"use strict";
var AssetLibrary_1 = require("awayjs-core/lib/library/AssetLibrary");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var LoaderEvent_1 = require("awayjs-core/lib/events/LoaderEvent");
var CoordinateSystem_1 = require("awayjs-core/lib/projections/CoordinateSystem");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View_1 = require("awayjs-display/lib/View");
var HoverController_1 = require("awayjs-display/lib/controllers/HoverController");
var Billboard_1 = require("awayjs-display/lib/display/Billboard");
var MouseEvent_1 = require("awayjs-display/lib/events/MouseEvent");
var BasicMaterial_1 = require("awayjs-display/lib/materials/BasicMaterial");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var LayoutTest = (function () {
    function LayoutTest() {
        var _this = this;
        this._move = false;
        this._billboards = new Array();
        //listen for a resource complete event
        AssetLibrary_1.default.addEventListener(LoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        //load an image
        AssetLibrary_1.default.load(new URLRequest_1.default('assets/256x256.png'));
    }
    /**
     * Listener for load complete event
     *
     * @param event
     */
    LayoutTest.prototype.onLoadComplete = function (event) {
        var _this = this;
        //create the view
        this._view = new View_1.default(new DefaultRenderer_1.default());
        this._projection = this._view.camera.projection;
        this._projection.coordinateSystem = CoordinateSystem_1.default.RIGHT_HANDED;
        this._projection.focalLength = 1000;
        this._projection.preserveFocalLength = true;
        this._projection.originX = 0;
        this._projection.originY = 0;
        //create a bitmap material
        this._bitmapMaterial = new BasicMaterial_1.default(event.assets[0]);
        var billboard;
        var numHBillboards = 2;
        var numVBillboards = 2;
        for (var i = 0; i < numHBillboards; i++) {
            for (var j = 0; j < numVBillboards; j++) {
                billboard = new Billboard_1.default(this._bitmapMaterial);
                //billboard.width = 50;
                //billboard.height = 50;
                //billboard.pivot = new Vector3D(billboard.billboardWidth/2, billboard.billboardHeight/2, 0);
                billboard.x = j * 300;
                billboard.y = i * 300;
                billboard.z = 0;
                billboard.addEventListener(MouseEvent_1.default.MOUSE_MOVE, this.onMouseEvent);
                //billboard.orientationMode = away.base.OrientationMode.CAMERA_PLANE;
                //billboard.alignmentMode = away.base.AlignmentMode.PIVOT_POINT;
                this._billboards.push(billboard);
                //add billboard to the scene
                this._view.scene.addChild(billboard);
            }
        }
        this._hoverControl = new HoverController_1.default(this._view.camera, null, 180, 0, 1000);
        document.onmousedown = function (event) { return _this.onMouseDownHandler(event); };
        document.onmouseup = function (event) { return _this.onMouseUpHandler(event); };
        document.onmousemove = function (event) { return _this.onMouseMove(event); };
        window.onresize = function (event) { return _this.onResize(event); };
        //trigger an initial resize for the view
        this.onResize(null);
        //setup the RAF for a render listener
        this._timer = new RequestAnimationFrame_1.default(this.render, this);
        this._timer.start();
    };
    LayoutTest.prototype.onMouseEvent = function (event) {
        console.log(event);
    };
    LayoutTest.prototype.onResize = function (event) {
        this._view.x = 0;
        this._view.y = 0;
        this._view.width = window.innerWidth;
        this._view.height = window.innerHeight;
    };
    LayoutTest.prototype.render = function (dt) {
        for (var i = 0; i < this._billboards.length; i++) {
        }
        this._view.render();
    };
    LayoutTest.prototype.onMouseUpHandler = function (event) {
        this._move = false;
    };
    LayoutTest.prototype.onMouseMove = function (event) {
        if (this._move) {
            this._hoverControl.panAngle = 0.3 * (event.clientX - this._lastMouseX) + this._lastPanAngle;
            this._hoverControl.tiltAngle = -0.3 * (event.clientY - this._lastMouseY) + this._lastTiltAngle;
        }
    };
    LayoutTest.prototype.onMouseDownHandler = function (event) {
        this._lastPanAngle = this._hoverControl.panAngle;
        this._lastTiltAngle = this._hoverControl.tiltAngle;
        this._lastMouseX = event.clientX;
        this._lastMouseY = event.clientY;
        this._move = true;
    };
    return LayoutTest;
}());

//# sourceMappingURL=data:application/json;base64,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O1FBQzlGLENBQUM7SUFDRixDQUFDO0lBRU8sdUNBQWtCLEdBQTFCLFVBQTJCLEtBQWdCO1FBRTFDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUM7UUFDakQsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQztRQUNuRCxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7UUFDakMsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO0lBQ25CLENBQUM7SUFDRixpQkFBQztBQUFELENBaklBLEFBaUlDLElBQUEiLCJmaWxlIjoiZW50aXRpZXMvTGF5b3V0VGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCaXRtYXBJbWFnZTJEXHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2ltYWdlL0JpdG1hcEltYWdlMkRcIjtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiO1xuaW1wb3J0IEFzc2V0TGlicmFyeVx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvQXNzZXRMaWJyYXJ5XCI7XG5pbXBvcnQgVVJMTG9hZGVyXHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlclwiO1xuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdFwiO1xuaW1wb3J0IExvYWRlckV2ZW50XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0xvYWRlckV2ZW50XCI7XG5pbXBvcnQgQ29vcmRpbmF0ZVN5c3RlbVx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9wcm9qZWN0aW9ucy9Db29yZGluYXRlU3lzdGVtXCI7XG5pbXBvcnQgUGVyc3BlY3RpdmVQcm9qZWN0aW9uXHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvUGVyc3BlY3RpdmVQcm9qZWN0aW9uXCI7XG5pbXBvcnQgUmVxdWVzdEFuaW1hdGlvbkZyYW1lXHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvdXRpbHMvUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCI7XG5cbmltcG9ydCBWaWV3XHRcdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL1ZpZXdcIjtcbmltcG9ydCBIb3ZlckNvbnRyb2xsZXJcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvY29udHJvbGxlcnMvSG92ZXJDb250cm9sbGVyXCI7XG5pbXBvcnQgQmlsbGJvYXJkXHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9CaWxsYm9hcmRcIjtcbmltcG9ydCBTcHJpdGVcdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL2Rpc3BsYXkvU3ByaXRlXCI7XG5pbXBvcnQgQXdheU1vdXNlRXZlbnRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZXZlbnRzL01vdXNlRXZlbnRcIjtcbmltcG9ydCBCYXNpY01hdGVyaWFsXHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9CYXNpY01hdGVyaWFsXCI7XG5pbXBvcnQgU2luZ2xlMkRUZXh0dXJlXHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL3RleHR1cmVzL1NpbmdsZTJEVGV4dHVyZVwiO1xuXG5pbXBvcnQgRGVmYXVsdFJlbmRlcmVyXHRcdFx0XHRmcm9tIFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL0RlZmF1bHRSZW5kZXJlclwiO1xuXG5jbGFzcyBMYXlvdXRUZXN0XG57XG5cdHByaXZhdGUgX3ZpZXc6Vmlldztcblx0cHJpdmF0ZSBfcHJvamVjdGlvbjpQZXJzcGVjdGl2ZVByb2plY3Rpb247XG5cdHByaXZhdGUgX3RpbWVyOlJlcXVlc3RBbmltYXRpb25GcmFtZTtcblx0cHJpdmF0ZSBfaG92ZXJDb250cm9sOkhvdmVyQ29udHJvbGxlcjtcblxuXHRwcml2YXRlIF9tb3ZlOmJvb2xlYW4gPSBmYWxzZTtcblx0cHJpdmF0ZSBfbGFzdFBhbkFuZ2xlOm51bWJlcjtcblx0cHJpdmF0ZSBfbGFzdFRpbHRBbmdsZTpudW1iZXI7XG5cdHByaXZhdGUgX2xhc3RNb3VzZVg6bnVtYmVyO1xuXHRwcml2YXRlIF9sYXN0TW91c2VZOm51bWJlcjtcblxuXHRwcml2YXRlIF90ZXh0dXJlOlNpbmdsZTJEVGV4dHVyZTtcblx0cHJpdmF0ZSBfYml0bWFwTWF0ZXJpYWw6QmFzaWNNYXRlcmlhbDtcblx0cHJpdmF0ZSBfYmlsbGJvYXJkczpBcnJheTxCaWxsYm9hcmQ+ID0gbmV3IEFycmF5PEJpbGxib2FyZD4oKTtcblxuXHRjb25zdHJ1Y3RvcigpXG5cdHtcblx0XHQvL2xpc3RlbiBmb3IgYSByZXNvdXJjZSBjb21wbGV0ZSBldmVudFxuXHRcdEFzc2V0TGlicmFyeS5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUgLCAoZXZlbnQ6TG9hZGVyRXZlbnQpID0+IHRoaXMub25Mb2FkQ29tcGxldGUoZXZlbnQpKTtcblxuXHRcdC8vbG9hZCBhbiBpbWFnZVxuXHRcdEFzc2V0TGlicmFyeS5sb2FkKG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvMjU2eDI1Ni5wbmcnKSApO1xuXHR9XG5cblx0LyoqXG5cdCAqIExpc3RlbmVyIGZvciBsb2FkIGNvbXBsZXRlIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBldmVudFxuXHQgKi9cblx0cHJpdmF0ZSBvbkxvYWRDb21wbGV0ZShldmVudDpMb2FkZXJFdmVudClcblx0e1xuXHRcdC8vY3JlYXRlIHRoZSB2aWV3XG5cdFx0dGhpcy5fdmlldyA9IG5ldyBWaWV3KG5ldyBEZWZhdWx0UmVuZGVyZXIoKSk7XG5cblx0XHR0aGlzLl9wcm9qZWN0aW9uID0gPFBlcnNwZWN0aXZlUHJvamVjdGlvbj4gdGhpcy5fdmlldy5jYW1lcmEucHJvamVjdGlvbjtcblxuXG5cdFx0dGhpcy5fcHJvamVjdGlvbi5jb29yZGluYXRlU3lzdGVtID0gQ29vcmRpbmF0ZVN5c3RlbS5SSUdIVF9IQU5ERUQ7XG5cdFx0dGhpcy5fcHJvamVjdGlvbi5mb2NhbExlbmd0aCA9IDEwMDA7XG5cdFx0dGhpcy5fcHJvamVjdGlvbi5wcmVzZXJ2ZUZvY2FsTGVuZ3RoID0gdHJ1ZTtcblx0XHR0aGlzLl9wcm9qZWN0aW9uLm9yaWdpblggPSAwO1xuXHRcdHRoaXMuX3Byb2plY3Rpb24ub3JpZ2luWSA9IDA7XG5cblx0XHQvL2NyZWF0ZSBhIGJpdG1hcCBtYXRlcmlhbFxuXHRcdHRoaXMuX2JpdG1hcE1hdGVyaWFsID0gbmV3IEJhc2ljTWF0ZXJpYWwoPEJpdG1hcEltYWdlMkQ+IGV2ZW50LmFzc2V0c1swXSk7XG5cblx0XHR2YXIgYmlsbGJvYXJkOkJpbGxib2FyZDtcblx0XHR2YXIgbnVtSEJpbGxib2FyZHM6bnVtYmVyID0gMjtcblx0XHR2YXIgbnVtVkJpbGxib2FyZHM6bnVtYmVyID0gMjtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBudW1IQmlsbGJvYXJkczsgaSsrKSB7XG5cdFx0XHRmb3IgKHZhciBqOm51bWJlciA9IDA7IGogPCBudW1WQmlsbGJvYXJkczsgaisrKSB7XG5cdFx0XHRcdGJpbGxib2FyZCA9IG5ldyBCaWxsYm9hcmQodGhpcy5fYml0bWFwTWF0ZXJpYWwpO1xuXHRcdFx0XHQvL2JpbGxib2FyZC53aWR0aCA9IDUwO1xuXHRcdFx0XHQvL2JpbGxib2FyZC5oZWlnaHQgPSA1MDtcblx0XHRcdFx0Ly9iaWxsYm9hcmQucGl2b3QgPSBuZXcgVmVjdG9yM0QoYmlsbGJvYXJkLmJpbGxib2FyZFdpZHRoLzIsIGJpbGxib2FyZC5iaWxsYm9hcmRIZWlnaHQvMiwgMCk7XG5cdFx0XHRcdGJpbGxib2FyZC54ID0gaiozMDA7XG5cdFx0XHRcdGJpbGxib2FyZC55ID0gaSozMDA7XG5cdFx0XHRcdGJpbGxib2FyZC56ID0gMDtcblx0XHRcdFx0YmlsbGJvYXJkLmFkZEV2ZW50TGlzdGVuZXIoQXdheU1vdXNlRXZlbnQuTU9VU0VfTU9WRSwgdGhpcy5vbk1vdXNlRXZlbnQpO1xuXHRcdFx0XHQvL2JpbGxib2FyZC5vcmllbnRhdGlvbk1vZGUgPSBhd2F5LmJhc2UuT3JpZW50YXRpb25Nb2RlLkNBTUVSQV9QTEFORTtcblx0XHRcdFx0Ly9iaWxsYm9hcmQuYWxpZ25tZW50TW9kZSA9IGF3YXkuYmFzZS5BbGlnbm1lbnRNb2RlLlBJVk9UX1BPSU5UO1xuXHRcdFx0XHR0aGlzLl9iaWxsYm9hcmRzLnB1c2goYmlsbGJvYXJkKTtcblx0XHRcdFx0Ly9hZGQgYmlsbGJvYXJkIHRvIHRoZSBzY2VuZVxuXHRcdFx0XHR0aGlzLl92aWV3LnNjZW5lLmFkZENoaWxkKGJpbGxib2FyZCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGhpcy5faG92ZXJDb250cm9sID0gbmV3IEhvdmVyQ29udHJvbGxlcih0aGlzLl92aWV3LmNhbWVyYSwgbnVsbCwgMTgwLCAwLCAxMDAwKTtcblxuXHRcdGRvY3VtZW50Lm9ubW91c2Vkb3duID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZURvd25IYW5kbGVyKGV2ZW50KTtcblx0XHRkb2N1bWVudC5vbm1vdXNldXAgPSAoZXZlbnQ6TW91c2VFdmVudCkgPT4gdGhpcy5vbk1vdXNlVXBIYW5kbGVyKGV2ZW50KTtcblx0XHRkb2N1bWVudC5vbm1vdXNlbW92ZSA9IChldmVudDpNb3VzZUV2ZW50KSA9PiB0aGlzLm9uTW91c2VNb3ZlKGV2ZW50KTtcblxuXHRcdHdpbmRvdy5vbnJlc2l6ZSAgPSAoZXZlbnQ6VUlFdmVudCkgPT4gdGhpcy5vblJlc2l6ZShldmVudCk7XG5cblx0XHQvL3RyaWdnZXIgYW4gaW5pdGlhbCByZXNpemUgZm9yIHRoZSB2aWV3XG5cdFx0dGhpcy5vblJlc2l6ZShudWxsKTtcblxuXHRcdC8vc2V0dXAgdGhlIFJBRiBmb3IgYSByZW5kZXIgbGlzdGVuZXJcblx0XHR0aGlzLl90aW1lciA9IG5ldyBSZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yZW5kZXIsIHRoaXMpO1xuXHRcdHRoaXMuX3RpbWVyLnN0YXJ0KCk7XG5cdH1cblxuXHRwcml2YXRlIG9uTW91c2VFdmVudChldmVudDpBd2F5TW91c2VFdmVudClcblx0e1xuXHRcdGNvbnNvbGUubG9nKGV2ZW50KTtcblx0fVxuXG5cdHByaXZhdGUgb25SZXNpemUoZXZlbnQ6VUlFdmVudClcblx0e1xuXHRcdHRoaXMuX3ZpZXcueCA9IDA7XG5cdFx0dGhpcy5fdmlldy55ID0gMDtcblx0XHR0aGlzLl92aWV3LndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG5cdFx0dGhpcy5fdmlldy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cdH1cblxuXHRwcml2YXRlIHJlbmRlcihkdDpudW1iZXIpXG5cdHtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCB0aGlzLl9iaWxsYm9hcmRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHQvL3RoaXMuX2JpbGxib2FyZHNbaV0ucm90YXRpb25aICs9Mjtcblx0XHR9XG5cblx0XHR0aGlzLl92aWV3LnJlbmRlcigpO1xuXG5cdH1cblxuXHRwcml2YXRlIG9uTW91c2VVcEhhbmRsZXIoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdHRoaXMuX21vdmUgPSBmYWxzZTtcblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZU1vdmUoZXZlbnQ6TW91c2VFdmVudClcblx0e1xuXHRcdGlmICh0aGlzLl9tb3ZlKSB7XG5cdFx0XHR0aGlzLl9ob3ZlckNvbnRyb2wucGFuQW5nbGUgPSAwLjMqKGV2ZW50LmNsaWVudFggLSB0aGlzLl9sYXN0TW91c2VYKSArIHRoaXMuX2xhc3RQYW5BbmdsZTtcblx0XHRcdHRoaXMuX2hvdmVyQ29udHJvbC50aWx0QW5nbGUgPSAtMC4zKihldmVudC5jbGllbnRZIC0gdGhpcy5fbGFzdE1vdXNlWSkgKyB0aGlzLl9sYXN0VGlsdEFuZ2xlO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgb25Nb3VzZURvd25IYW5kbGVyKGV2ZW50Ok1vdXNlRXZlbnQpXG5cdHtcblx0XHR0aGlzLl9sYXN0UGFuQW5nbGUgPSB0aGlzLl9ob3ZlckNvbnRyb2wucGFuQW5nbGU7XG5cdFx0dGhpcy5fbGFzdFRpbHRBbmdsZSA9IHRoaXMuX2hvdmVyQ29udHJvbC50aWx0QW5nbGU7XG5cdFx0dGhpcy5fbGFzdE1vdXNlWCA9IGV2ZW50LmNsaWVudFg7XG5cdFx0dGhpcy5fbGFzdE1vdXNlWSA9IGV2ZW50LmNsaWVudFk7XG5cdFx0dGhpcy5fbW92ZSA9IHRydWU7XG5cdH1cbn0iXSwic291cmNlUm9vdCI6Ii4vdGVzdHMifQ==