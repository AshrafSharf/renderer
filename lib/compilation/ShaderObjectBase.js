var LineSubGeometry = require("awayjs-core/lib/data/LineSubGeometry");
var TriangleSubGeometry = require("awayjs-core/lib/data/TriangleSubGeometry");
var ContextGLTriangleFace = require("awayjs-stagegl/lib/base/ContextGLTriangleFace");
var ShaderCompilerBase = require("awayjs-renderergl/lib/compilation/ShaderCompilerBase");
/**
 * ShaderObjectBase keeps track of the number of dependencies for "named registers" used across a pass.
 * Named registers are that are not necessarily limited to a single method. They are created by the compiler and
 * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed
 * each time a method has been compiled into the shader.
 *
 * @see RegisterPool.addUsage
 */
var ShaderObjectBase = (function () {
    /**
     * Creates a new MethodCompilerVO object.
     */
    function ShaderObjectBase(renderableClass, renderPass, stage) {
        this._invalidShader = true;
        this._invalidProgram = true;
        this._animationVertexCode = "";
        this._animationFragmentCode = "";
        this._defaultCulling = ContextGLTriangleFace.BACK;
        this._pInverseSceneMatrix = new Array();
        //set ambient values to default
        this.ambientR = 0xFF;
        this.ambientG = 0xFF;
        this.ambientB = 0xFF;
        /**
         * Indicates whether there are any dependencies on the world-space position vector.
         */
        this.usesGlobalPosFragment = false;
        this.vertexConstantData = new Array();
        this.fragmentConstantData = new Array();
        this._renderableClass = renderableClass;
        this._renderPass = renderPass;
        this._stage = stage;
        this.profile = this._stage.profile;
    }
    Object.defineProperty(ShaderObjectBase.prototype, "programData", {
        get: function () {
            if (this._invalidProgram)
                this._updateProgram();
            return this._programData;
        },
        enumerable: true,
        configurable: true
    });
    ShaderObjectBase.prototype._iIncludeDependencies = function () {
        this._renderPass._iIncludeDependencies(this);
    };
    /**
     * Factory method to create a concrete compiler object for this object
     *
     * @param renderableClass
     * @param renderPass
     * @param stage
     * @returns {ShaderCompilerBase}
     */
    ShaderObjectBase.prototype.createCompiler = function (renderableClass, renderPass) {
        return new ShaderCompilerBase(renderableClass, renderPass, this);
    };
    /**
     * Clears dependency counts for all registers. Called when recompiling a pass.
     */
    ShaderObjectBase.prototype.reset = function () {
        this.projectionDependencies = 0;
        this.normalDependencies = 0;
        this.colorDependencies = 0;
        this.viewDirDependencies = 0;
        this.uvDependencies = 0;
        this.secondaryUVDependencies = 0;
        this.globalPosDependencies = 0;
        this.localPosDependencies = 0;
        this.tangentDependencies = 0;
        this.usesGlobalPosFragment = false;
        this.usesFragmentAnimation = false;
        this.usesTangentSpace = false;
        this.outputsNormals = false;
        this.outputsTangentNormals = false;
    };
    ShaderObjectBase.prototype.pInitRegisterIndices = function () {
        this.commonsDataIndex = -1;
        this.cameraPositionIndex = -1;
        this.uvBufferIndex = -1;
        this.uvTransformIndex = -1;
        this.secondaryUVBufferIndex = -1;
        this.normalBufferIndex = -1;
        this.colorBufferIndex = -1;
        this.tangentBufferIndex = -1;
        this.sceneMatrixIndex = -1;
        this.sceneNormalMatrixIndex = -1;
    };
    /**
     * Initializes the unchanging constant data for this shader object.
     */
    ShaderObjectBase.prototype.initConstantData = function (registerCache, animatableAttributes, animationTargetRegisters, uvSource, uvTarget) {
        //Updates the amount of used register indices.
        this.numUsedVertexConstants = registerCache.numUsedVertexConstants;
        this.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;
        this.numUsedStreams = registerCache.numUsedStreams;
        this.numUsedTextures = registerCache.numUsedTextures;
        this.numUsedVaryings = registerCache.numUsedVaryings;
        this.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;
        this.animatableAttributes = animatableAttributes;
        this.animationTargetRegisters = animationTargetRegisters;
        this.uvSource = uvSource;
        this.uvTarget = uvTarget;
        this.vertexConstantData.length = this.numUsedVertexConstants * 4;
        this.fragmentConstantData.length = this.numUsedFragmentConstants * 4;
        //Initializes commonly required constant values.
        this.fragmentConstantData[this.commonsDataIndex] = .5;
        this.fragmentConstantData[this.commonsDataIndex + 1] = 0;
        this.fragmentConstantData[this.commonsDataIndex + 2] = 1 / 255;
        this.fragmentConstantData[this.commonsDataIndex + 3] = 1;
        //Initializes the default UV transformation matrix.
        if (this.uvTransformIndex >= 0) {
            this.vertexConstantData[this.uvTransformIndex] = 1;
            this.vertexConstantData[this.uvTransformIndex + 1] = 0;
            this.vertexConstantData[this.uvTransformIndex + 2] = 0;
            this.vertexConstantData[this.uvTransformIndex + 3] = 0;
            this.vertexConstantData[this.uvTransformIndex + 4] = 0;
            this.vertexConstantData[this.uvTransformIndex + 5] = 1;
            this.vertexConstantData[this.uvTransformIndex + 6] = 0;
            this.vertexConstantData[this.uvTransformIndex + 7] = 0;
        }
        if (this.cameraPositionIndex >= 0)
            this.vertexConstantData[this.cameraPositionIndex + 3] = 1;
    };
    /**
     * @inheritDoc
     */
    ShaderObjectBase.prototype._iActivate = function (camera) {
        if (this.usesAnimation)
            this._renderPass.animationSet.activate(this, this._stage);
        this._stage.context.setCulling(this.useBothSides ? ContextGLTriangleFace.NONE : this._defaultCulling, camera.projection.coordinateSystem);
        if (!this.usesTangentSpace && this.cameraPositionIndex >= 0) {
            var pos = camera.scenePosition;
            this.vertexConstantData[this.cameraPositionIndex] = pos.x;
            this.vertexConstantData[this.cameraPositionIndex + 1] = pos.y;
            this.vertexConstantData[this.cameraPositionIndex + 2] = pos.z;
        }
    };
    /**
     * @inheritDoc
     */
    ShaderObjectBase.prototype._iDeactivate = function () {
        if (this.usesAnimation)
            this._renderPass.animationSet.deactivate(this, this._stage);
    };
    /**
     *
     *
     * @param renderable
     * @param stage
     * @param camera
     */
    ShaderObjectBase.prototype._iRender = function (renderable, camera, viewProjection) {
        if (renderable.renderableOwner.animator)
            renderable.renderableOwner.animator.setRenderState(this, renderable, this._stage, camera, this.numUsedVertexConstants, this.numUsedStreams);
        if (this.uvBufferIndex >= 0)
            this._stage.activateBuffer(this.uvBufferIndex, renderable.getVertexData(TriangleSubGeometry.UV_DATA), renderable.getVertexOffset(TriangleSubGeometry.UV_DATA), TriangleSubGeometry.UV_FORMAT);
        if (this.secondaryUVBufferIndex >= 0)
            this._stage.activateBuffer(this.secondaryUVBufferIndex, renderable.getVertexData(TriangleSubGeometry.SECONDARY_UV_DATA), renderable.getVertexOffset(TriangleSubGeometry.SECONDARY_UV_DATA), TriangleSubGeometry.SECONDARY_UV_FORMAT);
        if (this.normalBufferIndex >= 0)
            this._stage.activateBuffer(this.normalBufferIndex, renderable.getVertexData(TriangleSubGeometry.NORMAL_DATA), renderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);
        if (this.tangentBufferIndex >= 0)
            this._stage.activateBuffer(this.tangentBufferIndex, renderable.getVertexData(TriangleSubGeometry.TANGENT_DATA), renderable.getVertexOffset(TriangleSubGeometry.TANGENT_DATA), TriangleSubGeometry.TANGENT_FORMAT);
        if (this.colorBufferIndex >= 0)
            this._stage.activateBuffer(this.colorBufferIndex, renderable.getVertexData(LineSubGeometry.COLOR_DATA), renderable.getVertexOffset(LineSubGeometry.COLOR_DATA), LineSubGeometry.COLOR_FORMAT);
        if (this.usesUVTransform) {
            var uvTransform = renderable.renderableOwner.uvTransform.matrix;
            if (uvTransform) {
                this.vertexConstantData[this.uvTransformIndex] = uvTransform.a;
                this.vertexConstantData[this.uvTransformIndex + 1] = uvTransform.b;
                this.vertexConstantData[this.uvTransformIndex + 3] = uvTransform.tx;
                this.vertexConstantData[this.uvTransformIndex + 4] = uvTransform.c;
                this.vertexConstantData[this.uvTransformIndex + 5] = uvTransform.d;
                this.vertexConstantData[this.uvTransformIndex + 7] = uvTransform.ty;
            }
            else {
                this.vertexConstantData[this.uvTransformIndex] = 1;
                this.vertexConstantData[this.uvTransformIndex + 1] = 0;
                this.vertexConstantData[this.uvTransformIndex + 3] = 0;
                this.vertexConstantData[this.uvTransformIndex + 4] = 0;
                this.vertexConstantData[this.uvTransformIndex + 5] = 1;
                this.vertexConstantData[this.uvTransformIndex + 7] = 0;
            }
        }
        if (this.sceneNormalMatrixIndex >= 0)
            renderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData, this.sceneNormalMatrixIndex, false);
        if (this.usesTangentSpace && this.cameraPositionIndex >= 0) {
            renderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);
            var pos = camera.scenePosition;
            var x = pos.x;
            var y = pos.y;
            var z = pos.z;
            this.vertexConstantData[this.cameraPositionIndex] = this._pInverseSceneMatrix[0] * x + this._pInverseSceneMatrix[4] * y + this._pInverseSceneMatrix[8] * z + this._pInverseSceneMatrix[12];
            this.vertexConstantData[this.cameraPositionIndex + 1] = this._pInverseSceneMatrix[1] * x + this._pInverseSceneMatrix[5] * y + this._pInverseSceneMatrix[9] * z + this._pInverseSceneMatrix[13];
            this.vertexConstantData[this.cameraPositionIndex + 2] = this._pInverseSceneMatrix[2] * x + this._pInverseSceneMatrix[6] * y + this._pInverseSceneMatrix[10] * z + this._pInverseSceneMatrix[14];
        }
    };
    ShaderObjectBase.prototype.invalidateProgram = function () {
        this._invalidProgram = true;
    };
    ShaderObjectBase.prototype.invalidateShader = function () {
        this._invalidShader = true;
        this._invalidProgram = true;
    };
    ShaderObjectBase.prototype.dispose = function () {
        this._programData.dispose();
        this._programData = null;
    };
    ShaderObjectBase.prototype._updateProgram = function () {
        this._invalidProgram = false;
        var compiler;
        if (this._invalidShader) {
            this._invalidShader = false;
            compiler = this.createCompiler(this._renderableClass, this._renderPass);
            compiler.compile();
        }
        this._calcAnimationCode(compiler.shadedTarget);
        var programData = this._stage.getProgramData(this._animationVertexCode + compiler.vertexCode, compiler.fragmentCode + this._animationFragmentCode + compiler.postAnimationFragmentCode);
        //check program data hasn't changed, keep count of program usages
        if (this._programData != programData) {
            if (this._programData)
                this._programData.dispose();
            this._programData = programData;
            programData.usages++;
        }
    };
    ShaderObjectBase.prototype._calcAnimationCode = function (shadedTarget) {
        //reset code
        this._animationVertexCode = "";
        this._animationFragmentCode = "";
        //check to see if GPU animation is used
        if (this.usesAnimation) {
            var animationSet = this._renderPass.animationSet;
            this._animationVertexCode += animationSet.getAGALVertexCode(this);
            if (this.uvDependencies > 0 && !this.usesUVTransform)
                this._animationVertexCode += animationSet.getAGALUVCode(this);
            if (this.usesFragmentAnimation)
                this._animationFragmentCode += animationSet.getAGALFragmentCode(this, shadedTarget);
            animationSet.doneAGALCode(this);
        }
        else {
            // simply write attributes to targets, do not animate them
            // projection will pick up on targets[0] to do the projection
            var len = this.animatableAttributes.length;
            for (var i = 0; i < len; ++i)
                this._animationVertexCode += "mov " + this.animationTargetRegisters[i] + ", " + this.animatableAttributes[i] + "\n";
            if (this.uvDependencies > 0 && !this.usesUVTransform)
                this._animationVertexCode += "mov " + this.uvTarget + "," + this.uvSource + "\n";
        }
    };
    return ShaderObjectBase;
})();
module.exports = ShaderObjectBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlLnRzIl0sIm5hbWVzIjpbIlNoYWRlck9iamVjdEJhc2UiLCJTaGFkZXJPYmplY3RCYXNlLmNvbnN0cnVjdG9yIiwiU2hhZGVyT2JqZWN0QmFzZS5wcm9ncmFtRGF0YSIsIlNoYWRlck9iamVjdEJhc2UuX2lJbmNsdWRlRGVwZW5kZW5jaWVzIiwiU2hhZGVyT2JqZWN0QmFzZS5jcmVhdGVDb21waWxlciIsIlNoYWRlck9iamVjdEJhc2UucmVzZXQiLCJTaGFkZXJPYmplY3RCYXNlLnBJbml0UmVnaXN0ZXJJbmRpY2VzIiwiU2hhZGVyT2JqZWN0QmFzZS5pbml0Q29uc3RhbnREYXRhIiwiU2hhZGVyT2JqZWN0QmFzZS5faUFjdGl2YXRlIiwiU2hhZGVyT2JqZWN0QmFzZS5faURlYWN0aXZhdGUiLCJTaGFkZXJPYmplY3RCYXNlLl9pUmVuZGVyIiwiU2hhZGVyT2JqZWN0QmFzZS5pbnZhbGlkYXRlUHJvZ3JhbSIsIlNoYWRlck9iamVjdEJhc2UuaW52YWxpZGF0ZVNoYWRlciIsIlNoYWRlck9iamVjdEJhc2UuZGlzcG9zZSIsIlNoYWRlck9iamVjdEJhc2UuX3VwZGF0ZVByb2dyYW0iLCJTaGFkZXJPYmplY3RCYXNlLl9jYWxjQW5pbWF0aW9uQ29kZSJdLCJtYXBwaW5ncyI6IkFBVUEsSUFBTyxlQUFlLFdBQWMsc0NBQXNDLENBQUMsQ0FBQztBQUM1RSxJQUFPLG1CQUFtQixXQUFhLDBDQUEwQyxDQUFDLENBQUM7QUFLbkYsSUFBTyxxQkFBcUIsV0FBWSwrQ0FBK0MsQ0FBQyxDQUFDO0FBVXpGLElBQU8sa0JBQWtCLFdBQWEsc0RBQXNELENBQUMsQ0FBQztBQUs5RixBQVFBOzs7Ozs7O0dBREc7SUFDRyxnQkFBZ0I7SUFvTnJCQTs7T0FFR0E7SUFDSEEsU0F2TktBLGdCQUFnQkEsQ0F1TlRBLGVBQWdDQSxFQUFFQSxVQUEwQkEsRUFBRUEsS0FBV0E7UUFoTjdFQyxtQkFB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Q2hDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDbkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN2REEsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ3ZEQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDdkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN2REEsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQ3ZEQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDdkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN4REEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNqQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzVEQSxDQUFDQTtJQUdEUDs7T0FFR0E7SUFDSUEscUNBQVVB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QSxDQUFDQSxpQkFBaUJBLENBQUNBLEVBQUVBLG1CQUFtQkEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxDQUFDQTtRQUV0T0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUMvQkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQSxtQkFBbUJBLENBQUNBLFdBQVdBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsRUFBRUEsbUJBQW1CQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQTtRQUUvTUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNoQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxFQUFFQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQSxtQkFBbUJBLENBQUNBLFlBQVlBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsRUFBRUEsbUJBQW1CQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQTtRQUVuTkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUM5QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxFQUFFQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQSxlQUFlQSxDQUFDQSxVQUFVQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxlQUFlQSxDQUFDQSxlQUFlQSxDQUFDQSxVQUFVQSxDQUFDQSxFQUFFQSxlQUFlQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtRQUcvTEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDMUJBLElBQUlBLFdBQVdBLEdBQVVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBO1lBRXZFQSxFQUFFQSxDQUFDQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDakJBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDL0RBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDbkVBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxFQUFFQSxDQUFDQTtnQkFDcEVBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDbkVBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDbkVBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUNyRUEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDbkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDdkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDdkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDdkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDdkRBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN4REEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNwQ0EsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEVBQUVBLElBQUlBLENBQUNBLHNCQUFzQkEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFFMUhBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsSUFBSUEsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUU1REEsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBO1lBQ3ZGQSxJQUFJQSxHQUFHQSxHQUFZQSxNQUFNQSxDQUFDQSxhQUFhQSxDQUFDQTtZQUN4Q0EsSUFBSUEsQ0FBQ0EsR0FBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDckJBLElBQUlBLENBQUNBLEdBQVVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JCQSxJQUFJQSxDQUFDQSxHQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUVyQkEsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDckxBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO1lBQ3pMQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLElBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9C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QUFFRCxBQUEwQixpQkFBakIsZ0JBQWdCLENBQUMiLCJmaWxlIjoiY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmxlbmRNb2RlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9kYXRhL0JsZW5kTW9kZVwiKTtcbmltcG9ydCBNYXRyaXhcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXhcIik7XG5pbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBFdmVudFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnRcIik7XG5pbXBvcnQgQXJndW1lbnRFcnJvclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2Vycm9ycy9Bcmd1bWVudEVycm9yXCIpO1xuaW1wb3J0IFRleHR1cmUyREJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi90ZXh0dXJlcy9UZXh0dXJlMkRCYXNlXCIpO1xuXG5pbXBvcnQgTGluZVN1Ykdlb21ldHJ5XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZGF0YS9MaW5lU3ViR2VvbWV0cnlcIik7XG5pbXBvcnQgVHJpYW5nbGVTdWJHZW9tZXRyeVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9kYXRhL1RyaWFuZ2xlU3ViR2VvbWV0cnlcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcblxuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcbmltcG9ydCBDb250ZXh0R0xDb21wYXJlTW9kZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTENvbXBhcmVNb2RlXCIpO1xuaW1wb3J0IENvbnRleHRHTFRyaWFuZ2xlRmFjZVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xUcmlhbmdsZUZhY2VcIik7XG5pbXBvcnQgQ29udGV4dEdMQmxlbmRGYWN0b3JcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xCbGVuZEZhY3RvclwiKTtcbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuaW1wb3J0IFByb2dyYW1EYXRhXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9wb29sL1Byb2dyYW1EYXRhXCIpO1xuXG5pbXBvcnQgQW5pbWF0aW9uU2V0QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9BbmltYXRpb25TZXRCYXNlXCIpO1xuaW1wb3J0IEFuaW1hdG9yQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL0FuaW1hdG9yQmFzZVwiKTtcbmltcG9ydCBBbmltYXRpb25SZWdpc3RlckNhY2hlXHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9BbmltYXRpb25SZWdpc3RlckNhY2hlXCIpO1xuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcbmltcG9ydCBJUmVuZGVyUGFzc0Jhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvSVJlbmRlclBhc3NCYXNlXCIpO1xuaW1wb3J0IFNoYWRlckNvbXBpbGVyQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJDb21waWxlckJhc2VcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xuaW1wb3J0IElSZW5kZXJhYmxlQ2xhc3NcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0lSZW5kZXJhYmxlQ2xhc3NcIik7XG5pbXBvcnQgUmVuZGVyZXJCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9iYXNlL1JlbmRlcmVyQmFzZVwiKTtcblxuLyoqXG4gKiBTaGFkZXJPYmplY3RCYXNlIGtlZXBzIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgZGVwZW5kZW5jaWVzIGZvciBcIm5hbWVkIHJlZ2lzdGVyc1wiIHVzZWQgYWNyb3NzIGEgcGFzcy5cbiAqIE5hbWVkIHJlZ2lzdGVycyBhcmUgdGhhdCBhcmUgbm90IG5lY2Vzc2FyaWx5IGxpbWl0ZWQgdG8gYSBzaW5nbGUgbWV0aG9kLiBUaGV5IGFyZSBjcmVhdGVkIGJ5IHRoZSBjb21waWxlciBhbmRcbiAqIHBhc3NlZCBvbiB0byBtZXRob2RzLiBUaGUgY29tcGlsZXIgdXNlcyB0aGUgcmVzdWx0cyB0byByZXNlcnZlIHVzYWdlcyB0aHJvdWdoIFJlZ2lzdGVyUG9vbCwgd2hpY2ggY2FuIGJlIHJlbW92ZWRcbiAqIGVhY2ggdGltZSBhIG1ldGhvZCBoYXMgYmVlbiBjb21waWxlZCBpbnRvIHRoZSBzaGFkZXIuXG4gKlxuICogQHNlZSBSZWdpc3RlclBvb2wuYWRkVXNhZ2VcbiAqL1xuY2xhc3MgU2hhZGVyT2JqZWN0QmFzZVxue1xuXHRwcml2YXRlIF9yZW5kZXJhYmxlQ2xhc3M6SVJlbmRlcmFibGVDbGFzcztcblx0cHJpdmF0ZSBfcmVuZGVyUGFzczpJUmVuZGVyUGFzc0Jhc2U7XG5cdHB1YmxpYyBfc3RhZ2U6U3RhZ2U7XG5cdHByaXZhdGUgX3Byb2dyYW1EYXRhOlByb2dyYW1EYXRhO1xuXG5cdHByaXZhdGUgX2ludmFsaWRTaGFkZXI6Ym9vbGVhbiA9IHRydWU7XG5cdHByaXZhdGUgX2ludmFsaWRQcm9ncmFtOmJvb2xlYW4gPSB0cnVlO1xuXHRwcml2YXRlIF9hbmltYXRpb25WZXJ0ZXhDb2RlOnN0cmluZyA9IFwiXCI7XG5cdHByaXZhdGUgX2FuaW1hdGlvbkZyYWdtZW50Q29kZTpzdHJpbmcgPSBcIlwiO1xuXG5cdHB1YmxpYyBnZXQgcHJvZ3JhbURhdGEoKTpQcm9ncmFtRGF0YVxuXHR7XG5cdFx0aWYgKHRoaXMuX2ludmFsaWRQcm9ncmFtKVxuXHRcdFx0dGhpcy5fdXBkYXRlUHJvZ3JhbSgpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX3Byb2dyYW1EYXRhO1xuXHR9XG5cblx0cHVibGljIHByb2ZpbGU6c3RyaW5nO1xuXG5cdHB1YmxpYyB1c2VzQW5pbWF0aW9uOmJvb2xlYW47XG5cblx0cHJpdmF0ZSBfZGVmYXVsdEN1bGxpbmc6c3RyaW5nID0gQ29udGV4dEdMVHJpYW5nbGVGYWNlLkJBQ0s7XG5cblx0cHVibGljIF9wSW52ZXJzZVNjZW5lTWF0cml4OkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXG5cdHB1YmxpYyBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGU7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgdXNlZCB2ZXJ0ZXggY29uc3RhbnRzIGluIHRoZSB2ZXJ0ZXggY29kZS4gVXNlZCBieSB0aGUgYW5pbWF0aW9uIGNvZGUgZ2VuZXJhdGlvbiB0byBrbm93IGZyb20gd2hpY2ggaW5kZXggb24gcmVnaXN0ZXJzIGFyZSBhdmFpbGFibGUuXG5cdCAqL1xuXHRwdWJsaWMgbnVtVXNlZFZlcnRleENvbnN0YW50czpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgdXNlZCBmcmFnbWVudCBjb25zdGFudHMgaW4gdGhlIGZyYWdtZW50IGNvZGUuIFVzZWQgYnkgdGhlIGFuaW1hdGlvbiBjb2RlIGdlbmVyYXRpb24gdG8ga25vdyBmcm9tIHdoaWNoIGluZGV4IG9uIHJlZ2lzdGVycyBhcmUgYXZhaWxhYmxlLlxuXHQgKi9cblx0cHVibGljIG51bVVzZWRGcmFnbWVudENvbnN0YW50czpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgdXNlZCB2ZXJ0ZXggc3RyZWFtcyBpbiB0aGUgdmVydGV4IGNvZGUuIFVzZWQgYnkgdGhlIGFuaW1hdGlvbiBjb2RlIGdlbmVyYXRpb24gdG8ga25vdyBmcm9tIHdoaWNoIGluZGV4IG9uIHN0cmVhbXMgYXJlIGF2YWlsYWJsZS5cblx0ICovXG5cdHB1YmxpYyBudW1Vc2VkU3RyZWFtczpudW1iZXI7XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgbnVtVXNlZFRleHR1cmVzOm51bWJlcjtcblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBudW1Vc2VkVmFyeWluZ3M6bnVtYmVyO1xuXG5cdHB1YmxpYyBhbmltYXRhYmxlQXR0cmlidXRlczpBcnJheTxzdHJpbmc+O1xuXHRwdWJsaWMgYW5pbWF0aW9uVGFyZ2V0UmVnaXN0ZXJzOkFycmF5PHN0cmluZz47XG5cdHB1YmxpYyB1dlNvdXJjZTpzdHJpbmc7XG5cdHB1YmxpYyB1dlRhcmdldDpzdHJpbmc7XG5cblx0cHVibGljIHVzZUFscGhhUHJlbXVsdGlwbGllZDpib29sZWFuO1xuXHRwdWJsaWMgdXNlQm90aFNpZGVzOmJvb2xlYW47XG5cdHB1YmxpYyB1c2VNaXBtYXBwaW5nOmJvb2xlYW47XG5cdHB1YmxpYyB1c2VTbW9vdGhUZXh0dXJlczpib29sZWFuO1xuXHRwdWJsaWMgcmVwZWF0VGV4dHVyZXM6Ym9vbGVhbjtcblx0cHVibGljIHVzZXNVVlRyYW5zZm9ybTpib29sZWFuO1xuXHRwdWJsaWMgYWxwaGFUaHJlc2hvbGQ6bnVtYmVyO1xuXHRwdWJsaWMgdGV4dHVyZTpUZXh0dXJlMkRCYXNlO1xuXHRwdWJsaWMgY29sb3I6bnVtYmVyO1xuXG5cblx0Ly9zZXQgYW1iaWVudCB2YWx1ZXMgdG8gZGVmYXVsdFxuXHRwdWJsaWMgYW1iaWVudFI6bnVtYmVyID0gMHhGRjtcblx0cHVibGljIGFtYmllbnRHOm51bWJlciA9IDB4RkY7XG5cdHB1YmxpYyBhbWJpZW50QjpudW1iZXIgPSAweEZGO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgcGFzcyByZXF1aXJlcyBhbnkgZnJhZ21lbnQgYW5pbWF0aW9uIGNvZGUuXG5cdCAqL1xuXHRwdWJsaWMgdXNlc0ZyYWdtZW50QW5pbWF0aW9uOmJvb2xlYW47XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgZGVwZW5kZW5jaWVzIG9uIHRoZSBwcm9qZWN0ZWQgcG9zaXRpb24uXG5cdCAqL1xuXHRwdWJsaWMgcHJvamVjdGlvbkRlcGVuZGVuY2llczpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgZGVwZW5kZW5jaWVzIG9uIHRoZSBub3JtYWwgdmVjdG9yLlxuXHQgKi9cblx0cHVibGljIG5vcm1hbERlcGVuZGVuY2llczpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgZGVwZW5kZW5jaWVzIG9uIHRoZSB2ZXJ0ZXggY29sb3IuXG5cdCAqL1xuXHRwdWJsaWMgY29sb3JEZXBlbmRlbmNpZXM6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBUaGUgYW1vdW50IG9mIGRlcGVuZGVuY2llcyBvbiB0aGUgdmlldyBkaXJlY3Rpb24uXG5cdCAqL1xuXHRwdWJsaWMgdmlld0RpckRlcGVuZGVuY2llczpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgZGVwZW5kZW5jaWVzIG9uIHRoZSBwcmltYXJ5IFVWIGNvb3JkaW5hdGVzLlxuXHQgKi9cblx0cHVibGljIHV2RGVwZW5kZW5jaWVzOm51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIGFtb3VudCBvZiBkZXBlbmRlbmNpZXMgb24gdGhlIHNlY29uZGFyeSBVViBjb29yZGluYXRlcy5cblx0ICovXG5cdHB1YmxpYyBzZWNvbmRhcnlVVkRlcGVuZGVuY2llczpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgZGVwZW5kZW5jaWVzIG9uIHRoZSBsb2NhbCBwb3NpdGlvbi4gVGhpcyBjYW4gYmUgMCB3aGlsZSBoYXNHbG9iYWxQb3NEZXBlbmRlbmNpZXMgaXMgdHJ1ZSB3aGVuXG5cdCAqIHRoZSBnbG9iYWwgcG9zaXRpb24gaXMgdXNlZCBhcyBhIHRlbXBvcmFyeSB2YWx1ZSAoZmUgdG8gY2FsY3VsYXRlIHRoZSB2aWV3IGRpcmVjdGlvbilcblx0ICovXG5cdHB1YmxpYyBsb2NhbFBvc0RlcGVuZGVuY2llczpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBhbW91bnQgb2YgZGVwZW5kZW5jaWVzIG9uIHRoZSBnbG9iYWwgcG9zaXRpb24uIFRoaXMgY2FuIGJlIDAgd2hpbGUgaGFzR2xvYmFsUG9zRGVwZW5kZW5jaWVzIGlzIHRydWUgd2hlblxuXHQgKiB0aGUgZ2xvYmFsIHBvc2l0aW9uIGlzIHVzZWQgYXMgYSB0ZW1wb3JhcnkgdmFsdWUgKGZlIHRvIGNhbGN1bGF0ZSB0aGUgdmlldyBkaXJlY3Rpb24pXG5cdCAqL1xuXHRwdWJsaWMgZ2xvYmFsUG9zRGVwZW5kZW5jaWVzOm51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIGFtb3VudCBvZiB0YW5nZW50IHZlY3RvciBkZXBlbmRlbmNpZXMgKGZyYWdtZW50IHNoYWRlcikuXG5cdCAqL1xuXHRwdWJsaWMgdGFuZ2VudERlcGVuZGVuY2llczpudW1iZXI7XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgb3V0cHV0c05vcm1hbHM6Ym9vbGVhbjtcblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBvdXRwdXRzQ29sb3JzOmJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCBub3JtYWwgY2FsY3VsYXRpb25zIGFyZSBleHBlY3RlZCBpbiB0YW5nZW50IHNwYWNlLiBUaGlzIGlzIG9ubHkgdGhlIGNhc2UgaWYgbm8gd29ybGQtc3BhY2Vcblx0ICogZGVwZW5kZW5jaWVzIGV4aXN0LlxuXHQgKi9cblx0cHVibGljIHVzZXNUYW5nZW50U3BhY2U6Ym9vbGVhbjtcblxuXHQvKipcblx0ICogSW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IG5vcm1hbCBjYWxjdWxhdGlvbnMgYXJlIG91dHB1dCBpbiB0YW5nZW50IHNwYWNlLlxuXHQgKi9cblx0cHVibGljIG91dHB1dHNUYW5nZW50Tm9ybWFsczpib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGVyZSBhcmUgYW55IGRlcGVuZGVuY2llcyBvbiB0aGUgd29ybGQtc3BhY2UgcG9zaXRpb24gdmVjdG9yLlxuXHQgKi9cblx0cHVibGljIHVzZXNHbG9iYWxQb3NGcmFnbWVudDpib29sZWFuID0gZmFsc2U7XG5cblx0cHVibGljIHZlcnRleENvbnN0YW50RGF0YTpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oKTtcblx0cHVibGljIGZyYWdtZW50Q29uc3RhbnREYXRhOkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXG5cdC8qKlxuXHQgKiBUaGUgaW5kZXggZm9yIHRoZSBjb21tb24gZGF0YSByZWdpc3Rlci5cblx0ICovXG5cdHB1YmxpYyBjb21tb25zRGF0YUluZGV4Om51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIGluZGV4IGZvciB0aGUgVVYgdmVydGV4IGF0dHJpYnV0ZSBzdHJlYW0uXG5cdCAqL1xuXHRwdWJsaWMgdXZCdWZmZXJJbmRleDpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBpbmRleCBmb3IgdGhlIHNlY29uZGFyeSBVViB2ZXJ0ZXggYXR0cmlidXRlIHN0cmVhbS5cblx0ICovXG5cdHB1YmxpYyBzZWNvbmRhcnlVVkJ1ZmZlckluZGV4Om51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIGluZGV4IGZvciB0aGUgdmVydGV4IG5vcm1hbCBhdHRyaWJ1dGUgc3RyZWFtLlxuXHQgKi9cblx0cHVibGljIG5vcm1hbEJ1ZmZlckluZGV4Om51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIGluZGV4IGZvciB0aGUgY29sb3IgYXR0cmlidXRlIHN0cmVhbS5cblx0ICovXG5cdHB1YmxpYyBjb2xvckJ1ZmZlckluZGV4Om51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIGluZGV4IGZvciB0aGUgdmVydGV4IHRhbmdlbnQgYXR0cmlidXRlIHN0cmVhbS5cblx0ICovXG5cdHB1YmxpYyB0YW5nZW50QnVmZmVySW5kZXg6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBUaGUgaW5kZXggb2YgdGhlIHZlcnRleCBjb25zdGFudCBjb250YWluaW5nIHRoZSB2aWV3IG1hdHJpeC5cblx0ICovXG5cdHB1YmxpYyB2aWV3TWF0cml4SW5kZXg6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBUaGUgaW5kZXggb2YgdGhlIHZlcnRleCBjb25zdGFudCBjb250YWluaW5nIHRoZSBzY2VuZSBtYXRyaXguXG5cdCAqL1xuXHRwdWJsaWMgc2NlbmVNYXRyaXhJbmRleDpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBpbmRleCBvZiB0aGUgdmVydGV4IGNvbnN0YW50IGNvbnRhaW5pbmcgdGhlIHVuaWZvcm0gc2NlbmUgbWF0cml4ICh0aGUgaW52ZXJzZSB0cmFuc3Bvc2UpLlxuXHQgKi9cblx0cHVibGljIHNjZW5lTm9ybWFsTWF0cml4SW5kZXg6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBUaGUgaW5kZXggb2YgdGhlIHZlcnRleCBjb25zdGFudCBjb250YWluaW5nIHRoZSBjYW1lcmEgcG9zaXRpb24uXG5cdCAqL1xuXHRwdWJsaWMgY2FtZXJhUG9zaXRpb25JbmRleDpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBpbmRleCBmb3IgdGhlIFVWIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCB2ZXJ0ZXggY29uc3RhbnQuXG5cdCAqL1xuXHRwdWJsaWMgdXZUcmFuc2Zvcm1JbmRleDpudW1iZXI7XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgTWV0aG9kQ29tcGlsZXJWTyBvYmplY3QuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcihyZW5kZXJhYmxlQ2xhc3M6SVJlbmRlcmFibGVDbGFzcywgcmVuZGVyUGFzczpJUmVuZGVyUGFzc0Jhc2UsIHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0dGhpcy5fcmVuZGVyYWJsZUNsYXNzID0gcmVuZGVyYWJsZUNsYXNzO1xuXHRcdHRoaXMuX3JlbmRlclBhc3MgPSByZW5kZXJQYXNzO1xuXHRcdHRoaXMuX3N0YWdlID0gc3RhZ2U7XG5cdFx0dGhpcy5wcm9maWxlID0gdGhpcy5fc3RhZ2UucHJvZmlsZTtcblx0fVxuXG5cdHB1YmxpYyBfaUluY2x1ZGVEZXBlbmRlbmNpZXMoKVxuXHR7XG5cdFx0dGhpcy5fcmVuZGVyUGFzcy5faUluY2x1ZGVEZXBlbmRlbmNpZXModGhpcyk7XG5cdH1cblxuXHQvKipcblx0ICogRmFjdG9yeSBtZXRob2QgdG8gY3JlYXRlIGEgY29uY3JldGUgY29tcGlsZXIgb2JqZWN0IGZvciB0aGlzIG9iamVjdFxuXHQgKlxuXHQgKiBAcGFyYW0gcmVuZGVyYWJsZUNsYXNzXG5cdCAqIEBwYXJhbSByZW5kZXJQYXNzXG5cdCAqIEBwYXJhbSBzdGFnZVxuXHQgKiBAcmV0dXJucyB7U2hhZGVyQ29tcGlsZXJCYXNlfVxuXHQgKi9cblx0cHVibGljIGNyZWF0ZUNvbXBpbGVyKHJlbmRlcmFibGVDbGFzczpJUmVuZGVyYWJsZUNsYXNzLCByZW5kZXJQYXNzOklSZW5kZXJQYXNzQmFzZSk6U2hhZGVyQ29tcGlsZXJCYXNlXG5cdHtcblx0XHRyZXR1cm4gbmV3IFNoYWRlckNvbXBpbGVyQmFzZShyZW5kZXJhYmxlQ2xhc3MsIHJlbmRlclBhc3MsIHRoaXMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENsZWFycyBkZXBlbmRlbmN5IGNvdW50cyBmb3IgYWxsIHJlZ2lzdGVycy4gQ2FsbGVkIHdoZW4gcmVjb21waWxpbmcgYSBwYXNzLlxuXHQgKi9cblx0cHVibGljIHJlc2V0KClcblx0e1xuXHRcdHRoaXMucHJvamVjdGlvbkRlcGVuZGVuY2llcyA9IDA7XG5cdFx0dGhpcy5ub3JtYWxEZXBlbmRlbmNpZXMgPSAwO1xuXHRcdHRoaXMuY29sb3JEZXBlbmRlbmNpZXMgPSAwO1xuXHRcdHRoaXMudmlld0RpckRlcGVuZGVuY2llcyA9IDA7XG5cdFx0dGhpcy51dkRlcGVuZGVuY2llcyA9IDA7XG5cdFx0dGhpcy5zZWNvbmRhcnlVVkRlcGVuZGVuY2llcyA9IDA7XG5cdFx0dGhpcy5nbG9iYWxQb3NEZXBlbmRlbmNpZXMgPSAwO1xuXHRcdHRoaXMubG9jYWxQb3NEZXBlbmRlbmNpZXMgPSAwO1xuXHRcdHRoaXMudGFuZ2VudERlcGVuZGVuY2llcyA9IDA7XG5cdFx0dGhpcy51c2VzR2xvYmFsUG9zRnJhZ21lbnQgPSBmYWxzZTtcblx0XHR0aGlzLnVzZXNGcmFnbWVudEFuaW1hdGlvbiA9IGZhbHNlO1xuXHRcdHRoaXMudXNlc1RhbmdlbnRTcGFjZSA9IGZhbHNlO1xuXHRcdHRoaXMub3V0cHV0c05vcm1hbHMgPSBmYWxzZTtcblx0XHR0aGlzLm91dHB1dHNUYW5nZW50Tm9ybWFscyA9IGZhbHNlO1xuXHR9XG5cblx0cHVibGljIHBJbml0UmVnaXN0ZXJJbmRpY2VzKClcblx0e1xuXHRcdHRoaXMuY29tbW9uc0RhdGFJbmRleCA9IC0xO1xuXHRcdHRoaXMuY2FtZXJhUG9zaXRpb25JbmRleCA9IC0xO1xuXHRcdHRoaXMudXZCdWZmZXJJbmRleCA9IC0xO1xuXHRcdHRoaXMudXZUcmFuc2Zvcm1JbmRleCA9IC0xO1xuXHRcdHRoaXMuc2Vjb25kYXJ5VVZCdWZmZXJJbmRleCA9IC0xO1xuXHRcdHRoaXMubm9ybWFsQnVmZmVySW5kZXggPSAtMTtcblx0XHR0aGlzLmNvbG9yQnVmZmVySW5kZXggPSAtMTtcblx0XHR0aGlzLnRhbmdlbnRCdWZmZXJJbmRleCA9IC0xO1xuXHRcdHRoaXMuc2NlbmVNYXRyaXhJbmRleCA9IC0xO1xuXHRcdHRoaXMuc2NlbmVOb3JtYWxNYXRyaXhJbmRleCA9IC0xO1xuXHR9XG5cblx0LyoqXG5cdCAqIEluaXRpYWxpemVzIHRoZSB1bmNoYW5naW5nIGNvbnN0YW50IGRhdGEgZm9yIHRoaXMgc2hhZGVyIG9iamVjdC5cblx0ICovXG5cdHB1YmxpYyBpbml0Q29uc3RhbnREYXRhKHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgYW5pbWF0YWJsZUF0dHJpYnV0ZXM6QXJyYXk8c3RyaW5nPiwgYW5pbWF0aW9uVGFyZ2V0UmVnaXN0ZXJzOkFycmF5PHN0cmluZz4sIHV2U291cmNlOnN0cmluZywgdXZUYXJnZXQ6c3RyaW5nKVxuXHR7XG5cdFx0Ly9VcGRhdGVzIHRoZSBhbW91bnQgb2YgdXNlZCByZWdpc3RlciBpbmRpY2VzLlxuXHRcdHRoaXMubnVtVXNlZFZlcnRleENvbnN0YW50cyA9IHJlZ2lzdGVyQ2FjaGUubnVtVXNlZFZlcnRleENvbnN0YW50cztcblx0XHR0aGlzLm51bVVzZWRGcmFnbWVudENvbnN0YW50cyA9IHJlZ2lzdGVyQ2FjaGUubnVtVXNlZEZyYWdtZW50Q29uc3RhbnRzO1xuXHRcdHRoaXMubnVtVXNlZFN0cmVhbXMgPSByZWdpc3RlckNhY2hlLm51bVVzZWRTdHJlYW1zO1xuXHRcdHRoaXMubnVtVXNlZFRleHR1cmVzID0gcmVnaXN0ZXJDYWNoZS5udW1Vc2VkVGV4dHVyZXM7XG5cdFx0dGhpcy5udW1Vc2VkVmFyeWluZ3MgPSByZWdpc3RlckNhY2hlLm51bVVzZWRWYXJ5aW5ncztcblx0XHR0aGlzLm51bVVzZWRGcmFnbWVudENvbnN0YW50cyA9IHJlZ2lzdGVyQ2FjaGUubnVtVXNlZEZyYWdtZW50Q29uc3RhbnRzO1xuXG5cdFx0dGhpcy5hbmltYXRhYmxlQXR0cmlidXRlcyA9IGFuaW1hdGFibGVBdHRyaWJ1dGVzO1xuXHRcdHRoaXMuYW5pbWF0aW9uVGFyZ2V0UmVnaXN0ZXJzID0gYW5pbWF0aW9uVGFyZ2V0UmVnaXN0ZXJzO1xuXHRcdHRoaXMudXZTb3VyY2UgPSB1dlNvdXJjZTtcblx0XHR0aGlzLnV2VGFyZ2V0ID0gdXZUYXJnZXQ7XG5cblx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YS5sZW5ndGggPSB0aGlzLm51bVVzZWRWZXJ0ZXhDb25zdGFudHMqNDtcblx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhLmxlbmd0aCA9IHRoaXMubnVtVXNlZEZyYWdtZW50Q29uc3RhbnRzKjQ7XG5cblx0XHQvL0luaXRpYWxpemVzIGNvbW1vbmx5IHJlcXVpcmVkIGNvbnN0YW50IHZhbHVlcy5cblx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW3RoaXMuY29tbW9uc0RhdGFJbmRleF0gPSAuNTtcblx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW3RoaXMuY29tbW9uc0RhdGFJbmRleCArIDFdID0gMDtcblx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW3RoaXMuY29tbW9uc0RhdGFJbmRleCArIDJdID0gMS8yNTU7XG5cdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVt0aGlzLmNvbW1vbnNEYXRhSW5kZXggKyAzXSA9IDE7XG5cblx0XHQvL0luaXRpYWxpemVzIHRoZSBkZWZhdWx0IFVWIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC5cblx0XHRpZiAodGhpcy51dlRyYW5zZm9ybUluZGV4ID49IDApIHtcblx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW3RoaXMudXZUcmFuc2Zvcm1JbmRleF0gPSAxO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgMV0gPSAwO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgMl0gPSAwO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgM10gPSAwO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgNF0gPSAwO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgNV0gPSAxO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgNl0gPSAwO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgN10gPSAwO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLmNhbWVyYVBvc2l0aW9uSW5kZXggPj0gMClcblx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW3RoaXMuY2FtZXJhUG9zaXRpb25JbmRleCArIDNdID0gMTtcblx0fVxuXG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lBY3RpdmF0ZShjYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0aWYgKHRoaXMudXNlc0FuaW1hdGlvbilcblx0XHRcdCg8QW5pbWF0aW9uU2V0QmFzZT4gdGhpcy5fcmVuZGVyUGFzcy5hbmltYXRpb25TZXQpLmFjdGl2YXRlKHRoaXMsIHRoaXMuX3N0YWdlKTtcblxuXHRcdHRoaXMuX3N0YWdlLmNvbnRleHQuc2V0Q3VsbGluZyh0aGlzLnVzZUJvdGhTaWRlcz8gQ29udGV4dEdMVHJpYW5nbGVGYWNlLk5PTkUgOiB0aGlzLl9kZWZhdWx0Q3VsbGluZywgY2FtZXJhLnByb2plY3Rpb24uY29vcmRpbmF0ZVN5c3RlbSk7XG5cblx0XHRpZiAoIXRoaXMudXNlc1RhbmdlbnRTcGFjZSAmJiB0aGlzLmNhbWVyYVBvc2l0aW9uSW5kZXggPj0gMCkge1xuXHRcdFx0dmFyIHBvczpWZWN0b3IzRCA9IGNhbWVyYS5zY2VuZVBvc2l0aW9uO1xuXG5cdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLmNhbWVyYVBvc2l0aW9uSW5kZXhdID0gcG9zLng7XG5cdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLmNhbWVyYVBvc2l0aW9uSW5kZXggKyAxXSA9IHBvcy55O1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy5jYW1lcmFQb3NpdGlvbkluZGV4ICsgMl0gPSBwb3Muejtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaURlYWN0aXZhdGUoKVxuXHR7XG5cdFx0aWYgKHRoaXMudXNlc0FuaW1hdGlvbilcblx0XHRcdCg8QW5pbWF0aW9uU2V0QmFzZT4gdGhpcy5fcmVuZGVyUGFzcy5hbmltYXRpb25TZXQpLmRlYWN0aXZhdGUodGhpcywgdGhpcy5fc3RhZ2UpO1xuXG5cdH1cblxuXG5cdC8qKlxuXHQgKlxuXHQgKlxuXHQgKiBAcGFyYW0gcmVuZGVyYWJsZVxuXHQgKiBAcGFyYW0gc3RhZ2Vcblx0ICogQHBhcmFtIGNhbWVyYVxuXHQgKi9cblx0cHVibGljIF9pUmVuZGVyKHJlbmRlcmFibGU6UmVuZGVyYWJsZUJhc2UsIGNhbWVyYTpDYW1lcmEsIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEKVxuXHR7XG5cdFx0aWYgKHJlbmRlcmFibGUucmVuZGVyYWJsZU93bmVyLmFuaW1hdG9yKVxuXHRcdFx0KDxBbmltYXRvckJhc2U+IHJlbmRlcmFibGUucmVuZGVyYWJsZU93bmVyLmFuaW1hdG9yKS5zZXRSZW5kZXJTdGF0ZSh0aGlzLCByZW5kZXJhYmxlLCB0aGlzLl9zdGFnZSwgY2FtZXJhLCB0aGlzLm51bVVzZWRWZXJ0ZXhDb25zdGFudHMsIHRoaXMubnVtVXNlZFN0cmVhbXMpO1xuXG5cdFx0aWYgKHRoaXMudXZCdWZmZXJJbmRleCA+PSAwKVxuXHRcdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIodGhpcy51dkJ1ZmZlckluZGV4LCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoVHJpYW5nbGVTdWJHZW9tZXRyeS5VVl9EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoVHJpYW5nbGVTdWJHZW9tZXRyeS5VVl9EQVRBKSwgVHJpYW5nbGVTdWJHZW9tZXRyeS5VVl9GT1JNQVQpO1xuXG5cdFx0aWYgKHRoaXMuc2Vjb25kYXJ5VVZCdWZmZXJJbmRleCA+PSAwKVxuXHRcdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIodGhpcy5zZWNvbmRhcnlVVkJ1ZmZlckluZGV4LCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoVHJpYW5nbGVTdWJHZW9tZXRyeS5TRUNPTkRBUllfVVZfREFUQSksIHJlbmRlcmFibGUuZ2V0VmVydGV4T2Zmc2V0KFRyaWFuZ2xlU3ViR2VvbWV0cnkuU0VDT05EQVJZX1VWX0RBVEEpLCBUcmlhbmdsZVN1Ykdlb21ldHJ5LlNFQ09OREFSWV9VVl9GT1JNQVQpO1xuXG5cdFx0aWYgKHRoaXMubm9ybWFsQnVmZmVySW5kZXggPj0gMClcblx0XHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKHRoaXMubm9ybWFsQnVmZmVySW5kZXgsIHJlbmRlcmFibGUuZ2V0VmVydGV4RGF0YShUcmlhbmdsZVN1Ykdlb21ldHJ5Lk5PUk1BTF9EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoVHJpYW5nbGVTdWJHZW9tZXRyeS5OT1JNQUxfREFUQSksIFRyaWFuZ2xlU3ViR2VvbWV0cnkuTk9STUFMX0ZPUk1BVCk7XG5cblx0XHRpZiAodGhpcy50YW5nZW50QnVmZmVySW5kZXggPj0gMClcblx0XHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKHRoaXMudGFuZ2VudEJ1ZmZlckluZGV4LCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoVHJpYW5nbGVTdWJHZW9tZXRyeS5UQU5HRU5UX0RBVEEpLCByZW5kZXJhYmxlLmdldFZlcnRleE9mZnNldChUcmlhbmdsZVN1Ykdlb21ldHJ5LlRBTkdFTlRfREFUQSksIFRyaWFuZ2xlU3ViR2VvbWV0cnkuVEFOR0VOVF9GT1JNQVQpO1xuXG5cdFx0aWYgKHRoaXMuY29sb3JCdWZmZXJJbmRleCA+PSAwKVxuXHRcdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIodGhpcy5jb2xvckJ1ZmZlckluZGV4LCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LkNPTE9SX0RBVEEpLCByZW5kZXJhYmxlLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuQ09MT1JfREFUQSksIExpbmVTdWJHZW9tZXRyeS5DT0xPUl9GT1JNQVQpO1xuXG5cblx0XHRpZiAodGhpcy51c2VzVVZUcmFuc2Zvcm0pIHtcblx0XHRcdHZhciB1dlRyYW5zZm9ybTpNYXRyaXggPSByZW5kZXJhYmxlLnJlbmRlcmFibGVPd25lci51dlRyYW5zZm9ybS5tYXRyaXg7XG5cblx0XHRcdGlmICh1dlRyYW5zZm9ybSkge1xuXHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLnV2VHJhbnNmb3JtSW5kZXhdID0gdXZUcmFuc2Zvcm0uYTtcblx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgMV0gPSB1dlRyYW5zZm9ybS5iO1xuXHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLnV2VHJhbnNmb3JtSW5kZXggKyAzXSA9IHV2VHJhbnNmb3JtLnR4O1xuXHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLnV2VHJhbnNmb3JtSW5kZXggKyA0XSA9IHV2VHJhbnNmb3JtLmM7XG5cdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW3RoaXMudXZUcmFuc2Zvcm1JbmRleCArIDVdID0gdXZUcmFuc2Zvcm0uZDtcblx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgN10gPSB1dlRyYW5zZm9ybS50eTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW3RoaXMudXZUcmFuc2Zvcm1JbmRleF0gPSAxO1xuXHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLnV2VHJhbnNmb3JtSW5kZXggKyAxXSA9IDA7XG5cdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW3RoaXMudXZUcmFuc2Zvcm1JbmRleCArIDNdID0gMDtcblx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy51dlRyYW5zZm9ybUluZGV4ICsgNF0gPSAwO1xuXHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLnV2VHJhbnNmb3JtSW5kZXggKyA1XSA9IDE7XG5cdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW3RoaXMudXZUcmFuc2Zvcm1JbmRleCArIDddID0gMDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodGhpcy5zY2VuZU5vcm1hbE1hdHJpeEluZGV4ID49IDApXG5cdFx0XHRyZW5kZXJhYmxlLnNvdXJjZUVudGl0eS5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0uY29weVJhd0RhdGFUbyh0aGlzLnZlcnRleENvbnN0YW50RGF0YSwgdGhpcy5zY2VuZU5vcm1hbE1hdHJpeEluZGV4LCBmYWxzZSk7XG5cblx0XHRpZiAodGhpcy51c2VzVGFuZ2VudFNwYWNlICYmIHRoaXMuY2FtZXJhUG9zaXRpb25JbmRleCA+PSAwKSB7XG5cblx0XHRcdHJlbmRlcmFibGUuc291cmNlRW50aXR5LmludmVyc2VTY2VuZVRyYW5zZm9ybS5jb3B5UmF3RGF0YVRvKHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXgpO1xuXHRcdFx0dmFyIHBvczpWZWN0b3IzRCA9IGNhbWVyYS5zY2VuZVBvc2l0aW9uO1xuXHRcdFx0dmFyIHg6bnVtYmVyID0gcG9zLng7XG5cdFx0XHR2YXIgeTpudW1iZXIgPSBwb3MueTtcblx0XHRcdHZhciB6Om51bWJlciA9IHBvcy56O1xuXG5cdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLmNhbWVyYVBvc2l0aW9uSW5kZXhdID0gdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFswXSp4ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs0XSp5ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs4XSp6ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxMl07XG5cdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVt0aGlzLmNhbWVyYVBvc2l0aW9uSW5kZXggKyAxXSA9IHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMV0qeCArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbNV0qeSArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbOV0qeiArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMTNdO1xuXHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbdGhpcy5jYW1lcmFQb3NpdGlvbkluZGV4ICsgMl0gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzJdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzZdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzEwXSp6ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxNF07XG5cdFx0fVxuXHR9XG5cdFxuXHRwdWJsaWMgaW52YWxpZGF0ZVByb2dyYW0oKVxuXHR7XG5cdFx0dGhpcy5faW52YWxpZFByb2dyYW0gPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGludmFsaWRhdGVTaGFkZXIoKVxuXHR7XG5cdFx0dGhpcy5faW52YWxpZFNoYWRlciA9IHRydWU7XG5cdFx0dGhpcy5faW52YWxpZFByb2dyYW0gPSB0cnVlO1xuXHR9XG5cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0dGhpcy5fcHJvZ3JhbURhdGEuZGlzcG9zZSgpO1xuXHRcdHRoaXMuX3Byb2dyYW1EYXRhID0gbnVsbDtcblx0fVxuXG5cdHByaXZhdGUgX3VwZGF0ZVByb2dyYW0oKVxuXHR7XG5cdFx0dGhpcy5faW52YWxpZFByb2dyYW0gPSBmYWxzZTtcblxuXHRcdHZhciBjb21waWxlcjpTaGFkZXJDb21waWxlckJhc2U7XG5cblx0XHRpZiAodGhpcy5faW52YWxpZFNoYWRlcikge1xuXHRcdFx0dGhpcy5faW52YWxpZFNoYWRlciA9IGZhbHNlO1xuXG5cdFx0XHRjb21waWxlciA9IHRoaXMuY3JlYXRlQ29tcGlsZXIodGhpcy5fcmVuZGVyYWJsZUNsYXNzLCB0aGlzLl9yZW5kZXJQYXNzKTtcblx0XHRcdGNvbXBpbGVyLmNvbXBpbGUoKTtcblx0XHR9XG5cblx0XHR0aGlzLl9jYWxjQW5pbWF0aW9uQ29kZShjb21waWxlci5zaGFkZWRUYXJnZXQpO1xuXG5cdFx0dmFyIHByb2dyYW1EYXRhOlByb2dyYW1EYXRhID0gdGhpcy5fc3RhZ2UuZ2V0UHJvZ3JhbURhdGEodGhpcy5fYW5pbWF0aW9uVmVydGV4Q29kZSArIGNvbXBpbGVyLnZlcnRleENvZGUsIGNvbXBpbGVyLmZyYWdtZW50Q29kZSArIHRoaXMuX2FuaW1hdGlvbkZyYWdtZW50Q29kZSArIGNvbXBpbGVyLnBvc3RBbmltYXRpb25GcmFnbWVudENvZGUpO1xuXG5cdFx0Ly9jaGVjayBwcm9ncmFtIGRhdGEgaGFzbid0IGNoYW5nZWQsIGtlZXAgY291bnQgb2YgcHJvZ3JhbSB1c2FnZXNcblx0XHRpZiAodGhpcy5fcHJvZ3JhbURhdGEgIT0gcHJvZ3JhbURhdGEpIHtcblx0XHRcdGlmICh0aGlzLl9wcm9ncmFtRGF0YSlcblx0XHRcdFx0dGhpcy5fcHJvZ3JhbURhdGEuZGlzcG9zZSgpO1xuXG5cdFx0XHR0aGlzLl9wcm9ncmFtRGF0YSA9IHByb2dyYW1EYXRhO1xuXG5cdFx0XHRwcm9ncmFtRGF0YS51c2FnZXMrKztcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIF9jYWxjQW5pbWF0aW9uQ29kZShzaGFkZWRUYXJnZXQ6c3RyaW5nKVxuXHR7XG5cdFx0Ly9yZXNldCBjb2RlXG5cdFx0dGhpcy5fYW5pbWF0aW9uVmVydGV4Q29kZSA9IFwiXCI7XG5cdFx0dGhpcy5fYW5pbWF0aW9uRnJhZ21lbnRDb2RlID0gXCJcIjtcblxuXHRcdC8vY2hlY2sgdG8gc2VlIGlmIEdQVSBhbmltYXRpb24gaXMgdXNlZFxuXHRcdGlmICh0aGlzLnVzZXNBbmltYXRpb24pIHtcblxuXHRcdFx0dmFyIGFuaW1hdGlvblNldDpBbmltYXRpb25TZXRCYXNlID0gPEFuaW1hdGlvblNldEJhc2U+IHRoaXMuX3JlbmRlclBhc3MuYW5pbWF0aW9uU2V0O1xuXG5cdFx0XHR0aGlzLl9hbmltYXRpb25WZXJ0ZXhDb2RlICs9IGFuaW1hdGlvblNldC5nZXRBR0FMVmVydGV4Q29kZSh0aGlzKTtcblxuXHRcdFx0aWYgKHRoaXMudXZEZXBlbmRlbmNpZXMgPiAwICYmICF0aGlzLnVzZXNVVlRyYW5zZm9ybSlcblx0XHRcdFx0dGhpcy5fYW5pbWF0aW9uVmVydGV4Q29kZSArPSBhbmltYXRpb25TZXQuZ2V0QUdBTFVWQ29kZSh0aGlzKTtcblxuXHRcdFx0aWYgKHRoaXMudXNlc0ZyYWdtZW50QW5pbWF0aW9uKVxuXHRcdFx0XHR0aGlzLl9hbmltYXRpb25GcmFnbWVudENvZGUgKz0gYW5pbWF0aW9uU2V0LmdldEFHQUxGcmFnbWVudENvZGUodGhpcywgc2hhZGVkVGFyZ2V0KTtcblxuXHRcdFx0YW5pbWF0aW9uU2V0LmRvbmVBR0FMQ29kZSh0aGlzKTtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBzaW1wbHkgd3JpdGUgYXR0cmlidXRlcyB0byB0YXJnZXRzLCBkbyBub3QgYW5pbWF0ZSB0aGVtXG5cdFx0XHQvLyBwcm9qZWN0aW9uIHdpbGwgcGljayB1cCBvbiB0YXJnZXRzWzBdIHRvIGRvIHRoZSBwcm9qZWN0aW9uXG5cdFx0XHR2YXIgbGVuOm51bWJlciA9IHRoaXMuYW5pbWF0YWJsZUF0dHJpYnV0ZXMubGVuZ3RoO1xuXHRcdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyArK2kpXG5cdFx0XHRcdHRoaXMuX2FuaW1hdGlvblZlcnRleENvZGUgKz0gXCJtb3YgXCIgKyB0aGlzLmFuaW1hdGlvblRhcmdldFJlZ2lzdGVyc1tpXSArIFwiLCBcIiArIHRoaXMuYW5pbWF0YWJsZUF0dHJpYnV0ZXNbaV0gKyBcIlxcblwiO1xuXG5cdFx0XHRpZiAodGhpcy51dkRlcGVuZGVuY2llcyA+IDAgJiYgIXRoaXMudXNlc1VWVHJhbnNmb3JtKVxuXHRcdFx0XHR0aGlzLl9hbmltYXRpb25WZXJ0ZXhDb2RlICs9IFwibW92IFwiICsgdGhpcy51dlRhcmdldCArIFwiLFwiICsgdGhpcy51dlNvdXJjZSArIFwiXFxuXCI7XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCA9IFNoYWRlck9iamVjdEJhc2U7Il19