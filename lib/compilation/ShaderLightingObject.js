var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var LightSources = require("awayjs-display/lib/materials/LightSources");
var ContextGLProfile = require("awayjs-stagegl/lib/base/ContextGLProfile");
var ShaderLightingCompiler = require("awayjs-renderergl/lib/compilation/ShaderLightingCompiler");
var ShaderObjectBase = require("awayjs-renderergl/lib/compilation/ShaderObjectBase");
/**
 * ShaderObjectBase keeps track of the number of dependencies for "named registers" used across a pass.
 * Named registers are that are not necessarily limited to a single method. They are created by the compiler and
 * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed
 * each time a method has been compiled into the shader.
 *
 * @see RegisterPool.addUsage
 */
var ShaderLightingObject = (function (_super) {
    __extends(ShaderLightingObject, _super);
    /**
     * Creates a new MethodCompilerVO object.
     */
    function ShaderLightingObject(renderableClass, renderLightingPass, stage) {
        _super.call(this, renderableClass, renderLightingPass, stage);
        this._includeCasters = true;
        this._renderLightingPass = renderLightingPass;
    }
    ShaderLightingObject.prototype._iIncludeDependencies = function () {
        this.numPointLights = this._renderLightingPass.numPointLights;
        this.numDirectionalLights = this._renderLightingPass.numDirectionalLights;
        this.numLightProbes = this._renderLightingPass.numLightProbes;
        var numAllLights = this._renderLightingPass.numPointLights + this._renderLightingPass.numDirectionalLights;
        var numLightProbes = this._renderLightingPass.numLightProbes;
        var diffuseLightSources = this._renderLightingPass._iUsesDiffuse(this) ? this._renderLightingPass.diffuseLightSources : 0x00;
        var specularLightSources = this._renderLightingPass._iUsesSpecular(this) ? this._renderLightingPass.specularLightSources : 0x00;
        var combinedLightSources = diffuseLightSources | specularLightSources;
        this.usesLightFallOff = this._renderLightingPass.enableLightFallOff && this.profile != ContextGLProfile.BASELINE_CONSTRAINED;
        this.numLights = numAllLights + numLightProbes;
        this.usesLights = numAllLights > 0 && (combinedLightSources & LightSources.LIGHTS) != 0;
        this.usesProbes = numLightProbes > 0 && (combinedLightSources & LightSources.PROBES) != 0;
        this.usesLightsForSpecular = numAllLights > 0 && (specularLightSources & LightSources.LIGHTS) != 0;
        this.usesProbesForSpecular = numLightProbes > 0 && (specularLightSources & LightSources.PROBES) != 0;
        this.usesLightsForDiffuse = numAllLights > 0 && (diffuseLightSources & LightSources.LIGHTS) != 0;
        this.usesProbesForDiffuse = numLightProbes > 0 && (diffuseLightSources & LightSources.PROBES) != 0;
        this.usesShadows = this._renderLightingPass._iUsesShadows(this);
        //IMPORTANT this must occur after shader lighting initialisation above
        _super.prototype._iIncludeDependencies.call(this);
    };
    /**
     * Factory method to create a concrete compiler object for this object
     *
     * @param materialPassVO
     * @returns {away.materials.ShaderLightingCompiler}
     */
    ShaderLightingObject.prototype.createCompiler = function (renderableClass, renderPass) {
        return new ShaderLightingCompiler(renderableClass, renderPass, this);
    };
    /**
     * Clears dependency counts for all registers. Called when recompiling a pass.
     */
    ShaderLightingObject.prototype.reset = function () {
        _super.prototype.reset.call(this);
        this.numLights = 0;
        this.usesLightFallOff = true;
    };
    /**
     *
     *
     * @param renderable
     * @param stage
     * @param camera
     */
    ShaderLightingObject.prototype._iRender = function (renderable, camera, viewProjection) {
        _super.prototype._iRender.call(this, renderable, camera, viewProjection);
        if (this._renderLightingPass.lightPicker)
            this._renderLightingPass.lightPicker.collectLights(renderable);
        if (this.usesLights)
            this.updateLights();
        if (this.usesProbes)
            this.updateProbes();
    };
    /**
     * Updates constant data render state used by the lights. This method is optional for subclasses to implement.
     */
    ShaderLightingObject.prototype.updateLights = function () {
        var dirLight;
        var pointLight;
        var i = 0;
        var k = 0;
        var len;
        var dirPos;
        var total = 0;
        var numLightTypes = this.usesShadows ? 2 : 1;
        var l;
        var offset;
        this.ambientR = this.ambientG = this.ambientB = 0;
        l = this.lightVertexConstantIndex;
        k = this.lightFragmentConstantIndex;
        var cast = 0;
        var dirLights = this._renderLightingPass.lightPicker.directionalLights;
        offset = this._renderLightingPass.directionalLightsOffset;
        len = this._renderLightingPass.lightPicker.directionalLights.length;
        if (offset > len) {
            cast = 1;
            offset -= len;
        }
        for (; cast < numLightTypes; ++cast) {
            if (cast)
                dirLights = this._renderLightingPass.lightPicker.castingDirectionalLights;
            len = dirLights.length;
            if (len > this.numDirectionalLights)
                len = this.numDirectionalLights;
            for (i = 0; i < len; ++i) {
                dirLight = dirLights[offset + i];
                dirPos = dirLight.sceneDirection;
                this.ambientR += dirLight._iAmbientR;
                this.ambientG += dirLight._iAmbientG;
                this.ambientB += dirLight._iAmbientB;
                if (this.usesTangentSpace) {
                    var x = -dirPos.x;
                    var y = -dirPos.y;
                    var z = -dirPos.z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[0] * x + this._pInverseSceneMatrix[4] * y + this._pInverseSceneMatrix[8] * z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[1] * x + this._pInverseSceneMatrix[5] * y + this._pInverseSceneMatrix[9] * z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[2] * x + this._pInverseSceneMatrix[6] * y + this._pInverseSceneMatrix[10] * z;
                    this.vertexConstantData[l++] = 1;
                }
                else {
                    this.fragmentConstantData[k++] = -dirPos.x;
                    this.fragmentConstantData[k++] = -dirPos.y;
                    this.fragmentConstantData[k++] = -dirPos.z;
                    this.fragmentConstantData[k++] = 1;
                }
                this.fragmentConstantData[k++] = dirLight._iDiffuseR;
                this.fragmentConstantData[k++] = dirLight._iDiffuseG;
                this.fragmentConstantData[k++] = dirLight._iDiffuseB;
                this.fragmentConstantData[k++] = 1;
                this.fragmentConstantData[k++] = dirLight._iSpecularR;
                this.fragmentConstantData[k++] = dirLight._iSpecularG;
                this.fragmentConstantData[k++] = dirLight._iSpecularB;
                this.fragmentConstantData[k++] = 1;
                if (++total == this.numDirectionalLights) {
                    // break loop
                    i = len;
                    cast = numLightTypes;
                }
            }
        }
        // more directional supported than currently picked, need to clamp all to 0
        if (this.numDirectionalLights > total) {
            i = k + (this.numDirectionalLights - total) * 12;
            while (k < i)
                this.fragmentConstantData[k++] = 0;
        }
        total = 0;
        var pointLights = this._renderLightingPass.lightPicker.pointLights;
        offset = this._renderLightingPass.pointLightsOffset;
        len = this._renderLightingPass.lightPicker.pointLights.length;
        if (offset > len) {
            cast = 1;
            offset -= len;
        }
        else {
            cast = 0;
        }
        for (; cast < numLightTypes; ++cast) {
            if (cast)
                pointLights = this._renderLightingPass.lightPicker.castingPointLights;
            len = pointLights.length;
            for (i = 0; i < len; ++i) {
                pointLight = pointLights[offset + i];
                dirPos = pointLight.scenePosition;
                this.ambientR += pointLight._iAmbientR;
                this.ambientG += pointLight._iAmbientG;
                this.ambientB += pointLight._iAmbientB;
                if (this.usesTangentSpace) {
                    x = dirPos.x;
                    y = dirPos.y;
                    z = dirPos.z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[0] * x + this._pInverseSceneMatrix[4] * y + this._pInverseSceneMatrix[8] * z + this._pInverseSceneMatrix[12];
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[1] * x + this._pInverseSceneMatrix[5] * y + this._pInverseSceneMatrix[9] * z + this._pInverseSceneMatrix[13];
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[2] * x + this._pInverseSceneMatrix[6] * y + this._pInverseSceneMatrix[10] * z + this._pInverseSceneMatrix[14];
                    this.vertexConstantData[l++] = 1;
                }
                else if (!this.usesGlobalPosFragment) {
                    this.vertexConstantData[l++] = dirPos.x;
                    this.vertexConstantData[l++] = dirPos.y;
                    this.vertexConstantData[l++] = dirPos.z;
                    this.vertexConstantData[l++] = 1;
                }
                else {
                    this.fragmentConstantData[k++] = dirPos.x;
                    this.fragmentConstantData[k++] = dirPos.y;
                    this.fragmentConstantData[k++] = dirPos.z;
                    this.fragmentConstantData[k++] = 1;
                }
                this.fragmentConstantData[k++] = pointLight._iDiffuseR;
                this.fragmentConstantData[k++] = pointLight._iDiffuseG;
                this.fragmentConstantData[k++] = pointLight._iDiffuseB;
                var radius = pointLight._pRadius;
                this.fragmentConstantData[k++] = radius * radius;
                this.fragmentConstantData[k++] = pointLight._iSpecularR;
                this.fragmentConstantData[k++] = pointLight._iSpecularG;
                this.fragmentConstantData[k++] = pointLight._iSpecularB;
                this.fragmentConstantData[k++] = pointLight._pFallOffFactor;
                if (++total == this.numPointLights) {
                    // break loop
                    i = len;
                    cast = numLightTypes;
                }
            }
        }
        // more directional supported than currently picked, need to clamp all to 0
        if (this.numPointLights > total) {
            i = k + (total - this.numPointLights) * 12;
            for (; k < i; ++k)
                this.fragmentConstantData[k] = 0;
        }
    };
    /**
     * Updates constant data render state used by the light probes. This method is optional for subclasses to implement.
     */
    ShaderLightingObject.prototype.updateProbes = function () {
        var probe;
        var lightProbes = this._renderLightingPass.lightPicker.lightProbes;
        var weights = this._renderLightingPass.lightPicker.lightProbeWeights;
        var len = lightProbes.length - this._renderLightingPass.lightProbesOffset;
        var addDiff = this.usesProbesForDiffuse;
        var addSpec = this.usesProbesForSpecular;
        if (!(addDiff || addSpec))
            return;
        if (len > this.numLightProbes)
            len = this.numLightProbes;
        for (var i = 0; i < len; ++i) {
            probe = lightProbes[this._renderLightingPass.lightProbesOffset + i];
            if (addDiff)
                this._stage.activateCubeTexture(this.lightProbeDiffuseIndices[i], probe.diffuseMap, this.useSmoothTextures, this.useMipmapping);
            if (addSpec)
                this._stage.activateCubeTexture(this.lightProbeSpecularIndices[i], probe.specularMap, this.useSmoothTextures, this.useMipmapping);
        }
        for (i = 0; i < len; ++i)
            this.fragmentConstantData[this.probeWeightsIndex + i] = weights[this._renderLightingPass.lightProbesOffset + i];
    };
    return ShaderLightingObject;
})(ShaderObjectBase);
module.exports = ShaderLightingObject;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJMaWdodGluZ09iamVjdC50cyJdLCJuYW1lcyI6WyJTaGFkZXJMaWdodGluZ09iamVjdCIsIlNoYWRlckxpZ2h0aW5nT2JqZWN0LmNvbnN0cnVjdG9yIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QuX2lJbmNsdWRlRGVwZW5kZW5jaWVzIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QuY3JlYXRlQ29tcGlsZXIiLCJTaGFkZXJMaWdodGluZ09iamVjdC5yZXNldCIsIlNoYWRlckxpZ2h0aW5nT2JqZWN0Ll9pUmVuZGVyIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QudXBkYXRlTGlnaHRzIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QudXBkYXRlUHJvYmVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFTQSxJQUFPLFlBQVksV0FBZSwyQ0FBMkMsQ0FBQyxDQUFDO0FBRS9FLElBQU8sZ0JBQWdCLFdBQWMsMENBQTBDLENBQUMsQ0FBQztBQUtqRixJQUFPLHNCQUFzQixXQUFZLDBEQUEwRCxDQUFDLENBQUM7QUFJckcsSUFBTyxnQkFBZ0IsV0FBYyxvREFBb0QsQ0FBQyxDQUFDO0FBRzNGLEFBUUE7Ozs7Ozs7R0FERztJQUNHLG9CQUFvQjtJQUFTQSxVQUE3QkEsb0JBQW9CQSxVQUF5QkE7SUFzRWxEQTs7T0FFR0E7SUFDSEEsU0F6RUtBLG9CQUFvQkEsQ0F5RWJBLGVBQWdDQSxFQUFFQSxrQkFBc0NBLEVBQUVBLEtBQVdBO1FBRWhHQyxrQkFBTUEsZUFBZUEsRUFBRUEsa0JBQWtCQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQXZFM0NBLG9CQUFlQSxHQUFXQSxJQUFJQSxDQUFDQTtRQXlFdENBLElBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0Esa0JBQWtCQSxDQUFDQTtJQUMvQ0EsQ0FBQ0E7SUFFTUQsb0RBQXFCQSxHQUE1QkE7UUFFQ0UsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJB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QUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtvQkFDaElBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2hJQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO29CQUNqSUEsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDbENBLENBQUNBO2dCQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtvQkFDUEEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDM0NBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzNDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO29CQUMzQ0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDcENBLENBQUNBO2dCQUVEQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLFFBQVFBLENBQUNBLFVBQVVBLENBQUNBO2dCQUNyREEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxRQUFRQSxDQUFDQSxVQUFVQSxDQUFDQTtnQkFDckRBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7Z0JBQ3JEQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO2dCQUVuQ0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxRQUFRQSxDQUFDQSxXQUFXQSxDQUFDQTtnQkFDdERBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7Z0JBQ3REQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLFFBQVFBLENBQUNBLFdBQVdBLENBQUNBO2dCQUN0REEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFFbkNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEtBQUtBLElBQUlBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzFDQSxBQUNBQSxhQURhQTtvQkFDYkEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0E7b0JBQ1JBLElBQUlBLEdBQUdBLGFBQWFBLENBQUNBO2dCQUN0QkEsQ0FBQ0E7WUFDRkEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFFREEsQUFDQUEsMkVBRDJFQTtRQUMzRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN2Q0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxLQUFLQSxDQUFDQSxHQUFDQSxFQUFFQSxDQUFDQTtZQUUvQ0EsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7Z0JBQ1hBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDckNBLENBQUNBO1FBRURBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBO1FBRVZBLElBQUlBLFdBQVdBLEdBQXFCQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLFdBQVdBLENBQUNBLFdBQVdBLENBQUNBO1FBQ3JGQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLGlCQUFpQkEsQ0FBQ0E7UUFDcERBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFFOURBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xCQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNUQSxNQUFNQSxJQUFJQSxHQUFHQSxDQUFDQTtRQUNmQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNWQSxDQUFDQTtRQUVEQSxHQUFHQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxHQUFHQSxhQUFhQSxFQUFFQSxFQUFFQSxJQUFJQSxFQUFFQSxDQUFDQTtZQUNyQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0E7Z0JBQ1JBLFdBQVdBLEdBQUdBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsV0FBV0EsQ0FBQ0Esa0JBQWtCQSxDQUFDQTtZQUV2RUEsR0FBR0EsR0FBR0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFFekJBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO2dCQUMxQkEsVUFBVUEsR0FBR0EsV0FBV0EsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3JDQSxNQUFNQSxHQUFHQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQTtnQkFFbENBLElBQUlBLENBQUNBLFFBQVFBLElBQUlBLFVBQVVBLENBQUNBLFVBQVVBLENBQUNBO2dCQUN2Q0EsSUFBSUEsQ0FBQ0EsUUFBUUEsSUFBSUEsVUFBVUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7Z0JBQ3ZDQSxJQUFJQSxDQUFDQSxRQUFRQSxJQUFJQSxVQUFVQSxDQUFDQSxVQUFVQSxDQUFDQTtnQkFFdkNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzNCQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDYkEsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2JBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO29CQUViQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7b0JBQ2hLQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7b0JBQ2hLQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLEVBQUVBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7b0JBQ2pLQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNsQ0EsQ0FBQ0E7Z0JBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3hDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO29CQUN4Q0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxH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QUNBLEVBQUVBLEtBQUtBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0E7WUFFaklBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBO2dCQUNYQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxtQkFBbUJBLENBQUNBLElBQUlBLENBQUNBLHlCQUF5QkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsS0FBS0EsQ0FBQ0EsV0FBV0EsRUFBRUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQTtRQUNwSUEsQ0FBQ0E7UUFFREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDdkJBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLGlCQUFpQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDbEhBLENBQUNBO0lBQ0ZQLDJCQUFDQTtBQUFEQSxDQTVWQSxBQTRWQ0EsRUE1VmtDLGdCQUFnQixFQTRWbEQ7QUFFRCxBQUE4QixpQkFBckIsb0JBQW9CLENBQUMiLCJmaWxlIjoiY29tcGlsYXRpb24vU2hhZGVyTGlnaHRpbmdPYmplY3QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5cclxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XHJcbmltcG9ydCBEaXJlY3Rpb25hbExpZ2h0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvRGlyZWN0aW9uYWxMaWdodFwiKTtcclxuaW1wb3J0IExpZ2h0UHJvYmVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0xpZ2h0UHJvYmVcIik7XHJcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0XCIpO1xyXG5pbXBvcnQgTGlnaHRQaWNrZXJCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL2xpZ2h0cGlja2Vycy9MaWdodFBpY2tlckJhc2VcIik7XHJcbmltcG9ydCBJUmVuZGVyT2JqZWN0T3duZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9JUmVuZGVyT2JqZWN0T3duZXJcIik7XHJcbmltcG9ydCBMaWdodFNvdXJjZXNcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9MaWdodFNvdXJjZXNcIik7XHJcblxyXG5pbXBvcnQgQ29udGV4dEdMUHJvZmlsZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMUHJvZmlsZVwiKTtcclxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcbmltcG9ydCBJQ29udGV4dEdMXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0lDb250ZXh0R0xcIik7XHJcblxyXG5pbXBvcnQgSVJlbmRlckxpZ2h0aW5nUGFzc1x0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvSVJlbmRlckxpZ2h0aW5nUGFzc1wiKTtcclxuaW1wb3J0IFNoYWRlckxpZ2h0aW5nQ29tcGlsZXJcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nQ29tcGlsZXJcIik7XHJcblxyXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xyXG5pbXBvcnQgU2hhZGVyQ29tcGlsZXJCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlckNvbXBpbGVyQmFzZVwiKTtcclxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmFibGVDbGFzc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvSVJlbmRlcmFibGVDbGFzc1wiKTtcclxuXHJcbi8qKlxyXG4gKiBTaGFkZXJPYmplY3RCYXNlIGtlZXBzIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgZGVwZW5kZW5jaWVzIGZvciBcIm5hbWVkIHJlZ2lzdGVyc1wiIHVzZWQgYWNyb3NzIGEgcGFzcy5cclxuICogTmFtZWQgcmVnaXN0ZXJzIGFyZSB0aGF0IGFyZSBub3QgbmVjZXNzYXJpbHkgbGltaXRlZCB0byBhIHNpbmdsZSBtZXRob2QuIFRoZXkgYXJlIGNyZWF0ZWQgYnkgdGhlIGNvbXBpbGVyIGFuZFxyXG4gKiBwYXNzZWQgb24gdG8gbWV0aG9kcy4gVGhlIGNvbXBpbGVyIHVzZXMgdGhlIHJlc3VsdHMgdG8gcmVzZXJ2ZSB1c2FnZXMgdGhyb3VnaCBSZWdpc3RlclBvb2wsIHdoaWNoIGNhbiBiZSByZW1vdmVkXHJcbiAqIGVhY2ggdGltZSBhIG1ldGhvZCBoYXMgYmVlbiBjb21waWxlZCBpbnRvIHRoZSBzaGFkZXIuXHJcbiAqXHJcbiAqIEBzZWUgUmVnaXN0ZXJQb29sLmFkZFVzYWdlXHJcbiAqL1xyXG5jbGFzcyBTaGFkZXJMaWdodGluZ09iamVjdCBleHRlbmRzIFNoYWRlck9iamVjdEJhc2Vcclxue1xyXG5cdHB1YmxpYyBfcmVuZGVyTGlnaHRpbmdQYXNzOklSZW5kZXJMaWdodGluZ1Bhc3M7XHJcblxyXG5cdHByaXZhdGUgX2luY2x1ZGVDYXN0ZXJzOmJvb2xlYW4gPSB0cnVlO1xyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgZmlyc3QgaW5kZXggZm9yIHRoZSBmcmFnbWVudCBjb25zdGFudHMgY29udGFpbmluZyB0aGUgbGlnaHQgZGF0YS5cclxuXHQgKi9cclxuXHRwdWJsaWMgbGlnaHRGcmFnbWVudENvbnN0YW50SW5kZXg6bnVtYmVyO1xyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgc3RhcnRpbmcgaW5kZXggaWYgdGhlIHZlcnRleCBjb25zdGFudCB0byB3aGljaCBsaWdodCBkYXRhIG5lZWRzIHRvIGJlIHVwbG9hZGVkLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBsaWdodFZlcnRleENvbnN0YW50SW5kZXg6bnVtYmVyO1xyXG5cclxuXHQvKipcclxuXHQgKiBJbmRpY2VzIGZvciB0aGUgbGlnaHQgcHJvYmUgZGlmZnVzZSB0ZXh0dXJlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgbGlnaHRQcm9iZURpZmZ1c2VJbmRpY2VzOkFycmF5PG51bWJlcj4gLyp1aW50Ki87XHJcblxyXG5cdC8qKlxyXG5cdCAqIEluZGljZXMgZm9yIHRoZSBsaWdodCBwcm9iZSBzcGVjdWxhciB0ZXh0dXJlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgbGlnaHRQcm9iZVNwZWN1bGFySW5kaWNlczpBcnJheTxudW1iZXI+IC8qdWludCovO1xyXG5cclxuXHQvKipcclxuXHQgKiBUaGUgaW5kZXggb2YgdGhlIGZyYWdtZW50IGNvbnN0YW50IGNvbnRhaW5pbmcgdGhlIHdlaWdodHMgZm9yIHRoZSBsaWdodCBwcm9iZXMuXHJcblx0ICovXHJcblx0cHVibGljIHByb2JlV2VpZ2h0c0luZGV4Om51bWJlcjtcclxuXHJcblx0cHVibGljIG51bUxpZ2h0czpudW1iZXI7XHJcblx0cHVibGljIG51bURpcmVjdGlvbmFsTGlnaHRzOm51bWJlcjtcclxuXHRwdWJsaWMgbnVtUG9pbnRMaWdodHM6bnVtYmVyO1xyXG5cdHB1YmxpYyBudW1MaWdodFByb2JlczpudW1iZXI7XHJcblxyXG5cdHB1YmxpYyB1c2VzTGlnaHRGYWxsT2ZmOmJvb2xlYW47XHJcblxyXG5cdHB1YmxpYyB1c2VzU2hhZG93czpib29sZWFuO1xyXG5cclxuXHQvKipcclxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc2hhZGVyIHVzZXMgYW55IGxpZ2h0cy5cclxuXHQgKi9cclxuXHRwdWJsaWMgdXNlc0xpZ2h0czpib29sZWFuO1xyXG5cclxuXHQvKipcclxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc2hhZGVyIHVzZXMgYW55IGxpZ2h0IHByb2Jlcy5cclxuXHQgKi9cclxuXHRwdWJsaWMgdXNlc1Byb2Jlczpib29sZWFuO1xyXG5cclxuXHQvKipcclxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgbGlnaHRzIHVzZXMgYW55IHNwZWN1bGFyIGNvbXBvbmVudHMuXHJcblx0ICovXHJcblx0cHVibGljIHVzZXNMaWdodHNGb3JTcGVjdWxhcjpib29sZWFuO1xyXG5cclxuXHQvKipcclxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgcHJvYmVzIHVzZXMgYW55IHNwZWN1bGFyIGNvbXBvbmVudHMuXHJcblx0ICovXHJcblx0cHVibGljIHVzZXNQcm9iZXNGb3JTcGVjdWxhcjpib29sZWFuO1xyXG5cclxuXHQvKipcclxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgbGlnaHRzIHVzZXMgYW55IGRpZmZ1c2UgY29tcG9uZW50cy5cclxuXHQgKi9cclxuXHRwdWJsaWMgdXNlc0xpZ2h0c0ZvckRpZmZ1c2U6Ym9vbGVhbjtcclxuXHJcblx0LyoqXHJcblx0ICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHByb2JlcyB1c2VzIGFueSBkaWZmdXNlIGNvbXBvbmVudHMuXHJcblx0ICovXHJcblx0cHVibGljIHVzZXNQcm9iZXNGb3JEaWZmdXNlOmJvb2xlYW47XHJcblxyXG5cdC8qKlxyXG5cdCAqIENyZWF0ZXMgYSBuZXcgTWV0aG9kQ29tcGlsZXJWTyBvYmplY3QuXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IocmVuZGVyYWJsZUNsYXNzOklSZW5kZXJhYmxlQ2xhc3MsIHJlbmRlckxpZ2h0aW5nUGFzczpJUmVuZGVyTGlnaHRpbmdQYXNzLCBzdGFnZTpTdGFnZSlcclxuXHR7XHJcblx0XHRzdXBlcihyZW5kZXJhYmxlQ2xhc3MsIHJlbmRlckxpZ2h0aW5nUGFzcywgc3RhZ2UpO1xyXG5cclxuXHRcdHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcyA9IHJlbmRlckxpZ2h0aW5nUGFzcztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBfaUluY2x1ZGVEZXBlbmRlbmNpZXMoKVxyXG5cdHtcclxuXHRcdHRoaXMubnVtUG9pbnRMaWdodHMgPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubnVtUG9pbnRMaWdodHM7XHJcblx0XHR0aGlzLm51bURpcmVjdGlvbmFsTGlnaHRzID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLm51bURpcmVjdGlvbmFsTGlnaHRzO1xyXG5cdFx0dGhpcy5udW1MaWdodFByb2JlcyA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5udW1MaWdodFByb2JlcztcclxuXHJcblx0XHR2YXIgbnVtQWxsTGlnaHRzOm51bWJlciA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5udW1Qb2ludExpZ2h0cyArIHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5udW1EaXJlY3Rpb25hbExpZ2h0cztcclxuXHRcdHZhciBudW1MaWdodFByb2JlczpudW1iZXIgPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubnVtTGlnaHRQcm9iZXM7XHJcblx0XHR2YXIgZGlmZnVzZUxpZ2h0U291cmNlczpudW1iZXIgPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MuX2lVc2VzRGlmZnVzZSh0aGlzKT8gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmRpZmZ1c2VMaWdodFNvdXJjZXMgOiAweDAwO1xyXG5cdFx0dmFyIHNwZWN1bGFyTGlnaHRTb3VyY2VzOm51bWJlciA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5faVVzZXNTcGVjdWxhcih0aGlzKT8gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLnNwZWN1bGFyTGlnaHRTb3VyY2VzIDogMHgwMDtcclxuXHRcdHZhciBjb21iaW5lZExpZ2h0U291cmNlczpudW1iZXIgPSBkaWZmdXNlTGlnaHRTb3VyY2VzIHwgc3BlY3VsYXJMaWdodFNvdXJjZXM7XHJcblxyXG5cdFx0dGhpcy51c2VzTGlnaHRGYWxsT2ZmID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmVuYWJsZUxpZ2h0RmFsbE9mZiAmJiB0aGlzLnByb2ZpbGUgIT0gQ29udGV4dEdMUHJvZmlsZS5CQVNFTElORV9DT05TVFJBSU5FRDtcclxuXHRcdHRoaXMubnVtTGlnaHRzID0gbnVtQWxsTGlnaHRzICsgbnVtTGlnaHRQcm9iZXM7XHJcblx0XHR0aGlzLnVzZXNMaWdodHMgPSBudW1BbGxMaWdodHMgPiAwICYmIChjb21iaW5lZExpZ2h0U291cmNlcyAmIExpZ2h0U291cmNlcy5MSUdIVFMpICE9IDA7XHJcblx0XHR0aGlzLnVzZXNQcm9iZXMgPSBudW1MaWdodFByb2JlcyA+IDAgJiYgKGNvbWJpbmVkTGlnaHRTb3VyY2VzICYgTGlnaHRTb3VyY2VzLlBST0JFUykgIT0gMDtcclxuXHRcdHRoaXMudXNlc0xpZ2h0c0ZvclNwZWN1bGFyID0gbnVtQWxsTGlnaHRzID4gMCAmJiAoc3BlY3VsYXJMaWdodFNvdXJjZXMgJiBMaWdodFNvdXJjZXMuTElHSFRTKSAhPSAwO1xyXG5cdFx0dGhpcy51c2VzUHJvYmVzRm9yU3BlY3VsYXIgPSBudW1MaWdodFByb2JlcyA+IDAgJiYgKHNwZWN1bGFyTGlnaHRTb3VyY2VzICYgTGlnaHRTb3VyY2VzLlBST0JFUykgIT0gMDtcclxuXHRcdHRoaXMudXNlc0xpZ2h0c0ZvckRpZmZ1c2UgPSBudW1BbGxMaWdodHMgPiAwICYmIChkaWZmdXNlTGlnaHRTb3VyY2VzICYgTGlnaHRTb3VyY2VzLkxJR0hUUykgIT0gMDtcclxuXHRcdHRoaXMudXNlc1Byb2Jlc0ZvckRpZmZ1c2UgPSBudW1MaWdodFByb2JlcyA+IDAgJiYgKGRpZmZ1c2VMaWdodFNvdXJjZXMgJiBMaWdodFNvdXJjZXMuUFJPQkVTKSAhPSAwO1xyXG5cdFx0dGhpcy51c2VzU2hhZG93cyA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5faVVzZXNTaGFkb3dzKHRoaXMpO1xyXG5cclxuXHRcdC8vSU1QT1JUQU5UIHRoaXMgbXVzdCBvY2N1ciBhZnRlciBzaGFkZXIgbGlnaHRpbmcgaW5pdGlhbGlzYXRpb24gYWJvdmVcclxuXHRcdHN1cGVyLl9pSW5jbHVkZURlcGVuZGVuY2llcygpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRmFjdG9yeSBtZXRob2QgdG8gY3JlYXRlIGEgY29uY3JldGUgY29tcGlsZXIgb2JqZWN0IGZvciB0aGlzIG9iamVjdFxyXG5cdCAqXHJcblx0ICogQHBhcmFtIG1hdGVyaWFsUGFzc1ZPXHJcblx0ICogQHJldHVybnMge2F3YXkubWF0ZXJpYWxzLlNoYWRlckxpZ2h0aW5nQ29tcGlsZXJ9XHJcblx0ICovXHJcblx0cHVibGljIGNyZWF0ZUNvbXBpbGVyKHJlbmRlcmFibGVDbGFzczpJUmVuZGVyYWJsZUNsYXNzLCByZW5kZXJQYXNzOklSZW5kZXJMaWdodGluZ1Bhc3MpOlNoYWRlckNvbXBpbGVyQmFzZVxyXG5cdHtcclxuXHRcdHJldHVybiBuZXcgU2hhZGVyTGlnaHRpbmdDb21waWxlcihyZW5kZXJhYmxlQ2xhc3MsIHJlbmRlclBhc3MsIHRoaXMpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQ2xlYXJzIGRlcGVuZGVuY3kgY291bnRzIGZvciBhbGwgcmVnaXN0ZXJzLiBDYWxsZWQgd2hlbiByZWNvbXBpbGluZyBhIHBhc3MuXHJcblx0ICovXHJcblx0cHVibGljIHJlc2V0KClcclxuXHR7XHJcblx0XHRzdXBlci5yZXNldCgpO1xyXG5cclxuXHRcdHRoaXMubnVtTGlnaHRzID0gMDtcclxuXHRcdHRoaXMudXNlc0xpZ2h0RmFsbE9mZiA9IHRydWU7XHJcblx0fVxyXG5cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKlxyXG5cdCAqIEBwYXJhbSByZW5kZXJhYmxlXHJcblx0ICogQHBhcmFtIHN0YWdlXHJcblx0ICogQHBhcmFtIGNhbWVyYVxyXG5cdCAqL1xyXG5cdHB1YmxpYyBfaVJlbmRlcihyZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBjYW1lcmE6Q2FtZXJhLCB2aWV3UHJvamVjdGlvbjpNYXRyaXgzRClcclxuXHR7XHJcblx0XHRzdXBlci5faVJlbmRlcihyZW5kZXJhYmxlLCBjYW1lcmEsIHZpZXdQcm9qZWN0aW9uKTtcclxuXHJcblx0XHRpZiAodGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyKVxyXG5cdFx0XHR0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubGlnaHRQaWNrZXIuY29sbGVjdExpZ2h0cyhyZW5kZXJhYmxlKTtcclxuXHJcblx0XHRpZiAodGhpcy51c2VzTGlnaHRzKVxyXG5cdFx0XHR0aGlzLnVwZGF0ZUxpZ2h0cygpO1xyXG5cclxuXHRcdGlmICh0aGlzLnVzZXNQcm9iZXMpXHJcblx0XHRcdHRoaXMudXBkYXRlUHJvYmVzKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBVcGRhdGVzIGNvbnN0YW50IGRhdGEgcmVuZGVyIHN0YXRlIHVzZWQgYnkgdGhlIGxpZ2h0cy4gVGhpcyBtZXRob2QgaXMgb3B0aW9uYWwgZm9yIHN1YmNsYXNzZXMgdG8gaW1wbGVtZW50LlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgdXBkYXRlTGlnaHRzKClcclxuXHR7XHJcblx0XHR2YXIgZGlyTGlnaHQ6RGlyZWN0aW9uYWxMaWdodDtcclxuXHRcdHZhciBwb2ludExpZ2h0OlBvaW50TGlnaHQ7XHJcblx0XHR2YXIgaTpudW1iZXIgPSAwO1xyXG5cdFx0dmFyIGs6bnVtYmVyID0gMDtcclxuXHRcdHZhciBsZW46bnVtYmVyO1xyXG5cdFx0dmFyIGRpclBvczpWZWN0b3IzRDtcclxuXHRcdHZhciB0b3RhbDpudW1iZXIgPSAwO1xyXG5cdFx0dmFyIG51bUxpZ2h0VHlwZXM6bnVtYmVyID0gdGhpcy51c2VzU2hhZG93cz8gMiA6IDE7XHJcblx0XHR2YXIgbDpudW1iZXI7XHJcblx0XHR2YXIgb2Zmc2V0Om51bWJlcjtcclxuXHJcblx0XHR0aGlzLmFtYmllbnRSID0gdGhpcy5hbWJpZW50RyA9IHRoaXMuYW1iaWVudEIgPSAwO1xyXG5cclxuXHRcdGwgPSB0aGlzLmxpZ2h0VmVydGV4Q29uc3RhbnRJbmRleDtcclxuXHRcdGsgPSB0aGlzLmxpZ2h0RnJhZ21lbnRDb25zdGFudEluZGV4O1xyXG5cclxuXHRcdHZhciBjYXN0Om51bWJlciA9IDA7XHJcblx0XHR2YXIgZGlyTGlnaHRzOkFycmF5PERpcmVjdGlvbmFsTGlnaHQ+ID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLmRpcmVjdGlvbmFsTGlnaHRzO1xyXG5cdFx0b2Zmc2V0ID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmRpcmVjdGlvbmFsTGlnaHRzT2Zmc2V0O1xyXG5cdFx0bGVuID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLmRpcmVjdGlvbmFsTGlnaHRzLmxlbmd0aDtcclxuXHJcblx0XHRpZiAob2Zmc2V0ID4gbGVuKSB7XHJcblx0XHRcdGNhc3QgPSAxO1xyXG5cdFx0XHRvZmZzZXQgLT0gbGVuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAoOyBjYXN0IDwgbnVtTGlnaHRUeXBlczsgKytjYXN0KSB7XHJcblx0XHRcdGlmIChjYXN0KVxyXG5cdFx0XHRcdGRpckxpZ2h0cyA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFBpY2tlci5jYXN0aW5nRGlyZWN0aW9uYWxMaWdodHM7XHJcblxyXG5cdFx0XHRsZW4gPSBkaXJMaWdodHMubGVuZ3RoO1xyXG5cclxuXHRcdFx0aWYgKGxlbiA+IHRoaXMubnVtRGlyZWN0aW9uYWxMaWdodHMpXHJcblx0XHRcdFx0bGVuID0gdGhpcy5udW1EaXJlY3Rpb25hbExpZ2h0cztcclxuXHJcblx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xyXG5cdFx0XHRcdGRpckxpZ2h0ID0gZGlyTGlnaHRzW29mZnNldCArIGldO1xyXG5cdFx0XHRcdGRpclBvcyA9IGRpckxpZ2h0LnNjZW5lRGlyZWN0aW9uO1xyXG5cclxuXHRcdFx0XHR0aGlzLmFtYmllbnRSICs9IGRpckxpZ2h0Ll9pQW1iaWVudFI7XHJcblx0XHRcdFx0dGhpcy5hbWJpZW50RyArPSBkaXJMaWdodC5faUFtYmllbnRHO1xyXG5cdFx0XHRcdHRoaXMuYW1iaWVudEIgKz0gZGlyTGlnaHQuX2lBbWJpZW50QjtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMudXNlc1RhbmdlbnRTcGFjZSkge1xyXG5cdFx0XHRcdFx0dmFyIHg6bnVtYmVyID0gLWRpclBvcy54O1xyXG5cdFx0XHRcdFx0dmFyIHk6bnVtYmVyID0gLWRpclBvcy55O1xyXG5cdFx0XHRcdFx0dmFyIHo6bnVtYmVyID0gLWRpclBvcy56O1xyXG5cclxuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzBdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzRdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzhdKno7XHJcblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxXSp4ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs1XSp5ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs5XSp6O1xyXG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMl0qeCArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbNl0qeSArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMTBdKno7XHJcblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gMTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gLWRpclBvcy54O1xyXG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gLWRpclBvcy55O1xyXG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gLWRpclBvcy56O1xyXG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gMTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pRGlmZnVzZVI7XHJcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyTGlnaHQuX2lEaWZmdXNlRztcclxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBkaXJMaWdodC5faURpZmZ1c2VCO1xyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IDE7XHJcblxyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pU3BlY3VsYXJSO1xyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pU3BlY3VsYXJHO1xyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pU3BlY3VsYXJCO1xyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IDE7XHJcblxyXG5cdFx0XHRcdGlmICgrK3RvdGFsID09IHRoaXMubnVtRGlyZWN0aW9uYWxMaWdodHMpIHtcclxuXHRcdFx0XHRcdC8vIGJyZWFrIGxvb3BcclxuXHRcdFx0XHRcdGkgPSBsZW47XHJcblx0XHRcdFx0XHRjYXN0ID0gbnVtTGlnaHRUeXBlcztcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvLyBtb3JlIGRpcmVjdGlvbmFsIHN1cHBvcnRlZCB0aGFuIGN1cnJlbnRseSBwaWNrZWQsIG5lZWQgdG8gY2xhbXAgYWxsIHRvIDBcclxuXHRcdGlmICh0aGlzLm51bURpcmVjdGlvbmFsTGlnaHRzID4gdG90YWwpIHtcclxuXHRcdFx0aSA9IGsgKyAodGhpcy5udW1EaXJlY3Rpb25hbExpZ2h0cyAtIHRvdGFsKSoxMjtcclxuXHJcblx0XHRcdHdoaWxlIChrIDwgaSlcclxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSAwO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRvdGFsID0gMDtcclxuXHJcblx0XHR2YXIgcG9pbnRMaWdodHM6QXJyYXk8UG9pbnRMaWdodD4gPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubGlnaHRQaWNrZXIucG9pbnRMaWdodHM7XHJcblx0XHRvZmZzZXQgPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MucG9pbnRMaWdodHNPZmZzZXQ7XHJcblx0XHRsZW4gPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubGlnaHRQaWNrZXIucG9pbnRMaWdodHMubGVuZ3RoO1xyXG5cclxuXHRcdGlmIChvZmZzZXQgPiBsZW4pIHtcclxuXHRcdFx0Y2FzdCA9IDE7XHJcblx0XHRcdG9mZnNldCAtPSBsZW47XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRjYXN0ID0gMDtcclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKDsgY2FzdCA8IG51bUxpZ2h0VHlwZXM7ICsrY2FzdCkge1xyXG5cdFx0XHRpZiAoY2FzdClcclxuXHRcdFx0XHRwb2ludExpZ2h0cyA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFBpY2tlci5jYXN0aW5nUG9pbnRMaWdodHM7XHJcblxyXG5cdFx0XHRsZW4gPSBwb2ludExpZ2h0cy5sZW5ndGg7XHJcblxyXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcclxuXHRcdFx0XHRwb2ludExpZ2h0ID0gcG9pbnRMaWdodHNbb2Zmc2V0ICsgaV07XHJcblx0XHRcdFx0ZGlyUG9zID0gcG9pbnRMaWdodC5zY2VuZVBvc2l0aW9uO1xyXG5cclxuXHRcdFx0XHR0aGlzLmFtYmllbnRSICs9IHBvaW50TGlnaHQuX2lBbWJpZW50UjtcclxuXHRcdFx0XHR0aGlzLmFtYmllbnRHICs9IHBvaW50TGlnaHQuX2lBbWJpZW50RztcclxuXHRcdFx0XHR0aGlzLmFtYmllbnRCICs9IHBvaW50TGlnaHQuX2lBbWJpZW50QjtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMudXNlc1RhbmdlbnRTcGFjZSkge1xyXG5cdFx0XHRcdFx0eCA9IGRpclBvcy54O1xyXG5cdFx0XHRcdFx0eSA9IGRpclBvcy55O1xyXG5cdFx0XHRcdFx0eiA9IGRpclBvcy56O1xyXG5cclxuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzBdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzRdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzhdKnogKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzEyXTtcclxuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzFdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzVdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzldKnogKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzEzXTtcclxuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzJdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzZdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzEwXSp6ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxNF07XHJcblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gMTtcclxuXHRcdFx0XHR9IGVsc2UgaWYgKCF0aGlzLnVzZXNHbG9iYWxQb3NGcmFnbWVudCkge1xyXG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IGRpclBvcy54O1xyXG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IGRpclBvcy55O1xyXG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IGRpclBvcy56O1xyXG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IDE7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpclBvcy54O1xyXG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyUG9zLnk7XHJcblx0XHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBkaXJQb3MuejtcclxuXHRcdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IDE7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBwb2ludExpZ2h0Ll9pRGlmZnVzZVI7XHJcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gcG9pbnRMaWdodC5faURpZmZ1c2VHO1xyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lEaWZmdXNlQjtcclxuXHJcblx0XHRcdFx0dmFyIHJhZGl1czpudW1iZXIgPSBwb2ludExpZ2h0Ll9wUmFkaXVzO1xyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHJhZGl1cypyYWRpdXM7XHJcblxyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lTcGVjdWxhclI7XHJcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gcG9pbnRMaWdodC5faVNwZWN1bGFyRztcclxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBwb2ludExpZ2h0Ll9pU3BlY3VsYXJCO1xyXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX3BGYWxsT2ZmRmFjdG9yO1xyXG5cclxuXHRcdFx0XHRpZiAoKyt0b3RhbCA9PSB0aGlzLm51bVBvaW50TGlnaHRzKSB7XHJcblx0XHRcdFx0XHQvLyBicmVhayBsb29wXHJcblx0XHRcdFx0XHRpID0gbGVuO1xyXG5cdFx0XHRcdFx0Y2FzdCA9IG51bUxpZ2h0VHlwZXM7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gbW9yZSBkaXJlY3Rpb25hbCBzdXBwb3J0ZWQgdGhhbiBjdXJyZW50bHkgcGlja2VkLCBuZWVkIHRvIGNsYW1wIGFsbCB0byAwXHJcblx0XHRpZiAodGhpcy5udW1Qb2ludExpZ2h0cyA+IHRvdGFsKSB7XHJcblx0XHRcdGkgPSBrICsgKHRvdGFsIC0gdGhpcy5udW1Qb2ludExpZ2h0cykqMTI7XHJcblxyXG5cdFx0XHRmb3IgKDsgayA8IGk7ICsraylcclxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2tdID0gMDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFVwZGF0ZXMgY29uc3RhbnQgZGF0YSByZW5kZXIgc3RhdGUgdXNlZCBieSB0aGUgbGlnaHQgcHJvYmVzLiBUaGlzIG1ldGhvZCBpcyBvcHRpb25hbCBmb3Igc3ViY2xhc3NlcyB0byBpbXBsZW1lbnQuXHJcblx0ICovXHJcblx0cHJpdmF0ZSB1cGRhdGVQcm9iZXMoKVxyXG5cdHtcclxuXHRcdHZhciBwcm9iZTpMaWdodFByb2JlO1xyXG5cdFx0dmFyIGxpZ2h0UHJvYmVzOkFycmF5PExpZ2h0UHJvYmU+ID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLmxpZ2h0UHJvYmVzO1xyXG5cdFx0dmFyIHdlaWdodHM6QXJyYXk8bnVtYmVyPiA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFBpY2tlci5saWdodFByb2JlV2VpZ2h0cztcclxuXHRcdHZhciBsZW46bnVtYmVyID0gbGlnaHRQcm9iZXMubGVuZ3RoIC0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UHJvYmVzT2Zmc2V0O1xyXG5cdFx0dmFyIGFkZERpZmY6Ym9vbGVhbiA9IHRoaXMudXNlc1Byb2Jlc0ZvckRpZmZ1c2U7XHJcblx0XHR2YXIgYWRkU3BlYzpib29sZWFuID0gdGhpcy51c2VzUHJvYmVzRm9yU3BlY3VsYXI7XHJcblxyXG5cdFx0aWYgKCEoYWRkRGlmZiB8fCBhZGRTcGVjKSlcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdGlmIChsZW4gPiB0aGlzLm51bUxpZ2h0UHJvYmVzKVxyXG5cdFx0XHRsZW4gPSB0aGlzLm51bUxpZ2h0UHJvYmVzO1xyXG5cclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgKytpKSB7XHJcblx0XHRcdHByb2JlID0gbGlnaHRQcm9iZXNbIHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFByb2Jlc09mZnNldCArIGldO1xyXG5cclxuXHRcdFx0aWYgKGFkZERpZmYpXHJcblx0XHRcdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVDdWJlVGV4dHVyZSh0aGlzLmxpZ2h0UHJvYmVEaWZmdXNlSW5kaWNlc1tpXSwgcHJvYmUuZGlmZnVzZU1hcCwgdGhpcy51c2VTbW9vdGhUZXh0dXJlcywgdGhpcy51c2VNaXBtYXBwaW5nKTtcclxuXHJcblx0XHRcdGlmIChhZGRTcGVjKVxyXG5cdFx0XHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQ3ViZVRleHR1cmUodGhpcy5saWdodFByb2JlU3BlY3VsYXJJbmRpY2VzW2ldLCBwcm9iZS5zcGVjdWxhck1hcCwgdGhpcy51c2VTbW9vdGhUZXh0dXJlcywgdGhpcy51c2VNaXBtYXBwaW5nKTtcclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpXHJcblx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbdGhpcy5wcm9iZVdlaWdodHNJbmRleCArIGldID0gd2VpZ2h0c1t0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubGlnaHRQcm9iZXNPZmZzZXQgKyBpXTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IFNoYWRlckxpZ2h0aW5nT2JqZWN0OyJdfQ==