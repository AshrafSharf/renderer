var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShaderLightingCompiler = require("awayjs-renderergl/lib/compilation/ShaderLightingCompiler");
var ShaderObjectBase = require("awayjs-renderergl/lib/compilation/ShaderObjectBase");
/**
 * ShaderObjectBase keeps track of the number of dependencies for "named registers" used across a pass.
 * Named registers are that are not necessarily limited to a single method. They are created by the compiler and
 * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed
 * each time a method has been compiled into the shader.
 *
 * @see RegisterPool.addUsage
 */
var ShaderLightingObject = (function (_super) {
    __extends(ShaderLightingObject, _super);
    /**
     * Creates a new MethodCompilerVO object.
     */
    function ShaderLightingObject(profile) {
        _super.call(this, profile);
    }
    /**
     * Factory method to create a concrete compiler object for this object
     *
     * @param materialPassVO
     * @returns {away.materials.ShaderLightingCompiler}
     */
    ShaderLightingObject.prototype.createCompiler = function (material, materialPass) {
        return new ShaderLightingCompiler(material, materialPass, this);
    };
    /**
     * Clears dependency counts for all registers. Called when recompiling a pass.
     */
    ShaderLightingObject.prototype.reset = function () {
        _super.prototype.reset.call(this);
        this.numLights = 0;
        this.usesLightFallOff = true;
    };
    /**
     *
     *
     * @param renderable
     * @param stage
     * @param camera
     */
    ShaderLightingObject.prototype.setRenderState = function (renderable, stage, camera, viewProjection) {
        _super.prototype.setRenderState.call(this, renderable, stage, camera, viewProjection);
        if (this.usesLights)
            this.updateLights();
        if (this.usesProbes)
            this.updateProbes(stage);
    };
    /**
     * Updates constant data render state used by the lights. This method is optional for subclasses to implement.
     */
    ShaderLightingObject.prototype.updateLights = function () {
        var dirLight;
        var pointLight;
        var i = 0;
        var k = 0;
        var len;
        var dirPos;
        var total = 0;
        var numLightTypes = this.usesShadows ? 2 : 1;
        var l;
        var offset;
        this.ambientR = this.ambientG = this.ambientB = 0;
        l = this.lightVertexConstantIndex;
        k = this.lightFragmentConstantIndex;
        var cast = 0;
        var dirLights = this.lightPicker.directionalLights;
        offset = this.directionalLightsOffset;
        len = this.lightPicker.directionalLights.length;
        if (offset > len) {
            cast = 1;
            offset -= len;
        }
        for (; cast < numLightTypes; ++cast) {
            if (cast)
                dirLights = this.lightPicker.castingDirectionalLights;
            len = dirLights.length;
            if (len > this.numDirectionalLights)
                len = this.numDirectionalLights;
            for (i = 0; i < len; ++i) {
                dirLight = dirLights[offset + i];
                dirPos = dirLight.sceneDirection;
                this.ambientR += dirLight._iAmbientR;
                this.ambientG += dirLight._iAmbientG;
                this.ambientB += dirLight._iAmbientB;
                if (this.usesTangentSpace) {
                    var x = -dirPos.x;
                    var y = -dirPos.y;
                    var z = -dirPos.z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[0] * x + this._pInverseSceneMatrix[4] * y + this._pInverseSceneMatrix[8] * z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[1] * x + this._pInverseSceneMatrix[5] * y + this._pInverseSceneMatrix[9] * z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[2] * x + this._pInverseSceneMatrix[6] * y + this._pInverseSceneMatrix[10] * z;
                    this.vertexConstantData[l++] = 1;
                }
                else {
                    this.fragmentConstantData[k++] = -dirPos.x;
                    this.fragmentConstantData[k++] = -dirPos.y;
                    this.fragmentConstantData[k++] = -dirPos.z;
                    this.fragmentConstantData[k++] = 1;
                }
                this.fragmentConstantData[k++] = dirLight._iDiffuseR;
                this.fragmentConstantData[k++] = dirLight._iDiffuseG;
                this.fragmentConstantData[k++] = dirLight._iDiffuseB;
                this.fragmentConstantData[k++] = 1;
                this.fragmentConstantData[k++] = dirLight._iSpecularR;
                this.fragmentConstantData[k++] = dirLight._iSpecularG;
                this.fragmentConstantData[k++] = dirLight._iSpecularB;
                this.fragmentConstantData[k++] = 1;
                if (++total == this.numDirectionalLights) {
                    // break loop
                    i = len;
                    cast = numLightTypes;
                }
            }
        }
        // more directional supported than currently picked, need to clamp all to 0
        if (this.numDirectionalLights > total) {
            i = k + (this.numDirectionalLights - total) * 12;
            while (k < i)
                this.fragmentConstantData[k++] = 0;
        }
        total = 0;
        var pointLights = this.lightPicker.pointLights;
        offset = this.pointLightsOffset;
        len = this.lightPicker.pointLights.length;
        if (offset > len) {
            cast = 1;
            offset -= len;
        }
        else {
            cast = 0;
        }
        for (; cast < numLightTypes; ++cast) {
            if (cast)
                pointLights = this.lightPicker.castingPointLights;
            len = pointLights.length;
            for (i = 0; i < len; ++i) {
                pointLight = pointLights[offset + i];
                dirPos = pointLight.scenePosition;
                this.ambientR += pointLight._iAmbientR;
                this.ambientG += pointLight._iAmbientG;
                this.ambientB += pointLight._iAmbientB;
                if (this.usesTangentSpace) {
                    x = dirPos.x;
                    y = dirPos.y;
                    z = dirPos.z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[0] * x + this._pInverseSceneMatrix[4] * y + this._pInverseSceneMatrix[8] * z + this._pInverseSceneMatrix[12];
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[1] * x + this._pInverseSceneMatrix[5] * y + this._pInverseSceneMatrix[9] * z + this._pInverseSceneMatrix[13];
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[2] * x + this._pInverseSceneMatrix[6] * y + this._pInverseSceneMatrix[10] * z + this._pInverseSceneMatrix[14];
                    this.vertexConstantData[l++] = 1;
                }
                else if (!this.usesGlobalPosFragment) {
                    this.vertexConstantData[l++] = dirPos.x;
                    this.vertexConstantData[l++] = dirPos.y;
                    this.vertexConstantData[l++] = dirPos.z;
                    this.vertexConstantData[l++] = 1;
                }
                else {
                    this.fragmentConstantData[k++] = dirPos.x;
                    this.fragmentConstantData[k++] = dirPos.y;
                    this.fragmentConstantData[k++] = dirPos.z;
                    this.fragmentConstantData[k++] = 1;
                }
                this.fragmentConstantData[k++] = pointLight._iDiffuseR;
                this.fragmentConstantData[k++] = pointLight._iDiffuseG;
                this.fragmentConstantData[k++] = pointLight._iDiffuseB;
                var radius = pointLight._pRadius;
                this.fragmentConstantData[k++] = radius * radius;
                this.fragmentConstantData[k++] = pointLight._iSpecularR;
                this.fragmentConstantData[k++] = pointLight._iSpecularG;
                this.fragmentConstantData[k++] = pointLight._iSpecularB;
                this.fragmentConstantData[k++] = pointLight._pFallOffFactor;
                if (++total == this.numPointLights) {
                    // break loop
                    i = len;
                    cast = numLightTypes;
                }
            }
        }
        // more directional supported than currently picked, need to clamp all to 0
        if (this.numPointLights > total) {
            i = k + (total - this.numPointLights) * 12;
            for (; k < i; ++k)
                this.fragmentConstantData[k] = 0;
        }
    };
    /**
     * Updates constant data render state used by the light probes. This method is optional for subclasses to implement.
     */
    ShaderLightingObject.prototype.updateProbes = function (stage) {
        var probe;
        var lightProbes = this.lightPicker.lightProbes;
        var weights = this.lightPicker.lightProbeWeights;
        var len = lightProbes.length - this.lightProbesOffset;
        var addDiff = this.usesProbesForDiffuse;
        var addSpec = this.usesProbesForSpecular;
        if (!(addDiff || addSpec))
            return;
        if (len > this.numLightProbes)
            len = this.numLightProbes;
        for (var i = 0; i < len; ++i) {
            probe = lightProbes[this.lightProbesOffset + i];
            if (addDiff)
                stage.activateCubeTexture(this.lightProbeDiffuseIndices[i], probe.diffuseMap);
            if (addSpec)
                stage.activateCubeTexture(this.lightProbeSpecularIndices[i], probe.specularMap);
        }
        for (i = 0; i < len; ++i)
            this.fragmentConstantData[this.probeWeightsIndex + i] = weights[this.lightProbesOffset + i];
    };
    return ShaderLightingObject;
})(ShaderObjectBase);
module.exports = ShaderLightingObject;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9zaGFkZXJsaWdodGluZ29iamVjdC50cyJdLCJuYW1lcyI6WyJTaGFkZXJMaWdodGluZ09iamVjdCIsIlNoYWRlckxpZ2h0aW5nT2JqZWN0LmNvbnN0cnVjdG9yIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QuY3JlYXRlQ29tcGlsZXIiLCJTaGFkZXJMaWdodGluZ09iamVjdC5yZXNldCIsIlNoYWRlckxpZ2h0aW5nT2JqZWN0LnNldFJlbmRlclN0YXRlIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QudXBkYXRlTGlnaHRzIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QudXBkYXRlUHJvYmVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFZQSxJQUFPLHNCQUFzQixXQUFZLDBEQUEwRCxDQUFDLENBQUM7QUFJckcsSUFBTyxnQkFBZ0IsV0FBYyxvREFBb0QsQ0FBQyxDQUFDO0FBRzNGLEFBUUE7Ozs7Ozs7R0FERztJQUNHLG9CQUFvQjtJQUFTQSxVQUE3QkEsb0JBQW9CQSxVQUF5QkE7SUFzRWxEQTs7T0FFR0E7SUFDSEEsU0F6RUtBLG9CQUFvQkEsQ0F5RWJBLE9BQU9BO1FBRWxCQyxrQkFBTUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7SUFDaEJBLENBQUNBO0lBRUREOzs7OztPQUtHQTtJQUNJQSw2Q0FBY0EsR0FBckJBLFVBQXNCQSxRQUF1QkEsRUFBRUEsWUFBK0JBO1FBRTdFRSxNQUFNQSxDQUFDQSxJQUFJQSxzQkFBc0JBLENBQUNBLFFBQVFBLEVBQUVBLFlBQVlBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO0lBQ2pFQSxDQUFDQTtJQUVERjs7T0FFR0E7SUFDSUEsb0NBQUtBLEdBQVpBO1FBRUNHLGdCQUFLQSxDQUFDQSxLQUFLQSxXQUFFQSxDQUFDQTtRQUVkQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNuQkEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUM5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aUJBQXJCLG9CQUFvQixDQUFDIiwiZmlsZSI6ImNvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nT2JqZWN0LmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XG5cbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xuaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9EaXJlY3Rpb25hbExpZ2h0XCIpO1xuaW1wb3J0IExpZ2h0UHJvYmVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0xpZ2h0UHJvYmVcIik7XG5pbXBvcnQgUG9pbnRMaWdodFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvUG9pbnRMaWdodFwiKTtcbmltcG9ydCBMaWdodFBpY2tlckJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvbGlnaHRwaWNrZXJzL0xpZ2h0UGlja2VyQmFzZVwiKTtcblxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xuXG5pbXBvcnQgU2hhZGVyTGlnaHRpbmdDb21waWxlclx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyTGlnaHRpbmdDb21waWxlclwiKTtcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XG5pbXBvcnQgTWF0ZXJpYWxHTEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvTWF0ZXJpYWxHTEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyQ29tcGlsZXJCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlckNvbXBpbGVyQmFzZVwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcbmltcG9ydCBMaWdodGluZ1Bhc3NHTEJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcGFzc2VzL0xpZ2h0aW5nUGFzc0dMQmFzZVwiKTtcblxuLyoqXG4gKiBTaGFkZXJPYmplY3RCYXNlIGtlZXBzIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgZGVwZW5kZW5jaWVzIGZvciBcIm5hbWVkIHJlZ2lzdGVyc1wiIHVzZWQgYWNyb3NzIGEgcGFzcy5cbiAqIE5hbWVkIHJlZ2lzdGVycyBhcmUgdGhhdCBhcmUgbm90IG5lY2Vzc2FyaWx5IGxpbWl0ZWQgdG8gYSBzaW5nbGUgbWV0aG9kLiBUaGV5IGFyZSBjcmVhdGVkIGJ5IHRoZSBjb21waWxlciBhbmRcbiAqIHBhc3NlZCBvbiB0byBtZXRob2RzLiBUaGUgY29tcGlsZXIgdXNlcyB0aGUgcmVzdWx0cyB0byByZXNlcnZlIHVzYWdlcyB0aHJvdWdoIFJlZ2lzdGVyUG9vbCwgd2hpY2ggY2FuIGJlIHJlbW92ZWRcbiAqIGVhY2ggdGltZSBhIG1ldGhvZCBoYXMgYmVlbiBjb21waWxlZCBpbnRvIHRoZSBzaGFkZXIuXG4gKlxuICogQHNlZSBSZWdpc3RlclBvb2wuYWRkVXNhZ2VcbiAqL1xuY2xhc3MgU2hhZGVyTGlnaHRpbmdPYmplY3QgZXh0ZW5kcyBTaGFkZXJPYmplY3RCYXNlXG57XG5cdC8qKlxuXHQgKiBUaGUgZmlyc3QgaW5kZXggZm9yIHRoZSBmcmFnbWVudCBjb25zdGFudHMgY29udGFpbmluZyB0aGUgbGlnaHQgZGF0YS5cblx0ICovXG5cdHB1YmxpYyBsaWdodEZyYWdtZW50Q29uc3RhbnRJbmRleDpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFRoZSBzdGFydGluZyBpbmRleCBpZiB0aGUgdmVydGV4IGNvbnN0YW50IHRvIHdoaWNoIGxpZ2h0IGRhdGEgbmVlZHMgdG8gYmUgdXBsb2FkZWQuXG5cdCAqL1xuXHRwdWJsaWMgbGlnaHRWZXJ0ZXhDb25zdGFudEluZGV4Om51bWJlcjtcblxuXHQvKipcblx0ICogSW5kaWNlcyBmb3IgdGhlIGxpZ2h0IHByb2JlIGRpZmZ1c2UgdGV4dHVyZXMuXG5cdCAqL1xuXHRwdWJsaWMgbGlnaHRQcm9iZURpZmZ1c2VJbmRpY2VzOkFycmF5PG51bWJlcj4gLyp1aW50Ki87XG5cblx0LyoqXG5cdCAqIEluZGljZXMgZm9yIHRoZSBsaWdodCBwcm9iZSBzcGVjdWxhciB0ZXh0dXJlcy5cblx0ICovXG5cdHB1YmxpYyBsaWdodFByb2JlU3BlY3VsYXJJbmRpY2VzOkFycmF5PG51bWJlcj4gLyp1aW50Ki87XG5cblx0LyoqXG5cdCAqIFRoZSBpbmRleCBvZiB0aGUgZnJhZ21lbnQgY29uc3RhbnQgY29udGFpbmluZyB0aGUgd2VpZ2h0cyBmb3IgdGhlIGxpZ2h0IHByb2Jlcy5cblx0ICovXG5cdHB1YmxpYyBwcm9iZVdlaWdodHNJbmRleDpudW1iZXI7XG5cblx0cHVibGljIG51bUxpZ2h0czpudW1iZXI7XG5cdHB1YmxpYyB1c2VzTGlnaHRGYWxsT2ZmOmJvb2xlYW47XG5cblx0cHVibGljIHVzZXNTaGFkb3dzOmJvb2xlYW47XG5cblx0cHVibGljIG51bVBvaW50TGlnaHRzOm51bWJlcjtcblx0cHVibGljIG51bURpcmVjdGlvbmFsTGlnaHRzOm51bWJlcjtcblx0cHVibGljIG51bUxpZ2h0UHJvYmVzOm51bWJlcjtcblx0cHVibGljIHBvaW50TGlnaHRzT2Zmc2V0Om51bWJlcjtcblx0cHVibGljIGRpcmVjdGlvbmFsTGlnaHRzT2Zmc2V0Om51bWJlcjtcblx0cHVibGljIGxpZ2h0UHJvYmVzT2Zmc2V0Om51bWJlcjtcblx0cHVibGljIGxpZ2h0UGlja2VyOkxpZ2h0UGlja2VyQmFzZTtcblxuXHQvKipcblx0ICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHNoYWRlciB1c2VzIGFueSBsaWdodHMuXG5cdCAqL1xuXHRwdWJsaWMgdXNlc0xpZ2h0czpib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc2hhZGVyIHVzZXMgYW55IGxpZ2h0IHByb2Jlcy5cblx0ICovXG5cdHB1YmxpYyB1c2VzUHJvYmVzOmJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBsaWdodHMgdXNlcyBhbnkgc3BlY3VsYXIgY29tcG9uZW50cy5cblx0ICovXG5cdHB1YmxpYyB1c2VzTGlnaHRzRm9yU3BlY3VsYXI6Ym9vbGVhbjtcblxuXHQvKipcblx0ICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHByb2JlcyB1c2VzIGFueSBzcGVjdWxhciBjb21wb25lbnRzLlxuXHQgKi9cblx0cHVibGljIHVzZXNQcm9iZXNGb3JTcGVjdWxhcjpib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgbGlnaHRzIHVzZXMgYW55IGRpZmZ1c2UgY29tcG9uZW50cy5cblx0ICovXG5cdHB1YmxpYyB1c2VzTGlnaHRzRm9yRGlmZnVzZTpib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgcHJvYmVzIHVzZXMgYW55IGRpZmZ1c2UgY29tcG9uZW50cy5cblx0ICovXG5cdHB1YmxpYyB1c2VzUHJvYmVzRm9yRGlmZnVzZTpib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IE1ldGhvZENvbXBpbGVyVk8gb2JqZWN0LlxuXHQgKi9cblx0Y29uc3RydWN0b3IocHJvZmlsZSlcblx0e1xuXHRcdHN1cGVyKHByb2ZpbGUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZhY3RvcnkgbWV0aG9kIHRvIGNyZWF0ZSBhIGNvbmNyZXRlIGNvbXBpbGVyIG9iamVjdCBmb3IgdGhpcyBvYmplY3Rcblx0ICpcblx0ICogQHBhcmFtIG1hdGVyaWFsUGFzc1ZPXG5cdCAqIEByZXR1cm5zIHthd2F5Lm1hdGVyaWFscy5TaGFkZXJMaWdodGluZ0NvbXBpbGVyfVxuXHQgKi9cblx0cHVibGljIGNyZWF0ZUNvbXBpbGVyKG1hdGVyaWFsOk1hdGVyaWFsR0xCYXNlLCBtYXRlcmlhbFBhc3M6TGlnaHRpbmdQYXNzR0xCYXNlKTpTaGFkZXJDb21waWxlckJhc2Vcblx0e1xuXHRcdHJldHVybiBuZXcgU2hhZGVyTGlnaHRpbmdDb21waWxlcihtYXRlcmlhbCwgbWF0ZXJpYWxQYXNzLCB0aGlzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDbGVhcnMgZGVwZW5kZW5jeSBjb3VudHMgZm9yIGFsbCByZWdpc3RlcnMuIENhbGxlZCB3aGVuIHJlY29tcGlsaW5nIGEgcGFzcy5cblx0ICovXG5cdHB1YmxpYyByZXNldCgpXG5cdHtcblx0XHRzdXBlci5yZXNldCgpO1xuXG5cdFx0dGhpcy5udW1MaWdodHMgPSAwO1xuXHRcdHRoaXMudXNlc0xpZ2h0RmFsbE9mZiA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICpcblx0ICogQHBhcmFtIHJlbmRlcmFibGVcblx0ICogQHBhcmFtIHN0YWdlXG5cdCAqIEBwYXJhbSBjYW1lcmFcblx0ICovXG5cdHB1YmxpYyBzZXRSZW5kZXJTdGF0ZShyZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBzdGFnZTpTdGFnZSwgY2FtZXJhOkNhbWVyYSwgdmlld1Byb2plY3Rpb246TWF0cml4M0QpXG5cdHtcblx0XHRzdXBlci5zZXRSZW5kZXJTdGF0ZShyZW5kZXJhYmxlLCBzdGFnZSwgY2FtZXJhLCB2aWV3UHJvamVjdGlvbik7XG5cblx0XHRpZiAodGhpcy51c2VzTGlnaHRzKVxuXHRcdFx0dGhpcy51cGRhdGVMaWdodHMoKTtcblxuXHRcdGlmICh0aGlzLnVzZXNQcm9iZXMpXG5cdFx0XHR0aGlzLnVwZGF0ZVByb2JlcyhzdGFnZSk7XG5cdH1cblxuXHQvKipcblx0ICogVXBkYXRlcyBjb25zdGFudCBkYXRhIHJlbmRlciBzdGF0ZSB1c2VkIGJ5IHRoZSBsaWdodHMuIFRoaXMgbWV0aG9kIGlzIG9wdGlvbmFsIGZvciBzdWJjbGFzc2VzIHRvIGltcGxlbWVudC5cblx0ICovXG5cdHByaXZhdGUgdXBkYXRlTGlnaHRzKClcblx0e1xuXHRcdHZhciBkaXJMaWdodDpEaXJlY3Rpb25hbExpZ2h0O1xuXHRcdHZhciBwb2ludExpZ2h0OlBvaW50TGlnaHQ7XG5cdFx0dmFyIGk6bnVtYmVyID0gMDtcblx0XHR2YXIgazpudW1iZXIgPSAwO1xuXHRcdHZhciBsZW46bnVtYmVyO1xuXHRcdHZhciBkaXJQb3M6VmVjdG9yM0Q7XG5cdFx0dmFyIHRvdGFsOm51bWJlciA9IDA7XG5cdFx0dmFyIG51bUxpZ2h0VHlwZXM6bnVtYmVyID0gdGhpcy51c2VzU2hhZG93cz8gMiA6IDE7XG5cdFx0dmFyIGw6bnVtYmVyO1xuXHRcdHZhciBvZmZzZXQ6bnVtYmVyO1xuXG5cdFx0dGhpcy5hbWJpZW50UiA9IHRoaXMuYW1iaWVudEcgPSB0aGlzLmFtYmllbnRCID0gMDtcblxuXHRcdGwgPSB0aGlzLmxpZ2h0VmVydGV4Q29uc3RhbnRJbmRleDtcblx0XHRrID0gdGhpcy5saWdodEZyYWdtZW50Q29uc3RhbnRJbmRleDtcblxuXHRcdHZhciBjYXN0Om51bWJlciA9IDA7XG5cdFx0dmFyIGRpckxpZ2h0czpBcnJheTxEaXJlY3Rpb25hbExpZ2h0PiA9IHRoaXMubGlnaHRQaWNrZXIuZGlyZWN0aW9uYWxMaWdodHM7XG5cdFx0b2Zmc2V0ID0gdGhpcy5kaXJlY3Rpb25hbExpZ2h0c09mZnNldDtcblx0XHRsZW4gPSB0aGlzLmxpZ2h0UGlja2VyLmRpcmVjdGlvbmFsTGlnaHRzLmxlbmd0aDtcblxuXHRcdGlmIChvZmZzZXQgPiBsZW4pIHtcblx0XHRcdGNhc3QgPSAxO1xuXHRcdFx0b2Zmc2V0IC09IGxlbjtcblx0XHR9XG5cblx0XHRmb3IgKDsgY2FzdCA8IG51bUxpZ2h0VHlwZXM7ICsrY2FzdCkge1xuXHRcdFx0aWYgKGNhc3QpXG5cdFx0XHRcdGRpckxpZ2h0cyA9IHRoaXMubGlnaHRQaWNrZXIuY2FzdGluZ0RpcmVjdGlvbmFsTGlnaHRzO1xuXG5cdFx0XHRsZW4gPSBkaXJMaWdodHMubGVuZ3RoO1xuXG5cdFx0XHRpZiAobGVuID4gdGhpcy5udW1EaXJlY3Rpb25hbExpZ2h0cylcblx0XHRcdFx0bGVuID0gdGhpcy5udW1EaXJlY3Rpb25hbExpZ2h0cztcblxuXHRcdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7XG5cdFx0XHRcdGRpckxpZ2h0ID0gZGlyTGlnaHRzW29mZnNldCArIGldO1xuXHRcdFx0XHRkaXJQb3MgPSBkaXJMaWdodC5zY2VuZURpcmVjdGlvbjtcblxuXHRcdFx0XHR0aGlzLmFtYmllbnRSICs9IGRpckxpZ2h0Ll9pQW1iaWVudFI7XG5cdFx0XHRcdHRoaXMuYW1iaWVudEcgKz0gZGlyTGlnaHQuX2lBbWJpZW50Rztcblx0XHRcdFx0dGhpcy5hbWJpZW50QiArPSBkaXJMaWdodC5faUFtYmllbnRCO1xuXG5cdFx0XHRcdGlmICh0aGlzLnVzZXNUYW5nZW50U3BhY2UpIHtcblx0XHRcdFx0XHR2YXIgeDpudW1iZXIgPSAtZGlyUG9zLng7XG5cdFx0XHRcdFx0dmFyIHk6bnVtYmVyID0gLWRpclBvcy55O1xuXHRcdFx0XHRcdHZhciB6Om51bWJlciA9IC1kaXJQb3MuejtcblxuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzBdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzRdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzhdKno7XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMV0qeCArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbNV0qeSArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbOV0qejtcblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsyXSp4ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs2XSp5ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxMF0qejtcblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gMTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSAtZGlyUG9zLng7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gLWRpclBvcy55O1xuXHRcdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IC1kaXJQb3Muejtcblx0XHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSAxO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyTGlnaHQuX2lEaWZmdXNlUjtcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyTGlnaHQuX2lEaWZmdXNlRztcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyTGlnaHQuX2lEaWZmdXNlQjtcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gMTtcblxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBkaXJMaWdodC5faVNwZWN1bGFyUjtcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyTGlnaHQuX2lTcGVjdWxhckc7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pU3BlY3VsYXJCO1xuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSAxO1xuXG5cdFx0XHRcdGlmICgrK3RvdGFsID09IHRoaXMubnVtRGlyZWN0aW9uYWxMaWdodHMpIHtcblx0XHRcdFx0XHQvLyBicmVhayBsb29wXG5cdFx0XHRcdFx0aSA9IGxlbjtcblx0XHRcdFx0XHRjYXN0ID0gbnVtTGlnaHRUeXBlcztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIG1vcmUgZGlyZWN0aW9uYWwgc3VwcG9ydGVkIHRoYW4gY3VycmVudGx5IHBpY2tlZCwgbmVlZCB0byBjbGFtcCBhbGwgdG8gMFxuXHRcdGlmICh0aGlzLm51bURpcmVjdGlvbmFsTGlnaHRzID4gdG90YWwpIHtcblx0XHRcdGkgPSBrICsgKHRoaXMubnVtRGlyZWN0aW9uYWxMaWdodHMgLSB0b3RhbCkqMTI7XG5cblx0XHRcdHdoaWxlIChrIDwgaSlcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gMDtcblx0XHR9XG5cblx0XHR0b3RhbCA9IDA7XG5cblx0XHR2YXIgcG9pbnRMaWdodHM6QXJyYXk8UG9pbnRMaWdodD4gPSB0aGlzLmxpZ2h0UGlja2VyLnBvaW50TGlnaHRzO1xuXHRcdG9mZnNldCA9IHRoaXMucG9pbnRMaWdodHNPZmZzZXQ7XG5cdFx0bGVuID0gdGhpcy5saWdodFBpY2tlci5wb2ludExpZ2h0cy5sZW5ndGg7XG5cblx0XHRpZiAob2Zmc2V0ID4gbGVuKSB7XG5cdFx0XHRjYXN0ID0gMTtcblx0XHRcdG9mZnNldCAtPSBsZW47XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNhc3QgPSAwO1xuXHRcdH1cblxuXHRcdGZvciAoOyBjYXN0IDwgbnVtTGlnaHRUeXBlczsgKytjYXN0KSB7XG5cdFx0XHRpZiAoY2FzdClcblx0XHRcdFx0cG9pbnRMaWdodHMgPSB0aGlzLmxpZ2h0UGlja2VyLmNhc3RpbmdQb2ludExpZ2h0cztcblxuXHRcdFx0bGVuID0gcG9pbnRMaWdodHMubGVuZ3RoO1xuXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcblx0XHRcdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRzW29mZnNldCArIGldO1xuXHRcdFx0XHRkaXJQb3MgPSBwb2ludExpZ2h0LnNjZW5lUG9zaXRpb247XG5cblx0XHRcdFx0dGhpcy5hbWJpZW50UiArPSBwb2ludExpZ2h0Ll9pQW1iaWVudFI7XG5cdFx0XHRcdHRoaXMuYW1iaWVudEcgKz0gcG9pbnRMaWdodC5faUFtYmllbnRHO1xuXHRcdFx0XHR0aGlzLmFtYmllbnRCICs9IHBvaW50TGlnaHQuX2lBbWJpZW50QjtcblxuXHRcdFx0XHRpZiAodGhpcy51c2VzVGFuZ2VudFNwYWNlKSB7XG5cdFx0XHRcdFx0eCA9IGRpclBvcy54O1xuXHRcdFx0XHRcdHkgPSBkaXJQb3MueTtcblx0XHRcdFx0XHR6ID0gZGlyUG9zLno7XG5cblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFswXSp4ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs0XSp5ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs4XSp6ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxMl07XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMV0qeCArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbNV0qeSArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbOV0qeiArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMTNdO1xuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzJdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzZdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzEwXSp6ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxNF07XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IDE7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXRoaXMudXNlc0dsb2JhbFBvc0ZyYWdtZW50KSB7XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IGRpclBvcy54O1xuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSBkaXJQb3MueTtcblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gZGlyUG9zLno7XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IDE7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyUG9zLng7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyUG9zLnk7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyUG9zLno7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gMTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lEaWZmdXNlUjtcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gcG9pbnRMaWdodC5faURpZmZ1c2VHO1xuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBwb2ludExpZ2h0Ll9pRGlmZnVzZUI7XG5cblx0XHRcdFx0dmFyIHJhZGl1czpudW1iZXIgPSBwb2ludExpZ2h0Ll9wUmFkaXVzO1xuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSByYWRpdXMqcmFkaXVzO1xuXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lTcGVjdWxhclI7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lTcGVjdWxhckc7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lTcGVjdWxhckI7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX3BGYWxsT2ZmRmFjdG9yO1xuXG5cdFx0XHRcdGlmICgrK3RvdGFsID09IHRoaXMubnVtUG9pbnRMaWdodHMpIHtcblx0XHRcdFx0XHQvLyBicmVhayBsb29wXG5cdFx0XHRcdFx0aSA9IGxlbjtcblx0XHRcdFx0XHRjYXN0ID0gbnVtTGlnaHRUeXBlcztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIG1vcmUgZGlyZWN0aW9uYWwgc3VwcG9ydGVkIHRoYW4gY3VycmVudGx5IHBpY2tlZCwgbmVlZCB0byBjbGFtcCBhbGwgdG8gMFxuXHRcdGlmICh0aGlzLm51bVBvaW50TGlnaHRzID4gdG90YWwpIHtcblx0XHRcdGkgPSBrICsgKHRvdGFsIC0gdGhpcy5udW1Qb2ludExpZ2h0cykqMTI7XG5cblx0XHRcdGZvciAoOyBrIDwgaTsgKytrKVxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2tdID0gMDtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVXBkYXRlcyBjb25zdGFudCBkYXRhIHJlbmRlciBzdGF0ZSB1c2VkIGJ5IHRoZSBsaWdodCBwcm9iZXMuIFRoaXMgbWV0aG9kIGlzIG9wdGlvbmFsIGZvciBzdWJjbGFzc2VzIHRvIGltcGxlbWVudC5cblx0ICovXG5cdHByaXZhdGUgdXBkYXRlUHJvYmVzKHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0dmFyIHByb2JlOkxpZ2h0UHJvYmU7XG5cdFx0dmFyIGxpZ2h0UHJvYmVzOkFycmF5PExpZ2h0UHJvYmU+ID0gdGhpcy5saWdodFBpY2tlci5saWdodFByb2Jlcztcblx0XHR2YXIgd2VpZ2h0czpBcnJheTxudW1iZXI+ID0gdGhpcy5saWdodFBpY2tlci5saWdodFByb2JlV2VpZ2h0cztcblx0XHR2YXIgbGVuOm51bWJlciA9IGxpZ2h0UHJvYmVzLmxlbmd0aCAtIHRoaXMubGlnaHRQcm9iZXNPZmZzZXQ7XG5cdFx0dmFyIGFkZERpZmY6Ym9vbGVhbiA9IHRoaXMudXNlc1Byb2Jlc0ZvckRpZmZ1c2U7XG5cdFx0dmFyIGFkZFNwZWM6Ym9vbGVhbiA9IHRoaXMudXNlc1Byb2Jlc0ZvclNwZWN1bGFyO1xuXG5cdFx0aWYgKCEoYWRkRGlmZiB8fCBhZGRTcGVjKSlcblx0XHRcdHJldHVybjtcblxuXHRcdGlmIChsZW4gPiB0aGlzLm51bUxpZ2h0UHJvYmVzKVxuXHRcdFx0bGVuID0gdGhpcy5udW1MaWdodFByb2JlcztcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgKytpKSB7XG5cdFx0XHRwcm9iZSA9IGxpZ2h0UHJvYmVzWyB0aGlzLmxpZ2h0UHJvYmVzT2Zmc2V0ICsgaV07XG5cblx0XHRcdGlmIChhZGREaWZmKVxuXHRcdFx0XHRzdGFnZS5hY3RpdmF0ZUN1YmVUZXh0dXJlKHRoaXMubGlnaHRQcm9iZURpZmZ1c2VJbmRpY2VzW2ldLCBwcm9iZS5kaWZmdXNlTWFwKTtcblxuXHRcdFx0aWYgKGFkZFNwZWMpXG5cdFx0XHRcdHN0YWdlLmFjdGl2YXRlQ3ViZVRleHR1cmUodGhpcy5saWdodFByb2JlU3BlY3VsYXJJbmRpY2VzW2ldLCBwcm9iZS5zcGVjdWxhck1hcCk7XG5cdFx0fVxuXG5cdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgKytpKVxuXHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVt0aGlzLnByb2JlV2VpZ2h0c0luZGV4ICsgaV0gPSB3ZWlnaHRzW3RoaXMubGlnaHRQcm9iZXNPZmZzZXQgKyBpXTtcblx0fVxufVxuXG5leHBvcnQgPSBTaGFkZXJMaWdodGluZ09iamVjdDsiXX0=