var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var LightSources = require("awayjs-display/lib/materials/LightSources");
var ContextGLProfile = require("awayjs-stagegl/lib/base/ContextGLProfile");
var ShaderLightingCompiler = require("awayjs-renderergl/lib/compilation/ShaderLightingCompiler");
var ShaderObjectBase = require("awayjs-renderergl/lib/compilation/ShaderObjectBase");
/**
 * ShaderObjectBase keeps track of the number of dependencies for "named registers" used across a pass.
 * Named registers are that are not necessarily limited to a single method. They are created by the compiler and
 * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed
 * each time a method has been compiled into the shader.
 *
 * @see RegisterPool.addUsage
 */
var ShaderLightingObject = (function (_super) {
    __extends(ShaderLightingObject, _super);
    /**
     * Creates a new MethodCompilerVO object.
     */
    function ShaderLightingObject(renderableClass, renderLightingPass, stage) {
        _super.call(this, renderableClass, renderLightingPass, stage);
        this._includeCasters = true;
        this._renderLightingPass = renderLightingPass;
    }
    ShaderLightingObject.prototype._iIncludeDependencies = function () {
        this.numPointLights = this._renderLightingPass.numPointLights;
        this.numDirectionalLights = this._renderLightingPass.numDirectionalLights;
        this.numLightProbes = this._renderLightingPass.numLightProbes;
        var numAllLights = this._renderLightingPass.numPointLights + this._renderLightingPass.numDirectionalLights;
        var numLightProbes = this._renderLightingPass.numLightProbes;
        var diffuseLightSources = this._renderLightingPass.diffuseLightSources;
        var specularLightSources = this._renderLightingPass._iUsesSpecular(this) ? this._renderLightingPass.specularLightSources : 0x00;
        var combinedLightSources = diffuseLightSources | specularLightSources;
        this.usesLightFallOff = this._renderLightingPass.enableLightFallOff && this.profile != ContextGLProfile.BASELINE_CONSTRAINED;
        this.numLights = numAllLights + numLightProbes;
        this.usesLights = numAllLights > 0 && (combinedLightSources & LightSources.LIGHTS) != 0;
        this.usesProbes = numLightProbes > 0 && (combinedLightSources & LightSources.PROBES) != 0;
        this.usesLightsForSpecular = numAllLights > 0 && (specularLightSources & LightSources.LIGHTS) != 0;
        this.usesProbesForSpecular = numLightProbes > 0 && (specularLightSources & LightSources.PROBES) != 0;
        this.usesLightsForDiffuse = numAllLights > 0 && (diffuseLightSources & LightSources.LIGHTS) != 0;
        this.usesProbesForDiffuse = numLightProbes > 0 && (diffuseLightSources & LightSources.PROBES) != 0;
        this.usesShadows = this._renderLightingPass._iUsesShadows(this);
        //IMPORTANT this must occur after shader lighting initialisation above
        _super.prototype._iIncludeDependencies.call(this);
    };
    /**
     * Factory method to create a concrete compiler object for this object
     *
     * @param materialPassVO
     * @returns {away.materials.ShaderLightingCompiler}
     */
    ShaderLightingObject.prototype.createCompiler = function (renderableClass, renderPass) {
        return new ShaderLightingCompiler(renderableClass, renderPass, this);
    };
    /**
     * Clears dependency counts for all registers. Called when recompiling a pass.
     */
    ShaderLightingObject.prototype.reset = function () {
        _super.prototype.reset.call(this);
        this.numLights = 0;
        this.usesLightFallOff = true;
    };
    /**
     *
     *
     * @param renderable
     * @param stage
     * @param camera
     */
    ShaderLightingObject.prototype._iRender = function (renderable, camera, viewProjection) {
        _super.prototype._iRender.call(this, renderable, camera, viewProjection);
        if (this._renderLightingPass.lightPicker)
            this._renderLightingPass.lightPicker.collectLights(renderable);
        if (this.usesLights)
            this.updateLights();
        if (this.usesProbes)
            this.updateProbes();
    };
    /**
     * Updates constant data render state used by the lights. This method is optional for subclasses to implement.
     */
    ShaderLightingObject.prototype.updateLights = function () {
        var dirLight;
        var pointLight;
        var i = 0;
        var k = 0;
        var len;
        var dirPos;
        var total = 0;
        var numLightTypes = this.usesShadows ? 2 : 1;
        var l;
        var offset;
        this.ambientR = this.ambientG = this.ambientB = 0;
        l = this.lightVertexConstantIndex;
        k = this.lightFragmentConstantIndex;
        var cast = 0;
        var dirLights = this._renderLightingPass.lightPicker.directionalLights;
        offset = this._renderLightingPass.directionalLightsOffset;
        len = this._renderLightingPass.lightPicker.directionalLights.length;
        if (offset > len) {
            cast = 1;
            offset -= len;
        }
        for (; cast < numLightTypes; ++cast) {
            if (cast)
                dirLights = this._renderLightingPass.lightPicker.castingDirectionalLights;
            len = dirLights.length;
            if (len > this.numDirectionalLights)
                len = this.numDirectionalLights;
            for (i = 0; i < len; ++i) {
                dirLight = dirLights[offset + i];
                dirPos = dirLight.sceneDirection;
                this.ambientR += dirLight._iAmbientR;
                this.ambientG += dirLight._iAmbientG;
                this.ambientB += dirLight._iAmbientB;
                if (this.usesTangentSpace) {
                    var x = -dirPos.x;
                    var y = -dirPos.y;
                    var z = -dirPos.z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[0] * x + this._pInverseSceneMatrix[4] * y + this._pInverseSceneMatrix[8] * z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[1] * x + this._pInverseSceneMatrix[5] * y + this._pInverseSceneMatrix[9] * z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[2] * x + this._pInverseSceneMatrix[6] * y + this._pInverseSceneMatrix[10] * z;
                    this.vertexConstantData[l++] = 1;
                }
                else {
                    this.fragmentConstantData[k++] = -dirPos.x;
                    this.fragmentConstantData[k++] = -dirPos.y;
                    this.fragmentConstantData[k++] = -dirPos.z;
                    this.fragmentConstantData[k++] = 1;
                }
                this.fragmentConstantData[k++] = dirLight._iDiffuseR;
                this.fragmentConstantData[k++] = dirLight._iDiffuseG;
                this.fragmentConstantData[k++] = dirLight._iDiffuseB;
                this.fragmentConstantData[k++] = 1;
                this.fragmentConstantData[k++] = dirLight._iSpecularR;
                this.fragmentConstantData[k++] = dirLight._iSpecularG;
                this.fragmentConstantData[k++] = dirLight._iSpecularB;
                this.fragmentConstantData[k++] = 1;
                if (++total == this.numDirectionalLights) {
                    // break loop
                    i = len;
                    cast = numLightTypes;
                }
            }
        }
        // more directional supported than currently picked, need to clamp all to 0
        if (this.numDirectionalLights > total) {
            i = k + (this.numDirectionalLights - total) * 12;
            while (k < i)
                this.fragmentConstantData[k++] = 0;
        }
        total = 0;
        var pointLights = this._renderLightingPass.lightPicker.pointLights;
        offset = this._renderLightingPass.pointLightsOffset;
        len = this._renderLightingPass.lightPicker.pointLights.length;
        if (offset > len) {
            cast = 1;
            offset -= len;
        }
        else {
            cast = 0;
        }
        for (; cast < numLightTypes; ++cast) {
            if (cast)
                pointLights = this._renderLightingPass.lightPicker.castingPointLights;
            len = pointLights.length;
            for (i = 0; i < len; ++i) {
                pointLight = pointLights[offset + i];
                dirPos = pointLight.scenePosition;
                this.ambientR += pointLight._iAmbientR;
                this.ambientG += pointLight._iAmbientG;
                this.ambientB += pointLight._iAmbientB;
                if (this.usesTangentSpace) {
                    x = dirPos.x;
                    y = dirPos.y;
                    z = dirPos.z;
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[0] * x + this._pInverseSceneMatrix[4] * y + this._pInverseSceneMatrix[8] * z + this._pInverseSceneMatrix[12];
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[1] * x + this._pInverseSceneMatrix[5] * y + this._pInverseSceneMatrix[9] * z + this._pInverseSceneMatrix[13];
                    this.vertexConstantData[l++] = this._pInverseSceneMatrix[2] * x + this._pInverseSceneMatrix[6] * y + this._pInverseSceneMatrix[10] * z + this._pInverseSceneMatrix[14];
                    this.vertexConstantData[l++] = 1;
                }
                else if (!this.usesGlobalPosFragment) {
                    this.vertexConstantData[l++] = dirPos.x;
                    this.vertexConstantData[l++] = dirPos.y;
                    this.vertexConstantData[l++] = dirPos.z;
                    this.vertexConstantData[l++] = 1;
                }
                else {
                    this.fragmentConstantData[k++] = dirPos.x;
                    this.fragmentConstantData[k++] = dirPos.y;
                    this.fragmentConstantData[k++] = dirPos.z;
                    this.fragmentConstantData[k++] = 1;
                }
                this.fragmentConstantData[k++] = pointLight._iDiffuseR;
                this.fragmentConstantData[k++] = pointLight._iDiffuseG;
                this.fragmentConstantData[k++] = pointLight._iDiffuseB;
                var radius = pointLight._pRadius;
                this.fragmentConstantData[k++] = radius * radius;
                this.fragmentConstantData[k++] = pointLight._iSpecularR;
                this.fragmentConstantData[k++] = pointLight._iSpecularG;
                this.fragmentConstantData[k++] = pointLight._iSpecularB;
                this.fragmentConstantData[k++] = pointLight._pFallOffFactor;
                if (++total == this.numPointLights) {
                    // break loop
                    i = len;
                    cast = numLightTypes;
                }
            }
        }
        // more directional supported than currently picked, need to clamp all to 0
        if (this.numPointLights > total) {
            i = k + (total - this.numPointLights) * 12;
            for (; k < i; ++k)
                this.fragmentConstantData[k] = 0;
        }
    };
    /**
     * Updates constant data render state used by the light probes. This method is optional for subclasses to implement.
     */
    ShaderLightingObject.prototype.updateProbes = function () {
        var probe;
        var lightProbes = this._renderLightingPass.lightPicker.lightProbes;
        var weights = this._renderLightingPass.lightPicker.lightProbeWeights;
        var len = lightProbes.length - this._renderLightingPass.lightProbesOffset;
        var addDiff = this.usesProbesForDiffuse;
        var addSpec = this.usesProbesForSpecular;
        if (!(addDiff || addSpec))
            return;
        if (len > this.numLightProbes)
            len = this.numLightProbes;
        for (var i = 0; i < len; ++i) {
            probe = lightProbes[this._renderLightingPass.lightProbesOffset + i];
            if (addDiff)
                this._stage.activateCubeTexture(this.lightProbeDiffuseIndices[i], probe.diffuseMap);
            if (addSpec)
                this._stage.activateCubeTexture(this.lightProbeSpecularIndices[i], probe.specularMap);
        }
        for (i = 0; i < len; ++i)
            this.fragmentConstantData[this.probeWeightsIndex + i] = weights[this._renderLightingPass.lightProbesOffset + i];
    };
    return ShaderLightingObject;
})(ShaderObjectBase);
module.exports = ShaderLightingObject;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9zaGFkZXJsaWdodGluZ29iamVjdC50cyJdLCJuYW1lcyI6WyJTaGFkZXJMaWdodGluZ09iamVjdCIsIlNoYWRlckxpZ2h0aW5nT2JqZWN0LmNvbnN0cnVjdG9yIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QuX2lJbmNsdWRlRGVwZW5kZW5jaWVzIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QuY3JlYXRlQ29tcGlsZXIiLCJTaGFkZXJMaWdodGluZ09iamVjdC5yZXNldCIsIlNoYWRlckxpZ2h0aW5nT2JqZWN0Ll9pUmVuZGVyIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QudXBkYXRlTGlnaHRzIiwiU2hhZGVyTGlnaHRpbmdPYmplY3QudXBkYXRlUHJvYmVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFTQSxJQUFPLFlBQVksV0FBZSwyQ0FBMkMsQ0FBQyxDQUFDO0FBRS9FLElBQU8sZ0JBQWdCLFdBQWMsMENBQTBDLENBQUMsQ0FBQztBQUtqRixJQUFPLHNCQUFzQixXQUFZLDBEQUEwRCxDQUFDLENBQUM7QUFJckcsSUFBTyxnQkFBZ0IsV0FBYyxvREFBb0QsQ0FBQyxDQUFDO0FBRzNGLEFBUUE7Ozs7Ozs7R0FERztJQUNHLG9CQUFvQjtJQUFTQSxVQUE3QkEsb0JBQW9CQSxVQUF5QkE7SUFzRWxEQTs7T0FFR0E7SUFDSEEsU0F6RUtBLG9CQUFvQkEsQ0F5RWJBLGVBQWdDQSxFQUFFQSxrQkFBc0NBLEVBQUVBLEtBQVdBO1FBRWhHQyxrQkFBTUEsZUFBZUEsRUFBRUEsa0JBQWtCQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQXZFM0NBLG9CQUFlQSxHQUFXQSxJQUFJQSxDQUFDQTtRQXlFdENBLElBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0Esa0JBQWtCQSxDQUFDQTtJQUMvQ0EsQ0FBQ0E7SUFFTUQsb0RBQXFCQSxHQUE1QkE7UUFFQ0UsSUFBSUEsQ0FBQ0EsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJB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R0FBVUEsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLElBQUlBLENBQVFBLENBQUNBO1FBQ2JBLElBQUlBLE1BQWFBLENBQUNBO1FBRWxCQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUVsREEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esd0JBQXdCQSxDQUFDQTtRQUNsQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsMEJBQTBCQSxDQUFDQTtRQUVwQ0EsSUFBSUEsSUFBSUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFDcEJBLElBQUlBLFNBQVNBLEdBQTJCQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLFdBQVdBLENBQUNBLGlCQUFpQkEsQ0FBQ0E7UUFDL0ZBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLG1CQUFtQkEsQ0FBQ0EsdUJBQXVCQSxDQUFDQTtRQUMxREEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxXQUFXQSxDQUFDQSxpQkFBaUJBLENBQUNBLE1BQU1BLENBQUNBO1FBRXBFQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsQkEsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDVEEsTUFBTUEsSUFBSUEsR0FBR0EsQ0FBQ0E7UUFDZkEsQ0FBQ0E7UUFFREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsSUFBSUEsR0FBR0EsYUFBYUEsRUFBRUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0E7WUFDckNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBO2dCQUNSQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLFdBQVdBLENBQUNBLHdCQUF3QkEsQ0FBQ0E7WUFFM0VBLEdBQUdBLEdBQUdBLFNBQVNBLENBQUNBLE1BQU1BLENBQUNBO1lBRXZCQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBO2dCQUNuQ0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQTtZQUVqQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7Z0JBQzFCQSxRQUFRQSxHQUFHQSxTQUFTQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDakNBLE1BQU1BLEdBQUdBLFFBQVFBLENBQUNBLGNBQWNBLENBQUNBO2dCQUVqQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsSUFBSUEsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0E7Z0JBQ3JDQSxJQUFJQSxDQUFDQSxRQUFRQSxJQUFJQSxRQUFRQSxDQUFDQSxVQUFVQSxDQUFDQTtnQkFDckNBLElBQUlBLENBQUNBLFFBQVFBLElBQUlBLFFBQVFBLENBQUNBLFVBQVVBLENBQUNBO2dCQUVyQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDM0JBLElBQUlBLENBQUNBLEdBQVVBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO29CQUN6QkEsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3pCQSxJQUFJQSxDQUFDQSxHQUFVQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFFekJBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2hJQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO29CQUNoSUEsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtvQkFDaklBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xDQSxDQUFDQTtnQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7b0JBQ1BBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzNDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO29CQUMzQ0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDM0NBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0Es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T0EsQ0FBQ0E7Z0JBQ1hBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLG1CQUFtQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EseUJBQXlCQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxLQUFLQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtRQUN4RkEsQ0FBQ0E7UUFFREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDdkJBLElBQUlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLGlCQUFpQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDbEhBLENBQUNBO0lBQ0ZQLDJCQUFDQTtBQUFEQSxDQTVWQSxBQTRWQ0EsRUE1VmtDLGdCQUFnQixFQTRWbEQ7QUFFRCxBQUE4QixpQkFBckIsb0JBQW9CLENBQUMiLCJmaWxlIjoiY29tcGlsYXRpb24vU2hhZGVyTGlnaHRpbmdPYmplY3QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5pbXBvcnQgRGlyZWN0aW9uYWxMaWdodFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0RpcmVjdGlvbmFsTGlnaHRcIik7XG5pbXBvcnQgTGlnaHRQcm9iZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvTGlnaHRQcm9iZVwiKTtcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0XCIpO1xuaW1wb3J0IExpZ2h0UGlja2VyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9saWdodHBpY2tlcnMvTGlnaHRQaWNrZXJCYXNlXCIpO1xuaW1wb3J0IElSZW5kZXJPYmplY3RPd25lclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0lSZW5kZXJPYmplY3RPd25lclwiKTtcbmltcG9ydCBMaWdodFNvdXJjZXNcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9MaWdodFNvdXJjZXNcIik7XG5cbmltcG9ydCBDb250ZXh0R0xQcm9maWxlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xQcm9maWxlXCIpO1xuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xuXG5pbXBvcnQgSVJlbmRlckxpZ2h0aW5nUGFzc1x0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvSVJlbmRlckxpZ2h0aW5nUGFzc1wiKTtcbmltcG9ydCBTaGFkZXJMaWdodGluZ0NvbXBpbGVyXHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJMaWdodGluZ0NvbXBpbGVyXCIpO1xuXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xuaW1wb3J0IFNoYWRlckNvbXBpbGVyQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJDb21waWxlckJhc2VcIik7XG5pbXBvcnQgU2hhZGVyT2JqZWN0QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XG5pbXBvcnQgSVJlbmRlcmFibGVDbGFzc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvSVJlbmRlcmFibGVDbGFzc1wiKTtcblxuLyoqXG4gKiBTaGFkZXJPYmplY3RCYXNlIGtlZXBzIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgZGVwZW5kZW5jaWVzIGZvciBcIm5hbWVkIHJlZ2lzdGVyc1wiIHVzZWQgYWNyb3NzIGEgcGFzcy5cbiAqIE5hbWVkIHJlZ2lzdGVycyBhcmUgdGhhdCBhcmUgbm90IG5lY2Vzc2FyaWx5IGxpbWl0ZWQgdG8gYSBzaW5nbGUgbWV0aG9kLiBUaGV5IGFyZSBjcmVhdGVkIGJ5IHRoZSBjb21waWxlciBhbmRcbiAqIHBhc3NlZCBvbiB0byBtZXRob2RzLiBUaGUgY29tcGlsZXIgdXNlcyB0aGUgcmVzdWx0cyB0byByZXNlcnZlIHVzYWdlcyB0aHJvdWdoIFJlZ2lzdGVyUG9vbCwgd2hpY2ggY2FuIGJlIHJlbW92ZWRcbiAqIGVhY2ggdGltZSBhIG1ldGhvZCBoYXMgYmVlbiBjb21waWxlZCBpbnRvIHRoZSBzaGFkZXIuXG4gKlxuICogQHNlZSBSZWdpc3RlclBvb2wuYWRkVXNhZ2VcbiAqL1xuY2xhc3MgU2hhZGVyTGlnaHRpbmdPYmplY3QgZXh0ZW5kcyBTaGFkZXJPYmplY3RCYXNlXG57XG5cdHB1YmxpYyBfcmVuZGVyTGlnaHRpbmdQYXNzOklSZW5kZXJMaWdodGluZ1Bhc3M7XG5cblx0cHJpdmF0ZSBfaW5jbHVkZUNhc3RlcnM6Ym9vbGVhbiA9IHRydWU7XG5cblx0LyoqXG5cdCAqIFRoZSBmaXJzdCBpbmRleCBmb3IgdGhlIGZyYWdtZW50IGNvbnN0YW50cyBjb250YWluaW5nIHRoZSBsaWdodCBkYXRhLlxuXHQgKi9cblx0cHVibGljIGxpZ2h0RnJhZ21lbnRDb25zdGFudEluZGV4Om51bWJlcjtcblxuXHQvKipcblx0ICogVGhlIHN0YXJ0aW5nIGluZGV4IGlmIHRoZSB2ZXJ0ZXggY29uc3RhbnQgdG8gd2hpY2ggbGlnaHQgZGF0YSBuZWVkcyB0byBiZSB1cGxvYWRlZC5cblx0ICovXG5cdHB1YmxpYyBsaWdodFZlcnRleENvbnN0YW50SW5kZXg6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2VzIGZvciB0aGUgbGlnaHQgcHJvYmUgZGlmZnVzZSB0ZXh0dXJlcy5cblx0ICovXG5cdHB1YmxpYyBsaWdodFByb2JlRGlmZnVzZUluZGljZXM6QXJyYXk8bnVtYmVyPiAvKnVpbnQqLztcblxuXHQvKipcblx0ICogSW5kaWNlcyBmb3IgdGhlIGxpZ2h0IHByb2JlIHNwZWN1bGFyIHRleHR1cmVzLlxuXHQgKi9cblx0cHVibGljIGxpZ2h0UHJvYmVTcGVjdWxhckluZGljZXM6QXJyYXk8bnVtYmVyPiAvKnVpbnQqLztcblxuXHQvKipcblx0ICogVGhlIGluZGV4IG9mIHRoZSBmcmFnbWVudCBjb25zdGFudCBjb250YWluaW5nIHRoZSB3ZWlnaHRzIGZvciB0aGUgbGlnaHQgcHJvYmVzLlxuXHQgKi9cblx0cHVibGljIHByb2JlV2VpZ2h0c0luZGV4Om51bWJlcjtcblxuXHRwdWJsaWMgbnVtTGlnaHRzOm51bWJlcjtcblx0cHVibGljIG51bURpcmVjdGlvbmFsTGlnaHRzOm51bWJlcjtcblx0cHVibGljIG51bVBvaW50TGlnaHRzOm51bWJlcjtcblx0cHVibGljIG51bUxpZ2h0UHJvYmVzOm51bWJlcjtcblxuXHRwdWJsaWMgdXNlc0xpZ2h0RmFsbE9mZjpib29sZWFuO1xuXG5cdHB1YmxpYyB1c2VzU2hhZG93czpib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc2hhZGVyIHVzZXMgYW55IGxpZ2h0cy5cblx0ICovXG5cdHB1YmxpYyB1c2VzTGlnaHRzOmJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBzaGFkZXIgdXNlcyBhbnkgbGlnaHQgcHJvYmVzLlxuXHQgKi9cblx0cHVibGljIHVzZXNQcm9iZXM6Ym9vbGVhbjtcblxuXHQvKipcblx0ICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGxpZ2h0cyB1c2VzIGFueSBzcGVjdWxhciBjb21wb25lbnRzLlxuXHQgKi9cblx0cHVibGljIHVzZXNMaWdodHNGb3JTcGVjdWxhcjpib29sZWFuO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgcHJvYmVzIHVzZXMgYW55IHNwZWN1bGFyIGNvbXBvbmVudHMuXG5cdCAqL1xuXHRwdWJsaWMgdXNlc1Byb2Jlc0ZvclNwZWN1bGFyOmJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBsaWdodHMgdXNlcyBhbnkgZGlmZnVzZSBjb21wb25lbnRzLlxuXHQgKi9cblx0cHVibGljIHVzZXNMaWdodHNGb3JEaWZmdXNlOmJvb2xlYW47XG5cblx0LyoqXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBwcm9iZXMgdXNlcyBhbnkgZGlmZnVzZSBjb21wb25lbnRzLlxuXHQgKi9cblx0cHVibGljIHVzZXNQcm9iZXNGb3JEaWZmdXNlOmJvb2xlYW47XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgTWV0aG9kQ29tcGlsZXJWTyBvYmplY3QuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcihyZW5kZXJhYmxlQ2xhc3M6SVJlbmRlcmFibGVDbGFzcywgcmVuZGVyTGlnaHRpbmdQYXNzOklSZW5kZXJMaWdodGluZ1Bhc3MsIHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0c3VwZXIocmVuZGVyYWJsZUNsYXNzLCByZW5kZXJMaWdodGluZ1Bhc3MsIHN0YWdlKTtcblxuXHRcdHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcyA9IHJlbmRlckxpZ2h0aW5nUGFzcztcblx0fVxuXG5cdHB1YmxpYyBfaUluY2x1ZGVEZXBlbmRlbmNpZXMoKVxuXHR7XG5cdFx0dGhpcy5udW1Qb2ludExpZ2h0cyA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5udW1Qb2ludExpZ2h0cztcblx0XHR0aGlzLm51bURpcmVjdGlvbmFsTGlnaHRzID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLm51bURpcmVjdGlvbmFsTGlnaHRzO1xuXHRcdHRoaXMubnVtTGlnaHRQcm9iZXMgPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubnVtTGlnaHRQcm9iZXM7XG5cblx0XHR2YXIgbnVtQWxsTGlnaHRzOm51bWJlciA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5udW1Qb2ludExpZ2h0cyArIHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5udW1EaXJlY3Rpb25hbExpZ2h0cztcblx0XHR2YXIgbnVtTGlnaHRQcm9iZXM6bnVtYmVyID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLm51bUxpZ2h0UHJvYmVzO1xuXHRcdHZhciBkaWZmdXNlTGlnaHRTb3VyY2VzOm51bWJlciA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5kaWZmdXNlTGlnaHRTb3VyY2VzO1xuXHRcdHZhciBzcGVjdWxhckxpZ2h0U291cmNlczpudW1iZXIgPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MuX2lVc2VzU3BlY3VsYXIodGhpcyk/IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5zcGVjdWxhckxpZ2h0U291cmNlcyA6IDB4MDA7XG5cdFx0dmFyIGNvbWJpbmVkTGlnaHRTb3VyY2VzOm51bWJlciA9IGRpZmZ1c2VMaWdodFNvdXJjZXMgfCBzcGVjdWxhckxpZ2h0U291cmNlcztcblxuXHRcdHRoaXMudXNlc0xpZ2h0RmFsbE9mZiA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5lbmFibGVMaWdodEZhbGxPZmYgJiYgdGhpcy5wcm9maWxlICE9IENvbnRleHRHTFByb2ZpbGUuQkFTRUxJTkVfQ09OU1RSQUlORUQ7XG5cdFx0dGhpcy5udW1MaWdodHMgPSBudW1BbGxMaWdodHMgKyBudW1MaWdodFByb2Jlcztcblx0XHR0aGlzLnVzZXNMaWdodHMgPSBudW1BbGxMaWdodHMgPiAwICYmIChjb21iaW5lZExpZ2h0U291cmNlcyAmIExpZ2h0U291cmNlcy5MSUdIVFMpICE9IDA7XG5cdFx0dGhpcy51c2VzUHJvYmVzID0gbnVtTGlnaHRQcm9iZXMgPiAwICYmIChjb21iaW5lZExpZ2h0U291cmNlcyAmIExpZ2h0U291cmNlcy5QUk9CRVMpICE9IDA7XG5cdFx0dGhpcy51c2VzTGlnaHRzRm9yU3BlY3VsYXIgPSBudW1BbGxMaWdodHMgPiAwICYmIChzcGVjdWxhckxpZ2h0U291cmNlcyAmIExpZ2h0U291cmNlcy5MSUdIVFMpICE9IDA7XG5cdFx0dGhpcy51c2VzUHJvYmVzRm9yU3BlY3VsYXIgPSBudW1MaWdodFByb2JlcyA+IDAgJiYgKHNwZWN1bGFyTGlnaHRTb3VyY2VzICYgTGlnaHRTb3VyY2VzLlBST0JFUykgIT0gMDtcblx0XHR0aGlzLnVzZXNMaWdodHNGb3JEaWZmdXNlID0gbnVtQWxsTGlnaHRzID4gMCAmJiAoZGlmZnVzZUxpZ2h0U291cmNlcyAmIExpZ2h0U291cmNlcy5MSUdIVFMpICE9IDA7XG5cdFx0dGhpcy51c2VzUHJvYmVzRm9yRGlmZnVzZSA9IG51bUxpZ2h0UHJvYmVzID4gMCAmJiAoZGlmZnVzZUxpZ2h0U291cmNlcyAmIExpZ2h0U291cmNlcy5QUk9CRVMpICE9IDA7XG5cdFx0dGhpcy51c2VzU2hhZG93cyA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5faVVzZXNTaGFkb3dzKHRoaXMpO1xuXG5cdFx0Ly9JTVBPUlRBTlQgdGhpcyBtdXN0IG9jY3VyIGFmdGVyIHNoYWRlciBsaWdodGluZyBpbml0aWFsaXNhdGlvbiBhYm92ZVxuXHRcdHN1cGVyLl9pSW5jbHVkZURlcGVuZGVuY2llcygpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZhY3RvcnkgbWV0aG9kIHRvIGNyZWF0ZSBhIGNvbmNyZXRlIGNvbXBpbGVyIG9iamVjdCBmb3IgdGhpcyBvYmplY3Rcblx0ICpcblx0ICogQHBhcmFtIG1hdGVyaWFsUGFzc1ZPXG5cdCAqIEByZXR1cm5zIHthd2F5Lm1hdGVyaWFscy5TaGFkZXJMaWdodGluZ0NvbXBpbGVyfVxuXHQgKi9cblx0cHVibGljIGNyZWF0ZUNvbXBpbGVyKHJlbmRlcmFibGVDbGFzczpJUmVuZGVyYWJsZUNsYXNzLCByZW5kZXJQYXNzOklSZW5kZXJMaWdodGluZ1Bhc3MpOlNoYWRlckNvbXBpbGVyQmFzZVxuXHR7XG5cdFx0cmV0dXJuIG5ldyBTaGFkZXJMaWdodGluZ0NvbXBpbGVyKHJlbmRlcmFibGVDbGFzcywgcmVuZGVyUGFzcywgdGhpcyk7XG5cdH1cblxuXHQvKipcblx0ICogQ2xlYXJzIGRlcGVuZGVuY3kgY291bnRzIGZvciBhbGwgcmVnaXN0ZXJzLiBDYWxsZWQgd2hlbiByZWNvbXBpbGluZyBhIHBhc3MuXG5cdCAqL1xuXHRwdWJsaWMgcmVzZXQoKVxuXHR7XG5cdFx0c3VwZXIucmVzZXQoKTtcblxuXHRcdHRoaXMubnVtTGlnaHRzID0gMDtcblx0XHR0aGlzLnVzZXNMaWdodEZhbGxPZmYgPSB0cnVlO1xuXHR9XG5cblxuXHQvKipcblx0ICpcblx0ICpcblx0ICogQHBhcmFtIHJlbmRlcmFibGVcblx0ICogQHBhcmFtIHN0YWdlXG5cdCAqIEBwYXJhbSBjYW1lcmFcblx0ICovXG5cdHB1YmxpYyBfaVJlbmRlcihyZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBjYW1lcmE6Q2FtZXJhLCB2aWV3UHJvamVjdGlvbjpNYXRyaXgzRClcblx0e1xuXHRcdHN1cGVyLl9pUmVuZGVyKHJlbmRlcmFibGUsIGNhbWVyYSwgdmlld1Byb2plY3Rpb24pO1xuXG5cdFx0aWYgKHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFBpY2tlcilcblx0XHRcdHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFBpY2tlci5jb2xsZWN0TGlnaHRzKHJlbmRlcmFibGUpO1xuXG5cdFx0aWYgKHRoaXMudXNlc0xpZ2h0cylcblx0XHRcdHRoaXMudXBkYXRlTGlnaHRzKCk7XG5cblx0XHRpZiAodGhpcy51c2VzUHJvYmVzKVxuXHRcdFx0dGhpcy51cGRhdGVQcm9iZXMoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBVcGRhdGVzIGNvbnN0YW50IGRhdGEgcmVuZGVyIHN0YXRlIHVzZWQgYnkgdGhlIGxpZ2h0cy4gVGhpcyBtZXRob2QgaXMgb3B0aW9uYWwgZm9yIHN1YmNsYXNzZXMgdG8gaW1wbGVtZW50LlxuXHQgKi9cblx0cHJpdmF0ZSB1cGRhdGVMaWdodHMoKVxuXHR7XG5cdFx0dmFyIGRpckxpZ2h0OkRpcmVjdGlvbmFsTGlnaHQ7XG5cdFx0dmFyIHBvaW50TGlnaHQ6UG9pbnRMaWdodDtcblx0XHR2YXIgaTpudW1iZXIgPSAwO1xuXHRcdHZhciBrOm51bWJlciA9IDA7XG5cdFx0dmFyIGxlbjpudW1iZXI7XG5cdFx0dmFyIGRpclBvczpWZWN0b3IzRDtcblx0XHR2YXIgdG90YWw6bnVtYmVyID0gMDtcblx0XHR2YXIgbnVtTGlnaHRUeXBlczpudW1iZXIgPSB0aGlzLnVzZXNTaGFkb3dzPyAyIDogMTtcblx0XHR2YXIgbDpudW1iZXI7XG5cdFx0dmFyIG9mZnNldDpudW1iZXI7XG5cblx0XHR0aGlzLmFtYmllbnRSID0gdGhpcy5hbWJpZW50RyA9IHRoaXMuYW1iaWVudEIgPSAwO1xuXG5cdFx0bCA9IHRoaXMubGlnaHRWZXJ0ZXhDb25zdGFudEluZGV4O1xuXHRcdGsgPSB0aGlzLmxpZ2h0RnJhZ21lbnRDb25zdGFudEluZGV4O1xuXG5cdFx0dmFyIGNhc3Q6bnVtYmVyID0gMDtcblx0XHR2YXIgZGlyTGlnaHRzOkFycmF5PERpcmVjdGlvbmFsTGlnaHQ+ID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLmRpcmVjdGlvbmFsTGlnaHRzO1xuXHRcdG9mZnNldCA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5kaXJlY3Rpb25hbExpZ2h0c09mZnNldDtcblx0XHRsZW4gPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubGlnaHRQaWNrZXIuZGlyZWN0aW9uYWxMaWdodHMubGVuZ3RoO1xuXG5cdFx0aWYgKG9mZnNldCA+IGxlbikge1xuXHRcdFx0Y2FzdCA9IDE7XG5cdFx0XHRvZmZzZXQgLT0gbGVuO1xuXHRcdH1cblxuXHRcdGZvciAoOyBjYXN0IDwgbnVtTGlnaHRUeXBlczsgKytjYXN0KSB7XG5cdFx0XHRpZiAoY2FzdClcblx0XHRcdFx0ZGlyTGlnaHRzID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLmNhc3RpbmdEaXJlY3Rpb25hbExpZ2h0cztcblxuXHRcdFx0bGVuID0gZGlyTGlnaHRzLmxlbmd0aDtcblxuXHRcdFx0aWYgKGxlbiA+IHRoaXMubnVtRGlyZWN0aW9uYWxMaWdodHMpXG5cdFx0XHRcdGxlbiA9IHRoaXMubnVtRGlyZWN0aW9uYWxMaWdodHM7XG5cblx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0XHRkaXJMaWdodCA9IGRpckxpZ2h0c1tvZmZzZXQgKyBpXTtcblx0XHRcdFx0ZGlyUG9zID0gZGlyTGlnaHQuc2NlbmVEaXJlY3Rpb247XG5cblx0XHRcdFx0dGhpcy5hbWJpZW50UiArPSBkaXJMaWdodC5faUFtYmllbnRSO1xuXHRcdFx0XHR0aGlzLmFtYmllbnRHICs9IGRpckxpZ2h0Ll9pQW1iaWVudEc7XG5cdFx0XHRcdHRoaXMuYW1iaWVudEIgKz0gZGlyTGlnaHQuX2lBbWJpZW50QjtcblxuXHRcdFx0XHRpZiAodGhpcy51c2VzVGFuZ2VudFNwYWNlKSB7XG5cdFx0XHRcdFx0dmFyIHg6bnVtYmVyID0gLWRpclBvcy54O1xuXHRcdFx0XHRcdHZhciB5Om51bWJlciA9IC1kaXJQb3MueTtcblx0XHRcdFx0XHR2YXIgejpudW1iZXIgPSAtZGlyUG9zLno7XG5cblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFswXSp4ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs0XSp5ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs4XSp6O1xuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzFdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzVdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzldKno7XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMl0qeCArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbNl0qeSArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMTBdKno7XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IDE7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gLWRpclBvcy54O1xuXHRcdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IC1kaXJQb3MueTtcblx0XHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSAtZGlyUG9zLno7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gMTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pRGlmZnVzZVI7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pRGlmZnVzZUc7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pRGlmZnVzZUI7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IDE7XG5cblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyTGlnaHQuX2lTcGVjdWxhclI7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IGRpckxpZ2h0Ll9pU3BlY3VsYXJHO1xuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBkaXJMaWdodC5faVNwZWN1bGFyQjtcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gMTtcblxuXHRcdFx0XHRpZiAoKyt0b3RhbCA9PSB0aGlzLm51bURpcmVjdGlvbmFsTGlnaHRzKSB7XG5cdFx0XHRcdFx0Ly8gYnJlYWsgbG9vcFxuXHRcdFx0XHRcdGkgPSBsZW47XG5cdFx0XHRcdFx0Y2FzdCA9IG51bUxpZ2h0VHlwZXM7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBtb3JlIGRpcmVjdGlvbmFsIHN1cHBvcnRlZCB0aGFuIGN1cnJlbnRseSBwaWNrZWQsIG5lZWQgdG8gY2xhbXAgYWxsIHRvIDBcblx0XHRpZiAodGhpcy5udW1EaXJlY3Rpb25hbExpZ2h0cyA+IHRvdGFsKSB7XG5cdFx0XHRpID0gayArICh0aGlzLm51bURpcmVjdGlvbmFsTGlnaHRzIC0gdG90YWwpKjEyO1xuXG5cdFx0XHR3aGlsZSAoayA8IGkpXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IDA7XG5cdFx0fVxuXG5cdFx0dG90YWwgPSAwO1xuXG5cdFx0dmFyIHBvaW50TGlnaHRzOkFycmF5PFBvaW50TGlnaHQ+ID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLnBvaW50TGlnaHRzO1xuXHRcdG9mZnNldCA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5wb2ludExpZ2h0c09mZnNldDtcblx0XHRsZW4gPSB0aGlzLl9yZW5kZXJMaWdodGluZ1Bhc3MubGlnaHRQaWNrZXIucG9pbnRMaWdodHMubGVuZ3RoO1xuXG5cdFx0aWYgKG9mZnNldCA+IGxlbikge1xuXHRcdFx0Y2FzdCA9IDE7XG5cdFx0XHRvZmZzZXQgLT0gbGVuO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYXN0ID0gMDtcblx0XHR9XG5cblx0XHRmb3IgKDsgY2FzdCA8IG51bUxpZ2h0VHlwZXM7ICsrY2FzdCkge1xuXHRcdFx0aWYgKGNhc3QpXG5cdFx0XHRcdHBvaW50TGlnaHRzID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLmNhc3RpbmdQb2ludExpZ2h0cztcblxuXHRcdFx0bGVuID0gcG9pbnRMaWdodHMubGVuZ3RoO1xuXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcblx0XHRcdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRzW29mZnNldCArIGldO1xuXHRcdFx0XHRkaXJQb3MgPSBwb2ludExpZ2h0LnNjZW5lUG9zaXRpb247XG5cblx0XHRcdFx0dGhpcy5hbWJpZW50UiArPSBwb2ludExpZ2h0Ll9pQW1iaWVudFI7XG5cdFx0XHRcdHRoaXMuYW1iaWVudEcgKz0gcG9pbnRMaWdodC5faUFtYmllbnRHO1xuXHRcdFx0XHR0aGlzLmFtYmllbnRCICs9IHBvaW50TGlnaHQuX2lBbWJpZW50QjtcblxuXHRcdFx0XHRpZiAodGhpcy51c2VzVGFuZ2VudFNwYWNlKSB7XG5cdFx0XHRcdFx0eCA9IGRpclBvcy54O1xuXHRcdFx0XHRcdHkgPSBkaXJQb3MueTtcblx0XHRcdFx0XHR6ID0gZGlyUG9zLno7XG5cblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFswXSp4ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs0XSp5ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFs4XSp6ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxMl07XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMV0qeCArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbNV0qeSArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbOV0qeiArIHRoaXMuX3BJbnZlcnNlU2NlbmVNYXRyaXhbMTNdO1xuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzJdKnggKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzZdKnkgKyB0aGlzLl9wSW52ZXJzZVNjZW5lTWF0cml4WzEwXSp6ICsgdGhpcy5fcEludmVyc2VTY2VuZU1hdHJpeFsxNF07XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IDE7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIXRoaXMudXNlc0dsb2JhbFBvc0ZyYWdtZW50KSB7XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IGRpclBvcy54O1xuXHRcdFx0XHRcdHRoaXMudmVydGV4Q29uc3RhbnREYXRhW2wrK10gPSBkaXJQb3MueTtcblx0XHRcdFx0XHR0aGlzLnZlcnRleENvbnN0YW50RGF0YVtsKytdID0gZGlyUG9zLno7XG5cdFx0XHRcdFx0dGhpcy52ZXJ0ZXhDb25zdGFudERhdGFbbCsrXSA9IDE7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyUG9zLng7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyUG9zLnk7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gZGlyUG9zLno7XG5cdFx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gMTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lEaWZmdXNlUjtcblx0XHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVtrKytdID0gcG9pbnRMaWdodC5faURpZmZ1c2VHO1xuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSBwb2ludExpZ2h0Ll9pRGlmZnVzZUI7XG5cblx0XHRcdFx0dmFyIHJhZGl1czpudW1iZXIgPSBwb2ludExpZ2h0Ll9wUmFkaXVzO1xuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2srK10gPSByYWRpdXMqcmFkaXVzO1xuXG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lTcGVjdWxhclI7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lTcGVjdWxhckc7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX2lTcGVjdWxhckI7XG5cdFx0XHRcdHRoaXMuZnJhZ21lbnRDb25zdGFudERhdGFbaysrXSA9IHBvaW50TGlnaHQuX3BGYWxsT2ZmRmFjdG9yO1xuXG5cdFx0XHRcdGlmICgrK3RvdGFsID09IHRoaXMubnVtUG9pbnRMaWdodHMpIHtcblx0XHRcdFx0XHQvLyBicmVhayBsb29wXG5cdFx0XHRcdFx0aSA9IGxlbjtcblx0XHRcdFx0XHRjYXN0ID0gbnVtTGlnaHRUeXBlcztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIG1vcmUgZGlyZWN0aW9uYWwgc3VwcG9ydGVkIHRoYW4gY3VycmVudGx5IHBpY2tlZCwgbmVlZCB0byBjbGFtcCBhbGwgdG8gMFxuXHRcdGlmICh0aGlzLm51bVBvaW50TGlnaHRzID4gdG90YWwpIHtcblx0XHRcdGkgPSBrICsgKHRvdGFsIC0gdGhpcy5udW1Qb2ludExpZ2h0cykqMTI7XG5cblx0XHRcdGZvciAoOyBrIDwgaTsgKytrKVxuXHRcdFx0XHR0aGlzLmZyYWdtZW50Q29uc3RhbnREYXRhW2tdID0gMDtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVXBkYXRlcyBjb25zdGFudCBkYXRhIHJlbmRlciBzdGF0ZSB1c2VkIGJ5IHRoZSBsaWdodCBwcm9iZXMuIFRoaXMgbWV0aG9kIGlzIG9wdGlvbmFsIGZvciBzdWJjbGFzc2VzIHRvIGltcGxlbWVudC5cblx0ICovXG5cdHByaXZhdGUgdXBkYXRlUHJvYmVzKClcblx0e1xuXHRcdHZhciBwcm9iZTpMaWdodFByb2JlO1xuXHRcdHZhciBsaWdodFByb2JlczpBcnJheTxMaWdodFByb2JlPiA9IHRoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFBpY2tlci5saWdodFByb2Jlcztcblx0XHR2YXIgd2VpZ2h0czpBcnJheTxudW1iZXI+ID0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UGlja2VyLmxpZ2h0UHJvYmVXZWlnaHRzO1xuXHRcdHZhciBsZW46bnVtYmVyID0gbGlnaHRQcm9iZXMubGVuZ3RoIC0gdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UHJvYmVzT2Zmc2V0O1xuXHRcdHZhciBhZGREaWZmOmJvb2xlYW4gPSB0aGlzLnVzZXNQcm9iZXNGb3JEaWZmdXNlO1xuXHRcdHZhciBhZGRTcGVjOmJvb2xlYW4gPSB0aGlzLnVzZXNQcm9iZXNGb3JTcGVjdWxhcjtcblxuXHRcdGlmICghKGFkZERpZmYgfHwgYWRkU3BlYykpXG5cdFx0XHRyZXR1cm47XG5cblx0XHRpZiAobGVuID4gdGhpcy5udW1MaWdodFByb2Jlcylcblx0XHRcdGxlbiA9IHRoaXMubnVtTGlnaHRQcm9iZXM7XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBsZW47ICsraSkge1xuXHRcdFx0cHJvYmUgPSBsaWdodFByb2Jlc1sgdGhpcy5fcmVuZGVyTGlnaHRpbmdQYXNzLmxpZ2h0UHJvYmVzT2Zmc2V0ICsgaV07XG5cblx0XHRcdGlmIChhZGREaWZmKVxuXHRcdFx0XHR0aGlzLl9zdGFnZS5hY3RpdmF0ZUN1YmVUZXh0dXJlKHRoaXMubGlnaHRQcm9iZURpZmZ1c2VJbmRpY2VzW2ldLCBwcm9iZS5kaWZmdXNlTWFwKTtcblxuXHRcdFx0aWYgKGFkZFNwZWMpXG5cdFx0XHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQ3ViZVRleHR1cmUodGhpcy5saWdodFByb2JlU3BlY3VsYXJJbmRpY2VzW2ldLCBwcm9iZS5zcGVjdWxhck1hcCk7XG5cdFx0fVxuXG5cdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgKytpKVxuXHRcdFx0dGhpcy5mcmFnbWVudENvbnN0YW50RGF0YVt0aGlzLnByb2JlV2VpZ2h0c0luZGV4ICsgaV0gPSB3ZWlnaHRzW3RoaXMuX3JlbmRlckxpZ2h0aW5nUGFzcy5saWdodFByb2Jlc09mZnNldCArIGldO1xuXHR9XG59XG5cbmV4cG9ydCA9IFNoYWRlckxpZ2h0aW5nT2JqZWN0OyJdfQ==