var Event = require("awayjs-core/lib/events/Event");
var AssetType = require("awayjs-core/lib/library/AssetType");
/**
 *
 * @class away.pool.ScreenPasses
 */
var RenderObjectBase = (function () {
    function RenderObjectBase(pool, renderObjectOwner, renderableClass, stage) {
        var _this = this;
        this._forceSeparateMVP = false;
        this._invalidAnimation = true;
        this._invalidRenderObject = true;
        this._passes = new Array();
        this._pRequiresBlending = false;
        this._pool = pool;
        this.renderObjectId = renderObjectOwner.id;
        this._renderObjectOwner = renderObjectOwner;
        this._renderableClass = renderableClass;
        this._stage = stage;
        this._onPassChangeDelegate = function (event) { return _this.onPassChange(event); };
    }
    Object.defineProperty(RenderObjectBase.prototype, "requiresBlending", {
        /**
         * Indicates whether or not the renderable requires alpha blending during rendering.
         */
        get: function () {
            return this._pRequiresBlending;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RenderObjectBase.prototype, "renderOrderId", {
        get: function () {
            if (this._invalidAnimation)
                this._updateAnimation();
            return this._renderOrderId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RenderObjectBase.prototype, "passes", {
        get: function () {
            if (this._invalidAnimation)
                this._updateAnimation();
            return this._passes;
        },
        enumerable: true,
        configurable: true
    });
    RenderObjectBase.prototype._iIncludeDependencies = function (shaderObject) {
        shaderObject.alphaThreshold = this._renderObjectOwner.alphaThreshold;
        shaderObject.useMipmapping = this._renderObjectOwner.mipmap;
        shaderObject.useSmoothTextures = this._renderObjectOwner.smooth;
        if (this._renderObjectOwner.assetType = AssetType.MATERIAL) {
            var material = this._renderObjectOwner;
            shaderObject.useAlphaPremultiplied = material.alphaPremultiplied;
            shaderObject.useBothSides = material.bothSides;
            shaderObject.repeatTextures = material.repeat;
            shaderObject.usesUVTransform = material.animateUVs;
            shaderObject.texture = material.texture;
            shaderObject.color = material.color;
        }
    };
    /**
     *
     */
    RenderObjectBase.prototype.dispose = function () {
        this._pClearScreenPasses();
        var len = this._passes.length;
        for (var i = 0; i < len; i++)
            this._passes[i].dispose();
        this._passes = null;
        this._pool.disposeItem(this._renderObjectOwner);
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidateRenderObject = function () {
        this._invalidRenderObject = true;
        this._invalidAnimation = true;
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidatePasses = function () {
        var len = this._passes.length;
        for (var i = 0; i < len; i++)
            this._passes[i].invalidatePass();
        this._invalidAnimation = true;
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidateAnimation = function () {
        this._invalidAnimation = true;
    };
    /**
     *
     * @param renderObjectOwner
     */
    RenderObjectBase.prototype._updateAnimation = function () {
        if (this._invalidRenderObject)
            this._pUpdateRenderObject();
        this._invalidAnimation = false;
        var enabledGPUAnimation = this._getEnabledGPUAnimation();
        var renderOrderId = 0;
        var mult = 1;
        var shaderObject;
        var len = this._passes.length;
        for (var i = 0; i < len; i++) {
            shaderObject = this._passes[i].shader;
            if (shaderObject.usesAnimation != enabledGPUAnimation) {
                shaderObject.usesAnimation = enabledGPUAnimation;
                shaderObject.invalidateProgram();
            }
            renderOrderId += shaderObject.programData.id * mult;
            mult *= 1000;
        }
        this._renderOrderId = renderOrderId;
    };
    /**
     * Performs any processing that needs to occur before any of its passes are used.
     *
     * @private
     */
    RenderObjectBase.prototype._pUpdateRenderObject = function () {
        this._invalidRenderObject = false;
        //overrride to update shader object properties
    };
    /**
     * Removes a pass from the renderObjectOwner.
     * @param pass The pass to be removed.
     */
    RenderObjectBase.prototype._pRemoveScreenPass = function (pass) {
        pass.removeEventListener(Event.CHANGE, this._onPassChangeDelegate);
        this._passes.splice(this._passes.indexOf(pass), 1);
    };
    /**
     * Removes all passes from the renderObjectOwner
     */
    RenderObjectBase.prototype._pClearScreenPasses = function () {
        var len = this._passes.length;
        for (var i = 0; i < len; ++i)
            this._passes[i].removeEventListener(Event.CHANGE, this._onPassChangeDelegate);
        this._passes.length = 0;
    };
    /**
     * Adds a pass to the renderObjectOwner
     * @param pass
     */
    RenderObjectBase.prototype._pAddScreenPass = function (pass) {
        this._passes.push(pass);
        pass.addEventListener(Event.CHANGE, this._onPassChangeDelegate);
    };
    /**
     * Listener for when a pass's shader code changes. It recalculates the render order id.
     */
    RenderObjectBase.prototype.onPassChange = function (event) {
        this.invalidateAnimation();
    };
    /**
     * test if animation will be able to run on gpu BEFORE compiling materials
     * test if the shader objects supports animating the animation set in the vertex shader
     * if any object using this material fails to support accelerated animations for any of the shader objects,
     * we should do everything on cpu (otherwise we have the cost of both gpu + cpu animations)
     */
    RenderObjectBase.prototype._getEnabledGPUAnimation = function () {
        if (this._renderObjectOwner.animationSet) {
            this._renderObjectOwner.animationSet.resetGPUCompatibility();
            var owners = this._renderObjectOwner.iOwners;
            var numOwners = owners.length;
            var len = this._passes.length;
            for (var i = 0; i < len; i++)
                for (var j = 0; j < numOwners; j++)
                    if (owners[j].animator)
                        owners[j].animator.testGPUCompatibility(this._passes[i].shader);
            return !this._renderObjectOwner.animationSet.usesCPU;
        }
        return false;
    };
    return RenderObjectBase;
})();
module.exports = RenderObjectBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9yZW5kZXJvYmplY3RiYXNlLnRzIl0sIm5hbWVzIjpbIlJlbmRlck9iamVjdEJhc2UiLCJSZW5kZXJPYmplY3RCYXNlLmNvbnN0cnVjdG9yIiwiUmVuZGVyT2JqZWN0QmFzZS5yZXF1aXJlc0JsZW5kaW5nIiwiUmVuZGVyT2JqZWN0QmFzZS5yZW5kZXJPcmRlcklkIiwiUmVuZGVyT2JqZWN0QmFzZS5wYXNzZXMiLCJSZW5kZXJPYmplY3RCYXNlLl9pSW5jbHVkZURlcGVuZGVuY2llcyIsIlJlbmRlck9iamVjdEJhc2UuZGlzcG9zZSIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZVJlbmRlck9iamVjdCIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZVBhc3NlcyIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZUFuaW1hdGlvbiIsIlJlbmRlck9iamVjdEJhc2UuX3VwZGF0ZUFuaW1hdGlvbiIsIlJlbmRlck9iamVjdEJhc2UuX3BVcGRhdGVSZW5kZXJPYmplY3QiLCJSZW5kZXJPYmplY3RCYXNlLl9wUmVtb3ZlU2NyZWVuUGFzcyIsIlJlbmRlck9iamVjdEJhc2UuX3BDbGVhclNjcmVlblBhc3NlcyIsIlJlbmRlck9iamVjdEJhc2UuX3BBZGRTY3JlZW5QYXNzIiwiUmVuZGVyT2JqZWN0QmFzZS5vblBhc3NDaGFuZ2UiLCJSZW5kZXJPYmplY3RCYXNlLl9nZXRFbmFibGVkR1BVQW5pbWF0aW9uIl0sIm1hcHBpbmdzIjoiQUFDQSxJQUFPLEtBQUssV0FBZ0IsOEJBQThCLENBQUMsQ0FBQztBQUM1RCxJQUFPLFNBQVMsV0FBZSxtQ0FBbUMsQ0FBQyxDQUFDO0FBbUJwRSxBQUlBOzs7R0FERztJQUNHLGdCQUFnQjtJQThDckJBLFNBOUNLQSxnQkFBZ0JBLENBOENUQSxJQUFxQkEsRUFBRUEsaUJBQW9DQSxFQUFFQSxlQUFnQ0EsRUFBRUEsS0FBV0E7UUE5Q3ZIQyxpQkFzT0NBO1FBcE9P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Q0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFFcEZBLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7UUFDdERBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBO0lBQ2RBLENBQUNBO0lBQ0ZoQix1QkFBQ0E7QUFBREEsQ0F0T0EsQUFzT0NBLElBQUE7QUFFRCxBQUEwQixpQkFBakIsZ0JBQWdCLENBQUMiLCJmaWxlIjoiY29tcGlsYXRpb24vUmVuZGVyT2JqZWN0QmFzZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBFdmVudFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnRcIik7XG5pbXBvcnQgQXNzZXRUeXBlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0Fzc2V0VHlwZVwiKTtcblxuaW1wb3J0IElSZW5kZXJPYmplY3RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wb29sL0lSZW5kZXJPYmplY3RcIik7XG5pbXBvcnQgSVJlbmRlck9iamVjdE93bmVyXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVJlbmRlck9iamVjdE93bmVyXCIpO1xuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5pbXBvcnQgSVJlbmRlcmFibGVPd25lclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVJlbmRlcmFibGVPd25lclwiKTtcbmltcG9ydCBNYXRlcmlhbEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9NYXRlcmlhbEJhc2VcIik7XG5cbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuXG5pbXBvcnQgQW5pbWF0b3JCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvQW5pbWF0b3JCYXNlXCIpO1xuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJDYWNoZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xuaW1wb3J0IFJlbmRlck9iamVjdFBvb2xcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9SZW5kZXJPYmplY3RQb29sXCIpO1xuaW1wb3J0IFJlbmRlclBhc3NCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcGFzc2VzL1JlbmRlclBhc3NCYXNlXCIpO1xuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcbmltcG9ydCBJUmVuZGVyYWJsZUNsYXNzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9JUmVuZGVyYWJsZUNsYXNzXCIpO1xuXG4vKipcbiAqXG4gKiBAY2xhc3MgYXdheS5wb29sLlNjcmVlblBhc3Nlc1xuICovXG5jbGFzcyBSZW5kZXJPYmplY3RCYXNlIGltcGxlbWVudHMgSVJlbmRlck9iamVjdFxue1xuXHRwdWJsaWMgX2ZvcmNlU2VwYXJhdGVNVlA6Ym9vbGVhbiA9IGZhbHNlO1xuXG5cdHByaXZhdGUgX3Bvb2w6UmVuZGVyT2JqZWN0UG9vbDtcblx0cHVibGljIF9yZW5kZXJPYmplY3RPd25lcjpJUmVuZGVyT2JqZWN0T3duZXI7XG5cdHB1YmxpYyBfcmVuZGVyYWJsZUNsYXNzOklSZW5kZXJhYmxlQ2xhc3M7XG5cdHB1YmxpYyBfc3RhZ2U6U3RhZ2U7XG5cblx0cHJpdmF0ZSBfcmVuZGVyT3JkZXJJZDpudW1iZXI7XG5cdHByaXZhdGUgX2ludmFsaWRBbmltYXRpb246Ym9vbGVhbiA9IHRydWU7XG5cdHByaXZhdGUgX2ludmFsaWRSZW5kZXJPYmplY3Q6Ym9vbGVhbiA9IHRydWU7XG5cdHByaXZhdGUgX3Bhc3NlczpBcnJheTxSZW5kZXJQYXNzQmFzZT4gPSBuZXcgQXJyYXk8UmVuZGVyUGFzc0Jhc2U+KCk7XG5cblxuXG5cdHB1YmxpYyBfcFJlcXVpcmVzQmxlbmRpbmc6Ym9vbGVhbiA9IGZhbHNlO1xuXG5cdHByaXZhdGUgX29uUGFzc0NoYW5nZURlbGVnYXRlOihldmVudDpFdmVudCkgPT4gdm9pZDtcblxuXHRwdWJsaWMgcmVuZGVyT2JqZWN0SWQ6bnVtYmVyO1xuXG5cdC8qKlxuXHQgKiBJbmRpY2F0ZXMgd2hldGhlciBvciBub3QgdGhlIHJlbmRlcmFibGUgcmVxdWlyZXMgYWxwaGEgYmxlbmRpbmcgZHVyaW5nIHJlbmRlcmluZy5cblx0ICovXG5cdHB1YmxpYyBnZXQgcmVxdWlyZXNCbGVuZGluZygpOmJvb2xlYW5cblx0e1xuXHRcdHJldHVybiB0aGlzLl9wUmVxdWlyZXNCbGVuZGluZztcblx0fVxuXG5cdHB1YmxpYyBnZXQgcmVuZGVyT3JkZXJJZCgpOm51bWJlclxuXHR7XG5cdFx0aWYgKHRoaXMuX2ludmFsaWRBbmltYXRpb24pXG5cdFx0XHR0aGlzLl91cGRhdGVBbmltYXRpb24oKTtcblxuXHRcdHJldHVybiB0aGlzLl9yZW5kZXJPcmRlcklkO1xuXHR9XG5cblx0cHVibGljIGdldCBwYXNzZXMoKTpBcnJheTxSZW5kZXJQYXNzQmFzZT5cblx0e1xuXHRcdGlmICh0aGlzLl9pbnZhbGlkQW5pbWF0aW9uKVxuXHRcdFx0dGhpcy5fdXBkYXRlQW5pbWF0aW9uKCk7XG5cblx0XHRyZXR1cm4gdGhpcy5fcGFzc2VzO1xuXHR9XG5cblx0Y29uc3RydWN0b3IocG9vbDpSZW5kZXJPYmplY3RQb29sLCByZW5kZXJPYmplY3RPd25lcjpJUmVuZGVyT2JqZWN0T3duZXIsIHJlbmRlcmFibGVDbGFzczpJUmVuZGVyYWJsZUNsYXNzLCBzdGFnZTpTdGFnZSlcblx0e1xuXHRcdHRoaXMuX3Bvb2wgPSBwb29sO1xuXHRcdHRoaXMucmVuZGVyT2JqZWN0SWQgPSByZW5kZXJPYmplY3RPd25lci5pZDtcblx0XHR0aGlzLl9yZW5kZXJPYmplY3RPd25lciA9IHJlbmRlck9iamVjdE93bmVyO1xuXHRcdHRoaXMuX3JlbmRlcmFibGVDbGFzcyA9IHJlbmRlcmFibGVDbGFzcztcblx0XHR0aGlzLl9zdGFnZSA9IHN0YWdlO1xuXG5cblx0XHR0aGlzLl9vblBhc3NDaGFuZ2VEZWxlZ2F0ZSA9IChldmVudDpFdmVudCkgPT4gdGhpcy5vblBhc3NDaGFuZ2UoZXZlbnQpO1xuXHR9XG5cblx0cHVibGljIF9pSW5jbHVkZURlcGVuZGVuY2llcyhzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSlcblx0e1xuXHRcdHNoYWRlck9iamVjdC5hbHBoYVRocmVzaG9sZCA9IHRoaXMuX3JlbmRlck9iamVjdE93bmVyLmFscGhhVGhyZXNob2xkO1xuXHRcdHNoYWRlck9iamVjdC51c2VNaXBtYXBwaW5nID0gdGhpcy5fcmVuZGVyT2JqZWN0T3duZXIubWlwbWFwO1xuXHRcdHNoYWRlck9iamVjdC51c2VTbW9vdGhUZXh0dXJlcyA9IHRoaXMuX3JlbmRlck9iamVjdE93bmVyLnNtb290aDtcblxuXHRcdGlmICh0aGlzLl9yZW5kZXJPYmplY3RPd25lci5hc3NldFR5cGUgPSBBc3NldFR5cGUuTUFURVJJQUwpIHtcblx0XHRcdHZhciBtYXRlcmlhbDpNYXRlcmlhbEJhc2UgPSA8TWF0ZXJpYWxCYXNlPiB0aGlzLl9yZW5kZXJPYmplY3RPd25lcjtcblx0XHRcdHNoYWRlck9iamVjdC51c2VBbHBoYVByZW11bHRpcGxpZWQgPSBtYXRlcmlhbC5hbHBoYVByZW11bHRpcGxpZWQ7XG5cdFx0XHRzaGFkZXJPYmplY3QudXNlQm90aFNpZGVzID0gbWF0ZXJpYWwuYm90aFNpZGVzO1xuXHRcdFx0c2hhZGVyT2JqZWN0LnJlcGVhdFRleHR1cmVzID0gbWF0ZXJpYWwucmVwZWF0O1xuXHRcdFx0c2hhZGVyT2JqZWN0LnVzZXNVVlRyYW5zZm9ybSA9IG1hdGVyaWFsLmFuaW1hdGVVVnM7XG5cdFx0XHRzaGFkZXJPYmplY3QudGV4dHVyZSA9IG1hdGVyaWFsLnRleHR1cmU7XG5cdFx0XHRzaGFkZXJPYmplY3QuY29sb3IgPSBtYXRlcmlhbC5jb2xvcjtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBkaXNwb3NlKClcblx0e1xuXHRcdHRoaXMuX3BDbGVhclNjcmVlblBhc3NlcygpO1xuXG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgaSsrKVxuXHRcdFx0dGhpcy5fcGFzc2VzW2ldLmRpc3Bvc2UoKTtcblxuXHRcdHRoaXMuX3Bhc3NlcyA9IG51bGw7XG5cblx0XHR0aGlzLl9wb29sLmRpc3Bvc2VJdGVtKHRoaXMuX3JlbmRlck9iamVjdE93bmVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGludmFsaWRhdGVSZW5kZXJPYmplY3QoKVxuXHR7XG5cdFx0dGhpcy5faW52YWxpZFJlbmRlck9iamVjdCA9IHRydWU7XG5cdFx0dGhpcy5faW52YWxpZEFuaW1hdGlvbiA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBpbnZhbGlkYXRlUGFzc2VzKClcblx0e1xuXHRcdHZhciBsZW46bnVtYmVyID0gdGhpcy5fcGFzc2VzLmxlbmd0aDtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBsZW47IGkrKylcblx0XHRcdHRoaXMuX3Bhc3Nlc1tpXS5pbnZhbGlkYXRlUGFzcygpO1xuXG5cdFx0dGhpcy5faW52YWxpZEFuaW1hdGlvbiA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBpbnZhbGlkYXRlQW5pbWF0aW9uKClcblx0e1xuXHRcdHRoaXMuX2ludmFsaWRBbmltYXRpb24gPSB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqIEBwYXJhbSByZW5kZXJPYmplY3RPd25lclxuXHQgKi9cblx0cHJpdmF0ZSBfdXBkYXRlQW5pbWF0aW9uKClcblx0e1xuXHRcdGlmICh0aGlzLl9pbnZhbGlkUmVuZGVyT2JqZWN0KVxuXHRcdFx0dGhpcy5fcFVwZGF0ZVJlbmRlck9iamVjdCgpO1xuXG5cdFx0dGhpcy5faW52YWxpZEFuaW1hdGlvbiA9IGZhbHNlO1xuXG5cdFx0dmFyIGVuYWJsZWRHUFVBbmltYXRpb246Ym9vbGVhbiA9IHRoaXMuX2dldEVuYWJsZWRHUFVBbmltYXRpb24oKTtcblxuXHRcdHZhciByZW5kZXJPcmRlcklkID0gMDtcblx0XHR2YXIgbXVsdDpudW1iZXIgPSAxO1xuXHRcdHZhciBzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZTtcblx0XHR2YXIgbGVuOm51bWJlciA9IHRoaXMuX3Bhc3Nlcy5sZW5ndGg7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdHNoYWRlck9iamVjdCA9IHRoaXMuX3Bhc3Nlc1tpXS5zaGFkZXI7XG5cblx0XHRcdGlmIChzaGFkZXJPYmplY3QudXNlc0FuaW1hdGlvbiAhPSBlbmFibGVkR1BVQW5pbWF0aW9uKSB7XG5cdFx0XHRcdHNoYWRlck9iamVjdC51c2VzQW5pbWF0aW9uID0gZW5hYmxlZEdQVUFuaW1hdGlvbjtcblx0XHRcdFx0c2hhZGVyT2JqZWN0LmludmFsaWRhdGVQcm9ncmFtKCk7XG5cdFx0XHR9XG5cblx0XHRcdHJlbmRlck9yZGVySWQgKz0gc2hhZGVyT2JqZWN0LnByb2dyYW1EYXRhLmlkKm11bHQ7XG5cdFx0XHRtdWx0ICo9IDEwMDA7XG5cdFx0fVxuXG5cdFx0dGhpcy5fcmVuZGVyT3JkZXJJZCA9IHJlbmRlck9yZGVySWQ7XG5cdH1cblxuXHQvKipcblx0ICogUGVyZm9ybXMgYW55IHByb2Nlc3NpbmcgdGhhdCBuZWVkcyB0byBvY2N1ciBiZWZvcmUgYW55IG9mIGl0cyBwYXNzZXMgYXJlIHVzZWQuXG5cdCAqXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwdWJsaWMgX3BVcGRhdGVSZW5kZXJPYmplY3QoKVxuXHR7XG5cdFx0dGhpcy5faW52YWxpZFJlbmRlck9iamVjdCA9IGZhbHNlO1xuXG5cdFx0Ly9vdmVycnJpZGUgdG8gdXBkYXRlIHNoYWRlciBvYmplY3QgcHJvcGVydGllc1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlbW92ZXMgYSBwYXNzIGZyb20gdGhlIHJlbmRlck9iamVjdE93bmVyLlxuXHQgKiBAcGFyYW0gcGFzcyBUaGUgcGFzcyB0byBiZSByZW1vdmVkLlxuXHQgKi9cblx0cHVibGljIF9wUmVtb3ZlU2NyZWVuUGFzcyhwYXNzOlJlbmRlclBhc3NCYXNlKVxuXHR7XG5cdFx0cGFzcy5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50LkNIQU5HRSwgdGhpcy5fb25QYXNzQ2hhbmdlRGVsZWdhdGUpO1xuXHRcdHRoaXMuX3Bhc3Nlcy5zcGxpY2UodGhpcy5fcGFzc2VzLmluZGV4T2YocGFzcyksIDEpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlbW92ZXMgYWxsIHBhc3NlcyBmcm9tIHRoZSByZW5kZXJPYmplY3RPd25lclxuXHQgKi9cblx0cHVibGljIF9wQ2xlYXJTY3JlZW5QYXNzZXMoKVxuXHR7XG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgKytpKVxuXHRcdFx0dGhpcy5fcGFzc2VzW2ldLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnQuQ0hBTkdFLCB0aGlzLl9vblBhc3NDaGFuZ2VEZWxlZ2F0ZSk7XG5cblx0XHR0aGlzLl9wYXNzZXMubGVuZ3RoID0gMDtcblx0fVxuXG5cdC8qKlxuXHQgKiBBZGRzIGEgcGFzcyB0byB0aGUgcmVuZGVyT2JqZWN0T3duZXJcblx0ICogQHBhcmFtIHBhc3Ncblx0ICovXG5cdHB1YmxpYyBfcEFkZFNjcmVlblBhc3MocGFzczpSZW5kZXJQYXNzQmFzZSlcblx0e1xuXHRcdHRoaXMuX3Bhc3Nlcy5wdXNoKHBhc3MpO1xuXHRcdHBhc3MuYWRkRXZlbnRMaXN0ZW5lcihFdmVudC5DSEFOR0UsIHRoaXMuX29uUGFzc0NoYW5nZURlbGVnYXRlKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBMaXN0ZW5lciBmb3Igd2hlbiBhIHBhc3MncyBzaGFkZXIgY29kZSBjaGFuZ2VzLiBJdCByZWNhbGN1bGF0ZXMgdGhlIHJlbmRlciBvcmRlciBpZC5cblx0ICovXG5cdHByaXZhdGUgb25QYXNzQ2hhbmdlKGV2ZW50OkV2ZW50KVxuXHR7XG5cdFx0dGhpcy5pbnZhbGlkYXRlQW5pbWF0aW9uKCk7XG5cdH1cblxuXG5cdC8qKlxuXHQgKiB0ZXN0IGlmIGFuaW1hdGlvbiB3aWxsIGJlIGFibGUgdG8gcnVuIG9uIGdwdSBCRUZPUkUgY29tcGlsaW5nIG1hdGVyaWFsc1xuXHQgKiB0ZXN0IGlmIHRoZSBzaGFkZXIgb2JqZWN0cyBzdXBwb3J0cyBhbmltYXRpbmcgdGhlIGFuaW1hdGlvbiBzZXQgaW4gdGhlIHZlcnRleCBzaGFkZXJcblx0ICogaWYgYW55IG9iamVjdCB1c2luZyB0aGlzIG1hdGVyaWFsIGZhaWxzIHRvIHN1cHBvcnQgYWNjZWxlcmF0ZWQgYW5pbWF0aW9ucyBmb3IgYW55IG9mIHRoZSBzaGFkZXIgb2JqZWN0cyxcblx0ICogd2Ugc2hvdWxkIGRvIGV2ZXJ5dGhpbmcgb24gY3B1IChvdGhlcndpc2Ugd2UgaGF2ZSB0aGUgY29zdCBvZiBib3RoIGdwdSArIGNwdSBhbmltYXRpb25zKVxuXHQgKi9cblx0cHJpdmF0ZSBfZ2V0RW5hYmxlZEdQVUFuaW1hdGlvbigpOmJvb2xlYW5cblx0e1xuXHRcdGlmICh0aGlzLl9yZW5kZXJPYmplY3RPd25lci5hbmltYXRpb25TZXQpIHtcblx0XHRcdHRoaXMuX3JlbmRlck9iamVjdE93bmVyLmFuaW1hdGlvblNldC5yZXNldEdQVUNvbXBhdGliaWxpdHkoKTtcblxuXHRcdFx0dmFyIG93bmVyczpBcnJheTxJUmVuZGVyYWJsZU93bmVyPiA9IHRoaXMuX3JlbmRlck9iamVjdE93bmVyLmlPd25lcnM7XG5cdFx0XHR2YXIgbnVtT3duZXJzOm51bWJlciA9IG93bmVycy5sZW5ndGg7XG5cblx0XHRcdHZhciBsZW46bnVtYmVyID0gdGhpcy5fcGFzc2VzLmxlbmd0aDtcblx0XHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgaSsrKVxuXHRcdFx0XHRmb3IgKHZhciBqOm51bWJlciA9IDA7IGogPCBudW1Pd25lcnM7IGorKylcblx0XHRcdFx0XHRpZiAob3duZXJzW2pdLmFuaW1hdG9yKVxuXHRcdFx0XHRcdFx0KDxBbmltYXRvckJhc2U+IG93bmVyc1tqXS5hbmltYXRvcikudGVzdEdQVUNvbXBhdGliaWxpdHkodGhpcy5fcGFzc2VzW2ldLnNoYWRlcik7XG5cblx0XHRcdHJldHVybiAhdGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuYW5pbWF0aW9uU2V0LnVzZXNDUFU7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG5cbmV4cG9ydCA9IFJlbmRlck9iamVjdEJhc2U7Il19