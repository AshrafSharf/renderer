var Event = require("awayjs-core/lib/events/Event");
var MaterialBase = require("awayjs-display/lib/materials/MaterialBase");
/**
 *
 * @class away.pool.ScreenPasses
 */
var RenderObjectBase = (function () {
    function RenderObjectBase(pool, renderObjectOwner, renderableClass, stage) {
        var _this = this;
        this._forceSeparateMVP = false;
        this._invalidAnimation = true;
        this._invalidRenderObject = true;
        this._passes = new Array();
        this._pRequiresBlending = false;
        this._pool = pool;
        this.renderObjectId = renderObjectOwner.id;
        this._renderObjectOwner = renderObjectOwner;
        this._renderableClass = renderableClass;
        this._stage = stage;
        this._onPassChangeDelegate = function (event) { return _this.onPassChange(event); };
    }
    Object.defineProperty(RenderObjectBase.prototype, "requiresBlending", {
        /**
         * Indicates whether or not the renderable requires alpha blending during rendering.
         */
        get: function () {
            return this._pRequiresBlending;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RenderObjectBase.prototype, "renderOrderId", {
        get: function () {
            if (this._invalidAnimation)
                this._updateAnimation();
            return this._renderOrderId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RenderObjectBase.prototype, "passes", {
        get: function () {
            if (this._invalidAnimation)
                this._updateAnimation();
            return this._passes;
        },
        enumerable: true,
        configurable: true
    });
    RenderObjectBase.prototype._iIncludeDependencies = function (shaderObject) {
        this._renderableClass._iIncludeDependencies(shaderObject);
        shaderObject.alphaThreshold = this._renderObjectOwner.alphaThreshold;
        shaderObject.useMipmapping = this._renderObjectOwner.mipmap;
        shaderObject.useSmoothTextures = this._renderObjectOwner.smooth;
        if (this._renderObjectOwner.isAsset(MaterialBase)) {
            var material = this._renderObjectOwner;
            shaderObject.useAlphaPremultiplied = material.alphaPremultiplied;
            shaderObject.useBothSides = material.bothSides;
            shaderObject.repeatTextures = material.repeat;
            shaderObject.usesUVTransform = material.animateUVs;
            shaderObject.texture = material.texture;
            shaderObject.color = material.color;
        }
    };
    /**
     *
     */
    RenderObjectBase.prototype.dispose = function () {
        this._pClearScreenPasses();
        var len = this._passes.length;
        for (var i = 0; i < len; i++)
            this._passes[i].dispose();
        this._passes = null;
        this._pool.disposeItem(this._renderObjectOwner);
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidateRenderObject = function () {
        this._invalidRenderObject = true;
        this._invalidAnimation = true;
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidatePasses = function () {
        var len = this._passes.length;
        for (var i = 0; i < len; i++)
            this._passes[i].invalidatePass();
        this._invalidAnimation = true;
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidateAnimation = function () {
        this._invalidAnimation = true;
    };
    /**
     *
     * @param renderObjectOwner
     */
    RenderObjectBase.prototype._updateAnimation = function () {
        if (this._invalidRenderObject)
            this._pUpdateRenderObject();
        this._invalidAnimation = false;
        var enabledGPUAnimation = this._getEnabledGPUAnimation();
        var renderOrderId = 0;
        var mult = 1;
        var shaderObject;
        var len = this._passes.length;
        for (var i = 0; i < len; i++) {
            shaderObject = this._passes[i].shader;
            if (shaderObject.usesAnimation != enabledGPUAnimation) {
                shaderObject.usesAnimation = enabledGPUAnimation;
                shaderObject.invalidateProgram();
            }
            renderOrderId += shaderObject.programData.id * mult;
            mult *= 1000;
        }
        this._renderOrderId = renderOrderId;
    };
    /**
     * Performs any processing that needs to occur before any of its passes are used.
     *
     * @private
     */
    RenderObjectBase.prototype._pUpdateRenderObject = function () {
        this._invalidRenderObject = false;
        //overrride to update shader object properties
    };
    /**
     * Removes a pass from the renderObjectOwner.
     * @param pass The pass to be removed.
     */
    RenderObjectBase.prototype._pRemoveScreenPass = function (pass) {
        pass.removeEventListener(Event.CHANGE, this._onPassChangeDelegate);
        this._passes.splice(this._passes.indexOf(pass), 1);
    };
    /**
     * Removes all passes from the renderObjectOwner
     */
    RenderObjectBase.prototype._pClearScreenPasses = function () {
        var len = this._passes.length;
        for (var i = 0; i < len; ++i)
            this._passes[i].removeEventListener(Event.CHANGE, this._onPassChangeDelegate);
        this._passes.length = 0;
    };
    /**
     * Adds a pass to the renderObjectOwner
     * @param pass
     */
    RenderObjectBase.prototype._pAddScreenPass = function (pass) {
        this._passes.push(pass);
        pass.addEventListener(Event.CHANGE, this._onPassChangeDelegate);
    };
    /**
     * Listener for when a pass's shader code changes. It recalculates the render order id.
     */
    RenderObjectBase.prototype.onPassChange = function (event) {
        this.invalidateAnimation();
    };
    /**
     * test if animation will be able to run on gpu BEFORE compiling materials
     * test if the shader objects supports animating the animation set in the vertex shader
     * if any object using this material fails to support accelerated animations for any of the shader objects,
     * we should do everything on cpu (otherwise we have the cost of both gpu + cpu animations)
     */
    RenderObjectBase.prototype._getEnabledGPUAnimation = function () {
        if (this._renderObjectOwner.animationSet) {
            this._renderObjectOwner.animationSet.resetGPUCompatibility();
            var owners = this._renderObjectOwner.iOwners;
            var numOwners = owners.length;
            var len = this._passes.length;
            for (var i = 0; i < len; i++)
                for (var j = 0; j < numOwners; j++)
                    if (owners[j].animator)
                        owners[j].animator.testGPUCompatibility(this._passes[i].shader);
            return !this._renderObjectOwner.animationSet.usesCPU;
        }
        return false;
    };
    return RenderObjectBase;
})();
module.exports = RenderObjectBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9SZW5kZXJPYmplY3RCYXNlLnRzIl0sIm5hbWVzIjpbIlJlbmRlck9iamVjdEJhc2UiLCJSZW5kZXJPYmplY3RCYXNlLmNvbnN0cnVjdG9yIiwiUmVuZGVyT2JqZWN0QmFzZS5yZXF1aXJlc0JsZW5kaW5nIiwiUmVuZGVyT2JqZWN0QmFzZS5yZW5kZXJPcmRlcklkIiwiUmVuZGVyT2JqZWN0QmFzZS5wYXNzZXMiLCJSZW5kZXJPYmplY3RCYXNlLl9pSW5jbHVkZURlcGVuZGVuY2llcyIsIlJlbmRlck9iamVjdEJhc2UuZGlzcG9zZSIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZVJlbmRlck9iamVjdCIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZVBhc3NlcyIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZUFuaW1hdGlvbiIsIlJlbmRlck9iamVjdEJhc2UuX3VwZGF0ZUFuaW1hdGlvbiIsIlJlbmRlck9iamVjdEJhc2UuX3BVcGRhdGVSZW5kZXJPYmplY3QiLCJSZW5kZXJPYmplY3RCYXNlLl9wUmVtb3ZlU2NyZWVuUGFzcyIsIlJlbmRlck9iamVjdEJhc2UuX3BDbGVhclNjcmVlblBhc3NlcyIsIlJlbmRlck9iamVjdEJhc2UuX3BBZGRTY3JlZW5QYXNzIiwiUmVuZGVyT2JqZWN0QmFzZS5vblBhc3NDaGFuZ2UiLCJSZW5kZXJPYmplY3RCYXNlLl9nZXRFbmFibGVkR1BVQW5pbWF0aW9uIl0sIm1hcHBpbmdzIjoiQUFDQSxJQUFPLEtBQUssV0FBZ0IsOEJBQThCLENBQUMsQ0FBQztBQU01RCxJQUFPLFlBQVksV0FBZSwyQ0FBMkMsQ0FBQyxDQUFDO0FBYS9FLEFBSUE7OztHQURHO0lBQ0csZ0JBQWdCO0lBOENyQkEsU0E5Q0tBLGdCQUFnQkEsQ0E4Q1RBLElBQXFCQSxFQUFFQSxpQkFBb0NBLEVBQUVBLGVBQWdDQSxFQUFFQSxLQUFXQTtRQTlDdkhDLGlCQXdPQ0E7UUF0T09B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QUFDQSxRQUFTQSxDQUFDQSxvQkFBb0JBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBRXBGQSxNQUFNQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLFlBQVlBLENBQUNBLE9BQU9BLENBQUNBO1FBQ3REQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtJQUNkQSxDQUFDQTtJQUNGaEIsdUJBQUNBO0FBQURBLENBeE9BLEFBd09DQSxJQUFBO0FBRUQsQUFBMEIsaUJBQWpCLGdCQUFnQixDQUFDIiwiZmlsZSI6ImNvbXBpbGF0aW9uL1JlbmRlck9iamVjdEJhc2UuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XG5pbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuXG5pbXBvcnQgSVJlbmRlck9iamVjdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3Bvb2wvSVJlbmRlck9iamVjdFwiKTtcbmltcG9ydCBJUmVuZGVyT2JqZWN0T3duZXJcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9JUmVuZGVyT2JqZWN0T3duZXJcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBJUmVuZGVyYWJsZU93bmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9JUmVuZGVyYWJsZU93bmVyXCIpO1xuaW1wb3J0IE1hdGVyaWFsQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL01hdGVyaWFsQmFzZVwiKTtcblxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5cbmltcG9ydCBBbmltYXRvckJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9BbmltYXRvckJhc2VcIik7XG5pbXBvcnQgU2hhZGVyT2JqZWN0QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRGF0YVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckRhdGFcIik7XG5pbXBvcnQgUmVuZGVyT2JqZWN0UG9vbFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1JlbmRlck9iamVjdFBvb2xcIik7XG5pbXBvcnQgUmVuZGVyUGFzc0Jhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvUmVuZGVyUGFzc0Jhc2VcIik7XG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xuaW1wb3J0IElSZW5kZXJhYmxlQ2xhc3NcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0lSZW5kZXJhYmxlQ2xhc3NcIik7XG5cbi8qKlxuICpcbiAqIEBjbGFzcyBhd2F5LnBvb2wuU2NyZWVuUGFzc2VzXG4gKi9cbmNsYXNzIFJlbmRlck9iamVjdEJhc2UgaW1wbGVtZW50cyBJUmVuZGVyT2JqZWN0XG57XG5cdHB1YmxpYyBfZm9yY2VTZXBhcmF0ZU1WUDpib29sZWFuID0gZmFsc2U7XG5cblx0cHJpdmF0ZSBfcG9vbDpSZW5kZXJPYmplY3RQb29sO1xuXHRwdWJsaWMgX3JlbmRlck9iamVjdE93bmVyOklSZW5kZXJPYmplY3RPd25lcjtcblx0cHVibGljIF9yZW5kZXJhYmxlQ2xhc3M6SVJlbmRlcmFibGVDbGFzcztcblx0cHVibGljIF9zdGFnZTpTdGFnZTtcblxuXHRwcml2YXRlIF9yZW5kZXJPcmRlcklkOm51bWJlcjtcblx0cHJpdmF0ZSBfaW52YWxpZEFuaW1hdGlvbjpib29sZWFuID0gdHJ1ZTtcblx0cHJpdmF0ZSBfaW52YWxpZFJlbmRlck9iamVjdDpib29sZWFuID0gdHJ1ZTtcblx0cHJpdmF0ZSBfcGFzc2VzOkFycmF5PFJlbmRlclBhc3NCYXNlPiA9IG5ldyBBcnJheTxSZW5kZXJQYXNzQmFzZT4oKTtcblxuXG5cblx0cHVibGljIF9wUmVxdWlyZXNCbGVuZGluZzpib29sZWFuID0gZmFsc2U7XG5cblx0cHJpdmF0ZSBfb25QYXNzQ2hhbmdlRGVsZWdhdGU6KGV2ZW50OkV2ZW50KSA9PiB2b2lkO1xuXG5cdHB1YmxpYyByZW5kZXJPYmplY3RJZDpudW1iZXI7XG5cblx0LyoqXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCB0aGUgcmVuZGVyYWJsZSByZXF1aXJlcyBhbHBoYSBibGVuZGluZyBkdXJpbmcgcmVuZGVyaW5nLlxuXHQgKi9cblx0cHVibGljIGdldCByZXF1aXJlc0JsZW5kaW5nKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3BSZXF1aXJlc0JsZW5kaW5nO1xuXHR9XG5cblx0cHVibGljIGdldCByZW5kZXJPcmRlcklkKCk6bnVtYmVyXG5cdHtcblx0XHRpZiAodGhpcy5faW52YWxpZEFuaW1hdGlvbilcblx0XHRcdHRoaXMuX3VwZGF0ZUFuaW1hdGlvbigpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX3JlbmRlck9yZGVySWQ7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHBhc3NlcygpOkFycmF5PFJlbmRlclBhc3NCYXNlPlxuXHR7XG5cdFx0aWYgKHRoaXMuX2ludmFsaWRBbmltYXRpb24pXG5cdFx0XHR0aGlzLl91cGRhdGVBbmltYXRpb24oKTtcblxuXHRcdHJldHVybiB0aGlzLl9wYXNzZXM7XG5cdH1cblxuXHRjb25zdHJ1Y3Rvcihwb29sOlJlbmRlck9iamVjdFBvb2wsIHJlbmRlck9iamVjdE93bmVyOklSZW5kZXJPYmplY3RPd25lciwgcmVuZGVyYWJsZUNsYXNzOklSZW5kZXJhYmxlQ2xhc3MsIHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0dGhpcy5fcG9vbCA9IHBvb2w7XG5cdFx0dGhpcy5yZW5kZXJPYmplY3RJZCA9IHJlbmRlck9iamVjdE93bmVyLmlkO1xuXHRcdHRoaXMuX3JlbmRlck9iamVjdE93bmVyID0gcmVuZGVyT2JqZWN0T3duZXI7XG5cdFx0dGhpcy5fcmVuZGVyYWJsZUNsYXNzID0gcmVuZGVyYWJsZUNsYXNzO1xuXHRcdHRoaXMuX3N0YWdlID0gc3RhZ2U7XG5cblxuXHRcdHRoaXMuX29uUGFzc0NoYW5nZURlbGVnYXRlID0gKGV2ZW50OkV2ZW50KSA9PiB0aGlzLm9uUGFzc0NoYW5nZShldmVudCk7XG5cdH1cblxuXHRwdWJsaWMgX2lJbmNsdWRlRGVwZW5kZW5jaWVzKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlKVxuXHR7XG5cdFx0dGhpcy5fcmVuZGVyYWJsZUNsYXNzLl9pSW5jbHVkZURlcGVuZGVuY2llcyhzaGFkZXJPYmplY3QpO1xuXG5cdFx0c2hhZGVyT2JqZWN0LmFscGhhVGhyZXNob2xkID0gdGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuYWxwaGFUaHJlc2hvbGQ7XG5cdFx0c2hhZGVyT2JqZWN0LnVzZU1pcG1hcHBpbmcgPSB0aGlzLl9yZW5kZXJPYmplY3RPd25lci5taXBtYXA7XG5cdFx0c2hhZGVyT2JqZWN0LnVzZVNtb290aFRleHR1cmVzID0gdGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuc21vb3RoO1xuXG5cdFx0aWYgKHRoaXMuX3JlbmRlck9iamVjdE93bmVyLmlzQXNzZXQoTWF0ZXJpYWxCYXNlKSkge1xuXHRcdFx0dmFyIG1hdGVyaWFsOk1hdGVyaWFsQmFzZSA9IDxNYXRlcmlhbEJhc2U+IHRoaXMuX3JlbmRlck9iamVjdE93bmVyO1xuXHRcdFx0c2hhZGVyT2JqZWN0LnVzZUFscGhhUHJlbXVsdGlwbGllZCA9IG1hdGVyaWFsLmFscGhhUHJlbXVsdGlwbGllZDtcblx0XHRcdHNoYWRlck9iamVjdC51c2VCb3RoU2lkZXMgPSBtYXRlcmlhbC5ib3RoU2lkZXM7XG5cdFx0XHRzaGFkZXJPYmplY3QucmVwZWF0VGV4dHVyZXMgPSBtYXRlcmlhbC5yZXBlYXQ7XG5cdFx0XHRzaGFkZXJPYmplY3QudXNlc1VWVHJhbnNmb3JtID0gbWF0ZXJpYWwuYW5pbWF0ZVVWcztcblx0XHRcdHNoYWRlck9iamVjdC50ZXh0dXJlID0gbWF0ZXJpYWwudGV4dHVyZTtcblx0XHRcdHNoYWRlck9iamVjdC5jb2xvciA9IG1hdGVyaWFsLmNvbG9yO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0dGhpcy5fcENsZWFyU2NyZWVuUGFzc2VzKCk7XG5cblx0XHR2YXIgbGVuOm51bWJlciA9IHRoaXMuX3Bhc3Nlcy5sZW5ndGg7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyBpKyspXG5cdFx0XHR0aGlzLl9wYXNzZXNbaV0uZGlzcG9zZSgpO1xuXG5cdFx0dGhpcy5fcGFzc2VzID0gbnVsbDtcblxuXHRcdHRoaXMuX3Bvb2wuZGlzcG9zZUl0ZW0odGhpcy5fcmVuZGVyT2JqZWN0T3duZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgaW52YWxpZGF0ZVJlbmRlck9iamVjdCgpXG5cdHtcblx0XHR0aGlzLl9pbnZhbGlkUmVuZGVyT2JqZWN0ID0gdHJ1ZTtcblx0XHR0aGlzLl9pbnZhbGlkQW5pbWF0aW9uID0gdHJ1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGludmFsaWRhdGVQYXNzZXMoKVxuXHR7XG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgaSsrKVxuXHRcdFx0dGhpcy5fcGFzc2VzW2ldLmludmFsaWRhdGVQYXNzKCk7XG5cblx0XHR0aGlzLl9pbnZhbGlkQW5pbWF0aW9uID0gdHJ1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIGludmFsaWRhdGVBbmltYXRpb24oKVxuXHR7XG5cdFx0dGhpcy5faW52YWxpZEFuaW1hdGlvbiA9IHRydWU7XG5cdH1cblxuXHQvKipcblx0ICpcblx0ICogQHBhcmFtIHJlbmRlck9iamVjdE93bmVyXG5cdCAqL1xuXHRwcml2YXRlIF91cGRhdGVBbmltYXRpb24oKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2ludmFsaWRSZW5kZXJPYmplY3QpXG5cdFx0XHR0aGlzLl9wVXBkYXRlUmVuZGVyT2JqZWN0KCk7XG5cblx0XHR0aGlzLl9pbnZhbGlkQW5pbWF0aW9uID0gZmFsc2U7XG5cblx0XHR2YXIgZW5hYmxlZEdQVUFuaW1hdGlvbjpib29sZWFuID0gdGhpcy5fZ2V0RW5hYmxlZEdQVUFuaW1hdGlvbigpO1xuXG5cdFx0dmFyIHJlbmRlck9yZGVySWQgPSAwO1xuXHRcdHZhciBtdWx0Om51bWJlciA9IDE7XG5cdFx0dmFyIHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlO1xuXHRcdHZhciBsZW46bnVtYmVyID0gdGhpcy5fcGFzc2VzLmxlbmd0aDtcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0c2hhZGVyT2JqZWN0ID0gdGhpcy5fcGFzc2VzW2ldLnNoYWRlcjtcblxuXHRcdFx0aWYgKHNoYWRlck9iamVjdC51c2VzQW5pbWF0aW9uICE9IGVuYWJsZWRHUFVBbmltYXRpb24pIHtcblx0XHRcdFx0c2hhZGVyT2JqZWN0LnVzZXNBbmltYXRpb24gPSBlbmFibGVkR1BVQW5pbWF0aW9uO1xuXHRcdFx0XHRzaGFkZXJPYmplY3QuaW52YWxpZGF0ZVByb2dyYW0oKTtcblx0XHRcdH1cblxuXHRcdFx0cmVuZGVyT3JkZXJJZCArPSBzaGFkZXJPYmplY3QucHJvZ3JhbURhdGEuaWQqbXVsdDtcblx0XHRcdG11bHQgKj0gMTAwMDtcblx0XHR9XG5cblx0XHR0aGlzLl9yZW5kZXJPcmRlcklkID0gcmVuZGVyT3JkZXJJZDtcblx0fVxuXG5cdC8qKlxuXHQgKiBQZXJmb3JtcyBhbnkgcHJvY2Vzc2luZyB0aGF0IG5lZWRzIHRvIG9jY3VyIGJlZm9yZSBhbnkgb2YgaXRzIHBhc3NlcyBhcmUgdXNlZC5cblx0ICpcblx0ICogQHByaXZhdGVcblx0ICovXG5cdHB1YmxpYyBfcFVwZGF0ZVJlbmRlck9iamVjdCgpXG5cdHtcblx0XHR0aGlzLl9pbnZhbGlkUmVuZGVyT2JqZWN0ID0gZmFsc2U7XG5cblx0XHQvL292ZXJycmlkZSB0byB1cGRhdGUgc2hhZGVyIG9iamVjdCBwcm9wZXJ0aWVzXG5cdH1cblxuXHQvKipcblx0ICogUmVtb3ZlcyBhIHBhc3MgZnJvbSB0aGUgcmVuZGVyT2JqZWN0T3duZXIuXG5cdCAqIEBwYXJhbSBwYXNzIFRoZSBwYXNzIHRvIGJlIHJlbW92ZWQuXG5cdCAqL1xuXHRwdWJsaWMgX3BSZW1vdmVTY3JlZW5QYXNzKHBhc3M6UmVuZGVyUGFzc0Jhc2UpXG5cdHtcblx0XHRwYXNzLnJlbW92ZUV2ZW50TGlzdGVuZXIoRXZlbnQuQ0hBTkdFLCB0aGlzLl9vblBhc3NDaGFuZ2VEZWxlZ2F0ZSk7XG5cdFx0dGhpcy5fcGFzc2VzLnNwbGljZSh0aGlzLl9wYXNzZXMuaW5kZXhPZihwYXNzKSwgMSk7XG5cdH1cblxuXHQvKipcblx0ICogUmVtb3ZlcyBhbGwgcGFzc2VzIGZyb20gdGhlIHJlbmRlck9iamVjdE93bmVyXG5cdCAqL1xuXHRwdWJsaWMgX3BDbGVhclNjcmVlblBhc3NlcygpXG5cdHtcblx0XHR2YXIgbGVuOm51bWJlciA9IHRoaXMuX3Bhc3Nlcy5sZW5ndGg7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyArK2kpXG5cdFx0XHR0aGlzLl9wYXNzZXNbaV0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihFdmVudC5DSEFOR0UsIHRoaXMuX29uUGFzc0NoYW5nZURlbGVnYXRlKTtcblxuXHRcdHRoaXMuX3Bhc3Nlcy5sZW5ndGggPSAwO1xuXHR9XG5cblx0LyoqXG5cdCAqIEFkZHMgYSBwYXNzIHRvIHRoZSByZW5kZXJPYmplY3RPd25lclxuXHQgKiBAcGFyYW0gcGFzc1xuXHQgKi9cblx0cHVibGljIF9wQWRkU2NyZWVuUGFzcyhwYXNzOlJlbmRlclBhc3NCYXNlKVxuXHR7XG5cdFx0dGhpcy5fcGFzc2VzLnB1c2gocGFzcyk7XG5cdFx0cGFzcy5hZGRFdmVudExpc3RlbmVyKEV2ZW50LkNIQU5HRSwgdGhpcy5fb25QYXNzQ2hhbmdlRGVsZWdhdGUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIExpc3RlbmVyIGZvciB3aGVuIGEgcGFzcydzIHNoYWRlciBjb2RlIGNoYW5nZXMuIEl0IHJlY2FsY3VsYXRlcyB0aGUgcmVuZGVyIG9yZGVyIGlkLlxuXHQgKi9cblx0cHJpdmF0ZSBvblBhc3NDaGFuZ2UoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHR0aGlzLmludmFsaWRhdGVBbmltYXRpb24oKTtcblx0fVxuXG5cblx0LyoqXG5cdCAqIHRlc3QgaWYgYW5pbWF0aW9uIHdpbGwgYmUgYWJsZSB0byBydW4gb24gZ3B1IEJFRk9SRSBjb21waWxpbmcgbWF0ZXJpYWxzXG5cdCAqIHRlc3QgaWYgdGhlIHNoYWRlciBvYmplY3RzIHN1cHBvcnRzIGFuaW1hdGluZyB0aGUgYW5pbWF0aW9uIHNldCBpbiB0aGUgdmVydGV4IHNoYWRlclxuXHQgKiBpZiBhbnkgb2JqZWN0IHVzaW5nIHRoaXMgbWF0ZXJpYWwgZmFpbHMgdG8gc3VwcG9ydCBhY2NlbGVyYXRlZCBhbmltYXRpb25zIGZvciBhbnkgb2YgdGhlIHNoYWRlciBvYmplY3RzLFxuXHQgKiB3ZSBzaG91bGQgZG8gZXZlcnl0aGluZyBvbiBjcHUgKG90aGVyd2lzZSB3ZSBoYXZlIHRoZSBjb3N0IG9mIGJvdGggZ3B1ICsgY3B1IGFuaW1hdGlvbnMpXG5cdCAqL1xuXHRwcml2YXRlIF9nZXRFbmFibGVkR1BVQW5pbWF0aW9uKCk6Ym9vbGVhblxuXHR7XG5cdFx0aWYgKHRoaXMuX3JlbmRlck9iamVjdE93bmVyLmFuaW1hdGlvblNldCkge1xuXHRcdFx0dGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuYW5pbWF0aW9uU2V0LnJlc2V0R1BVQ29tcGF0aWJpbGl0eSgpO1xuXG5cdFx0XHR2YXIgb3duZXJzOkFycmF5PElSZW5kZXJhYmxlT3duZXI+ID0gdGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuaU93bmVycztcblx0XHRcdHZhciBudW1Pd25lcnM6bnVtYmVyID0gb3duZXJzLmxlbmd0aDtcblxuXHRcdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xuXHRcdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyBpKyspXG5cdFx0XHRcdGZvciAodmFyIGo6bnVtYmVyID0gMDsgaiA8IG51bU93bmVyczsgaisrKVxuXHRcdFx0XHRcdGlmIChvd25lcnNbal0uYW5pbWF0b3IpXG5cdFx0XHRcdFx0XHQoPEFuaW1hdG9yQmFzZT4gb3duZXJzW2pdLmFuaW1hdG9yKS50ZXN0R1BVQ29tcGF0aWJpbGl0eSh0aGlzLl9wYXNzZXNbaV0uc2hhZGVyKTtcblxuXHRcdFx0cmV0dXJuICF0aGlzLl9yZW5kZXJPYmplY3RPd25lci5hbmltYXRpb25TZXQudXNlc0NQVTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn1cblxuZXhwb3J0ID0gUmVuZGVyT2JqZWN0QmFzZTsiXX0=