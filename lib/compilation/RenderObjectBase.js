var Event = require("awayjs-core/lib/events/Event");
var AssetType = require("awayjs-core/lib/library/AssetType");
/**
 *
 * @class away.pool.ScreenPasses
 */
var RenderObjectBase = (function () {
    function RenderObjectBase(pool, renderObjectOwner, renderableClass, stage) {
        var _this = this;
        this._forceSeparateMVP = false;
        this._invalidAnimation = true;
        this._invalidRenderObject = true;
        this._passes = new Array();
        this._pRequiresBlending = false;
        this._pool = pool;
        this.renderObjectId = renderObjectOwner.id;
        this._renderObjectOwner = renderObjectOwner;
        this._renderableClass = renderableClass;
        this._stage = stage;
        this._onPassChangeDelegate = function (event) { return _this.onPassChange(event); };
    }
    Object.defineProperty(RenderObjectBase.prototype, "requiresBlending", {
        /**
         * Indicates whether or not the renderable requires alpha blending during rendering.
         */
        get: function () {
            return this._pRequiresBlending;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RenderObjectBase.prototype, "renderOrderId", {
        get: function () {
            if (this._invalidAnimation)
                this._updateAnimation();
            return this._renderOrderId;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RenderObjectBase.prototype, "passes", {
        get: function () {
            if (this._invalidAnimation)
                this._updateAnimation();
            return this._passes;
        },
        enumerable: true,
        configurable: true
    });
    RenderObjectBase.prototype._iIncludeDependencies = function (shaderObject) {
        this._renderableClass._iIncludeDependencies(shaderObject);
        shaderObject.alphaThreshold = this._renderObjectOwner.alphaThreshold;
        shaderObject.useMipmapping = this._renderObjectOwner.mipmap;
        shaderObject.useSmoothTextures = this._renderObjectOwner.smooth;
        if (this._renderObjectOwner.assetType = AssetType.MATERIAL) {
            var material = this._renderObjectOwner;
            shaderObject.useAlphaPremultiplied = material.alphaPremultiplied;
            shaderObject.useBothSides = material.bothSides;
            shaderObject.repeatTextures = material.repeat;
            shaderObject.usesUVTransform = material.animateUVs;
            shaderObject.texture = material.texture;
            shaderObject.color = material.color;
        }
    };
    /**
     *
     */
    RenderObjectBase.prototype.dispose = function () {
        this._pClearScreenPasses();
        var len = this._passes.length;
        for (var i = 0; i < len; i++)
            this._passes[i].dispose();
        this._passes = null;
        this._pool.disposeItem(this._renderObjectOwner);
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidateRenderObject = function () {
        this._invalidRenderObject = true;
        this._invalidAnimation = true;
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidatePasses = function () {
        var len = this._passes.length;
        for (var i = 0; i < len; i++)
            this._passes[i].invalidatePass();
        this._invalidAnimation = true;
    };
    /**
     *
     */
    RenderObjectBase.prototype.invalidateAnimation = function () {
        this._invalidAnimation = true;
    };
    /**
     *
     * @param renderObjectOwner
     */
    RenderObjectBase.prototype._updateAnimation = function () {
        if (this._invalidRenderObject)
            this._pUpdateRenderObject();
        this._invalidAnimation = false;
        var enabledGPUAnimation = this._getEnabledGPUAnimation();
        var renderOrderId = 0;
        var mult = 1;
        var shaderObject;
        var len = this._passes.length;
        for (var i = 0; i < len; i++) {
            shaderObject = this._passes[i].shader;
            if (shaderObject.usesAnimation != enabledGPUAnimation) {
                shaderObject.usesAnimation = enabledGPUAnimation;
                shaderObject.invalidateProgram();
            }
            renderOrderId += shaderObject.programData.id * mult;
            mult *= 1000;
        }
        this._renderOrderId = renderOrderId;
    };
    /**
     * Performs any processing that needs to occur before any of its passes are used.
     *
     * @private
     */
    RenderObjectBase.prototype._pUpdateRenderObject = function () {
        this._invalidRenderObject = false;
        //overrride to update shader object properties
    };
    /**
     * Removes a pass from the renderObjectOwner.
     * @param pass The pass to be removed.
     */
    RenderObjectBase.prototype._pRemoveScreenPass = function (pass) {
        pass.removeEventListener(Event.CHANGE, this._onPassChangeDelegate);
        this._passes.splice(this._passes.indexOf(pass), 1);
    };
    /**
     * Removes all passes from the renderObjectOwner
     */
    RenderObjectBase.prototype._pClearScreenPasses = function () {
        var len = this._passes.length;
        for (var i = 0; i < len; ++i)
            this._passes[i].removeEventListener(Event.CHANGE, this._onPassChangeDelegate);
        this._passes.length = 0;
    };
    /**
     * Adds a pass to the renderObjectOwner
     * @param pass
     */
    RenderObjectBase.prototype._pAddScreenPass = function (pass) {
        this._passes.push(pass);
        pass.addEventListener(Event.CHANGE, this._onPassChangeDelegate);
    };
    /**
     * Listener for when a pass's shader code changes. It recalculates the render order id.
     */
    RenderObjectBase.prototype.onPassChange = function (event) {
        this.invalidateAnimation();
    };
    /**
     * test if animation will be able to run on gpu BEFORE compiling materials
     * test if the shader objects supports animating the animation set in the vertex shader
     * if any object using this material fails to support accelerated animations for any of the shader objects,
     * we should do everything on cpu (otherwise we have the cost of both gpu + cpu animations)
     */
    RenderObjectBase.prototype._getEnabledGPUAnimation = function () {
        if (this._renderObjectOwner.animationSet) {
            this._renderObjectOwner.animationSet.resetGPUCompatibility();
            var owners = this._renderObjectOwner.iOwners;
            var numOwners = owners.length;
            var len = this._passes.length;
            for (var i = 0; i < len; i++)
                for (var j = 0; j < numOwners; j++)
                    if (owners[j].animator)
                        owners[j].animator.testGPUCompatibility(this._passes[i].shader);
            return !this._renderObjectOwner.animationSet.usesCPU;
        }
        return false;
    };
    return RenderObjectBase;
})();
module.exports = RenderObjectBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9SZW5kZXJPYmplY3RCYXNlLnRzIl0sIm5hbWVzIjpbIlJlbmRlck9iamVjdEJhc2UiLCJSZW5kZXJPYmplY3RCYXNlLmNvbnN0cnVjdG9yIiwiUmVuZGVyT2JqZWN0QmFzZS5yZXF1aXJlc0JsZW5kaW5nIiwiUmVuZGVyT2JqZWN0QmFzZS5yZW5kZXJPcmRlcklkIiwiUmVuZGVyT2JqZWN0QmFzZS5wYXNzZXMiLCJSZW5kZXJPYmplY3RCYXNlLl9pSW5jbHVkZURlcGVuZGVuY2llcyIsIlJlbmRlck9iamVjdEJhc2UuZGlzcG9zZSIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZVJlbmRlck9iamVjdCIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZVBhc3NlcyIsIlJlbmRlck9iamVjdEJhc2UuaW52YWxpZGF0ZUFuaW1hdGlvbiIsIlJlbmRlck9iamVjdEJhc2UuX3VwZGF0ZUFuaW1hdGlvbiIsIlJlbmRlck9iamVjdEJhc2UuX3BVcGRhdGVSZW5kZXJPYmplY3QiLCJSZW5kZXJPYmplY3RCYXNlLl9wUmVtb3ZlU2NyZWVuUGFzcyIsIlJlbmRlck9iamVjdEJhc2UuX3BDbGVhclNjcmVlblBhc3NlcyIsIlJlbmRlck9iamVjdEJhc2UuX3BBZGRTY3JlZW5QYXNzIiwiUmVuZGVyT2JqZWN0QmFzZS5vblBhc3NDaGFuZ2UiLCJSZW5kZXJPYmplY3RCYXNlLl9nZXRFbmFibGVkR1BVQW5pbWF0aW9uIl0sIm1hcHBpbmdzIjoiQUFDQSxJQUFPLEtBQUssV0FBZ0IsOEJBQThCLENBQUMsQ0FBQztBQUM1RCxJQUFPLFNBQVMsV0FBZSxtQ0FBbUMsQ0FBQyxDQUFDO0FBbUJwRSxBQUlBOzs7R0FERztJQUNHLGdCQUFnQjtJQThDckJBLFNBOUNLQSxnQkFBZ0JBLENBOENUQSxJQUFxQkEsRUFBRUEsaUJBQW9DQSxFQUFFQSxlQUFnQ0EsRUFBRUEsS0FBV0E7UUE5Q3ZIQyxpQkF3T0NBO1FBdE9P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Q0FBQ0EsQ0FBQ0EsUUFBU0EsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUVwRkEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxZQUFZQSxDQUFDQSxPQUFPQSxDQUFDQTtRQUN0REEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7SUFDZEEsQ0FBQ0E7SUFDRmhCLHVCQUFDQTtBQUFEQSxDQXhPQSxBQXdPQ0EsSUFBQTtBQUVELEFBQTBCLGlCQUFqQixnQkFBZ0IsQ0FBQyIsImZpbGUiOiJjb21waWxhdGlvbi9SZW5kZXJPYmplY3RCYXNlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xyXG5pbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xyXG5pbXBvcnQgQXNzZXRUeXBlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0Fzc2V0VHlwZVwiKTtcclxuXHJcbmltcG9ydCBJUmVuZGVyT2JqZWN0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcG9vbC9JUmVuZGVyT2JqZWN0XCIpO1xyXG5pbXBvcnQgSVJlbmRlck9iamVjdE93bmVyXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVJlbmRlck9iamVjdE93bmVyXCIpO1xyXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuaW1wb3J0IElSZW5kZXJhYmxlT3duZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0lSZW5kZXJhYmxlT3duZXJcIik7XHJcbmltcG9ydCBNYXRlcmlhbEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9NYXRlcmlhbEJhc2VcIik7XHJcblxyXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcclxuXHJcbmltcG9ydCBBbmltYXRvckJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9BbmltYXRvckJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJDYWNoZVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRGF0YVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckRhdGFcIik7XHJcbmltcG9ydCBSZW5kZXJPYmplY3RQb29sXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vUmVuZGVyT2JqZWN0UG9vbFwiKTtcclxuaW1wb3J0IFJlbmRlclBhc3NCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcGFzc2VzL1JlbmRlclBhc3NCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmFibGVDbGFzc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvSVJlbmRlcmFibGVDbGFzc1wiKTtcclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBAY2xhc3MgYXdheS5wb29sLlNjcmVlblBhc3Nlc1xyXG4gKi9cclxuY2xhc3MgUmVuZGVyT2JqZWN0QmFzZSBpbXBsZW1lbnRzIElSZW5kZXJPYmplY3Rcclxue1xyXG5cdHB1YmxpYyBfZm9yY2VTZXBhcmF0ZU1WUDpib29sZWFuID0gZmFsc2U7XHJcblxyXG5cdHByaXZhdGUgX3Bvb2w6UmVuZGVyT2JqZWN0UG9vbDtcclxuXHRwdWJsaWMgX3JlbmRlck9iamVjdE93bmVyOklSZW5kZXJPYmplY3RPd25lcjtcclxuXHRwdWJsaWMgX3JlbmRlcmFibGVDbGFzczpJUmVuZGVyYWJsZUNsYXNzO1xyXG5cdHB1YmxpYyBfc3RhZ2U6U3RhZ2U7XHJcblxyXG5cdHByaXZhdGUgX3JlbmRlck9yZGVySWQ6bnVtYmVyO1xyXG5cdHByaXZhdGUgX2ludmFsaWRBbmltYXRpb246Ym9vbGVhbiA9IHRydWU7XHJcblx0cHJpdmF0ZSBfaW52YWxpZFJlbmRlck9iamVjdDpib29sZWFuID0gdHJ1ZTtcclxuXHRwcml2YXRlIF9wYXNzZXM6QXJyYXk8UmVuZGVyUGFzc0Jhc2U+ID0gbmV3IEFycmF5PFJlbmRlclBhc3NCYXNlPigpO1xyXG5cclxuXHJcblxyXG5cdHB1YmxpYyBfcFJlcXVpcmVzQmxlbmRpbmc6Ym9vbGVhbiA9IGZhbHNlO1xyXG5cclxuXHRwcml2YXRlIF9vblBhc3NDaGFuZ2VEZWxlZ2F0ZTooZXZlbnQ6RXZlbnQpID0+IHZvaWQ7XHJcblxyXG5cdHB1YmxpYyByZW5kZXJPYmplY3RJZDpudW1iZXI7XHJcblxyXG5cdC8qKlxyXG5cdCAqIEluZGljYXRlcyB3aGV0aGVyIG9yIG5vdCB0aGUgcmVuZGVyYWJsZSByZXF1aXJlcyBhbHBoYSBibGVuZGluZyBkdXJpbmcgcmVuZGVyaW5nLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgcmVxdWlyZXNCbGVuZGluZygpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcFJlcXVpcmVzQmxlbmRpbmc7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHJlbmRlck9yZGVySWQoKTpudW1iZXJcclxuXHR7XHJcblx0XHRpZiAodGhpcy5faW52YWxpZEFuaW1hdGlvbilcclxuXHRcdFx0dGhpcy5fdXBkYXRlQW5pbWF0aW9uKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX3JlbmRlck9yZGVySWQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHBhc3NlcygpOkFycmF5PFJlbmRlclBhc3NCYXNlPlxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9pbnZhbGlkQW5pbWF0aW9uKVxyXG5cdFx0XHR0aGlzLl91cGRhdGVBbmltYXRpb24oKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fcGFzc2VzO1xyXG5cdH1cclxuXHJcblx0Y29uc3RydWN0b3IocG9vbDpSZW5kZXJPYmplY3RQb29sLCByZW5kZXJPYmplY3RPd25lcjpJUmVuZGVyT2JqZWN0T3duZXIsIHJlbmRlcmFibGVDbGFzczpJUmVuZGVyYWJsZUNsYXNzLCBzdGFnZTpTdGFnZSlcclxuXHR7XHJcblx0XHR0aGlzLl9wb29sID0gcG9vbDtcclxuXHRcdHRoaXMucmVuZGVyT2JqZWN0SWQgPSByZW5kZXJPYmplY3RPd25lci5pZDtcclxuXHRcdHRoaXMuX3JlbmRlck9iamVjdE93bmVyID0gcmVuZGVyT2JqZWN0T3duZXI7XHJcblx0XHR0aGlzLl9yZW5kZXJhYmxlQ2xhc3MgPSByZW5kZXJhYmxlQ2xhc3M7XHJcblx0XHR0aGlzLl9zdGFnZSA9IHN0YWdlO1xyXG5cclxuXHJcblx0XHR0aGlzLl9vblBhc3NDaGFuZ2VEZWxlZ2F0ZSA9IChldmVudDpFdmVudCkgPT4gdGhpcy5vblBhc3NDaGFuZ2UoZXZlbnQpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIF9pSW5jbHVkZURlcGVuZGVuY2llcyhzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSlcclxuXHR7XHJcblx0XHR0aGlzLl9yZW5kZXJhYmxlQ2xhc3MuX2lJbmNsdWRlRGVwZW5kZW5jaWVzKHNoYWRlck9iamVjdCk7XHJcblxyXG5cdFx0c2hhZGVyT2JqZWN0LmFscGhhVGhyZXNob2xkID0gdGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuYWxwaGFUaHJlc2hvbGQ7XHJcblx0XHRzaGFkZXJPYmplY3QudXNlTWlwbWFwcGluZyA9IHRoaXMuX3JlbmRlck9iamVjdE93bmVyLm1pcG1hcDtcclxuXHRcdHNoYWRlck9iamVjdC51c2VTbW9vdGhUZXh0dXJlcyA9IHRoaXMuX3JlbmRlck9iamVjdE93bmVyLnNtb290aDtcclxuXHJcblx0XHRpZiAodGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuYXNzZXRUeXBlID0gQXNzZXRUeXBlLk1BVEVSSUFMKSB7XHJcblx0XHRcdHZhciBtYXRlcmlhbDpNYXRlcmlhbEJhc2UgPSA8TWF0ZXJpYWxCYXNlPiB0aGlzLl9yZW5kZXJPYmplY3RPd25lcjtcclxuXHRcdFx0c2hhZGVyT2JqZWN0LnVzZUFscGhhUHJlbXVsdGlwbGllZCA9IG1hdGVyaWFsLmFscGhhUHJlbXVsdGlwbGllZDtcclxuXHRcdFx0c2hhZGVyT2JqZWN0LnVzZUJvdGhTaWRlcyA9IG1hdGVyaWFsLmJvdGhTaWRlcztcclxuXHRcdFx0c2hhZGVyT2JqZWN0LnJlcGVhdFRleHR1cmVzID0gbWF0ZXJpYWwucmVwZWF0O1xyXG5cdFx0XHRzaGFkZXJPYmplY3QudXNlc1VWVHJhbnNmb3JtID0gbWF0ZXJpYWwuYW5pbWF0ZVVWcztcclxuXHRcdFx0c2hhZGVyT2JqZWN0LnRleHR1cmUgPSBtYXRlcmlhbC50ZXh0dXJlO1xyXG5cdFx0XHRzaGFkZXJPYmplY3QuY29sb3IgPSBtYXRlcmlhbC5jb2xvcjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHVibGljIGRpc3Bvc2UoKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BDbGVhclNjcmVlblBhc3NlcygpO1xyXG5cclxuXHRcdHZhciBsZW46bnVtYmVyID0gdGhpcy5fcGFzc2VzLmxlbmd0aDtcclxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IGxlbjsgaSsrKVxyXG5cdFx0XHR0aGlzLl9wYXNzZXNbaV0uZGlzcG9zZSgpO1xyXG5cclxuXHRcdHRoaXMuX3Bhc3NlcyA9IG51bGw7XHJcblxyXG5cdFx0dGhpcy5fcG9vbC5kaXNwb3NlSXRlbSh0aGlzLl9yZW5kZXJPYmplY3RPd25lcik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBpbnZhbGlkYXRlUmVuZGVyT2JqZWN0KClcclxuXHR7XHJcblx0XHR0aGlzLl9pbnZhbGlkUmVuZGVyT2JqZWN0ID0gdHJ1ZTtcclxuXHRcdHRoaXMuX2ludmFsaWRBbmltYXRpb24gPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgaW52YWxpZGF0ZVBhc3NlcygpXHJcblx0e1xyXG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyBpKyspXHJcblx0XHRcdHRoaXMuX3Bhc3Nlc1tpXS5pbnZhbGlkYXRlUGFzcygpO1xyXG5cclxuXHRcdHRoaXMuX2ludmFsaWRBbmltYXRpb24gPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgaW52YWxpZGF0ZUFuaW1hdGlvbigpXHJcblx0e1xyXG5cdFx0dGhpcy5faW52YWxpZEFuaW1hdGlvbiA9IHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqIEBwYXJhbSByZW5kZXJPYmplY3RPd25lclxyXG5cdCAqL1xyXG5cdHByaXZhdGUgX3VwZGF0ZUFuaW1hdGlvbigpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2ludmFsaWRSZW5kZXJPYmplY3QpXHJcblx0XHRcdHRoaXMuX3BVcGRhdGVSZW5kZXJPYmplY3QoKTtcclxuXHJcblx0XHR0aGlzLl9pbnZhbGlkQW5pbWF0aW9uID0gZmFsc2U7XHJcblxyXG5cdFx0dmFyIGVuYWJsZWRHUFVBbmltYXRpb246Ym9vbGVhbiA9IHRoaXMuX2dldEVuYWJsZWRHUFVBbmltYXRpb24oKTtcclxuXHJcblx0XHR2YXIgcmVuZGVyT3JkZXJJZCA9IDA7XHJcblx0XHR2YXIgbXVsdDpudW1iZXIgPSAxO1xyXG5cdFx0dmFyIHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlO1xyXG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0c2hhZGVyT2JqZWN0ID0gdGhpcy5fcGFzc2VzW2ldLnNoYWRlcjtcclxuXHJcblx0XHRcdGlmIChzaGFkZXJPYmplY3QudXNlc0FuaW1hdGlvbiAhPSBlbmFibGVkR1BVQW5pbWF0aW9uKSB7XHJcblx0XHRcdFx0c2hhZGVyT2JqZWN0LnVzZXNBbmltYXRpb24gPSBlbmFibGVkR1BVQW5pbWF0aW9uO1xyXG5cdFx0XHRcdHNoYWRlck9iamVjdC5pbnZhbGlkYXRlUHJvZ3JhbSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRyZW5kZXJPcmRlcklkICs9IHNoYWRlck9iamVjdC5wcm9ncmFtRGF0YS5pZCptdWx0O1xyXG5cdFx0XHRtdWx0ICo9IDEwMDA7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fcmVuZGVyT3JkZXJJZCA9IHJlbmRlck9yZGVySWQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBQZXJmb3JtcyBhbnkgcHJvY2Vzc2luZyB0aGF0IG5lZWRzIHRvIG9jY3VyIGJlZm9yZSBhbnkgb2YgaXRzIHBhc3NlcyBhcmUgdXNlZC5cclxuXHQgKlxyXG5cdCAqIEBwcml2YXRlXHJcblx0ICovXHJcblx0cHVibGljIF9wVXBkYXRlUmVuZGVyT2JqZWN0KClcclxuXHR7XHJcblx0XHR0aGlzLl9pbnZhbGlkUmVuZGVyT2JqZWN0ID0gZmFsc2U7XHJcblxyXG5cdFx0Ly9vdmVycnJpZGUgdG8gdXBkYXRlIHNoYWRlciBvYmplY3QgcHJvcGVydGllc1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogUmVtb3ZlcyBhIHBhc3MgZnJvbSB0aGUgcmVuZGVyT2JqZWN0T3duZXIuXHJcblx0ICogQHBhcmFtIHBhc3MgVGhlIHBhc3MgdG8gYmUgcmVtb3ZlZC5cclxuXHQgKi9cclxuXHRwdWJsaWMgX3BSZW1vdmVTY3JlZW5QYXNzKHBhc3M6UmVuZGVyUGFzc0Jhc2UpXHJcblx0e1xyXG5cdFx0cGFzcy5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50LkNIQU5HRSwgdGhpcy5fb25QYXNzQ2hhbmdlRGVsZWdhdGUpO1xyXG5cdFx0dGhpcy5fcGFzc2VzLnNwbGljZSh0aGlzLl9wYXNzZXMuaW5kZXhPZihwYXNzKSwgMSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZW1vdmVzIGFsbCBwYXNzZXMgZnJvbSB0aGUgcmVuZGVyT2JqZWN0T3duZXJcclxuXHQgKi9cclxuXHRwdWJsaWMgX3BDbGVhclNjcmVlblBhc3NlcygpXHJcblx0e1xyXG5cdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgbGVuOyArK2kpXHJcblx0XHRcdHRoaXMuX3Bhc3Nlc1tpXS5yZW1vdmVFdmVudExpc3RlbmVyKEV2ZW50LkNIQU5HRSwgdGhpcy5fb25QYXNzQ2hhbmdlRGVsZWdhdGUpO1xyXG5cclxuXHRcdHRoaXMuX3Bhc3Nlcy5sZW5ndGggPSAwO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQWRkcyBhIHBhc3MgdG8gdGhlIHJlbmRlck9iamVjdE93bmVyXHJcblx0ICogQHBhcmFtIHBhc3NcclxuXHQgKi9cclxuXHRwdWJsaWMgX3BBZGRTY3JlZW5QYXNzKHBhc3M6UmVuZGVyUGFzc0Jhc2UpXHJcblx0e1xyXG5cdFx0dGhpcy5fcGFzc2VzLnB1c2gocGFzcyk7XHJcblx0XHRwYXNzLmFkZEV2ZW50TGlzdGVuZXIoRXZlbnQuQ0hBTkdFLCB0aGlzLl9vblBhc3NDaGFuZ2VEZWxlZ2F0ZSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBMaXN0ZW5lciBmb3Igd2hlbiBhIHBhc3MncyBzaGFkZXIgY29kZSBjaGFuZ2VzLiBJdCByZWNhbGN1bGF0ZXMgdGhlIHJlbmRlciBvcmRlciBpZC5cclxuXHQgKi9cclxuXHRwcml2YXRlIG9uUGFzc0NoYW5nZShldmVudDpFdmVudClcclxuXHR7XHJcblx0XHR0aGlzLmludmFsaWRhdGVBbmltYXRpb24oKTtcclxuXHR9XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiB0ZXN0IGlmIGFuaW1hdGlvbiB3aWxsIGJlIGFibGUgdG8gcnVuIG9uIGdwdSBCRUZPUkUgY29tcGlsaW5nIG1hdGVyaWFsc1xyXG5cdCAqIHRlc3QgaWYgdGhlIHNoYWRlciBvYmplY3RzIHN1cHBvcnRzIGFuaW1hdGluZyB0aGUgYW5pbWF0aW9uIHNldCBpbiB0aGUgdmVydGV4IHNoYWRlclxyXG5cdCAqIGlmIGFueSBvYmplY3QgdXNpbmcgdGhpcyBtYXRlcmlhbCBmYWlscyB0byBzdXBwb3J0IGFjY2VsZXJhdGVkIGFuaW1hdGlvbnMgZm9yIGFueSBvZiB0aGUgc2hhZGVyIG9iamVjdHMsXHJcblx0ICogd2Ugc2hvdWxkIGRvIGV2ZXJ5dGhpbmcgb24gY3B1IChvdGhlcndpc2Ugd2UgaGF2ZSB0aGUgY29zdCBvZiBib3RoIGdwdSArIGNwdSBhbmltYXRpb25zKVxyXG5cdCAqL1xyXG5cdHByaXZhdGUgX2dldEVuYWJsZWRHUFVBbmltYXRpb24oKTpib29sZWFuXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3JlbmRlck9iamVjdE93bmVyLmFuaW1hdGlvblNldCkge1xyXG5cdFx0XHR0aGlzLl9yZW5kZXJPYmplY3RPd25lci5hbmltYXRpb25TZXQucmVzZXRHUFVDb21wYXRpYmlsaXR5KCk7XHJcblxyXG5cdFx0XHR2YXIgb3duZXJzOkFycmF5PElSZW5kZXJhYmxlT3duZXI+ID0gdGhpcy5fcmVuZGVyT2JqZWN0T3duZXIuaU93bmVycztcclxuXHRcdFx0dmFyIG51bU93bmVyczpudW1iZXIgPSBvd25lcnMubGVuZ3RoO1xyXG5cclxuXHRcdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl9wYXNzZXMubGVuZ3RoO1xyXG5cdFx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCBsZW47IGkrKylcclxuXHRcdFx0XHRmb3IgKHZhciBqOm51bWJlciA9IDA7IGogPCBudW1Pd25lcnM7IGorKylcclxuXHRcdFx0XHRcdGlmIChvd25lcnNbal0uYW5pbWF0b3IpXHJcblx0XHRcdFx0XHRcdCg8QW5pbWF0b3JCYXNlPiBvd25lcnNbal0uYW5pbWF0b3IpLnRlc3RHUFVDb21wYXRpYmlsaXR5KHRoaXMuX3Bhc3Nlc1tpXS5zaGFkZXIpO1xyXG5cclxuXHRcdFx0cmV0dXJuICF0aGlzLl9yZW5kZXJPYmplY3RPd25lci5hbmltYXRpb25TZXQudXNlc0NQVTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBSZW5kZXJPYmplY3RCYXNlOyJdfQ==