var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var ShaderRegisterElement = require("awayjs-renderergl/lib/compilation/ShaderRegisterElement");
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleNodeBase = require("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");
var ParticleRotationalVelocityState = require("awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState");
/**
 * A particle animation node used to set the starting rotational velocity of a particle.
 */
var ParticleRotationalVelocityNode = (function (_super) {
    __extends(ParticleRotationalVelocityNode, _super);
    /**
     * Creates a new <code>ParticleRotationalVelocityNode</code>
     *
     * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.
     */
    function ParticleRotationalVelocityNode(mode /*uint*/, rotationalVelocity) {
        if (rotationalVelocity === void 0) { rotationalVelocity = null; }
        _super.call(this, "ParticleRotationalVelocity", mode, 4);
        this._pStateClass = ParticleRotationalVelocityState;
        this._iRotationalVelocity = rotationalVelocity || new Vector3D();
    }
    /**
     * @inheritDoc
     */
    ParticleRotationalVelocityNode.prototype.getAGALVertexCode = function (shaderObject, animationRegisterCache) {
        var rotationRegister = (this._pMode == ParticlePropertiesMode.GLOBAL) ? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();
        animationRegisterCache.setRegisterIndex(this, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX, rotationRegister.index);
        var nrmVel = animationRegisterCache.getFreeVertexVectorTemp();
        animationRegisterCache.addVertexTempUsages(nrmVel, 1);
        var xAxis = animationRegisterCache.getFreeVertexVectorTemp();
        animationRegisterCache.addVertexTempUsages(xAxis, 1);
        var temp = animationRegisterCache.getFreeVertexVectorTemp();
        animationRegisterCache.addVertexTempUsages(temp, 1);
        var Rtemp = new ShaderRegisterElement(temp.regName, temp.index);
        var R_rev = animationRegisterCache.getFreeVertexVectorTemp();
        R_rev = new ShaderRegisterElement(R_rev.regName, R_rev.index);
        var cos = new ShaderRegisterElement(Rtemp.regName, Rtemp.index, 3);
        var sin = new ShaderRegisterElement(R_rev.regName, R_rev.index, 3);
        animationRegisterCache.removeVertexTempUsage(nrmVel);
        animationRegisterCache.removeVertexTempUsage(xAxis);
        animationRegisterCache.removeVertexTempUsage(temp);
        var code = "";
        code += "mov " + nrmVel + ".xyz," + rotationRegister + ".xyz\n";
        code += "mov " + nrmVel + ".w," + animationRegisterCache.vertexZeroConst + "\n";
        code += "mul " + cos + "," + animationRegisterCache.vertexTime + "," + rotationRegister + ".w\n";
        code += "sin " + sin + "," + cos + "\n";
        code += "cos " + cos + "," + cos + "\n";
        code += "mul " + Rtemp + ".xyz," + sin + "," + nrmVel + ".xyz\n";
        code += "mul " + R_rev + ".xyz," + sin + "," + nrmVel + ".xyz\n";
        code += "neg " + R_rev + ".xyz," + R_rev + ".xyz\n";
        //nrmVel and xAxis are used as temp register
        code += "crs " + nrmVel + ".xyz," + Rtemp + ".xyz," + animationRegisterCache.scaleAndRotateTarget + ".xyz\n";
        code += "mul " + xAxis + ".xyz," + cos + "," + animationRegisterCache.scaleAndRotateTarget + ".xyz\n";
        code += "add " + nrmVel + ".xyz," + nrmVel + ".xyz," + xAxis + ".xyz\n";
        code += "dp3 " + xAxis + ".w," + Rtemp + ".xyz," + animationRegisterCache.scaleAndRotateTarget + ".xyz\n";
        code += "neg " + nrmVel + ".w," + xAxis + ".w\n";
        code += "crs " + Rtemp + ".xyz," + nrmVel + ".xyz," + R_rev + ".xyz\n";
        //use cos as R_rev.w
        code += "mul " + xAxis + ".xyzw," + nrmVel + ".xyzw," + cos + "\n";
        code += "add " + Rtemp + ".xyz," + Rtemp + ".xyz," + xAxis + ".xyz\n";
        code += "mul " + xAxis + ".xyz," + nrmVel + ".w," + R_rev + ".xyz\n";
        code += "add " + animationRegisterCache.scaleAndRotateTarget + ".xyz," + Rtemp + ".xyz," + xAxis + ".xyz\n";
        var len = animationRegisterCache.rotationRegisters.length;
        for (var i = 0; i < len; i++) {
            code += "mov " + nrmVel + ".xyz," + rotationRegister + ".xyz\n";
            code += "mov " + nrmVel + ".w," + animationRegisterCache.vertexZeroConst + "\n";
            code += "mul " + cos + "," + animationRegisterCache.vertexTime + "," + rotationRegister + ".w\n";
            code += "sin " + sin + "," + cos + "\n";
            code += "cos " + cos + "," + cos + "\n";
            code += "mul " + Rtemp + ".xyz," + sin + "," + nrmVel + ".xyz\n";
            code += "mul " + R_rev + ".xyz," + sin + "," + nrmVel + ".xyz\n";
            code += "neg " + R_rev + ".xyz," + R_rev + ".xyz\n";
            code += "crs " + nrmVel + ".xyz," + Rtemp + ".xyz," + animationRegisterCache.rotationRegisters[i] + ".xyz\n";
            code += "mul " + xAxis + ".xyz," + cos + "," + animationRegisterCache.rotationRegisters[i] + "\n";
            code += "add " + nrmVel + ".xyz," + nrmVel + ".xyz," + xAxis + ".xyz\n";
            code += "dp3 " + xAxis + ".w," + Rtemp + ".xyz," + animationRegisterCache.rotationRegisters[i] + "\n";
            code += "neg " + nrmVel + ".w," + xAxis + ".w\n";
            code += "crs " + Rtemp + ".xyz," + nrmVel + ".xyz," + R_rev + ".xyz\n";
            code += "mul " + xAxis + ".xyzw," + nrmVel + ".xyzw," + cos + "\n";
            code += "add " + Rtemp + ".xyz," + Rtemp + ".xyz," + xAxis + ".xyz\n";
            code += "mul " + xAxis + ".xyz," + nrmVel + ".w," + R_rev + ".xyz\n";
            code += "add " + animationRegisterCache.rotationRegisters[i] + "," + Rtemp + ".xyz," + xAxis + ".xyz\n";
        }
        return code;
    };
    /**
     * @inheritDoc
     */
    ParticleRotationalVelocityNode.prototype.getAnimationState = function (animator) {
        return animator.getAnimationState(this);
    };
    /**
     * @inheritDoc
     */
    ParticleRotationalVelocityNode.prototype._iGeneratePropertyOfOneParticle = function (param) {
        //(Vector3d.x,Vector3d.y,Vector3d.z) is rotation axis,Vector3d.w is cycle duration
        var rotate = param[ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D];
        if (!rotate)
            throw (new Error("there is no " + ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D + " in param!"));
        if (rotate.length <= 0)
            rotate.z = 1; //set the default direction
        else
            rotate.normalize();
        this._pOneData[0] = rotate.x;
        this._pOneData[1] = rotate.y;
        this._pOneData[2] = rotate.z;
        if (rotate.w <= 0)
            throw (new Error("the cycle duration must greater than zero"));
        // it's used as angle/2 in agal
        this._pOneData[3] = Math.PI / rotate.w;
    };
    /**
     * Reference for rotational velocity node properties on a single particle (when in local property mode).
     * Expects a <code>Vector3D</code> object representing the rotational velocity around an axis of the particle.
     */
    ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D = "RotationalVelocityVector3D";
    return ParticleRotationalVelocityNode;
})(ParticleNodeBase);
module.exports = ParticleRotationalVelocityNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlLnRzIl0sIm5hbWVzIjpbIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZSIsIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZS5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZS5nZXRBR0FMVmVydGV4Q29kZSIsIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZS5nZXRBbmltYXRpb25TdGF0ZSIsIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZS5faUdlbmVyYXRlUHJvcGVydHlPZk9uZVBhcnRpY2xlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBaUIsK0JBQStCLENBQUMsQ0FBQztBQUtqRSxJQUFPLHFCQUFxQixXQUFhLHlEQUF5RCxDQUFDLENBQUM7QUFHcEcsSUFBTyxzQkFBc0IsV0FBYSw2REFBNkQsQ0FBQyxDQUFDO0FBQ3pHLElBQU8sZ0JBQWdCLFdBQWUsd0RBQXdELENBQUMsQ0FBQztBQUNoRyxJQUFPLCtCQUErQixXQUFXLHdFQUF3RSxDQUFDLENBQUM7QUFFM0gsQUFHQTs7R0FERztJQUNHLDhCQUE4QjtJQUFTQSxVQUF2Q0EsOEJBQThCQSxVQUF5QkE7SUFXNURBOzs7O09BSUdBO0lBQ0hBLFNBaEJLQSw4QkFBOEJBLENBZ0J2QkEsSUFBSUEsQ0FBUUEsUUFBREEsQUFBU0EsRUFBRUEsa0JBQWtDQTtRQUFsQ0Msa0NBQWtDQSxHQUFsQ0EseUJBQWtDQTtRQUVuRUEsa0JBQU1BLDRCQUE0QkEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFN0NBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLCtCQUErQkEsQ0FBQ0E7UUFFcERBLElBQUlBLENBQUNBLG9CQUFvQkEsR0FBR0Esa0JBQWtCQSxJQUFJQSxJQUFJQSxRQUFR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WUFDaEZBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLHNCQUFzQkEsQ0FBQ0EsVUFBVUEsR0FBR0EsR0FBR0EsR0FBR0EsZ0JBQWdCQSxHQUFHQSxNQUFNQSxDQUFDQTtZQUNqR0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDeENBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3hDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxDQUFDQTtZQUNqRUEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsT0FBT0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsQ0FBQ0E7WUFDakVBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE9BQU9BLEdBQUdBLEtBQUtBLEdBQUdBLFFBQVFBLENBQUNBO1lBQ3BEQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxNQUFNQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxzQkFBc0JBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0E7WUFDN0dBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLEdBQUdBLHNCQUFzQkEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUNsR0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsT0FBT0EsR0FBR0EsTUFBTUEsR0FB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QUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUN0Q0EsQ0FBQ0E7SUFwSURKOzs7T0FHR0E7SUFDV0EsMERBQTJCQSxHQUFVQSw0QkFBNEJBLENBQUNBO0lBaUlqRkEscUNBQUNBO0FBQURBLENBMUlBLEFBMElDQSxFQTFJNEMsZ0JBQWdCLEVBMEk1RDtBQUVELEFBQXdDLGlCQUEvQiw4QkFBOEIsQ0FBQyIsImZpbGUiOiJhbmltYXRvcnMvbm9kZXMvUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcblxyXG5pbXBvcnQgQW5pbWF0b3JCYXNlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9BbmltYXRvckJhc2VcIik7XHJcbmltcG9ydCBBbmltYXRpb25SZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL0FuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcIik7XHJcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJFbGVtZW50XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcclxuXHJcbmltcG9ydCBQYXJ0aWNsZVByb3BlcnRpZXNcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9QYXJ0aWNsZVByb3BlcnRpZXNcIik7XHJcbmltcG9ydCBQYXJ0aWNsZVByb3BlcnRpZXNNb2RlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL1BhcnRpY2xlUHJvcGVydGllc01vZGVcIik7XHJcbmltcG9ydCBQYXJ0aWNsZU5vZGVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvUGFydGljbGVOb2RlQmFzZVwiKTtcclxuaW1wb3J0IFBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGVcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGVcIik7XHJcblxyXG4vKipcclxuICogQSBwYXJ0aWNsZSBhbmltYXRpb24gbm9kZSB1c2VkIHRvIHNldCB0aGUgc3RhcnRpbmcgcm90YXRpb25hbCB2ZWxvY2l0eSBvZiBhIHBhcnRpY2xlLlxyXG4gKi9cclxuY2xhc3MgUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlIGV4dGVuZHMgUGFydGljbGVOb2RlQmFzZVxyXG57XHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIF9pUm90YXRpb25hbFZlbG9jaXR5OlZlY3RvcjNEO1xyXG5cclxuXHQvKipcclxuXHQgKiBSZWZlcmVuY2UgZm9yIHJvdGF0aW9uYWwgdmVsb2NpdHkgbm9kZSBwcm9wZXJ0aWVzIG9uIGEgc2luZ2xlIHBhcnRpY2xlICh3aGVuIGluIGxvY2FsIHByb3BlcnR5IG1vZGUpLlxyXG5cdCAqIEV4cGVjdHMgYSA8Y29kZT5WZWN0b3IzRDwvY29kZT4gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgcm90YXRpb25hbCB2ZWxvY2l0eSBhcm91bmQgYW4gYXhpcyBvZiB0aGUgcGFydGljbGUuXHJcblx0ICovXHJcblx0cHVibGljIHN0YXRpYyBST1RBVElPTkFMVkVMT0NJVFlfVkVDVE9SM0Q6c3RyaW5nID0gXCJSb3RhdGlvbmFsVmVsb2NpdHlWZWN0b3IzRFwiO1xyXG5cclxuXHQvKipcclxuXHQgKiBDcmVhdGVzIGEgbmV3IDxjb2RlPlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZTwvY29kZT5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSAgICAgICAgICAgICAgIG1vZGUgICAgICAgICAgICBEZWZpbmVzIHdoZXRoZXIgdGhlIG1vZGUgb2Ygb3BlcmF0aW9uIGFjdHMgb24gbG9jYWwgcHJvcGVydGllcyBvZiBhIHBhcnRpY2xlIG9yIGdsb2JhbCBwcm9wZXJ0aWVzIG9mIHRoZSBub2RlLlxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKG1vZGU6bnVtYmVyIC8qdWludCovLCByb3RhdGlvbmFsVmVsb2NpdHk6VmVjdG9yM0QgPSBudWxsKVxyXG5cdHtcclxuXHRcdHN1cGVyKFwiUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlcIiwgbW9kZSwgNCk7XHJcblxyXG5cdFx0dGhpcy5fcFN0YXRlQ2xhc3MgPSBQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eVN0YXRlO1xyXG5cclxuXHRcdHRoaXMuX2lSb3RhdGlvbmFsVmVsb2NpdHkgPSByb3RhdGlvbmFsVmVsb2NpdHkgfHwgbmV3IFZlY3RvcjNEKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXRBR0FMVmVydGV4Q29kZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZTpBbmltYXRpb25SZWdpc3RlckNhY2hlKTpzdHJpbmdcclxuXHR7XHJcblx0XHR2YXIgcm90YXRpb25SZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSAodGhpcy5fcE1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5HTE9CQUwpPyBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpIDogYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4QXR0cmlidXRlKCk7XHJcblx0XHRhbmltYXRpb25SZWdpc3RlckNhY2hlLnNldFJlZ2lzdGVySW5kZXgodGhpcywgUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlTdGF0ZS5ST1RBVElPTkFMVkVMT0NJVFlfSU5ERVgsIHJvdGF0aW9uUmVnaXN0ZXIuaW5kZXgpO1xyXG5cclxuXHRcdHZhciBucm1WZWw6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4VmVjdG9yVGVtcCgpO1xyXG5cdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5hZGRWZXJ0ZXhUZW1wVXNhZ2VzKG5ybVZlbCwgMSk7XHJcblxyXG5cdFx0dmFyIHhBeGlzOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleFZlY3RvclRlbXAoKTtcclxuXHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuYWRkVmVydGV4VGVtcFVzYWdlcyh4QXhpcywgMSk7XHJcblxyXG5cdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4VmVjdG9yVGVtcCgpO1xyXG5cdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5hZGRWZXJ0ZXhUZW1wVXNhZ2VzKHRlbXAsIDEpO1xyXG5cdFx0dmFyIFJ0ZW1wOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQodGVtcC5yZWdOYW1lLCB0ZW1wLmluZGV4KTtcclxuXHRcdHZhciBSX3JldjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhWZWN0b3JUZW1wKCk7XHJcblx0XHRSX3JldiA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQoUl9yZXYucmVnTmFtZSwgUl9yZXYuaW5kZXgpO1xyXG5cclxuXHRcdHZhciBjb3M6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudChSdGVtcC5yZWdOYW1lLCBSdGVtcC5pbmRleCwgMyk7XHJcblx0XHR2YXIgc2luOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQoUl9yZXYucmVnTmFtZSwgUl9yZXYuaW5kZXgsIDMpO1xyXG5cclxuXHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUucmVtb3ZlVmVydGV4VGVtcFVzYWdlKG5ybVZlbCk7XHJcblx0XHRhbmltYXRpb25SZWdpc3RlckNhY2hlLnJlbW92ZVZlcnRleFRlbXBVc2FnZSh4QXhpcyk7XHJcblx0XHRhbmltYXRpb25SZWdpc3RlckNhY2hlLnJlbW92ZVZlcnRleFRlbXBVc2FnZSh0ZW1wKTtcclxuXHJcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xyXG5cdFx0Y29kZSArPSBcIm1vdiBcIiArIG5ybVZlbCArIFwiLnh5eixcIiArIHJvdGF0aW9uUmVnaXN0ZXIgKyBcIi54eXpcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJtb3YgXCIgKyBucm1WZWwgKyBcIi53LFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS52ZXJ0ZXhaZXJvQ29uc3QgKyBcIlxcblwiO1xyXG5cclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBjb3MgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4VGltZSArIFwiLFwiICsgcm90YXRpb25SZWdpc3RlciArIFwiLndcXG5cIjtcclxuXHJcblx0XHRjb2RlICs9IFwic2luIFwiICsgc2luICsgXCIsXCIgKyBjb3MgKyBcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcImNvcyBcIiArIGNvcyArIFwiLFwiICsgY29zICsgXCJcXG5cIjtcclxuXHJcblx0XHRjb2RlICs9IFwibXVsIFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyBzaW4gKyBcIixcIiArIG5ybVZlbCArIFwiLnh5elxcblwiO1xyXG5cclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBSX3JldiArIFwiLnh5eixcIiArIHNpbiArIFwiLFwiICsgbnJtVmVsICsgXCIueHl6XFxuXCI7XHJcblx0XHRjb2RlICs9IFwibmVnIFwiICsgUl9yZXYgKyBcIi54eXosXCIgKyBSX3JldiArIFwiLnh5elxcblwiO1xyXG5cclxuXHRcdC8vbnJtVmVsIGFuZCB4QXhpcyBhcmUgdXNlZCBhcyB0ZW1wIHJlZ2lzdGVyXHJcblx0XHRjb2RlICs9IFwiY3JzIFwiICsgbnJtVmVsICsgXCIueHl6LFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnNjYWxlQW5kUm90YXRlVGFyZ2V0ICsgXCIueHl6XFxuXCI7XHJcblxyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHhBeGlzICsgXCIueHl6LFwiICsgY29zICsgXCIsXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnNjYWxlQW5kUm90YXRlVGFyZ2V0ICsgXCIueHl6XFxuXCI7XHJcblx0XHRjb2RlICs9IFwiYWRkIFwiICsgbnJtVmVsICsgXCIueHl6LFwiICsgbnJtVmVsICsgXCIueHl6LFwiICsgeEF4aXMgKyBcIi54eXpcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJkcDMgXCIgKyB4QXhpcyArIFwiLncsXCIgKyBSdGVtcCArIFwiLnh5eixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2NhbGVBbmRSb3RhdGVUYXJnZXQgKyBcIi54eXpcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJuZWcgXCIgKyBucm1WZWwgKyBcIi53LFwiICsgeEF4aXMgKyBcIi53XFxuXCI7XHJcblxyXG5cdFx0Y29kZSArPSBcImNycyBcIiArIFJ0ZW1wICsgXCIueHl6LFwiICsgbnJtVmVsICsgXCIueHl6LFwiICsgUl9yZXYgKyBcIi54eXpcXG5cIjtcclxuXHJcblx0XHQvL3VzZSBjb3MgYXMgUl9yZXYud1xyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHhBeGlzICsgXCIueHl6dyxcIiArIG5ybVZlbCArIFwiLnh5encsXCIgKyBjb3MgKyBcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcImFkZCBcIiArIFJ0ZW1wICsgXCIueHl6LFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyB4QXhpcyArIFwiLnh5elxcblwiO1xyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHhBeGlzICsgXCIueHl6LFwiICsgbnJtVmVsICsgXCIudyxcIiArIFJfcmV2ICsgXCIueHl6XFxuXCI7XHJcblxyXG5cdFx0Y29kZSArPSBcImFkZCBcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2NhbGVBbmRSb3RhdGVUYXJnZXQgKyBcIi54eXosXCIgKyBSdGVtcCArIFwiLnh5eixcIiArIHhBeGlzICsgXCIueHl6XFxuXCI7XHJcblxyXG5cdFx0dmFyIGxlbjpudW1iZXIgLyppbnQqLyA9IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUucm90YXRpb25SZWdpc3RlcnMubGVuZ3RoO1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgLyppbnQqLyA9IDA7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRjb2RlICs9IFwibW92IFwiICsgbnJtVmVsICsgXCIueHl6LFwiICsgcm90YXRpb25SZWdpc3RlciArIFwiLnh5elxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwibW92IFwiICsgbnJtVmVsICsgXCIudyxcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4WmVyb0NvbnN0ICsgXCJcXG5cIjtcclxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIGNvcyArIFwiLFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS52ZXJ0ZXhUaW1lICsgXCIsXCIgKyByb3RhdGlvblJlZ2lzdGVyICsgXCIud1xcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwic2luIFwiICsgc2luICsgXCIsXCIgKyBjb3MgKyBcIlxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwiY29zIFwiICsgY29zICsgXCIsXCIgKyBjb3MgKyBcIlxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwibXVsIFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyBzaW4gKyBcIixcIiArIG5ybVZlbCArIFwiLnh5elxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwibXVsIFwiICsgUl9yZXYgKyBcIi54eXosXCIgKyBzaW4gKyBcIixcIiArIG5ybVZlbCArIFwiLnh5elxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwibmVnIFwiICsgUl9yZXYgKyBcIi54eXosXCIgKyBSX3JldiArIFwiLnh5elxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwiY3JzIFwiICsgbnJtVmVsICsgXCIueHl6LFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnJvdGF0aW9uUmVnaXN0ZXJzW2ldICsgXCIueHl6XFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB4QXhpcyArIFwiLnh5eixcIiArIGNvcyArIFwiLFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5yb3RhdGlvblJlZ2lzdGVyc1tpXSArIFwiXFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyBucm1WZWwgKyBcIi54eXosXCIgKyBucm1WZWwgKyBcIi54eXosXCIgKyB4QXhpcyArIFwiLnh5elxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwiZHAzIFwiICsgeEF4aXMgKyBcIi53LFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnJvdGF0aW9uUmVnaXN0ZXJzW2ldICsgXCJcXG5cIjtcclxuXHRcdFx0Y29kZSArPSBcIm5lZyBcIiArIG5ybVZlbCArIFwiLncsXCIgKyB4QXhpcyArIFwiLndcXG5cIjtcclxuXHRcdFx0Y29kZSArPSBcImNycyBcIiArIFJ0ZW1wICsgXCIueHl6LFwiICsgbnJtVmVsICsgXCIueHl6LFwiICsgUl9yZXYgKyBcIi54eXpcXG5cIjtcclxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHhBeGlzICsgXCIueHl6dyxcIiArIG5ybVZlbCArIFwiLnh5encsXCIgKyBjb3MgKyBcIlxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyBSdGVtcCArIFwiLnh5eixcIiArIHhBeGlzICsgXCIueHl6XFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB4QXhpcyArIFwiLnh5eixcIiArIG5ybVZlbCArIFwiLncsXCIgKyBSX3JldiArIFwiLnh5elxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5yb3RhdGlvblJlZ2lzdGVyc1tpXSArIFwiLFwiICsgUnRlbXAgKyBcIi54eXosXCIgKyB4QXhpcyArIFwiLnh5elxcblwiO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXRBbmltYXRpb25TdGF0ZShhbmltYXRvcjpBbmltYXRvckJhc2UpOlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGVcclxuXHR7XHJcblx0XHRyZXR1cm4gPFBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGU+IGFuaW1hdG9yLmdldEFuaW1hdGlvblN0YXRlKHRoaXMpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgX2lHZW5lcmF0ZVByb3BlcnR5T2ZPbmVQYXJ0aWNsZShwYXJhbTpQYXJ0aWNsZVByb3BlcnRpZXMpXHJcblx0e1xyXG5cdFx0Ly8oVmVjdG9yM2QueCxWZWN0b3IzZC55LFZlY3RvcjNkLnopIGlzIHJvdGF0aW9uIGF4aXMsVmVjdG9yM2QudyBpcyBjeWNsZSBkdXJhdGlvblxyXG5cdFx0dmFyIHJvdGF0ZTpWZWN0b3IzRCA9IHBhcmFtW1BhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZS5ST1RBVElPTkFMVkVMT0NJVFlfVkVDVE9SM0RdO1xyXG5cdFx0aWYgKCFyb3RhdGUpXHJcblx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZXJlIGlzIG5vIFwiICsgUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlLlJPVEFUSU9OQUxWRUxPQ0lUWV9WRUNUT1IzRCArIFwiIGluIHBhcmFtIVwiKSk7XHJcblxyXG5cdFx0aWYgKHJvdGF0ZS5sZW5ndGggPD0gMClcclxuXHRcdFx0cm90YXRlLnogPSAxOyAvL3NldCB0aGUgZGVmYXVsdCBkaXJlY3Rpb25cclxuXHRcdGVsc2VcclxuXHRcdFx0cm90YXRlLm5vcm1hbGl6ZSgpO1xyXG5cclxuXHRcdHRoaXMuX3BPbmVEYXRhWzBdID0gcm90YXRlLng7XHJcblx0XHR0aGlzLl9wT25lRGF0YVsxXSA9IHJvdGF0ZS55O1xyXG5cdFx0dGhpcy5fcE9uZURhdGFbMl0gPSByb3RhdGUuejtcclxuXHRcdGlmIChyb3RhdGUudyA8PSAwKVxyXG5cdFx0XHR0aHJvdyhuZXcgRXJyb3IoXCJ0aGUgY3ljbGUgZHVyYXRpb24gbXVzdCBncmVhdGVyIHRoYW4gemVyb1wiKSk7XHJcblx0XHQvLyBpdCdzIHVzZWQgYXMgYW5nbGUvMiBpbiBhZ2FsXHJcblx0XHR0aGlzLl9wT25lRGF0YVszXSA9IE1hdGguUEkvcm90YXRlLnc7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eU5vZGU7Il19