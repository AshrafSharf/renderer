var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ColorTransform = require("awayjs-core/lib/geom/ColorTransform");
var ParticleAnimationSet = require("awayjs-renderergl/lib/animators/ParticleAnimationSet");
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleNodeBase = require("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");
var ParticleInitialColorState = require("awayjs-renderergl/lib/animators/states/ParticleInitialColorState");
/**
 *
 */
var ParticleInitialColorNode = (function (_super) {
    __extends(ParticleInitialColorNode, _super);
    function ParticleInitialColorNode(mode /*uint*/, usesMultiplier, usesOffset, initialColor) {
        if (usesMultiplier === void 0) { usesMultiplier = true; }
        if (usesOffset === void 0) { usesOffset = false; }
        if (initialColor === void 0) { initialColor = null; }
        _super.call(this, "ParticleInitialColor", mode, (usesMultiplier && usesOffset) ? 8 : 4, ParticleAnimationSet.COLOR_PRIORITY);
        this._pStateClass = ParticleInitialColorState;
        this._iUsesMultiplier = usesMultiplier;
        this._iUsesOffset = usesOffset;
        this._iInitialColor = initialColor || new ColorTransform();
    }
    /**
     * @inheritDoc
     */
    ParticleInitialColorNode.prototype.getAGALVertexCode = function (shaderObject, animationRegisterCache) {
        var code = "";
        if (animationRegisterCache.needFragmentAnimation) {
            if (this._iUsesMultiplier) {
                var multiplierValue = (this._pMode == ParticlePropertiesMode.GLOBAL) ? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();
                animationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.MULTIPLIER_INDEX, multiplierValue.index);
                code += "mul " + animationRegisterCache.colorMulTarget + "," + multiplierValue + "," + animationRegisterCache.colorMulTarget + "\n";
            }
            if (this._iUsesOffset) {
                var offsetValue = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC) ? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();
                animationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.OFFSET_INDEX, offsetValue.index);
                code += "add " + animationRegisterCache.colorAddTarget + "," + offsetValue + "," + animationRegisterCache.colorAddTarget + "\n";
            }
        }
        return code;
    };
    /**
     * @inheritDoc
     */
    ParticleInitialColorNode.prototype._iProcessAnimationSetting = function (particleAnimationSet) {
        if (this._iUsesMultiplier)
            particleAnimationSet.hasColorMulNode = true;
        if (this._iUsesOffset)
            particleAnimationSet.hasColorAddNode = true;
    };
    /**
     * @inheritDoc
     */
    ParticleInitialColorNode.prototype._iGeneratePropertyOfOneParticle = function (param) {
        var initialColor = param[ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM];
        if (!initialColor)
            throw (new Error("there is no " + ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM + " in param!"));
        var i = 0;
        //multiplier
        if (this._iUsesMultiplier) {
            this._pOneData[i++] = initialColor.redMultiplier;
            this._pOneData[i++] = initialColor.greenMultiplier;
            this._pOneData[i++] = initialColor.blueMultiplier;
            this._pOneData[i++] = initialColor.alphaMultiplier;
        }
        //offset
        if (this._iUsesOffset) {
            this._pOneData[i++] = initialColor.redOffset / 255;
            this._pOneData[i++] = initialColor.greenOffset / 255;
            this._pOneData[i++] = initialColor.blueOffset / 255;
            this._pOneData[i++] = initialColor.alphaOffset / 255;
        }
    };
    /**
     * Reference for color node properties on a single particle (when in local property mode).
     * Expects a <code>ColorTransform</code> object representing the color transform applied to the particle.
     */
    ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM = "ColorInitialColorTransform";
    return ParticleInitialColorNode;
})(ParticleNodeBase);
module.exports = ParticleInitialColorNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvUGFydGljbGVJbml0aWFsQ29sb3JOb2RlLnRzIl0sIm5hbWVzIjpbIlBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZSIsIlBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZS5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZS5nZXRBR0FMVmVydGV4Q29kZSIsIlBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZS5faVByb2Nlc3NBbmltYXRpb25TZXR0aW5nIiwiUGFydGljbGVJbml0aWFsQ29sb3JOb2RlLl9pR2VuZXJhdGVQcm9wZXJ0eU9mT25lUGFydGljbGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sY0FBYyxXQUFlLHFDQUFxQyxDQUFDLENBQUM7QUFRM0UsSUFBTyxvQkFBb0IsV0FBYyxzREFBc0QsQ0FBQyxDQUFDO0FBRWpHLElBQU8sc0JBQXNCLFdBQWEsNkRBQTZELENBQUMsQ0FBQztBQUN6RyxJQUFPLGdCQUFnQixXQUFlLHdEQUF3RCxDQUFDLENBQUM7QUFDaEcsSUFBTyx5QkFBeUIsV0FBWSxrRUFBa0UsQ0FBQyxDQUFDO0FBRWhILEFBR0E7O0dBREc7SUFDRyx3QkFBd0I7SUFBU0EsVUFBakNBLHdCQUF3QkEsVUFBeUJBO0lBZ0J0REEsU0FoQktBLHdCQUF3QkEsQ0FnQmpCQSxJQUFJQSxDQUFRQSxRQUFEQSxBQUFTQSxFQUFFQSxjQUE2QkEsRUFBRUEsVUFBMEJBLEVBQUVBLFlBQWtDQTtRQUE3RkMsOEJBQTZCQSxHQUE3QkEscUJBQTZCQTtRQUFFQSwwQkFBMEJBLEdBQTFCQSxrQkFBMEJBO1FBQUVBLDRCQUFrQ0EsR0FBbENBLG1CQUFrQ0E7UUFFOUhBLGtCQUFNQSxzQkFBc0JBLEVBQUVBLElBQUlBLEVBQUVBLENBQUNBLGNBQWNBLElBQUlBLFVBQVVBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLG9CQUFvQkEsQ0FBQ0EsY0FBY0Es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QSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxZQUFZQSxDQUFDQSxXQUFXQSxHQUFDQSxHQUFHQSxDQUFDQTtRQUNwREEsQ0FBQ0E7SUFFRkEsQ0FBQ0E7SUFoRkRKOzs7T0FHR0E7SUFDV0EscURBQTRCQSxHQUFVQSw0QkFBNEJBLENBQUNBO0lBOEVsRkEsK0JBQUNBO0FBQURBLENBNUZBLEFBNEZDQSxFQTVGc0MsZ0JBQWdCLEVBNEZ0RDtBQUVELEFBQWtDLGlCQUF6Qix3QkFBd0IsQ0FBQyIsImZpbGUiOiJhbmltYXRvcnMvbm9kZXMvUGFydGljbGVJbml0aWFsQ29sb3JOb2RlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb2xvclRyYW5zZm9ybVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9Db2xvclRyYW5zZm9ybVwiKTtcclxuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuXHJcbmltcG9ydCBBbmltYXRvckJhc2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL0FuaW1hdG9yQmFzZVwiKTtcclxuaW1wb3J0IEFuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvQW5pbWF0aW9uUmVnaXN0ZXJDYWNoZVwiKTtcclxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5cclxuaW1wb3J0IFBhcnRpY2xlQW5pbWF0aW9uU2V0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL1BhcnRpY2xlQW5pbWF0aW9uU2V0XCIpO1xyXG5pbXBvcnQgUGFydGljbGVQcm9wZXJ0aWVzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVQcm9wZXJ0aWVzXCIpO1xyXG5pbXBvcnQgUGFydGljbGVQcm9wZXJ0aWVzTW9kZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9QYXJ0aWNsZVByb3BlcnRpZXNNb2RlXCIpO1xyXG5pbXBvcnQgUGFydGljbGVOb2RlQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL25vZGVzL1BhcnRpY2xlTm9kZUJhc2VcIik7XHJcbmltcG9ydCBQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlXHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlSW5pdGlhbENvbG9yU3RhdGVcIik7XHJcblxyXG4vKipcclxuICpcclxuICovXHJcbmNsYXNzIFBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZSBleHRlbmRzIFBhcnRpY2xlTm9kZUJhc2Vcclxue1xyXG5cdC8vZGVmYXVsdCB2YWx1ZXMgdXNlZCB3aGVuIGNyZWF0aW5nIHN0YXRlc1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaVVzZXNNdWx0aXBsaWVyOmJvb2xlYW47XHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIF9pVXNlc09mZnNldDpib29sZWFuO1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaUluaXRpYWxDb2xvcjpDb2xvclRyYW5zZm9ybTtcclxuXHJcblx0LyoqXHJcblx0ICogUmVmZXJlbmNlIGZvciBjb2xvciBub2RlIHByb3BlcnRpZXMgb24gYSBzaW5nbGUgcGFydGljbGUgKHdoZW4gaW4gbG9jYWwgcHJvcGVydHkgbW9kZSkuXHJcblx0ICogRXhwZWN0cyBhIDxjb2RlPkNvbG9yVHJhbnNmb3JtPC9jb2RlPiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBjb2xvciB0cmFuc2Zvcm0gYXBwbGllZCB0byB0aGUgcGFydGljbGUuXHJcblx0ICovXHJcblx0cHVibGljIHN0YXRpYyBDT0xPUl9JTklUSUFMX0NPTE9SVFJBTlNGT1JNOnN0cmluZyA9IFwiQ29sb3JJbml0aWFsQ29sb3JUcmFuc2Zvcm1cIjtcclxuXHJcblx0Y29uc3RydWN0b3IobW9kZTpudW1iZXIgLyp1aW50Ki8sIHVzZXNNdWx0aXBsaWVyOmJvb2xlYW4gPSB0cnVlLCB1c2VzT2Zmc2V0OmJvb2xlYW4gPSBmYWxzZSwgaW5pdGlhbENvbG9yOkNvbG9yVHJhbnNmb3JtID0gbnVsbClcclxuXHR7XHJcblx0XHRzdXBlcihcIlBhcnRpY2xlSW5pdGlhbENvbG9yXCIsIG1vZGUsICh1c2VzTXVsdGlwbGllciAmJiB1c2VzT2Zmc2V0KT8gOCA6IDQsIFBhcnRpY2xlQW5pbWF0aW9uU2V0LkNPTE9SX1BSSU9SSVRZKTtcclxuXHJcblx0XHR0aGlzLl9wU3RhdGVDbGFzcyA9IFBhcnRpY2xlSW5pdGlhbENvbG9yU3RhdGU7XHJcblxyXG5cdFx0dGhpcy5faVVzZXNNdWx0aXBsaWVyID0gdXNlc011bHRpcGxpZXI7XHJcblx0XHR0aGlzLl9pVXNlc09mZnNldCA9IHVzZXNPZmZzZXQ7XHJcblx0XHR0aGlzLl9pSW5pdGlhbENvbG9yID0gaW5pdGlhbENvbG9yIHx8IG5ldyBDb2xvclRyYW5zZm9ybSgpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0QUdBTFZlcnRleENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGU6QW5pbWF0aW9uUmVnaXN0ZXJDYWNoZSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHRcdGlmIChhbmltYXRpb25SZWdpc3RlckNhY2hlLm5lZWRGcmFnbWVudEFuaW1hdGlvbikge1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX2lVc2VzTXVsdGlwbGllcikge1xyXG5cdFx0XHRcdHZhciBtdWx0aXBsaWVyVmFsdWU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gKHRoaXMuX3BNb2RlID09IFBhcnRpY2xlUHJvcGVydGllc01vZGUuR0xPQkFMKT8gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKSA6IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleEF0dHJpYnV0ZSgpO1xyXG5cdFx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2V0UmVnaXN0ZXJJbmRleCh0aGlzLCBQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlLk1VTFRJUExJRVJfSU5ERVgsIG11bHRpcGxpZXJWYWx1ZS5pbmRleCk7XHJcblxyXG5cdFx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLmNvbG9yTXVsVGFyZ2V0ICsgXCIsXCIgKyBtdWx0aXBsaWVyVmFsdWUgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuY29sb3JNdWxUYXJnZXQgKyBcIlxcblwiO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAodGhpcy5faVVzZXNPZmZzZXQpIHtcclxuXHRcdFx0XHR2YXIgb2Zmc2V0VmFsdWU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gKHRoaXMuX3BNb2RlID09IFBhcnRpY2xlUHJvcGVydGllc01vZGUuTE9DQUxfU1RBVElDKT8gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4QXR0cmlidXRlKCkgOiBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xyXG5cdFx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2V0UmVnaXN0ZXJJbmRleCh0aGlzLCBQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlLk9GRlNFVF9JTkRFWCwgb2Zmc2V0VmFsdWUuaW5kZXgpO1xyXG5cclxuXHRcdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5jb2xvckFkZFRhcmdldCArIFwiLFwiICsgb2Zmc2V0VmFsdWUgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuY29sb3JBZGRUYXJnZXQgKyBcIlxcblwiO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfaVByb2Nlc3NBbmltYXRpb25TZXR0aW5nKHBhcnRpY2xlQW5pbWF0aW9uU2V0OlBhcnRpY2xlQW5pbWF0aW9uU2V0KVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9pVXNlc011bHRpcGxpZXIpXHJcblx0XHRcdHBhcnRpY2xlQW5pbWF0aW9uU2V0Lmhhc0NvbG9yTXVsTm9kZSA9IHRydWU7XHJcblx0XHRpZiAodGhpcy5faVVzZXNPZmZzZXQpXHJcblx0XHRcdHBhcnRpY2xlQW5pbWF0aW9uU2V0Lmhhc0NvbG9yQWRkTm9kZSA9IHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfaUdlbmVyYXRlUHJvcGVydHlPZk9uZVBhcnRpY2xlKHBhcmFtOlBhcnRpY2xlUHJvcGVydGllcylcclxuXHR7XHJcblx0XHR2YXIgaW5pdGlhbENvbG9yOkNvbG9yVHJhbnNmb3JtID0gcGFyYW1bUGFydGljbGVJbml0aWFsQ29sb3JOb2RlLkNPTE9SX0lOSVRJQUxfQ09MT1JUUkFOU0ZPUk1dO1xyXG5cdFx0aWYgKCFpbml0aWFsQ29sb3IpXHJcblx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZXJlIGlzIG5vIFwiICsgUGFydGljbGVJbml0aWFsQ29sb3JOb2RlLkNPTE9SX0lOSVRJQUxfQ09MT1JUUkFOU0ZPUk0gKyBcIiBpbiBwYXJhbSFcIikpO1xyXG5cclxuXHRcdHZhciBpOm51bWJlciAvKnVpbnQqLyA9IDA7XHJcblxyXG5cdFx0Ly9tdWx0aXBsaWVyXHJcblx0XHRpZiAodGhpcy5faVVzZXNNdWx0aXBsaWVyKSB7XHJcblx0XHRcdHRoaXMuX3BPbmVEYXRhW2krK10gPSBpbml0aWFsQ29sb3IucmVkTXVsdGlwbGllcjtcclxuXHRcdFx0dGhpcy5fcE9uZURhdGFbaSsrXSA9IGluaXRpYWxDb2xvci5ncmVlbk11bHRpcGxpZXI7XHJcblx0XHRcdHRoaXMuX3BPbmVEYXRhW2krK10gPSBpbml0aWFsQ29sb3IuYmx1ZU11bHRpcGxpZXI7XHJcblx0XHRcdHRoaXMuX3BPbmVEYXRhW2krK10gPSBpbml0aWFsQ29sb3IuYWxwaGFNdWx0aXBsaWVyO1xyXG5cdFx0fVxyXG5cdFx0Ly9vZmZzZXRcclxuXHRcdGlmICh0aGlzLl9pVXNlc09mZnNldCkge1xyXG5cdFx0XHR0aGlzLl9wT25lRGF0YVtpKytdID0gaW5pdGlhbENvbG9yLnJlZE9mZnNldC8yNTU7XHJcblx0XHRcdHRoaXMuX3BPbmVEYXRhW2krK10gPSBpbml0aWFsQ29sb3IuZ3JlZW5PZmZzZXQvMjU1O1xyXG5cdFx0XHR0aGlzLl9wT25lRGF0YVtpKytdID0gaW5pdGlhbENvbG9yLmJsdWVPZmZzZXQvMjU1O1xyXG5cdFx0XHR0aGlzLl9wT25lRGF0YVtpKytdID0gaW5pdGlhbENvbG9yLmFscGhhT2Zmc2V0LzI1NTtcclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxufVxyXG5cclxuZXhwb3J0ID0gUGFydGljbGVJbml0aWFsQ29sb3JOb2RlOyJdfQ==