var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShaderRegisterElement = require("awayjs-renderergl/lib/compilation/ShaderRegisterElement");
var ParticleAnimationSet = require("awayjs-renderergl/lib/animators/ParticleAnimationSet");
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleNodeBase = require("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");
var ParticleSpriteSheetState = require("awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState");
/**
 * A particle animation node used when a spritesheet texture is required to animate the particle.
 * NB: to enable use of this node, the <code>repeat</code> property on the material has to be set to true.
 */
var ParticleSpriteSheetNode = (function (_super) {
    __extends(ParticleSpriteSheetNode, _super);
    /**
     * Creates a new <code>ParticleSpriteSheetNode</code>
     *
     * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.
     * @param    [optional] numColumns      Defines the number of columns in the spritesheet, when in global mode. Defaults to 1.
     * @param    [optional] numRows         Defines the number of rows in the spritesheet, when in global mode. Defaults to 1.
     * @param    [optional] cycleDuration   Defines the default cycle duration in seconds, when in global mode. Defaults to 1.
     * @param    [optional] cyclePhase      Defines the default cycle phase, when in global mode. Defaults to 0.
     * @param    [optional] totalFrames     Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows.
     * @param    [optional] looping         Defines whether the spritesheet animation is set to loop indefinitely. Defaults to true.
     */
    function ParticleSpriteSheetNode(mode /*uint*/, usesCycle, usesPhase, numColumns, numRows, cycleDuration, cyclePhase, totalFrames) {
        if (numColumns === void 0) { numColumns = 1; }
        if (numRows === void 0) { numRows = 1; }
        if (cycleDuration === void 0) { cycleDuration = 1; }
        if (cyclePhase === void 0) { cyclePhase = 0; }
        if (totalFrames === void 0) { totalFrames = Number.MAX_VALUE; }
        _super.call(this, "ParticleSpriteSheet", mode, usesCycle ? (usesPhase ? 3 : 2) : 1, ParticleAnimationSet.POST_PRIORITY + 1);
        this._pStateClass = ParticleSpriteSheetState;
        this._iUsesCycle = usesCycle;
        this._iUsesPhase = usesPhase;
        this._iNumColumns = numColumns;
        this._iNumRows = numRows;
        this._iCyclePhase = cyclePhase;
        this._iCycleDuration = cycleDuration;
        this._iTotalFrames = Math.min(totalFrames, numColumns * numRows);
    }
    Object.defineProperty(ParticleSpriteSheetNode.prototype, "numColumns", {
        /**
         * Defines the number of columns in the spritesheet, when in global mode. Defaults to 1. Read only.
         */
        get: function () {
            return this._iNumColumns;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ParticleSpriteSheetNode.prototype, "numRows", {
        /**
         * Defines the number of rows in the spritesheet, when in global mode. Defaults to 1. Read only.
         */
        get: function () {
            return this._iNumRows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ParticleSpriteSheetNode.prototype, "totalFrames", {
        /**
         * Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows. Read only.
         */
        get: function () {
            return this._iTotalFrames;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype.getAGALUVCode = function (shaderObject, animationRegisterCache) {
        //get 2 vc
        var uvParamConst1 = animationRegisterCache.getFreeVertexConstant();
        var uvParamConst2 = (this._pMode == ParticlePropertiesMode.GLOBAL) ? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();
        animationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_0, uvParamConst1.index);
        animationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_1, uvParamConst2.index);
        var uTotal = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 0);
        var uStep = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 1);
        var vStep = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 2);
        var uSpeed = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 0);
        var cycle = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 1);
        var phaseTime = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 2);
        var temp = animationRegisterCache.getFreeVertexVectorTemp();
        var time = new ShaderRegisterElement(temp.regName, temp.index, 0);
        var vOffset = new ShaderRegisterElement(temp.regName, temp.index, 1);
        temp = new ShaderRegisterElement(temp.regName, temp.index, 2);
        var temp2 = new ShaderRegisterElement(temp.regName, temp.index, 3);
        var u = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 0);
        var v = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 1);
        var code = "";
        //scale uv
        code += "mul " + u + "," + u + "," + uStep + "\n";
        if (this._iNumRows > 1)
            code += "mul " + v + "," + v + "," + vStep + "\n";
        if (this._iUsesCycle) {
            if (this._iUsesPhase)
                code += "add " + time + "," + animationRegisterCache.vertexTime + "," + phaseTime + "\n";
            else
                code += "mov " + time + "," + animationRegisterCache.vertexTime + "\n";
            code += "div " + time + "," + time + "," + cycle + "\n";
            code += "frc " + time + "," + time + "\n";
            code += "mul " + time + "," + time + "," + cycle + "\n";
            code += "mul " + temp + "," + time + "," + uSpeed + "\n";
        }
        else
            code += "mul " + temp.toString() + "," + animationRegisterCache.vertexLife + "," + uTotal + "\n";
        if (this._iNumRows > 1) {
            code += "frc " + temp2 + "," + temp + "\n";
            code += "sub " + vOffset + "," + temp + "," + temp2 + "\n";
            code += "mul " + vOffset + "," + vOffset + "," + vStep + "\n";
            code += "add " + v + "," + v + "," + vOffset + "\n";
        }
        code += "div " + temp2 + "," + temp + "," + uStep + "\n";
        code += "frc " + temp + "," + temp2 + "\n";
        code += "sub " + temp2 + "," + temp2 + "," + temp + "\n";
        code += "mul " + temp + "," + temp2 + "," + uStep + "\n";
        if (this._iNumRows > 1)
            code += "frc " + temp + "," + temp + "\n";
        code += "add " + u + "," + u + "," + temp + "\n";
        return code;
    };
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype.getAnimationState = function (animator) {
        return animator.getAnimationState(this);
    };
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype._iProcessAnimationSetting = function (particleAnimationSet) {
        particleAnimationSet.hasUVNode = true;
    };
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype._iGeneratePropertyOfOneParticle = function (param) {
        if (this._iUsesCycle) {
            var uvCycle = param[ParticleSpriteSheetNode.UV_VECTOR3D];
            if (!uvCycle)
                throw (new Error("there is no " + ParticleSpriteSheetNode.UV_VECTOR3D + " in param!"));
            if (uvCycle.x <= 0)
                throw (new Error("the cycle duration must be greater than zero"));
            var uTotal = this._iTotalFrames / this._iNumColumns;
            this._pOneData[0] = uTotal / uvCycle.x;
            this._pOneData[1] = uvCycle.x;
            if (this._iUsesPhase)
                this._pOneData[2] = uvCycle.y;
        }
    };
    /**
     * Reference for spritesheet node properties on a single particle (when in local property mode).
     * Expects a <code>Vector3D</code> representing the cycleDuration (x), optional phaseTime (y).
     */
    ParticleSpriteSheetNode.UV_VECTOR3D = "UVVector3D";
    return ParticleSpriteSheetNode;
})(ParticleNodeBase);
module.exports = ParticleSpriteSheetNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvUGFydGljbGVTcHJpdGVTaGVldE5vZGUudHMiXSwibmFtZXMiOlsiUGFydGljbGVTcHJpdGVTaGVldE5vZGUiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlU3ByaXRlU2hlZXROb2RlLm51bUNvbHVtbnMiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5udW1Sb3dzIiwiUGFydGljbGVTcHJpdGVTaGVldE5vZGUudG90YWxGcmFtZXMiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5nZXRBR0FMVVZDb2RlIiwiUGFydGljbGVTcHJpdGVTaGVldE5vZGUuZ2V0QW5pbWF0aW9uU3RhdGUiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5faVByb2Nlc3NBbmltYXRpb25TZXR0aW5nIiwiUGFydGljbGVTcHJpdGVTaGVldE5vZGUuX2lHZW5lcmF0ZVByb3BlcnR5T2ZPbmVQYXJ0aWNsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0EsSUFBTyxxQkFBcUIsV0FBYSx5REFBeUQsQ0FBQyxDQUFDO0FBRXBHLElBQU8sb0JBQW9CLFdBQWMsc0RBQXNELENBQUMsQ0FBQztBQUVqRyxJQUFPLHNCQUFzQixXQUFhLDZEQUE2RCxDQUFDLENBQUM7QUFDekcsSUFBTyxnQkFBZ0IsV0FBZSx3REFBd0QsQ0FBQyxDQUFDO0FBQ2hHLElBQU8sd0JBQXdCLFdBQWEsaUVBQWlFLENBQUMsQ0FBQztBQUUvRyxBQUlBOzs7R0FERztJQUNHLHVCQUF1QjtJQUFTQSxVQUFoQ0EsdUJBQXVCQSxVQUF5QkE7SUFpRHJEQTs7Ozs7Ozs7OztPQVVHQTtJQUNIQSxTQTVES0EsdUJBQXVCQSxDQTREaEJBLElBQUlBLENBQVFBLFFBQURBLEFBQVNBLEVBQUVBLFNBQWlCQSxFQUFFQSxTQUFpQkEsRUFBRUEsVUFBNkJBLEVBQUVBLE9BQTJCQSxFQUFFQSxhQUF3QkEsRUFBRUEsVUFBcUJBLEVB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QSxxQkFBcUJBLENBQUNBLGFBQWFBLENBQUNBLE9BQU9BLEVBQUVBLGFBQWFBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRTNHQSxJQUFJQSxNQUFNQSxHQUF5QkEsSUFBSUEscUJBQXFCQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxFQUFFQSxhQUFhQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM1R0EsSUFBSUEsS0FBS0EsR0FBeUJBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsT0FBT0EsRUFBRUEsYUFBYUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0dBLElBQUlBLFNBQVNBLEdBQXlCQSxJQUFJQSxxQkFBcUJBLENBQUNBLGFBQWFBLENBQUNBLE9BQU9BLEVBQUVBLGFBQWFBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRS9HQSxJQUFJQSxJQUFJQSxHQUF5QkEsc0JBQXNCQSxDQUFDQSx1QkFBdUJBLEVBQUVBLENBQUNBO1FBQ2xGQSxJQUFJQSxJQUFJQSxHQUF5QkEsSUFBSUEscUJBQXFCQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN4RkEsSUFBSUEsT0FBT0EsR0FBeUJBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0ZBLElBQUlBLEdBQUdBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDOURBLElBQUlBLEtBQUtBLEdBQXlCQSxJQUFJQSxxQkFBcUJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRXpGQSxJQUFJQSxDQUFDQSxHQUF5QkEsSUFBSUEscUJBQXFCQSxDQUFDQSxzQkFBc0JBLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLEVBQUVBLHNCQUFzQkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0lBLElBQUlBLENBQUNBLEdBQXlCQSxJQUFJQSxxQkFBcUJBLENBQUNBLHNCQUFzQkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsRUFBRUEsc0JBQXNCQSxDQUFDQSxRQUFRQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUUzSUEsSUFBSUEsSUFBSUEsR0FBVUEsRUFBRUEsQ0FBQ0E7UUFDckJBLEFBQ0FBLFVBRFVBO1FBQ1ZBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2xEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN0QkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFbkRBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQTtnQkFDcEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLHNCQUFzQkEsQ0FBQ0EsVUFBVUEsR0FBR0EsR0FBR0EsR0FBR0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDMUZBLElBQUlBO2dCQUNIQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxzQkFBc0JBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3hFQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUN4REEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDMUNBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3hEQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMxREEsQ0FBQ0E7UUFBQ0EsSUFBSUE7WUFDTEEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsR0FBR0EsR0FBR0EsR0FBR0Esc0JBQXNCQSxDQUFDQSxVQUFVQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVsR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDeEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1lBQzNDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUMzREEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsT0FBT0EsR0FBR0EsR0FBR0EsR0FBR0EsT0FBT0EsR0FBR0EsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDOURBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBO1FBQ3JEQSxDQUFDQTtRQUVEQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN6REEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDM0NBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLEdBQUdBLEdBQUdBLEtBQUtBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQ3pEQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUV6REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQzNDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVqREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFFREw7O09BRUdBO0lBQ0lBLG1EQUFpQkEsR0FBeEJBLFVBQXlCQSxRQUFxQkE7UUFFN0NNLE1BQU1BLENBQTRCQSxRQUFRQSxDQUFDQSxpQkFBaUJBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ3BFQSxDQUFDQTtJQUVETjs7T0FFR0E7SUFDSUEsMkRBQXlCQSxHQUFoQ0EsVUFBaUNBLG9CQUF5Q0E7UUFFekVPLG9CQUFvQkEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDdkNBLENBQUNBO0lBRURQOztPQUVHQTtJQUNJQSxpRUFBK0JBLEdBQXRDQSxVQUF1Q0EsS0FBd0JBO1FBRTlEUSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0QkEsSUFBSUEsT0FBT0EsR0FBWUEsS0FBS0EsQ0FBQ0EsdUJBQXVCQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtZQUNsRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0E7Z0JBQ1pBLE1BQUtBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLGNBQWNBLEdBQUdBLHVCQUF1QkEsQ0FBQ0EsV0FBV0EsR0FBR0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdkZBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNsQkEsTUFBS0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsOENBQThDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsRUEsSUFBSUEsTUFBTUEsR0FBVUEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7WUFDekRBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQ3JDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM5QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7Z0JBQ3BCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUEzSkRSOzs7T0FHR0E7SUFDV0EsbUNBQVdBLEdBQVVBLFlBQVlBLENBQUNBO0lBd0pqREEsOEJBQUNBO0FBQURBLENBL0tBLEFBK0tDQSxFQS9LcUMsZ0JBQWdCLEVBK0tyRDtBQUVELEFBQWlDLGlCQUF4Qix1QkFBdUIsQ0FBQyIsImZpbGUiOiJhbmltYXRvcnMvbm9kZXMvUGFydGljbGVTcHJpdGVTaGVldE5vZGUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuXHJcbmltcG9ydCBBbmltYXRvckJhc2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL0FuaW1hdG9yQmFzZVwiKTtcclxuaW1wb3J0IEFuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvQW5pbWF0aW9uUmVnaXN0ZXJDYWNoZVwiKTtcclxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5cclxuaW1wb3J0IFBhcnRpY2xlQW5pbWF0aW9uU2V0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL1BhcnRpY2xlQW5pbWF0aW9uU2V0XCIpO1xyXG5pbXBvcnQgUGFydGljbGVQcm9wZXJ0aWVzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVQcm9wZXJ0aWVzXCIpO1xyXG5pbXBvcnQgUGFydGljbGVQcm9wZXJ0aWVzTW9kZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9QYXJ0aWNsZVByb3BlcnRpZXNNb2RlXCIpO1xyXG5pbXBvcnQgUGFydGljbGVOb2RlQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL25vZGVzL1BhcnRpY2xlTm9kZUJhc2VcIik7XHJcbmltcG9ydCBQYXJ0aWNsZVNwcml0ZVNoZWV0U3RhdGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL3N0YXRlcy9QYXJ0aWNsZVNwcml0ZVNoZWV0U3RhdGVcIik7XHJcblxyXG4vKipcclxuICogQSBwYXJ0aWNsZSBhbmltYXRpb24gbm9kZSB1c2VkIHdoZW4gYSBzcHJpdGVzaGVldCB0ZXh0dXJlIGlzIHJlcXVpcmVkIHRvIGFuaW1hdGUgdGhlIHBhcnRpY2xlLlxyXG4gKiBOQjogdG8gZW5hYmxlIHVzZSBvZiB0aGlzIG5vZGUsIHRoZSA8Y29kZT5yZXBlYXQ8L2NvZGU+IHByb3BlcnR5IG9uIHRoZSBtYXRlcmlhbCBoYXMgdG8gYmUgc2V0IHRvIHRydWUuXHJcbiAqL1xyXG5jbGFzcyBQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZSBleHRlbmRzIFBhcnRpY2xlTm9kZUJhc2Vcclxue1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaVVzZXNDeWNsZTpib29sZWFuO1xyXG5cclxuXHQvKiogQHByaXZhdGUgKi9cclxuXHRwdWJsaWMgX2lVc2VzUGhhc2U6Ym9vbGVhbjtcclxuXHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIF9pVG90YWxGcmFtZXM6bnVtYmVyIC8qaW50Ki87XHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIF9pTnVtQ29sdW1uczpudW1iZXIgLyppbnQqLztcclxuXHQvKiogQHByaXZhdGUgKi9cclxuXHRwdWJsaWMgX2lOdW1Sb3dzOm51bWJlciAvKmludCovO1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaUN5Y2xlRHVyYXRpb246bnVtYmVyO1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaUN5Y2xlUGhhc2U6bnVtYmVyO1xyXG5cclxuXHQvKipcclxuXHQgKiBSZWZlcmVuY2UgZm9yIHNwcml0ZXNoZWV0IG5vZGUgcHJvcGVydGllcyBvbiBhIHNpbmdsZSBwYXJ0aWNsZSAod2hlbiBpbiBsb2NhbCBwcm9wZXJ0eSBtb2RlKS5cclxuXHQgKiBFeHBlY3RzIGEgPGNvZGU+VmVjdG9yM0Q8L2NvZGU+IHJlcHJlc2VudGluZyB0aGUgY3ljbGVEdXJhdGlvbiAoeCksIG9wdGlvbmFsIHBoYXNlVGltZSAoeSkuXHJcblx0ICovXHJcblx0cHVibGljIHN0YXRpYyBVVl9WRUNUT1IzRDpzdHJpbmcgPSBcIlVWVmVjdG9yM0RcIjtcclxuXHJcblx0LyoqXHJcblx0ICogRGVmaW5lcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHNwcml0ZXNoZWV0LCB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAxLiBSZWFkIG9ubHkuXHJcblx0ICovXHJcblx0cHVibGljIGdldCBudW1Db2x1bW5zKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2lOdW1Db2x1bW5zO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRGVmaW5lcyB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHNwcml0ZXNoZWV0LCB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAxLiBSZWFkIG9ubHkuXHJcblx0ICovXHJcblx0cHVibGljIGdldCBudW1Sb3dzKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2lOdW1Sb3dzO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRGVmaW5lcyB0aGUgdG90YWwgbnVtYmVyIG9mIGZyYW1lcyB1c2VkIGJ5IHRoZSBzcHJpdGVzaGVldCwgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gdGhlIG51bWJlciBkZWZpbmVkIGJ5IG51bUNvbHVtbnMgYW5kIG51bVJvd3MuIFJlYWQgb25seS5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IHRvdGFsRnJhbWVzKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2lUb3RhbEZyYW1lcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIENyZWF0ZXMgYSBuZXcgPGNvZGU+UGFydGljbGVTcHJpdGVTaGVldE5vZGU8L2NvZGU+XHJcblx0ICpcclxuXHQgKiBAcGFyYW0gICAgICAgICAgICAgICBtb2RlICAgICAgICAgICAgRGVmaW5lcyB3aGV0aGVyIHRoZSBtb2RlIG9mIG9wZXJhdGlvbiBhY3RzIG9uIGxvY2FsIHByb3BlcnRpZXMgb2YgYSBwYXJ0aWNsZSBvciBnbG9iYWwgcHJvcGVydGllcyBvZiB0aGUgbm9kZS5cclxuXHQgKiBAcGFyYW0gICAgW29wdGlvbmFsXSBudW1Db2x1bW5zICAgICAgRGVmaW5lcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHNwcml0ZXNoZWV0LCB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAxLlxyXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIG51bVJvd3MgICAgICAgICBEZWZpbmVzIHRoZSBudW1iZXIgb2Ygcm93cyBpbiB0aGUgc3ByaXRlc2hlZXQsIHdoZW4gaW4gZ2xvYmFsIG1vZGUuIERlZmF1bHRzIHRvIDEuXHJcblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gY3ljbGVEdXJhdGlvbiAgIERlZmluZXMgdGhlIGRlZmF1bHQgY3ljbGUgZHVyYXRpb24gaW4gc2Vjb25kcywgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gMS5cclxuXHQgKiBAcGFyYW0gICAgW29wdGlvbmFsXSBjeWNsZVBoYXNlICAgICAgRGVmaW5lcyB0aGUgZGVmYXVsdCBjeWNsZSBwaGFzZSwgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gMC5cclxuXHQgKiBAcGFyYW0gICAgW29wdGlvbmFsXSB0b3RhbEZyYW1lcyAgICAgRGVmaW5lcyB0aGUgdG90YWwgbnVtYmVyIG9mIGZyYW1lcyB1c2VkIGJ5IHRoZSBzcHJpdGVzaGVldCwgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gdGhlIG51bWJlciBkZWZpbmVkIGJ5IG51bUNvbHVtbnMgYW5kIG51bVJvd3MuXHJcblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gbG9vcGluZyAgICAgICAgIERlZmluZXMgd2hldGhlciB0aGUgc3ByaXRlc2hlZXQgYW5pbWF0aW9uIGlzIHNldCB0byBsb29wIGluZGVmaW5pdGVseS4gRGVmYXVsdHMgdG8gdHJ1ZS5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3Rvcihtb2RlOm51bWJlciAvKnVpbnQqLywgdXNlc0N5Y2xlOmJvb2xlYW4sIHVzZXNQaGFzZTpib29sZWFuLCBudW1Db2x1bW5zOm51bWJlciAvKmludCovID0gMSwgbnVtUm93czpudW1iZXIgLyp1aW50Ki8gPSAxLCBjeWNsZUR1cmF0aW9uOm51bWJlciA9IDEsIGN5Y2xlUGhhc2U6bnVtYmVyID0gMCwgdG90YWxGcmFtZXM6bnVtYmVyIC8qdWludCovID0gTnVtYmVyLk1BWF9WQUxVRSlcclxuXHR7XHJcblx0XHRzdXBlcihcIlBhcnRpY2xlU3ByaXRlU2hlZXRcIiwgbW9kZSwgdXNlc0N5Y2xlPyAodXNlc1BoYXNlPyAzIDogMikgOiAxLCBQYXJ0aWNsZUFuaW1hdGlvblNldC5QT1NUX1BSSU9SSVRZICsgMSk7XHJcblxyXG5cdFx0dGhpcy5fcFN0YXRlQ2xhc3MgPSBQYXJ0aWNsZVNwcml0ZVNoZWV0U3RhdGU7XHJcblxyXG5cdFx0dGhpcy5faVVzZXNDeWNsZSA9IHVzZXNDeWNsZTtcclxuXHRcdHRoaXMuX2lVc2VzUGhhc2UgPSB1c2VzUGhhc2U7XHJcblxyXG5cdFx0dGhpcy5faU51bUNvbHVtbnMgPSBudW1Db2x1bW5zO1xyXG5cdFx0dGhpcy5faU51bVJvd3MgPSBudW1Sb3dzO1xyXG5cdFx0dGhpcy5faUN5Y2xlUGhhc2UgPSBjeWNsZVBoYXNlO1xyXG5cdFx0dGhpcy5faUN5Y2xlRHVyYXRpb24gPSBjeWNsZUR1cmF0aW9uO1xyXG5cdFx0dGhpcy5faVRvdGFsRnJhbWVzID0gTWF0aC5taW4odG90YWxGcmFtZXMsIG51bUNvbHVtbnMqbnVtUm93cyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXRBR0FMVVZDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUpOnN0cmluZ1xyXG5cdHtcclxuXHRcdC8vZ2V0IDIgdmNcclxuXHRcdHZhciB1dlBhcmFtQ29uc3QxOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XHJcblx0XHR2YXIgdXZQYXJhbUNvbnN0MjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSAodGhpcy5fcE1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5HTE9CQUwpPyBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpIDogYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4QXR0cmlidXRlKCk7XHJcblx0XHRhbmltYXRpb25SZWdpc3RlckNhY2hlLnNldFJlZ2lzdGVySW5kZXgodGhpcywgUGFydGljbGVTcHJpdGVTaGVldFN0YXRlLlVWX0lOREVYXzAsIHV2UGFyYW1Db25zdDEuaW5kZXgpO1xyXG5cdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5zZXRSZWdpc3RlckluZGV4KHRoaXMsIFBhcnRpY2xlU3ByaXRlU2hlZXRTdGF0ZS5VVl9JTkRFWF8xLCB1dlBhcmFtQ29uc3QyLmluZGV4KTtcclxuXHJcblx0XHR2YXIgdVRvdGFsOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQodXZQYXJhbUNvbnN0MS5yZWdOYW1lLCB1dlBhcmFtQ29uc3QxLmluZGV4LCAwKTtcclxuXHRcdHZhciB1U3RlcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KHV2UGFyYW1Db25zdDEucmVnTmFtZSwgdXZQYXJhbUNvbnN0MS5pbmRleCwgMSk7XHJcblx0XHR2YXIgdlN0ZXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh1dlBhcmFtQ29uc3QxLnJlZ05hbWUsIHV2UGFyYW1Db25zdDEuaW5kZXgsIDIpO1xyXG5cclxuXHRcdHZhciB1U3BlZWQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh1dlBhcmFtQ29uc3QyLnJlZ05hbWUsIHV2UGFyYW1Db25zdDIuaW5kZXgsIDApO1xyXG5cdFx0dmFyIGN5Y2xlOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQodXZQYXJhbUNvbnN0Mi5yZWdOYW1lLCB1dlBhcmFtQ29uc3QyLmluZGV4LCAxKTtcclxuXHRcdHZhciBwaGFzZVRpbWU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh1dlBhcmFtQ29uc3QyLnJlZ05hbWUsIHV2UGFyYW1Db25zdDIuaW5kZXgsIDIpO1xyXG5cclxuXHRcdHZhciB0ZW1wOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleFZlY3RvclRlbXAoKTtcclxuXHRcdHZhciB0aW1lOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQodGVtcC5yZWdOYW1lLCB0ZW1wLmluZGV4LCAwKTtcclxuXHRcdHZhciB2T2Zmc2V0OlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQodGVtcC5yZWdOYW1lLCB0ZW1wLmluZGV4LCAxKTtcclxuXHRcdHRlbXAgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KHRlbXAucmVnTmFtZSwgdGVtcC5pbmRleCwgMik7XHJcblx0XHR2YXIgdGVtcDI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh0ZW1wLnJlZ05hbWUsIHRlbXAuaW5kZXgsIDMpO1xyXG5cclxuXHRcdHZhciB1OlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS51dlRhcmdldC5yZWdOYW1lLCBhbmltYXRpb25SZWdpc3RlckNhY2hlLnV2VGFyZ2V0LmluZGV4LCAwKTtcclxuXHRcdHZhciB2OlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS51dlRhcmdldC5yZWdOYW1lLCBhbmltYXRpb25SZWdpc3RlckNhY2hlLnV2VGFyZ2V0LmluZGV4LCAxKTtcclxuXHJcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xyXG5cdFx0Ly9zY2FsZSB1dlxyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHUgKyBcIixcIiArIHUgKyBcIixcIiArIHVTdGVwICsgXCJcXG5cIjtcclxuXHRcdGlmICh0aGlzLl9pTnVtUm93cyA+IDEpXHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB2ICsgXCIsXCIgKyB2ICsgXCIsXCIgKyB2U3RlcCArIFwiXFxuXCI7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2lVc2VzQ3ljbGUpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2lVc2VzUGhhc2UpXHJcblx0XHRcdFx0Y29kZSArPSBcImFkZCBcIiArIHRpbWUgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4VGltZSArIFwiLFwiICsgcGhhc2VUaW1lICsgXCJcXG5cIjtcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGNvZGUgKz0gXCJtb3YgXCIgKyB0aW1lICsgXCIsXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnZlcnRleFRpbWUgKyBcIlxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwiZGl2IFwiICsgdGltZSArIFwiLFwiICsgdGltZSArIFwiLFwiICsgY3ljbGUgKyBcIlxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwiZnJjIFwiICsgdGltZSArIFwiLFwiICsgdGltZSArIFwiXFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0aW1lICsgXCIsXCIgKyB0aW1lICsgXCIsXCIgKyBjeWNsZSArIFwiXFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0ZW1wICsgXCIsXCIgKyB0aW1lICsgXCIsXCIgKyB1U3BlZWQgKyBcIlxcblwiO1xyXG5cdFx0fSBlbHNlXHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0ZW1wLnRvU3RyaW5nKCkgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4TGlmZSArIFwiLFwiICsgdVRvdGFsICsgXCJcXG5cIjtcclxuXHJcblx0XHRpZiAodGhpcy5faU51bVJvd3MgPiAxKSB7XHJcblx0XHRcdGNvZGUgKz0gXCJmcmMgXCIgKyB0ZW1wMiArIFwiLFwiICsgdGVtcCArIFwiXFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJzdWIgXCIgKyB2T2Zmc2V0ICsgXCIsXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wMiArIFwiXFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB2T2Zmc2V0ICsgXCIsXCIgKyB2T2Zmc2V0ICsgXCIsXCIgKyB2U3RlcCArIFwiXFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB2ICsgXCIsXCIgKyB2ICsgXCIsXCIgKyB2T2Zmc2V0ICsgXCJcXG5cIjtcclxuXHRcdH1cclxuXHJcblx0XHRjb2RlICs9IFwiZGl2IFwiICsgdGVtcDIgKyBcIixcIiArIHRlbXAgKyBcIixcIiArIHVTdGVwICsgXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJmcmMgXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wMiArIFwiXFxuXCI7XHJcblx0XHRjb2RlICs9IFwic3ViIFwiICsgdGVtcDIgKyBcIixcIiArIHRlbXAyICsgXCIsXCIgKyB0ZW1wICsgXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wMiArIFwiLFwiICsgdVN0ZXAgKyBcIlxcblwiO1xyXG5cclxuXHRcdGlmICh0aGlzLl9pTnVtUm93cyA+IDEpXHJcblx0XHRcdGNvZGUgKz0gXCJmcmMgXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wICsgXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB1ICsgXCIsXCIgKyB1ICsgXCIsXCIgKyB0ZW1wICsgXCJcXG5cIjtcclxuXHJcblx0XHRyZXR1cm4gY29kZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGdldEFuaW1hdGlvblN0YXRlKGFuaW1hdG9yOkFuaW1hdG9yQmFzZSk6UGFydGljbGVTcHJpdGVTaGVldFN0YXRlXHJcblx0e1xyXG5cdFx0cmV0dXJuIDxQYXJ0aWNsZVNwcml0ZVNoZWV0U3RhdGU+IGFuaW1hdG9yLmdldEFuaW1hdGlvblN0YXRlKHRoaXMpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgX2lQcm9jZXNzQW5pbWF0aW9uU2V0dGluZyhwYXJ0aWNsZUFuaW1hdGlvblNldDpQYXJ0aWNsZUFuaW1hdGlvblNldClcclxuXHR7XHJcblx0XHRwYXJ0aWNsZUFuaW1hdGlvblNldC5oYXNVVk5vZGUgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgX2lHZW5lcmF0ZVByb3BlcnR5T2ZPbmVQYXJ0aWNsZShwYXJhbTpQYXJ0aWNsZVByb3BlcnRpZXMpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2lVc2VzQ3ljbGUpIHtcclxuXHRcdFx0dmFyIHV2Q3ljbGU6VmVjdG9yM0QgPSBwYXJhbVtQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5VVl9WRUNUT1IzRF07XHJcblx0XHRcdGlmICghdXZDeWNsZSlcclxuXHRcdFx0XHR0aHJvdyhuZXcgRXJyb3IoXCJ0aGVyZSBpcyBubyBcIiArIFBhcnRpY2xlU3ByaXRlU2hlZXROb2RlLlVWX1ZFQ1RPUjNEICsgXCIgaW4gcGFyYW0hXCIpKTtcclxuXHRcdFx0aWYgKHV2Q3ljbGUueCA8PSAwKVxyXG5cdFx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZSBjeWNsZSBkdXJhdGlvbiBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvXCIpKTtcclxuXHRcdFx0dmFyIHVUb3RhbDpudW1iZXIgPSB0aGlzLl9pVG90YWxGcmFtZXMvdGhpcy5faU51bUNvbHVtbnM7XHJcblx0XHRcdHRoaXMuX3BPbmVEYXRhWzBdID0gdVRvdGFsL3V2Q3ljbGUueDtcclxuXHRcdFx0dGhpcy5fcE9uZURhdGFbMV0gPSB1dkN5Y2xlLng7XHJcblx0XHRcdGlmICh0aGlzLl9pVXNlc1BoYXNlKVxyXG5cdFx0XHRcdHRoaXMuX3BPbmVEYXRhWzJdID0gdXZDeWNsZS55O1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gUGFydGljbGVTcHJpdGVTaGVldE5vZGU7Il19