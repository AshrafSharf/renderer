var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShaderRegisterElement = require("awayjs-renderergl/lib/compilation/ShaderRegisterElement");
var ParticleAnimationSet = require("awayjs-renderergl/lib/animators/ParticleAnimationSet");
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleNodeBase = require("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");
var ParticleSpriteSheetState = require("awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState");
/**
 * A particle animation node used when a spritesheet texture is required to animate the particle.
 * NB: to enable use of this node, the <code>repeat</code> property on the material has to be set to true.
 */
var ParticleSpriteSheetNode = (function (_super) {
    __extends(ParticleSpriteSheetNode, _super);
    /**
     * Creates a new <code>ParticleSpriteSheetNode</code>
     *
     * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.
     * @param    [optional] numColumns      Defines the number of columns in the spritesheet, when in global mode. Defaults to 1.
     * @param    [optional] numRows         Defines the number of rows in the spritesheet, when in global mode. Defaults to 1.
     * @param    [optional] cycleDuration   Defines the default cycle duration in seconds, when in global mode. Defaults to 1.
     * @param    [optional] cyclePhase      Defines the default cycle phase, when in global mode. Defaults to 0.
     * @param    [optional] totalFrames     Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows.
     * @param    [optional] looping         Defines whether the spritesheet animation is set to loop indefinitely. Defaults to true.
     */
    function ParticleSpriteSheetNode(mode /*uint*/, usesCycle, usesPhase, numColumns, numRows, cycleDuration, cyclePhase, totalFrames) {
        if (numColumns === void 0) { numColumns = 1; }
        if (numRows === void 0) { numRows = 1; }
        if (cycleDuration === void 0) { cycleDuration = 1; }
        if (cyclePhase === void 0) { cyclePhase = 0; }
        if (totalFrames === void 0) { totalFrames = Number.MAX_VALUE; }
        _super.call(this, "ParticleSpriteSheet", mode, usesCycle ? (usesPhase ? 3 : 2) : 1, ParticleAnimationSet.POST_PRIORITY + 1);
        this._pStateClass = ParticleSpriteSheetState;
        this._iUsesCycle = usesCycle;
        this._iUsesPhase = usesPhase;
        this._iNumColumns = numColumns;
        this._iNumRows = numRows;
        this._iCyclePhase = cyclePhase;
        this._iCycleDuration = cycleDuration;
        this._iTotalFrames = Math.min(totalFrames, numColumns * numRows);
    }
    Object.defineProperty(ParticleSpriteSheetNode.prototype, "numColumns", {
        /**
         * Defines the number of columns in the spritesheet, when in global mode. Defaults to 1. Read only.
         */
        get: function () {
            return this._iNumColumns;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ParticleSpriteSheetNode.prototype, "numRows", {
        /**
         * Defines the number of rows in the spritesheet, when in global mode. Defaults to 1. Read only.
         */
        get: function () {
            return this._iNumRows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ParticleSpriteSheetNode.prototype, "totalFrames", {
        /**
         * Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows. Read only.
         */
        get: function () {
            return this._iTotalFrames;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype.getAGALUVCode = function (shaderObject, animationRegisterCache) {
        //get 2 vc
        var uvParamConst1 = animationRegisterCache.getFreeVertexConstant();
        var uvParamConst2 = (this._pMode == ParticlePropertiesMode.GLOBAL) ? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();
        animationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_0, uvParamConst1.index);
        animationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_1, uvParamConst2.index);
        var uTotal = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 0);
        var uStep = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 1);
        var vStep = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 2);
        var uSpeed = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 0);
        var cycle = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 1);
        var phaseTime = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 2);
        var temp = animationRegisterCache.getFreeVertexVectorTemp();
        var time = new ShaderRegisterElement(temp.regName, temp.index, 0);
        var vOffset = new ShaderRegisterElement(temp.regName, temp.index, 1);
        temp = new ShaderRegisterElement(temp.regName, temp.index, 2);
        var temp2 = new ShaderRegisterElement(temp.regName, temp.index, 3);
        var u = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 0);
        var v = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 1);
        var code = "";
        //scale uv
        code += "mul " + u + "," + u + "," + uStep + "\n";
        if (this._iNumRows > 1)
            code += "mul " + v + "," + v + "," + vStep + "\n";
        if (this._iUsesCycle) {
            if (this._iUsesPhase)
                code += "add " + time + "," + animationRegisterCache.vertexTime + "," + phaseTime + "\n";
            else
                code += "mov " + time + "," + animationRegisterCache.vertexTime + "\n";
            code += "div " + time + "," + time + "," + cycle + "\n";
            code += "frc " + time + "," + time + "\n";
            code += "mul " + time + "," + time + "," + cycle + "\n";
            code += "mul " + temp + "," + time + "," + uSpeed + "\n";
        }
        else
            code += "mul " + temp.toString() + "," + animationRegisterCache.vertexLife + "," + uTotal + "\n";
        if (this._iNumRows > 1) {
            code += "frc " + temp2 + "," + temp + "\n";
            code += "sub " + vOffset + "," + temp + "," + temp2 + "\n";
            code += "mul " + vOffset + "," + vOffset + "," + vStep + "\n";
            code += "add " + v + "," + v + "," + vOffset + "\n";
        }
        code += "div " + temp2 + "," + temp + "," + uStep + "\n";
        code += "frc " + temp + "," + temp2 + "\n";
        code += "sub " + temp2 + "," + temp2 + "," + temp + "\n";
        code += "mul " + temp + "," + temp2 + "," + uStep + "\n";
        if (this._iNumRows > 1)
            code += "frc " + temp + "," + temp + "\n";
        code += "add " + u + "," + u + "," + temp + "\n";
        return code;
    };
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype.getAnimationState = function (animator) {
        return animator.getAnimationState(this);
    };
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype._iProcessAnimationSetting = function (particleAnimationSet) {
        particleAnimationSet.hasUVNode = true;
    };
    /**
     * @inheritDoc
     */
    ParticleSpriteSheetNode.prototype._iGeneratePropertyOfOneParticle = function (param) {
        if (this._iUsesCycle) {
            var uvCycle = param[ParticleSpriteSheetNode.UV_VECTOR3D];
            if (!uvCycle)
                throw (new Error("there is no " + ParticleSpriteSheetNode.UV_VECTOR3D + " in param!"));
            if (uvCycle.x <= 0)
                throw (new Error("the cycle duration must be greater than zero"));
            var uTotal = this._iTotalFrames / this._iNumColumns;
            this._pOneData[0] = uTotal / uvCycle.x;
            this._pOneData[1] = uvCycle.x;
            if (this._iUsesPhase)
                this._pOneData[2] = uvCycle.y;
        }
    };
    /**
     * Reference for spritesheet node properties on a single particle (when in local property mode).
     * Expects a <code>Vector3D</code> representing the cycleDuration (x), optional phaseTime (y).
     */
    ParticleSpriteSheetNode.UV_VECTOR3D = "UVVector3D";
    return ParticleSpriteSheetNode;
})(ParticleNodeBase);
module.exports = ParticleSpriteSheetNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvcGFydGljbGVzcHJpdGVzaGVldG5vZGUudHMiXSwibmFtZXMiOlsiUGFydGljbGVTcHJpdGVTaGVldE5vZGUiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlU3ByaXRlU2hlZXROb2RlLm51bUNvbHVtbnMiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5udW1Sb3dzIiwiUGFydGljbGVTcHJpdGVTaGVldE5vZGUudG90YWxGcmFtZXMiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5nZXRBR0FMVVZDb2RlIiwiUGFydGljbGVTcHJpdGVTaGVldE5vZGUuZ2V0QW5pbWF0aW9uU3RhdGUiLCJQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5faVByb2Nlc3NBbmltYXRpb25TZXR0aW5nIiwiUGFydGljbGVTcHJpdGVTaGVldE5vZGUuX2lHZW5lcmF0ZVByb3BlcnR5T2ZPbmVQYXJ0aWNsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBS0EsSUFBTyxxQkFBcUIsV0FBYSx5REFBeUQsQ0FBQyxDQUFDO0FBRXBHLElBQU8sb0JBQW9CLFdBQWMsc0RBQXNELENBQUMsQ0FBQztBQUVqRyxJQUFPLHNCQUFzQixXQUFhLDZEQUE2RCxDQUFDLENBQUM7QUFDekcsSUFBTyxnQkFBZ0IsV0FBZSx3REFBd0QsQ0FBQyxDQUFDO0FBQ2hHLElBQU8sd0JBQXdCLFdBQWEsaUVBQWlFLENBQUMsQ0FBQztBQUUvRyxBQUlBOzs7R0FERztJQUNHLHVCQUF1QjtJQUFTQSxVQUFoQ0EsdUJBQXVCQSxVQUF5QkE7SUFpRHJEQTs7Ozs7Ozs7OztPQVVHQTtJQUNIQSxTQTVES0EsdUJBQXVCQSxDQTREaEJBLElBQUlBLENBQVFBLFFBQURBLEFBQVNBLEVBQUVBLFNBQWlCQSxFQUFFQSxTQUFpQkEsRUFBRUEsVUFBNkJBLEVBQUVBLE9BQTJCQSxFQUFFQSxhQUF3QkEsRUFBRUEsVUFBcUJBLEVB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QSxxQkFBcUJBLENBQUNBLGFBQWFBLENBQUNBLE9BQU9BLEVBQUVBLGFBQWFBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRTNHQSxJQUFJQSxNQUFNQSxHQUF5QkEsSUFBSUEscUJBQXFCQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxFQUFFQSxhQUFhQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUM1R0EsSUFBSUEsS0FBS0EsR0FBeUJBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsT0FBT0EsRUFBRUEsYUFBYUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0dBLElBQUlBLFNBQVNBLEdBQXlCQSxJQUFJQSxxQkFBcUJBLENBQUNBLGFBQWFBLENBQUNBLE9BQU9BLEVBQUVBLGFBQWFBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRS9HQSxJQUFJQSxJQUFJQSxHQUF5QkEsc0JBQXNCQSxDQUFDQSx1QkFBdUJBLEVBQUVBLENBQUNBO1FBQ2xGQSxJQUFJQSxJQUFJQSxHQUF5QkEsSUFBSUEscUJBQXFCQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN4RkEsSUFBSUEsT0FBT0EsR0FBeUJBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0ZBLElBQUlBLEdBQUdBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDOURBLElBQUlBLEtBQUtBLEdBQXlCQSxJQUFJQSxxQkFBcUJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRXpGQSxJQUFJQSxDQUFDQSxHQUF5QkEsSUFBSUEscUJBQXFCQSxDQUFDQSxzQkFBc0JBLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLEVBQUVBLHNCQUFzQkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0lBLElBQUlBLENBQUNBLEdBQXlCQSxJQUFJQSxxQkFBcUJBLENBQUNBLHNCQUFzQkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsRUFBRUEsc0JBQXNCQSxDQUFDQSxRQUFRQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUUzSUEsSUFBSUEsSUFBSUEsR0FBVUEsRUFBRUEsQ0FBQ0E7UUFDckJBLEFBQ0FBLFVBRFVBO1FBQ1ZBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2xEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN0QkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFbkRBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQTtnQkFDcEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLHNCQUFzQkEsQ0FBQ0EsVUFBVUEsR0FBR0EsR0FBR0EsR0FBR0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDMUZBLElBQUlBO2dCQUNIQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxzQkFBc0JBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3hFQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUN4REEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDMUNBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1lBQ3hEQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMxREEsQ0FBQ0E7UUFBQ0EsSUFBSUE7WUFDTEEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsR0FBR0EsR0FBR0EsR0FBR0Esc0JBQXNCQSxDQUFDQSxVQUFVQSxHQUFHQSxHQUFHQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVsR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDeEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1lBQzNDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUMzREEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsT0FBT0EsR0FBR0EsR0FBR0EsR0FBR0EsT0FBT0EsR0FBR0EsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDOURBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBO1FBQ3JEQSxDQUFDQTtRQUVEQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN6REEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsR0FBR0EsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDM0NBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLEdBQUdBLEdBQUdBLEtBQUtBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQ3pEQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUV6REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQzNDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVqREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFFREw7O09BRUdBO0lBQ0lBLG1EQUFpQkEsR0FBeEJBLFVBQXlCQSxRQUFxQkE7UUFFN0NNLE1BQU1BLENBQTRCQSxRQUFRQSxDQUFDQSxpQkFBaUJBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ3BFQSxDQUFDQTtJQUVETjs7T0FFR0E7SUFDSUEsMkRBQXlCQSxHQUFoQ0EsVUFBaUNBLG9CQUF5Q0E7UUFFekVPLG9CQUFvQkEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDdkNBLENBQUNBO0lBRURQOztPQUVHQTtJQUNJQSxpRUFBK0JBLEdBQXRDQSxVQUF1Q0EsS0FBd0JBO1FBRTlEUSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0QkEsSUFBSUEsT0FBT0EsR0FBWUEsS0FBS0EsQ0FBQ0EsdUJBQXVCQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtZQUNsRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0E7Z0JBQ1pBLE1BQUtBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLGNBQWNBLEdBQUdBLHVCQUF1QkEsQ0FBQ0EsV0FBV0EsR0FBR0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdkZBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNsQkEsTUFBS0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsOENBQThDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsRUEsSUFBSUEsTUFBTUEsR0FBVUEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7WUFDekRBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQ3JDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM5QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7Z0JBQ3BCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNoQ0EsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUEzSkRSOzs7T0FHR0E7SUFDV0EsbUNBQVdBLEdBQVVBLFlBQVlBLENBQUNBO0lBd0pqREEsOEJBQUNBO0FBQURBLENBL0tBLEFBK0tDQSxFQS9LcUMsZ0JBQWdCLEVBK0tyRDtBQUVELEFBQWlDLGlCQUF4Qix1QkFBdUIsQ0FBQyIsImZpbGUiOiJhbmltYXRvcnMvbm9kZXMvUGFydGljbGVTcHJpdGVTaGVldE5vZGUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IEFuaW1hdG9yQmFzZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvQW5pbWF0b3JCYXNlXCIpO1xuaW1wb3J0IEFuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvQW5pbWF0aW9uUmVnaXN0ZXJDYWNoZVwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckVsZW1lbnRcIik7XG5cbmltcG9ydCBQYXJ0aWNsZUFuaW1hdGlvblNldFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9QYXJ0aWNsZUFuaW1hdGlvblNldFwiKTtcbmltcG9ydCBQYXJ0aWNsZVByb3BlcnRpZXNcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9QYXJ0aWNsZVByb3BlcnRpZXNcIik7XG5pbXBvcnQgUGFydGljbGVQcm9wZXJ0aWVzTW9kZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9QYXJ0aWNsZVByb3BlcnRpZXNNb2RlXCIpO1xuaW1wb3J0IFBhcnRpY2xlTm9kZUJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9ub2Rlcy9QYXJ0aWNsZU5vZGVCYXNlXCIpO1xuaW1wb3J0IFBhcnRpY2xlU3ByaXRlU2hlZXRTdGF0ZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlU3ByaXRlU2hlZXRTdGF0ZVwiKTtcblxuLyoqXG4gKiBBIHBhcnRpY2xlIGFuaW1hdGlvbiBub2RlIHVzZWQgd2hlbiBhIHNwcml0ZXNoZWV0IHRleHR1cmUgaXMgcmVxdWlyZWQgdG8gYW5pbWF0ZSB0aGUgcGFydGljbGUuXG4gKiBOQjogdG8gZW5hYmxlIHVzZSBvZiB0aGlzIG5vZGUsIHRoZSA8Y29kZT5yZXBlYXQ8L2NvZGU+IHByb3BlcnR5IG9uIHRoZSBtYXRlcmlhbCBoYXMgdG8gYmUgc2V0IHRvIHRydWUuXG4gKi9cbmNsYXNzIFBhcnRpY2xlU3ByaXRlU2hlZXROb2RlIGV4dGVuZHMgUGFydGljbGVOb2RlQmFzZVxue1xuXHQvKiogQHByaXZhdGUgKi9cblx0cHVibGljIF9pVXNlc0N5Y2xlOmJvb2xlYW47XG5cblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaVVzZXNQaGFzZTpib29sZWFuO1xuXG5cdC8qKiBAcHJpdmF0ZSAqL1xuXHRwdWJsaWMgX2lUb3RhbEZyYW1lczpudW1iZXIgLyppbnQqLztcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaU51bUNvbHVtbnM6bnVtYmVyIC8qaW50Ki87XG5cdC8qKiBAcHJpdmF0ZSAqL1xuXHRwdWJsaWMgX2lOdW1Sb3dzOm51bWJlciAvKmludCovO1xuXHQvKiogQHByaXZhdGUgKi9cblx0cHVibGljIF9pQ3ljbGVEdXJhdGlvbjpudW1iZXI7XG5cdC8qKiBAcHJpdmF0ZSAqL1xuXHRwdWJsaWMgX2lDeWNsZVBoYXNlOm51bWJlcjtcblxuXHQvKipcblx0ICogUmVmZXJlbmNlIGZvciBzcHJpdGVzaGVldCBub2RlIHByb3BlcnRpZXMgb24gYSBzaW5nbGUgcGFydGljbGUgKHdoZW4gaW4gbG9jYWwgcHJvcGVydHkgbW9kZSkuXG5cdCAqIEV4cGVjdHMgYSA8Y29kZT5WZWN0b3IzRDwvY29kZT4gcmVwcmVzZW50aW5nIHRoZSBjeWNsZUR1cmF0aW9uICh4KSwgb3B0aW9uYWwgcGhhc2VUaW1lICh5KS5cblx0ICovXG5cdHB1YmxpYyBzdGF0aWMgVVZfVkVDVE9SM0Q6c3RyaW5nID0gXCJVVlZlY3RvcjNEXCI7XG5cblx0LyoqXG5cdCAqIERlZmluZXMgdGhlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSBzcHJpdGVzaGVldCwgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gMS4gUmVhZCBvbmx5LlxuXHQgKi9cblx0cHVibGljIGdldCBudW1Db2x1bW5zKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5faU51bUNvbHVtbnM7XG5cdH1cblxuXHQvKipcblx0ICogRGVmaW5lcyB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHNwcml0ZXNoZWV0LCB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAxLiBSZWFkIG9ubHkuXG5cdCAqL1xuXHRwdWJsaWMgZ2V0IG51bVJvd3MoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9pTnVtUm93cztcblx0fVxuXG5cdC8qKlxuXHQgKiBEZWZpbmVzIHRoZSB0b3RhbCBudW1iZXIgb2YgZnJhbWVzIHVzZWQgYnkgdGhlIHNwcml0ZXNoZWV0LCB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byB0aGUgbnVtYmVyIGRlZmluZWQgYnkgbnVtQ29sdW1ucyBhbmQgbnVtUm93cy4gUmVhZCBvbmx5LlxuXHQgKi9cblx0cHVibGljIGdldCB0b3RhbEZyYW1lcygpOm51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2lUb3RhbEZyYW1lcztcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IDxjb2RlPlBhcnRpY2xlU3ByaXRlU2hlZXROb2RlPC9jb2RlPlxuXHQgKlxuXHQgKiBAcGFyYW0gICAgICAgICAgICAgICBtb2RlICAgICAgICAgICAgRGVmaW5lcyB3aGV0aGVyIHRoZSBtb2RlIG9mIG9wZXJhdGlvbiBhY3RzIG9uIGxvY2FsIHByb3BlcnRpZXMgb2YgYSBwYXJ0aWNsZSBvciBnbG9iYWwgcHJvcGVydGllcyBvZiB0aGUgbm9kZS5cblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gbnVtQ29sdW1ucyAgICAgIERlZmluZXMgdGhlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSBzcHJpdGVzaGVldCwgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gMS5cblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gbnVtUm93cyAgICAgICAgIERlZmluZXMgdGhlIG51bWJlciBvZiByb3dzIGluIHRoZSBzcHJpdGVzaGVldCwgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gMS5cblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gY3ljbGVEdXJhdGlvbiAgIERlZmluZXMgdGhlIGRlZmF1bHQgY3ljbGUgZHVyYXRpb24gaW4gc2Vjb25kcywgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gMS5cblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gY3ljbGVQaGFzZSAgICAgIERlZmluZXMgdGhlIGRlZmF1bHQgY3ljbGUgcGhhc2UsIHdoZW4gaW4gZ2xvYmFsIG1vZGUuIERlZmF1bHRzIHRvIDAuXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIHRvdGFsRnJhbWVzICAgICBEZWZpbmVzIHRoZSB0b3RhbCBudW1iZXIgb2YgZnJhbWVzIHVzZWQgYnkgdGhlIHNwcml0ZXNoZWV0LCB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byB0aGUgbnVtYmVyIGRlZmluZWQgYnkgbnVtQ29sdW1ucyBhbmQgbnVtUm93cy5cblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gbG9vcGluZyAgICAgICAgIERlZmluZXMgd2hldGhlciB0aGUgc3ByaXRlc2hlZXQgYW5pbWF0aW9uIGlzIHNldCB0byBsb29wIGluZGVmaW5pdGVseS4gRGVmYXVsdHMgdG8gdHJ1ZS5cblx0ICovXG5cdGNvbnN0cnVjdG9yKG1vZGU6bnVtYmVyIC8qdWludCovLCB1c2VzQ3ljbGU6Ym9vbGVhbiwgdXNlc1BoYXNlOmJvb2xlYW4sIG51bUNvbHVtbnM6bnVtYmVyIC8qaW50Ki8gPSAxLCBudW1Sb3dzOm51bWJlciAvKnVpbnQqLyA9IDEsIGN5Y2xlRHVyYXRpb246bnVtYmVyID0gMSwgY3ljbGVQaGFzZTpudW1iZXIgPSAwLCB0b3RhbEZyYW1lczpudW1iZXIgLyp1aW50Ki8gPSBOdW1iZXIuTUFYX1ZBTFVFKVxuXHR7XG5cdFx0c3VwZXIoXCJQYXJ0aWNsZVNwcml0ZVNoZWV0XCIsIG1vZGUsIHVzZXNDeWNsZT8gKHVzZXNQaGFzZT8gMyA6IDIpIDogMSwgUGFydGljbGVBbmltYXRpb25TZXQuUE9TVF9QUklPUklUWSArIDEpO1xuXG5cdFx0dGhpcy5fcFN0YXRlQ2xhc3MgPSBQYXJ0aWNsZVNwcml0ZVNoZWV0U3RhdGU7XG5cblx0XHR0aGlzLl9pVXNlc0N5Y2xlID0gdXNlc0N5Y2xlO1xuXHRcdHRoaXMuX2lVc2VzUGhhc2UgPSB1c2VzUGhhc2U7XG5cblx0XHR0aGlzLl9pTnVtQ29sdW1ucyA9IG51bUNvbHVtbnM7XG5cdFx0dGhpcy5faU51bVJvd3MgPSBudW1Sb3dzO1xuXHRcdHRoaXMuX2lDeWNsZVBoYXNlID0gY3ljbGVQaGFzZTtcblx0XHR0aGlzLl9pQ3ljbGVEdXJhdGlvbiA9IGN5Y2xlRHVyYXRpb247XG5cdFx0dGhpcy5faVRvdGFsRnJhbWVzID0gTWF0aC5taW4odG90YWxGcmFtZXMsIG51bUNvbHVtbnMqbnVtUm93cyk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBnZXRBR0FMVVZDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUpOnN0cmluZ1xuXHR7XG5cdFx0Ly9nZXQgMiB2Y1xuXHRcdHZhciB1dlBhcmFtQ29uc3QxOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XG5cdFx0dmFyIHV2UGFyYW1Db25zdDI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gKHRoaXMuX3BNb2RlID09IFBhcnRpY2xlUHJvcGVydGllc01vZGUuR0xPQkFMKT8gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKSA6IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleEF0dHJpYnV0ZSgpO1xuXHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2V0UmVnaXN0ZXJJbmRleCh0aGlzLCBQYXJ0aWNsZVNwcml0ZVNoZWV0U3RhdGUuVVZfSU5ERVhfMCwgdXZQYXJhbUNvbnN0MS5pbmRleCk7XG5cdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5zZXRSZWdpc3RlckluZGV4KHRoaXMsIFBhcnRpY2xlU3ByaXRlU2hlZXRTdGF0ZS5VVl9JTkRFWF8xLCB1dlBhcmFtQ29uc3QyLmluZGV4KTtcblxuXHRcdHZhciB1VG90YWw6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh1dlBhcmFtQ29uc3QxLnJlZ05hbWUsIHV2UGFyYW1Db25zdDEuaW5kZXgsIDApO1xuXHRcdHZhciB1U3RlcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KHV2UGFyYW1Db25zdDEucmVnTmFtZSwgdXZQYXJhbUNvbnN0MS5pbmRleCwgMSk7XG5cdFx0dmFyIHZTdGVwOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQodXZQYXJhbUNvbnN0MS5yZWdOYW1lLCB1dlBhcmFtQ29uc3QxLmluZGV4LCAyKTtcblxuXHRcdHZhciB1U3BlZWQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh1dlBhcmFtQ29uc3QyLnJlZ05hbWUsIHV2UGFyYW1Db25zdDIuaW5kZXgsIDApO1xuXHRcdHZhciBjeWNsZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KHV2UGFyYW1Db25zdDIucmVnTmFtZSwgdXZQYXJhbUNvbnN0Mi5pbmRleCwgMSk7XG5cdFx0dmFyIHBoYXNlVGltZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KHV2UGFyYW1Db25zdDIucmVnTmFtZSwgdXZQYXJhbUNvbnN0Mi5pbmRleCwgMik7XG5cblx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhWZWN0b3JUZW1wKCk7XG5cdFx0dmFyIHRpbWU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh0ZW1wLnJlZ05hbWUsIHRlbXAuaW5kZXgsIDApO1xuXHRcdHZhciB2T2Zmc2V0OlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IG5ldyBTaGFkZXJSZWdpc3RlckVsZW1lbnQodGVtcC5yZWdOYW1lLCB0ZW1wLmluZGV4LCAxKTtcblx0XHR0ZW1wID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh0ZW1wLnJlZ05hbWUsIHRlbXAuaW5kZXgsIDIpO1xuXHRcdHZhciB0ZW1wMjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KHRlbXAucmVnTmFtZSwgdGVtcC5pbmRleCwgMyk7XG5cblx0XHR2YXIgdTpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudXZUYXJnZXQucmVnTmFtZSwgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS51dlRhcmdldC5pbmRleCwgMCk7XG5cdFx0dmFyIHY6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudChhbmltYXRpb25SZWdpc3RlckNhY2hlLnV2VGFyZ2V0LnJlZ05hbWUsIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudXZUYXJnZXQuaW5kZXgsIDEpO1xuXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblx0XHQvL3NjYWxlIHV2XG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHUgKyBcIixcIiArIHUgKyBcIixcIiArIHVTdGVwICsgXCJcXG5cIjtcblx0XHRpZiAodGhpcy5faU51bVJvd3MgPiAxKVxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHYgKyBcIixcIiArIHYgKyBcIixcIiArIHZTdGVwICsgXCJcXG5cIjtcblxuXHRcdGlmICh0aGlzLl9pVXNlc0N5Y2xlKSB7XG5cdFx0XHRpZiAodGhpcy5faVVzZXNQaGFzZSlcblx0XHRcdFx0Y29kZSArPSBcImFkZCBcIiArIHRpbWUgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4VGltZSArIFwiLFwiICsgcGhhc2VUaW1lICsgXCJcXG5cIjtcblx0XHRcdGVsc2Vcblx0XHRcdFx0Y29kZSArPSBcIm1vdiBcIiArIHRpbWUgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4VGltZSArIFwiXFxuXCI7XG5cdFx0XHRjb2RlICs9IFwiZGl2IFwiICsgdGltZSArIFwiLFwiICsgdGltZSArIFwiLFwiICsgY3ljbGUgKyBcIlxcblwiO1xuXHRcdFx0Y29kZSArPSBcImZyYyBcIiArIHRpbWUgKyBcIixcIiArIHRpbWUgKyBcIlxcblwiO1xuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRpbWUgKyBcIixcIiArIHRpbWUgKyBcIixcIiArIGN5Y2xlICsgXCJcXG5cIjtcblx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0ZW1wICsgXCIsXCIgKyB0aW1lICsgXCIsXCIgKyB1U3BlZWQgKyBcIlxcblwiO1xuXHRcdH0gZWxzZVxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRlbXAudG9TdHJpbmcoKSArIFwiLFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS52ZXJ0ZXhMaWZlICsgXCIsXCIgKyB1VG90YWwgKyBcIlxcblwiO1xuXG5cdFx0aWYgKHRoaXMuX2lOdW1Sb3dzID4gMSkge1xuXHRcdFx0Y29kZSArPSBcImZyYyBcIiArIHRlbXAyICsgXCIsXCIgKyB0ZW1wICsgXCJcXG5cIjtcblx0XHRcdGNvZGUgKz0gXCJzdWIgXCIgKyB2T2Zmc2V0ICsgXCIsXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wMiArIFwiXFxuXCI7XG5cdFx0XHRjb2RlICs9IFwibXVsIFwiICsgdk9mZnNldCArIFwiLFwiICsgdk9mZnNldCArIFwiLFwiICsgdlN0ZXAgKyBcIlxcblwiO1xuXHRcdFx0Y29kZSArPSBcImFkZCBcIiArIHYgKyBcIixcIiArIHYgKyBcIixcIiArIHZPZmZzZXQgKyBcIlxcblwiO1xuXHRcdH1cblxuXHRcdGNvZGUgKz0gXCJkaXYgXCIgKyB0ZW1wMiArIFwiLFwiICsgdGVtcCArIFwiLFwiICsgdVN0ZXAgKyBcIlxcblwiO1xuXHRcdGNvZGUgKz0gXCJmcmMgXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wMiArIFwiXFxuXCI7XG5cdFx0Y29kZSArPSBcInN1YiBcIiArIHRlbXAyICsgXCIsXCIgKyB0ZW1wMiArIFwiLFwiICsgdGVtcCArIFwiXFxuXCI7XG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHRlbXAgKyBcIixcIiArIHRlbXAyICsgXCIsXCIgKyB1U3RlcCArIFwiXFxuXCI7XG5cblx0XHRpZiAodGhpcy5faU51bVJvd3MgPiAxKVxuXHRcdFx0Y29kZSArPSBcImZyYyBcIiArIHRlbXAgKyBcIixcIiArIHRlbXAgKyBcIlxcblwiO1xuXHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB1ICsgXCIsXCIgKyB1ICsgXCIsXCIgKyB0ZW1wICsgXCJcXG5cIjtcblxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgZ2V0QW5pbWF0aW9uU3RhdGUoYW5pbWF0b3I6QW5pbWF0b3JCYXNlKTpQYXJ0aWNsZVNwcml0ZVNoZWV0U3RhdGVcblx0e1xuXHRcdHJldHVybiA8UGFydGljbGVTcHJpdGVTaGVldFN0YXRlPiBhbmltYXRvci5nZXRBbmltYXRpb25TdGF0ZSh0aGlzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pUHJvY2Vzc0FuaW1hdGlvblNldHRpbmcocGFydGljbGVBbmltYXRpb25TZXQ6UGFydGljbGVBbmltYXRpb25TZXQpXG5cdHtcblx0XHRwYXJ0aWNsZUFuaW1hdGlvblNldC5oYXNVVk5vZGUgPSB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lHZW5lcmF0ZVByb3BlcnR5T2ZPbmVQYXJ0aWNsZShwYXJhbTpQYXJ0aWNsZVByb3BlcnRpZXMpXG5cdHtcblx0XHRpZiAodGhpcy5faVVzZXNDeWNsZSkge1xuXHRcdFx0dmFyIHV2Q3ljbGU6VmVjdG9yM0QgPSBwYXJhbVtQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZS5VVl9WRUNUT1IzRF07XG5cdFx0XHRpZiAoIXV2Q3ljbGUpXG5cdFx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZXJlIGlzIG5vIFwiICsgUGFydGljbGVTcHJpdGVTaGVldE5vZGUuVVZfVkVDVE9SM0QgKyBcIiBpbiBwYXJhbSFcIikpO1xuXHRcdFx0aWYgKHV2Q3ljbGUueCA8PSAwKVxuXHRcdFx0XHR0aHJvdyhuZXcgRXJyb3IoXCJ0aGUgY3ljbGUgZHVyYXRpb24gbXVzdCBiZSBncmVhdGVyIHRoYW4gemVyb1wiKSk7XG5cdFx0XHR2YXIgdVRvdGFsOm51bWJlciA9IHRoaXMuX2lUb3RhbEZyYW1lcy90aGlzLl9pTnVtQ29sdW1ucztcblx0XHRcdHRoaXMuX3BPbmVEYXRhWzBdID0gdVRvdGFsL3V2Q3ljbGUueDtcblx0XHRcdHRoaXMuX3BPbmVEYXRhWzFdID0gdXZDeWNsZS54O1xuXHRcdFx0aWYgKHRoaXMuX2lVc2VzUGhhc2UpXG5cdFx0XHRcdHRoaXMuX3BPbmVEYXRhWzJdID0gdXZDeWNsZS55O1xuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgPSBQYXJ0aWNsZVNwcml0ZVNoZWV0Tm9kZTsiXX0=