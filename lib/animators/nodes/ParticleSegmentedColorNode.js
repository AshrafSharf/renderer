var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShaderRegisterElement = require("awayjs-renderergl/lib/compilation/ShaderRegisterElement");
var ParticleAnimationSet = require("awayjs-renderergl/lib/animators/ParticleAnimationSet");
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleNodeBase = require("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");
var ParticleSegmentedColorState = require("awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState");
/**
 *
 */
var ParticleSegmentedColorNode = (function (_super) {
    __extends(ParticleSegmentedColorNode, _super);
    function ParticleSegmentedColorNode(usesMultiplier, usesOffset, numSegmentPoint /*int*/, startColor, endColor, segmentPoints) {
        //because of the stage3d register limitation, it only support the global mode
        _super.call(this, "ParticleSegmentedColor", ParticlePropertiesMode.GLOBAL, 0, ParticleAnimationSet.COLOR_PRIORITY);
        this._pStateClass = ParticleSegmentedColorState;
        if (numSegmentPoint > 4)
            throw (new Error("the numSegmentPoint must be less or equal 4"));
        this._iUsesMultiplier = usesMultiplier;
        this._iUsesOffset = usesOffset;
        this._iNumSegmentPoint = numSegmentPoint;
        this._iStartColor = startColor;
        this._iEndColor = endColor;
        this._iSegmentPoints = segmentPoints;
    }
    /**
     * @inheritDoc
     */
    ParticleSegmentedColorNode.prototype._iProcessAnimationSetting = function (particleAnimationSet) {
        if (this._iUsesMultiplier)
            particleAnimationSet.hasColorMulNode = true;
        if (this._iUsesOffset)
            particleAnimationSet.hasColorAddNode = true;
    };
    /**
     * @inheritDoc
     */
    ParticleSegmentedColorNode.prototype.getAGALVertexCode = function (shaderObject, animationRegisterCache) {
        var code = "";
        if (animationRegisterCache.needFragmentAnimation) {
            var accMultiplierColor;
            //var accOffsetColor:ShaderRegisterElement;
            if (this._iUsesMultiplier) {
                accMultiplierColor = animationRegisterCache.getFreeVertexVectorTemp();
                animationRegisterCache.addVertexTempUsages(accMultiplierColor, 1);
            }
            var tempColor = animationRegisterCache.getFreeVertexVectorTemp();
            animationRegisterCache.addVertexTempUsages(tempColor, 1);
            var temp = animationRegisterCache.getFreeVertexVectorTemp();
            var accTime = new ShaderRegisterElement(temp.regName, temp.index, 0);
            var tempTime = new ShaderRegisterElement(temp.regName, temp.index, 1);
            if (this._iUsesMultiplier)
                animationRegisterCache.removeVertexTempUsage(accMultiplierColor);
            animationRegisterCache.removeVertexTempUsage(tempColor);
            //for saving all the life values (at most 4)
            var lifeTimeRegister = animationRegisterCache.getFreeVertexConstant();
            animationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.TIME_DATA_INDEX, lifeTimeRegister.index);
            var i /*int*/;
            var startMulValue;
            var deltaMulValues;
            if (this._iUsesMultiplier) {
                startMulValue = animationRegisterCache.getFreeVertexConstant();
                animationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_MULTIPLIER_INDEX, startMulValue.index);
                deltaMulValues = new Array();
                for (i = 0; i < this._iNumSegmentPoint + 1; i++)
                    deltaMulValues.push(animationRegisterCache.getFreeVertexConstant());
            }
            var startOffsetValue;
            var deltaOffsetValues;
            if (this._iUsesOffset) {
                startOffsetValue = animationRegisterCache.getFreeVertexConstant();
                animationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_OFFSET_INDEX, startOffsetValue.index);
                deltaOffsetValues = new Array();
                for (i = 0; i < this._iNumSegmentPoint + 1; i++)
                    deltaOffsetValues.push(animationRegisterCache.getFreeVertexConstant());
            }
            if (this._iUsesMultiplier)
                code += "mov " + accMultiplierColor + "," + startMulValue + "\n";
            if (this._iUsesOffset)
                code += "add " + animationRegisterCache.colorAddTarget + "," + animationRegisterCache.colorAddTarget + "," + startOffsetValue + "\n";
            for (i = 0; i < this._iNumSegmentPoint; i++) {
                switch (i) {
                    case 0:
                        code += "min " + tempTime + "," + animationRegisterCache.vertexLife + "," + lifeTimeRegister + ".x\n";
                        break;
                    case 1:
                        code += "sub " + accTime + "," + animationRegisterCache.vertexLife + "," + lifeTimeRegister + ".x\n";
                        code += "max " + tempTime + "," + accTime + "," + animationRegisterCache.vertexZeroConst + "\n";
                        code += "min " + tempTime + "," + tempTime + "," + lifeTimeRegister + ".y\n";
                        break;
                    case 2:
                        code += "sub " + accTime + "," + accTime + "," + lifeTimeRegister + ".y\n";
                        code += "max " + tempTime + "," + accTime + "," + animationRegisterCache.vertexZeroConst + "\n";
                        code += "min " + tempTime + "," + tempTime + "," + lifeTimeRegister + ".z\n";
                        break;
                    case 3:
                        code += "sub " + accTime + "," + accTime + "," + lifeTimeRegister + ".z\n";
                        code += "max " + tempTime + "," + accTime + "," + animationRegisterCache.vertexZeroConst + "\n";
                        code += "min " + tempTime + "," + tempTime + "," + lifeTimeRegister + ".w\n";
                        break;
                }
                if (this._iUsesMultiplier) {
                    code += "mul " + tempColor + "," + tempTime + "," + deltaMulValues[i] + "\n";
                    code += "add " + accMultiplierColor + "," + accMultiplierColor + "," + tempColor + "\n";
                }
                if (this._iUsesOffset) {
                    code += "mul " + tempColor + "," + tempTime + "," + deltaOffsetValues[i] + "\n";
                    code += "add " + animationRegisterCache.colorAddTarget + "," + animationRegisterCache.colorAddTarget + "," + tempColor + "\n";
                }
            }
            //for the last segment:
            if (this._iNumSegmentPoint == 0)
                tempTime = animationRegisterCache.vertexLife;
            else {
                switch (this._iNumSegmentPoint) {
                    case 1:
                        code += "sub " + accTime + "," + animationRegisterCache.vertexLife + "," + lifeTimeRegister + ".x\n";
                        break;
                    case 2:
                        code += "sub " + accTime + "," + accTime + "," + lifeTimeRegister + ".y\n";
                        break;
                    case 3:
                        code += "sub " + accTime + "," + accTime + "," + lifeTimeRegister + ".z\n";
                        break;
                    case 4:
                        code += "sub " + accTime + "," + accTime + "," + lifeTimeRegister + ".w\n";
                        break;
                }
                code += "max " + tempTime + "," + accTime + "," + animationRegisterCache.vertexZeroConst + "\n";
            }
            if (this._iUsesMultiplier) {
                code += "mul " + tempColor + "," + tempTime + "," + deltaMulValues[this._iNumSegmentPoint] + "\n";
                code += "add " + accMultiplierColor + "," + accMultiplierColor + "," + tempColor + "\n";
                code += "mul " + animationRegisterCache.colorMulTarget + "," + animationRegisterCache.colorMulTarget + "," + accMultiplierColor + "\n";
            }
            if (this._iUsesOffset) {
                code += "mul " + tempColor + "," + tempTime + "," + deltaOffsetValues[this._iNumSegmentPoint] + "\n";
                code += "add " + animationRegisterCache.colorAddTarget + "," + animationRegisterCache.colorAddTarget + "," + tempColor + "\n";
            }
        }
        return code;
    };
    return ParticleSegmentedColorNode;
})(ParticleNodeBase);
module.exports = ParticleSegmentedColorNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvcGFydGljbGVzZWdtZW50ZWRjb2xvcm5vZGUudHMiXSwibmFtZXMiOlsiUGFydGljbGVTZWdtZW50ZWRDb2xvck5vZGUiLCJQYXJ0aWNsZVNlZ21lbnRlZENvbG9yTm9kZS5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlU2VnbWVudGVkQ29sb3JOb2RlLl9pUHJvY2Vzc0FuaW1hdGlvblNldHRpbmciLCJQYXJ0aWNsZVNlZ21lbnRlZENvbG9yTm9kZS5nZXRBR0FMVmVydGV4Q29kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBTUEsSUFBTyxxQkFBcUIsV0FBYSx5REFBeUQsQ0FBQyxDQUFDO0FBRXBHLElBQU8sb0JBQW9CLFdBQWMsc0RBQXNELENBQUMsQ0FBQztBQUdqRyxJQUFPLHNCQUFzQixXQUFhLDZEQUE2RCxDQUFDLENBQUM7QUFDekcsSUFBTyxnQkFBZ0IsV0FBZSx3REFBd0QsQ0FBQyxDQUFDO0FBQ2hHLElBQU8sMkJBQTJCLFdBQVksb0VBQW9FLENBQUMsQ0FBQztBQUVwSCxBQUdBOztHQURHO0lBQ0csMEJBQTBCO0lBQVNBLFVBQW5DQSwwQkFBMEJBLFVBQXlCQTtJQWV4REEsU0FmS0EsMEJBQTBCQSxDQWVuQkEsY0FBc0JBLEVBQUVBLFVBQWtCQSxFQUFFQSxlQUFlQSxDQUFRQSxPQUFEQSxBQUFRQSxFQUFFQSxVQUF5QkEsRUFBRUEsUUFBdUJBLEVBQUVBLGFBQXNDQTtRQUVqTEMsQUFDQUEsNkVBRDZFQTtRQUM3RUEsa0JBQU1BLHdCQUF3QkEsRUFBRUEsc0JBQXNCQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxvQkFBb0JBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBO1FBRXZHQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSwyQkFBMkJBLENBQUNBO1FBRWhEQSxFQUFFQSxDQUFDQSxDQUFDQSxlQUFlQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN2QkEsTUFBS0EsQ0FBQ0Es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Q0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDaENBLEtBQUtBLENBQUNBO3dCQUNMQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxPQUFPQSxHQUFHQSxHQUFHQSxHQUFHQSxzQkFBc0JBLENBQUNBLFVBQVVBLEdBQUdBLEdBQUdBLEdBQUdBLGdCQUFnQkEsR0FBR0EsTUFBTUEsQ0FBQ0E7d0JBQ3JHQSxLQUFLQSxDQUFDQTtvQkFDUEEsS0FBS0EsQ0FBQ0E7d0JBQ0xBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLGdCQUFnQkEsR0FBR0EsTUFBTUEsQ0FBQ0E7d0JBQzNFQSxLQUFLQSxDQUFDQTtvQkFDUEEsS0FBS0EsQ0FBQ0E7d0JBQ0xBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLGdCQUFnQkEsR0FBR0EsTUFBTUEsQ0FBQ0E7d0JBQzNFQSxLQUFLQSxDQUFDQTtvQkFDUEEsS0FBS0EsQ0FBQ0E7d0JBQ0xBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLGdCQUFnQkEsR0FBR0EsTUFBTUEsQ0FBQ0E7d0JBQzNFQSxLQUFLQSxDQUFDQTtnQkFDUkEsQ0FBQ0E7Z0JBQ0RBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLEdBQUdBLEdBQUdBLE9BQU9BLEdBQUdBLEdBQUdBLEdBQUdBLHNCQUFzQkEsQ0FBQ0EsZUFBZUEsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDakdBLENBQUNBO1lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzNCQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxHQUFHQSxHQUFHQSxRQUFRQSxHQUFHQSxHQUFHQSxHQUFHQSxjQUFjQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNsR0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0Esa0JBQWtCQSxHQUFHQSxHQUFHQSxHQUFHQSxrQkFBa0JBLEdBQUdBLEdBQUdBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUN4RkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0Esc0JBQXNCQSxDQUFDQSxjQUFjQSxHQUFHQSxHQUFHQSxHQUFHQSxzQkFBc0JBLENBQUNBLGNBQWNBLEdBQUdBLEdBQUdBLEdBQUdBLGtCQUFrQkEsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDeElBLENBQUNBO1lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO2dCQUN2QkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsR0FBR0EsR0FBR0EsUUFBUUEsR0FBR0EsR0FBR0EsR0FBR0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNyR0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0Esc0JBQXNCQSxDQUFDQSxjQUFjQSxHQUFHQSxHQUFHQSxHQUFHQSxzQkFBc0JBLENBQUNBLGNBQWNBLEdBQUdBLEdBQUdBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBO1lBQy9IQSxDQUFDQTtRQUVGQSxDQUFDQTtRQUNEQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtJQUNiQSxDQUFDQTtJQUVGSCxpQ0FBQ0E7QUFBREEsQ0FyS0EsQUFxS0NBLEVBckt3QyxnQkFBZ0IsRUFxS3hEO0FBRUQsQUFBb0MsaUJBQTNCLDBCQUEwQixDQUFDIiwiZmlsZSI6ImFuaW1hdG9ycy9ub2Rlcy9QYXJ0aWNsZVNlZ21lbnRlZENvbG9yTm9kZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ29sb3JUcmFuc2Zvcm1cdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vQ29sb3JUcmFuc2Zvcm1cIik7XG5pbXBvcnQgVmVjdG9yM0RcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xuXG5pbXBvcnQgQW5pbWF0b3JCYXNlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9BbmltYXRvckJhc2VcIik7XG5pbXBvcnQgQW5pbWF0aW9uUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9BbmltYXRpb25SZWdpc3RlckNhY2hlXCIpO1xuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJFbGVtZW50XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcblxuaW1wb3J0IFBhcnRpY2xlQW5pbWF0aW9uU2V0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL1BhcnRpY2xlQW5pbWF0aW9uU2V0XCIpO1xuaW1wb3J0IENvbG9yU2VnbWVudFBvaW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvQ29sb3JTZWdtZW50UG9pbnRcIik7XG5pbXBvcnQgUGFydGljbGVQcm9wZXJ0aWVzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVQcm9wZXJ0aWVzXCIpO1xuaW1wb3J0IFBhcnRpY2xlUHJvcGVydGllc01vZGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVQcm9wZXJ0aWVzTW9kZVwiKTtcbmltcG9ydCBQYXJ0aWNsZU5vZGVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvUGFydGljbGVOb2RlQmFzZVwiKTtcbmltcG9ydCBQYXJ0aWNsZVNlZ21lbnRlZENvbG9yU3RhdGVcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9zdGF0ZXMvUGFydGljbGVTZWdtZW50ZWRDb2xvclN0YXRlXCIpO1xuXG4vKipcbiAqXG4gKi9cbmNsYXNzIFBhcnRpY2xlU2VnbWVudGVkQ29sb3JOb2RlIGV4dGVuZHMgUGFydGljbGVOb2RlQmFzZVxue1xuXHQvKiogQHByaXZhdGUgKi9cblx0cHVibGljIF9pVXNlc011bHRpcGxpZXI6Ym9vbGVhbjtcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaVVzZXNPZmZzZXQ6Ym9vbGVhbjtcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaVN0YXJ0Q29sb3I6Q29sb3JUcmFuc2Zvcm07XG5cdC8qKiBAcHJpdmF0ZSAqL1xuXHRwdWJsaWMgX2lFbmRDb2xvcjpDb2xvclRyYW5zZm9ybTtcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaU51bVNlZ21lbnRQb2ludDpudW1iZXIgLyppbnQqLztcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaVNlZ21lbnRQb2ludHM6QXJyYXk8Q29sb3JTZWdtZW50UG9pbnQ+O1xuXG5cdGNvbnN0cnVjdG9yKHVzZXNNdWx0aXBsaWVyOmJvb2xlYW4sIHVzZXNPZmZzZXQ6Ym9vbGVhbiwgbnVtU2VnbWVudFBvaW50Om51bWJlciAvKmludCovLCBzdGFydENvbG9yOkNvbG9yVHJhbnNmb3JtLCBlbmRDb2xvcjpDb2xvclRyYW5zZm9ybSwgc2VnbWVudFBvaW50czpBcnJheTxDb2xvclNlZ21lbnRQb2ludD4pXG5cdHtcblx0XHQvL2JlY2F1c2Ugb2YgdGhlIHN0YWdlM2QgcmVnaXN0ZXIgbGltaXRhdGlvbiwgaXQgb25seSBzdXBwb3J0IHRoZSBnbG9iYWwgbW9kZVxuXHRcdHN1cGVyKFwiUGFydGljbGVTZWdtZW50ZWRDb2xvclwiLCBQYXJ0aWNsZVByb3BlcnRpZXNNb2RlLkdMT0JBTCwgMCwgUGFydGljbGVBbmltYXRpb25TZXQuQ09MT1JfUFJJT1JJVFkpO1xuXG5cdFx0dGhpcy5fcFN0YXRlQ2xhc3MgPSBQYXJ0aWNsZVNlZ21lbnRlZENvbG9yU3RhdGU7XG5cblx0XHRpZiAobnVtU2VnbWVudFBvaW50ID4gNClcblx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZSBudW1TZWdtZW50UG9pbnQgbXVzdCBiZSBsZXNzIG9yIGVxdWFsIDRcIikpO1xuXHRcdHRoaXMuX2lVc2VzTXVsdGlwbGllciA9IHVzZXNNdWx0aXBsaWVyO1xuXHRcdHRoaXMuX2lVc2VzT2Zmc2V0ID0gdXNlc09mZnNldDtcblx0XHR0aGlzLl9pTnVtU2VnbWVudFBvaW50ID0gbnVtU2VnbWVudFBvaW50O1xuXHRcdHRoaXMuX2lTdGFydENvbG9yID0gc3RhcnRDb2xvcjtcblx0XHR0aGlzLl9pRW5kQ29sb3IgPSBlbmRDb2xvcjtcblx0XHR0aGlzLl9pU2VnbWVudFBvaW50cyA9IHNlZ21lbnRQb2ludHM7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaVByb2Nlc3NBbmltYXRpb25TZXR0aW5nKHBhcnRpY2xlQW5pbWF0aW9uU2V0OlBhcnRpY2xlQW5pbWF0aW9uU2V0KVxuXHR7XG5cdFx0aWYgKHRoaXMuX2lVc2VzTXVsdGlwbGllcilcblx0XHRcdHBhcnRpY2xlQW5pbWF0aW9uU2V0Lmhhc0NvbG9yTXVsTm9kZSA9IHRydWU7XG5cdFx0aWYgKHRoaXMuX2lVc2VzT2Zmc2V0KVxuXHRcdFx0cGFydGljbGVBbmltYXRpb25TZXQuaGFzQ29sb3JBZGROb2RlID0gdHJ1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGdldEFHQUxWZXJ0ZXhDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblx0XHRpZiAoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5uZWVkRnJhZ21lbnRBbmltYXRpb24pIHtcblx0XHRcdHZhciBhY2NNdWx0aXBsaWVyQ29sb3I6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xuXHRcdFx0Ly92YXIgYWNjT2Zmc2V0Q29sb3I6U2hhZGVyUmVnaXN0ZXJFbGVtZW50O1xuXHRcdFx0aWYgKHRoaXMuX2lVc2VzTXVsdGlwbGllcikge1xuXHRcdFx0XHRhY2NNdWx0aXBsaWVyQ29sb3IgPSBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhWZWN0b3JUZW1wKCk7XG5cdFx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuYWRkVmVydGV4VGVtcFVzYWdlcyhhY2NNdWx0aXBsaWVyQ29sb3IsIDEpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgdGVtcENvbG9yOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleFZlY3RvclRlbXAoKTtcblx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuYWRkVmVydGV4VGVtcFVzYWdlcyh0ZW1wQ29sb3IsIDEpO1xuXG5cdFx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhWZWN0b3JUZW1wKCk7XG5cdFx0XHR2YXIgYWNjVGltZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBuZXcgU2hhZGVyUmVnaXN0ZXJFbGVtZW50KHRlbXAucmVnTmFtZSwgdGVtcC5pbmRleCwgMCk7XG5cdFx0XHR2YXIgdGVtcFRpbWU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gbmV3IFNoYWRlclJlZ2lzdGVyRWxlbWVudCh0ZW1wLnJlZ05hbWUsIHRlbXAuaW5kZXgsIDEpO1xuXG5cdFx0XHRpZiAodGhpcy5faVVzZXNNdWx0aXBsaWVyKVxuXHRcdFx0XHRhbmltYXRpb25SZWdpc3RlckNhY2hlLnJlbW92ZVZlcnRleFRlbXBVc2FnZShhY2NNdWx0aXBsaWVyQ29sb3IpO1xuXG5cdFx0XHRhbmltYXRpb25SZWdpc3RlckNhY2hlLnJlbW92ZVZlcnRleFRlbXBVc2FnZSh0ZW1wQ29sb3IpO1xuXG5cdFx0XHQvL2ZvciBzYXZpbmcgYWxsIHRoZSBsaWZlIHZhbHVlcyAoYXQgbW9zdCA0KVxuXHRcdFx0dmFyIGxpZmVUaW1lUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2V0UmVnaXN0ZXJJbmRleCh0aGlzLCBQYXJ0aWNsZVNlZ21lbnRlZENvbG9yU3RhdGUuVElNRV9EQVRBX0lOREVYLCBsaWZlVGltZVJlZ2lzdGVyLmluZGV4KTtcblxuXHRcdFx0dmFyIGk6bnVtYmVyIC8qaW50Ki87XG5cblx0XHRcdHZhciBzdGFydE11bFZhbHVlOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcblx0XHRcdHZhciBkZWx0YU11bFZhbHVlczpBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+O1xuXHRcdFx0aWYgKHRoaXMuX2lVc2VzTXVsdGlwbGllcikge1xuXHRcdFx0XHRzdGFydE11bFZhbHVlID0gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHRcdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5zZXRSZWdpc3RlckluZGV4KHRoaXMsIFBhcnRpY2xlU2VnbWVudGVkQ29sb3JTdGF0ZS5TVEFSVF9NVUxUSVBMSUVSX0lOREVYLCBzdGFydE11bFZhbHVlLmluZGV4KTtcblx0XHRcdFx0ZGVsdGFNdWxWYWx1ZXMgPSBuZXcgQXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50PigpO1xuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgdGhpcy5faU51bVNlZ21lbnRQb2ludCArIDE7IGkrKylcblx0XHRcdFx0XHRkZWx0YU11bFZhbHVlcy5wdXNoKGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgc3RhcnRPZmZzZXRWYWx1ZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQ7XG5cdFx0XHR2YXIgZGVsdGFPZmZzZXRWYWx1ZXM6QXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50Pjtcblx0XHRcdGlmICh0aGlzLl9pVXNlc09mZnNldCkge1xuXHRcdFx0XHRzdGFydE9mZnNldFZhbHVlID0gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHRcdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5zZXRSZWdpc3RlckluZGV4KHRoaXMsIFBhcnRpY2xlU2VnbWVudGVkQ29sb3JTdGF0ZS5TVEFSVF9PRkZTRVRfSU5ERVgsIHN0YXJ0T2Zmc2V0VmFsdWUuaW5kZXgpO1xuXHRcdFx0XHRkZWx0YU9mZnNldFZhbHVlcyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KCk7XG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCB0aGlzLl9pTnVtU2VnbWVudFBvaW50ICsgMTsgaSsrKVxuXHRcdFx0XHRcdGRlbHRhT2Zmc2V0VmFsdWVzLnB1c2goYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLl9pVXNlc011bHRpcGxpZXIpXG5cdFx0XHRcdGNvZGUgKz0gXCJtb3YgXCIgKyBhY2NNdWx0aXBsaWVyQ29sb3IgKyBcIixcIiArIHN0YXJ0TXVsVmFsdWUgKyBcIlxcblwiO1xuXHRcdFx0aWYgKHRoaXMuX2lVc2VzT2Zmc2V0KVxuXHRcdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5jb2xvckFkZFRhcmdldCArIFwiLFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5jb2xvckFkZFRhcmdldCArIFwiLFwiICsgc3RhcnRPZmZzZXRWYWx1ZSArIFwiXFxuXCI7XG5cblx0XHRcdGZvciAoaSA9IDA7IGkgPCB0aGlzLl9pTnVtU2VnbWVudFBvaW50OyBpKyspIHtcblx0XHRcdFx0c3dpdGNoIChpKSB7XG5cdFx0XHRcdFx0Y2FzZSAwOlxuXHRcdFx0XHRcdFx0Y29kZSArPSBcIm1pbiBcIiArIHRlbXBUaW1lICsgXCIsXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnZlcnRleExpZmUgKyBcIixcIiArIGxpZmVUaW1lUmVnaXN0ZXIgKyBcIi54XFxuXCI7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIDE6XG5cdFx0XHRcdFx0XHRjb2RlICs9IFwic3ViIFwiICsgYWNjVGltZSArIFwiLFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS52ZXJ0ZXhMaWZlICsgXCIsXCIgKyBsaWZlVGltZVJlZ2lzdGVyICsgXCIueFxcblwiO1xuXHRcdFx0XHRcdFx0Y29kZSArPSBcIm1heCBcIiArIHRlbXBUaW1lICsgXCIsXCIgKyBhY2NUaW1lICsgXCIsXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnZlcnRleFplcm9Db25zdCArIFwiXFxuXCI7XG5cdFx0XHRcdFx0XHRjb2RlICs9IFwibWluIFwiICsgdGVtcFRpbWUgKyBcIixcIiArIHRlbXBUaW1lICsgXCIsXCIgKyBsaWZlVGltZVJlZ2lzdGVyICsgXCIueVxcblwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSAyOlxuXHRcdFx0XHRcdFx0Y29kZSArPSBcInN1YiBcIiArIGFjY1RpbWUgKyBcIixcIiArIGFjY1RpbWUgKyBcIixcIiArIGxpZmVUaW1lUmVnaXN0ZXIgKyBcIi55XFxuXCI7XG5cdFx0XHRcdFx0XHRjb2RlICs9IFwibWF4IFwiICsgdGVtcFRpbWUgKyBcIixcIiArIGFjY1RpbWUgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4WmVyb0NvbnN0ICsgXCJcXG5cIjtcblx0XHRcdFx0XHRcdGNvZGUgKz0gXCJtaW4gXCIgKyB0ZW1wVGltZSArIFwiLFwiICsgdGVtcFRpbWUgKyBcIixcIiArIGxpZmVUaW1lUmVnaXN0ZXIgKyBcIi56XFxuXCI7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIDM6XG5cdFx0XHRcdFx0XHRjb2RlICs9IFwic3ViIFwiICsgYWNjVGltZSArIFwiLFwiICsgYWNjVGltZSArIFwiLFwiICsgbGlmZVRpbWVSZWdpc3RlciArIFwiLnpcXG5cIjtcblx0XHRcdFx0XHRcdGNvZGUgKz0gXCJtYXggXCIgKyB0ZW1wVGltZSArIFwiLFwiICsgYWNjVGltZSArIFwiLFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS52ZXJ0ZXhaZXJvQ29uc3QgKyBcIlxcblwiO1xuXHRcdFx0XHRcdFx0Y29kZSArPSBcIm1pbiBcIiArIHRlbXBUaW1lICsgXCIsXCIgKyB0ZW1wVGltZSArIFwiLFwiICsgbGlmZVRpbWVSZWdpc3RlciArIFwiLndcXG5cIjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICh0aGlzLl9pVXNlc011bHRpcGxpZXIpIHtcblx0XHRcdFx0XHRjb2RlICs9IFwibXVsIFwiICsgdGVtcENvbG9yICsgXCIsXCIgKyB0ZW1wVGltZSArIFwiLFwiICsgZGVsdGFNdWxWYWx1ZXNbaV0gKyBcIlxcblwiO1xuXHRcdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyBhY2NNdWx0aXBsaWVyQ29sb3IgKyBcIixcIiArIGFjY011bHRpcGxpZXJDb2xvciArIFwiLFwiICsgdGVtcENvbG9yICsgXCJcXG5cIjtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAodGhpcy5faVVzZXNPZmZzZXQpIHtcblx0XHRcdFx0XHRjb2RlICs9IFwibXVsIFwiICsgdGVtcENvbG9yICsgXCIsXCIgKyB0ZW1wVGltZSArIFwiLFwiICsgZGVsdGFPZmZzZXRWYWx1ZXNbaV0gKyBcIlxcblwiO1xuXHRcdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLmNvbG9yQWRkVGFyZ2V0ICsgXCIsXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLmNvbG9yQWRkVGFyZ2V0ICsgXCIsXCIgKyB0ZW1wQ29sb3IgKyBcIlxcblwiO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vZm9yIHRoZSBsYXN0IHNlZ21lbnQ6XG5cdFx0XHRpZiAodGhpcy5faU51bVNlZ21lbnRQb2ludCA9PSAwKVxuXHRcdFx0XHR0ZW1wVGltZSA9IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4TGlmZTtcblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRzd2l0Y2ggKHRoaXMuX2lOdW1TZWdtZW50UG9pbnQpIHtcblx0XHRcdFx0XHRjYXNlIDE6XG5cdFx0XHRcdFx0XHRjb2RlICs9IFwic3ViIFwiICsgYWNjVGltZSArIFwiLFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS52ZXJ0ZXhMaWZlICsgXCIsXCIgKyBsaWZlVGltZVJlZ2lzdGVyICsgXCIueFxcblwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSAyOlxuXHRcdFx0XHRcdFx0Y29kZSArPSBcInN1YiBcIiArIGFjY1RpbWUgKyBcIixcIiArIGFjY1RpbWUgKyBcIixcIiArIGxpZmVUaW1lUmVnaXN0ZXIgKyBcIi55XFxuXCI7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIDM6XG5cdFx0XHRcdFx0XHRjb2RlICs9IFwic3ViIFwiICsgYWNjVGltZSArIFwiLFwiICsgYWNjVGltZSArIFwiLFwiICsgbGlmZVRpbWVSZWdpc3RlciArIFwiLnpcXG5cIjtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgNDpcblx0XHRcdFx0XHRcdGNvZGUgKz0gXCJzdWIgXCIgKyBhY2NUaW1lICsgXCIsXCIgKyBhY2NUaW1lICsgXCIsXCIgKyBsaWZlVGltZVJlZ2lzdGVyICsgXCIud1xcblwiO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdFx0Y29kZSArPSBcIm1heCBcIiArIHRlbXBUaW1lICsgXCIsXCIgKyBhY2NUaW1lICsgXCIsXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnZlcnRleFplcm9Db25zdCArIFwiXFxuXCI7XG5cdFx0XHR9XG5cdFx0XHRpZiAodGhpcy5faVVzZXNNdWx0aXBsaWVyKSB7XG5cdFx0XHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0ZW1wQ29sb3IgKyBcIixcIiArIHRlbXBUaW1lICsgXCIsXCIgKyBkZWx0YU11bFZhbHVlc1t0aGlzLl9pTnVtU2VnbWVudFBvaW50XSArIFwiXFxuXCI7XG5cdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyBhY2NNdWx0aXBsaWVyQ29sb3IgKyBcIixcIiArIGFjY011bHRpcGxpZXJDb2xvciArIFwiLFwiICsgdGVtcENvbG9yICsgXCJcXG5cIjtcblx0XHRcdFx0Y29kZSArPSBcIm11bCBcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuY29sb3JNdWxUYXJnZXQgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuY29sb3JNdWxUYXJnZXQgKyBcIixcIiArIGFjY011bHRpcGxpZXJDb2xvciArIFwiXFxuXCI7XG5cdFx0XHR9XG5cdFx0XHRpZiAodGhpcy5faVVzZXNPZmZzZXQpIHtcblx0XHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRlbXBDb2xvciArIFwiLFwiICsgdGVtcFRpbWUgKyBcIixcIiArIGRlbHRhT2Zmc2V0VmFsdWVzW3RoaXMuX2lOdW1TZWdtZW50UG9pbnRdICsgXCJcXG5cIjtcblx0XHRcdFx0Y29kZSArPSBcImFkZCBcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuY29sb3JBZGRUYXJnZXQgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuY29sb3JBZGRUYXJnZXQgKyBcIixcIiArIHRlbXBDb2xvciArIFwiXFxuXCI7XG5cdFx0XHR9XG5cblx0XHR9XG5cdFx0cmV0dXJuIGNvZGU7XG5cdH1cblxufVxuXG5leHBvcnQgPSBQYXJ0aWNsZVNlZ21lbnRlZENvbG9yTm9kZTsiXX0=