var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleNodeBase = require("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");
var ParticleScaleState = require("awayjs-renderergl/lib/animators/states/ParticleScaleState");
/**
 * A particle animation node used to control the scale variation of a particle over time.
 */
var ParticleScaleNode = (function (_super) {
    __extends(ParticleScaleNode, _super);
    /**
     * Creates a new <code>ParticleScaleNode</code>
     *
     * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.
     * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of animation independent of particle duration. Defaults to false.
     * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the animation cycle. Defaults to false.
     * @param    [optional] minScale        Defines the default min scale transform of the node, when in global mode. Defaults to 1.
     * @param    [optional] maxScale        Defines the default max color transform of the node, when in global mode. Defaults to 1.
     * @param    [optional] cycleDuration   Defines the default duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.
     * @param    [optional] cyclePhase      Defines the default phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.
     */
    function ParticleScaleNode(mode /*uint*/, usesCycle, usesPhase, minScale, maxScale, cycleDuration, cyclePhase) {
        if (minScale === void 0) { minScale = 1; }
        if (maxScale === void 0) { maxScale = 1; }
        if (cycleDuration === void 0) { cycleDuration = 1; }
        if (cyclePhase === void 0) { cyclePhase = 0; }
        _super.call(this, "ParticleScale", mode, (usesCycle && usesPhase) ? 4 : ((usesCycle || usesPhase) ? 3 : 2), 3);
        this._pStateClass = ParticleScaleState;
        this._iUsesCycle = usesCycle;
        this._iUsesPhase = usesPhase;
        this._iMinScale = minScale;
        this._iMaxScale = maxScale;
        this._iCycleDuration = cycleDuration;
        this._iCyclePhase = cyclePhase;
    }
    /**
     * @inheritDoc
     */
    ParticleScaleNode.prototype.getAGALVertexCode = function (shaderObject, animationRegisterCache) {
        var code = "";
        var temp = animationRegisterCache.getFreeVertexSingleTemp();
        var scaleRegister = (this._pMode == ParticlePropertiesMode.GLOBAL) ? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();
        animationRegisterCache.setRegisterIndex(this, ParticleScaleState.SCALE_INDEX, scaleRegister.index);
        if (this._iUsesCycle) {
            code += "mul " + temp + "," + animationRegisterCache.vertexTime + "," + scaleRegister + ".z\n";
            if (this._iUsesPhase)
                code += "add " + temp + "," + temp + "," + scaleRegister + ".w\n";
            code += "sin " + temp + "," + temp + "\n";
        }
        code += "mul " + temp + "," + scaleRegister + ".y," + ((this._iUsesCycle) ? temp : animationRegisterCache.vertexLife) + "\n";
        code += "add " + temp + "," + scaleRegister + ".x," + temp + "\n";
        code += "mul " + animationRegisterCache.scaleAndRotateTarget + ".xyz," + animationRegisterCache.scaleAndRotateTarget + ".xyz," + temp + "\n";
        return code;
    };
    /**
     * @inheritDoc
     */
    ParticleScaleNode.prototype.getAnimationState = function (animator) {
        return animator.getAnimationState(this);
    };
    /**
     * @inheritDoc
     */
    ParticleScaleNode.prototype._iGeneratePropertyOfOneParticle = function (param) {
        var scale = param[ParticleScaleNode.SCALE_VECTOR3D];
        if (!scale)
            throw (new Error("there is no " + ParticleScaleNode.SCALE_VECTOR3D + " in param!"));
        if (this._iUsesCycle) {
            this._pOneData[0] = (scale.x + scale.y) / 2;
            this._pOneData[1] = Math.abs(scale.x - scale.y) / 2;
            if (scale.z <= 0)
                throw (new Error("the cycle duration must be greater than zero"));
            this._pOneData[2] = Math.PI * 2 / scale.z;
            if (this._iUsesPhase)
                this._pOneData[3] = scale.w * Math.PI / 180;
        }
        else {
            this._pOneData[0] = scale.x;
            this._pOneData[1] = scale.y - scale.x;
        }
    };
    /**
     * Reference for scale node properties on a single particle (when in local property mode).
     * Expects a <code>Vector3D</code> representing the min scale (x), max scale(y), optional cycle speed (z) and phase offset (w) applied to the particle.
     */
    ParticleScaleNode.SCALE_VECTOR3D = "ScaleVector3D";
    return ParticleScaleNode;
})(ParticleNodeBase);
module.exports = ParticleScaleNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvUGFydGljbGVTY2FsZU5vZGUudHMiXSwibmFtZXMiOlsiUGFydGljbGVTY2FsZU5vZGUiLCJQYXJ0aWNsZVNjYWxlTm9kZS5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlU2NhbGVOb2RlLmdldEFHQUxWZXJ0ZXhDb2RlIiwiUGFydGljbGVTY2FsZU5vZGUuZ2V0QW5pbWF0aW9uU3RhdGUiLCJQYXJ0aWNsZVNjYWxlTm9kZS5faUdlbmVyYXRlUHJvcGVydHlPZk9uZVBhcnRpY2xlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFRQSxJQUFPLHNCQUFzQixXQUFhLDZEQUE2RCxDQUFDLENBQUM7QUFDekcsSUFBTyxnQkFBZ0IsV0FBZSx3REFBd0QsQ0FBQyxDQUFDO0FBQ2hHLElBQU8sa0JBQWtCLFdBQWMsMkRBQTJELENBQUMsQ0FBQztBQUVwRyxBQUdBOztHQURHO0lBQ0csaUJBQWlCO0lBQVNBLFVBQTFCQSxpQkFBaUJBLFVBQXlCQTtJQXVCL0NBOzs7Ozs7Ozs7O09BVUdBO0lBQ0hBLFNBbENLQSxpQkFBaUJBLENBa0NWQSxJQUFJQSxDQUFRQSxRQUFEQSxBQUFTQSxFQUFFQSxTQUFpQkEsRUFBRUEsU0FBaUJBLEVBQUVBLFFBQW1CQSxFQUFFQSxRQUFtQkEsRUFBRUEsYUFBd0JBLEVBQUVBLFVBQXFCQTtRQUF6RkMsd0JBQW1CQSxHQUFuQkEsWUFBbUJBO1FBQUVBLHdCQUFtQkEsR0FBbkJBLFlBQW1CQTtRQUFFQSw2QkFBd0JBLEdBQXhCQSxpQkFBd0JBO1FBQUVBLDBCQUFxQkEsR0FBckJBLGNBQXFCQTtRQUVoS0Esa0JBQU1BLGVBQWVBLEVBQUVBLElBQUlBLEVBQUVBLENBQUNBLFNBQVNBLElBQUlBLFNBQVNBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLFNBQVNBLElBQUlBLFNBQVNBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEVBQUVBLENBQUNB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UUFFOURJLElBQUlBLEtBQUtBLEdBQVlBLEtBQUtBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0E7UUFDN0RBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBO1lBQ1ZBLE1BQUtBLENBQUNBLElBQUlBLEtBQUtBLENBQUNBLGNBQWNBLEdBQUdBLGlCQUFpQkEsQ0FBQ0EsY0FBY0EsR0FBR0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFcEZBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtZQUMxQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbERBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNoQkEsTUFBS0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsOENBQThDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsRUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBQ0EsQ0FBQ0EsR0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdENBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBO2dCQUNwQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDMUNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ1BBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO1lBQzVCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN2Q0EsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUF4RkRKOzs7T0FHR0E7SUFDV0EsZ0NBQWNBLEdBQVVBLGVBQWVBLENBQUNBO0lBcUZ2REEsd0JBQUNBO0FBQURBLENBMUdBLEFBMEdDQSxFQTFHK0IsZ0JBQWdCLEVBMEcvQztBQUVELEFBQTJCLGlCQUFsQixpQkFBaUIsQ0FBQyIsImZpbGUiOiJhbmltYXRvcnMvbm9kZXMvUGFydGljbGVTY2FsZU5vZGUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuXHJcbmltcG9ydCBBbmltYXRvckJhc2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL0FuaW1hdG9yQmFzZVwiKTtcclxuaW1wb3J0IEFuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvQW5pbWF0aW9uUmVnaXN0ZXJDYWNoZVwiKTtcclxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5cclxuaW1wb3J0IFBhcnRpY2xlUHJvcGVydGllc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL1BhcnRpY2xlUHJvcGVydGllc1wiKTtcclxuaW1wb3J0IFBhcnRpY2xlUHJvcGVydGllc01vZGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVQcm9wZXJ0aWVzTW9kZVwiKTtcclxuaW1wb3J0IFBhcnRpY2xlTm9kZUJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9ub2Rlcy9QYXJ0aWNsZU5vZGVCYXNlXCIpO1xyXG5pbXBvcnQgUGFydGljbGVTY2FsZVN0YXRlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL3N0YXRlcy9QYXJ0aWNsZVNjYWxlU3RhdGVcIik7XHJcblxyXG4vKipcclxuICogQSBwYXJ0aWNsZSBhbmltYXRpb24gbm9kZSB1c2VkIHRvIGNvbnRyb2wgdGhlIHNjYWxlIHZhcmlhdGlvbiBvZiBhIHBhcnRpY2xlIG92ZXIgdGltZS5cclxuICovXHJcbmNsYXNzIFBhcnRpY2xlU2NhbGVOb2RlIGV4dGVuZHMgUGFydGljbGVOb2RlQmFzZVxyXG57XHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIF9pVXNlc0N5Y2xlOmJvb2xlYW47XHJcblxyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaVVzZXNQaGFzZTpib29sZWFuO1xyXG5cclxuXHQvKiogQHByaXZhdGUgKi9cclxuXHRwdWJsaWMgX2lNaW5TY2FsZTpudW1iZXI7XHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIF9pTWF4U2NhbGU6bnVtYmVyO1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaUN5Y2xlRHVyYXRpb246bnVtYmVyO1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBfaUN5Y2xlUGhhc2U6bnVtYmVyO1xyXG5cclxuXHQvKipcclxuXHQgKiBSZWZlcmVuY2UgZm9yIHNjYWxlIG5vZGUgcHJvcGVydGllcyBvbiBhIHNpbmdsZSBwYXJ0aWNsZSAod2hlbiBpbiBsb2NhbCBwcm9wZXJ0eSBtb2RlKS5cclxuXHQgKiBFeHBlY3RzIGEgPGNvZGU+VmVjdG9yM0Q8L2NvZGU+IHJlcHJlc2VudGluZyB0aGUgbWluIHNjYWxlICh4KSwgbWF4IHNjYWxlKHkpLCBvcHRpb25hbCBjeWNsZSBzcGVlZCAoeikgYW5kIHBoYXNlIG9mZnNldCAodykgYXBwbGllZCB0byB0aGUgcGFydGljbGUuXHJcblx0ICovXHJcblx0cHVibGljIHN0YXRpYyBTQ0FMRV9WRUNUT1IzRDpzdHJpbmcgPSBcIlNjYWxlVmVjdG9yM0RcIjtcclxuXHJcblx0LyoqXHJcblx0ICogQ3JlYXRlcyBhIG5ldyA8Y29kZT5QYXJ0aWNsZVNjYWxlTm9kZTwvY29kZT5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSAgICAgICAgICAgICAgIG1vZGUgICAgICAgICAgICBEZWZpbmVzIHdoZXRoZXIgdGhlIG1vZGUgb2Ygb3BlcmF0aW9uIGFjdHMgb24gbG9jYWwgcHJvcGVydGllcyBvZiBhIHBhcnRpY2xlIG9yIGdsb2JhbCBwcm9wZXJ0aWVzIG9mIHRoZSBub2RlLlxyXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIHVzZXNDeWNsZSAgICAgICBEZWZpbmVzIHdoZXRoZXIgdGhlIG5vZGUgdXNlcyB0aGUgPGNvZGU+Y3ljbGVEdXJhdGlvbjwvY29kZT4gcHJvcGVydHkgaW4gdGhlIHNoYWRlciB0byBjYWxjdWxhdGUgdGhlIHBlcmlvZCBvZiBhbmltYXRpb24gaW5kZXBlbmRlbnQgb2YgcGFydGljbGUgZHVyYXRpb24uIERlZmF1bHRzIHRvIGZhbHNlLlxyXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIHVzZXNQaGFzZSAgICAgICBEZWZpbmVzIHdoZXRoZXIgdGhlIG5vZGUgdXNlcyB0aGUgPGNvZGU+Y3ljbGVQaGFzZTwvY29kZT4gcHJvcGVydHkgaW4gdGhlIHNoYWRlciB0byBjYWxjdWxhdGUgYSBzdGFydGluZyBvZmZzZXQgdG8gdGhlIGFuaW1hdGlvbiBjeWNsZS4gRGVmYXVsdHMgdG8gZmFsc2UuXHJcblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gbWluU2NhbGUgICAgICAgIERlZmluZXMgdGhlIGRlZmF1bHQgbWluIHNjYWxlIHRyYW5zZm9ybSBvZiB0aGUgbm9kZSwgd2hlbiBpbiBnbG9iYWwgbW9kZS4gRGVmYXVsdHMgdG8gMS5cclxuXHQgKiBAcGFyYW0gICAgW29wdGlvbmFsXSBtYXhTY2FsZSAgICAgICAgRGVmaW5lcyB0aGUgZGVmYXVsdCBtYXggY29sb3IgdHJhbnNmb3JtIG9mIHRoZSBub2RlLCB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAxLlxyXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIGN5Y2xlRHVyYXRpb24gICBEZWZpbmVzIHRoZSBkZWZhdWx0IGR1cmF0aW9uIG9mIHRoZSBhbmltYXRpb24gaW4gc2Vjb25kcywgdXNlZCBhcyBhIHBlcmlvZCBpbmRlcGVuZGVudCBvZiBwYXJ0aWNsZSBkdXJhdGlvbiB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAxLlxyXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIGN5Y2xlUGhhc2UgICAgICBEZWZpbmVzIHRoZSBkZWZhdWx0IHBoYXNlIG9mIHRoZSBjeWNsZSBpbiBkZWdyZWVzLCB1c2VkIGFzIHRoZSBzdGFydGluZyBvZmZzZXQgb2YgdGhlIGN5Y2xlIHdoZW4gaW4gZ2xvYmFsIG1vZGUuIERlZmF1bHRzIHRvIDAuXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IobW9kZTpudW1iZXIgLyp1aW50Ki8sIHVzZXNDeWNsZTpib29sZWFuLCB1c2VzUGhhc2U6Ym9vbGVhbiwgbWluU2NhbGU6bnVtYmVyID0gMSwgbWF4U2NhbGU6bnVtYmVyID0gMSwgY3ljbGVEdXJhdGlvbjpudW1iZXIgPSAxLCBjeWNsZVBoYXNlOm51bWJlciA9IDApXHJcblx0e1xyXG5cdFx0c3VwZXIoXCJQYXJ0aWNsZVNjYWxlXCIsIG1vZGUsICh1c2VzQ3ljbGUgJiYgdXNlc1BoYXNlKT8gNCA6ICgodXNlc0N5Y2xlIHx8IHVzZXNQaGFzZSk/IDMgOiAyKSwgMyk7XHJcblxyXG5cdFx0dGhpcy5fcFN0YXRlQ2xhc3MgPSBQYXJ0aWNsZVNjYWxlU3RhdGU7XHJcblxyXG5cdFx0dGhpcy5faVVzZXNDeWNsZSA9IHVzZXNDeWNsZTtcclxuXHRcdHRoaXMuX2lVc2VzUGhhc2UgPSB1c2VzUGhhc2U7XHJcblxyXG5cdFx0dGhpcy5faU1pblNjYWxlID0gbWluU2NhbGU7XHJcblx0XHR0aGlzLl9pTWF4U2NhbGUgPSBtYXhTY2FsZTtcclxuXHRcdHRoaXMuX2lDeWNsZUR1cmF0aW9uID0gY3ljbGVEdXJhdGlvbjtcclxuXHRcdHRoaXMuX2lDeWNsZVBoYXNlID0gY3ljbGVQaGFzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIGdldEFHQUxWZXJ0ZXhDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUpOnN0cmluZ1xyXG5cdHtcclxuXHRcdHZhciBjb2RlOnN0cmluZyA9IFwiXCI7XHJcblx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhTaW5nbGVUZW1wKCk7XHJcblxyXG5cdFx0dmFyIHNjYWxlUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gKHRoaXMuX3BNb2RlID09IFBhcnRpY2xlUHJvcGVydGllc01vZGUuR0xPQkFMKT8gYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKSA6IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleEF0dHJpYnV0ZSgpO1xyXG5cdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5zZXRSZWdpc3RlckluZGV4KHRoaXMsIFBhcnRpY2xlU2NhbGVTdGF0ZS5TQ0FMRV9JTkRFWCwgc2NhbGVSZWdpc3Rlci5pbmRleCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2lVc2VzQ3ljbGUpIHtcclxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRlbXAgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4VGltZSArIFwiLFwiICsgc2NhbGVSZWdpc3RlciArIFwiLnpcXG5cIjtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9pVXNlc1BoYXNlKVxyXG5cdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wICsgXCIsXCIgKyBzY2FsZVJlZ2lzdGVyICsgXCIud1xcblwiO1xyXG5cclxuXHRcdFx0Y29kZSArPSBcInNpbiBcIiArIHRlbXAgKyBcIixcIiArIHRlbXAgKyBcIlxcblwiO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0ZW1wICsgXCIsXCIgKyBzY2FsZVJlZ2lzdGVyICsgXCIueSxcIiArICgodGhpcy5faVVzZXNDeWNsZSk/IHRlbXAgOiBhbmltYXRpb25SZWdpc3RlckNhY2hlLnZlcnRleExpZmUpICsgXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0ZW1wICsgXCIsXCIgKyBzY2FsZVJlZ2lzdGVyICsgXCIueCxcIiArIHRlbXAgKyBcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2NhbGVBbmRSb3RhdGVUYXJnZXQgKyBcIi54eXosXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnNjYWxlQW5kUm90YXRlVGFyZ2V0ICsgXCIueHl6LFwiICsgdGVtcCArIFwiXFxuXCI7XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXRBbmltYXRpb25TdGF0ZShhbmltYXRvcjpBbmltYXRvckJhc2UpOlBhcnRpY2xlU2NhbGVTdGF0ZVxyXG5cdHtcclxuXHRcdHJldHVybiA8UGFydGljbGVTY2FsZVN0YXRlPiBhbmltYXRvci5nZXRBbmltYXRpb25TdGF0ZSh0aGlzKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIF9pR2VuZXJhdGVQcm9wZXJ0eU9mT25lUGFydGljbGUocGFyYW06UGFydGljbGVQcm9wZXJ0aWVzKVxyXG5cdHtcclxuXHRcdHZhciBzY2FsZTpWZWN0b3IzRCA9IHBhcmFtW1BhcnRpY2xlU2NhbGVOb2RlLlNDQUxFX1ZFQ1RPUjNEXTtcclxuXHRcdGlmICghc2NhbGUpXHJcblx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZXJlIGlzIG5vIFwiICsgUGFydGljbGVTY2FsZU5vZGUuU0NBTEVfVkVDVE9SM0QgKyBcIiBpbiBwYXJhbSFcIikpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9pVXNlc0N5Y2xlKSB7XHJcblx0XHRcdHRoaXMuX3BPbmVEYXRhWzBdID0gKHNjYWxlLnggKyBzY2FsZS55KS8yO1xyXG5cdFx0XHR0aGlzLl9wT25lRGF0YVsxXSA9IE1hdGguYWJzKHNjYWxlLnggLSBzY2FsZS55KS8yO1xyXG5cdFx0XHRpZiAoc2NhbGUueiA8PSAwKVxyXG5cdFx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZSBjeWNsZSBkdXJhdGlvbiBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvXCIpKTtcclxuXHRcdFx0dGhpcy5fcE9uZURhdGFbMl0gPSBNYXRoLlBJKjIvc2NhbGUuejtcclxuXHRcdFx0aWYgKHRoaXMuX2lVc2VzUGhhc2UpXHJcblx0XHRcdFx0dGhpcy5fcE9uZURhdGFbM10gPSBzY2FsZS53Kk1hdGguUEkvMTgwO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5fcE9uZURhdGFbMF0gPSBzY2FsZS54O1xyXG5cdFx0XHR0aGlzLl9wT25lRGF0YVsxXSA9IHNjYWxlLnkgLSBzY2FsZS54O1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gUGFydGljbGVTY2FsZU5vZGU7Il19