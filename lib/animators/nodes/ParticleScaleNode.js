var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleNodeBase = require("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");
var ParticleScaleState = require("awayjs-renderergl/lib/animators/states/ParticleScaleState");
/**
 * A particle animation node used to control the scale variation of a particle over time.
 */
var ParticleScaleNode = (function (_super) {
    __extends(ParticleScaleNode, _super);
    /**
     * Creates a new <code>ParticleScaleNode</code>
     *
     * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.
     * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of animation independent of particle duration. Defaults to false.
     * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the animation cycle. Defaults to false.
     * @param    [optional] minScale        Defines the default min scale transform of the node, when in global mode. Defaults to 1.
     * @param    [optional] maxScale        Defines the default max color transform of the node, when in global mode. Defaults to 1.
     * @param    [optional] cycleDuration   Defines the default duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.
     * @param    [optional] cyclePhase      Defines the default phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.
     */
    function ParticleScaleNode(mode /*uint*/, usesCycle, usesPhase, minScale, maxScale, cycleDuration, cyclePhase) {
        if (minScale === void 0) { minScale = 1; }
        if (maxScale === void 0) { maxScale = 1; }
        if (cycleDuration === void 0) { cycleDuration = 1; }
        if (cyclePhase === void 0) { cyclePhase = 0; }
        _super.call(this, "ParticleScale", mode, (usesCycle && usesPhase) ? 4 : ((usesCycle || usesPhase) ? 3 : 2), 3);
        this._pStateClass = ParticleScaleState;
        this._iUsesCycle = usesCycle;
        this._iUsesPhase = usesPhase;
        this._iMinScale = minScale;
        this._iMaxScale = maxScale;
        this._iCycleDuration = cycleDuration;
        this._iCyclePhase = cyclePhase;
    }
    /**
     * @inheritDoc
     */
    ParticleScaleNode.prototype.getAGALVertexCode = function (shaderObject, animationRegisterCache) {
        var code = "";
        var temp = animationRegisterCache.getFreeVertexSingleTemp();
        var scaleRegister = (this._pMode == ParticlePropertiesMode.GLOBAL) ? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();
        animationRegisterCache.setRegisterIndex(this, ParticleScaleState.SCALE_INDEX, scaleRegister.index);
        if (this._iUsesCycle) {
            code += "mul " + temp + "," + animationRegisterCache.vertexTime + "," + scaleRegister + ".z\n";
            if (this._iUsesPhase)
                code += "add " + temp + "," + temp + "," + scaleRegister + ".w\n";
            code += "sin " + temp + "," + temp + "\n";
        }
        code += "mul " + temp + "," + scaleRegister + ".y," + ((this._iUsesCycle) ? temp : animationRegisterCache.vertexLife) + "\n";
        code += "add " + temp + "," + scaleRegister + ".x," + temp + "\n";
        code += "mul " + animationRegisterCache.scaleAndRotateTarget + ".xyz," + animationRegisterCache.scaleAndRotateTarget + ".xyz," + temp + "\n";
        return code;
    };
    /**
     * @inheritDoc
     */
    ParticleScaleNode.prototype.getAnimationState = function (animator) {
        return animator.getAnimationState(this);
    };
    /**
     * @inheritDoc
     */
    ParticleScaleNode.prototype._iGeneratePropertyOfOneParticle = function (param) {
        var scale = param[ParticleScaleNode.SCALE_VECTOR3D];
        if (!scale)
            throw (new Error("there is no " + ParticleScaleNode.SCALE_VECTOR3D + " in param!"));
        if (this._iUsesCycle) {
            this._pOneData[0] = (scale.x + scale.y) / 2;
            this._pOneData[1] = Math.abs(scale.x - scale.y) / 2;
            if (scale.z <= 0)
                throw (new Error("the cycle duration must be greater than zero"));
            this._pOneData[2] = Math.PI * 2 / scale.z;
            if (this._iUsesPhase)
                this._pOneData[3] = scale.w * Math.PI / 180;
        }
        else {
            this._pOneData[0] = scale.x;
            this._pOneData[1] = scale.y - scale.x;
        }
    };
    /**
     * Reference for scale node properties on a single particle (when in local property mode).
     * Expects a <code>Vector3D</code> representing the min scale (x), max scale(y), optional cycle speed (z) and phase offset (w) applied to the particle.
     */
    ParticleScaleNode.SCALE_VECTOR3D = "ScaleVector3D";
    return ParticleScaleNode;
})(ParticleNodeBase);
module.exports = ParticleScaleNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuaW1hdG9ycy9ub2Rlcy9wYXJ0aWNsZXNjYWxlbm9kZS50cyJdLCJuYW1lcyI6WyJQYXJ0aWNsZVNjYWxlTm9kZSIsIlBhcnRpY2xlU2NhbGVOb2RlLmNvbnN0cnVjdG9yIiwiUGFydGljbGVTY2FsZU5vZGUuZ2V0QUdBTFZlcnRleENvZGUiLCJQYXJ0aWNsZVNjYWxlTm9kZS5nZXRBbmltYXRpb25TdGF0ZSIsIlBhcnRpY2xlU2NhbGVOb2RlLl9pR2VuZXJhdGVQcm9wZXJ0eU9mT25lUGFydGljbGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQVFBLElBQU8sc0JBQXNCLFdBQWEsNkRBQTZELENBQUMsQ0FBQztBQUN6RyxJQUFPLGdCQUFnQixXQUFlLHdEQUF3RCxDQUFDLENBQUM7QUFDaEcsSUFBTyxrQkFBa0IsV0FBYywyREFBMkQsQ0FBQyxDQUFDO0FBRXBHLEFBR0E7O0dBREc7SUFDRyxpQkFBaUI7SUFBU0EsVUFBMUJBLGlCQUFpQkEsVUFBeUJBO0lBdUIvQ0E7Ozs7Ozs7Ozs7T0FVR0E7SUFDSEEsU0FsQ0tBLGlCQUFpQkEsQ0FrQ1ZBLElBQUlBLENBQVFBLFFBQURBLEFBQVNBLEVBQUVBLFNBQWlCQSxFQUFFQSxTQUFpQkEsRUFBRUEsUUFBbUJBLEVBQUVBLFFBQW1CQSxFQUFFQSxhQUF3QkEsRUFBRUEsVUFBcUJBO1FBQXpGQyx3QkFBbUJBLEdBQW5CQSxZQUFtQkE7UUFBRUEsd0JBQW1CQSxHQUFuQkEsWUFBbUJBO1FBQUVBLDZCQUF3QkEsR0FBeEJBLGlCQUF3QkE7UUFBRUEsMEJBQXFCQSxHQUFyQkEsY0FBcUJBO1FBRWhLQSxrQkFBTUEsZUFBZUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsU0FBU0EsSUFBSUEsU0FBU0EsQ0FBQ0EsR0FBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsSUFBSUEsU0FBU0EsQ0FBQ0EsR0FBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFakdBLElB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WUEsS0FBS0EsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQTtRQUM3REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7WUFDVkEsTUFBS0EsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsY0FBY0EsR0FBR0EsaUJBQWlCQSxDQUFDQSxjQUFjQSxHQUFHQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVwRkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdEJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO1lBQzFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtZQUNsREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ2hCQSxNQUFLQSxDQUFDQSxJQUFJQSxLQUFLQSxDQUFDQSw4Q0FBOENBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xFQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFDQSxDQUFDQSxHQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0Q0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7Z0JBQ3BCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFDQSxHQUFHQSxDQUFDQTtRQUMxQ0EsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDNUJBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO1FBQ3ZDQSxDQUFDQTtJQUNGQSxDQUFDQTtJQXhGREo7OztPQUdHQTtJQUNXQSxnQ0FBY0EsR0FBVUEsZUFBZUEsQ0FBQ0E7SUFxRnZEQSx3QkFBQ0E7QUFBREEsQ0ExR0EsQUEwR0NBLEVBMUcrQixnQkFBZ0IsRUEwRy9DO0FBRUQsQUFBMkIsaUJBQWxCLGlCQUFpQixDQUFDIiwiZmlsZSI6ImFuaW1hdG9ycy9ub2Rlcy9QYXJ0aWNsZVNjYWxlTm9kZS5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvcm9iYmF0ZW1hbi9XZWJzdG9ybVByb2plY3RzL2F3YXlqcy1yZW5kZXJlcmdsLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IEFuaW1hdG9yQmFzZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9hbmltYXRvcnMvQW5pbWF0b3JCYXNlXCIpO1xuaW1wb3J0IEFuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYW5pbWF0b3JzL2RhdGEvQW5pbWF0aW9uUmVnaXN0ZXJDYWNoZVwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcblxuaW1wb3J0IFBhcnRpY2xlUHJvcGVydGllc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL1BhcnRpY2xlUHJvcGVydGllc1wiKTtcbmltcG9ydCBQYXJ0aWNsZVByb3BlcnRpZXNNb2RlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL1BhcnRpY2xlUHJvcGVydGllc01vZGVcIik7XG5pbXBvcnQgUGFydGljbGVOb2RlQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL25vZGVzL1BhcnRpY2xlTm9kZUJhc2VcIik7XG5pbXBvcnQgUGFydGljbGVTY2FsZVN0YXRlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL3N0YXRlcy9QYXJ0aWNsZVNjYWxlU3RhdGVcIik7XG5cbi8qKlxuICogQSBwYXJ0aWNsZSBhbmltYXRpb24gbm9kZSB1c2VkIHRvIGNvbnRyb2wgdGhlIHNjYWxlIHZhcmlhdGlvbiBvZiBhIHBhcnRpY2xlIG92ZXIgdGltZS5cbiAqL1xuY2xhc3MgUGFydGljbGVTY2FsZU5vZGUgZXh0ZW5kcyBQYXJ0aWNsZU5vZGVCYXNlXG57XG5cdC8qKiBAcHJpdmF0ZSAqL1xuXHRwdWJsaWMgX2lVc2VzQ3ljbGU6Ym9vbGVhbjtcblxuXHQvKiogQHByaXZhdGUgKi9cblx0cHVibGljIF9pVXNlc1BoYXNlOmJvb2xlYW47XG5cblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaU1pblNjYWxlOm51bWJlcjtcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaU1heFNjYWxlOm51bWJlcjtcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBfaUN5Y2xlRHVyYXRpb246bnVtYmVyO1xuXHQvKiogQHByaXZhdGUgKi9cblx0cHVibGljIF9pQ3ljbGVQaGFzZTpudW1iZXI7XG5cblx0LyoqXG5cdCAqIFJlZmVyZW5jZSBmb3Igc2NhbGUgbm9kZSBwcm9wZXJ0aWVzIG9uIGEgc2luZ2xlIHBhcnRpY2xlICh3aGVuIGluIGxvY2FsIHByb3BlcnR5IG1vZGUpLlxuXHQgKiBFeHBlY3RzIGEgPGNvZGU+VmVjdG9yM0Q8L2NvZGU+IHJlcHJlc2VudGluZyB0aGUgbWluIHNjYWxlICh4KSwgbWF4IHNjYWxlKHkpLCBvcHRpb25hbCBjeWNsZSBzcGVlZCAoeikgYW5kIHBoYXNlIG9mZnNldCAodykgYXBwbGllZCB0byB0aGUgcGFydGljbGUuXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIFNDQUxFX1ZFQ1RPUjNEOnN0cmluZyA9IFwiU2NhbGVWZWN0b3IzRFwiO1xuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IDxjb2RlPlBhcnRpY2xlU2NhbGVOb2RlPC9jb2RlPlxuXHQgKlxuXHQgKiBAcGFyYW0gICAgICAgICAgICAgICBtb2RlICAgICAgICAgICAgRGVmaW5lcyB3aGV0aGVyIHRoZSBtb2RlIG9mIG9wZXJhdGlvbiBhY3RzIG9uIGxvY2FsIHByb3BlcnRpZXMgb2YgYSBwYXJ0aWNsZSBvciBnbG9iYWwgcHJvcGVydGllcyBvZiB0aGUgbm9kZS5cblx0ICogQHBhcmFtICAgIFtvcHRpb25hbF0gdXNlc0N5Y2xlICAgICAgIERlZmluZXMgd2hldGhlciB0aGUgbm9kZSB1c2VzIHRoZSA8Y29kZT5jeWNsZUR1cmF0aW9uPC9jb2RlPiBwcm9wZXJ0eSBpbiB0aGUgc2hhZGVyIHRvIGNhbGN1bGF0ZSB0aGUgcGVyaW9kIG9mIGFuaW1hdGlvbiBpbmRlcGVuZGVudCBvZiBwYXJ0aWNsZSBkdXJhdGlvbi4gRGVmYXVsdHMgdG8gZmFsc2UuXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIHVzZXNQaGFzZSAgICAgICBEZWZpbmVzIHdoZXRoZXIgdGhlIG5vZGUgdXNlcyB0aGUgPGNvZGU+Y3ljbGVQaGFzZTwvY29kZT4gcHJvcGVydHkgaW4gdGhlIHNoYWRlciB0byBjYWxjdWxhdGUgYSBzdGFydGluZyBvZmZzZXQgdG8gdGhlIGFuaW1hdGlvbiBjeWNsZS4gRGVmYXVsdHMgdG8gZmFsc2UuXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIG1pblNjYWxlICAgICAgICBEZWZpbmVzIHRoZSBkZWZhdWx0IG1pbiBzY2FsZSB0cmFuc2Zvcm0gb2YgdGhlIG5vZGUsIHdoZW4gaW4gZ2xvYmFsIG1vZGUuIERlZmF1bHRzIHRvIDEuXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIG1heFNjYWxlICAgICAgICBEZWZpbmVzIHRoZSBkZWZhdWx0IG1heCBjb2xvciB0cmFuc2Zvcm0gb2YgdGhlIG5vZGUsIHdoZW4gaW4gZ2xvYmFsIG1vZGUuIERlZmF1bHRzIHRvIDEuXG5cdCAqIEBwYXJhbSAgICBbb3B0aW9uYWxdIGN5Y2xlRHVyYXRpb24gICBEZWZpbmVzIHRoZSBkZWZhdWx0IGR1cmF0aW9uIG9mIHRoZSBhbmltYXRpb24gaW4gc2Vjb25kcywgdXNlZCBhcyBhIHBlcmlvZCBpbmRlcGVuZGVudCBvZiBwYXJ0aWNsZSBkdXJhdGlvbiB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAxLlxuXHQgKiBAcGFyYW0gICAgW29wdGlvbmFsXSBjeWNsZVBoYXNlICAgICAgRGVmaW5lcyB0aGUgZGVmYXVsdCBwaGFzZSBvZiB0aGUgY3ljbGUgaW4gZGVncmVlcywgdXNlZCBhcyB0aGUgc3RhcnRpbmcgb2Zmc2V0IG9mIHRoZSBjeWNsZSB3aGVuIGluIGdsb2JhbCBtb2RlLiBEZWZhdWx0cyB0byAwLlxuXHQgKi9cblx0Y29uc3RydWN0b3IobW9kZTpudW1iZXIgLyp1aW50Ki8sIHVzZXNDeWNsZTpib29sZWFuLCB1c2VzUGhhc2U6Ym9vbGVhbiwgbWluU2NhbGU6bnVtYmVyID0gMSwgbWF4U2NhbGU6bnVtYmVyID0gMSwgY3ljbGVEdXJhdGlvbjpudW1iZXIgPSAxLCBjeWNsZVBoYXNlOm51bWJlciA9IDApXG5cdHtcblx0XHRzdXBlcihcIlBhcnRpY2xlU2NhbGVcIiwgbW9kZSwgKHVzZXNDeWNsZSAmJiB1c2VzUGhhc2UpPyA0IDogKCh1c2VzQ3ljbGUgfHwgdXNlc1BoYXNlKT8gMyA6IDIpLCAzKTtcblxuXHRcdHRoaXMuX3BTdGF0ZUNsYXNzID0gUGFydGljbGVTY2FsZVN0YXRlO1xuXG5cdFx0dGhpcy5faVVzZXNDeWNsZSA9IHVzZXNDeWNsZTtcblx0XHR0aGlzLl9pVXNlc1BoYXNlID0gdXNlc1BoYXNlO1xuXG5cdFx0dGhpcy5faU1pblNjYWxlID0gbWluU2NhbGU7XG5cdFx0dGhpcy5faU1heFNjYWxlID0gbWF4U2NhbGU7XG5cdFx0dGhpcy5faUN5Y2xlRHVyYXRpb24gPSBjeWNsZUR1cmF0aW9uO1xuXHRcdHRoaXMuX2lDeWNsZVBoYXNlID0gY3ljbGVQaGFzZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGdldEFHQUxWZXJ0ZXhDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhTaW5nbGVUZW1wKCk7XG5cblx0XHR2YXIgc2NhbGVSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSAodGhpcy5fcE1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5HTE9CQUwpPyBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpIDogYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4QXR0cmlidXRlKCk7XG5cdFx0YW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5zZXRSZWdpc3RlckluZGV4KHRoaXMsIFBhcnRpY2xlU2NhbGVTdGF0ZS5TQ0FMRV9JTkRFWCwgc2NhbGVSZWdpc3Rlci5pbmRleCk7XG5cblx0XHRpZiAodGhpcy5faVVzZXNDeWNsZSkge1xuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRlbXAgKyBcIixcIiArIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4VGltZSArIFwiLFwiICsgc2NhbGVSZWdpc3RlciArIFwiLnpcXG5cIjtcblxuXHRcdFx0aWYgKHRoaXMuX2lVc2VzUGhhc2UpXG5cdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0ZW1wICsgXCIsXCIgKyB0ZW1wICsgXCIsXCIgKyBzY2FsZVJlZ2lzdGVyICsgXCIud1xcblwiO1xuXG5cdFx0XHRjb2RlICs9IFwic2luIFwiICsgdGVtcCArIFwiLFwiICsgdGVtcCArIFwiXFxuXCI7XG5cdFx0fVxuXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHRlbXAgKyBcIixcIiArIHNjYWxlUmVnaXN0ZXIgKyBcIi55LFwiICsgKCh0aGlzLl9pVXNlc0N5Y2xlKT8gdGVtcCA6IGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUudmVydGV4TGlmZSkgKyBcIlxcblwiO1xuXHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB0ZW1wICsgXCIsXCIgKyBzY2FsZVJlZ2lzdGVyICsgXCIueCxcIiArIHRlbXAgKyBcIlxcblwiO1xuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBhbmltYXRpb25SZWdpc3RlckNhY2hlLnNjYWxlQW5kUm90YXRlVGFyZ2V0ICsgXCIueHl6LFwiICsgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5zY2FsZUFuZFJvdGF0ZVRhcmdldCArIFwiLnh5eixcIiArIHRlbXAgKyBcIlxcblwiO1xuXG5cdFx0cmV0dXJuIGNvZGU7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBnZXRBbmltYXRpb25TdGF0ZShhbmltYXRvcjpBbmltYXRvckJhc2UpOlBhcnRpY2xlU2NhbGVTdGF0ZVxuXHR7XG5cdFx0cmV0dXJuIDxQYXJ0aWNsZVNjYWxlU3RhdGU+IGFuaW1hdG9yLmdldEFuaW1hdGlvblN0YXRlKHRoaXMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lHZW5lcmF0ZVByb3BlcnR5T2ZPbmVQYXJ0aWNsZShwYXJhbTpQYXJ0aWNsZVByb3BlcnRpZXMpXG5cdHtcblx0XHR2YXIgc2NhbGU6VmVjdG9yM0QgPSBwYXJhbVtQYXJ0aWNsZVNjYWxlTm9kZS5TQ0FMRV9WRUNUT1IzRF07XG5cdFx0aWYgKCFzY2FsZSlcblx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZXJlIGlzIG5vIFwiICsgUGFydGljbGVTY2FsZU5vZGUuU0NBTEVfVkVDVE9SM0QgKyBcIiBpbiBwYXJhbSFcIikpO1xuXG5cdFx0aWYgKHRoaXMuX2lVc2VzQ3ljbGUpIHtcblx0XHRcdHRoaXMuX3BPbmVEYXRhWzBdID0gKHNjYWxlLnggKyBzY2FsZS55KS8yO1xuXHRcdFx0dGhpcy5fcE9uZURhdGFbMV0gPSBNYXRoLmFicyhzY2FsZS54IC0gc2NhbGUueSkvMjtcblx0XHRcdGlmIChzY2FsZS56IDw9IDApXG5cdFx0XHRcdHRocm93KG5ldyBFcnJvcihcInRoZSBjeWNsZSBkdXJhdGlvbiBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvXCIpKTtcblx0XHRcdHRoaXMuX3BPbmVEYXRhWzJdID0gTWF0aC5QSSoyL3NjYWxlLno7XG5cdFx0XHRpZiAodGhpcy5faVVzZXNQaGFzZSlcblx0XHRcdFx0dGhpcy5fcE9uZURhdGFbM10gPSBzY2FsZS53Kk1hdGguUEkvMTgwO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLl9wT25lRGF0YVswXSA9IHNjYWxlLng7XG5cdFx0XHR0aGlzLl9wT25lRGF0YVsxXSA9IHNjYWxlLnkgLSBzY2FsZS54O1xuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgPSBQYXJ0aWNsZVNjYWxlTm9kZTsiXX0=