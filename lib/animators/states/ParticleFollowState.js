var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var MathConsts = require("awayjs-core/lib/core/geom/MathConsts");
var Vector3D = require("awayjs-core/lib/core/geom/Vector3D");
var ContextGLVertexBufferFormat = require("awayjs-stagegl/lib/core/stagegl/ContextGLVertexBufferFormat");
var ParticleStateBase = require("awayjs-renderergl/lib/animators/states/ParticleStateBase");
/**
 * ...
 */
var ParticleFollowState = (function (_super) {
    __extends(ParticleFollowState, _super);
    function ParticleFollowState(animator, particleFollowNode) {
        _super.call(this, animator, particleFollowNode, true);
        this._targetPos = new Vector3D();
        this._targetEuler = new Vector3D();
        //temporary vector3D for calculation
        this._temp = new Vector3D();
        this._particleFollowNode = particleFollowNode;
        this._smooth = particleFollowNode._iSmooth;
    }
    Object.defineProperty(ParticleFollowState.prototype, "followTarget", {
        get: function () {
            return this._followTarget;
        },
        set: function (value) {
            this._followTarget = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ParticleFollowState.prototype, "smooth", {
        get: function () {
            return this._smooth;
        },
        set: function (value) {
            this._smooth = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ParticleFollowState.prototype.setRenderState = function (stage, renderable, animationSubGeometry, animationRegisterCache, camera) {
        if (this._followTarget) {
            if (this._particleFollowNode._iUsesPosition) {
                this._targetPos.x = this._followTarget.transform.position.x / renderable.sourceEntity.scaleX;
                this._targetPos.y = this._followTarget.transform.position.y / renderable.sourceEntity.scaleY;
                this._targetPos.z = this._followTarget.transform.position.z / renderable.sourceEntity.scaleZ;
            }
            if (this._particleFollowNode._iUsesRotation) {
                this._targetEuler.x = this._followTarget.rotationX;
                this._targetEuler.y = this._followTarget.rotationY;
                this._targetEuler.z = this._followTarget.rotationZ;
                this._targetEuler.scaleBy(MathConsts.DEGREES_TO_RADIANS);
            }
        }
        //initialization
        if (!this._prePos)
            this._prePos = this._targetPos.clone();
        if (!this._preEuler)
            this._preEuler = this._targetEuler.clone();
        var currentTime = this._pTime / 1000;
        var previousTime = animationSubGeometry.previousTime;
        var deltaTime = currentTime - previousTime;
        var needProcess = previousTime != currentTime;
        if (this._particleFollowNode._iUsesPosition && this._particleFollowNode._iUsesRotation) {
            if (needProcess)
                this.processPositionAndRotation(currentTime, deltaTime, animationSubGeometry);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);
        }
        else if (this._particleFollowNode._iUsesPosition) {
            if (needProcess)
                this.processPosition(currentTime, deltaTime, animationSubGeometry);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);
        }
        else if (this._particleFollowNode._iUsesRotation) {
            if (needProcess)
                this.precessRotation(currentTime, deltaTime, animationSubGeometry);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);
        }
        this._prePos.copyFrom(this._targetPos);
        this._targetEuler.copyFrom(this._targetEuler);
        animationSubGeometry.previousTime = currentTime;
    };
    ParticleFollowState.prototype.processPosition = function (currentTime, deltaTime, animationSubGeometry) {
        var data = animationSubGeometry.animationParticles;
        var vertexData = animationSubGeometry.vertexData;
        var changed = false;
        var len = data.length;
        var interpolatedPos;
        var posVelocity;
        if (this._smooth) {
            posVelocity = this._prePos.subtract(this._targetPos);
            posVelocity.scaleBy(1 / deltaTime);
        }
        else
            interpolatedPos = this._targetPos;
        for (var i = 0; i < len; i++) {
            var k = (currentTime - data[i].startTime) / data[i].totalTime;
            var t = (k - Math.floor(k)) * data[i].totalTime;
            if (t - deltaTime <= 0) {
                var inc = data[i].startVertexIndex * animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;
                if (this._smooth) {
                    this._temp.copyFrom(posVelocity);
                    this._temp.scaleBy(t);
                    interpolatedPos = this._targetPos.add(this._temp);
                }
                if (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z) {
                    changed = true;
                    for (var j = 0; j < data[i].numVertices; j++) {
                        vertexData[inc++] = interpolatedPos.x;
                        vertexData[inc++] = interpolatedPos.y;
                        vertexData[inc++] = interpolatedPos.z;
                    }
                }
            }
        }
        if (changed)
            animationSubGeometry.invalidateBuffer();
    };
    ParticleFollowState.prototype.precessRotation = function (currentTime, deltaTime, animationSubGeometry) {
        var data = animationSubGeometry.animationParticles;
        var vertexData = animationSubGeometry.vertexData;
        var changed = false;
        var len = data.length;
        var interpolatedRotation;
        var rotationVelocity;
        if (this._smooth) {
            rotationVelocity = this._preEuler.subtract(this._targetEuler);
            rotationVelocity.scaleBy(1 / deltaTime);
        }
        else
            interpolatedRotation = this._targetEuler;
        for (var i = 0; i < len; i++) {
            var k = (currentTime - data[i].startTime) / data[i].totalTime;
            var t = (k - Math.floor(k)) * data[i].totalTime;
            if (t - deltaTime <= 0) {
                var inc = data[i].startVertexIndex * animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;
                if (this._smooth) {
                    this._temp.copyFrom(rotationVelocity);
                    this._temp.scaleBy(t);
                    interpolatedRotation = this._targetEuler.add(this._temp);
                }
                if (vertexData[inc] != interpolatedRotation.x || vertexData[inc + 1] != interpolatedRotation.y || vertexData[inc + 2] != interpolatedRotation.z) {
                    changed = true;
                    for (var j = 0; j < data[i].numVertices; j++) {
                        vertexData[inc++] = interpolatedRotation.x;
                        vertexData[inc++] = interpolatedRotation.y;
                        vertexData[inc++] = interpolatedRotation.z;
                    }
                }
            }
        }
        if (changed)
            animationSubGeometry.invalidateBuffer();
    };
    ParticleFollowState.prototype.processPositionAndRotation = function (currentTime, deltaTime, animationSubGeometry) {
        var data = animationSubGeometry.animationParticles;
        var vertexData = animationSubGeometry.vertexData;
        var changed = false;
        var len = data.length;
        var interpolatedPos;
        var interpolatedRotation;
        var posVelocity;
        var rotationVelocity;
        if (this._smooth) {
            posVelocity = this._prePos.subtract(this._targetPos);
            posVelocity.scaleBy(1 / deltaTime);
            rotationVelocity = this._preEuler.subtract(this._targetEuler);
            rotationVelocity.scaleBy(1 / deltaTime);
        }
        else {
            interpolatedPos = this._targetPos;
            interpolatedRotation = this._targetEuler;
        }
        for (var i = 0; i < len; i++) {
            var k = (currentTime - data[i].startTime) / data[i].totalTime;
            var t = (k - Math.floor(k)) * data[i].totalTime;
            if (t - deltaTime <= 0) {
                var inc = data[i].startVertexIndex * animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;
                if (this._smooth) {
                    this._temp.copyFrom(posVelocity);
                    this._temp.scaleBy(t);
                    interpolatedPos = this._targetPos.add(this._temp);
                    this._temp.copyFrom(rotationVelocity);
                    this._temp.scaleBy(t);
                    interpolatedRotation = this._targetEuler.add(this._temp);
                }
                if (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z || vertexData[inc + 3] != interpolatedRotation.x || vertexData[inc + 4] != interpolatedRotation.y || vertexData[inc + 5] != interpolatedRotation.z) {
                    changed = true;
                    for (var j = 0; j < data[i].numVertices; j++) {
                        vertexData[inc++] = interpolatedPos.x;
                        vertexData[inc++] = interpolatedPos.y;
                        vertexData[inc++] = interpolatedPos.z;
                        vertexData[inc++] = interpolatedRotation.x;
                        vertexData[inc++] = interpolatedRotation.y;
                        vertexData[inc++] = interpolatedRotation.z;
                    }
                }
            }
        }
        if (changed)
            animationSubGeometry.invalidateBuffer();
    };
    /** @private */
    ParticleFollowState.FOLLOW_POSITION_INDEX = 0;
    /** @private */
    ParticleFollowState.FOLLOW_ROTATION_INDEX = 1;
    return ParticleFollowState;
})(ParticleStateBase);
module.exports = ParticleFollowState;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuaW1hdG9ycy9zdGF0ZXMvcGFydGljbGVmb2xsb3dzdGF0ZS50cyJdLCJuYW1lcyI6WyJQYXJ0aWNsZUZvbGxvd1N0YXRlIiwiUGFydGljbGVGb2xsb3dTdGF0ZS5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlRm9sbG93U3RhdGUuZm9sbG93VGFyZ2V0IiwiUGFydGljbGVGb2xsb3dTdGF0ZS5zbW9vdGgiLCJQYXJ0aWNsZUZvbGxvd1N0YXRlLnNldFJlbmRlclN0YXRlIiwiUGFydGljbGVGb2xsb3dTdGF0ZS5wcm9jZXNzUG9zaXRpb24iLCJQYXJ0aWNsZUZvbGxvd1N0YXRlLnByZWNlc3NSb3RhdGlvbiIsIlBhcnRpY2xlRm9sbG93U3RhdGUucHJvY2Vzc1Bvc2l0aW9uQW5kUm90YXRpb24iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQU8sVUFBVSxXQUFnQixzQ0FBc0MsQ0FBQyxDQUFDO0FBQ3pFLElBQU8sUUFBUSxXQUFpQixvQ0FBb0MsQ0FBQyxDQUFDO0FBTXRFLElBQU8sMkJBQTJCLFdBQVksNkRBQTZELENBQUMsQ0FBQztBQU03RyxJQUFPLGlCQUFpQixXQUFjLDBEQUEwRCxDQUFDLENBQUM7QUFFbEcsQUFHQTs7R0FERztJQUNHLG1CQUFtQjtJQUFTQSxVQUE1QkEsbUJBQW1CQSxVQUEwQkE7SUFvQmxEQSxTQXBCS0EsbUJBQW1CQSxDQW9CWkEsUUFBeUJBLEVBQUVBLGtCQUFxQ0E7UUFFM0VDLGtCQUFNQSxRQUFRQSxFQUFFQSxrQkFBa0JBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBWG5DQSxlQUFVQSxHQUFZQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUNyQ0EsaUJBQVlBLEdBQVlBLElBQUlBLFFBQVFBLEVBQUVBLENBQUNBO1FBSy9DQSxvQ0FBb0NBO1FBQzVCQSxVQUFLQSxHQUFZQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQU12Q0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxHQUFHQSxrQkFBa0JBLENBQUNBO1FBQzlDQSxJ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QkEsb0JBQW9CQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtnQkFDMURBLENBQUNBO2dCQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxlQUFlQSxDQUFDQSxDQUFDQSxJQUFJQSxVQUFVQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxlQUFlQSxDQUFDQSxDQUFDQSxJQUFJQSxVQUFVQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxlQUFlQSxDQUFDQSxDQUFDQSxJQUFJQSxVQUFVQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxvQkFBb0JBLENBQUNBLENBQUNBLElBQUlBLFVBQVVBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsVUFBVUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDclJBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBO29CQUNmQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFtQkEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7d0JBQzlEQSxVQUFVQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxlQUFlQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDdENBLFVBQVVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLGVBQWVBLENBQUNBLENBQUNBLENBQUNBO3dCQUN0Q0EsVUFBVUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ3RDQSxVQUFVQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBO3dCQUMzQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDM0NBLFVBQVVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzVDQSxDQUFDQTtnQkFDRkEsQ0FBQ0E7WUFDRkEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFDREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0E7WUFDWEEsb0JBQW9CQSxDQUFDQSxnQkFBZ0JBLEVBQUVBLENBQUNBO0lBQzFDQSxDQUFDQTtJQTdPRFAsZUFBZUE7SUFDREEseUNBQXFCQSxHQUFtQkEsQ0FBQ0EsQ0FBQ0E7SUFFeERBLGVBQWVBO0lBQ0RBLHlDQUFxQkEsR0FBbUJBLENBQUNBLENBQUNBO0lBMk96REEsMEJBQUNBO0FBQURBLENBalBBLEFBaVBDQSxFQWpQaUMsaUJBQWlCLEVBaVBsRDtBQUVELEFBQTZCLGlCQUFwQixtQkFBbUIsQ0FBQyIsImZpbGUiOiJhbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlRm9sbG93U3RhdGUuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtcmVuZGVyZXJnbC8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRGlzcGxheU9iamVjdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9iYXNlL0Rpc3BsYXlPYmplY3RcIik7XG5pbXBvcnQgTWF0aENvbnN0c1x0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2dlb20vTWF0aENvbnN0c1wiKTtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9WZWN0b3IzRFwiKTtcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5cbmltcG9ydCBBbmltYXRpb25SZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FuaW1hdG9ycy9kYXRhL0FuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9jb3JlL2Jhc2UvU3RhZ2VcIik7XG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcbmltcG9ydCBDb250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2NvcmUvc3RhZ2VnbC9Db250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXRcIik7XG5cbmltcG9ydCBQYXJ0aWNsZUFuaW1hdG9yXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvUGFydGljbGVBbmltYXRvclwiKTtcbmltcG9ydCBBbmltYXRpb25TdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL0FuaW1hdGlvblN1Ykdlb21ldHJ5XCIpO1xuaW1wb3J0IFBhcnRpY2xlQW5pbWF0aW9uRGF0YVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9QYXJ0aWNsZUFuaW1hdGlvbkRhdGFcIik7XG5pbXBvcnQgUGFydGljbGVGb2xsb3dOb2RlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL25vZGVzL1BhcnRpY2xlRm9sbG93Tm9kZVwiKTtcbmltcG9ydCBQYXJ0aWNsZVN0YXRlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9zdGF0ZXMvUGFydGljbGVTdGF0ZUJhc2VcIik7XG5cbi8qKlxuICogLi4uXG4gKi9cbmNsYXNzIFBhcnRpY2xlRm9sbG93U3RhdGUgZXh0ZW5kcyBQYXJ0aWNsZVN0YXRlQmFzZVxue1xuXHQvKiogQHByaXZhdGUgKi9cblx0cHVibGljIHN0YXRpYyBGT0xMT1dfUE9TSVRJT05fSU5ERVg6bnVtYmVyIC8qdWludCovID0gMDtcblxuXHQvKiogQHByaXZhdGUgKi9cblx0cHVibGljIHN0YXRpYyBGT0xMT1dfUk9UQVRJT05fSU5ERVg6bnVtYmVyIC8qdWludCovID0gMTtcblxuXHRwcml2YXRlIF9wYXJ0aWNsZUZvbGxvd05vZGU6UGFydGljbGVGb2xsb3dOb2RlO1xuXHRwcml2YXRlIF9mb2xsb3dUYXJnZXQ6RGlzcGxheU9iamVjdDtcblxuXHRwcml2YXRlIF90YXJnZXRQb3M6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0QoKTtcblx0cHJpdmF0ZSBfdGFyZ2V0RXVsZXI6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0QoKTtcblx0cHJpdmF0ZSBfcHJlUG9zOlZlY3RvcjNEO1xuXHRwcml2YXRlIF9wcmVFdWxlcjpWZWN0b3IzRDtcblx0cHJpdmF0ZSBfc21vb3RoOmJvb2xlYW47XG5cblx0Ly90ZW1wb3JhcnkgdmVjdG9yM0QgZm9yIGNhbGN1bGF0aW9uXG5cdHByaXZhdGUgX3RlbXA6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0QoKTtcblxuXHRjb25zdHJ1Y3RvcihhbmltYXRvcjpQYXJ0aWNsZUFuaW1hdG9yLCBwYXJ0aWNsZUZvbGxvd05vZGU6UGFydGljbGVGb2xsb3dOb2RlKVxuXHR7XG5cdFx0c3VwZXIoYW5pbWF0b3IsIHBhcnRpY2xlRm9sbG93Tm9kZSwgdHJ1ZSk7XG5cblx0XHR0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUgPSBwYXJ0aWNsZUZvbGxvd05vZGU7XG5cdFx0dGhpcy5fc21vb3RoID0gcGFydGljbGVGb2xsb3dOb2RlLl9pU21vb3RoO1xuXHR9XG5cblx0cHVibGljIGdldCBmb2xsb3dUYXJnZXQoKTpEaXNwbGF5T2JqZWN0XG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fZm9sbG93VGFyZ2V0O1xuXHR9XG5cblx0cHVibGljIHNldCBmb2xsb3dUYXJnZXQodmFsdWU6RGlzcGxheU9iamVjdClcblx0e1xuXHRcdHRoaXMuX2ZvbGxvd1RhcmdldCA9IHZhbHVlO1xuXHR9XG5cblx0cHVibGljIGdldCBzbW9vdGgoKTpib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fc21vb3RoO1xuXHR9XG5cblx0cHVibGljIHNldCBzbW9vdGgodmFsdWU6Ym9vbGVhbilcblx0e1xuXHRcdHRoaXMuX3Ntb290aCA9IHZhbHVlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgc2V0UmVuZGVyU3RhdGUoc3RhZ2U6U3RhZ2UsIHJlbmRlcmFibGU6UmVuZGVyYWJsZUJhc2UsIGFuaW1hdGlvblN1Ykdlb21ldHJ5OkFuaW1hdGlvblN1Ykdlb21ldHJ5LCBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUsIGNhbWVyYTpDYW1lcmEpXG5cdHtcblx0XHRpZiAodGhpcy5fZm9sbG93VGFyZ2V0KSB7XG5cdFx0XHRpZiAodGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pVXNlc1Bvc2l0aW9uKSB7XG5cdFx0XHRcdHRoaXMuX3RhcmdldFBvcy54ID0gdGhpcy5fZm9sbG93VGFyZ2V0LnRyYW5zZm9ybS5wb3NpdGlvbi54L3JlbmRlcmFibGUuc291cmNlRW50aXR5LnNjYWxlWDtcblx0XHRcdFx0dGhpcy5fdGFyZ2V0UG9zLnkgPSB0aGlzLl9mb2xsb3dUYXJnZXQudHJhbnNmb3JtLnBvc2l0aW9uLnkvcmVuZGVyYWJsZS5zb3VyY2VFbnRpdHkuc2NhbGVZO1xuXHRcdFx0XHR0aGlzLl90YXJnZXRQb3MueiA9IHRoaXMuX2ZvbGxvd1RhcmdldC50cmFuc2Zvcm0ucG9zaXRpb24uei9yZW5kZXJhYmxlLnNvdXJjZUVudGl0eS5zY2FsZVo7XG5cdFx0XHR9XG5cdFx0XHRpZiAodGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pVXNlc1JvdGF0aW9uKSB7XG5cdFx0XHRcdHRoaXMuX3RhcmdldEV1bGVyLnggPSB0aGlzLl9mb2xsb3dUYXJnZXQucm90YXRpb25YO1xuXHRcdFx0XHR0aGlzLl90YXJnZXRFdWxlci55ID0gdGhpcy5fZm9sbG93VGFyZ2V0LnJvdGF0aW9uWTtcblx0XHRcdFx0dGhpcy5fdGFyZ2V0RXVsZXIueiA9IHRoaXMuX2ZvbGxvd1RhcmdldC5yb3RhdGlvblo7XG5cdFx0XHRcdHRoaXMuX3RhcmdldEV1bGVyLnNjYWxlQnkoTWF0aENvbnN0cy5ERUdSRUVTX1RPX1JBRElBTlMpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHQvL2luaXRpYWxpemF0aW9uXG5cdFx0aWYgKCF0aGlzLl9wcmVQb3MpXG5cdFx0XHR0aGlzLl9wcmVQb3MgPSB0aGlzLl90YXJnZXRQb3MuY2xvbmUoKTtcblx0XHRpZiAoIXRoaXMuX3ByZUV1bGVyKVxuXHRcdFx0dGhpcy5fcHJlRXVsZXIgPSB0aGlzLl90YXJnZXRFdWxlci5jbG9uZSgpO1xuXG5cdFx0dmFyIGN1cnJlbnRUaW1lOm51bWJlciA9IHRoaXMuX3BUaW1lLzEwMDA7XG5cdFx0dmFyIHByZXZpb3VzVGltZTpudW1iZXIgPSBhbmltYXRpb25TdWJHZW9tZXRyeS5wcmV2aW91c1RpbWU7XG5cdFx0dmFyIGRlbHRhVGltZTpudW1iZXIgPSBjdXJyZW50VGltZSAtIHByZXZpb3VzVGltZTtcblxuXHRcdHZhciBuZWVkUHJvY2Vzczpib29sZWFuID0gcHJldmlvdXNUaW1lICE9IGN1cnJlbnRUaW1lO1xuXG5cdFx0aWYgKHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faVVzZXNQb3NpdGlvbiAmJiB0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUuX2lVc2VzUm90YXRpb24pIHtcblx0XHRcdGlmIChuZWVkUHJvY2Vzcylcblx0XHRcdFx0dGhpcy5wcm9jZXNzUG9zaXRpb25BbmRSb3RhdGlvbihjdXJyZW50VGltZSwgZGVsdGFUaW1lLCBhbmltYXRpb25TdWJHZW9tZXRyeSk7XG5cblx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmFjdGl2YXRlVmVydGV4QnVmZmVyKGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0UmVnaXN0ZXJJbmRleCh0aGlzLl9wQW5pbWF0aW9uTm9kZSwgUGFydGljbGVGb2xsb3dTdGF0ZS5GT0xMT1dfUE9TSVRJT05fSU5ERVgpLCB0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUuX2lEYXRhT2Zmc2V0LCBzdGFnZSwgQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0LkZMT0FUXzMpO1xuXHRcdFx0YW5pbWF0aW9uU3ViR2VvbWV0cnkuYWN0aXZhdGVWZXJ0ZXhCdWZmZXIoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRSZWdpc3RlckluZGV4KHRoaXMuX3BBbmltYXRpb25Ob2RlLCBQYXJ0aWNsZUZvbGxvd1N0YXRlLkZPTExPV19ST1RBVElPTl9JTkRFWCksIHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faURhdGFPZmZzZXQgKyAzLCBzdGFnZSwgQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0LkZMT0FUXzMpO1xuXHRcdH0gZWxzZSBpZiAodGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pVXNlc1Bvc2l0aW9uKSB7XG5cdFx0XHRpZiAobmVlZFByb2Nlc3MpXG5cdFx0XHRcdHRoaXMucHJvY2Vzc1Bvc2l0aW9uKGN1cnJlbnRUaW1lLCBkZWx0YVRpbWUsIGFuaW1hdGlvblN1Ykdlb21ldHJ5KTtcblxuXHRcdFx0YW5pbWF0aW9uU3ViR2VvbWV0cnkuYWN0aXZhdGVWZXJ0ZXhCdWZmZXIoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRSZWdpc3RlckluZGV4KHRoaXMuX3BBbmltYXRpb25Ob2RlLCBQYXJ0aWNsZUZvbGxvd1N0YXRlLkZPTExPV19QT1NJVElPTl9JTkRFWCksIHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faURhdGFPZmZzZXQsIHN0YWdlLCBDb250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXQuRkxPQVRfMyk7XG5cdFx0fSBlbHNlIGlmICh0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUuX2lVc2VzUm90YXRpb24pIHtcblx0XHRcdGlmIChuZWVkUHJvY2Vzcylcblx0XHRcdFx0dGhpcy5wcmVjZXNzUm90YXRpb24oY3VycmVudFRpbWUsIGRlbHRhVGltZSwgYW5pbWF0aW9uU3ViR2VvbWV0cnkpO1xuXG5cdFx0XHRhbmltYXRpb25TdWJHZW9tZXRyeS5hY3RpdmF0ZVZlcnRleEJ1ZmZlcihhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldFJlZ2lzdGVySW5kZXgodGhpcy5fcEFuaW1hdGlvbk5vZGUsIFBhcnRpY2xlRm9sbG93U3RhdGUuRk9MTE9XX1JPVEFUSU9OX0lOREVYKSwgdGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pRGF0YU9mZnNldCwgc3RhZ2UsIENvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdC5GTE9BVF8zKTtcblx0XHR9XG5cblx0XHR0aGlzLl9wcmVQb3MuY29weUZyb20odGhpcy5fdGFyZ2V0UG9zKTtcblx0XHR0aGlzLl90YXJnZXRFdWxlci5jb3B5RnJvbSh0aGlzLl90YXJnZXRFdWxlcik7XG5cdFx0YW5pbWF0aW9uU3ViR2VvbWV0cnkucHJldmlvdXNUaW1lID0gY3VycmVudFRpbWU7XG5cdH1cblxuXHRwcml2YXRlIHByb2Nlc3NQb3NpdGlvbihjdXJyZW50VGltZTpudW1iZXIsIGRlbHRhVGltZTpudW1iZXIsIGFuaW1hdGlvblN1Ykdlb21ldHJ5OkFuaW1hdGlvblN1Ykdlb21ldHJ5KVxuXHR7XG5cdFx0dmFyIGRhdGE6QXJyYXk8UGFydGljbGVBbmltYXRpb25EYXRhPiA9IGFuaW1hdGlvblN1Ykdlb21ldHJ5LmFuaW1hdGlvblBhcnRpY2xlcztcblx0XHR2YXIgdmVydGV4RGF0YTpBcnJheTxudW1iZXI+ID0gYW5pbWF0aW9uU3ViR2VvbWV0cnkudmVydGV4RGF0YTtcblxuXHRcdHZhciBjaGFuZ2VkOmJvb2xlYW4gPSBmYWxzZTtcblx0XHR2YXIgbGVuOm51bWJlciAvKnVpbnQqLyA9IGRhdGEubGVuZ3RoO1xuXHRcdHZhciBpbnRlcnBvbGF0ZWRQb3M6VmVjdG9yM0Q7XG5cdFx0dmFyIHBvc1ZlbG9jaXR5OlZlY3RvcjNEO1xuXHRcdGlmICh0aGlzLl9zbW9vdGgpIHtcblx0XHRcdHBvc1ZlbG9jaXR5ID0gdGhpcy5fcHJlUG9zLnN1YnRyYWN0KHRoaXMuX3RhcmdldFBvcyk7XG5cdFx0XHRwb3NWZWxvY2l0eS5zY2FsZUJ5KDEvZGVsdGFUaW1lKTtcblx0XHR9IGVsc2Vcblx0XHRcdGludGVycG9sYXRlZFBvcyA9IHRoaXMuX3RhcmdldFBvcztcblx0XHRmb3IgKHZhciBpOm51bWJlciAvKnVpbnQqLyA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0dmFyIGs6bnVtYmVyID0gKGN1cnJlbnRUaW1lIC0gZGF0YVtpXS5zdGFydFRpbWUpL2RhdGFbaV0udG90YWxUaW1lO1xuXHRcdFx0dmFyIHQ6bnVtYmVyID0gKGsgLSBNYXRoLmZsb29yKGspKSpkYXRhW2ldLnRvdGFsVGltZTtcblx0XHRcdGlmICh0IC0gZGVsdGFUaW1lIDw9IDApIHtcblx0XHRcdFx0dmFyIGluYzpudW1iZXIgLyppbnQqLyA9IGRhdGFbaV0uc3RhcnRWZXJ0ZXhJbmRleCphbmltYXRpb25TdWJHZW9tZXRyeS50b3RhbExlbk9mT25lVmVydGV4ICsgdGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pRGF0YU9mZnNldDtcblxuXHRcdFx0XHRpZiAodGhpcy5fc21vb3RoKSB7XG5cdFx0XHRcdFx0dGhpcy5fdGVtcC5jb3B5RnJvbShwb3NWZWxvY2l0eSk7XG5cdFx0XHRcdFx0dGhpcy5fdGVtcC5zY2FsZUJ5KHQpO1xuXHRcdFx0XHRcdGludGVycG9sYXRlZFBvcyA9IHRoaXMuX3RhcmdldFBvcy5hZGQodGhpcy5fdGVtcCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodmVydGV4RGF0YVtpbmNdICE9IGludGVycG9sYXRlZFBvcy54IHx8IHZlcnRleERhdGFbaW5jICsgMV0gIT0gaW50ZXJwb2xhdGVkUG9zLnkgfHwgdmVydGV4RGF0YVtpbmMgKyAyXSAhPSBpbnRlcnBvbGF0ZWRQb3Mueikge1xuXHRcdFx0XHRcdGNoYW5nZWQgPSB0cnVlO1xuXHRcdFx0XHRcdGZvciAodmFyIGo6bnVtYmVyIC8qdWludCovID0gMDsgaiA8IGRhdGFbaV0ubnVtVmVydGljZXM7IGorKykge1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRQb3MueDtcblx0XHRcdFx0XHRcdHZlcnRleERhdGFbaW5jKytdID0gaW50ZXJwb2xhdGVkUG9zLnk7XG5cdFx0XHRcdFx0XHR2ZXJ0ZXhEYXRhW2luYysrXSA9IGludGVycG9sYXRlZFBvcy56O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoY2hhbmdlZClcblx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmludmFsaWRhdGVCdWZmZXIoKTtcblxuXHR9XG5cblx0cHJpdmF0ZSBwcmVjZXNzUm90YXRpb24oY3VycmVudFRpbWU6bnVtYmVyLCBkZWx0YVRpbWU6bnVtYmVyLCBhbmltYXRpb25TdWJHZW9tZXRyeTpBbmltYXRpb25TdWJHZW9tZXRyeSlcblx0e1xuXHRcdHZhciBkYXRhOkFycmF5PFBhcnRpY2xlQW5pbWF0aW9uRGF0YT4gPSBhbmltYXRpb25TdWJHZW9tZXRyeS5hbmltYXRpb25QYXJ0aWNsZXM7XG5cdFx0dmFyIHZlcnRleERhdGE6QXJyYXk8bnVtYmVyPiA9IGFuaW1hdGlvblN1Ykdlb21ldHJ5LnZlcnRleERhdGE7XG5cblx0XHR2YXIgY2hhbmdlZDpib29sZWFuID0gZmFsc2U7XG5cdFx0dmFyIGxlbjpudW1iZXIgLyp1aW50Ki8gPSBkYXRhLmxlbmd0aDtcblxuXHRcdHZhciBpbnRlcnBvbGF0ZWRSb3RhdGlvbjpWZWN0b3IzRDtcblx0XHR2YXIgcm90YXRpb25WZWxvY2l0eTpWZWN0b3IzRDtcblxuXHRcdGlmICh0aGlzLl9zbW9vdGgpIHtcblx0XHRcdHJvdGF0aW9uVmVsb2NpdHkgPSB0aGlzLl9wcmVFdWxlci5zdWJ0cmFjdCh0aGlzLl90YXJnZXRFdWxlcik7XG5cdFx0XHRyb3RhdGlvblZlbG9jaXR5LnNjYWxlQnkoMS9kZWx0YVRpbWUpO1xuXHRcdH0gZWxzZVxuXHRcdFx0aW50ZXJwb2xhdGVkUm90YXRpb24gPSB0aGlzLl90YXJnZXRFdWxlcjtcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyIC8qdWludCovID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0XHR2YXIgazpudW1iZXIgPSAoY3VycmVudFRpbWUgLSBkYXRhW2ldLnN0YXJ0VGltZSkvZGF0YVtpXS50b3RhbFRpbWU7XG5cdFx0XHR2YXIgdDpudW1iZXIgPSAoayAtIE1hdGguZmxvb3IoaykpKmRhdGFbaV0udG90YWxUaW1lO1xuXHRcdFx0aWYgKHQgLSBkZWx0YVRpbWUgPD0gMCkge1xuXHRcdFx0XHR2YXIgaW5jOm51bWJlciAvKmludCovID0gZGF0YVtpXS5zdGFydFZlcnRleEluZGV4KmFuaW1hdGlvblN1Ykdlb21ldHJ5LnRvdGFsTGVuT2ZPbmVWZXJ0ZXggKyB0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUuX2lEYXRhT2Zmc2V0O1xuXG5cdFx0XHRcdGlmICh0aGlzLl9zbW9vdGgpIHtcblx0XHRcdFx0XHR0aGlzLl90ZW1wLmNvcHlGcm9tKHJvdGF0aW9uVmVsb2NpdHkpO1xuXHRcdFx0XHRcdHRoaXMuX3RlbXAuc2NhbGVCeSh0KTtcblx0XHRcdFx0XHRpbnRlcnBvbGF0ZWRSb3RhdGlvbiA9IHRoaXMuX3RhcmdldEV1bGVyLmFkZCh0aGlzLl90ZW1wKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh2ZXJ0ZXhEYXRhW2luY10gIT0gaW50ZXJwb2xhdGVkUm90YXRpb24ueCB8fCB2ZXJ0ZXhEYXRhW2luYyArIDFdICE9IGludGVycG9sYXRlZFJvdGF0aW9uLnkgfHwgdmVydGV4RGF0YVtpbmMgKyAyXSAhPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi56KSB7XG5cdFx0XHRcdFx0Y2hhbmdlZCA9IHRydWU7XG5cdFx0XHRcdFx0Zm9yICh2YXIgajpudW1iZXIgLyp1aW50Ki8gPSAwOyBqIDwgZGF0YVtpXS5udW1WZXJ0aWNlczsgaisrKSB7XG5cdFx0XHRcdFx0XHR2ZXJ0ZXhEYXRhW2luYysrXSA9IGludGVycG9sYXRlZFJvdGF0aW9uLng7XG5cdFx0XHRcdFx0XHR2ZXJ0ZXhEYXRhW2luYysrXSA9IGludGVycG9sYXRlZFJvdGF0aW9uLnk7XG5cdFx0XHRcdFx0XHR2ZXJ0ZXhEYXRhW2luYysrXSA9IGludGVycG9sYXRlZFJvdGF0aW9uLno7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChjaGFuZ2VkKVxuXHRcdFx0YW5pbWF0aW9uU3ViR2VvbWV0cnkuaW52YWxpZGF0ZUJ1ZmZlcigpO1xuXG5cdH1cblxuXHRwcml2YXRlIHByb2Nlc3NQb3NpdGlvbkFuZFJvdGF0aW9uKGN1cnJlbnRUaW1lOm51bWJlciwgZGVsdGFUaW1lOm51bWJlciwgYW5pbWF0aW9uU3ViR2VvbWV0cnk6QW5pbWF0aW9uU3ViR2VvbWV0cnkpXG5cdHtcblx0XHR2YXIgZGF0YTpBcnJheTxQYXJ0aWNsZUFuaW1hdGlvbkRhdGE+ID0gYW5pbWF0aW9uU3ViR2VvbWV0cnkuYW5pbWF0aW9uUGFydGljbGVzO1xuXHRcdHZhciB2ZXJ0ZXhEYXRhOkFycmF5PG51bWJlcj4gPSBhbmltYXRpb25TdWJHZW9tZXRyeS52ZXJ0ZXhEYXRhO1xuXG5cdFx0dmFyIGNoYW5nZWQ6Ym9vbGVhbiA9IGZhbHNlO1xuXHRcdHZhciBsZW46bnVtYmVyIC8qdWludCovID0gZGF0YS5sZW5ndGg7XG5cblx0XHR2YXIgaW50ZXJwb2xhdGVkUG9zOlZlY3RvcjNEO1xuXHRcdHZhciBpbnRlcnBvbGF0ZWRSb3RhdGlvbjpWZWN0b3IzRDtcblxuXHRcdHZhciBwb3NWZWxvY2l0eTpWZWN0b3IzRDtcblx0XHR2YXIgcm90YXRpb25WZWxvY2l0eTpWZWN0b3IzRDtcblx0XHRpZiAodGhpcy5fc21vb3RoKSB7XG5cdFx0XHRwb3NWZWxvY2l0eSA9IHRoaXMuX3ByZVBvcy5zdWJ0cmFjdCh0aGlzLl90YXJnZXRQb3MpO1xuXHRcdFx0cG9zVmVsb2NpdHkuc2NhbGVCeSgxL2RlbHRhVGltZSk7XG5cdFx0XHRyb3RhdGlvblZlbG9jaXR5ID0gdGhpcy5fcHJlRXVsZXIuc3VidHJhY3QodGhpcy5fdGFyZ2V0RXVsZXIpO1xuXHRcdFx0cm90YXRpb25WZWxvY2l0eS5zY2FsZUJ5KDEvZGVsdGFUaW1lKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aW50ZXJwb2xhdGVkUG9zID0gdGhpcy5fdGFyZ2V0UG9zO1xuXHRcdFx0aW50ZXJwb2xhdGVkUm90YXRpb24gPSB0aGlzLl90YXJnZXRFdWxlcjtcblx0XHR9XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciAvKnVpbnQqLyA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0dmFyIGs6bnVtYmVyID0gKGN1cnJlbnRUaW1lIC0gZGF0YVtpXS5zdGFydFRpbWUpL2RhdGFbaV0udG90YWxUaW1lO1xuXHRcdFx0dmFyIHQ6bnVtYmVyID0gKGsgLSBNYXRoLmZsb29yKGspKSpkYXRhW2ldLnRvdGFsVGltZTtcblx0XHRcdGlmICh0IC0gZGVsdGFUaW1lIDw9IDApIHtcblx0XHRcdFx0dmFyIGluYzpudW1iZXIgLyppbnQqLyA9IGRhdGFbaV0uc3RhcnRWZXJ0ZXhJbmRleCphbmltYXRpb25TdWJHZW9tZXRyeS50b3RhbExlbk9mT25lVmVydGV4ICsgdGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pRGF0YU9mZnNldDtcblx0XHRcdFx0aWYgKHRoaXMuX3Ntb290aCkge1xuXHRcdFx0XHRcdHRoaXMuX3RlbXAuY29weUZyb20ocG9zVmVsb2NpdHkpO1xuXHRcdFx0XHRcdHRoaXMuX3RlbXAuc2NhbGVCeSh0KTtcblx0XHRcdFx0XHRpbnRlcnBvbGF0ZWRQb3MgPSB0aGlzLl90YXJnZXRQb3MuYWRkKHRoaXMuX3RlbXApO1xuXG5cdFx0XHRcdFx0dGhpcy5fdGVtcC5jb3B5RnJvbShyb3RhdGlvblZlbG9jaXR5KTtcblx0XHRcdFx0XHR0aGlzLl90ZW1wLnNjYWxlQnkodCk7XG5cdFx0XHRcdFx0aW50ZXJwb2xhdGVkUm90YXRpb24gPSB0aGlzLl90YXJnZXRFdWxlci5hZGQodGhpcy5fdGVtcCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodmVydGV4RGF0YVtpbmNdICE9IGludGVycG9sYXRlZFBvcy54IHx8IHZlcnRleERhdGFbaW5jICsgMV0gIT0gaW50ZXJwb2xhdGVkUG9zLnkgfHwgdmVydGV4RGF0YVtpbmMgKyAyXSAhPSBpbnRlcnBvbGF0ZWRQb3MueiB8fCB2ZXJ0ZXhEYXRhW2luYyArIDNdICE9IGludGVycG9sYXRlZFJvdGF0aW9uLnggfHwgdmVydGV4RGF0YVtpbmMgKyA0XSAhPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi55IHx8IHZlcnRleERhdGFbaW5jICsgNV0gIT0gaW50ZXJwb2xhdGVkUm90YXRpb24ueikge1xuXHRcdFx0XHRcdGNoYW5nZWQgPSB0cnVlO1xuXHRcdFx0XHRcdGZvciAodmFyIGo6bnVtYmVyIC8qdWludCovID0gMDsgaiA8IGRhdGFbaV0ubnVtVmVydGljZXM7IGorKykge1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRQb3MueDtcblx0XHRcdFx0XHRcdHZlcnRleERhdGFbaW5jKytdID0gaW50ZXJwb2xhdGVkUG9zLnk7XG5cdFx0XHRcdFx0XHR2ZXJ0ZXhEYXRhW2luYysrXSA9IGludGVycG9sYXRlZFBvcy56O1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi54O1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi55O1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi56O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoY2hhbmdlZClcblx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmludmFsaWRhdGVCdWZmZXIoKTtcblx0fVxuXG59XG5cbmV4cG9ydCA9IFBhcnRpY2xlRm9sbG93U3RhdGU7Il19