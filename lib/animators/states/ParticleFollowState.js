var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var MathConsts = require("awayjs-core/lib/geom/MathConsts");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var ContextGLVertexBufferFormat = require("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");
var ParticleStateBase = require("awayjs-renderergl/lib/animators/states/ParticleStateBase");
/**
 * ...
 */
var ParticleFollowState = (function (_super) {
    __extends(ParticleFollowState, _super);
    function ParticleFollowState(animator, particleFollowNode) {
        _super.call(this, animator, particleFollowNode, true);
        this._targetPos = new Vector3D();
        this._targetEuler = new Vector3D();
        //temporary vector3D for calculation
        this._temp = new Vector3D();
        this._particleFollowNode = particleFollowNode;
        this._smooth = particleFollowNode._iSmooth;
    }
    Object.defineProperty(ParticleFollowState.prototype, "followTarget", {
        get: function () {
            return this._followTarget;
        },
        set: function (value) {
            this._followTarget = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ParticleFollowState.prototype, "smooth", {
        get: function () {
            return this._smooth;
        },
        set: function (value) {
            this._smooth = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ParticleFollowState.prototype.setRenderState = function (stage, renderable, animationSubGeometry, animationRegisterCache, camera) {
        if (this._followTarget) {
            if (this._particleFollowNode._iUsesPosition) {
                this._targetPos.x = this._followTarget.transform.position.x / renderable.sourceEntity.scaleX;
                this._targetPos.y = this._followTarget.transform.position.y / renderable.sourceEntity.scaleY;
                this._targetPos.z = this._followTarget.transform.position.z / renderable.sourceEntity.scaleZ;
            }
            if (this._particleFollowNode._iUsesRotation) {
                this._targetEuler.x = this._followTarget.rotationX;
                this._targetEuler.y = this._followTarget.rotationY;
                this._targetEuler.z = this._followTarget.rotationZ;
                this._targetEuler.scaleBy(MathConsts.DEGREES_TO_RADIANS);
            }
        }
        //initialization
        if (!this._prePos)
            this._prePos = this._targetPos.clone();
        if (!this._preEuler)
            this._preEuler = this._targetEuler.clone();
        var currentTime = this._pTime / 1000;
        var previousTime = animationSubGeometry.previousTime;
        var deltaTime = currentTime - previousTime;
        var needProcess = previousTime != currentTime;
        if (this._particleFollowNode._iUsesPosition && this._particleFollowNode._iUsesRotation) {
            if (needProcess)
                this.processPositionAndRotation(currentTime, deltaTime, animationSubGeometry);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);
        }
        else if (this._particleFollowNode._iUsesPosition) {
            if (needProcess)
                this.processPosition(currentTime, deltaTime, animationSubGeometry);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);
        }
        else if (this._particleFollowNode._iUsesRotation) {
            if (needProcess)
                this.precessRotation(currentTime, deltaTime, animationSubGeometry);
            animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);
        }
        this._prePos.copyFrom(this._targetPos);
        this._targetEuler.copyFrom(this._targetEuler);
        animationSubGeometry.previousTime = currentTime;
    };
    ParticleFollowState.prototype.processPosition = function (currentTime, deltaTime, animationSubGeometry) {
        var data = animationSubGeometry.animationParticles;
        var vertexData = animationSubGeometry.vertexData;
        var changed = false;
        var len = data.length;
        var interpolatedPos;
        var posVelocity;
        if (this._smooth) {
            posVelocity = this._prePos.subtract(this._targetPos);
            posVelocity.scaleBy(1 / deltaTime);
        }
        else
            interpolatedPos = this._targetPos;
        for (var i = 0; i < len; i++) {
            var k = (currentTime - data[i].startTime) / data[i].totalTime;
            var t = (k - Math.floor(k)) * data[i].totalTime;
            if (t - deltaTime <= 0) {
                var inc = data[i].startVertexIndex * animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;
                if (this._smooth) {
                    this._temp.copyFrom(posVelocity);
                    this._temp.scaleBy(t);
                    interpolatedPos = this._targetPos.add(this._temp);
                }
                if (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z) {
                    changed = true;
                    for (var j = 0; j < data[i].numVertices; j++) {
                        vertexData[inc++] = interpolatedPos.x;
                        vertexData[inc++] = interpolatedPos.y;
                        vertexData[inc++] = interpolatedPos.z;
                    }
                }
            }
        }
        if (changed)
            animationSubGeometry.invalidateBuffer();
    };
    ParticleFollowState.prototype.precessRotation = function (currentTime, deltaTime, animationSubGeometry) {
        var data = animationSubGeometry.animationParticles;
        var vertexData = animationSubGeometry.vertexData;
        var changed = false;
        var len = data.length;
        var interpolatedRotation;
        var rotationVelocity;
        if (this._smooth) {
            rotationVelocity = this._preEuler.subtract(this._targetEuler);
            rotationVelocity.scaleBy(1 / deltaTime);
        }
        else
            interpolatedRotation = this._targetEuler;
        for (var i = 0; i < len; i++) {
            var k = (currentTime - data[i].startTime) / data[i].totalTime;
            var t = (k - Math.floor(k)) * data[i].totalTime;
            if (t - deltaTime <= 0) {
                var inc = data[i].startVertexIndex * animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;
                if (this._smooth) {
                    this._temp.copyFrom(rotationVelocity);
                    this._temp.scaleBy(t);
                    interpolatedRotation = this._targetEuler.add(this._temp);
                }
                if (vertexData[inc] != interpolatedRotation.x || vertexData[inc + 1] != interpolatedRotation.y || vertexData[inc + 2] != interpolatedRotation.z) {
                    changed = true;
                    for (var j = 0; j < data[i].numVertices; j++) {
                        vertexData[inc++] = interpolatedRotation.x;
                        vertexData[inc++] = interpolatedRotation.y;
                        vertexData[inc++] = interpolatedRotation.z;
                    }
                }
            }
        }
        if (changed)
            animationSubGeometry.invalidateBuffer();
    };
    ParticleFollowState.prototype.processPositionAndRotation = function (currentTime, deltaTime, animationSubGeometry) {
        var data = animationSubGeometry.animationParticles;
        var vertexData = animationSubGeometry.vertexData;
        var changed = false;
        var len = data.length;
        var interpolatedPos;
        var interpolatedRotation;
        var posVelocity;
        var rotationVelocity;
        if (this._smooth) {
            posVelocity = this._prePos.subtract(this._targetPos);
            posVelocity.scaleBy(1 / deltaTime);
            rotationVelocity = this._preEuler.subtract(this._targetEuler);
            rotationVelocity.scaleBy(1 / deltaTime);
        }
        else {
            interpolatedPos = this._targetPos;
            interpolatedRotation = this._targetEuler;
        }
        for (var i = 0; i < len; i++) {
            var k = (currentTime - data[i].startTime) / data[i].totalTime;
            var t = (k - Math.floor(k)) * data[i].totalTime;
            if (t - deltaTime <= 0) {
                var inc = data[i].startVertexIndex * animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;
                if (this._smooth) {
                    this._temp.copyFrom(posVelocity);
                    this._temp.scaleBy(t);
                    interpolatedPos = this._targetPos.add(this._temp);
                    this._temp.copyFrom(rotationVelocity);
                    this._temp.scaleBy(t);
                    interpolatedRotation = this._targetEuler.add(this._temp);
                }
                if (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z || vertexData[inc + 3] != interpolatedRotation.x || vertexData[inc + 4] != interpolatedRotation.y || vertexData[inc + 5] != interpolatedRotation.z) {
                    changed = true;
                    for (var j = 0; j < data[i].numVertices; j++) {
                        vertexData[inc++] = interpolatedPos.x;
                        vertexData[inc++] = interpolatedPos.y;
                        vertexData[inc++] = interpolatedPos.z;
                        vertexData[inc++] = interpolatedRotation.x;
                        vertexData[inc++] = interpolatedRotation.y;
                        vertexData[inc++] = interpolatedRotation.z;
                    }
                }
            }
        }
        if (changed)
            animationSubGeometry.invalidateBuffer();
    };
    /** @private */
    ParticleFollowState.FOLLOW_POSITION_INDEX = 0;
    /** @private */
    ParticleFollowState.FOLLOW_ROTATION_INDEX = 1;
    return ParticleFollowState;
})(ParticleStateBase);
module.exports = ParticleFollowState;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL3BhcnRpY2xlZm9sbG93c3RhdGUudHMiXSwibmFtZXMiOlsiUGFydGljbGVGb2xsb3dTdGF0ZSIsIlBhcnRpY2xlRm9sbG93U3RhdGUuY29uc3RydWN0b3IiLCJQYXJ0aWNsZUZvbGxvd1N0YXRlLmZvbGxvd1RhcmdldCIsIlBhcnRpY2xlRm9sbG93U3RhdGUuc21vb3RoIiwiUGFydGljbGVGb2xsb3dTdGF0ZS5zZXRSZW5kZXJTdGF0ZSIsIlBhcnRpY2xlRm9sbG93U3RhdGUucHJvY2Vzc1Bvc2l0aW9uIiwiUGFydGljbGVGb2xsb3dTdGF0ZS5wcmVjZXNzUm90YXRpb24iLCJQYXJ0aWNsZUZvbGxvd1N0YXRlLnByb2Nlc3NQb3NpdGlvbkFuZFJvdGF0aW9uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFVBQVUsV0FBZ0IsaUNBQWlDLENBQUMsQ0FBQztBQUNwRSxJQUFPLFFBQVEsV0FBaUIsK0JBQStCLENBQUMsQ0FBQztBQU1qRSxJQUFPLDJCQUEyQixXQUFZLHFEQUFxRCxDQUFDLENBQUM7QUFPckcsSUFBTyxpQkFBaUIsV0FBYywwREFBMEQsQ0FBQyxDQUFDO0FBR2xHLEFBR0E7O0dBREc7SUFDRyxtQkFBbUI7SUFBU0EsVUFBNUJBLG1CQUFtQkEsVUFBMEJBO0lBb0JsREEsU0FwQktBLG1CQUFtQkEsQ0FvQlpBLFFBQXlCQSxFQUFFQSxrQkFBcUNBO1FBRTNFQyxrQkFBTUEsUUFBUUEsRUFBRUEsa0JBQWtCQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQVhuQ0EsZUFBVUEsR0FBWUEsSUFBSUEsUUFBUUEsRUFBRUEsQ0FBQ0E7UUFDckNBLGlCQUFZQSxHQUFZQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUsvQ0Esb0NBQW9DQTtRQUM1QkEsVUFBS0EsR0FBWUEsSUFBSUEsUUFBUUEsRUFBRUEsQ0FBQ0E7UUFNdkNBLElBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0Es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QUFDQSxDQUFDQSxDQUFDQTtvQkFDdEJBLG9CQUFvQkEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFEQSxDQUFDQTtnQkFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsZUFBZUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsVUFBVUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsZUFBZUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsVUFBVUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsZUFBZUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsVUFBVUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsb0JBQW9CQSxDQUFDQSxDQUFDQSxJQUFJQSxVQUFVQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxvQkFBb0JBLENBQUNBLENBQUNBLElBQUlBLFVBQVVBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLElBQUlBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3JSQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQTtvQkFDZkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBbUJBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO3dCQUM5REEsVUFBVUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0EsZUFBZUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ3RDQSxVQUFVQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxlQUFlQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDdENBLFVBQVVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLGVBQWVBLENBQUNBLENBQUNBLENBQUNBO3dCQUN0Q0EsVUFBVUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsR0FBR0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDM0NBLFVBQVVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLG9CQUFvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQzNDQSxVQUFVQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxHQUFHQSxvQkFBb0JBLENBQUNBLENBQUNBLENBQUNBO29CQUM1Q0EsQ0FBQ0E7Z0JBQ0ZBLENBQUNBO1lBQ0ZBLENBQUNBO1FBQ0ZBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBO1lBQ1hBLG9CQUFvQkEsQ0FBQ0EsZ0JBQWdCQSxFQUFFQSxDQUFDQTtJQUMxQ0EsQ0FBQ0E7SUE3T0RQLGVBQWVBO0lBQ0RBLHlDQUFxQkEsR0FBbUJBLENBQUNBLENBQUNBO0lBRXhEQSxlQUFlQTtJQUNEQSx5Q0FBcUJBLEdBQW1CQSxDQUFDQSxDQUFDQTtJQTJPekRBLDBCQUFDQTtBQUFEQSxDQWpQQSxBQWlQQ0EsRUFqUGlDLGlCQUFpQixFQWlQbEQ7QUFFRCxBQUE2QixpQkFBcEIsbUJBQW1CLENBQUMiLCJmaWxlIjoiYW5pbWF0b3JzL3N0YXRlcy9QYXJ0aWNsZUZvbGxvd1N0YXRlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRoQ29uc3RzXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0aENvbnN0c1wiKTtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XG5cbmltcG9ydCBEaXNwbGF5T2JqZWN0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0Rpc3BsYXlPYmplY3RcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xuXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuaW1wb3J0IENvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXRcIik7XG5cbmltcG9ydCBQYXJ0aWNsZUFuaW1hdG9yXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvUGFydGljbGVBbmltYXRvclwiKTtcbmltcG9ydCBBbmltYXRpb25SZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL0FuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgQW5pbWF0aW9uU3ViR2VvbWV0cnlcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9BbmltYXRpb25TdWJHZW9tZXRyeVwiKTtcbmltcG9ydCBQYXJ0aWNsZUFuaW1hdGlvbkRhdGFcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVBbmltYXRpb25EYXRhXCIpO1xuaW1wb3J0IFBhcnRpY2xlRm9sbG93Tm9kZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9ub2Rlcy9QYXJ0aWNsZUZvbGxvd05vZGVcIik7XG5pbXBvcnQgUGFydGljbGVTdGF0ZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlU3RhdGVCYXNlXCIpO1xuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xuXG4vKipcbiAqIC4uLlxuICovXG5jbGFzcyBQYXJ0aWNsZUZvbGxvd1N0YXRlIGV4dGVuZHMgUGFydGljbGVTdGF0ZUJhc2Vcbntcblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBzdGF0aWMgRk9MTE9XX1BPU0lUSU9OX0lOREVYOm51bWJlciAvKnVpbnQqLyA9IDA7XG5cblx0LyoqIEBwcml2YXRlICovXG5cdHB1YmxpYyBzdGF0aWMgRk9MTE9XX1JPVEFUSU9OX0lOREVYOm51bWJlciAvKnVpbnQqLyA9IDE7XG5cblx0cHJpdmF0ZSBfcGFydGljbGVGb2xsb3dOb2RlOlBhcnRpY2xlRm9sbG93Tm9kZTtcblx0cHJpdmF0ZSBfZm9sbG93VGFyZ2V0OkRpc3BsYXlPYmplY3Q7XG5cblx0cHJpdmF0ZSBfdGFyZ2V0UG9zOlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEKCk7XG5cdHByaXZhdGUgX3RhcmdldEV1bGVyOlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEKCk7XG5cdHByaXZhdGUgX3ByZVBvczpWZWN0b3IzRDtcblx0cHJpdmF0ZSBfcHJlRXVsZXI6VmVjdG9yM0Q7XG5cdHByaXZhdGUgX3Ntb290aDpib29sZWFuO1xuXG5cdC8vdGVtcG9yYXJ5IHZlY3RvcjNEIGZvciBjYWxjdWxhdGlvblxuXHRwcml2YXRlIF90ZW1wOlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEKCk7XG5cblx0Y29uc3RydWN0b3IoYW5pbWF0b3I6UGFydGljbGVBbmltYXRvciwgcGFydGljbGVGb2xsb3dOb2RlOlBhcnRpY2xlRm9sbG93Tm9kZSlcblx0e1xuXHRcdHN1cGVyKGFuaW1hdG9yLCBwYXJ0aWNsZUZvbGxvd05vZGUsIHRydWUpO1xuXG5cdFx0dGhpcy5fcGFydGljbGVGb2xsb3dOb2RlID0gcGFydGljbGVGb2xsb3dOb2RlO1xuXHRcdHRoaXMuX3Ntb290aCA9IHBhcnRpY2xlRm9sbG93Tm9kZS5faVNtb290aDtcblx0fVxuXG5cdHB1YmxpYyBnZXQgZm9sbG93VGFyZ2V0KCk6RGlzcGxheU9iamVjdFxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2ZvbGxvd1RhcmdldDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgZm9sbG93VGFyZ2V0KHZhbHVlOkRpc3BsYXlPYmplY3QpXG5cdHtcblx0XHR0aGlzLl9mb2xsb3dUYXJnZXQgPSB2YWx1ZTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgc21vb3RoKCk6Ym9vbGVhblxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX3Ntb290aDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgc21vb3RoKHZhbHVlOmJvb2xlYW4pXG5cdHtcblx0XHR0aGlzLl9zbW9vdGggPSB2YWx1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIHNldFJlbmRlclN0YXRlKHN0YWdlOlN0YWdlLCByZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBhbmltYXRpb25TdWJHZW9tZXRyeTpBbmltYXRpb25TdWJHZW9tZXRyeSwgYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZTpBbmltYXRpb25SZWdpc3RlckNhY2hlLCBjYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0aWYgKHRoaXMuX2ZvbGxvd1RhcmdldCkge1xuXHRcdFx0aWYgKHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faVVzZXNQb3NpdGlvbikge1xuXHRcdFx0XHR0aGlzLl90YXJnZXRQb3MueCA9IHRoaXMuX2ZvbGxvd1RhcmdldC50cmFuc2Zvcm0ucG9zaXRpb24ueC9yZW5kZXJhYmxlLnNvdXJjZUVudGl0eS5zY2FsZVg7XG5cdFx0XHRcdHRoaXMuX3RhcmdldFBvcy55ID0gdGhpcy5fZm9sbG93VGFyZ2V0LnRyYW5zZm9ybS5wb3NpdGlvbi55L3JlbmRlcmFibGUuc291cmNlRW50aXR5LnNjYWxlWTtcblx0XHRcdFx0dGhpcy5fdGFyZ2V0UG9zLnogPSB0aGlzLl9mb2xsb3dUYXJnZXQudHJhbnNmb3JtLnBvc2l0aW9uLnovcmVuZGVyYWJsZS5zb3VyY2VFbnRpdHkuc2NhbGVaO1xuXHRcdFx0fVxuXHRcdFx0aWYgKHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faVVzZXNSb3RhdGlvbikge1xuXHRcdFx0XHR0aGlzLl90YXJnZXRFdWxlci54ID0gdGhpcy5fZm9sbG93VGFyZ2V0LnJvdGF0aW9uWDtcblx0XHRcdFx0dGhpcy5fdGFyZ2V0RXVsZXIueSA9IHRoaXMuX2ZvbGxvd1RhcmdldC5yb3RhdGlvblk7XG5cdFx0XHRcdHRoaXMuX3RhcmdldEV1bGVyLnogPSB0aGlzLl9mb2xsb3dUYXJnZXQucm90YXRpb25aO1xuXHRcdFx0XHR0aGlzLl90YXJnZXRFdWxlci5zY2FsZUJ5KE1hdGhDb25zdHMuREVHUkVFU19UT19SQURJQU5TKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0Ly9pbml0aWFsaXphdGlvblxuXHRcdGlmICghdGhpcy5fcHJlUG9zKVxuXHRcdFx0dGhpcy5fcHJlUG9zID0gdGhpcy5fdGFyZ2V0UG9zLmNsb25lKCk7XG5cdFx0aWYgKCF0aGlzLl9wcmVFdWxlcilcblx0XHRcdHRoaXMuX3ByZUV1bGVyID0gdGhpcy5fdGFyZ2V0RXVsZXIuY2xvbmUoKTtcblxuXHRcdHZhciBjdXJyZW50VGltZTpudW1iZXIgPSB0aGlzLl9wVGltZS8xMDAwO1xuXHRcdHZhciBwcmV2aW91c1RpbWU6bnVtYmVyID0gYW5pbWF0aW9uU3ViR2VvbWV0cnkucHJldmlvdXNUaW1lO1xuXHRcdHZhciBkZWx0YVRpbWU6bnVtYmVyID0gY3VycmVudFRpbWUgLSBwcmV2aW91c1RpbWU7XG5cblx0XHR2YXIgbmVlZFByb2Nlc3M6Ym9vbGVhbiA9IHByZXZpb3VzVGltZSAhPSBjdXJyZW50VGltZTtcblxuXHRcdGlmICh0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUuX2lVc2VzUG9zaXRpb24gJiYgdGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pVXNlc1JvdGF0aW9uKSB7XG5cdFx0XHRpZiAobmVlZFByb2Nlc3MpXG5cdFx0XHRcdHRoaXMucHJvY2Vzc1Bvc2l0aW9uQW5kUm90YXRpb24oY3VycmVudFRpbWUsIGRlbHRhVGltZSwgYW5pbWF0aW9uU3ViR2VvbWV0cnkpO1xuXG5cdFx0XHRhbmltYXRpb25TdWJHZW9tZXRyeS5hY3RpdmF0ZVZlcnRleEJ1ZmZlcihhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldFJlZ2lzdGVySW5kZXgodGhpcy5fcEFuaW1hdGlvbk5vZGUsIFBhcnRpY2xlRm9sbG93U3RhdGUuRk9MTE9XX1BPU0lUSU9OX0lOREVYKSwgdGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pRGF0YU9mZnNldCwgc3RhZ2UsIENvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdC5GTE9BVF8zKTtcblx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmFjdGl2YXRlVmVydGV4QnVmZmVyKGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0UmVnaXN0ZXJJbmRleCh0aGlzLl9wQW5pbWF0aW9uTm9kZSwgUGFydGljbGVGb2xsb3dTdGF0ZS5GT0xMT1dfUk9UQVRJT05fSU5ERVgpLCB0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUuX2lEYXRhT2Zmc2V0ICsgMywgc3RhZ2UsIENvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdC5GTE9BVF8zKTtcblx0XHR9IGVsc2UgaWYgKHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faVVzZXNQb3NpdGlvbikge1xuXHRcdFx0aWYgKG5lZWRQcm9jZXNzKVxuXHRcdFx0XHR0aGlzLnByb2Nlc3NQb3NpdGlvbihjdXJyZW50VGltZSwgZGVsdGFUaW1lLCBhbmltYXRpb25TdWJHZW9tZXRyeSk7XG5cblx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmFjdGl2YXRlVmVydGV4QnVmZmVyKGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0UmVnaXN0ZXJJbmRleCh0aGlzLl9wQW5pbWF0aW9uTm9kZSwgUGFydGljbGVGb2xsb3dTdGF0ZS5GT0xMT1dfUE9TSVRJT05fSU5ERVgpLCB0aGlzLl9wYXJ0aWNsZUZvbGxvd05vZGUuX2lEYXRhT2Zmc2V0LCBzdGFnZSwgQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0LkZMT0FUXzMpO1xuXHRcdH0gZWxzZSBpZiAodGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pVXNlc1JvdGF0aW9uKSB7XG5cdFx0XHRpZiAobmVlZFByb2Nlc3MpXG5cdFx0XHRcdHRoaXMucHJlY2Vzc1JvdGF0aW9uKGN1cnJlbnRUaW1lLCBkZWx0YVRpbWUsIGFuaW1hdGlvblN1Ykdlb21ldHJ5KTtcblxuXHRcdFx0YW5pbWF0aW9uU3ViR2VvbWV0cnkuYWN0aXZhdGVWZXJ0ZXhCdWZmZXIoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRSZWdpc3RlckluZGV4KHRoaXMuX3BBbmltYXRpb25Ob2RlLCBQYXJ0aWNsZUZvbGxvd1N0YXRlLkZPTExPV19ST1RBVElPTl9JTkRFWCksIHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faURhdGFPZmZzZXQsIHN0YWdlLCBDb250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXQuRkxPQVRfMyk7XG5cdFx0fVxuXG5cdFx0dGhpcy5fcHJlUG9zLmNvcHlGcm9tKHRoaXMuX3RhcmdldFBvcyk7XG5cdFx0dGhpcy5fdGFyZ2V0RXVsZXIuY29weUZyb20odGhpcy5fdGFyZ2V0RXVsZXIpO1xuXHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LnByZXZpb3VzVGltZSA9IGN1cnJlbnRUaW1lO1xuXHR9XG5cblx0cHJpdmF0ZSBwcm9jZXNzUG9zaXRpb24oY3VycmVudFRpbWU6bnVtYmVyLCBkZWx0YVRpbWU6bnVtYmVyLCBhbmltYXRpb25TdWJHZW9tZXRyeTpBbmltYXRpb25TdWJHZW9tZXRyeSlcblx0e1xuXHRcdHZhciBkYXRhOkFycmF5PFBhcnRpY2xlQW5pbWF0aW9uRGF0YT4gPSBhbmltYXRpb25TdWJHZW9tZXRyeS5hbmltYXRpb25QYXJ0aWNsZXM7XG5cdFx0dmFyIHZlcnRleERhdGE6QXJyYXk8bnVtYmVyPiA9IGFuaW1hdGlvblN1Ykdlb21ldHJ5LnZlcnRleERhdGE7XG5cblx0XHR2YXIgY2hhbmdlZDpib29sZWFuID0gZmFsc2U7XG5cdFx0dmFyIGxlbjpudW1iZXIgLyp1aW50Ki8gPSBkYXRhLmxlbmd0aDtcblx0XHR2YXIgaW50ZXJwb2xhdGVkUG9zOlZlY3RvcjNEO1xuXHRcdHZhciBwb3NWZWxvY2l0eTpWZWN0b3IzRDtcblx0XHRpZiAodGhpcy5fc21vb3RoKSB7XG5cdFx0XHRwb3NWZWxvY2l0eSA9IHRoaXMuX3ByZVBvcy5zdWJ0cmFjdCh0aGlzLl90YXJnZXRQb3MpO1xuXHRcdFx0cG9zVmVsb2NpdHkuc2NhbGVCeSgxL2RlbHRhVGltZSk7XG5cdFx0fSBlbHNlXG5cdFx0XHRpbnRlcnBvbGF0ZWRQb3MgPSB0aGlzLl90YXJnZXRQb3M7XG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgLyp1aW50Ki8gPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdHZhciBrOm51bWJlciA9IChjdXJyZW50VGltZSAtIGRhdGFbaV0uc3RhcnRUaW1lKS9kYXRhW2ldLnRvdGFsVGltZTtcblx0XHRcdHZhciB0Om51bWJlciA9IChrIC0gTWF0aC5mbG9vcihrKSkqZGF0YVtpXS50b3RhbFRpbWU7XG5cdFx0XHRpZiAodCAtIGRlbHRhVGltZSA8PSAwKSB7XG5cdFx0XHRcdHZhciBpbmM6bnVtYmVyIC8qaW50Ki8gPSBkYXRhW2ldLnN0YXJ0VmVydGV4SW5kZXgqYW5pbWF0aW9uU3ViR2VvbWV0cnkudG90YWxMZW5PZk9uZVZlcnRleCArIHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faURhdGFPZmZzZXQ7XG5cblx0XHRcdFx0aWYgKHRoaXMuX3Ntb290aCkge1xuXHRcdFx0XHRcdHRoaXMuX3RlbXAuY29weUZyb20ocG9zVmVsb2NpdHkpO1xuXHRcdFx0XHRcdHRoaXMuX3RlbXAuc2NhbGVCeSh0KTtcblx0XHRcdFx0XHRpbnRlcnBvbGF0ZWRQb3MgPSB0aGlzLl90YXJnZXRQb3MuYWRkKHRoaXMuX3RlbXApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHZlcnRleERhdGFbaW5jXSAhPSBpbnRlcnBvbGF0ZWRQb3MueCB8fCB2ZXJ0ZXhEYXRhW2luYyArIDFdICE9IGludGVycG9sYXRlZFBvcy55IHx8IHZlcnRleERhdGFbaW5jICsgMl0gIT0gaW50ZXJwb2xhdGVkUG9zLnopIHtcblx0XHRcdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdFx0XHRmb3IgKHZhciBqOm51bWJlciAvKnVpbnQqLyA9IDA7IGogPCBkYXRhW2ldLm51bVZlcnRpY2VzOyBqKyspIHtcblx0XHRcdFx0XHRcdHZlcnRleERhdGFbaW5jKytdID0gaW50ZXJwb2xhdGVkUG9zLng7XG5cdFx0XHRcdFx0XHR2ZXJ0ZXhEYXRhW2luYysrXSA9IGludGVycG9sYXRlZFBvcy55O1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRQb3Muejtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKGNoYW5nZWQpXG5cdFx0XHRhbmltYXRpb25TdWJHZW9tZXRyeS5pbnZhbGlkYXRlQnVmZmVyKCk7XG5cblx0fVxuXG5cdHByaXZhdGUgcHJlY2Vzc1JvdGF0aW9uKGN1cnJlbnRUaW1lOm51bWJlciwgZGVsdGFUaW1lOm51bWJlciwgYW5pbWF0aW9uU3ViR2VvbWV0cnk6QW5pbWF0aW9uU3ViR2VvbWV0cnkpXG5cdHtcblx0XHR2YXIgZGF0YTpBcnJheTxQYXJ0aWNsZUFuaW1hdGlvbkRhdGE+ID0gYW5pbWF0aW9uU3ViR2VvbWV0cnkuYW5pbWF0aW9uUGFydGljbGVzO1xuXHRcdHZhciB2ZXJ0ZXhEYXRhOkFycmF5PG51bWJlcj4gPSBhbmltYXRpb25TdWJHZW9tZXRyeS52ZXJ0ZXhEYXRhO1xuXG5cdFx0dmFyIGNoYW5nZWQ6Ym9vbGVhbiA9IGZhbHNlO1xuXHRcdHZhciBsZW46bnVtYmVyIC8qdWludCovID0gZGF0YS5sZW5ndGg7XG5cblx0XHR2YXIgaW50ZXJwb2xhdGVkUm90YXRpb246VmVjdG9yM0Q7XG5cdFx0dmFyIHJvdGF0aW9uVmVsb2NpdHk6VmVjdG9yM0Q7XG5cblx0XHRpZiAodGhpcy5fc21vb3RoKSB7XG5cdFx0XHRyb3RhdGlvblZlbG9jaXR5ID0gdGhpcy5fcHJlRXVsZXIuc3VidHJhY3QodGhpcy5fdGFyZ2V0RXVsZXIpO1xuXHRcdFx0cm90YXRpb25WZWxvY2l0eS5zY2FsZUJ5KDEvZGVsdGFUaW1lKTtcblx0XHR9IGVsc2Vcblx0XHRcdGludGVycG9sYXRlZFJvdGF0aW9uID0gdGhpcy5fdGFyZ2V0RXVsZXI7XG5cblx0XHRmb3IgKHZhciBpOm51bWJlciAvKnVpbnQqLyA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0dmFyIGs6bnVtYmVyID0gKGN1cnJlbnRUaW1lIC0gZGF0YVtpXS5zdGFydFRpbWUpL2RhdGFbaV0udG90YWxUaW1lO1xuXHRcdFx0dmFyIHQ6bnVtYmVyID0gKGsgLSBNYXRoLmZsb29yKGspKSpkYXRhW2ldLnRvdGFsVGltZTtcblx0XHRcdGlmICh0IC0gZGVsdGFUaW1lIDw9IDApIHtcblx0XHRcdFx0dmFyIGluYzpudW1iZXIgLyppbnQqLyA9IGRhdGFbaV0uc3RhcnRWZXJ0ZXhJbmRleCphbmltYXRpb25TdWJHZW9tZXRyeS50b3RhbExlbk9mT25lVmVydGV4ICsgdGhpcy5fcGFydGljbGVGb2xsb3dOb2RlLl9pRGF0YU9mZnNldDtcblxuXHRcdFx0XHRpZiAodGhpcy5fc21vb3RoKSB7XG5cdFx0XHRcdFx0dGhpcy5fdGVtcC5jb3B5RnJvbShyb3RhdGlvblZlbG9jaXR5KTtcblx0XHRcdFx0XHR0aGlzLl90ZW1wLnNjYWxlQnkodCk7XG5cdFx0XHRcdFx0aW50ZXJwb2xhdGVkUm90YXRpb24gPSB0aGlzLl90YXJnZXRFdWxlci5hZGQodGhpcy5fdGVtcCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodmVydGV4RGF0YVtpbmNdICE9IGludGVycG9sYXRlZFJvdGF0aW9uLnggfHwgdmVydGV4RGF0YVtpbmMgKyAxXSAhPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi55IHx8IHZlcnRleERhdGFbaW5jICsgMl0gIT0gaW50ZXJwb2xhdGVkUm90YXRpb24ueikge1xuXHRcdFx0XHRcdGNoYW5nZWQgPSB0cnVlO1xuXHRcdFx0XHRcdGZvciAodmFyIGo6bnVtYmVyIC8qdWludCovID0gMDsgaiA8IGRhdGFbaV0ubnVtVmVydGljZXM7IGorKykge1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi54O1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi55O1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi56O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoY2hhbmdlZClcblx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmludmFsaWRhdGVCdWZmZXIoKTtcblxuXHR9XG5cblx0cHJpdmF0ZSBwcm9jZXNzUG9zaXRpb25BbmRSb3RhdGlvbihjdXJyZW50VGltZTpudW1iZXIsIGRlbHRhVGltZTpudW1iZXIsIGFuaW1hdGlvblN1Ykdlb21ldHJ5OkFuaW1hdGlvblN1Ykdlb21ldHJ5KVxuXHR7XG5cdFx0dmFyIGRhdGE6QXJyYXk8UGFydGljbGVBbmltYXRpb25EYXRhPiA9IGFuaW1hdGlvblN1Ykdlb21ldHJ5LmFuaW1hdGlvblBhcnRpY2xlcztcblx0XHR2YXIgdmVydGV4RGF0YTpBcnJheTxudW1iZXI+ID0gYW5pbWF0aW9uU3ViR2VvbWV0cnkudmVydGV4RGF0YTtcblxuXHRcdHZhciBjaGFuZ2VkOmJvb2xlYW4gPSBmYWxzZTtcblx0XHR2YXIgbGVuOm51bWJlciAvKnVpbnQqLyA9IGRhdGEubGVuZ3RoO1xuXG5cdFx0dmFyIGludGVycG9sYXRlZFBvczpWZWN0b3IzRDtcblx0XHR2YXIgaW50ZXJwb2xhdGVkUm90YXRpb246VmVjdG9yM0Q7XG5cblx0XHR2YXIgcG9zVmVsb2NpdHk6VmVjdG9yM0Q7XG5cdFx0dmFyIHJvdGF0aW9uVmVsb2NpdHk6VmVjdG9yM0Q7XG5cdFx0aWYgKHRoaXMuX3Ntb290aCkge1xuXHRcdFx0cG9zVmVsb2NpdHkgPSB0aGlzLl9wcmVQb3Muc3VidHJhY3QodGhpcy5fdGFyZ2V0UG9zKTtcblx0XHRcdHBvc1ZlbG9jaXR5LnNjYWxlQnkoMS9kZWx0YVRpbWUpO1xuXHRcdFx0cm90YXRpb25WZWxvY2l0eSA9IHRoaXMuX3ByZUV1bGVyLnN1YnRyYWN0KHRoaXMuX3RhcmdldEV1bGVyKTtcblx0XHRcdHJvdGF0aW9uVmVsb2NpdHkuc2NhbGVCeSgxL2RlbHRhVGltZSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGludGVycG9sYXRlZFBvcyA9IHRoaXMuX3RhcmdldFBvcztcblx0XHRcdGludGVycG9sYXRlZFJvdGF0aW9uID0gdGhpcy5fdGFyZ2V0RXVsZXI7XG5cdFx0fVxuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgLyp1aW50Ki8gPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdHZhciBrOm51bWJlciA9IChjdXJyZW50VGltZSAtIGRhdGFbaV0uc3RhcnRUaW1lKS9kYXRhW2ldLnRvdGFsVGltZTtcblx0XHRcdHZhciB0Om51bWJlciA9IChrIC0gTWF0aC5mbG9vcihrKSkqZGF0YVtpXS50b3RhbFRpbWU7XG5cdFx0XHRpZiAodCAtIGRlbHRhVGltZSA8PSAwKSB7XG5cdFx0XHRcdHZhciBpbmM6bnVtYmVyIC8qaW50Ki8gPSBkYXRhW2ldLnN0YXJ0VmVydGV4SW5kZXgqYW5pbWF0aW9uU3ViR2VvbWV0cnkudG90YWxMZW5PZk9uZVZlcnRleCArIHRoaXMuX3BhcnRpY2xlRm9sbG93Tm9kZS5faURhdGFPZmZzZXQ7XG5cdFx0XHRcdGlmICh0aGlzLl9zbW9vdGgpIHtcblx0XHRcdFx0XHR0aGlzLl90ZW1wLmNvcHlGcm9tKHBvc1ZlbG9jaXR5KTtcblx0XHRcdFx0XHR0aGlzLl90ZW1wLnNjYWxlQnkodCk7XG5cdFx0XHRcdFx0aW50ZXJwb2xhdGVkUG9zID0gdGhpcy5fdGFyZ2V0UG9zLmFkZCh0aGlzLl90ZW1wKTtcblxuXHRcdFx0XHRcdHRoaXMuX3RlbXAuY29weUZyb20ocm90YXRpb25WZWxvY2l0eSk7XG5cdFx0XHRcdFx0dGhpcy5fdGVtcC5zY2FsZUJ5KHQpO1xuXHRcdFx0XHRcdGludGVycG9sYXRlZFJvdGF0aW9uID0gdGhpcy5fdGFyZ2V0RXVsZXIuYWRkKHRoaXMuX3RlbXApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHZlcnRleERhdGFbaW5jXSAhPSBpbnRlcnBvbGF0ZWRQb3MueCB8fCB2ZXJ0ZXhEYXRhW2luYyArIDFdICE9IGludGVycG9sYXRlZFBvcy55IHx8IHZlcnRleERhdGFbaW5jICsgMl0gIT0gaW50ZXJwb2xhdGVkUG9zLnogfHwgdmVydGV4RGF0YVtpbmMgKyAzXSAhPSBpbnRlcnBvbGF0ZWRSb3RhdGlvbi54IHx8IHZlcnRleERhdGFbaW5jICsgNF0gIT0gaW50ZXJwb2xhdGVkUm90YXRpb24ueSB8fCB2ZXJ0ZXhEYXRhW2luYyArIDVdICE9IGludGVycG9sYXRlZFJvdGF0aW9uLnopIHtcblx0XHRcdFx0XHRjaGFuZ2VkID0gdHJ1ZTtcblx0XHRcdFx0XHRmb3IgKHZhciBqOm51bWJlciAvKnVpbnQqLyA9IDA7IGogPCBkYXRhW2ldLm51bVZlcnRpY2VzOyBqKyspIHtcblx0XHRcdFx0XHRcdHZlcnRleERhdGFbaW5jKytdID0gaW50ZXJwb2xhdGVkUG9zLng7XG5cdFx0XHRcdFx0XHR2ZXJ0ZXhEYXRhW2luYysrXSA9IGludGVycG9sYXRlZFBvcy55O1xuXHRcdFx0XHRcdFx0dmVydGV4RGF0YVtpbmMrK10gPSBpbnRlcnBvbGF0ZWRQb3Muejtcblx0XHRcdFx0XHRcdHZlcnRleERhdGFbaW5jKytdID0gaW50ZXJwb2xhdGVkUm90YXRpb24ueDtcblx0XHRcdFx0XHRcdHZlcnRleERhdGFbaW5jKytdID0gaW50ZXJwb2xhdGVkUm90YXRpb24ueTtcblx0XHRcdFx0XHRcdHZlcnRleERhdGFbaW5jKytdID0gaW50ZXJwb2xhdGVkUm90YXRpb24uejtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKGNoYW5nZWQpXG5cdFx0XHRhbmltYXRpb25TdWJHZW9tZXRyeS5pbnZhbGlkYXRlQnVmZmVyKCk7XG5cdH1cblxufVxuXG5leHBvcnQgPSBQYXJ0aWNsZUZvbGxvd1N0YXRlOyJdfQ==