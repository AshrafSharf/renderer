var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var JointPose = require("awayjs-renderergl/lib/animators/data/JointPose");
var SkeletonPose = require("awayjs-renderergl/lib/animators/data/SkeletonPose");
var AnimationClipState = require("awayjs-renderergl/lib/animators/states/AnimationClipState");
/**
 *
 */
var SkeletonClipState = (function (_super) {
    __extends(SkeletonClipState, _super);
    function SkeletonClipState(animator, skeletonClipNode) {
        _super.call(this, animator, skeletonClipNode);
        this._rootPos = new Vector3D();
        this._skeletonPose = new SkeletonPose();
        this._skeletonPoseDirty = true;
        this._skeletonClipNode = skeletonClipNode;
        this._frames = this._skeletonClipNode.frames;
    }
    Object.defineProperty(SkeletonClipState.prototype, "currentPose", {
        /**
         * Returns the current skeleton pose frame of animation in the clip based on the internal playhead position.
         */
        get: function () {
            if (this._pFramesDirty)
                this._pUpdateFrames();
            return this._currentPose;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SkeletonClipState.prototype, "nextPose", {
        /**
         * Returns the next skeleton pose frame of animation in the clip based on the internal playhead position.
         */
        get: function () {
            if (this._pFramesDirty)
                this._pUpdateFrames();
            return this._nextPose;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.
     */
    SkeletonClipState.prototype.getSkeletonPose = function (skeleton) {
        if (this._skeletonPoseDirty)
            this.updateSkeletonPose(skeleton);
        return this._skeletonPose;
    };
    /**
     * @inheritDoc
     */
    SkeletonClipState.prototype._pUpdateTime = function (time /*int*/) {
        this._skeletonPoseDirty = true;
        _super.prototype._pUpdateTime.call(this, time);
    };
    /**
     * @inheritDoc
     */
    SkeletonClipState.prototype._pUpdateFrames = function () {
        _super.prototype._pUpdateFrames.call(this);
        this._currentPose = this._frames[this._pCurrentFrame];
        if (this._skeletonClipNode.looping && this._pNextFrame >= this._skeletonClipNode.lastFrame) {
            this._nextPose = this._frames[0];
            this._pAnimator.dispatchCycleEvent();
        }
        else
            this._nextPose = this._frames[this._pNextFrame];
    };
    /**
     * Updates the output skeleton pose of the node based on the internal playhead position.
     *
     * @param skeleton The skeleton used by the animator requesting the ouput pose.
     */
    SkeletonClipState.prototype.updateSkeletonPose = function (skeleton) {
        this._skeletonPoseDirty = false;
        if (!this._skeletonClipNode.totalDuration)
            return;
        if (this._pFramesDirty)
            this._pUpdateFrames();
        var currentPose = this._currentPose.jointPoses;
        var nextPose = this._nextPose.jointPoses;
        var numJoints = skeleton.numJoints;
        var p1, p2;
        var pose1, pose2;
        var endPoses = this._skeletonPose.jointPoses;
        var endPose;
        var tr;
        // :s
        if (endPoses.length != numJoints)
            endPoses.length = numJoints;
        if ((numJoints != currentPose.length) || (numJoints != nextPose.length))
            throw new Error("joint counts don't match!");
        for (var i = 0; i < numJoints; ++i) {
            endPose = endPoses[i];
            if (endPose == null)
                endPose = endPoses[i] = new JointPose();
            pose1 = currentPose[i];
            pose2 = nextPose[i];
            p1 = pose1.translation;
            p2 = pose2.translation;
            if (this._skeletonClipNode.highQuality)
                endPose.orientation.slerp(pose1.orientation, pose2.orientation, this._pBlendWeight);
            else
                endPose.orientation.lerp(pose1.orientation, pose2.orientation, this._pBlendWeight);
            if (i > 0) {
                tr = endPose.translation;
                tr.x = p1.x + this._pBlendWeight * (p2.x - p1.x);
                tr.y = p1.y + this._pBlendWeight * (p2.y - p1.y);
                tr.z = p1.z + this._pBlendWeight * (p2.z - p1.z);
            }
        }
    };
    /**
     * @inheritDoc
     */
    SkeletonClipState.prototype._pUpdatePositionDelta = function () {
        this._pPositionDeltaDirty = false;
        if (this._pFramesDirty)
            this._pUpdateFrames();
        var p1, p2, p3;
        var totalDelta = this._skeletonClipNode.totalDelta;
        // jumping back, need to reset position
        if ((this._pTimeDir > 0 && this._pNextFrame < this._pOldFrame) || (this._pTimeDir < 0 && this._pNextFrame > this._pOldFrame)) {
            this._rootPos.x -= totalDelta.x * this._pTimeDir;
            this._rootPos.y -= totalDelta.y * this._pTimeDir;
            this._rootPos.z -= totalDelta.z * this._pTimeDir;
        }
        var dx = this._rootPos.x;
        var dy = this._rootPos.y;
        var dz = this._rootPos.z;
        if (this._skeletonClipNode.stitchFinalFrame && this._pNextFrame == this._skeletonClipNode.lastFrame) {
            p1 = this._frames[0].jointPoses[0].translation;
            p2 = this._frames[1].jointPoses[0].translation;
            p3 = this._currentPose.jointPoses[0].translation;
            this._rootPos.x = p3.x + p1.x + this._pBlendWeight * (p2.x - p1.x);
            this._rootPos.y = p3.y + p1.y + this._pBlendWeight * (p2.y - p1.y);
            this._rootPos.z = p3.z + p1.z + this._pBlendWeight * (p2.z - p1.z);
        }
        else {
            p1 = this._currentPose.jointPoses[0].translation;
            p2 = this._frames[this._pNextFrame].jointPoses[0].translation; //cover the instances where we wrap the pose but still want the final frame translation values
            this._rootPos.x = p1.x + this._pBlendWeight * (p2.x - p1.x);
            this._rootPos.y = p1.y + this._pBlendWeight * (p2.y - p1.y);
            this._rootPos.z = p1.z + this._pBlendWeight * (p2.z - p1.z);
        }
        this._pRootDelta.x = this._rootPos.x - dx;
        this._pRootDelta.y = this._rootPos.y - dy;
        this._pRootDelta.z = this._rootPos.z - dz;
        this._pOldFrame = this._pNextFrame;
    };
    return SkeletonClipState;
})(AnimationClipState);
module.exports = SkeletonClipState;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1NrZWxldG9uQ2xpcFN0YXRlLnRzIl0sIm5hbWVzIjpbIlNrZWxldG9uQ2xpcFN0YXRlIiwiU2tlbGV0b25DbGlwU3RhdGUuY29uc3RydWN0b3IiLCJTa2VsZXRvbkNsaXBTdGF0ZS5jdXJyZW50UG9zZSIsIlNrZWxldG9uQ2xpcFN0YXRlLm5leHRQb3NlIiwiU2tlbGV0b25DbGlwU3RhdGUuZ2V0U2tlbGV0b25Qb3NlIiwiU2tlbGV0b25DbGlwU3RhdGUuX3BVcGRhdGVUaW1lIiwiU2tlbGV0b25DbGlwU3RhdGUuX3BVcGRhdGVGcmFtZXMiLCJTa2VsZXRvbkNsaXBTdGF0ZS51cGRhdGVTa2VsZXRvblBvc2UiLCJTa2VsZXRvbkNsaXBTdGF0ZS5fcFVwZGF0ZVBvc2l0aW9uRGVsdGEiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFpQiwrQkFBK0IsQ0FBQyxDQUFDO0FBSWpFLElBQU8sU0FBUyxXQUFnQixnREFBZ0QsQ0FBQyxDQUFDO0FBRWxGLElBQU8sWUFBWSxXQUFnQixtREFBbUQsQ0FBQyxDQUFDO0FBRXhGLElBQU8sa0JBQWtCLFdBQWMsMkRBQTJELENBQUMsQ0FBQztBQUdwRyxBQUdBOztHQURHO0lBQ0csaUJBQWlCO0lBQVNBLFVBQTFCQSxpQkFBaUJBLFVBQTJCQTtJQWdDakRBLFNBaENLQSxpQkFBaUJBLENBZ0NWQSxRQUFxQkEsRUFBRUEsZ0JBQWlDQTtRQUVuRUMsa0JBQU1BLFFBQVFBLEVBQUVBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7UUFoQzNCQSxhQUFRQSxHQUFZQSxJQUFJQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUduQ0Esa0JBQWFBLEdBQWdCQSxJQUFJQSxZQUFZQSxFQUFFQSxDQUFDQTtRQUNoREEsdUJBQWtCQSxHQUFXQSxJQUFJQSxDQUFDQTtRQThCekNBLElBQUlBLENBQUNBLGlCQUFpQkEsR0FBR0EsZ0JBQWdCQSxDQUFDQTtRQUMxQ0Es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QUFDQSxDQUFDQTtRQUNoQ0EsSUFBSUEsRUFBRUEsR0FBVUEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLElBQUlBLEVBQUVBLEdBQVVBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO1FBRWhDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLGdCQUFnQkEsSUFBSUEsSUFBSUEsQ0FBQ0EsV0FBV0EsSUFBSUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyR0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0E7WUFDL0NBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLFdBQVdBLENBQUNBO1lBQy9DQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxXQUFXQSxDQUFDQTtZQUVqREEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakVBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLEdBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2pFQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNsRUEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0E7WUFDakRBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLFdBQVdBLEVBQUVBLDhGQUE4RkE7WUFDN0pBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLGFBQWFBLEdBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzFEQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxREEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0RBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUMxQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFFMUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBO0lBQ3BDQSxDQUFDQTtJQUNGUix3QkFBQ0E7QUFBREEsQ0FsTEEsQUFrTENBLEVBbEwrQixrQkFBa0IsRUFrTGpEO0FBRUQsQUFBMkIsaUJBQWxCLGlCQUFpQixDQUFDIiwiZmlsZSI6ImFuaW1hdG9ycy9zdGF0ZXMvU2tlbGV0b25DbGlwU3RhdGUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuXHJcbmltcG9ydCBBbmltYXRvckJhc2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL0FuaW1hdG9yQmFzZVwiKTtcclxuaW1wb3J0IFNrZWxldG9uQW5pbWF0b3JcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9Ta2VsZXRvbkFuaW1hdG9yXCIpO1xyXG5pbXBvcnQgSm9pbnRQb3NlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL0pvaW50UG9zZVwiKTtcclxuaW1wb3J0IFNrZWxldG9uXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvU2tlbGV0b25cIik7XHJcbmltcG9ydCBTa2VsZXRvblBvc2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvU2tlbGV0b25Qb3NlXCIpO1xyXG5pbXBvcnQgU2tlbGV0b25DbGlwTm9kZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL25vZGVzL1NrZWxldG9uQ2xpcE5vZGVcIik7XHJcbmltcG9ydCBBbmltYXRpb25DbGlwU3RhdGVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL0FuaW1hdGlvbkNsaXBTdGF0ZVwiKTtcclxuaW1wb3J0IElTa2VsZXRvbkFuaW1hdGlvblN0YXRlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9zdGF0ZXMvSVNrZWxldG9uQW5pbWF0aW9uU3RhdGVcIik7XHJcblxyXG4vKipcclxuICpcclxuICovXHJcbmNsYXNzIFNrZWxldG9uQ2xpcFN0YXRlIGV4dGVuZHMgQW5pbWF0aW9uQ2xpcFN0YXRlIGltcGxlbWVudHMgSVNrZWxldG9uQW5pbWF0aW9uU3RhdGVcclxue1xyXG5cdHByaXZhdGUgX3Jvb3RQb3M6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0QoKTtcclxuXHRwcml2YXRlIF9mcmFtZXM6QXJyYXk8U2tlbGV0b25Qb3NlPjtcclxuXHRwcml2YXRlIF9za2VsZXRvbkNsaXBOb2RlOlNrZWxldG9uQ2xpcE5vZGU7XHJcblx0cHJpdmF0ZSBfc2tlbGV0b25Qb3NlOlNrZWxldG9uUG9zZSA9IG5ldyBTa2VsZXRvblBvc2UoKTtcclxuXHRwcml2YXRlIF9za2VsZXRvblBvc2VEaXJ0eTpib29sZWFuID0gdHJ1ZTtcclxuXHRwcml2YXRlIF9jdXJyZW50UG9zZTpTa2VsZXRvblBvc2U7XHJcblx0cHJpdmF0ZSBfbmV4dFBvc2U6U2tlbGV0b25Qb3NlO1xyXG5cclxuXHQvKipcclxuXHQgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHNrZWxldG9uIHBvc2UgZnJhbWUgb2YgYW5pbWF0aW9uIGluIHRoZSBjbGlwIGJhc2VkIG9uIHRoZSBpbnRlcm5hbCBwbGF5aGVhZCBwb3NpdGlvbi5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IGN1cnJlbnRQb3NlKCk6U2tlbGV0b25Qb3NlXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3BGcmFtZXNEaXJ0eSlcclxuXHRcdFx0dGhpcy5fcFVwZGF0ZUZyYW1lcygpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9jdXJyZW50UG9zZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFJldHVybnMgdGhlIG5leHQgc2tlbGV0b24gcG9zZSBmcmFtZSBvZiBhbmltYXRpb24gaW4gdGhlIGNsaXAgYmFzZWQgb24gdGhlIGludGVybmFsIHBsYXloZWFkIHBvc2l0aW9uLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgbmV4dFBvc2UoKTpTa2VsZXRvblBvc2VcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcEZyYW1lc0RpcnR5KVxyXG5cdFx0XHR0aGlzLl9wVXBkYXRlRnJhbWVzKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX25leHRQb3NlO1xyXG5cdH1cclxuXHJcblx0Y29uc3RydWN0b3IoYW5pbWF0b3I6QW5pbWF0b3JCYXNlLCBza2VsZXRvbkNsaXBOb2RlOlNrZWxldG9uQ2xpcE5vZGUpXHJcblx0e1xyXG5cdFx0c3VwZXIoYW5pbWF0b3IsIHNrZWxldG9uQ2xpcE5vZGUpO1xyXG5cclxuXHRcdHRoaXMuX3NrZWxldG9uQ2xpcE5vZGUgPSBza2VsZXRvbkNsaXBOb2RlO1xyXG5cdFx0dGhpcy5fZnJhbWVzID0gdGhpcy5fc2tlbGV0b25DbGlwTm9kZS5mcmFtZXM7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHNrZWxldG9uIHBvc2Ugb2YgdGhlIGFuaW1hdGlvbiBpbiB0aGUgY2xpcCBiYXNlZCBvbiB0aGUgaW50ZXJuYWwgcGxheWhlYWQgcG9zaXRpb24uXHJcblx0ICovXHJcblx0cHVibGljIGdldFNrZWxldG9uUG9zZShza2VsZXRvbjpTa2VsZXRvbik6U2tlbGV0b25Qb3NlXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3NrZWxldG9uUG9zZURpcnR5KVxyXG5cdFx0XHR0aGlzLnVwZGF0ZVNrZWxldG9uUG9zZShza2VsZXRvbik7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX3NrZWxldG9uUG9zZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIF9wVXBkYXRlVGltZSh0aW1lOm51bWJlciAvKmludCovKVxyXG5cdHtcclxuXHRcdHRoaXMuX3NrZWxldG9uUG9zZURpcnR5ID0gdHJ1ZTtcclxuXHJcblx0XHRzdXBlci5fcFVwZGF0ZVRpbWUodGltZSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfcFVwZGF0ZUZyYW1lcygpXHJcblx0e1xyXG5cdFx0c3VwZXIuX3BVcGRhdGVGcmFtZXMoKTtcclxuXHJcblx0XHR0aGlzLl9jdXJyZW50UG9zZSA9IHRoaXMuX2ZyYW1lc1t0aGlzLl9wQ3VycmVudEZyYW1lXTtcclxuXHJcblx0XHRpZiAodGhpcy5fc2tlbGV0b25DbGlwTm9kZS5sb29waW5nICYmIHRoaXMuX3BOZXh0RnJhbWUgPj0gdGhpcy5fc2tlbGV0b25DbGlwTm9kZS5sYXN0RnJhbWUpIHtcclxuXHRcdFx0dGhpcy5fbmV4dFBvc2UgPSB0aGlzLl9mcmFtZXNbMF07XHJcblx0XHRcdCg8U2tlbGV0b25BbmltYXRvcj4gdGhpcy5fcEFuaW1hdG9yKS5kaXNwYXRjaEN5Y2xlRXZlbnQoKTtcclxuXHRcdH0gZWxzZVxyXG5cdFx0XHR0aGlzLl9uZXh0UG9zZSA9IHRoaXMuX2ZyYW1lc1t0aGlzLl9wTmV4dEZyYW1lXTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFVwZGF0ZXMgdGhlIG91dHB1dCBza2VsZXRvbiBwb3NlIG9mIHRoZSBub2RlIGJhc2VkIG9uIHRoZSBpbnRlcm5hbCBwbGF5aGVhZCBwb3NpdGlvbi5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBza2VsZXRvbiBUaGUgc2tlbGV0b24gdXNlZCBieSB0aGUgYW5pbWF0b3IgcmVxdWVzdGluZyB0aGUgb3VwdXQgcG9zZS5cclxuXHQgKi9cclxuXHRwcml2YXRlIHVwZGF0ZVNrZWxldG9uUG9zZShza2VsZXRvbjpTa2VsZXRvbilcclxuXHR7XHJcblx0XHR0aGlzLl9za2VsZXRvblBvc2VEaXJ0eSA9IGZhbHNlO1xyXG5cclxuXHRcdGlmICghdGhpcy5fc2tlbGV0b25DbGlwTm9kZS50b3RhbER1cmF0aW9uKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BGcmFtZXNEaXJ0eSlcclxuXHRcdFx0dGhpcy5fcFVwZGF0ZUZyYW1lcygpO1xyXG5cclxuXHRcdHZhciBjdXJyZW50UG9zZTpBcnJheTxKb2ludFBvc2U+ID0gdGhpcy5fY3VycmVudFBvc2Uuam9pbnRQb3NlcztcclxuXHRcdHZhciBuZXh0UG9zZTpBcnJheTxKb2ludFBvc2U+ID0gdGhpcy5fbmV4dFBvc2Uuam9pbnRQb3NlcztcclxuXHRcdHZhciBudW1Kb2ludHM6bnVtYmVyIC8qdWludCovID0gc2tlbGV0b24ubnVtSm9pbnRzO1xyXG5cdFx0dmFyIHAxOlZlY3RvcjNELCBwMjpWZWN0b3IzRDtcclxuXHRcdHZhciBwb3NlMTpKb2ludFBvc2UsIHBvc2UyOkpvaW50UG9zZTtcclxuXHRcdHZhciBlbmRQb3NlczpBcnJheTxKb2ludFBvc2U+ID0gdGhpcy5fc2tlbGV0b25Qb3NlLmpvaW50UG9zZXM7XHJcblx0XHR2YXIgZW5kUG9zZTpKb2ludFBvc2U7XHJcblx0XHR2YXIgdHI6VmVjdG9yM0Q7XHJcblxyXG5cdFx0Ly8gOnNcclxuXHRcdGlmIChlbmRQb3Nlcy5sZW5ndGggIT0gbnVtSm9pbnRzKVxyXG5cdFx0XHRlbmRQb3Nlcy5sZW5ndGggPSBudW1Kb2ludHM7XHJcblxyXG5cdFx0aWYgKChudW1Kb2ludHMgIT0gY3VycmVudFBvc2UubGVuZ3RoKSB8fCAobnVtSm9pbnRzICE9IG5leHRQb3NlLmxlbmd0aCkpXHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcImpvaW50IGNvdW50cyBkb24ndCBtYXRjaCFcIik7XHJcblxyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgLyp1aW50Ki8gPSAwOyBpIDwgbnVtSm9pbnRzOyArK2kpIHtcclxuXHRcdFx0ZW5kUG9zZSA9IGVuZFBvc2VzW2ldO1xyXG5cclxuXHRcdFx0aWYgKGVuZFBvc2UgPT0gbnVsbClcclxuXHRcdFx0XHRlbmRQb3NlID0gZW5kUG9zZXNbaV0gPSBuZXcgSm9pbnRQb3NlKCk7XHJcblxyXG5cdFx0XHRwb3NlMSA9IGN1cnJlbnRQb3NlW2ldO1xyXG5cdFx0XHRwb3NlMiA9IG5leHRQb3NlW2ldO1xyXG5cdFx0XHRwMSA9IHBvc2UxLnRyYW5zbGF0aW9uO1xyXG5cdFx0XHRwMiA9IHBvc2UyLnRyYW5zbGF0aW9uO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuX3NrZWxldG9uQ2xpcE5vZGUuaGlnaFF1YWxpdHkpXHJcblx0XHRcdFx0ZW5kUG9zZS5vcmllbnRhdGlvbi5zbGVycChwb3NlMS5vcmllbnRhdGlvbiwgcG9zZTIub3JpZW50YXRpb24sIHRoaXMuX3BCbGVuZFdlaWdodCk7IGVsc2VcclxuXHRcdFx0XHRlbmRQb3NlLm9yaWVudGF0aW9uLmxlcnAocG9zZTEub3JpZW50YXRpb24sIHBvc2UyLm9yaWVudGF0aW9uLCB0aGlzLl9wQmxlbmRXZWlnaHQpO1xyXG5cclxuXHRcdFx0aWYgKGkgPiAwKSB7XHJcblx0XHRcdFx0dHIgPSBlbmRQb3NlLnRyYW5zbGF0aW9uO1xyXG5cdFx0XHRcdHRyLnggPSBwMS54ICsgdGhpcy5fcEJsZW5kV2VpZ2h0KihwMi54IC0gcDEueCk7XHJcblx0XHRcdFx0dHIueSA9IHAxLnkgKyB0aGlzLl9wQmxlbmRXZWlnaHQqKHAyLnkgLSBwMS55KTtcclxuXHRcdFx0XHR0ci56ID0gcDEueiArIHRoaXMuX3BCbGVuZFdlaWdodCoocDIueiAtIHAxLnopO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfcFVwZGF0ZVBvc2l0aW9uRGVsdGEoKVxyXG5cdHtcclxuXHRcdHRoaXMuX3BQb3NpdGlvbkRlbHRhRGlydHkgPSBmYWxzZTtcclxuXHJcblx0XHRpZiAodGhpcy5fcEZyYW1lc0RpcnR5KVxyXG5cdFx0XHR0aGlzLl9wVXBkYXRlRnJhbWVzKCk7XHJcblxyXG5cdFx0dmFyIHAxOlZlY3RvcjNELCBwMjpWZWN0b3IzRCwgcDM6VmVjdG9yM0Q7XHJcblx0XHR2YXIgdG90YWxEZWx0YTpWZWN0b3IzRCA9IHRoaXMuX3NrZWxldG9uQ2xpcE5vZGUudG90YWxEZWx0YTtcclxuXHJcblx0XHQvLyBqdW1waW5nIGJhY2ssIG5lZWQgdG8gcmVzZXQgcG9zaXRpb25cclxuXHRcdGlmICgodGhpcy5fcFRpbWVEaXIgPiAwICYmIHRoaXMuX3BOZXh0RnJhbWUgPCB0aGlzLl9wT2xkRnJhbWUpIHx8ICh0aGlzLl9wVGltZURpciA8IDAgJiYgdGhpcy5fcE5leHRGcmFtZSA+IHRoaXMuX3BPbGRGcmFtZSkpIHtcclxuXHRcdFx0dGhpcy5fcm9vdFBvcy54IC09IHRvdGFsRGVsdGEueCp0aGlzLl9wVGltZURpcjtcclxuXHRcdFx0dGhpcy5fcm9vdFBvcy55IC09IHRvdGFsRGVsdGEueSp0aGlzLl9wVGltZURpcjtcclxuXHRcdFx0dGhpcy5fcm9vdFBvcy56IC09IHRvdGFsRGVsdGEueip0aGlzLl9wVGltZURpcjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgZHg6bnVtYmVyID0gdGhpcy5fcm9vdFBvcy54O1xyXG5cdFx0dmFyIGR5Om51bWJlciA9IHRoaXMuX3Jvb3RQb3MueTtcclxuXHRcdHZhciBkejpudW1iZXIgPSB0aGlzLl9yb290UG9zLno7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3NrZWxldG9uQ2xpcE5vZGUuc3RpdGNoRmluYWxGcmFtZSAmJiB0aGlzLl9wTmV4dEZyYW1lID09IHRoaXMuX3NrZWxldG9uQ2xpcE5vZGUubGFzdEZyYW1lKSB7XHJcblx0XHRcdHAxID0gdGhpcy5fZnJhbWVzWzBdLmpvaW50UG9zZXNbMF0udHJhbnNsYXRpb247XHJcblx0XHRcdHAyID0gdGhpcy5fZnJhbWVzWzFdLmpvaW50UG9zZXNbMF0udHJhbnNsYXRpb247XHJcblx0XHRcdHAzID0gdGhpcy5fY3VycmVudFBvc2Uuam9pbnRQb3Nlc1swXS50cmFuc2xhdGlvbjtcclxuXHJcblx0XHRcdHRoaXMuX3Jvb3RQb3MueCA9IHAzLnggKyBwMS54ICsgdGhpcy5fcEJsZW5kV2VpZ2h0KihwMi54IC0gcDEueCk7XHJcblx0XHRcdHRoaXMuX3Jvb3RQb3MueSA9IHAzLnkgKyBwMS55ICsgdGhpcy5fcEJsZW5kV2VpZ2h0KihwMi55IC0gcDEueSk7XHJcblx0XHRcdHRoaXMuX3Jvb3RQb3MueiA9IHAzLnogKyBwMS56ICsgdGhpcy5fcEJsZW5kV2VpZ2h0KihwMi56IC0gcDEueik7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRwMSA9IHRoaXMuX2N1cnJlbnRQb3NlLmpvaW50UG9zZXNbMF0udHJhbnNsYXRpb247XHJcblx0XHRcdHAyID0gdGhpcy5fZnJhbWVzW3RoaXMuX3BOZXh0RnJhbWVdLmpvaW50UG9zZXNbMF0udHJhbnNsYXRpb247IC8vY292ZXIgdGhlIGluc3RhbmNlcyB3aGVyZSB3ZSB3cmFwIHRoZSBwb3NlIGJ1dCBzdGlsbCB3YW50IHRoZSBmaW5hbCBmcmFtZSB0cmFuc2xhdGlvbiB2YWx1ZXNcclxuXHRcdFx0dGhpcy5fcm9vdFBvcy54ID0gcDEueCArIHRoaXMuX3BCbGVuZFdlaWdodCoocDIueCAtIHAxLngpO1xyXG5cdFx0XHR0aGlzLl9yb290UG9zLnkgPSBwMS55ICsgdGhpcy5fcEJsZW5kV2VpZ2h0KihwMi55IC0gcDEueSk7XHJcblx0XHRcdHRoaXMuX3Jvb3RQb3MueiA9IHAxLnogKyB0aGlzLl9wQmxlbmRXZWlnaHQqKHAyLnogLSBwMS56KTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9wUm9vdERlbHRhLnggPSB0aGlzLl9yb290UG9zLnggLSBkeDtcclxuXHRcdHRoaXMuX3BSb290RGVsdGEueSA9IHRoaXMuX3Jvb3RQb3MueSAtIGR5O1xyXG5cdFx0dGhpcy5fcFJvb3REZWx0YS56ID0gdGhpcy5fcm9vdFBvcy56IC0gZHo7XHJcblxyXG5cdFx0dGhpcy5fcE9sZEZyYW1lID0gdGhpcy5fcE5leHRGcmFtZTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IFNrZWxldG9uQ2xpcFN0YXRlOyJdfQ==