var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var ContextGLVertexBufferFormat = require("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleStateBase = require("awayjs-renderergl/lib/animators/states/ParticleStateBase");
/**
*
*/
var ParticleInitialColorState = (function (_super) {
    __extends(ParticleInitialColorState, _super);
    function ParticleInitialColorState(animator, particleInitialColorNode) {
        _super.call(this, animator, particleInitialColorNode);
        this._particleInitialColorNode = particleInitialColorNode;
        this._usesMultiplier = particleInitialColorNode._iUsesMultiplier;
        this._usesOffset = particleInitialColorNode._iUsesOffset;
        this._initialColor = particleInitialColorNode._iInitialColor;
        this.updateColorData();
    }
    Object.defineProperty(ParticleInitialColorState.prototype, "initialColor", {
        /**
         * Defines the initial color transform of the state, when in global mode.
         */
        get: function () {
            return this._initialColor;
        },
        set: function (value) {
            this._initialColor = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ParticleInitialColorState.prototype.setRenderState = function (stage, renderable, animationSubGeometry, animationRegisterCache, camera) {
        // TODO: not used
        renderable = renderable;
        camera = camera;
        if (animationRegisterCache.needFragmentAnimation) {
            if (this._particleInitialColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {
                var dataOffset = this._particleInitialColorNode._iDataOffset;
                if (this._usesMultiplier) {
                    animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);
                    dataOffset += 4;
                }
                if (this._usesOffset)
                    animationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);
            }
            else {
                if (this._usesMultiplier)
                    animationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), this._multiplierData.x, this._multiplierData.y, this._multiplierData.z, this._multiplierData.w);
                if (this._usesOffset)
                    animationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), this._offsetData.x, this._offsetData.y, this._offsetData.z, this._offsetData.w);
            }
        }
    };
    ParticleInitialColorState.prototype.updateColorData = function () {
        if (this._particleInitialColorNode.mode == ParticlePropertiesMode.GLOBAL) {
            if (this._usesMultiplier)
                this._multiplierData = new Vector3D(this._initialColor.redMultiplier, this._initialColor.greenMultiplier, this._initialColor.blueMultiplier, this._initialColor.alphaMultiplier);
            if (this._usesOffset)
                this._offsetData = new Vector3D(this._initialColor.redOffset / 255, this._initialColor.greenOffset / 255, this._initialColor.blueOffset / 255, this._initialColor.alphaOffset / 255);
        }
    };
    /** @private */
    ParticleInitialColorState.MULTIPLIER_INDEX = 0;
    /** @private */
    ParticleInitialColorState.OFFSET_INDEX = 1;
    return ParticleInitialColorState;
})(ParticleStateBase);
module.exports = ParticleInitialColorState;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlSW5pdGlhbENvbG9yU3RhdGUudHMiXSwibmFtZXMiOlsiUGFydGljbGVJbml0aWFsQ29sb3JTdGF0ZSIsIlBhcnRpY2xlSW5pdGlhbENvbG9yU3RhdGUuY29uc3RydWN0b3IiLCJQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlLmluaXRpYWxDb2xvciIsIlBhcnRpY2xlSW5pdGlhbENvbG9yU3RhdGUuc2V0UmVuZGVyU3RhdGUiLCJQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlLnVwZGF0ZUNvbG9yRGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBTyxRQUFRLFdBQWlCLCtCQUErQixDQUFDLENBQUM7QUFLakUsSUFBTywyQkFBMkIsV0FBWSxxREFBcUQsQ0FBQyxDQUFDO0FBS3JHLElBQU8sc0JBQXNCLFdBQWEsNkRBQTZELENBQUMsQ0FBQztBQUV6RyxJQUFPLGlCQUFpQixXQUFjLDBEQUEwRCxDQUFDLENBQUM7QUFHbEcsQUFHQTs7RUFERTtJQUNJLHlCQUF5QjtJQUFTQSxVQUFsQ0EseUJBQXlCQSxVQUEwQkE7SUFjeERBLFNBZEtBLHlCQUF5QkEsQ0FjbEJBLFFBQXlCQSxFQUFFQSx3QkFBaURBO1FBRXZGQyxrQkFBTUEsUUFBUUEsRUFBRUEsd0JBQXdCQSxDQUFDQSxDQUFDQTtRQUUxQ0EsSUFBSUEsQ0FBQ0EseUJBQXlCQSxHQUFHQSx3QkFBd0JBLENBQUNBO1FBQzFEQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSx3QkFBd0JBLENBQUNBLGdCQUFnQkEsQ0FBQ0E7UUFDakVBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLHdCQUF3QkEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDekRBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLHdCQUF3QkEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7UUFFN0RBLElBQUlBLENBQUNBLGVBQWVBLEVBQUVBLENBQUNBO0lBQ3hCQSxDQUFDQTtJ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dGF0ZXMvUGFydGljbGVJbml0aWFsQ29sb3JTdGF0ZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ29sb3JUcmFuc2Zvcm1cdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vQ29sb3JUcmFuc2Zvcm1cIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcblxyXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xyXG5cclxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcclxuaW1wb3J0IENvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXRcIik7XHJcblxyXG5pbXBvcnQgUGFydGljbGVBbmltYXRvclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL1BhcnRpY2xlQW5pbWF0b3JcIik7XHJcbmltcG9ydCBBbmltYXRpb25SZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL0FuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcIik7XHJcbmltcG9ydCBBbmltYXRpb25TdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL0FuaW1hdGlvblN1Ykdlb21ldHJ5XCIpO1xyXG5pbXBvcnQgUGFydGljbGVQcm9wZXJ0aWVzTW9kZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvZGF0YS9QYXJ0aWNsZVByb3BlcnRpZXNNb2RlXCIpO1xyXG5pbXBvcnQgUGFydGljbGVJbml0aWFsQ29sb3JOb2RlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9ub2Rlcy9QYXJ0aWNsZUluaXRpYWxDb2xvck5vZGVcIik7XHJcbmltcG9ydCBQYXJ0aWNsZVN0YXRlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9zdGF0ZXMvUGFydGljbGVTdGF0ZUJhc2VcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcclxuXHJcbi8qKlxyXG4qXHJcbiovXHJcbmNsYXNzIFBhcnRpY2xlSW5pdGlhbENvbG9yU3RhdGUgZXh0ZW5kcyBQYXJ0aWNsZVN0YXRlQmFzZVxyXG57XHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIHN0YXRpYyBNVUxUSVBMSUVSX0lOREVYOm51bWJlciAvKnVpbnQqLyA9IDA7XHJcblx0LyoqIEBwcml2YXRlICovXHJcblx0cHVibGljIHN0YXRpYyBPRkZTRVRfSU5ERVg6bnVtYmVyIC8qdWludCovID0gMTtcclxuXHJcblx0cHJpdmF0ZSBfcGFydGljbGVJbml0aWFsQ29sb3JOb2RlOlBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZTtcclxuXHRwcml2YXRlIF91c2VzTXVsdGlwbGllcjpib29sZWFuO1xyXG5cdHByaXZhdGUgX3VzZXNPZmZzZXQ6Ym9vbGVhbjtcclxuXHRwcml2YXRlIF9pbml0aWFsQ29sb3I6Q29sb3JUcmFuc2Zvcm07XHJcblx0cHJpdmF0ZSBfbXVsdGlwbGllckRhdGE6VmVjdG9yM0Q7XHJcblx0cHJpdmF0ZSBfb2Zmc2V0RGF0YTpWZWN0b3IzRDtcclxuXHJcblx0Y29uc3RydWN0b3IoYW5pbWF0b3I6UGFydGljbGVBbmltYXRvciwgcGFydGljbGVJbml0aWFsQ29sb3JOb2RlOlBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZSlcclxuXHR7XHJcblx0XHRzdXBlcihhbmltYXRvciwgcGFydGljbGVJbml0aWFsQ29sb3JOb2RlKTtcclxuXHJcblx0XHR0aGlzLl9wYXJ0aWNsZUluaXRpYWxDb2xvck5vZGUgPSBwYXJ0aWNsZUluaXRpYWxDb2xvck5vZGU7XHJcblx0XHR0aGlzLl91c2VzTXVsdGlwbGllciA9IHBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZS5faVVzZXNNdWx0aXBsaWVyO1xyXG5cdFx0dGhpcy5fdXNlc09mZnNldCA9IHBhcnRpY2xlSW5pdGlhbENvbG9yTm9kZS5faVVzZXNPZmZzZXQ7XHJcblx0XHR0aGlzLl9pbml0aWFsQ29sb3IgPSBwYXJ0aWNsZUluaXRpYWxDb2xvck5vZGUuX2lJbml0aWFsQ29sb3I7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVDb2xvckRhdGEoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIERlZmluZXMgdGhlIGluaXRpYWwgY29sb3IgdHJhbnNmb3JtIG9mIHRoZSBzdGF0ZSwgd2hlbiBpbiBnbG9iYWwgbW9kZS5cclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IGluaXRpYWxDb2xvcigpOkNvbG9yVHJhbnNmb3JtXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2luaXRpYWxDb2xvcjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgaW5pdGlhbENvbG9yKHZhbHVlOkNvbG9yVHJhbnNmb3JtKVxyXG5cdHtcclxuXHRcdHRoaXMuX2luaXRpYWxDb2xvciA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgc2V0UmVuZGVyU3RhdGUoc3RhZ2U6U3RhZ2UsIHJlbmRlcmFibGU6UmVuZGVyYWJsZUJhc2UsIGFuaW1hdGlvblN1Ykdlb21ldHJ5OkFuaW1hdGlvblN1Ykdlb21ldHJ5LCBhbmltYXRpb25SZWdpc3RlckNhY2hlOkFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUsIGNhbWVyYTpDYW1lcmEpXHJcblx0e1xyXG5cdFx0Ly8gVE9ETzogbm90IHVzZWRcclxuXHRcdHJlbmRlcmFibGUgPSByZW5kZXJhYmxlO1xyXG5cdFx0Y2FtZXJhID0gY2FtZXJhO1xyXG5cclxuXHRcdGlmIChhbmltYXRpb25SZWdpc3RlckNhY2hlLm5lZWRGcmFnbWVudEFuaW1hdGlvbikge1xyXG5cdFx0XHRpZiAodGhpcy5fcGFydGljbGVJbml0aWFsQ29sb3JOb2RlLm1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5MT0NBTF9TVEFUSUMpIHtcclxuXHRcdFx0XHR2YXIgZGF0YU9mZnNldDpudW1iZXIgLyp1aW50Ki8gPSB0aGlzLl9wYXJ0aWNsZUluaXRpYWxDb2xvck5vZGUuX2lEYXRhT2Zmc2V0O1xyXG5cdFx0XHRcdGlmICh0aGlzLl91c2VzTXVsdGlwbGllcikge1xyXG5cdFx0XHRcdFx0YW5pbWF0aW9uU3ViR2VvbWV0cnkuYWN0aXZhdGVWZXJ0ZXhCdWZmZXIoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRSZWdpc3RlckluZGV4KHRoaXMuX3BBbmltYXRpb25Ob2RlLCBQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlLk1VTFRJUExJRVJfSU5ERVgpLCBkYXRhT2Zmc2V0LCBzdGFnZSwgQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0LkZMT0FUXzQpO1xyXG5cdFx0XHRcdFx0ZGF0YU9mZnNldCArPSA0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGhpcy5fdXNlc09mZnNldClcclxuXHRcdFx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmFjdGl2YXRlVmVydGV4QnVmZmVyKGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuZ2V0UmVnaXN0ZXJJbmRleCh0aGlzLl9wQW5pbWF0aW9uTm9kZSwgUGFydGljbGVJbml0aWFsQ29sb3JTdGF0ZS5PRkZTRVRfSU5ERVgpLCBkYXRhT2Zmc2V0LCBzdGFnZSwgQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0LkZMT0FUXzQpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGlmICh0aGlzLl91c2VzTXVsdGlwbGllcilcclxuXHRcdFx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2V0VmVydGV4Q29uc3QoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRSZWdpc3RlckluZGV4KHRoaXMuX3BBbmltYXRpb25Ob2RlLCBQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlLk1VTFRJUExJRVJfSU5ERVgpLCB0aGlzLl9tdWx0aXBsaWVyRGF0YS54LCB0aGlzLl9tdWx0aXBsaWVyRGF0YS55LCB0aGlzLl9tdWx0aXBsaWVyRGF0YS56LCB0aGlzLl9tdWx0aXBsaWVyRGF0YS53KTtcclxuXHRcdFx0XHRpZiAodGhpcy5fdXNlc09mZnNldClcclxuXHRcdFx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2V0VmVydGV4Q29uc3QoYW5pbWF0aW9uUmVnaXN0ZXJDYWNoZS5nZXRSZWdpc3RlckluZGV4KHRoaXMuX3BBbmltYXRpb25Ob2RlLCBQYXJ0aWNsZUluaXRpYWxDb2xvclN0YXRlLk9GRlNFVF9JTkRFWCksIHRoaXMuX29mZnNldERhdGEueCwgdGhpcy5fb2Zmc2V0RGF0YS55LCB0aGlzLl9vZmZzZXREYXRhLnosIHRoaXMuX29mZnNldERhdGEudyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHByaXZhdGUgdXBkYXRlQ29sb3JEYXRhKClcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcGFydGljbGVJbml0aWFsQ29sb3JOb2RlLm1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5HTE9CQUwpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3VzZXNNdWx0aXBsaWVyKVxyXG5cdFx0XHRcdHRoaXMuX211bHRpcGxpZXJEYXRhID0gbmV3IFZlY3RvcjNEKHRoaXMuX2luaXRpYWxDb2xvci5yZWRNdWx0aXBsaWVyLCB0aGlzLl9pbml0aWFsQ29sb3IuZ3JlZW5NdWx0aXBsaWVyLCB0aGlzLl9pbml0aWFsQ29sb3IuYmx1ZU11bHRpcGxpZXIsIHRoaXMuX2luaXRpYWxDb2xvci5hbHBoYU11bHRpcGxpZXIpO1xyXG5cdFx0XHRpZiAodGhpcy5fdXNlc09mZnNldClcclxuXHRcdFx0XHR0aGlzLl9vZmZzZXREYXRhID0gbmV3IFZlY3RvcjNEKHRoaXMuX2luaXRpYWxDb2xvci5yZWRPZmZzZXQvMjU1LCB0aGlzLl9pbml0aWFsQ29sb3IuZ3JlZW5PZmZzZXQvMjU1LCB0aGlzLl9pbml0aWFsQ29sb3IuYmx1ZU9mZnNldC8yNTUsIHRoaXMuX2luaXRpYWxDb2xvci5hbHBoYU9mZnNldC8yNTUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCA9IFBhcnRpY2xlSW5pdGlhbENvbG9yU3RhdGU7Il19