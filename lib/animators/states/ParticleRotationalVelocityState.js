var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var ContextGLVertexBufferFormat = require("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");
var ParticlePropertiesMode = require("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");
var ParticleStateBase = require("awayjs-renderergl/lib/animators/states/ParticleStateBase");
/**
 * ...
 */
var ParticleRotationalVelocityState = (function (_super) {
    __extends(ParticleRotationalVelocityState, _super);
    function ParticleRotationalVelocityState(animator, particleRotationNode) {
        _super.call(this, animator, particleRotationNode);
        this._particleRotationalVelocityNode = particleRotationNode;
        this._rotationalVelocity = this._particleRotationalVelocityNode._iRotationalVelocity;
        this.updateRotationalVelocityData();
    }
    Object.defineProperty(ParticleRotationalVelocityState.prototype, "rotationalVelocity", {
        /**
         * Defines the default rotationalVelocity of the state, used when in global mode.
         */
        get: function () {
            return this._rotationalVelocity;
        },
        set: function (value) {
            this._rotationalVelocity = value;
            this.updateRotationalVelocityData();
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     */
    ParticleRotationalVelocityState.prototype.getRotationalVelocities = function () {
        return this._pDynamicProperties;
    };
    ParticleRotationalVelocityState.prototype.setRotationalVelocities = function (value) {
        this._pDynamicProperties = value;
        this._pDynamicPropertiesDirty = new Object();
    };
    /**
     * @inheritDoc
     */
    ParticleRotationalVelocityState.prototype.setRenderState = function (stage, renderable, animationSubGeometry, animationRegisterCache, camera) {
        if (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])
            this._pUpdateDynamicProperties(animationSubGeometry);
        var index = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX);
        if (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL)
            animationRegisterCache.setVertexConst(index, this._rotationalVelocityData.x, this._rotationalVelocityData.y, this._rotationalVelocityData.z, this._rotationalVelocityData.w);
        else
            animationSubGeometry.activateVertexBuffer(index, this._particleRotationalVelocityNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);
    };
    ParticleRotationalVelocityState.prototype.updateRotationalVelocityData = function () {
        if (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL) {
            if (this._rotationalVelocity.w <= 0)
                throw (new Error("the cycle duration must greater than zero"));
            var rotation = this._rotationalVelocity.clone();
            if (rotation.length <= 0)
                rotation.z = 1; //set the default direction
            else
                rotation.normalize();
            // w is used as angle/2 in agal
            this._rotationalVelocityData = new Vector3D(rotation.x, rotation.y, rotation.z, Math.PI / rotation.w);
        }
    };
    /** @private */
    ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX = 0;
    return ParticleRotationalVelocityState;
})(ParticleStateBase);
module.exports = ParticleRotationalVelocityState;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGUudHMiXSwibmFtZXMiOlsiUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlTdGF0ZSIsIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGUuY29uc3RydWN0b3IiLCJQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eVN0YXRlLnJvdGF0aW9uYWxWZWxvY2l0eSIsIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGUuZ2V0Um90YXRpb25hbFZlbG9jaXRpZXMiLCJQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eVN0YXRlLnNldFJvdGF0aW9uYWxWZWxvY2l0aWVzIiwiUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlTdGF0ZS5zZXRSZW5kZXJTdGF0ZSIsIlBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGUudXBkYXRlUm90YXRpb25hbFZlbG9jaXR5RGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxRQUFRLFdBQWlCLCtCQUErQixDQUFDLENBQUM7QUFLakUsSUFBTywyQkFBMkIsV0FBWSxxREFBcUQsQ0FBQyxDQUFDO0FBS3JHLElBQU8sc0JBQXNCLFdBQWEsNkRBQTZELENBQUMsQ0FBQztBQUV6RyxJQUFPLGlCQUFpQixXQUFjLDBEQUEwRCxDQUFDLENBQUM7QUFHbEcsQUFHQTs7R0FERztJQUNHLCtCQUErQjtJQUFTQSxVQUF4Q0EsK0JBQStCQSxVQUEwQkE7SUF1QzlEQSxTQXZDS0EsK0JBQStCQSxDQXVDeEJBLFFBQXlCQSxFQUFFQSxvQkFBbURBO1FBRXpGQyxrQkFBTUEsUUFBUUEsRUFBRUEsb0JBQW9CQSxDQUFDQSxDQUFDQTtRQUV0Q0EsSUFBSUEsQ0FBQ0EsK0JBQStCQSxHQUFHQSxvQkFBb0JBLENBQUNBO1FBQzVEQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLElBQUlBLENBQUNBLCtCQUEr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UUFBUUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsMkJBQTJCQTtZQUM1Q0EsSUFEZ0JBLEFBQ1pBO2dCQUNIQSxRQUFRQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQTtZQUN0QkEsQUFDQUEsK0JBRCtCQTtZQUMvQkEsSUFBSUEsQ0FBQ0EsdUJBQXVCQSxHQUFHQSxJQUFJQSxRQUFRQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxFQUFFQSxHQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNyR0EsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUE3RUROLGVBQWVBO0lBQ0RBLHdEQUF3QkEsR0FBbUJBLENBQUNBLENBQUNBO0lBNkU1REEsc0NBQUNBO0FBQURBLENBaEZBLEFBZ0ZDQSxFQWhGNkMsaUJBQWlCLEVBZ0Y5RDtBQUVELEFBQXlDLGlCQUFoQywrQkFBK0IsQ0FBQyIsImZpbGUiOiJhbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiKTtcclxuXHJcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XHJcblxyXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xyXG5pbXBvcnQgQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdFwiKTtcclxuXHJcbmltcG9ydCBQYXJ0aWNsZUFuaW1hdG9yXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvUGFydGljbGVBbmltYXRvclwiKTtcclxuaW1wb3J0IEFuaW1hdGlvblJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvQW5pbWF0aW9uUmVnaXN0ZXJDYWNoZVwiKTtcclxuaW1wb3J0IEFuaW1hdGlvblN1Ykdlb21ldHJ5XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvQW5pbWF0aW9uU3ViR2VvbWV0cnlcIik7XHJcbmltcG9ydCBQYXJ0aWNsZVByb3BlcnRpZXNNb2RlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2FuaW1hdG9ycy9kYXRhL1BhcnRpY2xlUHJvcGVydGllc01vZGVcIik7XHJcbmltcG9ydCBQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eU5vZGVcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvbm9kZXMvUGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlXCIpO1xyXG5pbXBvcnQgUGFydGljbGVTdGF0ZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9hbmltYXRvcnMvc3RhdGVzL1BhcnRpY2xlU3RhdGVCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XHJcblxyXG4vKipcclxuICogLi4uXHJcbiAqL1xyXG5jbGFzcyBQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eVN0YXRlIGV4dGVuZHMgUGFydGljbGVTdGF0ZUJhc2Vcclxue1xyXG5cdC8qKiBAcHJpdmF0ZSAqL1xyXG5cdHB1YmxpYyBzdGF0aWMgUk9UQVRJT05BTFZFTE9DSVRZX0lOREVYOm51bWJlciAvKnVpbnQqLyA9IDA7XHJcblxyXG5cdHByaXZhdGUgX3BhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5Tm9kZTpQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eU5vZGU7XHJcblx0cHJpdmF0ZSBfcm90YXRpb25hbFZlbG9jaXR5RGF0YTpWZWN0b3IzRDtcclxuXHRwcml2YXRlIF9yb3RhdGlvbmFsVmVsb2NpdHk6VmVjdG9yM0Q7XHJcblxyXG5cdC8qKlxyXG5cdCAqIERlZmluZXMgdGhlIGRlZmF1bHQgcm90YXRpb25hbFZlbG9jaXR5IG9mIHRoZSBzdGF0ZSwgdXNlZCB3aGVuIGluIGdsb2JhbCBtb2RlLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgcm90YXRpb25hbFZlbG9jaXR5KCk6VmVjdG9yM0RcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcm90YXRpb25hbFZlbG9jaXR5O1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCByb3RhdGlvbmFsVmVsb2NpdHkodmFsdWU6VmVjdG9yM0QpXHJcblx0e1xyXG5cdFx0dGhpcy5fcm90YXRpb25hbFZlbG9jaXR5ID0gdmFsdWU7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVSb3RhdGlvbmFsVmVsb2NpdHlEYXRhKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXRSb3RhdGlvbmFsVmVsb2NpdGllcygpOkFycmF5PFZlY3RvcjNEPlxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9wRHluYW1pY1Byb3BlcnRpZXM7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0Um90YXRpb25hbFZlbG9jaXRpZXModmFsdWU6QXJyYXk8VmVjdG9yM0Q+KVxyXG5cdHtcclxuXHRcdHRoaXMuX3BEeW5hbWljUHJvcGVydGllcyA9IHZhbHVlO1xyXG5cclxuXHRcdHRoaXMuX3BEeW5hbWljUHJvcGVydGllc0RpcnR5ID0gbmV3IE9iamVjdCgpO1xyXG5cdH1cclxuXHJcblx0Y29uc3RydWN0b3IoYW5pbWF0b3I6UGFydGljbGVBbmltYXRvciwgcGFydGljbGVSb3RhdGlvbk5vZGU6UGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlKVxyXG5cdHtcclxuXHRcdHN1cGVyKGFuaW1hdG9yLCBwYXJ0aWNsZVJvdGF0aW9uTm9kZSk7XHJcblxyXG5cdFx0dGhpcy5fcGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlID0gcGFydGljbGVSb3RhdGlvbk5vZGU7XHJcblx0XHR0aGlzLl9yb3RhdGlvbmFsVmVsb2NpdHkgPSB0aGlzLl9wYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eU5vZGUuX2lSb3RhdGlvbmFsVmVsb2NpdHk7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVSb3RhdGlvbmFsVmVsb2NpdHlEYXRhKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBzZXRSZW5kZXJTdGF0ZShzdGFnZTpTdGFnZSwgcmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgYW5pbWF0aW9uU3ViR2VvbWV0cnk6QW5pbWF0aW9uU3ViR2VvbWV0cnksIGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGU6QW5pbWF0aW9uUmVnaXN0ZXJDYWNoZSwgY2FtZXJhOkNhbWVyYSlcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlLm1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5MT0NBTF9EWU5BTUlDICYmICF0aGlzLl9wRHluYW1pY1Byb3BlcnRpZXNEaXJ0eVthbmltYXRpb25TdWJHZW9tZXRyeS5faVVuaXF1ZUlkXSlcclxuXHRcdFx0dGhpcy5fcFVwZGF0ZUR5bmFtaWNQcm9wZXJ0aWVzKGFuaW1hdGlvblN1Ykdlb21ldHJ5KTtcclxuXHJcblx0XHR2YXIgaW5kZXg6bnVtYmVyIC8qaW50Ki8gPSBhbmltYXRpb25SZWdpc3RlckNhY2hlLmdldFJlZ2lzdGVySW5kZXgodGhpcy5fcEFuaW1hdGlvbk5vZGUsIFBhcnRpY2xlUm90YXRpb25hbFZlbG9jaXR5U3RhdGUuUk9UQVRJT05BTFZFTE9DSVRZX0lOREVYKTtcclxuXHJcblx0XHRpZiAodGhpcy5fcGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlLm1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5HTE9CQUwpXHJcblx0XHRcdGFuaW1hdGlvblJlZ2lzdGVyQ2FjaGUuc2V0VmVydGV4Q29uc3QoaW5kZXgsIHRoaXMuX3JvdGF0aW9uYWxWZWxvY2l0eURhdGEueCwgdGhpcy5fcm90YXRpb25hbFZlbG9jaXR5RGF0YS55LCB0aGlzLl9yb3RhdGlvbmFsVmVsb2NpdHlEYXRhLnosIHRoaXMuX3JvdGF0aW9uYWxWZWxvY2l0eURhdGEudyk7XHJcblx0XHRlbHNlXHJcblx0XHRcdGFuaW1hdGlvblN1Ykdlb21ldHJ5LmFjdGl2YXRlVmVydGV4QnVmZmVyKGluZGV4LCB0aGlzLl9wYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eU5vZGUuX2lEYXRhT2Zmc2V0LCBzdGFnZSwgQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0LkZMT0FUXzQpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSB1cGRhdGVSb3RhdGlvbmFsVmVsb2NpdHlEYXRhKClcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcGFydGljbGVSb3RhdGlvbmFsVmVsb2NpdHlOb2RlLm1vZGUgPT0gUGFydGljbGVQcm9wZXJ0aWVzTW9kZS5HTE9CQUwpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3JvdGF0aW9uYWxWZWxvY2l0eS53IDw9IDApXHJcblx0XHRcdFx0dGhyb3cobmV3IEVycm9yKFwidGhlIGN5Y2xlIGR1cmF0aW9uIG11c3QgZ3JlYXRlciB0aGFuIHplcm9cIikpO1xyXG5cdFx0XHR2YXIgcm90YXRpb246VmVjdG9yM0QgPSB0aGlzLl9yb3RhdGlvbmFsVmVsb2NpdHkuY2xvbmUoKTtcclxuXHJcblx0XHRcdGlmIChyb3RhdGlvbi5sZW5ndGggPD0gMClcclxuXHRcdFx0XHRyb3RhdGlvbi56ID0gMTsgLy9zZXQgdGhlIGRlZmF1bHQgZGlyZWN0aW9uXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRyb3RhdGlvbi5ub3JtYWxpemUoKTtcclxuXHRcdFx0Ly8gdyBpcyB1c2VkIGFzIGFuZ2xlLzIgaW4gYWdhbFxyXG5cdFx0XHR0aGlzLl9yb3RhdGlvbmFsVmVsb2NpdHlEYXRhID0gbmV3IFZlY3RvcjNEKHJvdGF0aW9uLngsIHJvdGF0aW9uLnksIHJvdGF0aW9uLnosIE1hdGguUEkvcm90YXRpb24udyk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBQYXJ0aWNsZVJvdGF0aW9uYWxWZWxvY2l0eVN0YXRlOyJdfQ==