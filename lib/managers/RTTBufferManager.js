var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
var Event = require("awayjs-core/lib/events/Event");
var EventDispatcher = require("awayjs-core/lib/events/EventDispatcher");
var TextureUtils = require("awayjs-core/lib/utils/TextureUtils");
var RTTBufferManager = (function (_super) {
    __extends(RTTBufferManager, _super);
    function RTTBufferManager(stage) {
        _super.call(this);
        this._viewWidth = -1;
        this._viewHeight = -1;
        this._textureWidth = -1;
        this._textureHeight = -1;
        this._buffersInvalid = true;
        this._renderToTextureRect = new Rectangle();
        this._stage = stage;
    }
    RTTBufferManager.getInstance = function (stage) {
        if (!stage)
            throw new Error("stage key cannot be null!");
        if (RTTBufferManager._instances == null)
            RTTBufferManager._instances = new Array();
        var rttBufferManager = RTTBufferManager.getRTTBufferManagerFromStage(stage);
        if (rttBufferManager == null) {
            rttBufferManager = new RTTBufferManager(stage);
            var vo = new RTTBufferManagerVO();
            vo.stage3d = stage;
            vo.rttbfm = rttBufferManager;
            RTTBufferManager._instances.push(vo);
        }
        return rttBufferManager;
    };
    RTTBufferManager.getRTTBufferManagerFromStage = function (stage) {
        var l = RTTBufferManager._instances.length;
        var r;
        for (var c = 0; c < l; c++) {
            r = RTTBufferManager._instances[c];
            if (r.stage3d === stage)
                return r.rttbfm;
        }
        return null;
    };
    RTTBufferManager.deleteRTTBufferManager = function (stage) {
        var l = RTTBufferManager._instances.length;
        var r;
        for (var c = 0; c < l; c++) {
            r = RTTBufferManager._instances[c];
            if (r.stage3d === stage) {
                RTTBufferManager._instances.splice(c, 1);
                return;
            }
        }
    };
    Object.defineProperty(RTTBufferManager.prototype, "textureRatioX", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._textureRatioX;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureRatioY", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._textureRatioY;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "viewWidth", {
        get: function () {
            return this._viewWidth;
        },
        set: function (value) {
            if (value == this._viewWidth)
                return;
            this._viewWidth = value;
            this._buffersInvalid = true;
            this._textureWidth = TextureUtils.getBestPowerOf2(this._viewWidth);
            if (this._textureWidth > this._viewWidth) {
                this._renderToTextureRect.x = Math.floor((this._textureWidth - this._viewWidth) * .5);
                this._renderToTextureRect.width = this._viewWidth;
            }
            else {
                this._renderToTextureRect.x = 0;
                this._renderToTextureRect.width = this._textureWidth;
            }
            this.dispatchEvent(new Event(Event.RESIZE));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "viewHeight", {
        get: function () {
            return this._viewHeight;
        },
        set: function (value) {
            if (value == this._viewHeight)
                return;
            this._viewHeight = value;
            this._buffersInvalid = true;
            this._textureHeight = TextureUtils.getBestPowerOf2(this._viewHeight);
            if (this._textureHeight > this._viewHeight) {
                this._renderToTextureRect.y = Math.floor((this._textureHeight - this._viewHeight) * .5);
                this._renderToTextureRect.height = this._viewHeight;
            }
            else {
                this._renderToTextureRect.y = 0;
                this._renderToTextureRect.height = this._textureHeight;
            }
            this.dispatchEvent(new Event(Event.RESIZE));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToTextureVertexBuffer", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToTextureVertexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToScreenVertexBuffer", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToScreenVertexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "indexBuffer", {
        get: function () {
            return this._indexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToTextureRect", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToTextureRect;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureWidth", {
        get: function () {
            return this._textureWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureHeight", {
        get: function () {
            return this._textureHeight;
        },
        enumerable: true,
        configurable: true
    });
    RTTBufferManager.prototype.dispose = function () {
        RTTBufferManager.deleteRTTBufferManager(this._stage);
        if (this._indexBuffer) {
            this._indexBuffer.dispose();
            this._renderToScreenVertexBuffer.dispose();
            this._renderToTextureVertexBuffer.dispose();
            this._renderToScreenVertexBuffer = null;
            this._renderToTextureVertexBuffer = null;
            this._indexBuffer = null;
        }
    };
    // todo: place all this in a separate model, since it's used all over the place
    // maybe it even has a place in the core (together with screenRect etc)?
    // needs to be stored per view of course
    RTTBufferManager.prototype.updateRTTBuffers = function () {
        var context = this._stage.context;
        var textureVerts;
        var screenVerts;
        var x;
        var y;
        if (this._renderToTextureVertexBuffer == null)
            this._renderToTextureVertexBuffer = context.createVertexBuffer(4, 5);
        if (this._renderToScreenVertexBuffer == null)
            this._renderToScreenVertexBuffer = context.createVertexBuffer(4, 5);
        if (!this._indexBuffer) {
            this._indexBuffer = context.createIndexBuffer(6);
            this._indexBuffer.uploadFromArray([2, 1, 0, 3, 2, 0], 0, 6);
        }
        this._textureRatioX = x = Math.min(this._viewWidth / this._textureWidth, 1);
        this._textureRatioY = y = Math.min(this._viewHeight / this._textureHeight, 1);
        var u1 = (1 - x) * .5;
        var u2 = (x + 1) * .5;
        var v1 = (y + 1) * .5;
        var v2 = (1 - y) * .5;
        // last element contains indices for data per vertex that can be passed to the vertex shader if necessary (ie: frustum corners for deferred rendering)
        textureVerts = [-x, -y, u1, v1, 0, x, -y, u2, v1, 1, x, y, u2, v2, 2, -x, y, u1, v2, 3];
        screenVerts = [-1, -1, u1, v1, 0, 1, -1, u2, v1, 1, 1, 1, u2, v2, 2, -1, 1, u1, v2, 3];
        this._renderToTextureVertexBuffer.uploadFromArray(textureVerts, 0, 4);
        this._renderToScreenVertexBuffer.uploadFromArray(screenVerts, 0, 4);
        this._buffersInvalid = false;
    };
    return RTTBufferManager;
})(EventDispatcher);
var RTTBufferManagerVO = (function () {
    function RTTBufferManagerVO() {
    }
    return RTTBufferManagerVO;
})();
module.exports = RTTBufferManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYW5hZ2Vycy9SVFRCdWZmZXJNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbIlJUVEJ1ZmZlck1hbmFnZXIiLCJSVFRCdWZmZXJNYW5hZ2VyLmNvbnN0cnVjdG9yIiwiUlRUQnVmZmVyTWFuYWdlci5nZXRJbnN0YW5jZSIsIlJUVEJ1ZmZlck1hbmFnZXIuZ2V0UlRUQnVmZmVyTWFuYWdlckZyb21TdGFnZSIsIlJUVEJ1ZmZlck1hbmFnZXIuZGVsZXRlUlRUQnVmZmVyTWFuYWdlciIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWCIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWSIsIlJUVEJ1ZmZlck1hbmFnZXIudmlld1dpZHRoIiwiUlRUQnVmZmVyTWFuYWdlci52aWV3SGVpZ2h0IiwiUlRUQnVmZmVyTWFuYWdlci5yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXIiLCJSVFRCdWZmZXJNYW5hZ2VyLnJlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyIiwiUlRUQnVmZmVyTWFuYWdlci5pbmRleEJ1ZmZlciIsIlJUVEJ1ZmZlck1hbmFnZXIucmVuZGVyVG9UZXh0dXJlUmVjdCIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVdpZHRoIiwiUlRUQnVmZmVyTWFuYWdlci50ZXh0dXJlSGVpZ2h0IiwiUlRUQnVmZmVyTWFuYWdlci5kaXNwb3NlIiwiUlRUQnVmZmVyTWFuYWdlci51cGRhdGVSVFRCdWZmZXJzIiwiUlRUQnVmZmVyTWFuYWdlclZPIiwiUlRUQnVmZmVyTWFuYWdlclZPLmNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFNBQVMsV0FBZSxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2pFLElBQU8sS0FBSyxXQUFnQiw4QkFBOEIsQ0FBQyxDQUFDO0FBQzVELElBQU8sZUFBZSxXQUFjLHdDQUF3QyxDQUFDLENBQUM7QUFDOUUsSUFBTyxZQUFZLFdBQWUsb0NBQW9DLENBQUMsQ0FBQztB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RUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0RBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzFFQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU1RUEsSUFBSUEsRUFBRUEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDM0JBLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLEVBQUVBLENBQUNBO1FBQzNCQSxJQUFJQSxFQUFFQSxHQUFVQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxFQUFFQSxDQUFDQTtRQUMzQkEsSUFBSUEsRUFBRUEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUEsQ0FBQ0E7UUFFM0JBLEFBQ0FBLHNKQURzSkE7UUFDdEpBLFlBQVlBLEdBQUdBLENBQUtBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUVBLENBQUNBO1FBRTdGQSxXQUFXQSxHQUFHQSxDQUFNQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFFQSxDQUFDQTtRQUU3RkEsSUFBSUEsQ0FBQ0EsNEJBQTRCQSxDQUFDQSxlQUFlQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0RUEsSUFBSUEsQ0FBQ0EsMkJBQTJCQSxDQUFDQSxlQUFlQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVwRUEsSUFBSUEsQ0FBQ0EsZUFBZUEsR0FBR0EsS0FBS0EsQ0FBQ0E7SUFDOUJBLENBQUNBO0lBQ0ZoQix1QkFBQ0E7QUFBREEsQ0EzUEEsQUEyUENBLEVBM1A4QixlQUFlLEVBMlA3QztBQUlELElBQU0sa0JBQWtCO0lBQXhCaUIsU0FBTUEsa0JBQWtCQTtJQUt4QkMsQ0FBQ0E7SUFBREQseUJBQUNBO0FBQURBLENBTEEsQUFLQ0EsSUFBQTtBQVBELGlCQUFTLGdCQUFnQixDQUFDIiwiZmlsZSI6Im1hbmFnZXJzL1JUVEJ1ZmZlck1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XHJcbmltcG9ydCBFdmVudFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnRcIik7XHJcbmltcG9ydCBFdmVudERpc3BhdGNoZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvRXZlbnREaXNwYXRjaGVyXCIpO1xyXG5pbXBvcnQgVGV4dHVyZVV0aWxzXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9UZXh0dXJlVXRpbHNcIik7XHJcblxyXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcclxuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcclxuaW1wb3J0IElJbmRleEJ1ZmZlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JSW5kZXhCdWZmZXJcIik7XHJcbmltcG9ydCBJVmVydGV4QnVmZmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JVmVydGV4QnVmZmVyXCIpO1xyXG5cclxuY2xhc3MgUlRUQnVmZmVyTWFuYWdlciBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlclxyXG57XHJcblx0cHJpdmF0ZSBzdGF0aWMgX2luc3RhbmNlczpBcnJheTxSVFRCdWZmZXJNYW5hZ2VyVk8+O1xyXG5cclxuXHRwcml2YXRlIF9yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXI6SVZlcnRleEJ1ZmZlcjtcclxuXHRwcml2YXRlIF9yZW5kZXJUb1NjcmVlblZlcnRleEJ1ZmZlcjpJVmVydGV4QnVmZmVyO1xyXG5cclxuXHRwcml2YXRlIF9pbmRleEJ1ZmZlcjpJSW5kZXhCdWZmZXI7XHJcblx0cHJpdmF0ZSBfc3RhZ2U6U3RhZ2U7XHJcblx0cHJpdmF0ZSBfdmlld1dpZHRoOm51bWJlciA9IC0xO1xyXG5cdHByaXZhdGUgX3ZpZXdIZWlnaHQ6bnVtYmVyID0gLTE7XHJcblx0cHJpdmF0ZSBfdGV4dHVyZVdpZHRoOm51bWJlciA9IC0xO1xyXG5cdHByaXZhdGUgX3RleHR1cmVIZWlnaHQ6bnVtYmVyID0gLTE7XHJcblx0cHJpdmF0ZSBfcmVuZGVyVG9UZXh0dXJlUmVjdDpSZWN0YW5nbGU7XHJcblx0cHJpdmF0ZSBfYnVmZmVyc0ludmFsaWQ6Ym9vbGVhbiA9IHRydWU7XHJcblxyXG5cdHByaXZhdGUgX3RleHR1cmVSYXRpb1g6bnVtYmVyO1xyXG5cdHByaXZhdGUgX3RleHR1cmVSYXRpb1k6bnVtYmVyO1xyXG5cclxuXHRjb25zdHJ1Y3RvcihzdGFnZTpTdGFnZSlcclxuXHR7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3QgPSBuZXcgUmVjdGFuZ2xlKCk7XHJcblxyXG5cdFx0dGhpcy5fc3RhZ2UgPSBzdGFnZTtcclxuXHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKHN0YWdlOlN0YWdlKTpSVFRCdWZmZXJNYW5hZ2VyXHJcblx0e1xyXG5cdFx0aWYgKCFzdGFnZSlcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwic3RhZ2Uga2V5IGNhbm5vdCBiZSBudWxsIVwiKTtcclxuXHJcblx0XHRpZiAoUlRUQnVmZmVyTWFuYWdlci5faW5zdGFuY2VzID09IG51bGwpXHJcblx0XHRcdFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcyA9IG5ldyBBcnJheTxSVFRCdWZmZXJNYW5hZ2VyVk8+KCk7XHJcblxyXG5cdFx0dmFyIHJ0dEJ1ZmZlck1hbmFnZXI6UlRUQnVmZmVyTWFuYWdlciA9IFJUVEJ1ZmZlck1hbmFnZXIuZ2V0UlRUQnVmZmVyTWFuYWdlckZyb21TdGFnZShzdGFnZSk7XHJcblxyXG5cdFx0aWYgKHJ0dEJ1ZmZlck1hbmFnZXIgPT0gbnVsbCkge1xyXG5cdFx0XHRydHRCdWZmZXJNYW5hZ2VyID0gbmV3IFJUVEJ1ZmZlck1hbmFnZXIoc3RhZ2UpO1xyXG5cclxuXHRcdFx0dmFyIHZvOlJUVEJ1ZmZlck1hbmFnZXJWTyA9IG5ldyBSVFRCdWZmZXJNYW5hZ2VyVk8oKTtcclxuXHJcblx0XHRcdHZvLnN0YWdlM2QgPSBzdGFnZTtcclxuXHRcdFx0dm8ucnR0YmZtID0gcnR0QnVmZmVyTWFuYWdlcjtcclxuXHJcblx0XHRcdFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcy5wdXNoKHZvKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gcnR0QnVmZmVyTWFuYWdlcjtcclxuXHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHN0YXRpYyBnZXRSVFRCdWZmZXJNYW5hZ2VyRnJvbVN0YWdlKHN0YWdlOlN0YWdlKTpSVFRCdWZmZXJNYW5hZ2VyXHJcblx0e1xyXG5cclxuXHRcdHZhciBsOm51bWJlciA9IFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcy5sZW5ndGg7XHJcblx0XHR2YXIgcjpSVFRCdWZmZXJNYW5hZ2VyVk87XHJcblxyXG5cdFx0Zm9yICh2YXIgYzpudW1iZXIgPSAwOyBjIDwgbDsgYysrKSB7XHJcblx0XHRcdHIgPSBSVFRCdWZmZXJNYW5hZ2VyLl9pbnN0YW5jZXNbIGMgXTtcclxuXHJcblx0XHRcdGlmIChyLnN0YWdlM2QgPT09IHN0YWdlKVxyXG5cdFx0XHRcdHJldHVybiByLnJ0dGJmbTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgc3RhdGljIGRlbGV0ZVJUVEJ1ZmZlck1hbmFnZXIoc3RhZ2U6U3RhZ2UpOnZvaWRcclxuXHR7XHJcblx0XHR2YXIgbDpudW1iZXIgPSBSVFRCdWZmZXJNYW5hZ2VyLl9pbnN0YW5jZXMubGVuZ3RoO1xyXG5cdFx0dmFyIHI6UlRUQnVmZmVyTWFuYWdlclZPO1xyXG5cclxuXHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IGw7IGMrKykge1xyXG5cdFx0XHRyID0gUlRUQnVmZmVyTWFuYWdlci5faW5zdGFuY2VzWyBjIF07XHJcblxyXG5cdFx0XHRpZiAoci5zdGFnZTNkID09PSBzdGFnZSkge1xyXG5cdFx0XHRcdFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcy5zcGxpY2UoYywgMSk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHRleHR1cmVSYXRpb1goKTpudW1iZXJcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fYnVmZmVyc0ludmFsaWQpXHJcblx0XHRcdHRoaXMudXBkYXRlUlRUQnVmZmVycygpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlUmF0aW9YO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCB0ZXh0dXJlUmF0aW9ZKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX2J1ZmZlcnNJbnZhbGlkKVxyXG5cdFx0XHR0aGlzLnVwZGF0ZVJUVEJ1ZmZlcnMoKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZVJhdGlvWTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgdmlld1dpZHRoKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3ZpZXdXaWR0aDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgdmlld1dpZHRoKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHRpZiAodmFsdWUgPT0gdGhpcy5fdmlld1dpZHRoKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0dGhpcy5fdmlld1dpZHRoID0gdmFsdWU7XHJcblxyXG5cdFx0dGhpcy5fYnVmZmVyc0ludmFsaWQgPSB0cnVlO1xyXG5cclxuXHRcdHRoaXMuX3RleHR1cmVXaWR0aCA9IFRleHR1cmVVdGlscy5nZXRCZXN0UG93ZXJPZjIodGhpcy5fdmlld1dpZHRoKTtcclxuXHJcblx0XHRpZiAodGhpcy5fdGV4dHVyZVdpZHRoID4gdGhpcy5fdmlld1dpZHRoKSB7XHJcblx0XHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3QueCA9IE1hdGguZmxvb3IoKHRoaXMuX3RleHR1cmVXaWR0aCAtIHRoaXMuX3ZpZXdXaWR0aCkqLjUpO1xyXG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LndpZHRoID0gdGhpcy5fdmlld1dpZHRoO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC54ID0gMDtcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC53aWR0aCA9IHRoaXMuX3RleHR1cmVXaWR0aDtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KEV2ZW50LlJFU0laRSkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCB2aWV3SGVpZ2h0KCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3ZpZXdIZWlnaHQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHZpZXdIZWlnaHQodmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdGlmICh2YWx1ZSA9PSB0aGlzLl92aWV3SGVpZ2h0KVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0dGhpcy5fdmlld0hlaWdodCA9IHZhbHVlO1xyXG5cclxuXHRcdHRoaXMuX2J1ZmZlcnNJbnZhbGlkID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLl90ZXh0dXJlSGVpZ2h0ID0gVGV4dHVyZVV0aWxzLmdldEJlc3RQb3dlck9mMih0aGlzLl92aWV3SGVpZ2h0KTtcclxuXHJcblx0XHRpZiAodGhpcy5fdGV4dHVyZUhlaWdodCA+IHRoaXMuX3ZpZXdIZWlnaHQpIHtcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC55ID0gTWF0aC5mbG9vcigodGhpcy5fdGV4dHVyZUhlaWdodCAtIHRoaXMuX3ZpZXdIZWlnaHQpKi41KTtcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC5oZWlnaHQgPSB0aGlzLl92aWV3SGVpZ2h0O1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC55ID0gMDtcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC5oZWlnaHQgPSB0aGlzLl90ZXh0dXJlSGVpZ2h0O1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoRXZlbnQuUkVTSVpFKSk7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHJlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlcigpOklWZXJ0ZXhCdWZmZXJcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fYnVmZmVyc0ludmFsaWQpXHJcblx0XHRcdHRoaXMudXBkYXRlUlRUQnVmZmVycygpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXI7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHJlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyKCk6SVZlcnRleEJ1ZmZlclxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9idWZmZXJzSW52YWxpZClcclxuXHRcdFx0dGhpcy51cGRhdGVSVFRCdWZmZXJzKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyO1xyXG5cclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgaW5kZXhCdWZmZXIoKTpJSW5kZXhCdWZmZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5faW5kZXhCdWZmZXI7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHJlbmRlclRvVGV4dHVyZVJlY3QoKTpSZWN0YW5nbGVcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fYnVmZmVyc0ludmFsaWQpXHJcblx0XHRcdHRoaXMudXBkYXRlUlRUQnVmZmVycygpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0O1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCB0ZXh0dXJlV2lkdGgoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZVdpZHRoO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCB0ZXh0dXJlSGVpZ2h0KCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmVIZWlnaHQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZGlzcG9zZSgpXHJcblx0e1xyXG5cdFx0UlRUQnVmZmVyTWFuYWdlci5kZWxldGVSVFRCdWZmZXJNYW5hZ2VyKHRoaXMuX3N0YWdlKTtcclxuXHJcblx0XHRpZiAodGhpcy5faW5kZXhCdWZmZXIpIHtcclxuXHRcdFx0dGhpcy5faW5kZXhCdWZmZXIuZGlzcG9zZSgpO1xyXG5cdFx0XHR0aGlzLl9yZW5kZXJUb1NjcmVlblZlcnRleEJ1ZmZlci5kaXNwb3NlKCk7XHJcblx0XHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlci5kaXNwb3NlKCk7XHJcblx0XHRcdHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyID0gbnVsbDtcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyID0gbnVsbDtcclxuXHRcdFx0dGhpcy5faW5kZXhCdWZmZXIgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8gdG9kbzogcGxhY2UgYWxsIHRoaXMgaW4gYSBzZXBhcmF0ZSBtb2RlbCwgc2luY2UgaXQncyB1c2VkIGFsbCBvdmVyIHRoZSBwbGFjZVxyXG5cdC8vIG1heWJlIGl0IGV2ZW4gaGFzIGEgcGxhY2UgaW4gdGhlIGNvcmUgKHRvZ2V0aGVyIHdpdGggc2NyZWVuUmVjdCBldGMpP1xyXG5cdC8vIG5lZWRzIHRvIGJlIHN0b3JlZCBwZXIgdmlldyBvZiBjb3Vyc2VcclxuXHRwcml2YXRlIHVwZGF0ZVJUVEJ1ZmZlcnMoKVxyXG5cdHtcclxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xyXG5cdFx0dmFyIHRleHR1cmVWZXJ0czpudW1iZXJbXTtcclxuXHRcdHZhciBzY3JlZW5WZXJ0czpudW1iZXJbXTtcclxuXHJcblx0XHR2YXIgeDpudW1iZXI7XHJcblx0XHR2YXIgeTpudW1iZXI7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3JlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlciA9PSBudWxsKVxyXG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXIgPSBjb250ZXh0LmNyZWF0ZVZlcnRleEJ1ZmZlcig0LCA1KTtcclxuXHJcblx0XHRpZiAodGhpcy5fcmVuZGVyVG9TY3JlZW5WZXJ0ZXhCdWZmZXIgPT0gbnVsbClcclxuXHRcdFx0dGhpcy5fcmVuZGVyVG9TY3JlZW5WZXJ0ZXhCdWZmZXIgPSBjb250ZXh0LmNyZWF0ZVZlcnRleEJ1ZmZlcig0LCA1KTtcclxuXHJcblx0XHRpZiAoIXRoaXMuX2luZGV4QnVmZmVyKSB7XHJcblx0XHRcdHRoaXMuX2luZGV4QnVmZmVyID0gY29udGV4dC5jcmVhdGVJbmRleEJ1ZmZlcig2KTtcclxuXHJcblx0XHRcdHRoaXMuX2luZGV4QnVmZmVyLnVwbG9hZEZyb21BcnJheShbMiwgMSwgMCwgMywgMiwgMF0sIDAsIDYpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX3RleHR1cmVSYXRpb1ggPSB4ID0gTWF0aC5taW4odGhpcy5fdmlld1dpZHRoL3RoaXMuX3RleHR1cmVXaWR0aCwgMSk7XHJcblx0XHR0aGlzLl90ZXh0dXJlUmF0aW9ZID0geSA9IE1hdGgubWluKHRoaXMuX3ZpZXdIZWlnaHQvdGhpcy5fdGV4dHVyZUhlaWdodCwgMSk7XHJcblxyXG5cdFx0dmFyIHUxOm51bWJlciA9ICgxIC0geCkqLjU7XHJcblx0XHR2YXIgdTI6bnVtYmVyID0gKHggKyAxKSouNTtcclxuXHRcdHZhciB2MTpudW1iZXIgPSAoeSArIDEpKi41O1xyXG5cdFx0dmFyIHYyOm51bWJlciA9ICgxIC0geSkqLjU7XHJcblxyXG5cdFx0Ly8gbGFzdCBlbGVtZW50IGNvbnRhaW5zIGluZGljZXMgZm9yIGRhdGEgcGVyIHZlcnRleCB0aGF0IGNhbiBiZSBwYXNzZWQgdG8gdGhlIHZlcnRleCBzaGFkZXIgaWYgbmVjZXNzYXJ5IChpZTogZnJ1c3R1bSBjb3JuZXJzIGZvciBkZWZlcnJlZCByZW5kZXJpbmcpXHJcblx0XHR0ZXh0dXJlVmVydHMgPSBbICAgIC14LCAteSwgdTEsIHYxLCAwLCB4LCAteSwgdTIsIHYxLCAxLCB4LCB5LCB1MiwgdjIsIDIsIC14LCB5LCB1MSwgdjIsIDMgXTtcclxuXHJcblx0XHRzY3JlZW5WZXJ0cyA9IFsgICAgIC0xLCAtMSwgdTEsIHYxLCAwLCAxLCAtMSwgdTIsIHYxLCAxLCAxLCAxLCB1MiwgdjIsIDIsIC0xLCAxLCB1MSwgdjIsIDMgXTtcclxuXHJcblx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXIudXBsb2FkRnJvbUFycmF5KHRleHR1cmVWZXJ0cywgMCwgNCk7XHJcblx0XHR0aGlzLl9yZW5kZXJUb1NjcmVlblZlcnRleEJ1ZmZlci51cGxvYWRGcm9tQXJyYXkoc2NyZWVuVmVydHMsIDAsIDQpO1xyXG5cclxuXHRcdHRoaXMuX2J1ZmZlcnNJbnZhbGlkID0gZmFsc2U7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBSVFRCdWZmZXJNYW5hZ2VyO1xyXG5cclxuY2xhc3MgUlRUQnVmZmVyTWFuYWdlclZPXHJcbntcclxuXHRwdWJsaWMgc3RhZ2UzZDpTdGFnZTtcclxuXHJcblx0cHVibGljIHJ0dGJmbTpSVFRCdWZmZXJNYW5hZ2VyO1xyXG59Il19