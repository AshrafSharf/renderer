var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Rectangle = require("awayjs-core/lib/geom/Rectangle");
var Event = require("awayjs-core/lib/events/Event");
var EventDispatcher = require("awayjs-core/lib/events/EventDispatcher");
var TextureUtils = require("awayjs-core/lib/utils/TextureUtils");
var RTTBufferManager = (function (_super) {
    __extends(RTTBufferManager, _super);
    function RTTBufferManager(stage) {
        _super.call(this);
        this._viewWidth = -1;
        this._viewHeight = -1;
        this._textureWidth = -1;
        this._textureHeight = -1;
        this._buffersInvalid = true;
        this._renderToTextureRect = new Rectangle();
        this._stage = stage;
    }
    RTTBufferManager.getInstance = function (stage) {
        if (!stage)
            throw new Error("stage key cannot be null!");
        if (RTTBufferManager._instances == null)
            RTTBufferManager._instances = new Array();
        var rttBufferManager = RTTBufferManager.getRTTBufferManagerFromStage(stage);
        if (rttBufferManager == null) {
            rttBufferManager = new RTTBufferManager(stage);
            var vo = new RTTBufferManagerVO();
            vo.stage3d = stage;
            vo.rttbfm = rttBufferManager;
            RTTBufferManager._instances.push(vo);
        }
        return rttBufferManager;
    };
    RTTBufferManager.getRTTBufferManagerFromStage = function (stage) {
        var l = RTTBufferManager._instances.length;
        var r;
        for (var c = 0; c < l; c++) {
            r = RTTBufferManager._instances[c];
            if (r.stage3d === stage)
                return r.rttbfm;
        }
        return null;
    };
    RTTBufferManager.deleteRTTBufferManager = function (stage) {
        var l = RTTBufferManager._instances.length;
        var r;
        for (var c = 0; c < l; c++) {
            r = RTTBufferManager._instances[c];
            if (r.stage3d === stage) {
                RTTBufferManager._instances.splice(c, 1);
                return;
            }
        }
    };
    Object.defineProperty(RTTBufferManager.prototype, "textureRatioX", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._textureRatioX;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureRatioY", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._textureRatioY;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "viewWidth", {
        get: function () {
            return this._viewWidth;
        },
        set: function (value) {
            if (value == this._viewWidth)
                return;
            this._viewWidth = value;
            this._buffersInvalid = true;
            this._textureWidth = TextureUtils.getBestPowerOf2(this._viewWidth);
            if (this._textureWidth > this._viewWidth) {
                this._renderToTextureRect.x = Math.floor((this._textureWidth - this._viewWidth) * .5);
                this._renderToTextureRect.width = this._viewWidth;
            }
            else {
                this._renderToTextureRect.x = 0;
                this._renderToTextureRect.width = this._textureWidth;
            }
            this.dispatchEvent(new Event(Event.RESIZE));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "viewHeight", {
        get: function () {
            return this._viewHeight;
        },
        set: function (value) {
            if (value == this._viewHeight)
                return;
            this._viewHeight = value;
            this._buffersInvalid = true;
            this._textureHeight = TextureUtils.getBestPowerOf2(this._viewHeight);
            if (this._textureHeight > this._viewHeight) {
                this._renderToTextureRect.y = Math.floor((this._textureHeight - this._viewHeight) * .5);
                this._renderToTextureRect.height = this._viewHeight;
            }
            else {
                this._renderToTextureRect.y = 0;
                this._renderToTextureRect.height = this._textureHeight;
            }
            this.dispatchEvent(new Event(Event.RESIZE));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToTextureVertexBuffer", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToTextureVertexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToScreenVertexBuffer", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToScreenVertexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "indexBuffer", {
        get: function () {
            return this._indexBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "renderToTextureRect", {
        get: function () {
            if (this._buffersInvalid)
                this.updateRTTBuffers();
            return this._renderToTextureRect;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureWidth", {
        get: function () {
            return this._textureWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RTTBufferManager.prototype, "textureHeight", {
        get: function () {
            return this._textureHeight;
        },
        enumerable: true,
        configurable: true
    });
    RTTBufferManager.prototype.dispose = function () {
        RTTBufferManager.deleteRTTBufferManager(this._stage);
        if (this._indexBuffer) {
            this._indexBuffer.dispose();
            this._renderToScreenVertexBuffer.dispose();
            this._renderToTextureVertexBuffer.dispose();
            this._renderToScreenVertexBuffer = null;
            this._renderToTextureVertexBuffer = null;
            this._indexBuffer = null;
        }
    };
    // todo: place all this in a separate model, since it's used all over the place
    // maybe it even has a place in the core (together with screenRect etc)?
    // needs to be stored per view of course
    RTTBufferManager.prototype.updateRTTBuffers = function () {
        var context = this._stage.context;
        var textureVerts;
        var screenVerts;
        var x;
        var y;
        if (this._renderToTextureVertexBuffer == null)
            this._renderToTextureVertexBuffer = context.createVertexBuffer(4, 5);
        if (this._renderToScreenVertexBuffer == null)
            this._renderToScreenVertexBuffer = context.createVertexBuffer(4, 5);
        if (!this._indexBuffer) {
            this._indexBuffer = context.createIndexBuffer(6);
            this._indexBuffer.uploadFromArray([2, 1, 0, 3, 2, 0], 0, 6);
        }
        this._textureRatioX = x = Math.min(this._viewWidth / this._textureWidth, 1);
        this._textureRatioY = y = Math.min(this._viewHeight / this._textureHeight, 1);
        var u1 = (1 - x) * .5;
        var u2 = (x + 1) * .5;
        var v1 = (y + 1) * .5;
        var v2 = (1 - y) * .5;
        // last element contains indices for data per vertex that can be passed to the vertex shader if necessary (ie: frustum corners for deferred rendering)
        textureVerts = [-x, -y, u1, v1, 0, x, -y, u2, v1, 1, x, y, u2, v2, 2, -x, y, u1, v2, 3];
        screenVerts = [-1, -1, u1, v1, 0, 1, -1, u2, v1, 1, 1, 1, u2, v2, 2, -1, 1, u1, v2, 3];
        this._renderToTextureVertexBuffer.uploadFromArray(textureVerts, 0, 4);
        this._renderToScreenVertexBuffer.uploadFromArray(screenVerts, 0, 4);
        this._buffersInvalid = false;
    };
    return RTTBufferManager;
})(EventDispatcher);
var RTTBufferManagerVO = (function () {
    function RTTBufferManagerVO() {
    }
    return RTTBufferManagerVO;
})();
module.exports = RTTBufferManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYW5hZ2Vycy9SVFRCdWZmZXJNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbIlJUVEJ1ZmZlck1hbmFnZXIiLCJSVFRCdWZmZXJNYW5hZ2VyLmNvbnN0cnVjdG9yIiwiUlRUQnVmZmVyTWFuYWdlci5nZXRJbnN0YW5jZSIsIlJUVEJ1ZmZlck1hbmFnZXIuZ2V0UlRUQnVmZmVyTWFuYWdlckZyb21TdGFnZSIsIlJUVEJ1ZmZlck1hbmFnZXIuZGVsZXRlUlRUQnVmZmVyTWFuYWdlciIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWCIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWSIsIlJUVEJ1ZmZlck1hbmFnZXIudmlld1dpZHRoIiwiUlRUQnVmZmVyTWFuYWdlci52aWV3SGVpZ2h0IiwiUlRUQnVmZmVyTWFuYWdlci5yZW5kZXJUb1RleHR1cmVWZXJ0ZXhCdWZmZXIiLCJSVFRCdWZmZXJNYW5hZ2VyLnJlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyIiwiUlRUQnVmZmVyTWFuYWdlci5pbmRleEJ1ZmZlciIsIlJUVEJ1ZmZlck1hbmFnZXIucmVuZGVyVG9UZXh0dXJlUmVjdCIsIlJUVEJ1ZmZlck1hbmFnZXIudGV4dHVyZVdpZHRoIiwiUlRUQnVmZmVyTWFuYWdlci50ZXh0dXJlSGVpZ2h0IiwiUlRUQnVmZmVyTWFuYWdlci5kaXNwb3NlIiwiUlRUQnVmZmVyTWFuYWdlci51cGRhdGVSVFRCdWZmZXJzIiwiUlRUQnVmZmVyTWFuYWdlclZPIiwiUlRUQnVmZmVyTWFuYWdlclZPLmNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFNBQVMsV0FBZSxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2pFLElBQU8sS0FBSyxXQUFnQiw4QkFBOEIsQ0FBQyxDQUFDO0FBQzVELElBQU8sZUFBZSxXQUFjLHdDQUF3QyxDQUFDLENBQUM7QUFDOUUsSUFBTyxZQUFZLFdBQWUsb0NBQW9DLENBQUMsQ0FBQztB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RUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0RBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEdBQUNBLElBQUlBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzFFQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU1RUEsSUFBSUEsRUFBRUEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDM0JBLElBQUlBLEVBQUVBLEdBQVVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLEVBQUVBLENBQUNBO1FBQzNCQSxJQUFJQSxFQUFFQSxHQUFVQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFDQSxFQUFFQSxDQUFDQTtRQUMzQkEsSUFBSUEsRUFBRUEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsRUFBRUEsQ0FBQ0E7UUFFM0JBLEFBQ0FBLHNKQURzSkE7UUFDdEpBLFlBQVlBLEdBQUdBLENBQUtBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUVBLENBQUNBO1FBRTdGQSxXQUFXQSxHQUFHQSxDQUFNQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFFQSxDQUFDQTtRQUU3RkEsSUFBSUEsQ0FBQ0EsNEJBQTRCQSxDQUFDQSxlQUFlQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN0RUEsSUFBSUEsQ0FBQ0EsMkJBQTJCQSxDQUFDQSxlQUFlQSxDQUFDQSxXQUFXQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVwRUEsSUFBSUEsQ0FBQ0EsZUFBZUEsR0FBR0EsS0FBS0EsQ0FBQ0E7SUFDOUJBLENBQUNBO0lBQ0ZoQix1QkFBQ0E7QUFBREEsQ0EzUEEsQUEyUENBLEVBM1A4QixlQUFlLEVBMlA3QztBQUlELElBQU0sa0JBQWtCO0lBQXhCaUIsU0FBTUEsa0JBQWtCQTtJQUt4QkMsQ0FBQ0E7SUFBREQseUJBQUNBO0FBQURBLENBTEEsQUFLQ0EsSUFBQTtBQVBELGlCQUFTLGdCQUFnQixDQUFDIiwiZmlsZSI6Im1hbmFnZXJzL1JUVEJ1ZmZlck1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XG5pbXBvcnQgRXZlbnRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuaW1wb3J0IEV2ZW50RGlzcGF0Y2hlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9FdmVudERpc3BhdGNoZXJcIik7XG5pbXBvcnQgVGV4dHVyZVV0aWxzXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi91dGlscy9UZXh0dXJlVXRpbHNcIik7XG5cbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcbmltcG9ydCBJSW5kZXhCdWZmZXJcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUluZGV4QnVmZmVyXCIpO1xuaW1wb3J0IElWZXJ0ZXhCdWZmZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0lWZXJ0ZXhCdWZmZXJcIik7XG5cbmNsYXNzIFJUVEJ1ZmZlck1hbmFnZXIgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXJcbntcblx0cHJpdmF0ZSBzdGF0aWMgX2luc3RhbmNlczpBcnJheTxSVFRCdWZmZXJNYW5hZ2VyVk8+O1xuXG5cdHByaXZhdGUgX3JlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlcjpJVmVydGV4QnVmZmVyO1xuXHRwcml2YXRlIF9yZW5kZXJUb1NjcmVlblZlcnRleEJ1ZmZlcjpJVmVydGV4QnVmZmVyO1xuXG5cdHByaXZhdGUgX2luZGV4QnVmZmVyOklJbmRleEJ1ZmZlcjtcblx0cHJpdmF0ZSBfc3RhZ2U6U3RhZ2U7XG5cdHByaXZhdGUgX3ZpZXdXaWR0aDpudW1iZXIgPSAtMTtcblx0cHJpdmF0ZSBfdmlld0hlaWdodDpudW1iZXIgPSAtMTtcblx0cHJpdmF0ZSBfdGV4dHVyZVdpZHRoOm51bWJlciA9IC0xO1xuXHRwcml2YXRlIF90ZXh0dXJlSGVpZ2h0Om51bWJlciA9IC0xO1xuXHRwcml2YXRlIF9yZW5kZXJUb1RleHR1cmVSZWN0OlJlY3RhbmdsZTtcblx0cHJpdmF0ZSBfYnVmZmVyc0ludmFsaWQ6Ym9vbGVhbiA9IHRydWU7XG5cblx0cHJpdmF0ZSBfdGV4dHVyZVJhdGlvWDpudW1iZXI7XG5cdHByaXZhdGUgX3RleHR1cmVSYXRpb1k6bnVtYmVyO1xuXG5cdGNvbnN0cnVjdG9yKHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVJlY3QgPSBuZXcgUmVjdGFuZ2xlKCk7XG5cblx0XHR0aGlzLl9zdGFnZSA9IHN0YWdlO1xuXG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKHN0YWdlOlN0YWdlKTpSVFRCdWZmZXJNYW5hZ2VyXG5cdHtcblx0XHRpZiAoIXN0YWdlKVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwic3RhZ2Uga2V5IGNhbm5vdCBiZSBudWxsIVwiKTtcblxuXHRcdGlmIChSVFRCdWZmZXJNYW5hZ2VyLl9pbnN0YW5jZXMgPT0gbnVsbClcblx0XHRcdFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcyA9IG5ldyBBcnJheTxSVFRCdWZmZXJNYW5hZ2VyVk8+KCk7XG5cblx0XHR2YXIgcnR0QnVmZmVyTWFuYWdlcjpSVFRCdWZmZXJNYW5hZ2VyID0gUlRUQnVmZmVyTWFuYWdlci5nZXRSVFRCdWZmZXJNYW5hZ2VyRnJvbVN0YWdlKHN0YWdlKTtcblxuXHRcdGlmIChydHRCdWZmZXJNYW5hZ2VyID09IG51bGwpIHtcblx0XHRcdHJ0dEJ1ZmZlck1hbmFnZXIgPSBuZXcgUlRUQnVmZmVyTWFuYWdlcihzdGFnZSk7XG5cblx0XHRcdHZhciB2bzpSVFRCdWZmZXJNYW5hZ2VyVk8gPSBuZXcgUlRUQnVmZmVyTWFuYWdlclZPKCk7XG5cblx0XHRcdHZvLnN0YWdlM2QgPSBzdGFnZTtcblx0XHRcdHZvLnJ0dGJmbSA9IHJ0dEJ1ZmZlck1hbmFnZXI7XG5cblx0XHRcdFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlcy5wdXNoKHZvKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcnR0QnVmZmVyTWFuYWdlcjtcblxuXHR9XG5cblx0cHJpdmF0ZSBzdGF0aWMgZ2V0UlRUQnVmZmVyTWFuYWdlckZyb21TdGFnZShzdGFnZTpTdGFnZSk6UlRUQnVmZmVyTWFuYWdlclxuXHR7XG5cblx0XHR2YXIgbDpudW1iZXIgPSBSVFRCdWZmZXJNYW5hZ2VyLl9pbnN0YW5jZXMubGVuZ3RoO1xuXHRcdHZhciByOlJUVEJ1ZmZlck1hbmFnZXJWTztcblxuXHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IGw7IGMrKykge1xuXHRcdFx0ciA9IFJUVEJ1ZmZlck1hbmFnZXIuX2luc3RhbmNlc1sgYyBdO1xuXG5cdFx0XHRpZiAoci5zdGFnZTNkID09PSBzdGFnZSlcblx0XHRcdFx0cmV0dXJuIHIucnR0YmZtO1xuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0cHJpdmF0ZSBzdGF0aWMgZGVsZXRlUlRUQnVmZmVyTWFuYWdlcihzdGFnZTpTdGFnZSk6dm9pZFxuXHR7XG5cdFx0dmFyIGw6bnVtYmVyID0gUlRUQnVmZmVyTWFuYWdlci5faW5zdGFuY2VzLmxlbmd0aDtcblx0XHR2YXIgcjpSVFRCdWZmZXJNYW5hZ2VyVk87XG5cblx0XHRmb3IgKHZhciBjOm51bWJlciA9IDA7IGMgPCBsOyBjKyspIHtcblx0XHRcdHIgPSBSVFRCdWZmZXJNYW5hZ2VyLl9pbnN0YW5jZXNbIGMgXTtcblxuXHRcdFx0aWYgKHIuc3RhZ2UzZCA9PT0gc3RhZ2UpIHtcblx0XHRcdFx0UlRUQnVmZmVyTWFuYWdlci5faW5zdGFuY2VzLnNwbGljZShjLCAxKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXQgdGV4dHVyZVJhdGlvWCgpOm51bWJlclxuXHR7XG5cdFx0aWYgKHRoaXMuX2J1ZmZlcnNJbnZhbGlkKVxuXHRcdFx0dGhpcy51cGRhdGVSVFRCdWZmZXJzKCk7XG5cblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZVJhdGlvWDtcblx0fVxuXG5cdHB1YmxpYyBnZXQgdGV4dHVyZVJhdGlvWSgpOm51bWJlclxuXHR7XG5cdFx0aWYgKHRoaXMuX2J1ZmZlcnNJbnZhbGlkKVxuXHRcdFx0dGhpcy51cGRhdGVSVFRCdWZmZXJzKCk7XG5cblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZVJhdGlvWTtcblx0fVxuXG5cdHB1YmxpYyBnZXQgdmlld1dpZHRoKCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fdmlld1dpZHRoO1xuXHR9XG5cblx0cHVibGljIHNldCB2aWV3V2lkdGgodmFsdWU6bnVtYmVyKVxuXHR7XG5cdFx0aWYgKHZhbHVlID09IHRoaXMuX3ZpZXdXaWR0aClcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3ZpZXdXaWR0aCA9IHZhbHVlO1xuXG5cdFx0dGhpcy5fYnVmZmVyc0ludmFsaWQgPSB0cnVlO1xuXG5cdFx0dGhpcy5fdGV4dHVyZVdpZHRoID0gVGV4dHVyZVV0aWxzLmdldEJlc3RQb3dlck9mMih0aGlzLl92aWV3V2lkdGgpO1xuXG5cdFx0aWYgKHRoaXMuX3RleHR1cmVXaWR0aCA+IHRoaXMuX3ZpZXdXaWR0aCkge1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC54ID0gTWF0aC5mbG9vcigodGhpcy5fdGV4dHVyZVdpZHRoIC0gdGhpcy5fdmlld1dpZHRoKSouNSk7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LndpZHRoID0gdGhpcy5fdmlld1dpZHRoO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LnggPSAwO1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC53aWR0aCA9IHRoaXMuX3RleHR1cmVXaWR0aDtcblx0XHR9XG5cblx0XHR0aGlzLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KEV2ZW50LlJFU0laRSkpO1xuXHR9XG5cblx0cHVibGljIGdldCB2aWV3SGVpZ2h0KCk6bnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fdmlld0hlaWdodDtcblx0fVxuXG5cdHB1YmxpYyBzZXQgdmlld0hlaWdodCh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHRpZiAodmFsdWUgPT0gdGhpcy5fdmlld0hlaWdodClcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX3ZpZXdIZWlnaHQgPSB2YWx1ZTtcblxuXHRcdHRoaXMuX2J1ZmZlcnNJbnZhbGlkID0gdHJ1ZTtcblxuXHRcdHRoaXMuX3RleHR1cmVIZWlnaHQgPSBUZXh0dXJlVXRpbHMuZ2V0QmVzdFBvd2VyT2YyKHRoaXMuX3ZpZXdIZWlnaHQpO1xuXG5cdFx0aWYgKHRoaXMuX3RleHR1cmVIZWlnaHQgPiB0aGlzLl92aWV3SGVpZ2h0KSB7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LnkgPSBNYXRoLmZsb29yKCh0aGlzLl90ZXh0dXJlSGVpZ2h0IC0gdGhpcy5fdmlld0hlaWdodCkqLjUpO1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC5oZWlnaHQgPSB0aGlzLl92aWV3SGVpZ2h0O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0LnkgPSAwO1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlUmVjdC5oZWlnaHQgPSB0aGlzLl90ZXh0dXJlSGVpZ2h0O1xuXHRcdH1cblxuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoRXZlbnQuUkVTSVpFKSk7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHJlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlcigpOklWZXJ0ZXhCdWZmZXJcblx0e1xuXHRcdGlmICh0aGlzLl9idWZmZXJzSW52YWxpZClcblx0XHRcdHRoaXMudXBkYXRlUlRUQnVmZmVycygpO1xuXG5cdFx0cmV0dXJuIHRoaXMuX3JlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlcjtcblx0fVxuXG5cdHB1YmxpYyBnZXQgcmVuZGVyVG9TY3JlZW5WZXJ0ZXhCdWZmZXIoKTpJVmVydGV4QnVmZmVyXG5cdHtcblx0XHRpZiAodGhpcy5fYnVmZmVyc0ludmFsaWQpXG5cdFx0XHR0aGlzLnVwZGF0ZVJUVEJ1ZmZlcnMoKTtcblxuXHRcdHJldHVybiB0aGlzLl9yZW5kZXJUb1NjcmVlblZlcnRleEJ1ZmZlcjtcblxuXHR9XG5cblx0cHVibGljIGdldCBpbmRleEJ1ZmZlcigpOklJbmRleEJ1ZmZlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuX2luZGV4QnVmZmVyO1xuXHR9XG5cblx0cHVibGljIGdldCByZW5kZXJUb1RleHR1cmVSZWN0KCk6UmVjdGFuZ2xlXG5cdHtcblx0XHRpZiAodGhpcy5fYnVmZmVyc0ludmFsaWQpXG5cdFx0XHR0aGlzLnVwZGF0ZVJUVEJ1ZmZlcnMoKTtcblxuXHRcdHJldHVybiB0aGlzLl9yZW5kZXJUb1RleHR1cmVSZWN0O1xuXHR9XG5cblx0cHVibGljIGdldCB0ZXh0dXJlV2lkdGgoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlV2lkdGg7XG5cdH1cblxuXHRwdWJsaWMgZ2V0IHRleHR1cmVIZWlnaHQoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlSGVpZ2h0O1xuXHR9XG5cblx0cHVibGljIGRpc3Bvc2UoKVxuXHR7XG5cdFx0UlRUQnVmZmVyTWFuYWdlci5kZWxldGVSVFRCdWZmZXJNYW5hZ2VyKHRoaXMuX3N0YWdlKTtcblxuXHRcdGlmICh0aGlzLl9pbmRleEJ1ZmZlcikge1xuXHRcdFx0dGhpcy5faW5kZXhCdWZmZXIuZGlzcG9zZSgpO1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9TY3JlZW5WZXJ0ZXhCdWZmZXIuZGlzcG9zZSgpO1xuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyLmRpc3Bvc2UoKTtcblx0XHRcdHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyID0gbnVsbDtcblx0XHRcdHRoaXMuX3JlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlciA9IG51bGw7XG5cdFx0XHR0aGlzLl9pbmRleEJ1ZmZlciA9IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0Ly8gdG9kbzogcGxhY2UgYWxsIHRoaXMgaW4gYSBzZXBhcmF0ZSBtb2RlbCwgc2luY2UgaXQncyB1c2VkIGFsbCBvdmVyIHRoZSBwbGFjZVxuXHQvLyBtYXliZSBpdCBldmVuIGhhcyBhIHBsYWNlIGluIHRoZSBjb3JlICh0b2dldGhlciB3aXRoIHNjcmVlblJlY3QgZXRjKT9cblx0Ly8gbmVlZHMgdG8gYmUgc3RvcmVkIHBlciB2aWV3IG9mIGNvdXJzZVxuXHRwcml2YXRlIHVwZGF0ZVJUVEJ1ZmZlcnMoKVxuXHR7XG5cdFx0dmFyIGNvbnRleHQ6SUNvbnRleHRHTCA9IHRoaXMuX3N0YWdlLmNvbnRleHQ7XG5cdFx0dmFyIHRleHR1cmVWZXJ0czpudW1iZXJbXTtcblx0XHR2YXIgc2NyZWVuVmVydHM6bnVtYmVyW107XG5cblx0XHR2YXIgeDpudW1iZXI7XG5cdFx0dmFyIHk6bnVtYmVyO1xuXG5cdFx0aWYgKHRoaXMuX3JlbmRlclRvVGV4dHVyZVZlcnRleEJ1ZmZlciA9PSBudWxsKVxuXHRcdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyID0gY29udGV4dC5jcmVhdGVWZXJ0ZXhCdWZmZXIoNCwgNSk7XG5cblx0XHRpZiAodGhpcy5fcmVuZGVyVG9TY3JlZW5WZXJ0ZXhCdWZmZXIgPT0gbnVsbClcblx0XHRcdHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyID0gY29udGV4dC5jcmVhdGVWZXJ0ZXhCdWZmZXIoNCwgNSk7XG5cblx0XHRpZiAoIXRoaXMuX2luZGV4QnVmZmVyKSB7XG5cdFx0XHR0aGlzLl9pbmRleEJ1ZmZlciA9IGNvbnRleHQuY3JlYXRlSW5kZXhCdWZmZXIoNik7XG5cblx0XHRcdHRoaXMuX2luZGV4QnVmZmVyLnVwbG9hZEZyb21BcnJheShbMiwgMSwgMCwgMywgMiwgMF0sIDAsIDYpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3RleHR1cmVSYXRpb1ggPSB4ID0gTWF0aC5taW4odGhpcy5fdmlld1dpZHRoL3RoaXMuX3RleHR1cmVXaWR0aCwgMSk7XG5cdFx0dGhpcy5fdGV4dHVyZVJhdGlvWSA9IHkgPSBNYXRoLm1pbih0aGlzLl92aWV3SGVpZ2h0L3RoaXMuX3RleHR1cmVIZWlnaHQsIDEpO1xuXG5cdFx0dmFyIHUxOm51bWJlciA9ICgxIC0geCkqLjU7XG5cdFx0dmFyIHUyOm51bWJlciA9ICh4ICsgMSkqLjU7XG5cdFx0dmFyIHYxOm51bWJlciA9ICh5ICsgMSkqLjU7XG5cdFx0dmFyIHYyOm51bWJlciA9ICgxIC0geSkqLjU7XG5cblx0XHQvLyBsYXN0IGVsZW1lbnQgY29udGFpbnMgaW5kaWNlcyBmb3IgZGF0YSBwZXIgdmVydGV4IHRoYXQgY2FuIGJlIHBhc3NlZCB0byB0aGUgdmVydGV4IHNoYWRlciBpZiBuZWNlc3NhcnkgKGllOiBmcnVzdHVtIGNvcm5lcnMgZm9yIGRlZmVycmVkIHJlbmRlcmluZylcblx0XHR0ZXh0dXJlVmVydHMgPSBbICAgIC14LCAteSwgdTEsIHYxLCAwLCB4LCAteSwgdTIsIHYxLCAxLCB4LCB5LCB1MiwgdjIsIDIsIC14LCB5LCB1MSwgdjIsIDMgXTtcblxuXHRcdHNjcmVlblZlcnRzID0gWyAgICAgLTEsIC0xLCB1MSwgdjEsIDAsIDEsIC0xLCB1MiwgdjEsIDEsIDEsIDEsIHUyLCB2MiwgMiwgLTEsIDEsIHUxLCB2MiwgMyBdO1xuXG5cdFx0dGhpcy5fcmVuZGVyVG9UZXh0dXJlVmVydGV4QnVmZmVyLnVwbG9hZEZyb21BcnJheSh0ZXh0dXJlVmVydHMsIDAsIDQpO1xuXHRcdHRoaXMuX3JlbmRlclRvU2NyZWVuVmVydGV4QnVmZmVyLnVwbG9hZEZyb21BcnJheShzY3JlZW5WZXJ0cywgMCwgNCk7XG5cblx0XHR0aGlzLl9idWZmZXJzSW52YWxpZCA9IGZhbHNlO1xuXHR9XG59XG5cbmV4cG9ydCA9IFJUVEJ1ZmZlck1hbmFnZXI7XG5cbmNsYXNzIFJUVEJ1ZmZlck1hbmFnZXJWT1xue1xuXHRwdWJsaWMgc3RhZ2UzZDpTdGFnZTtcblxuXHRwdWJsaWMgcnR0YmZtOlJUVEJ1ZmZlck1hbmFnZXI7XG59Il19