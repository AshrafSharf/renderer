var Point = require("awayjs-core/lib/geom/Point");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var TriangleSubGeometry = require("awayjs-display/lib/base/TriangleSubGeometry");
var ParticleData = require("awayjs-renderergl/lib/animators/data/ParticleData");
var ParticleGeometry = require("awayjs-renderergl/lib/base/ParticleGeometry");
/**
 * ...
 */
var ParticleGeometryHelper = (function () {
    function ParticleGeometryHelper() {
    }
    ParticleGeometryHelper.generateGeometry = function (geometries, transforms) {
        if (transforms === void 0) { transforms = null; }
        var indicesVector = new Array() /*uint*/;
        var positionsVector = new Array();
        var normalsVector = new Array();
        var tangentsVector = new Array();
        var uvsVector = new Array();
        var vertexCounters = new Array() /*uint*/;
        var particles = new Array();
        var subGeometries = new Array();
        var numParticles = geometries.length;
        var sourceSubGeometries;
        var sourceSubGeometry;
        var numSubGeometries /*uint*/;
        var indices /*uint*/;
        var positions;
        var normals;
        var tangents;
        var uvs;
        var vertexCounter /*uint*/;
        var subGeometry;
        var i /*int*/;
        var j /*int*/;
        var sub2SubMap = new Array() /*int*/;
        var tempVertex = new Vector3D;
        var tempNormal = new Vector3D;
        var tempTangents = new Vector3D;
        var tempUV = new Point;
        for (i = 0; i < numParticles; i++) {
            sourceSubGeometries = geometries[i].subGeometries;
            numSubGeometries = sourceSubGeometries.length;
            for (var srcIndex = 0; srcIndex < numSubGeometries; srcIndex++) {
                //create a different particle subgeometry group for each source subgeometry in a particle.
                if (sub2SubMap.length <= srcIndex) {
                    sub2SubMap.push(subGeometries.length);
                    indicesVector.push(new Array());
                    positionsVector.push(new Array());
                    normalsVector.push(new Array());
                    tangentsVector.push(new Array());
                    uvsVector.push(new Array());
                    subGeometries.push(new TriangleSubGeometry(true));
                    vertexCounters.push(0);
                }
                sourceSubGeometry = sourceSubGeometries[srcIndex];
                //add a new particle subgeometry if this source subgeometry will take us over the maxvertex limit
                if (sourceSubGeometry.numVertices + vertexCounters[sub2SubMap[srcIndex]] > ParticleGeometryHelper.MAX_VERTEX) {
                    //update submap and add new subgeom vectors
                    sub2SubMap[srcIndex] = subGeometries.length;
                    indicesVector.push(new Array());
                    positionsVector.push(new Array());
                    normalsVector.push(new Array());
                    tangentsVector.push(new Array());
                    uvsVector.push(new Array());
                    subGeometries.push(new TriangleSubGeometry(true));
                    vertexCounters.push(0);
                }
                j = sub2SubMap[srcIndex];
                //select the correct vector
                indices = indicesVector[j];
                positions = positionsVector[j];
                normals = normalsVector[j];
                tangents = tangentsVector[j];
                uvs = uvsVector[j];
                vertexCounter = vertexCounters[j];
                subGeometry = subGeometries[j];
                var particleData = new ParticleData();
                particleData.numVertices = sourceSubGeometry.numVertices;
                particleData.startVertexIndex = vertexCounter;
                particleData.particleIndex = i;
                particleData.subGeometry = subGeometry;
                particles.push(particleData);
                vertexCounters[j] += sourceSubGeometry.numVertices;
                var k /*int*/;
                var tempLen /*int*/;
                var compact = sourceSubGeometry;
                var product /*uint*/;
                var sourcePositions;
                var sourceNormals;
                var sourceTangents;
                var sourceUVs;
                if (compact) {
                    tempLen = compact.numVertices;
                    compact.numTriangles;
                    sourcePositions = compact.positions;
                    sourceNormals = compact.vertexNormals;
                    sourceTangents = compact.vertexTangents;
                    sourceUVs = compact.uvs;
                    if (transforms) {
                        var particleGeometryTransform = transforms[i];
                        var vertexTransform = particleGeometryTransform.vertexTransform;
                        var invVertexTransform = particleGeometryTransform.invVertexTransform;
                        var UVTransform = particleGeometryTransform.UVTransform;
                        for (k = 0; k < tempLen; k++) {
                            /*
                             * 0 - 2: vertex position X, Y, Z
                             * 3 - 5: normal X, Y, Z
                             * 6 - 8: tangent X, Y, Z
                             * 9 - 10: U V
                             * 11 - 12: Secondary U V*/
                            product = k * 3;
                            tempVertex.x = sourcePositions[product];
                            tempVertex.y = sourcePositions[product + 1];
                            tempVertex.z = sourcePositions[product + 2];
                            tempNormal.x = sourceNormals[product];
                            tempNormal.y = sourceNormals[product + 1];
                            tempNormal.z = sourceNormals[product + 2];
                            tempTangents.x = sourceTangents[product];
                            tempTangents.y = sourceTangents[product + 1];
                            tempTangents.z = sourceTangents[product + 2];
                            tempUV.x = sourceUVs[k * 2];
                            tempUV.y = sourceUVs[k * 2 + 1];
                            if (vertexTransform) {
                                tempVertex = vertexTransform.transformVector(tempVertex);
                                tempNormal = invVertexTransform.deltaTransformVector(tempNormal);
                                tempTangents = invVertexTransform.deltaTransformVector(tempNormal);
                            }
                            if (UVTransform)
                                tempUV = UVTransform.transformPoint(tempUV);
                            //this is faster than that only push one data
                            sourcePositions.push(tempVertex.x, tempVertex.y, tempVertex.z);
                            sourceNormals.push(tempNormal.x, tempNormal.y, tempNormal.z);
                            sourceTangents.push(tempTangents.x, tempTangents.y, tempTangents.z);
                            sourceUVs.push(tempUV.x, tempUV.y);
                        }
                    }
                    else {
                        for (k = 0; k < tempLen; k++) {
                            product = k * 3;
                            //this is faster than that only push one data
                            positions.push(sourcePositions[product], sourcePositions[product + 1], sourcePositions[product + 2]);
                            normals.push(sourceNormals[product], sourceNormals[product + 1], sourceNormals[product + 2]);
                            tangents.push(sourceTangents[product], sourceTangents[product + 1], sourceTangents[product + 2]);
                            uvs.push(sourceUVs[k * 2], sourceUVs[k * 2 + 1]);
                        }
                    }
                }
                else {
                }
                var sourceIndices = sourceSubGeometry.indices;
                tempLen = sourceSubGeometry.numTriangles;
                for (k = 0; k < tempLen; k++) {
                    product = k * 3;
                    indices.push(sourceIndices[product] + vertexCounter, sourceIndices[product + 1] + vertexCounter, sourceIndices[product + 2] + vertexCounter);
                }
            }
        }
        var particleGeometry = new ParticleGeometry();
        particleGeometry.particles = particles;
        particleGeometry.numParticles = numParticles;
        numParticles = subGeometries.length;
        for (i = 0; i < numParticles; i++) {
            subGeometry = subGeometries[i];
            subGeometry.autoDeriveNormals = false;
            subGeometry.autoDeriveTangents = false;
            subGeometry.updateIndices(indicesVector[i]);
            subGeometry.updatePositions(positionsVector[i]);
            subGeometry.updateVertexNormals(normalsVector[i]);
            subGeometry.updateVertexTangents(tangentsVector[i]);
            subGeometry.updateUVs(uvsVector[i]);
            particleGeometry.addSubGeometry(subGeometry);
        }
        return particleGeometry;
    };
    ParticleGeometryHelper.MAX_VERTEX = 65535;
    return ParticleGeometryHelper;
})();
module.exports = ParticleGeometryHelper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi91dGlscy9QYXJ0aWNsZUdlb21ldHJ5SGVscGVyLnRzIl0sIm5hbWVzIjpbIlBhcnRpY2xlR2VvbWV0cnlIZWxwZXIiLCJQYXJ0aWNsZUdlb21ldHJ5SGVscGVyLmNvbnN0cnVjdG9yIiwiUGFydGljbGVHZW9tZXRyeUhlbHBlci5nZW5lcmF0ZUdlb21ldHJ5Il0sIm1hcHBpbmdzIjoiQUFFQSxJQUFPLEtBQUssV0FBaUIsNEJBQTRCLENBQUMsQ0FBQztBQUMzRCxJQUFPLFFBQVEsV0FBaUIsK0JBQStCLENBQUMsQ0FBQztBQUdqRSxJQUFPLG1CQUFtQixXQUFjLDZDQUE2QyxDQUFDLENBQUM7QUFJdkYsSUFBTyxZQUFZLFdBQWdCLG1EQUFtRCxDQUFDLENBQUM7QUFDeEYsSUFBTyxnQkFBZ0IsV0FBZSw2Q0FBNkMsQ0FBQyxDQUFDO0FBR3JGLEFBR0E7O0dBREc7SUFDRyxzQkFBc0I7SUFBNUJBLFNBQU1BLHNCQUFzQkE7SUF1TDVCQyxDQUFDQTtJQW5MY0QsdUNBQWdCQSxHQUE5QkEsVUFBK0JBLFVBQTBCQSxFQUFFQSxVQUFrREE7UUFBbERFLDBCQUFrREEsR0FBbERBLGlCQUFrREE7UUFFNUdBLElBQUlBLGFBQWFBLEdBQWlDQSxJQUFJQSxLQUFLQSxFQUFpQkEsQ0FBQ0EsUUFBREEsQUFBU0EsQ0FBQ0E7UUFDdEZBLElBQUlBLGVBQWVBLEdBQXdCQSxJQUFJQSxLQUFLQSxFQUFpQkEsQ0FBQ0E7UUFDdEVBLElBQUlBLGFBQWFBLEdBQXdCQSxJQUFJQSxLQUFLQSxFQUFpQkEsQ0FBQ0E7UUFDcEVBLElBQUlBLGNBQWNBLEdBQXdCQSxJQUFJQSxLQUFLQSxFQUFpQkEsQ0FBQ0E7UUFDckVBLElBQUlBLFNBQVNBLEdBQXdCQSxJQUFJQSxLQUFLQSxFQUFpQkEsQ0FBQ0E7UUFDaEVBLElBQUlBLGNBQWNBLEdBQTBCQSxJQUFJQSxLQUFLQSxFQUFVQSxDQUFDQSxRQUFEQSxBQUFTQSxDQUFDQTtRQUN6RUEsSUFBSUEs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QzdDQSxBQUNBQSw2Q0FENkNBOzRCQUM3Q0EsZUFBZUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7NEJBQy9EQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTs0QkFDN0RBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLEVBQUVBLFlBQVlBLENBQUNBLENBQUNBLEVBQUVBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBOzRCQUNwRUEsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7d0JBQ3BDQSxDQUFDQTtvQkFDRkEsQ0FBQ0E7b0JBQUNBLElBQUlBLENBQUNBLENBQUNBO3dCQUNQQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxPQUFPQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTs0QkFDOUJBLE9BQU9BLEdBQUdBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBOzRCQUNkQSxBQUNBQSw2Q0FENkNBOzRCQUM3Q0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFBRUEsZUFBZUEsQ0FBQ0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsZUFBZUEsQ0FBQ0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7NEJBQ3JHQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQSxFQUFFQSxhQUFhQSxDQUFDQSxPQUFPQSxHQUFHQSxDQUFDQSxDQUFDQSxF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QUFBREEsQ0F2TEEsQUF1TENBLElBQUE7QUFFRCxBQUFnQyxpQkFBdkIsc0JBQXNCLENBQUMiLCJmaWxlIjoidXRpbHMvUGFydGljbGVHZW9tZXRyeUhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4XHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXhcIik7XHJcbmltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBQb2ludFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vUG9pbnRcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcblxyXG5pbXBvcnQgR2VvbWV0cnlcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0dlb21ldHJ5XCIpO1xyXG5pbXBvcnQgVHJpYW5nbGVTdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvVHJpYW5nbGVTdWJHZW9tZXRyeVwiKTtcclxuaW1wb3J0IE1lc2hcdFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL01lc2hcIik7XHJcbmltcG9ydCBNYXRlcmlhbEJhc2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL01hdGVyaWFsQmFzZVwiKTtcclxuXHJcbmltcG9ydCBQYXJ0aWNsZURhdGFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVEYXRhXCIpO1xyXG5pbXBvcnQgUGFydGljbGVHZW9tZXRyeVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYmFzZS9QYXJ0aWNsZUdlb21ldHJ5XCIpO1xyXG5pbXBvcnQgUGFydGljbGVHZW9tZXRyeVRyYW5zZm9ybVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvdG9vbHMvZGF0YS9QYXJ0aWNsZUdlb21ldHJ5VHJhbnNmb3JtXCIpO1xyXG5cclxuLyoqXHJcbiAqIC4uLlxyXG4gKi9cclxuY2xhc3MgUGFydGljbGVHZW9tZXRyeUhlbHBlclxyXG57XHJcblx0cHVibGljIHN0YXRpYyBNQVhfVkVSVEVYOm51bWJlciAvKmludCovID0gNjU1MzU7XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgZ2VuZXJhdGVHZW9tZXRyeShnZW9tZXRyaWVzOkFycmF5PEdlb21ldHJ5PiwgdHJhbnNmb3JtczpBcnJheTxQYXJ0aWNsZUdlb21ldHJ5VHJhbnNmb3JtPiA9IG51bGwpOlBhcnRpY2xlR2VvbWV0cnlcclxuXHR7XHJcblx0XHR2YXIgaW5kaWNlc1ZlY3RvcjpBcnJheTxBcnJheTxudW1iZXI+PiAvKnVpbnQqLyA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpIC8qdWludCovO1xyXG5cdFx0dmFyIHBvc2l0aW9uc1ZlY3RvcjpBcnJheTxBcnJheTxudW1iZXI+PiA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpO1xyXG5cdFx0dmFyIG5vcm1hbHNWZWN0b3I6QXJyYXk8QXJyYXk8bnVtYmVyPj4gPSBuZXcgQXJyYXk8QXJyYXk8bnVtYmVyPj4oKTtcclxuXHRcdHZhciB0YW5nZW50c1ZlY3RvcjpBcnJheTxBcnJheTxudW1iZXI+PiA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpO1xyXG5cdFx0dmFyIHV2c1ZlY3RvcjpBcnJheTxBcnJheTxudW1iZXI+PiA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpO1xyXG5cdFx0dmFyIHZlcnRleENvdW50ZXJzOkFycmF5PG51bWJlcj4gLyp1aW50Ki8gPSBuZXcgQXJyYXk8bnVtYmVyPigpIC8qdWludCovO1xyXG5cdFx0dmFyIHBhcnRpY2xlczpBcnJheTxQYXJ0aWNsZURhdGE+ID0gbmV3IEFycmF5PFBhcnRpY2xlRGF0YT4oKTtcclxuXHRcdHZhciBzdWJHZW9tZXRyaWVzOkFycmF5PFRyaWFuZ2xlU3ViR2VvbWV0cnk+ID0gbmV3IEFycmF5PFRyaWFuZ2xlU3ViR2VvbWV0cnk+KCk7XHJcblx0XHR2YXIgbnVtUGFydGljbGVzOm51bWJlciAvKnVpbnQqLyA9IGdlb21ldHJpZXMubGVuZ3RoO1xyXG5cclxuXHRcdHZhciBzb3VyY2VTdWJHZW9tZXRyaWVzOkFycmF5PFRyaWFuZ2xlU3ViR2VvbWV0cnk+O1xyXG5cdFx0dmFyIHNvdXJjZVN1Ykdlb21ldHJ5OlRyaWFuZ2xlU3ViR2VvbWV0cnk7XHJcblx0XHR2YXIgbnVtU3ViR2VvbWV0cmllczpudW1iZXIgLyp1aW50Ki87XHJcblx0XHR2YXIgaW5kaWNlczpBcnJheTxudW1iZXI+IC8qdWludCovO1xyXG5cdFx0dmFyIHBvc2l0aW9uczpBcnJheTxudW1iZXI+O1xyXG5cdFx0dmFyIG5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcclxuXHRcdHZhciB0YW5nZW50czpBcnJheTxudW1iZXI+O1xyXG5cdFx0dmFyIHV2czpBcnJheTxudW1iZXI+O1xyXG5cdFx0dmFyIHZlcnRleENvdW50ZXI6bnVtYmVyIC8qdWludCovO1xyXG5cdFx0dmFyIHN1Ykdlb21ldHJ5OlRyaWFuZ2xlU3ViR2VvbWV0cnk7XHJcblx0XHR2YXIgaTpudW1iZXIgLyppbnQqLztcclxuXHRcdHZhciBqOm51bWJlciAvKmludCovO1xyXG5cdFx0dmFyIHN1YjJTdWJNYXA6QXJyYXk8bnVtYmVyPiAvKmludCovID0gbmV3IEFycmF5PG51bWJlcj4oKSAvKmludCovO1xyXG5cclxuXHRcdHZhciB0ZW1wVmVydGV4OlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEO1xyXG5cdFx0dmFyIHRlbXBOb3JtYWw6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0Q7XHJcblx0XHR2YXIgdGVtcFRhbmdlbnRzOlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEO1xyXG5cdFx0dmFyIHRlbXBVVjpQb2ludCA9IG5ldyBQb2ludDtcclxuXHJcblx0XHRmb3IgKGkgPSAwOyBpIDwgbnVtUGFydGljbGVzOyBpKyspIHtcclxuXHRcdFx0c291cmNlU3ViR2VvbWV0cmllcyA9IDxBcnJheTxUcmlhbmdsZVN1Ykdlb21ldHJ5Pj4gZ2VvbWV0cmllc1tpXS5zdWJHZW9tZXRyaWVzO1xyXG5cdFx0XHRudW1TdWJHZW9tZXRyaWVzID0gc291cmNlU3ViR2VvbWV0cmllcy5sZW5ndGg7XHJcblx0XHRcdGZvciAodmFyIHNyY0luZGV4Om51bWJlciAvKmludCovID0gMDsgc3JjSW5kZXggPCBudW1TdWJHZW9tZXRyaWVzOyBzcmNJbmRleCsrKSB7XHJcblx0XHRcdFx0Ly9jcmVhdGUgYSBkaWZmZXJlbnQgcGFydGljbGUgc3ViZ2VvbWV0cnkgZ3JvdXAgZm9yIGVhY2ggc291cmNlIHN1Ymdlb21ldHJ5IGluIGEgcGFydGljbGUuXHJcblx0XHRcdFx0aWYgKHN1YjJTdWJNYXAubGVuZ3RoIDw9IHNyY0luZGV4KSB7XHJcblx0XHRcdFx0XHRzdWIyU3ViTWFwLnB1c2goc3ViR2VvbWV0cmllcy5sZW5ndGgpO1xyXG5cdFx0XHRcdFx0aW5kaWNlc1ZlY3Rvci5wdXNoKG5ldyBBcnJheTxudW1iZXI+KCkgLyp1aW50Ki8pO1xyXG5cdFx0XHRcdFx0cG9zaXRpb25zVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSk7XHJcblx0XHRcdFx0XHRub3JtYWxzVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSk7XHJcblx0XHRcdFx0XHR0YW5nZW50c1ZlY3Rvci5wdXNoKG5ldyBBcnJheTxudW1iZXI+KCkpO1xyXG5cdFx0XHRcdFx0dXZzVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSk7XHJcblx0XHRcdFx0XHRzdWJHZW9tZXRyaWVzLnB1c2gobmV3IFRyaWFuZ2xlU3ViR2VvbWV0cnkodHJ1ZSkpO1xyXG5cdFx0XHRcdFx0dmVydGV4Q291bnRlcnMucHVzaCgwKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHNvdXJjZVN1Ykdlb21ldHJ5ID0gc291cmNlU3ViR2VvbWV0cmllc1tzcmNJbmRleF07XHJcblxyXG5cdFx0XHRcdC8vYWRkIGEgbmV3IHBhcnRpY2xlIHN1Ymdlb21ldHJ5IGlmIHRoaXMgc291cmNlIHN1Ymdlb21ldHJ5IHdpbGwgdGFrZSB1cyBvdmVyIHRoZSBtYXh2ZXJ0ZXggbGltaXRcclxuXHRcdFx0XHRpZiAoc291cmNlU3ViR2VvbWV0cnkubnVtVmVydGljZXMgKyB2ZXJ0ZXhDb3VudGVyc1tzdWIyU3ViTWFwW3NyY0luZGV4XV0gPiBQYXJ0aWNsZUdlb21ldHJ5SGVscGVyLk1BWF9WRVJURVgpIHtcclxuXHRcdFx0XHRcdC8vdXBkYXRlIHN1Ym1hcCBhbmQgYWRkIG5ldyBzdWJnZW9tIHZlY3RvcnNcclxuXHRcdFx0XHRcdHN1YjJTdWJNYXBbc3JjSW5kZXhdID0gc3ViR2VvbWV0cmllcy5sZW5ndGg7XHJcblx0XHRcdFx0XHRpbmRpY2VzVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSAvKnVpbnQqLyk7XHJcblx0XHRcdFx0XHRwb3NpdGlvbnNWZWN0b3IucHVzaChuZXcgQXJyYXk8bnVtYmVyPigpKTtcclxuXHRcdFx0XHRcdG5vcm1hbHNWZWN0b3IucHVzaChuZXcgQXJyYXk8bnVtYmVyPigpKTtcclxuXHRcdFx0XHRcdHRhbmdlbnRzVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSk7XHJcblx0XHRcdFx0XHR1dnNWZWN0b3IucHVzaChuZXcgQXJyYXk8bnVtYmVyPigpKTtcclxuXHRcdFx0XHRcdHN1Ykdlb21ldHJpZXMucHVzaChuZXcgVHJpYW5nbGVTdWJHZW9tZXRyeSh0cnVlKSk7XHJcblx0XHRcdFx0XHR2ZXJ0ZXhDb3VudGVycy5wdXNoKDApO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aiA9IHN1YjJTdWJNYXBbc3JjSW5kZXhdO1xyXG5cclxuXHRcdFx0XHQvL3NlbGVjdCB0aGUgY29ycmVjdCB2ZWN0b3JcclxuXHRcdFx0XHRpbmRpY2VzID0gaW5kaWNlc1ZlY3RvcltqXTtcclxuXHRcdFx0XHRwb3NpdGlvbnMgPSBwb3NpdGlvbnNWZWN0b3Jbal07XHJcblx0XHRcdFx0bm9ybWFscyA9IG5vcm1hbHNWZWN0b3Jbal07XHJcblx0XHRcdFx0dGFuZ2VudHMgPSB0YW5nZW50c1ZlY3RvcltqXTtcclxuXHRcdFx0XHR1dnMgPSB1dnNWZWN0b3Jbal07XHJcblx0XHRcdFx0dmVydGV4Q291bnRlciA9IHZlcnRleENvdW50ZXJzW2pdO1xyXG5cdFx0XHRcdHN1Ykdlb21ldHJ5ID0gc3ViR2VvbWV0cmllc1tqXTtcclxuXHJcblx0XHRcdFx0dmFyIHBhcnRpY2xlRGF0YTpQYXJ0aWNsZURhdGEgPSBuZXcgUGFydGljbGVEYXRhKCk7XHJcblx0XHRcdFx0cGFydGljbGVEYXRhLm51bVZlcnRpY2VzID0gc291cmNlU3ViR2VvbWV0cnkubnVtVmVydGljZXM7XHJcblx0XHRcdFx0cGFydGljbGVEYXRhLnN0YXJ0VmVydGV4SW5kZXggPSB2ZXJ0ZXhDb3VudGVyO1xyXG5cdFx0XHRcdHBhcnRpY2xlRGF0YS5wYXJ0aWNsZUluZGV4ID0gaTtcclxuXHRcdFx0XHRwYXJ0aWNsZURhdGEuc3ViR2VvbWV0cnkgPSBzdWJHZW9tZXRyeTtcclxuXHRcdFx0XHRwYXJ0aWNsZXMucHVzaChwYXJ0aWNsZURhdGEpO1xyXG5cclxuXHRcdFx0XHR2ZXJ0ZXhDb3VudGVyc1tqXSArPSBzb3VyY2VTdWJHZW9tZXRyeS5udW1WZXJ0aWNlcztcclxuXHJcblx0XHRcdFx0dmFyIGs6bnVtYmVyIC8qaW50Ki87XHJcblx0XHRcdFx0dmFyIHRlbXBMZW46bnVtYmVyIC8qaW50Ki87XHJcblx0XHRcdFx0dmFyIGNvbXBhY3Q6VHJpYW5nbGVTdWJHZW9tZXRyeSA9IHNvdXJjZVN1Ykdlb21ldHJ5O1xyXG5cdFx0XHRcdHZhciBwcm9kdWN0Om51bWJlciAvKnVpbnQqLztcclxuXHRcdFx0XHR2YXIgc291cmNlUG9zaXRpb25zOkFycmF5PG51bWJlcj47XHJcblx0XHRcdFx0dmFyIHNvdXJjZU5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcclxuXHRcdFx0XHR2YXIgc291cmNlVGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcclxuXHRcdFx0XHR2YXIgc291cmNlVVZzOkFycmF5PG51bWJlcj47XHJcblxyXG5cdFx0XHRcdGlmIChjb21wYWN0KSB7XHJcblx0XHRcdFx0XHR0ZW1wTGVuID0gY29tcGFjdC5udW1WZXJ0aWNlcztcclxuXHRcdFx0XHRcdGNvbXBhY3QubnVtVHJpYW5nbGVzO1xyXG5cdFx0XHRcdFx0c291cmNlUG9zaXRpb25zID0gY29tcGFjdC5wb3NpdGlvbnM7XHJcblx0XHRcdFx0XHRzb3VyY2VOb3JtYWxzID0gY29tcGFjdC52ZXJ0ZXhOb3JtYWxzO1xyXG5cdFx0XHRcdFx0c291cmNlVGFuZ2VudHMgPSBjb21wYWN0LnZlcnRleFRhbmdlbnRzO1xyXG5cdFx0XHRcdFx0c291cmNlVVZzID0gY29tcGFjdC51dnM7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHRyYW5zZm9ybXMpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHBhcnRpY2xlR2VvbWV0cnlUcmFuc2Zvcm06UGFydGljbGVHZW9tZXRyeVRyYW5zZm9ybSA9IHRyYW5zZm9ybXNbaV07XHJcblx0XHRcdFx0XHRcdHZhciB2ZXJ0ZXhUcmFuc2Zvcm06TWF0cml4M0QgPSBwYXJ0aWNsZUdlb21ldHJ5VHJhbnNmb3JtLnZlcnRleFRyYW5zZm9ybTtcclxuXHRcdFx0XHRcdFx0dmFyIGludlZlcnRleFRyYW5zZm9ybTpNYXRyaXgzRCA9IHBhcnRpY2xlR2VvbWV0cnlUcmFuc2Zvcm0uaW52VmVydGV4VHJhbnNmb3JtO1xyXG5cdFx0XHRcdFx0XHR2YXIgVVZUcmFuc2Zvcm06TWF0cml4ID0gcGFydGljbGVHZW9tZXRyeVRyYW5zZm9ybS5VVlRyYW5zZm9ybTtcclxuXHJcblx0XHRcdFx0XHRcdGZvciAoayA9IDA7IGsgPCB0ZW1wTGVuOyBrKyspIHtcclxuXHRcdFx0XHRcdFx0XHQvKlxyXG5cdFx0XHRcdFx0XHRcdCAqIDAgLSAyOiB2ZXJ0ZXggcG9zaXRpb24gWCwgWSwgWlxyXG5cdFx0XHRcdFx0XHRcdCAqIDMgLSA1OiBub3JtYWwgWCwgWSwgWlxyXG5cdFx0XHRcdFx0XHRcdCAqIDYgLSA4OiB0YW5nZW50IFgsIFksIFpcclxuXHRcdFx0XHRcdFx0XHQgKiA5IC0gMTA6IFUgVlxyXG5cdFx0XHRcdFx0XHRcdCAqIDExIC0gMTI6IFNlY29uZGFyeSBVIFYqL1xyXG5cdFx0XHRcdFx0XHRcdHByb2R1Y3QgPSBrKjM7XHJcblx0XHRcdFx0XHRcdFx0dGVtcFZlcnRleC54ID0gc291cmNlUG9zaXRpb25zW3Byb2R1Y3RdO1xyXG5cdFx0XHRcdFx0XHRcdHRlbXBWZXJ0ZXgueSA9IHNvdXJjZVBvc2l0aW9uc1twcm9kdWN0ICsgMV07XHJcblx0XHRcdFx0XHRcdFx0dGVtcFZlcnRleC56ID0gc291cmNlUG9zaXRpb25zW3Byb2R1Y3QgKyAyXTtcclxuXHRcdFx0XHRcdFx0XHR0ZW1wTm9ybWFsLnggPSBzb3VyY2VOb3JtYWxzW3Byb2R1Y3RdO1xyXG5cdFx0XHRcdFx0XHRcdHRlbXBOb3JtYWwueSA9IHNvdXJjZU5vcm1hbHNbcHJvZHVjdCArIDFdO1xyXG5cdFx0XHRcdFx0XHRcdHRlbXBOb3JtYWwueiA9IHNvdXJjZU5vcm1hbHNbcHJvZHVjdCArIDJdO1xyXG5cdFx0XHRcdFx0XHRcdHRlbXBUYW5nZW50cy54ID0gc291cmNlVGFuZ2VudHNbcHJvZHVjdF07XHJcblx0XHRcdFx0XHRcdFx0dGVtcFRhbmdlbnRzLnkgPSBzb3VyY2VUYW5nZW50c1twcm9kdWN0ICsgMV07XHJcblx0XHRcdFx0XHRcdFx0dGVtcFRhbmdlbnRzLnogPSBzb3VyY2VUYW5nZW50c1twcm9kdWN0ICsgMl07XHJcblx0XHRcdFx0XHRcdFx0dGVtcFVWLnggPSBzb3VyY2VVVnNbayoyXTtcclxuXHRcdFx0XHRcdFx0XHR0ZW1wVVYueSA9IHNvdXJjZVVWc1trKjIgKyAxXTtcclxuXHRcdFx0XHRcdFx0XHRpZiAodmVydGV4VHJhbnNmb3JtKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0ZW1wVmVydGV4ID0gdmVydGV4VHJhbnNmb3JtLnRyYW5zZm9ybVZlY3Rvcih0ZW1wVmVydGV4KTtcclxuXHRcdFx0XHRcdFx0XHRcdHRlbXBOb3JtYWwgPSBpbnZWZXJ0ZXhUcmFuc2Zvcm0uZGVsdGFUcmFuc2Zvcm1WZWN0b3IodGVtcE5vcm1hbCk7XHJcblx0XHRcdFx0XHRcdFx0XHR0ZW1wVGFuZ2VudHMgPSBpbnZWZXJ0ZXhUcmFuc2Zvcm0uZGVsdGFUcmFuc2Zvcm1WZWN0b3IodGVtcE5vcm1hbCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGlmIChVVlRyYW5zZm9ybSlcclxuXHRcdFx0XHRcdFx0XHRcdHRlbXBVViA9IFVWVHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50KHRlbXBVVik7XHJcblx0XHRcdFx0XHRcdFx0Ly90aGlzIGlzIGZhc3RlciB0aGFuIHRoYXQgb25seSBwdXNoIG9uZSBkYXRhXHJcblx0XHRcdFx0XHRcdFx0c291cmNlUG9zaXRpb25zLnB1c2godGVtcFZlcnRleC54LCB0ZW1wVmVydGV4LnksIHRlbXBWZXJ0ZXgueik7XHJcblx0XHRcdFx0XHRcdFx0c291cmNlTm9ybWFscy5wdXNoKHRlbXBOb3JtYWwueCwgdGVtcE5vcm1hbC55LCB0ZW1wTm9ybWFsLnopO1xyXG5cdFx0XHRcdFx0XHRcdHNvdXJjZVRhbmdlbnRzLnB1c2godGVtcFRhbmdlbnRzLngsIHRlbXBUYW5nZW50cy55LCB0ZW1wVGFuZ2VudHMueik7XHJcblx0XHRcdFx0XHRcdFx0c291cmNlVVZzLnB1c2godGVtcFVWLngsIHRlbXBVVi55KTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0Zm9yIChrID0gMDsgayA8IHRlbXBMZW47IGsrKykge1xyXG5cdFx0XHRcdFx0XHRcdHByb2R1Y3QgPSBrKjM7XHJcblx0XHRcdFx0XHRcdFx0Ly90aGlzIGlzIGZhc3RlciB0aGFuIHRoYXQgb25seSBwdXNoIG9uZSBkYXRhXHJcblx0XHRcdFx0XHRcdFx0cG9zaXRpb25zLnB1c2goc291cmNlUG9zaXRpb25zW3Byb2R1Y3RdLCBzb3VyY2VQb3NpdGlvbnNbcHJvZHVjdCArIDFdLCBzb3VyY2VQb3NpdGlvbnNbcHJvZHVjdCArIDJdKTtcclxuXHRcdFx0XHRcdFx0XHRub3JtYWxzLnB1c2goc291cmNlTm9ybWFsc1twcm9kdWN0XSwgc291cmNlTm9ybWFsc1twcm9kdWN0ICsgMV0sIHNvdXJjZU5vcm1hbHNbcHJvZHVjdCArIDJdKTtcclxuXHRcdFx0XHRcdFx0XHR0YW5nZW50cy5wdXNoKHNvdXJjZVRhbmdlbnRzW3Byb2R1Y3RdLCBzb3VyY2VUYW5nZW50c1twcm9kdWN0ICsgMV0sIHNvdXJjZVRhbmdlbnRzW3Byb2R1Y3QgKyAyXSk7XHJcblx0XHRcdFx0XHRcdFx0dXZzLnB1c2goc291cmNlVVZzW2sqMl0sIHNvdXJjZVVWc1trKjIgKyAxXSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Ly9Ub2RvXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR2YXIgc291cmNlSW5kaWNlczpBcnJheTxudW1iZXI+IC8qdWludCovID0gc291cmNlU3ViR2VvbWV0cnkuaW5kaWNlcztcclxuXHRcdFx0XHR0ZW1wTGVuID0gc291cmNlU3ViR2VvbWV0cnkubnVtVHJpYW5nbGVzO1xyXG5cdFx0XHRcdGZvciAoayA9IDA7IGsgPCB0ZW1wTGVuOyBrKyspIHtcclxuXHRcdFx0XHRcdHByb2R1Y3QgPSBrKjM7XHJcblx0XHRcdFx0XHRpbmRpY2VzLnB1c2goc291cmNlSW5kaWNlc1twcm9kdWN0XSArIHZlcnRleENvdW50ZXIsIHNvdXJjZUluZGljZXNbcHJvZHVjdCArIDFdICsgdmVydGV4Q291bnRlciwgc291cmNlSW5kaWNlc1twcm9kdWN0ICsgMl0gKyB2ZXJ0ZXhDb3VudGVyKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcGFydGljbGVHZW9tZXRyeTpQYXJ0aWNsZUdlb21ldHJ5ID0gbmV3IFBhcnRpY2xlR2VvbWV0cnkoKTtcclxuXHRcdHBhcnRpY2xlR2VvbWV0cnkucGFydGljbGVzID0gcGFydGljbGVzO1xyXG5cdFx0cGFydGljbGVHZW9tZXRyeS5udW1QYXJ0aWNsZXMgPSBudW1QYXJ0aWNsZXM7XHJcblxyXG5cdFx0bnVtUGFydGljbGVzID0gc3ViR2VvbWV0cmllcy5sZW5ndGg7XHJcblx0XHRmb3IgKGkgPSAwOyBpIDwgbnVtUGFydGljbGVzOyBpKyspIHtcclxuXHRcdFx0c3ViR2VvbWV0cnkgPSBzdWJHZW9tZXRyaWVzW2ldO1xyXG5cdFx0XHRzdWJHZW9tZXRyeS5hdXRvRGVyaXZlTm9ybWFscyA9IGZhbHNlO1xyXG5cdFx0XHRzdWJHZW9tZXRyeS5hdXRvRGVyaXZlVGFuZ2VudHMgPSBmYWxzZTtcclxuXHRcdFx0c3ViR2VvbWV0cnkudXBkYXRlSW5kaWNlcyhpbmRpY2VzVmVjdG9yW2ldKTtcclxuXHRcdFx0c3ViR2VvbWV0cnkudXBkYXRlUG9zaXRpb25zKHBvc2l0aW9uc1ZlY3RvcltpXSk7XHJcblx0XHRcdHN1Ykdlb21ldHJ5LnVwZGF0ZVZlcnRleE5vcm1hbHMobm9ybWFsc1ZlY3RvcltpXSk7XHJcblx0XHRcdHN1Ykdlb21ldHJ5LnVwZGF0ZVZlcnRleFRhbmdlbnRzKHRhbmdlbnRzVmVjdG9yW2ldKTtcclxuXHRcdFx0c3ViR2VvbWV0cnkudXBkYXRlVVZzKHV2c1ZlY3RvcltpXSk7XHJcblx0XHRcdHBhcnRpY2xlR2VvbWV0cnkuYWRkU3ViR2VvbWV0cnkoc3ViR2VvbWV0cnkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBwYXJ0aWNsZUdlb21ldHJ5O1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gUGFydGljbGVHZW9tZXRyeUhlbHBlcjsiXX0=