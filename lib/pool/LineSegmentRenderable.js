var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var LineSubGeometry = require("awayjs-display/lib/base/LineSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var RenderableBase = require("awayjs-renderergl/lib/pool/RenderableBase");
/**
 * @class away.pool.LineSubMeshRenderable
 */
var LineSegmentRenderable = (function (_super) {
    __extends(LineSegmentRenderable, _super);
    /**
     * //TODO
     *
     * @param pool
     * @param subMesh
     * @param level
     * @param dataOffset
     */
    function LineSegmentRenderable(pool, lineSegment, stage, level, indexOffset) {
        if (level === void 0) { level = 0; }
        if (indexOffset === void 0) { indexOffset = 0; }
        _super.call(this, pool, lineSegment, lineSegment, lineSegment.material, stage, level, indexOffset);
        this._constants = new Array(0, 0, 0, 0);
        this._thickness = 1.25;
        this._lineSegment = lineSegment;
        this._calcMatrix = new Matrix3D();
        this._constants[1] = 1 / 255;
    }
    /**
     * //TODO
     *
     * @returns {base.LineSubGeometry}
     * @protected
     */
    LineSegmentRenderable.prototype._pGetSubGeometry = function () {
        var geometry = LineSegmentRenderable._lineGeometry[this._lineSegment.id] || (LineSegmentRenderable._lineGeometry[this._lineSegment.id] = new LineSubGeometry());
        this._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;
        var start = this._lineSegment.startPostion;
        var end = this._lineSegment.endPosition;
        var startPositions;
        var endPositions;
        var thickness;
        if (geometry.indices != null) {
            startPositions = geometry.startPositions;
            endPositions = geometry.endPositions;
            thickness = geometry.thickness;
        }
        else {
            startPositions = new Array(3);
            endPositions = new Array(3);
            thickness = new Array(1);
        }
        startPositions[0] = start.x;
        startPositions[1] = start.y;
        startPositions[2] = start.z;
        endPositions[0] = end.x;
        endPositions[1] = end.y;
        endPositions[2] = end.z;
        thickness[0] = this._lineSegment.thickness;
        geometry.updatePositions(startPositions, endPositions);
        geometry.updateThickness(thickness);
        return geometry;
    };
    LineSegmentRenderable._iIncludeDependencies = function (shaderObject) {
        shaderObject.colorDependencies++;
    };
    /**
     * @inheritDoc
     */
    LineSegmentRenderable._iGetVertexCode = function (shader, regCache, sharedReg) {
        return "m44 vt0, va0, vc8			\n" + "m44 vt1, va1, vc8			\n" + "sub vt2, vt1, vt0 			\n" + "slt vt5.x, vt0.z, vc7.z			\n" + "sub vt5.y, vc5.x, vt5.x			\n" + "add vt4.x, vt0.z, vc7.z			\n" + "sub vt4.y, vt0.z, vt1.z			\n" + "seq vt4.z, vt4.y vc6.x			\n" + "add vt4.y, vt4.y, vt4.z			\n" + "div vt4.z, vt4.x, vt4.y			\n" + "mul vt4.xyz, vt4.zzz, vt2.xyz	\n" + "add vt3.xyz, vt0.xyz, vt4.xyz	\n" + "mov vt3.w, vc5.x			\n" + "mul vt0, vt0, vt5.yyyy			\n" + "mul vt3, vt3, vt5.xxxx			\n" + "add vt0, vt0, vt3				\n" + "sub vt2, vt1, vt0 			\n" + "nrm vt2.xyz, vt2.xyz			\n" + "nrm vt5.xyz, vt0.xyz			\n" + "mov vt5.w, vc5.x				\n" + "crs vt3.xyz, vt2, vt5			\n" + "nrm vt3.xyz, vt3.xyz			\n" + "mul vt3.xyz, vt3.xyz, va2.xxx	\n" + "mov vt3.w, vc5.x			\n" + "dp3 vt4.x, vt0, vc6			\n" + "mul vt4.x, vt4.x, vc7.x			\n" + "mul vt3.xyz, vt3.xyz, vt4.xxx	\n" + "add vt0.xyz, vt0.xyz, vt3.xyz	\n" + "m44 op, vt0, vc0			\n"; // transform Q0 to clip space
    };
    /**
     * @inheritDoc
     */
    LineSegmentRenderable.prototype._iActivate = function (pass, camera) {
        _super.prototype._iActivate.call(this, pass, camera);
        this._constants[0] = this._thickness / ((this._stage.scissorRect) ? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));
        // value to convert distance from camera to model length per pixel width
        this._constants[2] = camera.projection.near;
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSegmentRenderable.pONE_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSegmentRenderable.pFRONT_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);
        // projection matrix
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);
    };
    /**
     * @inheritDoc
     */
    LineSegmentRenderable.prototype._iRender = function (pass, camera, viewProjection) {
        _super.prototype._iRender.call(this, pass, camera, viewProjection);
        var context = this._stage.context;
        this._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);
        this._calcMatrix.append(camera.inverseSceneTransform);
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);
        this._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);
        context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);
    };
    /**
     * //TODO
     *
     * @param pool
     * @param renderableOwner
     * @param level
     * @param indexOffset
     * @returns {away.pool.LineSubMeshRenderable}
     * @private
     */
    LineSegmentRenderable.prototype._pGetOverflowRenderable = function (indexOffset) {
        return new LineSegmentRenderable(this._pool, this.renderableOwner, this._stage, this._level + 1, indexOffset);
    };
    LineSegmentRenderable._lineGeometry = new Object();
    LineSegmentRenderable.pONE_VECTOR = Array(1, 1, 1, 1);
    LineSegmentRenderable.pFRONT_VECTOR = Array(0, 0, -1, 0);
    /**
     *
     */
    LineSegmentRenderable.id = "linesegment";
    LineSegmentRenderable.vertexAttributesOffset = 3;
    return LineSegmentRenderable;
})(RenderableBase);
module.exports = LineSegmentRenderable;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0xpbmVTZWdtZW50UmVuZGVyYWJsZS50cyJdLCJuYW1lcyI6WyJMaW5lU2VnbWVudFJlbmRlcmFibGUiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuY29uc3RydWN0b3IiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX3BHZXRTdWJHZW9tZXRyeSIsIkxpbmVTZWdtZW50UmVuZGVyYWJsZS5faUluY2x1ZGVEZXBlbmRlbmNpZXMiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX2lHZXRWZXJ0ZXhDb2RlIiwiTGluZVNlZ21lbnRSZW5kZXJhYmxlLl9pQWN0aXZhdGUiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX2lSZW5kZXIiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX3BHZXRPdmVyZmxvd1JlbmRlcmFibGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBSWhFLElBQU8sZUFBZSxXQUFjLHlDQUF5QyxDQUFDLENBQUM7QUFPL0UsSUFBTyxvQkFBb0IsV0FBYSw4Q0FBOEMsQ0FBQyxDQUFDO0FBT3hGLElBQU8sY0FBYyxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFJaEYsQUFHQTs7R0FERztJQUNHLHFCQUFxQjtJQUFTQSxVQUE5QkEscUJBQXFCQSxVQUF1QkE7SUF1QmpEQTs7Ozs7OztPQU9HQTtJQUNIQSxTQS9CS0EscUJBQXFCQSxDQStCZEEsSUFBdUJBLEVBQUVBLFdBQXVCQSxFQUFFQSxLQUFXQSxFQUFFQSxLQUFnQkEsRUFBRUEsV0FBc0JBO1FBQXhDQyxxQkFBZ0JBLEdBQWhCQSxTQUFnQkE7UUFBRUEsMkJBQXNCQSxHQUF0QkEsZUFBc0JBO1FBRWxIQSxrQkFBTUEsSUFBSUEsRUFBRUEsV0FBV0EsRUFBRUEsV0FBV0EsRUFBRUEsV0FBV0EsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7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Q0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLG1DQUFhQSxHQUFpQkEsS0FBS0EsQ0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFNdkVBOztPQUVHQTtJQUNXQSx3QkFBRUEsR0FBVUEsYUFBYUEsQ0FBQ0E7SUFFMUJBLDRDQUFzQkEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7SUFvTWpEQSw0QkFBQ0E7QUFBREEsQ0FwTkEsQUFvTkNBLEVBcE5tQyxjQUFjLEVBb05qRDtBQUVELEFBQStCLGlCQUF0QixxQkFBcUIsQ0FBQyIsImZpbGUiOiJwb29sL0xpbmVTZWdtZW50UmVuZGVyYWJsZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcclxuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XHJcblxyXG5pbXBvcnQgSVJlbmRlcmFibGVPd25lclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVJlbmRlcmFibGVPd25lclwiKTtcclxuaW1wb3J0IExpbmVTdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGluZVN1Ykdlb21ldHJ5XCIpO1xyXG5pbXBvcnQgU3ViR2VvbWV0cnlFdmVudFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2V2ZW50cy9TdWJHZW9tZXRyeUV2ZW50XCIpO1xyXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuaW1wb3J0IExpbmVTZWdtZW50XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9MaW5lU2VnbWVudFwiKTtcclxuaW1wb3J0IERlZmF1bHRNYXRlcmlhbE1hbmFnZXJcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hbmFnZXJzL0RlZmF1bHRNYXRlcmlhbE1hbmFnZXJcIik7XHJcblxyXG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xyXG5pbXBvcnQgQ29udGV4dEdMUHJvZ3JhbVR5cGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xQcm9ncmFtVHlwZVwiKTtcclxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcblxyXG5pbXBvcnQgU2hhZGVyT2JqZWN0QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJFbGVtZW50XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckVsZW1lbnRcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlUG9vbEJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlUG9vbEJhc2VcIik7XHJcbmltcG9ydCBSZW5kZXJQYXNzQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bhc3Nlcy9SZW5kZXJQYXNzQmFzZVwiKTtcclxuXHJcbi8qKlxyXG4gKiBAY2xhc3MgYXdheS5wb29sLkxpbmVTdWJNZXNoUmVuZGVyYWJsZVxyXG4gKi9cclxuY2xhc3MgTGluZVNlZ21lbnRSZW5kZXJhYmxlIGV4dGVuZHMgUmVuZGVyYWJsZUJhc2Vcclxue1xyXG5cdHByaXZhdGUgc3RhdGljIF9saW5lR2VvbWV0cnk6T2JqZWN0ID0gbmV3IE9iamVjdCgpO1xyXG5cclxuXHRwdWJsaWMgc3RhdGljIHBPTkVfVkVDVE9SOkFycmF5PG51bWJlcj4gPSBBcnJheTxudW1iZXI+KDEsIDEsIDEsIDEpO1xyXG5cdHB1YmxpYyBzdGF0aWMgcEZST05UX1ZFQ1RPUjpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigwLCAwLCAtMSwgMCk7XHJcblxyXG5cdHByaXZhdGUgX2NvbnN0YW50czpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oMCwgMCwgMCwgMCk7XHJcblx0cHJpdmF0ZSBfY2FsY01hdHJpeDpNYXRyaXgzRDtcclxuXHRwcml2YXRlIF90aGlja25lc3M6bnVtYmVyID0gMS4yNTtcclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgc3RhdGljIGlkOnN0cmluZyA9IFwibGluZXNlZ21lbnRcIjtcclxuXHJcblx0cHVibGljIHN0YXRpYyB2ZXJ0ZXhBdHRyaWJ1dGVzT2Zmc2V0Om51bWJlciA9IDM7XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHJpdmF0ZSBfbGluZVNlZ21lbnQ6TGluZVNlZ21lbnQ7XHJcblxyXG5cdC8qKlxyXG5cdCAqIC8vVE9ET1xyXG5cdCAqXHJcblx0ICogQHBhcmFtIHBvb2xcclxuXHQgKiBAcGFyYW0gc3ViTWVzaFxyXG5cdCAqIEBwYXJhbSBsZXZlbFxyXG5cdCAqIEBwYXJhbSBkYXRhT2Zmc2V0XHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IocG9vbDpSZW5kZXJhYmxlUG9vbEJhc2UsIGxpbmVTZWdtZW50OkxpbmVTZWdtZW50LCBzdGFnZTpTdGFnZSwgbGV2ZWw6bnVtYmVyID0gMCwgaW5kZXhPZmZzZXQ6bnVtYmVyID0gMClcclxuXHR7XHJcblx0XHRzdXBlcihwb29sLCBsaW5lU2VnbWVudCwgbGluZVNlZ21lbnQsIGxpbmVTZWdtZW50Lm1hdGVyaWFsLCBzdGFnZSwgbGV2ZWwsIGluZGV4T2Zmc2V0KTtcclxuXHJcblx0XHR0aGlzLl9saW5lU2VnbWVudCA9IGxpbmVTZWdtZW50O1xyXG5cclxuXHRcdHRoaXMuX2NhbGNNYXRyaXggPSBuZXcgTWF0cml4M0QoKTtcclxuXHJcblx0XHR0aGlzLl9jb25zdGFudHNbMV0gPSAxLzI1NTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIC8vVE9ET1xyXG5cdCAqXHJcblx0ICogQHJldHVybnMge2Jhc2UuTGluZVN1Ykdlb21ldHJ5fVxyXG5cdCAqIEBwcm90ZWN0ZWRcclxuXHQgKi9cclxuXHRwdWJsaWMgX3BHZXRTdWJHZW9tZXRyeSgpOkxpbmVTdWJHZW9tZXRyeVxyXG5cdHtcclxuXHRcdHZhciBnZW9tZXRyeTpMaW5lU3ViR2VvbWV0cnkgPSBMaW5lU2VnbWVudFJlbmRlcmFibGUuX2xpbmVHZW9tZXRyeVt0aGlzLl9saW5lU2VnbWVudC5pZF0gfHwgKExpbmVTZWdtZW50UmVuZGVyYWJsZS5fbGluZUdlb21ldHJ5W3RoaXMuX2xpbmVTZWdtZW50LmlkXSA9IG5ldyBMaW5lU3ViR2VvbWV0cnkoKSk7XHJcblxyXG5cdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuU1RBUlRfUE9TSVRJT05fREFUQV0gPSB0cnVlO1xyXG5cdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEFdID0gdHJ1ZTtcclxuXHRcdHRoaXMuX3BWZXJ0ZXhEYXRhRGlydHlbTGluZVN1Ykdlb21ldHJ5LlRISUNLTkVTU19EQVRBXSA9IHRydWU7XHJcblx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0xpbmVTdWJHZW9tZXRyeS5DT0xPUl9EQVRBXSA9IHRydWU7XHJcblxyXG5cdFx0dmFyIHN0YXJ0OlZlY3RvcjNEID0gdGhpcy5fbGluZVNlZ21lbnQuc3RhcnRQb3N0aW9uO1xyXG5cdFx0dmFyIGVuZDpWZWN0b3IzRCA9IHRoaXMuX2xpbmVTZWdtZW50LmVuZFBvc2l0aW9uO1xyXG5cclxuXHRcdHZhciBzdGFydFBvc2l0aW9uczpBcnJheTxudW1iZXI+O1xyXG5cdFx0dmFyIGVuZFBvc2l0aW9uczpBcnJheTxudW1iZXI+O1xyXG5cdFx0dmFyIHRoaWNrbmVzczpBcnJheTxudW1iZXI+O1xyXG5cclxuXHRcdGlmIChnZW9tZXRyeS5pbmRpY2VzICE9IG51bGwpIHtcclxuXHRcdFx0c3RhcnRQb3NpdGlvbnMgPSBnZW9tZXRyeS5zdGFydFBvc2l0aW9ucztcclxuXHRcdFx0ZW5kUG9zaXRpb25zID0gZ2VvbWV0cnkuZW5kUG9zaXRpb25zO1xyXG5cdFx0XHR0aGlja25lc3MgPSBnZW9tZXRyeS50aGlja25lc3M7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRzdGFydFBvc2l0aW9ucyA9IG5ldyBBcnJheTxudW1iZXI+KDMpO1xyXG5cdFx0XHRlbmRQb3NpdGlvbnMgPSBuZXcgQXJyYXk8bnVtYmVyPigzKTtcclxuXHRcdFx0dGhpY2tuZXNzID0gbmV3IEFycmF5PG51bWJlcj4oMSk7XHJcblx0XHR9XHJcblxyXG5cdFx0c3RhcnRQb3NpdGlvbnNbMF0gPSBzdGFydC54O1xyXG5cdFx0c3RhcnRQb3NpdGlvbnNbMV0gPSBzdGFydC55O1xyXG5cdFx0c3RhcnRQb3NpdGlvbnNbMl0gPSBzdGFydC56O1xyXG5cdFx0ZW5kUG9zaXRpb25zWzBdID0gZW5kLng7XHJcblx0XHRlbmRQb3NpdGlvbnNbMV0gPSBlbmQueTtcclxuXHRcdGVuZFBvc2l0aW9uc1syXSA9IGVuZC56O1xyXG5cdFx0dGhpY2tuZXNzWzBdID0gdGhpcy5fbGluZVNlZ21lbnQudGhpY2tuZXNzO1xyXG5cclxuXHRcdGdlb21ldHJ5LnVwZGF0ZVBvc2l0aW9ucyhzdGFydFBvc2l0aW9ucywgZW5kUG9zaXRpb25zKTtcclxuXHRcdGdlb21ldHJ5LnVwZGF0ZVRoaWNrbmVzcyh0aGlja25lc3MpO1xyXG5cclxuXHRcdHJldHVybiBnZW9tZXRyeTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgX2lJbmNsdWRlRGVwZW5kZW5jaWVzKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlKVxyXG5cdHtcclxuXHRcdHNoYWRlck9iamVjdC5jb2xvckRlcGVuZGVuY2llcysrO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgc3RhdGljIF9pR2V0VmVydGV4Q29kZShzaGFkZXI6U2hhZGVyT2JqZWN0QmFzZSwgcmVnQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0cmV0dXJuIFwibTQ0IHZ0MCwgdmEwLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMCB0byBleWUgc3BhY2VcclxuXHRcdFx0XCJtNDQgdnQxLCB2YTEsIHZjOFx0XHRcdFxcblwiICsgLy8gdHJhbnNmb3JtIFExIHRvIGV5ZSBzcGFjZVxyXG5cdFx0XHRcInN1YiB2dDIsIHZ0MSwgdnQwIFx0XHRcdFxcblwiICsgLy8gTCA9IFExIC0gUTBcclxuXHJcblx0XHRcdFx0Ly8gdGVzdCBpZiBiZWhpbmQgY2FtZXJhIG5lYXIgcGxhbmVcclxuXHRcdFx0XHQvLyBpZiAwIC0gUTAueiA8IENhbWVyYS5uZWFyIHRoZW4gdGhlIHBvaW50IG5lZWRzIHRvIGJlIGNsaXBwZWRcclxuXHRcdFx0XHQvL1wibmVnIHZ0NS54LCB2dDAuelx0XHRcdFx0XFxuXCIgKyAvLyAwIC0gUTAuelxyXG5cdFx0XHRcInNsdCB2dDUueCwgdnQwLnosIHZjNy56XHRcdFx0XFxuXCIgKyAvLyBiZWhpbmQgPSAoIDAgLSBRMC56IDwgLUNhbWVyYS5uZWFyICkgPyAxIDogMFxyXG5cdFx0XHRcInN1YiB2dDUueSwgdmM1LngsIHZ0NS54XHRcdFx0XFxuXCIgKyAvLyAhYmVoaW5kID0gMSAtIGJlaGluZFxyXG5cclxuXHRcdFx0XHQvLyBwID0gcG9pbnQgb24gdGhlIHBsYW5lICgwLDAsLW5lYXIpXHJcblx0XHRcdFx0Ly8gbiA9IHBsYW5lIG5vcm1hbCAoMCwwLC0xKVxyXG5cdFx0XHRcdC8vIEQgPSBRMSAtIFEwXHJcblx0XHRcdFx0Ly8gdCA9ICggZG90KCBuLCAoIHAgLSBRMCApICkgLyAoIGRvdCggbiwgZCApXHJcblxyXG5cdFx0XHRcdC8vIHNvbHZlIGZvciB0IHdoZXJlIGxpbmUgY3Jvc3NlcyBDYW1lcmEubmVhclxyXG5cdFx0XHRcImFkZCB2dDQueCwgdnQwLnosIHZjNy56XHRcdFx0XFxuXCIgKyAvLyBRMC56ICsgKCAtQ2FtZXJhLm5lYXIgKVxyXG5cdFx0XHRcInN1YiB2dDQueSwgdnQwLnosIHZ0MS56XHRcdFx0XFxuXCIgKyAvLyBRMC56IC0gUTEuelxyXG5cclxuXHRcdFx0XHQvLyBmaXggZGl2aWRlIGJ5IHplcm8gZm9yIGhvcml6b250YWwgbGluZXNcclxuXHRcdFx0XCJzZXEgdnQ0LnosIHZ0NC55IHZjNi54XHRcdFx0XFxuXCIgKyAvLyBvZmZzZXQgPSAoUTAueiAtIFExLnopPT0wID8gMSA6IDBcclxuXHRcdFx0XCJhZGQgdnQ0LnksIHZ0NC55LCB2dDQuelx0XHRcdFxcblwiICsgLy8gKCBRMC56IC0gUTEueiApICsgb2Zmc2V0XHJcblxyXG5cdFx0XHRcImRpdiB2dDQueiwgdnQ0LngsIHZ0NC55XHRcdFx0XFxuXCIgKyAvLyB0ID0gKCBRMC56IC0gbmVhciApIC8gKCBRMC56IC0gUTEueiApXHJcblxyXG5cdFx0XHRcIm11bCB2dDQueHl6LCB2dDQuenp6LCB2dDIueHl6XHRcXG5cIiArIC8vIHQoTClcclxuXHRcdFx0XCJhZGQgdnQzLnh5eiwgdnQwLnh5eiwgdnQ0Lnh5elx0XFxuXCIgKyAvLyBRY2xpcHBlZCA9IFEwICsgdChMKVxyXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFFjbGlwcGVkLncgPSAxXHJcblxyXG5cdFx0XHRcdC8vIElmIG5lY2Vzc2FyeSwgcmVwbGFjZSBRMCB3aXRoIG5ldyBRY2xpcHBlZFxyXG5cdFx0XHRcIm11bCB2dDAsIHZ0MCwgdnQ1Lnl5eXlcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgKiBRMFxyXG5cdFx0XHRcIm11bCB2dDMsIHZ0MywgdnQ1Lnh4eHhcdFx0XHRcXG5cIiArIC8vIGJlaGluZCAqIFFjbGlwcGVkXHJcblx0XHRcdFwiYWRkIHZ0MCwgdnQwLCB2dDNcdFx0XHRcdFxcblwiICsgLy8gbmV3UTAgPSBRMCArIFFjbGlwcGVkXHJcblxyXG5cdFx0XHRcdC8vIGNhbGN1bGF0ZSBzaWRlIHZlY3RvciBmb3IgbGluZVxyXG5cdFx0XHRcInN1YiB2dDIsIHZ0MSwgdnQwIFx0XHRcdFxcblwiICsgLy8gTCA9IFExIC0gUTBcclxuXHRcdFx0XCJucm0gdnQyLnh5eiwgdnQyLnh5elx0XHRcdFxcblwiICsgLy8gbm9ybWFsaXplKCBMIClcclxuXHRcdFx0XCJucm0gdnQ1Lnh5eiwgdnQwLnh5elx0XHRcdFxcblwiICsgLy8gRCA9IG5vcm1hbGl6ZSggUTEgKVxyXG5cdFx0XHRcIm1vdiB2dDUudywgdmM1LnhcdFx0XHRcdFxcblwiICsgLy8gRC53ID0gMVxyXG5cdFx0XHRcImNycyB2dDMueHl6LCB2dDIsIHZ0NVx0XHRcdFxcblwiICsgLy8gUyA9IEwgeCBEXHJcblx0XHRcdFwibnJtIHZ0My54eXosIHZ0My54eXpcdFx0XHRcXG5cIiArIC8vIG5vcm1hbGl6ZSggUyApXHJcblxyXG5cdFx0XHRcdC8vIGZhY2UgdGhlIHNpZGUgdmVjdG9yIHByb3Blcmx5IGZvciB0aGUgZ2l2ZW4gcG9pbnRcclxuXHRcdFx0XCJtdWwgdnQzLnh5eiwgdnQzLnh5eiwgdmEyLnh4eFx0XFxuXCIgKyAvLyBTICo9IHdlaWdodFxyXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFMudyA9IDFcclxuXHJcblx0XHRcdFx0Ly8gY2FsY3VsYXRlIHRoZSBhbW91bnQgcmVxdWlyZWQgdG8gbW92ZSBhdCB0aGUgcG9pbnQncyBkaXN0YW5jZSB0byBjb3JyZXNwb25kIHRvIHRoZSBsaW5lJ3MgcGl4ZWwgd2lkdGhcclxuXHRcdFx0XHQvLyBzY2FsZSB0aGUgc2lkZSB2ZWN0b3IgYnkgdGhhdCBhbW91bnRcclxuXHRcdFx0XCJkcDMgdnQ0LngsIHZ0MCwgdmM2XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSA9IGRvdCggdmlldyApXHJcblx0XHRcdFwibXVsIHZ0NC54LCB2dDQueCwgdmM3LnhcdFx0XHRcXG5cIiArIC8vIGRpc3RhbmNlICo9IHZwc29kXHJcblx0XHRcdFwibXVsIHZ0My54eXosIHZ0My54eXosIHZ0NC54eHhcdFxcblwiICsgLy8gUy54eXogKj0gcGl4ZWxTY2FsZUZhY3RvclxyXG5cclxuXHRcdFx0XHQvLyBhZGQgc2NhbGVkIHNpZGUgdmVjdG9yIHRvIFEwIGFuZCB0cmFuc2Zvcm0gdG8gY2xpcCBzcGFjZVxyXG5cdFx0XHRcImFkZCB2dDAueHl6LCB2dDAueHl6LCB2dDMueHl6XHRcXG5cIiArIC8vIFEwICsgU1xyXG5cclxuXHRcdFx0XCJtNDQgb3AsIHZ0MCwgdmMwXHRcdFx0XFxuXCIgIC8vIHRyYW5zZm9ybSBRMCB0byBjbGlwIHNwYWNlXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfaUFjdGl2YXRlKHBhc3M6UmVuZGVyUGFzc0Jhc2UsIGNhbWVyYTpDYW1lcmEpXHJcblx0e1xyXG5cdFx0c3VwZXIuX2lBY3RpdmF0ZShwYXNzLCBjYW1lcmEpO1xyXG5cclxuXHRcdHRoaXMuX2NvbnN0YW50c1swXSA9IHRoaXMuX3RoaWNrbmVzcy8oKHRoaXMuX3N0YWdlLnNjaXNzb3JSZWN0KT8gTWF0aC5taW4odGhpcy5fc3RhZ2Uuc2Npc3NvclJlY3Qud2lkdGgsIHRoaXMuX3N0YWdlLnNjaXNzb3JSZWN0LmhlaWdodCkgOiBNYXRoLm1pbih0aGlzLl9zdGFnZS53aWR0aCwgdGhpcy5fc3RhZ2UuaGVpZ2h0KSk7XHJcblxyXG5cdFx0Ly8gdmFsdWUgdG8gY29udmVydCBkaXN0YW5jZSBmcm9tIGNhbWVyYSB0byBtb2RlbCBsZW5ndGggcGVyIHBpeGVsIHdpZHRoXHJcblx0XHR0aGlzLl9jb25zdGFudHNbMl0gPSBjYW1lcmEucHJvamVjdGlvbi5uZWFyO1xyXG5cclxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xyXG5cclxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDUsIExpbmVTZWdtZW50UmVuZGVyYWJsZS5wT05FX1ZFQ1RPUiwgMSk7XHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCA2LCBMaW5lU2VnbWVudFJlbmRlcmFibGUucEZST05UX1ZFQ1RPUiwgMSk7XHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCA3LCB0aGlzLl9jb25zdGFudHMsIDEpO1xyXG5cclxuXHRcdC8vIHByb2plY3Rpb24gbWF0cml4XHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tTWF0cml4KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgMCwgY2FtZXJhLnByb2plY3Rpb24ubWF0cml4LCB0cnVlKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIF9pUmVuZGVyKHBhc3M6UmVuZGVyUGFzc0Jhc2UsIGNhbWVyYTpDYW1lcmEsIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEKVxyXG5cdHtcclxuXHRcdHN1cGVyLl9pUmVuZGVyKHBhc3MsIGNhbWVyYSwgdmlld1Byb2plY3Rpb24pO1xyXG5cclxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xyXG5cdFx0dGhpcy5fY2FsY01hdHJpeC5jb3B5RnJvbSh0aGlzLnNvdXJjZUVudGl0eS5zY2VuZVRyYW5zZm9ybSk7XHJcblx0XHR0aGlzLl9jYWxjTWF0cml4LmFwcGVuZChjYW1lcmEuaW52ZXJzZVNjZW5lVHJhbnNmb3JtKTtcclxuXHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tTWF0cml4KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgOCwgdGhpcy5fY2FsY01hdHJpeCwgdHJ1ZSk7XHJcblxyXG5cdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMCwgdGhpcy5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBKSwgdGhpcy5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LlNUQVJUX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcclxuXHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKDEsIHRoaXMuZ2V0VmVydGV4RGF0YShMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEEpLCB0aGlzLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcclxuXHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKDIsIHRoaXMuZ2V0VmVydGV4RGF0YShMaW5lU3ViR2VvbWV0cnkuVEhJQ0tORVNTX0RBVEEpLCB0aGlzLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuVEhJQ0tORVNTX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuVEhJQ0tORVNTX0ZPUk1BVCk7XHJcblxyXG5cdFx0Y29udGV4dC5kcmF3VHJpYW5nbGVzKHRoaXMuX3N0YWdlLmdldEluZGV4QnVmZmVyKHRoaXMuZ2V0SW5kZXhEYXRhKCkpLCAwLCB0aGlzLm51bVRyaWFuZ2xlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiAvL1RPRE9cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBwb29sXHJcblx0ICogQHBhcmFtIHJlbmRlcmFibGVPd25lclxyXG5cdCAqIEBwYXJhbSBsZXZlbFxyXG5cdCAqIEBwYXJhbSBpbmRleE9mZnNldFxyXG5cdCAqIEByZXR1cm5zIHthd2F5LnBvb2wuTGluZVN1Yk1lc2hSZW5kZXJhYmxlfVxyXG5cdCAqIEBwcml2YXRlXHJcblx0ICovXHJcblx0cHVibGljIF9wR2V0T3ZlcmZsb3dSZW5kZXJhYmxlKGluZGV4T2Zmc2V0Om51bWJlcik6UmVuZGVyYWJsZUJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gbmV3IExpbmVTZWdtZW50UmVuZGVyYWJsZSh0aGlzLl9wb29sLCA8TGluZVNlZ21lbnQ+IHRoaXMucmVuZGVyYWJsZU93bmVyLCB0aGlzLl9zdGFnZSwgdGhpcy5fbGV2ZWwgKyAxLCBpbmRleE9mZnNldCk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBMaW5lU2VnbWVudFJlbmRlcmFibGU7Il19