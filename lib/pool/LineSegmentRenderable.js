var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var LineSubGeometry = require("awayjs-display/lib/base/LineSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var RenderableBase = require("awayjs-renderergl/lib/pool/RenderableBase");
/**
 * @class away.pool.LineSubMeshRenderable
 */
var LineSegmentRenderable = (function (_super) {
    __extends(LineSegmentRenderable, _super);
    /**
     * //TODO
     *
     * @param pool
     * @param subMesh
     * @param level
     * @param dataOffset
     */
    function LineSegmentRenderable(pool, lineSegment, stage, level, indexOffset) {
        if (level === void 0) { level = 0; }
        if (indexOffset === void 0) { indexOffset = 0; }
        _super.call(this, pool, lineSegment, lineSegment, lineSegment.material, stage, level, indexOffset);
        this._constants = new Array(0, 0, 0, 0);
        this._thickness = 1.25;
        this._lineSegment = lineSegment;
        this._calcMatrix = new Matrix3D();
        this._constants[1] = 1 / 255;
    }
    /**
     * //TODO
     *
     * @returns {base.LineSubGeometry}
     * @protected
     */
    LineSegmentRenderable.prototype._pGetSubGeometry = function () {
        var geometry = LineSegmentRenderable._lineGeometry[this._lineSegment.id] || (LineSegmentRenderable._lineGeometry[this._lineSegment.id] = new LineSubGeometry());
        this._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;
        var start = this._lineSegment.startPostion;
        var end = this._lineSegment.endPosition;
        var startPositions;
        var endPositions;
        var thickness;
        if (geometry.indices != null) {
            startPositions = geometry.startPositions;
            endPositions = geometry.endPositions;
            thickness = geometry.thickness;
        }
        else {
            startPositions = new Array(3);
            endPositions = new Array(3);
            thickness = new Array(1);
        }
        startPositions[0] = start.x;
        startPositions[1] = start.y;
        startPositions[2] = start.z;
        endPositions[0] = end.x;
        endPositions[1] = end.y;
        endPositions[2] = end.z;
        thickness[0] = this._lineSegment.thickness;
        geometry.updatePositions(startPositions, endPositions);
        geometry.updateThickness(thickness);
        return geometry;
    };
    LineSegmentRenderable._iIncludeDependencies = function (shaderObject) {
        shaderObject.colorDependencies++;
    };
    /**
     * @inheritDoc
     */
    LineSegmentRenderable._iGetVertexCode = function (shader, regCache, sharedReg) {
        return "m44 vt0, va0, vc8			\n" + "m44 vt1, va1, vc8			\n" + "sub vt2, vt1, vt0 			\n" + "slt vt5.x, vt0.z, vc7.z			\n" + "sub vt5.y, vc5.x, vt5.x			\n" + "add vt4.x, vt0.z, vc7.z			\n" + "sub vt4.y, vt0.z, vt1.z			\n" + "seq vt4.z, vt4.y vc6.x			\n" + "add vt4.y, vt4.y, vt4.z			\n" + "div vt4.z, vt4.x, vt4.y			\n" + "mul vt4.xyz, vt4.zzz, vt2.xyz	\n" + "add vt3.xyz, vt0.xyz, vt4.xyz	\n" + "mov vt3.w, vc5.x			\n" + "mul vt0, vt0, vt5.yyyy			\n" + "mul vt3, vt3, vt5.xxxx			\n" + "add vt0, vt0, vt3				\n" + "sub vt2, vt1, vt0 			\n" + "nrm vt2.xyz, vt2.xyz			\n" + "nrm vt5.xyz, vt0.xyz			\n" + "mov vt5.w, vc5.x				\n" + "crs vt3.xyz, vt2, vt5			\n" + "nrm vt3.xyz, vt3.xyz			\n" + "mul vt3.xyz, vt3.xyz, va2.xxx	\n" + "mov vt3.w, vc5.x			\n" + "dp3 vt4.x, vt0, vc6			\n" + "mul vt4.x, vt4.x, vc7.x			\n" + "mul vt3.xyz, vt3.xyz, vt4.xxx	\n" + "add vt0.xyz, vt0.xyz, vt3.xyz	\n" + "m44 op, vt0, vc0			\n"; // transform Q0 to clip space
    };
    /**
     * @inheritDoc
     */
    LineSegmentRenderable.prototype._iActivate = function (pass, camera) {
        _super.prototype._iActivate.call(this, pass, camera);
        this._constants[0] = this._thickness / ((this._stage.scissorRect) ? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));
        // value to convert distance from camera to model length per pixel width
        this._constants[2] = camera.projection.near;
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSegmentRenderable.pONE_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSegmentRenderable.pFRONT_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);
        // projection matrix
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);
    };
    /**
     * @inheritDoc
     */
    LineSegmentRenderable.prototype._iRender = function (pass, camera, viewProjection) {
        _super.prototype._iRender.call(this, pass, camera, viewProjection);
        var context = this._stage.context;
        this._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);
        this._calcMatrix.append(camera.inverseSceneTransform);
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);
        this._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);
        context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);
    };
    /**
     * //TODO
     *
     * @param pool
     * @param renderableOwner
     * @param level
     * @param indexOffset
     * @returns {away.pool.LineSubMeshRenderable}
     * @private
     */
    LineSegmentRenderable.prototype._pGetOverflowRenderable = function (indexOffset) {
        return new LineSegmentRenderable(this._pool, this.renderableOwner, this._stage, this._level + 1, indexOffset);
    };
    LineSegmentRenderable._lineGeometry = new Object();
    LineSegmentRenderable.pONE_VECTOR = Array(1, 1, 1, 1);
    LineSegmentRenderable.pFRONT_VECTOR = Array(0, 0, -1, 0);
    /**
     *
     */
    LineSegmentRenderable.id = "linesegment";
    LineSegmentRenderable.vertexAttributesOffset = 3;
    return LineSegmentRenderable;
})(RenderableBase);
module.exports = LineSegmentRenderable;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0xpbmVTZWdtZW50UmVuZGVyYWJsZS50cyJdLCJuYW1lcyI6WyJMaW5lU2VnbWVudFJlbmRlcmFibGUiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuY29uc3RydWN0b3IiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX3BHZXRTdWJHZW9tZXRyeSIsIkxpbmVTZWdtZW50UmVuZGVyYWJsZS5faUluY2x1ZGVEZXBlbmRlbmNpZXMiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX2lHZXRWZXJ0ZXhDb2RlIiwiTGluZVNlZ21lbnRSZW5kZXJhYmxlLl9pQWN0aXZhdGUiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX2lSZW5kZXIiLCJMaW5lU2VnbWVudFJlbmRlcmFibGUuX3BHZXRPdmVyZmxvd1JlbmRlcmFibGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBSWhFLElBQU8sZUFBZSxXQUFjLHlDQUF5QyxDQUFDLENBQUM7QUFPL0UsSUFBTyxvQkFBb0IsV0FBYSw4Q0FBOEMsQ0FBQyxDQUFDO0FBT3hGLElBQU8sY0FBYyxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFJaEYsQUFHQTs7R0FERztJQUNHLHFCQUFxQjtJQUFTQSxVQUE5QkEscUJBQXFCQSxVQUF1QkE7SUF1QmpEQTs7Ozs7OztPQU9HQTtJQUNIQSxTQS9CS0EscUJBQXFCQSxDQStCZEEsSUFBdUJBLEVBQUVBLFdBQXVCQSxFQUFFQSxLQUFXQSxFQUFFQSxLQUFnQkEsRUFBRUEsV0FBc0JBO1FBQXhDQyxxQkFBZ0JBLEdBQWhCQSxTQUFnQkE7UUFBRUEsMkJBQXNCQSxHQUF0QkEsZUFBc0JBO1FBRWxIQSxrQkFBTUEsSUFBSUEsRUFBRUEsV0FBV0EsRUFBRUEsV0FBV0EsRUFBRUEsV0FBV0EsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7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Q0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLG1DQUFhQSxHQUFpQkEsS0FBS0EsQ0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFNdkVBOztPQUVHQTtJQUNXQSx3QkFBRUEsR0FBVUEsYUFBYUEsQ0FBQ0E7SUFFMUJBLDRDQUFzQkEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7SUFvTWpEQSw0QkFBQ0E7QUFBREEsQ0FwTkEsQUFvTkNBLEVBcE5tQyxjQUFjLEVBb05qRDtBQUVELEFBQStCLGlCQUF0QixxQkFBcUIsQ0FBQyIsImZpbGUiOiJwb29sL0xpbmVTZWdtZW50UmVuZGVyYWJsZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xuXG5pbXBvcnQgSVJlbmRlcmFibGVPd25lclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVJlbmRlcmFibGVPd25lclwiKTtcbmltcG9ydCBMaW5lU3ViR2VvbWV0cnlcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0xpbmVTdWJHZW9tZXRyeVwiKTtcbmltcG9ydCBTdWJHZW9tZXRyeUV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZXZlbnRzL1N1Ykdlb21ldHJ5RXZlbnRcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBMaW5lU2VnbWVudFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvTGluZVNlZ21lbnRcIik7XG5pbXBvcnQgRGVmYXVsdE1hdGVyaWFsTWFuYWdlclx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWFuYWdlcnMvRGVmYXVsdE1hdGVyaWFsTWFuYWdlclwiKTtcblxuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcbmltcG9ydCBDb250ZXh0R0xQcm9ncmFtVHlwZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTFByb2dyYW1UeXBlXCIpO1xuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5cbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XG5pbXBvcnQgUmVuZGVyYWJsZVBvb2xCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZVBvb2xCYXNlXCIpO1xuaW1wb3J0IFJlbmRlclBhc3NCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcGFzc2VzL1JlbmRlclBhc3NCYXNlXCIpO1xuXG4vKipcbiAqIEBjbGFzcyBhd2F5LnBvb2wuTGluZVN1Yk1lc2hSZW5kZXJhYmxlXG4gKi9cbmNsYXNzIExpbmVTZWdtZW50UmVuZGVyYWJsZSBleHRlbmRzIFJlbmRlcmFibGVCYXNlXG57XG5cdHByaXZhdGUgc3RhdGljIF9saW5lR2VvbWV0cnk6T2JqZWN0ID0gbmV3IE9iamVjdCgpO1xuXG5cdHB1YmxpYyBzdGF0aWMgcE9ORV9WRUNUT1I6QXJyYXk8bnVtYmVyPiA9IEFycmF5PG51bWJlcj4oMSwgMSwgMSwgMSk7XG5cdHB1YmxpYyBzdGF0aWMgcEZST05UX1ZFQ1RPUjpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigwLCAwLCAtMSwgMCk7XG5cblx0cHJpdmF0ZSBfY29uc3RhbnRzOkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigwLCAwLCAwLCAwKTtcblx0cHJpdmF0ZSBfY2FsY01hdHJpeDpNYXRyaXgzRDtcblx0cHJpdmF0ZSBfdGhpY2tuZXNzOm51bWJlciA9IDEuMjU7XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIGlkOnN0cmluZyA9IFwibGluZXNlZ21lbnRcIjtcblxuXHRwdWJsaWMgc3RhdGljIHZlcnRleEF0dHJpYnV0ZXNPZmZzZXQ6bnVtYmVyID0gMztcblxuXHQvKipcblx0ICpcblx0ICovXG5cdHByaXZhdGUgX2xpbmVTZWdtZW50OkxpbmVTZWdtZW50O1xuXG5cdC8qKlxuXHQgKiAvL1RPRE9cblx0ICpcblx0ICogQHBhcmFtIHBvb2xcblx0ICogQHBhcmFtIHN1Yk1lc2hcblx0ICogQHBhcmFtIGxldmVsXG5cdCAqIEBwYXJhbSBkYXRhT2Zmc2V0XG5cdCAqL1xuXHRjb25zdHJ1Y3Rvcihwb29sOlJlbmRlcmFibGVQb29sQmFzZSwgbGluZVNlZ21lbnQ6TGluZVNlZ21lbnQsIHN0YWdlOlN0YWdlLCBsZXZlbDpudW1iZXIgPSAwLCBpbmRleE9mZnNldDpudW1iZXIgPSAwKVxuXHR7XG5cdFx0c3VwZXIocG9vbCwgbGluZVNlZ21lbnQsIGxpbmVTZWdtZW50LCBsaW5lU2VnbWVudC5tYXRlcmlhbCwgc3RhZ2UsIGxldmVsLCBpbmRleE9mZnNldCk7XG5cblx0XHR0aGlzLl9saW5lU2VnbWVudCA9IGxpbmVTZWdtZW50O1xuXG5cdFx0dGhpcy5fY2FsY01hdHJpeCA9IG5ldyBNYXRyaXgzRCgpO1xuXG5cdFx0dGhpcy5fY29uc3RhbnRzWzFdID0gMS8yNTU7XG5cdH1cblxuXHQvKipcblx0ICogLy9UT0RPXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtiYXNlLkxpbmVTdWJHZW9tZXRyeX1cblx0ICogQHByb3RlY3RlZFxuXHQgKi9cblx0cHVibGljIF9wR2V0U3ViR2VvbWV0cnkoKTpMaW5lU3ViR2VvbWV0cnlcblx0e1xuXHRcdHZhciBnZW9tZXRyeTpMaW5lU3ViR2VvbWV0cnkgPSBMaW5lU2VnbWVudFJlbmRlcmFibGUuX2xpbmVHZW9tZXRyeVt0aGlzLl9saW5lU2VnbWVudC5pZF0gfHwgKExpbmVTZWdtZW50UmVuZGVyYWJsZS5fbGluZUdlb21ldHJ5W3RoaXMuX2xpbmVTZWdtZW50LmlkXSA9IG5ldyBMaW5lU3ViR2VvbWV0cnkoKSk7XG5cblx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0xpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBXSA9IHRydWU7XG5cdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEFdID0gdHJ1ZTtcblx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0xpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQV0gPSB0cnVlO1xuXHRcdHRoaXMuX3BWZXJ0ZXhEYXRhRGlydHlbTGluZVN1Ykdlb21ldHJ5LkNPTE9SX0RBVEFdID0gdHJ1ZTtcblxuXHRcdHZhciBzdGFydDpWZWN0b3IzRCA9IHRoaXMuX2xpbmVTZWdtZW50LnN0YXJ0UG9zdGlvbjtcblx0XHR2YXIgZW5kOlZlY3RvcjNEID0gdGhpcy5fbGluZVNlZ21lbnQuZW5kUG9zaXRpb247XG5cblx0XHR2YXIgc3RhcnRQb3NpdGlvbnM6QXJyYXk8bnVtYmVyPjtcblx0XHR2YXIgZW5kUG9zaXRpb25zOkFycmF5PG51bWJlcj47XG5cdFx0dmFyIHRoaWNrbmVzczpBcnJheTxudW1iZXI+O1xuXG5cdFx0aWYgKGdlb21ldHJ5LmluZGljZXMgIT0gbnVsbCkge1xuXHRcdFx0c3RhcnRQb3NpdGlvbnMgPSBnZW9tZXRyeS5zdGFydFBvc2l0aW9ucztcblx0XHRcdGVuZFBvc2l0aW9ucyA9IGdlb21ldHJ5LmVuZFBvc2l0aW9ucztcblx0XHRcdHRoaWNrbmVzcyA9IGdlb21ldHJ5LnRoaWNrbmVzcztcblx0XHR9IGVsc2Uge1xuXHRcdFx0c3RhcnRQb3NpdGlvbnMgPSBuZXcgQXJyYXk8bnVtYmVyPigzKTtcblx0XHRcdGVuZFBvc2l0aW9ucyA9IG5ldyBBcnJheTxudW1iZXI+KDMpO1xuXHRcdFx0dGhpY2tuZXNzID0gbmV3IEFycmF5PG51bWJlcj4oMSk7XG5cdFx0fVxuXG5cdFx0c3RhcnRQb3NpdGlvbnNbMF0gPSBzdGFydC54O1xuXHRcdHN0YXJ0UG9zaXRpb25zWzFdID0gc3RhcnQueTtcblx0XHRzdGFydFBvc2l0aW9uc1syXSA9IHN0YXJ0Lno7XG5cdFx0ZW5kUG9zaXRpb25zWzBdID0gZW5kLng7XG5cdFx0ZW5kUG9zaXRpb25zWzFdID0gZW5kLnk7XG5cdFx0ZW5kUG9zaXRpb25zWzJdID0gZW5kLno7XG5cdFx0dGhpY2tuZXNzWzBdID0gdGhpcy5fbGluZVNlZ21lbnQudGhpY2tuZXNzO1xuXG5cdFx0Z2VvbWV0cnkudXBkYXRlUG9zaXRpb25zKHN0YXJ0UG9zaXRpb25zLCBlbmRQb3NpdGlvbnMpO1xuXHRcdGdlb21ldHJ5LnVwZGF0ZVRoaWNrbmVzcyh0aGlja25lc3MpO1xuXG5cdFx0cmV0dXJuIGdlb21ldHJ5O1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBfaUluY2x1ZGVEZXBlbmRlbmNpZXMoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UpXG5cdHtcblx0XHRzaGFkZXJPYmplY3QuY29sb3JEZXBlbmRlbmNpZXMrKztcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIHN0YXRpYyBfaUdldFZlcnRleENvZGUoc2hhZGVyOlNoYWRlck9iamVjdEJhc2UsIHJlZ0NhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZzpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0cmV0dXJuIFwibTQ0IHZ0MCwgdmEwLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMCB0byBleWUgc3BhY2Vcblx0XHRcdFwibTQ0IHZ0MSwgdmExLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMSB0byBleWUgc3BhY2Vcblx0XHRcdFwic3ViIHZ0MiwgdnQxLCB2dDAgXHRcdFx0XFxuXCIgKyAvLyBMID0gUTEgLSBRMFxuXG5cdFx0XHRcdC8vIHRlc3QgaWYgYmVoaW5kIGNhbWVyYSBuZWFyIHBsYW5lXG5cdFx0XHRcdC8vIGlmIDAgLSBRMC56IDwgQ2FtZXJhLm5lYXIgdGhlbiB0aGUgcG9pbnQgbmVlZHMgdG8gYmUgY2xpcHBlZFxuXHRcdFx0XHQvL1wibmVnIHZ0NS54LCB2dDAuelx0XHRcdFx0XFxuXCIgKyAvLyAwIC0gUTAuelxuXHRcdFx0XCJzbHQgdnQ1LngsIHZ0MC56LCB2Yzcuelx0XHRcdFxcblwiICsgLy8gYmVoaW5kID0gKCAwIC0gUTAueiA8IC1DYW1lcmEubmVhciApID8gMSA6IDBcblx0XHRcdFwic3ViIHZ0NS55LCB2YzUueCwgdnQ1LnhcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgPSAxIC0gYmVoaW5kXG5cblx0XHRcdFx0Ly8gcCA9IHBvaW50IG9uIHRoZSBwbGFuZSAoMCwwLC1uZWFyKVxuXHRcdFx0XHQvLyBuID0gcGxhbmUgbm9ybWFsICgwLDAsLTEpXG5cdFx0XHRcdC8vIEQgPSBRMSAtIFEwXG5cdFx0XHRcdC8vIHQgPSAoIGRvdCggbiwgKCBwIC0gUTAgKSApIC8gKCBkb3QoIG4sIGQgKVxuXG5cdFx0XHRcdC8vIHNvbHZlIGZvciB0IHdoZXJlIGxpbmUgY3Jvc3NlcyBDYW1lcmEubmVhclxuXHRcdFx0XCJhZGQgdnQ0LngsIHZ0MC56LCB2Yzcuelx0XHRcdFxcblwiICsgLy8gUTAueiArICggLUNhbWVyYS5uZWFyIClcblx0XHRcdFwic3ViIHZ0NC55LCB2dDAueiwgdnQxLnpcdFx0XHRcXG5cIiArIC8vIFEwLnogLSBRMS56XG5cblx0XHRcdFx0Ly8gZml4IGRpdmlkZSBieSB6ZXJvIGZvciBob3Jpem9udGFsIGxpbmVzXG5cdFx0XHRcInNlcSB2dDQueiwgdnQ0LnkgdmM2LnhcdFx0XHRcXG5cIiArIC8vIG9mZnNldCA9IChRMC56IC0gUTEueik9PTAgPyAxIDogMFxuXHRcdFx0XCJhZGQgdnQ0LnksIHZ0NC55LCB2dDQuelx0XHRcdFxcblwiICsgLy8gKCBRMC56IC0gUTEueiApICsgb2Zmc2V0XG5cblx0XHRcdFwiZGl2IHZ0NC56LCB2dDQueCwgdnQ0LnlcdFx0XHRcXG5cIiArIC8vIHQgPSAoIFEwLnogLSBuZWFyICkgLyAoIFEwLnogLSBRMS56IClcblxuXHRcdFx0XCJtdWwgdnQ0Lnh5eiwgdnQ0Lnp6eiwgdnQyLnh5elx0XFxuXCIgKyAvLyB0KEwpXG5cdFx0XHRcImFkZCB2dDMueHl6LCB2dDAueHl6LCB2dDQueHl6XHRcXG5cIiArIC8vIFFjbGlwcGVkID0gUTAgKyB0KEwpXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFFjbGlwcGVkLncgPSAxXG5cblx0XHRcdFx0Ly8gSWYgbmVjZXNzYXJ5LCByZXBsYWNlIFEwIHdpdGggbmV3IFFjbGlwcGVkXG5cdFx0XHRcIm11bCB2dDAsIHZ0MCwgdnQ1Lnl5eXlcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgKiBRMFxuXHRcdFx0XCJtdWwgdnQzLCB2dDMsIHZ0NS54eHh4XHRcdFx0XFxuXCIgKyAvLyBiZWhpbmQgKiBRY2xpcHBlZFxuXHRcdFx0XCJhZGQgdnQwLCB2dDAsIHZ0M1x0XHRcdFx0XFxuXCIgKyAvLyBuZXdRMCA9IFEwICsgUWNsaXBwZWRcblxuXHRcdFx0XHQvLyBjYWxjdWxhdGUgc2lkZSB2ZWN0b3IgZm9yIGxpbmVcblx0XHRcdFwic3ViIHZ0MiwgdnQxLCB2dDAgXHRcdFx0XFxuXCIgKyAvLyBMID0gUTEgLSBRMFxuXHRcdFx0XCJucm0gdnQyLnh5eiwgdnQyLnh5elx0XHRcdFxcblwiICsgLy8gbm9ybWFsaXplKCBMIClcblx0XHRcdFwibnJtIHZ0NS54eXosIHZ0MC54eXpcdFx0XHRcXG5cIiArIC8vIEQgPSBub3JtYWxpemUoIFExIClcblx0XHRcdFwibW92IHZ0NS53LCB2YzUueFx0XHRcdFx0XFxuXCIgKyAvLyBELncgPSAxXG5cdFx0XHRcImNycyB2dDMueHl6LCB2dDIsIHZ0NVx0XHRcdFxcblwiICsgLy8gUyA9IEwgeCBEXG5cdFx0XHRcIm5ybSB2dDMueHl6LCB2dDMueHl6XHRcdFx0XFxuXCIgKyAvLyBub3JtYWxpemUoIFMgKVxuXG5cdFx0XHRcdC8vIGZhY2UgdGhlIHNpZGUgdmVjdG9yIHByb3Blcmx5IGZvciB0aGUgZ2l2ZW4gcG9pbnRcblx0XHRcdFwibXVsIHZ0My54eXosIHZ0My54eXosIHZhMi54eHhcdFxcblwiICsgLy8gUyAqPSB3ZWlnaHRcblx0XHRcdFwibW92IHZ0My53LCB2YzUueFx0XHRcdFxcblwiICsgLy8gUy53ID0gMVxuXG5cdFx0XHRcdC8vIGNhbGN1bGF0ZSB0aGUgYW1vdW50IHJlcXVpcmVkIHRvIG1vdmUgYXQgdGhlIHBvaW50J3MgZGlzdGFuY2UgdG8gY29ycmVzcG9uZCB0byB0aGUgbGluZSdzIHBpeGVsIHdpZHRoXG5cdFx0XHRcdC8vIHNjYWxlIHRoZSBzaWRlIHZlY3RvciBieSB0aGF0IGFtb3VudFxuXHRcdFx0XCJkcDMgdnQ0LngsIHZ0MCwgdmM2XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSA9IGRvdCggdmlldyApXG5cdFx0XHRcIm11bCB2dDQueCwgdnQ0LngsIHZjNy54XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSAqPSB2cHNvZFxuXHRcdFx0XCJtdWwgdnQzLnh5eiwgdnQzLnh5eiwgdnQ0Lnh4eFx0XFxuXCIgKyAvLyBTLnh5eiAqPSBwaXhlbFNjYWxlRmFjdG9yXG5cblx0XHRcdFx0Ly8gYWRkIHNjYWxlZCBzaWRlIHZlY3RvciB0byBRMCBhbmQgdHJhbnNmb3JtIHRvIGNsaXAgc3BhY2Vcblx0XHRcdFwiYWRkIHZ0MC54eXosIHZ0MC54eXosIHZ0My54eXpcdFxcblwiICsgLy8gUTAgKyBTXG5cblx0XHRcdFwibTQ0IG9wLCB2dDAsIHZjMFx0XHRcdFxcblwiICAvLyB0cmFuc2Zvcm0gUTAgdG8gY2xpcCBzcGFjZVxuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lBY3RpdmF0ZShwYXNzOlJlbmRlclBhc3NCYXNlLCBjYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0c3VwZXIuX2lBY3RpdmF0ZShwYXNzLCBjYW1lcmEpO1xuXG5cdFx0dGhpcy5fY29uc3RhbnRzWzBdID0gdGhpcy5fdGhpY2tuZXNzLygodGhpcy5fc3RhZ2Uuc2Npc3NvclJlY3QpPyBNYXRoLm1pbih0aGlzLl9zdGFnZS5zY2lzc29yUmVjdC53aWR0aCwgdGhpcy5fc3RhZ2Uuc2Npc3NvclJlY3QuaGVpZ2h0KSA6IE1hdGgubWluKHRoaXMuX3N0YWdlLndpZHRoLCB0aGlzLl9zdGFnZS5oZWlnaHQpKTtcblxuXHRcdC8vIHZhbHVlIHRvIGNvbnZlcnQgZGlzdGFuY2UgZnJvbSBjYW1lcmEgdG8gbW9kZWwgbGVuZ3RoIHBlciBwaXhlbCB3aWR0aFxuXHRcdHRoaXMuX2NvbnN0YW50c1syXSA9IGNhbWVyYS5wcm9qZWN0aW9uLm5lYXI7XG5cblx0XHR2YXIgY29udGV4dDpJQ29udGV4dEdMID0gdGhpcy5fc3RhZ2UuY29udGV4dDtcblxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDUsIExpbmVTZWdtZW50UmVuZGVyYWJsZS5wT05FX1ZFQ1RPUiwgMSk7XG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgNiwgTGluZVNlZ21lbnRSZW5kZXJhYmxlLnBGUk9OVF9WRUNUT1IsIDEpO1xuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDcsIHRoaXMuX2NvbnN0YW50cywgMSk7XG5cblx0XHQvLyBwcm9qZWN0aW9uIG1hdHJpeFxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21NYXRyaXgoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCAwLCBjYW1lcmEucHJvamVjdGlvbi5tYXRyaXgsIHRydWUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lSZW5kZXIocGFzczpSZW5kZXJQYXNzQmFzZSwgY2FtZXJhOkNhbWVyYSwgdmlld1Byb2plY3Rpb246TWF0cml4M0QpXG5cdHtcblx0XHRzdXBlci5faVJlbmRlcihwYXNzLCBjYW1lcmEsIHZpZXdQcm9qZWN0aW9uKTtcblxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xuXHRcdHRoaXMuX2NhbGNNYXRyaXguY29weUZyb20odGhpcy5zb3VyY2VFbnRpdHkuc2NlbmVUcmFuc2Zvcm0pO1xuXHRcdHRoaXMuX2NhbGNNYXRyaXguYXBwZW5kKGNhbWVyYS5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0pO1xuXG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbU1hdHJpeChDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDgsIHRoaXMuX2NhbGNNYXRyaXgsIHRydWUpO1xuXG5cdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMCwgdGhpcy5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBKSwgdGhpcy5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LlNUQVJUX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcblx0XHR0aGlzLl9zdGFnZS5hY3RpdmF0ZUJ1ZmZlcigxLCB0aGlzLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgdGhpcy5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0ZPUk1BVCk7XG5cdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMiwgdGhpcy5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQSksIHRoaXMuZ2V0VmVydGV4T2Zmc2V0KExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQSksIExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfRk9STUFUKTtcblxuXHRcdGNvbnRleHQuZHJhd1RyaWFuZ2xlcyh0aGlzLl9zdGFnZS5nZXRJbmRleEJ1ZmZlcih0aGlzLmdldEluZGV4RGF0YSgpKSwgMCwgdGhpcy5udW1UcmlhbmdsZXMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIC8vVE9ET1xuXHQgKlxuXHQgKiBAcGFyYW0gcG9vbFxuXHQgKiBAcGFyYW0gcmVuZGVyYWJsZU93bmVyXG5cdCAqIEBwYXJhbSBsZXZlbFxuXHQgKiBAcGFyYW0gaW5kZXhPZmZzZXRcblx0ICogQHJldHVybnMge2F3YXkucG9vbC5MaW5lU3ViTWVzaFJlbmRlcmFibGV9XG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwdWJsaWMgX3BHZXRPdmVyZmxvd1JlbmRlcmFibGUoaW5kZXhPZmZzZXQ6bnVtYmVyKTpSZW5kZXJhYmxlQmFzZVxuXHR7XG5cdFx0cmV0dXJuIG5ldyBMaW5lU2VnbWVudFJlbmRlcmFibGUodGhpcy5fcG9vbCwgPExpbmVTZWdtZW50PiB0aGlzLnJlbmRlcmFibGVPd25lciwgdGhpcy5fc3RhZ2UsIHRoaXMuX2xldmVsICsgMSwgaW5kZXhPZmZzZXQpO1xuXHR9XG59XG5cbmV4cG9ydCA9IExpbmVTZWdtZW50UmVuZGVyYWJsZTsiXX0=