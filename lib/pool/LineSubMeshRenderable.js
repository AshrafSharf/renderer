var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var LineSubGeometry = require("awayjs-display/lib/base/LineSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var RenderableBase = require("awayjs-renderergl/lib/pool/RenderableBase");
/**
 * @class away.pool.LineSubMeshRenderable
 */
var LineSubMeshRenderable = (function (_super) {
    __extends(LineSubMeshRenderable, _super);
    /**
     * //TODO
     *
     * @param pool
     * @param subMesh
     * @param level
     * @param dataOffset
     */
    function LineSubMeshRenderable(pool, subMesh, stage, level, indexOffset) {
        if (level === void 0) { level = 0; }
        if (indexOffset === void 0) { indexOffset = 0; }
        _super.call(this, pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);
        this._constants = new Array(0, 0, 0, 0);
        this._thickness = 1.25;
        this.subMesh = subMesh;
        this._calcMatrix = new Matrix3D();
        this._constants[1] = 1 / 255;
    }
    /**
     * //TODO
     *
     * @returns {base.LineSubGeometry}
     * @protected
     */
    LineSubMeshRenderable.prototype._pGetSubGeometry = function () {
        var subGeometry = this.subMesh.subGeometry;
        this._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;
        if (subGeometry.thickness)
            this._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;
        if (subGeometry.startColors)
            this._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;
        return subGeometry;
    };
    LineSubMeshRenderable._iIncludeDependencies = function (shaderObject) {
        shaderObject.colorDependencies++;
    };
    /**
     * @inheritDoc
     */
    LineSubMeshRenderable._iGetVertexCode = function (shader, regCache, sharedReg) {
        return "m44 vt0, va0, vc8			\n" + "m44 vt1, va1, vc8			\n" + "sub vt2, vt1, vt0 			\n" + "slt vt5.x, vt0.z, vc7.z			\n" + "sub vt5.y, vc5.x, vt5.x			\n" + "add vt4.x, vt0.z, vc7.z			\n" + "sub vt4.y, vt0.z, vt1.z			\n" + "seq vt4.z, vt4.y vc6.x			\n" + "add vt4.y, vt4.y, vt4.z			\n" + "div vt4.z, vt4.x, vt4.y			\n" + "mul vt4.xyz, vt4.zzz, vt2.xyz	\n" + "add vt3.xyz, vt0.xyz, vt4.xyz	\n" + "mov vt3.w, vc5.x			\n" + "mul vt0, vt0, vt5.yyyy			\n" + "mul vt3, vt3, vt5.xxxx			\n" + "add vt0, vt0, vt3				\n" + "sub vt2, vt1, vt0 			\n" + "nrm vt2.xyz, vt2.xyz			\n" + "nrm vt5.xyz, vt0.xyz			\n" + "mov vt5.w, vc5.x				\n" + "crs vt3.xyz, vt2, vt5			\n" + "nrm vt3.xyz, vt3.xyz			\n" + "mul vt3.xyz, vt3.xyz, va2.xxx	\n" + "mov vt3.w, vc5.x			\n" + "dp3 vt4.x, vt0, vc6			\n" + "mul vt4.x, vt4.x, vc7.x			\n" + "mul vt3.xyz, vt3.xyz, vt4.xxx	\n" + "add vt0.xyz, vt0.xyz, vt3.xyz	\n" + "m44 op, vt0, vc0			\n"; // transform Q0 to clip space
    };
    /**
     * @inheritDoc
     */
    LineSubMeshRenderable.prototype._iActivate = function (pass, camera) {
        _super.prototype._iActivate.call(this, pass, camera);
        this._constants[0] = this._thickness / ((this._stage.scissorRect) ? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));
        // value to convert distance from camera to model length per pixel width
        this._constants[2] = camera.projection.near;
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSubMeshRenderable.pONE_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSubMeshRenderable.pFRONT_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);
        // projection matrix
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);
    };
    /**
     * @inheritDoc
     */
    LineSubMeshRenderable.prototype._iRender = function (pass, camera, viewProjection) {
        _super.prototype._iRender.call(this, pass, camera, viewProjection);
        var context = this._stage.context;
        this._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);
        this._calcMatrix.append(camera.inverseSceneTransform);
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);
        this._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);
        context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);
    };
    /**
     * //TODO
     *
     * @param pool
     * @param renderableOwner
     * @param level
     * @param indexOffset
     * @returns {away.pool.LineSubMeshRenderable}
     * @private
     */
    LineSubMeshRenderable.prototype._pGetOverflowRenderable = function (indexOffset) {
        return new LineSubMeshRenderable(this._pool, this.renderableOwner, this._stage, this._level + 1, indexOffset);
    };
    LineSubMeshRenderable.pONE_VECTOR = Array(1, 1, 1, 1);
    LineSubMeshRenderable.pFRONT_VECTOR = Array(0, 0, -1, 0);
    /**
     *
     */
    LineSubMeshRenderable.id = "linesubmesh";
    LineSubMeshRenderable.vertexAttributesOffset = 3;
    return LineSubMeshRenderable;
})(RenderableBase);
module.exports = LineSubMeshRenderable;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0xpbmVTdWJNZXNoUmVuZGVyYWJsZS50cyJdLCJuYW1lcyI6WyJMaW5lU3ViTWVzaFJlbmRlcmFibGUiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuY29uc3RydWN0b3IiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX3BHZXRTdWJHZW9tZXRyeSIsIkxpbmVTdWJNZXNoUmVuZGVyYWJsZS5faUluY2x1ZGVEZXBlbmRlbmNpZXMiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX2lHZXRWZXJ0ZXhDb2RlIiwiTGluZVN1Yk1lc2hSZW5kZXJhYmxlLl9pQWN0aXZhdGUiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX2lSZW5kZXIiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX3BHZXRPdmVyZmxvd1JlbmRlcmFibGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBSWhFLElBQU8sZUFBZSxXQUFjLHlDQUF5QyxDQUFDLENBQUM7QUFNL0UsSUFBTyxvQkFBb0IsV0FBYSw4Q0FBOEMsQ0FBQyxDQUFDO0FBT3hGLElBQU8sY0FBYyxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFJaEYsQUFHQTs7R0FERztJQUNHLHFCQUFxQjtJQUFTQSxVQUE5QkEscUJBQXFCQSxVQUF1QkE7SUFxQmpEQTs7Ozs7OztPQU9HQTtJQUNIQSxTQTdCS0EscUJBQXFCQSxDQTZCZEEsSUFBdUJBLEVBQUVBLE9BQW1CQSxFQUFFQSxLQUFXQSxFQUFFQSxLQUFnQkEsRUFBRUEsV0FBc0JBO1FBQXhDQyxxQkFBZ0JBLEdBQWhCQSxTQUFnQkE7UUFBRUEsMkJBQXNCQSxHQUF0QkEsZUFBc0JBO1FBRTlHQSxrQkFBTUEsSUFBSUEsRUFBRUEsT0FBT0EsQ0FBQ0EsVUFBVUEsRUFBRUEsT0FBT0EsRUFBRUEsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsV0FBV0Es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c291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xyXG5cclxuaW1wb3J0IElSZW5kZXJhYmxlT3duZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0lSZW5kZXJhYmxlT3duZXJcIik7XHJcbmltcG9ydCBMaW5lU3ViTWVzaFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9MaW5lU3ViTWVzaFwiKTtcclxuaW1wb3J0IExpbmVTdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGluZVN1Ykdlb21ldHJ5XCIpO1xyXG5pbXBvcnQgU3ViR2VvbWV0cnlFdmVudFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2V2ZW50cy9TdWJHZW9tZXRyeUV2ZW50XCIpO1xyXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuaW1wb3J0IERlZmF1bHRNYXRlcmlhbE1hbmFnZXJcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hbmFnZXJzL0RlZmF1bHRNYXRlcmlhbE1hbmFnZXJcIik7XHJcblxyXG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xyXG5pbXBvcnQgQ29udGV4dEdMUHJvZ3JhbVR5cGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9Db250ZXh0R0xQcm9ncmFtVHlwZVwiKTtcclxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcblxyXG5pbXBvcnQgU2hhZGVyT2JqZWN0QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XHJcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJFbGVtZW50XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckVsZW1lbnRcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlUG9vbEJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlUG9vbEJhc2VcIik7XHJcbmltcG9ydCBSZW5kZXJQYXNzQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bhc3Nlcy9SZW5kZXJQYXNzQmFzZVwiKTtcclxuXHJcbi8qKlxyXG4gKiBAY2xhc3MgYXdheS5wb29sLkxpbmVTdWJNZXNoUmVuZGVyYWJsZVxyXG4gKi9cclxuY2xhc3MgTGluZVN1Yk1lc2hSZW5kZXJhYmxlIGV4dGVuZHMgUmVuZGVyYWJsZUJhc2Vcclxue1xyXG5cdHB1YmxpYyBzdGF0aWMgcE9ORV9WRUNUT1I6QXJyYXk8bnVtYmVyPiA9IEFycmF5PG51bWJlcj4oMSwgMSwgMSwgMSk7XHJcblx0cHVibGljIHN0YXRpYyBwRlJPTlRfVkVDVE9SOkFycmF5PG51bWJlcj4gPSBBcnJheTxudW1iZXI+KDAsIDAsIC0xLCAwKTtcclxuXHJcblx0cHJpdmF0ZSBfY29uc3RhbnRzOkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigwLCAwLCAwLCAwKTtcclxuXHRwcml2YXRlIF9jYWxjTWF0cml4Ok1hdHJpeDNEO1xyXG5cdHByaXZhdGUgX3RoaWNrbmVzczpudW1iZXIgPSAxLjI1O1xyXG5cclxuXHQvKipcclxuXHQgKlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBzdGF0aWMgaWQ6c3RyaW5nID0gXCJsaW5lc3VibWVzaFwiO1xyXG5cclxuXHRwdWJsaWMgc3RhdGljIHZlcnRleEF0dHJpYnV0ZXNPZmZzZXQ6bnVtYmVyID0gMztcclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgc3ViTWVzaDpMaW5lU3ViTWVzaDtcclxuXHJcblx0LyoqXHJcblx0ICogLy9UT0RPXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gcG9vbFxyXG5cdCAqIEBwYXJhbSBzdWJNZXNoXHJcblx0ICogQHBhcmFtIGxldmVsXHJcblx0ICogQHBhcmFtIGRhdGFPZmZzZXRcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3Rvcihwb29sOlJlbmRlcmFibGVQb29sQmFzZSwgc3ViTWVzaDpMaW5lU3ViTWVzaCwgc3RhZ2U6U3RhZ2UsIGxldmVsOm51bWJlciA9IDAsIGluZGV4T2Zmc2V0Om51bWJlciA9IDApXHJcblx0e1xyXG5cdFx0c3VwZXIocG9vbCwgc3ViTWVzaC5wYXJlbnRNZXNoLCBzdWJNZXNoLCBzdWJNZXNoLm1hdGVyaWFsLCBzdGFnZSwgbGV2ZWwsIGluZGV4T2Zmc2V0KTtcclxuXHJcblx0XHR0aGlzLnN1Yk1lc2ggPSBzdWJNZXNoO1xyXG5cclxuXHRcdHRoaXMuX2NhbGNNYXRyaXggPSBuZXcgTWF0cml4M0QoKTtcclxuXHJcblx0XHR0aGlzLl9jb25zdGFudHNbMV0gPSAxLzI1NTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIC8vVE9ET1xyXG5cdCAqXHJcblx0ICogQHJldHVybnMge2Jhc2UuTGluZVN1Ykdlb21ldHJ5fVxyXG5cdCAqIEBwcm90ZWN0ZWRcclxuXHQgKi9cclxuXHRwdWJsaWMgX3BHZXRTdWJHZW9tZXRyeSgpOkxpbmVTdWJHZW9tZXRyeVxyXG5cdHtcclxuXHRcdHZhciBzdWJHZW9tZXRyeTpMaW5lU3ViR2VvbWV0cnkgPSB0aGlzLnN1Yk1lc2guc3ViR2VvbWV0cnk7XHJcblxyXG5cdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuU1RBUlRfUE9TSVRJT05fREFUQV0gPSB0cnVlO1xyXG5cdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEFdID0gdHJ1ZTtcclxuXHJcblx0XHRpZiAoc3ViR2VvbWV0cnkudGhpY2tuZXNzKVxyXG5cdFx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0xpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQV0gPSB0cnVlO1xyXG5cclxuXHRcdGlmIChzdWJHZW9tZXRyeS5zdGFydENvbG9ycylcclxuXHRcdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuQ09MT1JfREFUQV0gPSB0cnVlO1xyXG5cclxuXHRcdHJldHVybiBzdWJHZW9tZXRyeTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzdGF0aWMgX2lJbmNsdWRlRGVwZW5kZW5jaWVzKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlKVxyXG5cdHtcclxuXHRcdHNoYWRlck9iamVjdC5jb2xvckRlcGVuZGVuY2llcysrO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgc3RhdGljIF9pR2V0VmVydGV4Q29kZShzaGFkZXI6U2hhZGVyT2JqZWN0QmFzZSwgcmVnQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0cmV0dXJuIFwibTQ0IHZ0MCwgdmEwLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMCB0byBleWUgc3BhY2VcclxuXHRcdFx0XCJtNDQgdnQxLCB2YTEsIHZjOFx0XHRcdFxcblwiICsgLy8gdHJhbnNmb3JtIFExIHRvIGV5ZSBzcGFjZVxyXG5cdFx0XHRcInN1YiB2dDIsIHZ0MSwgdnQwIFx0XHRcdFxcblwiICsgLy8gTCA9IFExIC0gUTBcclxuXHJcblx0XHRcdFx0Ly8gdGVzdCBpZiBiZWhpbmQgY2FtZXJhIG5lYXIgcGxhbmVcclxuXHRcdFx0XHQvLyBpZiAwIC0gUTAueiA8IENhbWVyYS5uZWFyIHRoZW4gdGhlIHBvaW50IG5lZWRzIHRvIGJlIGNsaXBwZWRcclxuXHRcdFx0XHQvL1wibmVnIHZ0NS54LCB2dDAuelx0XHRcdFx0XFxuXCIgKyAvLyAwIC0gUTAuelxyXG5cdFx0XHRcInNsdCB2dDUueCwgdnQwLnosIHZjNy56XHRcdFx0XFxuXCIgKyAvLyBiZWhpbmQgPSAoIDAgLSBRMC56IDwgLUNhbWVyYS5uZWFyICkgPyAxIDogMFxyXG5cdFx0XHRcInN1YiB2dDUueSwgdmM1LngsIHZ0NS54XHRcdFx0XFxuXCIgKyAvLyAhYmVoaW5kID0gMSAtIGJlaGluZFxyXG5cclxuXHRcdFx0XHQvLyBwID0gcG9pbnQgb24gdGhlIHBsYW5lICgwLDAsLW5lYXIpXHJcblx0XHRcdFx0Ly8gbiA9IHBsYW5lIG5vcm1hbCAoMCwwLC0xKVxyXG5cdFx0XHRcdC8vIEQgPSBRMSAtIFEwXHJcblx0XHRcdFx0Ly8gdCA9ICggZG90KCBuLCAoIHAgLSBRMCApICkgLyAoIGRvdCggbiwgZCApXHJcblxyXG5cdFx0XHRcdC8vIHNvbHZlIGZvciB0IHdoZXJlIGxpbmUgY3Jvc3NlcyBDYW1lcmEubmVhclxyXG5cdFx0XHRcImFkZCB2dDQueCwgdnQwLnosIHZjNy56XHRcdFx0XFxuXCIgKyAvLyBRMC56ICsgKCAtQ2FtZXJhLm5lYXIgKVxyXG5cdFx0XHRcInN1YiB2dDQueSwgdnQwLnosIHZ0MS56XHRcdFx0XFxuXCIgKyAvLyBRMC56IC0gUTEuelxyXG5cclxuXHRcdFx0XHQvLyBmaXggZGl2aWRlIGJ5IHplcm8gZm9yIGhvcml6b250YWwgbGluZXNcclxuXHRcdFx0XCJzZXEgdnQ0LnosIHZ0NC55IHZjNi54XHRcdFx0XFxuXCIgKyAvLyBvZmZzZXQgPSAoUTAueiAtIFExLnopPT0wID8gMSA6IDBcclxuXHRcdFx0XCJhZGQgdnQ0LnksIHZ0NC55LCB2dDQuelx0XHRcdFxcblwiICsgLy8gKCBRMC56IC0gUTEueiApICsgb2Zmc2V0XHJcblxyXG5cdFx0XHRcImRpdiB2dDQueiwgdnQ0LngsIHZ0NC55XHRcdFx0XFxuXCIgKyAvLyB0ID0gKCBRMC56IC0gbmVhciApIC8gKCBRMC56IC0gUTEueiApXHJcblxyXG5cdFx0XHRcIm11bCB2dDQueHl6LCB2dDQuenp6LCB2dDIueHl6XHRcXG5cIiArIC8vIHQoTClcclxuXHRcdFx0XCJhZGQgdnQzLnh5eiwgdnQwLnh5eiwgdnQ0Lnh5elx0XFxuXCIgKyAvLyBRY2xpcHBlZCA9IFEwICsgdChMKVxyXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFFjbGlwcGVkLncgPSAxXHJcblxyXG5cdFx0XHRcdC8vIElmIG5lY2Vzc2FyeSwgcmVwbGFjZSBRMCB3aXRoIG5ldyBRY2xpcHBlZFxyXG5cdFx0XHRcIm11bCB2dDAsIHZ0MCwgdnQ1Lnl5eXlcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgKiBRMFxyXG5cdFx0XHRcIm11bCB2dDMsIHZ0MywgdnQ1Lnh4eHhcdFx0XHRcXG5cIiArIC8vIGJlaGluZCAqIFFjbGlwcGVkXHJcblx0XHRcdFwiYWRkIHZ0MCwgdnQwLCB2dDNcdFx0XHRcdFxcblwiICsgLy8gbmV3UTAgPSBRMCArIFFjbGlwcGVkXHJcblxyXG5cdFx0XHRcdC8vIGNhbGN1bGF0ZSBzaWRlIHZlY3RvciBmb3IgbGluZVxyXG5cdFx0XHRcInN1YiB2dDIsIHZ0MSwgdnQwIFx0XHRcdFxcblwiICsgLy8gTCA9IFExIC0gUTBcclxuXHRcdFx0XCJucm0gdnQyLnh5eiwgdnQyLnh5elx0XHRcdFxcblwiICsgLy8gbm9ybWFsaXplKCBMIClcclxuXHRcdFx0XCJucm0gdnQ1Lnh5eiwgdnQwLnh5elx0XHRcdFxcblwiICsgLy8gRCA9IG5vcm1hbGl6ZSggUTEgKVxyXG5cdFx0XHRcIm1vdiB2dDUudywgdmM1LnhcdFx0XHRcdFxcblwiICsgLy8gRC53ID0gMVxyXG5cdFx0XHRcImNycyB2dDMueHl6LCB2dDIsIHZ0NVx0XHRcdFxcblwiICsgLy8gUyA9IEwgeCBEXHJcblx0XHRcdFwibnJtIHZ0My54eXosIHZ0My54eXpcdFx0XHRcXG5cIiArIC8vIG5vcm1hbGl6ZSggUyApXHJcblxyXG5cdFx0XHRcdC8vIGZhY2UgdGhlIHNpZGUgdmVjdG9yIHByb3Blcmx5IGZvciB0aGUgZ2l2ZW4gcG9pbnRcclxuXHRcdFx0XCJtdWwgdnQzLnh5eiwgdnQzLnh5eiwgdmEyLnh4eFx0XFxuXCIgKyAvLyBTICo9IHdlaWdodFxyXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFMudyA9IDFcclxuXHJcblx0XHRcdFx0Ly8gY2FsY3VsYXRlIHRoZSBhbW91bnQgcmVxdWlyZWQgdG8gbW92ZSBhdCB0aGUgcG9pbnQncyBkaXN0YW5jZSB0byBjb3JyZXNwb25kIHRvIHRoZSBsaW5lJ3MgcGl4ZWwgd2lkdGhcclxuXHRcdFx0XHQvLyBzY2FsZSB0aGUgc2lkZSB2ZWN0b3IgYnkgdGhhdCBhbW91bnRcclxuXHRcdFx0XCJkcDMgdnQ0LngsIHZ0MCwgdmM2XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSA9IGRvdCggdmlldyApXHJcblx0XHRcdFwibXVsIHZ0NC54LCB2dDQueCwgdmM3LnhcdFx0XHRcXG5cIiArIC8vIGRpc3RhbmNlICo9IHZwc29kXHJcblx0XHRcdFwibXVsIHZ0My54eXosIHZ0My54eXosIHZ0NC54eHhcdFxcblwiICsgLy8gUy54eXogKj0gcGl4ZWxTY2FsZUZhY3RvclxyXG5cclxuXHRcdFx0XHQvLyBhZGQgc2NhbGVkIHNpZGUgdmVjdG9yIHRvIFEwIGFuZCB0cmFuc2Zvcm0gdG8gY2xpcCBzcGFjZVxyXG5cdFx0XHRcImFkZCB2dDAueHl6LCB2dDAueHl6LCB2dDMueHl6XHRcXG5cIiArIC8vIFEwICsgU1xyXG5cclxuXHRcdFx0XCJtNDQgb3AsIHZ0MCwgdmMwXHRcdFx0XFxuXCIgIC8vIHRyYW5zZm9ybSBRMCB0byBjbGlwIHNwYWNlXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBfaUFjdGl2YXRlKHBhc3M6UmVuZGVyUGFzc0Jhc2UsIGNhbWVyYTpDYW1lcmEpXHJcblx0e1xyXG5cdFx0c3VwZXIuX2lBY3RpdmF0ZShwYXNzLCBjYW1lcmEpO1xyXG5cclxuXHRcdHRoaXMuX2NvbnN0YW50c1swXSA9IHRoaXMuX3RoaWNrbmVzcy8oKHRoaXMuX3N0YWdlLnNjaXNzb3JSZWN0KT8gTWF0aC5taW4odGhpcy5fc3RhZ2Uuc2Npc3NvclJlY3Qud2lkdGgsIHRoaXMuX3N0YWdlLnNjaXNzb3JSZWN0LmhlaWdodCkgOiBNYXRoLm1pbih0aGlzLl9zdGFnZS53aWR0aCwgdGhpcy5fc3RhZ2UuaGVpZ2h0KSk7XHJcblxyXG5cdFx0Ly8gdmFsdWUgdG8gY29udmVydCBkaXN0YW5jZSBmcm9tIGNhbWVyYSB0byBtb2RlbCBsZW5ndGggcGVyIHBpeGVsIHdpZHRoXHJcblx0XHR0aGlzLl9jb25zdGFudHNbMl0gPSBjYW1lcmEucHJvamVjdGlvbi5uZWFyO1xyXG5cclxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xyXG5cclxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDUsIExpbmVTdWJNZXNoUmVuZGVyYWJsZS5wT05FX1ZFQ1RPUiwgMSk7XHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCA2LCBMaW5lU3ViTWVzaFJlbmRlcmFibGUucEZST05UX1ZFQ1RPUiwgMSk7XHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCA3LCB0aGlzLl9jb25zdGFudHMsIDEpO1xyXG5cclxuXHRcdC8vIHByb2plY3Rpb24gbWF0cml4XHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tTWF0cml4KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgMCwgY2FtZXJhLnByb2plY3Rpb24ubWF0cml4LCB0cnVlKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIF9pUmVuZGVyKHBhc3M6UmVuZGVyUGFzc0Jhc2UsIGNhbWVyYTpDYW1lcmEsIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEKVxyXG5cdHtcclxuXHRcdHN1cGVyLl9pUmVuZGVyKHBhc3MsIGNhbWVyYSwgdmlld1Byb2plY3Rpb24pO1xyXG5cclxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xyXG5cdFx0dGhpcy5fY2FsY01hdHJpeC5jb3B5RnJvbSh0aGlzLnNvdXJjZUVudGl0eS5zY2VuZVRyYW5zZm9ybSk7XHJcblx0XHR0aGlzLl9jYWxjTWF0cml4LmFwcGVuZChjYW1lcmEuaW52ZXJzZVNjZW5lVHJhbnNmb3JtKTtcclxuXHJcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tTWF0cml4KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgOCwgdGhpcy5fY2FsY01hdHJpeCwgdHJ1ZSk7XHJcblxyXG5cdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMCwgdGhpcy5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBKSwgdGhpcy5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LlNUQVJUX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcclxuXHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKDEsIHRoaXMuZ2V0VmVydGV4RGF0YShMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEEpLCB0aGlzLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcclxuXHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKDIsIHRoaXMuZ2V0VmVydGV4RGF0YShMaW5lU3ViR2VvbWV0cnkuVEhJQ0tORVNTX0RBVEEpLCB0aGlzLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuVEhJQ0tORVNTX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuVEhJQ0tORVNTX0ZPUk1BVCk7XHJcblxyXG5cdFx0Y29udGV4dC5kcmF3VHJpYW5nbGVzKHRoaXMuX3N0YWdlLmdldEluZGV4QnVmZmVyKHRoaXMuZ2V0SW5kZXhEYXRhKCkpLCAwLCB0aGlzLm51bVRyaWFuZ2xlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiAvL1RPRE9cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBwb29sXHJcblx0ICogQHBhcmFtIHJlbmRlcmFibGVPd25lclxyXG5cdCAqIEBwYXJhbSBsZXZlbFxyXG5cdCAqIEBwYXJhbSBpbmRleE9mZnNldFxyXG5cdCAqIEByZXR1cm5zIHthd2F5LnBvb2wuTGluZVN1Yk1lc2hSZW5kZXJhYmxlfVxyXG5cdCAqIEBwcml2YXRlXHJcblx0ICovXHJcblx0cHVibGljIF9wR2V0T3ZlcmZsb3dSZW5kZXJhYmxlKGluZGV4T2Zmc2V0Om51bWJlcik6UmVuZGVyYWJsZUJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gbmV3IExpbmVTdWJNZXNoUmVuZGVyYWJsZSh0aGlzLl9wb29sLCA8TGluZVN1Yk1lc2g+IHRoaXMucmVuZGVyYWJsZU93bmVyLCB0aGlzLl9zdGFnZSwgdGhpcy5fbGV2ZWwgKyAxLCBpbmRleE9mZnNldCk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBMaW5lU3ViTWVzaFJlbmRlcmFibGU7Il19