var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var LineSubGeometry = require("awayjs-display/lib/base/LineSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var RenderableBase = require("awayjs-renderergl/lib/pool/RenderableBase");
/**
 * @class away.pool.LineSubMeshRenderable
 */
var LineSubMeshRenderable = (function (_super) {
    __extends(LineSubMeshRenderable, _super);
    /**
     * //TODO
     *
     * @param pool
     * @param subMesh
     * @param level
     * @param dataOffset
     */
    function LineSubMeshRenderable(pool, subMesh, stage, level, indexOffset) {
        if (level === void 0) { level = 0; }
        if (indexOffset === void 0) { indexOffset = 0; }
        _super.call(this, pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);
        this._constants = new Array(0, 0, 0, 0);
        this._thickness = 1.25;
        this.subMesh = subMesh;
        this._calcMatrix = new Matrix3D();
        this._constants[1] = 1 / 255;
    }
    /**
     * //TODO
     *
     * @returns {base.LineSubGeometry}
     * @protected
     */
    LineSubMeshRenderable.prototype._pGetSubGeometry = function () {
        var subGeometry = this.subMesh.subGeometry;
        this._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;
        this._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;
        if (subGeometry.thickness)
            this._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;
        if (subGeometry.startColors)
            this._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;
        return subGeometry;
    };
    LineSubMeshRenderable._iIncludeDependencies = function (shaderObject) {
        shaderObject.colorDependencies++;
    };
    /**
     * @inheritDoc
     */
    LineSubMeshRenderable._iGetVertexCode = function (shader, regCache, sharedReg) {
        return "m44 vt0, va0, vc8			\n" + "m44 vt1, va1, vc8			\n" + "sub vt2, vt1, vt0 			\n" + "slt vt5.x, vt0.z, vc7.z			\n" + "sub vt5.y, vc5.x, vt5.x			\n" + "add vt4.x, vt0.z, vc7.z			\n" + "sub vt4.y, vt0.z, vt1.z			\n" + "seq vt4.z, vt4.y vc6.x			\n" + "add vt4.y, vt4.y, vt4.z			\n" + "div vt4.z, vt4.x, vt4.y			\n" + "mul vt4.xyz, vt4.zzz, vt2.xyz	\n" + "add vt3.xyz, vt0.xyz, vt4.xyz	\n" + "mov vt3.w, vc5.x			\n" + "mul vt0, vt0, vt5.yyyy			\n" + "mul vt3, vt3, vt5.xxxx			\n" + "add vt0, vt0, vt3				\n" + "sub vt2, vt1, vt0 			\n" + "nrm vt2.xyz, vt2.xyz			\n" + "nrm vt5.xyz, vt0.xyz			\n" + "mov vt5.w, vc5.x				\n" + "crs vt3.xyz, vt2, vt5			\n" + "nrm vt3.xyz, vt3.xyz			\n" + "mul vt3.xyz, vt3.xyz, va2.xxx	\n" + "mov vt3.w, vc5.x			\n" + "dp3 vt4.x, vt0, vc6			\n" + "mul vt4.x, vt4.x, vc7.x			\n" + "mul vt3.xyz, vt3.xyz, vt4.xxx	\n" + "add vt0.xyz, vt0.xyz, vt3.xyz	\n" + "m44 op, vt0, vc0			\n"; // transform Q0 to clip space
    };
    /**
     * @inheritDoc
     */
    LineSubMeshRenderable.prototype._iActivate = function (pass, camera) {
        _super.prototype._iActivate.call(this, pass, camera);
        this._constants[0] = this._thickness / ((this._stage.scissorRect) ? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));
        // value to convert distance from camera to model length per pixel width
        this._constants[2] = camera.projection.near;
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSubMeshRenderable.pONE_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSubMeshRenderable.pFRONT_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);
        // projection matrix
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);
    };
    /**
     * @inheritDoc
     */
    LineSubMeshRenderable.prototype._iRender = function (pass, camera, viewProjection) {
        _super.prototype._iRender.call(this, pass, camera, viewProjection);
        var context = this._stage.context;
        this._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);
        this._calcMatrix.append(camera.inverseSceneTransform);
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);
        this._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);
        context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);
    };
    /**
     * //TODO
     *
     * @param pool
     * @param renderableOwner
     * @param level
     * @param indexOffset
     * @returns {away.pool.LineSubMeshRenderable}
     * @private
     */
    LineSubMeshRenderable.prototype._pGetOverflowRenderable = function (indexOffset) {
        return new LineSubMeshRenderable(this._pool, this.renderableOwner, this._stage, this._level + 1, indexOffset);
    };
    LineSubMeshRenderable.pONE_VECTOR = Array(1, 1, 1, 1);
    LineSubMeshRenderable.pFRONT_VECTOR = Array(0, 0, -1, 0);
    /**
     *
     */
    LineSubMeshRenderable.id = "linesubmesh";
    LineSubMeshRenderable.vertexAttributesOffset = 3;
    return LineSubMeshRenderable;
})(RenderableBase);
module.exports = LineSubMeshRenderable;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0xpbmVTdWJNZXNoUmVuZGVyYWJsZS50cyJdLCJuYW1lcyI6WyJMaW5lU3ViTWVzaFJlbmRlcmFibGUiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuY29uc3RydWN0b3IiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX3BHZXRTdWJHZW9tZXRyeSIsIkxpbmVTdWJNZXNoUmVuZGVyYWJsZS5faUluY2x1ZGVEZXBlbmRlbmNpZXMiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX2lHZXRWZXJ0ZXhDb2RlIiwiTGluZVN1Yk1lc2hSZW5kZXJhYmxlLl9pQWN0aXZhdGUiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX2lSZW5kZXIiLCJMaW5lU3ViTWVzaFJlbmRlcmFibGUuX3BHZXRPdmVyZmxvd1JlbmRlcmFibGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQU8sUUFBUSxXQUFnQiwrQkFBK0IsQ0FBQyxDQUFDO0FBSWhFLElBQU8sZUFBZSxXQUFjLHlDQUF5QyxDQUFDLENBQUM7QUFNL0UsSUFBTyxvQkFBb0IsV0FBYSw4Q0FBOEMsQ0FBQyxDQUFDO0FBT3hGLElBQU8sY0FBYyxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFJaEYsQUFHQTs7R0FERztJQUNHLHFCQUFxQjtJQUFTQSxVQUE5QkEscUJBQXFCQSxVQUF1QkE7SUFxQmpEQTs7Ozs7OztPQU9HQTtJQUNIQSxTQTdCS0EscUJBQXFCQSxDQTZCZEEsSUFBdUJBLEVBQUVBLE9BQW1CQSxFQUFFQSxLQUFXQSxFQUFFQSxLQUFnQkEsRUFBRUEsV0FBc0JBO1FBQXhDQyxxQkFBZ0JBLEdBQWhCQSxTQUFnQkE7UUFBRUEsMkJBQXNCQSxHQUF0QkEsZUFBc0JBO1FBRTlHQSxrQkFBTUEsSUFBSUEsRUFBRUEsT0FBT0EsQ0FBQ0EsVUFBVUEsRUFBRUEsT0FBT0EsRUFBRUEsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsV0FBV0Es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c291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xuXG5pbXBvcnQgSVJlbmRlcmFibGVPd25lclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVJlbmRlcmFibGVPd25lclwiKTtcbmltcG9ydCBMaW5lU3ViTWVzaFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9MaW5lU3ViTWVzaFwiKTtcbmltcG9ydCBMaW5lU3ViR2VvbWV0cnlcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0xpbmVTdWJHZW9tZXRyeVwiKTtcbmltcG9ydCBTdWJHZW9tZXRyeUV2ZW50XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZXZlbnRzL1N1Ykdlb21ldHJ5RXZlbnRcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcbmltcG9ydCBEZWZhdWx0TWF0ZXJpYWxNYW5hZ2VyXHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYW5hZ2Vycy9EZWZhdWx0TWF0ZXJpYWxNYW5hZ2VyXCIpO1xuXG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xuaW1wb3J0IENvbnRleHRHTFByb2dyYW1UeXBlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMUHJvZ3JhbVR5cGVcIik7XG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcblxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJDYWNoZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcbmltcG9ydCBSZW5kZXJhYmxlUG9vbEJhc2VcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlUG9vbEJhc2VcIik7XG5pbXBvcnQgUmVuZGVyUGFzc0Jhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvUmVuZGVyUGFzc0Jhc2VcIik7XG5cbi8qKlxuICogQGNsYXNzIGF3YXkucG9vbC5MaW5lU3ViTWVzaFJlbmRlcmFibGVcbiAqL1xuY2xhc3MgTGluZVN1Yk1lc2hSZW5kZXJhYmxlIGV4dGVuZHMgUmVuZGVyYWJsZUJhc2Vcbntcblx0cHVibGljIHN0YXRpYyBwT05FX1ZFQ1RPUjpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigxLCAxLCAxLCAxKTtcblx0cHVibGljIHN0YXRpYyBwRlJPTlRfVkVDVE9SOkFycmF5PG51bWJlcj4gPSBBcnJheTxudW1iZXI+KDAsIDAsIC0xLCAwKTtcblxuXHRwcml2YXRlIF9jb25zdGFudHM6QXJyYXk8bnVtYmVyPiA9IG5ldyBBcnJheTxudW1iZXI+KDAsIDAsIDAsIDApO1xuXHRwcml2YXRlIF9jYWxjTWF0cml4Ok1hdHJpeDNEO1xuXHRwcml2YXRlIF90aGlja25lc3M6bnVtYmVyID0gMS4yNTtcblxuXHQvKipcblx0ICpcblx0ICovXG5cdHB1YmxpYyBzdGF0aWMgaWQ6c3RyaW5nID0gXCJsaW5lc3VibWVzaFwiO1xuXG5cdHB1YmxpYyBzdGF0aWMgdmVydGV4QXR0cmlidXRlc09mZnNldDpudW1iZXIgPSAzO1xuXG5cdC8qKlxuXHQgKlxuXHQgKi9cblx0cHVibGljIHN1Yk1lc2g6TGluZVN1Yk1lc2g7XG5cblx0LyoqXG5cdCAqIC8vVE9ET1xuXHQgKlxuXHQgKiBAcGFyYW0gcG9vbFxuXHQgKiBAcGFyYW0gc3ViTWVzaFxuXHQgKiBAcGFyYW0gbGV2ZWxcblx0ICogQHBhcmFtIGRhdGFPZmZzZXRcblx0ICovXG5cdGNvbnN0cnVjdG9yKHBvb2w6UmVuZGVyYWJsZVBvb2xCYXNlLCBzdWJNZXNoOkxpbmVTdWJNZXNoLCBzdGFnZTpTdGFnZSwgbGV2ZWw6bnVtYmVyID0gMCwgaW5kZXhPZmZzZXQ6bnVtYmVyID0gMClcblx0e1xuXHRcdHN1cGVyKHBvb2wsIHN1Yk1lc2gucGFyZW50TWVzaCwgc3ViTWVzaCwgc3ViTWVzaC5tYXRlcmlhbCwgc3RhZ2UsIGxldmVsLCBpbmRleE9mZnNldCk7XG5cblx0XHR0aGlzLnN1Yk1lc2ggPSBzdWJNZXNoO1xuXG5cdFx0dGhpcy5fY2FsY01hdHJpeCA9IG5ldyBNYXRyaXgzRCgpO1xuXG5cdFx0dGhpcy5fY29uc3RhbnRzWzFdID0gMS8yNTU7XG5cdH1cblxuXHQvKipcblx0ICogLy9UT0RPXG5cdCAqXG5cdCAqIEByZXR1cm5zIHtiYXNlLkxpbmVTdWJHZW9tZXRyeX1cblx0ICogQHByb3RlY3RlZFxuXHQgKi9cblx0cHVibGljIF9wR2V0U3ViR2VvbWV0cnkoKTpMaW5lU3ViR2VvbWV0cnlcblx0e1xuXHRcdHZhciBzdWJHZW9tZXRyeTpMaW5lU3ViR2VvbWV0cnkgPSB0aGlzLnN1Yk1lc2guc3ViR2VvbWV0cnk7XG5cblx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0xpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBXSA9IHRydWU7XG5cdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEFdID0gdHJ1ZTtcblxuXHRcdGlmIChzdWJHZW9tZXRyeS50aGlja25lc3MpXG5cdFx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0xpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQV0gPSB0cnVlO1xuXG5cdFx0aWYgKHN1Ykdlb21ldHJ5LnN0YXJ0Q29sb3JzKVxuXHRcdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtMaW5lU3ViR2VvbWV0cnkuQ09MT1JfREFUQV0gPSB0cnVlO1xuXG5cdFx0cmV0dXJuIHN1Ykdlb21ldHJ5O1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBfaUluY2x1ZGVEZXBlbmRlbmNpZXMoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UpXG5cdHtcblx0XHRzaGFkZXJPYmplY3QuY29sb3JEZXBlbmRlbmNpZXMrKztcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIHN0YXRpYyBfaUdldFZlcnRleENvZGUoc2hhZGVyOlNoYWRlck9iamVjdEJhc2UsIHJlZ0NhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZzpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0cmV0dXJuIFwibTQ0IHZ0MCwgdmEwLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMCB0byBleWUgc3BhY2Vcblx0XHRcdFwibTQ0IHZ0MSwgdmExLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMSB0byBleWUgc3BhY2Vcblx0XHRcdFwic3ViIHZ0MiwgdnQxLCB2dDAgXHRcdFx0XFxuXCIgKyAvLyBMID0gUTEgLSBRMFxuXG5cdFx0XHRcdC8vIHRlc3QgaWYgYmVoaW5kIGNhbWVyYSBuZWFyIHBsYW5lXG5cdFx0XHRcdC8vIGlmIDAgLSBRMC56IDwgQ2FtZXJhLm5lYXIgdGhlbiB0aGUgcG9pbnQgbmVlZHMgdG8gYmUgY2xpcHBlZFxuXHRcdFx0XHQvL1wibmVnIHZ0NS54LCB2dDAuelx0XHRcdFx0XFxuXCIgKyAvLyAwIC0gUTAuelxuXHRcdFx0XCJzbHQgdnQ1LngsIHZ0MC56LCB2Yzcuelx0XHRcdFxcblwiICsgLy8gYmVoaW5kID0gKCAwIC0gUTAueiA8IC1DYW1lcmEubmVhciApID8gMSA6IDBcblx0XHRcdFwic3ViIHZ0NS55LCB2YzUueCwgdnQ1LnhcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgPSAxIC0gYmVoaW5kXG5cblx0XHRcdFx0Ly8gcCA9IHBvaW50IG9uIHRoZSBwbGFuZSAoMCwwLC1uZWFyKVxuXHRcdFx0XHQvLyBuID0gcGxhbmUgbm9ybWFsICgwLDAsLTEpXG5cdFx0XHRcdC8vIEQgPSBRMSAtIFEwXG5cdFx0XHRcdC8vIHQgPSAoIGRvdCggbiwgKCBwIC0gUTAgKSApIC8gKCBkb3QoIG4sIGQgKVxuXG5cdFx0XHRcdC8vIHNvbHZlIGZvciB0IHdoZXJlIGxpbmUgY3Jvc3NlcyBDYW1lcmEubmVhclxuXHRcdFx0XCJhZGQgdnQ0LngsIHZ0MC56LCB2Yzcuelx0XHRcdFxcblwiICsgLy8gUTAueiArICggLUNhbWVyYS5uZWFyIClcblx0XHRcdFwic3ViIHZ0NC55LCB2dDAueiwgdnQxLnpcdFx0XHRcXG5cIiArIC8vIFEwLnogLSBRMS56XG5cblx0XHRcdFx0Ly8gZml4IGRpdmlkZSBieSB6ZXJvIGZvciBob3Jpem9udGFsIGxpbmVzXG5cdFx0XHRcInNlcSB2dDQueiwgdnQ0LnkgdmM2LnhcdFx0XHRcXG5cIiArIC8vIG9mZnNldCA9IChRMC56IC0gUTEueik9PTAgPyAxIDogMFxuXHRcdFx0XCJhZGQgdnQ0LnksIHZ0NC55LCB2dDQuelx0XHRcdFxcblwiICsgLy8gKCBRMC56IC0gUTEueiApICsgb2Zmc2V0XG5cblx0XHRcdFwiZGl2IHZ0NC56LCB2dDQueCwgdnQ0LnlcdFx0XHRcXG5cIiArIC8vIHQgPSAoIFEwLnogLSBuZWFyICkgLyAoIFEwLnogLSBRMS56IClcblxuXHRcdFx0XCJtdWwgdnQ0Lnh5eiwgdnQ0Lnp6eiwgdnQyLnh5elx0XFxuXCIgKyAvLyB0KEwpXG5cdFx0XHRcImFkZCB2dDMueHl6LCB2dDAueHl6LCB2dDQueHl6XHRcXG5cIiArIC8vIFFjbGlwcGVkID0gUTAgKyB0KEwpXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFFjbGlwcGVkLncgPSAxXG5cblx0XHRcdFx0Ly8gSWYgbmVjZXNzYXJ5LCByZXBsYWNlIFEwIHdpdGggbmV3IFFjbGlwcGVkXG5cdFx0XHRcIm11bCB2dDAsIHZ0MCwgdnQ1Lnl5eXlcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgKiBRMFxuXHRcdFx0XCJtdWwgdnQzLCB2dDMsIHZ0NS54eHh4XHRcdFx0XFxuXCIgKyAvLyBiZWhpbmQgKiBRY2xpcHBlZFxuXHRcdFx0XCJhZGQgdnQwLCB2dDAsIHZ0M1x0XHRcdFx0XFxuXCIgKyAvLyBuZXdRMCA9IFEwICsgUWNsaXBwZWRcblxuXHRcdFx0XHQvLyBjYWxjdWxhdGUgc2lkZSB2ZWN0b3IgZm9yIGxpbmVcblx0XHRcdFwic3ViIHZ0MiwgdnQxLCB2dDAgXHRcdFx0XFxuXCIgKyAvLyBMID0gUTEgLSBRMFxuXHRcdFx0XCJucm0gdnQyLnh5eiwgdnQyLnh5elx0XHRcdFxcblwiICsgLy8gbm9ybWFsaXplKCBMIClcblx0XHRcdFwibnJtIHZ0NS54eXosIHZ0MC54eXpcdFx0XHRcXG5cIiArIC8vIEQgPSBub3JtYWxpemUoIFExIClcblx0XHRcdFwibW92IHZ0NS53LCB2YzUueFx0XHRcdFx0XFxuXCIgKyAvLyBELncgPSAxXG5cdFx0XHRcImNycyB2dDMueHl6LCB2dDIsIHZ0NVx0XHRcdFxcblwiICsgLy8gUyA9IEwgeCBEXG5cdFx0XHRcIm5ybSB2dDMueHl6LCB2dDMueHl6XHRcdFx0XFxuXCIgKyAvLyBub3JtYWxpemUoIFMgKVxuXG5cdFx0XHRcdC8vIGZhY2UgdGhlIHNpZGUgdmVjdG9yIHByb3Blcmx5IGZvciB0aGUgZ2l2ZW4gcG9pbnRcblx0XHRcdFwibXVsIHZ0My54eXosIHZ0My54eXosIHZhMi54eHhcdFxcblwiICsgLy8gUyAqPSB3ZWlnaHRcblx0XHRcdFwibW92IHZ0My53LCB2YzUueFx0XHRcdFxcblwiICsgLy8gUy53ID0gMVxuXG5cdFx0XHRcdC8vIGNhbGN1bGF0ZSB0aGUgYW1vdW50IHJlcXVpcmVkIHRvIG1vdmUgYXQgdGhlIHBvaW50J3MgZGlzdGFuY2UgdG8gY29ycmVzcG9uZCB0byB0aGUgbGluZSdzIHBpeGVsIHdpZHRoXG5cdFx0XHRcdC8vIHNjYWxlIHRoZSBzaWRlIHZlY3RvciBieSB0aGF0IGFtb3VudFxuXHRcdFx0XCJkcDMgdnQ0LngsIHZ0MCwgdmM2XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSA9IGRvdCggdmlldyApXG5cdFx0XHRcIm11bCB2dDQueCwgdnQ0LngsIHZjNy54XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSAqPSB2cHNvZFxuXHRcdFx0XCJtdWwgdnQzLnh5eiwgdnQzLnh5eiwgdnQ0Lnh4eFx0XFxuXCIgKyAvLyBTLnh5eiAqPSBwaXhlbFNjYWxlRmFjdG9yXG5cblx0XHRcdFx0Ly8gYWRkIHNjYWxlZCBzaWRlIHZlY3RvciB0byBRMCBhbmQgdHJhbnNmb3JtIHRvIGNsaXAgc3BhY2Vcblx0XHRcdFwiYWRkIHZ0MC54eXosIHZ0MC54eXosIHZ0My54eXpcdFxcblwiICsgLy8gUTAgKyBTXG5cblx0XHRcdFwibTQ0IG9wLCB2dDAsIHZjMFx0XHRcdFxcblwiICAvLyB0cmFuc2Zvcm0gUTAgdG8gY2xpcCBzcGFjZVxuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lBY3RpdmF0ZShwYXNzOlJlbmRlclBhc3NCYXNlLCBjYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0c3VwZXIuX2lBY3RpdmF0ZShwYXNzLCBjYW1lcmEpO1xuXG5cdFx0dGhpcy5fY29uc3RhbnRzWzBdID0gdGhpcy5fdGhpY2tuZXNzLygodGhpcy5fc3RhZ2Uuc2Npc3NvclJlY3QpPyBNYXRoLm1pbih0aGlzLl9zdGFnZS5zY2lzc29yUmVjdC53aWR0aCwgdGhpcy5fc3RhZ2Uuc2Npc3NvclJlY3QuaGVpZ2h0KSA6IE1hdGgubWluKHRoaXMuX3N0YWdlLndpZHRoLCB0aGlzLl9zdGFnZS5oZWlnaHQpKTtcblxuXHRcdC8vIHZhbHVlIHRvIGNvbnZlcnQgZGlzdGFuY2UgZnJvbSBjYW1lcmEgdG8gbW9kZWwgbGVuZ3RoIHBlciBwaXhlbCB3aWR0aFxuXHRcdHRoaXMuX2NvbnN0YW50c1syXSA9IGNhbWVyYS5wcm9qZWN0aW9uLm5lYXI7XG5cblx0XHR2YXIgY29udGV4dDpJQ29udGV4dEdMID0gdGhpcy5fc3RhZ2UuY29udGV4dDtcblxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDUsIExpbmVTdWJNZXNoUmVuZGVyYWJsZS5wT05FX1ZFQ1RPUiwgMSk7XG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgNiwgTGluZVN1Yk1lc2hSZW5kZXJhYmxlLnBGUk9OVF9WRUNUT1IsIDEpO1xuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDcsIHRoaXMuX2NvbnN0YW50cywgMSk7XG5cblx0XHQvLyBwcm9qZWN0aW9uIG1hdHJpeFxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21NYXRyaXgoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCAwLCBjYW1lcmEucHJvamVjdGlvbi5tYXRyaXgsIHRydWUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lSZW5kZXIocGFzczpSZW5kZXJQYXNzQmFzZSwgY2FtZXJhOkNhbWVyYSwgdmlld1Byb2plY3Rpb246TWF0cml4M0QpXG5cdHtcblx0XHRzdXBlci5faVJlbmRlcihwYXNzLCBjYW1lcmEsIHZpZXdQcm9qZWN0aW9uKTtcblxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xuXHRcdHRoaXMuX2NhbGNNYXRyaXguY29weUZyb20odGhpcy5zb3VyY2VFbnRpdHkuc2NlbmVUcmFuc2Zvcm0pO1xuXHRcdHRoaXMuX2NhbGNNYXRyaXguYXBwZW5kKGNhbWVyYS5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0pO1xuXG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbU1hdHJpeChDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDgsIHRoaXMuX2NhbGNNYXRyaXgsIHRydWUpO1xuXG5cdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMCwgdGhpcy5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBKSwgdGhpcy5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LlNUQVJUX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcblx0XHR0aGlzLl9zdGFnZS5hY3RpdmF0ZUJ1ZmZlcigxLCB0aGlzLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgdGhpcy5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0ZPUk1BVCk7XG5cdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMiwgdGhpcy5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQSksIHRoaXMuZ2V0VmVydGV4T2Zmc2V0KExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQSksIExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfRk9STUFUKTtcblxuXHRcdGNvbnRleHQuZHJhd1RyaWFuZ2xlcyh0aGlzLl9zdGFnZS5nZXRJbmRleEJ1ZmZlcih0aGlzLmdldEluZGV4RGF0YSgpKSwgMCwgdGhpcy5udW1UcmlhbmdsZXMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIC8vVE9ET1xuXHQgKlxuXHQgKiBAcGFyYW0gcG9vbFxuXHQgKiBAcGFyYW0gcmVuZGVyYWJsZU93bmVyXG5cdCAqIEBwYXJhbSBsZXZlbFxuXHQgKiBAcGFyYW0gaW5kZXhPZmZzZXRcblx0ICogQHJldHVybnMge2F3YXkucG9vbC5MaW5lU3ViTWVzaFJlbmRlcmFibGV9XG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwdWJsaWMgX3BHZXRPdmVyZmxvd1JlbmRlcmFibGUoaW5kZXhPZmZzZXQ6bnVtYmVyKTpSZW5kZXJhYmxlQmFzZVxuXHR7XG5cdFx0cmV0dXJuIG5ldyBMaW5lU3ViTWVzaFJlbmRlcmFibGUodGhpcy5fcG9vbCwgPExpbmVTdWJNZXNoPiB0aGlzLnJlbmRlcmFibGVPd25lciwgdGhpcy5fc3RhZ2UsIHRoaXMuX2xldmVsICsgMSwgaW5kZXhPZmZzZXQpO1xuXHR9XG59XG5cbmV4cG9ydCA9IExpbmVTdWJNZXNoUmVuZGVyYWJsZTsiXX0=