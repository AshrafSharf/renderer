var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var CurveSubGeometry = require("awayjs-display/lib/base/CurveSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var RenderableBase = require("awayjs-renderergl/lib/pool/RenderableBase");
/**
 * @class away.pool.TriangleSubMeshRenderable
 */
var CurveSubMeshRenderable = (function (_super) {
    __extends(CurveSubMeshRenderable, _super);
    /**
     * //TODO
     *
     * @param pool
     * @param subMesh
     * @param level
     * @param indexOffset
     */
    function CurveSubMeshRenderable(pool, subMesh, stage, level, indexOffset) {
        if (level === void 0) { level = 0; }
        if (indexOffset === void 0) { indexOffset = 0; }
        _super.call(this, pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);
        this._constants = new Array(0, 0, 0, 0);
        this.subMesh = subMesh;
    }
    /**
     *
     * @returns {SubGeometryBase}
     * @protected
     */
    CurveSubMeshRenderable.prototype._pGetSubGeometry = function () {
        var subGeometry;
        if (this.subMesh.animator)
            subGeometry = this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry);
        else
            subGeometry = this.subMesh.subGeometry;
        this._pVertexDataDirty[CurveSubGeometry.POSITION_DATA] = true;
        if (subGeometry.curves)
            this._pVertexDataDirty[CurveSubGeometry.CURVE_DATA] = true;
        if (subGeometry.uvs)
            this._pVertexDataDirty[CurveSubGeometry.UV_DATA] = true;
        return subGeometry;
    };
    CurveSubMeshRenderable._iIncludeDependencies = function (shaderObject) {
        shaderObject.localPosDependencies++;
    };
    CurveSubMeshRenderable._iGetVertexCode = function (shaderObject, registerCache, sharedRegisters) {
        var code = "";
        //get the projection coordinates
        var position = (shaderObject.globalPosDependencies > 0) ? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;
        //reserving vertex constants for projection matrix
        var viewMatrixReg = registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        shaderObject.viewMatrixIndex = viewMatrixReg.index * 4;
        if (shaderObject.projectionDependencies > 0) {
            sharedRegisters.projectionFragment = registerCache.getFreeVarying();
            var temp = registerCache.getFreeVertexVectorTemp();
            code += "m44 " + temp + ", " + position + ".xyw, " + viewMatrixReg + "\n" + "mov " + sharedRegisters.projectionFragment + ", " + temp + "\n" + "mov op, " + temp + "\n";
        }
        else {
            code += "mov v2 va1 \n";
            code += "m44 op, " + position + ".xyw, " + viewMatrixReg + "\n";
        }
        return code;
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable._iGetFragmentCode = function (shaderObject, registerCache, sharedRegisters) {
        var curve = "v2"; //sharedRegisters.uvVarying //shaderObject.uvTarget;
        var pos = sharedRegisters.localPositionVarying;
        var out = sharedRegisters.shadedTarget; //registerCache.fragmentOutputRegister.toString();
        var free = registerCache.getFreeFragmentVectorTemp();
        var d = free + ".x"; //registerCache.getFreeFragmentConstant().toString();
        var less = free + ".y"; //registerCache.getFreeFragmentSingleTemp().toString();
        var half = free + ".z"; //registerCache.getFreeFragmentSingleTemp().toString();
        var code = "";
        code += "mov " + d + " " + curve + ".x\n";
        code += "mul " + d + " " + d + " " + d + "\n";
        code += "sub " + d + " " + d + " " + curve + ".y\n";
        // code += "mov "+ out + " " + sharedRegisters.uvVarying+"\n";
        // code += "mul "+ d + " " + d + " " + less + "\n";
        //code += "sub "+ d + " " + d + " " + pos + ".z " + "\n";
        code += "mul " + d + " " + d + " " + pos + ".z " + "\n";
        code += "mov " + half + " fc7.x\n";
        code += "slt " + less + " " + d + " " + half + "\n";
        code += "mul " + d + " " + d + " " + less + "\n";
        code += "abs " + d + " " + d + "\n";
        // code += "kil " + less + "\n";
        //  code += "sub "+ less + " " + less + " " + pos + ".z " + "\n";
        code += "mov " + out + ".w " + less + "\n";
        console.log(code);
        return code;
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable.prototype._iActivate = function (pass, camera) {
        _super.prototype._iActivate.call(this, pass, camera);
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 7, this._constants, 1);
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable.prototype._iRender = function (pass, camera, viewProjection) {
        _super.prototype._iRender.call(this, pass, camera, viewProjection);
        var shader = pass.shader;
        if (shader.sceneMatrixIndex >= 0) {
            this.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);
            viewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);
        }
        else {
            var matrix3D = Matrix3DUtils.CALCULATION_MATRIX;
            matrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));
            matrix3D.append(viewProjection);
            matrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);
        }
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);
        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);
        this._stage.activateBuffer(0, this.getVertexData(CurveSubGeometry.POSITION_DATA), this.getVertexOffset(CurveSubGeometry.POSITION_DATA), CurveSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(1, this.getVertexData(CurveSubGeometry.CURVE_DATA), this.getVertexOffset(CurveSubGeometry.CURVE_DATA), CurveSubGeometry.CURVE_FORMAT);
        this._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);
    };
    /**
     * //TODO
     *
     * @param pool
     * @param renderableOwner
     * @param level
     * @param indexOffset
     * @returns {away.pool.TriangleSubMeshRenderable}
     * @protected
     */
    CurveSubMeshRenderable.prototype._pGetOverflowRenderable = function (indexOffset) {
        return new CurveSubMeshRenderable(this._pool, this.renderableOwner, this._stage, this._level + 1, indexOffset);
    };
    /**
     *
     */
    CurveSubMeshRenderable.id = "curvesubmesh";
    CurveSubMeshRenderable.vertexAttributesOffset = 2;
    return CurveSubMeshRenderable;
})(RenderableBase);
module.exports = CurveSubMeshRenderable;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0N1cnZlU3ViTWVzaFJlbmRlcmFibGUudHMiXSwibmFtZXMiOlsiQ3VydmVTdWJNZXNoUmVuZGVyYWJsZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuY29uc3RydWN0b3IiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9wR2V0U3ViR2VvbWV0cnkiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9pSW5jbHVkZURlcGVuZGVuY2llcyIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lHZXRWZXJ0ZXhDb2RlIiwiQ3VydmVTdWJNZXNoUmVuZGVyYWJsZS5faUdldEZyYWdtZW50Q29kZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lBY3RpdmF0ZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lSZW5kZXIiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9wR2V0T3ZlcmZsb3dSZW5kZXJhYmxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLGFBQWEsV0FBYyxvQ0FBb0MsQ0FBQyxDQUFDO0FBSXhFLElBQU8sZ0JBQWdCLFdBQWlCLDBDQUEwQyxDQUFDLENBQUM7QUFNcEYsSUFBTyxvQkFBb0IsV0FBYSw4Q0FBOEMsQ0FBQyxDQUFDO0FBTXhGLElBQU8sY0FBYyxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFJaEYsQUFHQTs7R0FERztJQUNHLHNCQUFzQjtJQUFTQSxVQUEvQkEsc0JBQXNCQSxVQUF1QkE7SUFlbERBOzs7Ozs7O09BT0dBO0lBQ0hBLFNBdkJLQSxzQkFBc0JBLENBdUJmQSxJQUF1QkEsRUFBRUEsT0FBb0JBLEVBQUVBLEtBQVdBLEVBQUVBLEtBQWdCQSxFQUFFQSxXQUFzQkE7UUFBeENDLHFCQUFnQkEsR0FBaEJBLFNBQWdCQTtRQUFFQSwyQkFBc0JBLEdBQXRCQSxlQUFzQkE7UUFFL0dBLGtCQUFNQSxJQUFJQSxFQUFFQSxPQUFPQSxDQUFDQSxVQUFVQSxFQUFFQSxPQUFPQSxFQUFFQSxP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QUNBLGdCQUFnQkEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsRUFBRUEsZ0JBQWdCQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtRQUVqS0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7SUFDaEhBLENBQUNBO0lBRURQOzs7Ozs7Ozs7T0FTR0E7SUFDSUEsd0RBQXVCQSxHQUE5QkEsVUFBK0JBLFdBQWtCQTtRQUVoRFEsTUFBTUEsQ0FBQ0EsSUFBSUEsc0JBQXNCQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFpQkEsSUFBSUEsQ0FBQ0EsZUFBZUEsRUFBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7SUFDL0hBLENBQUNBO0lBbkxEUjs7T0FFR0E7SUFDV0EseUJBQUVBLEdBQVVBLGNBQWNBLENBQUNBO0lBRTNCQSw2Q0FBc0JBLEdBQVVBLENBQUNBLENBQUNBO0lBK0tqREEsNkJBQUNBO0FBQURBLENBdExBLEFBc0xDQSxFQXRMb0MsY0FBYyxFQXNMbEQ7QUFFRCxBQUFnQyxpQkFBdkIsc0JBQXNCLENBQUMiLCJmaWxlIjoicG9vbC9DdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xyXG5pbXBvcnQgTWF0cml4M0RVdGlsc1x0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RVdGlsc1wiKTtcclxuXHJcbmltcG9ydCBJUmVuZGVyYWJsZU93bmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9JUmVuZGVyYWJsZU93bmVyXCIpO1xyXG5pbXBvcnQgQ3VydmVTdWJNZXNoXHRcdFx0XHQgICAgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvQ3VydmVTdWJNZXNoXCIpO1xyXG5pbXBvcnQgQ3VydmVTdWJHZW9tZXRyeVx0XHQgICAgXHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9DdXJ2ZVN1Ykdlb21ldHJ5XCIpO1xyXG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuXHJcbmltcG9ydCBDb250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdFwiKTtcclxuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcclxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcbmltcG9ydCBDb250ZXh0R0xQcm9ncmFtVHlwZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTFByb2dyYW1UeXBlXCIpO1xyXG5cclxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyYWJsZVBvb2xCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZVBvb2xCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyUGFzc0Jhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvUmVuZGVyUGFzc0Jhc2VcIik7XHJcblxyXG4vKipcclxuICogQGNsYXNzIGF3YXkucG9vbC5UcmlhbmdsZVN1Yk1lc2hSZW5kZXJhYmxlXHJcbiAqL1xyXG5jbGFzcyBDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlIGV4dGVuZHMgUmVuZGVyYWJsZUJhc2Vcclxue1xyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHVibGljIHN0YXRpYyBpZDpzdHJpbmcgPSBcImN1cnZlc3VibWVzaFwiO1xyXG5cclxuXHRwdWJsaWMgc3RhdGljIHZlcnRleEF0dHJpYnV0ZXNPZmZzZXQ6bnVtYmVyID0gMjtcclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgc3ViTWVzaDpDdXJ2ZVN1Yk1lc2g7XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiAvL1RPRE9cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBwb29sXHJcblx0ICogQHBhcmFtIHN1Yk1lc2hcclxuXHQgKiBAcGFyYW0gbGV2ZWxcclxuXHQgKiBAcGFyYW0gaW5kZXhPZmZzZXRcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3Rvcihwb29sOlJlbmRlcmFibGVQb29sQmFzZSwgc3ViTWVzaDpDdXJ2ZVN1Yk1lc2gsIHN0YWdlOlN0YWdlLCBsZXZlbDpudW1iZXIgPSAwLCBpbmRleE9mZnNldDpudW1iZXIgPSAwKVxyXG5cdHtcclxuXHRcdHN1cGVyKHBvb2wsIHN1Yk1lc2gucGFyZW50TWVzaCwgc3ViTWVzaCwgc3ViTWVzaC5tYXRlcmlhbCwgc3RhZ2UsIGxldmVsLCBpbmRleE9mZnNldCk7XHJcblxyXG5cdFx0dGhpcy5zdWJNZXNoID0gc3ViTWVzaDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICogQHJldHVybnMge1N1Ykdlb21ldHJ5QmFzZX1cclxuXHQgKiBAcHJvdGVjdGVkXHJcblx0ICovXHJcblx0cHVibGljIF9wR2V0U3ViR2VvbWV0cnkoKTpDdXJ2ZVN1Ykdlb21ldHJ5XHJcblx0e1xyXG5cdFx0dmFyIHN1Ykdlb21ldHJ5OkN1cnZlU3ViR2VvbWV0cnk7XHJcblxyXG5cdFx0aWYgKHRoaXMuc3ViTWVzaC5hbmltYXRvcilcclxuXHRcdFx0c3ViR2VvbWV0cnkgPSA8Q3VydmVTdWJHZW9tZXRyeT4gdGhpcy5zdWJNZXNoLmFuaW1hdG9yLmdldFJlbmRlcmFibGVTdWJHZW9tZXRyeSh0aGlzLCB0aGlzLnN1Yk1lc2guc3ViR2VvbWV0cnkpO1xyXG5cdFx0ZWxzZVxyXG5cdFx0XHRzdWJHZW9tZXRyeSA9IHRoaXMuc3ViTWVzaC5zdWJHZW9tZXRyeTtcclxuXHJcblx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0N1cnZlU3ViR2VvbWV0cnkuUE9TSVRJT05fREFUQV0gPSB0cnVlO1xyXG5cclxuXHRcdGlmIChzdWJHZW9tZXRyeS5jdXJ2ZXMpXHJcblx0XHRcdHRoaXMuX3BWZXJ0ZXhEYXRhRGlydHlbQ3VydmVTdWJHZW9tZXRyeS5DVVJWRV9EQVRBXSA9IHRydWU7XHJcblxyXG5cdFx0aWYgKHN1Ykdlb21ldHJ5LnV2cylcclxuXHRcdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtDdXJ2ZVN1Ykdlb21ldHJ5LlVWX0RBVEFdID0gdHJ1ZTtcclxuXHJcblx0XHRyZXR1cm4gc3ViR2VvbWV0cnk7XHJcblx0fVxyXG5cclxuXHJcblx0cHVibGljIHN0YXRpYyBfaUluY2x1ZGVEZXBlbmRlbmNpZXMoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UpXHJcblx0e1xyXG4gICAgICAgIHNoYWRlck9iamVjdC5sb2NhbFBvc0RlcGVuZGVuY2llcysrO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyBfaUdldFZlcnRleENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHJcblx0XHQvL2dldCB0aGUgcHJvamVjdGlvbiBjb29yZGluYXRlc1xyXG5cdFx0dmFyIHBvc2l0aW9uOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IChzaGFkZXJPYmplY3QuZ2xvYmFsUG9zRGVwZW5kZW5jaWVzID4gMCk/IHNoYXJlZFJlZ2lzdGVycy5nbG9iYWxQb3NpdGlvblZlcnRleCA6IHNoYXJlZFJlZ2lzdGVycy5sb2NhbFBvc2l0aW9uO1xyXG5cclxuXHRcdC8vcmVzZXJ2aW5nIHZlcnRleCBjb25zdGFudHMgZm9yIHByb2plY3Rpb24gbWF0cml4XHJcblx0XHR2YXIgdmlld01hdHJpeFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xyXG5cdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcclxuXHRcdHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XHJcblx0XHRyZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xyXG5cdFx0c2hhZGVyT2JqZWN0LnZpZXdNYXRyaXhJbmRleCA9IHZpZXdNYXRyaXhSZWcuaW5kZXgqNDtcclxuXHJcblxyXG5cdFx0aWYgKHNoYWRlck9iamVjdC5wcm9qZWN0aW9uRGVwZW5kZW5jaWVzID4gMCkge1xyXG5cdFx0XHRzaGFyZWRSZWdpc3RlcnMucHJvamVjdGlvbkZyYWdtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmFyeWluZygpO1xyXG5cdFx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhWZWN0b3JUZW1wKCk7XHJcblx0XHRcdGNvZGUgKz0gXCJtNDQgXCIgKyB0ZW1wICsgXCIsIFwiICsgcG9zaXRpb24gKyBcIi54eXcsIFwiICsgdmlld01hdHJpeFJlZyArIFwiXFxuXCIgK1xyXG5cdFx0XHRcIm1vdiBcIiArIHNoYXJlZFJlZ2lzdGVycy5wcm9qZWN0aW9uRnJhZ21lbnQgKyBcIiwgXCIgKyB0ZW1wICsgXCJcXG5cIiArXHJcblx0XHRcdFwibW92IG9wLCBcIiArIHRlbXAgKyBcIlxcblwiO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Y29kZSArPSBcIm1vdiB2MiB2YTEgXFxuXCI7XHJcblx0XHRcdGNvZGUgKz0gXCJtNDQgb3AsIFwiICsgcG9zaXRpb24gKyBcIi54eXcsIFwiICsgdmlld01hdHJpeFJlZyArIFwiXFxuXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW5oZXJpdERvY1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIF9pR2V0RnJhZ21lbnRDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xyXG4gICAge1xyXG4gICAgICAgIHZhciBjdXJ2ZTpTdHJpbmcgPSBcInYyXCI7Ly9zaGFyZWRSZWdpc3RlcnMudXZWYXJ5aW5nIC8vc2hhZGVyT2JqZWN0LnV2VGFyZ2V0O1xyXG4gICAgICAgIHZhciBwb3M6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLmxvY2FsUG9zaXRpb25WYXJ5aW5nO1xyXG4gICAgICAgIHZhciBvdXQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLnNoYWRlZFRhcmdldDsvL3JlZ2lzdGVyQ2FjaGUuZnJhZ21lbnRPdXRwdXRSZWdpc3Rlci50b1N0cmluZygpO1xyXG5cclxuICAgICAgICB2YXIgZnJlZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcclxuICAgICAgICB2YXIgZDpTdHJpbmcgPSBmcmVlICsgXCIueFwiOy8vcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgdmFyIGxlc3M6U3RyaW5nID0gZnJlZSArIFwiLnlcIjsvL3JlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50U2luZ2xlVGVtcCgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgdmFyIGhhbGY6U3RyaW5nID0gZnJlZSArIFwiLnpcIjsvL3JlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50U2luZ2xlVGVtcCgpLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgIHZhciBjb2RlOnN0cmluZyA9IFwiXCI7XHJcbiAgICAgICAgY29kZSArPSBcIm1vdiBcIiArIGQgKyBcIiBcIiArIGN1cnZlICsgXCIueFxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtdWwgXCIgKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBkK1wiXFxuXCI7XHJcbiAgICAgICAgY29kZSArPSBcInN1YiBcIiArIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIGN1cnZlK1wiLnlcXG5cIjtcclxuXHJcbiAgICAgICAgICAgICAvLyBjb2RlICs9IFwibW92IFwiKyBvdXQgKyBcIiBcIiArIHNoYXJlZFJlZ2lzdGVycy51dlZhcnlpbmcrXCJcXG5cIjtcclxuXHJcbiAgICAgICAvLyBjb2RlICs9IFwibXVsIFwiKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBsZXNzICsgXCJcXG5cIjtcclxuICAgICAgICAvL2NvZGUgKz0gXCJzdWIgXCIrIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIHBvcyArIFwiLnogXCIgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtdWwgXCIrIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIHBvcyArIFwiLnogXCIgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtb3YgXCIrIGhhbGYgKyBcIiBmYzcueFxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJzbHQgXCIrIGxlc3MgKyBcIiBcIiArIGQgKyBcIiBcIiArIGhhbGYgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtdWwgXCIrIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIGxlc3MgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJhYnMgXCIrIGQgKyBcIiBcIiArIGQgKyBcIlxcblwiO1xyXG4gICAgICAgLy8gY29kZSArPSBcImtpbCBcIiArIGxlc3MgKyBcIlxcblwiO1xyXG4gICAgICAvLyAgY29kZSArPSBcInN1YiBcIisgbGVzcyArIFwiIFwiICsgbGVzcyArIFwiIFwiICsgcG9zICsgXCIueiBcIiArIFwiXFxuXCI7XHJcblxyXG4gICAgICAgIGNvZGUgKz0gXCJtb3YgXCIgKyBvdXQgKyBcIi53IFwiICsgbGVzcyArIFwiXFxuXCI7XHJcbiAgICAgICAgY29uc29sZS5sb2coY29kZSk7XHJcbiAgICAgICAgcmV0dXJuIGNvZGU7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIF9jb25zdGFudHM6QXJyYXk8bnVtYmVyPiA9IG5ldyBBcnJheTxudW1iZXI+KDAsIDAsIDAsIDApO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaW5oZXJpdERvY1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgX2lBY3RpdmF0ZShwYXNzOlJlbmRlclBhc3NCYXNlLCBjYW1lcmE6Q2FtZXJhKVxyXG4gICAge1xyXG4gICAgICAgIHN1cGVyLl9pQWN0aXZhdGUocGFzcywgY2FtZXJhKTtcclxuXHJcbiAgICAgICAgdmFyIGNvbnRleHQ6SUNvbnRleHRHTCA9IHRoaXMuX3N0YWdlLmNvbnRleHQ7XHJcblxyXG4gICAgICAgIGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5GUkFHTUVOVCwgNywgdGhpcy5fY29uc3RhbnRzLCAxKTtcclxuXHJcbiAgICB9XHJcblx0LyoqXHJcblx0ICogQGluaGVyaXREb2NcclxuXHQgKi9cclxuXHRwdWJsaWMgX2lSZW5kZXIocGFzczpSZW5kZXJQYXNzQmFzZSwgY2FtZXJhOkNhbWVyYSwgdmlld1Byb2plY3Rpb246TWF0cml4M0QpXHJcblx0e1xyXG5cdFx0c3VwZXIuX2lSZW5kZXIocGFzcywgY2FtZXJhLCB2aWV3UHJvamVjdGlvbik7XHJcblxyXG5cdFx0dmFyIHNoYWRlcjpTaGFkZXJPYmplY3RCYXNlID0gcGFzcy5zaGFkZXI7XHJcblxyXG5cdFx0aWYgKHNoYWRlci5zY2VuZU1hdHJpeEluZGV4ID49IDApIHtcclxuXHRcdFx0dGhpcy5zb3VyY2VFbnRpdHkuZ2V0UmVuZGVyU2NlbmVUcmFuc2Zvcm0oY2FtZXJhKS5jb3B5UmF3RGF0YVRvKHNoYWRlci52ZXJ0ZXhDb25zdGFudERhdGEsIHNoYWRlci5zY2VuZU1hdHJpeEluZGV4LCB0cnVlKTtcclxuXHRcdFx0dmlld1Byb2plY3Rpb24uY29weVJhd0RhdGFUbyhzaGFkZXIudmVydGV4Q29uc3RhbnREYXRhLCBzaGFkZXIudmlld01hdHJpeEluZGV4LCB0cnVlKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHZhciBtYXRyaXgzRDpNYXRyaXgzRCA9IE1hdHJpeDNEVXRpbHMuQ0FMQ1VMQVRJT05fTUFUUklYO1xyXG5cclxuXHRcdFx0bWF0cml4M0QuY29weUZyb20odGhpcy5zb3VyY2VFbnRpdHkuZ2V0UmVuZGVyU2NlbmVUcmFuc2Zvcm0oY2FtZXJhKSk7XHJcblx0XHRcdG1hdHJpeDNELmFwcGVuZCh2aWV3UHJvamVjdGlvbik7XHJcblxyXG5cdFx0XHRtYXRyaXgzRC5jb3B5UmF3RGF0YVRvKHNoYWRlci52ZXJ0ZXhDb25zdGFudERhdGEsIHNoYWRlci52aWV3TWF0cml4SW5kZXgsIHRydWUpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xyXG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgMCwgc2hhZGVyLnZlcnRleENvbnN0YW50RGF0YSwgc2hhZGVyLm51bVVzZWRWZXJ0ZXhDb25zdGFudHMpO1xyXG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLkZSQUdNRU5ULCAwLCBzaGFkZXIuZnJhZ21lbnRDb25zdGFudERhdGEsIHNoYWRlci5udW1Vc2VkRnJhZ21lbnRDb25zdGFudHMpO1xyXG5cclxuXHRcdHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKDAsIHRoaXMuZ2V0VmVydGV4RGF0YShDdXJ2ZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0RBVEEpLCB0aGlzLmdldFZlcnRleE9mZnNldChDdXJ2ZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0RBVEEpLCBDdXJ2ZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0ZPUk1BVCk7XHJcbiAgICAgICAgdGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMSwgdGhpcy5nZXRWZXJ0ZXhEYXRhKEN1cnZlU3ViR2VvbWV0cnkuQ1VSVkVfREFUQSksIHRoaXMuZ2V0VmVydGV4T2Zmc2V0KEN1cnZlU3ViR2VvbWV0cnkuQ1VSVkVfREFUQSksIEN1cnZlU3ViR2VvbWV0cnkuQ1VSVkVfRk9STUFUKTtcclxuXHJcbiAgICAgICAgdGhpcy5fc3RhZ2UuY29udGV4dC5kcmF3VHJpYW5nbGVzKHRoaXMuX3N0YWdlLmdldEluZGV4QnVmZmVyKHRoaXMuZ2V0SW5kZXhEYXRhKCkpLCAwLCB0aGlzLm51bVRyaWFuZ2xlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiAvL1RPRE9cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBwb29sXHJcblx0ICogQHBhcmFtIHJlbmRlcmFibGVPd25lclxyXG5cdCAqIEBwYXJhbSBsZXZlbFxyXG5cdCAqIEBwYXJhbSBpbmRleE9mZnNldFxyXG5cdCAqIEByZXR1cm5zIHthd2F5LnBvb2wuVHJpYW5nbGVTdWJNZXNoUmVuZGVyYWJsZX1cclxuXHQgKiBAcHJvdGVjdGVkXHJcblx0ICovXHJcblx0cHVibGljIF9wR2V0T3ZlcmZsb3dSZW5kZXJhYmxlKGluZGV4T2Zmc2V0Om51bWJlcik6UmVuZGVyYWJsZUJhc2VcclxuXHR7XHJcblx0XHRyZXR1cm4gbmV3IEN1cnZlU3ViTWVzaFJlbmRlcmFibGUodGhpcy5fcG9vbCwgPEN1cnZlU3ViTWVzaD4gdGhpcy5yZW5kZXJhYmxlT3duZXIsIHRoaXMuX3N0YWdlLCB0aGlzLl9sZXZlbCArIDEsIGluZGV4T2Zmc2V0KTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCA9IEN1cnZlU3ViTWVzaFJlbmRlcmFibGU7Il19