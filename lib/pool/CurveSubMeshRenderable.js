var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var CurveSubGeometry = require("awayjs-display/lib/base/CurveSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var RenderableBase = require("awayjs-renderergl/lib/pool/RenderableBase");
/**
 * @class away.pool.TriangleSubMeshRenderable
 */
var CurveSubMeshRenderable = (function (_super) {
    __extends(CurveSubMeshRenderable, _super);
    /**
     * //TODO
     *
     * @param pool
     * @param subMesh
     * @param level
     * @param indexOffset
     */
    function CurveSubMeshRenderable(pool, subMesh, stage, level, indexOffset) {
        if (level === void 0) { level = 0; }
        if (indexOffset === void 0) { indexOffset = 0; }
        _super.call(this, pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);
        this._constants = new Array(0, 1, 2, 0.5);
        this.subMesh = subMesh;
    }
    /**
     *
     * @returns {SubGeometryBase}
     * @protected
     */
    CurveSubMeshRenderable.prototype._pGetSubGeometry = function () {
        var subGeometry;
        if (this.subMesh.animator)
            subGeometry = this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry);
        else
            subGeometry = this.subMesh.subGeometry;
        this._pVertexDataDirty[CurveSubGeometry.POSITION_DATA] = true;
        if (subGeometry.curves)
            this._pVertexDataDirty[CurveSubGeometry.CURVE_DATA] = true;
        if (subGeometry.uvs)
            this._pVertexDataDirty[CurveSubGeometry.UV_DATA] = true;
        return subGeometry;
    };
    CurveSubMeshRenderable._iIncludeDependencies = function (shaderObject) {
        shaderObject.localPosDependencies++;
    };
    CurveSubMeshRenderable._iGetVertexCode = function (shaderObject, registerCache, sharedRegisters) {
        var code = "";
        //get the projection coordinates
        var position = (shaderObject.globalPosDependencies > 0) ? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;
        //reserving vertex constants for projection matrix
        var viewMatrixReg = registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        shaderObject.viewMatrixIndex = viewMatrixReg.index * 4;
        if (shaderObject.projectionDependencies > 0) {
            sharedRegisters.projectionFragment = registerCache.getFreeVarying();
            var temp = registerCache.getFreeVertexVectorTemp();
            code += "m44 " + temp + ", " + position + ".xyw, " + viewMatrixReg + "\n" + "mov " + sharedRegisters.projectionFragment + ", " + temp + "\n" + "mov v2 va1 \n" + "mov op, " + temp + "\n";
        }
        else {
            code += "mov v2 va1 \n";
            code += "m44 op, " + position + ".xyw, " + viewMatrixReg + "\n";
        }
        return code;
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable._iGetFragmentCode = function (shaderObject, registerCache, sharedRegisters) {
        var sd = shaderObject._stage.context.standardDerivatives;
        var curve = "v2";
        var curveX = "v2.x"; //sharedRegisters.uvVarying //shaderObject.uvTarget;
        var curveY = "v2.y"; //sharedRegisters.uvVarying //shaderObject.uvTarget;
        var pos = sharedRegisters.localPositionVarying;
        var out = sharedRegisters.shadedTarget; //registerCache.fragmentOutputRegister.toString();
        //get some free registers
        var free = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(free, 1);
        var free1 = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(free1, 1);
        var free2 = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(free2, 1);
        //distance from curve
        var d = free + ".x"; //registerCache.getFreeFragmentConstant().toString();
        var less = free + ".y"; //registerCache.getFreeFragmentSingleTemp().toString();
        var half = free + ".z"; //registerCache.getFreeFragmentSingleTemp().toString();
        var px = free + ".xy";
        var pxx = free + ".x";
        var pxy = free + ".y";
        var py = free1 + ".xy";
        var pyx = free1 + ".x";
        var pyy = free1 + ".y";
        var fx = free2 + ".x";
        var fy = free2 + ".y";
        var len = free2 + ".z";
        var dist = "fc7.z";
        var code = "";
        //derivatives
        code += "ddx " + px + " " + curve + "\n";
        code += "ddy " + py + " " + curve + "\n";
        code += "mul " + fx + " " + curveX + " " + pxx + "\n";
        code += "mul " + fx + " " + fx + " " + dist + "\n";
        code += "sub " + fx + " " + fx + " " + pxy + "\n";
        code += "mul " + fy + " " + curveY + " " + pyx + "\n";
        code += "mul " + fy + " " + fy + " " + dist + "\n";
        code += "sub " + fy + " " + fy + " " + pyy + "\n";
        //len
        code += "mul " + fx + " " + fx + " " + fx + "\n";
        code += "mul " + fy + " " + fy + " " + fy + "\n";
        code += "add " + len + " " + fx + " " + fy + "\n";
        code += "sqt " + len + " " + len + "\n";
        //distance
        code += "mul " + d + " " + curveX + " " + curveX + "\n";
        code += "sub " + d + " " + d + " " + curveY + "\n";
        //flip
        code += "mul " + d + " " + d + " " + pos + ".z " + "\n";
        //code += "abs "+ d + " " + d + "\n";
        code += "div " + d + " " + d + " " + len + "\n";
        /*

        //AA
        code += "mul " + dx + " " + dx + " " + dx+"\n";
        code += "mul " + dy + " " + dy + " " + dy+"\n";
        code += "add " + t + " " + dx + " " +  dy+"\n";
        code += "sqt " + t + " " + t+"\n";
        */
        code += "sub " + d + " fc7.w " + d + "\n";
        //code += "add " + t + " " + t + " " +  t+"\n";
        //
        //	code += "add " + d + " " + d + " " + " fc7.x\n";
        // code += "mov "+ out + " " + sharedRegisters.uvVarying+"\n";
        // code += "mul "+ d + " " + d + " " + less + "\n";
        //code += "sub "+ d + " " + d + " " + pos + ".z " + "\n";
        /*
        code += "mul "+ d + " " + d + " " + pos + ".z " + "\n";
        code += "mov "+ half + " fc7.x\n";
        code += "slt "+ less + " " + d + " " + half + "\n";
        code += "mul "+ d + " " + d + " " + less + "\n";
        code += "abs "+ d + " " + d + "\n";*/
        //code += "ddx " + d + " " + curve + ".x\n";
        // code += "kil " + less + "\n";
        //  code += "sub "+ less + " " + less + " " + pos + ".z " + "\n";
        code += "mov " + out + ".w " + d + "\n";
        return code;
        /*
        var curve:String = "v2";//sharedRegisters.uvVarying //shaderObject.uvTarget;
        var pos:ShaderRegisterElement = sharedRegisters.localPositionVarying;
        var out:ShaderRegisterElement = sharedRegisters.shadedTarget;//registerCache.fragmentOutputRegister.toString();

        var free:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();
        var d:String = free + ".x";//registerCache.getFreeFragmentConstant().toString();
        var less:String = free + ".y";//registerCache.getFreeFragmentSingleTemp().toString();
        var half:String = free + ".z";//registerCache.getFreeFragmentSingleTemp().toString();

        var code:string = "";
        code += "mov " + d + " " + curve + ".x\n";
        code += "mul " + d + " " + d + " " + d+"\n";
        code += "sub " + d + " " + d + " " + curve+".y\n";

             // code += "mov "+ out + " " + sharedRegisters.uvVarying+"\n";

       // code += "mul "+ d + " " + d + " " + less + "\n";
        //code += "sub "+ d + " " + d + " " + pos + ".z " + "\n";
        code += "mul "+ d + " " + d + " " + pos + ".z " + "\n";
        code += "mov "+ half + " fc7.x\n";
        code += "slt "+ less + " " + d + " " + half + "\n";
        code += "mul "+ d + " " + d + " " + less + "\n";
        code += "abs "+ d + " " + d + "\n";
        code += "ddx " + d + " " + curve + ".x\n";
       // code += "kil " + less + "\n";
      //  code += "sub "+ less + " " + less + " " + pos + ".z " + "\n";

        code += "mov " + out + ".w " + less + "\n";
        return code;*/
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable.prototype._iActivate = function (pass, camera) {
        _super.prototype._iActivate.call(this, pass, camera);
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 7, this._constants, 1);
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable.prototype._iRender = function (pass, camera, viewProjection) {
        _super.prototype._iRender.call(this, pass, camera, viewProjection);
        var shader = pass.shader;
        if (shader.sceneMatrixIndex >= 0) {
            this.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);
            viewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);
        }
        else {
            var matrix3D = Matrix3DUtils.CALCULATION_MATRIX;
            matrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));
            matrix3D.append(viewProjection);
            matrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);
        }
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);
        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);
        this._stage.activateBuffer(0, this.getVertexData(CurveSubGeometry.POSITION_DATA), this.getVertexOffset(CurveSubGeometry.POSITION_DATA), CurveSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(1, this.getVertexData(CurveSubGeometry.CURVE_DATA), this.getVertexOffset(CurveSubGeometry.CURVE_DATA), CurveSubGeometry.CURVE_FORMAT);
        this._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);
    };
    /**
     * //TODO
     *
     * @param pool
     * @param renderableOwner
     * @param level
     * @param indexOffset
     * @returns {away.pool.TriangleSubMeshRenderable}
     * @protected
     */
    CurveSubMeshRenderable.prototype._pGetOverflowRenderable = function (indexOffset) {
        return new CurveSubMeshRenderable(this._pool, this.renderableOwner, this._stage, this._level + 1, indexOffset);
    };
    /**
     *
     */
    CurveSubMeshRenderable.id = "curvesubmesh";
    CurveSubMeshRenderable.vertexAttributesOffset = 2;
    return CurveSubMeshRenderable;
})(RenderableBase);
module.exports = CurveSubMeshRenderable;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0N1cnZlU3ViTWVzaFJlbmRlcmFibGUudHMiXSwibmFtZXMiOlsiQ3VydmVTdWJNZXNoUmVuZGVyYWJsZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuY29uc3RydWN0b3IiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9wR2V0U3ViR2VvbWV0cnkiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9pSW5jbHVkZURlcGVuZGVuY2llcyIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lHZXRWZXJ0ZXhDb2RlIiwiQ3VydmVTdWJNZXNoUmVuZGVyYWJsZS5faUdldEZyYWdtZW50Q29kZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lBY3RpdmF0ZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lSZW5kZXIiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9wR2V0T3ZlcmZsb3dSZW5kZXJhYmxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLGFBQWEsV0FBYyxvQ0FBb0MsQ0FBQyxDQUFDO0FBSXhFLElBQU8sZ0JBQWdCLFdBQWlCLDBDQUEwQyxDQUFDLENBQUM7QUFPcEYsSUFBTyxvQkFBb0IsV0FBYSw4Q0FBOEMsQ0FBQyxDQUFDO0FBTXhGLElBQU8sY0FBYyxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFJaEYsQUFHQTs7R0FERztJQUNHLHNCQUFzQjtJQUFTQSxVQUEvQkEsc0JBQXNCQSxVQUF1QkE7SUFlbERBOzs7Ozs7O09BT0dBO0lBQ0hBLFNBdkJLQSxzQkFBc0JBLENBdUJmQSxJQUF1QkEsRUFBRUEsT0FBb0JBLEVBQUVBLEtBQVdBLEVBQUVBLEtBQWdCQSxFQUFFQSxXQUFzQkE7UUFBeENDLHFCQUFnQkEsR0FBaEJBLFNBQWdCQTtRQUFFQSwyQkFBc0JBLEdBQXRCQSxlQUFzQkE7UUFFL0dBLGtCQUFNQSxJQUFJQSxFQUFFQSxPQUFPQSxDQUFDQSxVQUFVQSxFQUFFQSxPQUFPQSxFQUFFQSxP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LENBQUNBLHFCQUFxQkEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDOUNBLElBQUlBLEtBQUtBLEdBQXlCQSxhQUFhQSxDQUFDQSx5QkFBeUJBLEVBQUVBLENBQUNBO1FBQzVFQSxhQUFhQSxDQUFDQSxxQkFBcUJBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRTlDQSxBQUNBQSxxQkFEcUJBO1lBQ2pCQSxDQUFDQSxHQUFVQSxJQUFJQSxHQUFHQSxJQUFJQSxFQUFDQSxxREFBcURBO1FBQ2hGQSxJQUFJQSxJQUFJQSxHQUFVQSxJQUFJQSxHQUFHQSxJQUFJQSxFQUFDQSx1REFBdURBO1FBQ3JGQSxJQUFJQSxJQUFJQSxHQUFVQSxJQUFJQSxHQUFHQSxJQUFJQSxFQUFDQSx1REFBdURBO1FBRXJGQSxJQUFJQSxFQUFFQSxHQUFVQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUM3QkEsSUFBSUEsR0FBR0EsR0FBVUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDN0JBLElBQUlBLEdBQUdBLEdBQVVBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQzdCQSxJQUFJQSxFQUFFQSxHQUFVQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUM5QkEsSUFBSUEsR0FBR0EsR0FBVUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDOUJBLElBQUlBLEdBQUdBLEdBQVVBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBRTlCQSxJQUFJQSxFQUFFQSxHQUFVQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUM3QkEsSUFBSUEsRUFBRUEsR0FBVUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDN0JBLElBQUlBLEdBQUdBLEdBQVVBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBRzlCQSxJQUFJQSxJQUFJQSxHQUFVQSxPQUFPQSxDQUFDQTtRQUcxQkEsSUFBSUEsSUFBSUEsR0FBVUEsRUFBRUEsQ0FBQ0E7UUFFckJBLEFBQ0FBLGFBRGFBO1FBQ2JBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEVBQUVBLEdBQUdBLEdBQUdBLEdBQUdBLEtBQUtBLEdBQUNBLElBQUlBLENBQUNBO1FBQ3ZDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxFQUFFQSxHQUFHQSxHQUFHQSxHQUFHQSxLQUFLQSxHQUFDQSxJQUFJQSxDQUFDQTtRQUV2Q0EsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsRUFBRUEsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdERBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEVBQUVBLEdBQUdBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQ25EQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxFQUFFQSxHQUFHQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVsREEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsRUFBRUEsR0FBR0EsR0FBR0EsR0FBR0EsTUFBTUEsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDdERBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEVBQUVBLEdBQUdBLEdBQUdBLEdBQUdBLEVBQUVBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQ25EQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxFQUFFQSxHQUFHQSxHQUFHQSxHQUFHQSxFQUFFQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUVsREEsQUFDQUEsS0FES0E7UUFDTEEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsRUFBRUEsR0FBR0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBR0EsR0FBR0EsR0FBR0EsRUFBRUEsR0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDL0NBLElBQUlB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LEVBNlJsRDtBQUVELEFBQWdDLGlCQUF2QixzQkFBc0IsQ0FBQyIsImZpbGUiOiJwb29sL0N1cnZlU3ViTWVzaFJlbmRlcmFibGUuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1hdHJpeDNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vTWF0cml4M0RcIik7XHJcbmltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xyXG5cclxuaW1wb3J0IElSZW5kZXJhYmxlT3duZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0lSZW5kZXJhYmxlT3duZXJcIik7XHJcbmltcG9ydCBDdXJ2ZVN1Yk1lc2hcdFx0XHRcdCAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9DdXJ2ZVN1Yk1lc2hcIik7XHJcbmltcG9ydCBDdXJ2ZVN1Ykdlb21ldHJ5XHRcdCAgICBcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0N1cnZlU3ViR2VvbWV0cnlcIik7XHJcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xyXG5cclxuaW1wb3J0IENvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMVmVydGV4QnVmZmVyRm9ybWF0XCIpO1xyXG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xyXG5pbXBvcnQgQ29udGV4dFdlYkdMXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRXZWJHTFwiKTtcclxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcbmltcG9ydCBDb250ZXh0R0xQcm9ncmFtVHlwZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTFByb2dyYW1UeXBlXCIpO1xyXG5cclxuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xyXG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcclxuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xyXG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyYWJsZVBvb2xCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZVBvb2xCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyUGFzc0Jhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvUmVuZGVyUGFzc0Jhc2VcIik7XHJcblxyXG4vKipcclxuICogQGNsYXNzIGF3YXkucG9vbC5UcmlhbmdsZVN1Yk1lc2hSZW5kZXJhYmxlXHJcbiAqL1xyXG5jbGFzcyBDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlIGV4dGVuZHMgUmVuZGVyYWJsZUJhc2Vcclxue1xyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHVibGljIHN0YXRpYyBpZDpzdHJpbmcgPSBcImN1cnZlc3VibWVzaFwiO1xyXG5cclxuXHRwdWJsaWMgc3RhdGljIHZlcnRleEF0dHJpYnV0ZXNPZmZzZXQ6bnVtYmVyID0gMjtcclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgc3ViTWVzaDpDdXJ2ZVN1Yk1lc2g7XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiAvL1RPRE9cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBwb29sXHJcblx0ICogQHBhcmFtIHN1Yk1lc2hcclxuXHQgKiBAcGFyYW0gbGV2ZWxcclxuXHQgKiBAcGFyYW0gaW5kZXhPZmZzZXRcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3Rvcihwb29sOlJlbmRlcmFibGVQb29sQmFzZSwgc3ViTWVzaDpDdXJ2ZVN1Yk1lc2gsIHN0YWdlOlN0YWdlLCBsZXZlbDpudW1iZXIgPSAwLCBpbmRleE9mZnNldDpudW1iZXIgPSAwKVxyXG5cdHtcclxuXHRcdHN1cGVyKHBvb2wsIHN1Yk1lc2gucGFyZW50TWVzaCwgc3ViTWVzaCwgc3ViTWVzaC5tYXRlcmlhbCwgc3RhZ2UsIGxldmVsLCBpbmRleE9mZnNldCk7XHJcblxyXG5cdFx0dGhpcy5zdWJNZXNoID0gc3ViTWVzaDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICogQHJldHVybnMge1N1Ykdlb21ldHJ5QmFzZX1cclxuXHQgKiBAcHJvdGVjdGVkXHJcblx0ICovXHJcblx0cHVibGljIF9wR2V0U3ViR2VvbWV0cnkoKTpDdXJ2ZVN1Ykdlb21ldHJ5XHJcblx0e1xyXG5cdFx0dmFyIHN1Ykdlb21ldHJ5OkN1cnZlU3ViR2VvbWV0cnk7XHJcblxyXG5cdFx0aWYgKHRoaXMuc3ViTWVzaC5hbmltYXRvcilcclxuXHRcdFx0c3ViR2VvbWV0cnkgPSA8Q3VydmVTdWJHZW9tZXRyeT4gdGhpcy5zdWJNZXNoLmFuaW1hdG9yLmdldFJlbmRlcmFibGVTdWJHZW9tZXRyeSh0aGlzLCB0aGlzLnN1Yk1lc2guc3ViR2VvbWV0cnkpO1xyXG5cdFx0ZWxzZVxyXG5cdFx0XHRzdWJHZW9tZXRyeSA9IHRoaXMuc3ViTWVzaC5zdWJHZW9tZXRyeTtcclxuXHJcblx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0N1cnZlU3ViR2VvbWV0cnkuUE9TSVRJT05fREFUQV0gPSB0cnVlO1xyXG5cclxuXHRcdGlmIChzdWJHZW9tZXRyeS5jdXJ2ZXMpXHJcblx0XHRcdHRoaXMuX3BWZXJ0ZXhEYXRhRGlydHlbQ3VydmVTdWJHZW9tZXRyeS5DVVJWRV9EQVRBXSA9IHRydWU7XHJcblxyXG5cdFx0aWYgKHN1Ykdlb21ldHJ5LnV2cylcclxuXHRcdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtDdXJ2ZVN1Ykdlb21ldHJ5LlVWX0RBVEFdID0gdHJ1ZTtcclxuXHJcblx0XHRyZXR1cm4gc3ViR2VvbWV0cnk7XHJcblx0fVxyXG5cclxuXHJcblx0cHVibGljIHN0YXRpYyBfaUluY2x1ZGVEZXBlbmRlbmNpZXMoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UpXHJcblx0e1xyXG4gICAgICAgIHNoYWRlck9iamVjdC5sb2NhbFBvc0RlcGVuZGVuY2llcysrO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyBfaUdldFZlcnRleENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcclxuXHJcblx0XHQvL2dldCB0aGUgcHJvamVjdGlvbiBjb29yZGluYXRlc1xyXG5cdFx0dmFyIHBvc2l0aW9uOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IChzaGFkZXJPYmplY3QuZ2xvYmFsUG9zRGVwZW5kZW5jaWVzID4gMCk/IHNoYXJlZFJlZ2lzdGVycy5nbG9iYWxQb3NpdGlvblZlcnRleCA6IHNoYXJlZFJlZ2lzdGVycy5sb2NhbFBvc2l0aW9uO1xyXG5cclxuXHRcdC8vcmVzZXJ2aW5nIHZlcnRleCBjb25zdGFudHMgZm9yIHByb2plY3Rpb24gbWF0cml4XHJcblx0XHR2YXIgdmlld01hdHJpeFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xyXG5cdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcclxuXHRcdHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XHJcblx0XHRyZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xyXG5cdFx0c2hhZGVyT2JqZWN0LnZpZXdNYXRyaXhJbmRleCA9IHZpZXdNYXRyaXhSZWcuaW5kZXgqNDtcclxuXHJcblxyXG5cdFx0aWYgKHNoYWRlck9iamVjdC5wcm9qZWN0aW9uRGVwZW5kZW5jaWVzID4gMCkge1xyXG5cdFx0XHRzaGFyZWRSZWdpc3RlcnMucHJvamVjdGlvbkZyYWdtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmFyeWluZygpO1xyXG5cdFx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhWZWN0b3JUZW1wKCk7XHJcblx0XHRcdGNvZGUgKz0gXCJtNDQgXCIgKyB0ZW1wICsgXCIsIFwiICsgcG9zaXRpb24gKyBcIi54eXcsIFwiICsgdmlld01hdHJpeFJlZyArIFwiXFxuXCIgK1xyXG5cdFx0XHRcIm1vdiBcIiArIHNoYXJlZFJlZ2lzdGVycy5wcm9qZWN0aW9uRnJhZ21lbnQgKyBcIiwgXCIgKyB0ZW1wICsgXCJcXG5cIiArXHJcblx0XHRcdFwibW92IHYyIHZhMSBcXG5cIiArXHJcblx0XHRcdFwibW92IG9wLCBcIiArIHRlbXAgKyBcIlxcblwiO1xyXG5cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGNvZGUgKz0gXCJtb3YgdjIgdmExIFxcblwiO1xyXG5cdFx0XHRjb2RlICs9IFwibTQ0IG9wLCBcIiArIHBvc2l0aW9uICsgXCIueHl3LCBcIiArIHZpZXdNYXRyaXhSZWcgKyBcIlxcblwiO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0fVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW5oZXJpdERvY1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIF9pR2V0RnJhZ21lbnRDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xyXG4gICAge1xyXG5cdFx0dmFyIHNkOmJvb2xlYW4gPSAoPENvbnRleHRXZWJHTD5zaGFkZXJPYmplY3QuX3N0YWdlLmNvbnRleHQpLnN0YW5kYXJkRGVyaXZhdGl2ZXM7XHJcblxyXG5cdFx0dmFyIGN1cnZlOlN0cmluZyA9IFwidjJcIjtcclxuXHRcdHZhciBjdXJ2ZVg6U3RyaW5nID0gXCJ2Mi54XCI7Ly9zaGFyZWRSZWdpc3RlcnMudXZWYXJ5aW5nIC8vc2hhZGVyT2JqZWN0LnV2VGFyZ2V0O1xyXG5cdFx0dmFyIGN1cnZlWTpTdHJpbmcgPSBcInYyLnlcIjsvL3NoYXJlZFJlZ2lzdGVycy51dlZhcnlpbmcgLy9zaGFkZXJPYmplY3QudXZUYXJnZXQ7XHJcblx0XHR2YXIgcG9zOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHNoYXJlZFJlZ2lzdGVycy5sb2NhbFBvc2l0aW9uVmFyeWluZztcclxuXHRcdHZhciBvdXQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLnNoYWRlZFRhcmdldDsvL3JlZ2lzdGVyQ2FjaGUuZnJhZ21lbnRPdXRwdXRSZWdpc3Rlci50b1N0cmluZygpO1xyXG5cclxuXHRcdC8vZ2V0IHNvbWUgZnJlZSByZWdpc3RlcnNcclxuXHRcdHZhciBmcmVlOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xyXG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMoZnJlZSwgMSk7XHJcblx0XHR2YXIgZnJlZTE6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XHJcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyhmcmVlMSwgMSk7XHJcblx0XHR2YXIgZnJlZTI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XHJcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyhmcmVlMiwgMSk7XHJcblxyXG5cdFx0Ly9kaXN0YW5jZSBmcm9tIGN1cnZlXHJcblx0XHR2YXIgZDpTdHJpbmcgPSBmcmVlICsgXCIueFwiOy8vcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpLnRvU3RyaW5nKCk7XHJcblx0XHR2YXIgbGVzczpTdHJpbmcgPSBmcmVlICsgXCIueVwiOy8vcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRTaW5nbGVUZW1wKCkudG9TdHJpbmcoKTtcclxuXHRcdHZhciBoYWxmOlN0cmluZyA9IGZyZWUgKyBcIi56XCI7Ly9yZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFNpbmdsZVRlbXAoKS50b1N0cmluZygpO1xyXG5cclxuXHRcdHZhciBweDpTdHJpbmcgPSBmcmVlICsgXCIueHlcIjtcclxuXHRcdHZhciBweHg6U3RyaW5nID0gZnJlZSArIFwiLnhcIjtcclxuXHRcdHZhciBweHk6U3RyaW5nID0gZnJlZSArIFwiLnlcIjtcclxuXHRcdHZhciBweTpTdHJpbmcgPSBmcmVlMSArIFwiLnh5XCI7XHJcblx0XHR2YXIgcHl4OlN0cmluZyA9IGZyZWUxICsgXCIueFwiO1xyXG5cdFx0dmFyIHB5eTpTdHJpbmcgPSBmcmVlMSArIFwiLnlcIjtcclxuXHJcblx0XHR2YXIgZng6U3RyaW5nID0gZnJlZTIgKyBcIi54XCI7XHJcblx0XHR2YXIgZnk6U3RyaW5nID0gZnJlZTIgKyBcIi55XCI7XHJcblx0XHR2YXIgbGVuOlN0cmluZyA9IGZyZWUyICsgXCIuelwiO1xyXG5cclxuXHJcblx0XHR2YXIgZGlzdDpTdHJpbmcgPSBcImZjNy56XCI7XHJcblxyXG5cclxuXHRcdHZhciBjb2RlOnN0cmluZyA9IFwiXCI7XHJcblxyXG5cdFx0Ly9kZXJpdmF0aXZlc1xyXG5cdFx0Y29kZSArPSBcImRkeCBcIiArIHB4ICsgXCIgXCIgKyBjdXJ2ZStcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcImRkeSBcIiArIHB5ICsgXCIgXCIgKyBjdXJ2ZStcIlxcblwiO1xyXG5cclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBmeCArIFwiIFwiICsgY3VydmVYICsgXCIgXCIgKyBweHggKyBcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIGZ4ICsgXCIgXCIgKyBmeCArIFwiIFwiICsgZGlzdCArIFwiXFxuXCI7XHJcblx0XHRjb2RlICs9IFwic3ViIFwiICsgZnggKyBcIiBcIiArIGZ4ICsgXCIgXCIgKyBweHkgKyBcIlxcblwiO1xyXG5cclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBmeSArIFwiIFwiICsgY3VydmVZICsgXCIgXCIgKyBweXggKyBcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIGZ5ICsgXCIgXCIgKyBmeSArIFwiIFwiICsgZGlzdCArIFwiXFxuXCI7XHJcblx0XHRjb2RlICs9IFwic3ViIFwiICsgZnkgKyBcIiBcIiArIGZ5ICsgXCIgXCIgKyBweXkgKyBcIlxcblwiO1xyXG5cclxuXHRcdC8vbGVuXHJcblx0XHRjb2RlICs9IFwibXVsIFwiICsgZnggKyBcIiBcIiArIGZ4ICsgXCIgXCIgKyBmeCtcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIGZ5ICsgXCIgXCIgKyBmeSArIFwiIFwiICsgZnkrXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJhZGQgXCIgKyBsZW4gKyBcIiBcIiArIGZ4ICsgXCIgXCIgKyBmeStcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcInNxdCBcIiArIGxlbiArIFwiIFwiICsgbGVuK1wiXFxuXCI7XHJcblxyXG5cclxuXHRcdC8vZGlzdGFuY2VcclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBkICsgXCIgXCIgKyBjdXJ2ZVggKyBcIiBcIiArIGN1cnZlWCtcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcInN1YiBcIiArIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIGN1cnZlWStcIlxcblwiO1xyXG5cclxuXHRcdC8vZmxpcFxyXG5cdFx0Y29kZSArPSBcIm11bCBcIisgZCArIFwiIFwiICsgZCArIFwiIFwiICsgcG9zICsgXCIueiBcIiArIFwiXFxuXCI7XHJcblx0XHQvL2NvZGUgKz0gXCJhYnMgXCIrIGQgKyBcIiBcIiArIGQgKyBcIlxcblwiO1xyXG5cclxuXHRcdGNvZGUgKz0gXCJkaXYgXCIgKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBsZW4gK1wiXFxuXCI7XHJcblx0XHQvKlxyXG5cclxuXHRcdC8vQUFcclxuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyBkeCArIFwiIFwiICsgZHggKyBcIiBcIiArIGR4K1wiXFxuXCI7XHJcblx0XHRjb2RlICs9IFwibXVsIFwiICsgZHkgKyBcIiBcIiArIGR5ICsgXCIgXCIgKyBkeStcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcImFkZCBcIiArIHQgKyBcIiBcIiArIGR4ICsgXCIgXCIgKyAgZHkrXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJzcXQgXCIgKyB0ICsgXCIgXCIgKyB0K1wiXFxuXCI7XHJcblx0XHQqL1xyXG5cclxuXHRcdGNvZGUgKz0gXCJzdWIgXCIrIGQgKyBcIiBmYzcudyBcIiArIGQgKyBcIlxcblwiO1xyXG5cclxuXHJcblxyXG5cdFx0Ly9jb2RlICs9IFwiYWRkIFwiICsgdCArIFwiIFwiICsgdCArIFwiIFwiICsgIHQrXCJcXG5cIjtcclxuXHJcblx0Ly9cclxuXHJcblx0Ly9cdGNvZGUgKz0gXCJhZGQgXCIgKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBcIiBmYzcueFxcblwiO1xyXG5cclxuXHRcdC8vIGNvZGUgKz0gXCJtb3YgXCIrIG91dCArIFwiIFwiICsgc2hhcmVkUmVnaXN0ZXJzLnV2VmFyeWluZytcIlxcblwiO1xyXG5cclxuXHRcdC8vIGNvZGUgKz0gXCJtdWwgXCIrIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIGxlc3MgKyBcIlxcblwiO1xyXG5cdFx0Ly9jb2RlICs9IFwic3ViIFwiKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBwb3MgKyBcIi56IFwiICsgXCJcXG5cIjtcclxuXHRcdC8qXHJcblx0XHRjb2RlICs9IFwibXVsIFwiKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBwb3MgKyBcIi56IFwiICsgXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJtb3YgXCIrIGhhbGYgKyBcIiBmYzcueFxcblwiO1xyXG5cdFx0Y29kZSArPSBcInNsdCBcIisgbGVzcyArIFwiIFwiICsgZCArIFwiIFwiICsgaGFsZiArIFwiXFxuXCI7XHJcblx0XHRjb2RlICs9IFwibXVsIFwiKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBsZXNzICsgXCJcXG5cIjtcclxuXHRcdGNvZGUgKz0gXCJhYnMgXCIrIGQgKyBcIiBcIiArIGQgKyBcIlxcblwiOyovXHJcblx0XHQvL2NvZGUgKz0gXCJkZHggXCIgKyBkICsgXCIgXCIgKyBjdXJ2ZSArIFwiLnhcXG5cIjtcclxuXHRcdC8vIGNvZGUgKz0gXCJraWwgXCIgKyBsZXNzICsgXCJcXG5cIjtcclxuXHRcdC8vICBjb2RlICs9IFwic3ViIFwiKyBsZXNzICsgXCIgXCIgKyBsZXNzICsgXCIgXCIgKyBwb3MgKyBcIi56IFwiICsgXCJcXG5cIjtcclxuXHJcblx0XHRjb2RlICs9IFwibW92IFwiICsgb3V0ICsgXCIudyBcIiArIGQgKyBcIlxcblwiO1xyXG5cdFx0cmV0dXJuIGNvZGU7XHJcblx0XHQvKlxyXG4gICAgICAgIHZhciBjdXJ2ZTpTdHJpbmcgPSBcInYyXCI7Ly9zaGFyZWRSZWdpc3RlcnMudXZWYXJ5aW5nIC8vc2hhZGVyT2JqZWN0LnV2VGFyZ2V0O1xyXG4gICAgICAgIHZhciBwb3M6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLmxvY2FsUG9zaXRpb25WYXJ5aW5nO1xyXG4gICAgICAgIHZhciBvdXQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLnNoYWRlZFRhcmdldDsvL3JlZ2lzdGVyQ2FjaGUuZnJhZ21lbnRPdXRwdXRSZWdpc3Rlci50b1N0cmluZygpO1xyXG5cclxuICAgICAgICB2YXIgZnJlZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcclxuICAgICAgICB2YXIgZDpTdHJpbmcgPSBmcmVlICsgXCIueFwiOy8vcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgdmFyIGxlc3M6U3RyaW5nID0gZnJlZSArIFwiLnlcIjsvL3JlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50U2luZ2xlVGVtcCgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgdmFyIGhhbGY6U3RyaW5nID0gZnJlZSArIFwiLnpcIjsvL3JlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50U2luZ2xlVGVtcCgpLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgIHZhciBjb2RlOnN0cmluZyA9IFwiXCI7XHJcbiAgICAgICAgY29kZSArPSBcIm1vdiBcIiArIGQgKyBcIiBcIiArIGN1cnZlICsgXCIueFxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtdWwgXCIgKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBkK1wiXFxuXCI7XHJcbiAgICAgICAgY29kZSArPSBcInN1YiBcIiArIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIGN1cnZlK1wiLnlcXG5cIjtcclxuXHJcbiAgICAgICAgICAgICAvLyBjb2RlICs9IFwibW92IFwiKyBvdXQgKyBcIiBcIiArIHNoYXJlZFJlZ2lzdGVycy51dlZhcnlpbmcrXCJcXG5cIjtcclxuXHJcbiAgICAgICAvLyBjb2RlICs9IFwibXVsIFwiKyBkICsgXCIgXCIgKyBkICsgXCIgXCIgKyBsZXNzICsgXCJcXG5cIjtcclxuICAgICAgICAvL2NvZGUgKz0gXCJzdWIgXCIrIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIHBvcyArIFwiLnogXCIgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtdWwgXCIrIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIHBvcyArIFwiLnogXCIgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtb3YgXCIrIGhhbGYgKyBcIiBmYzcueFxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJzbHQgXCIrIGxlc3MgKyBcIiBcIiArIGQgKyBcIiBcIiArIGhhbGYgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJtdWwgXCIrIGQgKyBcIiBcIiArIGQgKyBcIiBcIiArIGxlc3MgKyBcIlxcblwiO1xyXG4gICAgICAgIGNvZGUgKz0gXCJhYnMgXCIrIGQgKyBcIiBcIiArIGQgKyBcIlxcblwiO1xyXG5cdFx0Y29kZSArPSBcImRkeCBcIiArIGQgKyBcIiBcIiArIGN1cnZlICsgXCIueFxcblwiO1xyXG4gICAgICAgLy8gY29kZSArPSBcImtpbCBcIiArIGxlc3MgKyBcIlxcblwiO1xyXG4gICAgICAvLyAgY29kZSArPSBcInN1YiBcIisgbGVzcyArIFwiIFwiICsgbGVzcyArIFwiIFwiICsgcG9zICsgXCIueiBcIiArIFwiXFxuXCI7XHJcblxyXG4gICAgICAgIGNvZGUgKz0gXCJtb3YgXCIgKyBvdXQgKyBcIi53IFwiICsgbGVzcyArIFwiXFxuXCI7XHJcbiAgICAgICAgcmV0dXJuIGNvZGU7Ki9cclxuICAgIH1cclxuICAgIHByaXZhdGUgX2NvbnN0YW50czpBcnJheTxudW1iZXI+ID0gbmV3IEFycmF5PG51bWJlcj4oMCwgMSwgMiwgMC41KTtcclxuICAgIC8qKlxyXG4gICAgICogQGluaGVyaXREb2NcclxuICAgICAqL1xyXG4gICAgcHVibGljIF9pQWN0aXZhdGUocGFzczpSZW5kZXJQYXNzQmFzZSwgY2FtZXJhOkNhbWVyYSlcclxuICAgIHtcclxuICAgICAgICBzdXBlci5faUFjdGl2YXRlKHBhc3MsIGNhbWVyYSk7XHJcblxyXG4gICAgICAgIHZhciBjb250ZXh0OklDb250ZXh0R0wgPSB0aGlzLl9zdGFnZS5jb250ZXh0O1xyXG5cclxuICAgICAgICBjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuRlJBR01FTlQsIDcsIHRoaXMuX2NvbnN0YW50cywgMSk7XHJcblxyXG4gICAgfVxyXG5cdC8qKlxyXG5cdCAqIEBpbmhlcml0RG9jXHJcblx0ICovXHJcblx0cHVibGljIF9pUmVuZGVyKHBhc3M6UmVuZGVyUGFzc0Jhc2UsIGNhbWVyYTpDYW1lcmEsIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEKVxyXG5cdHtcclxuXHRcdHN1cGVyLl9pUmVuZGVyKHBhc3MsIGNhbWVyYSwgdmlld1Byb2plY3Rpb24pO1xyXG5cclxuXHRcdHZhciBzaGFkZXI6U2hhZGVyT2JqZWN0QmFzZSA9IHBhc3Muc2hhZGVyO1xyXG5cclxuXHRcdGlmIChzaGFkZXIuc2NlbmVNYXRyaXhJbmRleCA+PSAwKSB7XHJcblx0XHRcdHRoaXMuc291cmNlRW50aXR5LmdldFJlbmRlclNjZW5lVHJhbnNmb3JtKGNhbWVyYSkuY29weVJhd0RhdGFUbyhzaGFkZXIudmVydGV4Q29uc3RhbnREYXRhLCBzaGFkZXIuc2NlbmVNYXRyaXhJbmRleCwgdHJ1ZSk7XHJcblx0XHRcdHZpZXdQcm9qZWN0aW9uLmNvcHlSYXdEYXRhVG8oc2hhZGVyLnZlcnRleENvbnN0YW50RGF0YSwgc2hhZGVyLnZpZXdNYXRyaXhJbmRleCwgdHJ1ZSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR2YXIgbWF0cml4M0Q6TWF0cml4M0QgPSBNYXRyaXgzRFV0aWxzLkNBTENVTEFUSU9OX01BVFJJWDtcclxuXHJcblx0XHRcdG1hdHJpeDNELmNvcHlGcm9tKHRoaXMuc291cmNlRW50aXR5LmdldFJlbmRlclNjZW5lVHJhbnNmb3JtKGNhbWVyYSkpO1xyXG5cdFx0XHRtYXRyaXgzRC5hcHBlbmQodmlld1Byb2plY3Rpb24pO1xyXG5cclxuXHRcdFx0bWF0cml4M0QuY29weVJhd0RhdGFUbyhzaGFkZXIudmVydGV4Q29uc3RhbnREYXRhLCBzaGFkZXIudmlld01hdHJpeEluZGV4LCB0cnVlKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgY29udGV4dDpJQ29udGV4dEdMID0gdGhpcy5fc3RhZ2UuY29udGV4dDtcclxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDAsIHNoYWRlci52ZXJ0ZXhDb25zdGFudERhdGEsIHNoYWRlci5udW1Vc2VkVmVydGV4Q29uc3RhbnRzKTtcclxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5GUkFHTUVOVCwgMCwgc2hhZGVyLmZyYWdtZW50Q29uc3RhbnREYXRhLCBzaGFkZXIubnVtVXNlZEZyYWdtZW50Q29uc3RhbnRzKTtcclxuXHJcblx0XHR0aGlzLl9zdGFnZS5hY3RpdmF0ZUJ1ZmZlcigwLCB0aGlzLmdldFZlcnRleERhdGEoQ3VydmVTdWJHZW9tZXRyeS5QT1NJVElPTl9EQVRBKSwgdGhpcy5nZXRWZXJ0ZXhPZmZzZXQoQ3VydmVTdWJHZW9tZXRyeS5QT1NJVElPTl9EQVRBKSwgQ3VydmVTdWJHZW9tZXRyeS5QT1NJVElPTl9GT1JNQVQpO1xyXG4gICAgICAgIHRoaXMuX3N0YWdlLmFjdGl2YXRlQnVmZmVyKDEsIHRoaXMuZ2V0VmVydGV4RGF0YShDdXJ2ZVN1Ykdlb21ldHJ5LkNVUlZFX0RBVEEpLCB0aGlzLmdldFZlcnRleE9mZnNldChDdXJ2ZVN1Ykdlb21ldHJ5LkNVUlZFX0RBVEEpLCBDdXJ2ZVN1Ykdlb21ldHJ5LkNVUlZFX0ZPUk1BVCk7XHJcblxyXG4gICAgICAgIHRoaXMuX3N0YWdlLmNvbnRleHQuZHJhd1RyaWFuZ2xlcyh0aGlzLl9zdGFnZS5nZXRJbmRleEJ1ZmZlcih0aGlzLmdldEluZGV4RGF0YSgpKSwgMCwgdGhpcy5udW1UcmlhbmdsZXMpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogLy9UT0RPXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gcG9vbFxyXG5cdCAqIEBwYXJhbSByZW5kZXJhYmxlT3duZXJcclxuXHQgKiBAcGFyYW0gbGV2ZWxcclxuXHQgKiBAcGFyYW0gaW5kZXhPZmZzZXRcclxuXHQgKiBAcmV0dXJucyB7YXdheS5wb29sLlRyaWFuZ2xlU3ViTWVzaFJlbmRlcmFibGV9XHJcblx0ICogQHByb3RlY3RlZFxyXG5cdCAqL1xyXG5cdHB1YmxpYyBfcEdldE92ZXJmbG93UmVuZGVyYWJsZShpbmRleE9mZnNldDpudW1iZXIpOlJlbmRlcmFibGVCYXNlXHJcblx0e1xyXG5cdFx0cmV0dXJuIG5ldyBDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlKHRoaXMuX3Bvb2wsIDxDdXJ2ZVN1Yk1lc2g+IHRoaXMucmVuZGVyYWJsZU93bmVyLCB0aGlzLl9zdGFnZSwgdGhpcy5fbGV2ZWwgKyAxLCBpbmRleE9mZnNldCk7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgPSBDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlOyJdfQ==