var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var CurveSubGeometry = require("awayjs-display/lib/base/CurveSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var RenderableBase = require("awayjs-renderergl/lib/pool/RenderableBase");
/**
 * @class away.pool.TriangleSubMeshRenderable
 */
var CurveSubMeshRenderable = (function (_super) {
    __extends(CurveSubMeshRenderable, _super);
    /**
     * //TODO
     *
     * @param pool
     * @param subMesh
     * @param level
     * @param indexOffset
     */
    function CurveSubMeshRenderable(pool, subMesh, stage, level, indexOffset) {
        if (level === void 0) { level = 0; }
        if (indexOffset === void 0) { indexOffset = 0; }
        _super.call(this, pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);
        this._constants = new Array(0, 1, 1, 0.5);
        this.subMesh = subMesh;
    }
    /**
     *
     * @returns {SubGeometryBase}
     * @protected
     */
    CurveSubMeshRenderable.prototype._pGetSubGeometry = function () {
        var subGeometry;
        if (this.subMesh.animator)
            subGeometry = this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry);
        else
            subGeometry = this.subMesh.subGeometry;
        this._pVertexDataDirty[CurveSubGeometry.POSITION_DATA] = true;
        if (subGeometry.curves)
            this._pVertexDataDirty[CurveSubGeometry.CURVE_DATA] = true;
        if (subGeometry.uvs)
            this._pVertexDataDirty[CurveSubGeometry.UV_DATA] = true;
        return subGeometry;
    };
    CurveSubMeshRenderable._iIncludeDependencies = function (shaderObject) {
        shaderObject.localPosDependencies++;
    };
    CurveSubMeshRenderable._iGetVertexCode = function (shaderObject, registerCache, sharedRegisters) {
        var code = "";
        //get the projection coordinates
        var position = (shaderObject.globalPosDependencies > 0) ? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;
        //reserving vertex constants for projection matrix
        var viewMatrixReg = registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        registerCache.getFreeVertexConstant();
        shaderObject.viewMatrixIndex = viewMatrixReg.index * 4;
        if (shaderObject.projectionDependencies > 0) {
            sharedRegisters.projectionFragment = registerCache.getFreeVarying();
            var temp = registerCache.getFreeVertexVectorTemp();
            code += "m44 " + temp + ", " + position + ".xyw, " + viewMatrixReg + "\n" + "mov " + sharedRegisters.projectionFragment + ", " + temp + "\n" + "mov v2 va1 \n" + "mov op, " + temp + "\n";
        }
        else {
            code += "mov v2 va1 \n";
            code += "m44 op, " + position + ".xyw, " + viewMatrixReg + "\n";
        }
        return code;
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable._iGetFragmentCode = function (shaderObject, registerCache, sharedRegisters) {
        var sd = shaderObject._stage.context.standardDerivatives;
        var pos = sharedRegisters.localPositionVarying;
        var out = sharedRegisters.shadedTarget;
        var curve = "v2";
        var curvex = "v2.x";
        var curvey = "v2.y";
        var curvez = pos + ".z";
        //get some free registers
        var free = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(free, 1);
        var free1 = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(free1, 1);
        var free2 = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(free2, 1);
        //distance from curve
        var d = free + ".x";
        var dx = free + ".y";
        var dy = free + ".z";
        var t = free + ".w";
        var d2 = free1 + ".x";
        var fixa = free1 + ".y";
        var fixb = free1 + ".z";
        var _aa = "fc7.z";
        var _1 = "fc7.y";
        var nl = "\n";
        var code = new Array();
        //distance from curve
        code.push("mul", d, curvex, curvex, nl);
        code.push("sub", d, d, curvey, nl);
        code.push("mul", d, d, curvez, nl); //flipper
        code.push("kil", d, nl);
        if (sd) {
            //derivatives
            code.push("ddx", dx, d, nl);
            code.push("ddy", dy, d, nl);
            //AA
            code.push("mul", dx, dx, dx, nl);
            code.push("mul", dy, dy, dy, nl);
            code.push("add", t, dx, dy, nl);
            code.push("sqt", t, t, nl);
            code.push("mul", t, t, _aa, nl);
            code.push("div", d, d, t, nl);
            /*LINE*/
            code.push("mov", d2, curvey, nl);
            code.push("ddx", dx, curvey, nl);
            code.push("ddy", dy, curvey, nl);
            code.push("mul", dx, dx, dx, nl);
            code.push("mul", dy, dy, dy, nl);
            code.push("add", t, dx, dy, nl);
            code.push("sqt", t, t, nl);
            code.push("mul", t, t, _aa, nl);
            code.push("div", d2, d2, t, nl);
            /**/
            //code.push("sge", fixa, curvex, _1, nl);
            code.push("slt", fixb, curvex, _1, nl);
            code.push("sub", fixa, _1, fixb, nl);
            //code.push("sub", fixb, _1, fixa, nl);
            code.push("mul", d2, d2, fixa, nl);
            code.push("mul", d, d, fixb, nl);
            code.push("add", d, d, d2, nl);
            code.push("abs", d, d, nl);
            code.push("mov", out + ".w", d, nl);
        }
        return code.join(" ");
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable.prototype._iActivate = function (pass, camera) {
        _super.prototype._iActivate.call(this, pass, camera);
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 7, this._constants, 1);
    };
    /**
     * @inheritDoc
     */
    CurveSubMeshRenderable.prototype._iRender = function (pass, camera, viewProjection) {
        _super.prototype._iRender.call(this, pass, camera, viewProjection);
        var shader = pass.shader;
        if (shader.sceneMatrixIndex >= 0) {
            this.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);
            viewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);
        }
        else {
            var matrix3D = Matrix3DUtils.CALCULATION_MATRIX;
            matrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));
            matrix3D.append(viewProjection);
            matrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);
        }
        var context = this._stage.context;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);
        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);
        this._stage.activateBuffer(0, this.getVertexData(CurveSubGeometry.POSITION_DATA), this.getVertexOffset(CurveSubGeometry.POSITION_DATA), CurveSubGeometry.POSITION_FORMAT);
        this._stage.activateBuffer(1, this.getVertexData(CurveSubGeometry.CURVE_DATA), this.getVertexOffset(CurveSubGeometry.CURVE_DATA), CurveSubGeometry.CURVE_FORMAT);
        this._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);
    };
    /**
     * //TODO
     *
     * @param pool
     * @param renderableOwner
     * @param level
     * @param indexOffset
     * @returns {away.pool.TriangleSubMeshRenderable}
     * @protected
     */
    CurveSubMeshRenderable.prototype._pGetOverflowRenderable = function (indexOffset) {
        return new CurveSubMeshRenderable(this._pool, this.renderableOwner, this._stage, this._level + 1, indexOffset);
    };
    /**
     *
     */
    CurveSubMeshRenderable.id = "curvesubmesh";
    CurveSubMeshRenderable.vertexAttributesOffset = 2;
    return CurveSubMeshRenderable;
})(RenderableBase);
module.exports = CurveSubMeshRenderable;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0N1cnZlU3ViTWVzaFJlbmRlcmFibGUudHMiXSwibmFtZXMiOlsiQ3VydmVTdWJNZXNoUmVuZGVyYWJsZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuY29uc3RydWN0b3IiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9wR2V0U3ViR2VvbWV0cnkiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9pSW5jbHVkZURlcGVuZGVuY2llcyIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lHZXRWZXJ0ZXhDb2RlIiwiQ3VydmVTdWJNZXNoUmVuZGVyYWJsZS5faUdldEZyYWdtZW50Q29kZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lBY3RpdmF0ZSIsIkN1cnZlU3ViTWVzaFJlbmRlcmFibGUuX2lSZW5kZXIiLCJDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlLl9wR2V0T3ZlcmZsb3dSZW5kZXJhYmxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFPLGFBQWEsV0FBYyxvQ0FBb0MsQ0FBQyxDQUFDO0FBSXhFLElBQU8sZ0JBQWdCLFdBQWlCLDBDQUEwQyxDQUFDLENBQUM7QUFPcEYsSUFBTyxvQkFBb0IsV0FBYSw4Q0FBOEMsQ0FBQyxDQUFDO0FBTXhGLElBQU8sY0FBYyxXQUFjLDJDQUEyQyxDQUFDLENBQUM7QUFJaEYsQUFHQTs7R0FERztJQUNHLHNCQUFzQjtJQUFTQSxVQUEvQkEsc0JBQXNCQSxVQUF1QkE7SUFlbERBOzs7Ozs7O09BT0dBO0lBQ0hBLFNBdkJLQSxzQkFBc0JBLENBdUJmQSxJQUF1QkEsRUFBRUEsT0FBb0JBLEVBQUVBLEtBQVdBLEVBQUVBLEtBQWdCQSxFQUFFQSxXQUFzQkE7UUFBeENDLHFCQUFnQkEsR0FBaEJBLFNBQWdCQTtRQUFFQSwyQkFBc0JBLEdBQXRCQSxlQUFzQkE7UUFFL0dBLGtCQUFNQSxJQUFJQSxFQUFFQSxPQUFPQSxDQUFDQSxVQUFVQSxFQUFFQSxPQUFPQSxFQUFFQSxPQUFPQSxDQUFDQSxRQUFRQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxXQUFXQSxDQUFDQSxDQUFDQTtRQTJKNUVBLGVBQVVBLEdBQWlCQSxJQUFJQSxLQUFLQSxDQUFTQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtRQXpKckVBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBO0lBQ3hCQSxDQUFDQTtJQUVERDs7OztPQUlHQTtJQUNJQSxpREFBZ0JBLEdBQXZCQTtRQUVDRSxJQUFJQSxXQUE0QkEsQ0FBQ0E7UUFFakNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBO1lBQ3pCQSxXQUFXQSxHQUFzQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0Esd0JBQXdCQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtRQUNqSEEsSUFBSUE7WUFDSEEsV0FBV0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsV0FBV0EsQ0FBQ0E7UUFFeENBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxhQUFhQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUU5REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDdEJBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxVQUFVQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUU1REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7WUFDbkJBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxPQUFPQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUV6REEsTUFBTUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7SUFDcEJBLENBQUNBO0lBR2FGLDRDQUFxQkEsR0FBbkNBLFVBQW9DQSxZQUE2QkE7UUFFMURHLFlBQVlBLENBQUNBLG9CQUFvQkEsRUFBRUEsQ0FBQ0E7SUFDM0NBLENBQUNBO0lBRWFILHNDQUFlQSxHQUE3QkEsVUFBOEJBLFlBQTZCQSxFQUFFQSxhQUFpQ0EsRUFBRUEsZUFBa0NBO1FBRWpJSSxJQUFJQSxJQUFJQSxHQUFVQSxFQUFFQSxDQUFDQTtRQUVyQkEsQUFDQUEsZ0NBRGdDQTtZQUM1QkEsUUFBUUEsR0FBeUJBLENBQUNBLFlBQVlBLENBQUNBLHFCQUFxQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBRUEsZUFBZUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxlQUFlQSxDQUFDQSxhQUFhQSxDQUFDQTtRQUVwSkEsQUFDQUEsa0RBRGtEQTtZQUM5Q0EsYUFBYUEsR0FBeUJBLGFBQWFBLENBQUNBLHFCQUFxQkEsRUFBRUEsQ0FBQ0E7UUFDaEZBLGFBQWFBLENBQUNBLHFCQUFxQkEsRUFBRUEsQ0FBQ0E7UUFDdENBLGFBQWFBLENBQUNBLHFCQUFxQkEsRUFBRUEsQ0FBQ0E7UUFDdENBLGFBQWFBLENBQUNBLHFCQUFxQkEsRUFBRUEsQ0FBQ0E7UUFDdENBLFlBQVlBLENBQUNBLGVBQWVBLEdBQUdBLGFBQWFBLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLENBQUNBO1FBR3JEQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxDQUFDQSxzQkFBc0JBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzdDQSxlQUFlQSxDQUFDQSxrQkFBa0JBLEdBQUdBLGFBQWFBLENBQUNBLGNBQWNBLEVBQUVBLENBQUNBO1lBQ3BFQSxJQUFJQSxJQUFJQSxHQUF5QkEsYUFBYUEsQ0FBQ0EsdUJBQXVCQSxFQUFFQSxDQUFDQTtZQUN6RUEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsUUFBUUEsR0FBR0EsUUFBUUEsR0FBR0EsYUFBYUEsR0FBR0EsSUFBSUEsR0FDekVBLE1BQU1BLEdBQUdBLGVBQWVBLENBQUNBLGtCQUFrQkEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FDaEVBLGVBQWVBLEdBQ2ZBLFVBQVVBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBRTFCQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxJQUFJQSxJQUFJQSxlQUFlQSxDQUFDQTtZQUN4QkEsSUFBSUEsSUFBSUEsVUFBVUEsR0FBR0EsUUFBUUEsR0FBR0EsUUFBUUEsR0FBR0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDakVBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO0lBQ2JBLENBQUNBO0lBQ0VKOztPQUVHQTtJQUNRQSx3Q0FBaUJBLEdBQS9CQSxVQUFnQ0EsWUFBNkJBLEVBQUVBLGFBQWlDQSxFQUFFQSxlQUFrQ0E7UUFFbklLLElBQUlBLEVBQUVBLEdBQTBCQSxZQUFZQSxDQUFDQSxNQUFNQSxDQUFDQSxPQUFRQSxDQUFDQSxtQkFBbUJBLENBQUNBO1FBQ2pGQSxJQUFJQSxHQUFHQSxHQUF5QkEsZUFBZUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQTtRQUNyRUEsSUFBSUEsR0FBR0EsR0FBeUJBLGVBQWVBLENBQUNBLFlBQVlBLENBQUNBO1FBRTdEQSxJQUFJQSxLQUFLQSxHQUFVQSxJQUFJQSxDQUFDQTtRQUN4QkEsSUFBSUEsTUFBTUEsR0FBVUEsTUFBTUEsQ0FBQ0E7UUFDM0JBLElBQUlBLE1BQU1BLEdBQVVBLE1BQU1BLENBQUNBO1FBQzNCQSxJQUFJQSxNQUFNQSxHQUFVQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUcvQkEsQUFDQUEseUJBRHlCQTtZQUNyQkEsSUFBSUEsR0FBeUJBLGFBQWFBLENBQUNBLHlCQUF5QkEsRUFBRUEsQ0FBQ0E7UUFDM0VBLGFBQWFBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLElBQUlBLEtBQUtBLEdBQXlCQSxhQUFhQSxDQUFDQSx5QkFBeUJBLEVBQUVBLENBQUNBO1FBQzVFQSxhQUFhQSxDQUFDQSxxQkFBcUJBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzlDQSxJQUFJQSxLQUFLQSxHQUF5QkEsYUFBYUEsQ0FBQ0EseUJBQXlCQSxFQUFFQSxDQUFDQTtRQUM1RUEsYUFBYUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU5Q0EsQUFDQUEscUJBRHFCQTtZQUNqQkEsQ0FBQ0EsR0FBVUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDM0JBLElBQUlBLEVBQUVBLEdBQVVBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQzVCQSxJQUFJQSxFQUFFQSxHQUFVQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUM1QkEsSUFBSUEsQ0FBQ0EsR0FBVUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDM0JBLElBQUlBLEVBQUVBLEdBQVVBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO1FBQzdCQSxJQUFJQSxJQUFJQSxHQUFVQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUMvQkEsSUFBSUEsSUFBSUEsR0FBVUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFL0JBLElBQUlBLEdBQUdBLEdBQVVBLE9BQU9BLENBQUNBO1FBQ3pCQSxJQUFJQSxFQUFFQSxHQUFVQSxPQUFPQSxDQUFDQTtRQUV4QkEsSUFBSUEsRUFBRUEsR0FBVUEsSUFBSUEsQ0FBQ0E7UUFFckJBLElBQUlBLElBQUlBLEdBQWtCQSxJQUFJQSxLQUFLQSxFQUFVQSxDQUFDQTtRQUU5Q0EsQUFDQUEscUJBRHFCQTtRQUNyQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBQ0EsQ0FBQ0EsRUFBRUEsTUFBTUEsRUFBRUEsTUFBTUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDdkNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLE1BQU1BLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1FBQ2xDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxNQUFNQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxTQUFTQTtRQUU1Q0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFFeEJBLEVBQUVBLENBQUFBLENBQUNBLEVBQUVBLENBQUNBLENBQ05BLENBQUNBO1lBRUFBLEFBQ0FBLGFBRGFBO1lBQ2JBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQzVCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUU1QkEsQUFDQUEsSUFESUE7WUFDSkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDaENBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQ2hDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFDQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUMvQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFFMUJBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQy9CQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUc3QkEsQUFDQUEsUUFEUUE7WUFDUkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsRUFBRUEsRUFBRUEsTUFBTUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDakNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLEVBQUVBLEVBQUVBLE1BQU1BLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQ2pDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxFQUFFQSxFQUFFQSxNQUFNQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUNqQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDakNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQ2pDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUNoQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBRWhDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUNoQ0EsQUFHQUEsSUFISUE7WUFFSkEseUNBQXlDQTtZQUN6Q0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsSUFBSUEsRUFBRUEsTUFBTUEsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDdkNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLElBQUlBLEVBQUVBLEVBQUVBLEVBQUVBLElBQUlBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQ3JDQSxBQUNBQSx1Q0FEdUNBO1lBQ3ZDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxJQUFJQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUNuQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsSUFBSUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFFakNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1lBQy9CQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUUzQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsR0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLENBQUNBO1FBQ0RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQUVFTDs7T0FFR0E7SUFDSUEs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Z0JBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLGdCQUFnQkEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFFaktBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBO0lBQ2hIQSxDQUFDQTtJQUVEUDs7Ozs7Ozs7O09BU0dBO0lBQ0lBLHdEQUF1QkEsR0FBOUJBLFVBQStCQSxXQUFrQkE7UUFFaERRLE1BQU1BLENBQUNBLElBQUlBLHNCQUFzQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBaUJBLElBQUlBLENBQUNBLGVBQWVBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLEVBQUVBLFdBQVdBLENBQUNBLENBQUNBO0lBQy9IQSxDQUFDQTtJQTNPRFI7O09BRUdBO0lBQ1dBLHlCQUFFQSxHQUFVQSxjQUFjQSxDQUFDQTtJQUUzQkEsNkNBQXNCQSxHQUFVQSxDQUFDQSxDQUFDQTtJQXVPakRBLDZCQUFDQTtBQUFEQSxDQTlPQSxBQThPQ0EsRUE5T29DLGNBQWMsRUE4T2xEO0FBRUQsQUFBZ0MsaUJBQXZCLHNCQUFzQixDQUFDIiwiZmlsZSI6InBvb2wvQ3VydmVTdWJNZXNoUmVuZGVyYWJsZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xuXG5pbXBvcnQgSVJlbmRlcmFibGVPd25lclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvSVJlbmRlcmFibGVPd25lclwiKTtcbmltcG9ydCBDdXJ2ZVN1Yk1lc2hcdFx0XHRcdCAgICA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9DdXJ2ZVN1Yk1lc2hcIik7XG5pbXBvcnQgQ3VydmVTdWJHZW9tZXRyeVx0XHQgICAgXHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9DdXJ2ZVN1Ykdlb21ldHJ5XCIpO1xuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5cbmltcG9ydCBDb250ZXh0R0xWZXJ0ZXhCdWZmZXJGb3JtYXRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTFZlcnRleEJ1ZmZlckZvcm1hdFwiKTtcbmltcG9ydCBJQ29udGV4dEdMXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0lDb250ZXh0R0xcIik7XG5pbXBvcnQgQ29udGV4dFdlYkdMXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRXZWJHTFwiKTtcbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuaW1wb3J0IENvbnRleHRHTFByb2dyYW1UeXBlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMUHJvZ3JhbVR5cGVcIik7XG5cbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckNhY2hlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XG5pbXBvcnQgUmVuZGVyYWJsZVBvb2xCYXNlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZVBvb2xCYXNlXCIpO1xuaW1wb3J0IFJlbmRlclBhc3NCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcGFzc2VzL1JlbmRlclBhc3NCYXNlXCIpO1xuXG4vKipcbiAqIEBjbGFzcyBhd2F5LnBvb2wuVHJpYW5nbGVTdWJNZXNoUmVuZGVyYWJsZVxuICovXG5jbGFzcyBDdXJ2ZVN1Yk1lc2hSZW5kZXJhYmxlIGV4dGVuZHMgUmVuZGVyYWJsZUJhc2Vcbntcblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgc3RhdGljIGlkOnN0cmluZyA9IFwiY3VydmVzdWJtZXNoXCI7XG5cblx0cHVibGljIHN0YXRpYyB2ZXJ0ZXhBdHRyaWJ1dGVzT2Zmc2V0Om51bWJlciA9IDI7XG5cblx0LyoqXG5cdCAqXG5cdCAqL1xuXHRwdWJsaWMgc3ViTWVzaDpDdXJ2ZVN1Yk1lc2g7XG5cblxuXHQvKipcblx0ICogLy9UT0RPXG5cdCAqXG5cdCAqIEBwYXJhbSBwb29sXG5cdCAqIEBwYXJhbSBzdWJNZXNoXG5cdCAqIEBwYXJhbSBsZXZlbFxuXHQgKiBAcGFyYW0gaW5kZXhPZmZzZXRcblx0ICovXG5cdGNvbnN0cnVjdG9yKHBvb2w6UmVuZGVyYWJsZVBvb2xCYXNlLCBzdWJNZXNoOkN1cnZlU3ViTWVzaCwgc3RhZ2U6U3RhZ2UsIGxldmVsOm51bWJlciA9IDAsIGluZGV4T2Zmc2V0Om51bWJlciA9IDApXG5cdHtcblx0XHRzdXBlcihwb29sLCBzdWJNZXNoLnBhcmVudE1lc2gsIHN1Yk1lc2gsIHN1Yk1lc2gubWF0ZXJpYWwsIHN0YWdlLCBsZXZlbCwgaW5kZXhPZmZzZXQpO1xuXG5cdFx0dGhpcy5zdWJNZXNoID0gc3ViTWVzaDtcblx0fVxuXG5cdC8qKlxuXHQgKlxuXHQgKiBAcmV0dXJucyB7U3ViR2VvbWV0cnlCYXNlfVxuXHQgKiBAcHJvdGVjdGVkXG5cdCAqL1xuXHRwdWJsaWMgX3BHZXRTdWJHZW9tZXRyeSgpOkN1cnZlU3ViR2VvbWV0cnlcblx0e1xuXHRcdHZhciBzdWJHZW9tZXRyeTpDdXJ2ZVN1Ykdlb21ldHJ5O1xuXG5cdFx0aWYgKHRoaXMuc3ViTWVzaC5hbmltYXRvcilcblx0XHRcdHN1Ykdlb21ldHJ5ID0gPEN1cnZlU3ViR2VvbWV0cnk+IHRoaXMuc3ViTWVzaC5hbmltYXRvci5nZXRSZW5kZXJhYmxlU3ViR2VvbWV0cnkodGhpcywgdGhpcy5zdWJNZXNoLnN1Ykdlb21ldHJ5KTtcblx0XHRlbHNlXG5cdFx0XHRzdWJHZW9tZXRyeSA9IHRoaXMuc3ViTWVzaC5zdWJHZW9tZXRyeTtcblxuXHRcdHRoaXMuX3BWZXJ0ZXhEYXRhRGlydHlbQ3VydmVTdWJHZW9tZXRyeS5QT1NJVElPTl9EQVRBXSA9IHRydWU7XG5cblx0XHRpZiAoc3ViR2VvbWV0cnkuY3VydmVzKVxuXHRcdFx0dGhpcy5fcFZlcnRleERhdGFEaXJ0eVtDdXJ2ZVN1Ykdlb21ldHJ5LkNVUlZFX0RBVEFdID0gdHJ1ZTtcblxuXHRcdGlmIChzdWJHZW9tZXRyeS51dnMpXG5cdFx0XHR0aGlzLl9wVmVydGV4RGF0YURpcnR5W0N1cnZlU3ViR2VvbWV0cnkuVVZfREFUQV0gPSB0cnVlO1xuXG5cdFx0cmV0dXJuIHN1Ykdlb21ldHJ5O1xuXHR9XG5cblxuXHRwdWJsaWMgc3RhdGljIF9pSW5jbHVkZURlcGVuZGVuY2llcyhzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSlcblx0e1xuICAgICAgICBzaGFkZXJPYmplY3QubG9jYWxQb3NEZXBlbmRlbmNpZXMrKztcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgX2lHZXRWZXJ0ZXhDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblxuXHRcdC8vZ2V0IHRoZSBwcm9qZWN0aW9uIGNvb3JkaW5hdGVzXG5cdFx0dmFyIHBvc2l0aW9uOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IChzaGFkZXJPYmplY3QuZ2xvYmFsUG9zRGVwZW5kZW5jaWVzID4gMCk/IHNoYXJlZFJlZ2lzdGVycy5nbG9iYWxQb3NpdGlvblZlcnRleCA6IHNoYXJlZFJlZ2lzdGVycy5sb2NhbFBvc2l0aW9uO1xuXG5cdFx0Ly9yZXNlcnZpbmcgdmVydGV4IGNvbnN0YW50cyBmb3IgcHJvamVjdGlvbiBtYXRyaXhcblx0XHR2YXIgdmlld01hdHJpeFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXHRcdHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XG5cdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHRyZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXHRcdHNoYWRlck9iamVjdC52aWV3TWF0cml4SW5kZXggPSB2aWV3TWF0cml4UmVnLmluZGV4KjQ7XG5cblxuXHRcdGlmIChzaGFkZXJPYmplY3QucHJvamVjdGlvbkRlcGVuZGVuY2llcyA+IDApIHtcblx0XHRcdHNoYXJlZFJlZ2lzdGVycy5wcm9qZWN0aW9uRnJhZ21lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWYXJ5aW5nKCk7XG5cdFx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhWZWN0b3JUZW1wKCk7XG5cdFx0XHRjb2RlICs9IFwibTQ0IFwiICsgdGVtcCArIFwiLCBcIiArIHBvc2l0aW9uICsgXCIueHl3LCBcIiArIHZpZXdNYXRyaXhSZWcgKyBcIlxcblwiICtcblx0XHRcdFwibW92IFwiICsgc2hhcmVkUmVnaXN0ZXJzLnByb2plY3Rpb25GcmFnbWVudCArIFwiLCBcIiArIHRlbXAgKyBcIlxcblwiICtcblx0XHRcdFwibW92IHYyIHZhMSBcXG5cIiArXG5cdFx0XHRcIm1vdiBvcCwgXCIgKyB0ZW1wICsgXCJcXG5cIjtcblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb2RlICs9IFwibW92IHYyIHZhMSBcXG5cIjtcblx0XHRcdGNvZGUgKz0gXCJtNDQgb3AsIFwiICsgcG9zaXRpb24gKyBcIi54eXcsIFwiICsgdmlld01hdHJpeFJlZyArIFwiXFxuXCI7XG5cdFx0fVxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG4gICAgLyoqXG4gICAgICogQGluaGVyaXREb2NcbiAgICAgKi9cblx0cHVibGljIHN0YXRpYyBfaUdldEZyYWdtZW50Q29kZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgcmVnaXN0ZXJDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHZhciBzZDpib29sZWFuID0gKDxDb250ZXh0V2ViR0w+c2hhZGVyT2JqZWN0Ll9zdGFnZS5jb250ZXh0KS5zdGFuZGFyZERlcml2YXRpdmVzO1xuXHRcdHZhciBwb3M6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLmxvY2FsUG9zaXRpb25WYXJ5aW5nO1xuXHRcdHZhciBvdXQ6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gc2hhcmVkUmVnaXN0ZXJzLnNoYWRlZFRhcmdldDtcblxuXHRcdHZhciBjdXJ2ZTpzdHJpbmcgPSBcInYyXCI7XG5cdFx0dmFyIGN1cnZleDpzdHJpbmcgPSBcInYyLnhcIjtcblx0XHR2YXIgY3VydmV5OnN0cmluZyA9IFwidjIueVwiO1xuXHRcdHZhciBjdXJ2ZXo6c3RyaW5nID0gcG9zICsgXCIuelwiO1xuXG5cblx0XHQvL2dldCBzb21lIGZyZWUgcmVnaXN0ZXJzXG5cdFx0dmFyIGZyZWU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMoZnJlZSwgMSk7XG5cdFx0dmFyIGZyZWUxOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdHJlZ2lzdGVyQ2FjaGUuYWRkRnJhZ21lbnRUZW1wVXNhZ2VzKGZyZWUxLCAxKTtcblx0XHR2YXIgZnJlZTI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXMoZnJlZTIsIDEpO1xuXG5cdFx0Ly9kaXN0YW5jZSBmcm9tIGN1cnZlXG5cdFx0dmFyIGQ6c3RyaW5nID0gZnJlZSArIFwiLnhcIjtcblx0XHR2YXIgZHg6c3RyaW5nID0gZnJlZSArIFwiLnlcIjtcblx0XHR2YXIgZHk6c3RyaW5nID0gZnJlZSArIFwiLnpcIjtcblx0XHR2YXIgdDpzdHJpbmcgPSBmcmVlICsgXCIud1wiO1xuXHRcdHZhciBkMjpzdHJpbmcgPSBmcmVlMSArIFwiLnhcIjtcblx0XHR2YXIgZml4YTpzdHJpbmcgPSBmcmVlMSArIFwiLnlcIjtcblx0XHR2YXIgZml4YjpzdHJpbmcgPSBmcmVlMSArIFwiLnpcIjtcblxuXHRcdHZhciBfYWE6c3RyaW5nID0gXCJmYzcuelwiO1xuXHRcdHZhciBfMTpzdHJpbmcgPSBcImZjNy55XCI7XG5cblx0XHR2YXIgbmw6c3RyaW5nID0gXCJcXG5cIjtcblxuXHRcdHZhciBjb2RlOkFycmF5PHN0cmluZz4gPSAgbmV3IEFycmF5PHN0cmluZz4oKTtcblxuXHRcdC8vZGlzdGFuY2UgZnJvbSBjdXJ2ZVxuXHRcdGNvZGUucHVzaChcIm11bFwiLGQsIGN1cnZleCwgY3VydmV4LCBubCk7XG5cdFx0Y29kZS5wdXNoKFwic3ViXCIsZCwgZCwgY3VydmV5LCBubCk7XG5cdFx0Y29kZS5wdXNoKFwibXVsXCIsZCwgZCwgY3VydmV6LCBubCk7XHQvL2ZsaXBwZXJcblxuXHRcdGNvZGUucHVzaChcImtpbFwiICxkLCBubCk7XG5cblx0XHRpZihzZClcblx0XHR7XG5cblx0XHRcdC8vZGVyaXZhdGl2ZXNcblx0XHRcdGNvZGUucHVzaChcImRkeFwiLCBkeCwgZCwgbmwpO1xuXHRcdFx0Y29kZS5wdXNoKFwiZGR5XCIsIGR5LCBkLCBubCk7XG5cblx0XHRcdC8vQUFcblx0XHRcdGNvZGUucHVzaChcIm11bFwiLGR4LCBkeCwgZHgsIG5sKTtcblx0XHRcdGNvZGUucHVzaChcIm11bFwiLGR5LCBkeSwgZHksIG5sKTtcblx0XHRcdGNvZGUucHVzaChcImFkZFwiLHQsIGR4LCBkeSwgbmwpO1xuXHRcdFx0Y29kZS5wdXNoKFwic3F0XCIsdCwgdCwgbmwpO1xuXG5cdFx0XHRjb2RlLnB1c2goXCJtdWxcIix0LCB0LCBfYWEsIG5sKTtcblx0XHRcdGNvZGUucHVzaChcImRpdlwiLGQsIGQsIHQsIG5sKTtcblxuXG5cdFx0XHQvKkxJTkUqL1xuXHRcdFx0Y29kZS5wdXNoKFwibW92XCIsIGQyLCBjdXJ2ZXksIG5sKTtcblx0XHRcdGNvZGUucHVzaChcImRkeFwiLCBkeCwgY3VydmV5LCBubCk7XG5cdFx0XHRjb2RlLnB1c2goXCJkZHlcIiwgZHksIGN1cnZleSwgbmwpO1xuXHRcdFx0Y29kZS5wdXNoKFwibXVsXCIsIGR4LCBkeCwgZHgsIG5sKTtcblx0XHRcdGNvZGUucHVzaChcIm11bFwiLCBkeSwgZHksIGR5LCBubCk7XG5cdFx0XHRjb2RlLnB1c2goXCJhZGRcIiwgdCwgZHgsIGR5LCBubCk7XG5cdFx0XHRjb2RlLnB1c2goXCJzcXRcIiwgdCwgdCwgbmwpO1xuXHRcdFx0Y29kZS5wdXNoKFwibXVsXCIsIHQsIHQsIF9hYSwgbmwpO1xuXG5cdFx0XHRjb2RlLnB1c2goXCJkaXZcIiwgZDIsIGQyLCB0LCBubCk7XG5cdFx0XHQvKiovXG5cblx0XHRcdC8vY29kZS5wdXNoKFwic2dlXCIsIGZpeGEsIGN1cnZleCwgXzEsIG5sKTtcblx0XHRcdGNvZGUucHVzaChcInNsdFwiLCBmaXhiLCBjdXJ2ZXgsIF8xLCBubCk7XG5cdFx0XHRjb2RlLnB1c2goXCJzdWJcIiwgZml4YSwgXzEsIGZpeGIsIG5sKTtcblx0XHRcdC8vY29kZS5wdXNoKFwic3ViXCIsIGZpeGIsIF8xLCBmaXhhLCBubCk7XG5cdFx0XHRjb2RlLnB1c2goXCJtdWxcIiwgZDIsIGQyLCBmaXhhLCBubCk7XG5cdFx0XHRjb2RlLnB1c2goXCJtdWxcIiwgZCwgZCwgZml4YiwgbmwpO1xuXG5cdFx0XHRjb2RlLnB1c2goXCJhZGRcIiwgZCwgZCwgZDIsIG5sKTtcblx0XHRcdGNvZGUucHVzaChcImFic1wiLCBkLCBkLCBubCk7XG5cblx0XHRcdGNvZGUucHVzaChcIm1vdlwiLCBvdXQrXCIud1wiLCBkLCBubCk7XG5cdFx0fVxuXHRcdHJldHVybiBjb2RlLmpvaW4oXCIgXCIpO1xuXHR9XG4gICAgcHJpdmF0ZSBfY29uc3RhbnRzOkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigwLCAxLCAxLCAwLjUpO1xuICAgIC8qKlxuICAgICAqIEBpbmhlcml0RG9jXG4gICAgICovXG4gICAgcHVibGljIF9pQWN0aXZhdGUocGFzczpSZW5kZXJQYXNzQmFzZSwgY2FtZXJhOkNhbWVyYSlcbiAgICB7XG4gICAgICAgIHN1cGVyLl9pQWN0aXZhdGUocGFzcywgY2FtZXJhKTtcblxuICAgICAgICB2YXIgY29udGV4dDpJQ29udGV4dEdMID0gdGhpcy5fc3RhZ2UuY29udGV4dDtcblxuICAgICAgICBjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuRlJBR01FTlQsIDcsIHRoaXMuX2NvbnN0YW50cywgMSk7XG5cbiAgICB9XG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pUmVuZGVyKHBhc3M6UmVuZGVyUGFzc0Jhc2UsIGNhbWVyYTpDYW1lcmEsIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEKVxuXHR7XG5cdFx0c3VwZXIuX2lSZW5kZXIocGFzcywgY2FtZXJhLCB2aWV3UHJvamVjdGlvbik7XG5cblx0XHR2YXIgc2hhZGVyOlNoYWRlck9iamVjdEJhc2UgPSBwYXNzLnNoYWRlcjtcblxuXHRcdGlmIChzaGFkZXIuc2NlbmVNYXRyaXhJbmRleCA+PSAwKSB7XG5cdFx0XHR0aGlzLnNvdXJjZUVudGl0eS5nZXRSZW5kZXJTY2VuZVRyYW5zZm9ybShjYW1lcmEpLmNvcHlSYXdEYXRhVG8oc2hhZGVyLnZlcnRleENvbnN0YW50RGF0YSwgc2hhZGVyLnNjZW5lTWF0cml4SW5kZXgsIHRydWUpO1xuXHRcdFx0dmlld1Byb2plY3Rpb24uY29weVJhd0RhdGFUbyhzaGFkZXIudmVydGV4Q29uc3RhbnREYXRhLCBzaGFkZXIudmlld01hdHJpeEluZGV4LCB0cnVlKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmFyIG1hdHJpeDNEOk1hdHJpeDNEID0gTWF0cml4M0RVdGlscy5DQUxDVUxBVElPTl9NQVRSSVg7XG5cblx0XHRcdG1hdHJpeDNELmNvcHlGcm9tKHRoaXMuc291cmNlRW50aXR5LmdldFJlbmRlclNjZW5lVHJhbnNmb3JtKGNhbWVyYSkpO1xuXHRcdFx0bWF0cml4M0QuYXBwZW5kKHZpZXdQcm9qZWN0aW9uKTtcblxuXHRcdFx0bWF0cml4M0QuY29weVJhd0RhdGFUbyhzaGFkZXIudmVydGV4Q29uc3RhbnREYXRhLCBzaGFkZXIudmlld01hdHJpeEluZGV4LCB0cnVlKTtcblx0XHR9XG5cblx0XHR2YXIgY29udGV4dDpJQ29udGV4dEdMID0gdGhpcy5fc3RhZ2UuY29udGV4dDtcblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCAwLCBzaGFkZXIudmVydGV4Q29uc3RhbnREYXRhLCBzaGFkZXIubnVtVXNlZFZlcnRleENvbnN0YW50cyk7XG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLkZSQUdNRU5ULCAwLCBzaGFkZXIuZnJhZ21lbnRDb25zdGFudERhdGEsIHNoYWRlci5udW1Vc2VkRnJhZ21lbnRDb25zdGFudHMpO1xuXG5cdFx0dGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMCwgdGhpcy5nZXRWZXJ0ZXhEYXRhKEN1cnZlU3ViR2VvbWV0cnkuUE9TSVRJT05fREFUQSksIHRoaXMuZ2V0VmVydGV4T2Zmc2V0KEN1cnZlU3ViR2VvbWV0cnkuUE9TSVRJT05fREFUQSksIEN1cnZlU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcbiAgICAgICAgdGhpcy5fc3RhZ2UuYWN0aXZhdGVCdWZmZXIoMSwgdGhpcy5nZXRWZXJ0ZXhEYXRhKEN1cnZlU3ViR2VvbWV0cnkuQ1VSVkVfREFUQSksIHRoaXMuZ2V0VmVydGV4T2Zmc2V0KEN1cnZlU3ViR2VvbWV0cnkuQ1VSVkVfREFUQSksIEN1cnZlU3ViR2VvbWV0cnkuQ1VSVkVfRk9STUFUKTtcblxuICAgICAgICB0aGlzLl9zdGFnZS5jb250ZXh0LmRyYXdUcmlhbmdsZXModGhpcy5fc3RhZ2UuZ2V0SW5kZXhCdWZmZXIodGhpcy5nZXRJbmRleERhdGEoKSksIDAsIHRoaXMubnVtVHJpYW5nbGVzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiAvL1RPRE9cblx0ICpcblx0ICogQHBhcmFtIHBvb2xcblx0ICogQHBhcmFtIHJlbmRlcmFibGVPd25lclxuXHQgKiBAcGFyYW0gbGV2ZWxcblx0ICogQHBhcmFtIGluZGV4T2Zmc2V0XG5cdCAqIEByZXR1cm5zIHthd2F5LnBvb2wuVHJpYW5nbGVTdWJNZXNoUmVuZGVyYWJsZX1cblx0ICogQHByb3RlY3RlZFxuXHQgKi9cblx0cHVibGljIF9wR2V0T3ZlcmZsb3dSZW5kZXJhYmxlKGluZGV4T2Zmc2V0Om51bWJlcik6UmVuZGVyYWJsZUJhc2Vcblx0e1xuXHRcdHJldHVybiBuZXcgQ3VydmVTdWJNZXNoUmVuZGVyYWJsZSh0aGlzLl9wb29sLCA8Q3VydmVTdWJNZXNoPiB0aGlzLnJlbmRlcmFibGVPd25lciwgdGhpcy5fc3RhZ2UsIHRoaXMuX2xldmVsICsgMSwgaW5kZXhPZmZzZXQpO1xuXHR9XG59XG5cbmV4cG9ydCA9IEN1cnZlU3ViTWVzaFJlbmRlcmFibGU7Il19