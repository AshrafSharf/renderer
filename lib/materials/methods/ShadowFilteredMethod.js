var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var ShadowMethodBase = require("awayjs-renderergl/lib/materials/methods/ShadowMethodBase");
/**
 * ShadowFilteredMethod provides a softened shadowing technique by bilinearly interpolating shadow comparison
 * results of neighbouring pixels.
 */
var ShadowFilteredMethod = (function (_super) {
    __extends(ShadowFilteredMethod, _super);
    /**
     * Creates a new DiffuseBasicMethod object.
     *
     * @param castingLight The light casting the shadow
     */
    function ShadowFilteredMethod(castingLight) {
        _super.call(this, castingLight);
    }
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        _super.prototype.iInitConstants.call(this, shaderObject, methodVO);
        var fragmentData = shaderObject.fragmentConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index + 8] = .5;
        var size = this.castingLight.shadowMapper.depthMapSize;
        fragmentData[index + 9] = size;
        fragmentData[index + 10] = 1 / size;
    };
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype._pGetPlanarFragmentCode = function (methodVO, targetReg, regCache, sharedRegisters) {
        var depthMapRegister = regCache.getFreeTextureReg();
        var decReg = regCache.getFreeFragmentConstant();
        var dataReg = regCache.getFreeFragmentConstant();
        // TODO: not used
        dataReg = dataReg;
        var customDataReg = regCache.getFreeFragmentConstant();
        var depthCol = regCache.getFreeFragmentVectorTemp();
        var uvReg;
        var code = "";
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        regCache.addFragmentTempUsages(depthCol, 1);
        uvReg = regCache.getFreeFragmentVectorTemp();
        regCache.addFragmentTempUsages(uvReg, 1);
        code += "mov " + uvReg + ", " + this._pDepthMapCoordReg + "\n" + "tex " + depthCol + ", " + this._pDepthMapCoordReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".z, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "add " + uvReg + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".z\n" + "tex " + depthCol + ", " + uvReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".w, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "mul " + depthCol + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".y\n" + "frc " + depthCol + ".x, " + depthCol + ".x\n" + "sub " + uvReg + ".w, " + uvReg + ".w, " + uvReg + ".z\n" + "mul " + uvReg + ".w, " + uvReg + ".w, " + depthCol + ".x\n" + "add " + targetReg + ".w, " + uvReg + ".z, " + uvReg + ".w\n" + "mov " + uvReg + ".x, " + this._pDepthMapCoordReg + ".x\n" + "add " + uvReg + ".y, " + this._pDepthMapCoordReg + ".y, " + customDataReg + ".z\n" + "tex " + depthCol + ", " + uvReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".z, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "add " + uvReg + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".z\n" + "tex " + depthCol + ", " + uvReg + ", " + depthMapRegister + " <2d, nearest, clamp>\n" + "dp4 " + depthCol + ".z, " + depthCol + ", " + decReg + "\n" + "slt " + uvReg + ".w, " + this._pDepthMapCoordReg + ".z, " + depthCol + ".z\n" + "mul " + depthCol + ".x, " + this._pDepthMapCoordReg + ".x, " + customDataReg + ".y\n" + "frc " + depthCol + ".x, " + depthCol + ".x\n" + "sub " + uvReg + ".w, " + uvReg + ".w, " + uvReg + ".z\n" + "mul " + uvReg + ".w, " + uvReg + ".w, " + depthCol + ".x\n" + "add " + uvReg + ".w, " + uvReg + ".z, " + uvReg + ".w\n" + "mul " + depthCol + ".x, " + this._pDepthMapCoordReg + ".y, " + customDataReg + ".y\n" + "frc " + depthCol + ".x, " + depthCol + ".x\n" + "sub " + uvReg + ".w, " + uvReg + ".w, " + targetReg + ".w\n" + "mul " + uvReg + ".w, " + uvReg + ".w, " + depthCol + ".x\n" + "add " + targetReg + ".w, " + targetReg + ".w, " + uvReg + ".w\n";
        regCache.removeFragmentTempUsage(depthCol);
        regCache.removeFragmentTempUsage(uvReg);
        methodVO.texturesIndex = depthMapRegister.index;
        return code;
    };
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype.iActivateForCascade = function (shaderObject, methodVO, stage) {
        var size = this.castingLight.shadowMapper.depthMapSize;
        var index = methodVO.secondaryFragmentConstantsIndex;
        var data = shaderObject.fragmentConstantData;
        data[index] = size;
        data[index + 1] = 1 / size;
    };
    /**
     * @inheritDoc
     */
    ShadowFilteredMethod.prototype._iGetCascadeFragmentCode = function (shaderObject, methodVO, decodeRegister, depthTexture, depthProjection, targetRegister, registerCache, sharedRegisters) {
        var code;
        var dataReg = registerCache.getFreeFragmentConstant();
        methodVO.secondaryFragmentConstantsIndex = dataReg.index * 4;
        var temp = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(temp, 1);
        var predicate = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(predicate, 1);
        code = "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".x, " + depthProjection + ".z, " + temp + ".z\n" + "add " + depthProjection + ".x, " + depthProjection + ".x, " + dataReg + ".y\n" + "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".z, " + depthProjection + ".z, " + temp + ".z\n" + "add " + depthProjection + ".y, " + depthProjection + ".y, " + dataReg + ".y\n" + "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".w, " + depthProjection + ".z, " + temp + ".z\n" + "sub " + depthProjection + ".x, " + depthProjection + ".x, " + dataReg + ".y\n" + "tex " + temp + ", " + depthProjection + ", " + depthTexture + " <2d, nearest, clamp>\n" + "dp4 " + temp + ".z, " + temp + ", " + decodeRegister + "\n" + "slt " + predicate + ".y, " + depthProjection + ".z, " + temp + ".z\n" + "mul " + temp + ".xy, " + depthProjection + ".xy, " + dataReg + ".x\n" + "frc " + temp + ".xy, " + temp + ".xy\n" + "sub " + depthProjection + ", " + predicate + ".xyzw, " + predicate + ".zwxy\n" + "mul " + depthProjection + ", " + depthProjection + ", " + temp + ".x\n" + "add " + predicate + ".xy, " + predicate + ".xy, " + depthProjection + ".zw\n" + "sub " + predicate + ".y, " + predicate + ".y, " + predicate + ".x\n" + "mul " + predicate + ".y, " + predicate + ".y, " + temp + ".y\n" + "add " + targetRegister + ".w, " + predicate + ".x, " + predicate + ".y\n";
        registerCache.removeFragmentTempUsage(temp);
        registerCache.removeFragmentTempUsage(predicate);
        return code;
    };
    return ShadowFilteredMethod;
})(ShadowMethodBase);
module.exports = ShadowFilteredMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbWV0aG9kcy9zaGFkb3dmaWx0ZXJlZG1ldGhvZC50cyJdLCJuYW1lcyI6WyJTaGFkb3dGaWx0ZXJlZE1ldGhvZCIsIlNoYWRvd0ZpbHRlcmVkTWV0aG9kLmNvbnN0cnVjdG9yIiwiU2hhZG93RmlsdGVyZWRNZXRob2QuaUluaXRDb25zdGFudHMiLCJTaGFkb3dGaWx0ZXJlZE1ldGhvZC5fcEdldFBsYW5hckZyYWdtZW50Q29kZSIsIlNoYWRvd0ZpbHRlcmVkTWV0aG9kLmlBY3RpdmF0ZUZvckNhc2NhZGUiLCJTaGFkb3dGaWx0ZXJlZE1ldGhvZC5faUdldENhc2NhZGVGcmFnbWVudENvZGUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQVVBLElBQU8sZ0JBQWdCLFdBQWUsMERBQTBELENBQUMsQ0FBQztBQUVsRyxBQUlBOzs7R0FERztJQUNHLG9CQUFvQjtJQUFTQSxVQUE3QkEsb0JBQW9CQSxVQUF5QkE7SUFFbERBOzs7O09BSUdBO0lBQ0hBLFNBUEtBLG9CQUFvQkEsQ0FPYkEsWUFBNkJBO1FBRXhDQyxrQkFBTUEsWUFBWUEsQ0FBQ0EsQ0FBQ0E7SUFDckJBLENBQUNBO0lBRUREOztPQUVHQTtJQUNJQSw2Q0FBY0EsR0FBckJBLFVBQXNCQSxZQUFpQ0EsRUFBRUEsUUFBaUJBO1FBRXpFRSxnQkFBS0EsQ0FBQ0EsY0FBY0EsWUFBQ0EsWUFBWUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFFN0NBLElBQUlBLFlBQVlBLEdBQWlCQSxZQUFZQSxDQUFDQSxvQkFBb0JBLENBQUNBO1FBQ25FQSxJQUFJQSxLQUFLQSxHQUFrQkEsUUFBUUEsQ0FBQ0Esc0JBQXNCQSxDQUFDQTtRQUMzREEsWUFBWUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDN0JBLElBQUlBLElBQUlBLEdBQWtCQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxZQUFZQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUN0RUEsWUFBWUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDL0JBLFlBQVlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLEdBQUNBLElBQUlBLENBQUNBO0lBQ25DQSxDQUFDQTtJQUVERjs7T0FFR0E7SUFDSUEsc0RBQXVCQSxHQUE5QkEsVUFBK0JBLFFBQWlCQSxFQUFFQSxTQUErQkEsRUFBRUEsUUFBNEJBLEVBQUVBLGVBQWtDQTtRQUVsSkcsSUFBSUEsZ0JBQWdCQSxHQUF5QkEsUUFBUUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxDQUFDQTtRQUMxRUEsSUFBSUEsTUFBTUEsR0FBeUJBLFFBQVFBLENBQUNBLHVCQUF1QkEsRUFBRUEsQ0FBQ0E7UUFDdEVBLElBQUlBLE9BQU9BLEdBQXlCQSxRQUFRQSxDQUFDQSx1QkFBdUJBLEVBQUVBLENBQUNBO1FBQ3ZFQSxBQUNBQSxpQkFEaUJBO1FBQ2pCQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUNsQkEsSUFBSUEsYUFBYUEsR0FBeUJBLFFBQVFBLENBQUNBLHVCQUF1QkEsRUFBRUEsQ0FBQ0E7UUFDN0VBLElBQUlBLFFBQVFBLEdBQXlCQSxRQUFRQSxDQUFDQSx5QkFBeUJBLEVBQUVBLENBQUNBO1FBQzFFQSxJQUFJQSxLQUEyQkEsQ0FBQ0E7UUFDaENBLElBQUlBLElBQUlBLEdBQVVBLEVBQUVBLENBQUNBO1FBQ3JCQSxRQUFRQSxDQUFDQSxzQkFBc0JBLEdBQUdBLE1BQU1BLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLENBQUNBO1FBRWpEQSxRQUFRQSxDQUFDQSxxQkFBcUJBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRTVDQSxLQUFLQSxHQUFHQSxRQUFRQSxDQUFDQSx5QkFBeUJBLEVBQUVBLENBQUNBO1FBQzdDQSxRQUFRQSxDQUFDQSxxQkFBcUJBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBRXpDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLElBQUlBLEdBRTdEQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLElBQUlBLEdBQUdBLGdCQUFnQkEsR0FBR0EseUJBQXlCQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBRXhQQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE1BQU1BLEdBQUdBLGFBQWFBLEdBQUdBLE1BQU1BLEdBQ25GQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxJQUFJQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxHQUFHQSxnQkFBZ0JBLEdBQUdBLHlCQUF5QkEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUV0T0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxhQUFhQSxHQUFHQSxNQUFNQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUVsVUEsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE1BQU1BLEdBQUdBLGFBQWFBLEdBQUdBLE1BQU1BLEdBQ2hKQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxJQUFJQSxHQUFHQSxLQUFLQSxHQUFHQSxJQUFJQSxHQUFHQSxnQkFBZ0JBLEdBQUdBLHlCQUF5QkEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUV0T0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxHQUFHQSxNQUFNQSxHQUFHQSxhQUFhQSxHQUFHQSxNQUFNQSxHQUNuRkEsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsSUFBSUEsR0FBR0EsS0FBS0EsR0FBR0EsSUFBSUEsR0FBR0EsZ0JBQWdCQSxHQUFHQSx5QkFBeUJBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FHdE9BLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsYUFBYUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FFOVRBLE1BQU1BLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsTUFBTUEsR0FBR0EsYUFBYUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFFNVVBLFFBQVFBLENBQUNBLHVCQUF1QkEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDM0NBLFFBQVFBLENBQUNBLHVCQUF1QkEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFFeENBLFFBQVFBLENBQUNBLGFBQWFBLEdBQUdBLGdCQUFnQkEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFFaERBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO0lBQ2JBLENBQUNBO0lBRURIOztPQUVHQTtJQUNJQSxrREFBbUJBLEdBQTFCQSxVQUEyQkEsWUFBNkJBLEVBQUVBLFFBQWlCQSxFQUFFQSxLQUFXQTtRQUV2RkksSUFBSUEsSUFBSUEsR0FBa0JBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFlBQVlBLENBQUNBLFlBQVlBLENBQUNBO1FBQ3RFQSxJQUFJQSxLQUFLQSxHQUFrQkEsUUFBUUEsQ0FBQ0EsK0JBQStCQSxDQUFDQTtRQUNwRUEsSUFBSUEsSUFBSUEsR0FBaUJBLFlBQVlBLENBQUNBLG9CQUFvQkEsQ0FBQ0E7UUFDM0RBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxJQUFJQSxDQUFDQTtJQUMxQkEsQ0FBQ0E7SUFFREo7O09BRUdBO0lBQ0lBLHVEQUF3QkEsR0FBL0JBLFVBQWdDQSxZQUE2QkEsRUFBRUEsUUFBaUJBLEVBQUVBLGNBQW9DQSxFQUFFQSxZQUFrQ0EsRUFBRUEsZUFBcUNBLEVBQUVBLGNBQW9DQSxFQUFFQSxhQUFpQ0EsRUFBRUEsZUFBa0NBO1FBRTdTSyxJQUFJQSxJQUFXQSxDQUFDQTtRQUNoQkEsSUFBSUEsT0FBT0EsR0FBeUJBLGFBQWFBLENBQUNBLHVCQUF1QkEsRUFBRUEsQ0FBQ0E7UUFDNUVBLFFBQVFBLENBQUNBLCtCQUErQkEsR0FBR0EsT0FBT0EsQ0FBQ0EsS0FBS0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDM0RBLElBQUlBLElBQUlBLEdBQXlCQSxhQUFhQSxDQUFDQSx5QkFBeUJBLEVBQUVBLENBQUNBO1FBQzNFQSxhQUFhQSxDQUFDQSxxQkFBcUJBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQzdDQSxJQUFJQSxTQUFTQSxHQUF5QkEsYUFBYUEsQ0FBQ0EseUJBQXlCQSxFQUFFQSxDQUFDQTtRQUNoRkEsYUFBYUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVsREEsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsZUFBZUEsR0FBR0EsSUFBSUEsR0FBR0EsWUFBWUEsR0FBR0EseUJBQXlCQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxjQUFjQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUFHQSxlQUFlQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUV0T0EsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsT0FBT0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsZUFBZUEsR0FBR0EsSUFBSUEsR0FBR0EsWUFBWUEsR0FBR0EseUJBQXlCQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxjQUFjQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUFHQSxlQUFlQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUVsVEEsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsT0FBT0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsZUFBZUEsR0FBR0EsSUFBSUEsR0FBR0EsWUFBWUEsR0FBR0EseUJBQXlCQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxjQUFjQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUFHQSxlQUFlQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUVsVEEsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsT0FBT0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsZUFBZUEsR0FBR0EsSUFBSUEsR0FBR0EsWUFBWUEsR0FBR0EseUJBQXlCQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxjQUFjQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxNQUFNQSxHQUFHQSxlQUFlQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxHQUFHQSxNQUFNQSxHQUVsVEEsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsT0FBT0EsR0FBR0EsZUFBZUEsR0FBR0EsT0FBT0EsR0FBR0EsT0FBT0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsT0FBT0EsR0FBR0EsSUFBSUEsR0FBR0EsT0FBT0EsR0FHakhBLE1BQU1BLEdBQUdBLGVBQWVBLEdBQUdBLElBQUlBLEdBQUdBLFNBQVNBLEdBQUdBLFNBQVNBLEdBQUdBLFNBQVNBLEdBQUdBLFNBQVNBLEdBQUdBLE1BQU1BLEdBQUdBLGVBQWVBLEdBQUdBLElBQUlBLEdBQUdBLGVBQWVBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLEdBRTFKQSxNQUFNQSxHQUFHQSxTQUFTQSxHQUFHQSxPQUFPQSxHQUFHQSxTQUFTQSxHQUFHQSxPQUFPQSxHQUFHQSxlQUFlQSxHQUFHQSxPQUFPQSxHQUU5RUEsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsR0FBR0EsTUFBTUEsR0FBR0EsY0FBY0EsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFFdk5BLGFBQWFBLENBQUNBLHVCQUF1QkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDNUNBLGFBQWFBLENBQUNBLHVCQUF1QkEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDakRBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO0lBQ2JBLENBQUNBO0lBQ0ZMLDJCQUFDQTtBQUFEQSxDQTFIQSxBQTBIQ0EsRUExSGtDLGdCQUFnQixFQTBIbEQ7QUFFRCxBQUE4QixpQkFBckIsb0JBQW9CLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL21ldGhvZHMvU2hhZG93RmlsdGVyZWRNZXRob2QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0RpcmVjdGlvbmFsTGlnaHRcIik7XG5cbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5cbmltcG9ydCBNZXRob2RWT1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9NZXRob2RWT1wiKTtcbmltcG9ydCBTaGFkZXJMaWdodGluZ09iamVjdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJMaWdodGluZ09iamVjdFwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckNhY2hlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcbmltcG9ydCBTaGFkb3dNZXRob2RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbWV0aG9kcy9TaGFkb3dNZXRob2RCYXNlXCIpO1xuXG4vKipcbiAqIFNoYWRvd0ZpbHRlcmVkTWV0aG9kIHByb3ZpZGVzIGEgc29mdGVuZWQgc2hhZG93aW5nIHRlY2huaXF1ZSBieSBiaWxpbmVhcmx5IGludGVycG9sYXRpbmcgc2hhZG93IGNvbXBhcmlzb25cbiAqIHJlc3VsdHMgb2YgbmVpZ2hib3VyaW5nIHBpeGVscy5cbiAqL1xuY2xhc3MgU2hhZG93RmlsdGVyZWRNZXRob2QgZXh0ZW5kcyBTaGFkb3dNZXRob2RCYXNlXG57XG5cdC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IERpZmZ1c2VCYXNpY01ldGhvZCBvYmplY3QuXG5cdCAqXG5cdCAqIEBwYXJhbSBjYXN0aW5nTGlnaHQgVGhlIGxpZ2h0IGNhc3RpbmcgdGhlIHNoYWRvd1xuXHQgKi9cblx0Y29uc3RydWN0b3IoY2FzdGluZ0xpZ2h0OkRpcmVjdGlvbmFsTGlnaHQpXG5cdHtcblx0XHRzdXBlcihjYXN0aW5nTGlnaHQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUluaXRDb25zdGFudHMoc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0LCBtZXRob2RWTzpNZXRob2RWTylcblx0e1xuXHRcdHN1cGVyLmlJbml0Q29uc3RhbnRzKHNoYWRlck9iamVjdCwgbWV0aG9kVk8pO1xuXG5cdFx0dmFyIGZyYWdtZW50RGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LmZyYWdtZW50Q29uc3RhbnREYXRhO1xuXHRcdHZhciBpbmRleDpudW1iZXIgLyppbnQqLyA9IG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XG5cdFx0ZnJhZ21lbnREYXRhW2luZGV4ICsgOF0gPSAuNTtcblx0XHR2YXIgc2l6ZTpudW1iZXIgLyppbnQqLyA9IHRoaXMuY2FzdGluZ0xpZ2h0LnNoYWRvd01hcHBlci5kZXB0aE1hcFNpemU7XG5cdFx0ZnJhZ21lbnREYXRhW2luZGV4ICsgOV0gPSBzaXplO1xuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDEwXSA9IDEvc2l6ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9wR2V0UGxhbmFyRnJhZ21lbnRDb2RlKG1ldGhvZFZPOk1ldGhvZFZPLCB0YXJnZXRSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHZhciBkZXB0aE1hcFJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ0NhY2hlLmdldEZyZWVUZXh0dXJlUmVnKCk7XG5cdFx0dmFyIGRlY1JlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdHZhciBkYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ0NhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cdFx0Ly8gVE9ETzogbm90IHVzZWRcblx0XHRkYXRhUmVnID0gZGF0YVJlZztcblx0XHR2YXIgY3VzdG9tRGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdHZhciBkZXB0aENvbDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0dmFyIHV2UmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xuXHRcdG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSBkZWNSZWcuaW5kZXgqNDtcblxuXHRcdHJlZ0NhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyhkZXB0aENvbCwgMSk7XG5cblx0XHR1dlJlZyA9IHJlZ0NhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcblx0XHRyZWdDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXModXZSZWcsIDEpO1xuXG5cdFx0Y29kZSArPSBcIm1vdiBcIiArIHV2UmVnICsgXCIsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIlxcblwiICtcblxuXHRcdFx0XCJ0ZXggXCIgKyBkZXB0aENvbCArIFwiLCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIsIFwiICsgZGVwdGhNYXBSZWdpc3RlciArIFwiIDwyZCwgbmVhcmVzdCwgY2xhbXA+XFxuXCIgKyBcImRwNCBcIiArIGRlcHRoQ29sICsgXCIueiwgXCIgKyBkZXB0aENvbCArIFwiLCBcIiArIGRlY1JlZyArIFwiXFxuXCIgKyBcInNsdCBcIiArIHV2UmVnICsgXCIueiwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLnosIFwiICsgZGVwdGhDb2wgKyBcIi56XFxuXCIgKyAgIC8vIDAgaWYgaW4gc2hhZG93XG5cblx0XHRcdFwiYWRkIFwiICsgdXZSZWcgKyBcIi54LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueCwgXCIgKyBjdXN0b21EYXRhUmVnICsgXCIuelxcblwiICsgXHQvLyAoMSwgMClcblx0XHRcdFwidGV4IFwiICsgZGVwdGhDb2wgKyBcIiwgXCIgKyB1dlJlZyArIFwiLCBcIiArIGRlcHRoTWFwUmVnaXN0ZXIgKyBcIiA8MmQsIG5lYXJlc3QsIGNsYW1wPlxcblwiICsgXCJkcDQgXCIgKyBkZXB0aENvbCArIFwiLnosIFwiICsgZGVwdGhDb2wgKyBcIiwgXCIgKyBkZWNSZWcgKyBcIlxcblwiICsgXCJzbHQgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi56LCBcIiArIGRlcHRoQ29sICsgXCIuelxcblwiICsgICAvLyAwIGlmIGluIHNoYWRvd1xuXG5cdFx0XHRcIm11bCBcIiArIGRlcHRoQ29sICsgXCIueCwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLngsIFwiICsgY3VzdG9tRGF0YVJlZyArIFwiLnlcXG5cIiArIFwiZnJjIFwiICsgZGVwdGhDb2wgKyBcIi54LCBcIiArIGRlcHRoQ29sICsgXCIueFxcblwiICsgXCJzdWIgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIuelxcblwiICsgXCJtdWwgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIGRlcHRoQ29sICsgXCIueFxcblwiICsgXCJhZGQgXCIgKyB0YXJnZXRSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIueiwgXCIgKyB1dlJlZyArIFwiLndcXG5cIiArXG5cblx0XHRcdFwibW92IFwiICsgdXZSZWcgKyBcIi54LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueFxcblwiICsgXCJhZGQgXCIgKyB1dlJlZyArIFwiLnksIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi55LCBcIiArIGN1c3RvbURhdGFSZWcgKyBcIi56XFxuXCIgK1x0Ly8gKDAsIDEpXG5cdFx0XHRcInRleCBcIiArIGRlcHRoQ29sICsgXCIsIFwiICsgdXZSZWcgKyBcIiwgXCIgKyBkZXB0aE1hcFJlZ2lzdGVyICsgXCIgPDJkLCBuZWFyZXN0LCBjbGFtcD5cXG5cIiArIFwiZHA0IFwiICsgZGVwdGhDb2wgKyBcIi56LCBcIiArIGRlcHRoQ29sICsgXCIsIFwiICsgZGVjUmVnICsgXCJcXG5cIiArIFwic2x0IFwiICsgdXZSZWcgKyBcIi56LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueiwgXCIgKyBkZXB0aENvbCArIFwiLnpcXG5cIiArICAgLy8gMCBpZiBpbiBzaGFkb3dcblxuXHRcdFx0XCJhZGQgXCIgKyB1dlJlZyArIFwiLngsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi54LCBcIiArIGN1c3RvbURhdGFSZWcgKyBcIi56XFxuXCIgK1x0Ly8gKDEsIDEpXG5cdFx0XHRcInRleCBcIiArIGRlcHRoQ29sICsgXCIsIFwiICsgdXZSZWcgKyBcIiwgXCIgKyBkZXB0aE1hcFJlZ2lzdGVyICsgXCIgPDJkLCBuZWFyZXN0LCBjbGFtcD5cXG5cIiArIFwiZHA0IFwiICsgZGVwdGhDb2wgKyBcIi56LCBcIiArIGRlcHRoQ29sICsgXCIsIFwiICsgZGVjUmVnICsgXCJcXG5cIiArIFwic2x0IFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueiwgXCIgKyBkZXB0aENvbCArIFwiLnpcXG5cIiArICAgLy8gMCBpZiBpbiBzaGFkb3dcblxuXHRcdFx0Ly8gcmVjYWxjdWxhdGUgZnJhY3Rpb24sIHNpbmNlIHdlIHJhbiBvdXQgb2YgcmVnaXN0ZXJzIDooXG5cdFx0XHRcIm11bCBcIiArIGRlcHRoQ29sICsgXCIueCwgXCIgKyB0aGlzLl9wRGVwdGhNYXBDb29yZFJlZyArIFwiLngsIFwiICsgY3VzdG9tRGF0YVJlZyArIFwiLnlcXG5cIiArIFwiZnJjIFwiICsgZGVwdGhDb2wgKyBcIi54LCBcIiArIGRlcHRoQ29sICsgXCIueFxcblwiICsgXCJzdWIgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIuelxcblwiICsgXCJtdWwgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIGRlcHRoQ29sICsgXCIueFxcblwiICsgXCJhZGQgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgdXZSZWcgKyBcIi56LCBcIiArIHV2UmVnICsgXCIud1xcblwiICtcblxuXHRcdFx0XCJtdWwgXCIgKyBkZXB0aENvbCArIFwiLngsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi55LCBcIiArIGN1c3RvbURhdGFSZWcgKyBcIi55XFxuXCIgKyBcImZyYyBcIiArIGRlcHRoQ29sICsgXCIueCwgXCIgKyBkZXB0aENvbCArIFwiLnhcXG5cIiArIFwic3ViIFwiICsgdXZSZWcgKyBcIi53LCBcIiArIHV2UmVnICsgXCIudywgXCIgKyB0YXJnZXRSZWcgKyBcIi53XFxuXCIgKyBcIm11bCBcIiArIHV2UmVnICsgXCIudywgXCIgKyB1dlJlZyArIFwiLncsIFwiICsgZGVwdGhDb2wgKyBcIi54XFxuXCIgKyBcImFkZCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyB1dlJlZyArIFwiLndcXG5cIjtcblxuXHRcdHJlZ0NhY2hlLnJlbW92ZUZyYWdtZW50VGVtcFVzYWdlKGRlcHRoQ29sKTtcblx0XHRyZWdDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZSh1dlJlZyk7XG5cblx0XHRtZXRob2RWTy50ZXh0dXJlc0luZGV4ID0gZGVwdGhNYXBSZWdpc3Rlci5pbmRleDtcblxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUFjdGl2YXRlRm9yQ2FzY2FkZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIHN0YWdlOlN0YWdlKVxuXHR7XG5cdFx0dmFyIHNpemU6bnVtYmVyIC8qaW50Ki8gPSB0aGlzLmNhc3RpbmdMaWdodC5zaGFkb3dNYXBwZXIuZGVwdGhNYXBTaXplO1xuXHRcdHZhciBpbmRleDpudW1iZXIgLyppbnQqLyA9IG1ldGhvZFZPLnNlY29uZGFyeUZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XG5cdFx0dmFyIGRhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHRkYXRhW2luZGV4XSA9IHNpemU7XG5cdFx0ZGF0YVtpbmRleCArIDFdID0gMS9zaXplO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lHZXRDYXNjYWRlRnJhZ21lbnRDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgZGVjb2RlUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCBkZXB0aFRleHR1cmU6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCBkZXB0aFByb2plY3Rpb246U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCB0YXJnZXRSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXG5cdHtcblx0XHR2YXIgY29kZTpzdHJpbmc7XG5cdFx0dmFyIGRhdGFSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdG1ldGhvZFZPLnNlY29uZGFyeUZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSBkYXRhUmVnLmluZGV4KjQ7XG5cdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXModGVtcCwgMSk7XG5cdFx0dmFyIHByZWRpY2F0ZTpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyhwcmVkaWNhdGUsIDEpO1xuXG5cdFx0Y29kZSA9IFwidGV4IFwiICsgdGVtcCArIFwiLCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLCBcIiArIGRlcHRoVGV4dHVyZSArIFwiIDwyZCwgbmVhcmVzdCwgY2xhbXA+XFxuXCIgKyBcImRwNCBcIiArIHRlbXAgKyBcIi56LCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZWNvZGVSZWdpc3RlciArIFwiXFxuXCIgKyBcInNsdCBcIiArIHByZWRpY2F0ZSArIFwiLngsIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueiwgXCIgKyB0ZW1wICsgXCIuelxcblwiICtcblxuXHRcdFx0XCJhZGQgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIi54LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLngsIFwiICsgZGF0YVJlZyArIFwiLnlcXG5cIiArIFwidGV4IFwiICsgdGVtcCArIFwiLCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLCBcIiArIGRlcHRoVGV4dHVyZSArIFwiIDwyZCwgbmVhcmVzdCwgY2xhbXA+XFxuXCIgKyBcImRwNCBcIiArIHRlbXAgKyBcIi56LCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZWNvZGVSZWdpc3RlciArIFwiXFxuXCIgKyBcInNsdCBcIiArIHByZWRpY2F0ZSArIFwiLnosIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueiwgXCIgKyB0ZW1wICsgXCIuelxcblwiICtcblxuXHRcdFx0XCJhZGQgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIi55LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLnksIFwiICsgZGF0YVJlZyArIFwiLnlcXG5cIiArIFwidGV4IFwiICsgdGVtcCArIFwiLCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLCBcIiArIGRlcHRoVGV4dHVyZSArIFwiIDwyZCwgbmVhcmVzdCwgY2xhbXA+XFxuXCIgKyBcImRwNCBcIiArIHRlbXAgKyBcIi56LCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZWNvZGVSZWdpc3RlciArIFwiXFxuXCIgKyBcInNsdCBcIiArIHByZWRpY2F0ZSArIFwiLncsIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueiwgXCIgKyB0ZW1wICsgXCIuelxcblwiICtcblxuXHRcdFx0XCJzdWIgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIi54LCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLngsIFwiICsgZGF0YVJlZyArIFwiLnlcXG5cIiArIFwidGV4IFwiICsgdGVtcCArIFwiLCBcIiArIGRlcHRoUHJvamVjdGlvbiArIFwiLCBcIiArIGRlcHRoVGV4dHVyZSArIFwiIDwyZCwgbmVhcmVzdCwgY2xhbXA+XFxuXCIgKyBcImRwNCBcIiArIHRlbXAgKyBcIi56LCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZWNvZGVSZWdpc3RlciArIFwiXFxuXCIgKyBcInNsdCBcIiArIHByZWRpY2F0ZSArIFwiLnksIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueiwgXCIgKyB0ZW1wICsgXCIuelxcblwiICtcblxuXHRcdFx0XCJtdWwgXCIgKyB0ZW1wICsgXCIueHksIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIueHksIFwiICsgZGF0YVJlZyArIFwiLnhcXG5cIiArIFwiZnJjIFwiICsgdGVtcCArIFwiLnh5LCBcIiArIHRlbXAgKyBcIi54eVxcblwiICtcblxuXHRcdFx0Ly8gc29tZSBzdHJhbmdlIHJlZ2lzdGVyIGp1Z2dsaW5nIHRvIHByZXZlbnQgYWdhbCBidWdnaW5nIG91dFxuXHRcdFx0XCJzdWIgXCIgKyBkZXB0aFByb2plY3Rpb24gKyBcIiwgXCIgKyBwcmVkaWNhdGUgKyBcIi54eXp3LCBcIiArIHByZWRpY2F0ZSArIFwiLnp3eHlcXG5cIiArIFwibXVsIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIsIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIsIFwiICsgdGVtcCArIFwiLnhcXG5cIiArXG5cblx0XHRcdFwiYWRkIFwiICsgcHJlZGljYXRlICsgXCIueHksIFwiICsgcHJlZGljYXRlICsgXCIueHksIFwiICsgZGVwdGhQcm9qZWN0aW9uICsgXCIuendcXG5cIiArXG5cblx0XHRcdFwic3ViIFwiICsgcHJlZGljYXRlICsgXCIueSwgXCIgKyBwcmVkaWNhdGUgKyBcIi55LCBcIiArIHByZWRpY2F0ZSArIFwiLnhcXG5cIiArIFwibXVsIFwiICsgcHJlZGljYXRlICsgXCIueSwgXCIgKyBwcmVkaWNhdGUgKyBcIi55LCBcIiArIHRlbXAgKyBcIi55XFxuXCIgKyBcImFkZCBcIiArIHRhcmdldFJlZ2lzdGVyICsgXCIudywgXCIgKyBwcmVkaWNhdGUgKyBcIi54LCBcIiArIHByZWRpY2F0ZSArIFwiLnlcXG5cIjtcblxuXHRcdHJlZ2lzdGVyQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UodGVtcCk7XG5cdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZShwcmVkaWNhdGUpO1xuXHRcdHJldHVybiBjb2RlO1xuXHR9XG59XG5cbmV4cG9ydCA9IFNoYWRvd0ZpbHRlcmVkTWV0aG9kOyJdfQ==