var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var BitmapData = require("awayjs-core/lib/base/BitmapData");
var BitmapTexture = require("awayjs-core/lib/textures/BitmapTexture");
var ShadowMethodBase = require("awayjs-renderergl/lib/materials/methods/ShadowMethodBase");
/**
 * ShadowDitheredMethod provides a soft shadowing technique by randomly distributing sample points differently for each fragment.
 */
var ShadowDitheredMethod = (function (_super) {
    __extends(ShadowDitheredMethod, _super);
    /**
     * Creates a new ShadowDitheredMethod object.
     * @param castingLight The light casting the shadows
     * @param numSamples The amount of samples to take for dithering. Minimum 1, maximum 24.
     */
    function ShadowDitheredMethod(castingLight, numSamples, range) {
        if (numSamples === void 0) { numSamples = 4; }
        if (range === void 0) { range = 1; }
        _super.call(this, castingLight);
        this._depthMapSize = this._pCastingLight.shadowMapper.depthMapSize;
        this.numSamples = numSamples;
        this.range = range;
        ++ShadowDitheredMethod._grainUsages;
        if (!ShadowDitheredMethod._grainTexture)
            this.initGrainTexture();
    }
    Object.defineProperty(ShadowDitheredMethod.prototype, "numSamples", {
        /**
         * The amount of samples to take for dithering. Minimum 1, maximum 24. The actual maximum may depend on the
         * complexity of the shader.
         */
        get: function () {
            return this._numSamples;
        },
        set: function (value /*int*/) {
            this._numSamples = value;
            if (this._numSamples < 1)
                this._numSamples = 1;
            else if (this._numSamples > 24)
                this._numSamples = 24;
            this.iInvalidateShaderProgram();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        _super.prototype.iInitVO.call(this, shaderObject, methodVO);
        methodVO.needsProjection = true;
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        _super.prototype.iInitConstants.call(this, shaderObject, methodVO);
        var fragmentData = shaderObject.fragmentConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index + 8] = 1 / this._numSamples;
    };
    Object.defineProperty(ShadowDitheredMethod.prototype, "range", {
        /**
         * The range in the shadow map in which to distribute the samples.
         */
        get: function () {
            return this._range * 2;
        },
        set: function (value) {
            this._range = value / 2;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Creates a texture containing the dithering noise texture.
     */
    ShadowDitheredMethod.prototype.initGrainTexture = function () {
        ShadowDitheredMethod._grainBitmapData = new BitmapData(64, 64, false);
        var vec = new Array();
        var len = 4096;
        var step = 1 / (this._depthMapSize * this._range);
        var r, g;
        for (var i = 0; i < len; ++i) {
            r = 2 * (Math.random() - .5);
            g = 2 * (Math.random() - .5);
            if (r < 0)
                r -= step;
            else
                r += step;
            if (g < 0)
                g -= step;
            else
                g += step;
            if (r > 1)
                r = 1;
            else if (r < -1)
                r = -1;
            if (g > 1)
                g = 1;
            else if (g < -1)
                g = -1;
            vec[i] = (Math.floor((r * .5 + .5) * 0xff) << 16) | (Math.floor((g * .5 + .5) * 0xff) << 8);
        }
        ShadowDitheredMethod._grainBitmapData.setVector(ShadowDitheredMethod._grainBitmapData.rect, vec);
        ShadowDitheredMethod._grainTexture = new BitmapTexture(ShadowDitheredMethod._grainBitmapData);
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.dispose = function () {
        if (--ShadowDitheredMethod._grainUsages == 0) {
            ShadowDitheredMethod._grainTexture.dispose();
            ShadowDitheredMethod._grainBitmapData.dispose();
            ShadowDitheredMethod._grainTexture = null;
        }
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        _super.prototype.iActivate.call(this, shaderObject, methodVO, stage);
        var data = shaderObject.fragmentConstantData;
        var index = methodVO.fragmentConstantsIndex;
        data[index + 9] = (stage.width - 1) / 63;
        data[index + 10] = (stage.height - 1) / 63;
        data[index + 11] = 2 * this._range / this._depthMapSize;
        stage.context.activateTexture(methodVO.texturesIndex + 1, ShadowDitheredMethod._grainTexture);
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype._pGetPlanarFragmentCode = function (methodVO, targetReg, regCache, sharedRegisters) {
        var depthMapRegister = regCache.getFreeTextureReg();
        var decReg = regCache.getFreeFragmentConstant();
        var dataReg = regCache.getFreeFragmentConstant();
        var customDataReg = regCache.getFreeFragmentConstant();
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        methodVO.texturesIndex = depthMapRegister.index;
        return this.getSampleCode(customDataReg, depthMapRegister, decReg, targetReg, regCache, sharedRegisters);
    };
    /**
     * Get the actual shader code for shadow mapping
     * @param regCache The register cache managing the registers.
     * @param depthMapRegister The texture register containing the depth map.
     * @param decReg The register containing the depth map decoding data.
     * @param targetReg The target register to add the shadow coverage.
     */
    ShadowDitheredMethod.prototype.getSampleCode = function (customDataReg, depthMapRegister, decReg, targetReg, regCache, sharedRegisters) {
        var code = "";
        var grainRegister = regCache.getFreeTextureReg();
        var uvReg = regCache.getFreeFragmentVectorTemp();
        var numSamples = this._numSamples;
        regCache.addFragmentTempUsages(uvReg, 1);
        var temp = regCache.getFreeFragmentVectorTemp();
        var projectionReg = sharedRegisters.projectionFragment;
        code += "div " + uvReg + ", " + projectionReg + ", " + projectionReg + ".w\n" + "mul " + uvReg + ".xy, " + uvReg + ".xy, " + customDataReg + ".yz\n";
        while (numSamples > 0) {
            if (numSamples == this._numSamples)
                code += "tex " + uvReg + ", " + uvReg + ", " + grainRegister + " <2d,nearest,repeat,mipnone>\n";
            else
                code += "tex " + uvReg + ", " + uvReg + ".zwxy, " + grainRegister + " <2d,nearest,repeat,mipnone>\n";
            // keep grain in uvReg.zw
            code += "sub " + uvReg + ".zw, " + uvReg + ".xy, fc0.xx\n" + "mul " + uvReg + ".zw, " + uvReg + ".zw, " + customDataReg + ".w\n"; // (tex unpack scale and tex scale in one)
            if (numSamples == this._numSamples) {
                // first sample
                code += "add " + uvReg + ".xy, " + uvReg + ".zw, " + this._pDepthMapCoordReg + ".xy\n" + "tex " + temp + ", " + uvReg + ", " + depthMapRegister + " <2d,nearest,clamp,mipnone>\n" + "dp4 " + temp + ".z, " + temp + ", " + decReg + "\n" + "slt " + targetReg + ".w, " + this._pDepthMapCoordReg + ".z, " + temp + ".z\n"; // 0 if in shadow
            }
            else {
                code += this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            }
            if (numSamples > 4)
                code += "add " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".zw\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 1)
                code += "sub " + uvReg + ".xy, " + this._pDepthMapCoordReg + ".xy, " + uvReg + ".zw\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 5)
                code += "sub " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".zw\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 2) {
                code += "neg " + uvReg + ".w, " + uvReg + ".w\n"; // will be rotated 90 degrees when being accessed as wz
                code += "add " + uvReg + ".xy, " + uvReg + ".wz, " + this._pDepthMapCoordReg + ".xy\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            }
            if (numSamples > 6)
                code += "add " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".wz\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 3)
                code += "sub " + uvReg + ".xy, " + this._pDepthMapCoordReg + ".xy, " + uvReg + ".wz\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            if (numSamples > 7)
                code += "sub " + uvReg + ".xy, " + uvReg + ".xy, " + uvReg + ".wz\n" + this.addSample(uvReg, depthMapRegister, decReg, targetReg, regCache);
            numSamples -= 8;
        }
        regCache.removeFragmentTempUsage(uvReg);
        code += "mul " + targetReg + ".w, " + targetReg + ".w, " + customDataReg + ".x\n"; // average
        return code;
    };
    /**
     * Adds the code for another tap to the shader code.
     * @param uvReg The uv register for the tap.
     * @param depthMapRegister The texture register containing the depth map.
     * @param decReg The register containing the depth map decoding data.
     * @param targetReg The target register to add the tap comparison result.
     * @param regCache The register cache managing the registers.
     * @return
     */
    ShadowDitheredMethod.prototype.addSample = function (uvReg, depthMapRegister, decReg, targetReg, regCache) {
        var temp = regCache.getFreeFragmentVectorTemp();
        return "tex " + temp + ", " + uvReg + ", " + depthMapRegister + " <2d,nearest,clamp,mipnone>\n" + "dp4 " + temp + ".z, " + temp + ", " + decReg + "\n" + "slt " + temp + ".z, " + this._pDepthMapCoordReg + ".z, " + temp + ".z\n" + "add " + targetReg + ".w, " + targetReg + ".w, " + temp + ".z\n";
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype.iActivateForCascade = function (shaderObject, methodVO, stage) {
        var data = shaderObject.fragmentConstantData;
        var index = methodVO.secondaryFragmentConstantsIndex;
        data[index] = 1 / this._numSamples;
        data[index + 1] = (stage.width - 1) / 63;
        data[index + 2] = (stage.height - 1) / 63;
        data[index + 3] = 2 * this._range / this._depthMapSize;
        stage.context.activateTexture(methodVO.texturesIndex + 1, ShadowDitheredMethod._grainTexture);
    };
    /**
     * @inheritDoc
     */
    ShadowDitheredMethod.prototype._iGetCascadeFragmentCode = function (shaderObject, methodVO, decodeRegister, depthTexture, depthProjection, targetRegister, registerCache, sharedRegisters) {
        this._pDepthMapCoordReg = depthProjection;
        var dataReg = registerCache.getFreeFragmentConstant();
        methodVO.secondaryFragmentConstantsIndex = dataReg.index * 4;
        return this.getSampleCode(dataReg, depthTexture, decodeRegister, targetRegister, registerCache, sharedRegisters);
    };
    return ShadowDitheredMethod;
})(ShadowMethodBase);
module.exports = ShadowDitheredMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbWV0aG9kcy9zaGFkb3dkaXRoZXJlZG1ldGhvZC50cyJdLCJuYW1lcyI6WyJTaGFkb3dEaXRoZXJlZE1ldGhvZCIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLmNvbnN0cnVjdG9yIiwiU2hhZG93RGl0aGVyZWRNZXRob2QubnVtU2FtcGxlcyIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLmlJbml0Vk8iLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5pSW5pdENvbnN0YW50cyIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLnJhbmdlIiwiU2hhZG93RGl0aGVyZWRNZXRob2QuaW5pdEdyYWluVGV4dHVyZSIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLmRpc3Bvc2UiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5pQWN0aXZhdGUiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5fcEdldFBsYW5hckZyYWdtZW50Q29kZSIsIlNoYWRvd0RpdGhlcmVkTWV0aG9kLmdldFNhbXBsZUNvZGUiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5hZGRTYW1wbGUiLCJTaGFkb3dEaXRoZXJlZE1ldGhvZC5pQWN0aXZhdGVGb3JDYXNjYWRlIiwiU2hhZG93RGl0aGVyZWRNZXRob2QuX2lHZXRDYXNjYWRlRnJhZ21lbnRDb2RlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFVBQVUsV0FBZ0IsaUNBQWlDLENBQUMsQ0FBQztBQUNwRSxJQUFPLGFBQWEsV0FBZSx3Q0FBd0MsQ0FBQyxDQUFDO0FBWTdFLElBQU8sZ0JBQWdCLFdBQWUsMERBQTBELENBQUMsQ0FBQztBQUVsRyxBQUdBOztHQURHO0lBQ0csb0JBQW9CO0lBQVNBLFVBQTdCQSxvQkFBb0JBLFVBQXlCQTtJQVNsREE7Ozs7T0FJR0E7SUFDSEEsU0FkS0Esb0JBQW9CQSxDQWNiQSxZQUE2QkEsRUFBRUEsVUFBNkJBLEVBQUVBLEtBQWdCQTtRQUEvQ0MsMEJBQTZCQSxHQUE3QkEsY0FBNkJBO1FB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LGFBQWFBLEdBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3JEQSxJQUFJQSxDQUFRQSxFQUFFQSxDQUFRQSxDQUFDQTtRQUV2QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBbUJBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1lBQzlDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUMzQkEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNUQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQTtZQUFDQSxJQUFJQTtnQkFDZkEsQ0FBQ0EsSUFBSUEsSUFBSUEsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1RBLENBQUNBLElBQUlBLElBQUlBLENBQUNBO1lBQUNBLElBQUlBO2dCQUNmQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDVEEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3ZCQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNSQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDVEEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FB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Q0EsQ0FBQ0EsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xCQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxFQUFFQSxnQkFBZ0JBLEVBQUVBLE1BQU1BLEVBQUVBLFNBQVNBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1lBRTdJQSxFQUFFQSxDQUFDQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDcEJBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEdBQUdBLEtBQUtBLEdBQUdBLE1BQU1BLEVBQUVBLHVEQUF1REE7Z0JBQ3pHQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLEtBQUtBLEVBQUVBLGdCQUFnQkEsRUFBRUEsTUFBTUEsRUFBRUEsU0FBU0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7WUFDL0pBLENBQUNBO1lBRURBLEVBQUVBLENBQUNBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBO2dCQUNsQkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsS0FBS0EsR0FBR0EsT0FBT0EsR0FBR0EsS0FBS0EsR0FBR0EsT0FBT0EsR0FBR0EsS0FBS0EsR0FBR0EsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsRUFBRUEsZ0JBQWdCQSxFQUFFQSxNQUFNQSxFQUFFQSxTQUFTQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtZQUU3SUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2xC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LElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBRW5EQSxLQUFLQSxDQUFDQSxPQUFPQSxDQUFDQSxlQUFlQSxDQUFDQSxRQUFRQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxFQUFFQSxvQkFBb0JBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBO0lBQy9GQSxDQUFDQTtJQUVEWjs7T0FFR0E7SUFDSUEsdURBQXdCQSxHQUEvQkEsVUFBZ0NBLFlBQTZCQSxFQUFFQSxRQUFpQkEsRUFBRUEsY0FBb0NBLEVBQUVBLFlBQWtDQSxFQUFFQSxlQUFxQ0EsRUFBRUEsY0FBb0NBLEVBQUVBLGFBQWlDQSxFQUFFQSxlQUFrQ0E7UUFFN1NhLElBQUlBLENBQUNBLGtCQUFrQkEsR0FBR0EsZUFBZUEsQ0FBQ0E7UUFFMUNBLElBQUlBLE9BQU9BLEdBQXlCQSxhQUFhQSxDQUFDQSx1QkFBdUJBLEVBQUVBLENBQUNBO1FBQzVFQSxRQUFRQSxDQUFDQSwrQkFBK0JBLEdBQUdBLE9BQU9BLENBQUNBLEtBQUtBLEdBQUNBLENBQUNBLENBQUNBO1FBRTNEQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxFQUFFQSxZQUFZQSxFQUFFQSxjQUFjQSxFQUFFQSxjQUFjQSxFQUFFQSxhQUFhQSxFQUFFQSxlQUFlQSxDQUFDQSxDQUFDQTtJQUNsSEEsQ0FBQ0E7SUFDRmIsMkJBQUNBO0FBQURBLENBclJBLEFBcVJDQSxFQXJSa0MsZ0JBQWdCLEVBcVJsRDtBQUVELEFBQThCLGlCQUFyQixvQkFBb0IsQ0FBQyIsImZpbGUiOiJtYXRlcmlhbHMvbWV0aG9kcy9TaGFkb3dEaXRoZXJlZE1ldGhvZC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQml0bWFwRGF0YVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9iYXNlL0JpdG1hcERhdGFcIik7XG5pbXBvcnQgQml0bWFwVGV4dHVyZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvQml0bWFwVGV4dHVyZVwiKTtcblxuaW1wb3J0IERpcmVjdGlvbmFsTGlnaHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0RpcmVjdGlvbmFsTGlnaHRcIik7XG5cbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5cbmltcG9ydCBNZXRob2RWT1x0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9NZXRob2RWT1wiKTtcbmltcG9ydCBTaGFkZXJMaWdodGluZ09iamVjdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJMaWdodGluZ09iamVjdFwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckNhY2hlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyQ2FjaGVcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJEYXRhXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckVsZW1lbnRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRWxlbWVudFwiKTtcbmltcG9ydCBTaGFkb3dNZXRob2RCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbWV0aG9kcy9TaGFkb3dNZXRob2RCYXNlXCIpO1xuXG4vKipcbiAqIFNoYWRvd0RpdGhlcmVkTWV0aG9kIHByb3ZpZGVzIGEgc29mdCBzaGFkb3dpbmcgdGVjaG5pcXVlIGJ5IHJhbmRvbWx5IGRpc3RyaWJ1dGluZyBzYW1wbGUgcG9pbnRzIGRpZmZlcmVudGx5IGZvciBlYWNoIGZyYWdtZW50LlxuICovXG5jbGFzcyBTaGFkb3dEaXRoZXJlZE1ldGhvZCBleHRlbmRzIFNoYWRvd01ldGhvZEJhc2Vcbntcblx0cHJpdmF0ZSBzdGF0aWMgX2dyYWluVGV4dHVyZTpCaXRtYXBUZXh0dXJlO1xuXHRwcml2YXRlIHN0YXRpYyBfZ3JhaW5Vc2FnZXM6bnVtYmVyIC8qaW50Ki87XG5cdHByaXZhdGUgc3RhdGljIF9ncmFpbkJpdG1hcERhdGE6Qml0bWFwRGF0YTtcblx0cHJpdmF0ZSBfZGVwdGhNYXBTaXplOm51bWJlciAvKmludCovO1xuXHRwcml2YXRlIF9yYW5nZTpudW1iZXI7XG5cdHByaXZhdGUgX251bVNhbXBsZXM6bnVtYmVyIC8qaW50Ki87XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgU2hhZG93RGl0aGVyZWRNZXRob2Qgb2JqZWN0LlxuXHQgKiBAcGFyYW0gY2FzdGluZ0xpZ2h0IFRoZSBsaWdodCBjYXN0aW5nIHRoZSBzaGFkb3dzXG5cdCAqIEBwYXJhbSBudW1TYW1wbGVzIFRoZSBhbW91bnQgb2Ygc2FtcGxlcyB0byB0YWtlIGZvciBkaXRoZXJpbmcuIE1pbmltdW0gMSwgbWF4aW11bSAyNC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKGNhc3RpbmdMaWdodDpEaXJlY3Rpb25hbExpZ2h0LCBudW1TYW1wbGVzOm51bWJlciAvKmludCovID0gNCwgcmFuZ2U6bnVtYmVyID0gMSlcblx0e1xuXHRcdHN1cGVyKGNhc3RpbmdMaWdodCk7XG5cblx0XHR0aGlzLl9kZXB0aE1hcFNpemUgPSB0aGlzLl9wQ2FzdGluZ0xpZ2h0LnNoYWRvd01hcHBlci5kZXB0aE1hcFNpemU7XG5cblx0XHR0aGlzLm51bVNhbXBsZXMgPSBudW1TYW1wbGVzO1xuXHRcdHRoaXMucmFuZ2UgPSByYW5nZTtcblxuXHRcdCsrU2hhZG93RGl0aGVyZWRNZXRob2QuX2dyYWluVXNhZ2VzO1xuXG5cdFx0aWYgKCFTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5UZXh0dXJlKVxuXHRcdFx0dGhpcy5pbml0R3JhaW5UZXh0dXJlKCk7XG5cdH1cblxuXHQvKipcblx0ICogVGhlIGFtb3VudCBvZiBzYW1wbGVzIHRvIHRha2UgZm9yIGRpdGhlcmluZy4gTWluaW11bSAxLCBtYXhpbXVtIDI0LiBUaGUgYWN0dWFsIG1heGltdW0gbWF5IGRlcGVuZCBvbiB0aGVcblx0ICogY29tcGxleGl0eSBvZiB0aGUgc2hhZGVyLlxuXHQgKi9cblx0cHVibGljIGdldCBudW1TYW1wbGVzKCk6bnVtYmVyIC8qaW50Ki9cblx0e1xuXHRcdHJldHVybiB0aGlzLl9udW1TYW1wbGVzO1xuXHR9XG5cblx0cHVibGljIHNldCBudW1TYW1wbGVzKHZhbHVlOm51bWJlciAvKmludCovKVxuXHR7XG5cdFx0dGhpcy5fbnVtU2FtcGxlcyA9IHZhbHVlO1xuXHRcdGlmICh0aGlzLl9udW1TYW1wbGVzIDwgMSlcblx0XHRcdHRoaXMuX251bVNhbXBsZXMgPSAxOyBlbHNlIGlmICh0aGlzLl9udW1TYW1wbGVzID4gMjQpXG5cdFx0XHR0aGlzLl9udW1TYW1wbGVzID0gMjQ7XG5cdFx0dGhpcy5pSW52YWxpZGF0ZVNoYWRlclByb2dyYW0oKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlJbml0Vk8oc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0LCBtZXRob2RWTzpNZXRob2RWTylcblx0e1xuXHRcdHN1cGVyLmlJbml0Vk8oc2hhZGVyT2JqZWN0LCBtZXRob2RWTyk7XG5cblx0XHRtZXRob2RWTy5uZWVkc1Byb2plY3Rpb24gPSB0cnVlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUluaXRDb25zdGFudHMoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPKVxuXHR7XG5cdFx0c3VwZXIuaUluaXRDb25zdGFudHMoc2hhZGVyT2JqZWN0LCBtZXRob2RWTyk7XG5cblx0XHR2YXIgZnJhZ21lbnREYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QuZnJhZ21lbnRDb25zdGFudERhdGE7XG5cdFx0dmFyIGluZGV4Om51bWJlciAvKmludCovID0gbWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyA4XSA9IDEvdGhpcy5fbnVtU2FtcGxlcztcblx0fVxuXG5cdC8qKlxuXHQgKiBUaGUgcmFuZ2UgaW4gdGhlIHNoYWRvdyBtYXAgaW4gd2hpY2ggdG8gZGlzdHJpYnV0ZSB0aGUgc2FtcGxlcy5cblx0ICovXG5cdHB1YmxpYyBnZXQgcmFuZ2UoKTpudW1iZXJcblx0e1xuXHRcdHJldHVybiB0aGlzLl9yYW5nZSoyO1xuXHR9XG5cblx0cHVibGljIHNldCByYW5nZSh2YWx1ZTpudW1iZXIpXG5cdHtcblx0XHR0aGlzLl9yYW5nZSA9IHZhbHVlLzI7XG5cdH1cblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIHRleHR1cmUgY29udGFpbmluZyB0aGUgZGl0aGVyaW5nIG5vaXNlIHRleHR1cmUuXG5cdCAqL1xuXHRwcml2YXRlIGluaXRHcmFpblRleHR1cmUoKVxuXHR7XG5cdFx0U2hhZG93RGl0aGVyZWRNZXRob2QuX2dyYWluQml0bWFwRGF0YSA9IG5ldyBCaXRtYXBEYXRhKDY0LCA2NCwgZmFsc2UpO1xuXHRcdHZhciB2ZWM6QXJyYXk8bnVtYmVyPiAvKnVpbnQqLyA9IG5ldyBBcnJheTxudW1iZXI+KCk7XG5cdFx0dmFyIGxlbjpudW1iZXIgLyp1aW50Ki8gPSA0MDk2O1xuXHRcdHZhciBzdGVwOm51bWJlciA9IDEvKHRoaXMuX2RlcHRoTWFwU2l6ZSp0aGlzLl9yYW5nZSk7XG5cdFx0dmFyIHI6bnVtYmVyLCBnOm51bWJlcjtcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyIC8qdWludCovID0gMDsgaSA8IGxlbjsgKytpKSB7XG5cdFx0XHRyID0gMiooTWF0aC5yYW5kb20oKSAtIC41KTtcblx0XHRcdGcgPSAyKihNYXRoLnJhbmRvbSgpIC0gLjUpO1xuXHRcdFx0aWYgKHIgPCAwKVxuXHRcdFx0XHRyIC09IHN0ZXA7IGVsc2Vcblx0XHRcdFx0ciArPSBzdGVwO1xuXHRcdFx0aWYgKGcgPCAwKVxuXHRcdFx0XHRnIC09IHN0ZXA7IGVsc2Vcblx0XHRcdFx0ZyArPSBzdGVwO1xuXHRcdFx0aWYgKHIgPiAxKVxuXHRcdFx0XHRyID0gMTsgZWxzZSBpZiAociA8IC0xKVxuXHRcdFx0XHRyID0gLTE7XG5cdFx0XHRpZiAoZyA+IDEpXG5cdFx0XHRcdGcgPSAxOyBlbHNlIGlmIChnIDwgLTEpXG5cdFx0XHRcdGcgPSAtMTtcblx0XHRcdHZlY1tpXSA9IChNYXRoLmZsb29yKChyKi41ICsgLjUpKjB4ZmYpIDw8IDE2KSB8IChNYXRoLmZsb29yKChnKi41ICsgLjUpKjB4ZmYpIDw8IDgpO1xuXHRcdH1cblxuXHRcdFNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpbkJpdG1hcERhdGEuc2V0VmVjdG9yKFNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpbkJpdG1hcERhdGEucmVjdCwgdmVjKTtcblx0XHRTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5UZXh0dXJlID0gbmV3IEJpdG1hcFRleHR1cmUoU2hhZG93RGl0aGVyZWRNZXRob2QuX2dyYWluQml0bWFwRGF0YSk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBkaXNwb3NlKClcblx0e1xuXHRcdGlmICgtLVNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpblVzYWdlcyA9PSAwKSB7XG5cdFx0XHRTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5UZXh0dXJlLmRpc3Bvc2UoKTtcblx0XHRcdFNoYWRvd0RpdGhlcmVkTWV0aG9kLl9ncmFpbkJpdG1hcERhdGEuZGlzcG9zZSgpO1xuXHRcdFx0U2hhZG93RGl0aGVyZWRNZXRob2QuX2dyYWluVGV4dHVyZSA9IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUFjdGl2YXRlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgc3RhZ2U6U3RhZ2UpXG5cdHtcblx0XHRzdXBlci5pQWN0aXZhdGUoc2hhZGVyT2JqZWN0LCBtZXRob2RWTywgc3RhZ2UpO1xuXG5cdFx0dmFyIGRhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHR2YXIgaW5kZXg6bnVtYmVyIC8qdWludCovID0gbWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleDtcblx0XHRkYXRhW2luZGV4ICsgOV0gPSAoc3RhZ2Uud2lkdGggLSAxKS82Mztcblx0XHRkYXRhW2luZGV4ICsgMTBdID0gKHN0YWdlLmhlaWdodCAtIDEpLzYzO1xuXHRcdGRhdGFbaW5kZXggKyAxMV0gPSAyKnRoaXMuX3JhbmdlL3RoaXMuX2RlcHRoTWFwU2l6ZTtcblxuXHRcdHN0YWdlLmNvbnRleHQuYWN0aXZhdGVUZXh0dXJlKG1ldGhvZFZPLnRleHR1cmVzSW5kZXggKyAxLCBTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5UZXh0dXJlKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9wR2V0UGxhbmFyRnJhZ21lbnRDb2RlKG1ldGhvZFZPOk1ldGhvZFZPLCB0YXJnZXRSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnM6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHZhciBkZXB0aE1hcFJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ0NhY2hlLmdldEZyZWVUZXh0dXJlUmVnKCk7XG5cdFx0dmFyIGRlY1JlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdHZhciBkYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ0NhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cdFx0dmFyIGN1c3RvbURhdGFSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblxuXHRcdG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXggPSBkZWNSZWcuaW5kZXgqNDtcblx0XHRtZXRob2RWTy50ZXh0dXJlc0luZGV4ID0gZGVwdGhNYXBSZWdpc3Rlci5pbmRleDtcblxuXHRcdHJldHVybiB0aGlzLmdldFNhbXBsZUNvZGUoY3VzdG9tRGF0YVJlZywgZGVwdGhNYXBSZWdpc3RlciwgZGVjUmVnLCB0YXJnZXRSZWcsIHJlZ0NhY2hlLCBzaGFyZWRSZWdpc3RlcnMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCB0aGUgYWN0dWFsIHNoYWRlciBjb2RlIGZvciBzaGFkb3cgbWFwcGluZ1xuXHQgKiBAcGFyYW0gcmVnQ2FjaGUgVGhlIHJlZ2lzdGVyIGNhY2hlIG1hbmFnaW5nIHRoZSByZWdpc3RlcnMuXG5cdCAqIEBwYXJhbSBkZXB0aE1hcFJlZ2lzdGVyIFRoZSB0ZXh0dXJlIHJlZ2lzdGVyIGNvbnRhaW5pbmcgdGhlIGRlcHRoIG1hcC5cblx0ICogQHBhcmFtIGRlY1JlZyBUaGUgcmVnaXN0ZXIgY29udGFpbmluZyB0aGUgZGVwdGggbWFwIGRlY29kaW5nIGRhdGEuXG5cdCAqIEBwYXJhbSB0YXJnZXRSZWcgVGhlIHRhcmdldCByZWdpc3RlciB0byBhZGQgdGhlIHNoYWRvdyBjb3ZlcmFnZS5cblx0ICovXG5cdHByaXZhdGUgZ2V0U2FtcGxlQ29kZShjdXN0b21EYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgZGVwdGhNYXBSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGRlY1JlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHRhcmdldFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHJlZ0NhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblx0XHR2YXIgZ3JhaW5SZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xuXHRcdHZhciB1dlJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cdFx0dmFyIG51bVNhbXBsZXM6bnVtYmVyIC8qaW50Ki8gPSB0aGlzLl9udW1TYW1wbGVzO1xuXHRcdHJlZ0NhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyh1dlJlZywgMSk7XG5cblx0XHR2YXIgdGVtcDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cblx0XHR2YXIgcHJvamVjdGlvblJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSBzaGFyZWRSZWdpc3RlcnMucHJvamVjdGlvbkZyYWdtZW50O1xuXG5cdFx0Y29kZSArPSBcImRpdiBcIiArIHV2UmVnICsgXCIsIFwiICsgcHJvamVjdGlvblJlZyArIFwiLCBcIiArIHByb2plY3Rpb25SZWcgKyBcIi53XFxuXCIgKyBcIm11bCBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyBjdXN0b21EYXRhUmVnICsgXCIueXpcXG5cIjtcblxuXHRcdHdoaWxlIChudW1TYW1wbGVzID4gMCkge1xuXHRcdFx0aWYgKG51bVNhbXBsZXMgPT0gdGhpcy5fbnVtU2FtcGxlcylcblx0XHRcdFx0Y29kZSArPSBcInRleCBcIiArIHV2UmVnICsgXCIsIFwiICsgdXZSZWcgKyBcIiwgXCIgKyBncmFpblJlZ2lzdGVyICsgXCIgPDJkLG5lYXJlc3QscmVwZWF0LG1pcG5vbmU+XFxuXCI7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdGNvZGUgKz0gXCJ0ZXggXCIgKyB1dlJlZyArIFwiLCBcIiArIHV2UmVnICsgXCIuend4eSwgXCIgKyBncmFpblJlZ2lzdGVyICsgXCIgPDJkLG5lYXJlc3QscmVwZWF0LG1pcG5vbmU+XFxuXCI7XG5cblx0XHRcdC8vIGtlZXAgZ3JhaW4gaW4gdXZSZWcuendcblx0XHRcdGNvZGUgKz0gXCJzdWIgXCIgKyB1dlJlZyArIFwiLnp3LCBcIiArIHV2UmVnICsgXCIueHksIGZjMC54eFxcblwiICsgLy8gdXYtLjVcblx0XHRcdFx0XCJtdWwgXCIgKyB1dlJlZyArIFwiLnp3LCBcIiArIHV2UmVnICsgXCIuencsIFwiICsgY3VzdG9tRGF0YVJlZyArIFwiLndcXG5cIjsgLy8gKHRleCB1bnBhY2sgc2NhbGUgYW5kIHRleCBzY2FsZSBpbiBvbmUpXG5cblx0XHRcdGlmIChudW1TYW1wbGVzID09IHRoaXMuX251bVNhbXBsZXMpIHtcblx0XHRcdFx0Ly8gZmlyc3Qgc2FtcGxlXG5cdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIuencsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi54eVxcblwiICtcblx0XHRcdFx0XHRcInRleCBcIiArIHRlbXAgKyBcIiwgXCIgKyB1dlJlZyArIFwiLCBcIiArIGRlcHRoTWFwUmVnaXN0ZXIgKyBcIiA8MmQsbmVhcmVzdCxjbGFtcCxtaXBub25lPlxcblwiICtcblx0XHRcdFx0XHRcImRwNCBcIiArIHRlbXAgKyBcIi56LCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkZWNSZWcgKyBcIlxcblwiICtcblx0XHRcdFx0XHRcInNsdCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi56LCBcIiArIHRlbXAgKyBcIi56XFxuXCI7IC8vIDAgaWYgaW4gc2hhZG93XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb2RlICs9IHRoaXMuYWRkU2FtcGxlKHV2UmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCBkZWNSZWcsIHRhcmdldFJlZywgcmVnQ2FjaGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAobnVtU2FtcGxlcyA+IDQpXG5cdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi56d1xcblwiICsgdGhpcy5hZGRTYW1wbGUodXZSZWcsIGRlcHRoTWFwUmVnaXN0ZXIsIGRlY1JlZywgdGFyZ2V0UmVnLCByZWdDYWNoZSk7XG5cblx0XHRcdGlmIChudW1TYW1wbGVzID4gMSlcblx0XHRcdFx0Y29kZSArPSBcInN1YiBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnp3XFxuXCIgKyB0aGlzLmFkZFNhbXBsZSh1dlJlZywgZGVwdGhNYXBSZWdpc3RlciwgZGVjUmVnLCB0YXJnZXRSZWcsIHJlZ0NhY2hlKTtcblxuXHRcdFx0aWYgKG51bVNhbXBsZXMgPiA1KVxuXHRcdFx0XHRjb2RlICs9IFwic3ViIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIuendcXG5cIiArIHRoaXMuYWRkU2FtcGxlKHV2UmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCBkZWNSZWcsIHRhcmdldFJlZywgcmVnQ2FjaGUpO1xuXG5cdFx0XHRpZiAobnVtU2FtcGxlcyA+IDIpIHtcblx0XHRcdFx0Y29kZSArPSBcIm5lZyBcIiArIHV2UmVnICsgXCIudywgXCIgKyB1dlJlZyArIFwiLndcXG5cIjsgLy8gd2lsbCBiZSByb3RhdGVkIDkwIGRlZ3JlZXMgd2hlbiBiZWluZyBhY2Nlc3NlZCBhcyB3elxuXHRcdFx0XHRjb2RlICs9IFwiYWRkIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnd6LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueHlcXG5cIiArIHRoaXMuYWRkU2FtcGxlKHV2UmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCBkZWNSZWcsIHRhcmdldFJlZywgcmVnQ2FjaGUpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAobnVtU2FtcGxlcyA+IDYpXG5cdFx0XHRcdGNvZGUgKz0gXCJhZGQgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdXZSZWcgKyBcIi53elxcblwiICsgdGhpcy5hZGRTYW1wbGUodXZSZWcsIGRlcHRoTWFwUmVnaXN0ZXIsIGRlY1JlZywgdGFyZ2V0UmVnLCByZWdDYWNoZSk7XG5cblx0XHRcdGlmIChudW1TYW1wbGVzID4gMylcblx0XHRcdFx0Y29kZSArPSBcInN1YiBcIiArIHV2UmVnICsgXCIueHksIFwiICsgdGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnd6XFxuXCIgKyB0aGlzLmFkZFNhbXBsZSh1dlJlZywgZGVwdGhNYXBSZWdpc3RlciwgZGVjUmVnLCB0YXJnZXRSZWcsIHJlZ0NhY2hlKTtcblxuXHRcdFx0aWYgKG51bVNhbXBsZXMgPiA3KVxuXHRcdFx0XHRjb2RlICs9IFwic3ViIFwiICsgdXZSZWcgKyBcIi54eSwgXCIgKyB1dlJlZyArIFwiLnh5LCBcIiArIHV2UmVnICsgXCIud3pcXG5cIiArIHRoaXMuYWRkU2FtcGxlKHV2UmVnLCBkZXB0aE1hcFJlZ2lzdGVyLCBkZWNSZWcsIHRhcmdldFJlZywgcmVnQ2FjaGUpO1xuXG5cdFx0XHRudW1TYW1wbGVzIC09IDg7XG5cdFx0fVxuXG5cdFx0cmVnQ2FjaGUucmVtb3ZlRnJhZ21lbnRUZW1wVXNhZ2UodXZSZWcpO1xuXHRcdGNvZGUgKz0gXCJtdWwgXCIgKyB0YXJnZXRSZWcgKyBcIi53LCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgY3VzdG9tRGF0YVJlZyArIFwiLnhcXG5cIjsgLy8gYXZlcmFnZVxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEFkZHMgdGhlIGNvZGUgZm9yIGFub3RoZXIgdGFwIHRvIHRoZSBzaGFkZXIgY29kZS5cblx0ICogQHBhcmFtIHV2UmVnIFRoZSB1diByZWdpc3RlciBmb3IgdGhlIHRhcC5cblx0ICogQHBhcmFtIGRlcHRoTWFwUmVnaXN0ZXIgVGhlIHRleHR1cmUgcmVnaXN0ZXIgY29udGFpbmluZyB0aGUgZGVwdGggbWFwLlxuXHQgKiBAcGFyYW0gZGVjUmVnIFRoZSByZWdpc3RlciBjb250YWluaW5nIHRoZSBkZXB0aCBtYXAgZGVjb2RpbmcgZGF0YS5cblx0ICogQHBhcmFtIHRhcmdldFJlZyBUaGUgdGFyZ2V0IHJlZ2lzdGVyIHRvIGFkZCB0aGUgdGFwIGNvbXBhcmlzb24gcmVzdWx0LlxuXHQgKiBAcGFyYW0gcmVnQ2FjaGUgVGhlIHJlZ2lzdGVyIGNhY2hlIG1hbmFnaW5nIHRoZSByZWdpc3RlcnMuXG5cdCAqIEByZXR1cm5cblx0ICovXG5cdHByaXZhdGUgYWRkU2FtcGxlKHV2UmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgZGVwdGhNYXBSZWdpc3RlcjpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIGRlY1JlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHRhcmdldFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHJlZ0NhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXG5cdFx0cmV0dXJuIFwidGV4IFwiICsgdGVtcCArIFwiLCBcIiArIHV2UmVnICsgXCIsIFwiICsgZGVwdGhNYXBSZWdpc3RlciArIFwiIDwyZCxuZWFyZXN0LGNsYW1wLG1pcG5vbmU+XFxuXCIgK1xuXHRcdFx0XCJkcDQgXCIgKyB0ZW1wICsgXCIueiwgXCIgKyB0ZW1wICsgXCIsIFwiICsgZGVjUmVnICsgXCJcXG5cIiArXG5cdFx0XHRcInNsdCBcIiArIHRlbXAgKyBcIi56LCBcIiArIHRoaXMuX3BEZXB0aE1hcENvb3JkUmVnICsgXCIueiwgXCIgKyB0ZW1wICsgXCIuelxcblwiICsgLy8gMCBpZiBpbiBzaGFkb3dcblx0XHRcdFwiYWRkIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyB0YXJnZXRSZWcgKyBcIi53LCBcIiArIHRlbXAgKyBcIi56XFxuXCI7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpQWN0aXZhdGVGb3JDYXNjYWRlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgc3RhZ2U6U3RhZ2UpXG5cdHtcblx0XHR2YXIgZGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LmZyYWdtZW50Q29uc3RhbnREYXRhO1xuXHRcdHZhciBpbmRleDpudW1iZXIgLyp1aW50Ki8gPSBtZXRob2RWTy5zZWNvbmRhcnlGcmFnbWVudENvbnN0YW50c0luZGV4O1xuXHRcdGRhdGFbaW5kZXhdID0gMS90aGlzLl9udW1TYW1wbGVzO1xuXHRcdGRhdGFbaW5kZXggKyAxXSA9IChzdGFnZS53aWR0aCAtIDEpLzYzO1xuXHRcdGRhdGFbaW5kZXggKyAyXSA9IChzdGFnZS5oZWlnaHQgLSAxKS82Mztcblx0XHRkYXRhW2luZGV4ICsgM10gPSAyKnRoaXMuX3JhbmdlL3RoaXMuX2RlcHRoTWFwU2l6ZTtcblxuXHRcdHN0YWdlLmNvbnRleHQuYWN0aXZhdGVUZXh0dXJlKG1ldGhvZFZPLnRleHR1cmVzSW5kZXggKyAxLCBTaGFkb3dEaXRoZXJlZE1ldGhvZC5fZ3JhaW5UZXh0dXJlKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pR2V0Q2FzY2FkZUZyYWdtZW50Q29kZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIGRlY29kZVJlZ2lzdGVyOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgZGVwdGhUZXh0dXJlOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgZGVwdGhQcm9qZWN0aW9uOlNoYWRlclJlZ2lzdGVyRWxlbWVudCwgdGFyZ2V0UmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dGhpcy5fcERlcHRoTWFwQ29vcmRSZWcgPSBkZXB0aFByb2plY3Rpb247XG5cblx0XHR2YXIgZGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cdFx0bWV0aG9kVk8uc2Vjb25kYXJ5RnJhZ21lbnRDb25zdGFudHNJbmRleCA9IGRhdGFSZWcuaW5kZXgqNDtcblxuXHRcdHJldHVybiB0aGlzLmdldFNhbXBsZUNvZGUoZGF0YVJlZywgZGVwdGhUZXh0dXJlLCBkZWNvZGVSZWdpc3RlciwgdGFyZ2V0UmVnaXN0ZXIsIHJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVycyk7XG5cdH1cbn1cblxuZXhwb3J0ID0gU2hhZG93RGl0aGVyZWRNZXRob2Q7Il19