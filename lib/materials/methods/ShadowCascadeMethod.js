var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Event = require("awayjs-core/lib/events/Event");
var DirectionalLight = require("awayjs-display/lib/entities/DirectionalLight");
var ShadingMethodEvent = require("awayjs-renderergl/lib/events/ShadingMethodEvent");
var MethodVO = require("awayjs-renderergl/lib/materials/compilation/MethodVO");
var ShadowMapMethodBase = require("awayjs-renderergl/lib/materials/methods/ShadowMapMethodBase");
/**
 * ShadowCascadeMethod is a shadow map method to apply cascade shadow mapping on materials.
 * Must be used with a DirectionalLight with a CascadeShadowMapper assigned to its shadowMapper property.
 *
 * @see away.lights.CascadeShadowMapper
 */
var ShadowCascadeMethod = (function (_super) {
    __extends(ShadowCascadeMethod, _super);
    /**
     * Creates a new ShadowCascadeMethod object.
     *
     * @param shadowMethodBase The shadow map sampling method used to sample individual cascades (fe: ShadowHardMethod, ShadowSoftMethod)
     */
    function ShadowCascadeMethod(shadowMethodBase) {
        var _this = this;
        _super.call(this, shadowMethodBase.castingLight);
        this._baseMethod = shadowMethodBase;
        if (!(this._pCastingLight instanceof DirectionalLight))
            throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");
        this._cascadeShadowMapper = this._pCastingLight.shadowMapper;
        if (!this._cascadeShadowMapper)
            throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");
        this._cascadeShadowMapper.addEventListener(Event.CHANGE, function (event) { return _this.onCascadeChange(event); });
        this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
    }
    Object.defineProperty(ShadowCascadeMethod.prototype, "baseMethod", {
        /**
         * The shadow map sampling method used to sample individual cascades. These are typically those used in conjunction
         * with a DirectionalShadowMapper.
         *
         * @see ShadowHardMethod
         * @see ShadowSoftMethod
         */
        get: function () {
            return this._baseMethod;
        },
        set: function (value) {
            var _this = this;
            if (this._baseMethod == value)
                return;
            this._baseMethod.removeEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this._baseMethod = value;
            this._baseMethod.addEventListener(ShadingMethodEvent.SHADER_INVALIDATED, function (event) { return _this.onShaderInvalidated(event); });
            this.iInvalidateShaderProgram();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitVO = function (shaderObject, methodVO) {
        var tempVO = new MethodVO(this._baseMethod);
        this._baseMethod.iInitVO(shaderObject, tempVO);
        methodVO.needsGlobalVertexPos = true;
        methodVO.needsProjection = true;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iInitConstants = function (shaderObject, methodVO) {
        var fragmentData = shaderObject.fragmentConstantData;
        var vertexData = shaderObject.vertexConstantData;
        var index = methodVO.fragmentConstantsIndex;
        fragmentData[index] = 1.0;
        fragmentData[index + 1] = 1 / 255.0;
        fragmentData[index + 2] = 1 / 65025.0;
        fragmentData[index + 3] = 1 / 16581375.0;
        fragmentData[index + 6] = .5;
        fragmentData[index + 7] = -.5;
        index = methodVO.vertexConstantsIndex;
        vertexData[index] = .5;
        vertexData[index + 1] = -.5;
        vertexData[index + 2] = 0;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iCleanCompilationData = function () {
        _super.prototype.iCleanCompilationData.call(this);
        this._cascadeProjections = null;
        this._depthMapCoordVaryings = null;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetVertexCode = function (shaderObject, methodVO, registerCache, sharedRegisters) {
        var code = "";
        var dataReg = registerCache.getFreeVertexConstant();
        this.initProjectionsRegs(registerCache);
        methodVO.vertexConstantsIndex = dataReg.index * 4;
        var temp = registerCache.getFreeVertexVectorTemp();
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            code += "m44 " + temp + ", " + sharedRegisters.globalPositionVertex + ", " + this._cascadeProjections[i] + "\n" + "add " + this._depthMapCoordVaryings[i] + ", " + temp + ", " + dataReg + ".zzwz\n";
        }
        return code;
    };
    /**
     * Creates the registers for the cascades' projection coordinates.
     */
    ShadowCascadeMethod.prototype.initProjectionsRegs = function (registerCache) {
        this._cascadeProjections = new Array(this._cascadeShadowMapper.numCascades);
        this._depthMapCoordVaryings = new Array(this._cascadeShadowMapper.numCascades);
        for (var i = 0; i < this._cascadeShadowMapper.numCascades; ++i) {
            this._depthMapCoordVaryings[i] = registerCache.getFreeVarying();
            this._cascadeProjections[i] = registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
            registerCache.getFreeVertexConstant();
        }
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iGetFragmentCode = function (shaderObject, methodVO, targetReg, registerCache, sharedRegisters) {
        var numCascades = this._cascadeShadowMapper.numCascades;
        var depthMapRegister = registerCache.getFreeTextureReg();
        var decReg = registerCache.getFreeFragmentConstant();
        var dataReg = registerCache.getFreeFragmentConstant();
        var planeDistanceReg = registerCache.getFreeFragmentConstant();
        var planeDistances = Array(planeDistanceReg + ".x", planeDistanceReg + ".y", planeDistanceReg + ".z", planeDistanceReg + ".w");
        var code;
        methodVO.fragmentConstantsIndex = decReg.index * 4;
        methodVO.texturesIndex = depthMapRegister.index;
        var inQuad = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(inQuad, 1);
        var uvCoord = registerCache.getFreeFragmentVectorTemp();
        registerCache.addFragmentTempUsages(uvCoord, 1);
        // assume lowest partition is selected, will be overwritten later otherwise
        code = "mov " + uvCoord + ", " + this._depthMapCoordVaryings[numCascades - 1] + "\n";
        for (var i = numCascades - 2; i >= 0; --i) {
            var uvProjection = this._depthMapCoordVaryings[i];
            // calculate if in texturemap (result == 0 or 1, only 1 for a single partition)
            code += "slt " + inQuad + ".z, " + sharedRegisters.projectionFragment + ".z, " + planeDistances[i] + "\n"; // z = x > minX, w = y > minY
            var temp = registerCache.getFreeFragmentVectorTemp();
            // linearly interpolate between old and new uv coords using predicate value == conditional toggle to new value if predicate == 1 (true)
            code += "sub " + temp + ", " + uvProjection + ", " + uvCoord + "\n" + "mul " + temp + ", " + temp + ", " + inQuad + ".z\n" + "add " + uvCoord + ", " + uvCoord + ", " + temp + "\n";
        }
        registerCache.removeFragmentTempUsage(inQuad);
        code += "div " + uvCoord + ", " + uvCoord + ", " + uvCoord + ".w\n" + "mul " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zw\n" + "add " + uvCoord + ".xy, " + uvCoord + ".xy, " + dataReg + ".zz\n";
        code += this._baseMethod._iGetCascadeFragmentCode(shaderObject, methodVO, decReg, depthMapRegister, uvCoord, targetReg, registerCache, sharedRegisters) + "add " + targetReg + ".w, " + targetReg + ".w, " + dataReg + ".y\n";
        registerCache.removeFragmentTempUsage(uvCoord);
        return code;
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iActivate = function (shaderObject, methodVO, stage) {
        stage.activateTexture(methodVO.texturesIndex, this._pCastingLight.shadowMapper.depthMap);
        var vertexData = shaderObject.vertexConstantData;
        var vertexIndex = methodVO.vertexConstantsIndex;
        shaderObject.vertexConstantData[methodVO.vertexConstantsIndex + 3] = -1 / (this._cascadeShadowMapper.depth * this._pEpsilon);
        var numCascades = this._cascadeShadowMapper.numCascades;
        vertexIndex += 4;
        for (var k = 0; k < numCascades; ++k) {
            this._cascadeShadowMapper.getDepthProjections(k).copyRawDataTo(vertexData, vertexIndex, true);
            vertexIndex += 16;
        }
        var fragmentData = shaderObject.fragmentConstantData;
        var fragmentIndex = methodVO.fragmentConstantsIndex;
        fragmentData[fragmentIndex + 5] = 1 - this._pAlpha;
        var nearPlaneDistances = this._cascadeShadowMapper._iNearPlaneDistances;
        fragmentIndex += 8;
        for (var i = 0; i < numCascades; ++i)
            fragmentData[fragmentIndex + i] = nearPlaneDistances[i];
        this._baseMethod.iActivateForCascade(shaderObject, methodVO, stage);
    };
    /**
     * @inheritDoc
     */
    ShadowCascadeMethod.prototype.iSetRenderState = function (shaderObject, methodVO, renderable, stage, camera) {
    };
    /**
     * Called when the shadow mappers cascade configuration changes.
     */
    ShadowCascadeMethod.prototype.onCascadeChange = function (event) {
        this.iInvalidateShaderProgram();
    };
    /**
     * Called when the base method's shader code is invalidated.
     */
    ShadowCascadeMethod.prototype.onShaderInvalidated = function (event) {
        this.iInvalidateShaderProgram();
    };
    return ShadowCascadeMethod;
})(ShadowMapMethodBase);
module.exports = ShadowCascadeMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbWV0aG9kcy9zaGFkb3djYXNjYWRlbWV0aG9kLnRzIl0sIm5hbWVzIjpbIlNoYWRvd0Nhc2NhZGVNZXRob2QiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLmNvbnN0cnVjdG9yIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5iYXNlTWV0aG9kIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5pSW5pdFZPIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5pSW5pdENvbnN0YW50cyIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUNsZWFuQ29tcGlsYXRpb25EYXRhIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5pR2V0VmVydGV4Q29kZSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaW5pdFByb2plY3Rpb25zUmVncyIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUdldEZyYWdtZW50Q29kZSIsIlNoYWRvd0Nhc2NhZGVNZXRob2QuaUFjdGl2YXRlIiwiU2hhZG93Q2FzY2FkZU1ldGhvZC5pU2V0UmVuZGVyU3RhdGUiLCJTaGFkb3dDYXNjYWRlTWV0aG9kLm9uQ2FzY2FkZUNoYW5nZSIsIlNoYWRvd0Nhc2NhZGVNZXRob2Qub25TaGFkZXJJbnZhbGlkYXRlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxLQUFLLFdBQWlCLDhCQUE4QixDQUFDLENBQUM7QUFJN0QsSUFBTyxnQkFBZ0IsV0FBZSw4Q0FBOEMsQ0FBQyxDQUFDO0FBTXRGLElBQU8sa0JBQWtCLFdBQWMsaURBQWlELENBQUMsQ0FBQztBQUMxRixJQUFPLFFBQVEsV0FBaUIsc0RBQXNELENBQUMsQ0FBQztBQU14RixJQUFPLG1CQUFtQixXQUFjLDZEQUE2RCxDQUFDLENBQUM7QUFJdkcsQUFNQTs7Ozs7R0FERztJQUNHLG1CQUFtQjtJQUFTQSxVQUE1QkEsbUJBQW1CQSxVQUE0QkE7SUFPcERBOzs7O09BSUdBO0lBQ0hBLFNBWktBLG1CQUFtQkEsQ0FZWkEsZ0JBQWlDQTtRQVo5Q0Ms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QSxFQUFFQSxRQUFpQkEsRUFBRUEsVUFBeUJBLEVBQUVBLEtBQVdBLEVBQUVBLE1BQWFBO0lBRTlIVSxDQUFDQTtJQUVEVjs7T0FFR0E7SUFDS0EsNkNBQWVBLEdBQXZCQSxVQUF3QkEsS0FBV0E7UUFFbENXLElBQUlBLENBQUNBLHdCQUF3QkEsRUFBRUEsQ0FBQ0E7SUFDakNBLENBQUNBO0lBRURYOztPQUVHQTtJQUNLQSxpREFBbUJBLEdBQTNCQSxVQUE0QkEsS0FBd0JBO1FBRW5EWSxJQUFJQSxDQUFDQSx3QkFBd0JBLEVBQUVBLENBQUNBO0lBQ2pDQSxDQUFDQTtJQUNGWiwwQkFBQ0E7QUFBREEsQ0FuUEEsQUFtUENBLEVBblBpQyxtQkFBbUIsRUFtUHBEO0FBRUQsQUFBNkIsaUJBQXBCLG1CQUFtQixDQUFDIiwiZmlsZSI6Im1hdGVyaWFscy9tZXRob2RzL1NoYWRvd0Nhc2NhZGVNZXRob2QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEV2ZW50XHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0V2ZW50XCIpO1xuaW1wb3J0IFRleHR1cmUyREJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1RleHR1cmUyREJhc2VcIik7XG5cbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5pbXBvcnQgRGlyZWN0aW9uYWxMaWdodFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvRGlyZWN0aW9uYWxMaWdodFwiKTtcbmltcG9ydCBDYXNjYWRlU2hhZG93TWFwcGVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL3NoYWRvd21hcHBlcnMvQ2FzY2FkZVNoYWRvd01hcHBlclwiKTtcblxuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcblxuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xuaW1wb3J0IFNoYWRpbmdNZXRob2RFdmVudFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2V2ZW50cy9TaGFkaW5nTWV0aG9kRXZlbnRcIik7XG5pbXBvcnQgTWV0aG9kVk9cdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vTWV0aG9kVk9cIik7XG5pbXBvcnQgU2hhZGVyTGlnaHRpbmdPYmplY3RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyTGlnaHRpbmdPYmplY3RcIik7XG5pbXBvcnQgU2hhZGVyT2JqZWN0QmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckNhY2hlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRGF0YVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckRhdGFcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJFbGVtZW50XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9jb21waWxhdGlvbi9TaGFkZXJSZWdpc3RlckVsZW1lbnRcIik7XG5pbXBvcnQgU2hhZG93TWFwTWV0aG9kQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy9tZXRob2RzL1NoYWRvd01hcE1ldGhvZEJhc2VcIik7XG5pbXBvcnQgU2hhZG93TWV0aG9kQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL21ldGhvZHMvU2hhZG93TWV0aG9kQmFzZVwiKTtcbmltcG9ydCBTaGFkZXJDb21waWxlckhlbHBlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL21hdGVyaWFscy91dGlscy9TaGFkZXJDb21waWxlckhlbHBlclwiKTtcblxuLyoqXG4gKiBTaGFkb3dDYXNjYWRlTWV0aG9kIGlzIGEgc2hhZG93IG1hcCBtZXRob2QgdG8gYXBwbHkgY2FzY2FkZSBzaGFkb3cgbWFwcGluZyBvbiBtYXRlcmlhbHMuXG4gKiBNdXN0IGJlIHVzZWQgd2l0aCBhIERpcmVjdGlvbmFsTGlnaHQgd2l0aCBhIENhc2NhZGVTaGFkb3dNYXBwZXIgYXNzaWduZWQgdG8gaXRzIHNoYWRvd01hcHBlciBwcm9wZXJ0eS5cbiAqXG4gKiBAc2VlIGF3YXkubGlnaHRzLkNhc2NhZGVTaGFkb3dNYXBwZXJcbiAqL1xuY2xhc3MgU2hhZG93Q2FzY2FkZU1ldGhvZCBleHRlbmRzIFNoYWRvd01hcE1ldGhvZEJhc2Vcbntcblx0cHJpdmF0ZSBfYmFzZU1ldGhvZDpTaGFkb3dNZXRob2RCYXNlO1xuXHRwcml2YXRlIF9jYXNjYWRlU2hhZG93TWFwcGVyOkNhc2NhZGVTaGFkb3dNYXBwZXI7XG5cdHByaXZhdGUgX2RlcHRoTWFwQ29vcmRWYXJ5aW5nczpBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+O1xuXHRwcml2YXRlIF9jYXNjYWRlUHJvamVjdGlvbnM6QXJyYXk8U2hhZGVyUmVnaXN0ZXJFbGVtZW50PjtcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBTaGFkb3dDYXNjYWRlTWV0aG9kIG9iamVjdC5cblx0ICpcblx0ICogQHBhcmFtIHNoYWRvd01ldGhvZEJhc2UgVGhlIHNoYWRvdyBtYXAgc2FtcGxpbmcgbWV0aG9kIHVzZWQgdG8gc2FtcGxlIGluZGl2aWR1YWwgY2FzY2FkZXMgKGZlOiBTaGFkb3dIYXJkTWV0aG9kLCBTaGFkb3dTb2Z0TWV0aG9kKVxuXHQgKi9cblx0Y29uc3RydWN0b3Ioc2hhZG93TWV0aG9kQmFzZTpTaGFkb3dNZXRob2RCYXNlKVxuXHR7XG5cdFx0c3VwZXIoc2hhZG93TWV0aG9kQmFzZS5jYXN0aW5nTGlnaHQpO1xuXG5cdFx0dGhpcy5fYmFzZU1ldGhvZCA9IHNoYWRvd01ldGhvZEJhc2U7XG5cdFx0aWYgKCEodGhpcy5fcENhc3RpbmdMaWdodCBpbnN0YW5jZW9mIERpcmVjdGlvbmFsTGlnaHQpKVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiU2hhZG93Q2FzY2FkZU1ldGhvZCBpcyBvbmx5IGNvbXBhdGlibGUgd2l0aCBEaXJlY3Rpb25hbExpZ2h0XCIpO1xuXG5cdFx0dGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlciA9IDxDYXNjYWRlU2hhZG93TWFwcGVyPiB0aGlzLl9wQ2FzdGluZ0xpZ2h0LnNoYWRvd01hcHBlcjtcblxuXHRcdGlmICghdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlcilcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIlNoYWRvd0Nhc2NhZGVNZXRob2QgcmVxdWlyZXMgYSBsaWdodCB0aGF0IGhhcyBhIENhc2NhZGVTaGFkb3dNYXBwZXIgaW5zdGFuY2UgYXNzaWduZWQgdG8gc2hhZG93TWFwcGVyLlwiKTtcblxuXHRcdHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcihFdmVudC5DSEFOR0UsIChldmVudDpFdmVudCkgPT4gdGhpcy5vbkNhc2NhZGVDaGFuZ2UoZXZlbnQpKTtcblx0XHR0aGlzLl9iYXNlTWV0aG9kLmFkZEV2ZW50TGlzdGVuZXIoU2hhZGluZ01ldGhvZEV2ZW50LlNIQURFUl9JTlZBTElEQVRFRCwgKGV2ZW50OlNoYWRpbmdNZXRob2RFdmVudCkgPT4gdGhpcy5vblNoYWRlckludmFsaWRhdGVkKGV2ZW50KSk7XG5cdH1cblxuXHQvKipcblx0ICogVGhlIHNoYWRvdyBtYXAgc2FtcGxpbmcgbWV0aG9kIHVzZWQgdG8gc2FtcGxlIGluZGl2aWR1YWwgY2FzY2FkZXMuIFRoZXNlIGFyZSB0eXBpY2FsbHkgdGhvc2UgdXNlZCBpbiBjb25qdW5jdGlvblxuXHQgKiB3aXRoIGEgRGlyZWN0aW9uYWxTaGFkb3dNYXBwZXIuXG5cdCAqXG5cdCAqIEBzZWUgU2hhZG93SGFyZE1ldGhvZFxuXHQgKiBAc2VlIFNoYWRvd1NvZnRNZXRob2Rcblx0ICovXG5cdHB1YmxpYyBnZXQgYmFzZU1ldGhvZCgpOlNoYWRvd01ldGhvZEJhc2Vcblx0e1xuXHRcdHJldHVybiB0aGlzLl9iYXNlTWV0aG9kO1xuXHR9XG5cblx0cHVibGljIHNldCBiYXNlTWV0aG9kKHZhbHVlOlNoYWRvd01ldGhvZEJhc2UpXG5cdHtcblx0XHRpZiAodGhpcy5fYmFzZU1ldGhvZCA9PSB2YWx1ZSlcblx0XHRcdHJldHVybjtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QucmVtb3ZlRXZlbnRMaXN0ZW5lcihTaGFkaW5nTWV0aG9kRXZlbnQuU0hBREVSX0lOVkFMSURBVEVELCAoZXZlbnQ6U2hhZGluZ01ldGhvZEV2ZW50KSA9PiB0aGlzLm9uU2hhZGVySW52YWxpZGF0ZWQoZXZlbnQpKTtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QgPSB2YWx1ZTtcblxuXHRcdHRoaXMuX2Jhc2VNZXRob2QuYWRkRXZlbnRMaXN0ZW5lcihTaGFkaW5nTWV0aG9kRXZlbnQuU0hBREVSX0lOVkFMSURBVEVELCAoZXZlbnQ6U2hhZGluZ01ldGhvZEV2ZW50KSA9PiB0aGlzLm9uU2hhZGVySW52YWxpZGF0ZWQoZXZlbnQpKTtcblxuXHRcdHRoaXMuaUludmFsaWRhdGVTaGFkZXJQcm9ncmFtKCk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpSW5pdFZPKHNoYWRlck9iamVjdDpTaGFkZXJMaWdodGluZ09iamVjdCwgbWV0aG9kVk86TWV0aG9kVk8pXG5cdHtcblx0XHR2YXIgdGVtcFZPOk1ldGhvZFZPID0gbmV3IE1ldGhvZFZPKHRoaXMuX2Jhc2VNZXRob2QpO1xuXHRcdHRoaXMuX2Jhc2VNZXRob2QuaUluaXRWTyhzaGFkZXJPYmplY3QsIHRlbXBWTyk7XG5cblx0XHRtZXRob2RWTy5uZWVkc0dsb2JhbFZlcnRleFBvcyA9IHRydWU7XG5cdFx0bWV0aG9kVk8ubmVlZHNQcm9qZWN0aW9uID0gdHJ1ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlJbml0Q29uc3RhbnRzKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTylcblx0e1xuXHRcdHZhciBmcmFnbWVudERhdGE6QXJyYXk8bnVtYmVyPiA9IHNoYWRlck9iamVjdC5mcmFnbWVudENvbnN0YW50RGF0YTtcblx0XHR2YXIgdmVydGV4RGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LnZlcnRleENvbnN0YW50RGF0YTtcblx0XHR2YXIgaW5kZXg6bnVtYmVyID0gbWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXhdID0gMS4wO1xuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDFdID0gMS8yNTUuMDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAyXSA9IDEvNjUwMjUuMDtcblx0XHRmcmFnbWVudERhdGFbaW5kZXggKyAzXSA9IDEvMTY1ODEzNzUuMDtcblxuXHRcdGZyYWdtZW50RGF0YVtpbmRleCArIDZdID0gLjU7XG5cdFx0ZnJhZ21lbnREYXRhW2luZGV4ICsgN10gPSAtLjU7XG5cblx0XHRpbmRleCA9IG1ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4O1xuXHRcdHZlcnRleERhdGFbaW5kZXhdID0gLjU7XG5cdFx0dmVydGV4RGF0YVtpbmRleCArIDFdID0gLS41O1xuXHRcdHZlcnRleERhdGFbaW5kZXggKyAyXSA9IDA7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpQ2xlYW5Db21waWxhdGlvbkRhdGEoKVxuXHR7XG5cdFx0c3VwZXIuaUNsZWFuQ29tcGlsYXRpb25EYXRhKCk7XG5cdFx0dGhpcy5fY2FzY2FkZVByb2plY3Rpb25zID0gbnVsbDtcblx0XHR0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3MgPSBudWxsO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUdldFZlcnRleENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIGNvZGU6c3RyaW5nID0gXCJcIjtcblx0XHR2YXIgZGF0YVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXG5cdFx0dGhpcy5pbml0UHJvamVjdGlvbnNSZWdzKHJlZ2lzdGVyQ2FjaGUpO1xuXHRcdG1ldGhvZFZPLnZlcnRleENvbnN0YW50c0luZGV4ID0gZGF0YVJlZy5pbmRleCo0O1xuXG5cdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4VmVjdG9yVGVtcCgpO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlczsgKytpKSB7XG5cdFx0XHRjb2RlICs9IFwibTQ0IFwiICsgdGVtcCArIFwiLCBcIiArIHNoYXJlZFJlZ2lzdGVycy5nbG9iYWxQb3NpdGlvblZlcnRleCArIFwiLCBcIiArIHRoaXMuX2Nhc2NhZGVQcm9qZWN0aW9uc1tpXSArIFwiXFxuXCIgK1xuXHRcdFx0XHRcImFkZCBcIiArIHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5nc1tpXSArIFwiLCBcIiArIHRlbXAgKyBcIiwgXCIgKyBkYXRhUmVnICsgXCIuenp3elxcblwiO1xuXHRcdH1cblxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgdGhlIHJlZ2lzdGVycyBmb3IgdGhlIGNhc2NhZGVzJyBwcm9qZWN0aW9uIGNvb3JkaW5hdGVzLlxuXHQgKi9cblx0cHJpdmF0ZSBpbml0UHJvamVjdGlvbnNSZWdzKHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSlcblx0e1xuXHRcdHRoaXMuX2Nhc2NhZGVQcm9qZWN0aW9ucyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXMpO1xuXHRcdHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5ncyA9IG5ldyBBcnJheTxTaGFkZXJSZWdpc3RlckVsZW1lbnQ+KHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXMpO1xuXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5udW1DYXNjYWRlczsgKytpKSB7XG5cdFx0XHR0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3NbaV0gPSByZWdpc3RlckNhY2hlLmdldEZyZWVWYXJ5aW5nKCk7XG5cdFx0XHR0aGlzLl9jYXNjYWRlUHJvamVjdGlvbnNbaV0gPSByZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXHRcdFx0cmVnaXN0ZXJDYWNoZS5nZXRGcmVlVmVydGV4Q29uc3RhbnQoKTtcblx0XHRcdHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZVZlcnRleENvbnN0YW50KCk7XG5cdFx0XHRyZWdpc3RlckNhY2hlLmdldEZyZWVWZXJ0ZXhDb25zdGFudCgpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlHZXRGcmFnbWVudENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIG1ldGhvZFZPOk1ldGhvZFZPLCB0YXJnZXRSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCByZWdpc3RlckNhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZ2lzdGVyczpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0dmFyIG51bUNhc2NhZGVzOm51bWJlciA9IHRoaXMuX2Nhc2NhZGVTaGFkb3dNYXBwZXIubnVtQ2FzY2FkZXM7XG5cdFx0dmFyIGRlcHRoTWFwUmVnaXN0ZXI6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlVGV4dHVyZVJlZygpO1xuXHRcdHZhciBkZWNSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRDb25zdGFudCgpO1xuXHRcdHZhciBkYXRhUmVnOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50Q29uc3RhbnQoKTtcblx0XHR2YXIgcGxhbmVEaXN0YW5jZVJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudENvbnN0YW50KCk7XG5cdFx0dmFyIHBsYW5lRGlzdGFuY2VzOkFycmF5PHN0cmluZz4gPSBBcnJheTxzdHJpbmc+KCBwbGFuZURpc3RhbmNlUmVnICsgXCIueFwiLCBwbGFuZURpc3RhbmNlUmVnICsgXCIueVwiLCBwbGFuZURpc3RhbmNlUmVnICsgXCIuelwiLCBwbGFuZURpc3RhbmNlUmVnICsgXCIud1wiICk7XG5cdFx0dmFyIGNvZGU6c3RyaW5nO1xuXG5cdFx0bWV0aG9kVk8uZnJhZ21lbnRDb25zdGFudHNJbmRleCA9IGRlY1JlZy5pbmRleCo0O1xuXHRcdG1ldGhvZFZPLnRleHR1cmVzSW5kZXggPSBkZXB0aE1hcFJlZ2lzdGVyLmluZGV4O1xuXG5cdFx0dmFyIGluUXVhZDpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSByZWdpc3RlckNhY2hlLmdldEZyZWVGcmFnbWVudFZlY3RvclRlbXAoKTtcblx0XHRyZWdpc3RlckNhY2hlLmFkZEZyYWdtZW50VGVtcFVzYWdlcyhpblF1YWQsIDEpO1xuXHRcdHZhciB1dkNvb3JkOlNoYWRlclJlZ2lzdGVyRWxlbWVudCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdHJlZ2lzdGVyQ2FjaGUuYWRkRnJhZ21lbnRUZW1wVXNhZ2VzKHV2Q29vcmQsIDEpO1xuXG5cdFx0Ly8gYXNzdW1lIGxvd2VzdCBwYXJ0aXRpb24gaXMgc2VsZWN0ZWQsIHdpbGwgYmUgb3ZlcndyaXR0ZW4gbGF0ZXIgb3RoZXJ3aXNlXG5cdFx0Y29kZSA9IFwibW92IFwiICsgdXZDb29yZCArIFwiLCBcIiArIHRoaXMuX2RlcHRoTWFwQ29vcmRWYXJ5aW5nc1tudW1DYXNjYWRlcyAtIDFdICsgXCJcXG5cIjtcblxuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gbnVtQ2FzY2FkZXMgLSAyOyBpID49IDA7IC0taSkge1xuXHRcdFx0dmFyIHV2UHJvamVjdGlvbjpTaGFkZXJSZWdpc3RlckVsZW1lbnQgPSB0aGlzLl9kZXB0aE1hcENvb3JkVmFyeWluZ3NbaV07XG5cblx0XHRcdC8vIGNhbGN1bGF0ZSBpZiBpbiB0ZXh0dXJlbWFwIChyZXN1bHQgPT0gMCBvciAxLCBvbmx5IDEgZm9yIGEgc2luZ2xlIHBhcnRpdGlvbilcblx0XHRcdGNvZGUgKz0gXCJzbHQgXCIgKyBpblF1YWQgKyBcIi56LCBcIiArIHNoYXJlZFJlZ2lzdGVycy5wcm9qZWN0aW9uRnJhZ21lbnQgKyBcIi56LCBcIiArIHBsYW5lRGlzdGFuY2VzW2ldICsgXCJcXG5cIjsgLy8geiA9IHggPiBtaW5YLCB3ID0geSA+IG1pbllcblxuXHRcdFx0dmFyIHRlbXA6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID0gcmVnaXN0ZXJDYWNoZS5nZXRGcmVlRnJhZ21lbnRWZWN0b3JUZW1wKCk7XG5cblx0XHRcdC8vIGxpbmVhcmx5IGludGVycG9sYXRlIGJldHdlZW4gb2xkIGFuZCBuZXcgdXYgY29vcmRzIHVzaW5nIHByZWRpY2F0ZSB2YWx1ZSA9PSBjb25kaXRpb25hbCB0b2dnbGUgdG8gbmV3IHZhbHVlIGlmIHByZWRpY2F0ZSA9PSAxICh0cnVlKVxuXHRcdFx0Y29kZSArPSBcInN1YiBcIiArIHRlbXAgKyBcIiwgXCIgKyB1dlByb2plY3Rpb24gKyBcIiwgXCIgKyB1dkNvb3JkICsgXCJcXG5cIiArXG5cdFx0XHRcdFwibXVsIFwiICsgdGVtcCArIFwiLCBcIiArIHRlbXAgKyBcIiwgXCIgKyBpblF1YWQgKyBcIi56XFxuXCIgK1xuXHRcdFx0XHRcImFkZCBcIiArIHV2Q29vcmQgKyBcIiwgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdGVtcCArIFwiXFxuXCI7XG5cdFx0fVxuXG5cdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZShpblF1YWQpO1xuXG5cdFx0Y29kZSArPSBcImRpdiBcIiArIHV2Q29vcmQgKyBcIiwgXCIgKyB1dkNvb3JkICsgXCIsIFwiICsgdXZDb29yZCArIFwiLndcXG5cIiArXG5cdFx0XHRcIm11bCBcIiArIHV2Q29vcmQgKyBcIi54eSwgXCIgKyB1dkNvb3JkICsgXCIueHksIFwiICsgZGF0YVJlZyArIFwiLnp3XFxuXCIgK1xuXHRcdFx0XCJhZGQgXCIgKyB1dkNvb3JkICsgXCIueHksIFwiICsgdXZDb29yZCArIFwiLnh5LCBcIiArIGRhdGFSZWcgKyBcIi56elxcblwiO1xuXG5cdFx0Y29kZSArPSB0aGlzLl9iYXNlTWV0aG9kLl9pR2V0Q2FzY2FkZUZyYWdtZW50Q29kZShzaGFkZXJPYmplY3QsIG1ldGhvZFZPLCBkZWNSZWcsIGRlcHRoTWFwUmVnaXN0ZXIsIHV2Q29vcmQsIHRhcmdldFJlZywgcmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzKSArXG5cdFx0XHRcImFkZCBcIiArIHRhcmdldFJlZyArIFwiLncsIFwiICsgdGFyZ2V0UmVnICsgXCIudywgXCIgKyBkYXRhUmVnICsgXCIueVxcblwiO1xuXG5cdFx0cmVnaXN0ZXJDYWNoZS5yZW1vdmVGcmFnbWVudFRlbXBVc2FnZSh1dkNvb3JkKTtcblxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgaUFjdGl2YXRlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCBtZXRob2RWTzpNZXRob2RWTywgc3RhZ2U6U3RhZ2UpXG5cdHtcblx0XHRzdGFnZS5hY3RpdmF0ZVRleHR1cmUobWV0aG9kVk8udGV4dHVyZXNJbmRleCwgPFRleHR1cmUyREJhc2U+IHRoaXMuX3BDYXN0aW5nTGlnaHQuc2hhZG93TWFwcGVyLmRlcHRoTWFwKTtcblxuXHRcdHZhciB2ZXJ0ZXhEYXRhOkFycmF5PG51bWJlcj4gPSBzaGFkZXJPYmplY3QudmVydGV4Q29uc3RhbnREYXRhO1xuXHRcdHZhciB2ZXJ0ZXhJbmRleDpudW1iZXIgPSBtZXRob2RWTy52ZXJ0ZXhDb25zdGFudHNJbmRleDtcblxuXHRcdHNoYWRlck9iamVjdC52ZXJ0ZXhDb25zdGFudERhdGFbbWV0aG9kVk8udmVydGV4Q29uc3RhbnRzSW5kZXggKyAzXSA9IC0xLyh0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLmRlcHRoKnRoaXMuX3BFcHNpbG9uKTtcblxuXHRcdHZhciBudW1DYXNjYWRlczpudW1iZXIgPSB0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLm51bUNhc2NhZGVzO1xuXHRcdHZlcnRleEluZGV4ICs9IDQ7XG5cdFx0Zm9yICh2YXIgazpudW1iZXIgPSAwOyBrIDwgbnVtQ2FzY2FkZXM7ICsraykge1xuXHRcdFx0dGhpcy5fY2FzY2FkZVNoYWRvd01hcHBlci5nZXREZXB0aFByb2plY3Rpb25zKGspLmNvcHlSYXdEYXRhVG8odmVydGV4RGF0YSwgdmVydGV4SW5kZXgsIHRydWUpO1xuXHRcdFx0dmVydGV4SW5kZXggKz0gMTY7XG5cdFx0fVxuXG5cdFx0dmFyIGZyYWdtZW50RGF0YTpBcnJheTxudW1iZXI+ID0gc2hhZGVyT2JqZWN0LmZyYWdtZW50Q29uc3RhbnREYXRhO1xuXHRcdHZhciBmcmFnbWVudEluZGV4Om51bWJlciA9IG1ldGhvZFZPLmZyYWdtZW50Q29uc3RhbnRzSW5kZXg7XG5cdFx0ZnJhZ21lbnREYXRhW2ZyYWdtZW50SW5kZXggKyA1XSA9IDEgLSB0aGlzLl9wQWxwaGE7XG5cblx0XHR2YXIgbmVhclBsYW5lRGlzdGFuY2VzOkFycmF5PG51bWJlcj4gPSB0aGlzLl9jYXNjYWRlU2hhZG93TWFwcGVyLl9pTmVhclBsYW5lRGlzdGFuY2VzO1xuXG5cdFx0ZnJhZ21lbnRJbmRleCArPSA4O1xuXHRcdGZvciAodmFyIGk6bnVtYmVyID0gMDsgaSA8IG51bUNhc2NhZGVzOyArK2kpXG5cdFx0XHRmcmFnbWVudERhdGFbZnJhZ21lbnRJbmRleCArIGldID0gbmVhclBsYW5lRGlzdGFuY2VzW2ldO1xuXG5cdFx0dGhpcy5fYmFzZU1ldGhvZC5pQWN0aXZhdGVGb3JDYXNjYWRlKHNoYWRlck9iamVjdCwgbWV0aG9kVk8sIHN0YWdlKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIGlTZXRSZW5kZXJTdGF0ZShzaGFkZXJPYmplY3Q6U2hhZGVyT2JqZWN0QmFzZSwgbWV0aG9kVk86TWV0aG9kVk8sIHJlbmRlcmFibGU6UmVuZGVyYWJsZUJhc2UsIHN0YWdlOlN0YWdlLCBjYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdH1cblxuXHQvKipcblx0ICogQ2FsbGVkIHdoZW4gdGhlIHNoYWRvdyBtYXBwZXJzIGNhc2NhZGUgY29uZmlndXJhdGlvbiBjaGFuZ2VzLlxuXHQgKi9cblx0cHJpdmF0ZSBvbkNhc2NhZGVDaGFuZ2UoZXZlbnQ6RXZlbnQpXG5cdHtcblx0XHR0aGlzLmlJbnZhbGlkYXRlU2hhZGVyUHJvZ3JhbSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIHRoZSBiYXNlIG1ldGhvZCdzIHNoYWRlciBjb2RlIGlzIGludmFsaWRhdGVkLlxuXHQgKi9cblx0cHJpdmF0ZSBvblNoYWRlckludmFsaWRhdGVkKGV2ZW50OlNoYWRpbmdNZXRob2RFdmVudClcblx0e1xuXHRcdHRoaXMuaUludmFsaWRhdGVTaGFkZXJQcm9ncmFtKCk7XG5cdH1cbn1cblxuZXhwb3J0ID0gU2hhZG93Q2FzY2FkZU1ldGhvZDsiXX0=