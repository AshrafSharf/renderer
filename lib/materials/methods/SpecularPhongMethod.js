var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var SpecularBasicMethod = require("awayjs-renderergl/lib/materials/methods/SpecularBasicMethod");
/**
 * SpecularPhongMethod provides a specular method that provides Phong highlights.
 */
var SpecularPhongMethod = (function (_super) {
    __extends(SpecularPhongMethod, _super);
    /**
     * Creates a new SpecularPhongMethod object.
     */
    function SpecularPhongMethod() {
        _super.call(this);
    }
    /**
     * @inheritDoc
     */
    SpecularPhongMethod.prototype.iGetFragmentCodePerLight = function (shaderObject, methodVO, lightDirReg, lightColReg, registerCache, sharedRegisters) {
        var code = "";
        var t;
        if (this._pIsFirstLight) {
            t = this._pTotalLightColorReg;
        }
        else {
            t = registerCache.getFreeFragmentVectorTemp();
            registerCache.addFragmentTempUsages(t, 1);
        }
        var viewDirReg = sharedRegisters.viewDirFragment;
        var normalReg = sharedRegisters.normalFragment;
        // phong model
        code += "dp3 " + t + ".w, " + lightDirReg + ", " + normalReg + "\n" + "add " + t + ".w, " + t + ".w, " + t + ".w\n" + "mul " + t + ".xyz, " + normalReg + ", " + t + ".w\n" + "sub " + t + ".xyz, " + t + ", " + lightDirReg + "\n" + "add " + t + ".w, " + t + ".w, " + sharedRegisters.commons + ".w\n" + "sat " + t + ".w, " + t + ".w\n" + "mul " + t + ".xyz, " + t + ", " + t + ".w\n" + "dp3 " + t + ".w, " + t + ", " + viewDirReg + "\n" + "sat " + t + ".w, " + t + ".w\n";
        if (this._pUseTexture) {
            // apply gloss modulation from texture
            code += "mul " + this._pSpecularTexData + ".w, " + this._pSpecularTexData + ".y, " + this._pSpecularDataRegister + ".w\n" + "pow " + t + ".w, " + t + ".w, " + this._pSpecularTexData + ".w\n";
        }
        else
            code += "pow " + t + ".w, " + t + ".w, " + this._pSpecularDataRegister + ".w\n";
        // attenuate
        if (shaderObject.usesLightFallOff)
            code += "mul " + t + ".w, " + t + ".w, " + lightDirReg + ".w\n";
        if (this._iModulateMethod != null)
            code += this._iModulateMethod(shaderObject, methodVO, t, registerCache, sharedRegisters);
        code += "mul " + t + ".xyz, " + lightColReg + ".xyz, " + t + ".w\n";
        if (!this._pIsFirstLight) {
            code += "add " + this._pTotalLightColorReg + ".xyz, " + this._pTotalLightColorReg + ".xyz, " + t + ".xyz\n";
            registerCache.removeFragmentTempUsage(t);
        }
        this._pIsFirstLight = false;
        return code;
    };
    return SpecularPhongMethod;
})(SpecularBasicMethod);
module.exports = SpecularPhongMethod;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbWV0aG9kcy9zcGVjdWxhcnBob25nbWV0aG9kLnRzIl0sIm5hbWVzIjpbIlNwZWN1bGFyUGhvbmdNZXRob2QiLCJTcGVjdWxhclBob25nTWV0aG9kLmNvbnN0cnVjdG9yIiwiU3BlY3VsYXJQaG9uZ01ldGhvZC5pR2V0RnJhZ21lbnRDb2RlUGVyTGlnaHQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUtBLElBQU8sbUJBQW1CLFdBQWMsNkRBQTZELENBQUMsQ0FBQztBQUV2RyxBQUdBOztHQURHO0lBQ0csbUJBQW1CO0lBQVNBLFVBQTVCQSxtQkFBbUJBLFVBQTRCQTtJQUVwREE7O09BRUdBO0lBQ0hBLFNBTEtBLG1CQUFtQkE7UUFPdkJDLGlCQUFPQSxDQUFDQTtJQUNUQSxDQUFDQTtJQUVERDs7T0FFR0E7SUFDSUEsc0RBQXdCQSxHQUEvQkEsVUFBZ0NBLFlBQWlDQSxFQUFFQSxRQUFpQkEsRUFBRUEsV0FBaUNBLEVBQUVBLFdBQWlDQSxFQUFFQSxhQUFpQ0EsRUFBRUEsZUFBa0NBO1FBRWhPRSxJQUFJQSxJQUFJQSxHQUFVQSxFQUFFQSxDQUFDQTtRQUNyQkEsSUFBSUEsQ0FBdUJBLENBQUNBO1FBRTVCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN6QkEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQTtRQUMvQkEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsQ0FBQ0EsR0FBR0EsYUFBYUEsQ0FBQ0EseUJBQXlCQSxFQUFFQSxDQUFDQTtZQUM5Q0EsYUFBYUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUMzQ0EsQ0FBQ0E7UUFFREEsSUFBSUEsVUFBVUEsR0FBd0JBLGVBQWVBLENBQUNBLGVBQWVBLENBQUNBO1FBQ3RFQSxJQUFJQSxTQUFTQSxHQUF3QkEsZUFBZUEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7UUFFcEVBLEFBQ0FBLGNBRGNBO1FBQ2RBLElBQUlBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLE1BQU1BLEdBQUdBLFdBQVdBLEdBQUdBLElBQUlBLEdBQUdBLFNBQVNBLEdBQUdBLElBQUlBLEdBR2xFQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUM3Q0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsUUFBUUEsR0FBR0EsU0FBU0EsR0FBR0EsSUFBSUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FDckRBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLFFBQVFBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLFdBQVdBLEdBQUdBLElBQUlBLEdBR3JEQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFFQSxlQUFlQSxDQUFDQSxPQUFPQSxHQUFHQSxNQUFNQSxHQUNsRUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FDaENBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLFFBQVFBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLEdBQUdBLE1BQU1BLEdBRzdDQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxHQUFHQSxVQUFVQSxHQUFHQSxJQUFJQSxHQUNsREEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFFbENBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZCQSxBQUNBQSxzQ0FEc0NBO1lBQ3RDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLGlCQUFpQkEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxNQUFNQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLE1BQU1BLENBQUNBO1FBQ2hNQSxDQUFDQTtRQUFDQSxJQUFJQTtZQUNMQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxzQkFBc0JBLEdBQUdBLE1BQU1BLENBQUNBO1FBRWpGQSxBQUNBQSxZQURZQTtRQUNaQSxFQUFFQSxDQUFDQSxDQUFDQSxZQUFZQSxDQUFDQSxnQkFBZ0JBLENBQUNBO1lBQ2pDQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxDQUFDQSxHQUFHQSxNQUFNQSxHQUFHQSxXQUFXQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUVqRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxJQUFJQSxJQUFJQSxDQUFDQTtZQUNqQ0EsSUFBSUEsSUFBSUEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxZQUFZQSxFQUFFQSxRQUFRQSxFQUFFQSxDQUFDQSxFQUFFQSxhQUFhQSxFQUFFQSxlQUFlQSxDQUFDQSxDQUFDQTtRQUUxRkEsSUFBSUEsSUFBSUEsTUFBTUEsR0FBR0EsQ0FBQ0EsR0FBR0EsUUFBUUEsR0FBR0EsV0FBV0EsR0FBR0EsUUFBUUEsR0FBR0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFFcEVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLENBQUNBO1lBQzFCQSxJQUFJQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxvQkFBb0JBLEdBQUdBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLG9CQUFvQkEsR0FBR0EsUUFBUUEsR0FBR0EsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0E7WUFDNUdBLGFBQWFBLENBQUNBLHVCQUF1QkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDMUNBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLEtBQUtBLENBQUNBO1FBRTVCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQTtJQUNiQSxDQUFDQTtJQUNGRiwwQkFBQ0E7QUFBREEsQ0FyRUEsQUFxRUNBLEVBckVpQyxtQkFBbUIsRUFxRXBEO0FBRUQsQUFBNkIsaUJBQXBCLG1CQUFtQixDQUFDIiwiZmlsZSI6Im1hdGVyaWFscy9tZXRob2RzL1NwZWN1bGFyUGhvbmdNZXRob2QuanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE1ldGhvZFZPXHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL01ldGhvZFZPXCIpO1xuaW1wb3J0IFNoYWRlckxpZ2h0aW5nT2JqZWN0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlckxpZ2h0aW5nT2JqZWN0XCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJDYWNoZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyRWxlbWVudFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJFbGVtZW50XCIpO1xuaW1wb3J0IFNwZWN1bGFyQmFzaWNNZXRob2RcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbWV0aG9kcy9TcGVjdWxhckJhc2ljTWV0aG9kXCIpO1xuXG4vKipcbiAqIFNwZWN1bGFyUGhvbmdNZXRob2QgcHJvdmlkZXMgYSBzcGVjdWxhciBtZXRob2QgdGhhdCBwcm92aWRlcyBQaG9uZyBoaWdobGlnaHRzLlxuICovXG5jbGFzcyBTcGVjdWxhclBob25nTWV0aG9kIGV4dGVuZHMgU3BlY3VsYXJCYXNpY01ldGhvZFxue1xuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBTcGVjdWxhclBob25nTWV0aG9kIG9iamVjdC5cblx0ICovXG5cdGNvbnN0cnVjdG9yKClcblx0e1xuXHRcdHN1cGVyKCk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBpR2V0RnJhZ21lbnRDb2RlUGVyTGlnaHQoc2hhZGVyT2JqZWN0OlNoYWRlckxpZ2h0aW5nT2JqZWN0LCBtZXRob2RWTzpNZXRob2RWTywgbGlnaHREaXJSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50LCBsaWdodENvbFJlZzpTaGFkZXJSZWdpc3RlckVsZW1lbnQsIHJlZ2lzdGVyQ2FjaGU6U2hhZGVyUmVnaXN0ZXJDYWNoZSwgc2hhcmVkUmVnaXN0ZXJzOlNoYWRlclJlZ2lzdGVyRGF0YSk6c3RyaW5nXG5cdHtcblx0XHR2YXIgY29kZTpzdHJpbmcgPSBcIlwiO1xuXHRcdHZhciB0OlNoYWRlclJlZ2lzdGVyRWxlbWVudDtcblxuXHRcdGlmICh0aGlzLl9wSXNGaXJzdExpZ2h0KSB7XG5cdFx0XHR0ID0gdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZztcblx0XHR9IGVsc2Uge1xuXHRcdFx0dCA9IHJlZ2lzdGVyQ2FjaGUuZ2V0RnJlZUZyYWdtZW50VmVjdG9yVGVtcCgpO1xuXHRcdFx0cmVnaXN0ZXJDYWNoZS5hZGRGcmFnbWVudFRlbXBVc2FnZXModCwgMSk7XG5cdFx0fVxuXG5cdFx0dmFyIHZpZXdEaXJSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID1zaGFyZWRSZWdpc3RlcnMudmlld0RpckZyYWdtZW50O1xuXHRcdHZhciBub3JtYWxSZWc6U2hhZGVyUmVnaXN0ZXJFbGVtZW50ID1zaGFyZWRSZWdpc3RlcnMubm9ybWFsRnJhZ21lbnQ7XG5cblx0XHQvLyBwaG9uZyBtb2RlbFxuXHRcdGNvZGUgKz0gXCJkcDMgXCIgKyB0ICsgXCIudywgXCIgKyBsaWdodERpclJlZyArIFwiLCBcIiArIG5vcm1hbFJlZyArIFwiXFxuXCIgKyAvLyBzY2ExID0gbGlnaHQubm9ybWFsXG5cblx0XHRcdC8vZmluZCB0aGUgcmVmbGVjdGVkIGxpZ2h0IHZlY3RvciBSXG5cdFx0XHRcImFkZCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53XFxuXCIgKyAvLyBzY2ExID0gc2NhMSoyXG5cdFx0XHRcIm11bCBcIiArIHQgKyBcIi54eXosIFwiICsgbm9ybWFsUmVnICsgXCIsIFwiICsgdCArIFwiLndcXG5cIiArIC8vIHZlYzEgPSBub3JtYWwqc2NhMVxuXHRcdFx0XCJzdWIgXCIgKyB0ICsgXCIueHl6LCBcIiArIHQgKyBcIiwgXCIgKyBsaWdodERpclJlZyArIFwiXFxuXCIgKyAvLyB2ZWMxID0gdmVjMSAtIGxpZ2h0IChsaWdodCB2ZWN0b3IgaXMgbmVnYXRpdmUpXG5cblx0XHRcdC8vc21vb3RoIHRoZSBlZGdlIGFzIGluY2lkZW5jZSBhbmdsZSBhcHByb2FjaGVzIDkwXG5cdFx0XHRcImFkZCBcIiArIHQgKyBcIi53LCBcIiArIHQgKyBcIi53LCBcIiArc2hhcmVkUmVnaXN0ZXJzLmNvbW1vbnMgKyBcIi53XFxuXCIgKyAvLyBzY2ExID0gc2NhMSArIHNtb290aHRlcDtcblx0XHRcdFwic2F0IFwiICsgdCArIFwiLncsIFwiICsgdCArIFwiLndcXG5cIiArIC8vIHNjYTEgcmFuZ2UgMCAtIDFcblx0XHRcdFwibXVsIFwiICsgdCArIFwiLnh5eiwgXCIgKyB0ICsgXCIsIFwiICsgdCArIFwiLndcXG5cIiArIC8vIHZlYzEgPSB2ZWMxKnNjYTFcblxuXHRcdFx0Ly9maW5kIHRoZSBkb3QgcHJvZHVjdCBiZXR3ZWVuIFIgYW5kIFZcblx0XHRcdFwiZHAzIFwiICsgdCArIFwiLncsIFwiICsgdCArIFwiLCBcIiArIHZpZXdEaXJSZWcgKyBcIlxcblwiICsgLy8gc2NhMSA9IHZlYzEudmlld1xuXHRcdFx0XCJzYXQgXCIgKyB0ICsgXCIudywgXCIgKyB0ICsgXCIud1xcblwiO1xuXG5cdFx0aWYgKHRoaXMuX3BVc2VUZXh0dXJlKSB7XG5cdFx0XHQvLyBhcHBseSBnbG9zcyBtb2R1bGF0aW9uIGZyb20gdGV4dHVyZVxuXHRcdFx0Y29kZSArPSBcIm11bCBcIiArIHRoaXMuX3BTcGVjdWxhclRleERhdGEgKyBcIi53LCBcIiArIHRoaXMuX3BTcGVjdWxhclRleERhdGEgKyBcIi55LCBcIiArIHRoaXMuX3BTcGVjdWxhckRhdGFSZWdpc3RlciArIFwiLndcXG5cIiArIFwicG93IFwiICsgdCArIFwiLncsIFwiICsgdCArIFwiLncsIFwiICsgdGhpcy5fcFNwZWN1bGFyVGV4RGF0YSArIFwiLndcXG5cIjtcblx0XHR9IGVsc2Vcblx0XHRcdGNvZGUgKz0gXCJwb3cgXCIgKyB0ICsgXCIudywgXCIgKyB0ICsgXCIudywgXCIgKyB0aGlzLl9wU3BlY3VsYXJEYXRhUmVnaXN0ZXIgKyBcIi53XFxuXCI7XG5cblx0XHQvLyBhdHRlbnVhdGVcblx0XHRpZiAoc2hhZGVyT2JqZWN0LnVzZXNMaWdodEZhbGxPZmYpXG5cdFx0XHRjb2RlICs9IFwibXVsIFwiICsgdCArIFwiLncsIFwiICsgdCArIFwiLncsIFwiICsgbGlnaHREaXJSZWcgKyBcIi53XFxuXCI7XG5cblx0XHRpZiAodGhpcy5faU1vZHVsYXRlTWV0aG9kICE9IG51bGwpXG5cdFx0XHRjb2RlICs9IHRoaXMuX2lNb2R1bGF0ZU1ldGhvZChzaGFkZXJPYmplY3QsIG1ldGhvZFZPLCB0LCByZWdpc3RlckNhY2hlLCBzaGFyZWRSZWdpc3RlcnMpO1xuXG5cdFx0Y29kZSArPSBcIm11bCBcIiArIHQgKyBcIi54eXosIFwiICsgbGlnaHRDb2xSZWcgKyBcIi54eXosIFwiICsgdCArIFwiLndcXG5cIjtcblxuXHRcdGlmICghdGhpcy5fcElzRmlyc3RMaWdodCkge1xuXHRcdFx0Y29kZSArPSBcImFkZCBcIiArIHRoaXMuX3BUb3RhbExpZ2h0Q29sb3JSZWcgKyBcIi54eXosIFwiICsgdGhpcy5fcFRvdGFsTGlnaHRDb2xvclJlZyArIFwiLnh5eiwgXCIgKyB0ICsgXCIueHl6XFxuXCI7XG5cdFx0XHRyZWdpc3RlckNhY2hlLnJlbW92ZUZyYWdtZW50VGVtcFVzYWdlKHQpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3BJc0ZpcnN0TGlnaHQgPSBmYWxzZTtcblxuXHRcdHJldHVybiBjb2RlO1xuXHR9XG59XG5cbmV4cG9ydCA9IFNwZWN1bGFyUGhvbmdNZXRob2Q7Il19