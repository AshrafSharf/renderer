var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var LineSubGeometry = require("awayjs-display/lib/base/LineSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var MaterialGLBase = require("awayjs-renderergl/lib/materials/MaterialGLBase");
var LineBasicPass = require("awayjs-renderergl/lib/passes/LineBasicPass");
/**
 * LineMaterial is a material exclusively used to render wireframe objects
 *
 * @see away.entities.Lines
 */
var LineBasicMaterial = (function (_super) {
    __extends(LineBasicMaterial, _super);
    /**
     * Creates a new LineMaterial object.
     *
     * @param thickness The thickness of the wireframe lines.
     */
    function LineBasicMaterial(thickness) {
        if (thickness === void 0) { thickness = 1.25; }
        _super.call(this);
        this._constants = new Array(0, 0, 0, 0);
        this._thickness = thickness;
        this.bothSides = true;
        this._pAddScreenPass(this._screenPass = new LineBasicPass());
        this._calcMatrix = new Matrix3D();
        this._constants[1] = 1 / 255;
    }
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iGetVertexCode = function (shaderObject, regCache, sharedReg) {
        return "m44 vt0, va0, vc8			\n" + "m44 vt1, va1, vc8			\n" + "sub vt2, vt1, vt0 			\n" + "slt vt5.x, vt0.z, vc7.z			\n" + "sub vt5.y, vc5.x, vt5.x			\n" + "add vt4.x, vt0.z, vc7.z			\n" + "sub vt4.y, vt0.z, vt1.z			\n" + "seq vt4.z, vt4.y vc6.x			\n" + "add vt4.y, vt4.y, vt4.z			\n" + "div vt4.z, vt4.x, vt4.y			\n" + "mul vt4.xyz, vt4.zzz, vt2.xyz	\n" + "add vt3.xyz, vt0.xyz, vt4.xyz	\n" + "mov vt3.w, vc5.x			\n" + "mul vt0, vt0, vt5.yyyy			\n" + "mul vt3, vt3, vt5.xxxx			\n" + "add vt0, vt0, vt3				\n" + "sub vt2, vt1, vt0 			\n" + "nrm vt2.xyz, vt2.xyz			\n" + "nrm vt5.xyz, vt0.xyz			\n" + "mov vt5.w, vc5.x				\n" + "crs vt3.xyz, vt2, vt5			\n" + "nrm vt3.xyz, vt3.xyz			\n" + "mul vt3.xyz, vt3.xyz, va2.xxx	\n" + "mov vt3.w, vc5.x			\n" + "dp3 vt4.x, vt0, vc6			\n" + "mul vt4.x, vt4.x, vc7.x			\n" + "mul vt3.xyz, vt3.xyz, vt4.xxx	\n" + "add vt0.xyz, vt0.xyz, vt3.xyz	\n" + "m44 op, vt0, vc0			\n" + "mov v0, va3				\n";
    };
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iActivatePass = function (pass, renderer, camera) {
        _super.prototype._iActivatePass.call(this, pass, renderer, camera);
        var context = renderer.context;
        var stage = renderer.stage;
        this._constants[0] = this._thickness / ((stage.scissorRect) ? Math.min(stage.scissorRect.width, stage.scissorRect.height) : Math.min(stage.width, stage.height));
        // value to convert distance from camera to model length per pixel width
        this._constants[2] = camera.projection.near;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineBasicMaterial.pONE_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineBasicMaterial.pFRONT_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);
        // projection matrix
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);
    };
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iRenderPass = function (pass, renderable, stage, camera, viewProjection) {
        _super.prototype._iRenderPass.call(this, pass, renderable, stage, camera, viewProjection);
        var context = stage.context;
        this._calcMatrix.copyFrom(renderable.sourceEntity.sceneTransform);
        this._calcMatrix.append(camera.inverseSceneTransform);
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);
        stage.activateBuffer(0, renderable.getVertexData(LineSubGeometry.START_POSITION_DATA), renderable.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        stage.activateBuffer(1, renderable.getVertexData(LineSubGeometry.END_POSITION_DATA), renderable.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        stage.activateBuffer(2, renderable.getVertexData(LineSubGeometry.THICKNESS_DATA), renderable.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);
        stage.activateBuffer(3, renderable.getVertexData(LineSubGeometry.COLOR_DATA), renderable.getVertexOffset(LineSubGeometry.COLOR_DATA), LineSubGeometry.COLOR_FORMAT);
        context.drawTriangles(stage.getIndexBuffer(renderable.getIndexData()), 0, renderable.numTriangles);
    };
    LineBasicMaterial.pONE_VECTOR = Array(1, 1, 1, 1);
    LineBasicMaterial.pFRONT_VECTOR = Array(0, 0, -1, 0);
    return LineBasicMaterial;
})(MaterialGLBase);
module.exports = LineBasicMaterial;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbGluZWJhc2ljbWF0ZXJpYWwudHMiXSwibmFtZXMiOlsiTGluZUJhc2ljTWF0ZXJpYWwiLCJMaW5lQmFzaWNNYXRlcmlhbC5jb25zdHJ1Y3RvciIsIkxpbmVCYXNpY01hdGVyaWFsLl9pR2V0VmVydGV4Q29kZSIsIkxpbmVCYXNpY01hdGVyaWFsLl9pQWN0aXZhdGVQYXNzIiwiTGluZUJhc2ljTWF0ZXJpYWwuX2lSZW5kZXJQYXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUVoRSxJQUFPLGVBQWUsV0FBYyx5Q0FBeUMsQ0FBQyxDQUFDO0FBRy9FLElBQU8sb0JBQW9CLFdBQWEsOENBQThDLENBQUMsQ0FBQztBQU94RixJQUFPLGNBQWMsV0FBYyxnREFBZ0QsQ0FBQyxDQUFDO0FBSXJGLElBQU8sYUFBYSxXQUFjLDRDQUE0QyxDQUFDLENBQUM7QUFFaEYsQUFLQTs7OztHQURHO0lBQ0csaUJBQWlCO0lBQVNBLFVBQTFCQSxpQkFBaUJBLFVBQXVCQTtJQVc3Q0E7Ozs7T0FJR0E7SUFDSEEsU0FoQktBLGlCQUFpQkEsQ0FnQlZBLFNBQXVCQTtRQUF2QkMseUJBQXVCQSxHQUF2QkEsZ0JBQXVCQTtRQUVsQ0EsaUJBQU9BLENBQUNBO1FBYkRBLGVBQVVBLEdBQWlCQSxJQUFJQSxLQUFLQSxDQUFTQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQWVoRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsU0FBU0EsQ0FBQ0E7UUFFNUJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBO1FBRXRCQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxJQUFJQSxhQUFhQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUU3REEsSUFBSUEsQ0FBQ0EsV0FB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LENBQUNBLENBQUNBO1FBQ3JMQSxLQUFLQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQSxlQUFlQSxDQUFDQSxjQUFjQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxlQUFlQSxDQUFDQSxlQUFlQSxDQUFDQSxjQUFjQSxDQUFDQSxFQUFFQSxlQUFlQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBO1FBQ2hMQSxLQUFLQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxhQUFhQSxDQUFDQSxlQUFlQSxDQUFDQSxVQUFVQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxlQUFlQSxDQUFDQSxlQUFlQSxDQUFDQSxVQUFVQSxDQUFDQSxFQUFFQSxlQUFlQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtRQUVwS0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsWUFBWUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7SUFDcEdBLENBQUNBO0lBMUlhSiw2QkFBV0EsR0FBaUJBLEtBQUtBLENBQVNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBQ3REQSwrQkFBYUEsR0FBaUJBLEtBQUtBLENBQVNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO0lBMEl4RUEsd0JBQUNBO0FBQURBLENBN0lBLEFBNklDQSxFQTdJK0IsY0FBYyxFQTZJN0M7QUFFRCxBQUEyQixpQkFBbEIsaUJBQWlCLENBQUMiLCJmaWxlIjoibWF0ZXJpYWxzL0xpbmVCYXNpY01hdGVyaWFsLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEXCIpO1xuXG5pbXBvcnQgTGluZVN1Ykdlb21ldHJ5XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9MaW5lU3ViR2VvbWV0cnlcIik7XG5pbXBvcnQgQ2FtZXJhXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcblxuaW1wb3J0IENvbnRleHRHTFByb2dyYW1UeXBlXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMUHJvZ3JhbVR5cGVcIik7XG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xuaW1wb3J0IFN0YWdlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XG5cbmltcG9ydCBSZW5kZXJlckJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2Jhc2UvUmVuZGVyZXJCYXNlXCIpO1xuaW1wb3J0IE1hdGVyaWFsUGFzc0RhdGFcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL01hdGVyaWFsUGFzc0RhdGFcIik7XG5pbXBvcnQgUmVuZGVyYWJsZUJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xuaW1wb3J0IE1hdGVyaWFsR0xCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL01hdGVyaWFsR0xCYXNlXCIpO1xuaW1wb3J0IFNoYWRlck9iamVjdEJhc2VcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9TaGFkZXJPYmplY3RCYXNlXCIpO1xuaW1wb3J0IFNoYWRlclJlZ2lzdGVyQ2FjaGVcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJDYWNoZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJEYXRhXCIpO1xuaW1wb3J0IExpbmVCYXNpY1Bhc3NcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wYXNzZXMvTGluZUJhc2ljUGFzc1wiKTtcblxuLyoqXG4gKiBMaW5lTWF0ZXJpYWwgaXMgYSBtYXRlcmlhbCBleGNsdXNpdmVseSB1c2VkIHRvIHJlbmRlciB3aXJlZnJhbWUgb2JqZWN0c1xuICpcbiAqIEBzZWUgYXdheS5lbnRpdGllcy5MaW5lc1xuICovXG5jbGFzcyBMaW5lQmFzaWNNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsR0xCYXNlXG57XG5cdHB1YmxpYyBzdGF0aWMgcE9ORV9WRUNUT1I6QXJyYXk8bnVtYmVyPiA9IEFycmF5PG51bWJlcj4oMSwgMSwgMSwgMSk7XG5cdHB1YmxpYyBzdGF0aWMgcEZST05UX1ZFQ1RPUjpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigwLCAwLCAtMSwgMCk7XG5cblx0cHJpdmF0ZSBfY29uc3RhbnRzOkFycmF5PG51bWJlcj4gPSBuZXcgQXJyYXk8bnVtYmVyPigwLCAwLCAwLCAwKTtcblx0cHJpdmF0ZSBfY2FsY01hdHJpeDpNYXRyaXgzRDtcblx0cHJpdmF0ZSBfdGhpY2tuZXNzOm51bWJlcjtcblxuXHRwcml2YXRlIF9zY3JlZW5QYXNzOkxpbmVCYXNpY1Bhc3M7XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgTGluZU1hdGVyaWFsIG9iamVjdC5cblx0ICpcblx0ICogQHBhcmFtIHRoaWNrbmVzcyBUaGUgdGhpY2tuZXNzIG9mIHRoZSB3aXJlZnJhbWUgbGluZXMuXG5cdCAqL1xuXHRjb25zdHJ1Y3Rvcih0aGlja25lc3M6bnVtYmVyID0gMS4yNSlcblx0e1xuXHRcdHN1cGVyKCk7XG5cblx0XHR0aGlzLl90aGlja25lc3MgPSB0aGlja25lc3M7XG5cblx0XHR0aGlzLmJvdGhTaWRlcyA9IHRydWU7XG5cblx0XHR0aGlzLl9wQWRkU2NyZWVuUGFzcyh0aGlzLl9zY3JlZW5QYXNzID0gbmV3IExpbmVCYXNpY1Bhc3MoKSk7XG5cblx0XHR0aGlzLl9jYWxjTWF0cml4ID0gbmV3IE1hdHJpeDNEKCk7XG5cblx0XHR0aGlzLl9jb25zdGFudHNbMV0gPSAxLzI1NTtcblx0fVxuXG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lHZXRWZXJ0ZXhDb2RlKHNoYWRlck9iamVjdDpTaGFkZXJPYmplY3RCYXNlLCByZWdDYWNoZTpTaGFkZXJSZWdpc3RlckNhY2hlLCBzaGFyZWRSZWc6U2hhZGVyUmVnaXN0ZXJEYXRhKTpzdHJpbmdcblx0e1xuXHRcdHJldHVybiBcIm00NCB2dDAsIHZhMCwgdmM4XHRcdFx0XFxuXCIgKyAvLyB0cmFuc2Zvcm0gUTAgdG8gZXllIHNwYWNlXG5cdFx0XHRcIm00NCB2dDEsIHZhMSwgdmM4XHRcdFx0XFxuXCIgKyAvLyB0cmFuc2Zvcm0gUTEgdG8gZXllIHNwYWNlXG5cdFx0XHRcInN1YiB2dDIsIHZ0MSwgdnQwIFx0XHRcdFxcblwiICsgLy8gTCA9IFExIC0gUTBcblxuXHRcdFx0Ly8gdGVzdCBpZiBiZWhpbmQgY2FtZXJhIG5lYXIgcGxhbmVcblx0XHRcdC8vIGlmIDAgLSBRMC56IDwgQ2FtZXJhLm5lYXIgdGhlbiB0aGUgcG9pbnQgbmVlZHMgdG8gYmUgY2xpcHBlZFxuXHRcdFx0Ly9cIm5lZyB2dDUueCwgdnQwLnpcdFx0XHRcdFxcblwiICsgLy8gMCAtIFEwLnpcblx0XHRcdFwic2x0IHZ0NS54LCB2dDAueiwgdmM3LnpcdFx0XHRcXG5cIiArIC8vIGJlaGluZCA9ICggMCAtIFEwLnogPCAtQ2FtZXJhLm5lYXIgKSA/IDEgOiAwXG5cdFx0XHRcInN1YiB2dDUueSwgdmM1LngsIHZ0NS54XHRcdFx0XFxuXCIgKyAvLyAhYmVoaW5kID0gMSAtIGJlaGluZFxuXG5cdFx0XHQvLyBwID0gcG9pbnQgb24gdGhlIHBsYW5lICgwLDAsLW5lYXIpXG5cdFx0XHQvLyBuID0gcGxhbmUgbm9ybWFsICgwLDAsLTEpXG5cdFx0XHQvLyBEID0gUTEgLSBRMFxuXHRcdFx0Ly8gdCA9ICggZG90KCBuLCAoIHAgLSBRMCApICkgLyAoIGRvdCggbiwgZCApXG5cblx0XHRcdC8vIHNvbHZlIGZvciB0IHdoZXJlIGxpbmUgY3Jvc3NlcyBDYW1lcmEubmVhclxuXHRcdFx0XCJhZGQgdnQ0LngsIHZ0MC56LCB2Yzcuelx0XHRcdFxcblwiICsgLy8gUTAueiArICggLUNhbWVyYS5uZWFyIClcblx0XHRcdFwic3ViIHZ0NC55LCB2dDAueiwgdnQxLnpcdFx0XHRcXG5cIiArIC8vIFEwLnogLSBRMS56XG5cblx0XHRcdC8vIGZpeCBkaXZpZGUgYnkgemVybyBmb3IgaG9yaXpvbnRhbCBsaW5lc1xuXHRcdFx0XCJzZXEgdnQ0LnosIHZ0NC55IHZjNi54XHRcdFx0XFxuXCIgKyAvLyBvZmZzZXQgPSAoUTAueiAtIFExLnopPT0wID8gMSA6IDBcblx0XHRcdFwiYWRkIHZ0NC55LCB2dDQueSwgdnQ0LnpcdFx0XHRcXG5cIiArIC8vICggUTAueiAtIFExLnogKSArIG9mZnNldFxuXG5cdFx0XHRcImRpdiB2dDQueiwgdnQ0LngsIHZ0NC55XHRcdFx0XFxuXCIgKyAvLyB0ID0gKCBRMC56IC0gbmVhciApIC8gKCBRMC56IC0gUTEueiApXG5cblx0XHRcdFwibXVsIHZ0NC54eXosIHZ0NC56enosIHZ0Mi54eXpcdFxcblwiICsgLy8gdChMKVxuXHRcdFx0XCJhZGQgdnQzLnh5eiwgdnQwLnh5eiwgdnQ0Lnh5elx0XFxuXCIgKyAvLyBRY2xpcHBlZCA9IFEwICsgdChMKVxuXHRcdFx0XCJtb3YgdnQzLncsIHZjNS54XHRcdFx0XFxuXCIgKyAvLyBRY2xpcHBlZC53ID0gMVxuXG5cdFx0XHQvLyBJZiBuZWNlc3NhcnksIHJlcGxhY2UgUTAgd2l0aCBuZXcgUWNsaXBwZWRcblx0XHRcdFwibXVsIHZ0MCwgdnQwLCB2dDUueXl5eVx0XHRcdFxcblwiICsgLy8gIWJlaGluZCAqIFEwXG5cdFx0XHRcIm11bCB2dDMsIHZ0MywgdnQ1Lnh4eHhcdFx0XHRcXG5cIiArIC8vIGJlaGluZCAqIFFjbGlwcGVkXG5cdFx0XHRcImFkZCB2dDAsIHZ0MCwgdnQzXHRcdFx0XHRcXG5cIiArIC8vIG5ld1EwID0gUTAgKyBRY2xpcHBlZFxuXG5cdFx0XHQvLyBjYWxjdWxhdGUgc2lkZSB2ZWN0b3IgZm9yIGxpbmVcblx0XHRcdFwic3ViIHZ0MiwgdnQxLCB2dDAgXHRcdFx0XFxuXCIgKyAvLyBMID0gUTEgLSBRMFxuXHRcdFx0XCJucm0gdnQyLnh5eiwgdnQyLnh5elx0XHRcdFxcblwiICsgLy8gbm9ybWFsaXplKCBMIClcblx0XHRcdFwibnJtIHZ0NS54eXosIHZ0MC54eXpcdFx0XHRcXG5cIiArIC8vIEQgPSBub3JtYWxpemUoIFExIClcblx0XHRcdFwibW92IHZ0NS53LCB2YzUueFx0XHRcdFx0XFxuXCIgKyAvLyBELncgPSAxXG5cdFx0XHRcImNycyB2dDMueHl6LCB2dDIsIHZ0NVx0XHRcdFxcblwiICsgLy8gUyA9IEwgeCBEXG5cdFx0XHRcIm5ybSB2dDMueHl6LCB2dDMueHl6XHRcdFx0XFxuXCIgKyAvLyBub3JtYWxpemUoIFMgKVxuXG5cdFx0XHQvLyBmYWNlIHRoZSBzaWRlIHZlY3RvciBwcm9wZXJseSBmb3IgdGhlIGdpdmVuIHBvaW50XG5cdFx0XHRcIm11bCB2dDMueHl6LCB2dDMueHl6LCB2YTIueHh4XHRcXG5cIiArIC8vIFMgKj0gd2VpZ2h0XG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFMudyA9IDFcblxuXHRcdFx0Ly8gY2FsY3VsYXRlIHRoZSBhbW91bnQgcmVxdWlyZWQgdG8gbW92ZSBhdCB0aGUgcG9pbnQncyBkaXN0YW5jZSB0byBjb3JyZXNwb25kIHRvIHRoZSBsaW5lJ3MgcGl4ZWwgd2lkdGhcblx0XHRcdC8vIHNjYWxlIHRoZSBzaWRlIHZlY3RvciBieSB0aGF0IGFtb3VudFxuXHRcdFx0XCJkcDMgdnQ0LngsIHZ0MCwgdmM2XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSA9IGRvdCggdmlldyApXG5cdFx0XHRcIm11bCB2dDQueCwgdnQ0LngsIHZjNy54XHRcdFx0XFxuXCIgKyAvLyBkaXN0YW5jZSAqPSB2cHNvZFxuXHRcdFx0XCJtdWwgdnQzLnh5eiwgdnQzLnh5eiwgdnQ0Lnh4eFx0XFxuXCIgKyAvLyBTLnh5eiAqPSBwaXhlbFNjYWxlRmFjdG9yXG5cblx0XHRcdC8vIGFkZCBzY2FsZWQgc2lkZSB2ZWN0b3IgdG8gUTAgYW5kIHRyYW5zZm9ybSB0byBjbGlwIHNwYWNlXG5cdFx0XHRcImFkZCB2dDAueHl6LCB2dDAueHl6LCB2dDMueHl6XHRcXG5cIiArIC8vIFEwICsgU1xuXG5cdFx0XHRcIm00NCBvcCwgdnQwLCB2YzBcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMCB0byBjbGlwIHNwYWNlXG5cblx0XHRcdC8vIGludGVycG9sYXRlIGNvbG9yXG5cdFx0XHRcIm1vdiB2MCwgdmEzXHRcdFx0XHRcXG5cIjtcblx0fVxuXG5cdC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi9cblx0cHVibGljIF9pQWN0aXZhdGVQYXNzKHBhc3M6TWF0ZXJpYWxQYXNzRGF0YSwgcmVuZGVyZXI6UmVuZGVyZXJCYXNlLCBjYW1lcmE6Q2FtZXJhKVxuXHR7XG5cdFx0c3VwZXIuX2lBY3RpdmF0ZVBhc3MocGFzcywgcmVuZGVyZXIsIGNhbWVyYSk7XG5cblx0XHR2YXIgY29udGV4dDpJQ29udGV4dEdMID0gcmVuZGVyZXIuY29udGV4dDtcblx0XHR2YXIgc3RhZ2U6U3RhZ2UgPSByZW5kZXJlci5zdGFnZTtcblxuXHRcdHRoaXMuX2NvbnN0YW50c1swXSA9IHRoaXMuX3RoaWNrbmVzcy8oKHN0YWdlLnNjaXNzb3JSZWN0KT8gTWF0aC5taW4oc3RhZ2Uuc2Npc3NvclJlY3Qud2lkdGgsIHN0YWdlLnNjaXNzb3JSZWN0LmhlaWdodCkgOiBNYXRoLm1pbihzdGFnZS53aWR0aCwgc3RhZ2UuaGVpZ2h0KSk7XG5cblx0XHQvLyB2YWx1ZSB0byBjb252ZXJ0IGRpc3RhbmNlIGZyb20gY2FtZXJhIHRvIG1vZGVsIGxlbmd0aCBwZXIgcGl4ZWwgd2lkdGhcblx0XHR0aGlzLl9jb25zdGFudHNbMl0gPSBjYW1lcmEucHJvamVjdGlvbi5uZWFyO1xuXG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgNSwgTGluZUJhc2ljTWF0ZXJpYWwucE9ORV9WRUNUT1IsIDEpO1xuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDYsIExpbmVCYXNpY01hdGVyaWFsLnBGUk9OVF9WRUNUT1IsIDEpO1xuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21BcnJheShDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDcsIHRoaXMuX2NvbnN0YW50cywgMSk7XG5cblx0XHQvLyBwcm9qZWN0aW9uIG1hdHJpeFxuXHRcdGNvbnRleHQuc2V0UHJvZ3JhbUNvbnN0YW50c0Zyb21NYXRyaXgoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCAwLCBjYW1lcmEucHJvamVjdGlvbi5tYXRyaXgsIHRydWUpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lSZW5kZXJQYXNzKHBhc3M6TWF0ZXJpYWxQYXNzRGF0YSwgcmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgc3RhZ2U6U3RhZ2UsIGNhbWVyYTpDYW1lcmEsIHZpZXdQcm9qZWN0aW9uOk1hdHJpeDNEKVxuXHR7XG5cdFx0c3VwZXIuX2lSZW5kZXJQYXNzKHBhc3MsIHJlbmRlcmFibGUsIHN0YWdlLCBjYW1lcmEsIHZpZXdQcm9qZWN0aW9uKTtcblxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSBzdGFnZS5jb250ZXh0O1xuXHRcdHRoaXMuX2NhbGNNYXRyaXguY29weUZyb20ocmVuZGVyYWJsZS5zb3VyY2VFbnRpdHkuc2NlbmVUcmFuc2Zvcm0pO1xuXHRcdHRoaXMuX2NhbGNNYXRyaXguYXBwZW5kKGNhbWVyYS5pbnZlcnNlU2NlbmVUcmFuc2Zvcm0pO1xuXG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbU1hdHJpeChDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDgsIHRoaXMuX2NhbGNNYXRyaXgsIHRydWUpO1xuXG5cdFx0c3RhZ2UuYWN0aXZhdGVCdWZmZXIoMCwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5TVEFSVF9QT1NJVElPTl9EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LlNUQVJUX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcblx0XHRzdGFnZS5hY3RpdmF0ZUJ1ZmZlcigxLCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LkVORF9QT1NJVElPTl9EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LlBPU0lUSU9OX0ZPUk1BVCk7XG5cdFx0c3RhZ2UuYWN0aXZhdGVCdWZmZXIoMiwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhEYXRhKExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQSksIHJlbmRlcmFibGUuZ2V0VmVydGV4T2Zmc2V0KExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfREFUQSksIExpbmVTdWJHZW9tZXRyeS5USElDS05FU1NfRk9STUFUKTtcblx0XHRzdGFnZS5hY3RpdmF0ZUJ1ZmZlcigzLCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LkNPTE9SX0RBVEEpLCByZW5kZXJhYmxlLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuQ09MT1JfREFUQSksIExpbmVTdWJHZW9tZXRyeS5DT0xPUl9GT1JNQVQpO1xuXG5cdFx0Y29udGV4dC5kcmF3VHJpYW5nbGVzKHN0YWdlLmdldEluZGV4QnVmZmVyKHJlbmRlcmFibGUuZ2V0SW5kZXhEYXRhKCkpLCAwLCByZW5kZXJhYmxlLm51bVRyaWFuZ2xlcyk7XG5cdH1cbn1cblxuZXhwb3J0ID0gTGluZUJhc2ljTWF0ZXJpYWw7Il19