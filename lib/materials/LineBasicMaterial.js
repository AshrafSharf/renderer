var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var LineSubGeometry = require("awayjs-display/lib/base/LineSubGeometry");
var ContextGLProgramType = require("awayjs-stagegl/lib/base/ContextGLProgramType");
var StageGLMaterialBase = require("awayjs-renderergl/lib/materials/StageGLMaterialBase");
var LineBasicPass = require("awayjs-renderergl/lib/materials/passes/LineBasicPass");
/**
 * LineMaterial is a material exclusively used to render wireframe objects
 *
 * @see away.entities.Lines
 */
var LineBasicMaterial = (function (_super) {
    __extends(LineBasicMaterial, _super);
    /**
     * Creates a new LineMaterial object.
     *
     * @param thickness The thickness of the wireframe lines.
     */
    function LineBasicMaterial(thickness) {
        if (thickness === void 0) { thickness = 1.25; }
        _super.call(this);
        this._constants = new Array(0, 0, 0, 0);
        this._thickness = thickness;
        this.bothSides = true;
        this._pAddScreenPass(this._screenPass = new LineBasicPass());
        this._calcMatrix = new Matrix3D();
        this._constants[1] = 1 / 255;
    }
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iGetVertexCode = function (shaderObject, regCache, sharedReg) {
        return "m44 vt0, va0, vc8			\n" + "m44 vt1, va1, vc8			\n" + "sub vt2, vt1, vt0 			\n" + "slt vt5.x, vt0.z, vc7.z			\n" + "sub vt5.y, vc5.x, vt5.x			\n" + "add vt4.x, vt0.z, vc7.z			\n" + "sub vt4.y, vt0.z, vt1.z			\n" + "seq vt4.z, vt4.y vc6.x			\n" + "add vt4.y, vt4.y, vt4.z			\n" + "div vt4.z, vt4.x, vt4.y			\n" + "mul vt4.xyz, vt4.zzz, vt2.xyz	\n" + "add vt3.xyz, vt0.xyz, vt4.xyz	\n" + "mov vt3.w, vc5.x			\n" + "mul vt0, vt0, vt5.yyyy			\n" + "mul vt3, vt3, vt5.xxxx			\n" + "add vt0, vt0, vt3				\n" + "sub vt2, vt1, vt0 			\n" + "nrm vt2.xyz, vt2.xyz			\n" + "nrm vt5.xyz, vt0.xyz			\n" + "mov vt5.w, vc5.x				\n" + "crs vt3.xyz, vt2, vt5			\n" + "nrm vt3.xyz, vt3.xyz			\n" + "mul vt3.xyz, vt3.xyz, va2.xxx	\n" + "mov vt3.w, vc5.x			\n" + "dp3 vt4.x, vt0, vc6			\n" + "mul vt4.x, vt4.x, vc7.x			\n" + "mul vt3.xyz, vt3.xyz, vt4.xxx	\n" + "add vt0.xyz, vt0.xyz, vt3.xyz	\n" + "m44 op, vt0, vc0			\n" + "mov v0, va3				\n";
    };
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iActivatePass = function (pass, renderer, camera) {
        _super.prototype._iActivatePass.call(this, pass, renderer, camera);
        var context = renderer.context;
        var stage = renderer.stage;
        this._constants[0] = this._thickness / ((stage.scissorRect) ? Math.min(stage.scissorRect.width, stage.scissorRect.height) : Math.min(stage.width, stage.height));
        // value to convert distance from camera to model length per pixel width
        this._constants[2] = camera.projection.near;
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineBasicMaterial.pONE_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineBasicMaterial.pFRONT_VECTOR, 1);
        context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);
        // projection matrix
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);
    };
    /**
     * @inheritDoc
     */
    LineBasicMaterial.prototype._iRenderPass = function (pass, renderable, stage, camera, viewProjection) {
        _super.prototype._iRenderPass.call(this, pass, renderable, stage, camera, viewProjection);
        var context = stage.context;
        this._calcMatrix.copyFrom(renderable.sourceEntity.sceneTransform);
        this._calcMatrix.append(camera.inverseSceneTransform);
        context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);
        stage.activateBuffer(0, renderable.getVertexData(LineSubGeometry.START_POSITION_DATA), renderable.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        stage.activateBuffer(1, renderable.getVertexData(LineSubGeometry.END_POSITION_DATA), renderable.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);
        stage.activateBuffer(2, renderable.getVertexData(LineSubGeometry.THICKNESS_DATA), renderable.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);
        stage.activateBuffer(3, renderable.getVertexData(LineSubGeometry.COLOR_DATA), renderable.getVertexOffset(LineSubGeometry.COLOR_DATA), LineSubGeometry.COLOR_FORMAT);
        context.drawTriangles(stage.getIndexBuffer(renderable.getIndexData()), 0, renderable.numTriangles);
    };
    LineBasicMaterial.pONE_VECTOR = Array(1, 1, 1, 1);
    LineBasicMaterial.pFRONT_VECTOR = Array(0, 0, -1, 0);
    return LineBasicMaterial;
})(StageGLMaterialBase);
module.exports = LineBasicMaterial;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvbGluZWJhc2ljbWF0ZXJpYWwudHMiXSwibmFtZXMiOlsiTGluZUJhc2ljTWF0ZXJpYWwiLCJMaW5lQmFzaWNNYXRlcmlhbC5jb25zdHJ1Y3RvciIsIkxpbmVCYXNpY01hdGVyaWFsLl9pR2V0VmVydGV4Q29kZSIsIkxpbmVCYXNpY01hdGVyaWFsLl9pQWN0aXZhdGVQYXNzIiwiTGluZUJhc2ljTWF0ZXJpYWwuX2lSZW5kZXJQYXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUVoRSxJQUFPLGVBQWUsV0FBYyx5Q0FBeUMsQ0FBQyxDQUFDO0FBRy9FLElBQU8sb0JBQW9CLFdBQWEsOENBQThDLENBQUMsQ0FBQztBQU14RixJQUFPLG1CQUFtQixXQUFhLHFEQUFxRCxDQUFDLENBQUM7QUFJOUYsSUFBTyxhQUFhLFdBQWMsc0RBQXNELENBQUMsQ0FBQztBQUcxRixBQUtBOzs7O0dBREc7SUFDRyxpQkFBaUI7SUFBU0EsVUFBMUJBLGlCQUFpQkEsVUFBNEJBO0lBV2xEQTs7OztPQUlHQTtJQUNIQSxTQWhCS0EsaUJBQWlCQSxDQWdCVkEsU0FBdUJBO1FBQXZCQyx5QkFBdUJBLEdBQXZCQSxnQkFBdUJBO1FBRWxDQSxpQkFBT0EsQ0FBQ0E7UUFiREEsZUFBVUEsR0FBaUJBLElBQUlBLEtBQUtBLENBQVNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBZWhFQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxTQUFTQSxDQUFDQTtRQUU1QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFdEJBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEdBQUdBLElBQUlBLGFBQWFBLEVBQUVBLENBQUNBLENBQUNBO1FBRTdEQSxJQUFJQSxDQUFDQSxX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ZUEsQ0FBQ0EsQ0FBQ0E7UUFDckxBLEtBQUtBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGFBQWFBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLGVBQWVBLENBQUNBLGNBQWNBLENBQUNBLEVBQUVBLGVBQWVBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7UUFDaExBLEtBQUtBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGFBQWFBLENBQUNBLGVBQWVBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLFVBQVVBLENBQUNBLGVBQWVBLENBQUNBLGVBQWVBLENBQUNBLFVBQVVBLENBQUNBLEVBQUVBLGVBQWVBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBO1FBRXBLQSxPQUFPQSxDQUFDQSxhQUFhQSxDQUFDQSxLQUFLQSxDQUFDQSxjQUFjQSxDQUFDQSxVQUFVQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQSxFQUFFQSxVQUFVQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtJQUNwR0EsQ0FBQ0E7SUExSWFKLDZCQUFXQSxHQUFpQkEsS0FBS0EsQ0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFDdERBLCtCQUFhQSxHQUFpQkEsS0FBS0EsQ0FBU0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUEwSXhFQSx3QkFBQ0E7QUFBREEsQ0E3SUEsQUE2SUNBLEVBN0krQixtQkFBbUIsRUE2SWxEO0FBRUQsQUFBMkIsaUJBQWxCLGlCQUFpQixDQUFDIiwiZmlsZSI6Im1hdGVyaWFscy9MaW5lQmFzaWNNYXRlcmlhbC5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcblxuaW1wb3J0IExpbmVTdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGluZVN1Ykdlb21ldHJ5XCIpO1xuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XG5cbmltcG9ydCBDb250ZXh0R0xQcm9ncmFtVHlwZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTFByb2dyYW1UeXBlXCIpO1xuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcbmltcG9ydCBTdGFnZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL1N0YWdlXCIpO1xuXG5pbXBvcnQgTWF0ZXJpYWxQYXNzRGF0YVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvTWF0ZXJpYWxQYXNzRGF0YVwiKTtcbmltcG9ydCBSZW5kZXJhYmxlQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Bvb2wvUmVuZGVyYWJsZUJhc2VcIik7XG5pbXBvcnQgU3RhZ2VHTE1hdGVyaWFsQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvU3RhZ2VHTE1hdGVyaWFsQmFzZVwiKTtcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlck9iamVjdEJhc2VcIik7XG5pbXBvcnQgU2hhZGVyUmVnaXN0ZXJDYWNoZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9tYXRlcmlhbHMvY29tcGlsYXRpb24vU2hhZGVyUmVnaXN0ZXJDYWNoZVwiKTtcbmltcG9ydCBTaGFkZXJSZWdpc3RlckRhdGFcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL2NvbXBpbGF0aW9uL1NoYWRlclJlZ2lzdGVyRGF0YVwiKTtcbmltcG9ydCBMaW5lQmFzaWNQYXNzXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWF0ZXJpYWxzL3Bhc3Nlcy9MaW5lQmFzaWNQYXNzXCIpO1xuaW1wb3J0IFJlbmRlcmVyQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcmVuZGVyL1JlbmRlcmVyQmFzZVwiKTtcblxuLyoqXG4gKiBMaW5lTWF0ZXJpYWwgaXMgYSBtYXRlcmlhbCBleGNsdXNpdmVseSB1c2VkIHRvIHJlbmRlciB3aXJlZnJhbWUgb2JqZWN0c1xuICpcbiAqIEBzZWUgYXdheS5lbnRpdGllcy5MaW5lc1xuICovXG5jbGFzcyBMaW5lQmFzaWNNYXRlcmlhbCBleHRlbmRzIFN0YWdlR0xNYXRlcmlhbEJhc2Vcbntcblx0cHVibGljIHN0YXRpYyBwT05FX1ZFQ1RPUjpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigxLCAxLCAxLCAxKTtcblx0cHVibGljIHN0YXRpYyBwRlJPTlRfVkVDVE9SOkFycmF5PG51bWJlcj4gPSBBcnJheTxudW1iZXI+KDAsIDAsIC0xLCAwKTtcblxuXHRwcml2YXRlIF9jb25zdGFudHM6QXJyYXk8bnVtYmVyPiA9IG5ldyBBcnJheTxudW1iZXI+KDAsIDAsIDAsIDApO1xuXHRwcml2YXRlIF9jYWxjTWF0cml4Ok1hdHJpeDNEO1xuXHRwcml2YXRlIF90aGlja25lc3M6bnVtYmVyO1xuXG5cdHByaXZhdGUgX3NjcmVlblBhc3M6TGluZUJhc2ljUGFzcztcblxuXHQvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBMaW5lTWF0ZXJpYWwgb2JqZWN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gdGhpY2tuZXNzIFRoZSB0aGlja25lc3Mgb2YgdGhlIHdpcmVmcmFtZSBsaW5lcy5cblx0ICovXG5cdGNvbnN0cnVjdG9yKHRoaWNrbmVzczpudW1iZXIgPSAxLjI1KVxuXHR7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMuX3RoaWNrbmVzcyA9IHRoaWNrbmVzcztcblxuXHRcdHRoaXMuYm90aFNpZGVzID0gdHJ1ZTtcblxuXHRcdHRoaXMuX3BBZGRTY3JlZW5QYXNzKHRoaXMuX3NjcmVlblBhc3MgPSBuZXcgTGluZUJhc2ljUGFzcygpKTtcblxuXHRcdHRoaXMuX2NhbGNNYXRyaXggPSBuZXcgTWF0cml4M0QoKTtcblxuXHRcdHRoaXMuX2NvbnN0YW50c1sxXSA9IDEvMjU1O1xuXHR9XG5cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaUdldFZlcnRleENvZGUoc2hhZGVyT2JqZWN0OlNoYWRlck9iamVjdEJhc2UsIHJlZ0NhY2hlOlNoYWRlclJlZ2lzdGVyQ2FjaGUsIHNoYXJlZFJlZzpTaGFkZXJSZWdpc3RlckRhdGEpOnN0cmluZ1xuXHR7XG5cdFx0cmV0dXJuIFwibTQ0IHZ0MCwgdmEwLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMCB0byBleWUgc3BhY2Vcblx0XHRcdFwibTQ0IHZ0MSwgdmExLCB2YzhcdFx0XHRcXG5cIiArIC8vIHRyYW5zZm9ybSBRMSB0byBleWUgc3BhY2Vcblx0XHRcdFwic3ViIHZ0MiwgdnQxLCB2dDAgXHRcdFx0XFxuXCIgKyAvLyBMID0gUTEgLSBRMFxuXG5cdFx0XHQvLyB0ZXN0IGlmIGJlaGluZCBjYW1lcmEgbmVhciBwbGFuZVxuXHRcdFx0Ly8gaWYgMCAtIFEwLnogPCBDYW1lcmEubmVhciB0aGVuIHRoZSBwb2ludCBuZWVkcyB0byBiZSBjbGlwcGVkXG5cdFx0XHQvL1wibmVnIHZ0NS54LCB2dDAuelx0XHRcdFx0XFxuXCIgKyAvLyAwIC0gUTAuelxuXHRcdFx0XCJzbHQgdnQ1LngsIHZ0MC56LCB2Yzcuelx0XHRcdFxcblwiICsgLy8gYmVoaW5kID0gKCAwIC0gUTAueiA8IC1DYW1lcmEubmVhciApID8gMSA6IDBcblx0XHRcdFwic3ViIHZ0NS55LCB2YzUueCwgdnQ1LnhcdFx0XHRcXG5cIiArIC8vICFiZWhpbmQgPSAxIC0gYmVoaW5kXG5cblx0XHRcdC8vIHAgPSBwb2ludCBvbiB0aGUgcGxhbmUgKDAsMCwtbmVhcilcblx0XHRcdC8vIG4gPSBwbGFuZSBub3JtYWwgKDAsMCwtMSlcblx0XHRcdC8vIEQgPSBRMSAtIFEwXG5cdFx0XHQvLyB0ID0gKCBkb3QoIG4sICggcCAtIFEwICkgKSAvICggZG90KCBuLCBkIClcblxuXHRcdFx0Ly8gc29sdmUgZm9yIHQgd2hlcmUgbGluZSBjcm9zc2VzIENhbWVyYS5uZWFyXG5cdFx0XHRcImFkZCB2dDQueCwgdnQwLnosIHZjNy56XHRcdFx0XFxuXCIgKyAvLyBRMC56ICsgKCAtQ2FtZXJhLm5lYXIgKVxuXHRcdFx0XCJzdWIgdnQ0LnksIHZ0MC56LCB2dDEuelx0XHRcdFxcblwiICsgLy8gUTAueiAtIFExLnpcblxuXHRcdFx0Ly8gZml4IGRpdmlkZSBieSB6ZXJvIGZvciBob3Jpem9udGFsIGxpbmVzXG5cdFx0XHRcInNlcSB2dDQueiwgdnQ0LnkgdmM2LnhcdFx0XHRcXG5cIiArIC8vIG9mZnNldCA9IChRMC56IC0gUTEueik9PTAgPyAxIDogMFxuXHRcdFx0XCJhZGQgdnQ0LnksIHZ0NC55LCB2dDQuelx0XHRcdFxcblwiICsgLy8gKCBRMC56IC0gUTEueiApICsgb2Zmc2V0XG5cblx0XHRcdFwiZGl2IHZ0NC56LCB2dDQueCwgdnQ0LnlcdFx0XHRcXG5cIiArIC8vIHQgPSAoIFEwLnogLSBuZWFyICkgLyAoIFEwLnogLSBRMS56IClcblxuXHRcdFx0XCJtdWwgdnQ0Lnh5eiwgdnQ0Lnp6eiwgdnQyLnh5elx0XFxuXCIgKyAvLyB0KEwpXG5cdFx0XHRcImFkZCB2dDMueHl6LCB2dDAueHl6LCB2dDQueHl6XHRcXG5cIiArIC8vIFFjbGlwcGVkID0gUTAgKyB0KEwpXG5cdFx0XHRcIm1vdiB2dDMudywgdmM1LnhcdFx0XHRcXG5cIiArIC8vIFFjbGlwcGVkLncgPSAxXG5cblx0XHRcdC8vIElmIG5lY2Vzc2FyeSwgcmVwbGFjZSBRMCB3aXRoIG5ldyBRY2xpcHBlZFxuXHRcdFx0XCJtdWwgdnQwLCB2dDAsIHZ0NS55eXl5XHRcdFx0XFxuXCIgKyAvLyAhYmVoaW5kICogUTBcblx0XHRcdFwibXVsIHZ0MywgdnQzLCB2dDUueHh4eFx0XHRcdFxcblwiICsgLy8gYmVoaW5kICogUWNsaXBwZWRcblx0XHRcdFwiYWRkIHZ0MCwgdnQwLCB2dDNcdFx0XHRcdFxcblwiICsgLy8gbmV3UTAgPSBRMCArIFFjbGlwcGVkXG5cblx0XHRcdC8vIGNhbGN1bGF0ZSBzaWRlIHZlY3RvciBmb3IgbGluZVxuXHRcdFx0XCJzdWIgdnQyLCB2dDEsIHZ0MCBcdFx0XHRcXG5cIiArIC8vIEwgPSBRMSAtIFEwXG5cdFx0XHRcIm5ybSB2dDIueHl6LCB2dDIueHl6XHRcdFx0XFxuXCIgKyAvLyBub3JtYWxpemUoIEwgKVxuXHRcdFx0XCJucm0gdnQ1Lnh5eiwgdnQwLnh5elx0XHRcdFxcblwiICsgLy8gRCA9IG5vcm1hbGl6ZSggUTEgKVxuXHRcdFx0XCJtb3YgdnQ1LncsIHZjNS54XHRcdFx0XHRcXG5cIiArIC8vIEQudyA9IDFcblx0XHRcdFwiY3JzIHZ0My54eXosIHZ0MiwgdnQ1XHRcdFx0XFxuXCIgKyAvLyBTID0gTCB4IERcblx0XHRcdFwibnJtIHZ0My54eXosIHZ0My54eXpcdFx0XHRcXG5cIiArIC8vIG5vcm1hbGl6ZSggUyApXG5cblx0XHRcdC8vIGZhY2UgdGhlIHNpZGUgdmVjdG9yIHByb3Blcmx5IGZvciB0aGUgZ2l2ZW4gcG9pbnRcblx0XHRcdFwibXVsIHZ0My54eXosIHZ0My54eXosIHZhMi54eHhcdFxcblwiICsgLy8gUyAqPSB3ZWlnaHRcblx0XHRcdFwibW92IHZ0My53LCB2YzUueFx0XHRcdFxcblwiICsgLy8gUy53ID0gMVxuXG5cdFx0XHQvLyBjYWxjdWxhdGUgdGhlIGFtb3VudCByZXF1aXJlZCB0byBtb3ZlIGF0IHRoZSBwb2ludCdzIGRpc3RhbmNlIHRvIGNvcnJlc3BvbmQgdG8gdGhlIGxpbmUncyBwaXhlbCB3aWR0aFxuXHRcdFx0Ly8gc2NhbGUgdGhlIHNpZGUgdmVjdG9yIGJ5IHRoYXQgYW1vdW50XG5cdFx0XHRcImRwMyB2dDQueCwgdnQwLCB2YzZcdFx0XHRcXG5cIiArIC8vIGRpc3RhbmNlID0gZG90KCB2aWV3IClcblx0XHRcdFwibXVsIHZ0NC54LCB2dDQueCwgdmM3LnhcdFx0XHRcXG5cIiArIC8vIGRpc3RhbmNlICo9IHZwc29kXG5cdFx0XHRcIm11bCB2dDMueHl6LCB2dDMueHl6LCB2dDQueHh4XHRcXG5cIiArIC8vIFMueHl6ICo9IHBpeGVsU2NhbGVGYWN0b3JcblxuXHRcdFx0Ly8gYWRkIHNjYWxlZCBzaWRlIHZlY3RvciB0byBRMCBhbmQgdHJhbnNmb3JtIHRvIGNsaXAgc3BhY2Vcblx0XHRcdFwiYWRkIHZ0MC54eXosIHZ0MC54eXosIHZ0My54eXpcdFxcblwiICsgLy8gUTAgKyBTXG5cblx0XHRcdFwibTQ0IG9wLCB2dDAsIHZjMFx0XHRcdFxcblwiICsgLy8gdHJhbnNmb3JtIFEwIHRvIGNsaXAgc3BhY2VcblxuXHRcdFx0Ly8gaW50ZXJwb2xhdGUgY29sb3Jcblx0XHRcdFwibW92IHYwLCB2YTNcdFx0XHRcdFxcblwiO1xuXHR9XG5cblx0LyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqL1xuXHRwdWJsaWMgX2lBY3RpdmF0ZVBhc3MocGFzczpNYXRlcmlhbFBhc3NEYXRhLCByZW5kZXJlcjpSZW5kZXJlckJhc2UsIGNhbWVyYTpDYW1lcmEpXG5cdHtcblx0XHRzdXBlci5faUFjdGl2YXRlUGFzcyhwYXNzLCByZW5kZXJlciwgY2FtZXJhKTtcblxuXHRcdHZhciBjb250ZXh0OklDb250ZXh0R0wgPSByZW5kZXJlci5jb250ZXh0O1xuXHRcdHZhciBzdGFnZTpTdGFnZSA9IHJlbmRlcmVyLnN0YWdlO1xuXG5cdFx0dGhpcy5fY29uc3RhbnRzWzBdID0gdGhpcy5fdGhpY2tuZXNzLygoc3RhZ2Uuc2Npc3NvclJlY3QpPyBNYXRoLm1pbihzdGFnZS5zY2lzc29yUmVjdC53aWR0aCwgc3RhZ2Uuc2Npc3NvclJlY3QuaGVpZ2h0KSA6IE1hdGgubWluKHN0YWdlLndpZHRoLCBzdGFnZS5oZWlnaHQpKTtcblxuXHRcdC8vIHZhbHVlIHRvIGNvbnZlcnQgZGlzdGFuY2UgZnJvbSBjYW1lcmEgdG8gbW9kZWwgbGVuZ3RoIHBlciBwaXhlbCB3aWR0aFxuXHRcdHRoaXMuX2NvbnN0YW50c1syXSA9IGNhbWVyYS5wcm9qZWN0aW9uLm5lYXI7XG5cblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tQXJyYXkoQ29udGV4dEdMUHJvZ3JhbVR5cGUuVkVSVEVYLCA1LCBMaW5lQmFzaWNNYXRlcmlhbC5wT05FX1ZFQ1RPUiwgMSk7XG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgNiwgTGluZUJhc2ljTWF0ZXJpYWwucEZST05UX1ZFQ1RPUiwgMSk7XG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbUFycmF5KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgNywgdGhpcy5fY29uc3RhbnRzLCAxKTtcblxuXHRcdC8vIHByb2plY3Rpb24gbWF0cml4XG5cdFx0Y29udGV4dC5zZXRQcm9ncmFtQ29uc3RhbnRzRnJvbU1hdHJpeChDb250ZXh0R0xQcm9ncmFtVHlwZS5WRVJURVgsIDAsIGNhbWVyYS5wcm9qZWN0aW9uLm1hdHJpeCwgdHJ1ZSk7XG5cdH1cblxuXHQvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovXG5cdHB1YmxpYyBfaVJlbmRlclBhc3MocGFzczpNYXRlcmlhbFBhc3NEYXRhLCByZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlLCBzdGFnZTpTdGFnZSwgY2FtZXJhOkNhbWVyYSwgdmlld1Byb2plY3Rpb246TWF0cml4M0QpXG5cdHtcblx0XHRzdXBlci5faVJlbmRlclBhc3MocGFzcywgcmVuZGVyYWJsZSwgc3RhZ2UsIGNhbWVyYSwgdmlld1Byb2plY3Rpb24pO1xuXG5cdFx0dmFyIGNvbnRleHQ6SUNvbnRleHRHTCA9IHN0YWdlLmNvbnRleHQ7XG5cdFx0dGhpcy5fY2FsY01hdHJpeC5jb3B5RnJvbShyZW5kZXJhYmxlLnNvdXJjZUVudGl0eS5zY2VuZVRyYW5zZm9ybSk7XG5cdFx0dGhpcy5fY2FsY01hdHJpeC5hcHBlbmQoY2FtZXJhLmludmVyc2VTY2VuZVRyYW5zZm9ybSk7XG5cblx0XHRjb250ZXh0LnNldFByb2dyYW1Db25zdGFudHNGcm9tTWF0cml4KENvbnRleHRHTFByb2dyYW1UeXBlLlZFUlRFWCwgOCwgdGhpcy5fY2FsY01hdHJpeCwgdHJ1ZSk7XG5cblx0XHRzdGFnZS5hY3RpdmF0ZUJ1ZmZlcigwLCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LlNUQVJUX1BPU0lUSU9OX0RBVEEpLCByZW5kZXJhYmxlLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuU1RBUlRfUE9TSVRJT05fREFUQSksIExpbmVTdWJHZW9tZXRyeS5QT1NJVElPTl9GT1JNQVQpO1xuXHRcdHN0YWdlLmFjdGl2YXRlQnVmZmVyKDEsIHJlbmRlcmFibGUuZ2V0VmVydGV4RGF0YShMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEEpLCByZW5kZXJhYmxlLmdldFZlcnRleE9mZnNldChMaW5lU3ViR2VvbWV0cnkuRU5EX1BPU0lUSU9OX0RBVEEpLCBMaW5lU3ViR2VvbWV0cnkuUE9TSVRJT05fRk9STUFUKTtcblx0XHRzdGFnZS5hY3RpdmF0ZUJ1ZmZlcigyLCByZW5kZXJhYmxlLmdldFZlcnRleERhdGEoTGluZVN1Ykdlb21ldHJ5LlRISUNLTkVTU19EQVRBKSwgcmVuZGVyYWJsZS5nZXRWZXJ0ZXhPZmZzZXQoTGluZVN1Ykdlb21ldHJ5LlRISUNLTkVTU19EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LlRISUNLTkVTU19GT1JNQVQpO1xuXHRcdHN0YWdlLmFjdGl2YXRlQnVmZmVyKDMsIHJlbmRlcmFibGUuZ2V0VmVydGV4RGF0YShMaW5lU3ViR2VvbWV0cnkuQ09MT1JfREFUQSksIHJlbmRlcmFibGUuZ2V0VmVydGV4T2Zmc2V0KExpbmVTdWJHZW9tZXRyeS5DT0xPUl9EQVRBKSwgTGluZVN1Ykdlb21ldHJ5LkNPTE9SX0ZPUk1BVCk7XG5cblx0XHRjb250ZXh0LmRyYXdUcmlhbmdsZXMoc3RhZ2UuZ2V0SW5kZXhCdWZmZXIocmVuZGVyYWJsZS5nZXRJbmRleERhdGEoKSksIDAsIHJlbmRlcmFibGUubnVtVHJpYW5nbGVzKTtcblx0fVxufVxuXG5leHBvcnQgPSBMaW5lQmFzaWNNYXRlcmlhbDsiXX0=