var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var Matrix3D = require("awayjs-core/lib/geom/Matrix3D");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var RenderTexture = require("awayjs-core/lib/textures/RenderTexture");
var ContextGLCompareMode = require("awayjs-stagegl/lib/base/ContextGLCompareMode");
var ContextGLClearMask = require("awayjs-stagegl/lib/base/ContextGLClearMask");
var DepthRenderer = require("awayjs-renderergl/lib/DepthRenderer");
var DistanceRenderer = require("awayjs-renderergl/lib/DistanceRenderer");
var Filter3DRenderer = require("awayjs-renderergl/lib/Filter3DRenderer");
var RendererBase = require("awayjs-renderergl/lib/base/RendererBase");
var RenderablePoolBase = require("awayjs-renderergl/lib/pool/RenderablePoolBase");
var SkyboxRenderable = require("awayjs-renderergl/lib/pool/SkyboxRenderable");
var RTTBufferManager = require("awayjs-renderergl/lib/managers/RTTBufferManager");
/**
 * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the
 * materials assigned to them.
 *
 * @class away.render.DefaultRenderer
 */
var DefaultRenderer = (function (_super) {
    __extends(DefaultRenderer, _super);
    /**
     * Creates a new DefaultRenderer object.
     *
     * @param antiAlias The amount of anti-aliasing to use.
     * @param renderMode The render mode to use.
     */
    function DefaultRenderer(rendererPoolClass, stage) {
        if (rendererPoolClass === void 0) { rendererPoolClass = null; }
        if (stage === void 0) { stage = null; }
        _super.call(this, rendererPoolClass, stage);
        this._skyboxProjection = new Matrix3D();
        if (this._width == 0)
            this.width = window.innerWidth;
        else
            this._pRttBufferManager.viewWidth = this._width;
        if (this._height == 0)
            this.height = window.innerHeight;
        else
            this._pRttBufferManager.viewHeight = this._height;
    }
    Object.defineProperty(DefaultRenderer.prototype, "antiAlias", {
        get: function () {
            return this._antiAlias;
        },
        set: function (value) {
            if (this._antiAlias == value)
                return;
            this._antiAlias = value;
            this._pBackBufferInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DefaultRenderer.prototype, "depthPrepass", {
        /**
         *
         */
        get: function () {
            return this._depthPrepass;
        },
        set: function (value) {
            this._depthPrepass = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DefaultRenderer.prototype, "filters3d", {
        /**
         *
         * @returns {*}
         */
        get: function () {
            return this._pFilter3DRenderer ? this._pFilter3DRenderer.filters : null;
        },
        set: function (value) {
            if (value && value.length == 0)
                value = null;
            if (this._pFilter3DRenderer && !value) {
                this._pFilter3DRenderer.dispose();
                this._pFilter3DRenderer = null;
            }
            else if (!this._pFilter3DRenderer && value) {
                this._pFilter3DRenderer = new Filter3DRenderer(this._pStage);
                this._pFilter3DRenderer.filters = value;
            }
            if (this._pFilter3DRenderer) {
                this._pFilter3DRenderer.filters = value;
                this._pRequireDepthRender = this._pFilter3DRenderer.requireDepthRender;
            }
            else {
                this._pRequireDepthRender = false;
                if (this._pDepthRender) {
                    this._pDepthRender.dispose();
                    this._pDepthRender = null;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    DefaultRenderer.prototype.render = function (entityCollector) {
        _super.prototype.render.call(this, entityCollector);
        if (!this._pStage.recoverFromDisposal()) {
            this._pBackBufferInvalid = true;
            return;
        }
        if (this._pBackBufferInvalid)
            this.pUpdateBackBuffer();
        if (this._shareContext && this._pContext)
            this._pContext.clear(0, 0, 0, 1, 1, 0, ContextGLClearMask.DEPTH);
        if (this._pFilter3DRenderer) {
            this.textureRatioX = this._pRttBufferManager.textureRatioX;
            this.textureRatioY = this._pRttBufferManager.textureRatioY;
        }
        else {
            this.textureRatioX = 1;
            this.textureRatioY = 1;
        }
        if (this._pRequireDepthRender)
            this.pRenderSceneDepthToTexture(entityCollector);
        if (this._depthPrepass)
            this.pRenderDepthPrepass(entityCollector);
        if (this._pFilter3DRenderer && this._pContext) {
        }
        else {
            if (this._shareContext)
                this._iRender(entityCollector, null, this._pScissorRect);
            else
                this._iRender(entityCollector);
        }
        _super.prototype.render.call(this, entityCollector);
        if (!this._shareContext && this._pContext)
            this._pContext.present();
        // register that a view has been rendered
        this._pStage.bufferClear = false;
    };
    DefaultRenderer.prototype.pExecuteRender = function (entityCollector, target, scissorRect, surfaceSelector) {
        if (target === void 0) { target = null; }
        if (scissorRect === void 0) { scissorRect = null; }
        if (surfaceSelector === void 0) { surfaceSelector = 0; }
        this.updateLights(entityCollector);
        _super.prototype.pExecuteRender.call(this, entityCollector, target, scissorRect, surfaceSelector);
    };
    DefaultRenderer.prototype.updateLights = function (entityCollector) {
        var dirLights = entityCollector.directionalLights;
        var pointLights = entityCollector.pointLights;
        var len, i;
        var light;
        var shadowMapper;
        len = dirLights.length;
        for (i = 0; i < len; ++i) {
            light = dirLights[i];
            shadowMapper = light.shadowMapper;
            if (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))
                shadowMapper.iRenderDepthMap(entityCollector, this._pDepthRenderer);
        }
        len = pointLights.length;
        for (i = 0; i < len; ++i) {
            light = pointLights[i];
            shadowMapper = light.shadowMapper;
            if (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))
                shadowMapper.iRenderDepthMap(entityCollector, this._pDistanceRenderer);
        }
    };
    /**
     * @inheritDoc
     */
    DefaultRenderer.prototype.pDraw = function (entityCollector) {
        if (entityCollector.skyBox) {
            this._pContext.setDepthTest(false, ContextGLCompareMode.ALWAYS);
            this.drawSkybox(entityCollector);
        }
        _super.prototype.pDraw.call(this, entityCollector);
    };
    DefaultRenderer.prototype._pGetRenderObject = function (renderable, renderObjectOwner) {
        return renderObjectOwner.getRenderObject(renderable._pool);
    };
    /**
     * Draw the skybox if present.
     *
     * @param entityCollector The EntityCollector containing all potentially visible information.
     */
    DefaultRenderer.prototype.drawSkybox = function (entityCollector) {
        var skyBox = this._skyboxRenderablePool.getItem(entityCollector.skyBox);
        var camera = entityCollector.camera;
        this.updateSkyboxProjection(camera);
        var renderObject = skyBox.renderObject = this._pGetRenderObject(skyBox, skyBox.renderObjectOwner);
        var pass = renderObject.passes[0];
        this.activatePass(skyBox, pass, camera);
        skyBox._iRender(pass, camera, this._skyboxProjection);
        this.deactivatePass(skyBox, pass);
    };
    DefaultRenderer.prototype.updateSkyboxProjection = function (camera) {
        var near = new Vector3D();
        this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);
        this._skyboxProjection.copyRowTo(2, near);
        var camPos = camera.scenePosition;
        var cx = near.x;
        var cy = near.y;
        var cz = near.z;
        var cw = -(near.x * camPos.x + near.y * camPos.y + near.z * camPos.z + Math.sqrt(cx * cx + cy * cy + cz * cz));
        var signX = cx >= 0 ? 1 : -1;
        var signY = cy >= 0 ? 1 : -1;
        var p = new Vector3D(signX, signY, 1, 1);
        var inverse = this._skyboxProjection.clone();
        inverse.invert();
        var q = inverse.transformVector(p);
        this._skyboxProjection.copyRowTo(3, p);
        var a = (q.x * p.x + q.y * p.y + q.z * p.z + q.w * p.w) / (cx * q.x + cy * q.y + cz * q.z + cw * q.w);
        this._skyboxProjection.copyRowFrom(2, new Vector3D(cx * a, cy * a, cz * a, cw * a));
    };
    DefaultRenderer.prototype.dispose = function () {
        if (!this._shareContext)
            this._pStage.dispose();
        this._skyboxRenderablePool.dispose();
        this._skyboxRenderablePool = null;
        this._pRttBufferManager.dispose();
        this._pRttBufferManager = null;
        this._pDepthRenderer.dispose();
        this._pDistanceRenderer.dispose();
        this._pDepthRenderer = null;
        this._pDistanceRenderer = null;
        this._pDepthRender = null;
        _super.prototype.dispose.call(this);
    };
    /**
     *
     */
    DefaultRenderer.prototype.pRenderDepthPrepass = function (entityCollector) {
        this._pDepthRenderer.disableColor = true;
        if (this._pFilter3DRenderer) {
        }
        else {
            this._pDepthRenderer.textureRatioX = 1;
            this._pDepthRenderer.textureRatioY = 1;
            this._pDepthRenderer._iRender(entityCollector);
        }
        this._pDepthRenderer.disableColor = false;
    };
    /**
     *
     */
    DefaultRenderer.prototype.pRenderSceneDepthToTexture = function (entityCollector) {
        if (this._pDepthTextureInvalid || !this._pDepthRender)
            this.initDepthTexture(this._pStage.context);
        this._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;
        this._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;
        this._pDepthRenderer._iRender(entityCollector, this._pDepthRender);
    };
    /**
     * Updates the backbuffer dimensions.
     */
    DefaultRenderer.prototype.pUpdateBackBuffer = function () {
        // No reason trying to configure back buffer if there is no context available.
        // Doing this anyway (and relying on _stage to cache width/height for
        // context does get available) means usesSoftwareRendering won't be reliable.
        if (this._pStage.context && !this._shareContext) {
            if (this._width && this._height) {
                this._pStage.configureBackBuffer(this._width, this._height, this._antiAlias, true);
                this._pBackBufferInvalid = false;
            }
        }
    };
    DefaultRenderer.prototype.iSetStage = function (value) {
        _super.prototype.iSetStage.call(this, value);
        if (this._pStage) {
            this._pRttBufferManager = RTTBufferManager.getInstance(this._pStage);
            this._pDepthRenderer = new DepthRenderer(this._pRendererPoolClass, this._pStage);
            this._pDistanceRenderer = new DistanceRenderer(this._pRendererPoolClass, this._pStage);
            this._skyboxRenderablePool = RenderablePoolBase.getPool(SkyboxRenderable, this._pStage);
        }
    };
    /**
     *
     */
    DefaultRenderer.prototype.initDepthTexture = function (context) {
        this._pDepthTextureInvalid = false;
        if (this._pDepthRender)
            this._pDepthRender.dispose();
        this._pDepthRender = new RenderTexture(this._pRttBufferManager.textureWidth, this._pRttBufferManager.textureHeight);
    };
    return DefaultRenderer;
})(RendererBase);
module.exports = DefaultRenderer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9EZWZhdWx0UmVuZGVyZXIudHMiXSwibmFtZXMiOlsiRGVmYXVsdFJlbmRlcmVyIiwiRGVmYXVsdFJlbmRlcmVyLmNvbnN0cnVjdG9yIiwiRGVmYXVsdFJlbmRlcmVyLmFudGlBbGlhcyIsIkRlZmF1bHRSZW5kZXJlci5kZXB0aFByZXBhc3MiLCJEZWZhdWx0UmVuZGVyZXIuZmlsdGVyczNkIiwiRGVmYXVsdFJlbmRlcmVyLnJlbmRlciIsIkRlZmF1bHRSZW5kZXJlci5wRXhlY3V0ZVJlbmRlciIsIkRlZmF1bHRSZW5kZXJlci51cGRhdGVMaWdodHMiLCJEZWZhdWx0UmVuZGVyZXIucERyYXciLCJEZWZhdWx0UmVuZGVyZXIuX3BHZXRSZW5kZXJPYmplY3QiLCJEZWZhdWx0UmVuZGVyZXIuZHJhd1NreWJveCIsIkRlZmF1bHRSZW5kZXJlci51cGRhdGVTa3lib3hQcm9qZWN0aW9uIiwiRGVmYXVsdFJlbmRlcmVyLmRpc3Bvc2UiLCJEZWZhdWx0UmVuZGVyZXIucFJlbmRlckRlcHRoUHJlcGFzcyIsIkRlZmF1bHRSZW5kZXJlci5wUmVuZGVyU2NlbmVEZXB0aFRvVGV4dHVyZSIsIkRlZmF1bHRSZW5kZXJlci5wVXBkYXRlQmFja0J1ZmZlciIsIkRlZmF1bHRSZW5kZXJlci5pU2V0U3RhZ2UiLCJEZWZhdWx0UmVuZGVyZXIuaW5pdERlcHRoVGV4dHVyZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBTyxRQUFRLFdBQWdCLCtCQUErQixDQUFDLENBQUM7QUFFaEUsSUFBTyxRQUFRLFdBQWdCLCtCQUErQixDQUFDLENBQUM7QUFDaEUsSUFBTyxhQUFhLFdBQWMsd0NBQXdDLENBQUMsQ0FBQztBQWU1RSxJQUFPLG9CQUFvQixXQUFhLDhDQUE4QyxDQUFDLENBQUM7QUFDeEYsSUFBTyxrQkFBa0IsV0FBYSw0Q0FBNEMsQ0FBQyxDQUFDO0FBR3BGLElBQU8sYUFBYSxXQUFjLHFDQUFxQyxDQUFDLENBQUM7QUFDekUsSUFB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QUFDQSxtQkFBbUJBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQ3pDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLElBQUlBLENBQUNBO1lBQ2hDQSxNQUFNQSxDQUFDQTtRQUNSQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBO1lBQzVCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEVBQUVBLENBQUNBO1FBRTFCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxJQUFJQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQTtZQUN4Q0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsa0JBQWtCQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUVsRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxhQUFhQSxDQUFDQTtZQUMzREEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxhQUFhQSxDQUFDQTtRQUM1REEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDdkJBLElBQUlBLENBQUNBLGFBQWFBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3hCQSxDQUFDQTtRQUVEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxvQkFBb0JBLENBQUNBO1lBQzdCQSxJQUFJQSxDQUFDQSwwQkFBMEJBLENBQW1CQSxlQUFlQSxDQUFDQSxDQUFDQTtRQUVwRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsYUFB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QSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN2QkEsSUFBSUEsRUFBRUEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFMUdBLElBQUlBLEtBQUtBLEdBQVVBLEVBQUVBLElBQUlBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO1FBQ25DQSxJQUFJQSxLQUFLQSxHQUFVQSxFQUFFQSxJQUFJQSxDQUFDQSxHQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVuQ0EsSUFBSUEsQ0FBQ0EsR0FBWUEsSUFBSUEsUUFBUUEsQ0FBQ0EsS0FBS0EsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFbERBLElBQUlBLE9BQU9BLEdBQVlBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDdERBLE9BQU9BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1FBRWpCQSxJQUFJQSxDQUFDQSxHQUFZQSxPQUFPQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUU1Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUV2Q0EsSUFBSUEsQ0FBQ0EsR0FBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FB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LElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1lBRXJFQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxJQUFJQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1lBQ2pGQSxJQUFJQSxDQUFDQSxrQkFBa0JBLEdBQUdBLElBQUlBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtZQUV2RkEsSUFBSUEsQ0FBQ0EscUJBQXFCQSxHQUFHQSxrQkFBa0JBLENBQUNBLE9BQU9BLENBQUNBLGdCQUFnQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDekZBLENBQUNBO0lBQ0ZBLENBQUNBO0lBRURoQjs7T0FFR0E7SUFDS0EsMENBQWdCQSxHQUF4QkEsVUFBeUJBLE9BQWtCQTtRQUUxQ2lCLElBQUlBLENBQUNBLHFCQUFxQkEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFFbkNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1lBQ3RCQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtRQUU5QkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsSUFBSUEsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxZQUFZQSxFQUFFQSxJQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBO0lBQ3JIQSxDQUFDQTtJQUNGakIsc0JBQUNBO0FBQURBLENBaldBLEFBaVdDQSxFQWpXNkIsWUFBWSxFQWlXekM7QUFFRCxBQUF5QixpQkFBaEIsZUFBZSxDQUFDIiwiZmlsZSI6IkRlZmF1bHRSZW5kZXJlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWF0cml4M0RcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9NYXRyaXgzRFwiKTtcclxuaW1wb3J0IFJlY3RhbmdsZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZ2VvbS9SZWN0YW5nbGVcIik7XHJcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCIpO1xyXG5pbXBvcnQgUmVuZGVyVGV4dHVyZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1JlbmRlclRleHR1cmVcIik7XHJcbmltcG9ydCBUZXh0dXJlUHJveHlCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvVGV4dHVyZVByb3h5QmFzZVwiKTtcclxuXHJcbmltcG9ydCBMaWdodEJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvTGlnaHRCYXNlXCIpO1xyXG5pbXBvcnQgSVJlbmRlcmVyXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9yZW5kZXIvSVJlbmRlcmVyXCIpO1xyXG5pbXBvcnQgRW50aXR5Q29sbGVjdG9yXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvdHJhdmVyc2UvRW50aXR5Q29sbGVjdG9yXCIpO1xyXG5pbXBvcnQgQ29sbGVjdG9yQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RyYXZlcnNlL0NvbGxlY3RvckJhc2VcIik7XHJcbmltcG9ydCBDYW1lcmFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvQ2FtZXJhXCIpO1xyXG5pbXBvcnQgRGlyZWN0aW9uYWxMaWdodFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0RpcmVjdGlvbmFsTGlnaHRcIik7XHJcbmltcG9ydCBQb2ludExpZ2h0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9Qb2ludExpZ2h0XCIpO1xyXG5pbXBvcnQgTWF0ZXJpYWxCYXNlXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvTWF0ZXJpYWxCYXNlXCIpO1xyXG5pbXBvcnQgU2hhZG93TWFwcGVyQmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9zaGFkb3dtYXBwZXJzL1NoYWRvd01hcHBlckJhc2VcIik7XHJcblxyXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcclxuaW1wb3J0IENvbnRleHRHTEJsZW5kRmFjdG9yXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMQmxlbmRGYWN0b3JcIik7XHJcbmltcG9ydCBDb250ZXh0R0xDb21wYXJlTW9kZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0NvbnRleHRHTENvbXBhcmVNb2RlXCIpO1xyXG5pbXBvcnQgQ29udGV4dEdMQ2xlYXJNYXNrXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMQ2xlYXJNYXNrXCIpO1xyXG5pbXBvcnQgSUNvbnRleHRHTFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9JQ29udGV4dEdMXCIpO1xyXG5cclxuaW1wb3J0IERlcHRoUmVuZGVyZXJcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9EZXB0aFJlbmRlcmVyXCIpO1xyXG5pbXBvcnQgRGlzdGFuY2VSZW5kZXJlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL0Rpc3RhbmNlUmVuZGVyZXJcIik7XHJcbmltcG9ydCBGaWx0ZXIzRFJlbmRlcmVyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvRmlsdGVyM0RSZW5kZXJlclwiKTtcclxuaW1wb3J0IFJlbmRlcmVyQmFzZVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYmFzZS9SZW5kZXJlckJhc2VcIik7XHJcbmltcG9ydCBGaWx0ZXIzREJhc2VcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2ZpbHRlcnMvRmlsdGVyM0RCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyT2JqZWN0QmFzZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1JlbmRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTaGFkZXJPYmplY3RCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvY29tcGlsYXRpb24vU2hhZGVyT2JqZWN0QmFzZVwiKTtcclxuaW1wb3J0IElSZW5kZXJPYmplY3RPd25lclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0lSZW5kZXJPYmplY3RPd25lclwiKTtcclxuaW1wb3J0IElSZW5kZXJlclBvb2xDbGFzc1x0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL0lSZW5kZXJlclBvb2xDbGFzc1wiKTtcclxuaW1wb3J0IFJlbmRlcmFibGVCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcclxuaW1wb3J0IFJlbmRlcmFibGVQb29sQmFzZVx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVQb29sQmFzZVwiKTtcclxuaW1wb3J0IFNreWJveFJlbmRlcmFibGVcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1NreWJveFJlbmRlcmFibGVcIik7XHJcbmltcG9ydCBSVFRCdWZmZXJNYW5hZ2VyXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvbWFuYWdlcnMvUlRUQnVmZmVyTWFuYWdlclwiKTtcclxuaW1wb3J0IFJlbmRlclBhc3NCYXNlXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcGFzc2VzL1JlbmRlclBhc3NCYXNlXCIpO1xyXG5cclxuLyoqXHJcbiAqIFRoZSBEZWZhdWx0UmVuZGVyZXIgY2xhc3MgcHJvdmlkZXMgdGhlIGRlZmF1bHQgcmVuZGVyaW5nIG1ldGhvZC4gSXQgcmVuZGVycyB0aGUgc2NlbmUgZ3JhcGggb2JqZWN0cyB1c2luZyB0aGVcclxuICogbWF0ZXJpYWxzIGFzc2lnbmVkIHRvIHRoZW0uXHJcbiAqXHJcbiAqIEBjbGFzcyBhd2F5LnJlbmRlci5EZWZhdWx0UmVuZGVyZXJcclxuICovXHJcbmNsYXNzIERlZmF1bHRSZW5kZXJlciBleHRlbmRzIFJlbmRlcmVyQmFzZSBpbXBsZW1lbnRzIElSZW5kZXJlclxyXG57XHJcblx0cHVibGljIF9wUmVxdWlyZURlcHRoUmVuZGVyOmJvb2xlYW47XHJcblx0cHJpdmF0ZSBfc2t5Ym94UmVuZGVyYWJsZVBvb2w6UmVuZGVyYWJsZVBvb2xCYXNlO1xyXG5cclxuXHRwcml2YXRlIF9wRGlzdGFuY2VSZW5kZXJlcjpEZXB0aFJlbmRlcmVyO1xyXG5cdHByaXZhdGUgX3BEZXB0aFJlbmRlcmVyOkRlcHRoUmVuZGVyZXI7XHJcblx0cHJpdmF0ZSBfc2t5Ym94UHJvamVjdGlvbjpNYXRyaXgzRCA9IG5ldyBNYXRyaXgzRCgpO1xyXG5cdHB1YmxpYyBfcEZpbHRlcjNEUmVuZGVyZXI6RmlsdGVyM0RSZW5kZXJlcjtcclxuXHJcblx0cHVibGljIF9wRGVwdGhSZW5kZXI6VGV4dHVyZVByb3h5QmFzZTtcclxuXHJcblx0cHJpdmF0ZSBfYW50aUFsaWFzOm51bWJlcjtcclxuXHJcblx0cHVibGljIGdldCBhbnRpQWxpYXMoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fYW50aUFsaWFzO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBhbnRpQWxpYXModmFsdWU6bnVtYmVyKVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9hbnRpQWxpYXMgPT0gdmFsdWUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR0aGlzLl9hbnRpQWxpYXMgPSB2YWx1ZTtcclxuXHJcblx0XHR0aGlzLl9wQmFja0J1ZmZlckludmFsaWQgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgZ2V0IGRlcHRoUHJlcGFzcygpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fZGVwdGhQcmVwYXNzO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCBkZXB0aFByZXBhc3ModmFsdWU6Ym9vbGVhbilcclxuXHR7XHJcblx0XHR0aGlzLl9kZXB0aFByZXBhc3MgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICogQHJldHVybnMgeyp9XHJcblx0ICovXHJcblx0cHVibGljIGdldCBmaWx0ZXJzM2QoKTpBcnJheTxGaWx0ZXIzREJhc2U+XHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyPyB0aGlzLl9wRmlsdGVyM0RSZW5kZXJlci5maWx0ZXJzIDogbnVsbDtcclxuXHR9XHJcblx0cHVibGljIHNldCBmaWx0ZXJzM2QodmFsdWU6QXJyYXk8RmlsdGVyM0RCYXNlPilcclxuXHR7XHJcblx0XHRpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoID09IDApXHJcblx0XHRcdHZhbHVlID0gbnVsbDtcclxuXHJcblx0XHRpZiAodGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIgJiYgIXZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLmRpc3Bvc2UoKTtcclxuXHRcdFx0dGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIgPSBudWxsO1xyXG5cdFx0fSBlbHNlIGlmICghdGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIgJiYgdmFsdWUpIHtcclxuXHRcdFx0dGhpcy5fcEZpbHRlcjNEUmVuZGVyZXIgPSBuZXcgRmlsdGVyM0RSZW5kZXJlcih0aGlzLl9wU3RhZ2UpO1xyXG5cdFx0XHR0aGlzLl9wRmlsdGVyM0RSZW5kZXJlci5maWx0ZXJzID0gdmFsdWU7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyKSB7XHJcblx0XHRcdHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLmZpbHRlcnMgPSB2YWx1ZTtcclxuXHRcdFx0dGhpcy5fcFJlcXVpcmVEZXB0aFJlbmRlciA9IHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLnJlcXVpcmVEZXB0aFJlbmRlcjtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuX3BSZXF1aXJlRGVwdGhSZW5kZXIgPSBmYWxzZTtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9wRGVwdGhSZW5kZXIpIHtcclxuXHRcdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXIuZGlzcG9zZSgpO1xyXG5cdFx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlciA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIENyZWF0ZXMgYSBuZXcgRGVmYXVsdFJlbmRlcmVyIG9iamVjdC5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBhbnRpQWxpYXMgVGhlIGFtb3VudCBvZiBhbnRpLWFsaWFzaW5nIHRvIHVzZS5cclxuXHQgKiBAcGFyYW0gcmVuZGVyTW9kZSBUaGUgcmVuZGVyIG1vZGUgdG8gdXNlLlxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKHJlbmRlcmVyUG9vbENsYXNzOklSZW5kZXJlclBvb2xDbGFzcyA9IG51bGwsIHN0YWdlOlN0YWdlID0gbnVsbClcclxuXHR7XHJcblx0XHRzdXBlcihyZW5kZXJlclBvb2xDbGFzcywgc3RhZ2UpO1xyXG5cclxuXHRcdGlmICh0aGlzLl93aWR0aCA9PSAwKVxyXG5cdFx0XHR0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcblx0XHRlbHNlXHJcblx0XHRcdHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnZpZXdXaWR0aCA9IHRoaXMuX3dpZHRoO1xyXG5cclxuXHRcdGlmICh0aGlzLl9oZWlnaHQgPT0gMClcclxuXHRcdFx0dGhpcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblx0XHRlbHNlXHJcblx0XHRcdHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnZpZXdIZWlnaHQgPSB0aGlzLl9oZWlnaHQ7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcmVuZGVyKGVudGl0eUNvbGxlY3RvcjpDb2xsZWN0b3JCYXNlKVxyXG5cdHtcclxuXHRcdHN1cGVyLnJlbmRlcihlbnRpdHlDb2xsZWN0b3IpO1xyXG5cclxuXHRcdGlmICghdGhpcy5fcFN0YWdlLnJlY292ZXJGcm9tRGlzcG9zYWwoKSkgey8vaWYgY29udGV4dCBoYXMgRGlzcG9zZWQgYnkgdGhlIE9TLGRvbid0IHJlbmRlciBhdCB0aGlzIGZyYW1lXHJcblx0XHRcdHRoaXMuX3BCYWNrQnVmZmVySW52YWxpZCA9IHRydWU7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5fcEJhY2tCdWZmZXJJbnZhbGlkKS8vIHJlc2V0IG9yIHVwZGF0ZSByZW5kZXIgc2V0dGluZ3NcclxuXHRcdFx0dGhpcy5wVXBkYXRlQmFja0J1ZmZlcigpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9zaGFyZUNvbnRleHQgJiYgdGhpcy5fcENvbnRleHQpXHJcblx0XHRcdHRoaXMuX3BDb250ZXh0LmNsZWFyKDAsIDAsIDAsIDEsIDEsIDAsIENvbnRleHRHTENsZWFyTWFzay5ERVBUSCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyKSB7XHJcblx0XHRcdHRoaXMudGV4dHVyZVJhdGlvWCA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1g7XHJcblx0XHRcdHRoaXMudGV4dHVyZVJhdGlvWSA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1k7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnRleHR1cmVSYXRpb1ggPSAxO1xyXG5cdFx0XHR0aGlzLnRleHR1cmVSYXRpb1kgPSAxO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLl9wUmVxdWlyZURlcHRoUmVuZGVyKVxyXG5cdFx0XHR0aGlzLnBSZW5kZXJTY2VuZURlcHRoVG9UZXh0dXJlKDxFbnRpdHlDb2xsZWN0b3I+IGVudGl0eUNvbGxlY3Rvcik7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2RlcHRoUHJlcGFzcylcclxuXHRcdFx0dGhpcy5wUmVuZGVyRGVwdGhQcmVwYXNzKDxFbnRpdHlDb2xsZWN0b3I+IGVudGl0eUNvbGxlY3Rvcik7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyICYmIHRoaXMuX3BDb250ZXh0KSB7IC8vVE9ET1xyXG5cdFx0XHQvL3RoaXMuX2lSZW5kZXIoZW50aXR5Q29sbGVjdG9yLCB0aGlzLl9wRmlsdGVyM0RSZW5kZXJlci5nZXRNYWluSW5wdXRUZXh0dXJlKHRoaXMuX3BTdGFnZSksIHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnJlbmRlclRvVGV4dHVyZVJlY3QpO1xyXG5cdFx0XHQvL3RoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLnJlbmRlcih0aGlzLl9wU3RhZ2UsIGVudGl0eUNvbGxlY3Rvci5jYW1lcmEsIHRoaXMuX3BEZXB0aFJlbmRlcik7XHJcblxyXG5cdFx0fSBlbHNlIHtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9zaGFyZUNvbnRleHQpXHJcblx0XHRcdFx0dGhpcy5faVJlbmRlcihlbnRpdHlDb2xsZWN0b3IsIG51bGwsIHRoaXMuX3BTY2lzc29yUmVjdCk7XHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHR0aGlzLl9pUmVuZGVyKGVudGl0eUNvbGxlY3Rvcik7XHJcblx0XHR9XHJcblxyXG5cdFx0c3VwZXIucmVuZGVyKGVudGl0eUNvbGxlY3Rvcik7XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9zaGFyZUNvbnRleHQgJiYgdGhpcy5fcENvbnRleHQpXHJcblx0XHRcdHRoaXMuX3BDb250ZXh0LnByZXNlbnQoKTtcclxuXHJcblx0XHQvLyByZWdpc3RlciB0aGF0IGEgdmlldyBoYXMgYmVlbiByZW5kZXJlZFxyXG5cdFx0dGhpcy5fcFN0YWdlLmJ1ZmZlckNsZWFyID0gZmFsc2U7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcEV4ZWN1dGVSZW5kZXIoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3RvciwgdGFyZ2V0OlRleHR1cmVQcm94eUJhc2UgPSBudWxsLCBzY2lzc29yUmVjdDpSZWN0YW5nbGUgPSBudWxsLCBzdXJmYWNlU2VsZWN0b3I6bnVtYmVyID0gMClcclxuXHR7XHJcblx0XHR0aGlzLnVwZGF0ZUxpZ2h0cyhlbnRpdHlDb2xsZWN0b3IpO1xyXG5cclxuXHRcdHN1cGVyLnBFeGVjdXRlUmVuZGVyKGVudGl0eUNvbGxlY3RvciwgdGFyZ2V0LCBzY2lzc29yUmVjdCwgc3VyZmFjZVNlbGVjdG9yKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgdXBkYXRlTGlnaHRzKGVudGl0eUNvbGxlY3RvcjpFbnRpdHlDb2xsZWN0b3IpXHJcblx0e1xyXG5cdFx0dmFyIGRpckxpZ2h0czpBcnJheTxEaXJlY3Rpb25hbExpZ2h0PiA9IGVudGl0eUNvbGxlY3Rvci5kaXJlY3Rpb25hbExpZ2h0cztcclxuXHRcdHZhciBwb2ludExpZ2h0czpBcnJheTxQb2ludExpZ2h0PiA9IGVudGl0eUNvbGxlY3Rvci5wb2ludExpZ2h0cztcclxuXHRcdHZhciBsZW46bnVtYmVyLCBpOm51bWJlcjtcclxuXHRcdHZhciBsaWdodDpMaWdodEJhc2U7XHJcblx0XHR2YXIgc2hhZG93TWFwcGVyOlNoYWRvd01hcHBlckJhc2U7XHJcblxyXG5cdFx0bGVuID0gZGlyTGlnaHRzLmxlbmd0aDtcclxuXHRcdGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xyXG5cdFx0XHRsaWdodCA9IGRpckxpZ2h0c1tpXTtcclxuXHJcblx0XHRcdHNoYWRvd01hcHBlciA9IGxpZ2h0LnNoYWRvd01hcHBlcjtcclxuXHJcblx0XHRcdGlmIChsaWdodC5jYXN0c1NoYWRvd3MgJiYgKHNoYWRvd01hcHBlci5hdXRvVXBkYXRlU2hhZG93cyB8fCBzaGFkb3dNYXBwZXIuX2lTaGFkb3dzSW52YWxpZCApKVxyXG5cdFx0XHRcdHNoYWRvd01hcHBlci5pUmVuZGVyRGVwdGhNYXAoZW50aXR5Q29sbGVjdG9yLCB0aGlzLl9wRGVwdGhSZW5kZXJlcik7XHJcblx0XHR9XHJcblxyXG5cdFx0bGVuID0gcG9pbnRMaWdodHMubGVuZ3RoO1xyXG5cdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7XHJcblx0XHRcdGxpZ2h0ID0gcG9pbnRMaWdodHNbaV07XHJcblxyXG5cdFx0XHRzaGFkb3dNYXBwZXIgPSBsaWdodC5zaGFkb3dNYXBwZXI7XHJcblxyXG5cdFx0XHRpZiAobGlnaHQuY2FzdHNTaGFkb3dzICYmIChzaGFkb3dNYXBwZXIuYXV0b1VwZGF0ZVNoYWRvd3MgfHwgc2hhZG93TWFwcGVyLl9pU2hhZG93c0ludmFsaWQpKVxyXG5cdFx0XHRcdHNoYWRvd01hcHBlci5pUmVuZGVyRGVwdGhNYXAoZW50aXR5Q29sbGVjdG9yLCB0aGlzLl9wRGlzdGFuY2VSZW5kZXJlcik7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAaW5oZXJpdERvY1xyXG5cdCAqL1xyXG5cdHB1YmxpYyBwRHJhdyhlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yKVxyXG5cdHtcclxuXHRcdGlmIChlbnRpdHlDb2xsZWN0b3Iuc2t5Qm94KSB7XHJcblx0XHRcdHRoaXMuX3BDb250ZXh0LnNldERlcHRoVGVzdChmYWxzZSwgQ29udGV4dEdMQ29tcGFyZU1vZGUuQUxXQVlTKTtcclxuXHJcblx0XHRcdHRoaXMuZHJhd1NreWJveChlbnRpdHlDb2xsZWN0b3IpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHN1cGVyLnBEcmF3KGVudGl0eUNvbGxlY3Rvcik7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgX3BHZXRSZW5kZXJPYmplY3QocmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgcmVuZGVyT2JqZWN0T3duZXI6SVJlbmRlck9iamVjdE93bmVyKTpSZW5kZXJPYmplY3RCYXNlXHJcblx0e1xyXG5cdFx0cmV0dXJuIDxSZW5kZXJPYmplY3RCYXNlPiByZW5kZXJPYmplY3RPd25lci5nZXRSZW5kZXJPYmplY3QocmVuZGVyYWJsZS5fcG9vbCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBEcmF3IHRoZSBza3lib3ggaWYgcHJlc2VudC5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSBlbnRpdHlDb2xsZWN0b3IgVGhlIEVudGl0eUNvbGxlY3RvciBjb250YWluaW5nIGFsbCBwb3RlbnRpYWxseSB2aXNpYmxlIGluZm9ybWF0aW9uLlxyXG5cdCAqL1xyXG5cdHByaXZhdGUgZHJhd1NreWJveChlbnRpdHlDb2xsZWN0b3I6RW50aXR5Q29sbGVjdG9yKVxyXG5cdHtcclxuXHRcdHZhciBza3lCb3g6U2t5Ym94UmVuZGVyYWJsZSA9IDxTa3lib3hSZW5kZXJhYmxlPiB0aGlzLl9za3lib3hSZW5kZXJhYmxlUG9vbC5nZXRJdGVtKGVudGl0eUNvbGxlY3Rvci5za3lCb3gpO1xyXG5cclxuXHRcdHZhciBjYW1lcmE6Q2FtZXJhID0gZW50aXR5Q29sbGVjdG9yLmNhbWVyYTtcclxuXHJcblx0XHR0aGlzLnVwZGF0ZVNreWJveFByb2plY3Rpb24oY2FtZXJhKTtcclxuXHJcblx0XHR2YXIgcmVuZGVyT2JqZWN0OlJlbmRlck9iamVjdEJhc2UgPSBza3lCb3gucmVuZGVyT2JqZWN0ID0gdGhpcy5fcEdldFJlbmRlck9iamVjdChza3lCb3gsIHNreUJveC5yZW5kZXJPYmplY3RPd25lcik7XHJcblx0XHR2YXIgcGFzczpSZW5kZXJQYXNzQmFzZSA9IHJlbmRlck9iamVjdC5wYXNzZXNbMF07XHJcblxyXG5cdFx0dGhpcy5hY3RpdmF0ZVBhc3Moc2t5Qm94LCBwYXNzLCBjYW1lcmEpO1xyXG5cdFx0c2t5Qm94Ll9pUmVuZGVyKHBhc3MsIGNhbWVyYSwgdGhpcy5fc2t5Ym94UHJvamVjdGlvbik7XHJcblx0XHR0aGlzLmRlYWN0aXZhdGVQYXNzKHNreUJveCwgcGFzcyk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHVwZGF0ZVNreWJveFByb2plY3Rpb24oY2FtZXJhOkNhbWVyYSlcclxuXHR7XHJcblx0XHR2YXIgbmVhcjpWZWN0b3IzRCA9IG5ldyBWZWN0b3IzRCgpO1xyXG5cclxuXHRcdHRoaXMuX3NreWJveFByb2plY3Rpb24uY29weUZyb20odGhpcy5fcFJ0dFZpZXdQcm9qZWN0aW9uTWF0cml4KTtcclxuXHRcdHRoaXMuX3NreWJveFByb2plY3Rpb24uY29weVJvd1RvKDIsIG5lYXIpO1xyXG5cclxuXHRcdHZhciBjYW1Qb3M6VmVjdG9yM0QgPSBjYW1lcmEuc2NlbmVQb3NpdGlvbjtcclxuXHJcblx0XHR2YXIgY3g6bnVtYmVyID0gbmVhci54O1xyXG5cdFx0dmFyIGN5Om51bWJlciA9IG5lYXIueTtcclxuXHRcdHZhciBjejpudW1iZXIgPSBuZWFyLno7XHJcblx0XHR2YXIgY3c6bnVtYmVyID0gLShuZWFyLngqY2FtUG9zLnggKyBuZWFyLnkqY2FtUG9zLnkgKyBuZWFyLnoqY2FtUG9zLnogKyBNYXRoLnNxcnQoY3gqY3ggKyBjeSpjeSArIGN6KmN6KSk7XHJcblxyXG5cdFx0dmFyIHNpZ25YOm51bWJlciA9IGN4ID49IDA/IDEgOiAtMTtcclxuXHRcdHZhciBzaWduWTpudW1iZXIgPSBjeSA+PSAwPyAxIDogLTE7XHJcblxyXG5cdFx0dmFyIHA6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0Qoc2lnblgsIHNpZ25ZLCAxLCAxKTtcclxuXHJcblx0XHR2YXIgaW52ZXJzZTpNYXRyaXgzRCA9IHRoaXMuX3NreWJveFByb2plY3Rpb24uY2xvbmUoKTtcclxuXHRcdGludmVyc2UuaW52ZXJ0KCk7XHJcblxyXG5cdFx0dmFyIHE6VmVjdG9yM0QgPSBpbnZlcnNlLnRyYW5zZm9ybVZlY3RvcihwKTtcclxuXHJcblx0XHR0aGlzLl9za3lib3hQcm9qZWN0aW9uLmNvcHlSb3dUbygzLCBwKTtcclxuXHJcblx0XHR2YXIgYTpudW1iZXIgPSAocS54KnAueCArIHEueSpwLnkgKyBxLnoqcC56ICsgcS53KnAudykvKGN4KnEueCArIGN5KnEueSArIGN6KnEueiArIGN3KnEudyk7XHJcblxyXG5cdFx0dGhpcy5fc2t5Ym94UHJvamVjdGlvbi5jb3B5Um93RnJvbSgyLCBuZXcgVmVjdG9yM0QoY3gqYSwgY3kqYSwgY3oqYSwgY3cqYSkpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGRpc3Bvc2UoKVxyXG5cdHtcclxuXHRcdGlmICghdGhpcy5fc2hhcmVDb250ZXh0KVxyXG5cdFx0XHR0aGlzLl9wU3RhZ2UuZGlzcG9zZSgpO1xyXG5cclxuXHRcdHRoaXMuX3NreWJveFJlbmRlcmFibGVQb29sLmRpc3Bvc2UoKTtcclxuXHRcdHRoaXMuX3NreWJveFJlbmRlcmFibGVQb29sID0gbnVsbDtcclxuXHJcblx0XHR0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci5kaXNwb3NlKCk7XHJcblx0XHR0aGlzLl9wUnR0QnVmZmVyTWFuYWdlciA9IG51bGw7XHJcblxyXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIuZGlzcG9zZSgpO1xyXG5cdFx0dGhpcy5fcERpc3RhbmNlUmVuZGVyZXIuZGlzcG9zZSgpO1xyXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIgPSBudWxsO1xyXG5cdFx0dGhpcy5fcERpc3RhbmNlUmVuZGVyZXIgPSBudWxsO1xyXG5cclxuXHRcdHRoaXMuX3BEZXB0aFJlbmRlciA9IG51bGw7XHJcblxyXG5cdFx0c3VwZXIuZGlzcG9zZSgpO1xyXG5cdH1cclxuXHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHVibGljIHBSZW5kZXJEZXB0aFByZXBhc3MoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3RvcilcclxuXHR7XHJcblx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci5kaXNhYmxlQ29sb3IgPSB0cnVlO1xyXG5cclxuXHRcdGlmICh0aGlzLl9wRmlsdGVyM0RSZW5kZXJlcikgeyAvL1RPRE9cclxuLy9cdFx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLnRleHR1cmVSYXRpb1ggPSB0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci50ZXh0dXJlUmF0aW9YO1xyXG4vL1x0XHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWSA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1k7XHJcbi8vXHRcdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci5faVJlbmRlcihlbnRpdHlDb2xsZWN0b3IsIHRoaXMuX3BGaWx0ZXIzRFJlbmRlcmVyLmdldE1haW5JbnB1dFRleHR1cmUodGhpcy5fcFN0YWdlKSwgdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIucmVuZGVyVG9UZXh0dXJlUmVjdCk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci50ZXh0dXJlUmF0aW9YID0gMTtcclxuXHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWSA9IDE7XHJcblx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLl9pUmVuZGVyKGVudGl0eUNvbGxlY3Rvcik7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIuZGlzYWJsZUNvbG9yID0gZmFsc2U7XHJcblx0fVxyXG5cclxuXHJcblx0LyoqXHJcblx0ICpcclxuXHQgKi9cclxuXHRwdWJsaWMgcFJlbmRlclNjZW5lRGVwdGhUb1RleHR1cmUoZW50aXR5Q29sbGVjdG9yOkVudGl0eUNvbGxlY3RvcilcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fcERlcHRoVGV4dHVyZUludmFsaWQgfHwgIXRoaXMuX3BEZXB0aFJlbmRlcilcclxuXHRcdFx0dGhpcy5pbml0RGVwdGhUZXh0dXJlKDxJQ29udGV4dEdMPiB0aGlzLl9wU3RhZ2UuY29udGV4dCk7XHJcblxyXG5cdFx0dGhpcy5fcERlcHRoUmVuZGVyZXIudGV4dHVyZVJhdGlvWCA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVSYXRpb1g7XHJcblx0XHR0aGlzLl9wRGVwdGhSZW5kZXJlci50ZXh0dXJlUmF0aW9ZID0gdGhpcy5fcFJ0dEJ1ZmZlck1hbmFnZXIudGV4dHVyZVJhdGlvWTtcclxuXHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyLl9pUmVuZGVyKGVudGl0eUNvbGxlY3RvciwgdGhpcy5fcERlcHRoUmVuZGVyKTtcclxuXHR9XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiBVcGRhdGVzIHRoZSBiYWNrYnVmZmVyIGRpbWVuc2lvbnMuXHJcblx0ICovXHJcblx0cHVibGljIHBVcGRhdGVCYWNrQnVmZmVyKClcclxuXHR7XHJcblx0XHQvLyBObyByZWFzb24gdHJ5aW5nIHRvIGNvbmZpZ3VyZSBiYWNrIGJ1ZmZlciBpZiB0aGVyZSBpcyBubyBjb250ZXh0IGF2YWlsYWJsZS5cclxuXHRcdC8vIERvaW5nIHRoaXMgYW55d2F5IChhbmQgcmVseWluZyBvbiBfc3RhZ2UgdG8gY2FjaGUgd2lkdGgvaGVpZ2h0IGZvclxyXG5cdFx0Ly8gY29udGV4dCBkb2VzIGdldCBhdmFpbGFibGUpIG1lYW5zIHVzZXNTb2Z0d2FyZVJlbmRlcmluZyB3b24ndCBiZSByZWxpYWJsZS5cclxuXHRcdGlmICh0aGlzLl9wU3RhZ2UuY29udGV4dCAmJiAhdGhpcy5fc2hhcmVDb250ZXh0KSB7XHJcblx0XHRcdGlmICh0aGlzLl93aWR0aCAmJiB0aGlzLl9oZWlnaHQpIHtcclxuXHRcdFx0XHR0aGlzLl9wU3RhZ2UuY29uZmlndXJlQmFja0J1ZmZlcih0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCB0aGlzLl9hbnRpQWxpYXMsIHRydWUpO1xyXG5cdFx0XHRcdHRoaXMuX3BCYWNrQnVmZmVySW52YWxpZCA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgaVNldFN0YWdlKHZhbHVlOlN0YWdlKVxyXG5cdHtcclxuXHRcdHN1cGVyLmlTZXRTdGFnZSh2YWx1ZSk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BTdGFnZSkge1xyXG5cdFx0XHR0aGlzLl9wUnR0QnVmZmVyTWFuYWdlciA9IFJUVEJ1ZmZlck1hbmFnZXIuZ2V0SW5zdGFuY2UodGhpcy5fcFN0YWdlKTtcclxuXHJcblx0XHRcdHRoaXMuX3BEZXB0aFJlbmRlcmVyID0gbmV3IERlcHRoUmVuZGVyZXIodGhpcy5fcFJlbmRlcmVyUG9vbENsYXNzLCB0aGlzLl9wU3RhZ2UpO1xyXG5cdFx0XHR0aGlzLl9wRGlzdGFuY2VSZW5kZXJlciA9IG5ldyBEaXN0YW5jZVJlbmRlcmVyKHRoaXMuX3BSZW5kZXJlclBvb2xDbGFzcywgdGhpcy5fcFN0YWdlKTtcclxuXHJcblx0XHRcdHRoaXMuX3NreWJveFJlbmRlcmFibGVQb29sID0gUmVuZGVyYWJsZVBvb2xCYXNlLmdldFBvb2woU2t5Ym94UmVuZGVyYWJsZSwgdGhpcy5fcFN0YWdlKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqXHJcblx0ICovXHJcblx0cHJpdmF0ZSBpbml0RGVwdGhUZXh0dXJlKGNvbnRleHQ6SUNvbnRleHRHTCk6dm9pZFxyXG5cdHtcclxuXHRcdHRoaXMuX3BEZXB0aFRleHR1cmVJbnZhbGlkID0gZmFsc2U7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3BEZXB0aFJlbmRlcilcclxuXHRcdFx0dGhpcy5fcERlcHRoUmVuZGVyLmRpc3Bvc2UoKTtcclxuXHJcblx0XHR0aGlzLl9wRGVwdGhSZW5kZXIgPSBuZXcgUmVuZGVyVGV4dHVyZSh0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci50ZXh0dXJlV2lkdGgsIHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVIZWlnaHQpO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gRGVmYXVsdFJlbmRlcmVyOyJdfQ==