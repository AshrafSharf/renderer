var AbstractMethodError = require("awayjs-core/lib/errors/AbstractMethodError");
var AGALMiniAssembler = require("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");
var ContextGLTextureFormat = require("awayjs-stagegl/lib/base/ContextGLTextureFormat");
var Filter3DTaskBase = (function () {
    function Filter3DTaskBase(requireDepthRender) {
        if (requireDepthRender === void 0) { requireDepthRender = false; }
        this._scaledTextureWidth = -1;
        this._scaledTextureHeight = -1;
        this._textureWidth = -1;
        this._textureHeight = -1;
        this._textureDimensionsInvalid = true;
        this._program3DInvalid = true;
        this._textureScale = 0;
        this._requireDepthRender = requireDepthRender;
    }
    Object.defineProperty(Filter3DTaskBase.prototype, "textureScale", {
        /**
         * The texture scale for the input of this texture. This will define the output of the previous entry in the chain
         */
        get: function () {
            return this._textureScale;
        },
        set: function (value) {
            if (this._textureScale == value)
                return;
            this._textureScale = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "target", {
        get: function () {
            return this._target;
        },
        set: function (value) {
            this._target = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureWidth", {
        get: function () {
            return this._textureWidth;
        },
        set: function (value) {
            if (this._textureWidth == value)
                return;
            this._textureWidth = value;
            this._scaledTextureWidth = this._textureWidth >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Filter3DTaskBase.prototype, "textureHeight", {
        get: function () {
            return this._textureHeight;
        },
        set: function (value) {
            if (this._textureHeight == value)
                return;
            this._textureHeight = value;
            this._scaledTextureHeight = this._textureHeight >> this._textureScale;
            this._textureDimensionsInvalid = true;
        },
        enumerable: true,
        configurable: true
    });
    Filter3DTaskBase.prototype.getMainInputTexture = function (stage) {
        if (this._textureDimensionsInvalid)
            this.pUpdateTextures(stage);
        return this._mainInputTexture;
    };
    Filter3DTaskBase.prototype.dispose = function () {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        if (this._program3D)
            this._program3D.dispose();
    };
    Filter3DTaskBase.prototype.pInvalidateProgram = function () {
        this._program3DInvalid = true;
    };
    Filter3DTaskBase.prototype.pUpdateProgram = function (stage) {
        if (this._program3D)
            this._program3D.dispose();
        this._program3D = stage.context.createProgram();
        var vertexByteCode = (new AGALMiniAssembler().assemble("part vertex 1\n" + this.pGetVertexCode() + "endpart"))['vertex'].data;
        var fragmentByteCode = (new AGALMiniAssembler().assemble("part fragment 1\n" + this.pGetFragmentCode() + "endpart"))['fragment'].data;
        this._program3D.upload(vertexByteCode, fragmentByteCode);
        this._program3DInvalid = false;
    };
    Filter3DTaskBase.prototype.pGetVertexCode = function () {
        // TODO: imeplement AGAL <> GLSL
        return "mov op, va0\n" + "mov v0, va1\n";
    };
    Filter3DTaskBase.prototype.pGetFragmentCode = function () {
        throw new AbstractMethodError();
        return null;
    };
    Filter3DTaskBase.prototype.pUpdateTextures = function (stage) {
        if (this._mainInputTexture)
            this._mainInputTexture.dispose();
        this._mainInputTexture = stage.context.createTexture(this._scaledTextureWidth, this._scaledTextureHeight, ContextGLTextureFormat.BGRA, true);
        this._textureDimensionsInvalid = false;
    };
    Filter3DTaskBase.prototype.getProgram = function (stage) {
        if (this._program3DInvalid)
            this.pUpdateProgram(stage);
        return this._program3D;
    };
    Filter3DTaskBase.prototype.activate = function (stage, camera, depthTexture) {
    };
    Filter3DTaskBase.prototype.deactivate = function (stage) {
    };
    Object.defineProperty(Filter3DTaskBase.prototype, "requireDepthRender", {
        get: function () {
            return this._requireDepthRender;
        },
        enumerable: true,
        configurable: true
    });
    return Filter3DTaskBase;
})();
module.exports = Filter3DTaskBase;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9maWx0ZXJzL3Rhc2tzL0ZpbHRlcjNEVGFza0Jhc2UudHMiXSwibmFtZXMiOlsiRmlsdGVyM0RUYXNrQmFzZSIsIkZpbHRlcjNEVGFza0Jhc2UuY29uc3RydWN0b3IiLCJGaWx0ZXIzRFRhc2tCYXNlLnRleHR1cmVTY2FsZSIsIkZpbHRlcjNEVGFza0Jhc2UudGFyZ2V0IiwiRmlsdGVyM0RUYXNrQmFzZS50ZXh0dXJlV2lkdGgiLCJGaWx0ZXIzRFRhc2tCYXNlLnRleHR1cmVIZWlnaHQiLCJGaWx0ZXIzRFRhc2tCYXNlLmdldE1haW5JbnB1dFRleHR1cmUiLCJGaWx0ZXIzRFRhc2tCYXNlLmRpc3Bvc2UiLCJGaWx0ZXIzRFRhc2tCYXNlLnBJbnZhbGlkYXRlUHJvZ3JhbSIsIkZpbHRlcjNEVGFza0Jhc2UucFVwZGF0ZVByb2dyYW0iLCJGaWx0ZXIzRFRhc2tCYXNlLnBHZXRWZXJ0ZXhDb2RlIiwiRmlsdGVyM0RUYXNrQmFzZS5wR2V0RnJhZ21lbnRDb2RlIiwiRmlsdGVyM0RUYXNrQmFzZS5wVXBkYXRlVGV4dHVyZXMiLCJGaWx0ZXIzRFRhc2tCYXNlLmdldFByb2dyYW0iLCJGaWx0ZXIzRFRhc2tCYXNlLmFjdGl2YXRlIiwiRmlsdGVyM0RUYXNrQmFzZS5kZWFjdGl2YXRlIiwiRmlsdGVyM0RUYXNrQmFzZS5yZXF1aXJlRGVwdGhSZW5kZXIiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sbUJBQW1CLFdBQWEsNENBQTRDLENBQUMsQ0FBQztBQU1yRixJQUFPLGlCQUFpQixXQUFhLHNEQUFzRCxDQUFDLENBQUM7QUFDN0YsSUFBTyxzQkFBc0IsV0FBWSxnREFBZ0QsQ0FBQyxDQUFDO0FBSzNGLElBQU0sZ0JBQWdCO0lBZXJCQSxTQWZLQSxnQkFBZ0JBLENBZVRBLGtCQUFrQ0E7UUFBbENDLGtDQUFrQ0EsR0FBbENBLDBCQUFrQ0E7UUFYdENBLHdCQUFtQkEsR0FBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDaENBLHlCQUFv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QXFCQTtJQUVqRWMsQ0FBQ0E7SUFFTWQscUNBQVVBLEdBQWpCQSxVQUFrQkEsS0FBV0E7SUFFN0JlLENBQUNBO0lBRURmLHNCQUFXQSxnREFBa0JBO2FBQTdCQTtZQUVDZ0IsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQTtRQUNqQ0EsQ0FBQ0E7OztPQUFBaEI7SUFFRkEsdUJBQUNBO0FBQURBLENBaktBLEFBaUtDQSxJQUFBO0FBRUQsQUFBMEIsaUJBQWpCLGdCQUFnQixDQUFDIiwiZmlsZSI6ImZpbHRlcnMvdGFza3MvRmlsdGVyM0RUYXNrQmFzZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWJzdHJhY3RNZXRob2RFcnJvclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9lcnJvcnMvQWJzdHJhY3RNZXRob2RFcnJvclwiKTtcclxuaW1wb3J0IEJ5dGVBcnJheVx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvQnl0ZUFycmF5XCIpO1xyXG5cclxuaW1wb3J0IENhbWVyYVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9lbnRpdGllcy9DYW1lcmFcIik7XHJcblxyXG5pbXBvcnQgU3RhZ2VcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcclxuaW1wb3J0IEFHQUxNaW5pQXNzZW1ibGVyXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2FnbHNsL2Fzc2VtYmxlci9BR0FMTWluaUFzc2VtYmxlclwiKTtcclxuaW1wb3J0IENvbnRleHRHTFRleHR1cmVGb3JtYXRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMVGV4dHVyZUZvcm1hdFwiKTtcclxuaW1wb3J0IElDb250ZXh0R0xcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSUNvbnRleHRHTFwiKTtcclxuaW1wb3J0IElQcm9ncmFtXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvSVByb2dyYW1cIik7XHJcbmltcG9ydCBJVGV4dHVyZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1zdGFnZWdsL2xpYi9iYXNlL0lUZXh0dXJlXCIpO1xyXG5cclxuY2xhc3MgRmlsdGVyM0RUYXNrQmFzZVxyXG57XHJcblx0cHJpdmF0ZSBfbWFpbklucHV0VGV4dHVyZTpJVGV4dHVyZTtcclxuXHJcblx0cHJpdmF0ZSBfc2NhbGVkVGV4dHVyZVdpZHRoOm51bWJlciA9IC0xO1xyXG5cdHByaXZhdGUgX3NjYWxlZFRleHR1cmVIZWlnaHQ6bnVtYmVyID0gLTE7XHJcblx0cHJpdmF0ZSBfdGV4dHVyZVdpZHRoOm51bWJlciA9IC0xO1xyXG5cdHByaXZhdGUgX3RleHR1cmVIZWlnaHQ6bnVtYmVyID0gLTE7XHJcblx0cHJpdmF0ZSBfdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkOmJvb2xlYW4gPSB0cnVlO1xyXG5cdHByaXZhdGUgX3Byb2dyYW0zREludmFsaWQ6Ym9vbGVhbiA9IHRydWU7XHJcblx0cHJpdmF0ZSBfcHJvZ3JhbTNEOklQcm9ncmFtO1xyXG5cdHByaXZhdGUgX3RhcmdldDpJVGV4dHVyZTtcclxuXHRwcml2YXRlIF9yZXF1aXJlRGVwdGhSZW5kZXI6Ym9vbGVhbjtcclxuXHRwcml2YXRlIF90ZXh0dXJlU2NhbGU6bnVtYmVyID0gMDtcclxuXHJcblx0Y29uc3RydWN0b3IocmVxdWlyZURlcHRoUmVuZGVyOmJvb2xlYW4gPSBmYWxzZSlcclxuXHR7XHJcblxyXG5cdFx0dGhpcy5fcmVxdWlyZURlcHRoUmVuZGVyID0gcmVxdWlyZURlcHRoUmVuZGVyO1xyXG5cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFRoZSB0ZXh0dXJlIHNjYWxlIGZvciB0aGUgaW5wdXQgb2YgdGhpcyB0ZXh0dXJlLiBUaGlzIHdpbGwgZGVmaW5lIHRoZSBvdXRwdXQgb2YgdGhlIHByZXZpb3VzIGVudHJ5IGluIHRoZSBjaGFpblxyXG5cdCAqL1xyXG5cdHB1YmxpYyBnZXQgdGV4dHVyZVNjYWxlKCk6bnVtYmVyXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX3RleHR1cmVTY2FsZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgdGV4dHVyZVNjYWxlKHZhbHVlOm51bWJlcilcclxuXHR7XHJcblx0XHRpZiAodGhpcy5fdGV4dHVyZVNjYWxlID09IHZhbHVlKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0dGhpcy5fdGV4dHVyZVNjYWxlID0gdmFsdWU7XHJcblx0XHR0aGlzLl9zY2FsZWRUZXh0dXJlV2lkdGggPSB0aGlzLl90ZXh0dXJlV2lkdGggPj4gdGhpcy5fdGV4dHVyZVNjYWxlO1xyXG5cdFx0dGhpcy5fc2NhbGVkVGV4dHVyZUhlaWdodCA9IHRoaXMuX3RleHR1cmVIZWlnaHQgPj4gdGhpcy5fdGV4dHVyZVNjYWxlO1xyXG5cdFx0dGhpcy5fdGV4dHVyZURpbWVuc2lvbnNJbnZhbGlkID0gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgdGFyZ2V0KCk6SVRleHR1cmVcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fdGFyZ2V0O1xyXG5cdH1cclxuXHJcblx0cHVibGljIHNldCB0YXJnZXQodmFsdWU6SVRleHR1cmUpXHJcblx0e1xyXG5cdFx0dGhpcy5fdGFyZ2V0ID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHRleHR1cmVXaWR0aCgpOm51bWJlclxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl90ZXh0dXJlV2lkdGg7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc2V0IHRleHR1cmVXaWR0aCh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3RleHR1cmVXaWR0aCA9PSB2YWx1ZSlcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdHRoaXMuX3RleHR1cmVXaWR0aCA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fc2NhbGVkVGV4dHVyZVdpZHRoID0gdGhpcy5fdGV4dHVyZVdpZHRoID4+IHRoaXMuX3RleHR1cmVTY2FsZTtcclxuXHRcdHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZCA9IHRydWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHRleHR1cmVIZWlnaHQoKTpudW1iZXJcclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fdGV4dHVyZUhlaWdodDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBzZXQgdGV4dHVyZUhlaWdodCh2YWx1ZTpudW1iZXIpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3RleHR1cmVIZWlnaHQgPT0gdmFsdWUpXHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR0aGlzLl90ZXh0dXJlSGVpZ2h0ID0gdmFsdWU7XHJcblx0XHR0aGlzLl9zY2FsZWRUZXh0dXJlSGVpZ2h0ID0gdGhpcy5fdGV4dHVyZUhlaWdodCA+PiB0aGlzLl90ZXh0dXJlU2NhbGU7XHJcblx0XHR0aGlzLl90ZXh0dXJlRGltZW5zaW9uc0ludmFsaWQgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldE1haW5JbnB1dFRleHR1cmUoc3RhZ2U6U3RhZ2UpOklUZXh0dXJlXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZClcclxuXHRcdFx0dGhpcy5wVXBkYXRlVGV4dHVyZXMoc3RhZ2UpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9tYWluSW5wdXRUZXh0dXJlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGRpc3Bvc2UoKVxyXG5cdHtcclxuXHRcdGlmICh0aGlzLl9tYWluSW5wdXRUZXh0dXJlKVxyXG5cdFx0XHR0aGlzLl9tYWluSW5wdXRUZXh0dXJlLmRpc3Bvc2UoKTtcclxuXHJcblx0XHRpZiAodGhpcy5fcHJvZ3JhbTNEKVxyXG5cdFx0XHR0aGlzLl9wcm9ncmFtM0QuZGlzcG9zZSgpO1xyXG5cdH1cclxuXHJcblx0cHVibGljIHBJbnZhbGlkYXRlUHJvZ3JhbSgpXHJcblx0e1xyXG5cdFx0dGhpcy5fcHJvZ3JhbTNESW52YWxpZCA9IHRydWU7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgcFVwZGF0ZVByb2dyYW0oc3RhZ2U6U3RhZ2UpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3Byb2dyYW0zRClcclxuXHRcdFx0dGhpcy5fcHJvZ3JhbTNELmRpc3Bvc2UoKTtcclxuXHJcblx0XHR0aGlzLl9wcm9ncmFtM0QgPSBzdGFnZS5jb250ZXh0LmNyZWF0ZVByb2dyYW0oKTtcclxuXHJcblx0XHR2YXIgdmVydGV4Qnl0ZUNvZGU6Qnl0ZUFycmF5ID0gKG5ldyBBR0FMTWluaUFzc2VtYmxlcigpLmFzc2VtYmxlKFwicGFydCB2ZXJ0ZXggMVxcblwiICsgdGhpcy5wR2V0VmVydGV4Q29kZSgpICsgXCJlbmRwYXJ0XCIpKVsndmVydGV4J10uZGF0YTtcclxuXHRcdHZhciBmcmFnbWVudEJ5dGVDb2RlOkJ5dGVBcnJheSA9IChuZXcgQUdBTE1pbmlBc3NlbWJsZXIoKS5hc3NlbWJsZShcInBhcnQgZnJhZ21lbnQgMVxcblwiICsgdGhpcy5wR2V0RnJhZ21lbnRDb2RlKCkgKyBcImVuZHBhcnRcIikpWydmcmFnbWVudCddLmRhdGE7XHJcblx0XHR0aGlzLl9wcm9ncmFtM0QudXBsb2FkKHZlcnRleEJ5dGVDb2RlLCBmcmFnbWVudEJ5dGVDb2RlKTtcclxuXHRcdHRoaXMuX3Byb2dyYW0zREludmFsaWQgPSBmYWxzZTtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwR2V0VmVydGV4Q29kZSgpOnN0cmluZ1xyXG5cdHtcclxuXHRcdC8vIFRPRE86IGltZXBsZW1lbnQgQUdBTCA8PiBHTFNMXHJcblxyXG5cdFx0cmV0dXJuIFwibW92IG9wLCB2YTBcXG5cIiArIFwibW92IHYwLCB2YTFcXG5cIjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwR2V0RnJhZ21lbnRDb2RlKCk6c3RyaW5nXHJcblx0e1xyXG5cdFx0dGhyb3cgbmV3IEFic3RyYWN0TWV0aG9kRXJyb3IoKTtcclxuXHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBwVXBkYXRlVGV4dHVyZXMoc3RhZ2U6U3RhZ2UpXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX21haW5JbnB1dFRleHR1cmUpXHJcblx0XHRcdHRoaXMuX21haW5JbnB1dFRleHR1cmUuZGlzcG9zZSgpO1xyXG5cclxuXHRcdHRoaXMuX21haW5JbnB1dFRleHR1cmUgPSBzdGFnZS5jb250ZXh0LmNyZWF0ZVRleHR1cmUodGhpcy5fc2NhbGVkVGV4dHVyZVdpZHRoLCB0aGlzLl9zY2FsZWRUZXh0dXJlSGVpZ2h0LCBDb250ZXh0R0xUZXh0dXJlRm9ybWF0LkJHUkEsIHRydWUpO1xyXG5cclxuXHRcdHRoaXMuX3RleHR1cmVEaW1lbnNpb25zSW52YWxpZCA9IGZhbHNlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldFByb2dyYW0oc3RhZ2U6U3RhZ2UpOklQcm9ncmFtXHJcblx0e1xyXG5cdFx0aWYgKHRoaXMuX3Byb2dyYW0zREludmFsaWQpXHJcblx0XHRcdHRoaXMucFVwZGF0ZVByb2dyYW0oc3RhZ2UpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9wcm9ncmFtM0Q7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgYWN0aXZhdGUoc3RhZ2U6U3RhZ2UsIGNhbWVyYTpDYW1lcmEsIGRlcHRoVGV4dHVyZTpJVGV4dHVyZSlcclxuXHR7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZGVhY3RpdmF0ZShzdGFnZTpTdGFnZSlcclxuXHR7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IHJlcXVpcmVEZXB0aFJlbmRlcigpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fcmVxdWlyZURlcHRoUmVuZGVyO1xyXG5cdH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCA9IEZpbHRlcjNEVGFza0Jhc2U7Il19