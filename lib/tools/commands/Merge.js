var Geometry = require("awayjs-core/lib/core/base/Geometry");
var TriangleSubGeometry = require("awayjs-core/lib/core/base/TriangleSubGeometry");
var Matrix3DUtils = require("awayjs-core/lib/core/geom/Matrix3DUtils");
var Mesh = require("awayjs-core/lib/entities/Mesh");
/**
 *  Class Merge merges two or more static meshes into one.<code>Merge</code>
 */
var Merge = (function () {
    /**
     * @param    keepMaterial    [optional]    Determines if the merged object uses the recevier mesh material information or keeps its source material(s). Defaults to false.
     * If false and receiver object has multiple materials, the last material found in receiver submeshes is applied to the merged submesh(es).
     * @param    disposeSources  [optional]    Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.
     * If true, only receiver geometry and resulting mesh are kept in  memory.
     * @param    objectSpace     [optional]    Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.
     */
    function Merge(keepMaterial, disposeSources, objectSpace) {
        if (keepMaterial === void 0) { keepMaterial = false; }
        if (disposeSources === void 0) { disposeSources = false; }
        if (objectSpace === void 0) { objectSpace = false; }
        this._keepMaterial = keepMaterial;
        this._disposeSources = disposeSources;
        this._objectSpace = objectSpace;
    }
    Object.defineProperty(Merge.prototype, "disposeSources", {
        get: function () {
            return this._disposeSources;
        },
        /**
         * Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.
         */
        set: function (b) {
            this._disposeSources = b;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Merge.prototype, "keepMaterial", {
        get: function () {
            return this._keepMaterial;
        },
        /**
         * Determines if the material source(s) used for the merging are disposed. Defaults to false.
         */
        set: function (b) {
            this._keepMaterial = b;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Merge.prototype, "objectSpace", {
        get: function () {
            return this._objectSpace;
        },
        /**
         * Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.
         */
        set: function (b) {
            this._objectSpace = b;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Merges all the children of a container into a single Mesh. If no Mesh object is found, method returns the receiver without modification.
     *
     * @param    receiver           The Mesh to receive the merged contents of the container.
     * @param    objectContainer    The DisplayObjectContainer holding the meshes to be mergd.
     *
     * @return The merged Mesh instance.
     */
    Merge.prototype.applyToContainer = function (receiver, objectContainer) {
        this.reset();
        //collect container meshes
        this.parseContainer(receiver, objectContainer);
        //collect receiver
        this.collect(receiver, false);
        //merge to receiver
        this.merge(receiver, this._disposeSources);
    };
    /**
     * Merges all the meshes found in the Array&lt;Mesh&gt; into a single Mesh.
     *
     * @param    receiver    The Mesh to receive the merged contents of the meshes.
     * @param    meshes      A series of Meshes to be merged with the reciever mesh.
     */
    Merge.prototype.applyToMeshes = function (receiver, meshes) {
        this.reset();
        if (!meshes.length)
            return;
        for (var i = 0; i < meshes.length; i++)
            if (meshes[i] != receiver)
                this.collect(meshes[i], this._disposeSources);
        //collect receiver
        this.collect(receiver, false);
        //merge to receiver
        this.merge(receiver, this._disposeSources);
    };
    /**
     *  Merges 2 meshes into one. It is recommand to use apply when 2 meshes are to be merged. If more need to be merged, use either applyToMeshes or applyToContainer methods.
     *
     * @param    receiver    The Mesh to receive the merged contents of both meshes.
     * @param    mesh        The Mesh to be merged with the receiver mesh
     */
    Merge.prototype.apply = function (receiver, mesh) {
        this.reset();
        //collect mesh
        this.collect(mesh, this._disposeSources);
        //collect receiver
        this.collect(receiver, false);
        //merge to receiver
        this.merge(receiver, this._disposeSources);
    };
    Merge.prototype.reset = function () {
        this._toDispose = new Array();
        this._geomVOs = new Array();
    };
    Merge.prototype.merge = function (destMesh, dispose) {
        var i /*uint*/;
        var subIdx /*uint*/;
        var oldGeom;
        var destGeom;
        var useSubMaterials;
        oldGeom = destMesh.geometry;
        destGeom = destMesh.geometry = new Geometry();
        subIdx = destMesh.subMeshes.length;
        // Only apply materials directly to sub-meshes if necessary,
        // i.e. if there is more than one material available.
        useSubMaterials = (this._geomVOs.length > 1);
        for (i = 0; i < this._geomVOs.length; i++) {
            var s /*uint*/;
            var data;
            var sub = new TriangleSubGeometry(true);
            sub.autoDeriveNormals = false;
            sub.autoDeriveTangents = false;
            data = this._geomVOs[i];
            sub.updateIndices(data.indices);
            sub.updatePositions(data.vertices);
            sub.updateVertexNormals(data.normals);
            sub.updateVertexTangents(data.tangents);
            sub.updateUVs(data.uvs);
            destGeom.addSubGeometry(sub);
            if (this._keepMaterial && useSubMaterials)
                destMesh.subMeshes[subIdx].material = data.material;
        }
        if (this._keepMaterial && !useSubMaterials && this._geomVOs.length)
            destMesh.material = this._geomVOs[0].material;
        if (dispose) {
            var m;
            var len = this._toDispose.length;
            for (var i; i < len; i++) {
                m = this._toDispose[i];
                m.geometry.dispose();
                m.dispose();
            }
            //dispose of the original receiver geometry
            oldGeom.dispose();
        }
        this._toDispose = null;
    };
    Merge.prototype.collect = function (mesh, dispose) {
        if (mesh.geometry) {
            var subIdx /*uint*/;
            var subGeometries = mesh.geometry.subGeometries;
            var calc /*uint*/;
            for (subIdx = 0; subIdx < subGeometries.length; subIdx++) {
                var i /*uint*/;
                var len /*uint*/;
                var iIdx /*uint*/, vIdx /*uint*/, nIdx /*uint*/, tIdx /*uint*/, uIdx /*uint*/;
                var indexOffset /*uint*/;
                var subGeom;
                var vo;
                var vertices;
                var normals;
                var tangents;
                var pd, nd, td, ud;
                subGeom = subGeometries[subIdx];
                pd = subGeom.positions;
                nd = subGeom.vertexNormals;
                td = subGeom.vertexTangents;
                ud = subGeom.uvs;
                // Get (or create) a VO for this material
                vo = this.getSubGeomData(mesh.subMeshes[subIdx].material || mesh.material);
                // Vertices and normals are copied to temporary vectors, to be transformed
                // before concatenated onto those of the data. This is unnecessary if no
                // transformation will be performed, i.e. for object space merging.
                vertices = (this._objectSpace) ? vo.vertices : new Array();
                normals = (this._objectSpace) ? vo.normals : new Array();
                tangents = (this._objectSpace) ? vo.tangents : new Array();
                // Copy over vertex attributes
                vIdx = vertices.length;
                nIdx = normals.length;
                tIdx = tangents.length;
                uIdx = vo.uvs.length;
                len = subGeom.numVertices;
                for (i = 0; i < len; i++) {
                    calc = i * 3;
                    // Position
                    vertices[vIdx++] = pd[calc];
                    vertices[vIdx++] = pd[calc + 1];
                    vertices[vIdx++] = pd[calc + 2];
                    // Normal
                    normals[nIdx++] = nd[calc];
                    normals[nIdx++] = nd[calc + 1];
                    normals[nIdx++] = nd[calc + 2];
                    // Tangent
                    tangents[tIdx++] = td[calc];
                    tangents[tIdx++] = td[calc + 1];
                    tangents[tIdx++] = td[calc + 2];
                    // UV
                    vo.uvs[uIdx++] = ud[i * 2];
                    vo.uvs[uIdx++] = ud[i * 2 + 1];
                }
                // Copy over triangle indices
                indexOffset = (!this._objectSpace) ? vo.vertices.length / 3 : 0;
                iIdx = vo.indices.length;
                len = subGeom.numTriangles;
                for (i = 0; i < len; i++) {
                    calc = i * 3;
                    vo.indices[iIdx++] = subGeom.indices[calc] + indexOffset;
                    vo.indices[iIdx++] = subGeom.indices[calc + 1] + indexOffset;
                    vo.indices[iIdx++] = subGeom.indices[calc + 2] + indexOffset;
                }
                if (!this._objectSpace) {
                    mesh.sceneTransform.transformVectors(vertices, vertices);
                    Matrix3DUtils.deltaTransformVectors(mesh.sceneTransform, normals, normals);
                    Matrix3DUtils.deltaTransformVectors(mesh.sceneTransform, tangents, tangents);
                    // Copy vertex data from temporary (transformed) vectors
                    vIdx = vo.vertices.length;
                    nIdx = vo.normals.length;
                    tIdx = vo.tangents.length;
                    len = vertices.length;
                    for (i = 0; i < len; i++) {
                        vo.vertices[vIdx++] = vertices[i];
                        vo.normals[nIdx++] = normals[i];
                        vo.tangents[tIdx++] = tangents[i];
                    }
                }
            }
            if (dispose)
                this._toDispose.push(mesh);
        }
    };
    Merge.prototype.getSubGeomData = function (material) {
        var data;
        if (this._keepMaterial) {
            var i /*uint*/;
            var len /*uint*/;
            len = this._geomVOs.length;
            for (i = 0; i < len; i++) {
                if (this._geomVOs[i].material == material) {
                    data = this._geomVOs[i];
                    break;
                }
            }
        }
        else if (this._geomVOs.length) {
            // If materials are not to be kept, all data can be
            // put into a single VO, so return that one.
            data = this._geomVOs[0];
        }
        // No data (for this material) found, create new.
        if (!data) {
            data = new GeometryVO();
            data.vertices = new Array();
            data.normals = new Array();
            data.tangents = new Array();
            data.uvs = new Array();
            data.indices = new Array();
            data.material = material;
            this._geomVOs.push(data);
        }
        return data;
    };
    Merge.prototype.parseContainer = function (receiver, object) {
        var child;
        var i /*uint*/;
        if (object instanceof Mesh && object != receiver)
            this.collect(object, this._disposeSources);
        for (i = 0; i < object.numChildren; ++i) {
            child = object.getChildAt(i);
            this.parseContainer(receiver, child);
        }
    };
    return Merge;
})();
var GeometryVO = (function () {
    function GeometryVO() {
    }
    return GeometryVO;
})();
module.exports = Merge;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvb2xzL2NvbW1hbmRzL21lcmdlLnRzIl0sIm5hbWVzIjpbIk1lcmdlIiwiTWVyZ2UuY29uc3RydWN0b3IiLCJNZXJnZS5kaXNwb3NlU291cmNlcyIsIk1lcmdlLmtlZXBNYXRlcmlhbCIsIk1lcmdlLm9iamVjdFNwYWNlIiwiTWVyZ2UuYXBwbHlUb0NvbnRhaW5lciIsIk1lcmdlLmFwcGx5VG9NZXNoZXMiLCJNZXJnZS5hcHBseSIsIk1lcmdlLnJlc2V0IiwiTWVyZ2UubWVyZ2UiLCJNZXJnZS5jb2xsZWN0IiwiTWVyZ2UuZ2V0U3ViR2VvbURhdGEiLCJNZXJnZS5wYXJzZUNvbnRhaW5lciIsIkdlb21ldHJ5Vk8iLCJHZW9tZXRyeVZPLmNvbnN0cnVjdG9yIl0sIm1hcHBpbmdzIjoiQUFDQSxJQUFPLFFBQVEsV0FBaUIsb0NBQW9DLENBQUMsQ0FBQztBQUN0RSxJQUFPLG1CQUFtQixXQUFjLCtDQUErQyxDQUFDLENBQUM7QUFDekYsSUFBTyxhQUFhLFdBQWUseUNBQXlDLENBQUMsQ0FBQztBQUM5RSxJQUFPLElBQUksV0FBa0IsK0JBQStCLENBQUMsQ0FBQztBQUc5RCxBQUdBOztHQURHO0lBQ0csS0FBSztJQVVWQTs7Ozs7O09BTUdBO0lBQ0hBLFNBakJLQSxLQUFLQSxDQWlCRUEsWUFBNEJBLEVBQUVBLGNBQThCQSxFQUFFQSxXQUEyQkE7UUFBekZDLDRCQUE0QkEsR0FBNUJBLG9CQUE0QkE7UUFBRUEsOEJBQThCQSxHQUE5QkEsc0JBQThCQTtRQUFFQSwyQkFBMkJBLEdBQTNCQSxtQkFBMkJBO1FBRXBHQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxZQUFZQSxDQUFDQTtRQUNsQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsR0FBR0EsY0FBY0EsQ0FBQ0E7UUFDdENBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLFdBQVdBLENBQUNBO0lBQ2pDQSxDQUFDQTtJQUtERCxzQkFBV0EsaUNBQWNBO2FBS3pCQTtZQUVDRSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxl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SUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBRWhDQSxBQUNBQSxTQURTQTtvQkFDVEEsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7b0JBQzNCQSxPQUFPQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDL0JBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO29CQUUvQkEsQUFDQUEsVUFEVUE7b0JBQ1ZBLFFBQVFBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUM1QkEsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2hDQSxRQUFRQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFFaENBLEFBQ0FBLEtBREtBO29CQUNMQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDekJBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUM5QkEsQ0FBQ0E7Z0JBRURBLEFBQ0FBLDZCQUQ2QkE7Z0JBQzdCQSxXQUFXQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFD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QUFDQTtJQUNGWixZQUFDQTtBQUFEQSxDQWxWQSxBQWtWQ0EsSUFBQTtBQUlELElBQU0sVUFBVTtJQUFoQmEsU0FBTUEsVUFBVUE7SUFRaEJDLENBQUNBO0lBQURELGlCQUFDQTtBQUFEQSxDQVJBLEFBUUNBLElBQUE7QUFWRCxpQkFBUyxLQUFLLENBQUMiLCJmaWxlIjoidG9vbHMvY29tbWFuZHMvTWVyZ2UuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL3JvYmJhdGVtYW4vV2Vic3Rvcm1Qcm9qZWN0cy9hd2F5anMtcmVuZGVyZXJnbC8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRGlzcGxheU9iamVjdENvbnRhaW5lclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb250YWluZXJzL0Rpc3BsYXlPYmplY3RDb250YWluZXJcIik7XG5pbXBvcnQgR2VvbWV0cnlcdFx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9jb3JlL2Jhc2UvR2VvbWV0cnlcIik7XG5pbXBvcnQgVHJpYW5nbGVTdWJHZW9tZXRyeVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvYmFzZS9UcmlhbmdsZVN1Ykdlb21ldHJ5XCIpO1xuaW1wb3J0IE1hdHJpeDNEVXRpbHNcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9NYXRyaXgzRFV0aWxzXCIpO1xuaW1wb3J0IE1lc2hcdFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2VudGl0aWVzL01lc2hcIik7XG5pbXBvcnQgTWF0ZXJpYWxCYXNlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL21hdGVyaWFscy9NYXRlcmlhbEJhc2VcIik7XG5cbi8qKlxuICogIENsYXNzIE1lcmdlIG1lcmdlcyB0d28gb3IgbW9yZSBzdGF0aWMgbWVzaGVzIGludG8gb25lLjxjb2RlPk1lcmdlPC9jb2RlPlxuICovXG5jbGFzcyBNZXJnZVxue1xuXG5cdC8vcHJpdmF0ZSBjb25zdCBMSU1JVDp1aW50ID0gMTk2NjA1O1xuXHRwcml2YXRlIF9vYmplY3RTcGFjZTpib29sZWFuO1xuXHRwcml2YXRlIF9rZWVwTWF0ZXJpYWw6Ym9vbGVhbjtcblx0cHJpdmF0ZSBfZGlzcG9zZVNvdXJjZXM6Ym9vbGVhbjtcblx0cHJpdmF0ZSBfZ2VvbVZPczpBcnJheTxHZW9tZXRyeVZPPjtcblx0cHJpdmF0ZSBfdG9EaXNwb3NlOkFycmF5PE1lc2g+O1xuXG5cdC8qKlxuXHQgKiBAcGFyYW0gICAga2VlcE1hdGVyaWFsICAgIFtvcHRpb25hbF0gICAgRGV0ZXJtaW5lcyBpZiB0aGUgbWVyZ2VkIG9iamVjdCB1c2VzIHRoZSByZWNldmllciBtZXNoIG1hdGVyaWFsIGluZm9ybWF0aW9uIG9yIGtlZXBzIGl0cyBzb3VyY2UgbWF0ZXJpYWwocykuIERlZmF1bHRzIHRvIGZhbHNlLlxuXHQgKiBJZiBmYWxzZSBhbmQgcmVjZWl2ZXIgb2JqZWN0IGhhcyBtdWx0aXBsZSBtYXRlcmlhbHMsIHRoZSBsYXN0IG1hdGVyaWFsIGZvdW5kIGluIHJlY2VpdmVyIHN1Ym1lc2hlcyBpcyBhcHBsaWVkIHRvIHRoZSBtZXJnZWQgc3VibWVzaChlcykuXG5cdCAqIEBwYXJhbSAgICBkaXNwb3NlU291cmNlcyAgW29wdGlvbmFsXSAgICBEZXRlcm1pbmVzIGlmIHRoZSBtZXNoIGFuZCBnZW9tZXRyeSBzb3VyY2UocykgdXNlZCBmb3IgdGhlIG1lcmdpbmcgYXJlIGRpc3Bvc2VkLiBEZWZhdWx0cyB0byBmYWxzZS5cblx0ICogSWYgdHJ1ZSwgb25seSByZWNlaXZlciBnZW9tZXRyeSBhbmQgcmVzdWx0aW5nIG1lc2ggYXJlIGtlcHQgaW4gIG1lbW9yeS5cblx0ICogQHBhcmFtICAgIG9iamVjdFNwYWNlICAgICBbb3B0aW9uYWxdICAgIERldGVybWluZXMgaWYgc291cmNlIG1lc2goZXMpIGlzL2FyZSBtZXJnZWQgdXNpbmcgb2JqZWN0U3BhY2Ugb3Igd29ybGRzcGFjZS4gRGVmYXVsdHMgdG8gZmFsc2UuXG5cdCAqL1xuXHRjb25zdHJ1Y3RvcihrZWVwTWF0ZXJpYWw6Ym9vbGVhbiA9IGZhbHNlLCBkaXNwb3NlU291cmNlczpib29sZWFuID0gZmFsc2UsIG9iamVjdFNwYWNlOmJvb2xlYW4gPSBmYWxzZSlcblx0e1xuXHRcdHRoaXMuX2tlZXBNYXRlcmlhbCA9IGtlZXBNYXRlcmlhbDtcblx0XHR0aGlzLl9kaXNwb3NlU291cmNlcyA9IGRpc3Bvc2VTb3VyY2VzO1xuXHRcdHRoaXMuX29iamVjdFNwYWNlID0gb2JqZWN0U3BhY2U7XG5cdH1cblxuXHQvKipcblx0ICogRGV0ZXJtaW5lcyBpZiB0aGUgbWVzaCBhbmQgZ2VvbWV0cnkgc291cmNlKHMpIHVzZWQgZm9yIHRoZSBtZXJnaW5nIGFyZSBkaXNwb3NlZC4gRGVmYXVsdHMgdG8gZmFsc2UuXG5cdCAqL1xuXHRwdWJsaWMgc2V0IGRpc3Bvc2VTb3VyY2VzKGI6Ym9vbGVhbilcblx0e1xuXHRcdHRoaXMuX2Rpc3Bvc2VTb3VyY2VzID0gYjtcblx0fVxuXG5cdHB1YmxpYyBnZXQgZGlzcG9zZVNvdXJjZXMoKTpib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fZGlzcG9zZVNvdXJjZXM7XG5cdH1cblxuXHQvKipcblx0ICogRGV0ZXJtaW5lcyBpZiB0aGUgbWF0ZXJpYWwgc291cmNlKHMpIHVzZWQgZm9yIHRoZSBtZXJnaW5nIGFyZSBkaXNwb3NlZC4gRGVmYXVsdHMgdG8gZmFsc2UuXG5cdCAqL1xuXHRwdWJsaWMgc2V0IGtlZXBNYXRlcmlhbChiOmJvb2xlYW4pXG5cdHtcblx0XHR0aGlzLl9rZWVwTWF0ZXJpYWwgPSBiO1xuXHR9XG5cblx0cHVibGljIGdldCBrZWVwTWF0ZXJpYWwoKTpib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fa2VlcE1hdGVyaWFsO1xuXHR9XG5cblx0LyoqXG5cdCAqIERldGVybWluZXMgaWYgc291cmNlIG1lc2goZXMpIGlzL2FyZSBtZXJnZWQgdXNpbmcgb2JqZWN0U3BhY2Ugb3Igd29ybGRzcGFjZS4gRGVmYXVsdHMgdG8gZmFsc2UuXG5cdCAqL1xuXHRwdWJsaWMgc2V0IG9iamVjdFNwYWNlKGI6Ym9vbGVhbilcblx0e1xuXHRcdHRoaXMuX29iamVjdFNwYWNlID0gYjtcblx0fVxuXG5cdHB1YmxpYyBnZXQgb2JqZWN0U3BhY2UoKTpib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5fb2JqZWN0U3BhY2U7XG5cdH1cblxuXHQvKipcblx0ICogTWVyZ2VzIGFsbCB0aGUgY2hpbGRyZW4gb2YgYSBjb250YWluZXIgaW50byBhIHNpbmdsZSBNZXNoLiBJZiBubyBNZXNoIG9iamVjdCBpcyBmb3VuZCwgbWV0aG9kIHJldHVybnMgdGhlIHJlY2VpdmVyIHdpdGhvdXQgbW9kaWZpY2F0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gICAgcmVjZWl2ZXIgICAgICAgICAgIFRoZSBNZXNoIHRvIHJlY2VpdmUgdGhlIG1lcmdlZCBjb250ZW50cyBvZiB0aGUgY29udGFpbmVyLlxuXHQgKiBAcGFyYW0gICAgb2JqZWN0Q29udGFpbmVyICAgIFRoZSBEaXNwbGF5T2JqZWN0Q29udGFpbmVyIGhvbGRpbmcgdGhlIG1lc2hlcyB0byBiZSBtZXJnZC5cblx0ICpcblx0ICogQHJldHVybiBUaGUgbWVyZ2VkIE1lc2ggaW5zdGFuY2UuXG5cdCAqL1xuXHRwdWJsaWMgYXBwbHlUb0NvbnRhaW5lcihyZWNlaXZlcjpNZXNoLCBvYmplY3RDb250YWluZXI6RGlzcGxheU9iamVjdENvbnRhaW5lcilcblx0e1xuXHRcdHRoaXMucmVzZXQoKTtcblxuXHRcdC8vY29sbGVjdCBjb250YWluZXIgbWVzaGVzXG5cdFx0dGhpcy5wYXJzZUNvbnRhaW5lcihyZWNlaXZlciwgb2JqZWN0Q29udGFpbmVyKTtcblxuXHRcdC8vY29sbGVjdCByZWNlaXZlclxuXHRcdHRoaXMuY29sbGVjdChyZWNlaXZlciwgZmFsc2UpO1xuXG5cdFx0Ly9tZXJnZSB0byByZWNlaXZlclxuXHRcdHRoaXMubWVyZ2UocmVjZWl2ZXIsIHRoaXMuX2Rpc3Bvc2VTb3VyY2VzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBNZXJnZXMgYWxsIHRoZSBtZXNoZXMgZm91bmQgaW4gdGhlIEFycmF5Jmx0O01lc2gmZ3Q7IGludG8gYSBzaW5nbGUgTWVzaC5cblx0ICpcblx0ICogQHBhcmFtICAgIHJlY2VpdmVyICAgIFRoZSBNZXNoIHRvIHJlY2VpdmUgdGhlIG1lcmdlZCBjb250ZW50cyBvZiB0aGUgbWVzaGVzLlxuXHQgKiBAcGFyYW0gICAgbWVzaGVzICAgICAgQSBzZXJpZXMgb2YgTWVzaGVzIHRvIGJlIG1lcmdlZCB3aXRoIHRoZSByZWNpZXZlciBtZXNoLlxuXHQgKi9cblx0cHVibGljIGFwcGx5VG9NZXNoZXMocmVjZWl2ZXI6TWVzaCwgbWVzaGVzOkFycmF5PE1lc2g+KVxuXHR7XG5cdFx0dGhpcy5yZXNldCgpO1xuXG5cdFx0aWYgKCFtZXNoZXMubGVuZ3RoKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0Ly9jb2xsZWN0IG1lc2hlcyBpbiB2ZWN0b3Jcblx0XHRmb3IgKHZhciBpOm51bWJlciAvKnVpbnQqLyA9IDA7IGkgPCBtZXNoZXMubGVuZ3RoOyBpKyspXG5cdFx0XHRpZiAobWVzaGVzW2ldICE9IHJlY2VpdmVyKVxuXHRcdFx0XHR0aGlzLmNvbGxlY3QobWVzaGVzW2ldLCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XG5cblx0XHQvL2NvbGxlY3QgcmVjZWl2ZXJcblx0XHR0aGlzLmNvbGxlY3QocmVjZWl2ZXIsIGZhbHNlKTtcblxuXHRcdC8vbWVyZ2UgdG8gcmVjZWl2ZXJcblx0XHR0aGlzLm1lcmdlKHJlY2VpdmVyLCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XG5cdH1cblxuXHQvKipcblx0ICogIE1lcmdlcyAyIG1lc2hlcyBpbnRvIG9uZS4gSXQgaXMgcmVjb21tYW5kIHRvIHVzZSBhcHBseSB3aGVuIDIgbWVzaGVzIGFyZSB0byBiZSBtZXJnZWQuIElmIG1vcmUgbmVlZCB0byBiZSBtZXJnZWQsIHVzZSBlaXRoZXIgYXBwbHlUb01lc2hlcyBvciBhcHBseVRvQ29udGFpbmVyIG1ldGhvZHMuXG5cdCAqXG5cdCAqIEBwYXJhbSAgICByZWNlaXZlciAgICBUaGUgTWVzaCB0byByZWNlaXZlIHRoZSBtZXJnZWQgY29udGVudHMgb2YgYm90aCBtZXNoZXMuXG5cdCAqIEBwYXJhbSAgICBtZXNoICAgICAgICBUaGUgTWVzaCB0byBiZSBtZXJnZWQgd2l0aCB0aGUgcmVjZWl2ZXIgbWVzaFxuXHQgKi9cblx0cHVibGljIGFwcGx5KHJlY2VpdmVyOk1lc2gsIG1lc2g6TWVzaClcblx0e1xuXHRcdHRoaXMucmVzZXQoKTtcblxuXHRcdC8vY29sbGVjdCBtZXNoXG5cdFx0dGhpcy5jb2xsZWN0KG1lc2gsIHRoaXMuX2Rpc3Bvc2VTb3VyY2VzKTtcblxuXHRcdC8vY29sbGVjdCByZWNlaXZlclxuXHRcdHRoaXMuY29sbGVjdChyZWNlaXZlciwgZmFsc2UpO1xuXG5cdFx0Ly9tZXJnZSB0byByZWNlaXZlclxuXHRcdHRoaXMubWVyZ2UocmVjZWl2ZXIsIHRoaXMuX2Rpc3Bvc2VTb3VyY2VzKTtcblx0fVxuXG5cdHByaXZhdGUgcmVzZXQoKVxuXHR7XG5cdFx0dGhpcy5fdG9EaXNwb3NlICA9IG5ldyBBcnJheTxNZXNoPigpO1xuXHRcdHRoaXMuX2dlb21WT3MgPSBuZXcgQXJyYXk8R2VvbWV0cnlWTz4oKTtcblx0fVxuXG5cdHByaXZhdGUgbWVyZ2UoZGVzdE1lc2g6TWVzaCwgZGlzcG9zZTpib29sZWFuKVxuXHR7XG5cdFx0dmFyIGk6bnVtYmVyIC8qdWludCovO1xuXHRcdHZhciBzdWJJZHg6bnVtYmVyIC8qdWludCovO1xuXHRcdHZhciBvbGRHZW9tOkdlb21ldHJ5O1xuXHRcdHZhciBkZXN0R2VvbTpHZW9tZXRyeTtcblx0XHR2YXIgdXNlU3ViTWF0ZXJpYWxzOmJvb2xlYW47XG5cblx0XHRvbGRHZW9tID0gZGVzdE1lc2guZ2VvbWV0cnk7XG5cdFx0ZGVzdEdlb20gPSBkZXN0TWVzaC5nZW9tZXRyeSA9IG5ldyBHZW9tZXRyeSgpO1xuXHRcdHN1YklkeCA9IGRlc3RNZXNoLnN1Yk1lc2hlcy5sZW5ndGg7XG5cblx0XHQvLyBPbmx5IGFwcGx5IG1hdGVyaWFscyBkaXJlY3RseSB0byBzdWItbWVzaGVzIGlmIG5lY2Vzc2FyeSxcblx0XHQvLyBpLmUuIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbWF0ZXJpYWwgYXZhaWxhYmxlLlxuXHRcdHVzZVN1Yk1hdGVyaWFscyA9ICh0aGlzLl9nZW9tVk9zLmxlbmd0aCA+IDEpO1xuXG5cdFx0Zm9yIChpID0gMDsgaSA8IHRoaXMuX2dlb21WT3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBzOm51bWJlciAvKnVpbnQqLztcblx0XHRcdHZhciBkYXRhOkdlb21ldHJ5Vk87XG5cdFx0XHR2YXIgc3ViOlRyaWFuZ2xlU3ViR2VvbWV0cnkgPSBuZXcgVHJpYW5nbGVTdWJHZW9tZXRyeSh0cnVlKTtcblx0XHRcdHN1Yi5hdXRvRGVyaXZlTm9ybWFscyA9IGZhbHNlO1xuXHRcdFx0c3ViLmF1dG9EZXJpdmVUYW5nZW50cyA9IGZhbHNlO1xuXG5cdFx0XHRkYXRhID0gdGhpcy5fZ2VvbVZPc1tpXTtcblx0XHRcdHN1Yi51cGRhdGVJbmRpY2VzKGRhdGEuaW5kaWNlcyk7XG5cdFx0XHRzdWIudXBkYXRlUG9zaXRpb25zKGRhdGEudmVydGljZXMpO1xuXHRcdFx0c3ViLnVwZGF0ZVZlcnRleE5vcm1hbHMoZGF0YS5ub3JtYWxzKTtcblx0XHRcdHN1Yi51cGRhdGVWZXJ0ZXhUYW5nZW50cyhkYXRhLnRhbmdlbnRzKTtcblx0XHRcdHN1Yi51cGRhdGVVVnMoZGF0YS51dnMpO1xuXG5cdFx0XHRkZXN0R2VvbS5hZGRTdWJHZW9tZXRyeShzdWIpO1xuXG5cdFx0XHRpZiAodGhpcy5fa2VlcE1hdGVyaWFsICYmIHVzZVN1Yk1hdGVyaWFscylcblx0XHRcdFx0ZGVzdE1lc2guc3ViTWVzaGVzW3N1YklkeF0ubWF0ZXJpYWwgPSBkYXRhLm1hdGVyaWFsO1xuXHRcdH1cblxuXHRcdGlmICh0aGlzLl9rZWVwTWF0ZXJpYWwgJiYgIXVzZVN1Yk1hdGVyaWFscyAmJiB0aGlzLl9nZW9tVk9zLmxlbmd0aClcblx0XHRcdGRlc3RNZXNoLm1hdGVyaWFsID0gdGhpcy5fZ2VvbVZPc1swXS5tYXRlcmlhbDtcblxuXHRcdGlmIChkaXNwb3NlKSB7XG5cdFx0XHR2YXIgbTpNZXNoO1xuXHRcdFx0dmFyIGxlbjpudW1iZXIgPSB0aGlzLl90b0Rpc3Bvc2UubGVuZ3RoO1xuXHRcdFx0Zm9yICh2YXIgaTpudW1iZXI7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0XHRtID0gdGhpcy5fdG9EaXNwb3NlW2ldO1xuXHRcdFx0XHRtLmdlb21ldHJ5LmRpc3Bvc2UoKTtcblx0XHRcdFx0bS5kaXNwb3NlKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vZGlzcG9zZSBvZiB0aGUgb3JpZ2luYWwgcmVjZWl2ZXIgZ2VvbWV0cnlcblx0XHRcdG9sZEdlb20uZGlzcG9zZSgpO1xuXHRcdH1cblxuXHRcdHRoaXMuX3RvRGlzcG9zZSA9IG51bGw7XG5cdH1cblxuXHRwcml2YXRlIGNvbGxlY3QobWVzaDpNZXNoLCBkaXNwb3NlOmJvb2xlYW4pXG5cdHtcblx0XHRpZiAobWVzaC5nZW9tZXRyeSkge1xuXHRcdFx0dmFyIHN1YklkeDpudW1iZXIgLyp1aW50Ki87XG5cdFx0XHR2YXIgc3ViR2VvbWV0cmllczpBcnJheTxUcmlhbmdsZVN1Ykdlb21ldHJ5PiA9IDxBcnJheTxUcmlhbmdsZVN1Ykdlb21ldHJ5Pj4gbWVzaC5nZW9tZXRyeS5zdWJHZW9tZXRyaWVzO1xuXHRcdFx0dmFyIGNhbGM6bnVtYmVyIC8qdWludCovO1xuXHRcdFx0Zm9yIChzdWJJZHggPSAwOyBzdWJJZHggPCBzdWJHZW9tZXRyaWVzLmxlbmd0aDsgc3ViSWR4KyspIHtcblx0XHRcdFx0dmFyIGk6bnVtYmVyIC8qdWludCovO1xuXHRcdFx0XHR2YXIgbGVuOm51bWJlciAvKnVpbnQqLztcblx0XHRcdFx0dmFyIGlJZHg6bnVtYmVyIC8qdWludCovLCB2SWR4Om51bWJlciAvKnVpbnQqLywgbklkeDpudW1iZXIgLyp1aW50Ki8sIHRJZHg6bnVtYmVyIC8qdWludCovLCB1SWR4Om51bWJlciAvKnVpbnQqLztcblx0XHRcdFx0dmFyIGluZGV4T2Zmc2V0Om51bWJlciAvKnVpbnQqLztcblx0XHRcdFx0dmFyIHN1Ykdlb206VHJpYW5nbGVTdWJHZW9tZXRyeTtcblx0XHRcdFx0dmFyIHZvOkdlb21ldHJ5Vk87XG5cdFx0XHRcdHZhciB2ZXJ0aWNlczpBcnJheTxudW1iZXI+O1xuXHRcdFx0XHR2YXIgbm9ybWFsczpBcnJheTxudW1iZXI+O1xuXHRcdFx0XHR2YXIgdGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcblx0XHRcdFx0dmFyIHBkOkFycmF5PG51bWJlcj4sIG5kOkFycmF5PG51bWJlcj4sIHRkOkFycmF5PG51bWJlcj4sIHVkOkFycmF5PG51bWJlcj47XG5cblx0XHRcdFx0c3ViR2VvbSA9IHN1Ykdlb21ldHJpZXNbc3ViSWR4XTtcblx0XHRcdFx0cGQgPSBzdWJHZW9tLnBvc2l0aW9ucztcblx0XHRcdFx0bmQgPSBzdWJHZW9tLnZlcnRleE5vcm1hbHM7XG5cdFx0XHRcdHRkID0gc3ViR2VvbS52ZXJ0ZXhUYW5nZW50cztcblx0XHRcdFx0dWQgPSBzdWJHZW9tLnV2cztcblxuXHRcdFx0XHQvLyBHZXQgKG9yIGNyZWF0ZSkgYSBWTyBmb3IgdGhpcyBtYXRlcmlhbFxuXHRcdFx0XHR2byA9IHRoaXMuZ2V0U3ViR2VvbURhdGEobWVzaC5zdWJNZXNoZXNbc3ViSWR4XS5tYXRlcmlhbCB8fCBtZXNoLm1hdGVyaWFsKTtcblxuXHRcdFx0XHQvLyBWZXJ0aWNlcyBhbmQgbm9ybWFscyBhcmUgY29waWVkIHRvIHRlbXBvcmFyeSB2ZWN0b3JzLCB0byBiZSB0cmFuc2Zvcm1lZFxuXHRcdFx0XHQvLyBiZWZvcmUgY29uY2F0ZW5hdGVkIG9udG8gdGhvc2Ugb2YgdGhlIGRhdGEuIFRoaXMgaXMgdW5uZWNlc3NhcnkgaWYgbm9cblx0XHRcdFx0Ly8gdHJhbnNmb3JtYXRpb24gd2lsbCBiZSBwZXJmb3JtZWQsIGkuZS4gZm9yIG9iamVjdCBzcGFjZSBtZXJnaW5nLlxuXHRcdFx0XHR2ZXJ0aWNlcyA9ICh0aGlzLl9vYmplY3RTcGFjZSk/IHZvLnZlcnRpY2VzIDogbmV3IEFycmF5PG51bWJlcj4oKTtcblx0XHRcdFx0bm9ybWFscyA9ICh0aGlzLl9vYmplY3RTcGFjZSk/IHZvLm5vcm1hbHMgOiBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXHRcdFx0XHR0YW5nZW50cyA9ICh0aGlzLl9vYmplY3RTcGFjZSk/IHZvLnRhbmdlbnRzIDogbmV3IEFycmF5PG51bWJlcj4oKTtcblxuXHRcdFx0XHQvLyBDb3B5IG92ZXIgdmVydGV4IGF0dHJpYnV0ZXNcblx0XHRcdFx0dklkeCA9IHZlcnRpY2VzLmxlbmd0aDtcblx0XHRcdFx0bklkeCA9IG5vcm1hbHMubGVuZ3RoO1xuXHRcdFx0XHR0SWR4ID0gdGFuZ2VudHMubGVuZ3RoO1xuXHRcdFx0XHR1SWR4ID0gdm8udXZzLmxlbmd0aDtcblx0XHRcdFx0bGVuID0gc3ViR2VvbS5udW1WZXJ0aWNlcztcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0XHRcdFx0Y2FsYyA9IGkqMztcblxuXHRcdFx0XHRcdC8vIFBvc2l0aW9uXG5cdFx0XHRcdFx0dmVydGljZXNbdklkeCsrXSA9IHBkW2NhbGNdO1xuXHRcdFx0XHRcdHZlcnRpY2VzW3ZJZHgrK10gPSBwZFtjYWxjICsgMV07XG5cdFx0XHRcdFx0dmVydGljZXNbdklkeCsrXSA9IHBkW2NhbGMgKyAyXTtcblxuXHRcdFx0XHRcdC8vIE5vcm1hbFxuXHRcdFx0XHRcdG5vcm1hbHNbbklkeCsrXSA9IG5kW2NhbGNdO1xuXHRcdFx0XHRcdG5vcm1hbHNbbklkeCsrXSA9IG5kW2NhbGMgKyAxXTtcblx0XHRcdFx0XHRub3JtYWxzW25JZHgrK10gPSBuZFtjYWxjICsgMl07XG5cblx0XHRcdFx0XHQvLyBUYW5nZW50XG5cdFx0XHRcdFx0dGFuZ2VudHNbdElkeCsrXSA9IHRkW2NhbGNdO1xuXHRcdFx0XHRcdHRhbmdlbnRzW3RJZHgrK10gPSB0ZFtjYWxjICsgMV07XG5cdFx0XHRcdFx0dGFuZ2VudHNbdElkeCsrXSA9IHRkW2NhbGMgKyAyXTtcblxuXHRcdFx0XHRcdC8vIFVWXG5cdFx0XHRcdFx0dm8udXZzW3VJZHgrK10gPSB1ZFtpKjJdO1xuXHRcdFx0XHRcdHZvLnV2c1t1SWR4KytdID0gdWRbaSoyICsgMV07XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBDb3B5IG92ZXIgdHJpYW5nbGUgaW5kaWNlc1xuXHRcdFx0XHRpbmRleE9mZnNldCA9ICghdGhpcy5fb2JqZWN0U3BhY2UpPyB2by52ZXJ0aWNlcy5sZW5ndGgvMyA6MDtcblx0XHRcdFx0aUlkeCA9IHZvLmluZGljZXMubGVuZ3RoO1xuXHRcdFx0XHRsZW4gPSBzdWJHZW9tLm51bVRyaWFuZ2xlcztcblx0XHRcdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0XHRcdFx0Y2FsYyA9IGkqMztcblx0XHRcdFx0XHR2by5pbmRpY2VzW2lJZHgrK10gPSBzdWJHZW9tLmluZGljZXNbY2FsY10gKyBpbmRleE9mZnNldDtcblx0XHRcdFx0XHR2by5pbmRpY2VzW2lJZHgrK10gPSBzdWJHZW9tLmluZGljZXNbY2FsYyArIDFdICsgaW5kZXhPZmZzZXQ7XG5cdFx0XHRcdFx0dm8uaW5kaWNlc1tpSWR4KytdID0gc3ViR2VvbS5pbmRpY2VzW2NhbGMgKyAyXSArIGluZGV4T2Zmc2V0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCF0aGlzLl9vYmplY3RTcGFjZSkge1xuXHRcdFx0XHRcdG1lc2guc2NlbmVUcmFuc2Zvcm0udHJhbnNmb3JtVmVjdG9ycyh2ZXJ0aWNlcywgdmVydGljZXMpO1xuXHRcdFx0XHRcdE1hdHJpeDNEVXRpbHMuZGVsdGFUcmFuc2Zvcm1WZWN0b3JzKG1lc2guc2NlbmVUcmFuc2Zvcm0sIG5vcm1hbHMsIG5vcm1hbHMpO1xuXHRcdFx0XHRcdE1hdHJpeDNEVXRpbHMuZGVsdGFUcmFuc2Zvcm1WZWN0b3JzKG1lc2guc2NlbmVUcmFuc2Zvcm0sIHRhbmdlbnRzLCB0YW5nZW50cyk7XG5cblx0XHRcdFx0XHQvLyBDb3B5IHZlcnRleCBkYXRhIGZyb20gdGVtcG9yYXJ5ICh0cmFuc2Zvcm1lZCkgdmVjdG9yc1xuXHRcdFx0XHRcdHZJZHggPSB2by52ZXJ0aWNlcy5sZW5ndGg7XG5cdFx0XHRcdFx0bklkeCA9IHZvLm5vcm1hbHMubGVuZ3RoO1xuXHRcdFx0XHRcdHRJZHggPSB2by50YW5nZW50cy5sZW5ndGg7XG5cdFx0XHRcdFx0bGVuID0gdmVydGljZXMubGVuZ3RoO1xuXHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0XHRcdFx0dm8udmVydGljZXNbdklkeCsrXSA9IHZlcnRpY2VzW2ldO1xuXHRcdFx0XHRcdFx0dm8ubm9ybWFsc1tuSWR4KytdID0gbm9ybWFsc1tpXTtcblx0XHRcdFx0XHRcdHZvLnRhbmdlbnRzW3RJZHgrK10gPSB0YW5nZW50c1tpXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKGRpc3Bvc2UpXG5cdFx0XHRcdHRoaXMuX3RvRGlzcG9zZS5wdXNoKG1lc2gpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgZ2V0U3ViR2VvbURhdGEobWF0ZXJpYWw6TWF0ZXJpYWxCYXNlKTpHZW9tZXRyeVZPXG5cdHtcblx0XHR2YXIgZGF0YTpHZW9tZXRyeVZPO1xuXG5cdFx0aWYgKHRoaXMuX2tlZXBNYXRlcmlhbCkge1xuXHRcdFx0dmFyIGk6bnVtYmVyIC8qdWludCovO1xuXHRcdFx0dmFyIGxlbjpudW1iZXIgLyp1aW50Ki87XG5cblx0XHRcdGxlbiA9IHRoaXMuX2dlb21WT3MubGVuZ3RoO1xuXHRcdFx0Zm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0XHRcdGlmICh0aGlzLl9nZW9tVk9zW2ldLm1hdGVyaWFsID09IG1hdGVyaWFsKSB7XG5cdFx0XHRcdFx0ZGF0YSA9IHRoaXMuX2dlb21WT3NbaV07XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKHRoaXMuX2dlb21WT3MubGVuZ3RoKSB7XG5cdFx0XHQvLyBJZiBtYXRlcmlhbHMgYXJlIG5vdCB0byBiZSBrZXB0LCBhbGwgZGF0YSBjYW4gYmVcblx0XHRcdC8vIHB1dCBpbnRvIGEgc2luZ2xlIFZPLCBzbyByZXR1cm4gdGhhdCBvbmUuXG5cdFx0XHRkYXRhID0gdGhpcy5fZ2VvbVZPc1swXTtcblx0XHR9XG5cblx0XHQvLyBObyBkYXRhIChmb3IgdGhpcyBtYXRlcmlhbCkgZm91bmQsIGNyZWF0ZSBuZXcuXG5cdFx0aWYgKCFkYXRhKSB7XG5cdFx0XHRkYXRhID0gbmV3IEdlb21ldHJ5Vk8oKTtcblx0XHRcdGRhdGEudmVydGljZXMgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXHRcdFx0ZGF0YS5ub3JtYWxzID0gbmV3IEFycmF5PG51bWJlcj4oKTtcblx0XHRcdGRhdGEudGFuZ2VudHMgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXHRcdFx0ZGF0YS51dnMgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xuXHRcdFx0ZGF0YS5pbmRpY2VzID0gbmV3IEFycmF5PG51bWJlciAvKnVpbnQqLz4oKTtcblx0XHRcdGRhdGEubWF0ZXJpYWwgPSBtYXRlcmlhbDtcblxuXHRcdFx0dGhpcy5fZ2VvbVZPcy5wdXNoKGRhdGEpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9XG5cblx0cHJpdmF0ZSBwYXJzZUNvbnRhaW5lcihyZWNlaXZlcjpNZXNoLCBvYmplY3Q6RGlzcGxheU9iamVjdENvbnRhaW5lcilcblx0e1xuXHRcdHZhciBjaGlsZDpEaXNwbGF5T2JqZWN0Q29udGFpbmVyO1xuXHRcdHZhciBpOm51bWJlciAvKnVpbnQqLztcblxuXHRcdGlmIChvYmplY3QgaW5zdGFuY2VvZiBNZXNoICYmIG9iamVjdCAhPSAoPERpc3BsYXlPYmplY3RDb250YWluZXI+IHJlY2VpdmVyKSlcblx0XHRcdHRoaXMuY29sbGVjdCg8TWVzaD4gb2JqZWN0LCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XG5cblx0XHRmb3IgKGkgPSAwOyBpIDwgb2JqZWN0Lm51bUNoaWxkcmVuOyArK2kpIHtcblx0XHRcdGNoaWxkID0gPERpc3BsYXlPYmplY3RDb250YWluZXI+IG9iamVjdC5nZXRDaGlsZEF0KGkpO1xuXHRcdFx0dGhpcy5wYXJzZUNvbnRhaW5lcihyZWNlaXZlciwgY2hpbGQpO1xuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgPSBNZXJnZTtcblxuY2xhc3MgR2VvbWV0cnlWT1xue1xuXHRwdWJsaWMgdXZzOkFycmF5PG51bWJlcj47XG5cdHB1YmxpYyB2ZXJ0aWNlczpBcnJheTxudW1iZXI+O1xuXHRwdWJsaWMgbm9ybWFsczpBcnJheTxudW1iZXI+O1xuXHRwdWJsaWMgdGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcblx0cHVibGljIGluZGljZXM6QXJyYXk8bnVtYmVyIC8qdWludCovPjtcblx0cHVibGljIG1hdGVyaWFsOk1hdGVyaWFsQmFzZTtcbn1cbiJdfQ==