var Matrix3DUtils = require("awayjs-core/lib/geom/Matrix3DUtils");
var Geometry = require("awayjs-display/lib/base/Geometry");
var TriangleSubGeometry = require("awayjs-display/lib/base/TriangleSubGeometry");
var Mesh = require("awayjs-display/lib/entities/Mesh");
/**
 *  Class Merge merges two or more static meshes into one.<code>Merge</code>
 */
var Merge = (function () {
    /**
     * @param    keepMaterial    [optional]    Determines if the merged object uses the recevier mesh material information or keeps its source material(s). Defaults to false.
     * If false and receiver object has multiple materials, the last material found in receiver submeshes is applied to the merged submesh(es).
     * @param    disposeSources  [optional]    Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.
     * If true, only receiver geometry and resulting mesh are kept in  memory.
     * @param    objectSpace     [optional]    Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.
     */
    function Merge(keepMaterial, disposeSources, objectSpace) {
        if (keepMaterial === void 0) { keepMaterial = false; }
        if (disposeSources === void 0) { disposeSources = false; }
        if (objectSpace === void 0) { objectSpace = false; }
        this._keepMaterial = keepMaterial;
        this._disposeSources = disposeSources;
        this._objectSpace = objectSpace;
    }
    Object.defineProperty(Merge.prototype, "disposeSources", {
        get: function () {
            return this._disposeSources;
        },
        /**
         * Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.
         */
        set: function (b) {
            this._disposeSources = b;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Merge.prototype, "keepMaterial", {
        get: function () {
            return this._keepMaterial;
        },
        /**
         * Determines if the material source(s) used for the merging are disposed. Defaults to false.
         */
        set: function (b) {
            this._keepMaterial = b;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Merge.prototype, "objectSpace", {
        get: function () {
            return this._objectSpace;
        },
        /**
         * Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.
         */
        set: function (b) {
            this._objectSpace = b;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Merges all the children of a container into a single Mesh. If no Mesh object is found, method returns the receiver without modification.
     *
     * @param    receiver           The Mesh to receive the merged contents of the container.
     * @param    objectContainer    The DisplayObjectContainer holding the meshes to be mergd.
     *
     * @return The merged Mesh instance.
     */
    Merge.prototype.applyToContainer = function (receiver, objectContainer) {
        this.reset();
        //collect container meshes
        this.parseContainer(receiver, objectContainer);
        //collect receiver
        this.collect(receiver, false);
        //merge to receiver
        this.merge(receiver, this._disposeSources);
    };
    /**
     * Merges all the meshes found in the Array&lt;Mesh&gt; into a single Mesh.
     *
     * @param    receiver    The Mesh to receive the merged contents of the meshes.
     * @param    meshes      A series of Meshes to be merged with the reciever mesh.
     */
    Merge.prototype.applyToMeshes = function (receiver, meshes) {
        this.reset();
        if (!meshes.length)
            return;
        for (var i = 0; i < meshes.length; i++)
            if (meshes[i] != receiver)
                this.collect(meshes[i], this._disposeSources);
        //collect receiver
        this.collect(receiver, false);
        //merge to receiver
        this.merge(receiver, this._disposeSources);
    };
    /**
     *  Merges 2 meshes into one. It is recommand to use apply when 2 meshes are to be merged. If more need to be merged, use either applyToMeshes or applyToContainer methods.
     *
     * @param    receiver    The Mesh to receive the merged contents of both meshes.
     * @param    mesh        The Mesh to be merged with the receiver mesh
     */
    Merge.prototype.apply = function (receiver, mesh) {
        this.reset();
        //collect mesh
        this.collect(mesh, this._disposeSources);
        //collect receiver
        this.collect(receiver, false);
        //merge to receiver
        this.merge(receiver, this._disposeSources);
    };
    Merge.prototype.reset = function () {
        this._toDispose = new Array();
        this._geomVOs = new Array();
    };
    Merge.prototype.merge = function (destMesh, dispose) {
        var i /*uint*/;
        var subIdx /*uint*/;
        var oldGeom;
        var destGeom;
        var useSubMaterials;
        oldGeom = destMesh.geometry;
        destGeom = destMesh.geometry = new Geometry();
        subIdx = destMesh.subMeshes.length;
        // Only apply materials directly to sub-meshes if necessary,
        // i.e. if there is more than one material available.
        useSubMaterials = (this._geomVOs.length > 1);
        for (i = 0; i < this._geomVOs.length; i++) {
            var s /*uint*/;
            var data;
            var sub = new TriangleSubGeometry(true);
            sub.autoDeriveNormals = false;
            sub.autoDeriveTangents = false;
            data = this._geomVOs[i];
            sub.updateIndices(data.indices);
            sub.updatePositions(data.vertices);
            sub.updateVertexNormals(data.normals);
            sub.updateVertexTangents(data.tangents);
            sub.updateUVs(data.uvs);
            destGeom.addSubGeometry(sub);
            if (this._keepMaterial && useSubMaterials)
                destMesh.subMeshes[subIdx].material = data.material;
        }
        if (this._keepMaterial && !useSubMaterials && this._geomVOs.length)
            destMesh.material = this._geomVOs[0].material;
        if (dispose) {
            var m;
            var len = this._toDispose.length;
            for (var i; i < len; i++) {
                m = this._toDispose[i];
                m.geometry.dispose();
                m.dispose();
            }
            //dispose of the original receiver geometry
            oldGeom.dispose();
        }
        this._toDispose = null;
    };
    Merge.prototype.collect = function (mesh, dispose) {
        if (mesh.geometry) {
            var subIdx /*uint*/;
            var subGeometries = mesh.geometry.subGeometries;
            var calc /*uint*/;
            for (subIdx = 0; subIdx < subGeometries.length; subIdx++) {
                var i /*uint*/;
                var len /*uint*/;
                var iIdx /*uint*/, vIdx /*uint*/, nIdx /*uint*/, tIdx /*uint*/, uIdx /*uint*/;
                var indexOffset /*uint*/;
                var subGeom;
                var vo;
                var vertices;
                var normals;
                var tangents;
                var pd, nd, td, ud;
                subGeom = subGeometries[subIdx];
                pd = subGeom.positions;
                nd = subGeom.vertexNormals;
                td = subGeom.vertexTangents;
                ud = subGeom.uvs;
                // Get (or create) a VO for this material
                vo = this.getSubGeomData(mesh.subMeshes[subIdx].material || mesh.material);
                // Vertices and normals are copied to temporary vectors, to be transformed
                // before concatenated onto those of the data. This is unnecessary if no
                // transformation will be performed, i.e. for object space merging.
                vertices = (this._objectSpace) ? vo.vertices : new Array();
                normals = (this._objectSpace) ? vo.normals : new Array();
                tangents = (this._objectSpace) ? vo.tangents : new Array();
                // Copy over vertex attributes
                vIdx = vertices.length;
                nIdx = normals.length;
                tIdx = tangents.length;
                uIdx = vo.uvs.length;
                len = subGeom.numVertices;
                for (i = 0; i < len; i++) {
                    calc = i * 3;
                    // Position
                    vertices[vIdx++] = pd[calc];
                    vertices[vIdx++] = pd[calc + 1];
                    vertices[vIdx++] = pd[calc + 2];
                    // Normal
                    normals[nIdx++] = nd[calc];
                    normals[nIdx++] = nd[calc + 1];
                    normals[nIdx++] = nd[calc + 2];
                    // Tangent
                    tangents[tIdx++] = td[calc];
                    tangents[tIdx++] = td[calc + 1];
                    tangents[tIdx++] = td[calc + 2];
                    // UV
                    vo.uvs[uIdx++] = ud[i * 2];
                    vo.uvs[uIdx++] = ud[i * 2 + 1];
                }
                // Copy over triangle indices
                indexOffset = (!this._objectSpace) ? vo.vertices.length / 3 : 0;
                iIdx = vo.indices.length;
                len = subGeom.numTriangles;
                for (i = 0; i < len; i++) {
                    calc = i * 3;
                    vo.indices[iIdx++] = subGeom.indices[calc] + indexOffset;
                    vo.indices[iIdx++] = subGeom.indices[calc + 1] + indexOffset;
                    vo.indices[iIdx++] = subGeom.indices[calc + 2] + indexOffset;
                }
                if (!this._objectSpace) {
                    mesh.sceneTransform.transformVectors(vertices, vertices);
                    Matrix3DUtils.deltaTransformVectors(mesh.sceneTransform, normals, normals);
                    Matrix3DUtils.deltaTransformVectors(mesh.sceneTransform, tangents, tangents);
                    // Copy vertex data from temporary (transformed) vectors
                    vIdx = vo.vertices.length;
                    nIdx = vo.normals.length;
                    tIdx = vo.tangents.length;
                    len = vertices.length;
                    for (i = 0; i < len; i++) {
                        vo.vertices[vIdx++] = vertices[i];
                        vo.normals[nIdx++] = normals[i];
                        vo.tangents[tIdx++] = tangents[i];
                    }
                }
            }
            if (dispose)
                this._toDispose.push(mesh);
        }
    };
    Merge.prototype.getSubGeomData = function (material) {
        var data;
        if (this._keepMaterial) {
            var i /*uint*/;
            var len /*uint*/;
            len = this._geomVOs.length;
            for (i = 0; i < len; i++) {
                if (this._geomVOs[i].material == material) {
                    data = this._geomVOs[i];
                    break;
                }
            }
        }
        else if (this._geomVOs.length) {
            // If materials are not to be kept, all data can be
            // put into a single VO, so return that one.
            data = this._geomVOs[0];
        }
        // No data (for this material) found, create new.
        if (!data) {
            data = new GeometryVO();
            data.vertices = new Array();
            data.normals = new Array();
            data.tangents = new Array();
            data.uvs = new Array();
            data.indices = new Array();
            data.material = material;
            this._geomVOs.push(data);
        }
        return data;
    };
    Merge.prototype.parseContainer = function (receiver, object) {
        var child;
        var i /*uint*/;
        if (object instanceof Mesh && object != receiver)
            this.collect(object, this._disposeSources);
        for (i = 0; i < object.numChildren; ++i) {
            child = object.getChildAt(i);
            this.parseContainer(receiver, child);
        }
    };
    return Merge;
})();
var GeometryVO = (function () {
    function GeometryVO() {
    }
    return GeometryVO;
})();
module.exports = Merge;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1yZW5kZXJlcmdsL2xpYi90b29scy9jb21tYW5kcy9NZXJnZS50cyJdLCJuYW1lcyI6WyJNZXJnZSIsIk1lcmdlLmNvbnN0cnVjdG9yIiwiTWVyZ2UuZGlzcG9zZVNvdXJjZXMiLCJNZXJnZS5rZWVwTWF0ZXJpYWwiLCJNZXJnZS5vYmplY3RTcGFjZSIsIk1lcmdlLmFwcGx5VG9Db250YWluZXIiLCJNZXJnZS5hcHBseVRvTWVzaGVzIiwiTWVyZ2UuYXBwbHkiLCJNZXJnZS5yZXNldCIsIk1lcmdlLm1lcmdlIiwiTWVyZ2UuY29sbGVjdCIsIk1lcmdlLmdldFN1Ykdlb21EYXRhIiwiTWVyZ2UucGFyc2VDb250YWluZXIiLCJHZW9tZXRyeVZPIiwiR2VvbWV0cnlWTy5jb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxhQUFhLFdBQWUsb0NBQW9DLENBQUMsQ0FBQztBQUd6RSxJQUFPLFFBQVEsV0FBaUIsa0NBQWtDLENBQUMsQ0FBQztBQUNwRSxJQUFPLG1CQUFtQixXQUFjLDZDQUE2QyxDQUFDLENBQUM7QUFDdkYsSUFBTyxJQUFJLFdBQWtCLGtDQUFrQyxDQUFDLENBQUM7QUFHakUsQUFHQTs7R0FERztJQUNHLEtBQUs7SUFVVkE7Ozs7OztPQU1HQTtJQUNIQSxTQWpCS0EsS0FBS0EsQ0FpQkVBLFlBQTRCQSxFQUFFQSxjQUE4QkEsRUFBRUEsV0FBMkJBO1FBQXpGQyw0QkFBNEJBLEdBQTVCQSxvQkFBNEJBO1FBQUVBLDhCQUE4QkEsR0FBOUJBLHNCQUE4QkE7UUFBRUEsMkJBQTJCQSxHQUEzQkEsbUJBQTJCQTtRQUVwR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsWUFBWUEsQ0FBQ0E7UUFDbENBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLGNBQWNBLENBQUNBO1FBQ3RDQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSxXQUFXQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFLREQsc0JBQVdBLGlDQUFjQTthQUt6QkE7WUFFQ0UsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0E7UUFDN0JBLENBQUNBO1FBWERGOztXQUVHQTthQUNIQSxVQUEwQkEsQ0FBU0E7WUFFbENFLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLENBQUNBLENBQUNBO1FBQzFCQSxDQUFDQTs7O09BQUFGO0lBVURBLHNCQUFXQSwrQkFBWUE7YUFLdkJBO1lBRUNHLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBO1FBQzNCQSxDQUFDQTtRQVhESDs7V0FFR0E7YUFDSEEsVUFBd0JBLENBQVNBO1lBRWhDRyxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN4QkEsQ0FBQ0E7OztPQUFBSDtJQVVEQSxzQkFBV0EsOEJBQVdBO2FBS3RCQTtZQUVDSSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7UUFYREo7O1dBRUdBO2FBQ0hBLFVBQXVCQSxDQUFTQTtZQUUvQkksSUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLENBQUNBOzs7T0FBQUo7SUFPREE7Ozs7Ozs7T0FPR0E7SUFDSUEsZ0NBQWdCQSxHQUF2QkEsVUFBd0JBLFFBQWFBLEVBQUVBLGVBQXNDQTtRQUU1RUssSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFFYkEsQUFDQUEsMEJBRDBCQTtRQUMxQkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsUUFBUUEsRUFBRUEsZUFBZUEsQ0FBQ0EsQ0FBQ0E7UUFFL0NBLEFBQ0FBLGtCQURrQkE7UUFDbEJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBRTlCQSxBQUNBQSxtQkFEbUJBO1FBQ25CQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxFQUFFQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFFREw7Ozs7O09BS0dBO0lBQ0lBLDZCQUFhQSxHQUFwQkEsVUFBcUJBLFFBQWFBLEVBQUVBLE1BQWtCQTtRQUVyRE0sSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFFYkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDbEJBLE1BQU1BLENBQUNBO1FBR1JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQW1CQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQTtZQUNyREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsUUFBUUEsQ0FBQ0E7Z0JBQ3pCQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQTtRQUVoREEsQUFDQUEsa0JBRGtCQTtRQUNsQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFFOUJBLEFBQ0FBLG1CQURtQkE7UUFDbkJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLFFBQVFBLEVBQUVBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBO0lBQzVDQSxDQUFDQTtJQUVETjs7Ozs7T0FLR0E7SUFDSUEscUJBQUtBLEdBQVpBLFVBQWFBLFFBQWFBLEVBQUVBLElBQVNBO1FBRXBDTyxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUViQSxBQUNBQSxjQURjQTtRQUNkQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQTtRQUV6Q0EsQUFDQUEsa0JBRGtCQTtRQUNsQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFFOUJBLEFBQ0FBLG1CQURtQkE7UUFDbkJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLFFBQVFBLEVBQUVBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBO0lBQzVDQSxDQUFDQTtJQUVPUCxxQkFBS0EsR0FBYkE7UUFFQ1EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBSUEsSUFBSUEsS0FBS0EsRUFBUUEsQ0FBQ0E7UUFDckNBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLEtBQUtBLEVBQWNBLENBQUNBO0lBQ3pDQSxDQUFDQTtJQUVPUixxQkFBS0EsR0FBYkEsVUFBY0EsUUFBYUEsRUFBRUEsT0FBZUE7UUFFM0NTLElBQUlBLENBQUNBLENBQVFBLFFBQURBLEFBQVNBLENBQUNBO1FBQ3RCQSxJQUFJQSxNQUFNQSxDQUFRQSxRQUFEQSxBQUFTQSxDQUFDQTtRQUMzQkEsSUFBSUEsT0FBZ0JBLENBQUNBO1FBQ3JCQSxJQUFJQSxRQUFpQkEsQ0FBQ0E7UUFDdEJBLElBQUlBLGVBQXVCQSxDQUFDQTtRQUU1QkEsT0FBT0EsR0FBR0EsUUFBUUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFDNUJBLFFBQVFBLEdBQUdBLFFBQVFBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLFFBQVFBLEVBQUVBLENBQUNBO1FBQzlDQSxNQUFNQSxHQUFHQSxRQUFRQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUVuQ0EsQUFFQUEsNERBRjREQTtRQUM1REEscURBQXFEQTtRQUNyREEsZUFBZUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFN0NBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzNDQSxJQUFJQSxDQUFDQSxDQUFRQSxRQUFEQSxBQUFTQSxDQUFDQTtZQUN0QkEsSUFBSUEsSUFBZUEsQ0FBQ0E7WUFDcEJBLElBQUlBLEdBQUdBLEdBQXVCQSxJQUFJQSxtQkFBbUJBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQzVEQSxHQUFHQSxDQUFDQSxpQkFBaUJBLEdBQUdBLEtBQUtBLENBQUNBO1lBQzlCQSxHQUFHQSxDQUFDQSxrQkFBa0JBLEdBQUdBLEtBQUtBLENBQUNBO1lBRS9CQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4QkEsR0FBR0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7WUFDaENBLEdBQUdBLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1lBQ25DQSxHQUFHQSxDQUFDQSxtQkFBbUJBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1lBQ3RDQSxHQUFHQSxDQUFDQSxvQkFBb0JBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1lBQ3hDQSxHQUFHQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUV4QkEsUUFBUUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFFN0JBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLElBQUlBLGVBQWVBLENBQUNBO2dCQUN6Q0EsUUFBUUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0E7UUFDdERBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLElBQUlBLENBQUNBLGVBQWVBLElBQUlBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBO1lBQ2xFQSxRQUFRQSxDQUFDQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUUvQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDYkEsSUFBSUEsQ0FBTUEsQ0FBQ0E7WUFDWEEsSUFBSUEsR0FBR0EsR0FBVUEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDeENBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQVFBLEVBQUVBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO2dCQUNqQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3ZCQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtnQkFDckJBLENBQUNBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1lBQ2JBLENBQUNBO1lBRURBLEFBQ0FBLDJDQUQyQ0E7WUFDM0NBLE9BQU9BLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1FBQ25CQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUN4QkEsQ0FBQ0E7SUFFT1QsdUJBQU9BLEdBQWZBLFVBQWdCQSxJQUFTQSxFQUFFQSxPQUFlQTtRQUV6Q1UsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDbkJBLElBQUlBLE1BQU1BLENBQVFBLFFBQURBLEFBQVNBLENBQUNBO1lBQzNCQSxJQUFJQSxhQUFhQSxHQUEyREEsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7WUFDeEdBLElBQUlBLElBQUlBLENBQVFBLFFBQURBLEFBQVNBLENBQUNBO1lBQ3pCQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxFQUFFQSxNQUFNQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxFQUFFQSxNQUFNQSxFQUFFQSxFQUFFQSxDQUFDQTtnQkFDMURBLElBQUlBLENBQUNBLENBQVFBLFFBQURBLEFBQVNBLENBQUNBO2dCQUN0QkEsSUFBSUEsR0FBR0EsQ0FBUUEsUUFBREEsQUFBU0EsQ0FBQ0E7Z0JBQ3hCQSxJQUFJQSxJQUFJQSxDQUFRQSxRQUFEQSxBQUFTQSxFQUFFQSxJQUFJQSxDQUFRQSxRQUFEQSxBQUFTQSxFQUFFQSxJQUFJQSxDQUFRQSxRQUFEQSxBQUFTQSxFQUFFQSxJQUFJQSxDQUFRQSxRQUFEQSxBQUFTQSxFQUFFQSxJQUFJQSxDQUFRQSxRQUFEQSxBQUFTQSxDQUFDQTtnQkFDakhBLElBQUlBLFdBQVdBLENBQVFBLFFBQURBLEFBQVNBLENBQUNBO2dCQUNoQ0EsSUFBSUEsT0FBMkJBLENBQUNBO2dCQUNoQ0EsSUFBSUEsRUFBYUEsQ0FBQ0E7Z0JBQ2xCQSxJQUFJQSxRQUFzQkEsQ0FBQ0E7Z0JBQzNCQSxJQUFJQSxPQUFxQkEsQ0FBQ0E7Z0JBQzFCQSxJQUFJQSxRQUFzQkEsQ0FBQ0E7Z0JBQzNCQSxJQUFJQSxFQUFnQkEsRUFBRUEsRUFBZ0JBLEVBQUVBLEVBQWdCQSxFQUFFQSxFQUFnQkEsQ0FBQ0E7Z0JBRTNFQSxPQUFPQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtnQkFDaENBLEVBQUVBLEdBQUdBLE9BQU9BLENBQUNBLFNBQVNBLENBQUNBO2dCQUN2QkEsRUFBRUEsR0FBR0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0E7Z0JBQzNCQSxFQUFFQSxHQUFHQSxPQUFPQSxDQUFDQSxjQUFjQSxDQUFDQTtnQkFDNUJBLEVBQUVBLEdBQUdBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBO2dCQUVqQkEsQUFDQUEseUNBRHlDQTtnQkFDekNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLFFBQVFBLElBQUlBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO2dCQUUzRUEsQUFHQUEsMEVBSDBFQTtnQkFDMUVBLHdFQUF3RUE7Z0JBQ3hFQSxtRUFBbUVBO2dCQUNuRUEsUUFBUUEsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsR0FBRUEsRUFBRUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsS0FBS0EsRUFBVUEsQ0FBQ0E7Z0JBQ2xFQSxPQUFPQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxHQUFFQSxFQUFFQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFVQSxDQUFDQTtnQkFDaEVBLFFBQVFBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEdBQUVBLEVBQUVBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLEtBQUtBLEVBQVVBLENBQUNBO2dCQUVsRUEsQUFDQUEsOEJBRDhCQTtnQkFDOUJBLElBQUlBLEdBQUdBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBO2dCQUN2QkEsSUFBSUEsR0FBR0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7Z0JBQ3RCQSxJQUFJQSxHQUFHQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQTtnQkFDdkJBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBO2dCQUNyQkEsR0FBR0EsR0FBR0EsT0FBT0EsQ0FBQ0EsV0FBV0EsQ0FBQ0E7Z0JBQzFCQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtvQkFDMUJBLElBQUlBLEdBQUdBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBO29CQUVYQSxBQUNBQSxXQURXQTtvQkFDWEEsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7b0JBQzVCQSxRQUFRQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDaENBLFFBQVFBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO29CQUVoQ0EsQUFDQUEsU0FEU0E7b0JBQ1RBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUMzQkEsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQy9CQSxPQUFPQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFFL0JBLEFBQ0FBLFVBRFVBO29CQUNWQSxRQUFRQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtvQkFDNUJBLFFBQVFBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO29CQUNoQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBRWhDQSxBQUNBQSxLQURLQTtvQkFDTEEsRUFBRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3pCQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDOUJBLENBQUNBO2dCQUVEQSxBQUNBQSw2QkFENkJBO2dCQUM3QkEsV0FBV0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsR0FBRUEsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBQ0EsQ0FBQ0EsR0FBRUEsQ0FBQ0EsQ0FBQ0E7Z0JBQzVEQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQTtnQkFDekJBLEdBQUdBLEdBQUdBLE9BQU9BLENBQUNBLFlBQVlBLENBQUNBO2dCQUMzQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7b0JBQzFCQSxJQUFJQSxHQUFHQSxDQUFDQSxHQUFDQSxDQUFDQSxDQUFDQTtvQkFDWEEsRUFBRUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsT0FBT0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsV0FBV0EsQ0FBQ0E7b0JBQ3pEQSxFQUFFQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQTtvQkFDN0RBLEVBQUVBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLE9BQU9BLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFdBQVdBLENBQUNBO2dCQUM5REEsQ0FBQ0E7Z0JBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBO29CQUN4QkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxRQUFRQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtvQkFDekRBLGFBQWFBLENBQUNBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsY0FBY0EsRUFBRUEsT0FBT0EsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7b0JBQzNFQSxhQUFhQSxDQUFDQSxxQkFBcUJBLENBQUNBLElBQUlBLENBQUNBLGNBQWNBLEVBQUVBLFFBQVFBLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO29CQUU3RUEsQUFDQUEsd0RBRHdEQTtvQkFDeERBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBO29CQUMxQkEsSUFBSUEsR0FBR0EsRUFBRUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7b0JBQ3pCQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQTtvQkFDMUJBLEdBQUdBLEdBQUdBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBO29CQUN0QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7d0JBQzFCQSxFQUFFQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxHQUFHQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDbENBLEVBQUVBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLEdBQUdBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO3dCQUNoQ0EsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsR0FBR0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ25DQSxDQUFDQTtnQkFDRkEsQ0FBQ0E7WUFDRkEsQ0FBQ0E7WUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0E7Z0JBQ1hBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzdCQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUVPViw4QkFBY0EsR0FBdEJBLFVBQXVCQSxRQUFxQkE7UUFFM0NXLElBQUlBLElBQWVBLENBQUNBO1FBRXBCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4QkEsSUFBSUEsQ0FBQ0EsQ0FBUUEsUUFBREEsQUFBU0EsQ0FBQ0E7WUFDdEJBLElBQUlBLEdBQUdBLENBQVFBLFFBQURBLEFBQVNBLENBQUNBO1lBRXhCQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUMzQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsR0FBR0EsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7Z0JBQzFCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxRQUFRQSxJQUFJQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDM0NBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO29CQUN4QkEsS0FBS0EsQ0FBQ0E7Z0JBQ1BBLENBQUNBO1lBQ0ZBLENBQUNBO1FBQ0ZBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ2pDQSxBQUVBQSxtREFGbURBO1lBQ25EQSw0Q0FBNENBO1lBQzVDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6QkEsQ0FBQ0E7UUFFREEsQUFDQUEsaURBRGlEQTtRQUNqREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDWEEsSUFBSUEsR0FBR0EsSUFBSUEsVUFBVUEsRUFBRUEsQ0FBQ0E7WUFDeEJBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLEtBQUtBLEVBQVVBLENBQUNBO1lBQ3BDQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFVQSxDQUFDQTtZQUNuQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsS0FBS0EsRUFBVUEsQ0FBQ0E7WUFDcENBLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLElBQUlBLEtBQUtBLEVBQVVBLENBQUNBO1lBQy9CQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxLQUFLQSxFQUFtQkEsQ0FBQ0E7WUFDNUNBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLFFBQVFBLENBQUNBO1lBRXpCQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUMxQkEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDYkEsQ0FBQ0E7SUFFT1gsOEJBQWNBLEdBQXRCQSxVQUF1QkEsUUFBYUEsRUFBRUEsTUFBNkJBO1FBRWxFWSxJQUFJQSxLQUE0QkEsQ0FBQ0E7UUFDakNBLElBQUlBLENBQUNBLENBQVFBLFFBQURBLEFBQVNBLENBQUNBO1FBRXRCQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxZQUFZQSxJQUFJQSxJQUFJQSxNQUFNQSxJQUE4QkEsUUFBU0EsQ0FBQ0E7WUFDM0VBLElBQUlBLENBQUNBLE9BQU9BLENBQVFBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLENBQUNBO1FBRW5EQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxXQUFXQSxFQUFFQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtZQUN6Q0EsS0FBS0EsR0FBNEJBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3REQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxRQUFRQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUN0Q0EsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFDRlosWUFBQ0E7QUFBREEsQ0FsVkEsQUFrVkNBLElBQUE7QUFJRCxJQUFNLFVBQVU7SUFBaEJhLFNBQU1BLFVBQVVBO0lBUWhCQyxDQUFDQTtJQUFERCxpQkFBQ0E7QUFBREEsQ0FSQSxBQVFDQSxJQUFBO0FBVkQsaUJBQVMsS0FBSyxDQUFDIiwiZmlsZSI6InRvb2xzL2NvbW1hbmRzL01lcmdlLmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBNYXRyaXgzRFV0aWxzXHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9nZW9tL01hdHJpeDNEVXRpbHNcIik7XHJcblxyXG5pbXBvcnQgRGlzcGxheU9iamVjdENvbnRhaW5lclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL0Rpc3BsYXlPYmplY3RDb250YWluZXJcIik7XHJcbmltcG9ydCBHZW9tZXRyeVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvR2VvbWV0cnlcIik7XHJcbmltcG9ydCBUcmlhbmdsZVN1Ykdlb21ldHJ5XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvYmFzZS9UcmlhbmdsZVN1Ykdlb21ldHJ5XCIpO1xyXG5pbXBvcnQgTWVzaFx0XHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZW50aXRpZXMvTWVzaFwiKTtcclxuaW1wb3J0IE1hdGVyaWFsQmFzZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvTWF0ZXJpYWxCYXNlXCIpO1xyXG5cclxuLyoqXHJcbiAqICBDbGFzcyBNZXJnZSBtZXJnZXMgdHdvIG9yIG1vcmUgc3RhdGljIG1lc2hlcyBpbnRvIG9uZS48Y29kZT5NZXJnZTwvY29kZT5cclxuICovXHJcbmNsYXNzIE1lcmdlXHJcbntcclxuXHJcblx0Ly9wcml2YXRlIGNvbnN0IExJTUlUOnVpbnQgPSAxOTY2MDU7XHJcblx0cHJpdmF0ZSBfb2JqZWN0U3BhY2U6Ym9vbGVhbjtcclxuXHRwcml2YXRlIF9rZWVwTWF0ZXJpYWw6Ym9vbGVhbjtcclxuXHRwcml2YXRlIF9kaXNwb3NlU291cmNlczpib29sZWFuO1xyXG5cdHByaXZhdGUgX2dlb21WT3M6QXJyYXk8R2VvbWV0cnlWTz47XHJcblx0cHJpdmF0ZSBfdG9EaXNwb3NlOkFycmF5PE1lc2g+O1xyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0gICAga2VlcE1hdGVyaWFsICAgIFtvcHRpb25hbF0gICAgRGV0ZXJtaW5lcyBpZiB0aGUgbWVyZ2VkIG9iamVjdCB1c2VzIHRoZSByZWNldmllciBtZXNoIG1hdGVyaWFsIGluZm9ybWF0aW9uIG9yIGtlZXBzIGl0cyBzb3VyY2UgbWF0ZXJpYWwocykuIERlZmF1bHRzIHRvIGZhbHNlLlxyXG5cdCAqIElmIGZhbHNlIGFuZCByZWNlaXZlciBvYmplY3QgaGFzIG11bHRpcGxlIG1hdGVyaWFscywgdGhlIGxhc3QgbWF0ZXJpYWwgZm91bmQgaW4gcmVjZWl2ZXIgc3VibWVzaGVzIGlzIGFwcGxpZWQgdG8gdGhlIG1lcmdlZCBzdWJtZXNoKGVzKS5cclxuXHQgKiBAcGFyYW0gICAgZGlzcG9zZVNvdXJjZXMgIFtvcHRpb25hbF0gICAgRGV0ZXJtaW5lcyBpZiB0aGUgbWVzaCBhbmQgZ2VvbWV0cnkgc291cmNlKHMpIHVzZWQgZm9yIHRoZSBtZXJnaW5nIGFyZSBkaXNwb3NlZC4gRGVmYXVsdHMgdG8gZmFsc2UuXHJcblx0ICogSWYgdHJ1ZSwgb25seSByZWNlaXZlciBnZW9tZXRyeSBhbmQgcmVzdWx0aW5nIG1lc2ggYXJlIGtlcHQgaW4gIG1lbW9yeS5cclxuXHQgKiBAcGFyYW0gICAgb2JqZWN0U3BhY2UgICAgIFtvcHRpb25hbF0gICAgRGV0ZXJtaW5lcyBpZiBzb3VyY2UgbWVzaChlcykgaXMvYXJlIG1lcmdlZCB1c2luZyBvYmplY3RTcGFjZSBvciB3b3JsZHNwYWNlLiBEZWZhdWx0cyB0byBmYWxzZS5cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihrZWVwTWF0ZXJpYWw6Ym9vbGVhbiA9IGZhbHNlLCBkaXNwb3NlU291cmNlczpib29sZWFuID0gZmFsc2UsIG9iamVjdFNwYWNlOmJvb2xlYW4gPSBmYWxzZSlcclxuXHR7XHJcblx0XHR0aGlzLl9rZWVwTWF0ZXJpYWwgPSBrZWVwTWF0ZXJpYWw7XHJcblx0XHR0aGlzLl9kaXNwb3NlU291cmNlcyA9IGRpc3Bvc2VTb3VyY2VzO1xyXG5cdFx0dGhpcy5fb2JqZWN0U3BhY2UgPSBvYmplY3RTcGFjZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIERldGVybWluZXMgaWYgdGhlIG1lc2ggYW5kIGdlb21ldHJ5IHNvdXJjZShzKSB1c2VkIGZvciB0aGUgbWVyZ2luZyBhcmUgZGlzcG9zZWQuIERlZmF1bHRzIHRvIGZhbHNlLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBzZXQgZGlzcG9zZVNvdXJjZXMoYjpib29sZWFuKVxyXG5cdHtcclxuXHRcdHRoaXMuX2Rpc3Bvc2VTb3VyY2VzID0gYjtcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBnZXQgZGlzcG9zZVNvdXJjZXMoKTpib29sZWFuXHJcblx0e1xyXG5cdFx0cmV0dXJuIHRoaXMuX2Rpc3Bvc2VTb3VyY2VzO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRGV0ZXJtaW5lcyBpZiB0aGUgbWF0ZXJpYWwgc291cmNlKHMpIHVzZWQgZm9yIHRoZSBtZXJnaW5nIGFyZSBkaXNwb3NlZC4gRGVmYXVsdHMgdG8gZmFsc2UuXHJcblx0ICovXHJcblx0cHVibGljIHNldCBrZWVwTWF0ZXJpYWwoYjpib29sZWFuKVxyXG5cdHtcclxuXHRcdHRoaXMuX2tlZXBNYXRlcmlhbCA9IGI7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IGtlZXBNYXRlcmlhbCgpOmJvb2xlYW5cclxuXHR7XHJcblx0XHRyZXR1cm4gdGhpcy5fa2VlcE1hdGVyaWFsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogRGV0ZXJtaW5lcyBpZiBzb3VyY2UgbWVzaChlcykgaXMvYXJlIG1lcmdlZCB1c2luZyBvYmplY3RTcGFjZSBvciB3b3JsZHNwYWNlLiBEZWZhdWx0cyB0byBmYWxzZS5cclxuXHQgKi9cclxuXHRwdWJsaWMgc2V0IG9iamVjdFNwYWNlKGI6Ym9vbGVhbilcclxuXHR7XHJcblx0XHR0aGlzLl9vYmplY3RTcGFjZSA9IGI7XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgZ2V0IG9iamVjdFNwYWNlKCk6Ym9vbGVhblxyXG5cdHtcclxuXHRcdHJldHVybiB0aGlzLl9vYmplY3RTcGFjZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIE1lcmdlcyBhbGwgdGhlIGNoaWxkcmVuIG9mIGEgY29udGFpbmVyIGludG8gYSBzaW5nbGUgTWVzaC4gSWYgbm8gTWVzaCBvYmplY3QgaXMgZm91bmQsIG1ldGhvZCByZXR1cm5zIHRoZSByZWNlaXZlciB3aXRob3V0IG1vZGlmaWNhdGlvbi5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSAgICByZWNlaXZlciAgICAgICAgICAgVGhlIE1lc2ggdG8gcmVjZWl2ZSB0aGUgbWVyZ2VkIGNvbnRlbnRzIG9mIHRoZSBjb250YWluZXIuXHJcblx0ICogQHBhcmFtICAgIG9iamVjdENvbnRhaW5lciAgICBUaGUgRGlzcGxheU9iamVjdENvbnRhaW5lciBob2xkaW5nIHRoZSBtZXNoZXMgdG8gYmUgbWVyZ2QuXHJcblx0ICpcclxuXHQgKiBAcmV0dXJuIFRoZSBtZXJnZWQgTWVzaCBpbnN0YW5jZS5cclxuXHQgKi9cclxuXHRwdWJsaWMgYXBwbHlUb0NvbnRhaW5lcihyZWNlaXZlcjpNZXNoLCBvYmplY3RDb250YWluZXI6RGlzcGxheU9iamVjdENvbnRhaW5lcilcclxuXHR7XHJcblx0XHR0aGlzLnJlc2V0KCk7XHJcblxyXG5cdFx0Ly9jb2xsZWN0IGNvbnRhaW5lciBtZXNoZXNcclxuXHRcdHRoaXMucGFyc2VDb250YWluZXIocmVjZWl2ZXIsIG9iamVjdENvbnRhaW5lcik7XHJcblxyXG5cdFx0Ly9jb2xsZWN0IHJlY2VpdmVyXHJcblx0XHR0aGlzLmNvbGxlY3QocmVjZWl2ZXIsIGZhbHNlKTtcclxuXHJcblx0XHQvL21lcmdlIHRvIHJlY2VpdmVyXHJcblx0XHR0aGlzLm1lcmdlKHJlY2VpdmVyLCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBNZXJnZXMgYWxsIHRoZSBtZXNoZXMgZm91bmQgaW4gdGhlIEFycmF5Jmx0O01lc2gmZ3Q7IGludG8gYSBzaW5nbGUgTWVzaC5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSAgICByZWNlaXZlciAgICBUaGUgTWVzaCB0byByZWNlaXZlIHRoZSBtZXJnZWQgY29udGVudHMgb2YgdGhlIG1lc2hlcy5cclxuXHQgKiBAcGFyYW0gICAgbWVzaGVzICAgICAgQSBzZXJpZXMgb2YgTWVzaGVzIHRvIGJlIG1lcmdlZCB3aXRoIHRoZSByZWNpZXZlciBtZXNoLlxyXG5cdCAqL1xyXG5cdHB1YmxpYyBhcHBseVRvTWVzaGVzKHJlY2VpdmVyOk1lc2gsIG1lc2hlczpBcnJheTxNZXNoPilcclxuXHR7XHJcblx0XHR0aGlzLnJlc2V0KCk7XHJcblxyXG5cdFx0aWYgKCFtZXNoZXMubGVuZ3RoKVxyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0Ly9jb2xsZWN0IG1lc2hlcyBpbiB2ZWN0b3JcclxuXHRcdGZvciAodmFyIGk6bnVtYmVyIC8qdWludCovID0gMDsgaSA8IG1lc2hlcy5sZW5ndGg7IGkrKylcclxuXHRcdFx0aWYgKG1lc2hlc1tpXSAhPSByZWNlaXZlcilcclxuXHRcdFx0XHR0aGlzLmNvbGxlY3QobWVzaGVzW2ldLCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XHJcblxyXG5cdFx0Ly9jb2xsZWN0IHJlY2VpdmVyXHJcblx0XHR0aGlzLmNvbGxlY3QocmVjZWl2ZXIsIGZhbHNlKTtcclxuXHJcblx0XHQvL21lcmdlIHRvIHJlY2VpdmVyXHJcblx0XHR0aGlzLm1lcmdlKHJlY2VpdmVyLCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiAgTWVyZ2VzIDIgbWVzaGVzIGludG8gb25lLiBJdCBpcyByZWNvbW1hbmQgdG8gdXNlIGFwcGx5IHdoZW4gMiBtZXNoZXMgYXJlIHRvIGJlIG1lcmdlZC4gSWYgbW9yZSBuZWVkIHRvIGJlIG1lcmdlZCwgdXNlIGVpdGhlciBhcHBseVRvTWVzaGVzIG9yIGFwcGx5VG9Db250YWluZXIgbWV0aG9kcy5cclxuXHQgKlxyXG5cdCAqIEBwYXJhbSAgICByZWNlaXZlciAgICBUaGUgTWVzaCB0byByZWNlaXZlIHRoZSBtZXJnZWQgY29udGVudHMgb2YgYm90aCBtZXNoZXMuXHJcblx0ICogQHBhcmFtICAgIG1lc2ggICAgICAgIFRoZSBNZXNoIHRvIGJlIG1lcmdlZCB3aXRoIHRoZSByZWNlaXZlciBtZXNoXHJcblx0ICovXHJcblx0cHVibGljIGFwcGx5KHJlY2VpdmVyOk1lc2gsIG1lc2g6TWVzaClcclxuXHR7XHJcblx0XHR0aGlzLnJlc2V0KCk7XHJcblxyXG5cdFx0Ly9jb2xsZWN0IG1lc2hcclxuXHRcdHRoaXMuY29sbGVjdChtZXNoLCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XHJcblxyXG5cdFx0Ly9jb2xsZWN0IHJlY2VpdmVyXHJcblx0XHR0aGlzLmNvbGxlY3QocmVjZWl2ZXIsIGZhbHNlKTtcclxuXHJcblx0XHQvL21lcmdlIHRvIHJlY2VpdmVyXHJcblx0XHR0aGlzLm1lcmdlKHJlY2VpdmVyLCB0aGlzLl9kaXNwb3NlU291cmNlcyk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlc2V0KClcclxuXHR7XHJcblx0XHR0aGlzLl90b0Rpc3Bvc2UgID0gbmV3IEFycmF5PE1lc2g+KCk7XHJcblx0XHR0aGlzLl9nZW9tVk9zID0gbmV3IEFycmF5PEdlb21ldHJ5Vk8+KCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIG1lcmdlKGRlc3RNZXNoOk1lc2gsIGRpc3Bvc2U6Ym9vbGVhbilcclxuXHR7XHJcblx0XHR2YXIgaTpudW1iZXIgLyp1aW50Ki87XHJcblx0XHR2YXIgc3ViSWR4Om51bWJlciAvKnVpbnQqLztcclxuXHRcdHZhciBvbGRHZW9tOkdlb21ldHJ5O1xyXG5cdFx0dmFyIGRlc3RHZW9tOkdlb21ldHJ5O1xyXG5cdFx0dmFyIHVzZVN1Yk1hdGVyaWFsczpib29sZWFuO1xyXG5cclxuXHRcdG9sZEdlb20gPSBkZXN0TWVzaC5nZW9tZXRyeTtcclxuXHRcdGRlc3RHZW9tID0gZGVzdE1lc2guZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cnkoKTtcclxuXHRcdHN1YklkeCA9IGRlc3RNZXNoLnN1Yk1lc2hlcy5sZW5ndGg7XHJcblxyXG5cdFx0Ly8gT25seSBhcHBseSBtYXRlcmlhbHMgZGlyZWN0bHkgdG8gc3ViLW1lc2hlcyBpZiBuZWNlc3NhcnksXHJcblx0XHQvLyBpLmUuIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbWF0ZXJpYWwgYXZhaWxhYmxlLlxyXG5cdFx0dXNlU3ViTWF0ZXJpYWxzID0gKHRoaXMuX2dlb21WT3MubGVuZ3RoID4gMSk7XHJcblxyXG5cdFx0Zm9yIChpID0gMDsgaSA8IHRoaXMuX2dlb21WT3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIHM6bnVtYmVyIC8qdWludCovO1xyXG5cdFx0XHR2YXIgZGF0YTpHZW9tZXRyeVZPO1xyXG5cdFx0XHR2YXIgc3ViOlRyaWFuZ2xlU3ViR2VvbWV0cnkgPSBuZXcgVHJpYW5nbGVTdWJHZW9tZXRyeSh0cnVlKTtcclxuXHRcdFx0c3ViLmF1dG9EZXJpdmVOb3JtYWxzID0gZmFsc2U7XHJcblx0XHRcdHN1Yi5hdXRvRGVyaXZlVGFuZ2VudHMgPSBmYWxzZTtcclxuXHJcblx0XHRcdGRhdGEgPSB0aGlzLl9nZW9tVk9zW2ldO1xyXG5cdFx0XHRzdWIudXBkYXRlSW5kaWNlcyhkYXRhLmluZGljZXMpO1xyXG5cdFx0XHRzdWIudXBkYXRlUG9zaXRpb25zKGRhdGEudmVydGljZXMpO1xyXG5cdFx0XHRzdWIudXBkYXRlVmVydGV4Tm9ybWFscyhkYXRhLm5vcm1hbHMpO1xyXG5cdFx0XHRzdWIudXBkYXRlVmVydGV4VGFuZ2VudHMoZGF0YS50YW5nZW50cyk7XHJcblx0XHRcdHN1Yi51cGRhdGVVVnMoZGF0YS51dnMpO1xyXG5cclxuXHRcdFx0ZGVzdEdlb20uYWRkU3ViR2VvbWV0cnkoc3ViKTtcclxuXHJcblx0XHRcdGlmICh0aGlzLl9rZWVwTWF0ZXJpYWwgJiYgdXNlU3ViTWF0ZXJpYWxzKVxyXG5cdFx0XHRcdGRlc3RNZXNoLnN1Yk1lc2hlc1tzdWJJZHhdLm1hdGVyaWFsID0gZGF0YS5tYXRlcmlhbDtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5fa2VlcE1hdGVyaWFsICYmICF1c2VTdWJNYXRlcmlhbHMgJiYgdGhpcy5fZ2VvbVZPcy5sZW5ndGgpXHJcblx0XHRcdGRlc3RNZXNoLm1hdGVyaWFsID0gdGhpcy5fZ2VvbVZPc1swXS5tYXRlcmlhbDtcclxuXHJcblx0XHRpZiAoZGlzcG9zZSkge1xyXG5cdFx0XHR2YXIgbTpNZXNoO1xyXG5cdFx0XHR2YXIgbGVuOm51bWJlciA9IHRoaXMuX3RvRGlzcG9zZS5sZW5ndGg7XHJcblx0XHRcdGZvciAodmFyIGk6bnVtYmVyOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHRtID0gdGhpcy5fdG9EaXNwb3NlW2ldO1xyXG5cdFx0XHRcdG0uZ2VvbWV0cnkuZGlzcG9zZSgpO1xyXG5cdFx0XHRcdG0uZGlzcG9zZSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvL2Rpc3Bvc2Ugb2YgdGhlIG9yaWdpbmFsIHJlY2VpdmVyIGdlb21ldHJ5XHJcblx0XHRcdG9sZEdlb20uZGlzcG9zZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX3RvRGlzcG9zZSA9IG51bGw7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGNvbGxlY3QobWVzaDpNZXNoLCBkaXNwb3NlOmJvb2xlYW4pXHJcblx0e1xyXG5cdFx0aWYgKG1lc2guZ2VvbWV0cnkpIHtcclxuXHRcdFx0dmFyIHN1YklkeDpudW1iZXIgLyp1aW50Ki87XHJcblx0XHRcdHZhciBzdWJHZW9tZXRyaWVzOkFycmF5PFRyaWFuZ2xlU3ViR2VvbWV0cnk+ID0gPEFycmF5PFRyaWFuZ2xlU3ViR2VvbWV0cnk+PiBtZXNoLmdlb21ldHJ5LnN1Ykdlb21ldHJpZXM7XHJcblx0XHRcdHZhciBjYWxjOm51bWJlciAvKnVpbnQqLztcclxuXHRcdFx0Zm9yIChzdWJJZHggPSAwOyBzdWJJZHggPCBzdWJHZW9tZXRyaWVzLmxlbmd0aDsgc3ViSWR4KyspIHtcclxuXHRcdFx0XHR2YXIgaTpudW1iZXIgLyp1aW50Ki87XHJcblx0XHRcdFx0dmFyIGxlbjpudW1iZXIgLyp1aW50Ki87XHJcblx0XHRcdFx0dmFyIGlJZHg6bnVtYmVyIC8qdWludCovLCB2SWR4Om51bWJlciAvKnVpbnQqLywgbklkeDpudW1iZXIgLyp1aW50Ki8sIHRJZHg6bnVtYmVyIC8qdWludCovLCB1SWR4Om51bWJlciAvKnVpbnQqLztcclxuXHRcdFx0XHR2YXIgaW5kZXhPZmZzZXQ6bnVtYmVyIC8qdWludCovO1xyXG5cdFx0XHRcdHZhciBzdWJHZW9tOlRyaWFuZ2xlU3ViR2VvbWV0cnk7XHJcblx0XHRcdFx0dmFyIHZvOkdlb21ldHJ5Vk87XHJcblx0XHRcdFx0dmFyIHZlcnRpY2VzOkFycmF5PG51bWJlcj47XHJcblx0XHRcdFx0dmFyIG5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcclxuXHRcdFx0XHR2YXIgdGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcclxuXHRcdFx0XHR2YXIgcGQ6QXJyYXk8bnVtYmVyPiwgbmQ6QXJyYXk8bnVtYmVyPiwgdGQ6QXJyYXk8bnVtYmVyPiwgdWQ6QXJyYXk8bnVtYmVyPjtcclxuXHJcblx0XHRcdFx0c3ViR2VvbSA9IHN1Ykdlb21ldHJpZXNbc3ViSWR4XTtcclxuXHRcdFx0XHRwZCA9IHN1Ykdlb20ucG9zaXRpb25zO1xyXG5cdFx0XHRcdG5kID0gc3ViR2VvbS52ZXJ0ZXhOb3JtYWxzO1xyXG5cdFx0XHRcdHRkID0gc3ViR2VvbS52ZXJ0ZXhUYW5nZW50cztcclxuXHRcdFx0XHR1ZCA9IHN1Ykdlb20udXZzO1xyXG5cclxuXHRcdFx0XHQvLyBHZXQgKG9yIGNyZWF0ZSkgYSBWTyBmb3IgdGhpcyBtYXRlcmlhbFxyXG5cdFx0XHRcdHZvID0gdGhpcy5nZXRTdWJHZW9tRGF0YShtZXNoLnN1Yk1lc2hlc1tzdWJJZHhdLm1hdGVyaWFsIHx8IG1lc2gubWF0ZXJpYWwpO1xyXG5cclxuXHRcdFx0XHQvLyBWZXJ0aWNlcyBhbmQgbm9ybWFscyBhcmUgY29waWVkIHRvIHRlbXBvcmFyeSB2ZWN0b3JzLCB0byBiZSB0cmFuc2Zvcm1lZFxyXG5cdFx0XHRcdC8vIGJlZm9yZSBjb25jYXRlbmF0ZWQgb250byB0aG9zZSBvZiB0aGUgZGF0YS4gVGhpcyBpcyB1bm5lY2Vzc2FyeSBpZiBub1xyXG5cdFx0XHRcdC8vIHRyYW5zZm9ybWF0aW9uIHdpbGwgYmUgcGVyZm9ybWVkLCBpLmUuIGZvciBvYmplY3Qgc3BhY2UgbWVyZ2luZy5cclxuXHRcdFx0XHR2ZXJ0aWNlcyA9ICh0aGlzLl9vYmplY3RTcGFjZSk/IHZvLnZlcnRpY2VzIDogbmV3IEFycmF5PG51bWJlcj4oKTtcclxuXHRcdFx0XHRub3JtYWxzID0gKHRoaXMuX29iamVjdFNwYWNlKT8gdm8ubm9ybWFscyA6IG5ldyBBcnJheTxudW1iZXI+KCk7XHJcblx0XHRcdFx0dGFuZ2VudHMgPSAodGhpcy5fb2JqZWN0U3BhY2UpPyB2by50YW5nZW50cyA6IG5ldyBBcnJheTxudW1iZXI+KCk7XHJcblxyXG5cdFx0XHRcdC8vIENvcHkgb3ZlciB2ZXJ0ZXggYXR0cmlidXRlc1xyXG5cdFx0XHRcdHZJZHggPSB2ZXJ0aWNlcy5sZW5ndGg7XHJcblx0XHRcdFx0bklkeCA9IG5vcm1hbHMubGVuZ3RoO1xyXG5cdFx0XHRcdHRJZHggPSB0YW5nZW50cy5sZW5ndGg7XHJcblx0XHRcdFx0dUlkeCA9IHZvLnV2cy5sZW5ndGg7XHJcblx0XHRcdFx0bGVuID0gc3ViR2VvbS5udW1WZXJ0aWNlcztcclxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHRcdGNhbGMgPSBpKjM7XHJcblxyXG5cdFx0XHRcdFx0Ly8gUG9zaXRpb25cclxuXHRcdFx0XHRcdHZlcnRpY2VzW3ZJZHgrK10gPSBwZFtjYWxjXTtcclxuXHRcdFx0XHRcdHZlcnRpY2VzW3ZJZHgrK10gPSBwZFtjYWxjICsgMV07XHJcblx0XHRcdFx0XHR2ZXJ0aWNlc1t2SWR4KytdID0gcGRbY2FsYyArIDJdO1xyXG5cclxuXHRcdFx0XHRcdC8vIE5vcm1hbFxyXG5cdFx0XHRcdFx0bm9ybWFsc1tuSWR4KytdID0gbmRbY2FsY107XHJcblx0XHRcdFx0XHRub3JtYWxzW25JZHgrK10gPSBuZFtjYWxjICsgMV07XHJcblx0XHRcdFx0XHRub3JtYWxzW25JZHgrK10gPSBuZFtjYWxjICsgMl07XHJcblxyXG5cdFx0XHRcdFx0Ly8gVGFuZ2VudFxyXG5cdFx0XHRcdFx0dGFuZ2VudHNbdElkeCsrXSA9IHRkW2NhbGNdO1xyXG5cdFx0XHRcdFx0dGFuZ2VudHNbdElkeCsrXSA9IHRkW2NhbGMgKyAxXTtcclxuXHRcdFx0XHRcdHRhbmdlbnRzW3RJZHgrK10gPSB0ZFtjYWxjICsgMl07XHJcblxyXG5cdFx0XHRcdFx0Ly8gVVZcclxuXHRcdFx0XHRcdHZvLnV2c1t1SWR4KytdID0gdWRbaSoyXTtcclxuXHRcdFx0XHRcdHZvLnV2c1t1SWR4KytdID0gdWRbaSoyICsgMV07XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBDb3B5IG92ZXIgdHJpYW5nbGUgaW5kaWNlc1xyXG5cdFx0XHRcdGluZGV4T2Zmc2V0ID0gKCF0aGlzLl9vYmplY3RTcGFjZSk/IHZvLnZlcnRpY2VzLmxlbmd0aC8zIDowO1xyXG5cdFx0XHRcdGlJZHggPSB2by5pbmRpY2VzLmxlbmd0aDtcclxuXHRcdFx0XHRsZW4gPSBzdWJHZW9tLm51bVRyaWFuZ2xlcztcclxuXHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHRcdGNhbGMgPSBpKjM7XHJcblx0XHRcdFx0XHR2by5pbmRpY2VzW2lJZHgrK10gPSBzdWJHZW9tLmluZGljZXNbY2FsY10gKyBpbmRleE9mZnNldDtcclxuXHRcdFx0XHRcdHZvLmluZGljZXNbaUlkeCsrXSA9IHN1Ykdlb20uaW5kaWNlc1tjYWxjICsgMV0gKyBpbmRleE9mZnNldDtcclxuXHRcdFx0XHRcdHZvLmluZGljZXNbaUlkeCsrXSA9IHN1Ykdlb20uaW5kaWNlc1tjYWxjICsgMl0gKyBpbmRleE9mZnNldDtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmICghdGhpcy5fb2JqZWN0U3BhY2UpIHtcclxuXHRcdFx0XHRcdG1lc2guc2NlbmVUcmFuc2Zvcm0udHJhbnNmb3JtVmVjdG9ycyh2ZXJ0aWNlcywgdmVydGljZXMpO1xyXG5cdFx0XHRcdFx0TWF0cml4M0RVdGlscy5kZWx0YVRyYW5zZm9ybVZlY3RvcnMobWVzaC5zY2VuZVRyYW5zZm9ybSwgbm9ybWFscywgbm9ybWFscyk7XHJcblx0XHRcdFx0XHRNYXRyaXgzRFV0aWxzLmRlbHRhVHJhbnNmb3JtVmVjdG9ycyhtZXNoLnNjZW5lVHJhbnNmb3JtLCB0YW5nZW50cywgdGFuZ2VudHMpO1xyXG5cclxuXHRcdFx0XHRcdC8vIENvcHkgdmVydGV4IGRhdGEgZnJvbSB0ZW1wb3JhcnkgKHRyYW5zZm9ybWVkKSB2ZWN0b3JzXHJcblx0XHRcdFx0XHR2SWR4ID0gdm8udmVydGljZXMubGVuZ3RoO1xyXG5cdFx0XHRcdFx0bklkeCA9IHZvLm5vcm1hbHMubGVuZ3RoO1xyXG5cdFx0XHRcdFx0dElkeCA9IHZvLnRhbmdlbnRzLmxlbmd0aDtcclxuXHRcdFx0XHRcdGxlbiA9IHZlcnRpY2VzLmxlbmd0aDtcclxuXHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG5cdFx0XHRcdFx0XHR2by52ZXJ0aWNlc1t2SWR4KytdID0gdmVydGljZXNbaV07XHJcblx0XHRcdFx0XHRcdHZvLm5vcm1hbHNbbklkeCsrXSA9IG5vcm1hbHNbaV07XHJcblx0XHRcdFx0XHRcdHZvLnRhbmdlbnRzW3RJZHgrK10gPSB0YW5nZW50c1tpXTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChkaXNwb3NlKVxyXG5cdFx0XHRcdHRoaXMuX3RvRGlzcG9zZS5wdXNoKG1lc2gpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBnZXRTdWJHZW9tRGF0YShtYXRlcmlhbDpNYXRlcmlhbEJhc2UpOkdlb21ldHJ5Vk9cclxuXHR7XHJcblx0XHR2YXIgZGF0YTpHZW9tZXRyeVZPO1xyXG5cclxuXHRcdGlmICh0aGlzLl9rZWVwTWF0ZXJpYWwpIHtcclxuXHRcdFx0dmFyIGk6bnVtYmVyIC8qdWludCovO1xyXG5cdFx0XHR2YXIgbGVuOm51bWJlciAvKnVpbnQqLztcclxuXHJcblx0XHRcdGxlbiA9IHRoaXMuX2dlb21WT3MubGVuZ3RoO1xyXG5cdFx0XHRmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuXHRcdFx0XHRpZiAodGhpcy5fZ2VvbVZPc1tpXS5tYXRlcmlhbCA9PSBtYXRlcmlhbCkge1xyXG5cdFx0XHRcdFx0ZGF0YSA9IHRoaXMuX2dlb21WT3NbaV07XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSBpZiAodGhpcy5fZ2VvbVZPcy5sZW5ndGgpIHtcclxuXHRcdFx0Ly8gSWYgbWF0ZXJpYWxzIGFyZSBub3QgdG8gYmUga2VwdCwgYWxsIGRhdGEgY2FuIGJlXHJcblx0XHRcdC8vIHB1dCBpbnRvIGEgc2luZ2xlIFZPLCBzbyByZXR1cm4gdGhhdCBvbmUuXHJcblx0XHRcdGRhdGEgPSB0aGlzLl9nZW9tVk9zWzBdO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIE5vIGRhdGEgKGZvciB0aGlzIG1hdGVyaWFsKSBmb3VuZCwgY3JlYXRlIG5ldy5cclxuXHRcdGlmICghZGF0YSkge1xyXG5cdFx0XHRkYXRhID0gbmV3IEdlb21ldHJ5Vk8oKTtcclxuXHRcdFx0ZGF0YS52ZXJ0aWNlcyA9IG5ldyBBcnJheTxudW1iZXI+KCk7XHJcblx0XHRcdGRhdGEubm9ybWFscyA9IG5ldyBBcnJheTxudW1iZXI+KCk7XHJcblx0XHRcdGRhdGEudGFuZ2VudHMgPSBuZXcgQXJyYXk8bnVtYmVyPigpO1xyXG5cdFx0XHRkYXRhLnV2cyA9IG5ldyBBcnJheTxudW1iZXI+KCk7XHJcblx0XHRcdGRhdGEuaW5kaWNlcyA9IG5ldyBBcnJheTxudW1iZXIgLyp1aW50Ki8+KCk7XHJcblx0XHRcdGRhdGEubWF0ZXJpYWwgPSBtYXRlcmlhbDtcclxuXHJcblx0XHRcdHRoaXMuX2dlb21WT3MucHVzaChkYXRhKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZGF0YTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgcGFyc2VDb250YWluZXIocmVjZWl2ZXI6TWVzaCwgb2JqZWN0OkRpc3BsYXlPYmplY3RDb250YWluZXIpXHJcblx0e1xyXG5cdFx0dmFyIGNoaWxkOkRpc3BsYXlPYmplY3RDb250YWluZXI7XHJcblx0XHR2YXIgaTpudW1iZXIgLyp1aW50Ki87XHJcblxyXG5cdFx0aWYgKG9iamVjdCBpbnN0YW5jZW9mIE1lc2ggJiYgb2JqZWN0ICE9ICg8RGlzcGxheU9iamVjdENvbnRhaW5lcj4gcmVjZWl2ZXIpKVxyXG5cdFx0XHR0aGlzLmNvbGxlY3QoPE1lc2g+IG9iamVjdCwgdGhpcy5fZGlzcG9zZVNvdXJjZXMpO1xyXG5cclxuXHRcdGZvciAoaSA9IDA7IGkgPCBvYmplY3QubnVtQ2hpbGRyZW47ICsraSkge1xyXG5cdFx0XHRjaGlsZCA9IDxEaXNwbGF5T2JqZWN0Q29udGFpbmVyPiBvYmplY3QuZ2V0Q2hpbGRBdChpKTtcclxuXHRcdFx0dGhpcy5wYXJzZUNvbnRhaW5lcihyZWNlaXZlciwgY2hpbGQpO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0ID0gTWVyZ2U7XHJcblxyXG5jbGFzcyBHZW9tZXRyeVZPXHJcbntcclxuXHRwdWJsaWMgdXZzOkFycmF5PG51bWJlcj47XHJcblx0cHVibGljIHZlcnRpY2VzOkFycmF5PG51bWJlcj47XHJcblx0cHVibGljIG5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcclxuXHRwdWJsaWMgdGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcclxuXHRwdWJsaWMgaW5kaWNlczpBcnJheTxudW1iZXIgLyp1aW50Ki8+O1xyXG5cdHB1YmxpYyBtYXRlcmlhbDpNYXRlcmlhbEJhc2U7XHJcbn1cclxuIl19