var TriangleSubGeometry = require("awayjs-core/lib/core/base/TriangleSubGeometry");
var Point = require("awayjs-core/lib/core/geom/Point");
var Vector3D = require("awayjs-core/lib/core/geom/Vector3D");
var ParticleData = require("awayjs-renderergl/lib/animators/data/ParticleData");
var ParticleGeometry = require("awayjs-renderergl/lib/core/base/ParticleGeometry");
/**
 * ...
 */
var ParticleGeometryHelper = (function () {
    function ParticleGeometryHelper() {
    }
    ParticleGeometryHelper.generateGeometry = function (geometries, transforms) {
        if (transforms === void 0) { transforms = null; }
        var indicesVector = new Array() /*uint*/;
        var positionsVector = new Array();
        var normalsVector = new Array();
        var tangentsVector = new Array();
        var uvsVector = new Array();
        var vertexCounters = new Array() /*uint*/;
        var particles = new Array();
        var subGeometries = new Array();
        var numParticles = geometries.length;
        var sourceSubGeometries;
        var sourceSubGeometry;
        var numSubGeometries /*uint*/;
        var indices /*uint*/;
        var positions;
        var normals;
        var tangents;
        var uvs;
        var vertexCounter /*uint*/;
        var subGeometry;
        var i /*int*/;
        var j /*int*/;
        var sub2SubMap = new Array() /*int*/;
        var tempVertex = new Vector3D;
        var tempNormal = new Vector3D;
        var tempTangents = new Vector3D;
        var tempUV = new Point;
        for (i = 0; i < numParticles; i++) {
            sourceSubGeometries = geometries[i].subGeometries;
            numSubGeometries = sourceSubGeometries.length;
            for (var srcIndex = 0; srcIndex < numSubGeometries; srcIndex++) {
                //create a different particle subgeometry group for each source subgeometry in a particle.
                if (sub2SubMap.length <= srcIndex) {
                    sub2SubMap.push(subGeometries.length);
                    indicesVector.push(new Array());
                    positionsVector.push(new Array());
                    normalsVector.push(new Array());
                    tangentsVector.push(new Array());
                    uvsVector.push(new Array());
                    subGeometries.push(new TriangleSubGeometry(true));
                    vertexCounters.push(0);
                }
                sourceSubGeometry = sourceSubGeometries[srcIndex];
                //add a new particle subgeometry if this source subgeometry will take us over the maxvertex limit
                if (sourceSubGeometry.numVertices + vertexCounters[sub2SubMap[srcIndex]] > ParticleGeometryHelper.MAX_VERTEX) {
                    //update submap and add new subgeom vectors
                    sub2SubMap[srcIndex] = subGeometries.length;
                    indicesVector.push(new Array());
                    positionsVector.push(new Array());
                    normalsVector.push(new Array());
                    tangentsVector.push(new Array());
                    uvsVector.push(new Array());
                    subGeometries.push(new TriangleSubGeometry(true));
                    vertexCounters.push(0);
                }
                j = sub2SubMap[srcIndex];
                //select the correct vector
                indices = indicesVector[j];
                positions = positionsVector[j];
                normals = normalsVector[j];
                tangents = tangentsVector[j];
                uvs = uvsVector[j];
                vertexCounter = vertexCounters[j];
                subGeometry = subGeometries[j];
                var particleData = new ParticleData();
                particleData.numVertices = sourceSubGeometry.numVertices;
                particleData.startVertexIndex = vertexCounter;
                particleData.particleIndex = i;
                particleData.subGeometry = subGeometry;
                particles.push(particleData);
                vertexCounters[j] += sourceSubGeometry.numVertices;
                var k /*int*/;
                var tempLen /*int*/;
                var compact = sourceSubGeometry;
                var product /*uint*/;
                var sourcePositions;
                var sourceNormals;
                var sourceTangents;
                var sourceUVs;
                if (compact) {
                    tempLen = compact.numVertices;
                    compact.numTriangles;
                    sourcePositions = compact.positions;
                    sourceNormals = compact.vertexNormals;
                    sourceTangents = compact.vertexTangents;
                    sourceUVs = compact.uvs;
                    if (transforms) {
                        var particleGeometryTransform = transforms[i];
                        var vertexTransform = particleGeometryTransform.vertexTransform;
                        var invVertexTransform = particleGeometryTransform.invVertexTransform;
                        var UVTransform = particleGeometryTransform.UVTransform;
                        for (k = 0; k < tempLen; k++) {
                            /*
                             * 0 - 2: vertex position X, Y, Z
                             * 3 - 5: normal X, Y, Z
                             * 6 - 8: tangent X, Y, Z
                             * 9 - 10: U V
                             * 11 - 12: Secondary U V*/
                            product = k * 3;
                            tempVertex.x = sourcePositions[product];
                            tempVertex.y = sourcePositions[product + 1];
                            tempVertex.z = sourcePositions[product + 2];
                            tempNormal.x = sourceNormals[product];
                            tempNormal.y = sourceNormals[product + 1];
                            tempNormal.z = sourceNormals[product + 2];
                            tempTangents.x = sourceTangents[product];
                            tempTangents.y = sourceTangents[product + 1];
                            tempTangents.z = sourceTangents[product + 2];
                            tempUV.x = sourceUVs[k * 2];
                            tempUV.y = sourceUVs[k * 2 + 1];
                            if (vertexTransform) {
                                tempVertex = vertexTransform.transformVector(tempVertex);
                                tempNormal = invVertexTransform.deltaTransformVector(tempNormal);
                                tempTangents = invVertexTransform.deltaTransformVector(tempNormal);
                            }
                            if (UVTransform)
                                tempUV = UVTransform.transformPoint(tempUV);
                            //this is faster than that only push one data
                            sourcePositions.push(tempVertex.x, tempVertex.y, tempVertex.z);
                            sourceNormals.push(tempNormal.x, tempNormal.y, tempNormal.z);
                            sourceTangents.push(tempTangents.x, tempTangents.y, tempTangents.z);
                            sourceUVs.push(tempUV.x, tempUV.y);
                        }
                    }
                    else {
                        for (k = 0; k < tempLen; k++) {
                            product = k * 3;
                            //this is faster than that only push one data
                            positions.push(sourcePositions[product], sourcePositions[product + 1], sourcePositions[product + 2]);
                            normals.push(sourceNormals[product], sourceNormals[product + 1], sourceNormals[product + 2]);
                            tangents.push(sourceTangents[product], sourceTangents[product + 1], sourceTangents[product + 2]);
                            uvs.push(sourceUVs[k * 2], sourceUVs[k * 2 + 1]);
                        }
                    }
                }
                else {
                }
                var sourceIndices = sourceSubGeometry.indices;
                tempLen = sourceSubGeometry.numTriangles;
                for (k = 0; k < tempLen; k++) {
                    product = k * 3;
                    indices.push(sourceIndices[product] + vertexCounter, sourceIndices[product + 1] + vertexCounter, sourceIndices[product + 2] + vertexCounter);
                }
            }
        }
        var particleGeometry = new ParticleGeometry();
        particleGeometry.particles = particles;
        particleGeometry.numParticles = numParticles;
        numParticles = subGeometries.length;
        for (i = 0; i < numParticles; i++) {
            subGeometry = subGeometries[i];
            subGeometry.autoDeriveNormals = false;
            subGeometry.autoDeriveTangents = false;
            subGeometry.updateIndices(indicesVector[i]);
            subGeometry.updatePositions(positionsVector[i]);
            subGeometry.updateVertexNormals(normalsVector[i]);
            subGeometry.updateVertexTangents(tangentsVector[i]);
            subGeometry.updateUVs(uvsVector[i]);
            particleGeometry.addSubGeometry(subGeometry);
        }
        return particleGeometry;
    };
    ParticleGeometryHelper.MAX_VERTEX = 65535;
    return ParticleGeometryHelper;
})();
module.exports = ParticleGeometryHelper;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvb2xzL2hlbHBlcnMvcGFydGljbGVnZW9tZXRyeWhlbHBlci50cyJdLCJuYW1lcyI6WyJQYXJ0aWNsZUdlb21ldHJ5SGVscGVyIiwiUGFydGljbGVHZW9tZXRyeUhlbHBlci5jb25zdHJ1Y3RvciIsIlBhcnRpY2xlR2VvbWV0cnlIZWxwZXIuZ2VuZXJhdGVHZW9tZXRyeSJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBTyxtQkFBbUIsV0FBYywrQ0FBK0MsQ0FBQyxDQUFDO0FBR3pGLElBQU8sS0FBSyxXQUFpQixpQ0FBaUMsQ0FBQyxDQUFDO0FBQ2hFLElBQU8sUUFBUSxXQUFpQixvQ0FBb0MsQ0FBQyxDQUFDO0FBS3RFLElBQU8sWUFBWSxXQUFnQixtREFBbUQsQ0FBQyxDQUFDO0FBQ3hGLElBQU8sZ0JBQWdCLFdBQWUsa0RBQWtELENBQUMsQ0FBQztBQUcxRixBQUdBOztHQURHO0lBQ0csc0JBQXNCO0lBQTVCQSxTQUFNQSxzQkFBc0JBO0lBdUw1QkMsQ0FBQ0E7SUFuTGNELHVDQUFnQkEsR0FBOUJBLFVBQStCQSxVQUEwQkEsRUFBRUEsVUFBa0RBO1FBQWxERSwwQkFBa0RBLEdBQWxEQSxpQkFBa0RBO1FBRTVHQSxJQUFJQSxhQUFhQSxHQUFpQ0EsSUFBSUEsS0FBS0EsRUFBaUJBLENBQUNBLFFBQURBLEFBQVNBLENBQUNBO1FBQ3RGQSxJQUFJQSxlQUFlQSxHQUF3QkEsSUFBSUEsS0FBS0EsRUFBaUJBLENBQUNBO1FBQ3RFQSxJQUFJQSxhQUFhQSxHQUF3QkEsSUFBSUEsS0FBS0EsRUFBaUJBLENBQUNBO1FBQ3BFQSxJQUFJQSxjQUFjQSxHQUF3QkEsSUFBSUEsS0FBS0EsRUFBaUJBLENBQUNBO1FBQ3JFQSxJQUFJQSxTQUFTQSxHQUF3QkEsSUFBSUEsS0FBS0EsRUFBaUJBLENBQUNBO1FBQ2hFQSxJQUFJQSxjQUFjQSxHQUEwQkEsSUFBSUEsS0FBS0EsRUFBVUEsQ0FBQ0EsUUFBREEsQUFBU0EsQ0FBQ0E7UUFDekVBLElBQUlBLFNBQVNBLEdBQXVCQSxJ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dUxDQSxJQUFBO0FBRUQsQUFBZ0MsaUJBQXZCLHNCQUFzQixDQUFDIiwiZmlsZSI6InRvb2xzL2hlbHBlcnMvUGFydGljbGVHZW9tZXRyeUhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvcm9iYmF0ZW1hbi9XZWJzdG9ybVByb2plY3RzL2F3YXlqcy1yZW5kZXJlcmdsLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBHZW9tZXRyeVx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvYmFzZS9HZW9tZXRyeVwiKTtcbmltcG9ydCBUcmlhbmdsZVN1Ykdlb21ldHJ5XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9iYXNlL1RyaWFuZ2xlU3ViR2VvbWV0cnlcIik7XG5pbXBvcnQgTWF0cml4XHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvY29yZS9nZW9tL01hdHJpeFwiKTtcbmltcG9ydCBNYXRyaXgzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9NYXRyaXgzRFwiKTtcbmltcG9ydCBQb2ludFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9Qb2ludFwiKTtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2NvcmUvZ2VvbS9WZWN0b3IzRFwiKTtcblxuaW1wb3J0IE1lc2hcdFx0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2VudGl0aWVzL01lc2hcIik7XG5pbXBvcnQgTWF0ZXJpYWxCYXNlXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL21hdGVyaWFscy9NYXRlcmlhbEJhc2VcIik7XG5cbmltcG9ydCBQYXJ0aWNsZURhdGFcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvYW5pbWF0b3JzL2RhdGEvUGFydGljbGVEYXRhXCIpO1xuaW1wb3J0IFBhcnRpY2xlR2VvbWV0cnlcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvcmUvYmFzZS9QYXJ0aWNsZUdlb21ldHJ5XCIpO1xuaW1wb3J0IFBhcnRpY2xlR2VvbWV0cnlUcmFuc2Zvcm1cdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL3Rvb2xzL2RhdGEvUGFydGljbGVHZW9tZXRyeVRyYW5zZm9ybVwiKTtcblxuLyoqXG4gKiAuLi5cbiAqL1xuY2xhc3MgUGFydGljbGVHZW9tZXRyeUhlbHBlclxue1xuXHRwdWJsaWMgc3RhdGljIE1BWF9WRVJURVg6bnVtYmVyIC8qaW50Ki8gPSA2NTUzNTtcblxuXHRwdWJsaWMgc3RhdGljIGdlbmVyYXRlR2VvbWV0cnkoZ2VvbWV0cmllczpBcnJheTxHZW9tZXRyeT4sIHRyYW5zZm9ybXM6QXJyYXk8UGFydGljbGVHZW9tZXRyeVRyYW5zZm9ybT4gPSBudWxsKTpQYXJ0aWNsZUdlb21ldHJ5XG5cdHtcblx0XHR2YXIgaW5kaWNlc1ZlY3RvcjpBcnJheTxBcnJheTxudW1iZXI+PiAvKnVpbnQqLyA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpIC8qdWludCovO1xuXHRcdHZhciBwb3NpdGlvbnNWZWN0b3I6QXJyYXk8QXJyYXk8bnVtYmVyPj4gPSBuZXcgQXJyYXk8QXJyYXk8bnVtYmVyPj4oKTtcblx0XHR2YXIgbm9ybWFsc1ZlY3RvcjpBcnJheTxBcnJheTxudW1iZXI+PiA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpO1xuXHRcdHZhciB0YW5nZW50c1ZlY3RvcjpBcnJheTxBcnJheTxudW1iZXI+PiA9IG5ldyBBcnJheTxBcnJheTxudW1iZXI+PigpO1xuXHRcdHZhciB1dnNWZWN0b3I6QXJyYXk8QXJyYXk8bnVtYmVyPj4gPSBuZXcgQXJyYXk8QXJyYXk8bnVtYmVyPj4oKTtcblx0XHR2YXIgdmVydGV4Q291bnRlcnM6QXJyYXk8bnVtYmVyPiAvKnVpbnQqLyA9IG5ldyBBcnJheTxudW1iZXI+KCkgLyp1aW50Ki87XG5cdFx0dmFyIHBhcnRpY2xlczpBcnJheTxQYXJ0aWNsZURhdGE+ID0gbmV3IEFycmF5PFBhcnRpY2xlRGF0YT4oKTtcblx0XHR2YXIgc3ViR2VvbWV0cmllczpBcnJheTxUcmlhbmdsZVN1Ykdlb21ldHJ5PiA9IG5ldyBBcnJheTxUcmlhbmdsZVN1Ykdlb21ldHJ5PigpO1xuXHRcdHZhciBudW1QYXJ0aWNsZXM6bnVtYmVyIC8qdWludCovID0gZ2VvbWV0cmllcy5sZW5ndGg7XG5cblx0XHR2YXIgc291cmNlU3ViR2VvbWV0cmllczpBcnJheTxUcmlhbmdsZVN1Ykdlb21ldHJ5Pjtcblx0XHR2YXIgc291cmNlU3ViR2VvbWV0cnk6VHJpYW5nbGVTdWJHZW9tZXRyeTtcblx0XHR2YXIgbnVtU3ViR2VvbWV0cmllczpudW1iZXIgLyp1aW50Ki87XG5cdFx0dmFyIGluZGljZXM6QXJyYXk8bnVtYmVyPiAvKnVpbnQqLztcblx0XHR2YXIgcG9zaXRpb25zOkFycmF5PG51bWJlcj47XG5cdFx0dmFyIG5vcm1hbHM6QXJyYXk8bnVtYmVyPjtcblx0XHR2YXIgdGFuZ2VudHM6QXJyYXk8bnVtYmVyPjtcblx0XHR2YXIgdXZzOkFycmF5PG51bWJlcj47XG5cdFx0dmFyIHZlcnRleENvdW50ZXI6bnVtYmVyIC8qdWludCovO1xuXHRcdHZhciBzdWJHZW9tZXRyeTpUcmlhbmdsZVN1Ykdlb21ldHJ5O1xuXHRcdHZhciBpOm51bWJlciAvKmludCovO1xuXHRcdHZhciBqOm51bWJlciAvKmludCovO1xuXHRcdHZhciBzdWIyU3ViTWFwOkFycmF5PG51bWJlcj4gLyppbnQqLyA9IG5ldyBBcnJheTxudW1iZXI+KCkgLyppbnQqLztcblxuXHRcdHZhciB0ZW1wVmVydGV4OlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEO1xuXHRcdHZhciB0ZW1wTm9ybWFsOlZlY3RvcjNEID0gbmV3IFZlY3RvcjNEO1xuXHRcdHZhciB0ZW1wVGFuZ2VudHM6VmVjdG9yM0QgPSBuZXcgVmVjdG9yM0Q7XG5cdFx0dmFyIHRlbXBVVjpQb2ludCA9IG5ldyBQb2ludDtcblxuXHRcdGZvciAoaSA9IDA7IGkgPCBudW1QYXJ0aWNsZXM7IGkrKykge1xuXHRcdFx0c291cmNlU3ViR2VvbWV0cmllcyA9IDxBcnJheTxUcmlhbmdsZVN1Ykdlb21ldHJ5Pj4gZ2VvbWV0cmllc1tpXS5zdWJHZW9tZXRyaWVzO1xuXHRcdFx0bnVtU3ViR2VvbWV0cmllcyA9IHNvdXJjZVN1Ykdlb21ldHJpZXMubGVuZ3RoO1xuXHRcdFx0Zm9yICh2YXIgc3JjSW5kZXg6bnVtYmVyIC8qaW50Ki8gPSAwOyBzcmNJbmRleCA8IG51bVN1Ykdlb21ldHJpZXM7IHNyY0luZGV4KyspIHtcblx0XHRcdFx0Ly9jcmVhdGUgYSBkaWZmZXJlbnQgcGFydGljbGUgc3ViZ2VvbWV0cnkgZ3JvdXAgZm9yIGVhY2ggc291cmNlIHN1Ymdlb21ldHJ5IGluIGEgcGFydGljbGUuXG5cdFx0XHRcdGlmIChzdWIyU3ViTWFwLmxlbmd0aCA8PSBzcmNJbmRleCkge1xuXHRcdFx0XHRcdHN1YjJTdWJNYXAucHVzaChzdWJHZW9tZXRyaWVzLmxlbmd0aCk7XG5cdFx0XHRcdFx0aW5kaWNlc1ZlY3Rvci5wdXNoKG5ldyBBcnJheTxudW1iZXI+KCkgLyp1aW50Ki8pO1xuXHRcdFx0XHRcdHBvc2l0aW9uc1ZlY3Rvci5wdXNoKG5ldyBBcnJheTxudW1iZXI+KCkpO1xuXHRcdFx0XHRcdG5vcm1hbHNWZWN0b3IucHVzaChuZXcgQXJyYXk8bnVtYmVyPigpKTtcblx0XHRcdFx0XHR0YW5nZW50c1ZlY3Rvci5wdXNoKG5ldyBBcnJheTxudW1iZXI+KCkpO1xuXHRcdFx0XHRcdHV2c1ZlY3Rvci5wdXNoKG5ldyBBcnJheTxudW1iZXI+KCkpO1xuXHRcdFx0XHRcdHN1Ykdlb21ldHJpZXMucHVzaChuZXcgVHJpYW5nbGVTdWJHZW9tZXRyeSh0cnVlKSk7XG5cdFx0XHRcdFx0dmVydGV4Q291bnRlcnMucHVzaCgwKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNvdXJjZVN1Ykdlb21ldHJ5ID0gc291cmNlU3ViR2VvbWV0cmllc1tzcmNJbmRleF07XG5cblx0XHRcdFx0Ly9hZGQgYSBuZXcgcGFydGljbGUgc3ViZ2VvbWV0cnkgaWYgdGhpcyBzb3VyY2Ugc3ViZ2VvbWV0cnkgd2lsbCB0YWtlIHVzIG92ZXIgdGhlIG1heHZlcnRleCBsaW1pdFxuXHRcdFx0XHRpZiAoc291cmNlU3ViR2VvbWV0cnkubnVtVmVydGljZXMgKyB2ZXJ0ZXhDb3VudGVyc1tzdWIyU3ViTWFwW3NyY0luZGV4XV0gPiBQYXJ0aWNsZUdlb21ldHJ5SGVscGVyLk1BWF9WRVJURVgpIHtcblx0XHRcdFx0XHQvL3VwZGF0ZSBzdWJtYXAgYW5kIGFkZCBuZXcgc3ViZ2VvbSB2ZWN0b3JzXG5cdFx0XHRcdFx0c3ViMlN1Yk1hcFtzcmNJbmRleF0gPSBzdWJHZW9tZXRyaWVzLmxlbmd0aDtcblx0XHRcdFx0XHRpbmRpY2VzVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSAvKnVpbnQqLyk7XG5cdFx0XHRcdFx0cG9zaXRpb25zVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSk7XG5cdFx0XHRcdFx0bm9ybWFsc1ZlY3Rvci5wdXNoKG5ldyBBcnJheTxudW1iZXI+KCkpO1xuXHRcdFx0XHRcdHRhbmdlbnRzVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSk7XG5cdFx0XHRcdFx0dXZzVmVjdG9yLnB1c2gobmV3IEFycmF5PG51bWJlcj4oKSk7XG5cdFx0XHRcdFx0c3ViR2VvbWV0cmllcy5wdXNoKG5ldyBUcmlhbmdsZVN1Ykdlb21ldHJ5KHRydWUpKTtcblx0XHRcdFx0XHR2ZXJ0ZXhDb3VudGVycy5wdXNoKDApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aiA9IHN1YjJTdWJNYXBbc3JjSW5kZXhdO1xuXG5cdFx0XHRcdC8vc2VsZWN0IHRoZSBjb3JyZWN0IHZlY3RvclxuXHRcdFx0XHRpbmRpY2VzID0gaW5kaWNlc1ZlY3RvcltqXTtcblx0XHRcdFx0cG9zaXRpb25zID0gcG9zaXRpb25zVmVjdG9yW2pdO1xuXHRcdFx0XHRub3JtYWxzID0gbm9ybWFsc1ZlY3RvcltqXTtcblx0XHRcdFx0dGFuZ2VudHMgPSB0YW5nZW50c1ZlY3RvcltqXTtcblx0XHRcdFx0dXZzID0gdXZzVmVjdG9yW2pdO1xuXHRcdFx0XHR2ZXJ0ZXhDb3VudGVyID0gdmVydGV4Q291bnRlcnNbal07XG5cdFx0XHRcdHN1Ykdlb21ldHJ5ID0gc3ViR2VvbWV0cmllc1tqXTtcblxuXHRcdFx0XHR2YXIgcGFydGljbGVEYXRhOlBhcnRpY2xlRGF0YSA9IG5ldyBQYXJ0aWNsZURhdGEoKTtcblx0XHRcdFx0cGFydGljbGVEYXRhLm51bVZlcnRpY2VzID0gc291cmNlU3ViR2VvbWV0cnkubnVtVmVydGljZXM7XG5cdFx0XHRcdHBhcnRpY2xlRGF0YS5zdGFydFZlcnRleEluZGV4ID0gdmVydGV4Q291bnRlcjtcblx0XHRcdFx0cGFydGljbGVEYXRhLnBhcnRpY2xlSW5kZXggPSBpO1xuXHRcdFx0XHRwYXJ0aWNsZURhdGEuc3ViR2VvbWV0cnkgPSBzdWJHZW9tZXRyeTtcblx0XHRcdFx0cGFydGljbGVzLnB1c2gocGFydGljbGVEYXRhKTtcblxuXHRcdFx0XHR2ZXJ0ZXhDb3VudGVyc1tqXSArPSBzb3VyY2VTdWJHZW9tZXRyeS5udW1WZXJ0aWNlcztcblxuXHRcdFx0XHR2YXIgazpudW1iZXIgLyppbnQqLztcblx0XHRcdFx0dmFyIHRlbXBMZW46bnVtYmVyIC8qaW50Ki87XG5cdFx0XHRcdHZhciBjb21wYWN0OlRyaWFuZ2xlU3ViR2VvbWV0cnkgPSBzb3VyY2VTdWJHZW9tZXRyeTtcblx0XHRcdFx0dmFyIHByb2R1Y3Q6bnVtYmVyIC8qdWludCovO1xuXHRcdFx0XHR2YXIgc291cmNlUG9zaXRpb25zOkFycmF5PG51bWJlcj47XG5cdFx0XHRcdHZhciBzb3VyY2VOb3JtYWxzOkFycmF5PG51bWJlcj47XG5cdFx0XHRcdHZhciBzb3VyY2VUYW5nZW50czpBcnJheTxudW1iZXI+O1xuXHRcdFx0XHR2YXIgc291cmNlVVZzOkFycmF5PG51bWJlcj47XG5cblx0XHRcdFx0aWYgKGNvbXBhY3QpIHtcblx0XHRcdFx0XHR0ZW1wTGVuID0gY29tcGFjdC5udW1WZXJ0aWNlcztcblx0XHRcdFx0XHRjb21wYWN0Lm51bVRyaWFuZ2xlcztcblx0XHRcdFx0XHRzb3VyY2VQb3NpdGlvbnMgPSBjb21wYWN0LnBvc2l0aW9ucztcblx0XHRcdFx0XHRzb3VyY2VOb3JtYWxzID0gY29tcGFjdC52ZXJ0ZXhOb3JtYWxzO1xuXHRcdFx0XHRcdHNvdXJjZVRhbmdlbnRzID0gY29tcGFjdC52ZXJ0ZXhUYW5nZW50cztcblx0XHRcdFx0XHRzb3VyY2VVVnMgPSBjb21wYWN0LnV2cztcblxuXHRcdFx0XHRcdGlmICh0cmFuc2Zvcm1zKSB7XG5cdFx0XHRcdFx0XHR2YXIgcGFydGljbGVHZW9tZXRyeVRyYW5zZm9ybTpQYXJ0aWNsZUdlb21ldHJ5VHJhbnNmb3JtID0gdHJhbnNmb3Jtc1tpXTtcblx0XHRcdFx0XHRcdHZhciB2ZXJ0ZXhUcmFuc2Zvcm06TWF0cml4M0QgPSBwYXJ0aWNsZUdlb21ldHJ5VHJhbnNmb3JtLnZlcnRleFRyYW5zZm9ybTtcblx0XHRcdFx0XHRcdHZhciBpbnZWZXJ0ZXhUcmFuc2Zvcm06TWF0cml4M0QgPSBwYXJ0aWNsZUdlb21ldHJ5VHJhbnNmb3JtLmludlZlcnRleFRyYW5zZm9ybTtcblx0XHRcdFx0XHRcdHZhciBVVlRyYW5zZm9ybTpNYXRyaXggPSBwYXJ0aWNsZUdlb21ldHJ5VHJhbnNmb3JtLlVWVHJhbnNmb3JtO1xuXG5cdFx0XHRcdFx0XHRmb3IgKGsgPSAwOyBrIDwgdGVtcExlbjsgaysrKSB7XG5cdFx0XHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0XHRcdCAqIDAgLSAyOiB2ZXJ0ZXggcG9zaXRpb24gWCwgWSwgWlxuXHRcdFx0XHRcdFx0XHQgKiAzIC0gNTogbm9ybWFsIFgsIFksIFpcblx0XHRcdFx0XHRcdFx0ICogNiAtIDg6IHRhbmdlbnQgWCwgWSwgWlxuXHRcdFx0XHRcdFx0XHQgKiA5IC0gMTA6IFUgVlxuXHRcdFx0XHRcdFx0XHQgKiAxMSAtIDEyOiBTZWNvbmRhcnkgVSBWKi9cblx0XHRcdFx0XHRcdFx0cHJvZHVjdCA9IGsqMztcblx0XHRcdFx0XHRcdFx0dGVtcFZlcnRleC54ID0gc291cmNlUG9zaXRpb25zW3Byb2R1Y3RdO1xuXHRcdFx0XHRcdFx0XHR0ZW1wVmVydGV4LnkgPSBzb3VyY2VQb3NpdGlvbnNbcHJvZHVjdCArIDFdO1xuXHRcdFx0XHRcdFx0XHR0ZW1wVmVydGV4LnogPSBzb3VyY2VQb3NpdGlvbnNbcHJvZHVjdCArIDJdO1xuXHRcdFx0XHRcdFx0XHR0ZW1wTm9ybWFsLnggPSBzb3VyY2VOb3JtYWxzW3Byb2R1Y3RdO1xuXHRcdFx0XHRcdFx0XHR0ZW1wTm9ybWFsLnkgPSBzb3VyY2VOb3JtYWxzW3Byb2R1Y3QgKyAxXTtcblx0XHRcdFx0XHRcdFx0dGVtcE5vcm1hbC56ID0gc291cmNlTm9ybWFsc1twcm9kdWN0ICsgMl07XG5cdFx0XHRcdFx0XHRcdHRlbXBUYW5nZW50cy54ID0gc291cmNlVGFuZ2VudHNbcHJvZHVjdF07XG5cdFx0XHRcdFx0XHRcdHRlbXBUYW5nZW50cy55ID0gc291cmNlVGFuZ2VudHNbcHJvZHVjdCArIDFdO1xuXHRcdFx0XHRcdFx0XHR0ZW1wVGFuZ2VudHMueiA9IHNvdXJjZVRhbmdlbnRzW3Byb2R1Y3QgKyAyXTtcblx0XHRcdFx0XHRcdFx0dGVtcFVWLnggPSBzb3VyY2VVVnNbayoyXTtcblx0XHRcdFx0XHRcdFx0dGVtcFVWLnkgPSBzb3VyY2VVVnNbayoyICsgMV07XG5cdFx0XHRcdFx0XHRcdGlmICh2ZXJ0ZXhUcmFuc2Zvcm0pIHtcblx0XHRcdFx0XHRcdFx0XHR0ZW1wVmVydGV4ID0gdmVydGV4VHJhbnNmb3JtLnRyYW5zZm9ybVZlY3Rvcih0ZW1wVmVydGV4KTtcblx0XHRcdFx0XHRcdFx0XHR0ZW1wTm9ybWFsID0gaW52VmVydGV4VHJhbnNmb3JtLmRlbHRhVHJhbnNmb3JtVmVjdG9yKHRlbXBOb3JtYWwpO1xuXHRcdFx0XHRcdFx0XHRcdHRlbXBUYW5nZW50cyA9IGludlZlcnRleFRyYW5zZm9ybS5kZWx0YVRyYW5zZm9ybVZlY3Rvcih0ZW1wTm9ybWFsKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRpZiAoVVZUcmFuc2Zvcm0pXG5cdFx0XHRcdFx0XHRcdFx0dGVtcFVWID0gVVZUcmFuc2Zvcm0udHJhbnNmb3JtUG9pbnQodGVtcFVWKTtcblx0XHRcdFx0XHRcdFx0Ly90aGlzIGlzIGZhc3RlciB0aGFuIHRoYXQgb25seSBwdXNoIG9uZSBkYXRhXG5cdFx0XHRcdFx0XHRcdHNvdXJjZVBvc2l0aW9ucy5wdXNoKHRlbXBWZXJ0ZXgueCwgdGVtcFZlcnRleC55LCB0ZW1wVmVydGV4LnopO1xuXHRcdFx0XHRcdFx0XHRzb3VyY2VOb3JtYWxzLnB1c2godGVtcE5vcm1hbC54LCB0ZW1wTm9ybWFsLnksIHRlbXBOb3JtYWwueik7XG5cdFx0XHRcdFx0XHRcdHNvdXJjZVRhbmdlbnRzLnB1c2godGVtcFRhbmdlbnRzLngsIHRlbXBUYW5nZW50cy55LCB0ZW1wVGFuZ2VudHMueik7XG5cdFx0XHRcdFx0XHRcdHNvdXJjZVVWcy5wdXNoKHRlbXBVVi54LCB0ZW1wVVYueSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGZvciAoayA9IDA7IGsgPCB0ZW1wTGVuOyBrKyspIHtcblx0XHRcdFx0XHRcdFx0cHJvZHVjdCA9IGsqMztcblx0XHRcdFx0XHRcdFx0Ly90aGlzIGlzIGZhc3RlciB0aGFuIHRoYXQgb25seSBwdXNoIG9uZSBkYXRhXG5cdFx0XHRcdFx0XHRcdHBvc2l0aW9ucy5wdXNoKHNvdXJjZVBvc2l0aW9uc1twcm9kdWN0XSwgc291cmNlUG9zaXRpb25zW3Byb2R1Y3QgKyAxXSwgc291cmNlUG9zaXRpb25zW3Byb2R1Y3QgKyAyXSk7XG5cdFx0XHRcdFx0XHRcdG5vcm1hbHMucHVzaChzb3VyY2VOb3JtYWxzW3Byb2R1Y3RdLCBzb3VyY2VOb3JtYWxzW3Byb2R1Y3QgKyAxXSwgc291cmNlTm9ybWFsc1twcm9kdWN0ICsgMl0pO1xuXHRcdFx0XHRcdFx0XHR0YW5nZW50cy5wdXNoKHNvdXJjZVRhbmdlbnRzW3Byb2R1Y3RdLCBzb3VyY2VUYW5nZW50c1twcm9kdWN0ICsgMV0sIHNvdXJjZVRhbmdlbnRzW3Byb2R1Y3QgKyAyXSk7XG5cdFx0XHRcdFx0XHRcdHV2cy5wdXNoKHNvdXJjZVVWc1trKjJdLCBzb3VyY2VVVnNbayoyICsgMV0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvL1RvZG9cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciBzb3VyY2VJbmRpY2VzOkFycmF5PG51bWJlcj4gLyp1aW50Ki8gPSBzb3VyY2VTdWJHZW9tZXRyeS5pbmRpY2VzO1xuXHRcdFx0XHR0ZW1wTGVuID0gc291cmNlU3ViR2VvbWV0cnkubnVtVHJpYW5nbGVzO1xuXHRcdFx0XHRmb3IgKGsgPSAwOyBrIDwgdGVtcExlbjsgaysrKSB7XG5cdFx0XHRcdFx0cHJvZHVjdCA9IGsqMztcblx0XHRcdFx0XHRpbmRpY2VzLnB1c2goc291cmNlSW5kaWNlc1twcm9kdWN0XSArIHZlcnRleENvdW50ZXIsIHNvdXJjZUluZGljZXNbcHJvZHVjdCArIDFdICsgdmVydGV4Q291bnRlciwgc291cmNlSW5kaWNlc1twcm9kdWN0ICsgMl0gKyB2ZXJ0ZXhDb3VudGVyKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHZhciBwYXJ0aWNsZUdlb21ldHJ5OlBhcnRpY2xlR2VvbWV0cnkgPSBuZXcgUGFydGljbGVHZW9tZXRyeSgpO1xuXHRcdHBhcnRpY2xlR2VvbWV0cnkucGFydGljbGVzID0gcGFydGljbGVzO1xuXHRcdHBhcnRpY2xlR2VvbWV0cnkubnVtUGFydGljbGVzID0gbnVtUGFydGljbGVzO1xuXG5cdFx0bnVtUGFydGljbGVzID0gc3ViR2VvbWV0cmllcy5sZW5ndGg7XG5cdFx0Zm9yIChpID0gMDsgaSA8IG51bVBhcnRpY2xlczsgaSsrKSB7XG5cdFx0XHRzdWJHZW9tZXRyeSA9IHN1Ykdlb21ldHJpZXNbaV07XG5cdFx0XHRzdWJHZW9tZXRyeS5hdXRvRGVyaXZlTm9ybWFscyA9IGZhbHNlO1xuXHRcdFx0c3ViR2VvbWV0cnkuYXV0b0Rlcml2ZVRhbmdlbnRzID0gZmFsc2U7XG5cdFx0XHRzdWJHZW9tZXRyeS51cGRhdGVJbmRpY2VzKGluZGljZXNWZWN0b3JbaV0pO1xuXHRcdFx0c3ViR2VvbWV0cnkudXBkYXRlUG9zaXRpb25zKHBvc2l0aW9uc1ZlY3RvcltpXSk7XG5cdFx0XHRzdWJHZW9tZXRyeS51cGRhdGVWZXJ0ZXhOb3JtYWxzKG5vcm1hbHNWZWN0b3JbaV0pO1xuXHRcdFx0c3ViR2VvbWV0cnkudXBkYXRlVmVydGV4VGFuZ2VudHModGFuZ2VudHNWZWN0b3JbaV0pO1xuXHRcdFx0c3ViR2VvbWV0cnkudXBkYXRlVVZzKHV2c1ZlY3RvcltpXSk7XG5cdFx0XHRwYXJ0aWNsZUdlb21ldHJ5LmFkZFN1Ykdlb21ldHJ5KHN1Ykdlb21ldHJ5KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcGFydGljbGVHZW9tZXRyeTtcblx0fVxufVxuXG5leHBvcnQgPSBQYXJ0aWNsZUdlb21ldHJ5SGVscGVyOyJdfQ==