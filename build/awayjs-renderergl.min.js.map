{
  "version": 3,
  "sources": [
    "node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "awayjs-renderergl.js",
    "awayjs-renderergl/lib/DefaultRenderer.ts",
    "awayjs-renderergl/lib/DepthRenderer.ts",
    "awayjs-renderergl/lib/DistanceRenderer.ts",
    "awayjs-renderergl/lib/Filter3DRenderer.ts",
    "awayjs-renderergl/lib/RendererBase.ts",
    "awayjs-renderergl/lib/animators/AnimationSetBase.ts",
    "awayjs-renderergl/lib/animators/AnimatorBase.ts",
    "awayjs-renderergl/lib/animators/ParticleAnimationSet.ts",
    "awayjs-renderergl/lib/animators/ParticleAnimator.ts",
    "awayjs-renderergl/lib/animators/SkeletonAnimationSet.ts",
    "awayjs-renderergl/lib/animators/SkeletonAnimator.ts",
    "awayjs-renderergl/lib/animators/VertexAnimationSet.ts",
    "awayjs-renderergl/lib/animators/VertexAnimator.ts",
    "awayjs-renderergl/lib/animators/data/AnimationRegisterCache.ts",
    "awayjs-renderergl/lib/animators/data/AnimationSubGeometry.ts",
    "awayjs-renderergl/lib/animators/data/ColorSegmentPoint.ts",
    "awayjs-renderergl/lib/animators/data/JointPose.ts",
    "awayjs-renderergl/lib/animators/data/ParticleAnimationData.ts",
    "awayjs-renderergl/lib/animators/data/ParticleData.ts",
    "awayjs-renderergl/lib/animators/data/ParticlePropertiesMode.ts",
    "awayjs-renderergl/lib/animators/data/ParticleProperties.ts",
    "awayjs-renderergl/lib/animators/data/SkeletonJoint.ts",
    "awayjs-renderergl/lib/animators/data/SkeletonPose.ts",
    "awayjs-renderergl/lib/animators/data/Skeleton.ts",
    "awayjs-renderergl/lib/animators/data/VertexAnimationMode.ts",
    "awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleColorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleFollowNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleNodeBase.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticlePositionNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleScaleNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleTimeNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleUVNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonClipNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode.ts",
    "awayjs-renderergl/lib/animators/nodes/VertexClipNode.ts",
    "awayjs-renderergl/lib/animators/states/AnimationClipState.ts",
    "awayjs-renderergl/lib/animators/states/AnimationStateBase.ts",
    "awayjs-renderergl/lib/animators/states/ParticleAccelerationState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleBezierCurveState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleBillboardState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleColorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleFollowState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleInitialColorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleOrbitState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleOscillatorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticlePositionState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleScaleState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleStateBase.ts",
    "awayjs-renderergl/lib/animators/states/ParticleTimeState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleUVState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleVelocityState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonClipState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonDifferenceState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonDirectionalState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState.ts",
    "awayjs-renderergl/lib/animators/states/VertexClipState.ts",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode.ts",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState.ts",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransition.ts",
    "awayjs-renderergl/lib/base/ParticleGeometry.ts",
    "awayjs-renderergl/lib/errors/AnimationSetError.ts",
    "awayjs-renderergl/lib/events/AnimationStateEvent.ts",
    "awayjs-renderergl/lib/events/AnimatorEvent.ts",
    "awayjs-renderergl/lib/events/ShadingMethodEvent.ts",
    "awayjs-renderergl/lib/filters/BlurFilter3D.ts",
    "awayjs-renderergl/lib/filters/CompositeFilter3D.ts",
    "awayjs-renderergl/lib/filters/Filter3DBase.ts",
    "awayjs-renderergl/lib/filters/tasks/Filter3DCompositeTask.ts",
    "awayjs-renderergl/lib/filters/tasks/Filter3DFXAATask.ts",
    "awayjs-renderergl/lib/filters/tasks/Filter3DHBlurTask.ts",
    "awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase.ts",
    "awayjs-renderergl/lib/filters/tasks/Filter3DVBlurTask.ts",
    "awayjs-renderergl/lib/managers/RTTBufferManager.ts",
    "awayjs-renderergl/lib/pick/ShaderPicker.ts",
    "awayjs-renderergl/lib/render/BasicMaterialRender.ts",
    "awayjs-renderergl/lib/render/DepthRender.ts",
    "awayjs-renderergl/lib/render/DistanceRender.ts",
    "awayjs-renderergl/lib/render/RenderBase.ts",
    "awayjs-renderergl/lib/render/RenderPassBase.ts",
    "awayjs-renderergl/lib/render/RenderPool.ts",
    "awayjs-renderergl/lib/render/SkyboxRender.ts",
    "awayjs-renderergl/lib/render/passes/BasicMaterialPass.ts",
    "awayjs-renderergl/lib/render/passes/PassBase.ts",
    "awayjs-renderergl/lib/renderables/BillboardRenderable.ts",
    "awayjs-renderergl/lib/renderables/CurveSubMeshRenderable.ts",
    "awayjs-renderergl/lib/renderables/LineSegmentRenderable.ts",
    "awayjs-renderergl/lib/renderables/LineSubMeshRenderable.ts",
    "awayjs-renderergl/lib/renderables/RenderableBase.ts",
    "awayjs-renderergl/lib/renderables/RenderablePool.ts",
    "awayjs-renderergl/lib/renderables/SkyboxRenderable.ts",
    "awayjs-renderergl/lib/renderables/TriangleSubMeshRenderable.ts",
    "awayjs-renderergl/lib/shaders/LightingShader.ts",
    "awayjs-renderergl/lib/shaders/RegisterPool.ts",
    "awayjs-renderergl/lib/shaders/ShaderBase.ts",
    "awayjs-renderergl/lib/shaders/ShaderRegisterCache.ts",
    "awayjs-renderergl/lib/shaders/ShaderRegisterData.ts",
    "awayjs-renderergl/lib/shaders/ShaderRegisterElement.ts",
    "awayjs-renderergl/lib/shaders/compilers/CompilerBase.ts",
    "awayjs-renderergl/lib/shaders/compilers/LightingCompiler.ts",
    "awayjs-renderergl/lib/tools/commands/Merge.ts",
    "awayjs-renderergl/lib/tools/data/ParticleGeometryTransform.ts",
    "awayjs-renderergl/lib/utils/ParticleGeometryHelper.ts",
    "awayjs-renderergl/lib/utils/PerspectiveMatrix3D.ts",
    "awayjs-renderergl/lib/vos/CurveSubGeometryVO.ts",
    "awayjs-renderergl/lib/vos/LineSubGeometryVO.ts",
    "awayjs-renderergl/lib/vos/Sampler2DVO.ts",
    "awayjs-renderergl/lib/vos/SamplerCubeVO.ts",
    "awayjs-renderergl/lib/vos/SamplerVOBase.ts",
    "awayjs-renderergl/lib/vos/Single2DTextureVO.ts",
    "awayjs-renderergl/lib/vos/SingleCubeTextureVO.ts",
    "awayjs-renderergl/lib/vos/SubGeometryVOBase.ts",
    "awayjs-renderergl/lib/vos/SubGeometryVOPool.ts",
    "awayjs-renderergl/lib/vos/TextureVOBase.ts",
    "awayjs-renderergl/lib/vos/TextureVOPool.ts",
    "awayjs-renderergl/lib/vos/TriangleSubGeometryVO.ts"
  ],
  "names": [
    "require",
    "e",
    "t",
    "n",
    "r",
    "s",
    "o",
    "u",
    "a",
    "i",
    "f",
    "Error",
    "code",
    "l",
    "exports",
    "call",
    "length",
    "awayjs-renderergl/lib/DefaultRenderer",
    "module",
    "__extends",
    "this",
    "d",
    "b",
    "p",
    "hasOwnProperty",
    "__",
    "constructor",
    "prototype",
    "BitmapImage2D",
    "Matrix3D",
    "Vector3D",
    "ContextGLCompareMode",
    "ContextGLClearMask",
    "RendererBase",
    "DepthRenderer",
    "DistanceRenderer",
    "Filter3DRenderer",
    "RenderablePool",
    "RTTBufferManager",
    "DefaultRenderer",
    "_super",
    "stage",
    "forceSoftware",
    "profile",
    "mode",
    "_skyboxProjection",
    "_pRenderablePool",
    "_pStage",
    "_shareContext",
    "_pRttBufferManager",
    "getInstance",
    "_pDepthRenderer",
    "_pDistanceRenderer",
    "_width",
    "width",
    "window",
    "innerWidth",
    "viewWidth",
    "_height",
    "height",
    "innerHeight",
    "viewHeight",
    "Object",
    "defineProperty",
    "get",
    "_antiAlias",
    "set",
    "value",
    "_pBackBufferInvalid",
    "enumerable",
    "configurable",
    "_depthPrepass",
    "_pFilter3DRenderer",
    "filters",
    "dispose",
    "_pRequireDepthRender",
    "requireDepthRender",
    "_pDepthRender",
    "render",
    "entityCollector",
    "recoverFromDisposal",
    "pUpdateBackBuffer",
    "_pContext",
    "clear",
    "DEPTH",
    "textureRatioX",
    "textureRatioY",
    "pRenderSceneDepthToTexture",
    "pRenderDepthPrepass",
    "_iRender",
    "getMainInputTexture",
    "renderToTextureRect",
    "camera",
    "_pScissorRect",
    "present",
    "bufferClear",
    "pExecuteRender",
    "target",
    "scissorRect",
    "surfaceSelector",
    "updateLights",
    "dirLights",
    "directionalLights",
    "pointLights",
    "len",
    "light",
    "shadowMapper",
    "castsShadows",
    "autoUpdateShadows",
    "_iShadowsInvalid",
    "iRenderDepthMap",
    "pDraw",
    "skyBox",
    "setDepthTest",
    "ALWAYS",
    "drawSkybox",
    "renderable",
    "getItem",
    "updateSkyboxProjection",
    "getRenderPool",
    "renderableOwner",
    "renderOwner",
    "pass",
    "passes",
    "activatePass",
    "deactivatePass",
    "near",
    "copyFrom",
    "_pRttViewProjectionMatrix",
    "copyRowTo",
    "camPos",
    "scenePosition",
    "cx",
    "x",
    "cy",
    "y",
    "cz",
    "z",
    "cw",
    "Math",
    "sqrt",
    "signX",
    "signY",
    "inverse",
    "clone",
    "invert",
    "q",
    "transformVector",
    "w",
    "copyRowFrom",
    "disableColor",
    "_pDepthTextureInvalid",
    "initDepthTexture",
    "context",
    "configureBackBuffer",
    "textureWidth",
    "textureHeight",
    "awayjs-core/lib/data/BitmapImage2D",
    "undefined",
    "awayjs-core/lib/geom/Matrix3D",
    "awayjs-core/lib/geom/Vector3D",
    "awayjs-renderergl/lib/DepthRenderer",
    "awayjs-renderergl/lib/DistanceRenderer",
    "awayjs-renderergl/lib/Filter3DRenderer",
    "awayjs-renderergl/lib/RendererBase",
    "awayjs-renderergl/lib/managers/RTTBufferManager",
    "awayjs-renderergl/lib/renderables/RenderablePool",
    "awayjs-stagegl/lib/base/ContextGLClearMask",
    "awayjs-stagegl/lib/base/ContextGLCompareMode",
    "DepthRender",
    "_iBackgroundR",
    "_iBackgroundG",
    "_iBackgroundB",
    "awayjs-renderergl/lib/render/DepthRender",
    "DistanceRender",
    "awayjs-renderergl/lib/render/DistanceRender",
    "Event",
    "ContextGLDrawMode",
    "ContextGLBlendFactor",
    "ContextGLVertexBufferFormat",
    "_this",
    "_filterSizesInvalid",
    "_onRTTResizeDelegate",
    "event",
    "onRTTResize",
    "_stage",
    "_rttManager",
    "addEventListener",
    "RESIZE",
    "_requireDepthRender",
    "_filterTasksInvalid",
    "updateFilterTasks",
    "_mainInputTexture",
    "_filters",
    "updateFilterSizes",
    "_tasks",
    "Array",
    "filter",
    "setRenderTargets",
    "concat",
    "tasks",
    "depthTexture",
    "task",
    "indexBuffer",
    "vertexBuffer",
    "renderToTextureVertexBuffer",
    "update",
    "setProgram",
    "getProgram",
    "setVertexBufferAt",
    "FLOAT_2",
    "setRenderTarget",
    "getImageObject",
    "activate",
    "renderToScreenVertexBuffer",
    "setBlendFactors",
    "ONE",
    "ZERO",
    "drawIndices",
    "TRIANGLES",
    "deactivate",
    "setTextureAt",
    "removeEventListener",
    "awayjs-core/lib/events/Event",
    "awayjs-stagegl/lib/base/ContextGLBlendFactor",
    "awayjs-stagegl/lib/base/ContextGLDrawMode",
    "awayjs-stagegl/lib/base/ContextGLVertexBufferFormat",
    "Point",
    "Rectangle",
    "EventDispatcher",
    "RenderableMergeSort",
    "RendererEvent",
    "EntityCollector",
    "AGALMiniAssembler",
    "StageEvent",
    "StageManager",
    "_activeMasksConfig",
    "_registeredMasks",
    "_numUsedStreams",
    "_numUsedTextures",
    "_viewPort",
    "_backgroundR",
    "_backgroundG",
    "_backgroundB",
    "_backgroundAlpha",
    "_localPos",
    "_globalPos",
    "_pNumElements",
    "_disableColor",
    "_renderBlended",
    "_onViewportUpdatedDelegate",
    "onViewportUpdated",
    "_onContextUpdateDelegate",
    "onContextUpdate",
    "renderableSorter",
    "getFreeStage",
    "CONTEXT_CREATED",
    "CONTEXT_RECREATED",
    "VIEWPORT_UPDATED",
    "updateGlobalPos",
    "notifyScissorUpdate",
    "shader",
    "numUsedStreams",
    "numUsedTextures",
    "programData",
    "program",
    "createProgram",
    "vertexByteCode",
    "assemble",
    "vertexString",
    "data",
    "fragmentByteCode",
    "fragmentString",
    "upload",
    "_iActivate",
    "_iDeactivate",
    "_iCreateEntityCollector",
    "_viewportDirty",
    "_scissorDirty",
    "viewProjection",
    "appendScale",
    "_iRenderCascades",
    "numCascades",
    "scissorRects",
    "cameras",
    "_applyCollector",
    "LESS",
    "head",
    "_pOpaqueRenderableHead",
    "first",
    "LESS_EQUAL",
    "_pBlendedRenderableHead",
    "item",
    "entityHead",
    "_pCamera",
    "_iEntryPoint",
    "_pCameraForward",
    "transform",
    "forwardVector",
    "entity",
    "_applyRenderer",
    "next",
    "sortOpaqueRenderables",
    "sortBlendedRenderables",
    "_snapshotRequired",
    "_snapshotBitmapImage2D",
    "drawToBitmapImage2D",
    "queueSnapshot",
    "bmd",
    "setColorMask",
    "drawRenderables",
    "renderable2",
    "setStencilActions",
    "gl",
    "disable",
    "STENCIL_TEST",
    "_maskConfig",
    "_renderOwner",
    "alphaThreshold",
    "_activeMasksDirty",
    "_checkMasksConfig",
    "masksConfig",
    "stencilFunc",
    "stencilOp",
    "KEEP",
    "_renderMasks",
    "sourceEntity",
    "_iAssignedMasks",
    "maskId",
    "_registerMask",
    "_scissorUpdated",
    "SCISSOR_UPDATED",
    "dispatchEvent",
    "notifyViewportUpdate",
    "_viewPortUpdated",
    "viewPort",
    "_iApplyRenderableOwner",
    "renderId",
    "renderOrderId",
    "cascaded",
    "position",
    "subtract",
    "zIndex",
    "zOffset",
    "dotProduct",
    "_iAssignedMaskId",
    "_iMasksConfig",
    "renderSceneTransform",
    "getRenderSceneTransform",
    "requiresBlending",
    "subGeometryVO",
    "subGeometry",
    "numElements",
    "obj",
    "push",
    "masks",
    "enable",
    "REPLACE",
    "numLayers",
    "numRenderables",
    "children",
    "numChildren",
    "mask",
    "EQUAL",
    "INCR",
    "j",
    "k",
    "id",
    "_drawMask",
    "childConfig",
    "activeNumChildren",
    "activeChildConfig",
    "awayjs-core/lib/events/EventDispatcher",
    "awayjs-core/lib/geom/Point",
    "awayjs-core/lib/geom/Rectangle",
    "awayjs-display/lib/events/RendererEvent",
    "awayjs-display/lib/sort/RenderableMergeSort",
    "awayjs-display/lib/traverse/EntityCollector",
    "awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler",
    "awayjs-stagegl/lib/events/StageEvent",
    "awayjs-stagegl/lib/managers/StageManager",
    "awayjs-renderergl/lib/animators/AnimationSetBase",
    "AssetBase",
    "AbstractMethodError",
    "AnimationSetError",
    "AnimationSetBase",
    "_animations",
    "_animationNames",
    "_animationDictionary",
    "_pFindTempReg",
    "exclude",
    "excludeAnother",
    "reg",
    "indexOf",
    "_usesCPU",
    "resetGPUCompatibility",
    "cancelGPUCompatibility",
    "getAGALVertexCode",
    "getAGALFragmentCode",
    "shadedTarget",
    "getAGALUVCode",
    "doneAGALCode",
    "assetType",
    "hasAnimation",
    "name",
    "getAnimation",
    "addAnimation",
    "node",
    "awayjs-core/lib/errors/AbstractMethodError",
    "awayjs-core/lib/library/AssetBase",
    "awayjs-renderergl/lib/errors/AnimationSetError",
    "awayjs-renderergl/lib/animators/AnimatorBase",
    "RequestAnimationFrame",
    "getTimer",
    "AnimatorEvent",
    "AnimatorBase",
    "animationSet",
    "_autoUpdate",
    "_time",
    "_playbackSpeed",
    "_pOwners",
    "_pAbsoluteTime",
    "_animationStates",
    "updatePosition",
    "_pAnimationSet",
    "_broadcaster",
    "onEnterFrame",
    "getAnimationState",
    "className",
    "stateClass",
    "uID",
    "getAnimationStateByName",
    "_pActiveState",
    "_pActiveAnimationName",
    "start",
    "stop",
    "phase",
    "setRenderState",
    "vertexConstantOffset",
    "vertexStreamOffset",
    "_isPlaying",
    "hasEventListener",
    "START",
    "_startEvent",
    "STOP",
    "_stopEvent",
    "time",
    "dt",
    "playbackSpeed",
    "_pUpdateDeltaTime",
    "reset",
    "offset",
    "addOwner",
    "mesh",
    "removeOwner",
    "splice",
    "applyPositionDelta",
    "delta",
    "positionDelta",
    "dist",
    "translateLocal",
    "dispatchCycleEvent",
    "CYCLE_COMPLETE",
    "_cycleEvent",
    "testGPUCompatibility",
    "getRenderableSubGeometry",
    "sourceSubGeometry",
    "awayjs-core/lib/utils/RequestAnimationFrame",
    "awayjs-core/lib/utils/getTimer",
    "awayjs-renderergl/lib/events/AnimatorEvent",
    "awayjs-renderergl/lib/animators/ParticleAnimationSet",
    "AnimationRegisterCache",
    "AnimationSubGeometry",
    "ParticleAnimationData",
    "ParticleProperties",
    "ParticlePropertiesMode",
    "ParticleTimeNode",
    "ParticleAnimationSet",
    "usesDuration",
    "usesLooping",
    "usesDelay",
    "_animationSubGeometries",
    "_particleNodes",
    "_localDynamicNodes",
    "_localStaticNodes",
    "_totalLenOfOneVertex",
    "_timeNode",
    "_iProcessAnimationSetting",
    "LOCAL_STATIC",
    "_iDataOffset",
    "dataLength",
    "LOCAL_DYNAMIC",
    "priority",
    "_iAnimationRegisterCache",
    "animationRegisterCache",
    "numUsedVertexConstants",
    "vertexAttributesOffset",
    "varyingsOffset",
    "numUsedVaryings",
    "fragmentConstantOffset",
    "numUsedFragmentConstants",
    "hasUVNode",
    "needVelocity",
    "hasBillboard",
    "sourceRegisters",
    "animatableAttributes",
    "targetRegisters",
    "animationTargetRegisters",
    "needFragmentAnimation",
    "usesFragmentAnimation",
    "needUVAnimation",
    "usesUVTransform",
    "hasColorAddNode",
    "hasColorMulNode",
    "getInitCode",
    "POST_PRIORITY",
    "getCombinationCode",
    "COLOR_PRIORITY",
    "initColorRegisters",
    "getColorPassCode",
    "setUVSourceAndTarget",
    "uvSource",
    "uvTarget",
    "uvAttribute",
    "toString",
    "uvVar",
    "getColorCombinationCode",
    "setDataLength",
    "setVertexConst",
    "vertexZeroConst",
    "index",
    "key",
    "getAnimationSubGeometry",
    "subMesh",
    "parentMesh",
    "animationSubGeometry",
    "_iGenerateAnimationSubGeometries",
    "initParticleFunc",
    "geometry",
    "newAnimationSubGeometry",
    "localNode",
    "subMeshes",
    "shareAnimationGeometry",
    "createVertexData",
    "numVertices",
    "particles",
    "particlesLength",
    "numParticles",
    "particleProperties",
    "particle",
    "oneDataLen",
    "oneDataOffset",
    "counterForVertex",
    "counterForOneData",
    "oneData",
    "vertexData",
    "vertexLength",
    "startingOffset",
    "vertexOffset",
    "total",
    "startTime",
    "duration",
    "delay",
    "initParticleScope",
    "_iGeneratePropertyOfOneParticle",
    "particleIndex",
    "numProcessedVertices",
    "animationParticles",
    "awayjs-renderergl/lib/animators/data/AnimationRegisterCache",
    "awayjs-renderergl/lib/animators/data/AnimationSubGeometry",
    "awayjs-renderergl/lib/animators/data/ParticleAnimationData",
    "awayjs-renderergl/lib/animators/data/ParticleProperties",
    "awayjs-renderergl/lib/animators/data/ParticlePropertiesMode",
    "awayjs-renderergl/lib/animators/nodes/ParticleTimeNode",
    "awayjs-renderergl/lib/animators/ParticleAnimator",
    "ContextGLProgramType",
    "ParticleAnimator",
    "particleAnimationSet",
    "_animationParticleStates",
    "_animatorParticleStates",
    "_timeParticleStates",
    "_animatorSubGeometries",
    "_particleAnimationSet",
    "state",
    "particleNodes",
    "needUpdateTime",
    "animatorSubGeometry",
    "getAnimatorSubGeometry",
    "setProgramConstantsFromArray",
    "VERTEX",
    "vertexConstantData",
    "numVertexConstant",
    "numFragmentConstant",
    "FRAGMENT",
    "fragmentConstantData",
    "resetTime",
    "awayjs-stagegl/lib/base/ContextGLProgramType",
    "awayjs-renderergl/lib/animators/SkeletonAnimationSet",
    "SkeletonAnimationSet",
    "jointsPerVertex",
    "_jointsPerVertex",
    "indexOffset0",
    "indexOffset1",
    "indexOffset2",
    "indexStream",
    "weightStream",
    "indices",
    "weights",
    "temp1",
    "temp2",
    "dot",
    "src",
    "awayjs-renderergl/lib/animators/SkeletonAnimator",
    "SubGeometryEvent",
    "JointPose",
    "SkeletonPose",
    "AnimationStateEvent",
    "SkeletonAnimator",
    "skeleton",
    "forceCPU",
    "_globalPose",
    "_morphedSubGeometry",
    "_morphedSubGeometryDirty",
    "_skeleton",
    "_forceCPU",
    "_numJoints",
    "numJoints",
    "_globalMatrices",
    "Float32Array",
    "_onTransitionCompleteDelegate",
    "onTransitionComplete",
    "_onIndicesUpdateDelegate",
    "onIndicesUpdate",
    "_onVerticesUpdateDelegate",
    "onVerticesUpdate",
    "_globalPropertiesDirty",
    "updateGlobalProperties",
    "_useCondensedIndices",
    "play",
    "transition",
    "NaN",
    "_pActiveNode",
    "getAnimationNode",
    "TRANSITION_COMPLETE",
    "_activeSkeletonState",
    "isNaN",
    "useCondensedIndices",
    "updateCondensedMatrices",
    "condensedIndexLookUp",
    "_condensedMatrices",
    "usesCPU",
    "morphSubGeometry",
    "jointIndexIndex",
    "jointWeightIndex",
    "srcIndex",
    "localToGlobalPose",
    "getSkeletonPose",
    "mtxOffset",
    "globalPoses",
    "jointPoses",
    "raw",
    "ox",
    "oy",
    "oz",
    "ow",
    "xy2",
    "xz2",
    "xw2",
    "yz2",
    "yw2",
    "zw2",
    "n11",
    "n12",
    "n13",
    "n21",
    "n22",
    "n23",
    "n31",
    "n32",
    "n33",
    "m11",
    "m12",
    "m13",
    "m14",
    "m21",
    "m22",
    "m23",
    "m24",
    "m31",
    "m32",
    "m33",
    "m34",
    "joints",
    "pose",
    "quat",
    "vec",
    "orientation",
    "translation",
    "inverseBindPose",
    "targetSubGeometry",
    "autoDeriveNormals",
    "autoDeriveTangents",
    "autoDeriveUVs",
    "INDICES_UPDATED",
    "VERTICES_UPDATED",
    "sourcePositions",
    "positions",
    "sourceNormals",
    "normals",
    "sourceTangents",
    "tangents",
    "jointIndices",
    "jointWeights",
    "targetPositions",
    "targetNormals",
    "targetTangents",
    "vx",
    "vy",
    "vz",
    "nx",
    "ny",
    "nz",
    "tx",
    "ty",
    "tz",
    "weight",
    "vertX",
    "vertY",
    "vertZ",
    "normX",
    "normY",
    "normZ",
    "tangX",
    "tangY",
    "tangZ",
    "setPositions",
    "setNormals",
    "setTangents",
    "sourcePose",
    "targetPose",
    "globalJointPose",
    "numJointPoses",
    "parentIndex",
    "joint",
    "parentPose",
    "or",
    "tr",
    "x1",
    "y1",
    "z1",
    "w1",
    "x2",
    "y2",
    "z2",
    "w2",
    "x3",
    "y3",
    "z3",
    "type",
    "animationNode",
    "animationState",
    "setIndices",
    "morphGeometry",
    "attributesView",
    "uvs",
    "setUVs",
    "secondaryUVs",
    "setSecondaryUVs",
    "awayjs-display/lib/events/SubGeometryEvent",
    "awayjs-renderergl/lib/animators/data/JointPose",
    "awayjs-renderergl/lib/animators/data/SkeletonPose",
    "awayjs-renderergl/lib/events/AnimationStateEvent",
    "awayjs-renderergl/lib/animators/VertexAnimationSet",
    "VertexAnimationMode",
    "VertexAnimationSet",
    "numPoses",
    "blendMode",
    "_numPoses",
    "_blendMode",
    "ABSOLUTE",
    "getAbsoluteAGALCode",
    "getAdditiveAGALCode",
    "regs",
    "constantReg",
    "streamIndex",
    "tangentDependencies",
    "outputsNormals",
    "normalDependencies",
    "awayjs-renderergl/lib/animators/data/VertexAnimationMode",
    "awayjs-renderergl/lib/animators/VertexAnimator",
    "SubGeometryVOPool",
    "VertexAnimator",
    "vertexAnimationSet",
    "_poses",
    "_weights",
    "_vertexAnimationSet",
    "_subGeometryVOPool",
    "getPool",
    "_activeVertexState",
    "geometryFlag",
    "currentGeometry",
    "nextGeometry",
    "blendWeight",
    "_iInvalidateRenderableGeometries",
    "subGeom",
    "setNullPose",
    "subGeometries",
    "_iIndex",
    "_indexMappings",
    "indexMappings",
    "activateVertexBufferVO",
    "awayjs-renderergl/lib/vos/SubGeometryVOPool",
    "ShaderRegisterCache",
    "ShaderRegisterElement",
    "indexDictionary",
    "rotationRegisters",
    "positionAttribute",
    "getRegisterFromString",
    "scaleAndRotateTarget",
    "addVertexTempUsages",
    "regName",
    "getFreeVertexConstant",
    "vertexOneConst",
    "vertexTwoConst",
    "positionTarget",
    "getFreeVertexVectorTemp",
    "velocityTarget",
    "vertexTime",
    "vertexLife",
    "tempTime",
    "UVAttribute",
    "UVVaring",
    "setRegisterIndex",
    "parameterIndex",
    "registerIndex",
    "getRegisterIndex",
    "colorMulTarget",
    "colorMulVary",
    "getFreeVarying",
    "colorAddTarget",
    "colorAddVary",
    "colorTarget",
    "addFragmentTempUsages",
    "temp",
    "split",
    "parseInt",
    "_numVertexConstant",
    "_numFragmentConstant",
    "_index",
    "setVertexConstFromArray",
    "setVertexConstFromMatrix",
    "matrix",
    "rawData",
    "setFragmentConst",
    "awayjs-renderergl/lib/shaders/ShaderRegisterCache",
    "awayjs-renderergl/lib/shaders/ShaderRegisterElement",
    "_pVertexBuffer",
    "_pBufferContext",
    "_pBufferDirty",
    "previousTime",
    "Number",
    "NEGATIVE_INFINITY",
    "_iUniqueId",
    "SUBGEOM_ID_COUNT",
    "totalLenOfOneVertex",
    "_numVertices",
    "_pVertexData",
    "activateVertexBuffer",
    "bufferOffset",
    "format",
    "contextIndex",
    "stageIndex",
    "buffer",
    "createVertexBuffer",
    "uploadFromArray",
    "pop",
    "invalidateBuffer",
    "awayjs-renderergl/lib/animators/data/ColorSegmentPoint",
    "ColorSegmentPoint",
    "life",
    "color",
    "_life",
    "_color",
    "Quaternion",
    "toMatrix3D",
    "appendTranslation",
    "awayjs-core/lib/geom/Quaternion",
    "totalTime",
    "startVertexIndex",
    "awayjs-renderergl/lib/animators/data/ParticleData",
    "ParticleData",
    "GLOBAL",
    "awayjs-renderergl/lib/animators/data/SkeletonJoint",
    "SkeletonJoint",
    "jointPoseFromName",
    "jointName",
    "jointPoseIndex",
    "jointPoseIndexFromName",
    "jointPose",
    "cloneJointPose",
    "thisJointPose",
    "awayjs-renderergl/lib/animators/data/Skeleton",
    "Skeleton",
    "jointFromName",
    "jointIndex",
    "jointIndexFromName",
    "ADDITIVE",
    "awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase",
    "AnimationNodeBase",
    "AnimationClipNodeBase",
    "_pLooping",
    "_pTotalDuration",
    "_pStitchDirty",
    "_pStitchFinalFrame",
    "_pNumFrames",
    "_pDurations",
    "_pTotalDelta",
    "fixedFrameRate",
    "_pUpdateStitch",
    "_pLastFrame",
    "awayjs-display/lib/animators/nodes/AnimationNodeBase",
    "awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode",
    "ParticleNodeBase",
    "ParticleAccelerationState",
    "ParticleAccelerationNode",
    "acceleration",
    "_pStateClass",
    "_acceleration",
    "pGetAGALVertexCode",
    "accelerationValue",
    "_pMode",
    "getFreeVertexAttribute",
    "ACCELERATION_INDEX",
    "removeVertexTempUsage",
    "animator",
    "param",
    "tempAcceleration",
    "ACCELERATION_VECTOR3D",
    "_pOneData",
    "awayjs-renderergl/lib/animators/nodes/ParticleNodeBase",
    "awayjs-renderergl/lib/animators/states/ParticleAccelerationState",
    "awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode",
    "ParticleBezierCurveState",
    "ParticleBezierCurveNode",
    "controlPoint",
    "endPoint",
    "_iControlPoint",
    "_iEndPoint",
    "controlValue",
    "BEZIER_CONTROL_INDEX",
    "endValue",
    "BEZIER_END_INDEX",
    "rev_time",
    "time_2",
    "time_temp",
    "distance",
    "bezierControl",
    "BEZIER_CONTROL_VECTOR3D",
    "bezierEnd",
    "BEZIER_END_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleBezierCurveState",
    "awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode",
    "ParticleBillboardState",
    "ParticleBillboardNode",
    "billboardAxis",
    "_iBillboardAxis",
    "rotationMatrixRegister",
    "MATRIX_INDEX",
    "shaderRegisterElement",
    "awayjs-renderergl/lib/animators/states/ParticleBillboardState",
    "awayjs-renderergl/lib/animators/nodes/ParticleColorNode",
    "ColorTransform",
    "ParticleColorState",
    "ParticleColorNode",
    "usesMultiplier",
    "usesOffset",
    "usesCycle",
    "usesPhase",
    "startColor",
    "endColor",
    "cycleDuration",
    "cyclePhase",
    "_iUsesMultiplier",
    "_iUsesOffset",
    "_iUsesCycle",
    "_iUsesPhase",
    "_iStartColor",
    "_iEndColor",
    "_iCycleDuration",
    "_iCyclePhase",
    "cycleConst",
    "CYCLE_INDEX",
    "sin",
    "getFreeVertexSingleTemp",
    "startMultiplierValue",
    "deltaMultiplierValue",
    "START_MULTIPLIER_INDEX",
    "DELTA_MULTIPLIER_INDEX",
    "startOffsetValue",
    "deltaOffsetValue",
    "START_OFFSET_INDEX",
    "DELTA_OFFSET_INDEX",
    "COLOR_START_COLORTRANSFORM",
    "COLOR_END_COLORTRANSFORM",
    "redMultiplier",
    "greenMultiplier",
    "blueMultiplier",
    "alphaMultiplier",
    "redOffset",
    "greenOffset",
    "blueOffset",
    "alphaOffset",
    "awayjs-core/lib/geom/ColorTransform",
    "awayjs-renderergl/lib/animators/states/ParticleColorState",
    "awayjs-renderergl/lib/animators/nodes/ParticleFollowNode",
    "ParticleFollowState",
    "ParticleFollowNode",
    "usesPosition",
    "usesRotation",
    "smooth",
    "_iUsesPosition",
    "_iUsesRotation",
    "_iSmooth",
    "rotationAttribute",
    "FOLLOW_ROTATION_INDEX",
    "temp3",
    "temp4",
    "FOLLOW_POSITION_INDEX",
    "awayjs-renderergl/lib/animators/states/ParticleFollowState",
    "awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode",
    "ParticleInitialColorState",
    "ParticleInitialColorNode",
    "initialColor",
    "_iInitialColor",
    "multiplierValue",
    "MULTIPLIER_INDEX",
    "offsetValue",
    "OFFSET_INDEX",
    "COLOR_INITIAL_COLORTRANSFORM",
    "awayjs-renderergl/lib/animators/states/ParticleInitialColorState",
    "_pDataLength",
    "MODES",
    "_priority",
    1,
    2,
    "awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode",
    "ParticleOrbitState",
    "ParticleOrbitNode",
    "usesEulers",
    "radius",
    "eulers",
    "_iUsesEulers",
    "_iRadius",
    "_iEulers",
    "orbitRegister",
    "ORBIT_INDEX",
    "eulersMatrixRegister",
    "EULERS_INDEX",
    "cos",
    "degree",
    "orbit",
    "ORBIT_VECTOR3D",
    "PI",
    "awayjs-renderergl/lib/animators/states/ParticleOrbitState",
    "awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode",
    "ParticleOscillatorState",
    "ParticleOscillatorNode",
    "oscillator",
    "_iOscillator",
    "oscillatorRegister",
    "OSCILLATOR_INDEX",
    "dgree",
    "drift",
    "OSCILLATOR_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleOscillatorState",
    "awayjs-renderergl/lib/animators/nodes/ParticlePositionNode",
    "ParticlePositionState",
    "ParticlePositionNode",
    "_iPosition",
    "POSITION_INDEX",
    "POSITION_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticlePositionState",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode",
    "ParticleRotateToHeadingState",
    "ParticleRotateToHeadingNode",
    "nrmVel",
    "xAxis",
    "R",
    "R_rev",
    "cos2",
    "tempSingle",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode",
    "ParticleRotateToPositionState",
    "ParticleRotateToPositionNode",
    "nrmDirection",
    "o_temp",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode",
    "ParticleRotationalVelocityState",
    "ParticleRotationalVelocityNode",
    "rotationalVelocity",
    "_iRotationalVelocity",
    "rotationRegister",
    "ROTATIONALVELOCITY_INDEX",
    "Rtemp",
    "rotate",
    "ROTATIONALVELOCITY_VECTOR3D",
    "normalize",
    "awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState",
    "awayjs-renderergl/lib/animators/nodes/ParticleScaleNode",
    "ParticleScaleState",
    "ParticleScaleNode",
    "minScale",
    "maxScale",
    "_iMinScale",
    "_iMaxScale",
    "scaleRegister",
    "SCALE_INDEX",
    "scale",
    "SCALE_VECTOR3D",
    "abs",
    "awayjs-renderergl/lib/animators/states/ParticleScaleState",
    "awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode",
    "ParticleSegmentedColorState",
    "ParticleSegmentedColorNode",
    "numSegmentPoint",
    "segmentPoints",
    "_iNumSegmentPoint",
    "_iSegmentPoints",
    "accMultiplierColor",
    "tempColor",
    "accTime",
    "lifeTimeRegister",
    "TIME_DATA_INDEX",
    "startMulValue",
    "deltaMulValues",
    "deltaOffsetValues",
    "awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState",
    "awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode",
    "ParticleSpriteSheetState",
    "ParticleSpriteSheetNode",
    "numColumns",
    "numRows",
    "totalFrames",
    "MAX_VALUE",
    "_iNumColumns",
    "_iNumRows",
    "_iTotalFrames",
    "min",
    "uvParamConst1",
    "uvParamConst2",
    "UV_INDEX_0",
    "UV_INDEX_1",
    "uTotal",
    "uStep",
    "vStep",
    "uSpeed",
    "cycle",
    "phaseTime",
    "vOffset",
    "v",
    "uvCycle",
    "UV_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState",
    "ParticleTimeState",
    "_iUsesDuration",
    "_iUsesLooping",
    "_iUsesDelay",
    "timeStreamRegister",
    "TIME_STREAM_INDEX",
    "timeConst",
    "TIME_CONSTANT_INDEX",
    "div",
    "sge",
    "awayjs-renderergl/lib/animators/states/ParticleTimeState",
    "awayjs-renderergl/lib/animators/nodes/ParticleUVNode",
    "ParticleUVState",
    "ParticleUVNode",
    "axis",
    "_cycle",
    "_scale",
    "_axis",
    "updateUVData",
    "uvConst",
    "UV_INDEX",
    "axisIndex",
    "_iUvData",
    "U_AXIS",
    "V_AXIS",
    "awayjs-renderergl/lib/animators/states/ParticleUVState",
    "awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode",
    "ParticleVelocityState",
    "ParticleVelocityNode",
    "velocity",
    "_iVelocity",
    "velocityValue",
    "VELOCITY_INDEX",
    "_tempVelocity",
    "VELOCITY_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleVelocityState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode",
    "SkeletonBinaryLERPState",
    "SkeletonBinaryLERPNode",
    "awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonClipNode",
    "SkeletonClipState",
    "SkeletonClipNode",
    "_frames",
    "highQuality",
    "addFrame",
    "skeletonPose",
    "p1",
    "p2",
    "awayjs-renderergl/lib/animators/states/SkeletonClipState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode",
    "SkeletonDifferenceState",
    "SkeletonDifferenceNode",
    "awayjs-renderergl/lib/animators/states/SkeletonDifferenceState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode",
    "SkeletonDirectionalState",
    "SkeletonDirectionalNode",
    "awayjs-renderergl/lib/animators/states/SkeletonDirectionalState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode",
    "SkeletonNaryLERPState",
    "SkeletonNaryLERPNode",
    "_iInputs",
    "_numInputs",
    "getInputIndex",
    "input",
    "getInputAt",
    "addInput",
    "awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState",
    "awayjs-renderergl/lib/animators/nodes/VertexClipNode",
    "VertexClipState",
    "VertexClipNode",
    "_translations",
    "awayjs-renderergl/lib/animators/states/VertexClipState",
    "awayjs-renderergl/lib/animators/states/AnimationClipState",
    "AnimationStateBase",
    "AnimationClipState",
    "animationClipNode",
    "_pFramesDirty",
    "_animationClipNode",
    "_pUpdateFrames",
    "_pBlendWeight",
    "_pCurrentFrame",
    "_pNextFrame",
    "looping",
    "_pStartTime",
    "totalDuration",
    "_pTime",
    "_pUpdateTime",
    "_pTimeDir",
    "lastFrame",
    "notifyPlaybackComplete",
    "floor",
    "dur",
    "frameTime",
    "durations",
    "_animationStatePlaybackComplete",
    "PLAYBACK_COMPLETE",
    "_pAnimator",
    "awayjs-renderergl/lib/animators/states/AnimationStateBase",
    "_pRootDelta",
    "_pPositionDeltaDirty",
    "_pAnimationNode",
    "_pUpdatePositionDelta",
    "awayjs-renderergl/lib/animators/states/IAnimationState",
    "awayjs-renderergl/lib/animators/states/ISkeletonAnimationState",
    "awayjs-renderergl/lib/animators/states/IVertexAnimationState",
    "ParticleStateBase",
    "particleAccelerationNode",
    "_particleAccelerationNode",
    "updateAccelerationData",
    "FLOAT_3",
    "_halfAcceleration",
    "awayjs-renderergl/lib/animators/states/ParticleStateBase",
    "particleBezierCurveNode",
    "_particleBezierCurveNode",
    "_controlPoint",
    "_endPoint",
    "controlIndex",
    "endIndex",
    "MathConsts",
    "Orientation3D",
    "particleNode",
    "_matrix",
    "_billboardAxis",
    "comps",
    "pos",
    "sceneTransform",
    "look",
    "right",
    "crossProduct",
    "decompose",
    "AXIS_ANGLE",
    "copyColumnFrom",
    "appendRotation",
    "RADIANS_TO_DEGREES",
    "append",
    "inverseSceneTransform",
    "identity",
    "awayjs-core/lib/geom/MathConsts",
    "awayjs-core/lib/geom/Orientation3D",
    "particleColorNode",
    "_particleColorNode",
    "_usesMultiplier",
    "_usesOffset",
    "_usesCycle",
    "_usesPhase",
    "_startColor",
    "_endColor",
    "_cycleDuration",
    "_cyclePhase",
    "updateColorData",
    "dataOffset",
    "_cycleData",
    "FLOAT_4",
    "_startMultiplierData",
    "_deltaMultiplierData",
    "_startOffsetData",
    "_deltaOffsetData",
    "particleFollowNode",
    "_targetPos",
    "_targetEuler",
    "_temp",
    "_particleFollowNode",
    "_smooth",
    "_followTarget",
    "scaleX",
    "scaleY",
    "scaleZ",
    "rotationX",
    "rotationY",
    "rotationZ",
    "scaleBy",
    "DEGREES_TO_RADIANS",
    "_prePos",
    "_preEuler",
    "currentTime",
    "deltaTime",
    "needProcess",
    "processPositionAndRotation",
    "processPosition",
    "precessRotation",
    "changed",
    "interpolatedPos",
    "posVelocity",
    "inc",
    "add",
    "interpolatedRotation",
    "rotationVelocity",
    "particleInitialColorNode",
    "_particleInitialColorNode",
    "_initialColor",
    "_multiplierData",
    "_offsetData",
    "particleOrbitNode",
    "_particleOrbitNode",
    "_usesEulers",
    "_eulers",
    "_radius",
    "updateOrbitData",
    "_orbitData",
    "_eulersMatrix",
    "X_AXIS",
    "Y_AXIS",
    "Z_AXIS",
    "particleOscillatorNode",
    "_particleOscillatorNode",
    "_oscillator",
    "updateOscillatorData",
    "_oscillatorData",
    "particlePositionNode",
    "_particlePositionNode",
    "_position",
    "getPositions",
    "_pDynamicProperties",
    "_pDynamicPropertiesDirty",
    "_pUpdateDynamicProperties",
    "particleRotateToPositionNode",
    "_particleRotateToPositionNode",
    "_offset",
    "particleRotationNode",
    "_particleRotationalVelocityNode",
    "_rotationalVelocity",
    "updateRotationalVelocityData",
    "getRotationalVelocities",
    "setRotationalVelocities",
    "_rotationalVelocityData",
    "rotation",
    "particleScaleNode",
    "_particleScaleNode",
    "_minScale",
    "_maxScale",
    "updateScaleData",
    "_scaleData",
    "particleSegmentedColorNode",
    "_segmentPoints",
    "_numSegmentPoint",
    "_timeLifeData",
    "particleSpriteSheetNode",
    "_particleSpriteSheetNode",
    "_totalFrames",
    "_numColumns",
    "_numRows",
    "updateSpriteSheetData",
    "_spriteSheetData",
    "_particleNode",
    "_pNeedUpdateTime",
    "animationParticle",
    "particleTimeNode",
    "_particleTimeNode",
    "particleTime",
    "particleUVNode",
    "_particleUVNode",
    "particleVelocityNode",
    "_particleVelocityNode",
    "_velocity",
    "getVelocities",
    "setVelocities",
    "skeletonAnimationNode",
    "_blendWeight",
    "_skeletonPose",
    "_skeletonPoseDirty",
    "_skeletonAnimationNode",
    "_inputA",
    "inputA",
    "_inputB",
    "inputB",
    "updateSkeletonPose",
    "deltA",
    "deltB",
    "endPose",
    "endPoses",
    "poses1",
    "poses2",
    "pose1",
    "pose2",
    "lerp",
    "skeletonClipNode",
    "_rootPos",
    "_skeletonClipNode",
    "frames",
    "_currentPose",
    "_nextPose",
    "currentPose",
    "nextPose",
    "slerp",
    "p3",
    "totalDelta",
    "_pOldFrame",
    "dx",
    "dy",
    "dz",
    "stitchFinalFrame",
    "_baseInput",
    "baseInput",
    "_differenceInput",
    "differenceInput",
    "basePoses",
    "diffPoses",
    "base",
    "diff",
    "basePos",
    "diffPos",
    "_tempQuat",
    "multiply",
    "_direction",
    "_blendDirty",
    "_forward",
    "forward",
    "_backward",
    "backward",
    "_left",
    "left",
    "_right",
    "updateBlend",
    "_pUdateTime",
    "_blendWeights",
    "_inputs",
    "numInputs",
    "getBlendWeightAt",
    "setBlendWeightAt",
    "poses",
    "endTr",
    "endQuat",
    "firstPose",
    "w0",
    "x0",
    "y0",
    "z0",
    "vertexClipNode",
    "_vertexClipNode",
    "_currentGeometry",
    "_nextGeometry",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode",
    "CrossfadeTransitionState",
    "CrossfadeTransitionNode",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState",
    "_crossfadeTransitionNode",
    "startBlend",
    "blendSpeed",
    "_animationStateTransitionComplete",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransition",
    "CrossfadeTransition",
    "startNode",
    "endNode",
    "crossFadeTransitionNode",
    "awayjs-renderergl/lib/animators/transitions/IAnimationTransition",
    "awayjs-renderergl/lib/base/ParticleGeometry",
    "Geometry",
    "ParticleGeometry",
    "apply",
    "arguments",
    "awayjs-display/lib/base/Geometry",
    "message",
    "awayjs-core/lib/errors/Error",
    "_animator",
    "_animationState",
    "_animationNode",
    "awayjs-renderergl/lib/events/ShadingMethodEvent",
    "ShadingMethodEvent",
    "SHADER_INVALIDATED",
    "awayjs-renderergl/lib/filters/BlurFilter3D",
    "Filter3DHBlurTask",
    "Filter3DVBlurTask",
    "Filter3DBase",
    "BlurFilter3D",
    "blurX",
    "blurY",
    "stepSize",
    "_hBlurTask",
    "_vBlurTask",
    "addTask",
    "amount",
    "mainTarget",
    "awayjs-renderergl/lib/filters/Filter3DBase",
    "awayjs-renderergl/lib/filters/tasks/Filter3DHBlurTask",
    "awayjs-renderergl/lib/filters/tasks/Filter3DVBlurTask",
    "awayjs-renderergl/lib/filters/CompositeFilter3D",
    "Filter3DCompositeTask",
    "CompositeFilter3D",
    "exposure",
    "_compositeTask",
    "overlayTexture",
    "awayjs-renderergl/lib/filters/tasks/Filter3DCompositeTask",
    "_textureWidth",
    "_textureHeight",
    "Filter3DTaskBase",
    "_data",
    "_overlayTexture",
    "_overlayWidth",
    "_overlayHeight",
    "getFragmentCode",
    "op",
    "camera3D",
    "_scaledTextureWidth",
    "_scaledTextureHeight",
    "awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase",
    "awayjs-renderergl/lib/filters/tasks/Filter3DFXAATask",
    "Filter3DFXAATask",
    "_stepSize",
    "_amount",
    "invalidateProgram",
    "updateBlurData",
    "calculateStepSize",
    "uv_in",
    "lum",
    "pix",
    "mOne",
    "mul",
    "delta1",
    "delta2",
    "delta3",
    "delta4",
    "_0",
    "_025",
    "_05",
    "_075",
    "_1",
    "uv",
    "uvx",
    "uvy",
    "TL",
    "TR",
    "BL",
    "BR",
    "M",
    "tempf1",
    "tempf2",
    "tempf3",
    "tex",
    "dir",
    "dirx",
    "diry",
    "dirxy",
    "dirReduce",
    "inverseDirAdjustment",
    "result1",
    "result2",
    "fxaaReduceMin",
    "fxaaReduceMul",
    "fxaaSpanMax",
    "lumaMin",
    "lumaMax",
    "sample",
    "tempxy",
    "join",
    "updateTextures",
    "invH",
    "_realStepSize",
    "MAX_AUTO_SAMPLES",
    "numSamples",
    "invW",
    "Image2D",
    "_textureDimensionsInvalid",
    "_program3DInvalid",
    "_textureScale",
    "_target",
    "_program3D",
    "updateProgram",
    "getVertexCode",
    "awayjs-core/lib/data/Image2D",
    "ImageUtils",
    "_viewWidth",
    "_viewHeight",
    "_buffersInvalid",
    "_renderToTextureRect",
    "_instances",
    "rttBufferManager",
    "getRTTBufferManagerFromStage",
    "vo",
    "RTTBufferManagerVO",
    "stage3d",
    "rttbfm",
    "c",
    "deleteRTTBufferManager",
    "updateRTTBuffers",
    "_textureRatioX",
    "_textureRatioY",
    "getBestPowerOf2",
    "_renderToTextureVertexBuffer",
    "_renderToScreenVertexBuffer",
    "_indexBuffer",
    "textureVerts",
    "screenVerts",
    "createIndexBuffer",
    "u1",
    "u2",
    "v1",
    "v2",
    "awayjs-core/lib/utils/ImageUtils",
    "awayjs-renderergl/lib/pick/ShaderPicker",
    "Debug",
    "Matrix3DUtils",
    "ContextGLTriangleFace",
    "ShaderPicker",
    "shaderPickingDetails",
    "_onlyMouseEnabled",
    "_interactives",
    "_localHitPosition",
    "_hitUV",
    "_localHitNormal",
    "_rayPos",
    "_rayDir",
    "_shaderPickingDetails",
    "_id",
    "_viewportData",
    "_boundOffsetScale",
    "getViewCollision",
    "view",
    "collector",
    "iEntityCollector",
    "renderer",
    "_context",
    "_projX",
    "_projY",
    "_potentialFound",
    "_blendedRenderableHead",
    "_opaqueRenderableHead",
    "_bitmapImage2D",
    "_hitColor",
    "getPixel",
    "_hitRenderable",
    "_hitEntity",
    "_iIsMouseEnabled",
    "_collisionVO",
    "_iPickingCollisionVO",
    "getHitDetails",
    "localPosition",
    "localNormal",
    "_faceIndex",
    "getSceneCollision",
    "direction",
    "scene",
    "MOUSE_SCISSOR_RECT",
    "_interactiveId",
    "_objectProgram",
    "initObjectProgram",
    "CALCULATION_MATRIX",
    "setCulling",
    "bothSides",
    "NONE",
    "BACK",
    "projection",
    "coordinateSystem",
    "setProgramConstantsFromMatrix",
    "getIndexBufferVO",
    "draw",
    "numIndices",
    "updateRay",
    "getRay",
    "vertexCode",
    "fragmentCode",
    "throwPIR",
    "initTriangleProgram",
    "_triangleProgram",
    "getApproximatePosition",
    "getPreciseDetails",
    "bounds",
    "getBox",
    "col",
    "scX",
    "scY",
    "scZ",
    "offsX",
    "offsY",
    "offsZ",
    "localViewProjection",
    "depth",
    "setScissorRectangle",
    "t1",
    "t2",
    "t3",
    "v0x",
    "v0y",
    "v0z",
    "v1x",
    "v1y",
    "v1z",
    "v2x",
    "v2y",
    "v2z",
    "ni1",
    "ni2",
    "ni3",
    "n1",
    "n2",
    "n3",
    "nLength",
    "dot00",
    "dot01",
    "dot02",
    "dot11",
    "dot12",
    "invDenom",
    "ui1",
    "ui2",
    "ui3",
    "s0x",
    "s0y",
    "s0z",
    "s1x",
    "s1y",
    "s1z",
    "nl",
    "_pGetSubGeometry",
    "posDim",
    "dimensions",
    "uvDim",
    "normalDim",
    "getPrecisePosition",
    "invSceneTransform",
    "px",
    "py",
    "pz",
    "rx",
    "ry",
    "rz",
    "RAW_DATA_CONTAINER",
    "copyRawDataTo",
    "awayjs-core/lib/geom/Matrix3DUtils",
    "awayjs-core/lib/utils/Debug",
    "awayjs-stagegl/lib/base/ContextGLTriangleFace",
    "awayjs-renderergl/lib/render/BasicMaterialRender",
    "BlendMode",
    "BasicMaterialPass",
    "RenderBase",
    "BasicMaterialRender",
    "pool",
    "material",
    "renderableClass",
    "_material",
    "_pAddPass",
    "_pass",
    "_pUpdateRender",
    "_pRequiresBlending",
    "NORMAL",
    "alphaBlending",
    "colorTransform",
    "preserveAlpha",
    "setBlendMode",
    "LAYER",
    "awayjs-core/lib/data/BlendMode",
    "awayjs-renderergl/lib/render/RenderBase",
    "awayjs-renderergl/lib/render/passes/BasicMaterialPass",
    "RenderPassBase",
    "ShaderBase",
    "_shader",
    "_iIncludeDependencies",
    "projectionDependencies",
    "uvDependencies",
    "_iInitConstantData",
    "_fragmentConstantsIndex",
    "_iGetFragmentCode",
    "registerCache",
    "sharedRegisters",
    "targetReg",
    "dataReg1",
    "getFreeFragmentConstant",
    "dataReg2",
    "getFreeFragmentVectorTemp",
    "projectionFragment",
    "texture",
    "_iInitRegisters",
    "albedo",
    "uvVarying",
    "cutOffReg",
    "removeFragmentTempUsage",
    "awayjs-renderergl/lib/render/RenderPassBase",
    "awayjs-renderergl/lib/shaders/ShaderBase",
    "viewDirDependencies",
    "globalPosDependencies",
    "viewDirVarying",
    "far",
    "awayjs-renderergl/lib/render/IRenderClass",
    "MaterialBase",
    "usages",
    "_forceSeparateMVP",
    "_invalidAnimation",
    "_invalidRender",
    "_passes",
    "_pool",
    "_renderableClass",
    "_onPassChangeDelegate",
    "onPassChange",
    "_updateAnimation",
    "_renderOrderId",
    "useMipmapping",
    "mipmap",
    "useSmoothTextures",
    "useAlphaPremultiplied",
    "alphaPremultiplied",
    "useBothSides",
    "repeatTextures",
    "repeat",
    "animateUVs",
    "usesColorTransform",
    "useColorTransform",
    "getTextureVO",
    "disposeItem",
    "CHANGE",
    "invalidateRender",
    "invalidatePasses",
    "invalidatePass",
    "invalidateAnimation",
    "enabledGPUAnimation",
    "_getEnabledGPUAnimation",
    "mult",
    "usesAnimation",
    "_pRemovePass",
    "_pClearPasses",
    "owners",
    "iOwners",
    "numOwners",
    "awayjs-display/lib/materials/MaterialBase",
    "invalidateShader",
    "_iGetPreLightingVertexCode",
    "_iGetPreLightingFragmentCode",
    "_iGetVertexCode",
    "_iGetNormalVertexCode",
    "_iGetNormalFragmentCode",
    "awayjs-renderergl/lib/render/RenderPool",
    "BasicMaterial",
    "Skybox",
    "SkyboxRender",
    "RenderPool",
    "renderClass",
    "_renderClass",
    "_iAddRender",
    "getClass",
    "_iRemoveRender",
    "registerClass",
    "assetClass",
    "_classPool",
    "addDefaults",
    "main",
    "awayjs-display/lib/entities/Skybox",
    "awayjs-display/lib/materials/BasicMaterial",
    "awayjs-renderergl/lib/render/SkyboxRender",
    "skybox",
    "_skybox",
    "_cubeTexture",
    "cubeMap",
    "usesLocalPosFragment",
    "localPositionVarying",
    "PassBase",
    "_diffuseR",
    "_diffuseG",
    "_diffuseB",
    "_diffuseA",
    "regCache",
    "sharedReg",
    "alphaReg",
    "getFreeFragmentSingleTemp",
    "colorBufferIndex",
    "colorVarying",
    "diffuseInputReg",
    "awayjs-renderergl/lib/render/passes/PassBase",
    "awayjs-renderergl/lib/render/passes/ILightingPass",
    "awayjs-renderergl/lib/render/passes/IPass",
    "_preserveAlpha",
    "_render",
    "awayjs-renderergl/lib/renderables/BillboardRenderable",
    "AttributesBuffer",
    "TriangleSubGeometry",
    "Billboard",
    "RenderableBase",
    "BillboardRenderable",
    "billboard",
    "_billboard",
    "billboardRect",
    "_materialGeometry",
    "globalPositionVertex",
    "viewMatrixReg",
    "viewMatrixIndex",
    "_setRenderState",
    "sceneMatrixIndex",
    "matrix3D",
    "awayjs-core/lib/attributes/AttributesBuffer",
    "awayjs-display/lib/base/TriangleSubGeometry",
    "awayjs-display/lib/entities/Billboard",
    "awayjs-renderergl/lib/renderables/RenderableBase",
    "awayjs-renderergl/lib/renderables/CurveSubMeshRenderable",
    "CurveSubMesh",
    "CurveSubMeshRenderable",
    "sd",
    "standardDerivatives",
    "out",
    "curve",
    "curvex",
    "curvey",
    "curvez",
    "free",
    "free1",
    "free2",
    "d2",
    "fixa",
    "fixb",
    "_aa",
    "applyAA",
    "_constants",
    "awayjs-display/lib/base/CurveSubMesh",
    "awayjs-renderergl/lib/renderables/IRenderableClass",
    "awayjs-renderergl/lib/renderables/LineSegmentRenderable",
    "LineSubGeometry",
    "LineSegment",
    "LineSegmentRenderable",
    "lineSegment",
    "_thickness",
    "_lineSegment",
    "_calcMatrix",
    "_lineGeometry",
    "startPostion",
    "end",
    "endPosition",
    "thickness",
    "setThickness",
    "colorDependencies",
    "pONE_VECTOR",
    "pFRONT_VECTOR",
    "_pGetOverflowRenderable",
    "indexOffset",
    "awayjs-display/lib/base/LineSubGeometry",
    "awayjs-display/lib/entities/LineSegment",
    "awayjs-renderergl/lib/renderables/LineSubMeshRenderable",
    "LineSubMesh",
    "LineSubMeshRenderable",
    "awayjs-display/lib/base/LineSubMesh",
    "RenderableOwnerEvent",
    "DefaultMaterialManager",
    "_geometryDirty",
    "_onRenderOwnerUpdatedDelegate",
    "_onRenderOwnerUpdated",
    "RENDER_OWNER_UPDATED",
    "getDefaultMaterial",
    "_updateGeometry",
    "_subGeometryVO",
    "invalidateGeometry",
    "awayjs-display/lib/events/RenderableOwnerEvent",
    "awayjs-display/lib/managers/DefaultMaterialManager",
    "SkyboxRenderable",
    "TriangleSubMeshRenderable",
    "_objectPools",
    "_iAddRenderable",
    "_iRemoveRenderable",
    "awayjs-renderergl/lib/renderables/SkyboxRenderable",
    "awayjs-renderergl/lib/renderables/TriangleSubMeshRenderable",
    "_vertexArray",
    "_geometry",
    "TriangleSubMesh",
    "awayjs-display/lib/base/TriangleSubMesh",
    "awayjs-renderergl/lib/shaders/LightingShader",
    "LightSources",
    "ContextGLProfile",
    "LightingCompiler",
    "LightingShader",
    "lightingPass",
    "_includeCasters",
    "_lightingPass",
    "numPointLights",
    "numDirectionalLights",
    "numLightProbes",
    "numAllLights",
    "diffuseLightSources",
    "_iUsesDiffuse",
    "specularLightSources",
    "_iUsesSpecular",
    "combinedLightSources",
    "usesLightFallOff",
    "enableLightFallOff",
    "BASELINE_CONSTRAINED",
    "usesCommonData",
    "numLights",
    "usesLights",
    "LIGHTS",
    "usesProbes",
    "PROBES",
    "usesLightsForSpecular",
    "usesProbesForSpecular",
    "usesLightsForDiffuse",
    "usesProbesForDiffuse",
    "usesShadows",
    "_iUsesShadows",
    "createCompiler",
    "lightPicker",
    "collectLights",
    "updateProbes",
    "dirLight",
    "pointLight",
    "dirPos",
    "numLightTypes",
    "ambientR",
    "ambientG",
    "ambientB",
    "lightVertexConstantIndex",
    "lightFragmentConstantIndex",
    "cast",
    "directionalLightsOffset",
    "castingDirectionalLights",
    "sceneDirection",
    "_iAmbientR",
    "_iAmbientG",
    "_iAmbientB",
    "usesTangentSpace",
    "_pInverseSceneMatrix",
    "_iDiffuseR",
    "_iDiffuseG",
    "_iDiffuseB",
    "_iSpecularR",
    "_iSpecularG",
    "_iSpecularB",
    "pointLightsOffset",
    "castingPointLights",
    "usesGlobalPosFragment",
    "_pRadius",
    "_pFallOffFactor",
    "probe",
    "lightProbes",
    "lightProbeWeights",
    "lightProbesOffset",
    "addDiff",
    "addSpec",
    "diffuseMap",
    "lightProbeDiffuseIndices",
    "specularMap",
    "lightProbeSpecularIndices",
    "probeWeightsIndex",
    "awayjs-display/lib/materials/LightSources",
    "awayjs-renderergl/lib/shaders/compilers/LightingCompiler",
    "awayjs-stagegl/lib/base/ContextGLProfile",
    "awayjs-renderergl/lib/shaders/RegisterPool",
    "RegisterPool",
    "regCount",
    "persistent",
    "_regName",
    "_regCount",
    "_persistent",
    "initRegisters",
    "requestFreeVectorReg",
    "isRegisterUsed",
    "_usedVectorCount",
    "_vectorRegisters",
    "requestFreeRegComponent",
    "_usedSingleCount",
    "_registerComponents",
    "addUsage",
    "register",
    "usageCount",
    "_component",
    "removeUsage",
    "hasRegisteredRegs",
    "hash",
    "_initPool",
    "_regPool",
    "_regCompsPool",
    "_initArray",
    "vectorRegisters",
    "registerComponents",
    "val",
    "ArgumentError",
    "CompilerBase",
    "TextureVOPool",
    "_blendFactorSource",
    "_blendFactorDest",
    "_invalidShader",
    "_invalidProgram",
    "_animationVertexCode",
    "_animationFragmentCode",
    "usesBlending",
    "depthCompareMode",
    "writeDepth",
    "_defaultCulling",
    "_textureVOPool",
    "_updateProgram",
    "_programData",
    "secondaryUVDependencies",
    "outputsTangentNormals",
    "pInitRegisterIndices",
    "commonsDataIndex",
    "cameraPositionIndex",
    "uvBufferIndex",
    "uvTransformIndex",
    "colorTransformIndex",
    "secondaryUVBufferIndex",
    "normalBufferIndex",
    "tangentBufferIndex",
    "sceneNormalMatrixIndex",
    "initConstantData",
    "SOURCE_ALPHA",
    "ONE_MINUS_SOURCE_ALPHA",
    "MULTIPLY",
    "SOURCE_COLOR",
    "ADD",
    "ALPHA",
    "uvTransform",
    "_iAssignedColorTransform",
    "compiler",
    "compile",
    "_calcAnimationCode",
    "getProgramData",
    "postAnimationFragmentCode",
    "awayjs-core/lib/errors/ArgumentError",
    "awayjs-renderergl/lib/shaders/compilers/CompilerBase",
    "awayjs-renderergl/lib/vos/TextureVOPool",
    "_numUsedVertexConstants",
    "_numUsedFragmentConstants",
    "_numUsedVaryings",
    "_profile",
    "_fragmentTempCache",
    "_vertexTempCache",
    "_varyingCache",
    "_textureCache",
    "_vertexAttributesCache",
    "_fragmentConstantsCache",
    "_vertexConstantsCache",
    "_fragmentOutputRegister",
    "_vertexOutputRegister",
    "_vertexAttributesOffset",
    "_vertexConstantOffset",
    "_varyingsOffset",
    "_fragmentConstantOffset",
    "getFreeTextureReg",
    "awayjs-renderergl/lib/shaders/ShaderRegisterData",
    "ShaderRegisterData",
    "component",
    "_toStr",
    "COMPONENTS",
    "_pVertexCode",
    "_pFragmentCode",
    "_pPostAnimationFragmentCode",
    "_pRenderableClass",
    "_pRenderPass",
    "_pShader",
    "_pSharedRegisters",
    "_pRegisterCache",
    "pCompileDependencies",
    "compileColorTransformCode",
    "fragmentOutputRegister",
    "_pAnimatableAttributes",
    "_pAnimationTargetRegisters",
    "_uvSource",
    "_uvTarget",
    "ct1",
    "ct2",
    "compileGlobalPositionCode",
    "compileLocalPositionCode",
    "compileUVCode",
    "compileSecondaryUVCode",
    "compileNormalCode",
    "compileViewDirCode",
    "sceneMatrixReg",
    "globalPositionVarying",
    "uvAttributeReg",
    "varying",
    "uvTransform1",
    "uvTransform2",
    "secondaryUVVarying",
    "cameraPositionReg",
    "viewDirFragment",
    "animatedTangent",
    "normalFragment",
    "normalMatrix",
    "normalVarying",
    "animatedNormal",
    "bitangent",
    "tangentVarying",
    "bitangentVarying",
    "normalInput",
    "commons",
    "tangentInput",
    "colorInput",
    "shaderLightingObject",
    "_shaderLightingObject",
    "pCompileShadowCode",
    "initLightRegisters",
    "compileLightCode",
    "compileLightProbeCode",
    "_iGetPostLightingVertexCode",
    "_iGetPostLightingFragmentCode",
    "shadowTarget",
    "_dirLightVertexConstants",
    "_pointLightVertexConstants",
    "_dirLightFragmentConstants",
    "_pointLightFragmentConstants",
    "diffuseColorReg",
    "specularColorReg",
    "lightPosReg",
    "lightDirReg",
    "vertexRegIndex",
    "fragmentRegIndex",
    "lightVarying",
    "_iGetPerLightDiffuseFragmentCode",
    "_iGetPerLightSpecularFragmentCode",
    "weightReg",
    "weightComponents",
    "weightRegisters",
    "texReg",
    "_pNumProbeRegisters",
    "_iGetPerProbeDiffuseFragmentCode",
    "_iGetPerProbeSpecularFragmentCode",
    "ceil",
    "awayjs-renderergl/lib/tools/commands/Merge",
    "Mesh",
    "Merge",
    "keepMaterial",
    "disposeSources",
    "objectSpace",
    "_keepMaterial",
    "_disposeSources",
    "_objectSpace",
    "applyToContainer",
    "receiver",
    "objectContainer",
    "parseContainer",
    "collect",
    "merge",
    "applyToMeshes",
    "meshes",
    "_toDispose",
    "_geomVOs",
    "destMesh",
    "subIdx",
    "oldGeom",
    "destGeom",
    "useSubMaterials",
    "sub",
    "vertices",
    "addSubGeometry",
    "m",
    "calc",
    "iIdx",
    "vIdx",
    "nIdx",
    "tIdx",
    "uIdx",
    "ind",
    "pd",
    "nd",
    "td",
    "ud",
    "getSubGeomData",
    "transformVectors",
    "deltaTransformVectors",
    "GeometryVO",
    "object",
    "child",
    "getChildAt",
    "awayjs-display/lib/entities/Mesh",
    "awayjs-renderergl/lib/tools/data/ParticleGeometryTransform",
    "ParticleGeometryTransform",
    "_defaultVertexTransform",
    "_defaultInvVertexTransform",
    "transpose",
    "_defaultUVTransform",
    "awayjs-renderergl/lib/utils/ParticleGeometryHelper",
    "ParticleGeometryHelper",
    "generateGeometry",
    "geometries",
    "transforms",
    "indicesVector",
    "positionsVector",
    "normalsVector",
    "tangentsVector",
    "uvsVector",
    "vertexCounters",
    "sourceSubGeometries",
    "numSubGeometries",
    "vertexCounter",
    "sub2SubMap",
    "tempVertex",
    "tempNormal",
    "tempTangents",
    "tempUV",
    "MAX_VERTEX",
    "particleData",
    "tempLen",
    "compact",
    "product",
    "sourceUVs",
    "particleGeometryTransform",
    "vertexTransform",
    "invVertexTransform",
    "UVTransform",
    "deltaTransformVector",
    "transformPoint",
    "sourceIndices",
    "particleGeometry",
    "awayjs-renderergl/lib/utils/PerspectiveMatrix3D",
    "PerspectiveMatrix3D",
    "perspectiveFieldOfViewLH",
    "fieldOfViewY",
    "aspectRatio",
    "zNear",
    "zFar",
    "yScale",
    "tan",
    "xScale",
    "awayjs-renderergl/lib/vos/CurveSubGeometryVO",
    "CurveSubGeometry",
    "SubGeometryVOBase",
    "CurveSubGeometryVO",
    "curveSubGeometry",
    "_curveSubGeometry",
    "invalidateVertices",
    "curves",
    "disposeVertices",
    "_drawElements",
    "firstIndex",
    "_drawArrays",
    "firstVertex",
    "drawVertices",
    "_pGetOverflowSubGeometry",
    "awayjs-display/lib/base/CurveSubGeometry",
    "awayjs-renderergl/lib/vos/SubGeometryVOBase",
    "awayjs-renderergl/lib/vos/ISubGeometryVOClass",
    "awayjs-renderergl/lib/vos/ITextureVOClass",
    "awayjs-renderergl/lib/vos/LineSubGeometryVO",
    "LineSubGeometryVO",
    "lineSubGeometry",
    "_lineSubGeometry",
    "colors",
    "awayjs-renderergl/lib/vos/Sampler2DVO",
    "SamplerVOBase",
    "Sampler2DVO",
    "sampler2D",
    "_sampler2D",
    "_imageObject",
    "image2D",
    "initProperties",
    "samplerReg",
    "samplerIndex",
    "imageRect",
    "_fragmentReg",
    "_fragmentIndex",
    "inputReg",
    "wrap",
    "getFormatString",
    "offsetX",
    "offsetY",
    "awayjs-renderergl/lib/vos/SamplerVOBase",
    "awayjs-renderergl/lib/vos/SamplerCubeVO",
    "SamplerCubeVO",
    "samplerCube",
    "_samplerCube",
    "imageCube",
    "ContextGLTextureFormat",
    "bitmap",
    "COMPRESSED",
    "COMPRESSED_ALPHA",
    "awayjs-stagegl/lib/base/ContextGLTextureFormat",
    "awayjs-renderergl/lib/vos/Single2DTextureVO",
    "Single2DTexture",
    "TextureVOBase",
    "Single2DTextureVO",
    "single2DTexture",
    "_single2DTexture",
    "_sampler2DVO",
    "awayjs-display/lib/textures/Single2DTexture",
    "awayjs-renderergl/lib/vos/TextureVOBase",
    "awayjs-renderergl/lib/vos/SingleCubeTextureVO",
    "SingleCubeTexture",
    "SingleCubeTextureVO",
    "singleCubeTexture",
    "_singleCubeTexture",
    "_samplerCubeVO",
    "includeInput",
    "awayjs-display/lib/textures/SingleCubeTexture",
    "SubGeometryUtils",
    "_vertices",
    "_vertexBuffers",
    "_verticesDirty",
    "_subGeometry",
    "_onIndicesUpdatedDelegate",
    "_onIndicesUpdated",
    "_onIndicesDisposedDelegate",
    "_onIndicesDisposed",
    "_onVerticesUpdatedDelegate",
    "_onVerticesUpdated",
    "_onVerticesDisposedDelegate",
    "_onVerticesDisposed",
    "INDICES_DISPOSED",
    "VERTICES_DISPOSED",
    "invalidateIndices",
    "_numIndices",
    "_indicesDirty",
    "_updateIndices",
    "getAttributesBufferVO",
    "_indices",
    "getVertexBufferVO",
    "bufferId",
    "_updateVertices",
    "size",
    "disposeIndices",
    "_overflow",
    "invalidate",
    "invalid",
    "getSubIndices",
    "count",
    "getSubVertices",
    "awayjs-display/lib/utils/SubGeometryUtils",
    "TriangleSubGeometryVO",
    "_iAddSubGeometryVO",
    "_iRemoveSubGeometryVO",
    "subGeometryVOClass",
    "classPool",
    "awayjs-renderergl/lib/vos/TriangleSubGeometryVO",
    "_texture",
    "_iAddTextureVO",
    "_iRemoveTextureVO",
    "textureVOClass",
    "triangleSubGeometry",
    "_triangleSubGeometry"
  ],
  "mappings": "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",
  "file": "awayjs-renderergl.min.js",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    null,
    "import ImageBase\t\t\t\t\t= require(\"awayjs-core/lib/data/ImageBase\");\r\nimport BitmapImage2D\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport ShadowMapperBase\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\r\n\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLClearMask\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/RendererBase\");\r\nimport DepthRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/DepthRenderer\");\r\nimport DistanceRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/DistanceRenderer\");\r\nimport Filter3DRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/Filter3DRenderer\");\r\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\nimport SkyboxRenderable\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/SkyboxRenderable\");\r\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\n\r\n/**\r\n * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the\r\n * materials assigned to them.\r\n *\r\n * @class away.render.DefaultRenderer\r\n */\r\nclass DefaultRenderer extends RendererBase\r\n{\r\n\tpublic _pRequireDepthRender:boolean;\r\n\r\n\tprivate _pDistanceRenderer:DepthRenderer;\r\n\tprivate _pDepthRenderer:DepthRenderer;\r\n\tprivate _skyboxProjection:Matrix3D = new Matrix3D();\r\n\tpublic _pFilter3DRenderer:Filter3DRenderer;\r\n\r\n\tpublic _pDepthRender:BitmapImage2D;\r\n\r\n\tprivate _antiAlias:number;\r\n\r\n\tpublic get antiAlias():number\r\n\t{\r\n\t\treturn this._antiAlias;\r\n\t}\r\n\r\n\tpublic set antiAlias(value:number)\r\n\t{\r\n\t\tif (this._antiAlias == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._antiAlias = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get depthPrepass():boolean\r\n\t{\r\n\t\treturn this._depthPrepass;\r\n\t}\r\n\r\n\tpublic set depthPrepass(value:boolean)\r\n\t{\r\n\t\tthis._depthPrepass = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {*}\r\n\t */\r\n\tpublic get filters3d():Array<Filter3DBase>\r\n\t{\r\n\t\treturn this._pFilter3DRenderer? this._pFilter3DRenderer.filters : null;\r\n\t}\r\n\tpublic set filters3d(value:Array<Filter3DBase>)\r\n\t{\r\n\t\tif (value && value.length == 0)\r\n\t\t\tvalue = null;\r\n\r\n\t\tif (this._pFilter3DRenderer && !value) {\r\n\t\t\tthis._pFilter3DRenderer.dispose();\r\n\t\t\tthis._pFilter3DRenderer = null;\r\n\t\t} else if (!this._pFilter3DRenderer && value) {\r\n\t\t\tthis._pFilter3DRenderer = new Filter3DRenderer(this._pStage);\r\n\t\t\tthis._pFilter3DRenderer.filters = value;\r\n\t\t}\r\n\r\n\t\tif (this._pFilter3DRenderer) {\r\n\t\t\tthis._pFilter3DRenderer.filters = value;\r\n\t\t\tthis._pRequireDepthRender = this._pFilter3DRenderer.requireDepthRender;\r\n\t\t} else {\r\n\t\t\tthis._pRequireDepthRender = false;\r\n\r\n\t\t\tif (this._pDepthRender) {\r\n\t\t\t\tthis._pDepthRender.dispose();\r\n\t\t\t\tthis._pDepthRender = null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new DefaultRenderer object.\r\n\t *\r\n\t * @param antiAlias The amount of anti-aliasing to use.\r\n\t * @param renderMode The render mode to use.\r\n\t */\r\n\tconstructor(stage:Stage = null, forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\")\r\n\t{\r\n\t\tsuper(stage, forceSoftware, profile, mode);\r\n\r\n\t\tthis._pRenderablePool = new RenderablePool(this._pStage);\r\n\t\t\r\n\t\tif (stage)\r\n\t\t\tthis._shareContext = true;\r\n\r\n\t\tthis._pRttBufferManager = RTTBufferManager.getInstance(this._pStage);\r\n\r\n\t\tthis._pDepthRenderer = new DepthRenderer(this._pStage);\r\n\t\tthis._pDistanceRenderer = new DistanceRenderer(this._pStage);\r\n\r\n\t\tif (this._width == 0)\r\n\t\t\tthis.width = window.innerWidth;\r\n\t\telse\r\n\t\t\tthis._pRttBufferManager.viewWidth = this._width;\r\n\r\n\t\tif (this._height == 0)\r\n\t\t\tthis.height = window.innerHeight;\r\n\t\telse\r\n\t\t\tthis._pRttBufferManager.viewHeight = this._height;\r\n\t}\r\n\r\n\tpublic render(entityCollector:CollectorBase)\r\n\t{\r\n\t\tsuper.render(entityCollector);\r\n\r\n\t\tif (!this._pStage.recoverFromDisposal()) {//if context has Disposed by the OS,don't render at this frame\r\n\t\t\tthis._pBackBufferInvalid = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._pBackBufferInvalid)// reset or update render settings\r\n\t\t\tthis.pUpdateBackBuffer();\r\n\r\n\t\tif (this._shareContext && this._pContext)\r\n\t\t\tthis._pContext.clear(0, 0, 0, 1, 1, 0, ContextGLClearMask.DEPTH);\r\n\r\n\t\tif (this._pFilter3DRenderer) {\r\n\t\t\tthis.textureRatioX = this._pRttBufferManager.textureRatioX;\r\n\t\t\tthis.textureRatioY = this._pRttBufferManager.textureRatioY;\r\n\t\t} else {\r\n\t\t\tthis.textureRatioX = 1;\r\n\t\t\tthis.textureRatioY = 1;\r\n\t\t}\r\n\r\n\t\tif (this._pRequireDepthRender)\r\n\t\t\tthis.pRenderSceneDepthToTexture(<EntityCollector> entityCollector);\r\n\r\n\t\tif (this._depthPrepass)\r\n\t\t\tthis.pRenderDepthPrepass(<EntityCollector> entityCollector);\r\n\r\n\t\tif (this._pFilter3DRenderer && this._pContext) { //TODO\r\n\t\t\tthis._iRender(entityCollector, this._pFilter3DRenderer.getMainInputTexture(this._pStage), this._pRttBufferManager.renderToTextureRect);\r\n\t\t\tthis._pFilter3DRenderer.render(this._pStage, entityCollector.camera, this._pDepthRender);\r\n\t\t} else {\r\n\r\n\t\t\tif (this._shareContext)\r\n\t\t\t\tthis._iRender(entityCollector, null, this._pScissorRect);\r\n\t\t\telse\r\n\t\t\t\tthis._iRender(entityCollector);\r\n\t\t}\r\n\r\n\t\tif (!this._shareContext && this._pContext)\r\n\t\t\tthis._pContext.present();\r\n\r\n\t\t// register that a view has been rendered\r\n\t\tthis._pStage.bufferClear = false;\r\n\t}\r\n\r\n\tpublic pExecuteRender(entityCollector:EntityCollector, target:ImageBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\r\n\t{\r\n\t\tthis.updateLights(entityCollector);\r\n\r\n\t\tsuper.pExecuteRender(entityCollector, target, scissorRect, surfaceSelector);\r\n\t}\r\n\r\n\tprivate updateLights(entityCollector:EntityCollector)\r\n\t{\r\n\t\tvar dirLights:Array<DirectionalLight> = entityCollector.directionalLights;\r\n\t\tvar pointLights:Array<PointLight> = entityCollector.pointLights;\r\n\t\tvar len:number, i:number;\r\n\t\tvar light:LightBase;\r\n\t\tvar shadowMapper:ShadowMapperBase;\r\n\r\n\t\tlen = dirLights.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tlight = dirLights[i];\r\n\r\n\t\t\tshadowMapper = light.shadowMapper;\r\n\r\n\t\t\tif (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid ))\r\n\t\t\t\tshadowMapper.iRenderDepthMap(entityCollector, this._pDepthRenderer);\r\n\t\t}\r\n\r\n\t\tlen = pointLights.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tlight = pointLights[i];\r\n\r\n\t\t\tshadowMapper = light.shadowMapper;\r\n\r\n\t\t\tif (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))\r\n\t\t\t\tshadowMapper.iRenderDepthMap(entityCollector, this._pDistanceRenderer);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic pDraw(entityCollector:EntityCollector)\r\n\t{\r\n\t\tif (entityCollector.skyBox) {\r\n\t\t\tthis._pContext.setDepthTest(false, ContextGLCompareMode.ALWAYS);\r\n\r\n\t\t\tthis.drawSkybox(entityCollector);\r\n\t\t}\r\n\r\n\t\tsuper.pDraw(entityCollector);\r\n\t}\r\n\r\n\t/**\r\n\t * Draw the skybox if present.\r\n\t *\r\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\r\n\t */\r\n\tprivate drawSkybox(entityCollector:EntityCollector)\r\n\t{\r\n\t\tvar renderable:RenderableBase = this._pRenderablePool.getItem(entityCollector.skyBox);\r\n\r\n\t\tvar camera:Camera = entityCollector.camera;\r\n\r\n\t\tthis.updateSkyboxProjection(camera);\r\n\r\n\t\tvar render:RenderBase = this._pRenderablePool.getRenderPool(renderable.renderableOwner).getItem(renderable.renderOwner);\r\n\r\n\t\tvar pass:IPass = render.passes[0];\r\n\r\n\t\tthis.activatePass(renderable, pass, camera);\r\n\t\trenderable._iRender(pass, camera, this._skyboxProjection);\r\n\t\tthis.deactivatePass(renderable, pass);\r\n\t}\r\n\r\n\tprivate updateSkyboxProjection(camera:Camera)\r\n\t{\r\n\t\tvar near:Vector3D = new Vector3D();\r\n\r\n\t\tthis._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);\r\n\t\tthis._skyboxProjection.copyRowTo(2, near);\r\n\r\n\t\tvar camPos:Vector3D = camera.scenePosition;\r\n\r\n\t\tvar cx:number = near.x;\r\n\t\tvar cy:number = near.y;\r\n\t\tvar cz:number = near.z;\r\n\t\tvar cw:number = -(near.x*camPos.x + near.y*camPos.y + near.z*camPos.z + Math.sqrt(cx*cx + cy*cy + cz*cz));\r\n\r\n\t\tvar signX:number = cx >= 0? 1 : -1;\r\n\t\tvar signY:number = cy >= 0? 1 : -1;\r\n\r\n\t\tvar p:Vector3D = new Vector3D(signX, signY, 1, 1);\r\n\r\n\t\tvar inverse:Matrix3D = this._skyboxProjection.clone();\r\n\t\tinverse.invert();\r\n\r\n\t\tvar q:Vector3D = inverse.transformVector(p);\r\n\r\n\t\tthis._skyboxProjection.copyRowTo(3, p);\r\n\r\n\t\tvar a:number = (q.x*p.x + q.y*p.y + q.z*p.z + q.w*p.w)/(cx*q.x + cy*q.y + cz*q.z + cw*q.w);\r\n\r\n\t\tthis._skyboxProjection.copyRowFrom(2, new Vector3D(cx*a, cy*a, cz*a, cw*a));\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tif (!this._shareContext)\r\n\t\t\tthis._pStage.dispose();\r\n\r\n\t\tthis._pRttBufferManager.dispose();\r\n\t\tthis._pRttBufferManager = null;\r\n\r\n\t\tthis._pDepthRenderer.dispose();\r\n\t\tthis._pDistanceRenderer.dispose();\r\n\t\tthis._pDepthRenderer = null;\r\n\t\tthis._pDistanceRenderer = null;\r\n\r\n\t\tthis._pDepthRender = null;\r\n\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic pRenderDepthPrepass(entityCollector:EntityCollector)\r\n\t{\r\n\t\tthis._pDepthRenderer.disableColor = true;\r\n\r\n\t\tif (this._pFilter3DRenderer) {\r\n\t\t\tthis._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;\r\n\t\t\tthis._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;\r\n\t\t\tthis._pDepthRenderer._iRender(entityCollector, this._pFilter3DRenderer.getMainInputTexture(this._pStage), this._pRttBufferManager.renderToTextureRect);\r\n\t\t} else {\r\n\t\t\tthis._pDepthRenderer.textureRatioX = 1;\r\n\t\t\tthis._pDepthRenderer.textureRatioY = 1;\r\n\t\t\tthis._pDepthRenderer._iRender(entityCollector);\r\n\t\t}\r\n\r\n\t\tthis._pDepthRenderer.disableColor = false;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic pRenderSceneDepthToTexture(entityCollector:EntityCollector)\r\n\t{\r\n\t\tif (this._pDepthTextureInvalid || !this._pDepthRender)\r\n\t\t\tthis.initDepthTexture(<IContextGL> this._pStage.context);\r\n\r\n\t\tthis._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;\r\n\t\tthis._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;\r\n\t\tthis._pDepthRenderer._iRender(entityCollector, this._pDepthRender);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Updates the backbuffer dimensions.\r\n\t */\r\n\tpublic pUpdateBackBuffer()\r\n\t{\r\n\t\t// No reason trying to configure back buffer if there is no context available.\r\n\t\t// Doing this anyway (and relying on _stage to cache width/height for\r\n\t\t// context does get available) means usesSoftwareRendering won't be reliable.\r\n\t\tif (this._pStage.context && !this._shareContext) {\r\n\t\t\tif (this._width && this._height) {\r\n\t\t\t\tthis._pStage.configureBackBuffer(this._width, this._height, this._antiAlias, true);\r\n\t\t\t\tthis._pBackBufferInvalid = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate initDepthTexture(context:IContextGL):void\r\n\t{\r\n\t\tthis._pDepthTextureInvalid = false;\r\n\r\n\t\tif (this._pDepthRender)\r\n\t\t\tthis._pDepthRender.dispose();\r\n\r\n\t\tthis._pDepthRender = new BitmapImage2D(this._pRttBufferManager.textureWidth, this._pRttBufferManager.textureHeight);\r\n\t}\r\n}\r\n\r\nexport = DefaultRenderer;",
    "import Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/RendererBase\");\r\nimport DepthRender\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/DepthRender\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\n\r\n/**\r\n * The DepthRenderer class renders 32-bit depth information encoded as RGBA\r\n *\r\n * @class away.render.DepthRenderer\r\n */\r\nclass DepthRenderer extends RendererBase\r\n{\r\n\t/**\r\n\t * Creates a new DepthRenderer object.\r\n\t * @param renderBlended Indicates whether semi-transparent objects should be rendered.\r\n\t * @param distanceBased Indicates whether the written depth value is distance-based or projected depth-based\r\n\t */\r\n\tconstructor(stage:Stage = null)\r\n\t{\r\n\t\tsuper(stage);\r\n\r\n\t\tthis._pRenderablePool = new RenderablePool(this._pStage, DepthRender);\r\n\r\n\t\tthis._iBackgroundR = 1;\r\n\t\tthis._iBackgroundG = 1;\r\n\t\tthis._iBackgroundB = 1;\r\n\r\n\t}\r\n}\r\n\r\nexport = DepthRenderer;",
    "import Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/RendererBase\");\r\nimport DistanceRender\t\t\t\t= require(\"awayjs-renderergl/lib/render/DistanceRender\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\n\r\n\r\n/**\r\n * The DistanceRenderer class renders 32-bit depth information encoded as RGBA\r\n *\r\n * @class away.render.DistanceRenderer\r\n */\r\nclass DistanceRenderer extends RendererBase\r\n{\r\n\t/**\r\n\t * Creates a new DistanceRenderer object.\r\n\t * @param renderBlended Indicates whether semi-transparent objects should be rendered.\r\n\t * @param distanceBased Indicates whether the written depth value is distance-based or projected depth-based\r\n\t */\r\n\tconstructor(stage:Stage = null)\r\n\t{\r\n\t\tsuper(stage);\r\n\t\t\r\n\t\tthis._pRenderablePool = new RenderablePool(this._pStage, DistanceRender);\r\n\t\t\r\n\t\tthis._iBackgroundR = 1;\r\n\t\tthis._iBackgroundG = 1;\r\n\t\tthis._iBackgroundB = 1;\r\n\r\n\t}\r\n}\r\n\r\nexport = DistanceRenderer;",
    "import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLDrawMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLDrawMode\");\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\r\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\r\n\r\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\r\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\n/**\r\n * @class away.render.Filter3DRenderer\r\n */\r\nclass Filter3DRenderer\r\n{\r\n\tprivate _filters:Array<Filter3DBase>;\r\n\tprivate _tasks:Array<Filter3DTaskBase>;\r\n\tprivate _filterTasksInvalid:boolean;\r\n\tprivate _mainInputTexture:Image2D;\r\n\tprivate _requireDepthRender:boolean;\r\n\tprivate _rttManager:RTTBufferManager;\r\n\tprivate _stage:Stage;\r\n\tprivate _filterSizesInvalid:boolean = true;\r\n\tprivate _onRTTResizeDelegate:(event:Event) => void;\r\n\r\n\tconstructor(stage:Stage)\r\n\t{\r\n\t\tthis._onRTTResizeDelegate = (event:Event) => this.onRTTResize(event);\r\n\r\n\t\tthis._stage = stage;\r\n\t\tthis._rttManager = RTTBufferManager.getInstance(stage);\r\n\t\tthis._rttManager.addEventListener(Event.RESIZE, this._onRTTResizeDelegate);\r\n\r\n\t}\r\n\r\n\tprivate onRTTResize(event:Event)\r\n\t{\r\n\t\tthis._filterSizesInvalid = true;\r\n\t}\r\n\r\n\tpublic get requireDepthRender():boolean\r\n\t{\r\n\t\treturn this._requireDepthRender;\r\n\t}\r\n\r\n\tpublic getMainInputTexture(stage:Stage):Image2D\r\n\t{\r\n\t\tif (this._filterTasksInvalid)\r\n\t\t\tthis.updateFilterTasks(stage);\r\n\r\n\t\treturn this._mainInputTexture;\r\n\t}\r\n\r\n\tpublic get filters():Filter3DBase[]\r\n\t{\r\n\t\treturn this._filters;\r\n\t}\r\n\r\n\tpublic set filters(value:Filter3DBase[])\r\n\t{\r\n\t\tthis._filters = value;\r\n\r\n\t\tthis._filterTasksInvalid = true;\r\n\r\n\t\tthis._requireDepthRender = false;\r\n\r\n\t\tif (!this._filters)\r\n\t\t\treturn;\r\n\r\n\t\tfor (var i:number = 0; i < this._filters.length; ++i)\r\n\t\t\tif (this._filters[i].requireDepthRender)\r\n\t\t\t\tthis._requireDepthRender = true;\r\n\r\n\t\tthis._filterSizesInvalid = true;\r\n\t}\r\n\r\n\tprivate updateFilterTasks(stage:Stage)\r\n\t{\r\n\t\tvar len:number;\r\n\r\n\t\tif (this._filterSizesInvalid)\r\n\t\t\tthis.updateFilterSizes();\r\n\r\n\t\tif (!this._filters) {\r\n\t\t\tthis._tasks = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._tasks = new Array<Filter3DTaskBase>();\r\n\r\n\t\tlen = this._filters.length - 1;\r\n\r\n\t\tvar filter:Filter3DBase;\r\n\r\n\t\tfor (var i:number = 0; i <= len; ++i) {\r\n\r\n\t\t\t// make sure all internal tasks are linked together\r\n\t\t\tfilter = this._filters[i];\r\n\r\n\t\t\tfilter.setRenderTargets(i == len? null : this._filters[i + 1].getMainInputTexture(stage), stage);\r\n\r\n\t\t\tthis._tasks = this._tasks.concat(filter.tasks);\r\n\r\n\t\t}\r\n\r\n\t\tthis._mainInputTexture = this._filters[0].getMainInputTexture(stage);\r\n\r\n\t}\r\n\r\n\tpublic render(stage:Stage, camera:Camera, depthTexture:Image2D)\r\n\t{\r\n\t\tvar len:number;\r\n\t\tvar i:number;\r\n\t\tvar task:Filter3DTaskBase;\r\n\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n\r\n\t\tvar indexBuffer:IIndexBuffer = this._rttManager.indexBuffer;\r\n\r\n\t\tvar vertexBuffer:IVertexBuffer = this._rttManager.renderToTextureVertexBuffer;\r\n\r\n\t\tif (!this._filters)\r\n\t\t\treturn;\r\n\r\n\t\tif (this._filterSizesInvalid)\r\n\t\t\tthis.updateFilterSizes();\r\n\r\n\t\tif (this._filterTasksInvalid)\r\n\t\t\tthis.updateFilterTasks(stage);\r\n\r\n\t\tlen = this._filters.length;\r\n\r\n\t\tfor (i = 0; i < len; ++i)\r\n\t\t\tthis._filters[i].update(stage, camera);\r\n\r\n\t\tlen = this._tasks.length;\r\n\r\n\t\tif (len > 1) {\r\n\t\t\tcontext.setProgram(this._tasks[0].getProgram(stage));\r\n\t\t\tcontext.setVertexBufferAt(0, vertexBuffer, 0, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t\tcontext.setVertexBufferAt(1, vertexBuffer, 8, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\r\n\t\t\ttask = this._tasks[i];\r\n\r\n\t\t\tstage.setRenderTarget(task.target);\r\n\r\n\t\t\tcontext.setProgram(task.getProgram(stage));\r\n\t\t\tstage.getImageObject(task.getMainInputTexture(stage)).activate(0, false, true, false);\r\n\r\n\r\n\t\t\tif (!task.target) {\r\n\r\n\t\t\t\tstage.scissorRect = null;\r\n\t\t\t\tvertexBuffer = this._rttManager.renderToScreenVertexBuffer;\r\n\t\t\t\tcontext.setVertexBufferAt(0, vertexBuffer, 0, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t\t\tcontext.setVertexBufferAt(1, vertexBuffer, 8, ContextGLVertexBufferFormat.FLOAT_2);\r\n\r\n\t\t\t}\r\n\t\t\tcontext.clear(0.0, 0.0, 0.0, 0.0);\r\n\r\n\t\t\ttask.activate(stage, camera, depthTexture);\r\n\r\n\t\t\tcontext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\t\t\tcontext.drawIndices(ContextGLDrawMode.TRIANGLES, indexBuffer, 0, 6);\r\n\r\n\t\t\ttask.deactivate(stage);\r\n\t\t}\r\n\r\n\t\tcontext.setTextureAt(0, null);\r\n\t\tcontext.setVertexBufferAt(0, null);\r\n\t\tcontext.setVertexBufferAt(1, null);\r\n\t}\r\n\r\n\tprivate updateFilterSizes()\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._filters.length; ++i) {\r\n\t\t\tthis._filters[i].textureWidth = this._rttManager.textureWidth;\r\n\t\t\tthis._filters[i].textureHeight = this._rttManager.textureHeight;\r\n\t\t}\r\n\r\n\t\tthis._filterSizesInvalid = true;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._rttManager.removeEventListener(Event.RESIZE, this._onRTTResizeDelegate);\r\n\t\tthis._rttManager = null;\r\n\t\tthis._stage = null;\r\n\t}\r\n}\r\n\r\nexport = Filter3DRenderer;",
    "import ImageBase\t\t\t\t\t= require(\"awayjs-core/lib/data/ImageBase\");\r\nimport BitmapImage2D\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\r\nimport Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport EntityListItem\t\t\t\t= require(\"awayjs-display/lib/pool/EntityListItem\");\r\nimport IEntitySorter\t\t\t\t= require(\"awayjs-display/lib/sort/IEntitySorter\");\r\nimport RenderableMergeSort\t\t\t= require(\"awayjs-display/lib/sort/RenderableMergeSort\");\r\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/IRenderer\");\r\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport DisplayObject\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport RendererEvent\t\t\t\t= require(\"awayjs-display/lib/events/RendererEvent\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\r\nimport ShadowCasterCollector\t\t= require(\"awayjs-display/lib/traverse/ShadowCasterCollector\");\r\n\r\nimport AGALMiniAssembler\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport StageEvent\t\t\t\t\t= require(\"awayjs-stagegl/lib/events/StageEvent\");\r\nimport StageManager\t\t\t\t\t= require(\"awayjs-stagegl/lib/managers/StageManager\");\r\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\r\n\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\n\r\n\r\n/**\r\n * RendererBase forms an abstract base class for classes that are used in the rendering pipeline to render the\r\n * contents of a partition\r\n *\r\n * @class away.render.RendererBase\r\n */\r\nclass RendererBase extends EventDispatcher implements IRenderer\r\n{\r\n\tprivate _maskConfig:number;\r\n\tprivate _activeMasksDirty:boolean;\r\n\tprivate _activeMasksConfig:Array<Array<number>> = new Array<Array<number>>();\r\n\tprivate _registeredMasks : Array<RenderableBase> = new Array<RenderableBase>();\r\n\tprivate _numUsedStreams:number = 0;\r\n\tprivate _numUsedTextures:number = 0;\r\n\r\n\tpublic _pRenderablePool:RenderablePool;\r\n\r\n\tpublic _pContext:IContextGL;\r\n\tpublic _pStage:Stage;\r\n\r\n\tpublic _pCamera:Camera;\r\n\tpublic _iEntryPoint:Vector3D;\r\n\tpublic _pCameraForward:Vector3D;\r\n\r\n\tpublic _pRttBufferManager:RTTBufferManager;\r\n\tprivate _viewPort:Rectangle = new Rectangle();\r\n\tprivate _viewportDirty:boolean;\r\n\tprivate _scissorDirty:boolean;\r\n\r\n\tpublic _pBackBufferInvalid:boolean = true;\r\n\tpublic _pDepthTextureInvalid:boolean = true;\r\n\tpublic _depthPrepass:boolean = false;\r\n\tprivate _backgroundR:number = 0;\r\n\tprivate _backgroundG:number = 0;\r\n\tprivate _backgroundB:number = 0;\r\n\tprivate _backgroundAlpha:number = 1;\r\n\tpublic _shareContext:boolean;\r\n\r\n\t// only used by renderers that need to render geometry to textures\r\n\tpublic _width:number;\r\n\tpublic _height:number;\r\n\r\n\tpublic textureRatioX:number = 1;\r\n\tpublic textureRatioY:number = 1;\r\n\r\n\tprivate _snapshotBitmapImage2D:BitmapImage2D;\r\n\tprivate _snapshotRequired:boolean;\r\n\r\n\tpublic _pRttViewProjectionMatrix:Matrix3D = new Matrix3D();\r\n\r\n\tprivate _localPos:Point = new Point();\r\n\tprivate _globalPos:Point = new Point();\r\n\tpublic _pScissorRect:Rectangle = new Rectangle();\r\n\r\n\tprivate _scissorUpdated:RendererEvent;\r\n\tprivate _viewPortUpdated:RendererEvent;\r\n\r\n\tprivate _onContextUpdateDelegate:Function;\r\n\tprivate _onViewportUpdatedDelegate;\r\n\r\n\tpublic _pNumElements:number = 0;\r\n\r\n\tpublic _pOpaqueRenderableHead:RenderableBase;\r\n\tpublic _pBlendedRenderableHead:RenderableBase;\r\n\tpublic _disableColor:boolean = false;\r\n\tpublic _renderBlended:boolean = true;\r\n\r\n\r\n\tpublic get renderBlended():boolean\r\n\t{\r\n\t\treturn this._renderBlended;\r\n\t}\r\n\r\n\tpublic set renderBlended(value:boolean)\r\n\t{\r\n\t\tthis._renderBlended = value;\r\n\t}\r\n\r\n\r\n\tpublic get disableColor():boolean\r\n\t{\r\n\t\treturn this._disableColor;\r\n\t}\r\n\r\n\tpublic set disableColor(value:boolean)\r\n\t{\r\n\t\tthis._disableColor = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get numElements():number\r\n\t{\r\n\t\treturn this._pNumElements;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderableSorter:IEntitySorter;\r\n\r\n\r\n\t/**\r\n\t * A viewPort rectangle equivalent of the Stage size and position.\r\n\t */\r\n\tpublic get viewPort():Rectangle\r\n\t{\r\n\t\treturn this._viewPort;\r\n\t}\r\n\r\n\t/**\r\n\t * A scissor rectangle equivalent of the view size and position.\r\n\t */\r\n\tpublic get scissorRect():Rectangle\r\n\t{\r\n\t\treturn this._pScissorRect;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get x():number\r\n\t{\r\n\t\treturn this._localPos.x;\r\n\t}\r\n\r\n\tpublic set x(value:number)\r\n\t{\r\n\t\tif (this.x == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._globalPos.x = this._localPos.x = value;\r\n\r\n\t\tthis.updateGlobalPos();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get y():number\r\n\t{\r\n\t\treturn this._localPos.y;\r\n\t}\r\n\r\n\tpublic set y(value:number)\r\n\t{\r\n\t\tif (this.y == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._globalPos.y = this._localPos.y = value;\r\n\r\n\t\tthis.updateGlobalPos();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get width():number\r\n\t{\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tpublic set width(value:number)\r\n\t{\r\n\t\tif (this._width == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._width = value;\r\n\t\tthis._pScissorRect.width = value;\r\n\r\n\t\tif (this._pRttBufferManager)\r\n\t\t\tthis._pRttBufferManager.viewWidth = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t\tthis._pDepthTextureInvalid = true;\r\n\r\n\t\tthis.notifyScissorUpdate();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get height():number\r\n\t{\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tpublic set height(value:number)\r\n\t{\r\n\t\tif (this._height == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._height = value;\r\n\t\tthis._pScissorRect.height = value;\r\n\r\n\t\tif (this._pRttBufferManager)\r\n\t\t\tthis._pRttBufferManager.viewHeight = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t\tthis._pDepthTextureInvalid = true;\r\n\r\n\t\tthis.notifyScissorUpdate();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new RendererBase object.\r\n\t */\r\n\tconstructor(stage:Stage = null, forceSoftware:boolean = false, profile:string = \"baseline\", mode:string = \"auto\")\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._onViewportUpdatedDelegate = (event:StageEvent) => this.onViewportUpdated(event);\r\n\t\tthis._onContextUpdateDelegate = (event:Event) => this.onContextUpdate(event);\r\n\r\n\t\t//default sorting algorithm\r\n\t\tthis.renderableSorter = new RenderableMergeSort();\r\n\r\n\t\t//set stage\r\n\t\tthis._pStage = stage || StageManager.getInstance().getFreeStage(forceSoftware, profile, mode);\r\n\r\n\t\tthis._pStage.addEventListener(StageEvent.CONTEXT_CREATED, this._onContextUpdateDelegate);\r\n\t\tthis._pStage.addEventListener(StageEvent.CONTEXT_RECREATED, this._onContextUpdateDelegate);\r\n\t\tthis._pStage.addEventListener(StageEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\r\n\r\n\t\t/*\r\n\t\t if (_backgroundImageRenderer)\r\n\t\t _backgroundImageRenderer.stage = value;\r\n\t\t */\r\n\t\tif (this._pStage.context)\r\n\t\t\tthis._pContext = <IContextGL> this._pStage.context;\r\n\r\n\t}\r\n\r\n\tpublic activatePass(renderable:RenderableBase, pass:IPass, camera:Camera)\r\n\t{\r\n\t\t//clear unused vertex streams\r\n\t\tfor (var i = pass.shader.numUsedStreams; i < this._numUsedStreams; i++)\r\n\t\t\tthis._pContext.setVertexBufferAt(i, null);\r\n\r\n\t\t//clear unused texture streams\r\n\t\tfor (var i = pass.shader.numUsedTextures; i < this._numUsedTextures; i++)\r\n\t\t\tthis._pContext.setTextureAt(i, null);\r\n\r\n\t\t//check program data is uploaded\r\n\t\tvar programData:ProgramData = pass.shader.programData;\r\n\r\n\t\tif (!programData.program) {\r\n\t\t\tprogramData.program = this._pContext.createProgram();\r\n\t\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + programData.vertexString + \"endpart\"))['vertex'].data;\r\n\t\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + programData.fragmentString + \"endpart\"))['fragment'].data;\r\n\t\t\tprogramData.program.upload(vertexByteCode, fragmentByteCode);\r\n\t\t}\r\n\r\n\t\t//set program data\r\n\t\tthis._pContext.setProgram(programData.program);\r\n\r\n\t\t//activate shader object through renderable\r\n\t\trenderable._iActivate(pass, camera);\r\n\t}\r\n\r\n\tpublic deactivatePass(renderable:RenderableBase, pass:IPass)\r\n\t{\r\n\t\t//deactivate shader object\r\n\t\trenderable._iDeactivate(pass);\r\n\r\n\t\tthis._numUsedStreams = pass.shader.numUsedStreams;\r\n\t\tthis._numUsedTextures = pass.shader.numUsedTextures;\r\n\t}\r\n\r\n\tpublic _iCreateEntityCollector():CollectorBase\r\n\t{\r\n\t\treturn new EntityCollector();\r\n\t}\r\n\r\n\t/**\r\n\t * The background color's red component, used when clearing.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic get _iBackgroundR():number\r\n\t{\r\n\t\treturn this._backgroundR;\r\n\t}\r\n\r\n\tpublic set _iBackgroundR(value:number)\r\n\t{\r\n\t\tif (this._backgroundR == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundR = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/**\r\n\t * The background color's green component, used when clearing.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic get _iBackgroundG():number\r\n\t{\r\n\t\treturn this._backgroundG;\r\n\t}\r\n\r\n\tpublic set _iBackgroundG(value:number)\r\n\t{\r\n\t\tif (this._backgroundG == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundG = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/**\r\n\t * The background color's blue component, used when clearing.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic get _iBackgroundB():number\r\n\t{\r\n\t\treturn this._backgroundB;\r\n\t}\r\n\r\n\tpublic set _iBackgroundB(value:number)\r\n\t{\r\n\t\tif (this._backgroundB == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundB = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\tpublic get context():IContextGL\r\n\t{\r\n\t\treturn this._pContext;\r\n\t}\r\n\r\n\t/**\r\n\t * The Stage that will provide the ContextGL used for rendering.\r\n\t */\r\n\tpublic get stage():Stage\r\n\t{\r\n\t\treturn this._pStage;\r\n\t}\r\n\r\n\t/**\r\n\t * Defers control of ContextGL clear() and present() calls to Stage, enabling multiple Stage frameworks\r\n\t * to share the same ContextGL object.\r\n\t */\r\n\tpublic get shareContext():boolean\r\n\t{\r\n\t\treturn this._shareContext;\r\n\t}\r\n\r\n\tpublic get renderablePool():RenderablePool\r\n\t{\r\n\t\treturn this._pRenderablePool;\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes the resources used by the RendererBase.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pRenderablePool.dispose();\r\n\r\n\t\tthis._pStage.removeEventListener(StageEvent.CONTEXT_CREATED, this._onContextUpdateDelegate);\r\n\t\tthis._pStage.removeEventListener(StageEvent.CONTEXT_RECREATED, this._onContextUpdateDelegate);\r\n\t\tthis._pStage.removeEventListener(StageEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\r\n\r\n\t\tthis._pStage = null;\r\n\t\tthis._pContext = null;\r\n\t\t/*\r\n\t\t if (_backgroundImageRenderer) {\r\n\t\t _backgroundImageRenderer.dispose();\r\n\t\t _backgroundImageRenderer = null;\r\n\t\t }\r\n\t\t */\r\n\t}\r\n\r\n\tpublic render(entityCollector:CollectorBase)\r\n\t{\r\n\t\tthis._viewportDirty = false;\r\n\t\tthis._scissorDirty = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the potentially visible geometry to the back buffer or texture.\r\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\r\n\t * @param target An option target texture to render to.\r\n\t * @param surfaceSelector The index of a CubeTexture's face to render to.\r\n\t * @param additionalClearMask Additional clear mask information, in case extra clear channels are to be omitted.\r\n\t */\r\n\tpublic _iRender(entityCollector:CollectorBase, target:ImageBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\r\n\t{\r\n\t\t//TODO refactor setTarget so that rendertextures are created before this check\r\n\t\tif (!this._pStage || !this._pContext)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pRttViewProjectionMatrix.copyFrom(entityCollector.camera.viewProjection);\r\n\t\tthis._pRttViewProjectionMatrix.appendScale(this.textureRatioX, this.textureRatioY, 1);\r\n\r\n\t\tthis.pExecuteRender(entityCollector, target, scissorRect, surfaceSelector);\r\n\r\n\t\t// generate mip maps on target (if target exists) //TODO\r\n\t\t//if (target)\r\n\t\t//\t(<Texture>target).generateMipmaps();\r\n\r\n\t\t// clear buffers\r\n\t\tfor (var i:number = 0; i < 8; ++i) {\r\n\t\t\tthis._pContext.setVertexBufferAt(i, null);\r\n\t\t\tthis._pContext.setTextureAt(i, null);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _iRenderCascades(entityCollector:ShadowCasterCollector, target:ImageBase, numCascades:number, scissorRects:Array<Rectangle>, cameras:Array<Camera>)\r\n\t{\r\n\t\tthis._applyCollector(entityCollector);\r\n\r\n\t\tthis._pStage.setRenderTarget(target, true, 0);\r\n\t\tthis._pContext.clear(1, 1, 1, 1, 1, 0);\r\n\r\n\t\tthis._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\t\tthis._pContext.setDepthTest(true, ContextGLCompareMode.LESS);\r\n\r\n\t\tvar head:RenderableBase = this._pOpaqueRenderableHead;\r\n\r\n\t\tvar first:boolean = true;\r\n\r\n\t\t//TODO cascades must have separate collectors, rather than separate draw commands\r\n\t\tfor (var i:number = numCascades - 1; i >= 0; --i) {\r\n\t\t\tthis._pStage.scissorRect = scissorRects[i];\r\n\t\t\t//this.drawCascadeRenderables(head, cameras[i], first? null : cameras[i].frustumPlanes);\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\t//line required for correct rendering when using away3d with starling. DO NOT REMOVE UNLESS STARLING INTEGRATION IS RETESTED!\r\n\t\tthis._pContext.setDepthTest(false, ContextGLCompareMode.LESS_EQUAL);\r\n\r\n\t\tthis._pStage.scissorRect = null;\r\n\t}\r\n\r\n\tprivate _applyCollector(entityCollector:CollectorBase)\r\n\t{\r\n\t\t//reset head values\r\n\t\tthis._pBlendedRenderableHead = null;\r\n\t\tthis._pOpaqueRenderableHead = null;\r\n\t\tthis._pNumElements = 0;\r\n\r\n\t\t//grab entity head\r\n\t\tvar item:EntityListItem = entityCollector.entityHead;\r\n\r\n\t\t//set temp values for entry point and camera forward vector\r\n\t\tthis._pCamera = entityCollector.camera;\r\n\t\tthis._iEntryPoint = this._pCamera.scenePosition;\r\n\t\tthis._pCameraForward = this._pCamera.transform.forwardVector;\r\n\r\n\t\t//iterate through all entities\r\n\t\twhile (item) {\r\n\t\t\titem.entity._applyRenderer(this);\r\n\t\t\titem = item.next;\r\n\t\t}\r\n\r\n\t\t//sort the resulting renderables\r\n\t\tif (this.renderableSorter) {\r\n\t\t\tthis._pOpaqueRenderableHead = <RenderableBase> this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead);\r\n\t\t\tthis._pBlendedRenderableHead = <RenderableBase> this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the potentially visible geometry to the back buffer or texture. Only executed if everything is set up.\r\n\t *\r\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\r\n\t * @param target An option target texture to render to.\r\n\t * @param surfaceSelector The index of a CubeTexture's face to render to.\r\n\t * @param additionalClearMask Additional clear mask information, in case extra clear channels are to be omitted.\r\n\t */\r\n\tpublic pExecuteRender(entityCollector:CollectorBase, target:ImageBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\r\n\t{\r\n\t\tthis._pStage.setRenderTarget(target, true, surfaceSelector);\r\n\r\n\t\tif ((target || !this._shareContext) && !this._depthPrepass)\r\n\t\t\tthis._pContext.clear(this._backgroundR, this._backgroundG, this._backgroundB, this._backgroundAlpha, 1, 0);\r\n\r\n\t\tthis._pStage.scissorRect = scissorRect;\r\n\r\n\t\t/*\r\n\t\t if (_backgroundImageRenderer)\r\n\t\t _backgroundImageRenderer.render();\r\n\t\t */\r\n\t\tthis._applyCollector(entityCollector);\r\n\r\n\t\tthis._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\r\n\t\tthis.pDraw(entityCollector);\r\n\r\n\t\t//line required for correct rendering when using away3d with starling. DO NOT REMOVE UNLESS STARLING INTEGRATION IS RETESTED!\r\n\t\t//this._pContext.setDepthTest(false, ContextGLCompareMode.LESS_EQUAL); //oopsie\r\n\r\n\t\tif (!this._shareContext) {\r\n\t\t\tif (this._snapshotRequired && this._snapshotBitmapImage2D) {\r\n\t\t\t\tthis._pContext.drawToBitmapImage2D(this._snapshotBitmapImage2D);\r\n\t\t\t\tthis._snapshotRequired = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._pStage.scissorRect = null;\r\n\t}\r\n\r\n\t/*\r\n\t * Will draw the renderer's output on next render to the provided bitmap data.\r\n\t * */\r\n\tpublic queueSnapshot(bmd:BitmapImage2D)\r\n\t{\r\n\t\tthis._snapshotRequired = true;\r\n\t\tthis._snapshotBitmapImage2D = bmd;\r\n\t}\r\n\r\n\t/**\r\n\t * Performs the actual drawing of geometry to the target.\r\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\r\n\t */\r\n\tpublic pDraw(entityCollector:CollectorBase)\r\n\t{\r\n\t\tthis._pContext.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);\r\n\r\n\t\tif (this._disableColor)\r\n\t\t\tthis._pContext.setColorMask(false, false, false, false);\r\n\r\n\t\tthis.drawRenderables(this._pOpaqueRenderableHead, entityCollector);\r\n\r\n\t\tif (this._renderBlended)\r\n\t\t\tthis.drawRenderables(this._pBlendedRenderableHead, entityCollector);\r\n\r\n\t\tif (this._disableColor)\r\n\t\t\tthis._pContext.setColorMask(true, true, true, true);\r\n\t}\r\n\r\n\t//private drawCascadeRenderables(renderable:RenderableBase, camera:Camera, cullPlanes:Array<Plane3D>)\r\n\t//{\r\n\t//\tvar renderable2:RenderableBase;\r\n\t//\tvar render:RenderBase;\r\n\t//\tvar pass:IPass;\r\n\t//\r\n\t//\twhile (renderable) {\r\n\t//\t\trenderable2 = renderable;\r\n\t//\t\trender = renderable.render;\r\n\t//\t\tpass = render.passes[0] //assuming only one pass per material\r\n\t//\r\n\t//\t\tthis.activatePass(renderable, pass, camera);\r\n\t//\r\n\t//\t\tdo {\r\n\t//\t\t\t// if completely in front, it will fall in a different cascade\r\n\t//\t\t\t// do not use near and far planes\r\n\t//\t\t\tif (!cullPlanes || renderable2.sourceEntity.worldBounds.isInFrustum(cullPlanes, 4)) {\r\n\t//\t\t\t\trenderable2._iRender(pass, camera, this._pRttViewProjectionMatrix);\r\n\t//\t\t\t} else {\r\n\t//\t\t\t\trenderable2.cascaded = true;\r\n\t//\t\t\t}\r\n\t//\r\n\t//\t\t\trenderable2 = renderable2.next;\r\n\t//\r\n\t//\t\t} while (renderable2 && renderable2.render == render && !renderable2.cascaded);\r\n\t//\r\n\t//\t\tthis.deactivatePass(renderable, pass);\r\n\t//\r\n\t//\t\trenderable = renderable2;\r\n\t//\t}\r\n\t//}\r\n\r\n\t/**\r\n\t * Draw a list of renderables.\r\n\t *\r\n\t * @param renderables The renderables to draw.\r\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\r\n\t */\r\n\tpublic drawRenderables(renderable:RenderableBase, entityCollector:CollectorBase)\r\n\t{\r\n\t\tvar i:number;\r\n\t\tvar len:number;\r\n\t\tvar renderable2:RenderableBase;\r\n\t\tvar render:RenderBase;\r\n\t\tvar passes:Array<IPass>;\r\n\t\tvar pass:IPass;\r\n\t\tvar camera:Camera = entityCollector.camera;\r\n\r\n\t\tthis._pContext.setStencilActions(\"frontAndBack\", \"always\", \"keep\", \"keep\", \"keep\");\r\n\r\n\t\tthis._registeredMasks.length = 0;\r\n\t\tvar gl = this._pContext[\"_gl\"];\r\n\t\tif(gl) {\r\n\t\t\tgl.disable(gl.STENCIL_TEST);\r\n\t\t}\r\n\r\n\t\tthis._maskConfig = 0;\r\n\r\n\t\twhile (renderable) {\r\n\t\t\trender = renderable.render;\r\n\t\t\tpasses = render.passes;\r\n\r\n\t\t\t// otherwise this would result in depth rendered anyway because fragment shader kil is ignored\r\n\t\t\tif (this._disableColor && render._renderOwner.alphaThreshold != 0) {\r\n\t\t\t\trenderable2 = renderable;\r\n\t\t\t\t// fast forward\r\n\t\t\t\tdo {\r\n\t\t\t\t\trenderable2 = renderable2.next;\r\n\r\n\t\t\t\t} while (renderable2 && renderable2.render == render);\r\n\t\t\t} else {\r\n\t\t\t\tif (this._activeMasksDirty || this._checkMasksConfig(renderable.masksConfig)) {\r\n\t\t\t\t\tthis._activeMasksConfig = renderable.masksConfig;\r\n\t\t\t\t\tif (!this._activeMasksConfig.length) {\r\n\t\t\t\t\t\t// disable stencil\r\n\t\t\t\t\t\tif(gl) {\r\n\t\t\t\t\t\t\tgl.disable(gl.STENCIL_TEST);\r\n\t\t\t\t\t\t\tgl.stencilFunc(gl.ALWAYS, 0, 0xff);\r\n\t\t\t\t\t\t\tgl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._renderMasks(renderable.sourceEntity._iAssignedMasks());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._activeMasksDirty = false;\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\t//iterate through each shader object\r\n\t\t\t\tlen = passes.length;\r\n\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\trenderable2 = renderable;\r\n\t\t\t\t\tpass = passes[i];\r\n\r\n\t\t\t\t\tthis.activatePass(renderable, pass, camera);\r\n\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tif (renderable2.maskId !== -1) {\r\n\t\t\t\t\t\t\tif (i == 0)\r\n\t\t\t\t\t\t\t\tthis._registerMask(renderable2);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trenderable2._iRender(pass, camera, this._pRttViewProjectionMatrix);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\trenderable2 = renderable2.next;\r\n\r\n\t\t\t\t\t} while (renderable2 && renderable2.render == render && !(this._activeMasksDirty = this._checkMasksConfig(renderable2.masksConfig)));\r\n\r\n\t\t\t\t\tthis.deactivatePass(renderable, pass);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\trenderable = renderable2;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Assign the context once retrieved\r\n\t */\r\n\tprivate onContextUpdate(event:Event)\r\n\t{\r\n\t\tthis._pContext = <IContextGL> this._pStage.context;\r\n\t}\r\n\r\n\tpublic get _iBackgroundAlpha():number\r\n\t{\r\n\t\treturn this._backgroundAlpha;\r\n\t}\r\n\r\n\tpublic set _iBackgroundAlpha(value:number)\r\n\t{\r\n\t\tif (this._backgroundAlpha == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundAlpha = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/*\r\n\t public get iBackground():Texture2DBase\r\n\t {\r\n\t return this._background;\r\n\t }\r\n\t */\r\n\r\n\t/*\r\n\t public set iBackground(value:Texture2DBase)\r\n\t {\r\n\t if (this._backgroundImageRenderer && !value) {\r\n\t this._backgroundImageRenderer.dispose();\r\n\t this._backgroundImageRenderer = null;\r\n\t }\r\n\r\n\t if (!this._backgroundImageRenderer && value)\r\n\t {\r\n\r\n\t this._backgroundImageRenderer = new BackgroundImageRenderer(this._pStage);\r\n\r\n\t }\r\n\r\n\r\n\t this._background = value;\r\n\r\n\t if (this._backgroundImageRenderer)\r\n\t this._backgroundImageRenderer.texture = value;\r\n\t }\r\n\t */\r\n\t/*\r\n\t public get backgroundImageRenderer():BackgroundImageRenderer\r\n\t {\r\n\t return _backgroundImageRenderer;\r\n\t }\r\n\t */\r\n\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tprivate notifyScissorUpdate()\r\n\t{\r\n\t\tif (this._scissorDirty)\r\n\t\t\treturn;\r\n\r\n\t\tthis._scissorDirty = true;\r\n\r\n\t\tif (!this._scissorUpdated)\r\n\t\t\tthis._scissorUpdated = new RendererEvent(RendererEvent.SCISSOR_UPDATED);\r\n\r\n\t\tthis.dispatchEvent(this._scissorUpdated);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tprivate notifyViewportUpdate()\r\n\t{\r\n\t\tif (this._viewportDirty)\r\n\t\t\treturn;\r\n\r\n\t\tthis._viewportDirty = true;\r\n\r\n\t\tif (!this._viewPortUpdated)\r\n\t\t\tthis._viewPortUpdated = new RendererEvent(RendererEvent.VIEWPORT_UPDATED);\r\n\r\n\t\tthis.dispatchEvent(this._viewPortUpdated);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic onViewportUpdated(event:StageEvent)\r\n\t{\r\n\t\tthis._viewPort = this._pStage.viewPort;\r\n\t\t//TODO stop firing viewport updated for every stagegl viewport change\r\n\r\n\t\tif (this._shareContext) {\r\n\t\t\tthis._pScissorRect.x = this._globalPos.x - this._pStage.x;\r\n\t\t\tthis._pScissorRect.y = this._globalPos.y - this._pStage.y;\r\n\t\t\tthis.notifyScissorUpdate();\r\n\t\t}\r\n\r\n\t\tthis.notifyViewportUpdate();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic updateGlobalPos()\r\n\t{\r\n\t\tif (this._shareContext) {\r\n\t\t\tthis._pScissorRect.x = this._globalPos.x - this._viewPort.x;\r\n\t\t\tthis._pScissorRect.y = this._globalPos.y - this._viewPort.y;\r\n\t\t} else {\r\n\t\t\tthis._pScissorRect.x = 0;\r\n\t\t\tthis._pScissorRect.y = 0;\r\n\t\t\tthis._viewPort.x = this._globalPos.x;\r\n\t\t\tthis._viewPort.y = this._globalPos.y;\r\n\t\t}\r\n\r\n\t\tthis.notifyScissorUpdate();\r\n\t}\r\n\r\n\tpublic _iApplyRenderableOwner(renderableOwner:IRenderableOwner)\r\n\t{\r\n\t\tvar renderable:RenderableBase = this._pRenderablePool.getItem(renderableOwner);\r\n\t\tvar render:RenderBase = renderable.render;\r\n\r\n\t\t//set local vars for faster referencing\r\n\t\trenderable.renderId = render.renderId;\r\n\t\trenderable.renderOrderId = render.renderOrderId;\r\n\r\n\t\trenderable.cascaded = false;\r\n\r\n\t\tvar entity:IEntity = renderable.sourceEntity;\r\n\t\tvar position:Vector3D = entity.scenePosition;\r\n\r\n\t\t// project onto camera's z-axis\r\n\t\tposition = this._iEntryPoint.subtract(position);\r\n\t\trenderable.zIndex = entity.zOffset + position.dotProduct(this._pCameraForward);\r\n\t\trenderable.maskId = entity._iAssignedMaskId();\r\n\t\trenderable.masksConfig = entity._iMasksConfig();\r\n\r\n\t\t//store reference to scene transform\r\n\t\trenderable.renderSceneTransform = renderable.sourceEntity.getRenderSceneTransform(this._pCamera);\r\n\r\n\t\tif (render.requiresBlending) {\r\n\t\t\trenderable.next = this._pBlendedRenderableHead;\r\n\t\t\tthis._pBlendedRenderableHead = renderable;\r\n\t\t} else {\r\n\t\t\trenderable.next = this._pOpaqueRenderableHead;\r\n\t\t\tthis._pOpaqueRenderableHead = renderable;\r\n\t\t}\r\n\r\n\t\tthis._pNumElements += renderable.subGeometryVO.subGeometry.numElements;\r\n\t}\r\n\r\n\tprivate _registerMask(obj:RenderableBase)\r\n\t{\r\n\t\t//console.log(\"registerMask\");\r\n\t\tthis._registeredMasks.push(obj);\r\n\t}\r\n\r\n\tpublic _renderMasks(masks:DisplayObject[][])\r\n\t{\r\n\t\tvar gl = this._pContext[\"_gl\"];\r\n\t\t//var oldRenderTarget = this._stage.renderTarget;\r\n\r\n\t\t//this._stage.setRenderTarget(this._image);\r\n\t\t//this._stage.clear();\r\n\t\tthis._pContext.setColorMask(false, false, false, false);\r\n\t\t// TODO: Could we create masks within masks by providing a previous configID, and supply \"clear/keep\" on stencil fail\r\n\t\t//context.setStencilActions(\"frontAndBack\", \"always\", \"set\", \"set\", \"set\");\r\n\t\tgl.enable(gl.STENCIL_TEST);\r\n\t\tthis._maskConfig++;\r\n\t\tgl.stencilFunc(gl.ALWAYS, this._maskConfig, 0xff);\r\n\t\tgl.stencilOp(gl.REPLACE, gl.REPLACE, gl.REPLACE);\r\n\r\n\t\tvar numLayers:number = masks.length;\r\n\t\tvar numRenderables:number = this._registeredMasks.length;\r\n\t\tvar renderable:RenderableBase;\r\n\t\tvar children:Array<DisplayObject>;\r\n\t\tvar numChildren:number;\r\n\t\tvar mask:DisplayObject;\r\n\r\n\t\tfor (var i:number = 0; i < numLayers; ++i) {\r\n\t\t\tif (i != 0) {\r\n\t\t\t\tgl.stencilFunc(gl.EQUAL, this._maskConfig, 0xff);\r\n\t\t\t\tgl.stencilOp(gl.KEEP, gl.INCR, gl.INCR);\r\n\t\t\t\tthis._maskConfig++;\r\n\t\t\t}\r\n\r\n\t\t\tchildren = masks[i];\r\n\t\t\tnumChildren = children.length;\r\n\r\n\t\t\tfor (var j:number = 0; j < numChildren; ++j) {\r\n\t\t\t\tmask = children[j];\r\n\t\t\t\tfor (var k:number = 0; k < numRenderables; ++k) {\r\n\t\t\t\t\trenderable = this._registeredMasks[k];\r\n\t\t\t\t\t//console.log(\"testing for \" + mask[\"hierarchicalMaskID\"] + \", \" + mask.name);\r\n\t\t\t\t\tif (renderable.maskId == mask.id) {\r\n\t\t\t\t\t\t//console.log(\"Rendering hierarchicalMaskID \" + mask[\"hierarchicalMaskID\"]);\r\n\t\t\t\t\t\tthis._drawMask(renderable);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgl.stencilFunc(gl.EQUAL, this._maskConfig, 0xff);\r\n\t\tgl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\r\n\r\n\t\tthis._pContext.setColorMask(true, true, true, true);\r\n\t\t//this._stage.setRenderTarget(oldRenderTarget);\r\n\t}\r\n\r\n\tprivate _drawMask(renderable:RenderableBase)\r\n\t{\r\n\t\tvar render = renderable.render;\r\n\t\tvar passes = render.passes;\r\n\t\tvar len = passes.length;\r\n\t\tvar pass = passes[len-1];\r\n\r\n\t\tthis.activatePass(renderable, pass, this._pCamera);\r\n\t\t// only render last pass for now\r\n\t\trenderable._iRender(pass, this._pCamera, this._pRttViewProjectionMatrix);\r\n\t\tthis.deactivatePass(renderable, pass);\r\n\t}\r\n\r\n\tprivate _checkMasksConfig(masksConfig:Array<Array<number>>):boolean\r\n\t{\r\n\t\tif (this._activeMasksConfig.length != masksConfig.length)\r\n\t\t\treturn true;\r\n\r\n\t\tvar numLayers:number = masksConfig.length;\r\n\t\tvar numChildren:number;\r\n\t\tvar childConfig:Array<number>;\r\n\t\tvar activeNumChildren:number;\r\n\t\tvar activeChildConfig:Array<number>;\r\n\t\tfor (var i:number = 0; i < numLayers; i++) {\r\n\t\t\tchildConfig = masksConfig[i];\r\n\t\t\tnumChildren = childConfig.length;\r\n\t\t\tactiveChildConfig = this._activeMasksConfig[i];\r\n\t\t\tactiveNumChildren = activeChildConfig.length;\r\n\t\t\tif (activeNumChildren != numChildren)\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tfor (var j:number = 0; j < numChildren; j++) {\r\n\t\t\t\tif (activeChildConfig[j] != childConfig[j])\r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport = RendererBase;",
    "import IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetBase\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\n\r\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetError\t\t\t= require(\"awayjs-renderergl/lib/errors/AnimationSetError\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n/**\r\n * Provides an abstract base class for data set classes that hold animation data for use in animator classes.\r\n *\r\n * @see away.animators.AnimatorBase\r\n */\r\nclass AnimationSetBase extends AssetBase implements IAsset\r\n{\r\n\tpublic static assetType:string = \"[asset AnimationSet]\";\r\n\r\n\tprivate _usesCPU:boolean;\r\n\tprivate _animations:Array<AnimationNodeBase> = new Array<AnimationNodeBase>();\r\n\tprivate _animationNames:Array<string> = new Array<string>();\r\n\tprivate _animationDictionary:Object = new Object();\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves a temporary GPU register that's still free.\r\n\t *\r\n\t * @param exclude An array of non-free temporary registers.\r\n\t * @param excludeAnother An additional register that's not free.\r\n\t * @return A temporary register that can be used.\r\n\t */\r\n\tpublic _pFindTempReg(exclude:Array<string>, excludeAnother:string = null):string\r\n\t{\r\n\t\tvar i:number /*uint*/ = 0;\r\n\t\tvar reg:string;\r\n\r\n\t\twhile (true) {\r\n\t\t\treg = \"vt\" + i;\r\n\t\t\tif (exclude.indexOf(reg) == -1 && excludeAnother != reg)\r\n\t\t\t\treturn reg;\r\n\t\t\t++i;\r\n\t\t}\r\n\r\n\t\t// can't be reached\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the properties of the animation data contained within the set combined with\r\n\t * the vertex registers already in use on shading materials allows the animation data to utilise\r\n\t * GPU calls.\r\n\t */\r\n\tpublic get usesCPU():boolean\r\n\t{\r\n\t\treturn this._usesCPU;\r\n\t}\r\n\r\n\t/**\r\n\t * Called by the material to reset the GPU indicator before testing whether register space in the shader\r\n\t * is available for running GPU-based animation code.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic resetGPUCompatibility()\r\n\t{\r\n\t\tthis._usesCPU = false;\r\n\t}\r\n\r\n\tpublic cancelGPUCompatibility()\r\n\t{\r\n\t\tthis._usesCPU = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shader:ShaderBase, shadedTarget:string):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shader:ShaderBase):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shader:ShaderBase)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn AnimationSetBase.assetType;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of animation state objects that make up the contents of the animation data set.\r\n\t */\r\n\tpublic get animations():Array<AnimationNodeBase>\r\n\t{\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of animation state objects that make up the contents of the animation data set.\r\n\t */\r\n\tpublic get animationNames():Array<string>\r\n\t{\r\n\t\treturn this._animationNames;\r\n\t}\r\n\r\n\t/**\r\n\t * Check to determine whether a state is registered in the animation set under the given name.\r\n\t *\r\n\t * @param stateName The name of the animation state object to be checked.\r\n\t */\r\n\tpublic hasAnimation(name:string):boolean\r\n\t{\r\n\t\treturn this._animationDictionary[name] != null;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the animation state object registered in the animation data set under the given name.\r\n\t *\r\n\t * @param stateName The name of the animation state object to be retrieved.\r\n\t */\r\n\tpublic getAnimation(name:string):AnimationNodeBase\r\n\t{\r\n\t\treturn this._animationDictionary[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an animation state object to the aniamtion data set under the given name.\r\n\t *\r\n\t * @param stateName The name under which the animation state object will be stored.\r\n\t * @param animationState The animation state object to be staored in the set.\r\n\t */\r\n\tpublic addAnimation(node:AnimationNodeBase)\r\n\t{\r\n\t\tif (this._animationDictionary[node.name])\r\n\t\t\tthrow new AnimationSetError(\"root node name '\" + node.name + \"' already exists in the set\");\r\n\r\n\t\tthis._animationDictionary[node.name] = node;\r\n\r\n\t\tthis._animations.push(node);\r\n\r\n\t\tthis._animationNames.push(node.name);\r\n\t}\r\n\r\n\t/**\r\n\t * Cleans up any resources used by the current object.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t}\r\n}\r\n\r\nexport = AnimationSetBase;",
    "import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetBase\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport RequestAnimationFrame\t\t= require(\"awayjs-core/lib/utils/RequestAnimationFrame\");\r\nimport getTimer\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/getTimer\");\r\n\r\nimport IAnimationSet\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\r\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IAnimationState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport TriangleSubMeshRenderable\t= require(\"awayjs-renderergl/lib/renderables/TriangleSubMeshRenderable\");\r\nimport AnimatorEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimatorEvent\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\n\r\n/**\r\n * Dispatched when playback of an animation inside the animator object starts.\r\n *\r\n * @eventType away3d.events.AnimatorEvent\r\n */\r\n//[Event(name=\"start\", type=\"away3d.events.AnimatorEvent\")]\r\n\r\n/**\r\n * Dispatched when playback of an animation inside the animator object stops.\r\n *\r\n * @eventType away3d.events.AnimatorEvent\r\n */\r\n//[Event(name=\"stop\", type=\"away3d.events.AnimatorEvent\")]\r\n\r\n/**\r\n * Dispatched when playback of an animation reaches the end of an animation.\r\n *\r\n * @eventType away3d.events.AnimatorEvent\r\n */\r\n//[Event(name=\"cycle_complete\", type=\"away3d.events.AnimatorEvent\")]\r\n\r\n/**\r\n * Provides an abstract base class for animator classes that control animation output from a data set subtype of <code>AnimationSetBase</code>.\r\n *\r\n * @see away.animators.AnimationSetBase\r\n */\r\nclass AnimatorBase extends AssetBase implements IAnimator\r\n{\r\n\tpublic static assetType:string = \"[asset Animator]\";\r\n\r\n\tprivate _broadcaster:RequestAnimationFrame;\r\n\tprivate _isPlaying:boolean;\r\n\tprivate _autoUpdate:boolean = true;\r\n\tprivate _startEvent:AnimatorEvent;\r\n\tprivate _stopEvent:AnimatorEvent;\r\n\tprivate _cycleEvent:AnimatorEvent;\r\n\tprivate _time:number /*int*/ = 0;\r\n\tprivate _playbackSpeed:number = 1;\r\n\r\n\tpublic _pAnimationSet:IAnimationSet;\r\n\tpublic _pOwners:Array<Mesh> = new Array<Mesh>();\r\n\tpublic _pActiveNode:AnimationNodeBase;\r\n\tpublic _pActiveState:IAnimationState;\r\n\tpublic _pActiveAnimationName:string;\r\n\tpublic _pAbsoluteTime:number = 0;\r\n\r\n\tprivate _animationStates:Object = new Object();\r\n\r\n\t/**\r\n\t * Enables translation of the animated mesh from data returned per frame via the positionDelta property of the active animation node. Defaults to true.\r\n\t *\r\n\t * @see away.animators.IAnimationState#positionDelta\r\n\t */\r\n\tpublic updatePosition:boolean = true;\r\n\r\n\tpublic getAnimationState(node:AnimationNodeBase):IAnimationState\r\n\t{\r\n\t\tvar className:any = node.stateClass;\r\n\t\tvar uID:number = node.id;\r\n\r\n\t\tif (this._animationStates[uID] == null)\r\n\t\t\tthis._animationStates[uID] = new className(this, node);\r\n\r\n\t\treturn this._animationStates[uID];\r\n\t}\r\n\r\n\tpublic getAnimationStateByName(name:string):IAnimationState\r\n\t{\r\n\t\treturn this.getAnimationState(this._pAnimationSet.getAnimation(name));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the internal absolute time of the animator, calculated by the current time and the playback speed.\r\n\t *\r\n\t * @see #time\r\n\t * @see #playbackSpeed\r\n\t */\r\n\tpublic get absoluteTime():number\r\n\t{\r\n\t\treturn this._pAbsoluteTime;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the animation data set in use by the animator.\r\n\t */\r\n\tpublic get animationSet():IAnimationSet\r\n\t{\r\n\t\treturn this._pAnimationSet;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current active animation state.\r\n\t */\r\n\tpublic get activeState():IAnimationState\r\n\t{\r\n\t\treturn this._pActiveState;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current active animation node.\r\n\t */\r\n\tpublic get activeAnimation():AnimationNodeBase\r\n\t{\r\n\t\treturn this._pAnimationSet.getAnimation(this._pActiveAnimationName);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current active animation node.\r\n\t */\r\n\tpublic get activeAnimationName():string\r\n\t{\r\n\t\treturn this._pActiveAnimationName;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines whether the animators internal update mechanisms are active. Used in cases\r\n\t * where manual updates are required either via the <code>time</code> property or <code>update()</code> method.\r\n\t * Defaults to true.\r\n\t *\r\n\t * @see #time\r\n\t * @see #update()\r\n\t */\r\n\tpublic get autoUpdate():boolean\r\n\t{\r\n\t\treturn this._autoUpdate;\r\n\t}\r\n\r\n\tpublic set autoUpdate(value:boolean)\r\n\t{\r\n\t\tif (this._autoUpdate == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._autoUpdate = value;\r\n\r\n\t\tif (this._autoUpdate)\r\n\t\t\tthis.start(); else\r\n\t\t\tthis.stop();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets and sets the internal time clock of the animator.\r\n\t */\r\n\tpublic get time():number /*int*/\r\n\t{\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\tpublic set time(value:number /*int*/)\r\n\t{\r\n\t\tif (this._time == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis.update(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the animation phase of the current active state's animation clip(s).\r\n\t *\r\n\t * @param value The phase value to use. 0 represents the beginning of an animation clip, 1 represents the end.\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._pActiveState.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>AnimatorBase</code> object.\r\n\t *\r\n\t * @param animationSet The animation data set to be used by the animator object.\r\n\t */\r\n\tconstructor(animationSet:IAnimationSet)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pAnimationSet = animationSet;\r\n\r\n\t\tthis._broadcaster = new RequestAnimationFrame(this.onEnterFrame, this);\r\n\t}\r\n\r\n\t/**\r\n\t * The amount by which passed time should be scaled. Used to slow down or speed up animations. Defaults to 1.\r\n\t */\r\n\tpublic get playbackSpeed():number\r\n\t{\r\n\t\treturn this._playbackSpeed;\r\n\t}\r\n\r\n\tpublic set playbackSpeed(value:number)\r\n\t{\r\n\t\tthis._playbackSpeed = value;\r\n\t}\r\n\r\n\tpublic setRenderState(shader:ShaderBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * Resumes the automatic playback clock controling the active state of the animator.\r\n\t */\r\n\tpublic start()\r\n\t{\r\n\t\tif (this._isPlaying || !this._autoUpdate)\r\n\t\t\treturn;\r\n\r\n\t\tthis._time = this._pAbsoluteTime = getTimer();\r\n\r\n\t\tthis._isPlaying = true;\r\n\r\n\t\tthis._broadcaster.start();\r\n\r\n\t\tif (!this.hasEventListener(AnimatorEvent.START))\r\n\t\t\treturn;\r\n\r\n\t\tif (this._startEvent == null)\r\n\t\t\tthis._startEvent = new AnimatorEvent(AnimatorEvent.START, this);\r\n\r\n\t\tthis.dispatchEvent(this._startEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * Pauses the automatic playback clock of the animator, in case manual updates are required via the\r\n\t * <code>time</code> property or <code>update()</code> method.\r\n\t *\r\n\t * @see #time\r\n\t * @see #update()\r\n\t */\r\n\tpublic stop()\r\n\t{\r\n\t\tif (!this._isPlaying)\r\n\t\t\treturn;\r\n\r\n\t\tthis._isPlaying = false;\r\n\r\n\t\tthis._broadcaster.stop();\r\n\r\n\t\tif (!this.hasEventListener(AnimatorEvent.STOP))\r\n\t\t\treturn;\r\n\r\n\t\tif (this._stopEvent == null)\r\n\t\t\tthis._stopEvent = new AnimatorEvent(AnimatorEvent.STOP, this);\r\n\r\n\t\tthis.dispatchEvent(this._stopEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * Provides a way to manually update the active state of the animator when automatic\r\n\t * updates are disabled.\r\n\t *\r\n\t * @see #stop()\r\n\t * @see #autoUpdate\r\n\t */\r\n\tpublic update(time:number /*int*/)\r\n\t{\r\n\t\tvar dt:number = (time - this._time)*this.playbackSpeed;\r\n\r\n\t\tthis._pUpdateDeltaTime(dt);\r\n\r\n\t\tthis._time = time;\r\n\t}\r\n\r\n\tpublic reset(name:string, offset:number = 0)\r\n\t{\r\n\t\tthis.getAnimationState(this._pAnimationSet.getAnimation(name)).offset(offset + this._pAbsoluteTime);\r\n\t}\r\n\r\n\t/**\r\n\t * Used by the mesh object to which the animator is applied, registers the owner for internal use.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic addOwner(mesh:Mesh)\r\n\t{\r\n\t\tthis._pOwners.push(mesh);\r\n\t}\r\n\r\n\t/**\r\n\t * Used by the mesh object from which the animator is removed, unregisters the owner for internal use.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic removeOwner(mesh:Mesh)\r\n\t{\r\n\t\tthis._pOwners.splice(this._pOwners.indexOf(mesh), 1);\r\n\t}\r\n\r\n\t/**\r\n\t * Internal abstract method called when the time delta property of the animator's contents requires updating.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tthis._pAbsoluteTime += dt;\r\n\r\n\t\tthis._pActiveState.update(this._pAbsoluteTime);\r\n\r\n\t\tif (this.updatePosition)\r\n\t\t\tthis.applyPositionDelta();\r\n\t}\r\n\r\n\t/**\r\n\t * Enter frame event handler for automatically updating the active state of the animator.\r\n\t */\r\n\tprivate onEnterFrame(event:Event = null)\r\n\t{\r\n\t\tthis.update(getTimer());\r\n\t}\r\n\r\n\tprivate applyPositionDelta()\r\n\t{\r\n\t\tvar delta:Vector3D = this._pActiveState.positionDelta;\r\n\t\tvar dist:number = delta.length;\r\n\t\tvar len:number /*uint*/;\r\n\t\tif (dist > 0) {\r\n\t\t\tlen = this._pOwners.length;\r\n\t\t\tfor (var i:number /*uint*/ = 0; i < len; ++i)\r\n\t\t\t\tthis._pOwners[i].translateLocal(delta, dist);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  for internal use.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic dispatchCycleEvent()\r\n\t{\r\n\t\tif (this.hasEventListener(AnimatorEvent.CYCLE_COMPLETE)) {\r\n\t\t\tif (this._cycleEvent == null)\r\n\t\t\t\tthis._cycleEvent = new AnimatorEvent(AnimatorEvent.CYCLE_COMPLETE, this);\r\n\r\n\t\t\tthis.dispatchEvent(this._cycleEvent);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic testGPUCompatibility(shader:ShaderBase)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn AnimatorBase.assetType;\r\n\t}\r\n\r\n\r\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\r\n\t{\r\n\t\t//nothing to do here\r\n\t\treturn sourceSubGeometry;\r\n\t}\r\n}\r\n\r\nexport = AnimatorBase;",
    "import SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleTimeNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode\");\r\nimport ParticleGeometry\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/ParticleGeometry\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\n\r\n\r\n/**\r\n * The animation data set used by particle-based animators, containing particle animation data.\r\n *\r\n * @see away.animators.ParticleAnimator\r\n */\r\nclass ParticleAnimationSet extends AnimationSetBase implements IAnimationSet\r\n{\r\n\t/** @private */\r\n\tpublic _iAnimationRegisterCache:AnimationRegisterCache;\r\n\r\n\t//all other nodes dependent on it\r\n\tprivate _timeNode:ParticleTimeNode;\r\n\r\n\t/**\r\n\t * Property used by particle nodes that require compilers at the end of the shader\r\n\t */\r\n\tpublic static POST_PRIORITY:number /*int*/ = 9;\r\n\r\n\t/**\r\n\t * Property used by particle nodes that require color compilers\r\n\t */\r\n\tpublic static COLOR_PRIORITY:number /*int*/ = 18;\r\n\r\n\tprivate _animationSubGeometries:Object = new Object();\r\n\tprivate _particleNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\r\n\tprivate _localDynamicNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\r\n\tprivate _localStaticNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\r\n\tprivate _totalLenOfOneVertex:number /*int*/ = 0;\r\n\r\n\t//set true if has an node which will change UV\r\n\tpublic hasUVNode:boolean;\r\n\t//set if the other nodes need to access the velocity\r\n\tpublic needVelocity:boolean;\r\n\t//set if has a billboard node.\r\n\tpublic hasBillboard:boolean;\r\n\t//set if has an node which will apply color multiple operation\r\n\tpublic hasColorMulNode:boolean;\r\n\t//set if has an node which will apply color add operation\r\n\tpublic hasColorAddNode:boolean;\r\n\r\n\t/**\r\n\t * Initialiser function for static particle properties. Needs to reference a with the following format\r\n\t *\r\n\t * <code>\r\n\t * initParticleFunc(prop:ParticleProperties)\r\n\t * {\r\n\t * \t\t//code for settings local properties\r\n\t * }\r\n\t * </code>\r\n\t *\r\n\t * Aside from setting any properties required in particle animation nodes using local static properties, the initParticleFunc function\r\n\t * is required to time node requirements as they may be needed. These properties on the ParticleProperties object can include\r\n\t * <code>startTime</code>, <code>duration</code> and <code>delay</code>. The use of these properties is determined by the setting\r\n\t * arguments passed in the constructor of the particle animation set. By default, only the <code>startTime</code> property is required.\r\n\t */\r\n\tpublic initParticleFunc:Function;\r\n\r\n\t/**\r\n\t * Initialiser function scope for static particle properties\r\n\t */\r\n\tpublic initParticleScope:Object;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleAnimationSet</code>\r\n\t *\r\n\t * @param    [optional] usesDuration    Defines whether the animation set uses the <code>duration</code> data in its static properties to determine how long a particle is visible for. Defaults to false.\r\n\t * @param    [optional] usesLooping     Defines whether the animation set uses a looping timeframe for each particle determined by the <code>startTime</code>, <code>duration</code> and <code>delay</code> data in its static properties function. Defaults to false. Requires <code>usesDuration</code> to be true.\r\n\t * @param    [optional] usesDelay       Defines whether the animation set uses the <code>delay</code> data in its static properties to determine how long a particle is hidden for. Defaults to false. Requires <code>usesLooping</code> to be true.\r\n\t */\r\n\tconstructor(usesDuration:boolean = false, usesLooping:boolean = false, usesDelay:boolean = false)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\t//automatically add a particle time node to the set\r\n\t\tthis.addAnimation(this._timeNode = new ParticleTimeNode(usesDuration, usesLooping, usesDelay));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of the particle animation nodes contained within the set.\r\n\t */\r\n\tpublic get particleNodes():Array<ParticleNodeBase>\r\n\t{\r\n\t\treturn this._particleNodes;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic addAnimation(node:AnimationNodeBase)\r\n\t{\r\n\t\tvar i:number /*int*/;\r\n\t\tvar n:ParticleNodeBase = <ParticleNodeBase> node;\r\n\t\tn._iProcessAnimationSetting(this);\r\n\t\tif (n.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tn._iDataOffset = this._totalLenOfOneVertex;\r\n\t\t\tthis._totalLenOfOneVertex += n.dataLength;\r\n\t\t\tthis._localStaticNodes.push(n);\r\n\t\t} else if (n.mode == ParticlePropertiesMode.LOCAL_DYNAMIC)\r\n\t\t\tthis._localDynamicNodes.push(n);\r\n\r\n\t\tfor (i = this._particleNodes.length - 1; i >= 0; i--) {\r\n\t\t\tif (this._particleNodes[i].priority <= n.priority)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis._particleNodes.splice(i + 1, 0, n);\r\n\r\n\t\tsuper.addAnimation(node);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n//\t\t\tthis._iAnimationRegisterCache = pass.animationRegisterCache;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n//\t\t\tvar offset:number /*int*/ = this._iAnimationRegisterCache.vertexAttributesOffset;\r\n//\t\t\tvar used:number /*int*/ = this._iAnimationRegisterCache.numUsedStreams;\r\n//\t\t\tfor (var i:number /*int*/ = offset; i < used; i++)\r\n//\t\t\t\tcontext.setVertexBufferAt(i, null);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase):string\r\n\t{\r\n\t\t//grab animationRegisterCache from the materialpassbase or create a new one if the first time\r\n\t\tthis._iAnimationRegisterCache = shader.animationRegisterCache;\r\n\r\n\t\tif (this._iAnimationRegisterCache == null)\r\n\t\t\tthis._iAnimationRegisterCache = shader.animationRegisterCache = new AnimationRegisterCache(shader.profile);\r\n\r\n\t\t//reset animationRegisterCache\r\n\t\tthis._iAnimationRegisterCache.vertexConstantOffset = shader.numUsedVertexConstants;\r\n\t\tthis._iAnimationRegisterCache.vertexAttributesOffset = shader.numUsedStreams;\r\n\t\tthis._iAnimationRegisterCache.varyingsOffset = shader.numUsedVaryings;\r\n\t\tthis._iAnimationRegisterCache.fragmentConstantOffset = shader.numUsedFragmentConstants;\r\n\t\tthis._iAnimationRegisterCache.hasUVNode = this.hasUVNode;\r\n\t\tthis._iAnimationRegisterCache.needVelocity = this.needVelocity;\r\n\t\tthis._iAnimationRegisterCache.hasBillboard = this.hasBillboard;\r\n\t\tthis._iAnimationRegisterCache.sourceRegisters = shader.animatableAttributes;\r\n\t\tthis._iAnimationRegisterCache.targetRegisters = shader.animationTargetRegisters;\r\n\t\tthis._iAnimationRegisterCache.needFragmentAnimation = shader.usesFragmentAnimation;\r\n\t\tthis._iAnimationRegisterCache.needUVAnimation = !shader.usesUVTransform;\r\n\t\tthis._iAnimationRegisterCache.hasColorAddNode = this.hasColorAddNode;\r\n\t\tthis._iAnimationRegisterCache.hasColorMulNode = this.hasColorMulNode;\r\n\t\tthis._iAnimationRegisterCache.reset();\r\n\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tcode += this._iAnimationRegisterCache.getInitCode();\r\n\r\n\t\tvar node:ParticleNodeBase;\r\n\t\tvar i:number /*int*/;\r\n\r\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\r\n\t\t\tnode = this._particleNodes[i];\r\n\t\t\tif (node.priority < ParticleAnimationSet.POST_PRIORITY)\r\n\t\t\t\tcode += node.getAGALVertexCode(shader, this._iAnimationRegisterCache);\r\n\t\t}\r\n\r\n\t\tcode += this._iAnimationRegisterCache.getCombinationCode();\r\n\r\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\r\n\t\t\tnode = this._particleNodes[i];\r\n\t\t\tif (node.priority >= ParticleAnimationSet.POST_PRIORITY && node.priority < ParticleAnimationSet.COLOR_PRIORITY)\r\n\t\t\t\tcode += node.getAGALVertexCode(shader, this._iAnimationRegisterCache);\r\n\t\t}\r\n\r\n\t\tcode += this._iAnimationRegisterCache.initColorRegisters();\r\n\r\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\r\n\t\t\tnode = this._particleNodes[i];\r\n\t\t\tif (node.priority >= ParticleAnimationSet.COLOR_PRIORITY)\r\n\t\t\t\tcode += node.getAGALVertexCode(shader, this._iAnimationRegisterCache);\r\n\t\t}\r\n\t\tcode += this._iAnimationRegisterCache.getColorPassCode();\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shader:ShaderBase):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.hasUVNode) {\r\n\t\t\tthis._iAnimationRegisterCache.setUVSourceAndTarget(shader.uvSource, shader.uvTarget);\r\n\t\t\tcode += \"mov \" + this._iAnimationRegisterCache.uvTarget + \".xy,\" + this._iAnimationRegisterCache.uvAttribute.toString() + \"\\n\";\r\n\t\t\tvar node:ParticleNodeBase;\r\n\t\t\tfor (var i:number /*uint*/ = 0; i < this._particleNodes.length; i++)\r\n\t\t\t\tnode = this._particleNodes[i];\r\n\t\t\t\tcode += node.getAGALUVCode(shader, this._iAnimationRegisterCache);\r\n\t\t\tcode += \"mov \" + this._iAnimationRegisterCache.uvVar.toString() + \",\" + this._iAnimationRegisterCache.uvTarget + \".xy\\n\";\r\n\t\t} else\r\n\t\t\tcode += \"mov \" + shader.uvTarget + \",\" + shader.uvSource + \"\\n\";\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shader:ShaderBase, shadedTarget:string):string\r\n\t{\r\n\t\treturn this._iAnimationRegisterCache.getColorCombinationCode(shadedTarget);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shader:ShaderBase)\r\n\t{\r\n\t\tthis._iAnimationRegisterCache.setDataLength();\r\n\r\n\t\t//set vertexZeroConst,vertexOneConst,vertexTwoConst\r\n\t\tthis._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index, 0, 1, 2, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get usesCPU():boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic cancelGPUCompatibility()\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var key in this._animationSubGeometries)\r\n\t\t\t(<AnimationSubGeometry> this._animationSubGeometries[key]).dispose();\r\n\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\tpublic getAnimationSubGeometry(subMesh:ISubMesh)\r\n\t{\r\n\t\tvar mesh:Mesh = subMesh.parentMesh;\r\n\t\tvar animationSubGeometry:AnimationSubGeometry = (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\r\n\r\n\t\tif (animationSubGeometry)\r\n\t\t\treturn animationSubGeometry;\r\n\r\n\t\tthis._iGenerateAnimationSubGeometries(mesh);\r\n\r\n\t\treturn (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\r\n\t}\r\n\r\n\r\n\t/** @private */\r\n\tpublic _iGenerateAnimationSubGeometries(mesh:Mesh)\r\n\t{\r\n\t\tif (this.initParticleFunc == null)\r\n\t\t\tthrow(new Error(\"no initParticleFunc set\"));\r\n\r\n\t\tvar geometry:ParticleGeometry = <ParticleGeometry> mesh.geometry;\r\n\r\n\t\tif (!geometry)\r\n\t\t\tthrow(new Error(\"Particle animation can only be performed on a ParticleGeometry object\"));\r\n\r\n\t\tvar i:number /*int*/, j:number /*int*/, k:number /*int*/;\r\n\t\tvar animationSubGeometry:AnimationSubGeometry;\r\n\t\tvar newAnimationSubGeometry:boolean = false;\r\n\t\tvar subGeometry:SubGeometryBase;\r\n\t\tvar subMesh:ISubMesh;\r\n\t\tvar localNode:ParticleNodeBase;\r\n\r\n\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\r\n\t\t\tsubMesh = mesh.subMeshes[i];\r\n\t\t\tsubGeometry = subMesh.subGeometry;\r\n\t\t\tif (mesh.shareAnimationGeometry) {\r\n\t\t\t\tanimationSubGeometry = this._animationSubGeometries[subGeometry.id];\r\n\r\n\t\t\t\tif (animationSubGeometry)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tanimationSubGeometry = new AnimationSubGeometry();\r\n\r\n\t\t\tif (mesh.shareAnimationGeometry)\r\n\t\t\t\tthis._animationSubGeometries[subGeometry.id] = animationSubGeometry;\r\n\t\t\telse\r\n\t\t\t\tthis._animationSubGeometries[subMesh.id] = animationSubGeometry;\r\n\r\n\t\t\tnewAnimationSubGeometry = true;\r\n\r\n\t\t\t//create the vertexData vector that will be used for local node data\r\n\t\t\tanimationSubGeometry.createVertexData(subGeometry.numVertices, this._totalLenOfOneVertex);\r\n\t\t}\r\n\r\n\t\tif (!newAnimationSubGeometry)\r\n\t\t\treturn;\r\n\r\n\t\tvar particles:Array<ParticleData> = geometry.particles;\r\n\t\tvar particlesLength:number /*uint*/ = particles.length;\r\n\t\tvar numParticles:number /*uint*/ = geometry.numParticles;\r\n\t\tvar particleProperties:ParticleProperties = new ParticleProperties();\r\n\t\tvar particle:ParticleData;\r\n\r\n\t\tvar oneDataLen:number /*int*/;\r\n\t\tvar oneDataOffset:number /*int*/;\r\n\t\tvar counterForVertex:number /*int*/;\r\n\t\tvar counterForOneData:number /*int*/;\r\n\t\tvar oneData:Array<number>;\r\n\t\tvar numVertices:number /*uint*/;\r\n\t\tvar vertexData:Array<number>;\r\n\t\tvar vertexLength:number /*uint*/;\r\n\t\tvar startingOffset:number /*uint*/;\r\n\t\tvar vertexOffset:number /*uint*/;\r\n\r\n\t\t//default values for particle param\r\n\t\tparticleProperties.total = numParticles;\r\n\t\tparticleProperties.startTime = 0;\r\n\t\tparticleProperties.duration = 1000;\r\n\t\tparticleProperties.delay = 0.1;\r\n\r\n\t\ti = 0;\r\n\t\tj = 0;\r\n\t\twhile (i < numParticles) {\r\n\t\t\tparticleProperties.index = i;\r\n\r\n\t\t\t//call the init on the particle parameters\r\n\t\t\tthis.initParticleFunc.call(this.initParticleScope, particleProperties);\r\n\r\n\t\t\t//create the next set of node properties for the particle\r\n\t\t\tfor (k = 0; k < this._localStaticNodes.length; k++)\r\n\t\t\t\tthis._localStaticNodes[k]._iGeneratePropertyOfOneParticle(particleProperties);\r\n\r\n\t\t\t//loop through all particle data for the curent particle\r\n\t\t\twhile (j < particlesLength && (particle = particles[j]).particleIndex == i) {\r\n\t\t\t\t//find the target animationSubGeometry\r\n\t\t\t\tfor (k = 0; k < mesh.subMeshes.length; k++) {\r\n\t\t\t\t\tsubMesh = mesh.subMeshes[k];\r\n\t\t\t\t\tif (subMesh.subGeometry == particle.subGeometry) {\r\n\t\t\t\t\t\tanimationSubGeometry = (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnumVertices = particle.numVertices;\r\n\t\t\t\tvertexData = animationSubGeometry.vertexData;\r\n\t\t\t\tvertexLength = numVertices*this._totalLenOfOneVertex;\r\n\t\t\t\tstartingOffset = animationSubGeometry.numProcessedVertices*this._totalLenOfOneVertex;\r\n\r\n\t\t\t\t//loop through each static local node in the animation set\r\n\t\t\t\tfor (k = 0; k < this._localStaticNodes.length; k++) {\r\n\t\t\t\t\tlocalNode = this._localStaticNodes[k];\r\n\t\t\t\t\toneData = localNode.oneData;\r\n\t\t\t\t\toneDataLen = localNode.dataLength;\r\n\t\t\t\t\toneDataOffset = startingOffset + localNode._iDataOffset;\r\n\r\n\t\t\t\t\t//loop through each vertex set in the vertex data\r\n\t\t\t\t\tfor (counterForVertex = 0; counterForVertex < vertexLength; counterForVertex += this._totalLenOfOneVertex) {\r\n\t\t\t\t\t\tvertexOffset = oneDataOffset + counterForVertex;\r\n\r\n\t\t\t\t\t\t//add the data for the local node to the vertex data\r\n\t\t\t\t\t\tfor (counterForOneData = 0; counterForOneData < oneDataLen; counterForOneData++)\r\n\t\t\t\t\t\t\tvertexData[vertexOffset + counterForOneData] = oneData[counterForOneData];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//store particle properties if they need to be retreived for dynamic local nodes\r\n\t\t\t\tif (this._localDynamicNodes.length)\r\n\t\t\t\t\tanimationSubGeometry.animationParticles.push(new ParticleAnimationData(i, particleProperties.startTime, particleProperties.duration, particleProperties.delay, particle));\r\n\r\n\t\t\t\tanimationSubGeometry.numProcessedVertices += numVertices;\r\n\r\n\t\t\t\t//next index\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\r\n\t\t\t//next particle\r\n\t\t\ti++;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleAnimationSet;",
    "import ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/renderables/TriangleSubMeshRenderable\");\r\n\r\n/**\r\n * Provides an interface for assigning paricle-based animation data sets to mesh-based entity objects\r\n * and controlling the various available states of animation through an interative playhead that can be\r\n * automatically updated or manually triggered.\r\n *\r\n * Requires that the containing geometry of the parent mesh is particle geometry\r\n *\r\n * @see away.base.ParticleGeometry\r\n */\r\nclass ParticleAnimator extends AnimatorBase\r\n{\r\n\r\n\tprivate _particleAnimationSet:ParticleAnimationSet;\r\n\tprivate _animationParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\r\n\tprivate _animatorParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\r\n\tprivate _timeParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\r\n\tprivate _totalLenOfOneVertex:number /*uint*/ = 0;\r\n\tprivate _animatorSubGeometries:Object = new Object();\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleAnimator</code> object.\r\n\t *\r\n\t * @param particleAnimationSet The animation data set containing the particle animations used by the animator.\r\n\t */\r\n\tconstructor(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tsuper(particleAnimationSet);\r\n\t\tthis._particleAnimationSet = particleAnimationSet;\r\n\r\n\t\tvar state:ParticleStateBase;\r\n\t\tvar node:ParticleNodeBase;\r\n\r\n\t\tfor (var i:number = 0; i < this._particleAnimationSet.particleNodes.length; i++) {\r\n\t\t\tnode = this._particleAnimationSet.particleNodes[i];\r\n\t\t\tstate = <ParticleStateBase> this.getAnimationState(node);\r\n\t\t\tif (node.mode == ParticlePropertiesMode.LOCAL_DYNAMIC) {\r\n\t\t\t\tthis._animatorParticleStates.push(state);\r\n\t\t\t\tnode._iDataOffset = this._totalLenOfOneVertex;\r\n\t\t\t\tthis._totalLenOfOneVertex += node.dataLength;\r\n\t\t\t} else {\r\n\t\t\t\tthis._animationParticleStates.push(state);\r\n\t\t\t}\r\n\t\t\tif (state.needUpdateTime)\r\n\t\t\t\tthis._timeParticleStates.push(state);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\treturn new ParticleAnimator(this._particleAnimationSet);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(shader:ShaderBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\tvar animationRegisterCache:AnimationRegisterCache = this._particleAnimationSet._iAnimationRegisterCache;\r\n\r\n\t\tvar subMesh:ISubMesh = (<TriangleSubMeshRenderable> renderable).subMesh;\r\n\t\tvar state:ParticleStateBase;\r\n\t\tvar i:number;\r\n\r\n\t\tif (!subMesh)\r\n\t\t\tthrow(new Error(\"Must be subMesh\"));\r\n\r\n\t\t//process animation sub geometries\r\n\t\tvar animationSubGeometry:AnimationSubGeometry = this._particleAnimationSet.getAnimationSubGeometry(subMesh);\r\n\r\n\t\tfor (i = 0; i < this._animationParticleStates.length; i++)\r\n\t\t\tthis._animationParticleStates[i].setRenderState(stage, renderable, animationSubGeometry, animationRegisterCache, camera);\r\n\r\n\t\t//process animator subgeometries\r\n\t\tvar animatorSubGeometry:AnimationSubGeometry = this.getAnimatorSubGeometry(subMesh);\r\n\r\n\t\tfor (i = 0; i < this._animatorParticleStates.length; i++)\r\n\t\t\tthis._animatorParticleStates[i].setRenderState(stage, renderable, animatorSubGeometry, animationRegisterCache, camera);\r\n\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, animationRegisterCache.vertexConstantOffset, animationRegisterCache.vertexConstantData, animationRegisterCache.numVertexConstant);\r\n\r\n\t\tif (animationRegisterCache.numFragmentConstant > 0)\r\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, animationRegisterCache.fragmentConstantOffset, animationRegisterCache.fragmentConstantData, animationRegisterCache.numFragmentConstant);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic testGPUCompatibility(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic start()\r\n\t{\r\n\t\tsuper.start();\r\n\r\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\r\n\t\t\tthis._timeParticleStates[i].offset(this._pAbsoluteTime);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tthis._pAbsoluteTime += dt;\r\n\r\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\r\n\t\t\tthis._timeParticleStates[i].update(this._pAbsoluteTime);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic resetTime(offset:number /*int*/ = 0)\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\r\n\t\t\tthis._timeParticleStates[i].offset(this._pAbsoluteTime + offset);\r\n\t\tthis.update(this.time);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var key in this._animatorSubGeometries)\r\n\t\t\t(<AnimationSubGeometry> this._animatorSubGeometries[key]).dispose();\r\n\t}\r\n\r\n\tprivate getAnimatorSubGeometry(subMesh:ISubMesh):AnimationSubGeometry\r\n\t{\r\n\t\tif (!this._animatorParticleStates.length)\r\n\t\t\treturn;\r\n\r\n\t\tvar subGeometry:SubGeometryBase = subMesh.subGeometry;\r\n\t\tvar animatorSubGeometry:AnimationSubGeometry = this._animatorSubGeometries[subGeometry.id] = new AnimationSubGeometry();\r\n\r\n\t\t//create the vertexData vector that will be used for local state data\r\n\t\tanimatorSubGeometry.createVertexData(subGeometry.numVertices, this._totalLenOfOneVertex);\r\n\r\n\t\t//pass the particles data to the animator subGeometry\r\n\t\tanimatorSubGeometry.animationParticles = this._particleAnimationSet.getAnimationSubGeometry(subMesh).animationParticles;\r\n\t}\r\n}\r\n\r\nexport = ParticleAnimator;",
    "import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\n\r\n/**\r\n * The animation data set used by skeleton-based animators, containing skeleton animation data.\r\n *\r\n * @see away.animators.SkeletonAnimator\r\n */\r\nclass SkeletonAnimationSet extends AnimationSetBase implements IAnimationSet\r\n{\r\n\tprivate _jointsPerVertex:number /*uint*/;\r\n\r\n\t/**\r\n\t * Returns the amount of skeleton joints that can be linked to a single vertex via skinned weight values. For GPU-base animation, the\r\n\t * maximum allowed value is 4.\r\n\t */\r\n\tpublic get jointsPerVertex():number /*uint*/\r\n\t{\r\n\t\treturn this._jointsPerVertex;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonAnimationSet</code> object.\r\n\t *\r\n\t * @param jointsPerVertex Sets the amount of skeleton joints that can be linked to a single vertex via skinned weight values. For GPU-base animation, the maximum allowed value is 4. Defaults to 4.\r\n\t */\r\n\tconstructor(jointsPerVertex:number /*uint*/ = 4)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._jointsPerVertex = jointsPerVertex;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase):string\r\n\t{\r\n\t\tvar len:number /*uint*/ = shader.animatableAttributes.length;\r\n\r\n\t\tvar indexOffset0:number /*uint*/ = shader.numUsedVertexConstants;\r\n\t\tvar indexOffset1:number /*uint*/ = indexOffset0 + 1;\r\n\t\tvar indexOffset2:number /*uint*/ = indexOffset0 + 2;\r\n\t\tvar indexStream:string = \"va\" + shader.numUsedStreams;\r\n\t\tvar weightStream:string = \"va\" + (shader.numUsedStreams + 1);\r\n\t\tvar indices:Array<string> = [ indexStream + \".x\", indexStream + \".y\", indexStream + \".z\", indexStream + \".w\" ];\r\n\t\tvar weights:Array<string> = [ weightStream + \".x\", weightStream + \".y\", weightStream + \".z\", weightStream + \".w\" ];\r\n\t\tvar temp1:string = this._pFindTempReg(shader.animationTargetRegisters);\r\n\t\tvar temp2:string = this._pFindTempReg(shader.animationTargetRegisters, temp1);\r\n\t\tvar dot:string = \"dp4\";\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\r\n\t\t\tvar src:string = shader.animatableAttributes[i];\r\n\r\n\t\t\tfor (var j:number /*uint*/ = 0; j < this._jointsPerVertex; ++j) {\r\n\t\t\t\tcode += dot + \" \" + temp1 + \".x, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset0 + \"]\\n\" +\r\n\t\t\t\t\tdot + \" \" + temp1 + \".y, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset1 + \"]\\n\" +\r\n\t\t\t\t\tdot + \" \" + temp1 + \".z, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset2 + \"]\\n\" +\r\n\t\t\t\t\t\"mov \" + temp1 + \".w, \" + src + \".w\\n\" +\r\n\t\t\t\t\t\"mul \" + temp1 + \", \" + temp1 + \", \" + weights[j] + \"\\n\"; // apply weight\r\n\r\n\t\t\t\t// add or mov to target. Need to write to a temp reg first, because an output can be a target\r\n\t\t\t\tif (j == 0)\r\n\t\t\t\t\tcode += \"mov \" + temp2 + \", \" + temp1 + \"\\n\"; else\r\n\t\t\t\t\tcode += \"add \" + temp2 + \", \" + temp2 + \", \" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\t\t\t// switch to dp3 once positions have been transformed, from now on, it should only be vectors instead of points\r\n\t\t\tdot = \"dp3\";\r\n\t\t\tcode += \"mov \" + shader.animationTargetRegisters[i] + \", \" + temp2 + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar streamOffset:number /*uint*/ = pass.numUsedStreams;\r\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n//\t\t\tcontext.setVertexBufferAt(streamOffset, null);\r\n//\t\t\tcontext.setVertexBufferAt(streamOffset + 1, null);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shader:ShaderBase, shadedTarget:string):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shader:ShaderBase):string\r\n\t{\r\n\t\treturn \"mov \" + shader.uvTarget + \",\" + shader.uvSource + \"\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = SkeletonAnimationSet;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport TriangleSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport SubGeometryEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\n\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/renderables/TriangleSubMeshRenderable\");\r\n\r\n/**\r\n * Provides an interface for assigning skeleton-based animation data sets to mesh-based entity objects\r\n * and controlling the various available states of animation through an interative playhead that can be\r\n * automatically updated or manually triggered.\r\n */\r\nclass SkeletonAnimator extends AnimatorBase\r\n{\r\n\tprivate _globalMatrices:Float32Array;\r\n\tprivate _globalPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _globalPropertiesDirty:boolean;\r\n\tprivate _numJoints:number /*uint*/;\r\n\tprivate _morphedSubGeometry:Object = new Object();\r\n\tprivate _morphedSubGeometryDirty:Object = new Object();\r\n\tprivate _condensedMatrices:Float32Array;\r\n\r\n\tprivate _skeleton:Skeleton;\r\n\tprivate _forceCPU:boolean;\r\n\tprivate _useCondensedIndices:boolean;\r\n\tprivate _jointsPerVertex:number /*uint*/;\r\n\tprivate _activeSkeletonState:ISkeletonAnimationState;\r\n\tprivate _onTransitionCompleteDelegate:(event:AnimationStateEvent) => void;\r\n\r\n\tprivate _onIndicesUpdateDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _onVerticesUpdateDelegate:(event:SubGeometryEvent) => void;\r\n\r\n\t/**\r\n\t * returns the calculated global matrices of the current skeleton pose.\r\n\t *\r\n\t * @see #globalPose\r\n\t */\r\n\tpublic get globalMatrices():Float32Array\r\n\t{\r\n\t\tif (this._globalPropertiesDirty)\r\n\t\t\tthis.updateGlobalProperties();\r\n\r\n\t\treturn this._globalMatrices;\r\n\t}\r\n\r\n\t/**\r\n\t * returns the current skeleton pose output from the animator.\r\n\t *\r\n\t * @see away.animators.data.SkeletonPose\r\n\t */\r\n\tpublic get globalPose():SkeletonPose\r\n\t{\r\n\t\tif (this._globalPropertiesDirty)\r\n\t\t\tthis.updateGlobalProperties();\r\n\r\n\t\treturn this._globalPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the skeleton object in use by the animator - this defines the number and heirarchy of joints used by the\r\n\t * skinned geoemtry to which skeleon animator is applied.\r\n\t */\r\n\tpublic get skeleton():Skeleton\r\n\t{\r\n\t\treturn this._skeleton;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the skeleton animator is disabled by default for GPU rendering, something that allows the animator to perform calculation on the GPU.\r\n\t * Defaults to false.\r\n\t */\r\n\tpublic get forceCPU():boolean\r\n\t{\r\n\t\treturn this._forceCPU;\r\n\t}\r\n\r\n\t/**\r\n\t * Offers the option of enabling GPU accelerated animation on skeletons larger than 32 joints\r\n\t * by condensing the number of joint index values required per mesh. Only applicable to\r\n\t * skeleton animations that utilise more than one mesh object. Defaults to false.\r\n\t */\r\n\tpublic get useCondensedIndices():boolean\r\n\t{\r\n\t\treturn this._useCondensedIndices;\r\n\t}\r\n\r\n\tpublic set useCondensedIndices(value:boolean)\r\n\t{\r\n\t\tthis._useCondensedIndices = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonAnimator</code> object.\r\n\t *\r\n\t * @param skeletonAnimationSet The animation data set containing the skeleton animations used by the animator.\r\n\t * @param skeleton The skeleton object used for calculating the resulting global matrices for transforming skinned mesh data.\r\n\t * @param forceCPU Optional value that only allows the animator to perform calculation on the CPU. Defaults to false.\r\n\t */\r\n\tconstructor(animationSet:SkeletonAnimationSet, skeleton:Skeleton, forceCPU:boolean = false)\r\n\t{\r\n\t\tsuper(animationSet);\r\n\r\n\t\tthis._skeleton = skeleton;\r\n\t\tthis._forceCPU = forceCPU;\r\n\t\tthis._jointsPerVertex = animationSet.jointsPerVertex;\r\n\r\n\t\tthis._numJoints = this._skeleton.numJoints;\r\n\t\tthis._globalMatrices = new Float32Array(this._numJoints*12);\r\n\r\n\t\tvar j:number /*int*/ = 0;\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numJoints; ++i) {\r\n\t\t\tthis._globalMatrices[j++] = 1;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 1;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 1;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t}\r\n\r\n\t\tthis._onTransitionCompleteDelegate = (event:AnimationStateEvent) => this.onTransitionComplete(event);\r\n\t\tthis._onIndicesUpdateDelegate = (event:SubGeometryEvent) => this.onIndicesUpdate(event);\r\n\t\tthis._onVerticesUpdateDelegate = (event:SubGeometryEvent) => this.onVerticesUpdate(event);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\t/* The cast to SkeletonAnimationSet should never fail, as _animationSet can only be set\r\n\t\t through the constructor, which will only accept a SkeletonAnimationSet. */\r\n\t\treturn new SkeletonAnimator(<SkeletonAnimationSet> this._pAnimationSet, this._skeleton, this._forceCPU);\r\n\t}\r\n\r\n\t/**\r\n\t * Plays an animation state registered with the given name in the animation data set.\r\n\t *\r\n\t * @param name The data set name of the animation state to be played.\r\n\t * @param transition An optional transition object that determines how the animator will transition from the currently active animation state.\r\n\t * @param offset An option offset time (in milliseconds) that resets the state's internal clock to the absolute time of the animator plus the offset value. Required for non-looping animation states.\r\n\t */\r\n\tpublic play(name:string, transition:IAnimationTransition = null, offset:number = NaN)\r\n\t{\r\n\t\tif (this._pActiveAnimationName == name)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pActiveAnimationName = name;\r\n\r\n\t\tif (!this._pAnimationSet.hasAnimation(name))\r\n\t\t\tthrow new Error(\"Animation root node \" + name + \" not found!\");\r\n\r\n\t\tif (transition && this._pActiveNode) {\r\n\t\t\t//setup the transition\r\n\t\t\tthis._pActiveNode = transition.getAnimationNode(this, this._pActiveNode, this._pAnimationSet.getAnimation(name), this._pAbsoluteTime);\r\n\t\t\tthis._pActiveNode.addEventListener(AnimationStateEvent.TRANSITION_COMPLETE, this._onTransitionCompleteDelegate);\r\n\t\t} else\r\n\t\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(name);\r\n\r\n\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\r\n\r\n\t\tif (this.updatePosition) {\r\n\t\t\t//update straight away to reset position deltas\r\n\t\t\tthis._pActiveState.update(this._pAbsoluteTime);\r\n\t\t\tthis._pActiveState.positionDelta;\r\n\t\t}\r\n\r\n\t\tthis._activeSkeletonState = <ISkeletonAnimationState> this._pActiveState;\r\n\r\n\t\tthis.start();\r\n\r\n\t\t//apply a time offset if specified\r\n\t\tif (!isNaN(offset))\r\n\t\t\tthis.reset(name, offset);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(shader:ShaderBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\t// do on request of globalProperties\r\n\t\tif (this._globalPropertiesDirty)\r\n\t\t\tthis.updateGlobalProperties();\r\n\r\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> (<TriangleSubMesh> (<TriangleSubMeshRenderable> renderable).subMesh).subGeometry;\r\n\r\n\t\tsubGeometry.useCondensedIndices = this._useCondensedIndices;\r\n\r\n\t\tif (this._useCondensedIndices) {\r\n\t\t\t// using a condensed data set\r\n\t\t\tthis.updateCondensedMatrices(subGeometry.condensedIndexLookUp);\r\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._condensedMatrices, this._condensedMatrices.length/4);\r\n\t\t} else {\r\n\t\t\tif (this._pAnimationSet.usesCPU) {\r\n\t\t\t\tif (this._morphedSubGeometryDirty[subGeometry.id])\r\n\t\t\t\t\tthis.morphSubGeometry(<TriangleSubMeshRenderable> renderable, subGeometry);\r\n\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._globalMatrices, this._numJoints*3);\r\n\t\t}\r\n\r\n\t\tshader.jointIndexIndex = vertexStreamOffset++;\r\n\t\tshader.jointWeightIndex = vertexStreamOffset++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic testGPUCompatibility(shader:ShaderBase)\r\n\t{\r\n\t\tif (!this._useCondensedIndices && (this._forceCPU || this._jointsPerVertex > 4 || shader.numUsedVertexConstants + this._numJoints*3 > 128))\r\n\t\t\tthis._pAnimationSet.cancelGPUCompatibility();\r\n\t}\r\n\r\n\t/**\r\n\t * Applies the calculated time delta to the active animation state node or state transition object.\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tsuper._pUpdateDeltaTime(dt);\r\n\r\n\t\t//invalidate pose matrices\r\n\t\tthis._globalPropertiesDirty = true;\r\n\r\n\t\t//trigger geometry invalidation if using CPU animation\r\n\t\tif (this._pAnimationSet.usesCPU)\r\n\t\t\tfor (var key in this._morphedSubGeometryDirty)\r\n\t\t\t\tthis._morphedSubGeometryDirty[key] = true;\r\n\t}\r\n\r\n\tprivate updateCondensedMatrices(condensedIndexLookUp:Array<number>)\r\n\t{\r\n\t\tvar j:number = 0, k:number = 0;\r\n\t\tvar len:number = condensedIndexLookUp.length;\r\n\t\tvar srcIndex:number /*uint*/;\r\n\r\n\t\tthis._condensedMatrices = new Float32Array(len*12);\r\n\r\n\t\tfor (var i:number = 0; i < len; i++) {\r\n\t\t\tsrcIndex = condensedIndexLookUp[i]*12; //12 required for the three 4-component vectors that store the matrix\r\n\t\t\tk = 12;\r\n\t\t\t// copy into condensed\r\n\t\t\twhile (k--)\r\n\t\t\t\tthis._condensedMatrices[j++] = this._globalMatrices[srcIndex++];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateGlobalProperties()\r\n\t{\r\n\t\tthis._globalPropertiesDirty = false;\r\n\r\n\t\t//get global pose\r\n\t\tthis.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton), this._globalPose, this._skeleton);\r\n\r\n\t\t// convert pose to matrix\r\n\t\tvar mtxOffset:number /*uint*/ = 0;\r\n\t\tvar globalPoses:Array<JointPose> = this._globalPose.jointPoses;\r\n\t\tvar raw:Float32Array;\r\n\t\tvar ox:number, oy:number, oz:number, ow:number;\r\n\t\tvar xy2:number, xz2:number, xw2:number;\r\n\t\tvar yz2:number, yw2:number, zw2:number;\r\n\t\tvar n11:number, n12:number, n13:number;\r\n\t\tvar n21:number, n22:number, n23:number;\r\n\t\tvar n31:number, n32:number, n33:number;\r\n\t\tvar m11:number, m12:number, m13:number, m14:number;\r\n\t\tvar m21:number, m22:number, m23:number, m24:number;\r\n\t\tvar m31:number, m32:number, m33:number, m34:number;\r\n\t\tvar joints:Array<SkeletonJoint> = this._skeleton.joints;\r\n\t\tvar pose:JointPose;\r\n\t\tvar quat:Quaternion;\r\n\t\tvar vec:Vector3D;\r\n\t\tvar t:number;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numJoints; ++i) {\r\n\t\t\tpose = globalPoses[i];\r\n\t\t\tquat = pose.orientation;\r\n\t\t\tvec = pose.translation;\r\n\t\t\tox = quat.x;\r\n\t\t\toy = quat.y;\r\n\t\t\toz = quat.z;\r\n\t\t\tow = quat.w;\r\n\r\n\t\t\txy2 = (t = 2.0*ox)*oy;\r\n\t\t\txz2 = t*oz;\r\n\t\t\txw2 = t*ow;\r\n\t\t\tyz2 = (t = 2.0*oy)*oz;\r\n\t\t\tyw2 = t*ow;\r\n\t\t\tzw2 = 2.0*oz*ow;\r\n\r\n\t\t\tyz2 = 2.0*oy*oz;\r\n\t\t\tyw2 = 2.0*oy*ow;\r\n\t\t\tzw2 = 2.0*oz*ow;\r\n\t\t\tox *= ox;\r\n\t\t\toy *= oy;\r\n\t\t\toz *= oz;\r\n\t\t\tow *= ow;\r\n\r\n\t\t\tn11 = (t = ox - oy) - oz + ow;\r\n\t\t\tn12 = xy2 - zw2;\r\n\t\t\tn13 = xz2 + yw2;\r\n\t\t\tn21 = xy2 + zw2;\r\n\t\t\tn22 = -t - oz + ow;\r\n\t\t\tn23 = yz2 - xw2;\r\n\t\t\tn31 = xz2 - yw2;\r\n\t\t\tn32 = yz2 + xw2;\r\n\t\t\tn33 = -ox - oy + oz + ow;\r\n\r\n\t\t\t// prepend inverse bind pose\r\n\t\t\traw = joints[i].inverseBindPose;\r\n\t\t\tm11 = raw[0];\r\n\t\t\tm12 = raw[4];\r\n\t\t\tm13 = raw[8];\r\n\t\t\tm14 = raw[12];\r\n\t\t\tm21 = raw[1];\r\n\t\t\tm22 = raw[5];\r\n\t\t\tm23 = raw[9];\r\n\t\t\tm24 = raw[13];\r\n\t\t\tm31 = raw[2];\r\n\t\t\tm32 = raw[6];\r\n\t\t\tm33 = raw[10];\r\n\t\t\tm34 = raw[14];\r\n\r\n\t\t\tthis._globalMatrices[mtxOffset] = n11*m11 + n12*m21 + n13*m31;\r\n\t\t\tthis._globalMatrices[mtxOffset + 1] = n11*m12 + n12*m22 + n13*m32;\r\n\t\t\tthis._globalMatrices[mtxOffset + 2] = n11*m13 + n12*m23 + n13*m33;\r\n\t\t\tthis._globalMatrices[mtxOffset + 3] = n11*m14 + n12*m24 + n13*m34 + vec.x;\r\n\t\t\tthis._globalMatrices[mtxOffset + 4] = n21*m11 + n22*m21 + n23*m31;\r\n\t\t\tthis._globalMatrices[mtxOffset + 5] = n21*m12 + n22*m22 + n23*m32;\r\n\t\t\tthis._globalMatrices[mtxOffset + 6] = n21*m13 + n22*m23 + n23*m33;\r\n\t\t\tthis._globalMatrices[mtxOffset + 7] = n21*m14 + n22*m24 + n23*m34 + vec.y;\r\n\t\t\tthis._globalMatrices[mtxOffset + 8] = n31*m11 + n32*m21 + n33*m31;\r\n\t\t\tthis._globalMatrices[mtxOffset + 9] = n31*m12 + n32*m22 + n33*m32;\r\n\t\t\tthis._globalMatrices[mtxOffset + 10] = n31*m13 + n32*m23 + n33*m33;\r\n\t\t\tthis._globalMatrices[mtxOffset + 11] = n31*m14 + n32*m24 + n33*m34 + vec.z;\r\n\r\n\t\t\tmtxOffset = mtxOffset + 12;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\r\n\t{\r\n\t\tthis._morphedSubGeometryDirty[sourceSubGeometry.id] = true;\r\n\r\n\t\t//early out for GPU animations\r\n\t\tif (!this._pAnimationSet.usesCPU)\r\n\t\t\treturn sourceSubGeometry;\r\n\r\n\t\tvar targetSubGeometry:TriangleSubGeometry;\r\n\r\n\t\tif (!(targetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id])) {\r\n\t\t\t//not yet stored\r\n\t\t\ttargetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id] = sourceSubGeometry.clone();\r\n\t\t\t//turn off auto calculations on the morphed geometry\r\n\t\t\ttargetSubGeometry.autoDeriveNormals = false;\r\n\t\t\ttargetSubGeometry.autoDeriveTangents = false;\r\n\t\t\ttargetSubGeometry.autoDeriveUVs = false;\r\n\t\t\t//add event listeners for any changes in UV values on the source geometry\r\n\t\t\tsourceSubGeometry.addEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdateDelegate);\r\n\t\t\tsourceSubGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdateDelegate);\r\n\t\t}\r\n\r\n\t\treturn targetSubGeometry;\r\n\t}\r\n\r\n\t/**\r\n\t * If the animation can't be performed on GPU, transform vertices manually\r\n\t * @param subGeom The subgeometry containing the weights and joint index data per vertex.\r\n\t * @param pass The material pass for which we need to transform the vertices\r\n\t */\r\n\tpublic morphSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry)\r\n\t{\r\n\t\tthis._morphedSubGeometryDirty[sourceSubGeometry.id] = false;\r\n\r\n\t\tvar numVertices:number = sourceSubGeometry.numVertices;\r\n\t\tvar sourcePositions:Float32Array = sourceSubGeometry.positions.get(numVertices);\r\n\t\tvar sourceNormals:Float32Array = sourceSubGeometry.normals.get(numVertices);\r\n\t\tvar sourceTangents:Float32Array = sourceSubGeometry.tangents.get(numVertices);\r\n\r\n\t\tvar jointIndices:Float32Array = <Float32Array> sourceSubGeometry.jointIndices.get(numVertices);\r\n\t\tvar jointWeights:Float32Array = <Float32Array> sourceSubGeometry.jointWeights.get(numVertices);\r\n\r\n\t\tvar targetSubGeometry:TriangleSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id];\r\n\r\n\t\tvar targetPositions:Float32Array = targetSubGeometry.positions.get(numVertices);\r\n\t\tvar targetNormals:Float32Array = targetSubGeometry.normals.get(numVertices);\r\n\t\tvar targetTangents:Float32Array = targetSubGeometry.tangents.get(numVertices);\r\n\r\n\t\tvar index:number /*uint*/ = 0;\r\n\t\tvar j:number /*uint*/ = 0;\r\n\t\tvar k:number /*uint*/;\r\n\t\tvar vx:number, vy:number, vz:number;\r\n\t\tvar nx:number, ny:number, nz:number;\r\n\t\tvar tx:number, ty:number, tz:number;\r\n\t\tvar len:number /*int*/ = sourcePositions.length;\r\n\t\tvar weight:number;\r\n\t\tvar vertX:number, vertY:number, vertZ:number;\r\n\t\tvar normX:number, normY:number, normZ:number;\r\n\t\tvar tangX:number, tangY:number, tangZ:number;\r\n\t\tvar m11:number, m12:number, m13:number, m14:number;\r\n\t\tvar m21:number, m22:number, m23:number, m24:number;\r\n\t\tvar m31:number, m32:number, m33:number, m34:number;\r\n\r\n\t\twhile (index < len) {\r\n\t\t\tvertX = sourcePositions[index];\r\n\t\t\tvertY = sourcePositions[index + 1];\r\n\t\t\tvertZ = sourcePositions[index + 2];\r\n\t\t\tnormX = sourceNormals[index];\r\n\t\t\tnormY = sourceNormals[index + 1];\r\n\t\t\tnormZ = sourceNormals[index + 2];\r\n\t\t\ttangX = sourceTangents[index];\r\n\t\t\ttangY = sourceTangents[index + 1];\r\n\t\t\ttangZ = sourceTangents[index + 2];\r\n\t\t\tvx = 0;\r\n\t\t\tvy = 0;\r\n\t\t\tvz = 0;\r\n\t\t\tnx = 0;\r\n\t\t\tny = 0;\r\n\t\t\tnz = 0;\r\n\t\t\ttx = 0;\r\n\t\t\tty = 0;\r\n\t\t\ttz = 0;\r\n\t\t\tk = 0;\r\n\t\t\twhile (k < this._jointsPerVertex) {\r\n\t\t\t\tweight = jointWeights[j];\r\n\t\t\t\tif (weight > 0) {\r\n\t\t\t\t\t// implicit /3*12 (/3 because indices are multiplied by 3 for gpu matrix access, *12 because it's the matrix size)\r\n\t\t\t\t\tvar mtxOffset:number /*uint*/ = jointIndices[j++] << 2;\r\n\t\t\t\t\tm11 = this._globalMatrices[mtxOffset];\r\n\t\t\t\t\tm12 = this._globalMatrices[mtxOffset + 1];\r\n\t\t\t\t\tm13 = this._globalMatrices[mtxOffset + 2];\r\n\t\t\t\t\tm14 = this._globalMatrices[mtxOffset + 3];\r\n\t\t\t\t\tm21 = this._globalMatrices[mtxOffset + 4];\r\n\t\t\t\t\tm22 = this._globalMatrices[mtxOffset + 5];\r\n\t\t\t\t\tm23 = this._globalMatrices[mtxOffset + 6];\r\n\t\t\t\t\tm24 = this._globalMatrices[mtxOffset + 7];\r\n\t\t\t\t\tm31 = this._globalMatrices[mtxOffset + 8];\r\n\t\t\t\t\tm32 = this._globalMatrices[mtxOffset + 9];\r\n\t\t\t\t\tm33 = this._globalMatrices[mtxOffset + 10];\r\n\t\t\t\t\tm34 = this._globalMatrices[mtxOffset + 11];\r\n\t\t\t\t\tvx += weight*(m11*vertX + m12*vertY + m13*vertZ + m14);\r\n\t\t\t\t\tvy += weight*(m21*vertX + m22*vertY + m23*vertZ + m24);\r\n\t\t\t\t\tvz += weight*(m31*vertX + m32*vertY + m33*vertZ + m34);\r\n\t\t\t\t\tnx += weight*(m11*normX + m12*normY + m13*normZ);\r\n\t\t\t\t\tny += weight*(m21*normX + m22*normY + m23*normZ);\r\n\t\t\t\t\tnz += weight*(m31*normX + m32*normY + m33*normZ);\r\n\t\t\t\t\ttx += weight*(m11*tangX + m12*tangY + m13*tangZ);\r\n\t\t\t\t\tty += weight*(m21*tangX + m22*tangY + m23*tangZ);\r\n\t\t\t\t\ttz += weight*(m31*tangX + m32*tangY + m33*tangZ);\r\n\t\t\t\t\t++k;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tj += (this._jointsPerVertex - k);\r\n\t\t\t\t\tk = this._jointsPerVertex;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttargetPositions[index] = vx;\r\n\t\t\ttargetPositions[index + 1] = vy;\r\n\t\t\ttargetPositions[index + 2] = vz;\r\n\t\t\ttargetNormals[index] = nx;\r\n\t\t\ttargetNormals[index + 1] = ny;\r\n\t\t\ttargetNormals[index + 2] = nz;\r\n\t\t\ttargetTangents[index] = tx;\r\n\t\t\ttargetTangents[index + 1] = ty;\r\n\t\t\ttargetTangents[index + 2] = tz;\r\n\r\n\t\t\tindex += 3;\r\n\t\t}\r\n\r\n\t\ttargetSubGeometry.setPositions(targetPositions);\r\n\t\ttargetSubGeometry.setNormals(targetNormals);\r\n\t\ttargetSubGeometry.setTangents(targetTangents);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a local hierarchical skeleton pose to a global pose\r\n\t * @param targetPose The SkeletonPose object that will contain the global pose.\r\n\t * @param skeleton The skeleton containing the joints, and as such, the hierarchical data to transform to global poses.\r\n\t */\r\n\tprivate localToGlobalPose(sourcePose:SkeletonPose, targetPose:SkeletonPose, skeleton:Skeleton)\r\n\t{\r\n\t\tvar globalPoses:Array<JointPose> = targetPose.jointPoses;\r\n\t\tvar globalJointPose:JointPose;\r\n\t\tvar joints:Array<SkeletonJoint> = skeleton.joints;\r\n\t\tvar len:number /*uint*/ = sourcePose.numJointPoses;\r\n\t\tvar jointPoses:Array<JointPose> = sourcePose.jointPoses;\r\n\t\tvar parentIndex:number /*int*/;\r\n\t\tvar joint:SkeletonJoint;\r\n\t\tvar parentPose:JointPose;\r\n\t\tvar pose:JointPose;\r\n\t\tvar or:Quaternion;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar t:Vector3D;\r\n\t\tvar q:Quaternion;\r\n\r\n\t\tvar x1:number, y1:number, z1:number, w1:number;\r\n\t\tvar x2:number, y2:number, z2:number, w2:number;\r\n\t\tvar x3:number, y3:number, z3:number;\r\n\r\n\t\t// :s\r\n\t\tif (globalPoses.length != len)\r\n\t\t\tglobalPoses.length = len;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tglobalJointPose = globalPoses[i];\r\n\r\n\t\t\tif (globalJointPose == null)\r\n\t\t\t\tglobalJointPose = globalPoses[i] = new JointPose();\r\n\r\n\t\t\tjoint = joints[i];\r\n\t\t\tparentIndex = joint.parentIndex;\r\n\t\t\tpose = jointPoses[i];\r\n\r\n\t\t\tq = globalJointPose.orientation;\r\n\t\t\tt = globalJointPose.translation;\r\n\r\n\t\t\tif (parentIndex < 0) {\r\n\t\t\t\ttr = pose.translation;\r\n\t\t\t\tor = pose.orientation;\r\n\t\t\t\tq.x = or.x;\r\n\t\t\t\tq.y = or.y;\r\n\t\t\t\tq.z = or.z;\r\n\t\t\t\tq.w = or.w;\r\n\t\t\t\tt.x = tr.x;\r\n\t\t\t\tt.y = tr.y;\r\n\t\t\t\tt.z = tr.z;\r\n\t\t\t} else {\r\n\t\t\t\t// append parent pose\r\n\t\t\t\tparentPose = globalPoses[parentIndex];\r\n\r\n\t\t\t\t// rotate point\r\n\t\t\t\tor = parentPose.orientation;\r\n\t\t\t\ttr = pose.translation;\r\n\t\t\t\tx2 = or.x;\r\n\t\t\t\ty2 = or.y;\r\n\t\t\t\tz2 = or.z;\r\n\t\t\t\tw2 = or.w;\r\n\t\t\t\tx3 = tr.x;\r\n\t\t\t\ty3 = tr.y;\r\n\t\t\t\tz3 = tr.z;\r\n\r\n\t\t\t\tw1 = -x2*x3 - y2*y3 - z2*z3;\r\n\t\t\t\tx1 = w2*x3 + y2*z3 - z2*y3;\r\n\t\t\t\ty1 = w2*y3 - x2*z3 + z2*x3;\r\n\t\t\t\tz1 = w2*z3 + x2*y3 - y2*x3;\r\n\r\n\t\t\t\t// append parent translation\r\n\t\t\t\ttr = parentPose.translation;\r\n\t\t\t\tt.x = -w1*x2 + x1*w2 - y1*z2 + z1*y2 + tr.x;\r\n\t\t\t\tt.y = -w1*y2 + x1*z2 + y1*w2 - z1*x2 + tr.y;\r\n\t\t\t\tt.z = -w1*z2 - x1*y2 + y1*x2 + z1*w2 + tr.z;\r\n\r\n\t\t\t\t// append parent orientation\r\n\t\t\t\tx1 = or.x;\r\n\t\t\t\ty1 = or.y;\r\n\t\t\t\tz1 = or.z;\r\n\t\t\t\tw1 = or.w;\r\n\t\t\t\tor = pose.orientation;\r\n\t\t\t\tx2 = or.x;\r\n\t\t\t\ty2 = or.y;\r\n\t\t\t\tz2 = or.z;\r\n\t\t\t\tw2 = or.w;\r\n\r\n\t\t\t\tq.w = w1*w2 - x1*x2 - y1*y2 - z1*z2;\r\n\t\t\t\tq.x = w1*x2 + x1*w2 + y1*z2 - z1*y2;\r\n\t\t\t\tq.y = w1*y2 - x1*z2 + y1*w2 + z1*x2;\r\n\t\t\t\tq.z = w1*z2 + x1*y2 - y1*x2 + z1*w2;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onTransitionComplete(event:AnimationStateEvent)\r\n\t{\r\n\t\tif (event.type == AnimationStateEvent.TRANSITION_COMPLETE) {\r\n\t\t\tevent.animationNode.removeEventListener(AnimationStateEvent.TRANSITION_COMPLETE, this._onTransitionCompleteDelegate);\r\n\t\t\t//if this is the current active state transition, revert control to the active node\r\n\t\t\tif (this._pActiveState == event.animationState) {\r\n\t\t\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(this._pActiveAnimationName);\r\n\t\t\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\r\n\t\t\t\tthis._activeSkeletonState = <ISkeletonAnimationState> this._pActiveState;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onIndicesUpdate(event:SubGeometryEvent)\r\n\t{\r\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> event.target;\r\n\r\n\t\t(<TriangleSubGeometry> this._morphedSubGeometry[subGeometry.id]).setIndices(subGeometry.indices);\r\n\t}\r\n\r\n\tprivate onVerticesUpdate(event:SubGeometryEvent)\r\n\t{\r\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> event.target;\r\n\t\tvar morphGeometry:TriangleSubGeometry = <TriangleSubGeometry> this._morphedSubGeometry[subGeometry.id];\r\n\r\n\t\tswitch(event.attributesView) {\r\n\t\t\tcase subGeometry.uvs:\r\n\t\t\t\tmorphGeometry.setUVs(subGeometry.uvs.get(subGeometry.numVertices));\r\n\t\t\t\tbreak;\r\n\t\t\tcase subGeometry.secondaryUVs:\r\n\t\t\t\tmorphGeometry.setSecondaryUVs(subGeometry.secondaryUVs.get(subGeometry.numVertices));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonAnimator;",
    "import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport VertexAnimationMode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/VertexAnimationMode\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\n\r\n/**\r\n * The animation data set used by vertex-based animators, containing vertex animation state data.\r\n *\r\n * @see VertexAnimator\r\n */\r\nclass VertexAnimationSet extends AnimationSetBase implements IAnimationSet\r\n{\r\n\tprivate _numPoses:number /*uint*/;\r\n\tprivate _blendMode:string;\r\n\r\n\t/**\r\n\t * Returns the number of poses made available at once to the GPU animation code.\r\n\t */\r\n\tpublic get numPoses():number /*uint*/\r\n\t{\r\n\t\treturn this._numPoses;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the active blend mode of the vertex animator object.\r\n\t */\r\n\tpublic get blendMode():string\r\n\t{\r\n\t\treturn this._blendMode;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether or not normal data is used in last set GPU pass of the vertex shader.\r\n\t */\r\n//\t\tpublic get useNormals():boolean\r\n//\t\t{\r\n//\t\t\treturn this._uploadNormals;\r\n//\t\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>VertexAnimationSet</code> object.\r\n\t *\r\n\t * @param numPoses The number of poses made available at once to the GPU animation code.\r\n\t * @param blendMode Optional value for setting the animation mode of the vertex animator object.\r\n\t *\r\n\t * @see away3d.animators.data.VertexAnimationMode\r\n\t */\r\n\tconstructor(numPoses:number /*uint*/ = 2, blendMode:string = \"absolute\")\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._numPoses = numPoses;\r\n\t\tthis._blendMode = blendMode;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase):string\r\n\t{\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE)\r\n\t\t\treturn this.getAbsoluteAGALCode(shader);\r\n\t\telse\r\n\t\t\treturn this.getAdditiveAGALCode(shader);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar uID:number = pass._iUniqueId;\r\n//\t\t\tthis._uploadNormals = <boolean> this._useNormals[uID];\r\n//\t\t\tthis._uploadTangents = <boolean> this._useTangents[uID];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shader:ShaderBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar uID:number = pass._iUniqueId;\r\n//\t\t\tvar index:number /*uint*/ = this._streamIndices[uID];\r\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n//\t\t\tcontext.setVertexBufferAt(index, null);\r\n//\t\t\tif (this._uploadNormals)\r\n//\t\t\t\tcontext.setVertexBufferAt(index + 1, null);\r\n//\t\t\tif (this._uploadTangents)\r\n//\t\t\t\tcontext.setVertexBufferAt(index + 2, null);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shader:ShaderBase, shadedTarget:string):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shader:ShaderBase):string\r\n\t{\r\n\t\treturn \"mov \" + shader.uvTarget + \",\" + shader.uvSource + \"\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Generates the vertex AGAL code for absolute blending.\r\n\t */\r\n\tprivate getAbsoluteAGALCode(shader:ShaderBase):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar temp1:string = this._pFindTempReg(shader.animationTargetRegisters);\r\n\t\tvar temp2:string = this._pFindTempReg(shader.animationTargetRegisters, temp1);\r\n\t\tvar regs:Array<string> = new Array<string>(\"x\", \"y\", \"z\", \"w\");\r\n\t\tvar len:number /*uint*/ = shader.animatableAttributes.length;\r\n\t\tvar constantReg:string = \"vc\" + shader.numUsedVertexConstants;\r\n\r\n\t\tif (len > 2)\r\n\t\t\tlen = 2;\r\n\t\tvar streamIndex:number /*uint*/ = shader.numUsedStreams;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tcode += \"mul \" + temp1 + \", \" + shader.animatableAttributes[i] + \", \" + constantReg + \".\" + regs[0] + \"\\n\";\r\n\r\n\t\t\tfor (var j:number /*uint*/ = 1; j < this._numPoses; ++j) {\r\n\t\t\t\tcode += \"mul \" + temp2 + \", va\" + streamIndex + \", \" + constantReg + \".\" + regs[j] + \"\\n\";\r\n\r\n\t\t\t\tif (j < this._numPoses - 1)\r\n\t\t\t\t\tcode += \"add \" + temp1 + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\r\n\t\t\t\t++streamIndex;\r\n\t\t\t}\r\n\r\n\t\t\tcode += \"add \" + shader.animationTargetRegisters[i] + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\t\t}\r\n\r\n\t\t// add code for bitangents if tangents are used\r\n\t\tif (shader.tangentDependencies > 0 || shader.outputsNormals) {\r\n\t\t\tcode += \"dp3 \" + temp1 + \".x, \" + shader.animatableAttributes[2] + \", \" + shader.animationTargetRegisters[1] + \"\\n\" +\r\n\t\t\t\t\"mul \" + temp1 + \", \" + shader.animationTargetRegisters[1] + \", \" + temp1 + \".x\\n\" +\r\n\t\t\t\t\"sub \" + shader.animationTargetRegisters[2] + \", \" + shader.animationTargetRegisters[2] + \", \" + temp1 + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates the vertex AGAL code for additive blending.\r\n\t */\r\n\tprivate getAdditiveAGALCode(shader:ShaderBase):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar len:number /*uint*/ = shader.animatableAttributes.length;\r\n\t\tvar regs:Array<string> = [\"x\", \"y\", \"z\", \"w\"];\r\n\t\tvar temp1:string = this._pFindTempReg(shader.animationTargetRegisters);\r\n\t\tvar k:number /*uint*/;\r\n\r\n\t\tvar streamIndex:number /*uint*/ = shader.numUsedStreams;\r\n\r\n\t\tif (len > 2)\r\n\t\t\tlen = 2;\r\n\r\n\t\tcode += \"mov  \" + shader.animationTargetRegisters[0] + \", \" + shader.animatableAttributes[0] + \"\\n\";\r\n\t\tif (shader.normalDependencies > 0)\r\n\t\t\tcode += \"mov \" + shader.animationTargetRegisters[1] + \", \" + shader.animatableAttributes[1] + \"\\n\";\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tfor (var j:number /*uint*/ = 0; j < this._numPoses; ++j) {\r\n\t\t\t\tcode += \"mul \" + temp1 + \", va\" + (streamIndex + k) + \", vc\" + shader.numUsedVertexConstants + \".\" + regs[j] + \"\\n\" +\r\n\t\t\t\t\t\"add \" + shader.animationTargetRegisters[i] + \", \" + shader.animationTargetRegisters[i] + \", \" + temp1 + \"\\n\";\r\n\t\t\t\tk++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (shader.tangentDependencies > 0 || shader.outputsNormals) {\r\n\t\t\tcode += \"dp3 \" + temp1 + \".x, \" + shader.animatableAttributes[2] + \", \" + shader.animationTargetRegisters[1] + \"\\n\" +\r\n\t\t\t\t\"mul \" + temp1 + \", \" + shader.animationTargetRegisters[1] + \", \" + temp1 + \".x\\n\" +\r\n\t\t\t\t\"sub \" + shader.animationTargetRegisters[2] + \", \" + shader.animatableAttributes[2] + \", \" + temp1 + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n}\r\n\r\nexport = VertexAnimationSet;",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport TriangleSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport VertexAnimationMode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/VertexAnimationMode\");\r\nimport IVertexAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IVertexAnimationState\");\r\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\r\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/renderables/TriangleSubMeshRenderable\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport SubGeometryVOBase\t\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOBase\");\r\nimport SubGeometryVOPool\t\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOPool\");\r\n\r\n/**\r\n * Provides an interface for assigning vertex-based animation data sets to mesh-based entity objects\r\n * and controlling the various available states of animation through an interative playhead that can be\r\n * automatically updated or manually triggered.\r\n */\r\nclass VertexAnimator extends AnimatorBase\r\n{\r\n\tprivate _subGeometryVOPool:SubGeometryVOPool;\r\n\tprivate _vertexAnimationSet:VertexAnimationSet;\r\n\tprivate _poses:Array<Geometry> = new Array<Geometry>();\r\n\tprivate _weights:Float32Array = new Float32Array([1, 0, 0, 0]);\r\n\tprivate _numPoses:number /*uint*/;\r\n\tprivate _blendMode:string;\r\n\tprivate _activeVertexState:IVertexAnimationState;\r\n\r\n\t/**\r\n\t * Creates a new <code>VertexAnimator</code> object.\r\n\t *\r\n\t * @param vertexAnimationSet The animation data set containing the vertex animations used by the animator.\r\n\t */\r\n\tconstructor(vertexAnimationSet:VertexAnimationSet)\r\n\t{\r\n\t\tsuper(vertexAnimationSet);\r\n\r\n\t\tthis._vertexAnimationSet = vertexAnimationSet;\r\n\t\tthis._numPoses = vertexAnimationSet.numPoses;\r\n\t\tthis._blendMode = vertexAnimationSet.blendMode;\r\n\t\tthis._subGeometryVOPool = SubGeometryVOPool.getPool();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\treturn new VertexAnimator(this._vertexAnimationSet);\r\n\t}\r\n\r\n\t/**\r\n\t * Plays a sequence with a given name. If the sequence is not found, it may not be loaded yet, and it will retry every frame.\r\n\t * @param sequenceName The name of the clip to be played.\r\n\t */\r\n\tpublic play(name:string, transition:IAnimationTransition = null, offset:number = NaN)\r\n\t{\r\n\t\tif (this._pActiveAnimationName == name)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pActiveAnimationName = name;\r\n\r\n\t\t//TODO: implement transitions in vertex animator\r\n\r\n\t\tif (!this._pAnimationSet.hasAnimation(name))\r\n\t\t\tthrow new Error(\"Animation root node \" + name + \" not found!\");\r\n\r\n\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(name);\r\n\r\n\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\r\n\r\n\t\tif (this.updatePosition) {\r\n\t\t\t//update straight away to reset position deltas\r\n\t\t\tthis._pActiveState.update(this._pAbsoluteTime);\r\n\t\t\tthis._pActiveState.positionDelta;\r\n\t\t}\r\n\r\n\t\tthis._activeVertexState = <IVertexAnimationState> this._pActiveState;\r\n\r\n\t\tthis.start();\r\n\r\n\t\t//apply a time offset if specified\r\n\t\tif (!isNaN(offset))\r\n\t\t\tthis.reset(name, offset);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tsuper._pUpdateDeltaTime(dt);\r\n\r\n\t\tvar geometryFlag:boolean = false;\r\n\r\n\t\tif (this._poses[0] != this._activeVertexState.currentGeometry) {\r\n\t\t\tthis._poses[0] = this._activeVertexState.currentGeometry;\r\n\t\t\tgeometryFlag = true;\r\n\t\t}\r\n\r\n\t\tif (this._poses[1] != this._activeVertexState.nextGeometry) {\r\n\t\t\tthis._poses[1] = this._activeVertexState.nextGeometry;\r\n\t\t\tgeometryFlag = true;\r\n\t\t}\r\n\r\n\t\tthis._weights[0] = 1 - (this._weights[1] = this._activeVertexState.blendWeight);\r\n\r\n\t\tif (geometryFlag) {\r\n\t\t\t//invalidate meshes\r\n\t\t\tvar mesh:Mesh;\r\n\t\t\tvar len:number = this._pOwners.length;\r\n\t\t\tfor (var i:number = 0; i < len; i++) {\r\n\t\t\t\tmesh = this._pOwners[i];\r\n\t\t\t\tmesh._iInvalidateRenderableGeometries();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(shader:ShaderBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\t// todo: add code for when running on cpu\r\n\t\t// this type of animation can only be SubMesh\r\n\t\tvar subMesh:TriangleSubMesh = <TriangleSubMesh> (<TriangleSubMeshRenderable> renderable).subMesh;\r\n\t\tvar subGeom:TriangleSubGeometry = subMesh.subGeometry;\r\n\r\n\t\t// if no poses defined, set temp data\r\n\t\tif (!this._poses.length) {\r\n\t\t\tthis.setNullPose(shader, subGeom, stage, vertexConstantOffset, vertexStreamOffset);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/ = this._numPoses;\r\n\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._weights, 1);\r\n\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE)\r\n\t\t\ti = 1;\r\n\t\telse\r\n\t\t\ti = 0;\r\n\r\n\t\tvar subGeometryVO:SubGeometryVOBase;\r\n\r\n\t\tfor (; i < len; ++i) {\r\n\t\t\tsubGeom = <TriangleSubGeometry> this._poses[i].subGeometries[subMesh._iIndex] || subMesh.subGeometry;\r\n\r\n\t\t\tsubGeometryVO = this._subGeometryVOPool.getItem(subGeom);\r\n\t\t\tsubGeometryVO._indexMappings = this._subGeometryVOPool.getItem(subMesh.subGeometry).indexMappings;\r\n\r\n\t\t\tsubGeometryVO.activateVertexBufferVO(vertexStreamOffset++, subGeom.positions, stage);\r\n\r\n\t\t\tif (shader.normalDependencies > 0)\r\n\t\t\t\tsubGeometryVO.activateVertexBufferVO(vertexStreamOffset++, subGeom.normals, stage);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate setNullPose(shader:ShaderBase, subGeometry:TriangleSubGeometry, stage:Stage, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._weights, 1);\r\n\r\n\t\tvar subGeometryVO:SubGeometryVOBase = this._subGeometryVOPool.getItem(subGeometry);\r\n\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE) {\r\n\t\t\tvar len:number /*uint*/ = this._numPoses;\r\n\t\t\tfor (var i:number /*uint*/ = 1; i < len; ++i) {\r\n\t\t\t\tsubGeometryVO.activateVertexBufferVO(vertexStreamOffset++, subGeometry.positions, stage);\r\n\r\n\t\t\t\tif (shader.normalDependencies > 0)\r\n\t\t\t\t\tsubGeometryVO.activateVertexBufferVO(vertexStreamOffset++, subGeometry.normals, stage);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// todo: set temp data for additive?\r\n\t}\r\n\r\n\t/**\r\n\t * Verifies if the animation will be used on cpu. Needs to be true for all passes for a material to be able to use it on gpu.\r\n\t * Needs to be called if gpu code is potentially required.\r\n\t */\r\n\tpublic testGPUCompatibility(shader:ShaderBase)\r\n\t{\r\n\t}\r\n\r\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\r\n\t{\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE && this._poses.length)\r\n\t\t\treturn <TriangleSubGeometry> this._poses[0].subGeometries[renderable.subMesh._iIndex] || sourceSubGeometry;\r\n\r\n\t\t//nothing to do here\r\n\t\treturn sourceSubGeometry;\r\n\t}\r\n}\r\n\r\nexport = VertexAnimator;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n\r\n/**\r\n * ...\r\n */\r\nclass AnimationRegisterCache extends ShaderRegisterCache\r\n{\r\n\t//vertex\r\n\tpublic positionAttribute:ShaderRegisterElement;\r\n\tpublic uvAttribute:ShaderRegisterElement;\r\n\tpublic positionTarget:ShaderRegisterElement;\r\n\tpublic scaleAndRotateTarget:ShaderRegisterElement;\r\n\tpublic velocityTarget:ShaderRegisterElement;\r\n\tpublic vertexTime:ShaderRegisterElement;\r\n\tpublic vertexLife:ShaderRegisterElement;\r\n\tpublic vertexZeroConst:ShaderRegisterElement;\r\n\tpublic vertexOneConst:ShaderRegisterElement;\r\n\tpublic vertexTwoConst:ShaderRegisterElement;\r\n\tpublic uvTarget:ShaderRegisterElement;\r\n\tpublic colorAddTarget:ShaderRegisterElement;\r\n\tpublic colorMulTarget:ShaderRegisterElement;\r\n\t//vary\r\n\tpublic colorAddVary:ShaderRegisterElement;\r\n\tpublic colorMulVary:ShaderRegisterElement;\r\n\r\n\t//fragment\r\n\r\n\tpublic uvVar:ShaderRegisterElement;\r\n\r\n\t//these are targets only need to rotate ( normal and tangent )\r\n\tpublic rotationRegisters:Array<ShaderRegisterElement>;\r\n\r\n\tpublic needFragmentAnimation:boolean;\r\n\tpublic needUVAnimation:boolean;\r\n\r\n\tpublic sourceRegisters:Array<string>;\r\n\tpublic targetRegisters:Array<string>;\r\n\r\n\tprivate indexDictionary:Object = new Object();\r\n\r\n\t//set true if has an node which will change UV\r\n\tpublic hasUVNode:boolean;\r\n\t//set if the other nodes need to access the velocity\r\n\tpublic needVelocity:boolean;\r\n\t//set if has a billboard node.\r\n\tpublic hasBillboard:boolean;\r\n\t//set if has an node which will apply color multiple operation\r\n\tpublic hasColorMulNode:boolean;\r\n\t//set if has an node which will apply color add operation\r\n\tpublic hasColorAddNode:boolean;\r\n\r\n\tconstructor(profile:string)\r\n\t{\r\n\t\tsuper(profile);\r\n\t}\r\n\r\n\tpublic reset()\r\n\t{\r\n\t\tsuper.reset();\r\n\r\n\t\tthis.rotationRegisters = new Array<ShaderRegisterElement>();\r\n\t\tthis.positionAttribute = this.getRegisterFromString(this.sourceRegisters[0]);\r\n\t\tthis.scaleAndRotateTarget = this.getRegisterFromString(this.targetRegisters[0]);\r\n\t\tthis.addVertexTempUsages(this.scaleAndRotateTarget, 1);\r\n\r\n\t\tfor (var i:number /*int*/ = 1; i < this.targetRegisters.length; i++) {\r\n\t\t\tthis.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[i]));\r\n\t\t\tthis.addVertexTempUsages(this.rotationRegisters[i - 1], 1);\r\n\t\t}\r\n\r\n\t\tthis.scaleAndRotateTarget = new ShaderRegisterElement(this.scaleAndRotateTarget.regName, this.scaleAndRotateTarget.index); //only use xyz, w is used as vertexLife\r\n\r\n\t\t//allot const register\r\n\r\n\t\tthis.vertexZeroConst = this.getFreeVertexConstant();\r\n\t\tthis.vertexZeroConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 0);\r\n\t\tthis.vertexOneConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 1);\r\n\t\tthis.vertexTwoConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 2);\r\n\r\n\t\t//allot temp register\r\n\t\tthis.positionTarget = this.getFreeVertexVectorTemp();\r\n\t\tthis.addVertexTempUsages(this.positionTarget, 1);\r\n\t\tthis.positionTarget = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index);\r\n\r\n\t\tif (this.needVelocity) {\r\n\t\t\tthis.velocityTarget = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(this.velocityTarget, 1);\r\n\t\t\tthis.velocityTarget = new ShaderRegisterElement(this.velocityTarget.regName, this.velocityTarget.index);\r\n\t\t\tthis.vertexTime = new ShaderRegisterElement(this.velocityTarget.regName, this.velocityTarget.index, 3);\r\n\t\t\tthis.vertexLife = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index, 3);\r\n\t\t} else {\r\n\t\t\tvar tempTime:ShaderRegisterElement = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(tempTime, 1);\r\n\t\t\tthis.vertexTime = new ShaderRegisterElement(tempTime.regName, tempTime.index, 0);\r\n\t\t\tthis.vertexLife = new ShaderRegisterElement(tempTime.regName, tempTime.index, 1);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic setUVSourceAndTarget(UVAttribute:string, UVVaring:string)\r\n\t{\r\n\t\tthis.uvVar = this.getRegisterFromString(UVVaring);\r\n\t\tthis.uvAttribute = this.getRegisterFromString(UVAttribute);\r\n\t\t//uv action is processed after normal actions,so use offsetTarget as uvTarget\r\n\t\tthis.uvTarget = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index);\r\n\t}\r\n\r\n\tpublic setRegisterIndex(node:AnimationNodeBase, parameterIndex:number /*int*/, registerIndex:number /*int*/)\r\n\t{\r\n\t\t//8 should be enough for any node.\r\n\t\tvar t:Array<number> /*int*/ = this.indexDictionary[node.id];\r\n\r\n\t\tif (t == null)\r\n\t\t\tt = this.indexDictionary[node.id] = new Array<number>(8) /*int*/;\r\n\r\n\t\tt[parameterIndex] = registerIndex;\r\n\t}\r\n\r\n\tpublic getRegisterIndex(node:AnimationNodeBase, parameterIndex:number /*int*/):number /*int*/\r\n\t{\r\n\t\treturn (<Array<number>> this.indexDictionary[node.id])[parameterIndex];\r\n\t}\r\n\r\n\tpublic getInitCode():string\r\n\t{\r\n\t\tvar len:number /*int*/ = this.sourceRegisters.length;\r\n\t\tvar code:string = \"\";\r\n\t\tfor (var i:number /*int*/ = 0; i < len; i++)\r\n\t\t\tcode += \"mov \" + this.targetRegisters[i] + \",\" + this.sourceRegisters[i] + \"\\n\";\r\n\r\n\t\tcode += \"mov \" + this.positionTarget + \".xyz,\" + this.vertexZeroConst.toString() + \"\\n\";\r\n\r\n\t\tif (this.needVelocity)\r\n\t\t\tcode += \"mov \" + this.velocityTarget + \".xyz,\" + this.vertexZeroConst.toString() + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic getCombinationCode():string\r\n\t{\r\n\t\treturn \"add \" + this.scaleAndRotateTarget + \".xyz,\" + this.scaleAndRotateTarget + \".xyz,\" + this.positionTarget + \".xyz\\n\";\r\n\t}\r\n\r\n\tpublic initColorRegisters():string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.hasColorMulNode) {\r\n\t\t\tthis.colorMulTarget = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(this.colorMulTarget, 1);\r\n\t\t\tthis.colorMulVary = this.getFreeVarying();\r\n\t\t\tcode += \"mov \" + this.colorMulTarget + \",\" + this.vertexOneConst + \"\\n\";\r\n\t\t}\r\n\t\tif (this.hasColorAddNode) {\r\n\t\t\tthis.colorAddTarget = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(this.colorAddTarget, 1);\r\n\t\t\tthis.colorAddVary = this.getFreeVarying();\r\n\t\t\tcode += \"mov \" + this.colorAddTarget + \",\" + this.vertexZeroConst + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic getColorPassCode():string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.needFragmentAnimation && (this.hasColorAddNode || this.hasColorMulNode)) {\r\n\t\t\tif (this.hasColorMulNode)\r\n\t\t\t\tcode += \"mov \" + this.colorMulVary + \",\" + this.colorMulTarget + \"\\n\";\r\n\t\t\tif (this.hasColorAddNode)\r\n\t\t\t\tcode += \"mov \" + this.colorAddVary + \",\" + this.colorAddTarget + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic getColorCombinationCode(shadedTarget:string):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.needFragmentAnimation && (this.hasColorAddNode || this.hasColorMulNode)) {\r\n\t\t\tvar colorTarget:ShaderRegisterElement = this.getRegisterFromString(shadedTarget);\r\n\t\t\tthis.addFragmentTempUsages(colorTarget, 1);\r\n\t\t\tif (this.hasColorMulNode)\r\n\t\t\t\tcode += \"mul \" + colorTarget + \",\" + colorTarget + \",\" + this.colorMulVary + \"\\n\";\r\n\t\t\tif (this.hasColorAddNode)\r\n\t\t\t\tcode += \"add \" + colorTarget + \",\" + colorTarget + \",\" + this.colorAddVary + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\tprivate getRegisterFromString(code:string):ShaderRegisterElement\r\n\t{\r\n\t\tvar temp:Array<string> = code.split(/(\\d+)/);\r\n\t\treturn new ShaderRegisterElement(temp[0], parseInt(temp[1]));\r\n\t}\r\n\r\n\tpublic vertexConstantData:Float32Array;\r\n\tpublic fragmentConstantData:Float32Array;\r\n\r\n\tprivate _numVertexConstant:number /*int*/;\r\n\tprivate _numFragmentConstant:number /*int*/;\r\n\r\n\tpublic get numVertexConstant():number /*int*/\r\n\t{\r\n\t\treturn this._numVertexConstant;\r\n\t}\r\n\r\n\tpublic get numFragmentConstant():number /*int*/\r\n\t{\r\n\t\treturn this._numFragmentConstant;\r\n\t}\r\n\r\n\tpublic setDataLength()\r\n\t{\r\n\t\tthis._numVertexConstant = this.numUsedVertexConstants - this.vertexConstantOffset;\r\n\t\tthis._numFragmentConstant = this.numUsedFragmentConstants - this.fragmentConstantOffset;\r\n\t\tthis.vertexConstantData = new Float32Array(this._numVertexConstant*4);\r\n\t\tthis.fragmentConstantData = new Float32Array(this._numFragmentConstant*4);\r\n\t}\r\n\r\n\tpublic setVertexConst(index:number /*int*/, x:number = 0, y:number = 0, z:number = 0, w:number = 0)\r\n\t{\r\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\r\n\t\tthis.vertexConstantData[_index++] = x;\r\n\t\tthis.vertexConstantData[_index++] = y;\r\n\t\tthis.vertexConstantData[_index++] = z;\r\n\t\tthis.vertexConstantData[_index] = w;\r\n\t}\r\n\r\n\tpublic setVertexConstFromArray(index:number /*int*/, data:Array<number>)\r\n\t{\r\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\r\n\t\tfor (var i:number /*int*/ = 0; i < data.length; i++)\r\n\t\t\tthis.vertexConstantData[_index++] = data[i];\r\n\t}\r\n\r\n\tpublic setVertexConstFromMatrix(index:number /*int*/, matrix:Matrix3D)\r\n\t{\r\n\t\tvar rawData:Float32Array = matrix.rawData;\r\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\r\n\t\tthis.vertexConstantData[_index++] = rawData[0];\r\n\t\tthis.vertexConstantData[_index++] = rawData[4];\r\n\t\tthis.vertexConstantData[_index++] = rawData[8];\r\n\t\tthis.vertexConstantData[_index++] = rawData[12];\r\n\t\tthis.vertexConstantData[_index++] = rawData[1];\r\n\t\tthis.vertexConstantData[_index++] = rawData[5];\r\n\t\tthis.vertexConstantData[_index++] = rawData[9];\r\n\t\tthis.vertexConstantData[_index++] = rawData[13];\r\n\t\tthis.vertexConstantData[_index++] = rawData[2];\r\n\t\tthis.vertexConstantData[_index++] = rawData[6];\r\n\t\tthis.vertexConstantData[_index++] = rawData[10];\r\n\t\tthis.vertexConstantData[_index++] = rawData[14];\r\n\t\tthis.vertexConstantData[_index++] = rawData[3];\r\n\t\tthis.vertexConstantData[_index++] = rawData[7];\r\n\t\tthis.vertexConstantData[_index++] = rawData[11];\r\n\t\tthis.vertexConstantData[_index] = rawData[15];\r\n\r\n\t}\r\n\r\n\tpublic setFragmentConst(index:number /*int*/, x:number = 0, y:number = 0, z:number = 0, w:number = 0)\r\n\t{\r\n\t\tvar _index:number /*int*/ = (index - this.fragmentConstantOffset)*4;\r\n\t\tthis.fragmentConstantData[_index++] = x;\r\n\t\tthis.fragmentConstantData[_index++] = y;\r\n\t\tthis.fragmentConstantData[_index++] = z;\r\n\t\tthis.fragmentConstantData[_index] = w;\r\n\t}\r\n}\r\n\r\nexport = AnimationRegisterCache;",
    "import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IVertexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\r\n\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass AnimationSubGeometry\r\n{\r\n\tpublic static SUBGEOM_ID_COUNT:number = 0;\r\n\r\n\tpublic _pVertexData:Array<number>;\r\n\r\n\tpublic _pVertexBuffer:Array<IVertexBuffer> = new Array<IVertexBuffer>(8);\r\n\tpublic _pBufferContext:Array<IContextGL> = new Array<IContextGL>(8);\r\n\tpublic _pBufferDirty:Array<boolean> = new Array<boolean>(8);\r\n\r\n\tprivate _numVertices:number /*uint*/;\r\n\r\n\tprivate _totalLenOfOneVertex:number /*uint*/;\r\n\r\n\tpublic numProcessedVertices:number /*int*/ = 0;\r\n\r\n\tpublic previousTime:number = Number.NEGATIVE_INFINITY;\r\n\r\n\tpublic animationParticles:Array<ParticleAnimationData> = new Array<ParticleAnimationData>();\r\n\r\n\t/**\r\n\t * An id for this animation subgeometry, used to identify animation subgeometries when using animation sets.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iUniqueId:number;//Arcane\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tfor (var i:number /*int*/ = 0; i < 8; i++)\r\n\t\t\tthis._pBufferDirty[i] = true;\r\n\r\n\t\tthis._iUniqueId = AnimationSubGeometry.SUBGEOM_ID_COUNT++;\r\n\t}\r\n\r\n\tpublic createVertexData(numVertices:number /*uint*/, totalLenOfOneVertex:number /*uint*/)\r\n\t{\r\n\t\tthis._numVertices = numVertices;\r\n\t\tthis._totalLenOfOneVertex = totalLenOfOneVertex;\r\n\t\tthis._pVertexData = new Array<number>(numVertices*totalLenOfOneVertex);\r\n\t}\r\n\r\n\tpublic activateVertexBuffer(index:number /*int*/, bufferOffset:number /*int*/, stage:Stage, format:number)\r\n\t{\r\n\t\tvar contextIndex:number /*int*/ = stage.stageIndex;\r\n\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n\r\n\t\tvar buffer:IVertexBuffer = this._pVertexBuffer[contextIndex];\r\n\t\tif (!buffer || this._pBufferContext[contextIndex] != context) {\r\n\t\t\tbuffer = this._pVertexBuffer[contextIndex] = context.createVertexBuffer(this._numVertices, this._totalLenOfOneVertex*4);\r\n\t\t\tthis._pBufferContext[contextIndex] = context;\r\n\t\t\tthis._pBufferDirty[contextIndex] = true;\r\n\t\t}\r\n\t\tif (this._pBufferDirty[contextIndex]) {\r\n\t\t\tbuffer.uploadFromArray(this._pVertexData, 0, this._numVertices);\r\n\t\t\tthis._pBufferDirty[contextIndex] = false;\r\n\t\t}\r\n\t\tcontext.setVertexBufferAt(index, buffer, bufferOffset*4, format);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\twhile (this._pVertexBuffer.length) {\r\n\t\t\tvar vertexBuffer:IVertexBuffer = this._pVertexBuffer.pop()\r\n\r\n\t\t\tif (vertexBuffer)\r\n\t\t\t\tvertexBuffer.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic invalidateBuffer()\r\n\t{\r\n\t\tfor (var i:number /*int*/ = 0; i < 8; i++)\r\n\t\t\tthis._pBufferDirty[i] = true;\r\n\t}\r\n\r\n\tpublic get vertexData():Array<number>\r\n\t{\r\n\t\treturn this._pVertexData;\r\n\t}\r\n\r\n\tpublic get numVertices():number /*uint*/\r\n\t{\r\n\t\treturn this._numVertices;\r\n\t}\r\n\r\n\tpublic get totalLenOfOneVertex():number /*uint*/\r\n\t{\r\n\t\treturn this._totalLenOfOneVertex;\r\n\t}\r\n}\r\n\r\nexport = AnimationSubGeometry;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\n\r\nclass ColorSegmentPoint\r\n{\r\n\tprivate _color:ColorTransform;\r\n\tprivate _life:number;\r\n\r\n\tconstructor(life:number, color:ColorTransform)\r\n\t{\r\n\t\t//0<life<1\r\n\t\tif (life <= 0 || life >= 1)\r\n\t\t\tthrow(new Error(\"life exceeds range (0,1)\"));\r\n\t\tthis._life = life;\r\n\t\tthis._color = color;\r\n\t}\r\n\r\n\tpublic get color():ColorTransform\r\n\t{\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tpublic get life():number\r\n\t{\r\n\t\treturn this._life;\r\n\t}\r\n\r\n}\r\n\r\nexport = ColorSegmentPoint;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\n/**\r\n * Contains transformation data for a skeleton joint, used for skeleton animation.\r\n *\r\n * @see away.animation.Skeleton\r\n * @see away.animation.SkeletonJoint\r\n *\r\n * todo: support (uniform) scale\r\n */\r\nclass JointPose\r\n{\r\n\t/**\r\n\t * The name of the joint to which the pose is associated\r\n\t */\r\n\tpublic name:string; // intention is that this should be used only at load time, not in the main loop\r\n\r\n\t/**\r\n\t * The rotation of the pose stored as a quaternion\r\n\t */\r\n\tpublic orientation:Quaternion = new Quaternion();\r\n\r\n\t/**\r\n\t * The translation of the pose\r\n\t */\r\n\tpublic translation:Vector3D = new Vector3D();\r\n\r\n\tconstructor()\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the transformation to a Matrix3D representation.\r\n\t *\r\n\t * @param target An optional target matrix to store the transformation. If not provided, it will create a new instance.\r\n\t * @return The transformation matrix of the pose.\r\n\t */\r\n\tpublic toMatrix3D(target:Matrix3D = null):Matrix3D\r\n\t{\r\n\t\tif (target == null)\r\n\t\t\ttarget = new Matrix3D();\r\n\r\n\t\tthis.orientation.toMatrix3D(target);\r\n\t\ttarget.appendTranslation(this.translation.x, this.translation.y, this.translation.z);\r\n\t\treturn target;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies the transformation data from a source pose object into the existing pose object.\r\n\t *\r\n\t * @param pose The source pose to copy from.\r\n\t */\r\n\tpublic copyFrom(pose:JointPose)\r\n\t{\r\n\t\tvar or:Quaternion = pose.orientation;\r\n\t\tvar tr:Vector3D = pose.translation;\r\n\t\tthis.orientation.x = or.x;\r\n\t\tthis.orientation.y = or.y;\r\n\t\tthis.orientation.z = or.z;\r\n\t\tthis.orientation.w = or.w;\r\n\t\tthis.translation.x = tr.x;\r\n\t\tthis.translation.y = tr.y;\r\n\t\tthis.translation.z = tr.z;\r\n\t}\r\n}\r\n\r\nexport = JointPose;",
    "import ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleAnimationData\r\n{\r\n\tpublic index:number /*uint*/;\r\n\tpublic startTime:number;\r\n\tpublic totalTime:number;\r\n\tpublic duration:number;\r\n\tpublic delay:number;\r\n\tpublic startVertexIndex:number /*uint*/;\r\n\tpublic numVertices:number /*uint*/;\r\n\r\n\tconstructor(index:number /*uint*/, startTime:number, duration:number, delay:number, particle:ParticleData)\r\n\t{\r\n\t\tthis.index = index;\r\n\t\tthis.startTime = startTime;\r\n\t\tthis.totalTime = duration + delay;\r\n\t\tthis.duration = duration;\r\n\t\tthis.delay = delay;\r\n\t\tthis.startVertexIndex = particle.startVertexIndex;\r\n\t\tthis.numVertices = particle.numVertices;\r\n\t}\r\n}\r\n\r\nexport = ParticleAnimationData;",
    "import TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\n\r\nclass ParticleData\r\n{\r\n\tpublic particleIndex:number /*uint*/;\r\n\tpublic numVertices:number /*uint*/;\r\n\tpublic startVertexIndex:number /*uint*/;\r\n\tpublic subGeometry:TriangleSubGeometry;\r\n}\r\n\r\nexport = ParticleData",
    "/**\r\n * Options for setting the properties mode of a particle animation node.\r\n */\r\nclass ParticlePropertiesMode\r\n{\r\n\t/**\r\n\t * Mode that defines the particle node as acting on global properties (ie. the properties set in the node constructor or the corresponding animation state).\r\n\t */\r\n\tpublic static GLOBAL:number /*uint*/ = 0;\r\n\r\n\t/**\r\n\t * Mode that defines the particle node as acting on local static properties (ie. the properties of particles set in the initialising on the animation set).\r\n\t */\r\n\tpublic static LOCAL_STATIC:number /*uint*/ = 1;\r\n\r\n\t/**\r\n\t * Mode that defines the particle node as acting on local dynamic properties (ie. the properties of the particles set in the corresponding animation state).\r\n\t */\r\n\tpublic static LOCAL_DYNAMIC:number /*uint*/ = 2;\r\n}\r\n\r\nexport = ParticlePropertiesMode;",
    "/**\r\n * Dynamic class for holding the local properties of a particle, used for processing the static properties\r\n * of particles in the particle animation set before beginning upload to the GPU.\r\n */\r\nclass ParticleProperties\r\n{\r\n\t/**\r\n\t * The index of the current particle being set.\r\n\t */\r\n\tpublic index:number /*uint*/;\r\n\r\n\t/**\r\n\t * The total number of particles being processed by the particle animation set.\r\n\t */\r\n\tpublic total:number /*uint*/;\r\n\r\n\t/**\r\n\t * The start time of the particle.\r\n\t */\r\n\tpublic startTime:number;\r\n\r\n\t/**\r\n\t * The duration of the particle, an optional value used when the particle aniamtion set settings for <code>useDuration</code> are enabled in the constructor.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t */\r\n\tpublic duration:number;\r\n\r\n\t/**\r\n\t * The delay between cycles of the particle, an optional value used when the particle aniamtion set settings for <code>useLooping</code> and  <code>useDelay</code> are enabled in the constructor.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t */\r\n\tpublic delay:number;\r\n}\r\n\r\nexport = ParticleProperties;",
    "/**\r\n * A value obect representing a single joint in a skeleton object.\r\n *\r\n * @see away.animators.Skeleton\r\n */\r\nclass SkeletonJoint\r\n{\r\n\t/**\r\n\t * The index of the parent joint in the skeleton's joints vector.\r\n\t *\r\n\t * @see away.animators.Skeleton#joints\r\n\t */\r\n\tpublic parentIndex:number /*int*/ = -1;\r\n\r\n\t/**\r\n\t * The name of the joint\r\n\t */\r\n\tpublic name:string; // intention is that this should be used only at load time, not in the main loop\r\n\r\n\t/**\r\n\t * The inverse bind pose matrix, as raw data, used to transform vertices to bind joint space in preparation for transformation using the joint matrix.\r\n\t */\r\n\tpublic inverseBindPose:Float32Array;\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonJoint</code> object\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t}\r\n}\r\n\r\nexport = SkeletonJoint;",
    "import IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AssetBase\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetBase\");\r\n\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\n\r\n\r\n/**\r\n * A collection of pose objects, determining the pose for an entire skeleton.\r\n * The <code>jointPoses</code> vector object corresponds to a skeleton's <code>joints</code> vector object, however, there is no\r\n * reference to a skeleton's instance, since several skeletons can be influenced by the same pose (eg: animation\r\n * clips are added to any animator with a valid skeleton)\r\n *\r\n * @see away.animators.Skeleton\r\n * @see away.animators.JointPose\r\n */\r\nclass SkeletonPose extends AssetBase implements IAsset\r\n{\r\n\tpublic static assetType:string = \"[asset SkeletonPose]\";\r\n\r\n\t/**\r\n\t * A flat list of pose objects that comprise the skeleton pose. The pose indices correspond to the target skeleton's joint indices.\r\n\t *\r\n\t * @see away.animators.Skeleton#joints\r\n\t */\r\n\tpublic jointPoses:Array<JointPose>;\r\n\r\n\t/**\r\n\t * The total number of joint poses in the skeleton pose.\r\n\t */\r\n\tpublic get numJointPoses():number /*uint*/\r\n\t{\r\n\t\treturn this.jointPoses.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonPose</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.jointPoses = new Array<JointPose>();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn SkeletonPose.assetType;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the joint pose object with the given joint name, otherwise returns a null object.\r\n\t *\r\n\t * @param jointName The name of the joint object whose pose is to be found.\r\n\t * @return The pose object with the given joint name.\r\n\t */\r\n\tpublic jointPoseFromName(jointName:string):JointPose\r\n\t{\r\n\t\tvar jointPoseIndex:number /*int*/ = this.jointPoseIndexFromName(jointName);\r\n\t\tif (jointPoseIndex != -1)\r\n\t\t\treturn this.jointPoses[jointPoseIndex]; else\r\n\t\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the pose index, given the joint name. -1 is returned if the joint name is not found in the pose.\r\n\t *\r\n\t * @param The name of the joint object whose pose is to be found.\r\n\t * @return The index of the pose object in the jointPoses Array\r\n\t *\r\n\t * @see #jointPoses\r\n\t */\r\n\tpublic jointPoseIndexFromName(jointName:string):number /*int*/\r\n\t{\r\n\t\t// this is implemented as a linear search, rather than a possibly\r\n\t\t// more optimal method (Dictionary lookup, for example) because:\r\n\t\t// a) it is assumed that it will be called once for each joint\r\n\t\t// b) it is assumed that it will be called only during load, and not during main loop\r\n\t\t// c) maintaining a dictionary (for safety) would dictate an interface to access JointPoses,\r\n\t\t//    rather than direct array access.  this would be sub-optimal.\r\n\t\tvar jointPoseIndex:number /*int*/;\r\n\t\tvar jointPose:JointPose;\r\n\t\tfor (var i:number /*uint*/; i < this.jointPoses.length; i++) {\r\n\t\t\tjointPose = this.jointPoses[i];\r\n\t\t\tif (jointPose.name == jointName)\r\n\t\t\t\treturn jointPoseIndex;\r\n\t\t\tjointPoseIndex++;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a copy of the <code>SkeletonPose</code> object, with a dulpicate of its component joint poses.\r\n\t *\r\n\t * @return SkeletonPose\r\n\t */\r\n\tpublic clone():SkeletonPose\r\n\t{\r\n\t\tvar clone:SkeletonPose = new SkeletonPose();\r\n\t\tvar numJointPoses:number /*uint*/ = this.jointPoses.length;\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJointPoses; i++) {\r\n\t\t\tvar cloneJointPose:JointPose = new JointPose();\r\n\t\t\tvar thisJointPose:JointPose = this.jointPoses[i];\r\n\t\t\tcloneJointPose.name = thisJointPose.name;\r\n\t\t\tcloneJointPose.copyFrom(thisJointPose);\r\n\t\t\tclone.jointPoses[i] = cloneJointPose;\r\n\t\t}\r\n\t\treturn clone;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis.jointPoses.length = 0;\r\n\t}\r\n}\r\n\r\nexport = SkeletonPose;",
    "import SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\n\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AssetBase\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetBase\");\r\n\r\n/**\r\n * A Skeleton object is a hierarchical grouping of joint objects that can be used for skeletal animation.\r\n *\r\n * @see away.animators.SkeletonJoint\r\n */\r\nclass Skeleton extends AssetBase implements IAsset\r\n{\r\n\tpublic static assetType:string = \"[asset Skeleton]\";\r\n\r\n\t/**\r\n\t * A flat list of joint objects that comprise the skeleton. Every joint except for the root has a parentIndex\r\n\t * property that is an index into this list.\r\n\t * A child joint should always have a higher index than its parent.\r\n\t */\r\n\tpublic joints:Array<SkeletonJoint>;\r\n\r\n\t/**\r\n\t * The total number of joints in the skeleton.\r\n\t */\r\n\tpublic get numJoints():number /*uint*/\r\n\t{\r\n\t\treturn this.joints.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>Skeleton</code> object\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\t// in the long run, it might be a better idea to not store Joint objects, but keep all data in Vectors, that we can upload easily?\r\n\t\tthis.joints = new Array<SkeletonJoint>();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the joint object in the skeleton with the given name, otherwise returns a null object.\r\n\t *\r\n\t * @param jointName The name of the joint object to be found.\r\n\t * @return The joint object with the given name.\r\n\t *\r\n\t * @see #joints\r\n\t */\r\n\tpublic jointFromName(jointName:string):SkeletonJoint\r\n\t{\r\n\t\tvar jointIndex:number /*int*/ = this.jointIndexFromName(jointName);\r\n\t\tif (jointIndex != -1)\r\n\t\t\treturn this.joints[jointIndex]; else\r\n\t\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the joint index, given the joint name. -1 is returned if the joint name is not found.\r\n\t *\r\n\t * @param jointName The name of the joint object to be found.\r\n\t * @return The index of the joint object in the joints Array\r\n\t *\r\n\t * @see #joints\r\n\t */\r\n\tpublic jointIndexFromName(jointName:string):number /*int*/\r\n\t{\r\n\t\t// this is implemented as a linear search, rather than a possibly\r\n\t\t// more optimal method (Dictionary lookup, for example) because:\r\n\t\t// a) it is assumed that it will be called once for each joint\r\n\t\t// b) it is assumed that it will be called only during load, and not during main loop\r\n\t\t// c) maintaining a dictionary (for safety) would dictate an interface to access SkeletonJoints,\r\n\t\t//    rather than direct array access.  this would be sub-optimal.\r\n\t\tvar jointIndex:number /*int*/;\r\n\t\tvar joint:SkeletonJoint;\r\n\t\tfor (var i:number /*int*/; i < this.joints.length; i++) {\r\n\t\t\tjoint = this.joints[i];\r\n\t\t\tif (joint.name == jointName)\r\n\t\t\t\treturn jointIndex;\r\n\t\t\tjointIndex++;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis.joints.length = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn Skeleton.assetType;\r\n\t}\r\n}\r\n\r\nexport = Skeleton;",
    "/**\r\n * Options for setting the animation mode of a vertex animator object.\r\n *\r\n * @see away.animators.VertexAnimator\r\n */\r\nclass VertexAnimationMode\r\n{\r\n\t/**\r\n\t * Animation mode that adds all outputs from active vertex animation state to form the current vertex animation pose.\r\n\t */\r\n\tpublic static ADDITIVE:string = \"additive\";\r\n\r\n\t/**\r\n\t * Animation mode that picks the output from a single vertex animation state to form the current vertex animation pose.\r\n\t */\r\n\tpublic static ABSOLUTE:string = \"absolute\";\r\n}\r\n\r\nexport = VertexAnimationMode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\n/**\r\n * Provides an abstract base class for nodes with time-based animation data in an animation blend tree.\r\n */\r\nclass AnimationClipNodeBase extends AnimationNodeBase\r\n{\r\n\tpublic _pLooping:boolean = true;\r\n\tpublic _pTotalDuration:number /*uint*/ = 0;\r\n\tpublic _pLastFrame:number /*uint*/;\r\n\r\n\tpublic _pStitchDirty:boolean = true;\r\n\tpublic _pStitchFinalFrame:boolean = false;\r\n\tpublic _pNumFrames:number /*uint*/ = 0;\r\n\r\n\tpublic _pDurations:Array<number> = new Array<number>();\r\n\t/*uint*/\r\n\tpublic _pTotalDelta:Vector3D = new Vector3D();\r\n\r\n\tpublic fixedFrameRate:boolean = true;\r\n\r\n\t/**\r\n\t * Determines whether the contents of the animation node have looping characteristics enabled.\r\n\t */\r\n\tpublic get looping():boolean\r\n\t{\r\n\t\treturn this._pLooping;\r\n\t}\r\n\r\n\tpublic set looping(value:boolean)\r\n\t{\r\n\t\tif (this._pLooping == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pLooping = value;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines if looping content blends the final frame of animation data with the first (true) or works on the\r\n\t * assumption that both first and last frames are identical (false). Defaults to false.\r\n\t */\r\n\tpublic get stitchFinalFrame():boolean\r\n\t{\r\n\t\treturn this._pStitchFinalFrame;\r\n\t}\r\n\r\n\tpublic set stitchFinalFrame(value:boolean)\r\n\t{\r\n\t\tif (this._pStitchFinalFrame == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pStitchFinalFrame = value;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\tpublic get totalDuration():number /*uint*/\r\n\t{\r\n\t\tif (this._pStitchDirty)\r\n\t\t\tthis._pUpdateStitch();\r\n\r\n\t\treturn this._pTotalDuration;\r\n\t}\r\n\r\n\tpublic get totalDelta():Vector3D\r\n\t{\r\n\t\tif (this._pStitchDirty)\r\n\t\t\tthis._pUpdateStitch();\r\n\r\n\t\treturn this._pTotalDelta;\r\n\t}\r\n\r\n\tpublic get lastFrame():number /*uint*/\r\n\t{\r\n\t\tif (this._pStitchDirty)\r\n\t\t\tthis._pUpdateStitch();\r\n\r\n\t\treturn this._pLastFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of time values representing the duration (in milliseconds) of each animation frame in the clip.\r\n\t */\r\n\tpublic get durations():Array<number> /*uint*/\r\n\t{\r\n\t\treturn this._pDurations;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>AnimationClipNodeBase</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the node's final frame stitch state.\r\n\t *\r\n\t * @see #stitchFinalFrame\r\n\t */\r\n\tpublic _pUpdateStitch()\r\n\t{\r\n\t\tthis._pStitchDirty = false;\r\n\r\n\t\tthis._pLastFrame = (this._pStitchFinalFrame)? this._pNumFrames : this._pNumFrames - 1;\r\n\r\n\t\tthis._pTotalDuration = 0;\r\n\t\tthis._pTotalDelta.x = 0;\r\n\t\tthis._pTotalDelta.y = 0;\r\n\t\tthis._pTotalDelta.z = 0;\r\n\t}\r\n}\r\n\r\nexport = AnimationClipNodeBase;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleAccelerationState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleAccelerationState\");\r\n\r\n/**\r\n * A particle animation node used to apply a constant acceleration vector to the motion of a particle.\r\n */\r\nclass ParticleAccelerationNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _acceleration:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for acceleration node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the direction of acceleration on the particle.\r\n\t */\r\n\tpublic static ACCELERATION_VECTOR3D:string = \"AccelerationVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleAccelerationNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] acceleration    Defines the default acceleration vector of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, acceleration:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleAcceleration\", mode, 3);\r\n\r\n\t\tthis._pStateClass = ParticleAccelerationState;\r\n\r\n\t\tthis._acceleration = acceleration || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic pGetAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar accelerationValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleAccelerationState.ACCELERATION_INDEX, accelerationValue.index);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\r\n\t\tvar code:string = \"mul \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + accelerationValue + \"\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"mul \" + temp2 + \",\" + temp + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + temp2 + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t}\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tcode += \"mul \" + temp + \",\" + temp + \",\" + animationRegisterCache.vertexTime + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + temp + \",\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleAccelerationState\r\n\t{\r\n\t\treturn <ParticleAccelerationState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar tempAcceleration:Vector3D = param[ParticleAccelerationNode.ACCELERATION_VECTOR3D];\r\n\t\tif (!tempAcceleration)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleAccelerationNode.ACCELERATION_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = tempAcceleration.x/2;\r\n\t\tthis._pOneData[1] = tempAcceleration.y/2;\r\n\t\tthis._pOneData[2] = tempAcceleration.z/2;\r\n\t}\r\n}\r\n\r\nexport = ParticleAccelerationNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleBezierCurveState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState\");\r\n\r\n/**\r\n * A particle animation node used to control the position of a particle over time along a bezier curve.\r\n */\r\nclass ParticleBezierCurveNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iControlPoint:Vector3D;\r\n\t/** @private */\r\n\tpublic _iEndPoint:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for bezier curve node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the control point position (0, 1, 2) of the curve.\r\n\t */\r\n\tpublic static BEZIER_CONTROL_VECTOR3D:string = \"BezierControlVector3D\";\r\n\r\n\t/**\r\n\t * Reference for bezier curve node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the end point position (0, 1, 2) of the curve.\r\n\t */\r\n\tpublic static BEZIER_END_VECTOR3D:string = \"BezierEndVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleBezierCurveNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] controlPoint    Defines the default control point of the node, used when in global mode.\r\n\t * @param    [optional] endPoint        Defines the default end point of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, controlPoint:Vector3D = null, endPoint:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleBezierCurve\", mode, 6);\r\n\r\n\t\tthis._pStateClass = ParticleBezierCurveState;\r\n\r\n\t\tthis._iControlPoint = controlPoint || new Vector3D();\r\n\t\tthis._iEndPoint = endPoint || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar controlValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBezierCurveState.BEZIER_CONTROL_INDEX, controlValue.index);\r\n\r\n\t\tvar endValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBezierCurveState.BEZIER_END_INDEX, endValue.index);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar rev_time:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\tvar time_2:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\tvar time_temp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"sub \" + rev_time + \",\" + animationRegisterCache.vertexOneConst + \",\" + animationRegisterCache.vertexLife + \"\\n\";\r\n\t\tcode += \"mul \" + time_2 + \",\" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexLife + \"\\n\";\r\n\r\n\t\tcode += \"mul \" + time_temp + \",\" + animationRegisterCache.vertexLife + \",\" + rev_time + \"\\n\";\r\n\t\tcode += \"mul \" + time_temp + \",\" + time_temp + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\tcode += \"mul \" + distance + \".xyz,\" + time_temp + \",\" + controlValue + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\tcode += \"mul \" + distance + \".xyz,\" + time_2 + \",\" + endValue + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tcode += \"mul \" + time_2 + \",\" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"sub \" + time_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + time_2 + \"\\n\";\r\n\t\t\tcode += \"mul \" + time_temp + \",\" + animationRegisterCache.vertexTwoConst + \",\" + time_temp + \"\\n\";\r\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + controlValue + \",\" + time_temp + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + endValue + \",\" + time_2 + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleBezierCurveState\r\n\t{\r\n\t\treturn <ParticleBezierCurveState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar bezierControl:Vector3D = param[ParticleBezierCurveNode.BEZIER_CONTROL_VECTOR3D];\r\n\t\tif (!bezierControl)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleBezierCurveNode.BEZIER_CONTROL_VECTOR3D + \" in param!\");\r\n\r\n\t\tvar bezierEnd:Vector3D = param[ParticleBezierCurveNode.BEZIER_END_VECTOR3D];\r\n\t\tif (!bezierEnd)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleBezierCurveNode.BEZIER_END_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = bezierControl.x;\r\n\t\tthis._pOneData[1] = bezierControl.y;\r\n\t\tthis._pOneData[2] = bezierControl.z;\r\n\t\tthis._pOneData[3] = bezierEnd.x;\r\n\t\tthis._pOneData[4] = bezierEnd.y;\r\n\t\tthis._pOneData[5] = bezierEnd.z;\r\n\t}\r\n}\r\n\r\nexport = ParticleBezierCurveNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleBillboardState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleBillboardState\");\r\n\r\n/**\r\n * A particle animation node that controls the rotation of a particle to always face the camera.\r\n */\r\nclass ParticleBillboardNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iBillboardAxis:Vector3D;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleBillboardNode</code>\r\n\t */\r\n\tconstructor(billboardAxis:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleBillboard\", ParticlePropertiesMode.GLOBAL, 0, 4);\r\n\r\n\t\tthis._pStateClass = ParticleBillboardState;\r\n\r\n\t\tthis._iBillboardAxis = billboardAxis;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBillboardState.MATRIX_INDEX, rotationMatrixRegister.index);\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\tvar code:string = \"m33 \" + temp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \",\" + rotationMatrixRegister + \"\\n\" +\r\n\t\t\t\t\t\t  \"mov \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\r\n\r\n\t\tvar shaderRegisterElement:ShaderRegisterElement;\r\n\t\tfor (var i:number /*uint*/ = 0; i < animationRegisterCache.rotationRegisters.length; i++) {\r\n\t\t\tshaderRegisterElement = animationRegisterCache.rotationRegisters[i];\r\n\t\t\tcode += \"m33 \" + temp + \".xyz,\" + shaderRegisterElement + \",\" + rotationMatrixRegister + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + shaderRegisterElement + \".xyz,\" + shaderRegisterElement + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleBillboardState\r\n\t{\r\n\t\treturn <ParticleBillboardState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.hasBillboard = true;\r\n\t}\r\n}\r\n\r\nexport = ParticleBillboardNode;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleColorState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleColorState\");\r\n\r\n/**\r\n * A particle animation node used to control the color variation of a particle over time.\r\n */\r\nclass ParticleColorNode extends ParticleNodeBase\r\n{\r\n\t//default values used when creating states\r\n\t/** @private */\r\n\tpublic _iUsesMultiplier:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesOffset:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\t/** @private */\r\n\tpublic _iStartColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iEndColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\r\n\t/**\r\n\t * Reference for color node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>ColorTransform</code> object representing the start color transform applied to the particle.\r\n\t */\r\n\tpublic static COLOR_START_COLORTRANSFORM:string = \"ColorStartColorTransform\";\r\n\r\n\t/**\r\n\t * Reference for color node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>ColorTransform</code> object representing the end color transform applied to the particle.\r\n\t */\r\n\tpublic static COLOR_END_COLORTRANSFORM:string = \"ColorEndColorTransform\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleColorNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] usesMultiplier  Defines whether the node uses multiplier data in the shader for its color transformations. Defaults to true.\r\n\t * @param    [optional] usesOffset      Defines whether the node uses offset data in the shader for its color transformations. Defaults to true.\r\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of the animation independent of particle duration. Defaults to false.\r\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the cycle rotation of the particle. Defaults to false.\r\n\t * @param    [optional] startColor      Defines the default start color transform of the node, when in global mode.\r\n\t * @param    [optional] endColor        Defines the default end color transform of the node, when in global mode.\r\n\t * @param    [optional] cycleDuration   Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesMultiplier:boolean = true, usesOffset:boolean = true, usesCycle:boolean = false, usesPhase:boolean = false, startColor:ColorTransform = null, endColor:ColorTransform = null, cycleDuration:number = 1, cyclePhase:number = 0)\r\n\t{\r\n\t\tsuper(\"ParticleColor\", mode, (usesMultiplier && usesOffset)? 16 : 8, ParticleAnimationSet.COLOR_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleColorState;\r\n\r\n\t\tthis._iUsesMultiplier = usesMultiplier;\r\n\t\tthis._iUsesOffset = usesOffset;\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iStartColor = startColor || new ColorTransform();\r\n\t\tthis._iEndColor = endColor || new ColorTransform();\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tif (this._iUsesCycle) {\r\n\t\t\t\tvar cycleConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.CYCLE_INDEX, cycleConst.index);\r\n\r\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\t\t\tvar sin:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\t\t\tcode += \"mul \" + sin + \",\" + animationRegisterCache.vertexTime + \",\" + cycleConst + \".x\\n\";\r\n\r\n\t\t\t\tif (this._iUsesPhase)\r\n\t\t\t\t\tcode += \"add \" + sin + \",\" + sin + \",\" + cycleConst + \".y\\n\";\r\n\r\n\t\t\t\tcode += \"sin \" + sin + \",\" + sin + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tvar startMultiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\t\tvar deltaMultiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.START_MULTIPLIER_INDEX, startMultiplierValue.index);\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.DELTA_MULTIPLIER_INDEX, deltaMultiplierValue.index);\r\n\r\n\t\t\t\tcode += \"mul \" + temp + \",\" + deltaMultiplierValue + \",\" + (this._iUsesCycle? sin : animationRegisterCache.vertexLife) + \"\\n\";\r\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + startMultiplierValue + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + temp + \",\" + animationRegisterCache.colorMulTarget + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tvar startOffsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tvar deltaOffsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.START_OFFSET_INDEX, startOffsetValue.index);\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.DELTA_OFFSET_INDEX, deltaOffsetValue.index);\r\n\r\n\t\t\t\tcode += \"mul \" + temp + \",\" + deltaOffsetValue + \",\" + (this._iUsesCycle? sin : animationRegisterCache.vertexLife) + \"\\n\";\r\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + startOffsetValue + \"\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + temp + \",\" + animationRegisterCache.colorAddTarget + \"\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleColorState\r\n\t{\r\n\t\treturn <ParticleColorState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tif (this._iUsesMultiplier)\r\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\r\n\t\tif (this._iUsesOffset)\r\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar startColor:ColorTransform = param[ParticleColorNode.COLOR_START_COLORTRANSFORM];\r\n\t\tif (!startColor)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleColorNode.COLOR_START_COLORTRANSFORM + \" in param!\"));\r\n\r\n\t\tvar endColor:ColorTransform = param[ParticleColorNode.COLOR_END_COLORTRANSFORM];\r\n\t\tif (!endColor)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleColorNode.COLOR_END_COLORTRANSFORM + \" in param!\"));\r\n\r\n\t\tvar i:number /*uint*/ = 0;\r\n\r\n\t\tif (!this._iUsesCycle) {\r\n\t\t\t//multiplier\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tthis._pOneData[i++] = startColor.redMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = startColor.greenMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = startColor.blueMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = startColor.alphaMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.redMultiplier - startColor.redMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.greenMultiplier - startColor.greenMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.blueMultiplier - startColor.blueMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.alphaMultiplier - startColor.alphaMultiplier;\r\n\t\t\t}\r\n\r\n\t\t\t//offset\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tthis._pOneData[i++] = startColor.redOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = startColor.greenOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = startColor.blueOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = startColor.alphaOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.redOffset - startColor.redOffset)/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.greenOffset - startColor.greenOffset)/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.blueOffset - startColor.blueOffset)/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.alphaOffset - startColor.alphaOffset)/255;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//multiplier\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redMultiplier + endColor.redMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenMultiplier + endColor.greenMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueMultiplier + endColor.blueMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaMultiplier + endColor.alphaMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redMultiplier - endColor.redMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenMultiplier - endColor.greenMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueMultiplier - endColor.blueMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaMultiplier - endColor.alphaMultiplier)/2;\r\n\t\t\t}\r\n\r\n\t\t\t//offset\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redOffset + endColor.redOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenOffset + endColor.greenOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueOffset + endColor.blueOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaOffset + endColor.alphaOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redOffset - endColor.redOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenOffset - endColor.greenOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueOffset - endColor.blueOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaOffset - endColor.alphaOffset)/(255*2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nexport = ParticleColorNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleFollowState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleFollowState\");\r\n\r\n/**\r\n * A particle animation node used to create a follow behaviour on a particle system.\r\n */\r\nclass ParticleFollowNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesPosition:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesRotation:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iSmooth:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleFollowNode</code>\r\n\t *\r\n\t * @param    [optional] usesPosition     Defines wehether the individual particle reacts to the position of the target.\r\n\t * @param    [optional] usesRotation     Defines wehether the individual particle reacts to the rotation of the target.\r\n\t * @param    [optional] smooth     Defines wehether the state calculate the interpolated value.\r\n\t */\r\n\tconstructor(usesPosition:boolean = true, usesRotation:boolean = true, smooth:boolean = false)\r\n\t{\r\n\t\tsuper(\"ParticleFollow\", ParticlePropertiesMode.LOCAL_DYNAMIC, (usesPosition && usesRotation)? 6 : 3, ParticleAnimationSet.POST_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleFollowState;\r\n\r\n\t\tthis._iUsesPosition = usesPosition;\r\n\t\tthis._iUsesRotation = usesRotation;\r\n\t\tthis._iSmooth = smooth;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\t//TODO: use Quaternion to implement this function\r\n\t\tvar code:string = \"\";\r\n\t\tif (this._iUsesRotation) {\r\n\t\t\tvar rotationAttribute:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleFollowState.FOLLOW_ROTATION_INDEX, rotationAttribute.index);\r\n\r\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\r\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tvar temp4:ShaderRegisterElement;\r\n\t\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(temp3, 1);\r\n\t\t\t\ttemp4 = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t}\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\r\n\t\t\tif (animationRegisterCache.hasBillboard)\r\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(temp3);\r\n\r\n\t\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\t\tvar i:number /*int*/;\r\n\r\n\t\t\t//x axis\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"sin \" + temp3 + \".y,\" + rotationAttribute + \".x\\n\";\r\n\t\t\tcode += \"cos \" + temp3 + \".z,\" + rotationAttribute + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".z\\n\";\r\n\t\t\tcode += \"neg \" + temp2 + \".z,\" + temp3 + \".y\\n\";\r\n\r\n\t\t\tif (animationRegisterCache.hasBillboard)\r\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\telse {\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\t//y axis\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"cos \" + temp1 + \".x,\" + rotationAttribute + \".y\\n\";\r\n\t\t\tcode += \"sin \" + temp1 + \".z,\" + rotationAttribute + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"neg \" + temp3 + \".x,\" + temp1 + \".z\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + temp1 + \".x\\n\";\r\n\r\n\t\t\tif (animationRegisterCache.hasBillboard)\r\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\telse {\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\t//z axis\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"sin \" + temp2 + \".x,\" + rotationAttribute + \".z\\n\";\r\n\t\t\tcode += \"cos \" + temp2 + \".y,\" + rotationAttribute + \".z\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp2 + \".y\\n\";\r\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp2 + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\r\n\t\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp4 + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t\t} else {\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._iUsesPosition) {\r\n\t\t\tvar positionAttribute:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleFollowState.FOLLOW_POSITION_INDEX, positionAttribute.index);\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + positionAttribute + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleFollowState\r\n\t{\r\n\t\treturn <ParticleFollowState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = ParticleFollowNode;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleInitialColorState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleInitialColorState\");\r\n\r\n/**\r\n *\r\n */\r\nclass ParticleInitialColorNode extends ParticleNodeBase\r\n{\r\n\t//default values used when creating states\r\n\t/** @private */\r\n\tpublic _iUsesMultiplier:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesOffset:boolean;\r\n\t/** @private */\r\n\tpublic _iInitialColor:ColorTransform;\r\n\r\n\t/**\r\n\t * Reference for color node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>ColorTransform</code> object representing the color transform applied to the particle.\r\n\t */\r\n\tpublic static COLOR_INITIAL_COLORTRANSFORM:string = \"ColorInitialColorTransform\";\r\n\r\n\tconstructor(mode:number /*uint*/, usesMultiplier:boolean = true, usesOffset:boolean = false, initialColor:ColorTransform = null)\r\n\t{\r\n\t\tsuper(\"ParticleInitialColor\", mode, (usesMultiplier && usesOffset)? 8 : 4, ParticleAnimationSet.COLOR_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleInitialColorState;\r\n\r\n\t\tthis._iUsesMultiplier = usesMultiplier;\r\n\t\tthis._iUsesOffset = usesOffset;\r\n\t\tthis._iInitialColor = initialColor || new ColorTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tvar multiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.MULTIPLIER_INDEX, multiplierValue.index);\r\n\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + multiplierValue + \",\" + animationRegisterCache.colorMulTarget + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tvar offsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.OFFSET_INDEX, offsetValue.index);\r\n\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + offsetValue + \",\" + animationRegisterCache.colorAddTarget + \"\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tif (this._iUsesMultiplier)\r\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\r\n\t\tif (this._iUsesOffset)\r\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar initialColor:ColorTransform = param[ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM];\r\n\t\tif (!initialColor)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM + \" in param!\"));\r\n\r\n\t\tvar i:number /*uint*/ = 0;\r\n\r\n\t\t//multiplier\r\n\t\tif (this._iUsesMultiplier) {\r\n\t\t\tthis._pOneData[i++] = initialColor.redMultiplier;\r\n\t\t\tthis._pOneData[i++] = initialColor.greenMultiplier;\r\n\t\t\tthis._pOneData[i++] = initialColor.blueMultiplier;\r\n\t\t\tthis._pOneData[i++] = initialColor.alphaMultiplier;\r\n\t\t}\r\n\t\t//offset\r\n\t\tif (this._iUsesOffset) {\r\n\t\t\tthis._pOneData[i++] = initialColor.redOffset/255;\r\n\t\t\tthis._pOneData[i++] = initialColor.greenOffset/255;\r\n\t\t\tthis._pOneData[i++] = initialColor.blueOffset/255;\r\n\t\t\tthis._pOneData[i++] = initialColor.alphaOffset/255;\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleInitialColorNode;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\n\r\n/**\r\n * Provides an abstract base class for particle animation nodes.\r\n */\r\nclass ParticleNodeBase extends AnimationNodeBase\r\n{\r\n\tprivate _priority:number /*int*/;\r\n\r\n\tpublic _pMode:number /*uint*/;\r\n\tpublic _pDataLength:number /*uint*/ = 3;\r\n\tpublic _pOneData:Array<number>;\r\n\r\n\tpublic _iDataOffset:number /*uint*/;\r\n\r\n\t//modes alias\r\n\tprivate static GLOBAL:string = 'Global';\r\n\tprivate static LOCAL_STATIC:string = 'LocalStatic';\r\n\tprivate static LOCAL_DYNAMIC:string = 'LocalDynamic';\r\n\r\n\t//modes list\r\n\tprivate static MODES:Object =\r\n\t{\r\n\t\t0:ParticleNodeBase.GLOBAL,\r\n\t\t1:ParticleNodeBase.LOCAL_STATIC,\r\n\t\t2:ParticleNodeBase.LOCAL_DYNAMIC\r\n\t};\r\n\r\n\t/**\r\n\t * Returns the property mode of the particle animation node. Typically set in the node constructor\r\n\t *\r\n\t * @see away.animators.ParticlePropertiesMode\r\n\t */\r\n\tpublic get mode():number /*uint*/\r\n\t{\r\n\t\treturn this._pMode;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the priority of the particle animation node, used to order the agal generated in a particle animation set. Set automatically on instantiation.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t * @see #getAGALVertexCode\r\n\t */\r\n\tpublic get priority():number /*int*/\r\n\t{\r\n\t\treturn this._priority;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the length of the data used by the node when in <code>LOCAL_STATIC</code> mode. Used to generate the local static data of the particle animation set.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t * @see #getAGALVertexCode\r\n\t */\r\n\tpublic get dataLength():number /*int*/\r\n\t{\r\n\t\treturn this._pDataLength;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the generated data vector of the node after one particle pass during the generation of all local static data of the particle animation set.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t * @see #generatePropertyOfOneParticle\r\n\t */\r\n\tpublic get oneData():Array<number>\r\n\t{\r\n\t\treturn this._pOneData;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleNodeBase</code> object.\r\n\t *\r\n\t * @param               name            Defines the generic name of the particle animation node.\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param               dataLength      Defines the length of the data used by the node when in <code>LOCAL_STATIC</code> mode.\r\n\t * @param    [optional] priority        the priority of the particle animation node, used to order the agal generated in a particle animation set. Defaults to 1.\r\n\t */\r\n\tconstructor(name:string, mode:number /*uint*/, dataLength:number /*uint*/, priority:number /*int*/ = 1)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tname = name + ParticleNodeBase.MODES[mode];\r\n\r\n\t\tthis.name = name;\r\n\t\tthis._pMode = mode;\r\n\t\tthis._priority = priority;\r\n\t\tthis._pDataLength = dataLength;\r\n\r\n\t\tthis._pOneData = new Array<number>(this._pDataLength);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the AGAL code of the particle animation node for use in the vertex shader.\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the AGAL code of the particle animation node for use in the fragment shader.\r\n\t */\r\n\tpublic getAGALFragmentCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the AGAL code of the particle animation node for use in the fragment shader when UV coordinates are required.\r\n\t */\r\n\tpublic getAGALUVCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Called internally by the particle animation set when assigning the set of static properties originally defined by the initParticleFunc of the set.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet#initParticleFunc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Called internally by the particle animation set when determining the requirements of the particle animation node AGAL.\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = ParticleNodeBase;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleOrbitState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleOrbitState\");\r\n\r\n/**\r\n * A particle animation node used to control the position of a particle over time around a circular orbit.\r\n */\r\nclass ParticleOrbitNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesEulers:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iRadius:number;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\t/** @private */\r\n\tpublic _iEulers:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for orbit node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the radius (x), cycle speed (y) and cycle phase (z) of the motion on the particle.\r\n\t */\r\n\tpublic static ORBIT_VECTOR3D:string = \"OrbitVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleOrbitNode</code> object.\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] usesEulers      Defines whether the node uses the <code>eulers</code> property in the shader to calculate a rotation on the orbit. Defaults to true.\r\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of the orbit independent of particle duration. Defaults to false.\r\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the cycle rotation of the particle. Defaults to false.\r\n\t * @param    [optional] radius          Defines the radius of the orbit when in global mode. Defaults to 100.\r\n\t * @param    [optional] cycleDuration   Defines the duration of the orbit in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the phase of the orbit in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t * @param    [optional] eulers          Defines the euler rotation in degrees, applied to the orientation of the orbit when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesEulers:boolean = true, usesCycle:boolean = false, usesPhase:boolean = false, radius:number = 100, cycleDuration:number = 1, cyclePhase:number = 0, eulers:Vector3D = null)\r\n\t{\r\n\t\tvar len:number /*int*/ = 3;\r\n\t\tif (usesPhase)\r\n\t\t\tlen++;\r\n\t\tsuper(\"ParticleOrbit\", mode, len);\r\n\r\n\t\tthis._pStateClass = ParticleOrbitState;\r\n\r\n\t\tthis._iUsesEulers = usesEulers;\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iRadius = radius;\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t\tthis._iEulers = eulers || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar orbitRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOrbitState.ORBIT_INDEX, orbitRegister.index);\r\n\r\n\t\tvar eulersMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOrbitState.EULERS_INDEX, eulersMatrixRegister.index);\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp1.regName, temp1.index);\r\n\r\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 0);\r\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 1);\r\n\t\tvar degree:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 2);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tcode += \"mul \" + degree + \",\" + animationRegisterCache.vertexTime + \",\" + orbitRegister + \".y\\n\";\r\n\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tcode += \"add \" + degree + \",\" + degree + \",\" + orbitRegister + \".w\\n\";\r\n\t\t} else\r\n\t\t\tcode += \"mul \" + degree + \",\" + animationRegisterCache.vertexLife + \",\" + orbitRegister + \".y\\n\";\r\n\r\n\t\tcode += \"cos \" + cos + \",\" + degree + \"\\n\";\r\n\t\tcode += \"sin \" + sin + \",\" + degree + \"\\n\";\r\n\t\tcode += \"mul \" + distance + \".x,\" + cos + \",\" + orbitRegister + \".x\\n\";\r\n\t\tcode += \"mul \" + distance + \".y,\" + sin + \",\" + orbitRegister + \".x\\n\";\r\n\t\tcode += \"mov \" + distance + \".wz\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\tif (this._iUsesEulers)\r\n\t\t\tcode += \"m44 \" + distance + \",\" + distance + \",\" + eulersMatrixRegister + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tcode += \"neg \" + distance + \".x,\" + sin + \"\\n\";\r\n\t\t\tcode += \"mov \" + distance + \".y,\" + cos + \"\\n\";\r\n\t\t\tcode += \"mov \" + distance + \".zw,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tif (this._iUsesEulers)\r\n\t\t\t\tcode += \"m44 \" + distance + \",\" + distance + \",\" + eulersMatrixRegister + \"\\n\";\r\n\t\t\tcode += \"mul \" + distance + \",\" + distance + \",\" + orbitRegister + \".z\\n\";\r\n\t\t\tcode += \"div \" + distance + \",\" + distance + \",\" + orbitRegister + \".y\\n\";\r\n\t\t\tif (!this._iUsesCycle)\r\n\t\t\t\tcode += \"div \" + distance + \",\" + distance + \",\" + animationRegisterCache.vertexLife + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleOrbitState\r\n\t{\r\n\t\treturn <ParticleOrbitState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\t//Vector3D.x is radius, Vector3D.y is cycle duration, Vector3D.z is phase\r\n\t\tvar orbit:Vector3D = param[ParticleOrbitNode.ORBIT_VECTOR3D];\r\n\t\tif (!orbit)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleOrbitNode.ORBIT_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = orbit.x;\r\n\t\tif (this._iUsesCycle && orbit.y <= 0)\r\n\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\tthis._pOneData[1] = Math.PI*2/(!this._iUsesCycle? 1 : orbit.y);\r\n\t\tthis._pOneData[2] = orbit.x*Math.PI*2;\r\n\t\tif (this._iUsesPhase)\r\n\t\t\tthis._pOneData[3] = orbit.z*Math.PI/180;\r\n\t}\r\n}\r\n\r\nexport = ParticleOrbitNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleOscillatorState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleOscillatorState\");\r\n\r\n/**\r\n * A particle animation node used to control the position of a particle over time using simple harmonic motion.\r\n */\r\nclass ParticleOscillatorNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iOscillator:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for ocsillator node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the axis (x,y,z) and cycle speed (w) of the motion on the particle.\r\n\t */\r\n\tpublic static OSCILLATOR_VECTOR3D:string = \"OscillatorVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleOscillatorNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] oscillator      Defines the default oscillator axis (x, y, z) and cycleDuration (w) of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, oscillator:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleOscillator\", mode, 4);\r\n\r\n\t\tthis._pStateClass = ParticleOscillatorState;\r\n\r\n\t\tthis._iOscillator = oscillator || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar oscillatorRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOscillatorState.OSCILLATOR_INDEX, oscillatorRegister.index);\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar dgree:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"mul \" + dgree + \",\" + animationRegisterCache.vertexTime + \",\" + oscillatorRegister + \".w\\n\";\r\n\t\tcode += \"sin \" + sin + \",\" + dgree + \"\\n\";\r\n\t\tcode += \"mul \" + distance + \".xyz,\" + sin + \",\" + oscillatorRegister + \".xyz\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tcode += \"cos \" + cos + \",\" + dgree + \"\\n\";\r\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + cos + \",\" + oscillatorRegister + \".xyz\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleOscillatorState\r\n\t{\r\n\t\treturn <ParticleOscillatorState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\t//(Vector3D.x,Vector3D.y,Vector3D.z) is oscillator axis, Vector3D.w is oscillator cycle duration\r\n\t\tvar drift:Vector3D = param[ParticleOscillatorNode.OSCILLATOR_VECTOR3D];\r\n\t\tif (!drift)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleOscillatorNode.OSCILLATOR_VECTOR3D + \" in param!\"));\r\n\r\n\t\tthis._pOneData[0] = drift.x;\r\n\t\tthis._pOneData[1] = drift.y;\r\n\t\tthis._pOneData[2] = drift.z;\r\n\t\tif (drift.w <= 0)\r\n\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\t\tthis._pOneData[3] = Math.PI*2/drift.w;\r\n\t}\r\n}\r\n\r\nexport = ParticleOscillatorNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticlePositionState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticlePositionState\");\r\n\r\n/**\r\n * A particle animation node used to set the starting position of a particle.\r\n */\r\nclass ParticlePositionNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iPosition:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for position node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing position of the particle.\r\n\t */\r\n\tpublic static POSITION_VECTOR3D:string = \"PositionVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticlePositionNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] position        Defines the default position of the particle when in global mode. Defaults to 0,0,0.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, position:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticlePosition\", mode, 3);\r\n\r\n\t\tthis._pStateClass = ParticlePositionState;\r\n\r\n\t\tthis._iPosition = position || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar positionAttribute:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticlePositionState.POSITION_INDEX, positionAttribute.index);\r\n\r\n\t\treturn \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticlePositionState\r\n\t{\r\n\t\treturn <ParticlePositionState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar offset:Vector3D = param[ParticlePositionNode.POSITION_VECTOR3D];\r\n\t\tif (!offset)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticlePositionNode.POSITION_VECTOR3D + \" in param!\"));\r\n\r\n\t\tthis._pOneData[0] = offset.x;\r\n\t\tthis._pOneData[1] = offset.y;\r\n\t\tthis._pOneData[2] = offset.z;\r\n\t}\r\n}\r\n\r\nexport = ParticlePositionNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotateToHeadingState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState\");\r\n\r\n/**\r\n * A particle animation node used to control the rotation of a particle to match its heading vector.\r\n */\r\nclass ParticleRotateToHeadingNode extends ParticleNodeBase\r\n{\r\n\t/**\r\n\t * Creates a new <code>ParticleBillboardNode</code>\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(\"ParticleRotateToHeading\", ParticlePropertiesMode.GLOBAL, 0, 3);\r\n\r\n\t\tthis._pStateClass = ParticleRotateToHeadingState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\tvar i:number /*int*/;\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\r\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToHeadingState.MATRIX_INDEX, rotationMatrixRegister.index);\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\r\n\r\n\t\t\t//process the velocity\r\n\t\t\tcode += \"m33 \" + temp1 + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz,\" + rotationMatrixRegister + \"\\n\";\r\n\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".xy,\" + temp1 + \".xy\\n\";\r\n\t\t\tcode += \"nrm \" + temp3 + \".xyz,\" + temp3 + \".xyz\\n\";\r\n\r\n\t\t\t//temp3.x=cos,temp3.y=sin\r\n\t\t\t//only process z axis\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t} else {\r\n\t\t\tvar nrmVel:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(nrmVel, 1);\r\n\r\n\t\t\tvar xAxis:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(xAxis, 1);\r\n\r\n\t\t\tvar R:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(R, 1);\r\n\t\t\tvar R_rev:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(R.regName, R.index, 3);\r\n\t\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(R_rev.regName, R_rev.index, 3);\r\n\t\t\tvar cos2:ShaderRegisterElement = new ShaderRegisterElement(nrmVel.regName, nrmVel.index, 3);\r\n\t\t\tvar tempSingle:ShaderRegisterElement = sin;\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(nrmVel);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(xAxis);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(R);\r\n\r\n\t\t\tcode += \"mov \" + xAxis + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + xAxis + \".yz,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\r\n\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t\tcode += \"dp3 \" + cos2 + \",\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + xAxis + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t//use R as temp to judge if nrm is (0,0,0).\r\n\t\t\t//if nrm is (0,0,0) ,change it to (0,0,1).\r\n\t\t\tcode += \"dp3 \" + R + \".x,\" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"sge \" + R + \".x,\" + animationRegisterCache.vertexZeroConst + \",\" + R + \".x\\n\";\r\n\t\t\tcode += \"add \" + nrmVel + \".z,\" + R + \".x,\" + nrmVel + \".z\\n\";\r\n\r\n\t\t\tcode += \"add \" + tempSingle + \",\" + cos2 + \",\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"sqt \" + cos + \",\" + tempSingle + \"\\n\";\r\n\r\n\t\t\tcode += \"sub \" + tempSingle + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos2 + \"\\n\";\r\n\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"sqt \" + sin + \",\" + tempSingle + \"\\n\";\r\n\r\n\t\t\tcode += \"mul \" + R + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\r\n\t\t\t//use cos as R.w\r\n\r\n\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t\t//use cos as R_rev.w\r\n\r\n\t\t\t//nrmVel and xAxis are used as temp register\r\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + R + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\r\n\t\t\t//use cos as R.w\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + R + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\r\n\t\t\tcode += \"crs \" + R + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\t//code += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" +R_rev + \".w\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\t\tcode += \"add \" + R + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t//just repeat the calculate above\r\n\t\t\t\t//because of the limited registers, no need to optimise\r\n\t\t\t\tcode += \"mov \" + xAxis + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\t\tcode += \"mov \" + xAxis + \".yz,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t\t\tcode += \"dp3 \" + cos2 + \",\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + xAxis + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"dp3 \" + R + \".x,\" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"sge \" + R + \".x,\" + animationRegisterCache.vertexZeroConst + \",\" + R + \".x\\n\";\r\n\t\t\t\tcode += \"add \" + nrmVel + \".z,\" + R + \".x,\" + nrmVel + \".z\\n\";\r\n\t\t\t\tcode += \"add \" + tempSingle + \",\" + cos2 + \",\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\t\tcode += \"sqt \" + cos + \",\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + tempSingle + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos2 + \"\\n\";\r\n\t\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\t\tcode += \"sqt \" + sin + \",\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + R + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + R + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\t\t\t\tcode += \"crs \" + R + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"add \" + R + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotateToHeadingState\r\n\t{\r\n\t\treturn <ParticleRotateToHeadingState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.needVelocity = true;\r\n\t}\r\n}\r\n\r\nexport = ParticleRotateToHeadingNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotateToPositionState\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState\");\r\n\r\n/**\r\n * A particle animation node used to control the rotation of a particle to face to a position\r\n */\r\nclass ParticleRotateToPositionNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iPosition:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for the position the particle will rotate to face for a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the position that the particle must face.\r\n\t */\r\n\tpublic static POSITION_VECTOR3D:string = \"RotateToPositionVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleRotateToPositionNode</code>\r\n\t */\r\n\tconstructor(mode:number /*uint*/, position:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleRotateToPosition\", mode, 3, 3);\r\n\r\n\t\tthis._pStateClass = ParticleRotateToPositionState;\r\n\r\n\t\tthis._iPosition = position || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar positionAttribute:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToPositionState.POSITION_INDEX, positionAttribute.index);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\tvar i:number /*int*/;\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\r\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToPositionState.MATRIX_INDEX, rotationMatrixRegister.index);\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\r\n\r\n\t\t\t//process the position\r\n\t\t\tcode += \"sub \" + temp1 + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\tcode += \"m33 \" + temp1 + \".xyz,\" + temp1 + \".xyz,\" + rotationMatrixRegister + \"\\n\";\r\n\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".xy,\" + temp1 + \".xy\\n\";\r\n\t\t\tcode += \"nrm \" + temp3 + \".xyz,\" + temp3 + \".xyz\\n\";\r\n\r\n\t\t\t//temp3.x=cos,temp3.y=sin\r\n\t\t\t//only process z axis\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t} else {\r\n\t\t\tvar nrmDirection:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(nrmDirection, 1);\r\n\r\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\t\tvar o_temp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\t\tvar tempSingle:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 3);\r\n\r\n\t\t\tvar R:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(R, 1);\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(nrmDirection);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(R);\r\n\r\n\t\t\tcode += \"sub \" + nrmDirection + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\r\n\t\t\tcode += \"mov \" + sin + \",\" + nrmDirection + \".y\\n\";\r\n\t\t\tcode += \"mul \" + cos + \",\" + sin + \",\" + sin + \"\\n\";\r\n\t\t\tcode += \"sub \" + cos + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"sqt \" + cos + \",\" + cos + \"\\n\";\r\n\r\n\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".y\\n\";\r\n\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".y\\n\";\r\n\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\r\n\t\t\tcode += \"sub \" + animationRegisterCache.scaleAndRotateTarget + \".y,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\r\n\t\t\tcode += \"abs \" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\t\t\tcode += \"sge \" + R + \".z,\" + R + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mul \" + R + \".x,\" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\r\n\t\t\t//judgu if nrmDirection=(0,1,0);\r\n\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"dp3 \" + sin + \",\" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\tcode += \"sge \" + tempSingle + \",\" + animationRegisterCache.vertexZeroConst + \",\" + sin + \"\\n\";\r\n\r\n\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\r\n\t\t\tcode += \"sub \" + sin + \",\" + animationRegisterCache.vertexOneConst + \",\" + tempSingle + \"\\n\";\r\n\t\t\tcode += \"mul \" + sin + \",\" + sin + \",\" + nrmDirection + \".x\\n\";\r\n\r\n\t\t\tcode += \"mov \" + cos + \",\" + nrmDirection + \".z\\n\";\r\n\t\t\tcode += \"neg \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"sub \" + o_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"mul \" + o_temp + \",\" + R + \".x,\" + tempSingle + \"\\n\";\r\n\t\t\tcode += \"add \" + cos + \",\" + cos + \",\" + o_temp + \"\\n\";\r\n\r\n\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".x\\n\";\r\n\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".x\\n\";\r\n\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\r\n\t\t\tcode += \"sub \" + animationRegisterCache.scaleAndRotateTarget + \".x,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t//just repeat the calculate above\r\n\t\t\t\t//because of the limited registers, no need to optimise\r\n\t\t\t\tcode += \"sub \" + nrmDirection + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\t\tcode += \"mov \" + sin + \",\" + nrmDirection + \".y\\n\";\r\n\t\t\t\tcode += \"mul \" + cos + \",\" + sin + \",\" + sin + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + cos + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"sqt \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".y\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".y\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"sub \" + animationRegisterCache.rotationRegisters[i] + \".y,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\t\t\t\tcode += \"abs \" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\t\t\t\tcode += \"sge \" + R + \".z,\" + R + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".x,\" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\t\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\tcode += \"dp3 \" + sin + \",\" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\t\tcode += \"sge \" + tempSingle + \",\" + animationRegisterCache.vertexZeroConst + \",\" + sin + \"\\n\";\r\n\t\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\t\tcode += \"sub \" + sin + \",\" + animationRegisterCache.vertexOneConst + \",\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + sin + \",\" + sin + \",\" + nrmDirection + \".x\\n\";\r\n\t\t\t\tcode += \"mov \" + cos + \",\" + nrmDirection + \".z\\n\";\r\n\t\t\t\tcode += \"neg \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + o_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + o_temp + \",\" + R + \".x,\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"add \" + cos + \",\" + cos + \",\" + o_temp + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".x\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".x\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"sub \" + animationRegisterCache.rotationRegisters[i] + \".x,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotateToPositionState\r\n\t{\r\n\t\treturn <ParticleRotateToPositionState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar offset:Vector3D = param[ParticleRotateToPositionNode.POSITION_VECTOR3D];\r\n\t\tif (!offset)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleRotateToPositionNode.POSITION_VECTOR3D + \" in param!\"));\r\n\r\n\t\tthis._pOneData[0] = offset.x;\r\n\t\tthis._pOneData[1] = offset.y;\r\n\t\tthis._pOneData[2] = offset.z;\r\n\t}\r\n}\r\n\r\nexport = ParticleRotateToPositionNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotationalVelocityState\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState\");\r\n\r\n/**\r\n * A particle animation node used to set the starting rotational velocity of a particle.\r\n */\r\nclass ParticleRotationalVelocityNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iRotationalVelocity:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for rotational velocity node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the rotational velocity around an axis of the particle.\r\n\t */\r\n\tpublic static ROTATIONALVELOCITY_VECTOR3D:string = \"RotationalVelocityVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleRotationalVelocityNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, rotationalVelocity:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleRotationalVelocity\", mode, 4);\r\n\r\n\t\tthis._pStateClass = ParticleRotationalVelocityState;\r\n\r\n\t\tthis._iRotationalVelocity = rotationalVelocity || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar rotationRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX, rotationRegister.index);\r\n\r\n\t\tvar nrmVel:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(nrmVel, 1);\r\n\r\n\t\tvar xAxis:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(xAxis, 1);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\tvar Rtemp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index);\r\n\t\tvar R_rev:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tR_rev = new ShaderRegisterElement(R_rev.regName, R_rev.index);\r\n\r\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(Rtemp.regName, Rtemp.index, 3);\r\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(R_rev.regName, R_rev.index, 3);\r\n\r\n\t\tanimationRegisterCache.removeVertexTempUsage(nrmVel);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(xAxis);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"mov \" + nrmVel + \".xyz,\" + rotationRegister + \".xyz\\n\";\r\n\t\tcode += \"mov \" + nrmVel + \".w,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\r\n\t\tcode += \"mul \" + cos + \",\" + animationRegisterCache.vertexTime + \",\" + rotationRegister + \".w\\n\";\r\n\r\n\t\tcode += \"sin \" + sin + \",\" + cos + \"\\n\";\r\n\t\tcode += \"cos \" + cos + \",\" + cos + \"\\n\";\r\n\r\n\t\tcode += \"mul \" + Rtemp + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\r\n\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t//nrmVel and xAxis are used as temp register\r\n\t\tcode += \"crs \" + nrmVel + \".xyz,\" + Rtemp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\r\n\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\tcode += \"dp3 \" + xAxis + \".w,\" + Rtemp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\r\n\t\tcode += \"crs \" + Rtemp + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t//use cos as R_rev.w\r\n\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\tcode += \"add \" + Rtemp + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\r\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\tfor (var i:number /*int*/ = 0; i < len; i++) {\r\n\t\t\tcode += \"mov \" + nrmVel + \".xyz,\" + rotationRegister + \".xyz\\n\";\r\n\t\t\tcode += \"mov \" + nrmVel + \".w,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mul \" + cos + \",\" + animationRegisterCache.vertexTime + \",\" + rotationRegister + \".w\\n\";\r\n\t\t\tcode += \"sin \" + sin + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"cos \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"mul \" + Rtemp + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + Rtemp + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \"\\n\";\r\n\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + Rtemp + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \"\\n\";\r\n\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\t\t\tcode += \"crs \" + Rtemp + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\t\tcode += \"add \" + Rtemp + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \",\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotationalVelocityState\r\n\t{\r\n\t\treturn <ParticleRotationalVelocityState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\t//(Vector3d.x,Vector3d.y,Vector3d.z) is rotation axis,Vector3d.w is cycle duration\r\n\t\tvar rotate:Vector3D = param[ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D];\r\n\t\tif (!rotate)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D + \" in param!\"));\r\n\r\n\t\tif (rotate.length <= 0)\r\n\t\t\trotate.z = 1; //set the default direction\r\n\t\telse\r\n\t\t\trotate.normalize();\r\n\r\n\t\tthis._pOneData[0] = rotate.x;\r\n\t\tthis._pOneData[1] = rotate.y;\r\n\t\tthis._pOneData[2] = rotate.z;\r\n\t\tif (rotate.w <= 0)\r\n\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\t\t// it's used as angle/2 in agal\r\n\t\tthis._pOneData[3] = Math.PI/rotate.w;\r\n\t}\r\n}\r\n\r\nexport = ParticleRotationalVelocityNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleScaleState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleScaleState\");\r\n\r\n/**\r\n * A particle animation node used to control the scale variation of a particle over time.\r\n */\r\nclass ParticleScaleNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iMinScale:number;\r\n\t/** @private */\r\n\tpublic _iMaxScale:number;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\r\n\t/**\r\n\t * Reference for scale node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> representing the min scale (x), max scale(y), optional cycle speed (z) and phase offset (w) applied to the particle.\r\n\t */\r\n\tpublic static SCALE_VECTOR3D:string = \"ScaleVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleScaleNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of animation independent of particle duration. Defaults to false.\r\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the animation cycle. Defaults to false.\r\n\t * @param    [optional] minScale        Defines the default min scale transform of the node, when in global mode. Defaults to 1.\r\n\t * @param    [optional] maxScale        Defines the default max color transform of the node, when in global mode. Defaults to 1.\r\n\t * @param    [optional] cycleDuration   Defines the default duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the default phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesCycle:boolean, usesPhase:boolean, minScale:number = 1, maxScale:number = 1, cycleDuration:number = 1, cyclePhase:number = 0)\r\n\t{\r\n\t\tsuper(\"ParticleScale\", mode, (usesCycle && usesPhase)? 4 : ((usesCycle || usesPhase)? 3 : 2), 3);\r\n\r\n\t\tthis._pStateClass = ParticleScaleState;\r\n\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iMinScale = minScale;\r\n\t\tthis._iMaxScale = maxScale;\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\r\n\t\tvar scaleRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleScaleState.SCALE_INDEX, scaleRegister.index);\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tcode += \"mul \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + scaleRegister + \".z\\n\";\r\n\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + scaleRegister + \".w\\n\";\r\n\r\n\t\t\tcode += \"sin \" + temp + \",\" + temp + \"\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"mul \" + temp + \",\" + scaleRegister + \".y,\" + ((this._iUsesCycle)? temp : animationRegisterCache.vertexLife) + \"\\n\";\r\n\t\tcode += \"add \" + temp + \",\" + scaleRegister + \".x,\" + temp + \"\\n\";\r\n\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleScaleState\r\n\t{\r\n\t\treturn <ParticleScaleState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar scale:Vector3D = param[ParticleScaleNode.SCALE_VECTOR3D];\r\n\t\tif (!scale)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleScaleNode.SCALE_VECTOR3D + \" in param!\"));\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tthis._pOneData[0] = (scale.x + scale.y)/2;\r\n\t\t\tthis._pOneData[1] = Math.abs(scale.x - scale.y)/2;\r\n\t\t\tif (scale.z <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tthis._pOneData[2] = Math.PI*2/scale.z;\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tthis._pOneData[3] = scale.w*Math.PI/180;\r\n\t\t} else {\r\n\t\t\tthis._pOneData[0] = scale.x;\r\n\t\t\tthis._pOneData[1] = scale.y - scale.x;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleScaleNode;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ColorSegmentPoint\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ColorSegmentPoint\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleSegmentedColorState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState\");\r\n\r\n/**\r\n *\r\n */\r\nclass ParticleSegmentedColorNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesMultiplier:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesOffset:boolean;\r\n\t/** @private */\r\n\tpublic _iStartColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iEndColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iNumSegmentPoint:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iSegmentPoints:Array<ColorSegmentPoint>;\r\n\r\n\tconstructor(usesMultiplier:boolean, usesOffset:boolean, numSegmentPoint:number /*int*/, startColor:ColorTransform, endColor:ColorTransform, segmentPoints:Array<ColorSegmentPoint>)\r\n\t{\r\n\t\t//because of the stage3d register limitation, it only support the global mode\r\n\t\tsuper(\"ParticleSegmentedColor\", ParticlePropertiesMode.GLOBAL, 0, ParticleAnimationSet.COLOR_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleSegmentedColorState;\r\n\r\n\t\tif (numSegmentPoint > 4)\r\n\t\t\tthrow(new Error(\"the numSegmentPoint must be less or equal 4\"));\r\n\t\tthis._iUsesMultiplier = usesMultiplier;\r\n\t\tthis._iUsesOffset = usesOffset;\r\n\t\tthis._iNumSegmentPoint = numSegmentPoint;\r\n\t\tthis._iStartColor = startColor;\r\n\t\tthis._iEndColor = endColor;\r\n\t\tthis._iSegmentPoints = segmentPoints;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tif (this._iUsesMultiplier)\r\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\r\n\t\tif (this._iUsesOffset)\r\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tvar accMultiplierColor:ShaderRegisterElement;\r\n\t\t\t//var accOffsetColor:ShaderRegisterElement;\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\taccMultiplierColor = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(accMultiplierColor, 1);\r\n\t\t\t}\r\n\r\n\t\t\tvar tempColor:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(tempColor, 1);\r\n\r\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tvar accTime:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\t\tvar tempTime:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\r\n\t\t\tif (this._iUsesMultiplier)\r\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(accMultiplierColor);\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(tempColor);\r\n\r\n\t\t\t//for saving all the life values (at most 4)\r\n\t\t\tvar lifeTimeRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.TIME_DATA_INDEX, lifeTimeRegister.index);\r\n\r\n\t\t\tvar i:number /*int*/;\r\n\r\n\t\t\tvar startMulValue:ShaderRegisterElement;\r\n\t\t\tvar deltaMulValues:Array<ShaderRegisterElement>;\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tstartMulValue = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_MULTIPLIER_INDEX, startMulValue.index);\r\n\t\t\t\tdeltaMulValues = new Array<ShaderRegisterElement>();\r\n\t\t\t\tfor (i = 0; i < this._iNumSegmentPoint + 1; i++)\r\n\t\t\t\t\tdeltaMulValues.push(animationRegisterCache.getFreeVertexConstant());\r\n\t\t\t}\r\n\r\n\t\t\tvar startOffsetValue:ShaderRegisterElement;\r\n\t\t\tvar deltaOffsetValues:Array<ShaderRegisterElement>;\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tstartOffsetValue = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_OFFSET_INDEX, startOffsetValue.index);\r\n\t\t\t\tdeltaOffsetValues = new Array<ShaderRegisterElement>();\r\n\t\t\t\tfor (i = 0; i < this._iNumSegmentPoint + 1; i++)\r\n\t\t\t\t\tdeltaOffsetValues.push(animationRegisterCache.getFreeVertexConstant());\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesMultiplier)\r\n\t\t\t\tcode += \"mov \" + accMultiplierColor + \",\" + startMulValue + \"\\n\";\r\n\t\t\tif (this._iUsesOffset)\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + startOffsetValue + \"\\n\";\r\n\r\n\t\t\tfor (i = 0; i < this._iNumSegmentPoint; i++) {\r\n\t\t\t\tswitch (i) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\r\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".y\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".y\\n\";\r\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".z\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".z\\n\";\r\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".w\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaMulValues[i] + \"\\n\";\r\n\t\t\t\t\tcode += \"add \" + accMultiplierColor + \",\" + accMultiplierColor + \",\" + tempColor + \"\\n\";\r\n\t\t\t\t}\r\n\t\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaOffsetValues[i] + \"\\n\";\r\n\t\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + tempColor + \"\\n\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//for the last segment:\r\n\t\t\tif (this._iNumSegmentPoint == 0)\r\n\t\t\t\ttempTime = animationRegisterCache.vertexLife;\r\n\t\t\telse {\r\n\t\t\t\tswitch (this._iNumSegmentPoint) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".y\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".z\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".w\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t}\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaMulValues[this._iNumSegmentPoint] + \"\\n\";\r\n\t\t\t\tcode += \"add \" + accMultiplierColor + \",\" + accMultiplierColor + \",\" + tempColor + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + animationRegisterCache.colorMulTarget + \",\" + accMultiplierColor + \"\\n\";\r\n\t\t\t}\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaOffsetValues[this._iNumSegmentPoint] + \"\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + tempColor + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleSegmentedColorNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleSpriteSheetState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState\");\r\n\r\n/**\r\n * A particle animation node used when a spritesheet texture is required to animate the particle.\r\n * NB: to enable use of this node, the <code>repeat</code> property on the material has to be set to true.\r\n */\r\nclass ParticleSpriteSheetNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iTotalFrames:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iNumColumns:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iNumRows:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\r\n\t/**\r\n\t * Reference for spritesheet node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> representing the cycleDuration (x), optional phaseTime (y).\r\n\t */\r\n\tpublic static UV_VECTOR3D:string = \"UVVector3D\";\r\n\r\n\t/**\r\n\t * Defines the number of columns in the spritesheet, when in global mode. Defaults to 1. Read only.\r\n\t */\r\n\tpublic get numColumns():number\r\n\t{\r\n\t\treturn this._iNumColumns;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the number of rows in the spritesheet, when in global mode. Defaults to 1. Read only.\r\n\t */\r\n\tpublic get numRows():number\r\n\t{\r\n\t\treturn this._iNumRows;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows. Read only.\r\n\t */\r\n\tpublic get totalFrames():number\r\n\t{\r\n\t\treturn this._iTotalFrames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleSpriteSheetNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] numColumns      Defines the number of columns in the spritesheet, when in global mode. Defaults to 1.\r\n\t * @param    [optional] numRows         Defines the number of rows in the spritesheet, when in global mode. Defaults to 1.\r\n\t * @param    [optional] cycleDuration   Defines the default cycle duration in seconds, when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the default cycle phase, when in global mode. Defaults to 0.\r\n\t * @param    [optional] totalFrames     Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows.\r\n\t * @param    [optional] looping         Defines whether the spritesheet animation is set to loop indefinitely. Defaults to true.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesCycle:boolean, usesPhase:boolean, numColumns:number /*int*/ = 1, numRows:number /*uint*/ = 1, cycleDuration:number = 1, cyclePhase:number = 0, totalFrames:number /*uint*/ = Number.MAX_VALUE)\r\n\t{\r\n\t\tsuper(\"ParticleSpriteSheet\", mode, usesCycle? (usesPhase? 3 : 2) : 1, ParticleAnimationSet.POST_PRIORITY + 1);\r\n\r\n\t\tthis._pStateClass = ParticleSpriteSheetState;\r\n\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iNumColumns = numColumns;\r\n\t\tthis._iNumRows = numRows;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iTotalFrames = Math.min(totalFrames, numColumns*numRows);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\t//get 2 vc\r\n\t\tvar uvParamConst1:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tvar uvParamConst2:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_0, uvParamConst1.index);\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_1, uvParamConst2.index);\r\n\r\n\t\tvar uTotal:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 0);\r\n\t\tvar uStep:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 1);\r\n\t\tvar vStep:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 2);\r\n\r\n\t\tvar uSpeed:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 0);\r\n\t\tvar cycle:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 1);\r\n\t\tvar phaseTime:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 2);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar time:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\tvar vOffset:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\ttemp = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\tvar temp2:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 3);\r\n\r\n\t\tvar u:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 0);\r\n\t\tvar v:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 1);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\t//scale uv\r\n\t\tcode += \"mul \" + u + \",\" + u + \",\" + uStep + \"\\n\";\r\n\t\tif (this._iNumRows > 1)\r\n\t\t\tcode += \"mul \" + v + \",\" + v + \",\" + vStep + \"\\n\";\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tcode += \"add \" + time + \",\" + animationRegisterCache.vertexTime + \",\" + phaseTime + \"\\n\";\r\n\t\t\telse\r\n\t\t\t\tcode += \"mov \" + time + \",\" + animationRegisterCache.vertexTime + \"\\n\";\r\n\t\t\tcode += \"div \" + time + \",\" + time + \",\" + cycle + \"\\n\";\r\n\t\t\tcode += \"frc \" + time + \",\" + time + \"\\n\";\r\n\t\t\tcode += \"mul \" + time + \",\" + time + \",\" + cycle + \"\\n\";\r\n\t\t\tcode += \"mul \" + temp + \",\" + time + \",\" + uSpeed + \"\\n\";\r\n\t\t} else\r\n\t\t\tcode += \"mul \" + temp.toString() + \",\" + animationRegisterCache.vertexLife + \",\" + uTotal + \"\\n\";\r\n\r\n\t\tif (this._iNumRows > 1) {\r\n\t\t\tcode += \"frc \" + temp2 + \",\" + temp + \"\\n\";\r\n\t\t\tcode += \"sub \" + vOffset + \",\" + temp + \",\" + temp2 + \"\\n\";\r\n\t\t\tcode += \"mul \" + vOffset + \",\" + vOffset + \",\" + vStep + \"\\n\";\r\n\t\t\tcode += \"add \" + v + \",\" + v + \",\" + vOffset + \"\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"div \" + temp2 + \",\" + temp + \",\" + uStep + \"\\n\";\r\n\t\tcode += \"frc \" + temp + \",\" + temp2 + \"\\n\";\r\n\t\tcode += \"sub \" + temp2 + \",\" + temp2 + \",\" + temp + \"\\n\";\r\n\t\tcode += \"mul \" + temp + \",\" + temp2 + \",\" + uStep + \"\\n\";\r\n\r\n\t\tif (this._iNumRows > 1)\r\n\t\t\tcode += \"frc \" + temp + \",\" + temp + \"\\n\";\r\n\t\tcode += \"add \" + u + \",\" + u + \",\" + temp + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleSpriteSheetState\r\n\t{\r\n\t\treturn <ParticleSpriteSheetState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.hasUVNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tvar uvCycle:Vector3D = param[ParticleSpriteSheetNode.UV_VECTOR3D];\r\n\t\t\tif (!uvCycle)\r\n\t\t\t\tthrow(new Error(\"there is no \" + ParticleSpriteSheetNode.UV_VECTOR3D + \" in param!\"));\r\n\t\t\tif (uvCycle.x <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tvar uTotal:number = this._iTotalFrames/this._iNumColumns;\r\n\t\t\tthis._pOneData[0] = uTotal/uvCycle.x;\r\n\t\t\tthis._pOneData[1] = uvCycle.x;\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tthis._pOneData[2] = uvCycle.y;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleSpriteSheetNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleTimeState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleTimeState\");\r\n\r\n/**\r\n * A particle animation node used as the base node for timekeeping inside a particle. Automatically added to a particle animation set on instatiation.\r\n */\r\nclass ParticleTimeNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesDuration:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesDelay:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesLooping:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleTimeNode</code>\r\n\t *\r\n\t * @param    [optional] usesDuration    Defines whether the node uses the <code>duration</code> data in the static properties to determine how long a particle is visible for. Defaults to false.\r\n\t * @param    [optional] usesDelay       Defines whether the node uses the <code>delay</code> data in the static properties to determine how long a particle is hidden for. Defaults to false. Requires <code>usesDuration</code> to be true.\r\n\t * @param    [optional] usesLooping     Defines whether the node creates a looping timeframe for each particle determined by the <code>startTime</code>, <code>duration</code> and <code>delay</code> data in the static properties function. Defaults to false. Requires <code>usesLooping</code> to be true.\r\n\t */\r\n\tconstructor(usesDuration:boolean = false, usesLooping:boolean = false, usesDelay:boolean = false)\r\n\t{\r\n\t\tthis._pStateClass = ParticleTimeState;\r\n\r\n\t\tthis._iUsesDuration = usesDuration;\r\n\t\tthis._iUsesLooping = usesLooping;\r\n\t\tthis._iUsesDelay = usesDelay;\r\n\r\n\t\tsuper(\"ParticleTime\", ParticlePropertiesMode.LOCAL_STATIC, 4, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar timeStreamRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute(); //timeStreamRegister.x is start，timeStreamRegister.y is during time\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleTimeState.TIME_STREAM_INDEX, timeStreamRegister.index);\r\n\t\tvar timeConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleTimeState.TIME_CONSTANT_INDEX, timeConst.index);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"sub \" + animationRegisterCache.vertexTime + \",\" + timeConst + \",\" + timeStreamRegister + \".x\\n\";\r\n\t\t//if time=0,set the position to zero.\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\tcode += \"sge \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\r\n\t\tif (this._iUsesDuration) {\r\n\t\t\tif (this._iUsesLooping) {\r\n\t\t\t\tvar div:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\t\t\tif (this._iUsesDelay) {\r\n\t\t\t\t\tcode += \"div \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".z\\n\";\r\n\t\t\t\t\tcode += \"frc \" + div + \",\" + div + \"\\n\";\r\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.vertexTime + \",\" + div + \",\" + timeStreamRegister + \".z\\n\";\r\n\t\t\t\t\tcode += \"slt \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".y\\n\";\r\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + div + \"\\n\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcode += \"mul \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".w\\n\";\r\n\t\t\t\t\tcode += \"frc \" + div + \",\" + div + \"\\n\";\r\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.vertexTime + \",\" + div + \",\" + timeStreamRegister + \".y\\n\";\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar sge:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\t\t\tcode += \"sge \" + sge + \",\" + timeStreamRegister + \".y,\" + animationRegisterCache.vertexTime + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + sge + \"\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tcode += \"mul \" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".w\\n\";\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleTimeState\r\n\t{\r\n\t\treturn <ParticleTimeState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tthis._pOneData[0] = param.startTime;\r\n\t\tthis._pOneData[1] = param.duration;\r\n\t\tthis._pOneData[2] = param.delay + param.duration;\r\n\t\tthis._pOneData[3] = 1/param.duration;\r\n\r\n\t}\r\n}\r\n\r\nexport = ParticleTimeNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleUVState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleUVState\");\r\n\r\n/**\r\n * A particle animation node used to control the UV offset and scale of a particle over time.\r\n */\r\nclass ParticleUVNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUvData:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static U_AXIS:string = \"x\";\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static V_AXIS:string = \"y\";\r\n\r\n\tprivate _cycle:number;\r\n\tprivate _scale:number;\r\n\tprivate _axis:string;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleTimeNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] cycle           Defines whether the time track is in loop mode. Defaults to false.\r\n\t * @param    [optional] scale           Defines whether the time track is in loop mode. Defaults to false.\r\n\t * @param    [optional] axis            Defines whether the time track is in loop mode. Defaults to false.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, cycle:number = 1, scale:number = 1, axis:string = \"x\")\r\n\t{\r\n\t\t//because of the stage3d register limitation, it only support the global mode\r\n\t\tsuper(\"ParticleUV\", ParticlePropertiesMode.GLOBAL, 4, ParticleAnimationSet.POST_PRIORITY + 1);\r\n\r\n\t\tthis._pStateClass = ParticleUVState;\r\n\r\n\t\tthis._cycle = cycle;\r\n\t\tthis._scale = scale;\r\n\t\tthis._axis = axis;\r\n\r\n\t\tthis.updateUVData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get cycle():number\r\n\t{\r\n\t\treturn this._cycle;\r\n\t}\r\n\r\n\tpublic set cycle(value:number)\r\n\t{\r\n\t\tthis._cycle = value;\r\n\r\n\t\tthis.updateUVData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get scale():number\r\n\t{\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\tpublic set scale(value:number)\r\n\t{\r\n\t\tthis._scale = value;\r\n\r\n\t\tthis.updateUVData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get axis():string\r\n\t{\r\n\t\treturn this._axis;\r\n\t}\r\n\r\n\tpublic set axis(value:string)\r\n\t{\r\n\t\tthis._axis = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tvar uvConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleUVState.UV_INDEX, uvConst.index);\r\n\r\n\t\tvar axisIndex:number = this._axis == \"x\"? 0 : (this._axis == \"y\"? 1 : 2);\r\n\r\n\t\tvar target:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, axisIndex);\r\n\r\n\t\tvar sin:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\r\n\t\tif (this._scale != 1)\r\n\t\t\tcode += \"mul \" + target + \",\" + target + \",\" + uvConst + \".y\\n\";\r\n\r\n\t\tcode += \"mul \" + sin + \",\" + animationRegisterCache.vertexTime + \",\" + uvConst + \".x\\n\";\r\n\t\tcode += \"sin \" + sin + \",\" + sin + \"\\n\";\r\n\t\tcode += \"add \" + target + \",\" + target + \",\" + sin + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleUVState\r\n\t{\r\n\t\treturn <ParticleUVState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\tprivate updateUVData()\r\n\t{\r\n\t\tthis._iUvData = new Vector3D(Math.PI*2/this._cycle, this._scale, 0, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.hasUVNode = true;\r\n\t}\r\n}\r\n\r\nexport = ParticleUVNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleVelocityState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleVelocityState\");\r\n\r\n/**\r\n * A particle animation node used to set the starting velocity of a particle.\r\n */\r\nclass ParticleVelocityNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iVelocity:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for velocity node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the direction of movement on the particle.\r\n\t */\r\n\tpublic static VELOCITY_VECTOR3D:string = \"VelocityVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleVelocityNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] velocity        Defines the default velocity vector of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, velocity:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleVelocity\", mode, 3);\r\n\r\n\t\tthis._pStateClass = ParticleVelocityState;\r\n\r\n\t\tthis._iVelocity = velocity || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shader:ShaderBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar velocityValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleVelocityState.VELOCITY_INDEX, velocityValue.index);\r\n\r\n\t\tvar distance:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"mul \" + distance + \",\" + animationRegisterCache.vertexTime + \",\" + velocityValue + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \",\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity)\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + velocityValue + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleVelocityState\r\n\t{\r\n\t\treturn <ParticleVelocityState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar _tempVelocity:Vector3D = param[ParticleVelocityNode.VELOCITY_VECTOR3D];\r\n\t\tif (!_tempVelocity)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleVelocityNode.VELOCITY_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = _tempVelocity.x;\r\n\t\tthis._pOneData[1] = _tempVelocity.y;\r\n\t\tthis._pOneData[2] = _tempVelocity.z;\r\n\t}\r\n}\r\n\r\nexport = ParticleVelocityNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonBinaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState\");\r\n\r\n/**\r\n * A skeleton animation node that uses two animation node inputs to blend a lineraly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonBinaryLERPNode extends AnimationNodeBase\r\n{\r\n\t/**\r\n\t * Defines input node A to use for the blended output.\r\n\t */\r\n\tpublic inputA:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines input node B to use for the blended output.\r\n\t */\r\n\tpublic inputB:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonBinaryLERPNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonBinaryLERPState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonBinaryLERPState\r\n\t{\r\n\t\treturn <SkeletonBinaryLERPState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = SkeletonBinaryLERPNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\r\nimport SkeletonClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonClipState\");\r\n\r\n/**\r\n * A skeleton animation node containing time-based animation data as individual skeleton poses.\r\n */\r\nclass SkeletonClipNode extends AnimationClipNodeBase\r\n{\r\n\tprivate _frames:Array<SkeletonPose> = new Array<SkeletonPose>();\r\n\r\n\t/**\r\n\t * Determines whether to use SLERP equations (true) or LERP equations (false) in the calculation\r\n\t * of the output skeleton pose. Defaults to false.\r\n\t */\r\n\tpublic highQuality:boolean = false;\r\n\r\n\t/**\r\n\t * Returns a vector of skeleton poses representing the pose of each animation frame in the clip.\r\n\t */\r\n\tpublic get frames():Array<SkeletonPose>\r\n\t{\r\n\t\treturn this._frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonClipNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonClipState;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a skeleton pose frame to the internal timeline of the animation node.\r\n\t *\r\n\t * @param skeletonPose The skeleton pose object to add to the timeline of the node.\r\n\t * @param duration The specified duration of the frame in milliseconds.\r\n\t */\r\n\tpublic addFrame(skeletonPose:SkeletonPose, duration:number /*number /*uint*/)\r\n\t{\r\n\t\tthis._frames.push(skeletonPose);\r\n\t\tthis._pDurations.push(duration);\r\n\r\n\t\tthis._pNumFrames = this._pDurations.length;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonClipState\r\n\t{\r\n\t\treturn <SkeletonClipState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateStitch()\r\n\t{\r\n\t\tsuper._pUpdateStitch();\r\n\r\n\t\tvar i:number /*uint*/ = this._pNumFrames - 1;\r\n\t\tvar p1:Vector3D, p2:Vector3D, delta:Vector3D;\r\n\t\twhile (i--) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[i];\r\n\t\t\tp1 = this._frames[i].jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[i + 1].jointPoses[0].translation;\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\r\n\t\tif (this._pStitchFinalFrame || !this._pLooping) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[this._pNumFrames - 1];\r\n\t\t\tp1 = this._frames[0].jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[1].jointPoses[0].translation;\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonClipNode;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonDifferenceState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState\");\r\n\r\n/**\r\n * A skeleton animation node that uses a difference input pose with a base input pose to blend a linearly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonDifferenceNode extends AnimationNodeBase\r\n{\r\n\t/**\r\n\t * Defines a base input node to use for the blended output.\r\n\t */\r\n\tpublic baseInput:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines a difference input node to use for the blended output.\r\n\t */\r\n\tpublic differenceInput:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonAdditiveNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonDifferenceState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonDifferenceState\r\n\t{\r\n\t\treturn <SkeletonDifferenceState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = SkeletonDifferenceNode",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonDirectionalState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState\");\r\n\r\n/**\r\n * A skeleton animation node that uses four directional input poses with an input direction to blend a linearly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonDirectionalNode extends AnimationNodeBase\r\n{\r\n\t/**\r\n\t * Defines the forward configured input node to use for the blended output.\r\n\t */\r\n\tpublic forward:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines the backwards configured input node to use for the blended output.\r\n\t */\r\n\tpublic backward:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines the left configured input node to use for the blended output.\r\n\t */\r\n\tpublic left:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines the right configured input node to use for the blended output.\r\n\t */\r\n\tpublic right:AnimationNodeBase;\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonDirectionalState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonDirectionalState\r\n\t{\r\n\t\treturn <SkeletonDirectionalState> animator.getAnimationState(this);\r\n\t}\r\n\r\n}\r\n\r\nexport = SkeletonDirectionalNode;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonNaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState\");\r\n\r\n/**\r\n * A skeleton animation node that uses an n-dimensional array of animation node inputs to blend a lineraly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonNaryLERPNode extends AnimationNodeBase\r\n{\r\n\tpublic _iInputs:Array<AnimationNodeBase> = new Array<AnimationNodeBase>();\r\n\r\n\tprivate _numInputs:number /*uint*/;\r\n\r\n\tpublic get numInputs():number /*uint*/\r\n\t{\r\n\t\treturn this._numInputs;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonNaryLERPNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonNaryLERPState;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an integer representing the input index of the given skeleton animation node.\r\n\t *\r\n\t * @param input The skeleton animation node for with the input index is requested.\r\n\t */\r\n\tpublic getInputIndex(input:AnimationNodeBase):number /*int*/\r\n\t{\r\n\t\treturn this._iInputs.indexOf(input);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the skeleton animation node object that resides at the given input index.\r\n\t *\r\n\t * @param index The input index for which the skeleton animation node is requested.\r\n\t */\r\n\tpublic getInputAt(index:number /*uint*/):AnimationNodeBase\r\n\t{\r\n\t\treturn this._iInputs[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a new skeleton animation node input to the animation node.\r\n\t */\r\n\tpublic addInput(input:AnimationNodeBase)\r\n\t{\r\n\t\tthis._iInputs[this._numInputs++] = input;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonNaryLERPState\r\n\t{\r\n\t\treturn <SkeletonNaryLERPState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = SkeletonNaryLERPNode",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\r\nimport VertexClipState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/VertexClipState\");\r\n\r\n/**\r\n * A vertex animation node containing time-based animation data as individual geometry obejcts.\r\n */\r\nclass VertexClipNode extends AnimationClipNodeBase\r\n{\r\n\tprivate _frames:Array<Geometry> = new Array<Geometry>();\r\n\tprivate _translations:Array<Vector3D> = new Array<Vector3D>();\r\n\r\n\t/**\r\n\t * Returns a vector of geometry frames representing the vertex values of each animation frame in the clip.\r\n\t */\r\n\tpublic get frames():Array<Geometry>\r\n\t{\r\n\t\treturn this._frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>VertexClipNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = VertexClipState;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a geometry object to the internal timeline of the animation node.\r\n\t *\r\n\t * @param geometry The geometry object to add to the timeline of the node.\r\n\t * @param duration The specified duration of the frame in milliseconds.\r\n\t * @param translation The absolute translation of the frame, used in root delta calculations for mesh movement.\r\n\t */\r\n\tpublic addFrame(geometry:Geometry, duration:number /*uint*/, translation:Vector3D = null)\r\n\t{\r\n\t\tthis._frames.push(geometry);\r\n\t\tthis._pDurations.push(duration);\r\n\t\tthis._translations.push(translation || new Vector3D());\r\n\r\n\t\tthis._pNumFrames = this._pDurations.length;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateStitch()\r\n\t{\r\n\t\tsuper._pUpdateStitch();\r\n\r\n\t\tvar i:number /*uint*/ = this._pNumFrames - 1;\r\n\t\tvar p1:Vector3D, p2:Vector3D, delta:Vector3D;\r\n\t\twhile (i--) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[i];\r\n\t\t\tp1 = this._translations[i];\r\n\t\t\tp2 = this._translations[i + 1];\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\r\n\t\tif (this._pNumFrames > 1 && (this._pStitchFinalFrame || !this._pLooping)) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[this._pNumFrames - 1];\r\n\t\t\tp1 = this._translations[0];\r\n\t\t\tp2 = this._translations[1];\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = VertexClipNode;",
    "import AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\n\r\n/**\r\n *\r\n */\r\nclass AnimationClipState extends AnimationStateBase\r\n{\r\n\tprivate _animationClipNode:AnimationClipNodeBase;\r\n\tprivate _animationStatePlaybackComplete:AnimationStateEvent;\r\n\tpublic _pBlendWeight:number;\r\n\tpublic _pCurrentFrame:number /*uint*/;\r\n\tpublic _pNextFrame:number /*uint*/;\r\n\r\n\tpublic _pOldFrame:number /*uint*/;\r\n\tpublic _pTimeDir:number /*int*/;\r\n\tpublic _pFramesDirty:boolean = true;\r\n\r\n\t/**\r\n\t * Returns a fractional value between 0 and 1 representing the blending ratio of the current playhead position\r\n\t * between the current frame (0) and next frame (1) of the animation.\r\n\t *\r\n\t * @see #currentFrame\r\n\t * @see #nextFrame\r\n\t */\r\n\tpublic get blendWeight():number\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._pBlendWeight;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get currentFrame():number /*uint*/\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._pCurrentFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the next frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get nextFrame():number /*uint*/\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._pNextFrame;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, animationClipNode:AnimationClipNodeBase)\r\n\t{\r\n\t\tsuper(animator, animationClipNode);\r\n\r\n\t\tthis._animationClipNode = animationClipNode;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic update(time:number /*int*/)\r\n\t{\r\n\t\tif (!this._animationClipNode.looping) {\r\n\t\t\tif (time > this._pStartTime + this._animationClipNode.totalDuration)\r\n\t\t\t\ttime = this._pStartTime + this._animationClipNode.totalDuration; else if (time < this._pStartTime)\r\n\t\t\t\ttime = this._pStartTime;\r\n\t\t}\r\n\r\n\t\tif (this._pTime == time - this._pStartTime)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tvar time:number /*int*/ = value*this._animationClipNode.totalDuration + this._pStartTime;\r\n\r\n\t\tif (this._pTime == time - this._pStartTime)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._pFramesDirty = true;\r\n\r\n\t\tthis._pTimeDir = (time - this._pStartTime > this._pTime)? 1 : -1;\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the nodes internal playhead to determine the current and next animation frame, and the blendWeight between the two.\r\n\t *\r\n\t * @see #currentFrame\r\n\t * @see #nextFrame\r\n\t * @see #blendWeight\r\n\t */\r\n\tpublic _pUpdateFrames()\r\n\t{\r\n\t\tthis._pFramesDirty = false;\r\n\r\n\t\tvar looping:boolean = this._animationClipNode.looping;\r\n\t\tvar totalDuration:number /*uint*/ = this._animationClipNode.totalDuration;\r\n\t\tvar lastFrame:number /*uint*/ = this._animationClipNode.lastFrame;\r\n\t\tvar time:number /*int*/ = this._pTime;\r\n\r\n\t\t//trace(\"time\", time, totalDuration)\r\n\t\tif (looping && (time >= totalDuration || time < 0)) {\r\n\t\t\ttime %= totalDuration;\r\n\t\t\tif (time < 0)\r\n\t\t\t\ttime += totalDuration;\r\n\t\t}\r\n\r\n\t\tif (!looping && time >= totalDuration) {\r\n\t\t\tthis.notifyPlaybackComplete();\r\n\t\t\tthis._pCurrentFrame = lastFrame;\r\n\t\t\tthis._pNextFrame = lastFrame;\r\n\t\t\tthis._pBlendWeight = 0;\r\n\t\t} else if (!looping && time <= 0) {\r\n\t\t\tthis._pCurrentFrame = 0;\r\n\t\t\tthis._pNextFrame = 0;\r\n\t\t\tthis._pBlendWeight = 0;\r\n\t\t} else if (this._animationClipNode.fixedFrameRate) {\r\n\t\t\tvar t:number = time/totalDuration*lastFrame;\r\n\t\t\tthis._pCurrentFrame = Math.floor(t);\r\n\t\t\tthis._pBlendWeight = t - this._pCurrentFrame;\r\n\t\t\tthis._pNextFrame = this._pCurrentFrame + 1;\r\n\t\t} else {\r\n\t\t\tthis._pCurrentFrame = 0;\r\n\t\t\tthis._pNextFrame = 0;\r\n\r\n\t\t\tvar dur:number /*uint*/ = 0, frameTime:number /*uint*/;\r\n\t\t\tvar durations:Array<number> /*uint*/ = this._animationClipNode.durations;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tframeTime = dur;\r\n\t\t\t\tdur += durations[this._pNextFrame];\r\n\t\t\t\tthis._pCurrentFrame = this._pNextFrame++;\r\n\t\t\t} while (time > dur);\r\n\r\n\t\t\tif (this._pCurrentFrame == lastFrame) {\r\n\t\t\t\tthis._pCurrentFrame = 0;\r\n\t\t\t\tthis._pNextFrame = 1;\r\n\t\t\t}\r\n\r\n\t\t\tthis._pBlendWeight = (time - frameTime)/durations[this._pCurrentFrame];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate notifyPlaybackComplete()\r\n\t{\r\n\t\tif (this._animationStatePlaybackComplete == null)\r\n\t\t\tthis._animationStatePlaybackComplete = new AnimationStateEvent(AnimationStateEvent.PLAYBACK_COMPLETE, this._pAnimator, this, this._animationClipNode);\r\n\r\n\t\tthis._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete);\r\n\t}\r\n}\r\n\r\nexport = AnimationClipState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport IAnimationState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\r\n\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\n\r\n/**\r\n *\r\n */\r\nclass AnimationStateBase implements IAnimationState\r\n{\r\n\tpublic _pAnimationNode:AnimationNodeBase;\r\n\tpublic _pRootDelta:Vector3D = new Vector3D();\r\n\tpublic _pPositionDeltaDirty:boolean = true;\r\n\r\n\tpublic _pTime:number;\r\n\tpublic _pStartTime:number = 0;\r\n\tpublic _pAnimator:AnimatorBase;\r\n\r\n\t/**\r\n\t * Returns a 3d vector representing the translation delta of the animating entity for the current timestep of animation\r\n\t */\r\n\tpublic get positionDelta():Vector3D\r\n\t{\r\n\t\tif (this._pPositionDeltaDirty) {\r\n\r\n\t\t\tthis._pUpdatePositionDelta();\r\n\t\t}\r\n\r\n\t\treturn this._pRootDelta;\r\n\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, animationNode:AnimationNodeBase)\r\n\t{\r\n\t\tthis._pAnimator = animator;\r\n\t\tthis._pAnimationNode = animationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the start time of the node to a  new value.\r\n\t *\r\n\t * @param startTime The absolute start time (in milliseconds) of the node's starting time.\r\n\t */\r\n\tpublic offset(startTime:number)\r\n\t{\r\n\t\tthis._pStartTime = startTime;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the configuration of the node to its current state.\r\n\t *\r\n\t * @param time The absolute time (in milliseconds) of the animator's play head position.\r\n\t *\r\n\t * @see AnimatorBase#update()\r\n\t */\r\n\tpublic update(time:number)\r\n\t{\r\n\t\tif (this._pTime == time - this._pStartTime) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tthis._pUpdateTime(time);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the animation phase of the node.\r\n\t *\r\n\t * @param value The phase value to use. 0 represents the beginning of an animation clip, 1 represents the end.\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the node's internal playhead position.\r\n\t *\r\n\t * @param time The local time (in milliseconds) of the node's playhead position.\r\n\t */\r\n\tpublic _pUpdateTime(time:number)\r\n\t{\r\n\t\tthis._pTime = time - this._pStartTime;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the node's root delta position\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t}\r\n}\r\n\r\nexport = AnimationStateBase;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleAccelerationNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleAccelerationState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static ACCELERATION_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _particleAccelerationNode:ParticleAccelerationNode;\r\n\tprivate _acceleration:Vector3D;\r\n\tprivate _halfAcceleration:Vector3D;\r\n\t\r\n\t/**\r\n\t * Defines the acceleration vector of the state, used when in global mode.\r\n\t */\r\n\tpublic get acceleration():Vector3D\r\n\t{\r\n\t\treturn this._acceleration;\r\n\t}\r\n\t\r\n\tpublic set acceleration(value:Vector3D)\r\n\t{\r\n\t\tthis._acceleration.x = value.x;\r\n\t\tthis._acceleration.y = value.y;\r\n\t\tthis._acceleration.z = value.z;\r\n\r\n\t\tthis.updateAccelerationData();\r\n\t}\r\n\t\r\n\tconstructor(animator:ParticleAnimator, particleAccelerationNode:ParticleAccelerationNode)\r\n\t{\r\n\t\tsuper(animator, particleAccelerationNode);\r\n\r\n\t\tthis._particleAccelerationNode = particleAccelerationNode;\r\n\t\tthis._acceleration = this._particleAccelerationNode._acceleration;\r\n\r\n\t\tthis.updateAccelerationData();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleAccelerationState.ACCELERATION_INDEX);\r\n\t\t\r\n\t\tif (this._particleAccelerationNode.mode == ParticlePropertiesMode.LOCAL_STATIC)\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleAccelerationNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\telse\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._halfAcceleration.x, this._halfAcceleration.y, this._halfAcceleration.z);\r\n\t}\r\n\t\r\n\tprivate updateAccelerationData()\r\n\t{\r\n\t\tif (this._particleAccelerationNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tthis._halfAcceleration = new Vector3D(this._acceleration.x/2, this._acceleration.y/2, this._acceleration.z/2);\r\n\t}\r\n}\r\n\r\nexport = ParticleAccelerationState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleBezierCurveNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n/**\r\n * ...\r\n */\r\nclass ParticleBezierCurveState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static BEZIER_CONTROL_INDEX:number /*int*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static BEZIER_END_INDEX:number /*int*/ = 1;\r\n\r\n\tprivate _particleBezierCurveNode:ParticleBezierCurveNode;\r\n\tprivate _controlPoint:Vector3D;\r\n\tprivate _endPoint:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default control point of the node, used when in global mode.\r\n\t */\r\n\tpublic get controlPoint():Vector3D\r\n\t{\r\n\t\treturn this._controlPoint;\r\n\t}\r\n\r\n\tpublic set controlPoint(value:Vector3D)\r\n\t{\r\n\t\tthis._controlPoint = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the default end point of the node, used when in global mode.\r\n\t */\r\n\tpublic get endPoint():Vector3D\r\n\t{\r\n\t\treturn this._endPoint;\r\n\t}\r\n\r\n\tpublic set endPoint(value:Vector3D)\r\n\t{\r\n\t\tthis._endPoint = value;\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleBezierCurveNode:ParticleBezierCurveNode)\r\n\t{\r\n\t\tsuper(animator, particleBezierCurveNode);\r\n\r\n\t\tthis._particleBezierCurveNode = particleBezierCurveNode;\r\n\t\tthis._controlPoint = this._particleBezierCurveNode._iControlPoint;\r\n\t\tthis._endPoint = this._particleBezierCurveNode._iEndPoint;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar controlIndex:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBezierCurveState.BEZIER_CONTROL_INDEX);\r\n\t\tvar endIndex:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBezierCurveState.BEZIER_END_INDEX);\r\n\r\n\t\tif (this._particleBezierCurveNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(controlIndex, this._particleBezierCurveNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(endIndex, this._particleBezierCurveNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else {\r\n\t\t\tanimationRegisterCache.setVertexConst(controlIndex, this._controlPoint.x, this._controlPoint.y, this._controlPoint.z);\r\n\t\t\tanimationRegisterCache.setVertexConst(endIndex, this._endPoint.x, this._endPoint.y, this._endPoint.z);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleBezierCurveState;",
    "import MathConsts\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport Orientation3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Orientation3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleBillboardNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleBillboardState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _matrix:Matrix3D = new Matrix3D;\r\n\r\n\tprivate _billboardAxis:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleBillboardNode)\r\n\t{\r\n\t\tsuper(animator, particleNode);\r\n\r\n\t\tthis._billboardAxis = particleNode._iBillboardAxis;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar comps:Array<Vector3D>;\r\n\t\tif (this._billboardAxis) {\r\n\t\t\tvar pos:Vector3D = renderable.sourceEntity.sceneTransform.position;\r\n\t\t\tvar look:Vector3D = camera.sceneTransform.position.subtract(pos);\r\n\t\t\tvar right:Vector3D = look.crossProduct(this._billboardAxis);\r\n\t\t\tright.normalize();\r\n\t\t\tlook = this.billboardAxis.crossProduct(right);\r\n\t\t\tlook.normalize();\r\n\r\n\t\t\t//create a quick inverse projection matrix\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tcomps = this._matrix.decompose(Orientation3D.AXIS_ANGLE);\r\n\t\t\tthis._matrix.copyColumnFrom(0, right);\r\n\t\t\tthis._matrix.copyColumnFrom(1, this.billboardAxis);\r\n\t\t\tthis._matrix.copyColumnFrom(2, look);\r\n\t\t\tthis._matrix.copyColumnFrom(3, pos);\r\n\t\t\tthis._matrix.appendRotation(-comps[1].w*MathConsts.RADIANS_TO_DEGREES, comps[1]);\r\n\t\t} else {\r\n\t\t\t//create a quick inverse projection matrix\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\r\n\r\n\t\t\t//decompose using axis angle rotations\r\n\t\t\tcomps = this._matrix.decompose(Orientation3D.AXIS_ANGLE);\r\n\r\n\t\t\t//recreate the matrix with just the rotation data\r\n\t\t\tthis._matrix.identity();\r\n\t\t\tthis._matrix.appendRotation(-comps[1].w*MathConsts.RADIANS_TO_DEGREES, comps[1]);\r\n\t\t}\r\n\r\n\t\t//set a new matrix transform constant\r\n\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBillboardState.MATRIX_INDEX), this._matrix);\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the billboard axis.\r\n\t */\r\n\tpublic get billboardAxis():Vector3D\r\n\t{\r\n\t\treturn this.billboardAxis;\r\n\t}\r\n\r\n\tpublic set billboardAxis(value:Vector3D)\r\n\t{\r\n\t\tthis.billboardAxis = value? value.clone() : null;\r\n\t\tif (this.billboardAxis)\r\n\t\t\tthis.billboardAxis.normalize();\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleBillboardState;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleColorNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleColorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n * @author ...\r\n */\r\nclass ParticleColorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static START_MULTIPLIER_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static DELTA_MULTIPLIER_INDEX:number /*uint*/ = 1;\r\n\r\n\t/** @private */\r\n\tpublic static START_OFFSET_INDEX:number /*uint*/ = 2;\r\n\r\n\t/** @private */\r\n\tpublic static DELTA_OFFSET_INDEX:number /*uint*/ = 3;\r\n\r\n\t/** @private */\r\n\tpublic static CYCLE_INDEX:number /*uint*/ = 4;\r\n\r\n\tprivate _particleColorNode:ParticleColorNode;\r\n\tprivate _usesMultiplier:boolean;\r\n\tprivate _usesOffset:boolean;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _startColor:ColorTransform;\r\n\tprivate _endColor:ColorTransform;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _cycleData:Vector3D;\r\n\tprivate _startMultiplierData:Vector3D;\r\n\tprivate _deltaMultiplierData:Vector3D;\r\n\tprivate _startOffsetData:Vector3D;\r\n\tprivate _deltaOffsetData:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the start color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get startColor():ColorTransform\r\n\t{\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tpublic set startColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._startColor = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the end color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get endColor():ColorTransform\r\n\t{\r\n\t\treturn this._endColor;\r\n\t}\r\n\r\n\tpublic set endColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._endColor = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleColorNode:ParticleColorNode)\r\n\t{\r\n\t\tsuper(animator, particleColorNode);\r\n\r\n\t\tthis._particleColorNode = particleColorNode;\r\n\t\tthis._usesMultiplier = this._particleColorNode._iUsesMultiplier;\r\n\t\tthis._usesOffset = this._particleColorNode._iUsesOffset;\r\n\t\tthis._usesCycle = this._particleColorNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleColorNode._iUsesPhase;\r\n\t\tthis._startColor = this._particleColorNode._iStartColor;\r\n\t\tthis._endColor = this._particleColorNode._iEndColor;\r\n\t\tthis._cycleDuration = this._particleColorNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleColorNode._iCyclePhase;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tvar dataOffset:number /*uint*/ = this._particleColorNode._iDataOffset;\r\n\t\t\tif (this._usesCycle)\r\n\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.CYCLE_INDEX), this._cycleData.x, this._cycleData.y, this._cycleData.z, this._cycleData.w);\r\n\r\n\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_MULTIPLIER_INDEX), this._startMultiplierData.x, this._startMultiplierData.y, this._startMultiplierData.z, this._startMultiplierData.w);\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_MULTIPLIER_INDEX), this._deltaMultiplierData.x, this._deltaMultiplierData.y, this._deltaMultiplierData.z, this._deltaMultiplierData.w);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._usesOffset) {\r\n\t\t\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_OFFSET_INDEX), this._startOffsetData.x, this._startOffsetData.y, this._startOffsetData.z, this._startOffsetData.w);\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_OFFSET_INDEX), this._deltaOffsetData.x, this._deltaOffsetData.y, this._deltaOffsetData.z, this._deltaOffsetData.w);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateColorData()\r\n\t{\r\n\t\tif (this._usesCycle) {\r\n\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tthis._cycleData = new Vector3D(Math.PI*2/this._cycleDuration, this._cyclePhase*Math.PI/180, 0, 0);\r\n\t\t}\r\n\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\t\tthis._startMultiplierData = new Vector3D((this._startColor.redMultiplier + this._endColor.redMultiplier)/2, (this._startColor.greenMultiplier + this._endColor.greenMultiplier)/2, (this._startColor.blueMultiplier + this._endColor.blueMultiplier)/2, (this._startColor.alphaMultiplier + this._endColor.alphaMultiplier)/2);\r\n\t\t\t\t\tthis._deltaMultiplierData = new Vector3D((this._endColor.redMultiplier - this._startColor.redMultiplier)/2, (this._endColor.greenMultiplier - this._startColor.greenMultiplier)/2, (this._endColor.blueMultiplier - this._startColor.blueMultiplier)/2, (this._endColor.alphaMultiplier - this._startColor.alphaMultiplier)/2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._usesOffset) {\r\n\t\t\t\t\tthis._startOffsetData = new Vector3D((this._startColor.redOffset + this._endColor.redOffset)/(255*2), (this._startColor.greenOffset + this._endColor.greenOffset)/(255*2), (this._startColor.blueOffset + this._endColor.blueOffset)/(255*2), (this._startColor.alphaOffset + this._endColor.alphaOffset)/(255*2));\r\n\t\t\t\t\tthis._deltaOffsetData = new Vector3D((this._endColor.redOffset - this._startColor.redOffset)/(255*2), (this._endColor.greenOffset - this._startColor.greenOffset)/(255*2), (this._endColor.blueOffset - this._startColor.blueOffset)/(255*2), (this._endColor.alphaOffset - this._startColor.alphaOffset)/(255*2));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\t\tthis._startMultiplierData = new Vector3D(this._startColor.redMultiplier, this._startColor.greenMultiplier, this._startColor.blueMultiplier, this._startColor.alphaMultiplier);\r\n\t\t\t\t\tthis._deltaMultiplierData = new Vector3D((this._endColor.redMultiplier - this._startColor.redMultiplier), (this._endColor.greenMultiplier - this._startColor.greenMultiplier), (this._endColor.blueMultiplier - this._startColor.blueMultiplier), (this._endColor.alphaMultiplier - this._startColor.alphaMultiplier));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._usesOffset) {\r\n\t\t\t\t\tthis._startOffsetData = new Vector3D(this._startColor.redOffset/255, this._startColor.greenOffset/255, this._startColor.blueOffset/255, this._startColor.alphaOffset/255);\r\n\t\t\t\t\tthis._deltaOffsetData = new Vector3D((this._endColor.redOffset - this._startColor.redOffset)/255, (this._endColor.greenOffset - this._startColor.greenOffset)/255, (this._endColor.blueOffset - this._startColor.blueOffset )/255, (this._endColor.alphaOffset - this._startColor.alphaOffset)/255);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleColorState;",
    "import MathConsts\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticleFollowNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleFollowState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static FOLLOW_POSITION_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static FOLLOW_ROTATION_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleFollowNode:ParticleFollowNode;\r\n\tprivate _followTarget:DisplayObject;\r\n\r\n\tprivate _targetPos:Vector3D = new Vector3D();\r\n\tprivate _targetEuler:Vector3D = new Vector3D();\r\n\tprivate _prePos:Vector3D;\r\n\tprivate _preEuler:Vector3D;\r\n\tprivate _smooth:boolean;\r\n\r\n\t//temporary vector3D for calculation\r\n\tprivate _temp:Vector3D = new Vector3D();\r\n\r\n\tconstructor(animator:ParticleAnimator, particleFollowNode:ParticleFollowNode)\r\n\t{\r\n\t\tsuper(animator, particleFollowNode, true);\r\n\r\n\t\tthis._particleFollowNode = particleFollowNode;\r\n\t\tthis._smooth = particleFollowNode._iSmooth;\r\n\t}\r\n\r\n\tpublic get followTarget():DisplayObject\r\n\t{\r\n\t\treturn this._followTarget;\r\n\t}\r\n\r\n\tpublic set followTarget(value:DisplayObject)\r\n\t{\r\n\t\tthis._followTarget = value;\r\n\t}\r\n\r\n\tpublic get smooth():boolean\r\n\t{\r\n\t\treturn this._smooth;\r\n\t}\r\n\r\n\tpublic set smooth(value:boolean)\r\n\t{\r\n\t\tthis._smooth = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._followTarget) {\r\n\t\t\tif (this._particleFollowNode._iUsesPosition) {\r\n\t\t\t\tthis._targetPos.x = this._followTarget.transform.position.x/renderable.sourceEntity.scaleX;\r\n\t\t\t\tthis._targetPos.y = this._followTarget.transform.position.y/renderable.sourceEntity.scaleY;\r\n\t\t\t\tthis._targetPos.z = this._followTarget.transform.position.z/renderable.sourceEntity.scaleZ;\r\n\t\t\t}\r\n\t\t\tif (this._particleFollowNode._iUsesRotation) {\r\n\t\t\t\tthis._targetEuler.x = this._followTarget.rotationX;\r\n\t\t\t\tthis._targetEuler.y = this._followTarget.rotationY;\r\n\t\t\t\tthis._targetEuler.z = this._followTarget.rotationZ;\r\n\t\t\t\tthis._targetEuler.scaleBy(MathConsts.DEGREES_TO_RADIANS);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//initialization\r\n\t\tif (!this._prePos)\r\n\t\t\tthis._prePos = this._targetPos.clone();\r\n\t\tif (!this._preEuler)\r\n\t\t\tthis._preEuler = this._targetEuler.clone();\r\n\r\n\t\tvar currentTime:number = this._pTime/1000;\r\n\t\tvar previousTime:number = animationSubGeometry.previousTime;\r\n\t\tvar deltaTime:number = currentTime - previousTime;\r\n\r\n\t\tvar needProcess:boolean = previousTime != currentTime;\r\n\r\n\t\tif (this._particleFollowNode._iUsesPosition && this._particleFollowNode._iUsesRotation) {\r\n\t\t\tif (needProcess)\r\n\t\t\t\tthis.processPositionAndRotation(currentTime, deltaTime, animationSubGeometry);\r\n\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else if (this._particleFollowNode._iUsesPosition) {\r\n\t\t\tif (needProcess)\r\n\t\t\t\tthis.processPosition(currentTime, deltaTime, animationSubGeometry);\r\n\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else if (this._particleFollowNode._iUsesRotation) {\r\n\t\t\tif (needProcess)\r\n\t\t\t\tthis.precessRotation(currentTime, deltaTime, animationSubGeometry);\r\n\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t}\r\n\r\n\t\tthis._prePos.copyFrom(this._targetPos);\r\n\t\tthis._targetEuler.copyFrom(this._targetEuler);\r\n\t\tanimationSubGeometry.previousTime = currentTime;\r\n\t}\r\n\r\n\tprivate processPosition(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\r\n\t\tvar changed:boolean = false;\r\n\t\tvar len:number /*uint*/ = data.length;\r\n\t\tvar interpolatedPos:Vector3D;\r\n\t\tvar posVelocity:Vector3D;\r\n\t\tif (this._smooth) {\r\n\t\t\tposVelocity = this._prePos.subtract(this._targetPos);\r\n\t\t\tposVelocity.scaleBy(1/deltaTime);\r\n\t\t} else\r\n\t\t\tinterpolatedPos = this._targetPos;\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\r\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\r\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\r\n\t\t\tif (t - deltaTime <= 0) {\r\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\r\n\r\n\t\t\t\tif (this._smooth) {\r\n\t\t\t\t\tthis._temp.copyFrom(posVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedPos = this._targetPos.add(this._temp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (changed)\r\n\t\t\tanimationSubGeometry.invalidateBuffer();\r\n\r\n\t}\r\n\r\n\tprivate precessRotation(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\r\n\t\tvar changed:boolean = false;\r\n\t\tvar len:number /*uint*/ = data.length;\r\n\r\n\t\tvar interpolatedRotation:Vector3D;\r\n\t\tvar rotationVelocity:Vector3D;\r\n\r\n\t\tif (this._smooth) {\r\n\t\t\trotationVelocity = this._preEuler.subtract(this._targetEuler);\r\n\t\t\trotationVelocity.scaleBy(1/deltaTime);\r\n\t\t} else\r\n\t\t\tinterpolatedRotation = this._targetEuler;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\r\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\r\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\r\n\t\t\tif (t - deltaTime <= 0) {\r\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\r\n\r\n\t\t\t\tif (this._smooth) {\r\n\t\t\t\t\tthis._temp.copyFrom(rotationVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedRotation = this._targetEuler.add(this._temp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (vertexData[inc] != interpolatedRotation.x || vertexData[inc + 1] != interpolatedRotation.y || vertexData[inc + 2] != interpolatedRotation.z) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (changed)\r\n\t\t\tanimationSubGeometry.invalidateBuffer();\r\n\r\n\t}\r\n\r\n\tprivate processPositionAndRotation(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\r\n\t\tvar changed:boolean = false;\r\n\t\tvar len:number /*uint*/ = data.length;\r\n\r\n\t\tvar interpolatedPos:Vector3D;\r\n\t\tvar interpolatedRotation:Vector3D;\r\n\r\n\t\tvar posVelocity:Vector3D;\r\n\t\tvar rotationVelocity:Vector3D;\r\n\t\tif (this._smooth) {\r\n\t\t\tposVelocity = this._prePos.subtract(this._targetPos);\r\n\t\t\tposVelocity.scaleBy(1/deltaTime);\r\n\t\t\trotationVelocity = this._preEuler.subtract(this._targetEuler);\r\n\t\t\trotationVelocity.scaleBy(1/deltaTime);\r\n\t\t} else {\r\n\t\t\tinterpolatedPos = this._targetPos;\r\n\t\t\tinterpolatedRotation = this._targetEuler;\r\n\t\t}\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\r\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\r\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\r\n\t\t\tif (t - deltaTime <= 0) {\r\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\r\n\t\t\t\tif (this._smooth) {\r\n\t\t\t\t\tthis._temp.copyFrom(posVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedPos = this._targetPos.add(this._temp);\r\n\r\n\t\t\t\t\tthis._temp.copyFrom(rotationVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedRotation = this._targetEuler.add(this._temp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z || vertexData[inc + 3] != interpolatedRotation.x || vertexData[inc + 4] != interpolatedRotation.y || vertexData[inc + 5] != interpolatedRotation.z) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.z;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (changed)\r\n\t\t\tanimationSubGeometry.invalidateBuffer();\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleFollowState;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleInitialColorNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n*\r\n*/\r\nclass ParticleInitialColorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MULTIPLIER_INDEX:number /*uint*/ = 0;\r\n\t/** @private */\r\n\tpublic static OFFSET_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleInitialColorNode:ParticleInitialColorNode;\r\n\tprivate _usesMultiplier:boolean;\r\n\tprivate _usesOffset:boolean;\r\n\tprivate _initialColor:ColorTransform;\r\n\tprivate _multiplierData:Vector3D;\r\n\tprivate _offsetData:Vector3D;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleInitialColorNode:ParticleInitialColorNode)\r\n\t{\r\n\t\tsuper(animator, particleInitialColorNode);\r\n\r\n\t\tthis._particleInitialColorNode = particleInitialColorNode;\r\n\t\tthis._usesMultiplier = particleInitialColorNode._iUsesMultiplier;\r\n\t\tthis._usesOffset = particleInitialColorNode._iUsesOffset;\r\n\t\tthis._initialColor = particleInitialColorNode._iInitialColor;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the initial color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get initialColor():ColorTransform\r\n\t{\r\n\t\treturn this._initialColor;\r\n\t}\r\n\r\n\tpublic set initialColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._initialColor = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\t// TODO: not used\r\n\t\trenderable = renderable;\r\n\t\tcamera = camera;\r\n\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tif (this._particleInitialColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\tvar dataOffset:number /*uint*/ = this._particleInitialColorNode._iDataOffset;\r\n\t\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._usesOffset)\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t} else {\r\n\t\t\t\tif (this._usesMultiplier)\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), this._multiplierData.x, this._multiplierData.y, this._multiplierData.z, this._multiplierData.w);\r\n\t\t\t\tif (this._usesOffset)\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), this._offsetData.x, this._offsetData.y, this._offsetData.z, this._offsetData.w);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateColorData()\r\n\t{\r\n\t\tif (this._particleInitialColorNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._usesMultiplier)\r\n\t\t\t\tthis._multiplierData = new Vector3D(this._initialColor.redMultiplier, this._initialColor.greenMultiplier, this._initialColor.blueMultiplier, this._initialColor.alphaMultiplier);\r\n\t\t\tif (this._usesOffset)\r\n\t\t\t\tthis._offsetData = new Vector3D(this._initialColor.redOffset/255, this._initialColor.greenOffset/255, this._initialColor.blueOffset/255, this._initialColor.alphaOffset/255);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleInitialColorState;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleOrbitNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleOrbitState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static ORBIT_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static EULERS_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleOrbitNode:ParticleOrbitNode;\r\n\tprivate _usesEulers:boolean;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _radius:number;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _eulers:Vector3D;\r\n\tprivate _orbitData:Vector3D;\r\n\tprivate _eulersMatrix:Matrix3D;\r\n\r\n\t/**\r\n\t * Defines the radius of the orbit when in global mode. Defaults to 100.\r\n\t */\r\n\tpublic get radius():number\r\n\t{\r\n\t\treturn this._radius;\r\n\t}\r\n\r\n\tpublic set radius(value:number)\r\n\t{\r\n\t\tthis._radius = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the duration of the orbit in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the phase of the orbit in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the euler rotation in degrees, applied to the orientation of the orbit when in global mode.\r\n\t */\r\n\tpublic get eulers():Vector3D\r\n\t{\r\n\t\treturn this._eulers;\r\n\t}\r\n\r\n\tpublic set eulers(value:Vector3D)\r\n\t{\r\n\t\tthis._eulers = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleOrbitNode:ParticleOrbitNode)\r\n\t{\r\n\t\tsuper(animator, particleOrbitNode);\r\n\r\n\t\tthis._particleOrbitNode = particleOrbitNode;\r\n\t\tthis._usesEulers = this._particleOrbitNode._iUsesEulers;\r\n\t\tthis._usesCycle = this._particleOrbitNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleOrbitNode._iUsesPhase;\r\n\t\tthis._eulers = this._particleOrbitNode._iEulers;\r\n\t\tthis._radius = this._particleOrbitNode._iRadius;\r\n\t\tthis._cycleDuration = this._particleOrbitNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleOrbitNode._iCyclePhase;\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOrbitState.ORBIT_INDEX);\r\n\r\n\t\tif (this._particleOrbitNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tif (this._usesPhase)\r\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOrbitNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\telse\r\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOrbitNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._orbitData.x, this._orbitData.y, this._orbitData.z, this._orbitData.w);\r\n\r\n\t\tif (this._usesEulers)\r\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOrbitState.EULERS_INDEX), this._eulersMatrix);\r\n\t}\r\n\r\n\tprivate updateOrbitData()\r\n\t{\r\n\t\tif (this._usesEulers) {\r\n\t\t\tthis._eulersMatrix = new Matrix3D();\r\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.x, Vector3D.X_AXIS);\r\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.y, Vector3D.Y_AXIS);\r\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.z, Vector3D.Z_AXIS);\r\n\t\t}\r\n\t\tif (this._particleOrbitNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tthis._orbitData = new Vector3D(this._radius, 0, this._radius*Math.PI*2, this._cyclePhase*Math.PI/180);\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\t\tthis._orbitData.y = Math.PI*2/this._cycleDuration;\r\n\t\t\t} else\r\n\t\t\t\tthis._orbitData.y = Math.PI*2;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleOrbitState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleOscillatorNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleOscillatorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static OSCILLATOR_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleOscillatorNode:ParticleOscillatorNode;\r\n\tprivate _oscillator:Vector3D;\r\n\tprivate _oscillatorData:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default oscillator axis (x, y, z) and cycleDuration (w) of the state, used when in global mode.\r\n\t */\r\n\tpublic get oscillator():Vector3D\r\n\t{\r\n\t\treturn this._oscillator;\r\n\t}\r\n\r\n\tpublic set oscillator(value:Vector3D)\r\n\t{\r\n\t\tthis._oscillator = value;\r\n\r\n\t\tthis.updateOscillatorData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleOscillatorNode:ParticleOscillatorNode)\r\n\t{\r\n\t\tsuper(animator, particleOscillatorNode);\r\n\r\n\t\tthis._particleOscillatorNode = particleOscillatorNode;\r\n\t\tthis._oscillator = this._particleOscillatorNode._iOscillator;\r\n\r\n\t\tthis.updateOscillatorData();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOscillatorState.OSCILLATOR_INDEX);\r\n\r\n\t\tif (this._particleOscillatorNode.mode == ParticlePropertiesMode.LOCAL_STATIC)\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOscillatorNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\telse\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._oscillatorData.x, this._oscillatorData.y, this._oscillatorData.z, this._oscillatorData.w);\r\n\t}\r\n\r\n\tprivate updateOscillatorData()\r\n\t{\r\n\t\tif (this._particleOscillatorNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._oscillator.w <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\r\n\t\t\tif (this._oscillatorData == null)\r\n\t\t\t\tthis._oscillatorData = new Vector3D();\r\n\r\n\t\t\tthis._oscillatorData.x = this._oscillator.x;\r\n\t\t\tthis._oscillatorData.y = this._oscillator.y;\r\n\t\t\tthis._oscillatorData.z = this._oscillator.z;\r\n\t\t\tthis._oscillatorData.w = Math.PI*2/this._oscillator.w;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleOscillatorState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticlePositionNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n * @author ...\r\n */\r\nclass ParticlePositionState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static POSITION_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particlePositionNode:ParticlePositionNode;\r\n\tprivate _position:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the position of the particle when in global mode. Defaults to 0,0,0.\r\n\t */\r\n\tpublic get position():Vector3D\r\n\t{\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tpublic set position(value:Vector3D)\r\n\t{\r\n\t\tthis._position = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getPositions():Array<Vector3D>\r\n\t{\r\n\t\treturn this._pDynamicProperties;\r\n\t}\r\n\r\n\tpublic setPositions(value:Array<Vector3D>)\r\n\t{\r\n\t\tthis._pDynamicProperties = value;\r\n\r\n\t\tthis._pDynamicPropertiesDirty = new Object();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particlePositionNode:ParticlePositionNode)\r\n\t{\r\n\t\tsuper(animator, particlePositionNode);\r\n\r\n\t\tthis._particlePositionNode = particlePositionNode;\r\n\t\tthis._position = this._particlePositionNode._iPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._particlePositionNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\r\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\r\n\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticlePositionState.POSITION_INDEX);\r\n\r\n\t\tif (this._particlePositionNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._position.x, this._position.y, this._position.z);\r\n\t\telse\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particlePositionNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t}\r\n}\r\n\r\nexport = ParticlePositionState;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotateToHeadingNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleRotateToHeadingState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _matrix:Matrix3D = new Matrix3D();\r\n\r\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleNodeBase)\r\n\t{\r\n\t\tsuper(animator, particleNode);\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\r\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToHeadingState.MATRIX_INDEX), this._matrix);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleRotateToHeadingState;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleRotateToPositionNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleRotateToPositionState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\r\n\t/** @private */\r\n\tpublic static POSITION_INDEX:number /*int*/ = 1;\r\n\r\n\tprivate _particleRotateToPositionNode:ParticleRotateToPositionNode;\r\n\tprivate _position:Vector3D;\r\n\tprivate _matrix:Matrix3D = new Matrix3D();\r\n\tprivate _offset:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the position of the point the particle will rotate to face when in global mode. Defaults to 0,0,0.\r\n\t */\r\n\tpublic get position():Vector3D\r\n\t{\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tpublic set position(value:Vector3D)\r\n\t{\r\n\t\tthis._position = value;\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleRotateToPositionNode:ParticleRotateToPositionNode)\r\n\t{\r\n\t\tsuper(animator, particleRotateToPositionNode);\r\n\r\n\t\tthis._particleRotateToPositionNode = particleRotateToPositionNode;\r\n\t\tthis._position = this._particleRotateToPositionNode._iPosition;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToPositionState.POSITION_INDEX);\r\n\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\r\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToPositionState.MATRIX_INDEX), this._matrix);\r\n\t\t}\r\n\r\n\t\tif (this._particleRotateToPositionNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tthis._offset = renderable.sourceEntity.inverseSceneTransform.transformVector(this._position);\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._offset.x, this._offset.y, this._offset.z);\r\n\t\t} else\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleRotateToPositionNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleRotateToPositionState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleRotationalVelocityNode\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleRotationalVelocityState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static ROTATIONALVELOCITY_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleRotationalVelocityNode:ParticleRotationalVelocityNode;\r\n\tprivate _rotationalVelocityData:Vector3D;\r\n\tprivate _rotationalVelocity:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default rotationalVelocity of the state, used when in global mode.\r\n\t */\r\n\tpublic get rotationalVelocity():Vector3D\r\n\t{\r\n\t\treturn this._rotationalVelocity;\r\n\t}\r\n\r\n\tpublic set rotationalVelocity(value:Vector3D)\r\n\t{\r\n\t\tthis._rotationalVelocity = value;\r\n\r\n\t\tthis.updateRotationalVelocityData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getRotationalVelocities():Array<Vector3D>\r\n\t{\r\n\t\treturn this._pDynamicProperties;\r\n\t}\r\n\r\n\tpublic setRotationalVelocities(value:Array<Vector3D>)\r\n\t{\r\n\t\tthis._pDynamicProperties = value;\r\n\r\n\t\tthis._pDynamicPropertiesDirty = new Object();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleRotationNode:ParticleRotationalVelocityNode)\r\n\t{\r\n\t\tsuper(animator, particleRotationNode);\r\n\r\n\t\tthis._particleRotationalVelocityNode = particleRotationNode;\r\n\t\tthis._rotationalVelocity = this._particleRotationalVelocityNode._iRotationalVelocity;\r\n\r\n\t\tthis.updateRotationalVelocityData();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\r\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\r\n\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX);\r\n\r\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._rotationalVelocityData.x, this._rotationalVelocityData.y, this._rotationalVelocityData.z, this._rotationalVelocityData.w);\r\n\t\telse\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleRotationalVelocityNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t}\r\n\r\n\tprivate updateRotationalVelocityData()\r\n\t{\r\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._rotationalVelocity.w <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\t\t\tvar rotation:Vector3D = this._rotationalVelocity.clone();\r\n\r\n\t\t\tif (rotation.length <= 0)\r\n\t\t\t\trotation.z = 1; //set the default direction\r\n\t\t\telse\r\n\t\t\t\trotation.normalize();\r\n\t\t\t// w is used as angle/2 in agal\r\n\t\t\tthis._rotationalVelocityData = new Vector3D(rotation.x, rotation.y, rotation.z, Math.PI/rotation.w);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleRotationalVelocityState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleScaleNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleScaleState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static SCALE_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleScaleNode:ParticleScaleNode;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _minScale:number;\r\n\tprivate _maxScale:number;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _scaleData:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the end scale of the state, when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get minScale():number\r\n\t{\r\n\t\treturn this._minScale;\r\n\t}\r\n\r\n\tpublic set minScale(value:number)\r\n\t{\r\n\t\tthis._minScale = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the end scale of the state, when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get maxScale():number\r\n\t{\r\n\t\treturn this._maxScale;\r\n\t}\r\n\r\n\tpublic set maxScale(value:number)\r\n\t{\r\n\t\tthis._maxScale = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleScaleNode:ParticleScaleNode)\r\n\t{\r\n\t\tsuper(animator, particleScaleNode);\r\n\r\n\t\tthis._particleScaleNode = particleScaleNode;\r\n\t\tthis._usesCycle = this._particleScaleNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleScaleNode._iUsesPhase;\r\n\t\tthis._minScale = this._particleScaleNode._iMinScale;\r\n\t\tthis._maxScale = this._particleScaleNode._iMaxScale;\r\n\t\tthis._cycleDuration = this._particleScaleNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleScaleNode._iCyclePhase;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleScaleState.SCALE_INDEX);\r\n\r\n\t\tif (this._particleScaleNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._usesPhase)\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\telse\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\t} else\r\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t} else\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._scaleData.x, this._scaleData.y, this._scaleData.z, this._scaleData.w);\r\n\t}\r\n\r\n\tprivate updateScaleData()\r\n\t{\r\n\t\tif (this._particleScaleNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\t\tthis._scaleData = new Vector3D((this._minScale + this._maxScale)/2, Math.abs(this._minScale - this._maxScale)/2, Math.PI*2/this._cycleDuration, this._cyclePhase*Math.PI/180);\r\n\t\t\t} else\r\n\t\t\t\tthis._scaleData = new Vector3D(this._minScale, this._maxScale - this._minScale, 0, 0);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleScaleState;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ColorSegmentPoint\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ColorSegmentPoint\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleSegmentedColorNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n *\r\n */\r\nclass ParticleSegmentedColorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static START_MULTIPLIER_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static START_OFFSET_INDEX:number /*uint*/ = 1;\r\n\r\n\t/** @private */\r\n\tpublic static TIME_DATA_INDEX:number /*uint*/ = 2;\r\n\r\n\tprivate _usesMultiplier:boolean;\r\n\tprivate _usesOffset:boolean;\r\n\tprivate _startColor:ColorTransform;\r\n\tprivate _endColor:ColorTransform;\r\n\tprivate _segmentPoints:Array<ColorSegmentPoint>;\r\n\tprivate _numSegmentPoint:number /*int*/;\r\n\r\n\tprivate _timeLifeData:Array<number>;\r\n\tprivate _multiplierData:Array<number>;\r\n\tprivate _offsetData:Array<number>;\r\n\r\n\t/**\r\n\t * Defines the start color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get startColor():ColorTransform\r\n\t{\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tpublic set startColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._startColor = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the end color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get endColor():ColorTransform\r\n\t{\r\n\t\treturn this._endColor;\r\n\t}\r\n\r\n\tpublic set endColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._endColor = value;\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the number of segments.\r\n\t */\r\n\tpublic get numSegmentPoint():number /*int*/\r\n\t{\r\n\t\treturn this._numSegmentPoint;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the key points of color\r\n\t */\r\n\tpublic get segmentPoints():Array<ColorSegmentPoint>\r\n\t{\r\n\t\treturn this._segmentPoints;\r\n\t}\r\n\r\n\tpublic set segmentPoints(value:Array<ColorSegmentPoint>)\r\n\t{\r\n\t\tthis._segmentPoints = value;\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tpublic get usesMultiplier():boolean\r\n\t{\r\n\t\treturn this._usesMultiplier;\r\n\t}\r\n\r\n\tpublic get usesOffset():boolean\r\n\t{\r\n\t\treturn this._usesOffset;\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleSegmentedColorNode:ParticleSegmentedColorNode)\r\n\t{\r\n\t\tsuper(animator, particleSegmentedColorNode);\r\n\r\n\t\tthis._usesMultiplier = particleSegmentedColorNode._iUsesMultiplier;\r\n\t\tthis._usesOffset = particleSegmentedColorNode._iUsesOffset;\r\n\t\tthis._startColor = particleSegmentedColorNode._iStartColor;\r\n\t\tthis._endColor = particleSegmentedColorNode._iEndColor;\r\n\t\tthis._segmentPoints = particleSegmentedColorNode._iSegmentPoints;\r\n\t\tthis._numSegmentPoint = particleSegmentedColorNode._iNumSegmentPoint;\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tif (this._numSegmentPoint > 0)\r\n\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.TIME_DATA_INDEX), this._timeLifeData[0], this._timeLifeData[1], this._timeLifeData[2], this._timeLifeData[3]);\r\n\t\t\tif (this._usesMultiplier)\r\n\t\t\t\tanimationRegisterCache.setVertexConstFromArray(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.START_MULTIPLIER_INDEX), this._multiplierData);\r\n\t\t\tif (this._usesOffset)\r\n\t\t\t\tanimationRegisterCache.setVertexConstFromArray(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.START_OFFSET_INDEX), this._offsetData);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateColorData()\r\n\t{\r\n\t\tthis._timeLifeData = new Array<number>();\r\n\t\tthis._multiplierData = new Array<number>();\r\n\t\tthis._offsetData = new Array<number>();\r\n\t\tvar i:number /*int*/;\r\n\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\r\n\t\t\tif (i == 0)\r\n\t\t\t\tthis._timeLifeData.push(this._segmentPoints[i].life);\r\n\t\t\telse\r\n\t\t\t\tthis._timeLifeData.push(this._segmentPoints[i].life - this._segmentPoints[i - 1].life);\r\n\t\t}\r\n\t\tif (this._numSegmentPoint == 0)\r\n\t\t\tthis._timeLifeData.push(1);\r\n\t\telse\r\n\t\t\tthis._timeLifeData.push(1 - this._segmentPoints[i - 1].life);\r\n\r\n\t\tif (this._usesMultiplier) {\r\n\t\t\tthis._multiplierData.push(this._startColor.redMultiplier, this._startColor.greenMultiplier, this._startColor.blueMultiplier, this._startColor.alphaMultiplier);\r\n\t\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\r\n\t\t\t\tif (i == 0)\r\n\t\t\t\t\tthis._multiplierData.push((this._segmentPoints[i].color.redMultiplier - this._startColor.redMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.greenMultiplier - this._startColor.greenMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.blueMultiplier - this._startColor.blueMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.alphaMultiplier - this._startColor.alphaMultiplier)/this._timeLifeData[i]);\r\n\t\t\t\telse\r\n\t\t\t\t\tthis._multiplierData.push((this._segmentPoints[i].color.redMultiplier - this._segmentPoints[i - 1].color.redMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.greenMultiplier - this._segmentPoints[i - 1].color.greenMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.blueMultiplier - this._segmentPoints[i - 1].color.blueMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.alphaMultiplier - this._segmentPoints[i - 1].color.alphaMultiplier)/this._timeLifeData[i]);\r\n\t\t\t}\r\n\t\t\tif (this._numSegmentPoint == 0)\r\n\t\t\t\tthis._multiplierData.push(this._endColor.redMultiplier - this._startColor.redMultiplier, this._endColor.greenMultiplier - this._startColor.greenMultiplier, this._endColor.blueMultiplier - this._startColor.blueMultiplier, this._endColor.alphaMultiplier - this._startColor.alphaMultiplier);\r\n\t\t\telse\r\n\t\t\t\tthis._multiplierData.push((this._endColor.redMultiplier - this._segmentPoints[i - 1].color.redMultiplier)/this._timeLifeData[i], (this._endColor.greenMultiplier - this._segmentPoints[i - 1].color.greenMultiplier)/this._timeLifeData[i], (this._endColor.blueMultiplier - this._segmentPoints[i - 1].color.blueMultiplier)/this._timeLifeData[i], (this._endColor.alphaMultiplier - this._segmentPoints[i - 1].color.alphaMultiplier)/this._timeLifeData[i]);\r\n\t\t}\r\n\r\n\t\tif (this._usesOffset) {\r\n\t\t\tthis._offsetData.push(this._startColor.redOffset/255, this._startColor.greenOffset/255, this._startColor.blueOffset/255, this._startColor.alphaOffset/255);\r\n\t\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\r\n\t\t\t\tif (i == 0)\r\n\t\t\t\t\tthis._offsetData.push((this._segmentPoints[i].color.redOffset - this._startColor.redOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.greenOffset - this._startColor.greenOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.blueOffset - this._startColor.blueOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.alphaOffset - this._startColor.alphaOffset)/this._timeLifeData[i]/255);\r\n\t\t\t\telse\r\n\t\t\t\t\tthis._offsetData.push((this._segmentPoints[i].color.redOffset - this._segmentPoints[i - 1].color.redOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.greenOffset - this._segmentPoints[i - 1].color.greenOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.blueOffset - this._segmentPoints[i - 1].color.blueOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.alphaOffset - this._segmentPoints[i - 1].color.alphaOffset)/this._timeLifeData[i]/255);\r\n\t\t\t}\r\n\t\t\tif (this._numSegmentPoint == 0)\r\n\t\t\t\tthis._offsetData.push((this._endColor.redOffset - this._startColor.redOffset)/255, (this._endColor.greenOffset - this._startColor.greenOffset)/255, (this._endColor.blueOffset - this._startColor.blueOffset)/255, (this._endColor.alphaOffset - this._startColor.alphaOffset)/255);\r\n\t\t\telse\r\n\t\t\t\tthis._offsetData.push((this._endColor.redOffset - this._segmentPoints[i - 1].color.redOffset)/this._timeLifeData[i]/255, (this._endColor.greenOffset - this._segmentPoints[i - 1].color.greenOffset)/this._timeLifeData[i]/255, (this._endColor.blueOffset - this._segmentPoints[i - 1].color.blueOffset)/this._timeLifeData[i]/255, (this._endColor.alphaOffset - this._segmentPoints[i - 1].color.alphaOffset)/this._timeLifeData[i]/255);\r\n\t\t}\r\n\t\t//cut off the data\r\n\t\tthis._timeLifeData.length = 4;\r\n\t}\r\n}\r\n\r\nexport = ParticleSegmentedColorState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleSpriteSheetNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleSpriteSheetState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static UV_INDEX_0:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static UV_INDEX_1:number /*uint*/ = 1;\r\n\r\n\tprivate _particleSpriteSheetNode:ParticleSpriteSheetNode;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _totalFrames:number /*int*/;\r\n\tprivate _numColumns:number /*int*/;\r\n\tprivate _numRows:number /*int*/;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _spriteSheetData:Array<number>;\r\n\r\n\t/**\r\n\t * Defines the cycle phase, when in global mode. Defaults to zero.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateSpriteSheetData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the cycle duration in seconds, when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateSpriteSheetData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleSpriteSheetNode:ParticleSpriteSheetNode)\r\n\t{\r\n\t\tsuper(animator, particleSpriteSheetNode);\r\n\r\n\t\tthis._particleSpriteSheetNode = particleSpriteSheetNode;\r\n\r\n\t\tthis._usesCycle = this._particleSpriteSheetNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleSpriteSheetNode._iUsesCycle;\r\n\t\tthis._totalFrames = this._particleSpriteSheetNode._iTotalFrames;\r\n\t\tthis._numColumns = this._particleSpriteSheetNode._iNumColumns;\r\n\t\tthis._numRows = this._particleSpriteSheetNode._iNumRows;\r\n\t\tthis._cycleDuration = this._particleSpriteSheetNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleSpriteSheetNode._iCyclePhase;\r\n\r\n\t\tthis.updateSpriteSheetData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needUVAnimation) {\r\n\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSpriteSheetState.UV_INDEX_0), this._spriteSheetData[0], this._spriteSheetData[1], this._spriteSheetData[2], this._spriteSheetData[3]);\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSpriteSheetState.UV_INDEX_1);\r\n\t\t\t\tif (this._particleSpriteSheetNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\t\tif (this._usesPhase)\r\n\t\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleSpriteSheetNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleSpriteSheetNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t\t\t} else\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(index, this._spriteSheetData[4], this._spriteSheetData[5]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateSpriteSheetData()\r\n\t{\r\n\t\tthis._spriteSheetData = new Array<number>(8);\r\n\r\n\t\tvar uTotal:number = this._totalFrames/this._numColumns;\r\n\r\n\t\tthis._spriteSheetData[0] = uTotal;\r\n\t\tthis._spriteSheetData[1] = 1/this._numColumns;\r\n\t\tthis._spriteSheetData[2] = 1/this._numRows;\r\n\r\n\t\tif (this._usesCycle) {\r\n\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tthis._spriteSheetData[4] = uTotal/this._cycleDuration;\r\n\t\t\tthis._spriteSheetData[5] = this._cycleDuration;\r\n\t\t\tif (this._usesPhase)\r\n\t\t\t\tthis._spriteSheetData[6] = this._cyclePhase;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleSpriteSheetState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleStateBase extends AnimationStateBase\r\n{\r\n\tprivate _particleNode:ParticleNodeBase;\r\n\r\n\tpublic _pDynamicProperties:Array<Vector3D> = new Array<Vector3D>();\r\n\tpublic _pDynamicPropertiesDirty:Object = new Object();\r\n\r\n\tpublic _pNeedUpdateTime:boolean;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleNodeBase, needUpdateTime:boolean = false)\r\n\t{\r\n\t\tsuper(animator, particleNode);\r\n\r\n\t\tthis._particleNode = particleNode;\r\n\t\tthis._pNeedUpdateTime = needUpdateTime;\r\n\t}\r\n\r\n\tpublic get needUpdateTime():boolean\r\n\t{\r\n\t\treturn this._pNeedUpdateTime;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic _pUpdateDynamicProperties(animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tthis._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId] = true;\r\n\r\n\t\tvar animationParticles:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\t\tvar totalLenOfOneVertex:number /*uint*/ = animationSubGeometry.totalLenOfOneVertex;\r\n\t\tvar dataLength:number /*uint*/ = this._particleNode.dataLength;\r\n\t\tvar dataOffset:number /*uint*/ = this._particleNode._iDataOffset;\r\n\t\tvar vertexLength:number /*uint*/;\r\n\t\t//\t\t\tvar particleOffset:number /*uint*/;\r\n\t\tvar startingOffset:number /*uint*/;\r\n\t\tvar vertexOffset:number /*uint*/;\r\n\t\tvar data:Vector3D;\r\n\t\tvar animationParticle:ParticleAnimationData;\r\n\r\n\t\t//\t\t\tvar numParticles:number /*uint*/ = _positions.length/dataLength;\r\n\t\tvar numParticles:number /*uint*/ = this._pDynamicProperties.length;\r\n\t\tvar i:number /*uint*/ = 0;\r\n\t\tvar j:number /*uint*/ = 0;\r\n\t\tvar k:number /*uint*/ = 0;\r\n\r\n\t\t//loop through all particles\r\n\t\twhile (i < numParticles) {\r\n\t\t\t//loop through each particle data for the current particle\r\n\t\t\twhile (j < numParticles && (animationParticle = animationParticles[j]).index == i) {\r\n\t\t\t\tdata = this._pDynamicProperties[i];\r\n\t\t\t\tvertexLength = animationParticle.numVertices*totalLenOfOneVertex;\r\n\t\t\t\tstartingOffset = animationParticle.startVertexIndex*totalLenOfOneVertex + dataOffset;\r\n\t\t\t\t//loop through each vertex in the particle data\r\n\t\t\t\tfor (k = 0; k < vertexLength; k += totalLenOfOneVertex) {\r\n\t\t\t\t\tvertexOffset = startingOffset + k;\r\n\t\t\t\t\t//\t\t\t\t\t\tparticleOffset = i * dataLength;\r\n\t\t\t\t\t//loop through all vertex data for the current particle data\r\n\t\t\t\t\tfor (k = 0; k < vertexLength; k += totalLenOfOneVertex) {\r\n\t\t\t\t\t\tvertexOffset = startingOffset + k;\r\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.x;\r\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.y;\r\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.z;\r\n\r\n\t\t\t\t\t\tif (dataLength == 4)\r\n\t\t\t\t\t\t\tvertexData[vertexOffset++] = data.w;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t//loop through each value in the particle vertex\r\n\t\t\t\t\t\t//\t\t\t\t\t\tswitch(dataLength) {\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\tanimationSubGeometry.invalidateBuffer();\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleStateBase;",
    "import Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleTimeNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleTimeState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static TIME_STREAM_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static TIME_CONSTANT_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleTimeNode:ParticleTimeNode;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleTimeNode:ParticleTimeNode)\r\n\t{\r\n\t\tsuper(animator, particleTimeNode, true);\r\n\r\n\t\tthis._particleTimeNode = particleTimeNode;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleTimeState.TIME_STREAM_INDEX), this._particleTimeNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\r\n\t\tvar particleTime:number = this._pTime/1000;\r\n\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleTimeState.TIME_CONSTANT_INDEX), particleTime, particleTime, particleTime, particleTime);\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleTimeState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleUVNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleUVNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleUVState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static UV_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleUVNode:ParticleUVNode;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleUVNode:ParticleUVNode)\r\n\t{\r\n\t\tsuper(animator, particleUVNode);\r\n\r\n\t\tthis._particleUVNode = particleUVNode;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needUVAnimation) {\r\n\t\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleUVState.UV_INDEX);\r\n\t\t\tvar data:Vector3D = this._particleUVNode._iUvData;\r\n\t\t\tanimationRegisterCache.setVertexConst(index, data.x, data.y);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleUVState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleVelocityNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleVelocityState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static VELOCITY_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _particleVelocityNode:ParticleVelocityNode;\r\n\tprivate _velocity:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default velocity vector of the state, used when in global mode.\r\n\t */\r\n\tpublic get velocity():Vector3D\r\n\t{\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\tpublic set velocity(value:Vector3D)\r\n\t{\r\n\t\tthis._velocity = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getVelocities():Array<Vector3D>\r\n\t{\r\n\t\treturn this._pDynamicProperties;\r\n\t}\r\n\r\n\tpublic setVelocities(value:Array<Vector3D>)\r\n\t{\r\n\t\tthis._pDynamicProperties = value;\r\n\r\n\t\tthis._pDynamicPropertiesDirty = new Object();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleVelocityNode:ParticleVelocityNode)\r\n\t{\r\n\t\tsuper(animator, particleVelocityNode);\r\n\r\n\t\tthis._particleVelocityNode = particleVelocityNode;\r\n\t\tthis._velocity = this._particleVelocityNode._iVelocity;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._particleVelocityNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\r\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\r\n\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleVelocityState.VELOCITY_INDEX);\r\n\r\n\t\tif (this._particleVelocityNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._velocity.x, this._velocity.y, this._velocity.z);\r\n\t\telse\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleVelocityNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t}\r\n}\r\n\r\nexport = ParticleVelocityState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonBinaryLERPState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _blendWeight:number = 0;\r\n\tprivate _skeletonAnimationNode:SkeletonBinaryLERPNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _inputA:ISkeletonAnimationState;\r\n\tprivate _inputB:ISkeletonAnimationState;\r\n\r\n\t/**\r\n\t * Defines a fractional value between 0 and 1 representing the blending ratio between inputA (0) and inputB (1),\r\n\t * used to produce the skeleton pose output.\r\n\t *\r\n\t * @see inputA\r\n\t * @see inputB\r\n\t */\r\n\tpublic get blendWeight():number\r\n\t{\r\n\t\treturn this._blendWeight;\r\n\t}\r\n\r\n\tpublic set blendWeight(value:number)\r\n\t{\r\n\t\tthis._blendWeight = value;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonBinaryLERPNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tthis._inputA = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.inputA);\r\n\t\tthis._inputB = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.inputB);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tthis._inputA.phase(value);\r\n\t\tthis._inputB.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._inputA.update(time);\r\n\t\tthis._inputB.update(time);\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tvar deltA:Vector3D = this._inputA.positionDelta;\r\n\t\tvar deltB:Vector3D = this._inputB.positionDelta;\r\n\r\n\t\tthis._pRootDelta.x = deltA.x + this._blendWeight*(deltB.x - deltA.x);\r\n\t\tthis._pRootDelta.y = deltA.y + this._blendWeight*(deltB.y - deltA.y);\r\n\t\tthis._pRootDelta.z = deltA.z + this._blendWeight*(deltB.z - deltA.z);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the blendWeight value between input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tvar endPose:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar poses1:Array<JointPose> = this._inputA.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar poses2:Array<JointPose> = this._inputB.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar pose1:JointPose, pose2:JointPose;\r\n\t\tvar p1:Vector3D, p2:Vector3D;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tpose1 = poses1[i];\r\n\t\t\tpose2 = poses2[i];\r\n\t\t\tp1 = pose1.translation;\r\n\t\t\tp2 = pose2.translation;\r\n\r\n\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._blendWeight);\r\n\r\n\t\t\ttr = endPose.translation;\r\n\t\t\ttr.x = p1.x + this._blendWeight*(p2.x - p1.x);\r\n\t\t\ttr.y = p1.y + this._blendWeight*(p2.y - p1.y);\r\n\t\t\ttr.z = p1.z + this._blendWeight*(p2.z - p1.z);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonBinaryLERPState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport AnimationClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationClipState\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonClipState extends AnimationClipState implements ISkeletonAnimationState\r\n{\r\n\tprivate _rootPos:Vector3D = new Vector3D();\r\n\tprivate _frames:Array<SkeletonPose>;\r\n\tprivate _skeletonClipNode:SkeletonClipNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _currentPose:SkeletonPose;\r\n\tprivate _nextPose:SkeletonPose;\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get currentPose():SkeletonPose\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._currentPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the next skeleton pose frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get nextPose():SkeletonPose\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._nextPose;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonClipNode:SkeletonClipNode)\r\n\t{\r\n\t\tsuper(animator, skeletonClipNode);\r\n\r\n\t\tthis._skeletonClipNode = skeletonClipNode;\r\n\t\tthis._frames = this._skeletonClipNode.frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateFrames()\r\n\t{\r\n\t\tsuper._pUpdateFrames();\r\n\r\n\t\tthis._currentPose = this._frames[this._pCurrentFrame];\r\n\r\n\t\tif (this._skeletonClipNode.looping && this._pNextFrame >= this._skeletonClipNode.lastFrame) {\r\n\t\t\tthis._nextPose = this._frames[0];\r\n\t\t\t(<SkeletonAnimator> this._pAnimator).dispatchCycleEvent();\r\n\t\t} else\r\n\t\t\tthis._nextPose = this._frames[this._pNextFrame];\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the internal playhead position.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tif (!this._skeletonClipNode.totalDuration)\r\n\t\t\treturn;\r\n\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\tvar currentPose:Array<JointPose> = this._currentPose.jointPoses;\r\n\t\tvar nextPose:Array<JointPose> = this._nextPose.jointPoses;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\t\tvar p1:Vector3D, p2:Vector3D;\r\n\t\tvar pose1:JointPose, pose2:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar endPose:JointPose;\r\n\t\tvar tr:Vector3D;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tif ((numJoints != currentPose.length) || (numJoints != nextPose.length))\r\n\t\t\tthrow new Error(\"joint counts don't match!\");\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tpose1 = currentPose[i];\r\n\t\t\tpose2 = nextPose[i];\r\n\t\t\tp1 = pose1.translation;\r\n\t\t\tp2 = pose2.translation;\r\n\r\n\t\t\tif (this._skeletonClipNode.highQuality)\r\n\t\t\t\tendPose.orientation.slerp(pose1.orientation, pose2.orientation, this._pBlendWeight); else\r\n\t\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._pBlendWeight);\r\n\r\n\t\t\tif (i > 0) {\r\n\t\t\t\ttr = endPose.translation;\r\n\t\t\t\ttr.x = p1.x + this._pBlendWeight*(p2.x - p1.x);\r\n\t\t\t\ttr.y = p1.y + this._pBlendWeight*(p2.y - p1.y);\r\n\t\t\t\ttr.z = p1.z + this._pBlendWeight*(p2.z - p1.z);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\tvar p1:Vector3D, p2:Vector3D, p3:Vector3D;\r\n\t\tvar totalDelta:Vector3D = this._skeletonClipNode.totalDelta;\r\n\r\n\t\t// jumping back, need to reset position\r\n\t\tif ((this._pTimeDir > 0 && this._pNextFrame < this._pOldFrame) || (this._pTimeDir < 0 && this._pNextFrame > this._pOldFrame)) {\r\n\t\t\tthis._rootPos.x -= totalDelta.x*this._pTimeDir;\r\n\t\t\tthis._rootPos.y -= totalDelta.y*this._pTimeDir;\r\n\t\t\tthis._rootPos.z -= totalDelta.z*this._pTimeDir;\r\n\t\t}\r\n\r\n\t\tvar dx:number = this._rootPos.x;\r\n\t\tvar dy:number = this._rootPos.y;\r\n\t\tvar dz:number = this._rootPos.z;\r\n\r\n\t\tif (this._skeletonClipNode.stitchFinalFrame && this._pNextFrame == this._skeletonClipNode.lastFrame) {\r\n\t\t\tp1 = this._frames[0].jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[1].jointPoses[0].translation;\r\n\t\t\tp3 = this._currentPose.jointPoses[0].translation;\r\n\r\n\t\t\tthis._rootPos.x = p3.x + p1.x + this._pBlendWeight*(p2.x - p1.x);\r\n\t\t\tthis._rootPos.y = p3.y + p1.y + this._pBlendWeight*(p2.y - p1.y);\r\n\t\t\tthis._rootPos.z = p3.z + p1.z + this._pBlendWeight*(p2.z - p1.z);\r\n\t\t} else {\r\n\t\t\tp1 = this._currentPose.jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[this._pNextFrame].jointPoses[0].translation; //cover the instances where we wrap the pose but still want the final frame translation values\r\n\t\t\tthis._rootPos.x = p1.x + this._pBlendWeight*(p2.x - p1.x);\r\n\t\t\tthis._rootPos.y = p1.y + this._pBlendWeight*(p2.y - p1.y);\r\n\t\t\tthis._rootPos.z = p1.z + this._pBlendWeight*(p2.z - p1.z);\r\n\t\t}\r\n\r\n\t\tthis._pRootDelta.x = this._rootPos.x - dx;\r\n\t\tthis._pRootDelta.y = this._rootPos.y - dy;\r\n\t\tthis._pRootDelta.z = this._rootPos.z - dz;\r\n\r\n\t\tthis._pOldFrame = this._pNextFrame;\r\n\t}\r\n}\r\n\r\nexport = SkeletonClipState;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonDifferenceNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonDifferenceState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _blendWeight:number = 0;\r\n\tprivate static _tempQuat:Quaternion = new Quaternion();\r\n\tprivate _skeletonAnimationNode:SkeletonDifferenceNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _baseInput:ISkeletonAnimationState;\r\n\tprivate _differenceInput:ISkeletonAnimationState;\r\n\r\n\t/**\r\n\t * Defines a fractional value between 0 and 1 representing the blending ratio between the base input (0) and difference input (1),\r\n\t * used to produce the skeleton pose output.\r\n\t *\r\n\t * @see #baseInput\r\n\t * @see #differenceInput\r\n\t */\r\n\tpublic get blendWeight():number\r\n\t{\r\n\t\treturn this._blendWeight;\r\n\t}\r\n\r\n\tpublic set blendWeight(value:number)\r\n\t{\r\n\t\tthis._blendWeight = value;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonDifferenceNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tthis._baseInput = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.baseInput);\r\n\t\tthis._differenceInput = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.differenceInput);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tthis._baseInput.phase(value);\r\n\t\tthis._baseInput.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._baseInput.update(time);\r\n\t\tthis._differenceInput.update(time);\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tvar deltA:Vector3D = this._baseInput.positionDelta;\r\n\t\tvar deltB:Vector3D = this._differenceInput.positionDelta;\r\n\r\n\t\tthis.positionDelta.x = deltA.x + this._blendWeight*deltB.x;\r\n\t\tthis.positionDelta.y = deltA.y + this._blendWeight*deltB.y;\r\n\t\tthis.positionDelta.z = deltA.z + this._blendWeight*deltB.z;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the blendWeight value between base input and difference input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tvar endPose:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar basePoses:Array<JointPose> = this._baseInput.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar diffPoses:Array<JointPose> = this._differenceInput.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar base:JointPose, diff:JointPose;\r\n\t\tvar basePos:Vector3D, diffPos:Vector3D;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tbase = basePoses[i];\r\n\t\t\tdiff = diffPoses[i];\r\n\t\t\tbasePos = base.translation;\r\n\t\t\tdiffPos = diff.translation;\r\n\r\n\t\t\tSkeletonDifferenceState._tempQuat.multiply(diff.orientation, base.orientation);\r\n\t\t\tendPose.orientation.lerp(base.orientation, SkeletonDifferenceState._tempQuat, this._blendWeight);\r\n\r\n\t\t\ttr = endPose.translation;\r\n\t\t\ttr.x = basePos.x + this._blendWeight*diffPos.x;\r\n\t\t\ttr.y = basePos.y + this._blendWeight*diffPos.y;\r\n\t\t\ttr.z = basePos.z + this._blendWeight*diffPos.z;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonDifferenceState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonDirectionalNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonDirectionalState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _skeletonAnimationNode:SkeletonDirectionalNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _inputA:ISkeletonAnimationState;\r\n\tprivate _inputB:ISkeletonAnimationState;\r\n\tprivate _blendWeight:number = 0;\r\n\tprivate _direction:number = 0;\r\n\tprivate _blendDirty:boolean = true;\r\n\tprivate _forward:ISkeletonAnimationState;\r\n\tprivate _backward:ISkeletonAnimationState;\r\n\tprivate _left:ISkeletonAnimationState;\r\n\tprivate _right:ISkeletonAnimationState;\r\n\r\n\t/**\r\n\t * Defines the direction in degrees of the aniamtion between the forwards (0), right(90) backwards (180) and left(270) input nodes,\r\n\t * used to produce the skeleton pose output.\r\n\t */\r\n\tpublic set direction(value:number)\r\n\t{\r\n\t\tif (this._direction == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._direction = value;\r\n\r\n\t\tthis._blendDirty = true;\r\n\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t}\r\n\r\n\tpublic get direction():number\r\n\t{\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonDirectionalNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tthis._forward = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.forward);\r\n\t\tthis._backward = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.backward);\r\n\t\tthis._left = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.left);\r\n\t\tthis._right = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.right);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tthis._inputA.phase(value);\r\n\t\tthis._inputB.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUdateTime(time:number /*int*/)\r\n\t{\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._inputA.update(time);\r\n\t\tthis._inputB.update(time);\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tvar deltA:Vector3D = this._inputA.positionDelta;\r\n\t\tvar deltB:Vector3D = this._inputB.positionDelta;\r\n\r\n\t\tthis.positionDelta.x = deltA.x + this._blendWeight*(deltB.x - deltA.x);\r\n\t\tthis.positionDelta.y = deltA.y + this._blendWeight*(deltB.y - deltA.y);\r\n\t\tthis.positionDelta.z = deltA.z + this._blendWeight*(deltB.z - deltA.z);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the direction value between forward, backwards, left and right input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tvar endPose:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar poses1:Array<JointPose> = this._inputA.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar poses2:Array<JointPose> = this._inputB.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar pose1:JointPose, pose2:JointPose;\r\n\t\tvar p1:Vector3D, p2:Vector3D;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tpose1 = poses1[i];\r\n\t\t\tpose2 = poses2[i];\r\n\t\t\tp1 = pose1.translation;\r\n\t\t\tp2 = pose2.translation;\r\n\r\n\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._blendWeight);\r\n\r\n\t\t\ttr = endPose.translation;\r\n\t\t\ttr.x = p1.x + this._blendWeight*(p2.x - p1.x);\r\n\t\t\ttr.y = p1.y + this._blendWeight*(p2.y - p1.y);\r\n\t\t\ttr.z = p1.z + this._blendWeight*(p2.z - p1.z);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the blend value for the animation output based on the direction value between forward, backwards, left and right input nodes.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tprivate updateBlend()\r\n\t{\r\n\t\tthis._blendDirty = false;\r\n\r\n\t\tif (this._direction < 0 || this._direction > 360) {\r\n\t\t\tthis._direction %= 360;\r\n\t\t\tif (this._direction < 0)\r\n\t\t\t\tthis._direction += 360;\r\n\t\t}\r\n\r\n\t\tif (this._direction < 90) {\r\n\t\t\tthis._inputA = this._forward;\r\n\t\t\tthis._inputB = this._right;\r\n\t\t\tthis._blendWeight = this._direction/90;\r\n\t\t} else if (this._direction < 180) {\r\n\t\t\tthis._inputA = this._right;\r\n\t\t\tthis._inputB = this._backward;\r\n\t\t\tthis._blendWeight = (this._direction - 90)/90;\r\n\t\t} else if (this._direction < 270) {\r\n\t\t\tthis._inputA = this._backward;\r\n\t\t\tthis._inputB = this._left;\r\n\t\t\tthis._blendWeight = (this._direction - 180)/90;\r\n\t\t} else {\r\n\t\t\tthis._inputA = this._left;\r\n\t\t\tthis._inputB = this._forward;\r\n\t\t\tthis._blendWeight = (this._direction - 270)/90;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonDirectionalState;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonNaryLERPNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonNaryLERPState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _skeletonAnimationNode:SkeletonNaryLERPNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _blendWeights:Array<number> = new Array<number>();\r\n\tprivate _inputs:Array<ISkeletonAnimationState> = new Array<ISkeletonAnimationState>();\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonNaryLERPNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tvar i:number /*uint*/ = this._skeletonAnimationNode.numInputs;\r\n\r\n\t\twhile (i--)\r\n\t\t\tthis._inputs[i] = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode._iInputs[i]);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tif (this._blendWeights[j])\r\n\t\t\t\tthis._inputs[j].update(value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUdateTime(time:number /*int*/)\r\n\t{\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tif (this._blendWeights[j])\r\n\t\t\t\tthis._inputs[j].update(time);\r\n\t\t}\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the blend weight of the skeleton aniamtion node that resides at the given input index.\r\n\t *\r\n\t * @param index The input index for which the skeleton animation node blend weight is requested.\r\n\t */\r\n\tpublic getBlendWeightAt(index:number /*uint*/):number\r\n\t{\r\n\t\treturn this._blendWeights[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the blend weight of the skeleton aniamtion node that resides at the given input index.\r\n\t *\r\n\t * @param index The input index on which the skeleton animation node blend weight is to be set.\r\n\t * @param blendWeight The blend weight value to use for the given skeleton animation node index.\r\n\t */\r\n\tpublic setBlendWeightAt(index:number /*uint*/, blendWeight:number)\r\n\t{\r\n\t\tthis._blendWeights[index] = blendWeight;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tvar delta:Vector3D;\r\n\t\tvar weight:number;\r\n\r\n\t\tthis.positionDelta.x = 0;\r\n\t\tthis.positionDelta.y = 0;\r\n\t\tthis.positionDelta.z = 0;\r\n\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tweight = this._blendWeights[j];\r\n\r\n\t\t\tif (weight) {\r\n\t\t\t\tdelta = this._inputs[j].positionDelta;\r\n\t\t\t\tthis.positionDelta.x += weight*delta.x;\r\n\t\t\t\tthis.positionDelta.y += weight*delta.y;\r\n\t\t\t\tthis.positionDelta.z += weight*delta.z;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the blend weight values given to the input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tvar weight:number;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar poses:Array<JointPose>;\r\n\t\tvar endPose:JointPose, pose:JointPose;\r\n\t\tvar endTr:Vector3D, tr:Vector3D;\r\n\t\tvar endQuat:Quaternion, q:Quaternion;\r\n\t\tvar firstPose:Array<JointPose>;\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar w0:number, x0:number, y0:number, z0:number;\r\n\t\tvar w1:number, x1:number, y1:number, z1:number;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tweight = this._blendWeights[j];\r\n\r\n\t\t\tif (!weight)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tposes = this._inputs[j].getSkeletonPose(skeleton).jointPoses;\r\n\r\n\t\t\tif (!firstPose) {\r\n\t\t\t\tfirstPose = poses;\r\n\t\t\t\tfor (i = 0; i < numJoints; ++i) {\r\n\t\t\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\t\t\tif (endPose == null)\r\n\t\t\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\t\t\tpose = poses[i];\r\n\t\t\t\t\tq = pose.orientation;\r\n\t\t\t\t\ttr = pose.translation;\r\n\r\n\t\t\t\t\tendQuat = endPose.orientation;\r\n\r\n\t\t\t\t\tendQuat.x = weight*q.x;\r\n\t\t\t\t\tendQuat.y = weight*q.y;\r\n\t\t\t\t\tendQuat.z = weight*q.z;\r\n\t\t\t\t\tendQuat.w = weight*q.w;\r\n\r\n\t\t\t\t\tendTr = endPose.translation;\r\n\t\t\t\t\tendTr.x = weight*tr.x;\r\n\t\t\t\t\tendTr.y = weight*tr.y;\r\n\t\t\t\t\tendTr.z = weight*tr.z;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (i = 0; i < skeleton.numJoints; ++i) {\r\n\t\t\t\t\tendPose = endPoses[i];\r\n\t\t\t\t\tpose = poses[i];\r\n\r\n\t\t\t\t\tq = firstPose[i].orientation;\r\n\t\t\t\t\tx0 = q.x;\r\n\t\t\t\t\ty0 = q.y;\r\n\t\t\t\t\tz0 = q.z;\r\n\t\t\t\t\tw0 = q.w;\r\n\r\n\t\t\t\t\tq = pose.orientation;\r\n\t\t\t\t\ttr = pose.translation;\r\n\r\n\t\t\t\t\tx1 = q.x;\r\n\t\t\t\t\ty1 = q.y;\r\n\t\t\t\t\tz1 = q.z;\r\n\t\t\t\t\tw1 = q.w;\r\n\t\t\t\t\t// find shortest direction\r\n\t\t\t\t\tif (x0*x1 + y0*y1 + z0*z1 + w0*w1 < 0) {\r\n\t\t\t\t\t\tx1 = -x1;\r\n\t\t\t\t\t\ty1 = -y1;\r\n\t\t\t\t\t\tz1 = -z1;\r\n\t\t\t\t\t\tw1 = -w1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tendQuat = endPose.orientation;\r\n\t\t\t\t\tendQuat.x += weight*x1;\r\n\t\t\t\t\tendQuat.y += weight*y1;\r\n\t\t\t\t\tendQuat.z += weight*z1;\r\n\t\t\t\t\tendQuat.w += weight*w1;\r\n\r\n\t\t\t\t\tendTr = endPose.translation;\r\n\t\t\t\t\tendTr.x += weight*tr.x;\r\n\t\t\t\t\tendTr.y += weight*tr.y;\r\n\t\t\t\t\tendTr.z += weight*tr.z;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < skeleton.numJoints; ++i)\r\n\t\t\tendPoses[i].orientation.normalize();\r\n\t}\r\n}\r\n\r\nexport = SkeletonNaryLERPState;",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport AnimationClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationClipState\");\r\nimport IVertexAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IVertexAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass VertexClipState extends AnimationClipState implements IVertexAnimationState\r\n{\r\n\tprivate _frames:Array<Geometry>;\r\n\tprivate _vertexClipNode:VertexClipNode;\r\n\tprivate _currentGeometry:Geometry;\r\n\tprivate _nextGeometry:Geometry;\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get currentGeometry():Geometry\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._currentGeometry;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get nextGeometry():Geometry\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._nextGeometry;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, vertexClipNode:VertexClipNode)\r\n\t{\r\n\t\tsuper(animator, vertexClipNode);\r\n\r\n\t\tthis._vertexClipNode = vertexClipNode;\r\n\t\tthis._frames = this._vertexClipNode.frames;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateFrames()\r\n\t{\r\n\t\tsuper._pUpdateFrames();\r\n\r\n\t\tthis._currentGeometry = this._frames[this._pCurrentFrame];\r\n\r\n\t\tif (this._vertexClipNode.looping && this._pNextFrame >= this._vertexClipNode.lastFrame) {\r\n\t\t\tthis._nextGeometry = this._frames[0];\r\n\t\t\t(<VertexAnimator> this._pAnimator).dispatchCycleEvent();\r\n\t\t} else\r\n\t\t\tthis._nextGeometry = this._frames[this._pNextFrame];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\t//TODO:implement positiondelta functionality for vertex animations\r\n\t}\r\n}\r\n\r\nexport = VertexClipState;",
    "import SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\r\nimport CrossfadeTransitionState\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState\");\r\n\r\n/**\r\n * A skeleton animation node that uses two animation node inputs to blend a lineraly interpolated output of a skeleton pose.\r\n */\r\nclass CrossfadeTransitionNode extends SkeletonBinaryLERPNode\r\n{\r\n\tpublic blendSpeed:number;\r\n\r\n\tpublic startBlend:number /*int*/;\r\n\r\n\t/**\r\n\t * Creates a new <code>CrossfadeTransitionNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = CrossfadeTransitionState;\r\n\t}\r\n}\r\n\r\nexport = CrossfadeTransitionNode;",
    "import AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\r\nimport SkeletonBinaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState\");\r\nimport CrossfadeTransitionNode\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode\");\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\n\r\n/**\r\n *\r\n */\r\nclass CrossfadeTransitionState extends SkeletonBinaryLERPState\r\n{\r\n\tprivate _crossfadeTransitionNode:CrossfadeTransitionNode;\r\n\tprivate _animationStateTransitionComplete:AnimationStateEvent;\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:CrossfadeTransitionNode)\r\n\t{\r\n\t\tsuper(animator, <SkeletonBinaryLERPNode> skeletonAnimationNode);\r\n\r\n\t\tthis._crossfadeTransitionNode = skeletonAnimationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis.blendWeight = Math.abs(time - this._crossfadeTransitionNode.startBlend)/(1000*this._crossfadeTransitionNode.blendSpeed);\r\n\r\n\t\tif (this.blendWeight >= 1) {\r\n\t\t\tthis.blendWeight = 1;\r\n\r\n\t\t\tif (this._animationStateTransitionComplete == null)\r\n\t\t\t\tthis._animationStateTransitionComplete = new AnimationStateEvent(AnimationStateEvent.TRANSITION_COMPLETE, this._pAnimator, this, this._crossfadeTransitionNode);\r\n\r\n\t\t\tthis._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete);\r\n\t\t}\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n}\r\n\r\nexport = CrossfadeTransitionState;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport CrossfadeTransitionNode\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode\");\r\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\r\n\r\n/**\r\n *\r\n */\r\nclass CrossfadeTransition implements IAnimationTransition\r\n{\r\n\tpublic blendSpeed:number = 0.5;\r\n\r\n\tconstructor(blendSpeed:number)\r\n\t{\r\n\t\tthis.blendSpeed = blendSpeed;\r\n\t}\r\n\r\n\tpublic getAnimationNode(animator:AnimatorBase, startNode:AnimationNodeBase, endNode:AnimationNodeBase, startBlend:number /*int*/):AnimationNodeBase\r\n\t{\r\n\t\tvar crossFadeTransitionNode:CrossfadeTransitionNode = new CrossfadeTransitionNode();\r\n\t\tcrossFadeTransitionNode.inputA = startNode;\r\n\t\tcrossFadeTransitionNode.inputB = endNode;\r\n\t\tcrossFadeTransitionNode.blendSpeed = this.blendSpeed;\r\n\t\tcrossFadeTransitionNode.startBlend = startBlend;\r\n\r\n\t\treturn <AnimationNodeBase> crossFadeTransitionNode;\r\n\t}\r\n}\r\n\r\nexport = CrossfadeTransition;",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\n\r\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\n\r\n/**\r\n * @class away.base.ParticleGeometry\r\n */\r\nclass ParticleGeometry extends Geometry\r\n{\r\n\tpublic particles:Array<ParticleData>;\r\n\r\n\tpublic numParticles:number /*uint*/;\r\n\r\n}\r\n\r\nexport = ParticleGeometry;",
    "import Error\t\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\r\n\r\nclass AnimationSetError extends Error\r\n{\r\n\tconstructor(message:string)\r\n\t{\r\n\t\tsuper(message);\r\n\t}\r\n}\r\n\r\nexport = AnimationSetError;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport Event\t\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport IAnimationState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\r\n\r\n/**\r\n * Dispatched to notify changes in an animation state's state.\r\n */\r\nclass AnimationStateEvent extends Event\r\n{\r\n\t/**\r\n\t * Dispatched when a non-looping clip node inside an animation state reaches the end of its timeline.\r\n\t */\r\n\tpublic static PLAYBACK_COMPLETE:string = \"playbackComplete\";\r\n\r\n\tpublic static TRANSITION_COMPLETE:string = \"transitionComplete\";\r\n\r\n\tprivate _animator:AnimatorBase;\r\n\tprivate _animationState:IAnimationState;\r\n\tprivate _animationNode:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Create a new <code>AnimatonStateEvent</code>\r\n\t *\r\n\t * @param type The event type.\r\n\t * @param animator The animation state object that is the subject of this event.\r\n\t * @param animationNode The animation node inside the animation state from which the event originated.\r\n\t */\r\n\tconstructor(type:string, animator:AnimatorBase, animationState:IAnimationState, animationNode:AnimationNodeBase)\r\n\t{\r\n\t\tsuper(type);\r\n\r\n\t\tthis._animator = animator;\r\n\t\tthis._animationState = animationState;\r\n\t\tthis._animationNode = animationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * The animator object that is the subject of this event.\r\n\t */\r\n\tpublic get animator():AnimatorBase\r\n\t{\r\n\t\treturn this._animator;\r\n\t}\r\n\r\n\t/**\r\n\t * The animation state object that is the subject of this event.\r\n\t */\r\n\tpublic get animationState():IAnimationState\r\n\t{\r\n\t\treturn this._animationState;\r\n\t}\r\n\r\n\t/**\r\n\t * The animation node inside the animation state from which the event originated.\r\n\t */\r\n\tpublic get animationNode():AnimationNodeBase\r\n\t{\r\n\t\treturn this._animationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * Clones the event.\r\n\t *\r\n\t * @return An exact duplicate of the current object.\r\n\t */\r\n\tpublic clone():Event\r\n\t{\r\n\t\treturn new AnimationStateEvent(this.type, this._animator, this._animationState, this._animationNode);\r\n\t}\r\n}\r\n\r\nexport = AnimationStateEvent;",
    "import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\n\r\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\n/**\r\n * Dispatched to notify changes in an animator's state.\r\n */\r\nclass AnimatorEvent extends Event\r\n{\r\n\t/**\r\n\t * Defines the value of the type property of a start event object.\r\n\t */\r\n\tpublic static START:string = \"start\";\r\n\r\n\t/**\r\n\t * Defines the value of the type property of a stop event object.\r\n\t */\r\n\tpublic static STOP:string = \"stop\";\r\n\r\n\t/**\r\n\t * Defines the value of the type property of a cycle complete event object.\r\n\t */\r\n\tpublic static CYCLE_COMPLETE:string = \"cycle_complete\";\r\n\r\n\tprivate _animator:AnimatorBase;\r\n\r\n\t/**\r\n\t * Create a new <code>AnimatorEvent</code> object.\r\n\t *\r\n\t * @param type The event type.\r\n\t * @param animator The animator object that is the subject of this event.\r\n\t */\r\n\tconstructor(type:string, animator:AnimatorBase)\r\n\t{\r\n\t\tsuper(type);\r\n\t\tthis._animator = animator;\r\n\t}\r\n\r\n\tpublic get animator():AnimatorBase\r\n\t{\r\n\t\treturn this._animator;\r\n\t}\r\n\r\n\t/**\r\n\t * Clones the event.\r\n\t *\r\n\t * @return An exact duplicate of the current event object.\r\n\t */\r\n\tpublic clone():Event\r\n\t{\r\n\t\treturn new AnimatorEvent(this.type, this._animator);\r\n\t}\r\n}\r\n\r\nexport = AnimatorEvent;",
    "import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\n\r\nclass ShadingMethodEvent extends Event\r\n{\r\n\tpublic static SHADER_INVALIDATED:string = \"ShaderInvalidated\";\r\n\r\n\tconstructor(type:string)\r\n\t{\r\n\r\n\t\tsuper(type);\r\n\r\n\t}\r\n}\r\n\r\nexport = ShadingMethodEvent;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Filter3DHBlurTask\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DHBlurTask\");\r\nimport Filter3DVBlurTask\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DVBlurTask\");\r\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\r\n\r\nclass BlurFilter3D extends Filter3DBase\r\n{\r\n\tprivate _hBlurTask:Filter3DHBlurTask;\r\n\tprivate _vBlurTask:Filter3DVBlurTask;\r\n\t\r\n\t/**\r\n\t * Creates a new BlurFilter3D object\r\n\t * @param blurX The amount of horizontal blur to apply\r\n\t * @param blurY The amount of vertical blur to apply\r\n\t * @param stepSize The distance between samples. Set to -1 to autodetect with acceptable quality.\r\n\t */\r\n\tconstructor(blurX:number = 3, blurY:number = 3, stepSize:number = -1)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._hBlurTask = new Filter3DHBlurTask(blurX, stepSize);\r\n\t\tthis._vBlurTask = new Filter3DVBlurTask(blurY, stepSize);\r\n\r\n\t\tthis.addTask(this._hBlurTask);\r\n\t\tthis.addTask(this._vBlurTask);\r\n\t}\r\n\t\r\n\tpublic get blurX():number\r\n\t{\r\n\t\treturn this._hBlurTask.amount;\r\n\t}\r\n\t\r\n\tpublic set blurX(value:number)\r\n\t{\r\n\t\tthis._hBlurTask.amount = value;\r\n\t}\r\n\t\r\n\tpublic get blurY():number\r\n\t{\r\n\t\treturn this._vBlurTask.amount;\r\n\t}\r\n\t\r\n\tpublic set blurY(value:number)\r\n\t{\r\n\t\tthis._vBlurTask.amount = value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * The distance between two blur samples. Set to -1 to autodetect with acceptable quality (default value).\r\n\t * Higher values provide better performance at the cost of reduces quality.\r\n\t */\r\n\tpublic get stepSize():number\r\n\t{\r\n\t\treturn this._hBlurTask.stepSize;\r\n\t}\r\n\t\r\n\tpublic set stepSize(value:number)\r\n\t{\r\n\t\tthis._hBlurTask.stepSize = value;\r\n\t\tthis._vBlurTask.stepSize = value;\r\n\t}\r\n\t\r\n\tpublic setRenderTargets(mainTarget:Image2D, stage:Stage)\r\n\t{\r\n\t\tthis._hBlurTask.target = this._vBlurTask.getMainInputTexture(stage);\r\n\t\tsuper.setRenderTargets(mainTarget, stage);\r\n\t}\r\n}\r\n\r\nexport = BlurFilter3D;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Filter3DCompositeTask\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DCompositeTask\");\r\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\r\n\r\nclass CompositeFilter3D extends Filter3DBase\r\n{\r\n\tprivate _compositeTask:Filter3DCompositeTask;\r\n\t\r\n\t/**\r\n\t * Creates a new CompositeFilter3D object\r\n\t * @param blurX The amount of horizontal blur to apply\r\n\t * @param blurY The amount of vertical blur to apply\r\n\t * @param stepSize The distance between samples. Set to -1 to autodetect with acceptable quality.\r\n\t */\r\n\tconstructor(blendMode:string, exposure:number = 1)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._compositeTask = new Filter3DCompositeTask(blendMode, exposure);\r\n\r\n\t\tthis.addTask(this._compositeTask);\r\n\t}\r\n\t\r\n\tpublic get exposure():number\r\n\t{\r\n\t\treturn this._compositeTask.exposure;\r\n\t}\r\n\t\r\n\tpublic set exposure(value:number)\r\n\t{\r\n\t\tthis._compositeTask.exposure = value;\r\n\t}\r\n\r\n\r\n\tpublic get overlayTexture():Image2D\r\n\t{\r\n\t\treturn this._compositeTask.overlayTexture;\r\n\t}\r\n\r\n\tpublic set overlayTexture(value:Image2D)\r\n\t{\r\n\t\tthis._compositeTask.overlayTexture = value;\r\n\t}\r\n}\r\n\r\nexport = CompositeFilter3D;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\nclass Filter3DBase\r\n{\r\n\tprivate _tasks:Array<Filter3DTaskBase>;\r\n\tprivate _requireDepthRender:boolean;\r\n\tprivate _textureWidth:number;\r\n\tprivate _textureHeight:number;\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._tasks = new Array<Filter3DTaskBase>();\r\n\t}\r\n\r\n\tpublic get requireDepthRender():boolean\r\n\t{\r\n\t\treturn this._requireDepthRender;\r\n\t}\r\n\r\n\tpublic addTask(filter:Filter3DTaskBase)\r\n\t{\r\n\t\tthis._tasks.push(filter);\r\n\r\n\t\tif (this._requireDepthRender == null)\r\n\t\t\tthis._requireDepthRender = filter.requireDepthRender;\r\n\t}\r\n\r\n\tpublic get tasks():Filter3DTaskBase[]\r\n\t{\r\n\t\treturn this._tasks;\r\n\t}\r\n\r\n\tpublic getMainInputTexture(stage:Stage):Image2D\r\n\t{\r\n\t\treturn this._tasks[0].getMainInputTexture(stage);\r\n\t}\r\n\r\n\tpublic get textureWidth():number\r\n\t{\r\n\t\treturn this._textureWidth;\r\n\t}\r\n\r\n\tpublic set textureWidth(value:number)\r\n\t{\r\n\t\tthis._textureWidth = value;\r\n\r\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\r\n\t\t\tthis._tasks[i].textureWidth = value;\r\n\t}\r\n\r\n\tpublic get textureHeight():number\r\n\t{\r\n\t\treturn this._textureHeight;\r\n\t}\r\n\r\n\tpublic set textureHeight(value:number)\r\n\t{\r\n\t\tthis._textureHeight = value;\r\n\r\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\r\n\t\t\tthis._tasks[i].textureHeight = value;\r\n\t}\r\n\r\n\t// link up the filters correctly with the next filter\r\n\tpublic setRenderTargets(mainTarget:Image2D, stage:Stage)\r\n\t{\r\n\t\tthis._tasks[this._tasks.length - 1].target = mainTarget;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\r\n\t\t\tthis._tasks[i].dispose();\r\n\t}\r\n\r\n\tpublic update(stage:Stage, camera:Camera)\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = Filter3DBase;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\n\r\nclass Filter3DCompositeTask extends Filter3DTaskBase\r\n{\r\n\tprivate _data:Float32Array;\r\n\tprivate _overlayTexture:Image2D;\r\n\tprivate _overlayWidth:number;\r\n\tprivate _overlayHeight:number;\r\n\tprivate _blendMode:string;\r\n\t\r\n\tconstructor(blendMode:string, exposure:number = 1)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._data = new Float32Array([exposure, 0.5, 2.0, -1, 0.0, 0.0, 0.0, 0.0 ]);\r\n\t\tthis._blendMode = blendMode;\r\n\t}\r\n\t\r\n\tpublic get overlayTexture():Image2D\r\n\t{\r\n\t\treturn this._overlayTexture;\r\n\t}\r\n\t\r\n\tpublic set overlayTexture(value:Image2D)\r\n\t{\r\n\t\tthis._overlayTexture = value;\r\n\t\tthis._overlayWidth = this._overlayTexture.width;\r\n\t\tthis._overlayHeight = this._overlayTexture.height;\r\n\t}\r\n\t\r\n\tpublic get exposure():number\r\n\t{\r\n\t\treturn this._data[0];\r\n\t}\r\n\t\r\n\tpublic set exposure(value:number)\r\n\t{\r\n\t\tthis._data[0] = value;\r\n\t}\r\n\t\r\n\tpublic getFragmentCode():string\r\n\t{\r\n\r\n\t\tvar code:string;\r\n\t\tvar op:string;\r\n\t\tcode = \"tex ft0, v0, fs0 <2d,linear,clamp>\\n\" +\r\n\t\t\t\"mul ft1, v0, fc1.zw\\n\" +\r\n\t\t\t\"add ft1, ft1, fc1.xy\\n\" +\r\n\t\t\t\"tex ft1, ft1, fs1 <2d,linear,clamp>\\n\" +\r\n\t\t\t\"mul ft1, ft1, fc0.xxx\\n\" +\r\n\t\t\t\"add ft1, ft1, fc0.xxx\\n\";\r\n\t\tswitch (this._blendMode) {\r\n\t\t\tcase \"multiply\":\r\n\t\t\t\tcode += \"mul oc, ft0, ft1\\n\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"add\":\r\n\t\t\t\tcode += \"add oc, ft0, ft1\\n\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"subtract\":\r\n\t\t\t\tcode += \"sub oc, ft0, ft1\\n\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"overlay\":\r\n\t\t\t\tcode += \"sge ft2, ft0, fc0.yyy\\n\"; // t2 = (blend >= 0.5)? 1 : 0\r\n\t\t\t\tcode += \"sub ft0, ft2, ft0\\n\"; // base = (1 : 0 - base)\r\n\t\t\t\tcode += \"sub ft1, ft1, ft2\\n\"; // blend = (blend - 1 : 0)\r\n\t\t\t\tcode += \"mul ft1, ft1, ft0\\n\"; // blend = blend * base\r\n\t\t\t\tcode += \"sub ft3, ft2, fc0.yyy\\n\"; // t3 = (blend >= 0.5)? 0.5 : -0.5\r\n\t\t\t\tcode += \"div ft1, ft1, ft3\\n\"; // blend = blend / ( 0.5 : -0.5)\r\n\t\t\t\tcode += \"add oc, ft1, ft2\\n\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"normal\":\r\n\t\t\t\t// for debugging purposes\r\n\t\t\t\tcode += \"mov oc, ft0\\n\";\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"Unknown blend mode\");\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\t\r\n\tpublic activate(stage:Stage, camera3D:Camera, depthTexture:Image2D)\r\n\t{\r\n\t\tthis._data[4] = -0.5*(this._scaledTextureWidth - this._overlayWidth)/this._overlayWidth;\r\n\t\tthis._data[5] = -0.5*(this._scaledTextureHeight - this._overlayHeight)/this._overlayHeight;\r\n\r\n\t\tthis._data[6] = this._scaledTextureWidth/this._overlayWidth;\r\n\t\tthis._data[7] = this._scaledTextureHeight/this._overlayHeight;\r\n\r\n\t\tvar context:IContextGL = stage.context;\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._data, 2);\r\n\t\tstage.getImageObject(this._overlayTexture).activate(1, false, true, false);\r\n\t}\r\n\t\r\n\tpublic deactivate(stage:Stage)\r\n\t{\r\n\t\tstage.context.setTextureAt(1, null);\r\n\t}\r\n}\r\n\r\nexport = Filter3DCompositeTask;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\nclass Filter3DFXAATask extends Filter3DTaskBase\r\n{\r\n\tprivate _data:Float32Array;\r\n\t//TODO - remove blur variables and create setters/getters for FXAA\r\n\tprivate static MAX_AUTO_SAMPLES:number = 15;\r\n\tprivate _amount:number;\r\n\tprivate _stepSize:number = 1;\r\n\tprivate _realStepSize:number;\r\n\t\r\n\t/**\r\n\t *\r\n\t * @param amount\r\n\t * @param stepSize The distance between samples. Set to -1 to autodetect with acceptable quality.\r\n\t */\r\n\tconstructor(amount:number, stepSize:number = -1)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._data =  new Float32Array(16);\r\n\t\t//luma\r\n\t\tthis._data.set([0.299, 0.587, 0.114, 1],0);//0.212, 0.716, 0.072\r\n\t\t//helpers\r\n\t\tthis._data.set([0.25, 0.5, 0.75, 8], 4);\r\n\t\t//settings (screen x, screen y, ...)\r\n\t\tthis._data.set([1/1024, 1/1024, 1/128, 1/8], 8);\r\n\t\t//deltas\r\n\t\tthis._data.set([1.0/3.0 - 0.5, 2.0/3.0 - 0.5, 0.0/3.0 - 0.5, 3.0/3.0 - 0.5], 12);\r\n\r\n\t\tthis.stepSize = stepSize;\r\n\t}\r\n\r\n\tpublic get amount():number\r\n\t{\r\n\t\treturn this._amount;\r\n\t}\r\n\r\n\tpublic set amount(value:number)\r\n\t{\r\n\t\tif (this._amount == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._amount = value;\r\n\r\n\t\tthis.invalidateProgram();\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tpublic get stepSize():number\r\n\t{\r\n\t\treturn this._stepSize;\r\n\t}\r\n\r\n\tpublic set stepSize(value:number)\r\n\t{\r\n\t\tif (this._stepSize == value)\r\n\t\t\treturn;\r\n\t\tthis._stepSize = value;\r\n\t\tthis.calculateStepSize();\r\n\t\tthis.invalidateProgram();\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tpublic getFragmentCode():string\r\n\t{\r\n\t\tvar uv_in:string = \"v0\";\r\n\r\n\t\tvar w:string = \"fc2.z\";\t\t//\t1.75\r\n\r\n\t\tvar lum:string = \"fc0\";\t\t//\t0.299, 0.587, 0.114\r\n\t\tvar s:string = \"fc2.w\";\t\t//\t1/16\r\n\t\tvar div:string = \"fc1.w\";\t//\t4.3\r\n\r\n\t\tvar pix:string = \"fc2.xy\";\r\n\t\tvar dx:string = \"fc2.x\";\r\n\t\tvar dy:string = \"fc2.y\";\r\n\t\tvar mOne:string = \"fc3.w\";\r\n\t\tvar mul:string = \"fc3.x\";\r\n\r\n\t\tvar delta1:string = \"fc4.x\";\t//1.0/3.0 - 0.5\r\n\t\tvar delta2:string = \"fc4.y\";\t//2.0/3.0 - 0.5\r\n\t\tvar delta3:string = \"fc4.z\";\t//0.0/3.0 - 0.5\r\n\t\tvar delta4:string = \"fc4.w\";\t//3.0/3.0 - 0.5\r\n\r\n\t\tvar _0:string = \"fc3.x\";\r\n\t\tvar _025:string = \"fc1.x\";\r\n\t\tvar _05:string = \"fc1.y\";\r\n\t\tvar _075:string = \"fc1.z\";\r\n\t\tvar _1:string = \"fc0.w\";\r\n\r\n\r\n\t\tvar uv:string = \"ft0.xy\";\r\n\t\tvar uvx:string = \"ft0.x\";\r\n\t\tvar uvy:string = \"ft0.y\";\r\n\r\n\t\tvar TL:string = \"ft2.x\";\r\n\t\tvar TR:string = \"ft2.y\";\r\n\t\tvar BL:string = \"ft2.z\";\r\n\t\tvar BR:string = \"ft2.w\";\r\n\t\tvar M:string = \"ft3.x\";\r\n\r\n\t\tvar tempf1:string = \"ft3.y\";\r\n\t\tvar tempf2:string = \"ft3.z\";\r\n\t\tvar tempf3:string = \"ft3.w\";\r\n\r\n\t\tvar tex:string = \"ft1\";\r\n\r\n\t\tvar dir:string = \"ft4\";\r\n\t\tvar dirx:string = \"ft4.x\";\r\n\t\tvar diry:string = \"ft4.y\";\r\n\t\tvar dirxy:string = \"ft4.xy\";\r\n\r\n\t\tvar dirReduce:string = \"ft5.x\";\r\n\t\tvar inverseDirAdjustment:string = \"ft5.y\";\r\n\r\n\t\tvar result1:string = \"ft6\";\r\n\t\tvar result2:string = \"ft7\";\r\n\r\n\t\tvar fxaaReduceMin :string = \"fc2.x\";\t//1/128\r\n\t\tvar fxaaReduceMul :string = \"fc2.y\";\t//1/8\r\n\t\tvar fxaaSpanMax :string = \"fc1.w\";\t\t//8\r\n\r\n\t\tvar lumaMin:string = \"ft5.x\";\r\n\t\tvar lumaMax:string = \"ft5.y\";\r\n\r\n\t\tvar sample:string = \"fs0\";\r\n\r\n\r\n\t\tvar temp:string = tex;\r\n\t\tvar tempxy:string = temp + \".xy\";\r\n\t\t\r\n\t\tvar code:Array<string> =  new Array<string>();\r\n\r\n\t\t//lumas\r\n\t\tcode.push(tex, tex, uv_in, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"dp3\", M, tex, lum, \"\\n\");\r\n\t\tcode.push(\"mov\", uv, uv_in, \"\\n\");\r\n\t\tcode.push(\"sub\", uv, uv, pix, \"\\n\");\r\n\t\tcode.push(\"tex\", tex, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"dp3\", TL, tex, lum, \"\\n\");\r\n\t\tcode.push(\"mov\", uv, uv_in, \"\\n\");\r\n\t\tcode.push(\"add\", uv, uv, pix, \"\\n\");\r\n\t\tcode.push(\"tex\", tex, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"dp3\",  BR, tex, lum, \"\\n\");\r\n\t\tcode.push(\"mov\", uv, uv_in, \"\\n\");\r\n\t\tcode.push(\"sub\", uvy, uvy, dy, \"\\n\");\r\n\t\tcode.push(\"add\", uvx, uvx, dx, \"\\n\");\r\n\t\tcode.push(\"tex\", tex, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"dp3\", TR, tex, lum, \"\\n\");\r\n\t\tcode.push(\"mov\", uv, uv_in, \"\\n\");\r\n\t\tcode.push(\"add\", uvy, uvy, dy, \"\\n\");\r\n\t\tcode.push(\"sub\", uvx, uvx, dx, \"\\n\");\r\n\t\tcode.push(\"tex\", tex, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"dp3\", BL, tex, lum, \"\\n\");\r\n\r\n\t\t//dir\r\n\t\tcode.push(\"add\", tempf1, TL, TR, \"\\n\");\r\n\t\tcode.push(\"add\", tempf2, BL, BR, \"\\n\");\r\n\t\tcode.push(\"sub\", dirx, tempf1, tempf2, \"\\n\");\r\n\t\tcode.push(\"neg\", dirx, dirx, \"\\n\");\r\n\r\n\t\tcode.push(\"add\", tempf1, TL, BL, \"\\n\");\r\n\t\tcode.push(\"add\", tempf2, TR, BR, \"\\n\");\r\n\t\tcode.push(\"sub\", diry, tempf1, tempf2, \"\\n\");\r\n\r\n\t\tcode.push(\"add\", tempf1, tempf1, tempf2, \"\\n\");\r\n\t\tcode.push(\"mul\", tempf1, tempf1, fxaaReduceMul, \"\\n\");\r\n\t\tcode.push(\"mul\", tempf1, tempf1, _025, \"\\n\");\r\n\t\tcode.push(\"max\", dirReduce, tempf1, fxaaReduceMin, \"\\n\");\r\n\r\n\t\tcode.push(\"abs\", tempf1, dirx, \"\\n\");\r\n\t\tcode.push(\"abs\", tempf2, diry, \"\\n\");\r\n\t\tcode.push(\"min\", tempf1, tempf1, tempf2, \"\\n\");\r\n\t\tcode.push(\"add\", tempf1, tempf1, dirReduce, \"\\n\");\r\n\t\tcode.push(\"rcp\", inverseDirAdjustment, tempf1, \"\\n\");\r\n\r\n\t\tcode.push(\"mul\", tempf1, dirx, inverseDirAdjustment, \"\\n\");\r\n\t\tcode.push(\"mov\", tempf2, fxaaSpanMax, \"\\n\");\r\n\t\tcode.push(\"neg\", tempf2, tempf2, \"\\n\");\r\n\t\tcode.push(\"max\", tempf1, tempf1, tempf2, \"\\n\");\r\n\t\tcode.push(\"min\", tempf1, fxaaSpanMax, tempf1, \"\\n\");\r\n\t\tcode.push(\"mul\", dirx, tempf1, dx, \"\\n\");\r\n\r\n\t\tcode.push(\"mul\", tempf1, diry, inverseDirAdjustment, \"\\n\");\r\n\t\tcode.push(\"mov\", tempf2, fxaaSpanMax, \"\\n\");\r\n\t\tcode.push(\"neg\", tempf2, tempf2, \"\\n\");\r\n\t\tcode.push(\"max\", tempf1, tempf1, tempf2, \"\\n\");\r\n\t\tcode.push(\"min\", tempf1, fxaaSpanMax, tempf1, \"\\n\");\r\n\t\tcode.push(\"mul\", diry, tempf1, dy, \"\\n\");\r\n\r\n\r\n\t\tcode.push(\"mul\", tempxy, dirxy, delta1, \"\\n\");\r\n\t\tcode.push(\"add\", uv, uv_in, tempxy, \"\\n\");\r\n\t\tcode.push(\"tex\", result1, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"mul\", tempxy, dirxy, delta2, \"\\n\");\r\n\t\tcode.push(\"add\", uv, uv_in, tempxy, \"\\n\");\r\n\t\tcode.push(\"tex\", tex, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"add\", result1, result1, tex, \"\\n\");\r\n\t\tcode.push(\"mul\", result1, result1, _05, \"\\n\");\r\n\r\n\t\tcode.push(\"mul\", tempxy, dirxy, delta3, \"\\n\");\r\n\t\tcode.push(\"add\", uv, uv_in, tempxy, \"\\n\");\r\n\t\tcode.push(\"tex\", result2, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"mul\", tempxy, dirxy, delta4, \"\\n\");\r\n\t\tcode.push(\"add\", uv, uv_in, tempxy, \"\\n\");\r\n\t\tcode.push(\"tex\", tex, uv, sample, \"2d\", \"wrap\", \"linear\", \"\\n\");\r\n\t\tcode.push(\"add\", result2, result2, tex, \"\\n\");\r\n\t\tcode.push(\"mul\", result2, result2, _025, \"\\n\");\r\n\t\tcode.push(\"mul\", tex, result1, _05, \"\\n\");\r\n\t\tcode.push(\"add\", result2, result2, tex, \"\\n\");\r\n\r\n\t\tcode.push(\"min\", tempf1, BL, BR, \"\\n\");\r\n\t\tcode.push(\"min\", tempf2, TL, TR, \"\\n\");\r\n\t\tcode.push(\"min\", tempf1, tempf1, tempf2, \"\\n\");\r\n\t\tcode.push(\"min\", lumaMin, tempf1, M, \"\\n\");\r\n\r\n\t\tcode.push(\"max\", tempf1, BL, BR, \"\\n\");\r\n\t\tcode.push(\"max\", tempf2, TL, TR, \"\\n\");\r\n\t\tcode.push(\"max\", tempf1, tempf1, tempf2, \"\\n\");\r\n\t\tcode.push(\"max\", lumaMax, tempf1, M, \"\\n\");\r\n\r\n\t\tcode.push(\"dp3\", tempf1, lum, result2, \"\\n\");\r\n\r\n\t\tcode.push(\"slt\", tempf2, tempf1, lumaMin, \"\\n\");\r\n\t\tcode.push(\"sge\", tempf3, tempf1, lumaMax, \"\\n\");\r\n\t\tcode.push(\"mul\", tempf2, tempf2, tempf3, \"\\n\");\r\n\r\n\t\tcode.push(\"mul\", result1, result1, tempf2, \"\\n\");\r\n\t\tcode.push(\"sub\", tempf2, _1, tempf2, \"\\n\");\r\n\t\tcode.push(\"mul\", result2, result2, tempf2, \"\\n\");\r\n\r\n\t\tcode.push(\"add\", \"oc\", result1, result2, \"\\n\");\r\n\r\n\t\t//this._data[2] = 1/numSamples;\r\n\r\n\t\treturn code.join(\" \");\r\n\t}\r\n\r\n\tpublic activate(stage:Stage, camera3D:Camera, depthTexture:Image2D)\r\n\t{\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._data, 1);\r\n\t}\r\n\r\n\tpublic updateTextures(stage:Stage)\r\n\t{\r\n\t\tsuper.updateTextures(stage);\r\n\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tprivate updateBlurData()\r\n\t{\r\n\t\t// todo: must be normalized using view size ratio instead of texture\r\n\t\tvar invH:number = 1/this._textureHeight;\r\n\r\n\t\tthis._data[0] = this._amount*.5*invH;\r\n\t\tthis._data[1] = this._realStepSize*invH;\r\n\t}\r\n\r\n\tprivate calculateStepSize()\r\n\t{\r\n\t\tthis._realStepSize = 1;//this._stepSize > 0? this._stepSize : this._amount > Filter3DVBlurTask.MAX_AUTO_SAMPLES? this._amount/Filter3DVBlurTask.MAX_AUTO_SAMPLES : 1;\r\n\t}\r\n}\r\n\r\nexport = Filter3DFXAATask;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\nclass Filter3DHBlurTask extends Filter3DTaskBase\r\n{\r\n\tprivate static MAX_AUTO_SAMPLES:number = 15;\r\n\tprivate _amount:number;\r\n\tprivate _data:Float32Array;\r\n\tprivate _stepSize:number = 1;\r\n\tprivate _realStepSize:number;\r\n\r\n\t/**\r\n\t * Creates a new Filter3DHDepthOfFFieldTask\r\n\t * @param amount The maximum amount of blur to apply in pixels at the most out-of-focus areas\r\n\t * @param stepSize The distance between samples. Set to -1 to autodetect with acceptable quality.\r\n\t */\r\n\tconstructor(amount:number, stepSize:number = -1)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._amount = amount;\r\n\t\tthis._data = new Float32Array([0, 0, 0, 1]);\r\n\t\tthis.stepSize = stepSize;\r\n\t}\r\n\r\n\tpublic get amount():number\r\n\t{\r\n\t\treturn this._amount;\r\n\t}\r\n\r\n\tpublic set amount(value:number)\r\n\t{\r\n\t\tif (this._amount == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._amount = value;\r\n\r\n\t\tthis.invalidateProgram();\r\n\t\tthis.updateBlurData();\r\n\t\tthis.calculateStepSize();\r\n\t}\r\n\r\n\tpublic get stepSize():number\r\n\t{\r\n\t\treturn this._stepSize;\r\n\t}\r\n\r\n\tpublic set stepSize(value:number)\r\n\t{\r\n\t\tif (this._stepSize == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._stepSize = value;\r\n\t\tthis.calculateStepSize();\r\n\t\tthis.invalidateProgram();\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tpublic getFragmentCode():string\r\n\t{\r\n\t\tvar code:string;\r\n\t\tvar numSamples:number = 1;\r\n\r\n\t\tcode = \"mov ft0, v0\t\\n\" +\r\n\t\t\t\"sub ft0.x, v0.x, fc0.x\\n\";\r\n\r\n\t\tcode += \"tex ft1, ft0, fs0 <2d,linear,clamp>\\n\";\r\n\r\n\t\tfor (var x:number = this._realStepSize; x <= this._amount; x += this._realStepSize) {\r\n\t\t\tcode += \"add ft0.x, ft0.x, fc0.y\\n\" +\r\n\t\t\t\t\"tex ft2, ft0, fs0 <2d,linear,clamp>\\n\" +\r\n\t\t\t\t\"add ft1, ft1, ft2\\n\";\r\n\t\t\t++numSamples;\r\n\t\t}\r\n\r\n\t\tcode += \"mul oc, ft1, fc0.z\\n\";\r\n\r\n\t\tthis._data[2] = 1/numSamples;\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic activate(stage:Stage, camera3D:Camera, depthTexture:Image2D)\r\n\t{\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._data, 1);\r\n\t}\r\n\r\n\tpublic updateTextures(stage:Stage)\r\n\t{\r\n\t\tsuper.updateTextures(stage);\r\n\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tprivate updateBlurData()\r\n\t{\r\n\t\t// todo: must be normalized using view size ratio instead of texture\r\n\t\tvar invW:number = 1/this._textureWidth;\r\n\r\n\t\tthis._data[0] = this._amount*.5*invW;\r\n\t\tthis._data[1] = this._realStepSize*invW;\r\n\t}\r\n\r\n\tprivate calculateStepSize()\r\n\t{\r\n\t\tthis._realStepSize = this._stepSize > 0? this._stepSize : this._amount > Filter3DHBlurTask.MAX_AUTO_SAMPLES? this._amount/Filter3DHBlurTask.MAX_AUTO_SAMPLES : 1;\r\n\t}\r\n}\r\n\r\nexport = Filter3DHBlurTask;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport AGALMiniAssembler\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\r\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\r\n\r\nclass Filter3DTaskBase\r\n{\r\n\tprivate _mainInputTexture:Image2D;\r\n\r\n\tpublic _scaledTextureWidth:number = -1;\r\n\tpublic _scaledTextureHeight:number = -1;\r\n\tpublic _textureWidth:number = -1;\r\n\tpublic _textureHeight:number = -1;\r\n\tprivate _textureDimensionsInvalid:boolean = true;\r\n\tprivate _program3DInvalid:boolean = true;\r\n\tprivate _program3D:IProgram;\r\n\tprivate _target:Image2D;\r\n\tprivate _requireDepthRender:boolean;\r\n\tprivate _textureScale:number = 0;\r\n\r\n\tconstructor(requireDepthRender:boolean = false)\r\n\t{\r\n\t\tthis._requireDepthRender = requireDepthRender;\r\n\t}\r\n\r\n\t/**\r\n\t * The texture scale for the input of this texture. This will define the output of the previous entry in the chain\r\n\t */\r\n\tpublic get textureScale():number\r\n\t{\r\n\t\treturn this._textureScale;\r\n\t}\r\n\r\n\tpublic set textureScale(value:number)\r\n\t{\r\n\t\tif (this._textureScale == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._textureScale = value;\r\n\t\tthis._scaledTextureWidth = this._textureWidth >> this._textureScale;\r\n\t\tthis._scaledTextureHeight = this._textureHeight >> this._textureScale;\r\n\t\tthis._textureDimensionsInvalid = true;\r\n\t}\r\n\r\n\tpublic get target():Image2D\r\n\t{\r\n\t\treturn this._target;\r\n\t}\r\n\r\n\tpublic set target(value:Image2D)\r\n\t{\r\n\t\tthis._target = value;\r\n\t}\r\n\r\n\tpublic get textureWidth():number\r\n\t{\r\n\t\treturn this._textureWidth;\r\n\t}\r\n\r\n\tpublic set textureWidth(value:number)\r\n\t{\r\n\t\tif (this._textureWidth == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._textureWidth = value;\r\n\t\tthis._scaledTextureWidth = this._textureWidth >> this._textureScale;\r\n\t\tthis._textureDimensionsInvalid = true;\r\n\t}\r\n\r\n\tpublic get textureHeight():number\r\n\t{\r\n\t\treturn this._textureHeight;\r\n\t}\r\n\r\n\tpublic set textureHeight(value:number)\r\n\t{\r\n\t\tif (this._textureHeight == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._textureHeight = value;\r\n\t\tthis._scaledTextureHeight = this._textureHeight >> this._textureScale;\r\n\t\tthis._textureDimensionsInvalid = true;\r\n\t}\r\n\r\n\tpublic getMainInputTexture(stage:Stage):Image2D\r\n\t{\r\n\t\tif (this._textureDimensionsInvalid)\r\n\t\t\tthis.updateTextures(stage);\r\n\r\n\t\treturn this._mainInputTexture;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tif (this._mainInputTexture)\r\n\t\t\tthis._mainInputTexture.dispose();\r\n\r\n\t\tif (this._program3D)\r\n\t\t\tthis._program3D.dispose();\r\n\t}\r\n\r\n\tpublic invalidateProgram()\r\n\t{\r\n\t\tthis._program3DInvalid = true;\r\n\t}\r\n\r\n\tpublic updateProgram(stage:Stage)\r\n\t{\r\n\t\tif (this._program3D)\r\n\t\t\tthis._program3D.dispose();\r\n\r\n\t\tthis._program3D = stage.context.createProgram();\r\n\r\n\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + this.getVertexCode() + \"endpart\"))['vertex'].data;\r\n\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + this.getFragmentCode() + \"endpart\"))['fragment'].data;\r\n\t\tthis._program3D.upload(vertexByteCode, fragmentByteCode);\r\n\t\tthis._program3DInvalid = false;\r\n\t}\r\n\r\n\tpublic getVertexCode():string\r\n\t{\r\n\t\treturn \"mov op, va0\\n\" + \"mov v0, va1\\n\";\r\n\t}\r\n\r\n\tpublic getFragmentCode():string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tpublic updateTextures(stage:Stage)\r\n\t{\r\n\t\tif (this._mainInputTexture)\r\n\t\t\tthis._mainInputTexture.dispose();\r\n\r\n\t\tthis._mainInputTexture = new Image2D(this._scaledTextureWidth, this._scaledTextureHeight);\r\n\r\n\t\tthis._textureDimensionsInvalid = false;\r\n\t}\r\n\r\n\tpublic getProgram(stage:Stage):IProgram\r\n\t{\r\n\t\tif (this._program3DInvalid)\r\n\t\t\tthis.updateProgram(stage);\r\n\r\n\t\treturn this._program3D;\r\n\t}\r\n\r\n\tpublic activate(stage:Stage, camera:Camera, depthTexture:Image2D)\r\n\t{\r\n\t}\r\n\r\n\tpublic deactivate(stage:Stage)\r\n\t{\r\n\t}\r\n\r\n\tpublic get requireDepthRender():boolean\r\n\t{\r\n\t\treturn this._requireDepthRender;\r\n\t}\r\n\r\n}\r\n\r\nexport = Filter3DTaskBase;",
    "import Image2D\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Image2D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\nclass Filter3DVBlurTask extends Filter3DTaskBase\r\n{\r\n\tprivate static MAX_AUTO_SAMPLES:number = 15;\r\n\tprivate _amount:number;\r\n\tprivate _data:Float32Array;\r\n\tprivate _stepSize:number = 1;\r\n\tprivate _realStepSize:number;\r\n\t\r\n\t/**\r\n\t *\r\n\t * @param amount\r\n\t * @param stepSize The distance between samples. Set to -1 to autodetect with acceptable quality.\r\n\t */\r\n\tconstructor(amount:number, stepSize:number = -1)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._amount = amount;\r\n\t\tthis._data =  new Float32Array([0, 0, 0, 1]);\r\n\t\tthis.stepSize = stepSize;\r\n\t}\r\n\r\n\tpublic get amount():number\r\n\t{\r\n\t\treturn this._amount;\r\n\t}\r\n\r\n\tpublic set amount(value:number)\r\n\t{\r\n\t\tif (this._amount == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._amount = value;\r\n\r\n\t\tthis.invalidateProgram();\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tpublic get stepSize():number\r\n\t{\r\n\t\treturn this._stepSize;\r\n\t}\r\n\r\n\tpublic set stepSize(value:number)\r\n\t{\r\n\t\tif (this._stepSize == value)\r\n\t\t\treturn;\r\n\t\tthis._stepSize = value;\r\n\t\tthis.calculateStepSize();\r\n\t\tthis.invalidateProgram();\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tpublic getFragmentCode():string\r\n\t{\r\n\t\tvar code:string;\r\n\t\tvar numSamples:number = 1;\r\n\r\n\t\tcode = \"mov ft0, v0\t\\n\" +\r\n\t\t\t\"sub ft0.y, v0.y, fc0.x\\n\";\r\n\r\n\t\tcode += \"tex ft1, ft0, fs0 <2d,linear,clamp>\\n\";\r\n\r\n\t\tfor (var x:number = this._realStepSize; x <= this._amount; x += this._realStepSize) {\r\n\t\t\tcode += \"add ft0.y, ft0.y, fc0.y\\n\";\r\n\t\t\tcode += \"tex ft2, ft0, fs0 <2d,linear,clamp>\\n\" +\r\n\t\t\t\t\"add ft1, ft1, ft2\\n\";\r\n\t\t\t++numSamples;\r\n\t\t}\r\n\r\n\t\tcode += \"mul oc, ft1, fc0.z\\n\";\r\n\r\n\t\tthis._data[2] = 1/numSamples;\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic activate(stage:Stage, camera3D:Camera, depthTexture:Image2D)\r\n\t{\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._data, 1);\r\n\t}\r\n\r\n\tpublic updateTextures(stage:Stage)\r\n\t{\r\n\t\tsuper.updateTextures(stage);\r\n\r\n\t\tthis.updateBlurData();\r\n\t}\r\n\r\n\tprivate updateBlurData()\r\n\t{\r\n\t\t// todo: must be normalized using view size ratio instead of texture\r\n\t\tvar invH:number = 1/this._textureHeight;\r\n\r\n\t\tthis._data[0] = this._amount*.5*invH;\r\n\t\tthis._data[1] = this._realStepSize*invH;\r\n\t}\r\n\r\n\tprivate calculateStepSize()\r\n\t{\r\n\t\tthis._realStepSize = this._stepSize > 0? this._stepSize : this._amount > Filter3DVBlurTask.MAX_AUTO_SAMPLES? this._amount/Filter3DVBlurTask.MAX_AUTO_SAMPLES : 1;\r\n\t}\r\n}\r\n\r\nexport = Filter3DVBlurTask;",
    "import Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ImageUtils\t\t\t\t\t= require(\"awayjs-core/lib/utils/ImageUtils\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\r\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\r\n\r\nclass RTTBufferManager extends EventDispatcher\r\n{\r\n\tprivate static _instances:Array<RTTBufferManagerVO>;\r\n\r\n\tprivate _renderToTextureVertexBuffer:IVertexBuffer;\r\n\tprivate _renderToScreenVertexBuffer:IVertexBuffer;\r\n\r\n\tprivate _indexBuffer:IIndexBuffer;\r\n\tprivate _stage:Stage;\r\n\tprivate _viewWidth:number = -1;\r\n\tprivate _viewHeight:number = -1;\r\n\tprivate _textureWidth:number = -1;\r\n\tprivate _textureHeight:number = -1;\r\n\tprivate _renderToTextureRect:Rectangle;\r\n\tprivate _buffersInvalid:boolean = true;\r\n\r\n\tprivate _textureRatioX:number;\r\n\tprivate _textureRatioY:number;\r\n\r\n\tconstructor(stage:Stage)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._renderToTextureRect = new Rectangle();\r\n\r\n\t\tthis._stage = stage;\r\n\r\n\t}\r\n\r\n\tpublic static getInstance(stage:Stage):RTTBufferManager\r\n\t{\r\n\t\tif (!stage)\r\n\t\t\tthrow new Error(\"stage key cannot be null!\");\r\n\r\n\t\tif (RTTBufferManager._instances == null)\r\n\t\t\tRTTBufferManager._instances = new Array<RTTBufferManagerVO>();\r\n\r\n\t\tvar rttBufferManager:RTTBufferManager = RTTBufferManager.getRTTBufferManagerFromStage(stage);\r\n\r\n\t\tif (rttBufferManager == null) {\r\n\t\t\trttBufferManager = new RTTBufferManager(stage);\r\n\r\n\t\t\tvar vo:RTTBufferManagerVO = new RTTBufferManagerVO();\r\n\r\n\t\t\tvo.stage3d = stage;\r\n\t\t\tvo.rttbfm = rttBufferManager;\r\n\r\n\t\t\tRTTBufferManager._instances.push(vo);\r\n\t\t}\r\n\r\n\t\treturn rttBufferManager;\r\n\r\n\t}\r\n\r\n\tprivate static getRTTBufferManagerFromStage(stage:Stage):RTTBufferManager\r\n\t{\r\n\r\n\t\tvar l:number = RTTBufferManager._instances.length;\r\n\t\tvar r:RTTBufferManagerVO;\r\n\r\n\t\tfor (var c:number = 0; c < l; c++) {\r\n\t\t\tr = RTTBufferManager._instances[ c ];\r\n\r\n\t\t\tif (r.stage3d === stage)\r\n\t\t\t\treturn r.rttbfm;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate static deleteRTTBufferManager(stage:Stage):void\r\n\t{\r\n\t\tvar l:number = RTTBufferManager._instances.length;\r\n\t\tvar r:RTTBufferManagerVO;\r\n\r\n\t\tfor (var c:number = 0; c < l; c++) {\r\n\t\t\tr = RTTBufferManager._instances[ c ];\r\n\r\n\t\t\tif (r.stage3d === stage) {\r\n\t\t\t\tRTTBufferManager._instances.splice(c, 1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get textureRatioX():number\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._textureRatioX;\r\n\t}\r\n\r\n\tpublic get textureRatioY():number\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._textureRatioY;\r\n\t}\r\n\r\n\tpublic get viewWidth():number\r\n\t{\r\n\t\treturn this._viewWidth;\r\n\t}\r\n\r\n\tpublic set viewWidth(value:number)\r\n\t{\r\n\t\tif (value == this._viewWidth)\r\n\t\t\treturn;\r\n\r\n\t\tthis._viewWidth = value;\r\n\r\n\t\tthis._buffersInvalid = true;\r\n\r\n\t\tthis._textureWidth = ImageUtils.getBestPowerOf2(this._viewWidth);\r\n\r\n\t\tif (this._textureWidth > this._viewWidth) {\r\n\t\t\tthis._renderToTextureRect.x = Math.floor((this._textureWidth - this._viewWidth)*.5);\r\n\t\t\tthis._renderToTextureRect.width = this._viewWidth;\r\n\t\t} else {\r\n\t\t\tthis._renderToTextureRect.x = 0;\r\n\t\t\tthis._renderToTextureRect.width = this._textureWidth;\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent(new Event(Event.RESIZE));\r\n\t}\r\n\r\n\tpublic get viewHeight():number\r\n\t{\r\n\t\treturn this._viewHeight;\r\n\t}\r\n\r\n\tpublic set viewHeight(value:number)\r\n\t{\r\n\t\tif (value == this._viewHeight)\r\n\t\t\treturn;\r\n\r\n\t\tthis._viewHeight = value;\r\n\r\n\t\tthis._buffersInvalid = true;\r\n\r\n\t\tthis._textureHeight = ImageUtils.getBestPowerOf2(this._viewHeight);\r\n\r\n\t\tif (this._textureHeight > this._viewHeight) {\r\n\t\t\tthis._renderToTextureRect.y = Math.floor((this._textureHeight - this._viewHeight)*.5);\r\n\t\t\tthis._renderToTextureRect.height = this._viewHeight;\r\n\t\t} else {\r\n\t\t\tthis._renderToTextureRect.y = 0;\r\n\t\t\tthis._renderToTextureRect.height = this._textureHeight;\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent(new Event(Event.RESIZE));\r\n\t}\r\n\r\n\tpublic get renderToTextureVertexBuffer():IVertexBuffer\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._renderToTextureVertexBuffer;\r\n\t}\r\n\r\n\tpublic get renderToScreenVertexBuffer():IVertexBuffer\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._renderToScreenVertexBuffer;\r\n\r\n\t}\r\n\r\n\tpublic get indexBuffer():IIndexBuffer\r\n\t{\r\n\t\treturn this._indexBuffer;\r\n\t}\r\n\r\n\tpublic get renderToTextureRect():Rectangle\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._renderToTextureRect;\r\n\t}\r\n\r\n\tpublic get textureWidth():number\r\n\t{\r\n\t\treturn this._textureWidth;\r\n\t}\r\n\r\n\tpublic get textureHeight():number\r\n\t{\r\n\t\treturn this._textureHeight;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tRTTBufferManager.deleteRTTBufferManager(this._stage);\r\n\r\n\t\tif (this._indexBuffer) {\r\n\t\t\tthis._indexBuffer.dispose();\r\n\t\t\tthis._renderToScreenVertexBuffer.dispose();\r\n\t\t\tthis._renderToTextureVertexBuffer.dispose();\r\n\t\t\tthis._renderToScreenVertexBuffer = null;\r\n\t\t\tthis._renderToTextureVertexBuffer = null;\r\n\t\t\tthis._indexBuffer = null;\r\n\t\t}\r\n\t}\r\n\r\n\t// todo: place all this in a separate model, since it's used all over the place\r\n\t// maybe it even has a place in the core (together with screenRect etc)?\r\n\t// needs to be stored per view of course\r\n\tprivate updateRTTBuffers()\r\n\t{\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tvar textureVerts:number[];\r\n\t\tvar screenVerts:number[];\r\n\r\n\t\tvar x:number;\r\n\t\tvar y:number;\r\n\r\n\t\tif (this._renderToTextureVertexBuffer == null)\r\n\t\t\tthis._renderToTextureVertexBuffer = context.createVertexBuffer(4, 20);\r\n\r\n\t\tif (this._renderToScreenVertexBuffer == null)\r\n\t\t\tthis._renderToScreenVertexBuffer = context.createVertexBuffer(4, 20);\r\n\r\n\t\tif (!this._indexBuffer) {\r\n\t\t\tthis._indexBuffer = context.createIndexBuffer(6);\r\n\r\n\t\t\tthis._indexBuffer.uploadFromArray([2, 1, 0, 3, 2, 0], 0, 6);\r\n\t\t}\r\n\r\n\t\tthis._textureRatioX = x = Math.min(this._viewWidth/this._textureWidth, 1);\r\n\t\tthis._textureRatioY = y = Math.min(this._viewHeight/this._textureHeight, 1);\r\n\r\n\t\tvar u1:number = (1 - x)*.5;\r\n\t\tvar u2:number = (x + 1)*.5;\r\n\t\tvar v1:number = (1 - y)*.5;\r\n\t\tvar v2:number = (y + 1)*.5;\r\n\r\n\t\t// last element contains indices for data per vertex that can be passed to the vertex shader if necessary (ie: frustum corners for deferred rendering)\r\n\t\ttextureVerts = [    -x, -y, u1, v1, 0, x, -y, u2, v1, 1, x, y, u2, v2, 2, -x, y, u1, v2, 3 ];\r\n\r\n\t\tscreenVerts = [     -1, -1, u1, v1, 0, 1, -1, u2, v1, 1, 1, 1, u2, v2, 2, -1, 1, u1, v2, 3 ];\r\n\r\n\t\tthis._renderToTextureVertexBuffer.uploadFromArray(textureVerts, 0, 4);\r\n\t\tthis._renderToScreenVertexBuffer.uploadFromArray(screenVerts, 0, 4);\r\n\r\n\t\tthis._buffersInvalid = false;\r\n\t}\r\n}\r\n\r\nexport = RTTBufferManager;\r\n\r\nclass RTTBufferManagerVO\r\n{\r\n\tpublic stage3d:Stage;\r\n\r\n\tpublic rttbfm:RTTBufferManager;\r\n}",
    "import Debug\t\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/Debug\");\r\nimport BitmapImage2D\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapImage2D\");\r\nimport Box\t\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\nimport Rectangle\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Scene\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\r\nimport View\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\r\nimport IPicker\t\t\t\t\t\t\t= require(\"awayjs-display/lib/pick/IPicker\");\r\nimport PickingCollisionVO\t\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\r\nimport EntityCollector\t\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport IEntity\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport AGALMiniAssembler\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\r\nimport ContextGLDrawMode\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLDrawMode\");\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLBlendFactor\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLClearMask\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\r\nimport ContextGLCompareMode\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport ContextGLTriangleFace\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\r\nimport IContextGL\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IProgram\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\r\nimport ITextureBase\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITextureBase\");\r\n\r\nimport DefaultRenderer\t\t\t\t\t= require(\"awayjs-renderergl/lib/DefaultRenderer\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport SubGeometryVOBase\t\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOBase\");\r\nimport SubGeometryVOPool\t\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOPool\");\r\n\r\n/**\r\n * Picks a 3d object from a view or scene by performing a separate render pass on the scene around the area being picked using key color values,\r\n * then reading back the color value of the pixel in the render representing the picking ray. Requires multiple passes and readbacks for retriving details\r\n * on an entity that has its shaderPickingDetails property set to true.\r\n *\r\n * A read-back operation from any GPU is not a very efficient process, and the amount of processing used can vary significantly between different hardware.\r\n *\r\n * @see away.entities.Entity#shaderPickingDetails\r\n *\r\n * @class away.pick.ShaderPicker\r\n */\r\nclass ShaderPicker implements IPicker\r\n{\r\n\tprivate _opaqueRenderableHead:RenderableBase;\r\n\tprivate _blendedRenderableHead:RenderableBase;\r\n\r\n\tprivate _stage:Stage;\r\n\tprivate _context:IContextGL;\r\n\tprivate _onlyMouseEnabled:boolean = true;\r\n\r\n\tprivate _objectProgram:IProgram;\r\n\tprivate _triangleProgram:IProgram;\r\n\tprivate _bitmapImage2D:BitmapImage2D;\r\n\tprivate _viewportData:Float32Array;\r\n\tprivate _boundOffsetScale:Float32Array;\r\n\tprivate _id:Float32Array;\r\n\r\n\tprivate _interactives:Array<RenderableBase> = new Array<RenderableBase>();\r\n\tprivate _interactiveId:number;\r\n\tprivate _hitColor:number;\r\n\tprivate _projX:number;\r\n\tprivate _projY:number;\r\n\r\n\tprivate _hitRenderable:RenderableBase;\r\n\tprivate _hitEntity:IEntity;\r\n\tprivate _localHitPosition:Vector3D = new Vector3D();\r\n\tprivate _hitUV:Point = new Point();\r\n\tprivate _faceIndex:number;\r\n\tprivate _subGeometryIndex:number;\r\n\r\n\tprivate _localHitNormal:Vector3D = new Vector3D();\r\n\r\n\tprivate _rayPos:Vector3D = new Vector3D();\r\n\tprivate _rayDir:Vector3D = new Vector3D();\r\n\tprivate _potentialFound:boolean;\r\n\tprivate static MOUSE_SCISSOR_RECT:Rectangle = new Rectangle(0, 0, 1, 1);\r\n\r\n\tprivate _shaderPickingDetails:boolean;\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get onlyMouseEnabled():boolean\r\n\t{\r\n\t\treturn this._onlyMouseEnabled;\r\n\t}\r\n\r\n\tpublic set onlyMouseEnabled(value:boolean)\r\n\t{\r\n\t\tthis._onlyMouseEnabled = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>ShaderPicker</code> object.\r\n\t *\r\n\t * @param shaderPickingDetails Determines whether the picker includes a second pass to calculate extra\r\n\t * properties such as uv and normal coordinates.\r\n\t */\r\n\tconstructor(shaderPickingDetails:boolean = false)\r\n\t{\r\n\t\tthis._shaderPickingDetails = shaderPickingDetails;\r\n\r\n\t\tthis._id = new Float32Array(4);\r\n\t\tthis._viewportData = new Float32Array(4); // first 2 contain scale, last 2 translation\r\n\t\tthis._boundOffsetScale = new Float32Array(8); // first 2 contain scale, last 2 translation\r\n\t\tthis._boundOffsetScale[3] = 0;\r\n\t\tthis._boundOffsetScale[7] = 1;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getViewCollision(x:number, y:number, view:View):PickingCollisionVO\r\n\t{\r\n\t\tvar collector:EntityCollector = <EntityCollector> view.iEntityCollector;\r\n\r\n\t\tthis._stage = (<DefaultRenderer> view.renderer).stage;\r\n\r\n\t\tif (!this._stage)\r\n\t\t\treturn null;\r\n\r\n\t\tthis._context = <IContextGL> this._stage.context;\r\n\r\n\t\tthis._viewportData[0] = view.width;\r\n\t\tthis._viewportData[1] = view.height;\r\n\t\tthis._viewportData[2] = -(this._projX = 2*x/view.width - 1);\r\n\t\tthis._viewportData[3] = this._projY = 2*y/view.height - 1;\r\n\r\n\t\t// _potentialFound will be set to true if any object is actually rendered\r\n\t\tthis._potentialFound = false;\r\n\r\n\t\t//reset head values\r\n\t\tthis._blendedRenderableHead = null;\r\n\t\tthis._opaqueRenderableHead = null;\r\n\r\n\t\tthis.pDraw(collector, null);\r\n\r\n\t\t// clear buffers\r\n\t\tthis._context.setVertexBufferAt(0, null);\r\n\r\n\t\tif (!this._context || !this._potentialFound)\r\n\t\t\treturn null;\r\n\r\n\t\tif (!this._bitmapImage2D)\r\n\t\t\tthis._bitmapImage2D = new BitmapImage2D(1, 1, false, 0);\r\n\r\n\t\tthis._context.drawToBitmapImage2D(this._bitmapImage2D);\r\n\t\tthis._hitColor = this._bitmapImage2D.getPixel(0, 0);\r\n\r\n\t\tif (!this._hitColor) {\r\n\t\t\tthis._context.present();\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tthis._hitRenderable = this._interactives[this._hitColor - 1];\r\n\t\tthis._hitEntity = this._hitRenderable.sourceEntity;\r\n\r\n\t\tif (this._onlyMouseEnabled && !this._hitEntity._iIsMouseEnabled())\r\n\t\t\treturn null;\r\n\r\n\t\tvar _collisionVO:PickingCollisionVO = this._hitEntity._iPickingCollisionVO;\r\n\t\tif (this._shaderPickingDetails) {\r\n\t\t\tthis.getHitDetails(view.camera);\r\n\t\t\t_collisionVO.localPosition = this._localHitPosition;\r\n\t\t\t_collisionVO.localNormal = this._localHitNormal;\r\n\t\t\t_collisionVO.uv = this._hitUV;\r\n\t\t\t_collisionVO.index = this._faceIndex;\r\n\t\t\t//_collisionVO.subGeometryIndex = this._subGeometryIndex;\r\n\r\n\t\t} else {\r\n\t\t\t_collisionVO.localPosition = null;\r\n\t\t\t_collisionVO.localNormal = null;\r\n\t\t\t_collisionVO.uv = null;\r\n\t\t\t_collisionVO.index = 0;\r\n\t\t\t//_collisionVO.subGeometryIndex = 0;\r\n\t\t}\r\n\r\n\t\treturn _collisionVO;\r\n\t}\r\n\r\n\t//*/\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getSceneCollision(position:Vector3D, direction:Vector3D, scene:Scene):PickingCollisionVO\r\n\t{\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic pDraw(entityCollector:EntityCollector, target:ITextureBase)\r\n\t{\r\n\r\n\t\tvar camera:Camera = entityCollector.camera;\r\n\r\n\t\tthis._context.clear(0, 0, 0, 1);\r\n\t\tthis._stage.scissorRect = ShaderPicker.MOUSE_SCISSOR_RECT;\r\n\r\n\t\tthis._interactives.length = this._interactiveId = 0;\r\n\r\n\t\tif (!this._objectProgram)\r\n\t\t\tthis.initObjectProgram();\r\n\r\n\t\tthis._context.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\t\tthis._context.setDepthTest(true, ContextGLCompareMode.LESS);\r\n\t\tthis._context.setProgram(this._objectProgram);\r\n\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 4, this._viewportData, 1);\r\n\t\t//this.drawRenderables(entityCollector.opaqueRenderableHead, camera);\r\n\t\t//this.drawRenderables(entityCollector.blendedRenderableHead, camera);\r\n\t\t//TODO: reimplement ShaderPicker inheriting from RendererBase\r\n\t}\r\n\r\n\t/**\r\n\t * Draw a list of renderables.\r\n\t * @param renderables The renderables to draw.\r\n\t * @param camera The camera for which to render.\r\n\t */\r\n\tprivate drawRenderables(renderable:RenderableBase, camera:Camera)\r\n\t{\r\n\t\tvar matrix:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\t\tvar viewProjection:Matrix3D = camera.viewProjection;\r\n\r\n\t\twhile (renderable) {\r\n\t\t\t// it's possible that the renderable was already removed from the scene\r\n\t\t\tif (!renderable.sourceEntity.scene || !renderable.sourceEntity._iIsMouseEnabled()) {\r\n\t\t\t\trenderable = renderable.next;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tthis._potentialFound = true;\r\n\r\n\t\t\tthis._context.setCulling((<MaterialBase> renderable.renderOwner).bothSides? ContextGLTriangleFace.NONE : ContextGLTriangleFace.BACK, camera.projection.coordinateSystem);\r\n\r\n\t\t\tthis._interactives[this._interactiveId++] = renderable;\r\n\t\t\t// color code so that reading from bitmapdata will contain the correct value\r\n\t\t\tthis._id[1] = (this._interactiveId >> 8)/255; // on green channel\r\n\t\t\tthis._id[2] = (this._interactiveId & 0xff)/255; // on blue channel\r\n\r\n\t\t\tmatrix.copyFrom(renderable.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix.append(viewProjection);\r\n\t\t\tthis._context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, matrix, true);\r\n\t\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._id, 1);\r\n\r\n\t\t\tvar subGeometryVO:SubGeometryVOBase = this._hitRenderable.subGeometryVO;\r\n\r\n\t\t\tsubGeometryVO.activateVertexBufferVO(0, (<TriangleSubGeometry> subGeometryVO.subGeometry).positions, this._stage);\r\n\t\t\tsubGeometryVO.getIndexBufferVO(this._stage).draw(ContextGLDrawMode.TRIANGLES, 0, subGeometryVO.numIndices);\r\n\r\n\t\t\trenderable = renderable.next;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate updateRay(camera:Camera)\r\n\t{\r\n\t\tthis._rayPos = camera.scenePosition;\r\n\r\n\t\tthis._rayDir = camera.getRay(this._projX, this._projY, 1);\r\n\t\tthis._rayDir.normalize();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the Program that color-codes objects.\r\n\t */\r\n\tprivate initObjectProgram()\r\n\t{\r\n\t\tvar vertexCode:string;\r\n\t\tvar fragmentCode:string;\r\n\r\n\t\tthis._objectProgram = this._context.createProgram();\r\n\r\n\t\tvertexCode = \"m44 vt0, va0, vc0\t\t\t\\n\" + \"mul vt1.xy, vt0.w, vc4.zw\t\\n\" + \"add vt0.xy, vt0.xy, vt1.xy\t\\n\" + \"mul vt0.xy, vt0.xy, vc4.xy\t\\n\" + \"mov op, vt0\t\\n\";\r\n\t\tfragmentCode = \"mov oc, fc0\"; // write identifier\r\n\r\n\t\tDebug.throwPIR('ShaderPicker', 'initTriangleProgram', 'Dependency: initObjectProgram')\r\n\t\t//_objectProgram.upload(new AGALMiniAssembler().assemble(ContextGLProgramType.VERTEX, vertexCode),new AGALMiniAssembler().assemble(ContextGLProgramType.FRAGMENT, fragmentCode));\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the Program that renders positions.\r\n\t */\r\n\r\n\tprivate initTriangleProgram()\r\n\t{\r\n\t\tvar vertexCode:string;\r\n\t\tvar fragmentCode:string;\r\n\r\n\t\tthis._triangleProgram = this._context.createProgram();\r\n\r\n\t\t// todo: add animation code\r\n\t\tvertexCode = \"add vt0, va0, vc5 \t\t\t\\n\" + \"mul vt0, vt0, vc6 \t\t\t\\n\" + \"mov v0, vt0\t\t\t\t\\n\" + \"m44 vt0, va0, vc0\t\t\t\\n\" + \"mul vt1.xy, vt0.w, vc4.zw\t\\n\" + \"add vt0.xy, vt0.xy, vt1.xy\t\\n\" + \"mul vt0.xy, vt0.xy, vc4.xy\t\\n\" + \"mov op, vt0\t\\n\";\r\n\t\tfragmentCode = \"mov oc, v0\"; // write identifier\r\n\r\n\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + vertexCode + \"endpart\"))['vertex'].data;\r\n\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + fragmentCode + \"endpart\"))['fragment'].data;\r\n\t\tthis._triangleProgram.upload(vertexByteCode, fragmentByteCode);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets more detailed information about the hir position, if required.\r\n\t * @param camera The camera used to view the hit object.\r\n\t */\r\n\tprivate getHitDetails(camera:Camera)\r\n\t{\r\n\t\tthis.getApproximatePosition(camera);\r\n\t\tthis.getPreciseDetails(camera);\r\n\t}\r\n\r\n\t/**\r\n\t * Finds a first-guess approximate position about the hit position.\r\n\t *\r\n\t * @param camera The camera used to view the hit object.\r\n\t */\r\n\tprivate getApproximatePosition(camera:Camera)\r\n\t{\r\n\t\tvar bounds:Box = this._hitRenderable.sourceEntity.getBox();\r\n\t\tvar col:number;\r\n\t\tvar scX:number, scY:number, scZ:number;\r\n\t\tvar offsX:number, offsY:number, offsZ:number;\r\n\t\tvar localViewProjection:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\tlocalViewProjection.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(camera));\r\n\t\tlocalViewProjection.append(camera.viewProjection);\r\n\t\tif (!this._triangleProgram) {\r\n\t\t\tthis.initTriangleProgram();\r\n\t\t}\r\n\r\n\t\tthis._boundOffsetScale[4] = 1/(scX = bounds.width);\r\n\t\tthis._boundOffsetScale[5] = 1/(scY = bounds.height);\r\n\t\tthis._boundOffsetScale[6] = 1/(scZ = bounds.depth);\r\n\t\tthis._boundOffsetScale[0] = offsX = -bounds.x;\r\n\t\tthis._boundOffsetScale[1] = offsY = -bounds.y;\r\n\t\tthis._boundOffsetScale[2] = offsZ = -bounds.z;\r\n\r\n\t\tthis._context.setProgram(this._triangleProgram);\r\n\t\tthis._context.clear(0, 0, 0, 0, 1, 0, ContextGLClearMask.DEPTH);\r\n\t\tthis._context.setScissorRectangle(ShaderPicker.MOUSE_SCISSOR_RECT);\r\n\t\tthis._context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, localViewProjection, true);\r\n\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, this._boundOffsetScale, 2);\r\n\r\n\t\tvar subGeometryVO:SubGeometryVOBase = this._hitRenderable.subGeometryVO;\r\n\r\n\t\tsubGeometryVO.activateVertexBufferVO(0, (<TriangleSubGeometry> subGeometryVO.subGeometry).positions, this._stage);\r\n\t\tsubGeometryVO.getIndexBufferVO(this._stage).draw(ContextGLDrawMode.TRIANGLES, 0, subGeometryVO.numIndices);\r\n\r\n\t\tthis._context.drawToBitmapImage2D(this._bitmapImage2D);\r\n\r\n\t\tcol = this._bitmapImage2D.getPixel(0, 0);\r\n\r\n\t\tthis._localHitPosition.x = ((col >> 16) & 0xff)*scX/255 - offsX;\r\n\t\tthis._localHitPosition.y = ((col >> 8) & 0xff)*scY/255 - offsY;\r\n\t\tthis._localHitPosition.z = (col & 0xff)*scZ/255 - offsZ;\r\n\t}\r\n\r\n\t/**\r\n\t * Use the approximate position info to find the face under the mouse position from which we can derive the precise\r\n\t * ray-face intersection point, then use barycentric coordinates to figure out the uv coordinates, etc.\r\n\t * @param camera The camera used to view the hit object.\r\n\t */\r\n\tprivate getPreciseDetails(camera:Camera)\r\n\t{\r\n\t\tvar len:number = indices.length;\r\n\t\tvar x1:number, y1:number, z1:number;\r\n\t\tvar x2:number, y2:number, z2:number;\r\n\t\tvar x3:number, y3:number, z3:number;\r\n\t\tvar i:number = 0, j:number = 1, k:number = 2;\r\n\t\tvar t1:number, t2:number, t3:number;\r\n\t\tvar v0x:number, v0y:number, v0z:number;\r\n\t\tvar v1x:number, v1y:number, v1z:number;\r\n\t\tvar v2x:number, v2y:number, v2z:number;\r\n\t\tvar ni1:number, ni2:number, ni3:number;\r\n\t\tvar n1:number, n2:number, n3:number, nLength:number;\r\n\t\tvar dot00:number, dot01:number, dot02:number, dot11:number, dot12:number;\r\n\t\tvar s:number, t:number, invDenom:number;\r\n\t\tvar x:number = this._localHitPosition.x, y:number = this._localHitPosition.y, z:number = this._localHitPosition.z;\r\n\t\tvar u:number, v:number;\r\n\t\tvar ui1:number, ui2:number, ui3:number;\r\n\t\tvar s0x:number, s0y:number, s0z:number;\r\n\t\tvar s1x:number, s1y:number, s1z:number;\r\n\t\tvar nl:number;\r\n\t\tvar subGeom:TriangleSubGeometry = <TriangleSubGeometry> this._hitRenderable._pGetSubGeometry();\r\n\t\tvar indices:Uint16Array = subGeom.indices.get(subGeom.numElements);\r\n\r\n\t\tvar positions:Float32Array = subGeom.positions.get(subGeom.numVertices);\r\n\t\tvar posDim:number = subGeom.positions.dimensions;\r\n\r\n\t\tvar uvs:Float32Array = subGeom.uvs.get(subGeom.numVertices);\r\n\t\tvar uvDim:number = subGeom.uvs.dimensions;\r\n\r\n\t\tvar normals:Float32Array = subGeom.normals.get(subGeom.numVertices);\r\n\t\tvar normalDim:number = subGeom.normals.dimensions;\r\n\r\n\t\tthis.updateRay(camera);\r\n\r\n\t\twhile (i < len) {\r\n\t\t\tt1 = indices[i]*posDim;\r\n\t\t\tt2 = indices[j]*posDim;\r\n\t\t\tt3 = indices[k]*posDim;\r\n\t\t\tx1 = positions[t1];\r\n\t\t\ty1 = positions[t1 + 1];\r\n\t\t\tz1 = positions[t1 + 2];\r\n\t\t\tx2 = positions[t2];\r\n\t\t\ty2 = positions[t2 + 1];\r\n\t\t\tz2 = positions[t2 + 2];\r\n\t\t\tx3 = positions[t3];\r\n\t\t\ty3 = positions[t3 + 1];\r\n\t\t\tz3 = positions[t3 + 2];\r\n\r\n\t\t\t// if within bounds\r\n\t\t\tif (!(    (x < x1 && x < x2 && x < x3) || (y < y1 && y < y2 && y < y3) || (z < z1 && z < z2 && z < z3) || (x > x1 && x > x2 && x > x3) || (y > y1 && y > y2 && y > y3) || (z > z1 && z > z2 && z > z3))) {\r\n\r\n\t\t\t\t// calculate barycentric coords for approximated position\r\n\t\t\t\tv0x = x3 - x1;\r\n\t\t\t\tv0y = y3 - y1;\r\n\t\t\t\tv0z = z3 - z1;\r\n\t\t\t\tv1x = x2 - x1;\r\n\t\t\t\tv1y = y2 - y1;\r\n\t\t\t\tv1z = z2 - z1;\r\n\t\t\t\tv2x = x - x1;\r\n\t\t\t\tv2y = y - y1;\r\n\t\t\t\tv2z = z - z1;\r\n\t\t\t\tdot00 = v0x*v0x + v0y*v0y + v0z*v0z;\r\n\t\t\t\tdot01 = v0x*v1x + v0y*v1y + v0z*v1z;\r\n\t\t\t\tdot02 = v0x*v2x + v0y*v2y + v0z*v2z;\r\n\t\t\t\tdot11 = v1x*v1x + v1y*v1y + v1z*v1z;\r\n\t\t\t\tdot12 = v1x*v2x + v1y*v2y + v1z*v2z;\r\n\t\t\t\tinvDenom = 1/(dot00*dot11 - dot01*dot01);\r\n\t\t\t\ts = (dot11*dot02 - dot01*dot12)*invDenom;\r\n\t\t\t\tt = (dot00*dot12 - dot01*dot02)*invDenom;\r\n\r\n\t\t\t\t// if inside the current triangle, fetch details hit information\r\n\t\t\t\tif (s >= 0 && t >= 0 && (s + t) <= 1) {\r\n\r\n\t\t\t\t\tni1 = indices[i]*normalDim;\r\n\t\t\t\t\tni2 = indices[j]*normalDim;\r\n\t\t\t\t\tni3 = indices[k]*normalDim;\r\n\r\n\t\t\t\t\tn1 = indices[ni1] + indices[ni2] + indices[ni3];\r\n\t\t\t\t\tn2 = indices[ni1 + 1] + indices[ni2 + 1] + indices[ni3 + 1];\r\n\t\t\t\t\tn3 = indices[ni1 + 2] + indices[ni2 + 2] + indices[ni3 + 2];\r\n\r\n\t\t\t\t\tnLength = Math.sqrt(n1*n1 + n2*n2 + n3*n3);\r\n\r\n\t\t\t\t\tn1 /= nLength;\r\n\t\t\t\t\tn2 /= nLength;\r\n\t\t\t\t\tn3 /= nLength;\r\n\r\n\t\t\t\t\t// this is def the triangle, now calculate precise coords\r\n\t\t\t\t\tthis.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform, n1, n2, n3, x1, y1, z1);\r\n\r\n\t\t\t\t\tv2x = this._localHitPosition.x - x1;\r\n\t\t\t\t\tv2y = this._localHitPosition.y - y1;\r\n\t\t\t\t\tv2z = this._localHitPosition.z - z1;\r\n\r\n\t\t\t\t\ts0x = x2 - x1; // s0 = p1 - p0\r\n\t\t\t\t\ts0y = y2 - y1;\r\n\t\t\t\t\ts0z = z2 - z1;\r\n\t\t\t\t\ts1x = x3 - x1; // s1 = p2 - p0\r\n\t\t\t\t\ts1y = y3 - y1;\r\n\t\t\t\t\ts1z = z3 - z1;\r\n\t\t\t\t\tthis._localHitNormal.x = s0y*s1z - s0z*s1y; // n = s0 x s1\r\n\t\t\t\t\tthis._localHitNormal.y = s0z*s1x - s0x*s1z;\r\n\t\t\t\t\tthis._localHitNormal.z = s0x*s1y - s0y*s1x;\r\n\t\t\t\t\tnl = 1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x + this._localHitNormal.y*this._localHitNormal.y + this._localHitNormal.z*this._localHitNormal.z); // normalize n\r\n\t\t\t\t\tthis._localHitNormal.x *= nl;\r\n\t\t\t\t\tthis._localHitNormal.y *= nl;\r\n\t\t\t\t\tthis._localHitNormal.z *= nl;\r\n\r\n\t\t\t\t\tdot02 = v0x*v2x + v0y*v2y + v0z*v2z;\r\n\t\t\t\t\tdot12 = v1x*v2x + v1y*v2y + v1z*v2z;\r\n\t\t\t\t\ts = (dot11*dot02 - dot01*dot12)*invDenom;\r\n\t\t\t\t\tt = (dot00*dot12 - dot01*dot02)*invDenom;\r\n\r\n\t\t\t\t\tui1 = indices[i]*uvDim\r\n\t\t\t\t\tui2 = indices[j]*uvDim\r\n\t\t\t\t\tui3 = indices[k]*uvDim\r\n\r\n\t\t\t\t\tu = uvs[ui1];\r\n\t\t\t\t\tv = uvs[ui1 + 1];\r\n\t\t\t\t\tthis._hitUV.x = u + t*(uvs[ui2] - u) + s*(uvs[ui3] - u);\r\n\t\t\t\t\tthis._hitUV.y = v + t*(uvs[ui2 + 1] - v) + s*(uvs[ui3 + 1] - v);\r\n\r\n\t\t\t\t\tthis._faceIndex = i;\r\n\t\t\t\t\t//TODO add back subGeometryIndex value\r\n\t\t\t\t\t//this._subGeometryIndex = away.utils.GeometryUtils.getMeshSubGeometryIndex(subGeom);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ti += 3;\r\n\t\t\tj += 3;\r\n\t\t\tk += 3;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the precise hit position by unprojecting the screen coordinate back unto the hit face's plane and\r\n\t * calculating the intersection point.\r\n\t * @param camera The camera used to render the object.\r\n\t * @param invSceneTransform The inverse scene transformation of the hit object.\r\n\t * @param nx The x-coordinate of the face's plane normal.\r\n\t * @param ny The y-coordinate of the face plane normal.\r\n\t * @param nz The z-coordinate of the face plane normal.\r\n\t * @param px The x-coordinate of a point on the face's plane (ie a face vertex)\r\n\t * @param py The y-coordinate of a point on the face's plane (ie a face vertex)\r\n\t * @param pz The z-coordinate of a point on the face's plane (ie a face vertex)\r\n\t */\r\n\r\n\tprivate getPrecisePosition(invSceneTransform:Matrix3D, nx:number, ny:number, nz:number, px:number, py:number, pz:number)\r\n\t{\r\n\t\t// calculate screen ray and find exact intersection position with triangle\r\n\t\tvar rx:number, ry:number, rz:number;\r\n\t\tvar ox:number, oy:number, oz:number;\r\n\t\tvar t:number;\r\n\t\tvar raw:Float32Array = Matrix3DUtils.RAW_DATA_CONTAINER;\r\n\t\tvar cx:number = this._rayPos.x, cy:number = this._rayPos.y, cz:number = this._rayPos.z;\r\n\r\n\t\t// unprojected projection point, gives ray dir in cam space\r\n\t\tox = this._rayDir.x;\r\n\t\toy = this._rayDir.y;\r\n\t\toz = this._rayDir.z;\r\n\r\n\t\t// transform ray dir and origin (cam pos) to object space\r\n\t\t//invSceneTransform.copyRawDataTo( raw  );\r\n\t\tinvSceneTransform.copyRawDataTo(raw);\r\n\t\trx = raw[0]*ox + raw[4]*oy + raw[8]*oz;\r\n\t\try = raw[1]*ox + raw[5]*oy + raw[9]*oz;\r\n\t\trz = raw[2]*ox + raw[6]*oy + raw[10]*oz;\r\n\r\n\t\tox = raw[0]*cx + raw[4]*cy + raw[8]*cz + raw[12];\r\n\t\toy = raw[1]*cx + raw[5]*cy + raw[9]*cz + raw[13];\r\n\t\toz = raw[2]*cx + raw[6]*cy + raw[10]*cz + raw[14];\r\n\r\n\t\tt = ((px - ox)*nx + (py - oy)*ny + (pz - oz)*nz)/(rx*nx + ry*ny + rz*nz);\r\n\r\n\t\tthis._localHitPosition.x = ox + rx*t;\r\n\t\tthis._localHitPosition.y = oy + ry*t;\r\n\t\tthis._localHitPosition.z = oz + rz*t;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._bitmapImage2D.dispose();\r\n\t\tif (this._triangleProgram)\r\n\t\t\tthis._triangleProgram.dispose();\r\n\r\n\t\tif (this._objectProgram)\r\n\t\t\tthis._objectProgram.dispose();\r\n\r\n\t\tthis._triangleProgram = null;\r\n\t\tthis._objectProgram = null;\r\n\t\tthis._bitmapImage2D = null;\r\n\t\tthis._hitRenderable = null;\r\n\t\tthis._hitEntity = null;\r\n\t}\r\n}\r\n\r\nexport = ShaderPicker;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\n\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport BasicMaterialPass\t\t\t= require(\"awayjs-renderergl/lib/render/passes/BasicMaterialPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\nimport RenderPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPool\");\r\n\r\n/**\r\n * RenderMaterialObject forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass BasicMaterialRender extends RenderBase\r\n{\r\n\tprivate _material:BasicMaterial;\r\n\tprivate _pass:BasicMaterialPass;\r\n\r\n\r\n\tconstructor(pool:RenderPool, material:BasicMaterial, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, material, renderableClass, stage);\r\n\r\n\t\tthis._material = material;\r\n\r\n\t\tthis._pAddPass(this._pass = new BasicMaterialPass(this, material, renderableClass, this._stage));\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._material = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateRender()\r\n\t{\r\n\t\tsuper._pUpdateRender();\r\n\r\n\t\tthis._pRequiresBlending = (this._material.blendMode != BlendMode.NORMAL || this._material.alphaBlending || (this._material.colorTransform && this._material.colorTransform.alphaMultiplier < 1));\r\n\t\tthis._pass.preserveAlpha = this._material.preserveAlpha;//this._pRequiresBlending;\r\n\t\tthis._pass.shader.setBlendMode((this._renderOwner.blendMode == BlendMode.NORMAL && this._pRequiresBlending)? BlendMode.LAYER : this._material.blendMode);\r\n\t\t//this._pass.forceSeparateMVP = false;\r\n\t}\r\n}\r\n\r\nexport = BasicMaterialRender;",
    "import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPassBase\");\r\nimport RenderPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPool\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n/**\r\n * DepthRender forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass DepthRender extends RenderPassBase\r\n{\r\n\tprivate _fragmentConstantsIndex:number;\r\n\r\n\t/**\r\n\t *\r\n\t * @param pool\r\n\t * @param renderOwner\r\n\t * @param renderableClass\r\n\t * @param stage\r\n\t */\r\n\tconstructor(pool:RenderPool, renderOwner:IRenderOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, renderOwner, renderableClass, stage);\r\n\r\n\t\tthis._shader = new ShaderBase(renderableClass, this, this._stage);\r\n\r\n\t\tthis._pAddPass(this);\r\n\t}\r\n\r\n\r\n\tpublic _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tsuper._iIncludeDependencies(shader);\r\n\r\n\t\tshader.projectionDependencies++;\r\n\r\n\t\tif (shader.alphaThreshold > 0)\r\n\t\t\tshader.uvDependencies++;\r\n\t}\r\n\r\n\r\n\tpublic _iInitConstantData(shader:ShaderBase)\r\n\t{\r\n\t\tsuper._iInitConstantData(shader);\r\n\r\n\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\tvar data:Float32Array = shader.fragmentConstantData;\r\n\t\tdata[index] = 1.0;\r\n\t\tdata[index + 1] = 255.0;\r\n\t\tdata[index + 2] = 65025.0;\r\n\t\tdata[index + 3] = 16581375.0;\r\n\t\tdata[index + 4] = 1.0/255.0;\r\n\t\tdata[index + 5] = 1.0/255.0;\r\n\t\tdata[index + 6] = 1.0/255.0;\r\n\t\tdata[index + 7] = 0.0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar targetReg:ShaderRegisterElement = sharedRegisters.shadedTarget;\r\n\t\tvar dataReg1:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\r\n\t\tthis._fragmentConstantsIndex = dataReg1.index*4;\r\n\r\n\t\tvar temp1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp1, 1);\r\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp2, 1);\r\n\r\n\t\tcode += \"div \" + temp1 + \", \" + sharedRegisters.projectionFragment + \", \" + sharedRegisters.projectionFragment + \".w\\n\" + //\"sub ft2.z, fc0.x, ft2.z\\n\" +    //invert\r\n\t\t\t\"mul \" + temp1 + \", \" + dataReg1 + \", \" + temp1 + \".z\\n\" +\r\n\t\t\t\"frc \" + temp1 + \", \" + temp1 + \"\\n\" +\r\n\t\t\t\"mul \" + temp2 + \", \" + temp1 + \".yzww, \" + dataReg2 + \"\\n\";\r\n\r\n\t\t//codeF += \"mov ft1.w, fc1.w\t\\n\" +\r\n\t\t//    \"mov ft0.w, fc0.x\t\\n\";\r\n\r\n\t\tif (shader.texture && shader.alphaThreshold > 0) {\r\n\r\n\t\t\tshader.texture._iInitRegisters(shader, registerCache);\r\n\r\n\t\t\tvar albedo:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\t\tcode += shader.texture._iGetFragmentCode(shader, albedo, registerCache, sharedRegisters.uvVarying);\r\n\r\n\t\t\tvar cutOffReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\r\n\t\t\tcode += \"sub \" + albedo + \".w, \" + albedo + \".w, \" + cutOffReg + \".x\\n\" +\r\n\t\t\t\t\"kil \" + albedo + \".w\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"sub \" + targetReg + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\r\n\t\tregisterCache.removeFragmentTempUsage(temp1);\r\n\t\tregisterCache.removeFragmentTempUsage(temp2);\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tif (this._shader.texture && this._shader.alphaThreshold > 0) {\r\n\t\t\tthis._shader.texture.activate(this._shader);\r\n\r\n\t\t\tthis._shader.fragmentConstantData[this._fragmentConstantsIndex + 8] = this._shader.alphaThreshold;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = DepthRender;",
    "﻿import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPool\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPassBase\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n/**\r\n * DistanceRender is a pass that writes distance values to a depth map as a 32-bit value exploded over the 4 texture channels.\r\n * This is used to render omnidirectional shadow maps.\r\n */\r\nclass DistanceRender extends RenderPassBase\r\n{\r\n\tprivate _fragmentConstantsIndex:number;\r\n\r\n\t/**\r\n\t * Creates a new DistanceRender object.\r\n\t *\r\n\t * @param material The material to which this pass belongs.\r\n\t */\r\n\tconstructor(pool:RenderPool, renderOwner:IRenderOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, renderOwner, renderableClass, stage);\r\n\r\n\t\tthis._shader = new ShaderBase(renderableClass, this, this._stage);\r\n\r\n\t\tthis._pAddPass(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the unchanging constant data for this material.\r\n\t */\r\n\tpublic _iInitConstantData(shader:ShaderBase)\r\n\t{\r\n\t\tsuper._iInitConstantData(shader);\r\n\r\n\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\tvar data:Float32Array = shader.fragmentConstantData;\r\n\t\tdata[index + 4] = 1.0/255.0;\r\n\t\tdata[index + 5] = 1.0/255.0;\r\n\t\tdata[index + 6] = 1.0/255.0;\r\n\t\tdata[index + 7] = 0.0;\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tsuper._iIncludeDependencies(shader);\r\n\r\n\t\tshader.projectionDependencies++;\r\n\t\tshader.viewDirDependencies++;\r\n\r\n\t\tif (shader.alphaThreshold > 0)\r\n\t\t\tshader.uvDependencies++;\r\n\r\n\t\tif (shader.viewDirDependencies > 0)\r\n\t\t\tshader.globalPosDependencies++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string;\r\n\t\tvar targetReg:ShaderRegisterElement = sharedRegisters.shadedTarget;\r\n\t\tvar dataReg1:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\r\n\t\tthis._fragmentConstantsIndex = dataReg1.index*4;\r\n\r\n\t\tvar temp1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp1, 1);\r\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp2, 1);\r\n\r\n\t\t// squared distance to view\r\n\t\tcode = \"dp3 \" + temp1 + \".z, \" + sharedRegisters.viewDirVarying + \".xyz, \" + sharedRegisters.viewDirVarying + \".xyz\\n\" +\r\n\t\t\t\"mul \" + temp1 + \", \" + dataReg1 + \", \" + temp1 + \".z\\n\" +\r\n\t\t\t\"frc \" + temp1 + \", \" + temp1 + \"\\n\" +\r\n\t\t\t\"mul \" + temp2 + \", \" + temp1 + \".yzww, \" + dataReg2 + \"\\n\";\r\n\r\n\t\tif (shader.alphaThreshold > 0) {\r\n\t\t\tshader.texture._iInitRegisters(shader, registerCache);\r\n\r\n\t\t\tvar albedo:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\t\tcode += shader.texture._iGetFragmentCode(shader, albedo, registerCache, sharedRegisters.uvVarying);\r\n\r\n\t\t\tvar cutOffReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\r\n\t\t\tcode += \"sub \" + albedo + \".w, \" + albedo + \".w, \" + cutOffReg + \".x\\n\" +\r\n\t\t\t\t\"kil \" + albedo + \".w\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"sub \" + targetReg + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tvar f:number = camera.projection.far;\r\n\r\n\t\tf = 1/(2*f*f);\r\n\t\t// sqrt(f*f+f*f) is largest possible distance for any frustum, so we need to divide by it. Rarely a tight fit, but with 32 bits precision, it's enough.\r\n\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\tvar data:Float32Array = this._shader.fragmentConstantData;\r\n\t\tdata[index] = 1.0*f;\r\n\t\tdata[index + 1] = 255.0*f;\r\n\t\tdata[index + 2] = 65025.0*f;\r\n\t\tdata[index + 3] = 16581375.0*f;\r\n\r\n\t\tif (this._shader.alphaThreshold > 0) {\r\n\t\t\tthis._shader.texture.activate(this._shader);\r\n\r\n\t\t\tdata[index + 8] = this._shader.alphaThreshold;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = DistanceRender;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\n\r\nimport IRender\t\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRender\");\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport RenderPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPool\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n *\r\n * @class away.pool.Passes\r\n */\r\nclass RenderBase extends EventDispatcher implements IRender\r\n{\r\n\tpublic usages:number = 0;\r\n\tpublic _forceSeparateMVP:boolean = false;\r\n\r\n\tprivate _pool:RenderPool;\r\n\tpublic _renderOwner:IRenderOwner;\r\n\tpublic _renderableClass:IRenderableClass;\r\n\tpublic _stage:Stage;\r\n\r\n\tprivate _renderOrderId:number;\r\n\tprivate _invalidAnimation:boolean = true;\r\n\tprivate _invalidRender:boolean = true;\r\n\tprivate _passes:Array<IPass> = new Array<IPass>();\r\n\r\n\r\n\r\n\tpublic _pRequiresBlending:boolean = false;\r\n\r\n\tprivate _onPassChangeDelegate:(event:Event) => void;\r\n\r\n\tpublic renderId:number;\r\n\r\n\t/**\r\n\t * Indicates whether or not the renderable requires alpha blending during rendering.\r\n\t */\r\n\tpublic get requiresBlending():boolean\r\n\t{\r\n\t\treturn this._pRequiresBlending;\r\n\t}\r\n\r\n\tpublic get renderOrderId():number\r\n\t{\r\n\t\tif (this._invalidAnimation)\r\n\t\t\tthis._updateAnimation();\r\n\r\n\t\treturn this._renderOrderId;\r\n\t}\r\n\r\n\tpublic get passes():Array<IPass>\r\n\t{\r\n\t\tif (this._invalidAnimation)\r\n\t\t\tthis._updateAnimation();\r\n\r\n\t\treturn this._passes;\r\n\t}\r\n\r\n\tconstructor(pool:RenderPool, renderOwner:IRenderOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pool = pool;\r\n\t\tthis.renderId = renderOwner.id;\r\n\t\tthis._renderOwner = renderOwner;\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._stage = stage;\r\n\r\n\r\n\t\tthis._onPassChangeDelegate = (event:Event) => this.onPassChange(event);\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tthis._renderableClass._iIncludeDependencies(shader);\r\n\r\n\t\tshader.alphaThreshold = this._renderOwner.alphaThreshold;\r\n\t\tshader.useMipmapping = this._renderOwner.mipmap;\r\n\t\tshader.useSmoothTextures = this._renderOwner.smooth;\r\n\r\n\t\tif (this._renderOwner instanceof MaterialBase) {\r\n\t\t\tvar material:MaterialBase = <MaterialBase> this._renderOwner;\r\n\t\t\tshader.useAlphaPremultiplied = material.alphaPremultiplied;\r\n\t\t\tshader.useBothSides = material.bothSides;\r\n\t\t\tshader.repeatTextures = material.repeat;\r\n\t\t\tshader.usesUVTransform = material.animateUVs;\r\n\t\t\tshader.usesColorTransform = material.useColorTransform;\r\n\t\t\tif (material.texture)\r\n\t\t\t\tshader.texture = shader.getTextureVO(material.texture);\r\n\t\t\tshader.color = material.color;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pool.disposeItem(this._renderOwner);\r\n\t\tthis._pool = null;\r\n\t\tthis._renderOwner = null;\r\n\t\tthis._renderableClass = null;\r\n\t\tthis._stage = null;\r\n\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; i++) {\r\n\t\t\tthis._passes[i].removeEventListener(Event.CHANGE, this._onPassChangeDelegate);\r\n\t\t\tthis._passes[i].dispose();\r\n\t\t}\r\n\r\n\t\tthis._passes = null;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidateRender()\r\n\t{\r\n\t\tthis._invalidRender = true;\r\n\t\tthis._invalidAnimation = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidatePasses()\r\n\t{\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; i++)\r\n\t\t\tthis._passes[i].invalidatePass();\r\n\r\n\t\tthis._invalidAnimation = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidateAnimation()\r\n\t{\r\n\t\tthis._invalidAnimation = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param renderOwner\r\n\t */\r\n\tprivate _updateAnimation()\r\n\t{\r\n\t\tif (this._invalidRender)\r\n\t\t\tthis._pUpdateRender();\r\n\r\n\t\tthis._invalidAnimation = false;\r\n\r\n\t\tvar enabledGPUAnimation:boolean = this._getEnabledGPUAnimation();\r\n\r\n\t\tvar renderOrderId = 0;\r\n\t\tvar mult:number = 1;\r\n\t\tvar shader:ShaderBase;\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; i++) {\r\n\t\t\tshader = this._passes[i].shader;\r\n\r\n\t\t\tif (shader.usesAnimation != enabledGPUAnimation) {\r\n\t\t\t\tshader.usesAnimation = enabledGPUAnimation;\r\n\t\t\t\tshader.invalidateProgram();\r\n\t\t\t}\r\n\r\n\t\t\trenderOrderId += shader.programData.id*mult;\r\n\t\t\tmult *= 1000;\r\n\t\t}\r\n\r\n\t\tthis._renderOrderId = renderOrderId;\r\n\t}\r\n\r\n\t/**\r\n\t * Performs any processing that needs to occur before any of its passes are used.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _pUpdateRender()\r\n\t{\r\n\t\tthis._invalidRender = false;\r\n\r\n\t\t//overrride to update shader object properties\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a pass from the renderOwner.\r\n\t * @param pass The pass to be removed.\r\n\t */\r\n\tpublic _pRemovePass(pass:IPass)\r\n\t{\r\n\t\tpass.removeEventListener(Event.CHANGE, this._onPassChangeDelegate);\r\n\t\tthis._passes.splice(this._passes.indexOf(pass), 1);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all passes from the renderOwner\r\n\t */\r\n\tpublic _pClearPasses()\r\n\t{\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; ++i)\r\n\t\t\tthis._passes[i].removeEventListener(Event.CHANGE, this._onPassChangeDelegate);\r\n\r\n\t\tthis._passes.length = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a pass to the renderOwner\r\n\t * @param pass\r\n\t */\r\n\tpublic _pAddPass(pass:IPass)\r\n\t{\r\n\t\tthis._passes.push(pass);\r\n\t\tpass.addEventListener(Event.CHANGE, this._onPassChangeDelegate);\r\n\t}\r\n\r\n\t/**\r\n\t * Listener for when a pass's shader code changes. It recalculates the render order id.\r\n\t */\r\n\tprivate onPassChange(event:Event)\r\n\t{\r\n\t\tthis.invalidateAnimation();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * test if animation will be able to run on gpu BEFORE compiling materials\r\n\t * test if the shader objects supports animating the animation set in the vertex shader\r\n\t * if any object using this material fails to support accelerated animations for any of the shader objects,\r\n\t * we should do everything on cpu (otherwise we have the cost of both gpu + cpu animations)\r\n\t */\r\n\tprivate _getEnabledGPUAnimation():boolean\r\n\t{\r\n\t\tif (this._renderOwner.animationSet) {\r\n\t\t\tthis._renderOwner.animationSet.resetGPUCompatibility();\r\n\r\n\t\t\tvar owners:Array<IRenderableOwner> = this._renderOwner.iOwners;\r\n\t\t\tvar numOwners:number = owners.length;\r\n\r\n\t\t\tvar len:number = this._passes.length;\r\n\t\t\tfor (var i:number = 0; i < len; i++)\r\n\t\t\t\tfor (var j:number = 0; j < numOwners; j++)\r\n\t\t\t\t\tif (owners[j].animator)\r\n\t\t\t\t\t\t(<AnimatorBase> owners[j].animator).testGPUCompatibility(this._passes[i].shader);\r\n\r\n\t\t\treturn !this._renderOwner.animationSet.usesCPU;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport = RenderBase;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport AssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetBase\");\r\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\")\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/RendererBase\");\r\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport RenderPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPool\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\n\r\n/**\r\n * RenderPassBase provides an abstract base class for material shader passes. A material pass constitutes at least\r\n * a render call per required renderable.\r\n */\r\nclass RenderPassBase extends RenderBase implements IPass\r\n{\r\n\tpublic _shader:ShaderBase;\r\n\r\n\tpublic get shader():ShaderBase\r\n\t{\r\n\t\treturn this._shader;\r\n\t}\r\n\r\n\tpublic get animationSet():AnimationSetBase\r\n\t{\r\n\t\treturn <AnimationSetBase> this._renderOwner.animationSet;\r\n\t}\r\n\r\n\t/**\r\n\t * Cleans up any resources used by the current object.\r\n\t * @param deep Indicates whether other resources should be cleaned up, that could potentially be shared across different instances.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tif (this._shader) {\r\n\t\t\tthis._shader.dispose();\r\n\t\t\tthis._shader = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the current pass. Before calling pass, activatePass needs to be called with the same index.\r\n\t * @param pass The pass used to render the renderable.\r\n\t * @param renderable The IRenderable object to draw.\r\n\t * @param stage The Stage object used for rendering.\r\n\t * @param entityCollector The EntityCollector object that contains the visible scene data.\r\n\t * @param viewProjection The view-projection matrix used to project to the screen. This is not the same as\r\n\t * camera.viewProjection as it includes the scaling factors when rendering to textures.\r\n\t *\r\n\t * @internal\r\n\t */\r\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tthis._shader._iRender(renderable, camera, viewProjection);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the render state for the pass that is independent of the rendered object. This needs to be called before\r\n\t * calling pass. Before activating a pass, the previously used pass needs to be deactivated.\r\n\t * @param stage The Stage object which is currently used for rendering.\r\n\t * @param camera The camera from which the scene is viewed.\r\n\t * @private\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tthis._shader._iActivate(camera);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the render state for the pass. This needs to be called before activating another pass.\r\n\t * @param stage The Stage used for rendering\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iDeactivate()\r\n\t{\r\n\t\tthis._shader._iDeactivate();\r\n\t}\r\n\r\n\t/**\r\n\t * Marks the shader program as invalid, so it will be recompiled before the next render.\r\n\t *\r\n\t * @param updateMaterial Indicates whether the invalidation should be performed on the entire material. Should always pass \"true\" unless it's called from the material itself.\r\n\t */\r\n\tpublic invalidatePass()\r\n\t{\r\n\t\tthis._shader.invalidateShader();\r\n\r\n\t\tthis.dispatchEvent(new Event(Event.CHANGE));\r\n\t}\r\n\r\n\r\n\tpublic _iInitConstantData(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic _iGetPreLightingVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetPreLightingFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetNormalVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetNormalFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\nexport = RenderPassBase;",
    "import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\n\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport BasicMaterialRender\t\t\t= require(\"awayjs-renderergl/lib/render/BasicMaterialRender\");\r\nimport IRenderClass\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/IRenderClass\");\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\nimport SkyboxRender\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/SkyboxRender\");\r\n\r\n/**\r\n * @class away.pool.RenderPool\r\n */\r\nclass RenderPool\r\n{\r\n\tprivate static _classPool:Object = new Object();\r\n\t\r\n\tprivate _pool:Object = new Object();\r\n\tprivate _renderableClass:IRenderableClass;\r\n\tprivate _stage:Stage;\r\n\tprivate _renderClass:IRenderClass;\r\n\t\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderClass\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, stage:Stage, renderClass:IRenderClass = null)\r\n\t{\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._stage = stage;\r\n\t\tthis._renderClass = renderClass;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableOwner\r\n\t * @returns IRenderable\r\n\t */\r\n\tpublic getItem(renderOwner:IRenderOwner):RenderBase\r\n\t{\r\n\t\treturn (this._pool[renderOwner.id] || (this._pool[renderOwner.id] = renderOwner._iAddRender(new (this._renderClass || RenderPool.getClass(renderOwner))(this, renderOwner, this._renderableClass, this._stage))))\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableOwner\r\n\t */\r\n\tpublic disposeItem(renderOwner:IRenderOwner)\r\n\t{\r\n\t\trenderOwner._iRemoveRender(this._pool[renderOwner.id]);\r\n\r\n\t\tdelete this._pool[renderOwner.id];\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t * @param imageObjectClass\r\n\t */\r\n\tpublic static registerClass(renderClass:IRenderClass, assetClass:IAssetClass)\r\n\t{\r\n\t\tRenderPool._classPool[assetClass.assetType] = renderClass;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param subGeometry\r\n\t */\r\n\tpublic static getClass(renderOwner:IRenderOwner):IRenderClass\r\n\t{\r\n\t\treturn RenderPool._classPool[renderOwner.assetType];\r\n\t}\r\n\t\r\n\r\n\tprivate static main = RenderPool.addDefaults();\r\n\r\n\tprivate static addDefaults()\r\n\t{\r\n\t\tRenderPool.registerClass(BasicMaterialRender, BasicMaterial);\r\n\t\tRenderPool.registerClass(SkyboxRender, Skybox);\r\n\t}\r\n}\r\n\r\nexport = RenderPool;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPassBase\");\r\nimport RenderPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPool\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport TextureVOBase\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOBase\");\r\n\r\n/**\r\n * SkyboxRender forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass SkyboxRender extends RenderPassBase\r\n{\r\n\tpublic _skybox:Skybox;\r\n\tpublic _cubeTexture:TextureVOBase;\r\n\r\n\tconstructor(pool:RenderPool, skybox:Skybox, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, skybox, renderableClass, stage);\r\n\r\n\t\tthis._skybox = skybox;\r\n\r\n\t\tthis._shader = new ShaderBase(renderableClass, this, this._stage);\r\n\r\n\t\tthis._cubeTexture = this._shader.getTextureVO(this._skybox.cubeMap);\r\n\r\n\t\tthis._pAddPass(this);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._skybox = null;\r\n\r\n\t\tthis._cubeTexture.dispose();\r\n\t\tthis._cubeTexture = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateRender()\r\n\t{\r\n\t\tsuper._pUpdateRender();\r\n\r\n\t\tthis._pRequiresBlending = (this._renderOwner.blendMode != BlendMode.NORMAL);\r\n\r\n\t\tthis.shader.setBlendMode((this._renderOwner.blendMode == BlendMode.NORMAL && this._pRequiresBlending)? BlendMode.LAYER : this._renderOwner.blendMode);\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tsuper._iIncludeDependencies(shader);\r\n\r\n\t\tshader.usesLocalPosFragment = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tthis._cubeTexture._iInitRegisters(shader, registerCache);\r\n\r\n\t\treturn this._cubeTexture._iGetFragmentCode(shader, sharedRegisters.shadedTarget, registerCache, sharedRegisters.localPositionVarying);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setDepthTest(false, ContextGLCompareMode.LESS);\r\n\t\tthis._cubeTexture.activate(this._shader);\r\n\t}\r\n}\r\n\r\nexport = SkyboxRender;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\n\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\r\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\r\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport PassBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/PassBase\");\r\n\r\n\r\n/**\r\n * BasicMaterialPass forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass BasicMaterialPass extends PassBase\r\n{\r\n\tprivate _diffuseR:number = 1;\r\n\tprivate _diffuseG:number = 1;\r\n\tprivate _diffuseB:number = 1;\r\n\tprivate _diffuseA:number = 1;\r\n\r\n\tprivate _fragmentConstantsIndex:number;\r\n\r\n\tconstructor(render:RenderBase, renderOwner:IRenderOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(render, renderOwner, renderableClass, stage);\r\n\r\n\t\tthis._shader = new ShaderBase(renderableClass, this, this._stage);\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tsuper._iIncludeDependencies(shader);\r\n\r\n\t\tif (shader.texture != null)\r\n\t\t\tshader.uvDependencies++;\r\n    }\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n        var alphaReg:ShaderRegisterElement;\r\n\r\n        if (this.preserveAlpha) {\r\n            alphaReg = regCache.getFreeFragmentSingleTemp();\r\n            regCache.addFragmentTempUsages(alphaReg, 1);\r\n            code += \"mov \" + alphaReg + \", \" + sharedReg.shadedTarget + \".w\\n\";\r\n        }\r\n\r\n\t\tvar targetReg:ShaderRegisterElement = sharedReg.shadedTarget;\r\n\r\n\t\tif (shader.texture != null) {\r\n\r\n\t\t\tshader.texture._iInitRegisters(shader, regCache);\r\n\r\n\t\t\tcode += shader.texture._iGetFragmentCode(shader, targetReg, regCache, sharedReg.uvVarying);\r\n\r\n\t\t\tif (shader.alphaThreshold > 0) {\r\n\t\t\t\tvar cutOffReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\r\n\t\t\t\tthis._fragmentConstantsIndex = cutOffReg.index*4;\r\n\r\n\t\t\t\tcode += \"sub \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\" + \"kil \" + targetReg + \".w\\n\" + \"add \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\";\r\n\t\t\t}\r\n\t\t} else if (shader.colorBufferIndex != -1) {\r\n\r\n\t\t\tcode += \"mov \" + targetReg + \", \" + sharedReg.colorVarying + \"\\n\";\r\n\t\t} else {\r\n\t\t\tvar diffuseInputReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\r\n\r\n\t\t\tthis._fragmentConstantsIndex = diffuseInputReg.index*4;\r\n\r\n\t\t\tcode += \"mov \" + targetReg + \", \" + diffuseInputReg + \"\\n\";\r\n\t\t}\r\n\r\n        if (this.preserveAlpha) {\r\n            code += \"mul \" + sharedReg.shadedTarget + \".w, \" + sharedReg.shadedTarget + \".w, \" + alphaReg + \"\\n\";\r\n            regCache.removeFragmentTempUsage(alphaReg);\r\n        }\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tif (this._shader.texture != null) {\r\n\t\t\tthis._shader.texture.activate(this._shader);\r\n\r\n\t\t\tif (this._shader.alphaThreshold > 0)\r\n\t\t\t\tthis._shader.fragmentConstantData[this._fragmentConstantsIndex] = this._shader.alphaThreshold;\r\n\t\t} else if (this._shader.colorBufferIndex == -1) {\r\n\t\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\t\tvar data:Float32Array = this._shader.fragmentConstantData;\r\n\t\t\tdata[index] = this._diffuseR;\r\n\t\t\tdata[index + 1] = this._diffuseG;\r\n\t\t\tdata[index + 2] = this._diffuseB;\r\n\t\t\tdata[index + 3] = this._diffuseA;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = BasicMaterialPass;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport AssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetBase\");\r\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\")\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/RendererBase\");\r\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\n\r\n/**\r\n * PassBase provides an abstract base class for material shader passes. A material pass constitutes at least\r\n * a render call per required renderable.\r\n */\r\nclass PassBase extends EventDispatcher implements IPass\r\n{\r\n\tprivate _render:RenderBase;\r\n\tpublic _renderOwner:IRenderOwner;\r\n\tpublic _renderableClass:IRenderableClass;\r\n\tpublic _stage:Stage;\r\n\t\r\n\tpublic _shader:ShaderBase;\r\n\r\n\tprivate _preserveAlpha:boolean = true;\r\n\tprivate _forceSeparateMVP:boolean = false;\r\n\r\n\tpublic get shader():ShaderBase\r\n\t{\r\n\t\treturn this._shader;\r\n\t}\r\n\r\n\tpublic get animationSet():AnimationSetBase\r\n\t{\r\n\t\treturn <AnimationSetBase> this._renderOwner.animationSet;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the output alpha value should remain unchanged compared to the material's original alpha.\r\n\t */\r\n\tpublic get preserveAlpha():boolean\r\n\t{\r\n\t\treturn this._preserveAlpha;\r\n\t}\r\n\r\n\tpublic set preserveAlpha(value:boolean)\r\n\t{\r\n\t\tif (this._preserveAlpha == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._preserveAlpha = value;\r\n\r\n\t\tthis.invalidatePass();\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the screen projection should be calculated by forcing a separate scene matrix and\r\n\t * view-projection matrix. This is used to prevent rounding errors when using multiple passes with different\r\n\t * projection code.\r\n\t */\r\n\tpublic get forceSeparateMVP():boolean\r\n\t{\r\n\t\treturn this._forceSeparateMVP;\r\n\t}\r\n\r\n\tpublic set forceSeparateMVP(value:boolean)\r\n\t{\r\n\t\tif (this._forceSeparateMVP == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._forceSeparateMVP = value;\r\n\r\n\t\tthis.invalidatePass();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new PassBase object.\r\n\t */\r\n\tconstructor(render:RenderBase, renderOwner:IRenderOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._render = render;\r\n\t\tthis._renderOwner = renderOwner;\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._stage = stage;\r\n\t}\r\n\r\n\t/**\r\n\t * Cleans up any resources used by the current object.\r\n\t * @param deep Indicates whether other resources should be cleaned up, that could potentially be shared across different instances.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._render = null;\r\n\t\tthis._renderOwner = null;\r\n\t\tthis._renderableClass = null;\r\n\t\tthis._stage = null;\r\n\r\n\t\tif (this._shader) {\r\n\t\t\tthis._shader.dispose();\r\n\t\t\tthis._shader = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the current pass. Before calling pass, activatePass needs to be called with the same index.\r\n\t * @param pass The pass used to render the renderable.\r\n\t * @param renderable The IRenderable object to draw.\r\n\t * @param stage The Stage object used for rendering.\r\n\t * @param entityCollector The EntityCollector object that contains the visible scene data.\r\n\t * @param viewProjection The view-projection matrix used to project to the screen. This is not the same as\r\n\t * camera.viewProjection as it includes the scaling factors when rendering to textures.\r\n\t *\r\n\t * @internal\r\n\t */\r\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tthis._shader._iRender(renderable, camera, viewProjection);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the render state for the pass that is independent of the rendered object. This needs to be called before\r\n\t * calling pass. Before activating a pass, the previously used pass needs to be deactivated.\r\n\t * @param stage The Stage object which is currently used for rendering.\r\n\t * @param camera The camera from which the scene is viewed.\r\n\t * @private\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tthis._shader._iActivate(camera);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the render state for the pass. This needs to be called before activating another pass.\r\n\t * @param stage The Stage used for rendering\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iDeactivate()\r\n\t{\r\n\t\tthis._shader._iDeactivate();\r\n\t}\r\n\r\n\t/**\r\n\t * Marks the shader program as invalid, so it will be recompiled before the next render.\r\n\t *\r\n\t * @param updateMaterial Indicates whether the invalidation should be performed on the entire material. Should always pass \"true\" unless it's called from the material itself.\r\n\t */\r\n\tpublic invalidatePass()\r\n\t{\r\n\t\tthis._shader.invalidateShader();\r\n\r\n\t\tthis.dispatchEvent(new Event(Event.CHANGE));\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tthis._render._iIncludeDependencies(shader);\r\n\t\t\r\n\t\tif (this._forceSeparateMVP)\r\n\t\t\tshader.globalPosDependencies++;\r\n\t}\r\n\r\n\r\n\tpublic _iInitConstantData(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic _iGetPreLightingVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetPreLightingFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetNormalVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetNormalFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\nexport = PassBase;",
    "import AttributesBuffer\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport PassBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/PassBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\n\r\n/**\r\n * @class away.pool.RenderableListItem\r\n */\r\nclass BillboardRenderable extends RenderableBase\r\n{\r\n\tpublic static assetClass:IAssetClass = Billboard;\r\n\r\n\tprivate static _materialGeometry:Object = new Object();\r\n\r\n\tpublic static vertexAttributesOffset:number = 1;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate _billboard:Billboard;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param billboard\r\n\t */\r\n\tconstructor(pool:RenderablePool, billboard:Billboard, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, billboard, billboard, billboard.material, stage);\r\n\r\n\t\tthis._billboard = billboard;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._billboard = null;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {away.base.TriangleSubGeometry}\r\n\t */\r\n\tpublic _pGetSubGeometry():SubGeometryBase\r\n\t{\r\n\t\tvar material:MaterialBase = this._billboard.material;\r\n\t\tvar billboardRect:Rectangle = this._billboard.billboardRect;\r\n\r\n\t\tvar geometry:TriangleSubGeometry = BillboardRenderable._materialGeometry[material.id];\r\n\r\n\t\tif (!geometry) {\r\n\t\t\tgeometry = BillboardRenderable._materialGeometry[material.id] = new TriangleSubGeometry(new AttributesBuffer(11, 4));\r\n\t\t\tgeometry.autoDeriveNormals = false;\r\n\t\t\tgeometry.autoDeriveTangents = false;\r\n\t\t\tgeometry.setIndices(Array<number>(0, 1, 2, 0, 2, 3));\r\n\t\t\tgeometry.setPositions(Array<number>(-billboardRect.x, material.height-billboardRect.y, 0, material.width-billboardRect.x, material.height-billboardRect.y, 0, material.width-billboardRect.x, -billboardRect.y, 0, -billboardRect.x, -billboardRect.y, 0));\r\n\t\t\tgeometry.setNormals(Array<number>(1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0));\r\n\t\t\tgeometry.setTangents(Array<number>(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1));\r\n\t\t\tgeometry.setUVs(Array<number>(0, 0, 1, 0, 1, 1, 0, 1));\r\n\t\t} else {\r\n\t\t\tgeometry.setPositions(Array<number>(-billboardRect.x, material.height-billboardRect.y, 0, material.width-billboardRect.x, material.height-billboardRect.y, 0, material.width-billboardRect.x, -billboardRect.y, 0, -billboardRect.x, -billboardRect.y, 0));\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic static _iGetVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\t//get the projection coordinates\r\n\t\tvar position:ShaderRegisterElement = (shader.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\r\n\r\n\t\t//reserving vertex constants for projection matrix\r\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tshader.viewMatrixIndex = viewMatrixReg.index*4;\r\n\r\n\t\tif (shader.projectionDependencies > 0) {\r\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\r\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \", \" + viewMatrixReg + \"\\n\" +\r\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\r\n\t\t\t\"mov op, \" + temp + \"\\n\";\r\n\t\t} else {\r\n\t\t\tcode += \"m44 op, \" + position + \", \" + viewMatrixReg + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic static _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _setRenderState(pass:PassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._setRenderState(pass, camera, viewProjection);\r\n\r\n\t\tvar shader:ShaderBase = pass.shader;\r\n\r\n\t\tif (shader.sceneMatrixIndex >= 0) {\r\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\r\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t} else {\r\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix3D.append(viewProjection);\r\n\r\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t}\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\r\n\t}\r\n}\r\n\r\nexport = BillboardRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport CurveSubMesh\t\t\t\t    = require(\"awayjs-display/lib/base/CurveSubMesh\");\r\nimport CurveSubGeometry\t\t    \t= require(\"awayjs-display/lib/base/CurveSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextWebGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport PassBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/PassBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\")\r\n\r\n/**\r\n * @class away.pool.TriangleSubMeshRenderable\r\n */\r\nclass CurveSubMeshRenderable extends RenderableBase\r\n{\r\n\tprivate static _constants:Float32Array = new Float32Array([0, 1, 1, 0.5]);\r\n\r\n\tpublic static assetClass:IAssetClass = CurveSubMesh;\r\n\r\n\tpublic static vertexAttributesOffset:number = 2;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic subMesh:CurveSubMesh;\r\n\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t */\r\n\tconstructor(pool:RenderablePool, subMesh:CurveSubMesh, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage);\r\n\r\n\t\tthis.subMesh = subMesh;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis.subMesh = null;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {SubGeometryBase}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():CurveSubGeometry\r\n\t{\r\n\t\treturn (this.subMesh.animator)? <CurveSubGeometry> this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry) : this.subMesh.subGeometry;\r\n\t}\r\n\r\n\r\n\tpublic static _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n        shader.usesLocalPosFragment = true;\r\n\t}\r\n\r\n\tpublic static _iGetVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\t//get the projection coordinates\r\n\t\tvar position:ShaderRegisterElement = (shader.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\r\n\r\n\t\t//reserving vertex constants for projection matrix\r\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tshader.viewMatrixIndex = viewMatrixReg.index*4;\r\n\r\n\r\n\t\tif (shader.projectionDependencies > 0) {\r\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\r\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \".xyw, \" + viewMatrixReg + \"\\n\" +\r\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\r\n\t\t\t\"mov v2 va1 \\n\" +\r\n\t\t\t\"mov op, \" + temp + \"\\n\";\r\n\r\n\t\t} else {\r\n\t\t\tcode += \"mov v2 va1 \\n\";\r\n\t\t\tcode += \"m44 op, \" + position + \".xyw, \" + viewMatrixReg + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n\tpublic static _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar sd:boolean = (<ContextWebGL>shader._stage.context).standardDerivatives;\r\n\t\tvar pos:ShaderRegisterElement = sharedRegisters.localPositionVarying;\r\n\t\tvar out:ShaderRegisterElement = sharedRegisters.shadedTarget;\r\n\r\n\t\tvar curve:string = \"v2\";\r\n\t\tvar curvex:string = \"v2.x\";\r\n\t\tvar curvey:string = \"v2.y\";\r\n\t\tvar curvez:string = pos + \".z\";\r\n\r\n\r\n\t\t//get some free registers\r\n\t\tvar free:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(free, 1);\r\n\t\tvar free1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(free1, 1);\r\n\t\tvar free2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(free2, 1);\r\n\r\n\t\t//distance from curve\r\n\t\tvar d:string = free + \".x\";\r\n\t\tvar dx:string = free + \".y\";\r\n\t\tvar dy:string = free + \".z\";\r\n\t\tvar t:string = free + \".w\";\r\n\t\tvar d2:string = free1 + \".x\";\r\n\t\tvar fixa:string = free1 + \".y\";\r\n\t\tvar fixb:string = free1 + \".z\";\r\n\r\n\t\tvar _aa:string = \"fc2.z\";\r\n\t\tvar _0:string = \"fc2.x\";\r\n\t\tvar _1:string = \"fc2.y\";\r\n\r\n\t\tvar nl:string = \"\\n\";\r\n\r\n\t\tvar code:Array<string> =  new Array<string>();\r\n\r\n\t\t//distance from curve\r\n\t\tcode.push(\"mul\",d, curvex, curvex, nl);\r\n\t\tcode.push(\"sub\",d, d, curvey, nl);\r\n\t\tcode.push(\"mul\",d, d, curvez, nl);\t//flipper\r\n\r\n\t\t//kill based on distance from curve\r\n\t\tcode.push(\"kil\" ,d, nl);\r\n\r\n\t\tvar applyAA:boolean = false;\r\n\t\tif(applyAA && sd)\r\n\t\t{\r\n\r\n\t\t\t//derivatives\r\n\t\t\tcode.push(\"ddx\", dx, d, nl);\r\n\t\t\tcode.push(\"ddy\", dy, d, nl);\r\n\r\n\t\t\t//AA\r\n\t\t\tcode.push(\"mul\",dx, dx, dx, nl);\r\n\t\t\tcode.push(\"mul\",dy, dy, dy, nl);\r\n\t\t\tcode.push(\"add\",t, dx, dy, nl);\r\n\t\t\tcode.push(\"sqt\",t, t, nl);\r\n\r\n\t\t\tcode.push(\"mul\",t, t, _aa, nl);\r\n\t\t\tcode.push(\"div\",d, d, t, nl);\r\n\r\n/*\r\n\t\t\t//code.push(\"sge\", fixa, curvex, _1, nl);\r\n\t\t\tcode.push(\"slt\", fixb, curvex, _1, nl);\r\n\t\t\tcode.push(\"sub\", fixa, _1, fixb, nl);\r\n\t\t\t//code.push(\"sub\", fixb, _1, fixa, nl);\r\n\r\n\t\t\tcode.push(\"mul\", d, d, fixb, nl);\r\n\r\n*/\r\n//\t\t\tcode.push(\"abs\", d, d, nl);\r\n\t\t\tcode.push(\"max\", d, d, _0, nl);\r\n\t\t\tcode.push(\"min\", d, d, _1, nl);\r\n\t\t\tcode.push(\"mov\", out+\".w\", d, nl);\r\n\t\t}\r\n\r\n\r\n\t\tcode.push(\"mov\", out+\".w\", _1, nl);\r\n\t\treturn code.join(\" \");\r\n\t}\r\n\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public _iActivate(pass:PassBase, camera:Camera)\r\n    {\r\n        super._iActivate(pass, camera);\r\n\r\n        var context:IContextGL = this._stage.context;\r\n\r\n        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 2, CurveSubMeshRenderable._constants, 1);\r\n\r\n    }\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _setRenderState(pass:PassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._setRenderState(pass, camera, viewProjection);\r\n\r\n\t\tvar shader:ShaderBase = pass.shader;\r\n\r\n\t\tif (shader.sceneMatrixIndex >= 0) {\r\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\r\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t} else {\r\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix3D.append(viewProjection);\r\n\r\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t}\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\r\n\t}\r\n}\r\n\r\nexport = CurveSubMeshRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\r\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport LineSegment\t\t\t\t\t= require(\"awayjs-display/lib/entities/LineSegment\");\r\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\nimport PassBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/PassBase\");\r\n\r\n/**\r\n * @class away.pool.LineSubMeshRenderable\r\n */\r\nclass LineSegmentRenderable extends RenderableBase\r\n{\r\n\tpublic static assetClass:IAssetClass = LineSegment;\r\n\r\n\tprivate static _lineGeometry:Object = new Object();\r\n\r\n\tpublic static pONE_VECTOR:Float32Array = new Float32Array([1, 1, 1, 1]);\r\n\tpublic static pFRONT_VECTOR:Float32Array = new Float32Array([0, 0, -1, 0]);\r\n\r\n\tprivate _constants:Float32Array = new Float32Array([0, 0, 0, 0]);\r\n\tprivate _calcMatrix:Matrix3D;\r\n\tprivate _thickness:number = 1.25;\r\n\r\n\r\n\tpublic static vertexAttributesOffset:number = 3;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate _lineSegment:LineSegment;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param dataOffset\r\n\t */\r\n\tconstructor(pool:RenderablePool, lineSegment:LineSegment, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, lineSegment, lineSegment, lineSegment.material, stage);\r\n\r\n\t\tthis._lineSegment = lineSegment;\r\n\r\n\t\tthis._calcMatrix = new Matrix3D();\r\n\r\n\t\tthis._constants[1] = 1/255;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._lineSegment = null;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {base.LineSubGeometry}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():LineSubGeometry\r\n\t{\r\n\t\tvar geometry:LineSubGeometry = LineSegmentRenderable._lineGeometry[this._lineSegment.id] || (LineSegmentRenderable._lineGeometry[this._lineSegment.id] = new LineSubGeometry());\r\n\r\n\t\tvar start:Vector3D = this._lineSegment.startPostion;\r\n\t\tvar end:Vector3D = this._lineSegment.endPosition;\r\n\r\n\t\tvar positions:Float32Array;\r\n\t\tvar thickness:Float32Array;\r\n\r\n\t\t//if (geometry.indices != null) {\r\n\t\t//\tpositions = <Float32Array> geometry.positions.get(geometry.numVertices);\r\n\t\t//\tthickness = geometry.thickness.get(geometry.numVertices);\r\n\t\t//} else {\r\n\t\t\tpositions = new Float32Array(6);\r\n\t\t\tthickness = new Float32Array(1);\r\n\t\t//}\r\n\r\n\t\tpositions[0] = start.x;\r\n\t\tpositions[1] = start.y;\r\n\t\tpositions[2] = start.z;\r\n\t\tpositions[3] = end.x;\r\n\t\tpositions[4] = end.y;\r\n\t\tpositions[5] = end.z;\r\n\t\tthickness[0] = this._lineSegment.thickness;\r\n\r\n\t\tgeometry.setPositions(positions);\r\n\t\tgeometry.setThickness(thickness);\r\n\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tshader.colorDependencies++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic static _iGetVertexCode(shader:ShaderBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"m44 vt0, va0, vc8\t\t\t\\n\" + // transform Q0 to eye space\r\n\t\t\t\"m44 vt1, va1, vc8\t\t\t\\n\" + // transform Q1 to eye space\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\r\n\t\t\t\t// test if behind camera near plane\r\n\t\t\t\t// if 0 - Q0.z < Camera.near then the point needs to be clipped\r\n\t\t\t\t//\"neg vt5.x, vt0.z\t\t\t\t\\n\" + // 0 - Q0.z\r\n\t\t\t\"slt vt5.x, vt0.z, vc7.z\t\t\t\\n\" + // behind = ( 0 - Q0.z < -Camera.near ) ? 1 : 0\r\n\t\t\t\"sub vt5.y, vc5.x, vt5.x\t\t\t\\n\" + // !behind = 1 - behind\r\n\r\n\t\t\t\t// p = point on the plane (0,0,-near)\r\n\t\t\t\t// n = plane normal (0,0,-1)\r\n\t\t\t\t// D = Q1 - Q0\r\n\t\t\t\t// t = ( dot( n, ( p - Q0 ) ) / ( dot( n, d )\r\n\r\n\t\t\t\t// solve for t where line crosses Camera.near\r\n\t\t\t\"add vt4.x, vt0.z, vc7.z\t\t\t\\n\" + // Q0.z + ( -Camera.near )\r\n\t\t\t\"sub vt4.y, vt0.z, vt1.z\t\t\t\\n\" + // Q0.z - Q1.z\r\n\r\n\t\t\t\t// fix divide by zero for horizontal lines\r\n\t\t\t\"seq vt4.z, vt4.y vc6.x\t\t\t\\n\" + // offset = (Q0.z - Q1.z)==0 ? 1 : 0\r\n\t\t\t\"add vt4.y, vt4.y, vt4.z\t\t\t\\n\" + // ( Q0.z - Q1.z ) + offset\r\n\r\n\t\t\t\"div vt4.z, vt4.x, vt4.y\t\t\t\\n\" + // t = ( Q0.z - near ) / ( Q0.z - Q1.z )\r\n\r\n\t\t\t\"mul vt4.xyz, vt4.zzz, vt2.xyz\t\\n\" + // t(L)\r\n\t\t\t\"add vt3.xyz, vt0.xyz, vt4.xyz\t\\n\" + // Qclipped = Q0 + t(L)\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // Qclipped.w = 1\r\n\r\n\t\t\t\t// If necessary, replace Q0 with new Qclipped\r\n\t\t\t\"mul vt0, vt0, vt5.yyyy\t\t\t\\n\" + // !behind * Q0\r\n\t\t\t\"mul vt3, vt3, vt5.xxxx\t\t\t\\n\" + // behind * Qclipped\r\n\t\t\t\"add vt0, vt0, vt3\t\t\t\t\\n\" + // newQ0 = Q0 + Qclipped\r\n\r\n\t\t\t\t// calculate side vector for line\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\t\t\t\"nrm vt2.xyz, vt2.xyz\t\t\t\\n\" + // normalize( L )\r\n\t\t\t\"nrm vt5.xyz, vt0.xyz\t\t\t\\n\" + // D = normalize( Q1 )\r\n\t\t\t\"mov vt5.w, vc5.x\t\t\t\t\\n\" + // D.w = 1\r\n\t\t\t\"crs vt3.xyz, vt2, vt5\t\t\t\\n\" + // S = L x D\r\n\t\t\t\"nrm vt3.xyz, vt3.xyz\t\t\t\\n\" + // normalize( S )\r\n\r\n\t\t\t\t// face the side vector properly for the given point\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, va2.xxx\t\\n\" + // S *= weight\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // S.w = 1\r\n\r\n\t\t\t\t// calculate the amount required to move at the point's distance to correspond to the line's pixel width\r\n\t\t\t\t// scale the side vector by that amount\r\n\t\t\t\"dp3 vt4.x, vt0, vc6\t\t\t\\n\" + // distance = dot( view )\r\n\t\t\t\"mul vt4.x, vt4.x, vc7.x\t\t\t\\n\" + // distance *= vpsod\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, vt4.xxx\t\\n\" + // S.xyz *= pixelScaleFactor\r\n\r\n\t\t\t\t// add scaled side vector to Q0 and transform to clip space\r\n\t\t\t\"add vt0.xyz, vt0.xyz, vt3.xyz\t\\n\" + // Q0 + S\r\n\r\n\t\t\t\"m44 op, vt0, vc0\t\t\t\\n\"  // transform Q0 to clip space\r\n\t}\r\n\r\n\tpublic static _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(pass:PassBase, camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(pass, camera);\r\n\r\n\t\tthis._constants[0] = this._thickness/((this._stage.scissorRect)? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));\r\n\r\n\t\t// value to convert distance from camera to model length per pixel width\r\n\t\tthis._constants[2] = camera.projection.near;\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSegmentRenderable.pONE_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSegmentRenderable.pFRONT_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);\r\n\r\n\t\t// projection matrix\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _setRenderState(pass:PassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._setRenderState(pass, camera, viewProjection);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tthis._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);\r\n\t\tthis._calcMatrix.append(camera.inverseSceneTransform);\r\n\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.LineSubMeshRenderable}\r\n\t * @private\r\n\t */\r\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\r\n\t{\r\n\t\treturn new LineSegmentRenderable(this._pool, <LineSegment> this.renderableOwner, this._stage);\r\n\t}\r\n}\r\n\r\nexport = LineSegmentRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\r\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\r\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\nimport PassBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/PassBase\");\r\n\r\n/**\r\n * @class away.pool.LineSubMeshRenderable\r\n */\r\nclass LineSubMeshRenderable extends RenderableBase\r\n{\r\n\tpublic static assetClass:IAssetClass = LineSubMesh;\r\n\r\n\tpublic static pONE_VECTOR:Float32Array = new Float32Array([1, 1, 1, 1]);\r\n\tpublic static pFRONT_VECTOR:Float32Array = new Float32Array([0, 0, -1, 0]);\r\n\r\n\tprivate _constants:Float32Array = new Float32Array([0, 0, 0, 0]);\r\n\tprivate _calcMatrix:Matrix3D;\r\n\tprivate _thickness:number = 1.25;\r\n\r\n\r\n\tpublic static vertexAttributesOffset:number = 3;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic subMesh:LineSubMesh;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param dataOffset\r\n\t */\r\n\tconstructor(pool:RenderablePool, subMesh:LineSubMesh, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage);\r\n\r\n\t\tthis.subMesh = subMesh;\r\n\r\n\t\tthis._calcMatrix = new Matrix3D();\r\n\r\n\t\tthis._constants[1] = 1/255;\r\n\t}\r\n\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis.subMesh = null;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {base.LineSubGeometry}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():LineSubGeometry\r\n\t{\r\n\t\treturn this.subMesh.subGeometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\t\tshader.colorDependencies++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic static _iGetVertexCode(shader:ShaderBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"m44 vt0, va0, vc8\t\t\t\\n\" + // transform Q0 to eye space\r\n\t\t\t\"m44 vt1, va1, vc8\t\t\t\\n\" + // transform Q1 to eye space\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\r\n\t\t\t\t// test if behind camera near plane\r\n\t\t\t\t// if 0 - Q0.z < Camera.near then the point needs to be clipped\r\n\t\t\t\t//\"neg vt5.x, vt0.z\t\t\t\t\\n\" + // 0 - Q0.z\r\n\t\t\t\"slt vt5.x, vt0.z, vc7.z\t\t\t\\n\" + // behind = ( 0 - Q0.z < -Camera.near ) ? 1 : 0\r\n\t\t\t\"sub vt5.y, vc5.x, vt5.x\t\t\t\\n\" + // !behind = 1 - behind\r\n\r\n\t\t\t\t// p = point on the plane (0,0,-near)\r\n\t\t\t\t// n = plane normal (0,0,-1)\r\n\t\t\t\t// D = Q1 - Q0\r\n\t\t\t\t// t = ( dot( n, ( p - Q0 ) ) / ( dot( n, d )\r\n\r\n\t\t\t\t// solve for t where line crosses Camera.near\r\n\t\t\t\"add vt4.x, vt0.z, vc7.z\t\t\t\\n\" + // Q0.z + ( -Camera.near )\r\n\t\t\t\"sub vt4.y, vt0.z, vt1.z\t\t\t\\n\" + // Q0.z - Q1.z\r\n\r\n\t\t\t\t// fix divide by zero for horizontal lines\r\n\t\t\t\"seq vt4.z, vt4.y vc6.x\t\t\t\\n\" + // offset = (Q0.z - Q1.z)==0 ? 1 : 0\r\n\t\t\t\"add vt4.y, vt4.y, vt4.z\t\t\t\\n\" + // ( Q0.z - Q1.z ) + offset\r\n\r\n\t\t\t\"div vt4.z, vt4.x, vt4.y\t\t\t\\n\" + // t = ( Q0.z - near ) / ( Q0.z - Q1.z )\r\n\r\n\t\t\t\"mul vt4.xyz, vt4.zzz, vt2.xyz\t\\n\" + // t(L)\r\n\t\t\t\"add vt3.xyz, vt0.xyz, vt4.xyz\t\\n\" + // Qclipped = Q0 + t(L)\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // Qclipped.w = 1\r\n\r\n\t\t\t\t// If necessary, replace Q0 with new Qclipped\r\n\t\t\t\"mul vt0, vt0, vt5.yyyy\t\t\t\\n\" + // !behind * Q0\r\n\t\t\t\"mul vt3, vt3, vt5.xxxx\t\t\t\\n\" + // behind * Qclipped\r\n\t\t\t\"add vt0, vt0, vt3\t\t\t\t\\n\" + // newQ0 = Q0 + Qclipped\r\n\r\n\t\t\t\t// calculate side vector for line\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\t\t\t\"nrm vt2.xyz, vt2.xyz\t\t\t\\n\" + // normalize( L )\r\n\t\t\t\"nrm vt5.xyz, vt0.xyz\t\t\t\\n\" + // D = normalize( Q1 )\r\n\t\t\t\"mov vt5.w, vc5.x\t\t\t\t\\n\" + // D.w = 1\r\n\t\t\t\"crs vt3.xyz, vt2, vt5\t\t\t\\n\" + // S = L x D\r\n\t\t\t\"nrm vt3.xyz, vt3.xyz\t\t\t\\n\" + // normalize( S )\r\n\r\n\t\t\t\t// face the side vector properly for the given point\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, va2.xxx\t\\n\" + // S *= weight\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // S.w = 1\r\n\r\n\t\t\t\t// calculate the amount required to move at the point's distance to correspond to the line's pixel width\r\n\t\t\t\t// scale the side vector by that amount\r\n\t\t\t\"dp3 vt4.x, vt0, vc6\t\t\t\\n\" + // distance = dot( view )\r\n\t\t\t\"mul vt4.x, vt4.x, vc7.x\t\t\t\\n\" + // distance *= vpsod\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, vt4.xxx\t\\n\" + // S.xyz *= pixelScaleFactor\r\n\r\n\t\t\t\t// add scaled side vector to Q0 and transform to clip space\r\n\t\t\t\"add vt0.xyz, vt0.xyz, vt3.xyz\t\\n\" + // Q0 + S\r\n\r\n\t\t\t\"m44 op, vt0, vc0\t\t\t\\n\"  // transform Q0 to clip space\r\n\t}\r\n\r\n\tpublic static _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(pass:PassBase, camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(pass, camera);\r\n\r\n\t\tthis._constants[0] = this._thickness/((this._stage.scissorRect)? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));\r\n\r\n\t\t// value to convert distance from camera to model length per pixel width\r\n\t\tthis._constants[2] = camera.projection.near;\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSubMeshRenderable.pONE_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSubMeshRenderable.pFRONT_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);\r\n\r\n\t\t// projection matrix\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _setRenderState(pass:PassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._setRenderState(pass, camera, viewProjection);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tthis._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);\r\n\t\tthis._calcMatrix.append(camera.inverseSceneTransform);\r\n\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);\r\n\t}\r\n}\r\n\r\nexport = LineSubMeshRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\n\r\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/IRenderer\");\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\r\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport RenderableOwnerEvent\t\t\t= require(\"awayjs-display/lib/events/RenderableOwnerEvent\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\nimport RenderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderBase\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\nimport SubGeometryVOBase\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOBase\");\r\nimport SubGeometryVOPool\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOPool\");\r\n/**\r\n * @class RenderableListItem\r\n */\r\nclass RenderableBase implements IRenderable\r\n{\r\n\tprivate _onRenderOwnerUpdatedDelegate:(event:RenderableOwnerEvent) => void;\r\n\r\n\tpublic _subGeometryVOPool:SubGeometryVOPool;\r\n\tpublic _subGeometryVO:SubGeometryVOBase;\r\n\tprivate _geometryDirty:boolean = true;\r\n\r\n\tpublic JOINT_INDEX_FORMAT:string;\r\n\tpublic JOINT_WEIGHT_FORMAT:string;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic _pool:RenderablePool;\r\n\r\n\tpublic _stage:Stage;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic next:RenderableBase;\r\n\r\n\tpublic id:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderId:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderOrderId:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic zIndex:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic maskId:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic masksConfig:Array<Array<number>>;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic cascaded:boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderSceneTransform:Matrix3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic sourceEntity:IEntity;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderableOwner:IRenderableOwner;\r\n\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderOwner:IRenderOwner;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic render:RenderBase;\r\n\r\n\r\n\tpublic get subGeometryVO():SubGeometryVOBase\r\n\t{\r\n\t\tif (this._geometryDirty)\r\n\t\t\tthis._updateGeometry();\r\n\r\n\t\treturn this._subGeometryVO;\r\n\t}\r\n\t/**\r\n\t *\r\n\t * @param sourceEntity\r\n\t * @param renderableOwner\r\n\t * @param subGeometry\r\n\t * @param animationSubGeometry\r\n\t */\r\n\tconstructor(pool:RenderablePool, sourceEntity:IEntity, renderableOwner:IRenderableOwner, renderOwner:IRenderOwner, stage:Stage)\r\n\t{\r\n\t\tthis._onRenderOwnerUpdatedDelegate = (event:RenderableOwnerEvent) => this._onRenderOwnerUpdated(event);\r\n\r\n\t\t//store a reference to the pool for later disposal\r\n\t\tthis._pool = pool;\r\n\t\tthis._stage = stage;\r\n\r\n\t\tthis._subGeometryVOPool = SubGeometryVOPool.getPool();\r\n\r\n\t\tthis.sourceEntity = sourceEntity;\r\n\r\n\t\tthis.renderableOwner = renderableOwner;\r\n\r\n\t\tthis.renderableOwner.addEventListener(RenderableOwnerEvent.RENDER_OWNER_UPDATED, this._onRenderOwnerUpdatedDelegate);\r\n\r\n\t\tthis.renderOwner = renderOwner;\r\n\r\n\t\tthis.render = pool.getRenderPool(renderableOwner).getItem(renderOwner || DefaultMaterialManager.getDefaultMaterial(renderableOwner));\r\n\t\tthis.render.usages++;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis.next = null;\r\n\t\tthis.masksConfig = null;\r\n\t\tthis.renderSceneTransform = null;\r\n\r\n\t\tthis._pool.disposeItem(this.renderableOwner);\r\n\t\tthis._pool = null;\r\n\t\tthis._stage = null;\r\n\t\tthis._subGeometryVOPool = null;\r\n\t\tthis.sourceEntity = null;\r\n\r\n\t\tthis.renderableOwner.removeEventListener(RenderableOwnerEvent.RENDER_OWNER_UPDATED, this._onRenderOwnerUpdatedDelegate);\r\n\t\tthis.renderableOwner = null;\r\n\t\tthis.renderOwner = null;\r\n\r\n\t\tthis.render.usages--;\r\n\r\n\t\tif (!this.render.usages)\r\n\t\t\tthis.render.dispose();\r\n\r\n\t\tthis.render = null;\r\n\r\n\t\tif (this._subGeometryVO) {\r\n\t\t\tthis._subGeometryVO.usages--;\r\n\r\n\t\t\tif (!this._subGeometryVO.usages)\r\n\t\t\t\tthis._subGeometryVO.dispose();\r\n\r\n\t\t\tthis._subGeometryVO = null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic invalidateGeometry()\r\n\t{\r\n\t\tthis._geometryDirty = true;\r\n\t}\r\n\r\n\tpublic _pGetSubGeometry():SubGeometryBase\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the render state for the pass that is independent of the rendered object. This needs to be called before\r\n\t * calling pass. Before activating a pass, the previously used pass needs to be deactivated.\r\n\t * @param stage The Stage object which is currently used for rendering.\r\n\t * @param camera The camera from which the scene is viewed.\r\n\t * @private\r\n\t */\r\n\tpublic _iActivate(pass:IPass, camera:Camera)\r\n\t{\r\n\t\tpass._iActivate(camera);\r\n\t}\r\n\r\n\t/**\r\n\t * Renders an object to the current render target.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iRender(pass:IPass, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tthis._setRenderState(pass, camera, viewProjection)\r\n\r\n\t\tif (this._geometryDirty)\r\n\t\t\tthis._updateGeometry();\r\n\r\n\t\tthis._subGeometryVO._iRender(pass.shader, this._stage);\r\n\t}\r\n\r\n\tpublic _setRenderState(pass:IPass, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tpass._iRender(this, camera, viewProjection);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the render state for the pass. This needs to be called before activating another pass.\r\n\t * @param stage The Stage used for rendering\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iDeactivate(pass:IPass)\r\n\t{\r\n\t\tpass._iDeactivate();\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @private\r\n\t */\r\n\tprivate _updateGeometry()\r\n\t{\r\n\t\tif (this._subGeometryVO) {\r\n\t\t\tthis._subGeometryVO.usages--;\r\n\r\n\t\t\tif (!this._subGeometryVO.usages)\r\n\t\t\t\tthis._subGeometryVO.dispose();\r\n\t\t}\r\n\r\n\t\tthis._subGeometryVO = this._subGeometryVOPool.getItem(this._pGetSubGeometry());\r\n\t\tthis._subGeometryVO.usages++;\r\n\r\n\t\tthis._geometryDirty = false;\r\n\t}\r\n\r\n\tprivate _onRenderOwnerUpdated(event:RenderableOwnerEvent)\r\n\t{\r\n\t\tthis.renderOwner = event.renderOwner;\r\n\r\n\t\tthis.render.usages--;\r\n\r\n\t\tif (!this.render.usages)\r\n\t\t\tthis.render.dispose();\r\n\r\n\t\tthis.render = this._pool.getRenderPool(this.renderableOwner).getItem(this.renderOwner || DefaultMaterialManager.getDefaultMaterial(this.renderableOwner));\r\n\t\tthis.render.usages++;\r\n\t}\r\n}\r\n\r\nexport = RenderableBase;",
    "import IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\r\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport CurveSubMesh\t\t\t    \t= require(\"awayjs-display/lib/base/CurveSubMesh\");\r\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport LineSegment\t\t\t\t\t= require(\"awayjs-display/lib/entities/LineSegment\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/RendererBase\");\r\nimport IRenderClass\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/IRenderClass\");\r\nimport RenderPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/RenderPool\");\r\nimport BillboardRenderable\t\t\t= require(\"awayjs-renderergl/lib/renderables/BillboardRenderable\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport LineSegmentRenderable\t\t= require(\"awayjs-renderergl/lib/renderables/LineSegmentRenderable\");\r\nimport LineSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/renderables/LineSubMeshRenderable\");\r\nimport CurveSubMeshRenderable\t    = require(\"awayjs-renderergl/lib/renderables/CurveSubMeshRenderable\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport SkyboxRenderable\t\t\t    = require(\"awayjs-renderergl/lib/renderables/SkyboxRenderable\");\r\nimport TriangleSubMeshRenderable\t= require(\"awayjs-renderergl/lib/renderables/TriangleSubMeshRenderable\");\r\n\r\n/**\r\n * RenderablePool forms an abstract base class for classes that are used in the rendering pipeline to render the\r\n * contents of a partition\r\n *\r\n * @class away.render.RenderablePool\r\n */\r\nclass RenderablePool\r\n{\r\n\tprivate static _classPool:Object = new Object();\r\n\r\n\tprivate _stage:Stage;\r\n\tprivate _pool:Object = new Object();\r\n\r\n\tprivate _objectPools:Object = new Object();\r\n\t\r\n\t/**\r\n\t * Creates a new RenderablePool object.\r\n\t *\r\n\t * @param stage\r\n\t * @param renderClass\r\n\t */\r\n\tconstructor(stage:Stage, renderClass:IRenderClass = null)\r\n\t{\r\n\t\tthis._stage = stage;\r\n\r\n\t\tfor (var i in RenderablePool._classPool)\r\n\t\t\tthis._objectPools[i] = new RenderPool(RenderablePool._classPool[i], this._stage, renderClass);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableOwner\r\n\t * @returns IRenderable\r\n\t */\r\n\tpublic getItem(renderableOwner:IRenderableOwner):RenderableBase\r\n\t{\r\n\t\treturn this._pool[renderableOwner.id] || (this._pool[renderableOwner.id] = renderableOwner._iAddRenderable(new (RenderablePool.getClass(renderableOwner))(this, renderableOwner, this._stage)));\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param image\r\n\t */\r\n\tpublic disposeItem(renderableOwner:IRenderableOwner)\r\n\t{\r\n\t\trenderableOwner._iRemoveRenderable(this._pool[renderableOwner.id]);\r\n\r\n\t\tdelete this._pool[renderableOwner.id];\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableClass\r\n\t * @returns RenderPool\r\n\t */\r\n\tpublic getRenderPool(renderableOwner:IRenderableOwner):RenderPool\r\n\t{\r\n\t\treturn this._objectPools[renderableOwner.assetType];\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param imageObjectClass\r\n\t */\r\n\tpublic static registerClass(renderableClass:IRenderableClass)\r\n\t{\r\n\t\tRenderablePool._classPool[renderableClass.assetClass.assetType] = renderableClass;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param subGeometry\r\n\t */\r\n\tpublic static getClass(renderableOwner:IRenderableOwner):IRenderableClass\r\n\t{\r\n\t\treturn RenderablePool._classPool[renderableOwner.assetType];\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes the resources used by the RenderablePool.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var id in this._pool)\r\n\t\t\tthis._pool[id].dispose();\r\n\r\n\t\tthis._pool = null;\r\n\t}\r\n\r\n\r\n\tprivate static main = RenderablePool.addDefaults();\r\n\r\n\tprivate static addDefaults()\r\n\t{\r\n\t\tRenderablePool.registerClass(BillboardRenderable);\r\n\t\tRenderablePool.registerClass(LineSegmentRenderable);\r\n\t\tRenderablePool.registerClass(LineSubMeshRenderable);\r\n\t\tRenderablePool.registerClass(TriangleSubMeshRenderable);\r\n\t\tRenderablePool.registerClass(CurveSubMeshRenderable);\r\n\t\tRenderablePool.registerClass(SkyboxRenderable);\r\n\t}\r\n}\r\n\r\nexport = RenderablePool;",
    "import AttributesBuffer\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\nimport PassBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/PassBase\");\r\n\r\n/**\r\n * @class away.pool.SkyboxRenderable\r\n */\r\nclass SkyboxRenderable extends RenderableBase\r\n{\r\n\tpublic static assetClass:IAssetClass = Skybox;\r\n\r\n\tpublic static vertexAttributesOffset:number = 1;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate static _geometry:TriangleSubGeometry;\r\n\r\n\tprivate _vertexArray:Float32Array;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param skybox\r\n\t */\r\n\tconstructor(pool:RenderablePool, skybox:Skybox, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, skybox, skybox, skybox, stage);\r\n\r\n\t\tthis._vertexArray = new Float32Array([0, 0, 0, 0, 1, 1, 1, 1]);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {away.base.TriangleSubGeometry}\r\n\t * @private\r\n\t */\r\n\tpublic _pGetSubGeometry():TriangleSubGeometry\r\n\t{\r\n\t\tvar geometry:TriangleSubGeometry = SkyboxRenderable._geometry;\r\n\r\n\t\tif (!geometry) {\r\n\t\t\tgeometry = SkyboxRenderable._geometry = new TriangleSubGeometry(new AttributesBuffer(11, 4));\r\n\t\t\tgeometry.autoDeriveNormals = false;\r\n\t\t\tgeometry.autoDeriveTangents = false;\r\n\t\t\tgeometry.setIndices(Array<number>(0, 1, 2, 2, 3, 0, 6, 5, 4, 4, 7, 6, 2, 6, 7, 7, 3, 2, 4, 5, 1, 1, 0, 4, 4, 0, 3, 3, 7, 4, 2, 1, 5, 5, 6, 2));\r\n\t\t\tgeometry.setPositions(Array<number>(-1, 1, -1, 1, 1, -1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1));\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic static _iGetVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"mul vt0, va0, vc5\\n\" +\r\n\t\t\t\"add vt0, vt0, vc4\\n\" +\r\n\t\t\t\"m44 op, vt0, vc0\\n\";\r\n\t}\r\n\r\n\tpublic static _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _setRenderState(pass:PassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._setRenderState(pass, camera, viewProjection);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tvar pos:Vector3D = camera.scenePosition;\r\n\t\tthis._vertexArray[0] = pos.x;\r\n\t\tthis._vertexArray[1] = pos.y;\r\n\t\tthis._vertexArray[2] = pos.z;\r\n\t\tthis._vertexArray[4] = this._vertexArray[5] = this._vertexArray[6] = camera.projection.far/Math.sqrt(3);\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, viewProjection, true);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 4, this._vertexArray, 2);\r\n\t}\r\n}\r\n\r\nexport = SkyboxRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport RenderablePool\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderablePool\");\r\nimport PassBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/PassBase\");\r\n\r\n/**\r\n * @class away.pool.TriangleSubMeshRenderable\r\n */\r\nclass TriangleSubMeshRenderable extends RenderableBase\r\n{\r\n\tpublic static assetClass:IAssetClass = TriangleSubMesh;\r\n\r\n\tpublic static vertexAttributesOffset:number = 1;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic subMesh:TriangleSubMesh;\r\n\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t */\r\n\tconstructor(pool:RenderablePool, subMesh:TriangleSubMesh, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage);\r\n\r\n\t\tthis.subMesh = subMesh;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis.subMesh = null;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {SubGeometryBase}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():TriangleSubGeometry\r\n\t{\r\n\t\treturn (this.subMesh.animator)? <TriangleSubGeometry> this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry) : this.subMesh.subGeometry;\r\n\t}\r\n\r\n\r\n\tpublic static _iIncludeDependencies(shader:ShaderBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic static _iGetVertexCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\t//get the projection coordinates\r\n\t\tvar position:ShaderRegisterElement = (shader.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\r\n\r\n\t\t//reserving vertex constants for projection matrix\r\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tshader.viewMatrixIndex = viewMatrixReg.index*4;\r\n\r\n\t\tif (shader.projectionDependencies > 0) {\r\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\r\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \", \" + viewMatrixReg + \"\\n\" +\r\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\r\n\t\t\t\"mov op, \" + temp + \"\\n\";\r\n\t\t} else {\r\n\t\t\tcode += \"m44 op, \" + position + \", \" + viewMatrixReg + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic static _iGetFragmentCode(shader:ShaderBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _setRenderState(pass:PassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._setRenderState(pass, camera, viewProjection);\r\n\r\n\t\tvar shader:ShaderBase = pass.shader;\r\n\r\n\t\tif (shader.sceneMatrixIndex >= 0) {\r\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\r\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t} else {\r\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix3D.append(viewProjection);\r\n\r\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t}\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\r\n\t}\r\n}\r\n\r\nexport = TriangleSubMeshRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport LightProbe\t\t\t\t\t= require(\"awayjs-display/lib/entities/LightProbe\");\r\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport IRenderOwner\t\t\t\t\t= require(\"awayjs-display/lib/base/IRenderOwner\");\r\nimport LightSources\t\t\t\t\t= require(\"awayjs-display/lib/materials/LightSources\");\r\n\r\nimport ContextGLProfile\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProfile\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\n\r\nimport ILightingPass\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/ILightingPass\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport CompilerBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/compilers/CompilerBase\");\r\nimport LightingCompiler\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/compilers/LightingCompiler\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\n\r\n/**\r\n * ShaderBase keeps track of the number of dependencies for \"named registers\" used across a pass.\r\n * Named registers are that are not necessarily limited to a single method. They are created by the compiler and\r\n * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed\r\n * each time a method has been compiled into the shader.\r\n *\r\n * @see RegisterPool.addUsage\r\n */\r\nclass LightingShader extends ShaderBase\r\n{\r\n\tpublic _lightingPass:ILightingPass;\r\n\r\n\tprivate _includeCasters:boolean = true;\r\n\r\n\t/**\r\n\t * The first index for the fragment constants containing the light data.\r\n\t */\r\n\tpublic lightFragmentConstantIndex:number;\r\n\r\n\t/**\r\n\t * The starting index if the vertex constant to which light data needs to be uploaded.\r\n\t */\r\n\tpublic lightVertexConstantIndex:number;\r\n\r\n\t/**\r\n\t * Indices for the light probe diffuse textures.\r\n\t */\r\n\tpublic lightProbeDiffuseIndices:Array<number> /*uint*/;\r\n\r\n\t/**\r\n\t * Indices for the light probe specular textures.\r\n\t */\r\n\tpublic lightProbeSpecularIndices:Array<number> /*uint*/;\r\n\r\n\t/**\r\n\t * The index of the fragment constant containing the weights for the light probes.\r\n\t */\r\n\tpublic probeWeightsIndex:number;\r\n\r\n\tpublic numLights:number;\r\n\tpublic numDirectionalLights:number;\r\n\tpublic numPointLights:number;\r\n\tpublic numLightProbes:number;\r\n\r\n\tpublic usesLightFallOff:boolean;\r\n\r\n\tpublic usesShadows:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the shader uses any lights.\r\n\t */\r\n\tpublic usesLights:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the shader uses any light probes.\r\n\t */\r\n\tpublic usesProbes:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the lights uses any specular components.\r\n\t */\r\n\tpublic usesLightsForSpecular:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the probes uses any specular components.\r\n\t */\r\n\tpublic usesProbesForSpecular:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the lights uses any diffuse components.\r\n\t */\r\n\tpublic usesLightsForDiffuse:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the probes uses any diffuse components.\r\n\t */\r\n\tpublic usesProbesForDiffuse:boolean;\r\n\r\n\t/**\r\n\t * Creates a new MethodCompilerVO object.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, lightingPass:ILightingPass, stage:Stage)\r\n\t{\r\n\t\tsuper(renderableClass, lightingPass, stage);\r\n\r\n\t\tthis._lightingPass = lightingPass;\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies()\r\n\t{\r\n\t\tthis.numPointLights = this._lightingPass.numPointLights;\r\n\t\tthis.numDirectionalLights = this._lightingPass.numDirectionalLights;\r\n\t\tthis.numLightProbes = this._lightingPass.numLightProbes;\r\n\r\n\t\tvar numAllLights:number = this._lightingPass.numPointLights + this._lightingPass.numDirectionalLights;\r\n\t\tvar numLightProbes:number = this._lightingPass.numLightProbes;\r\n\t\tvar diffuseLightSources:number = this._lightingPass._iUsesDiffuse(this)? this._lightingPass.diffuseLightSources : 0x00;\r\n\t\tvar specularLightSources:number = this._lightingPass._iUsesSpecular(this)? this._lightingPass.specularLightSources : 0x00;\r\n\t\tvar combinedLightSources:number = diffuseLightSources | specularLightSources;\r\n\r\n\t\tthis.usesLightFallOff = this._lightingPass.enableLightFallOff && this.profile != ContextGLProfile.BASELINE_CONSTRAINED;\r\n\t\tthis.usesCommonData = this.usesLightFallOff;\r\n\t\tthis.numLights = numAllLights + numLightProbes;\r\n\t\tthis.usesLights = numAllLights > 0 && (combinedLightSources & LightSources.LIGHTS) != 0;\r\n\t\tthis.usesProbes = numLightProbes > 0 && (combinedLightSources & LightSources.PROBES) != 0;\r\n\t\tthis.usesLightsForSpecular = numAllLights > 0 && (specularLightSources & LightSources.LIGHTS) != 0;\r\n\t\tthis.usesProbesForSpecular = numLightProbes > 0 && (specularLightSources & LightSources.PROBES) != 0;\r\n\t\tthis.usesLightsForDiffuse = numAllLights > 0 && (diffuseLightSources & LightSources.LIGHTS) != 0;\r\n\t\tthis.usesProbesForDiffuse = numLightProbes > 0 && (diffuseLightSources & LightSources.PROBES) != 0;\r\n\t\tthis.usesShadows = this._lightingPass._iUsesShadows(this);\r\n\r\n\t\t//IMPORTANT this must occur after shader lighting initialisation above\r\n\t\tsuper._iIncludeDependencies();\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method to create a concrete compiler object for this object\r\n\t *\r\n\t * @param materialPassVO\r\n\t * @returns {away.materials.LightingCompiler}\r\n\t */\r\n\tpublic createCompiler(renderableClass:IRenderableClass, pass:ILightingPass):CompilerBase\r\n\t{\r\n\t\treturn new LightingCompiler(renderableClass, pass, this);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param renderable\r\n\t * @param stage\r\n\t * @param camera\r\n\t */\r\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(renderable, camera, viewProjection);\r\n\r\n\t\tif (this._lightingPass.lightPicker)\r\n\t\t\tthis._lightingPass.lightPicker.collectLights(renderable);\r\n\r\n\t\tif (this.usesLights)\r\n\t\t\tthis.updateLights();\r\n\r\n\t\tif (this.usesProbes)\r\n\t\t\tthis.updateProbes();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates constant data render state used by the lights. This method is optional for subclasses to implement.\r\n\t */\r\n\tprivate updateLights()\r\n\t{\r\n\t\tvar dirLight:DirectionalLight;\r\n\t\tvar pointLight:PointLight;\r\n\t\tvar i:number = 0;\r\n\t\tvar k:number = 0;\r\n\t\tvar len:number;\r\n\t\tvar dirPos:Vector3D;\r\n\t\tvar total:number = 0;\r\n\t\tvar numLightTypes:number = this.usesShadows? 2 : 1;\r\n\t\tvar l:number;\r\n\t\tvar offset:number;\r\n\r\n\t\tthis.ambientR = this.ambientG = this.ambientB = 0;\r\n\r\n\t\tl = this.lightVertexConstantIndex;\r\n\t\tk = this.lightFragmentConstantIndex;\r\n\r\n\t\tvar cast:number = 0;\r\n\t\tvar dirLights:Array<DirectionalLight> = this._lightingPass.lightPicker.directionalLights;\r\n\t\toffset = this._lightingPass.directionalLightsOffset;\r\n\t\tlen = this._lightingPass.lightPicker.directionalLights.length;\r\n\r\n\t\tif (offset > len) {\r\n\t\t\tcast = 1;\r\n\t\t\toffset -= len;\r\n\t\t}\r\n\r\n\t\tfor (; cast < numLightTypes; ++cast) {\r\n\t\t\tif (cast)\r\n\t\t\t\tdirLights = this._lightingPass.lightPicker.castingDirectionalLights;\r\n\r\n\t\t\tlen = dirLights.length;\r\n\r\n\t\t\tif (len > this.numDirectionalLights)\r\n\t\t\t\tlen = this.numDirectionalLights;\r\n\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tdirLight = dirLights[offset + i];\r\n\t\t\t\tdirPos = dirLight.sceneDirection;\r\n\r\n\t\t\t\tthis.ambientR += dirLight._iAmbientR;\r\n\t\t\t\tthis.ambientG += dirLight._iAmbientG;\r\n\t\t\t\tthis.ambientB += dirLight._iAmbientB;\r\n\r\n\t\t\t\tif (this.usesTangentSpace) {\r\n\t\t\t\t\tvar x:number = -dirPos.x;\r\n\t\t\t\t\tvar y:number = -dirPos.y;\r\n\t\t\t\t\tvar z:number = -dirPos.z;\r\n\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.x;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.y;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.z;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseB;\r\n\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularB;\r\n\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\r\n\t\t\t\tif (++total == this.numDirectionalLights) {\r\n\t\t\t\t\t// break loop\r\n\t\t\t\t\ti = len;\r\n\t\t\t\t\tcast = numLightTypes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// more directional supported than currently picked, need to clamp all to 0\r\n\t\tif (this.numDirectionalLights > total) {\r\n\t\t\ti = k + (this.numDirectionalLights - total)*12;\r\n\r\n\t\t\twhile (k < i)\r\n\t\t\t\tthis.fragmentConstantData[k++] = 0;\r\n\t\t}\r\n\r\n\t\ttotal = 0;\r\n\r\n\t\tvar pointLights:Array<PointLight> = this._lightingPass.lightPicker.pointLights;\r\n\t\toffset = this._lightingPass.pointLightsOffset;\r\n\t\tlen = this._lightingPass.lightPicker.pointLights.length;\r\n\r\n\t\tif (offset > len) {\r\n\t\t\tcast = 1;\r\n\t\t\toffset -= len;\r\n\t\t} else {\r\n\t\t\tcast = 0;\r\n\t\t}\r\n\r\n\t\tfor (; cast < numLightTypes; ++cast) {\r\n\t\t\tif (cast)\r\n\t\t\t\tpointLights = this._lightingPass.lightPicker.castingPointLights;\r\n\r\n\t\t\tlen = pointLights.length;\r\n\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tpointLight = pointLights[offset + i];\r\n\t\t\t\tdirPos = pointLight.scenePosition;\r\n\r\n\t\t\t\tthis.ambientR += pointLight._iAmbientR;\r\n\t\t\t\tthis.ambientG += pointLight._iAmbientG;\r\n\t\t\t\tthis.ambientB += pointLight._iAmbientB;\r\n\r\n\t\t\t\tif (this.usesTangentSpace) {\r\n\t\t\t\t\tx = dirPos.x;\r\n\t\t\t\t\ty = dirPos.y;\r\n\t\t\t\t\tz = dirPos.z;\r\n\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z + this._pInverseSceneMatrix[12];\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z + this._pInverseSceneMatrix[13];\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z + this._pInverseSceneMatrix[14];\r\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\r\n\t\t\t\t} else if (!this.usesGlobalPosFragment) {\r\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.x;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.y;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.x;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.y;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.z;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseB;\r\n\r\n\t\t\t\tvar radius:number = pointLight._pRadius;\r\n\t\t\t\tthis.fragmentConstantData[k++] = radius*radius;\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularB;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._pFallOffFactor;\r\n\r\n\t\t\t\tif (++total == this.numPointLights) {\r\n\t\t\t\t\t// break loop\r\n\t\t\t\t\ti = len;\r\n\t\t\t\t\tcast = numLightTypes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// more directional supported than currently picked, need to clamp all to 0\r\n\t\tif (this.numPointLights > total) {\r\n\t\t\ti = k + (total - this.numPointLights)*12;\r\n\r\n\t\t\tfor (; k < i; ++k)\r\n\t\t\t\tthis.fragmentConstantData[k] = 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates constant data render state used by the light probes. This method is optional for subclasses to implement.\r\n\t */\r\n\tprivate updateProbes()\r\n\t{\r\n\t\tvar probe:LightProbe;\r\n\t\tvar lightProbes:Array<LightProbe> = this._lightingPass.lightPicker.lightProbes;\r\n\t\tvar weights:Array<number> = this._lightingPass.lightPicker.lightProbeWeights;\r\n\t\tvar len:number = lightProbes.length - this._lightingPass.lightProbesOffset;\r\n\t\tvar addDiff:boolean = this.usesProbesForDiffuse;\r\n\t\tvar addSpec:boolean = this.usesProbesForSpecular;\r\n\r\n\t\tif (!(addDiff || addSpec))\r\n\t\t\treturn;\r\n\r\n\t\tif (len > this.numLightProbes)\r\n\t\t\tlen = this.numLightProbes;\r\n\r\n\t\tfor (var i:number = 0; i < len; ++i) {\r\n\t\t\tprobe = lightProbes[ this._lightingPass.lightProbesOffset + i];\r\n\r\n\t\t\tif (addDiff)\r\n\t\t\t\tthis._stage.getImageObject(probe.diffuseMap).activate(this.lightProbeDiffuseIndices[i], false, this.useSmoothTextures, this.useMipmapping);\r\n\r\n\t\t\tif (addSpec)\r\n\t\t\t\tthis._stage.getImageObject(probe.specularMap).activate(this.lightProbeSpecularIndices[i], false, this.useSmoothTextures, this.useMipmapping);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < len; ++i)\r\n\t\t\tthis.fragmentConstantData[this.probeWeightsIndex + i] = weights[this._lightingPass.lightProbesOffset + i];\r\n\t}\r\n}\r\n\r\nexport = LightingShader;",
    "import ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n/**\r\n * RegisterPool is used by the shader compilers process to keep track of which registers of a certain type are\r\n * currently used and should not be allowed to be written to. Either entire registers can be requested and locked,\r\n * or single components (x, y, z, w) of a single register.\r\n * It is used by ShaderRegisterCache to track usages of individual register types.\r\n *\r\n * @see away.materials.ShaderRegisterCache\r\n */\r\nclass RegisterPool\r\n{\r\n\tprivate static _regPool:Object = new Object();\r\n\tprivate static _regCompsPool:Object = new Object();\r\n\r\n\tprivate _vectorRegisters:Array<ShaderRegisterElement>;\r\n\tprivate _registerComponents;\r\n\r\n\tprivate _regName:string;\r\n\tprivate _usedSingleCount:Array<Array<number>>;\r\n\tprivate _usedVectorCount:Array<number> /*uint*/;\r\n\tprivate _regCount:number;\r\n\r\n\tprivate _persistent:boolean;\r\n\r\n\t/**\r\n\t * Creates a new RegisterPool object.\r\n\t * @param regName The base name of the register type (\"ft\" for fragment temporaries, \"vc\" for vertex constants, etc)\r\n\t * @param regCount The amount of available registers of this type.\r\n\t * @param persistent Whether or not registers, once reserved, can be freed again. For example, temporaries are not persistent, but constants are.\r\n\t */\r\n\tconstructor(regName:string, regCount:number, persistent:boolean = true)\r\n\t{\r\n\t\tthis._regName = regName;\r\n\t\tthis._regCount = regCount;\r\n\t\tthis._persistent = persistent;\r\n\t\tthis.initRegisters(regName, regCount);\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an entire vector register that's still available.\r\n\t */\r\n\tpublic requestFreeVectorReg():ShaderRegisterElement\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._regCount; ++i) {\r\n\t\t\tif (!this.isRegisterUsed(i)) {\r\n\t\t\t\tif (this._persistent)\r\n\t\t\t\t\tthis._usedVectorCount[i]++;\r\n\r\n\t\t\t\treturn this._vectorRegisters[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthrow new Error(\"Register overflow!\");\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve a single vector component that's still available.\r\n\t */\r\n\tpublic requestFreeRegComponent():ShaderRegisterElement\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._regCount; ++i) {\r\n\t\t\tif (this._usedVectorCount[i] > 0)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tfor (var j:number = 0; j < 4; ++j) {\r\n\t\t\t\tif (this._usedSingleCount[j][i] == 0) {\r\n\t\t\t\t\tif (this._persistent)\r\n\t\t\t\t\t\tthis._usedSingleCount[j][i]++;\r\n\r\n\t\t\t\t\treturn this._registerComponents[j][i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthrow new Error(\"Register overflow!\");\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a register as used, so it cannot be retrieved. The register won't be able to be used until removeUsage\r\n\t * has been called usageCount times again.\r\n\t * @param register The register to mark as used.\r\n\t * @param usageCount The amount of usages to add.\r\n\t */\r\n\tpublic addUsage(register:ShaderRegisterElement, usageCount:number)\r\n\t{\r\n\t\tif (register._component > -1)\r\n\t\t\tthis._usedSingleCount[register._component][register.index] += usageCount;\r\n\t\telse\r\n\t\t\tthis._usedVectorCount[register.index] += usageCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a usage from a register. When usages reach 0, the register is freed again.\r\n\t * @param register The register for which to remove a usage.\r\n\t */\r\n\tpublic removeUsage(register:ShaderRegisterElement)\r\n\t{\r\n\t\tif (register._component > -1) {\r\n\t\t\tif (--this._usedSingleCount[register._component][register.index] < 0)\r\n\t\t\t\tthrow new Error(\"More usages removed than exist!\");\r\n\t\t} else {\r\n\t\t\tif (--this._usedVectorCount[register.index] < 0)\r\n\t\t\t\tthrow new Error(\"More usages removed than exist!\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes any resources used by the current RegisterPool object.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._vectorRegisters = null;\r\n\t\tthis._registerComponents = null;\r\n\t\tthis._usedSingleCount = null;\r\n\t\tthis._usedVectorCount = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not any registers are in use.\r\n\t */\r\n\tpublic hasRegisteredRegs():boolean\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._regCount; ++i)\r\n\t\t\tif (this.isRegisterUsed(i))\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes all registers.\r\n\t */\r\n\tprivate initRegisters(regName:string, regCount:number)\r\n\t{\r\n\t\tvar hash:string = RegisterPool._initPool(regName, regCount);\r\n\r\n\t\tthis._vectorRegisters = RegisterPool._regPool[hash];\r\n\t\tthis._registerComponents = RegisterPool._regCompsPool[hash];\r\n\r\n\t\tthis._usedVectorCount = this._initArray(Array<number>(regCount), 0);\r\n\r\n\t\tthis._usedSingleCount = new Array<Array<number>>(4);\r\n\t\tthis._usedSingleCount[0] = this._initArray(new Array<number>(regCount), 0);\r\n\t\tthis._usedSingleCount[1] = this._initArray(new Array<number>(regCount), 0);\r\n\t\tthis._usedSingleCount[2] = this._initArray(new Array<number>(regCount), 0);\r\n\t\tthis._usedSingleCount[3] = this._initArray(new Array<number>(regCount), 0);\r\n\t}\r\n\r\n\tprivate static _initPool(regName:string, regCount:number):string\r\n\t{\r\n\t\tvar hash:string = regName + regCount;\r\n\r\n\t\tif (RegisterPool._regPool[hash] != undefined)\r\n\t\t\treturn hash;\r\n\r\n\t\tvar vectorRegisters:Array<ShaderRegisterElement> = new Array<ShaderRegisterElement>(regCount);\r\n\t\tRegisterPool._regPool[hash] = vectorRegisters;\r\n\r\n\t\tvar registerComponents = [\r\n\t\t\t[],\r\n\t\t\t[],\r\n\t\t\t[],\r\n\t\t\t[]\r\n\t\t];\r\n\t\tRegisterPool._regCompsPool[hash] = registerComponents;\r\n\r\n\t\tfor (var i:number = 0; i < regCount; ++i) {\r\n\r\n\t\t\tvectorRegisters[i] = new ShaderRegisterElement(regName, i);\r\n\r\n\t\t\tfor (var j:number = 0; j < 4; ++j)\r\n\t\t\t\tregisterComponents[j][i] = new ShaderRegisterElement(regName, i, j);\r\n\t\t}\r\n\r\n\t\treturn hash;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Check if the temp register is either used for single or vector use\r\n\t */\r\n\tprivate isRegisterUsed(index:number):boolean\r\n\t{\r\n\t\tif (this._usedVectorCount[index] > 0)\r\n\t\t\treturn true;\r\n\r\n\t\tfor (var i:number = 0; i < 4; ++i)\r\n\t\t\tif (this._usedSingleCount[i][index] > 0)\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tprivate _initArray(a:Array<any>, val:any):Array<any>\r\n\t{\r\n\t\tvar l:number = a.length;\r\n\r\n\t\tfor (var c:number = 0; c < l; c++)\r\n\t\t\ta[c] = val;\r\n\r\n\t\treturn a;\r\n\t}\r\n}\r\n\r\nexport = RegisterPool;\r\n",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport ColorTransform\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\r\n\r\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport TextureBase\t\t\t\t\t= require(\"awayjs-display/lib/textures/TextureBase\");\r\n\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLTriangleFace\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\r\n\r\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport CompilerBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/compilers/CompilerBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport TextureVOPool\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOPool\");\r\nimport TextureVOBase\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOBase\");\r\n\r\n/**\r\n * ShaderBase keeps track of the number of dependencies for \"named registers\" used across a pass.\r\n * Named registers are that are not necessarily limited to a single method. They are created by the compiler and\r\n * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed\r\n * each time a method has been compiled into the shader.\r\n *\r\n * @see RegisterPool.addUsage\r\n */\r\nclass ShaderBase\r\n{\r\n\tprivate _textureVOPool:TextureVOPool;\r\n\tprivate _renderableClass:IRenderableClass;\r\n\tprivate _pass:IPass;\r\n\tpublic _stage:Stage;\r\n\tprivate _programData:ProgramData;\r\n\r\n\tprivate _blendFactorSource:string = ContextGLBlendFactor.ONE;\r\n\tprivate _blendFactorDest:string = ContextGLBlendFactor.ZERO;\r\n\r\n\tprivate _invalidShader:boolean = true;\r\n\tprivate _invalidProgram:boolean = true;\r\n\tprivate _animationVertexCode:string = \"\";\r\n\tprivate _animationFragmentCode:string = \"\";\r\n\r\n\tpublic get programData():ProgramData\r\n\t{\r\n\t\tif (this._invalidProgram)\r\n\t\t\tthis._updateProgram();\r\n\r\n\t\treturn this._programData;\r\n\t}\r\n\r\n\tpublic usesBlending:boolean = false;\r\n\r\n\t/**\r\n\t * The depth compare mode used to render the renderables using this material.\r\n\t *\r\n\t * @see away.stagegl.ContextGLCompareMode\r\n\t */\r\n\tpublic depthCompareMode:string = ContextGLCompareMode.LESS_EQUAL;\r\n\r\n\r\n\t/**\r\n\t * Indicate whether the shader should write to the depth buffer or not. Ignored when blending is enabled.\r\n\t */\r\n\tpublic writeDepth:boolean = true;\r\n\r\n\tpublic profile:string;\r\n\r\n\tpublic usesAnimation:boolean;\r\n\r\n\tprivate _defaultCulling:string = ContextGLTriangleFace.BACK;\r\n\r\n\tpublic _pInverseSceneMatrix:Float32Array = new Float32Array(16);\r\n\r\n\tpublic animationRegisterCache:AnimationRegisterCache;\r\n\r\n\t/**\r\n\t * The amount of used vertex constants in the vertex code. Used by the animation code generation to know from which index on registers are available.\r\n\t */\r\n\tpublic numUsedVertexConstants:number;\r\n\r\n\t/**\r\n\t * The amount of used fragment constants in the fragment code. Used by the animation code generation to know from which index on registers are available.\r\n\t */\r\n\tpublic numUsedFragmentConstants:number;\r\n\r\n\t/**\r\n\t * The amount of used vertex streams in the vertex code. Used by the animation code generation to know from which index on streams are available.\r\n\t */\r\n\tpublic numUsedStreams:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic numUsedTextures:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic numUsedVaryings:number;\r\n\r\n\tpublic animatableAttributes:Array<string>;\r\n\tpublic animationTargetRegisters:Array<string>;\r\n\tpublic uvSource:string;\r\n\tpublic uvTarget:string;\r\n\r\n\tpublic useAlphaPremultiplied:boolean;\r\n\tpublic useBothSides:boolean;\r\n\tpublic useMipmapping:boolean;\r\n\tpublic useSmoothTextures:boolean;\r\n\tpublic repeatTextures:boolean;\r\n\tpublic usesUVTransform:boolean;\r\n\tpublic usesColorTransform:boolean;\r\n\tpublic alphaThreshold:number;\r\n\tpublic texture:TextureVOBase;\r\n\tpublic color:number;\r\n\r\n\r\n\t//set ambient values to default\r\n\tpublic ambientR:number = 0xFF;\r\n\tpublic ambientG:number = 0xFF;\r\n\tpublic ambientB:number = 0xFF;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic usesCommonData:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the pass requires any fragment animation code.\r\n\t */\r\n\tpublic usesFragmentAnimation:boolean;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the projected position.\r\n\t */\r\n\tpublic projectionDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the normal vector.\r\n\t */\r\n\tpublic normalDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the vertex color.\r\n\t */\r\n\tpublic colorDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the view direction.\r\n\t */\r\n\tpublic viewDirDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the primary UV coordinates.\r\n\t */\r\n\tpublic uvDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the secondary UV coordinates.\r\n\t */\r\n\tpublic secondaryUVDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the global position. This can be 0 while hasGlobalPosDependencies is true when\r\n\t * the global position is used as a temporary value (fe to calculate the view direction)\r\n\t */\r\n\tpublic globalPosDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of tangent vector dependencies (fragment shader).\r\n\t */\r\n\tpublic tangentDependencies:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic outputsColors:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether or not normals are output.\r\n\t */\r\n\tpublic outputsNormals:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether or not normal calculations are output in tangent space.\r\n\t */\r\n\tpublic outputsTangentNormals:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether or not normal calculations are expected in tangent space. This is only the case if no world-space\r\n\t * dependencies exist and normals are being output.\r\n\t */\r\n\tpublic usesTangentSpace:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether there are any dependencies on the world-space position vector.\r\n\t */\r\n\tpublic usesGlobalPosFragment:boolean = false;\r\n\r\n\t/**\r\n\t * Indicates whether there are any dependencies on the local position vector.\r\n\t */\r\n\tpublic usesLocalPosFragment:boolean = false;\r\n\r\n\tpublic vertexConstantData:Float32Array;\r\n\tpublic fragmentConstantData:Float32Array;\r\n\r\n\t/**\r\n\t * The index for the common data register.\r\n\t */\r\n\tpublic commonsDataIndex:number;\r\n\r\n\t/**\r\n\t * The index for the UV vertex attribute stream.\r\n\t */\r\n\tpublic uvBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the secondary UV vertex attribute stream.\r\n\t */\r\n\tpublic secondaryUVBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the vertex normal attribute stream.\r\n\t */\r\n\tpublic normalBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the color attribute stream.\r\n\t */\r\n\tpublic colorBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the vertex tangent attribute stream.\r\n\t */\r\n\tpublic tangentBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the view matrix.\r\n\t */\r\n\tpublic viewMatrixIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the scene matrix.\r\n\t */\r\n\tpublic sceneMatrixIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the uniform scene matrix (the inverse transpose).\r\n\t */\r\n\tpublic sceneNormalMatrixIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the camera position.\r\n\t */\r\n\tpublic cameraPositionIndex:number;\r\n\r\n\t/**\r\n\t * The index for the UV transformation matrix vertex constant.\r\n\t */\r\n\tpublic uvTransformIndex:number;\r\n\r\n\t/**\r\n\t * The index for the color transform fragment constant.\r\n\t */\r\n\tpublic colorTransformIndex:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic jointIndexIndex:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic jointWeightIndex:number;\r\n\r\n\t/**\r\n\t * Creates a new MethodCompilerVO object.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, pass:IPass, stage:Stage)\r\n\t{\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._pass = pass;\r\n\t\tthis._stage = stage;\r\n\t\tthis.profile = this._stage.profile;\r\n\r\n\t\tthis._textureVOPool = new TextureVOPool(this._stage);\r\n\t}\r\n\r\n\tpublic getTextureVO(texture:TextureBase):TextureVOBase\r\n\t{\r\n\t\treturn this._textureVOPool.getItem(texture);\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies()\r\n\t{\r\n\t\tthis._pass._iIncludeDependencies(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method to create a concrete compiler object for this object\r\n\t *\r\n\t * @param renderableClass\r\n\t * @param pass\r\n\t * @param stage\r\n\t * @returns {CompilerBase}\r\n\t */\r\n\tpublic createCompiler(renderableClass:IRenderableClass, pass:IPass):CompilerBase\r\n\t{\r\n\t\treturn new CompilerBase(renderableClass, pass, this);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears dependency counts for all registers. Called when recompiling a pass.\r\n\t */\r\n\tpublic reset()\r\n\t{\r\n\t\tthis.projectionDependencies = 0;\r\n\t\tthis.normalDependencies = 0;\r\n\t\tthis.colorDependencies = 0;\r\n\t\tthis.viewDirDependencies = 0;\r\n\t\tthis.uvDependencies = 0;\r\n\t\tthis.secondaryUVDependencies = 0;\r\n\t\tthis.globalPosDependencies = 0;\r\n\t\tthis.tangentDependencies = 0;\r\n\t\tthis.usesCommonData = false;\r\n\t\tthis.usesGlobalPosFragment = false;\r\n\t\tthis.usesLocalPosFragment = false;\r\n\t\tthis.usesFragmentAnimation = false;\r\n\t\tthis.usesTangentSpace = false;\r\n\t\tthis.outputsNormals = false;\r\n\t\tthis.outputsTangentNormals = false;\r\n\t}\r\n\r\n\tpublic pInitRegisterIndices()\r\n\t{\r\n\t\tthis.commonsDataIndex = -1;\r\n\t\tthis.cameraPositionIndex = -1;\r\n\t\tthis.uvBufferIndex = -1;\r\n\t\tthis.uvTransformIndex = -1;\r\n\t\tthis.colorTransformIndex = -1;\r\n\t\tthis.secondaryUVBufferIndex = -1;\r\n\t\tthis.normalBufferIndex = -1;\r\n\t\tthis.colorBufferIndex = -1;\r\n\t\tthis.tangentBufferIndex = -1;\r\n\t\tthis.sceneMatrixIndex = -1;\r\n\t\tthis.sceneNormalMatrixIndex = -1;\r\n\t\tthis.jointIndexIndex = -1;\r\n\t\tthis.jointWeightIndex = -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the unchanging constant data for this shader object.\r\n\t */\r\n\tpublic initConstantData(registerCache:ShaderRegisterCache, animatableAttributes:Array<string>, animationTargetRegisters:Array<string>, uvSource:string, uvTarget:string)\r\n\t{\r\n\t\t//Updates the amount of used register indices.\r\n\t\tthis.numUsedVertexConstants = registerCache.numUsedVertexConstants;\r\n\t\tthis.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;\r\n\t\tthis.numUsedStreams = registerCache.numUsedStreams;\r\n\t\tthis.numUsedTextures = registerCache.numUsedTextures;\r\n\t\tthis.numUsedVaryings = registerCache.numUsedVaryings;\r\n\t\tthis.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;\r\n\r\n\t\tthis.animatableAttributes = animatableAttributes;\r\n\t\tthis.animationTargetRegisters = animationTargetRegisters;\r\n\t\tthis.uvSource = uvSource;\r\n\t\tthis.uvTarget = uvTarget;\r\n\r\n\t\tthis.vertexConstantData = new Float32Array(this.numUsedVertexConstants*4);\r\n\t\tthis.fragmentConstantData = new Float32Array(this.numUsedFragmentConstants*4);\r\n\r\n\t\t//Initializes commonly required constant values.\r\n\t\tif (this.commonsDataIndex >= 0) {\r\n\t\t\tthis.fragmentConstantData[this.commonsDataIndex] = .5;\r\n\t\t\tthis.fragmentConstantData[this.commonsDataIndex + 1] = 0;\r\n\t\t\tthis.fragmentConstantData[this.commonsDataIndex + 2] = 1/255;\r\n\t\t\tthis.fragmentConstantData[this.commonsDataIndex + 3] = 1;\r\n\t\t}\r\n\r\n\t\t//Initializes the default UV transformation matrix.\r\n\t\tif (this.uvTransformIndex >= 0) {\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex] = 1;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 2] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = 1;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 6] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = 0;\r\n\t\t}\r\n\r\n\t\t//Initializes the default colorTransform.\r\n\t\tif (this.colorTransformIndex >= 0) {\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex] = 1;\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 1] = 1;\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 2] = 1;\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 3] = 1;\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 4] = 0;\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 5] = 0;\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 6] = 0;\r\n\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 7] = 0;\r\n\t\t}\r\n\t\tif (this.cameraPositionIndex >= 0)\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 3] = 1;\r\n\t}\r\n\r\n\t/**\r\n\t * The blend mode to use when drawing this renderable. The following blend modes are supported:\r\n\t * <ul>\r\n\t * <li>BlendMode.NORMAL: No blending, unless the material inherently needs it</li>\r\n\t * <li>BlendMode.LAYER: Force blending. This will draw the object the same as NORMAL, but without writing depth writes.</li>\r\n\t * <li>BlendMode.MULTIPLY</li>\r\n\t * <li>BlendMode.ADD</li>\r\n\t * <li>BlendMode.ALPHA</li>\r\n\t * </ul>\r\n\t */\r\n\tpublic setBlendMode(value:string)\r\n\t{\r\n\t\tswitch (value) {\r\n\t\t\tcase BlendMode.NORMAL:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ONE;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ZERO;\r\n\t\t\t\tthis.usesBlending = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.LAYER:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.SOURCE_ALPHA;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA;\r\n\t\t\t\tthis.usesBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.MULTIPLY:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ZERO;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.SOURCE_COLOR;\r\n\t\t\t\tthis.usesBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.ADD:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.SOURCE_ALPHA;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ONE;\r\n\t\t\t\tthis.usesBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.ALPHA:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ZERO;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.SOURCE_ALPHA;\r\n\t\t\t\tthis.usesBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new ArgumentError(\"Unsupported blend mode!\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tif (this.usesAnimation)\r\n\t\t\t(<AnimationSetBase> this._pass.animationSet).activate(this, this._stage);\r\n\r\n\t\tthis._stage.context.setCulling(this.useBothSides? ContextGLTriangleFace.NONE : this._defaultCulling, camera.projection.coordinateSystem);\r\n\r\n\t\tif (!this.usesTangentSpace && this.cameraPositionIndex >= 0) {\r\n\t\t\tvar pos:Vector3D = camera.scenePosition;\r\n\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex] = pos.x;\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 1] = pos.y;\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 2] = pos.z;\r\n\t\t}\r\n\r\n\t\tthis._stage.context.setDepthTest(( this.writeDepth && !this.usesBlending ), this.depthCompareMode);\r\n\r\n\t\tif (this.usesBlending)\r\n\t\t\tthis._stage.context.setBlendFactors(this._blendFactorSource, this._blendFactorDest);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iDeactivate()\r\n\t{\r\n\t\tif (this.usesAnimation)\r\n\t\t\t(<AnimationSetBase> this._pass.animationSet).deactivate(this, this._stage);\r\n\r\n\t\t//For the love of god don't remove this if you want your multi-material shadows to not flicker like shit\r\n\t\tthis._stage.context.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param renderable\r\n\t * @param stage\r\n\t * @param camera\r\n\t */\r\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tif (renderable.renderableOwner.animator)\r\n\t\t\t(<AnimatorBase> renderable.renderableOwner.animator).setRenderState(this, renderable, this._stage, camera, this.numUsedVertexConstants, this.numUsedStreams);\r\n\r\n\t\tif (this.usesUVTransform) {\r\n\t\t\tvar uvTransform:Matrix = renderable.renderableOwner.uvTransform.matrix;\r\n\r\n\t\t\tif (uvTransform) {\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex] = uvTransform.a;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = uvTransform.b;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = uvTransform.tx;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = uvTransform.c;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = uvTransform.d;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = uvTransform.ty;\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex] = 1;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = 0;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = 0;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = 0;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = 1;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.usesColorTransform) {\r\n\r\n\t\t\tvar colorTransform:ColorTransform = renderable.sourceEntity._iAssignedColorTransform();\r\n\r\n\t\t\tif (colorTransform) {\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex] = colorTransform.redMultiplier;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 1] = colorTransform.greenMultiplier;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 2] = colorTransform.blueMultiplier;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 3] = colorTransform.alphaMultiplier;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 4] = colorTransform.redOffset/255;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 5] = colorTransform.greenOffset/255;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 6] = colorTransform.blueOffset/255;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 7] = colorTransform.alphaOffset/255;\r\n\t\t\t} else {\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex] = 1;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 1] = 1;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 2] = 1;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 3] = 1;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 4] = 0;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 5] = 0;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 6] = 0;\r\n\t\t\t\tthis.fragmentConstantData[this.colorTransformIndex + 7] = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.sceneNormalMatrixIndex >= 0)\r\n\t\t\trenderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData, this.sceneNormalMatrixIndex, false);\r\n\r\n\t\tif (this.usesTangentSpace && this.cameraPositionIndex >= 0) {\r\n\r\n\t\t\trenderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);\r\n\t\t\tvar pos:Vector3D = camera.scenePosition;\r\n\t\t\tvar x:number = pos.x;\r\n\t\t\tvar y:number = pos.y;\r\n\t\t\tvar z:number = pos.z;\r\n\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z + this._pInverseSceneMatrix[12];\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 1] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z + this._pInverseSceneMatrix[13];\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 2] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z + this._pInverseSceneMatrix[14];\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic invalidateProgram()\r\n\t{\r\n\t\tthis._invalidProgram = true;\r\n\t}\r\n\r\n\tpublic invalidateShader()\r\n\t{\r\n\t\tthis._invalidShader = true;\r\n\t\tthis._invalidProgram = true;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tif (this.texture) {\r\n\t\t\tthis.texture.dispose();\r\n\t\t\tthis.texture = null;\r\n\t\t}\r\n\r\n\t\tthis._programData.dispose();\r\n\t\tthis._programData = null;\r\n\t}\r\n\r\n\tprivate _updateProgram()\r\n\t{\r\n\t\tthis._invalidProgram = false;\r\n\r\n\t\tvar compiler:CompilerBase;\r\n\r\n\t\tif (this._invalidShader) {\r\n\t\t\tthis._invalidShader = false;\r\n\r\n\t\t\tcompiler = this.createCompiler(this._renderableClass, this._pass);\r\n\t\t\tcompiler.compile();\r\n\t\t}\r\n\r\n\t\tthis._calcAnimationCode(compiler.shadedTarget);\r\n\r\n\t\tvar programData:ProgramData = this._stage.getProgramData(this._animationVertexCode + compiler.vertexCode, compiler.fragmentCode + this._animationFragmentCode + compiler.postAnimationFragmentCode);\r\n\r\n\t\t//check program data hasn't changed, keep count of program usages\r\n\t\tif (this._programData != programData) {\r\n\t\t\tif (this._programData)\r\n\t\t\t\tthis._programData.dispose();\r\n\r\n\t\t\tthis._programData = programData;\r\n\r\n\t\t\tprogramData.usages++;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _calcAnimationCode(shadedTarget:string)\r\n\t{\r\n\t\t//reset code\r\n\t\tthis._animationVertexCode = \"\";\r\n\t\tthis._animationFragmentCode = \"\";\r\n\r\n\t\t//check to see if GPU animation is used\r\n\t\tif (this.usesAnimation) {\r\n\r\n\t\t\tvar animationSet:AnimationSetBase = <AnimationSetBase> this._pass.animationSet;\r\n\r\n\t\t\tthis._animationVertexCode += animationSet.getAGALVertexCode(this);\r\n\r\n\t\t\tif (this.uvDependencies > 0 && !this.usesUVTransform)\r\n\t\t\t\tthis._animationVertexCode += animationSet.getAGALUVCode(this);\r\n\r\n\t\t\tif (this.usesFragmentAnimation)\r\n\t\t\t\tthis._animationFragmentCode += animationSet.getAGALFragmentCode(this, shadedTarget);\r\n\r\n\t\t\tanimationSet.doneAGALCode(this);\r\n\r\n\t\t} else {\r\n\t\t\t// simply write attributes to targets, do not animate them\r\n\t\t\t// projection will pick up on targets[0] to do the projection\r\n\t\t\tvar len:number = this.animatableAttributes.length;\r\n\t\t\tfor (var i:number = 0; i < len; ++i)\r\n\t\t\t\tthis._animationVertexCode += \"mov \" + this.animationTargetRegisters[i] + \", \" + this.animatableAttributes[i] + \"\\n\";\r\n\r\n\t\t\tif (this.uvDependencies > 0 && !this.usesUVTransform)\r\n\t\t\t\tthis._animationVertexCode += \"mov \" + this.uvTarget + \",\" + this.uvSource + \"\\n\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ShaderBase;",
    "import RegisterPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/RegisterPool\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n/**\r\n * ShaderRegister Cache provides the usage management system for all registers during shading compilers.\r\n */\r\nclass ShaderRegisterCache\r\n{\r\n\tprivate _fragmentTempCache:RegisterPool;\r\n\tprivate _vertexTempCache:RegisterPool;\r\n\tprivate _varyingCache:RegisterPool;\r\n\tprivate _fragmentConstantsCache:RegisterPool;\r\n\tprivate _vertexConstantsCache:RegisterPool;\r\n\tprivate _textureCache:RegisterPool;\r\n\tprivate _vertexAttributesCache:RegisterPool;\r\n\tprivate _vertexConstantOffset:number; //TODO: check if this should be initialised to 0\r\n\tprivate _vertexAttributesOffset:number;//TODO: check if this should be initialised to 0\r\n\tprivate _varyingsOffset:number;//TODO: check if this should be initialised to 0\r\n\tprivate _fragmentConstantOffset:number;//TODO: check if this should be initialised to 0\r\n\r\n\tprivate _fragmentOutputRegister:ShaderRegisterElement;\r\n\tprivate _vertexOutputRegister:ShaderRegisterElement;\r\n\tprivate _numUsedVertexConstants:number = 0;\r\n\tprivate _numUsedFragmentConstants:number = 0;\r\n\tprivate _numUsedStreams:number = 0;\r\n\tprivate _numUsedTextures:number = 0;\r\n\tprivate _numUsedVaryings:number = 0;\r\n\tprivate _profile:string;\r\n\r\n\t/**\r\n\t * Create a new ShaderRegisterCache object.\r\n\t *\r\n\t * @param profile The compatibility profile used by the renderer.\r\n\t */\r\n\tconstructor(profile:string)\r\n\t{\r\n\t\tthis._profile = profile;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets all registers.\r\n\t */\r\n\tpublic reset()\r\n\t{\r\n\t\tthis._fragmentTempCache = new RegisterPool(\"ft\", 8, false);\r\n\t\tthis._vertexTempCache = new RegisterPool(\"vt\", 8, false);\r\n\t\tthis._varyingCache = new RegisterPool(\"v\", 8);\r\n\t\tthis._textureCache = new RegisterPool(\"fs\", 8);\r\n\t\tthis._vertexAttributesCache = new RegisterPool(\"va\", 8);\r\n\t\tthis._fragmentConstantsCache = new RegisterPool(\"fc\", 28);\r\n\t\tthis._vertexConstantsCache = new RegisterPool(\"vc\", 128);\r\n\t\tthis._fragmentOutputRegister = new ShaderRegisterElement(\"oc\", -1);\r\n\t\tthis._vertexOutputRegister = new ShaderRegisterElement(\"op\", -1);\r\n\t\tthis._numUsedVertexConstants = 0;\r\n\t\tthis._numUsedStreams = 0;\r\n\t\tthis._numUsedTextures = 0;\r\n\t\tthis._numUsedVaryings = 0;\r\n\t\tthis._numUsedFragmentConstants = 0;\r\n\r\n\t\tvar i:number;\r\n\r\n\t\tfor (i = 0; i < this._vertexAttributesOffset; ++i)\r\n\t\t\tthis.getFreeVertexAttribute();\r\n\r\n\t\tfor (i = 0; i < this._vertexConstantOffset; ++i)\r\n\t\t\tthis.getFreeVertexConstant();\r\n\r\n\t\tfor (i = 0; i < this._varyingsOffset; ++i)\r\n\t\t\tthis.getFreeVarying();\r\n\r\n\t\tfor (i = 0; i < this._fragmentConstantOffset; ++i)\r\n\t\t\tthis.getFreeFragmentConstant();\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes all resources used.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._fragmentTempCache.dispose();\r\n\t\tthis._vertexTempCache.dispose();\r\n\t\tthis._varyingCache.dispose();\r\n\t\tthis._fragmentConstantsCache.dispose();\r\n\t\tthis._vertexAttributesCache.dispose();\r\n\r\n\t\tthis._fragmentTempCache = null;\r\n\t\tthis._vertexTempCache = null;\r\n\t\tthis._varyingCache = null;\r\n\t\tthis._fragmentConstantsCache = null;\r\n\t\tthis._vertexAttributesCache = null;\r\n\t\tthis._fragmentOutputRegister = null;\r\n\t\tthis._vertexOutputRegister = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a fragment temporary register as used, so it cannot be retrieved. The register won't be able to be used until removeUsage\r\n\t * has been called usageCount times again.\r\n\t * @param register The register to mark as used.\r\n\t * @param usageCount The amount of usages to add.\r\n\t */\r\n\tpublic addFragmentTempUsages(register:ShaderRegisterElement, usageCount:number)\r\n\t{\r\n\t\tthis._fragmentTempCache.addUsage(register, usageCount);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a usage from a fragment temporary register. When usages reach 0, the register is freed again.\r\n\t * @param register The register for which to remove a usage.\r\n\t */\r\n\tpublic removeFragmentTempUsage(register:ShaderRegisterElement)\r\n\t{\r\n\t\tthis._fragmentTempCache.removeUsage(register);\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a vertex temporary register as used, so it cannot be retrieved. The register won't be able to be used\r\n\t * until removeUsage has been called usageCount times again.\r\n\t * @param register The register to mark as used.\r\n\t * @param usageCount The amount of usages to add.\r\n\t */\r\n\tpublic addVertexTempUsages(register:ShaderRegisterElement, usageCount:number)\r\n\t{\r\n\t\tthis._vertexTempCache.addUsage(register, usageCount);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a usage from a vertex temporary register. When usages reach 0, the register is freed again.\r\n\t * @param register The register for which to remove a usage.\r\n\t */\r\n\tpublic removeVertexTempUsage(register:ShaderRegisterElement)\r\n\t{\r\n\t\tthis._vertexTempCache.removeUsage(register);\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an entire fragment temporary register that's still available. The register won't be able to be used until removeUsage\r\n\t * has been called usageCount times again.\r\n\t */\r\n\tpublic getFreeFragmentVectorTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._fragmentTempCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve a single component from a fragment temporary register that's still available.\r\n\t */\r\n\tpublic getFreeFragmentSingleTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._fragmentTempCache.requestFreeRegComponent();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available varying register\r\n\t */\r\n\tpublic getFreeVarying():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedVaryings;\r\n\t\treturn this._varyingCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available fragment constant register\r\n\t */\r\n\tpublic getFreeFragmentConstant():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedFragmentConstants;\r\n\t\treturn this._fragmentConstantsCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available vertex constant register\r\n\t */\r\n\tpublic getFreeVertexConstant():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedVertexConstants;\r\n\t\treturn this._vertexConstantsCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an entire vertex temporary register that's still available.\r\n\t */\r\n\tpublic getFreeVertexVectorTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._vertexTempCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve a single component from a vertex temporary register that's still available.\r\n\t */\r\n\tpublic getFreeVertexSingleTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._vertexTempCache.requestFreeRegComponent();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available vertex attribute register\r\n\t */\r\n\tpublic getFreeVertexAttribute():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedStreams;\r\n\t\treturn this._vertexAttributesCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available texture register\r\n\t */\r\n\tpublic getFreeTextureReg():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedTextures;\r\n\t\treturn this._textureCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve vertex constants.\r\n\t */\r\n\tpublic get vertexConstantOffset():number\r\n\t{\r\n\t\treturn this._vertexConstantOffset;\r\n\t}\r\n\r\n\tpublic set vertexConstantOffset(vertexConstantOffset:number)\r\n\t{\r\n\t\tthis._vertexConstantOffset = vertexConstantOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve vertex attributes.\r\n\t */\r\n\tpublic get vertexAttributesOffset():number\r\n\t{\r\n\t\treturn this._vertexAttributesOffset;\r\n\t}\r\n\r\n\tpublic set vertexAttributesOffset(value:number)\r\n\t{\r\n\t\tthis._vertexAttributesOffset = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve varying registers.\r\n\t */\r\n\tpublic get varyingsOffset():number\r\n\t{\r\n\t\treturn this._varyingsOffset;\r\n\t}\r\n\r\n\tpublic set varyingsOffset(value:number)\r\n\t{\r\n\t\tthis._varyingsOffset = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve fragment constants.\r\n\t */\r\n\tpublic get fragmentConstantOffset():number\r\n\t{\r\n\t\treturn this._fragmentConstantOffset;\r\n\t}\r\n\r\n\tpublic set fragmentConstantOffset(value:number)\r\n\t{\r\n\t\tthis._fragmentConstantOffset = value;\r\n\t}\r\n\r\n\t/**\r\n\t * The fragment output register.\r\n\t */\r\n\tpublic get fragmentOutputRegister():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._fragmentOutputRegister;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used vertex constant registers.\r\n\t */\r\n\tpublic get numUsedVertexConstants():number\r\n\t{\r\n\t\treturn this._numUsedVertexConstants;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used fragment constant registers.\r\n\t */\r\n\tpublic get numUsedFragmentConstants():number\r\n\t{\r\n\t\treturn this._numUsedFragmentConstants;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used vertex streams.\r\n\t */\r\n\tpublic get numUsedStreams():number\r\n\t{\r\n\t\treturn this._numUsedStreams;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used texture slots.\r\n\t */\r\n\tpublic get numUsedTextures():number\r\n\t{\r\n\t\treturn this._numUsedTextures;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used varying registers.\r\n\t */\r\n\tpublic get numUsedVaryings():number\r\n\t{\r\n\t\treturn this._numUsedVaryings;\r\n\t}\r\n}\r\n\r\nexport = ShaderRegisterCache;",
    "import ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n/**\r\n * ShaderRegisterData contains the \"named\" registers, generated by the compiler and to be passed on to the methods.\r\n */\r\nclass ShaderRegisterData\r\n{\r\n\tpublic normalVarying:ShaderRegisterElement;\r\n\tpublic colorVarying:ShaderRegisterElement\r\n\tpublic tangentVarying:ShaderRegisterElement;\r\n\tpublic bitangentVarying:ShaderRegisterElement;\r\n\tpublic uvVarying:ShaderRegisterElement;\r\n\tpublic secondaryUVVarying:ShaderRegisterElement;\r\n\tpublic viewDirVarying:ShaderRegisterElement;\r\n\tpublic shadowTarget:ShaderRegisterElement;\r\n\tpublic shadedTarget:ShaderRegisterElement;\r\n\tpublic globalPositionVertex:ShaderRegisterElement;\r\n\tpublic globalPositionVarying:ShaderRegisterElement;\r\n    public localPositionVarying:ShaderRegisterElement;\r\n\tpublic localPosition:ShaderRegisterElement;\r\n\tpublic normalInput:ShaderRegisterElement;\r\n\tpublic colorInput:ShaderRegisterElement;\r\n\tpublic tangentInput:ShaderRegisterElement;\r\n\tpublic animatedNormal:ShaderRegisterElement;\r\n\tpublic animatedTangent:ShaderRegisterElement;\r\n\tpublic commons:ShaderRegisterElement;\r\n\tpublic projectionFragment:ShaderRegisterElement;\r\n\tpublic normalFragment:ShaderRegisterElement;\r\n\tpublic viewDirFragment:ShaderRegisterElement;\r\n\tpublic bitangent:ShaderRegisterElement;\r\n\r\n\tconstructor()\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = ShaderRegisterData;",
    "/**\r\n * A single register element (an entire register or a single register's component) used by the RegisterPool.\r\n */\r\nclass ShaderRegisterElement\r\n{\r\n\tprivate _regName:string;\r\n\tprivate _index:number;\r\n\tprivate _toStr:string;\r\n\r\n\tprivate static COMPONENTS = [\"x\", \"y\", \"z\", \"w\"];\r\n\r\n\tpublic _component:number;\r\n\r\n\t/**\r\n\t * Creates a new ShaderRegisterElement object.\r\n\t *\r\n\t * @param regName The name of the register.\r\n\t * @param index The index of the register.\r\n\t * @param component The register's component, if not the entire register is represented.\r\n\t */\r\n\tconstructor(regName:string, index:number, component:number = -1)\r\n\t{\r\n\t\tthis._component = component;\r\n\t\tthis._regName = regName;\r\n\t\tthis._index = index;\r\n\r\n\t\tthis._toStr = this._regName;\r\n\r\n\t\tif (this._index >= 0)\r\n\t\t\tthis._toStr += this._index;\r\n\r\n\t\tif (component > -1)\r\n\t\t\tthis._toStr += \".\" + ShaderRegisterElement.COMPONENTS[component];\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the register or the components AGAL string representation.\r\n\t */\r\n\tpublic toString():string\r\n\t{\r\n\t\treturn this._toStr;\r\n\t}\r\n\r\n\t/**\r\n\t * The register's name.\r\n\t */\r\n\tpublic get regName():string\r\n\t{\r\n\t\treturn this._regName;\r\n\t}\r\n\r\n\t/**\r\n\t * The register's index.\r\n\t */\r\n\tpublic get index():number\r\n\t{\r\n\t\treturn this._index;\r\n\t}\r\n}\r\n\r\nexport = ShaderRegisterElement;",
    "import RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/RenderableBase\");\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport IPass\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/IPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\n\r\n/**\r\n * CompilerBase is an abstract base class for shader compilers that use modular shader methods to assemble a\r\n * material. Concrete subclasses are used by the default materials.\r\n *\r\n * @see away.materials.ShadingMethodBase\r\n */\r\nclass CompilerBase\r\n{\r\n\tpublic _pShader:ShaderBase;\r\n\tpublic _pSharedRegisters:ShaderRegisterData;\r\n\tpublic _pRegisterCache:ShaderRegisterCache;\r\n\tpublic _pRenderableClass:IRenderableClass;\r\n\tpublic _pRenderPass:IPass;\r\n\r\n\tpublic _pVertexCode:string = ''; // Changed to emtpy string- AwayTS\r\n\tpublic _pFragmentCode:string = '';// Changed to emtpy string - AwayTS\r\n\tpublic _pPostAnimationFragmentCode:string = '';// Changed to emtpy string - AwayTS\r\n\r\n\t//The attributes that need to be animated by animators.\r\n\tpublic _pAnimatableAttributes:Array<string>;\r\n\r\n\t//The target registers for animated properties, written to by the animators.\r\n\tpublic _pAnimationTargetRegisters:Array<string>;\r\n\r\n\t//The target register to place the animated UV coordinate.\r\n\tprivate _uvTarget:string;\r\n\r\n\t//The souce register providing the UV coordinate to animate.\r\n\tprivate _uvSource:string;\r\n\r\n\t/**\r\n\t * Creates a new CompilerBase object.\r\n\t * @param profile The compatibility profile of the renderer.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, pass:IPass, shader:ShaderBase)\r\n\t{\r\n\t\tthis._pRenderableClass = renderableClass;\r\n\t\tthis._pRenderPass = pass;\r\n\t\tthis._pShader = shader;\r\n\r\n\t\tthis._pSharedRegisters = new ShaderRegisterData();\r\n\r\n\t\tthis._pRegisterCache = new ShaderRegisterCache(shader.profile);\r\n\t\tthis._pRegisterCache.vertexAttributesOffset = renderableClass.vertexAttributesOffset;\r\n\t\tthis._pRegisterCache.reset();\r\n\t}\r\n\r\n\t/**\r\n\t * Compiles the code after all setup on the compiler has finished.\r\n\t */\r\n\tpublic compile()\r\n\t{\r\n\t\tthis._pShader.reset();\r\n\r\n\t\tthis._pShader._iIncludeDependencies();\r\n\r\n\t\tthis.pInitRegisterIndices();\r\n\r\n\t\tthis.pCompileDependencies();\r\n\r\n\t\t//compile custom vertex & fragment codes\r\n\t\tthis._pVertexCode += this._pRenderPass._iGetVertexCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pPostAnimationFragmentCode += this._pRenderPass._iGetFragmentCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\tif (this._pShader.usesColorTransform)\r\n\t\t\tthis.compileColorTransformCode();\r\n\t\telse\r\n\t\t\tthis._pShader.colorTransformIndex = -1;\r\n\r\n\t\t//assign the final output color to the output register\r\n\t\tthis._pPostAnimationFragmentCode += \"mov \" + this._pRegisterCache.fragmentOutputRegister + \", \" + this._pSharedRegisters.shadedTarget + \"\\n\";\r\n\t\tthis._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget);\r\n\r\n\t\t//initialise the required shader constants\r\n\t\tthis._pShader.initConstantData(this._pRegisterCache, this._pAnimatableAttributes, this._pAnimationTargetRegisters, this._uvSource, this._uvTarget);\r\n\t\tthis._pRenderPass._iInitConstantData(this._pShader);\r\n\t}\r\n\t/**\r\n\t * Calculate the transformed colours\r\n\t */\r\n\tprivate compileColorTransformCode()\r\n\t{\r\n\t\t// rm, gm, bm, am - multiplier\r\n\t\t// ro, go, bo, ao - offset\r\n\t\tvar ct1:ShaderRegisterElement = this._pRegisterCache.getFreeFragmentConstant();\r\n\t\tvar ct2:ShaderRegisterElement = this._pRegisterCache.getFreeFragmentConstant();\r\n\t\tthis._pShader.colorTransformIndex = ct1.index*4;\r\n\t\tthis._pPostAnimationFragmentCode += \"mul \" + this._pSharedRegisters.shadedTarget + \", \" + this._pSharedRegisters.shadedTarget + \", \" + ct1 + \"\\n\";\r\n\t\tthis._pPostAnimationFragmentCode += \"add \" + this._pSharedRegisters.shadedTarget + \", \" + this._pSharedRegisters.shadedTarget + \", \" + ct2 + \"\\n\";\r\n\t}\r\n\t/**\r\n\t * Compile the code for the methods.\r\n\t */\r\n\tpublic pCompileDependencies()\r\n\t{\r\n\t\tthis._pSharedRegisters.shadedTarget = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget, 1);\r\n\r\n\t\t//compile the world-space position if required\r\n\t\tif (this._pShader.globalPosDependencies > 0)\r\n\t\t\tthis.compileGlobalPositionCode();\r\n\r\n        //compile the local-space position if required\r\n        if (this._pShader.usesLocalPosFragment)\r\n            this.compileLocalPositionCode();\r\n\r\n\t\t//Calculate the (possibly animated) UV coordinates.\r\n\t\tif (this._pShader.uvDependencies > 0)\r\n\t\t\tthis.compileUVCode();\r\n\r\n\t\tif (this._pShader.secondaryUVDependencies > 0)\r\n\t\t\tthis.compileSecondaryUVCode();\r\n\r\n\t\tif (this._pShader.normalDependencies > 0)\r\n\t\t\tthis.compileNormalCode();\r\n\r\n\t\tif (this._pShader.viewDirDependencies > 0)\r\n\t\t\tthis.compileViewDirCode();\r\n\r\n\t\t//collect code from material\r\n\t\tthis._pVertexCode += this._pRenderableClass._iGetVertexCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pFragmentCode += this._pRenderableClass._iGetFragmentCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t//collect code from pass\r\n\t\tthis._pVertexCode += this._pRenderPass._iGetPreLightingVertexCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pFragmentCode += this._pRenderPass._iGetPreLightingFragmentCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\t}\r\n\r\n\tprivate compileGlobalPositionCode()\r\n\t{\r\n\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex = this._pRegisterCache.getFreeVertexVectorTemp(), this._pShader.globalPosDependencies);\r\n\r\n\t\tvar sceneMatrixReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\tthis._pShader.sceneMatrixIndex = sceneMatrixReg.index*4;\r\n\r\n\t\tthis._pVertexCode += \"m44 \" + this._pSharedRegisters.globalPositionVertex + \", \" + this._pSharedRegisters.localPosition + \", \" + sceneMatrixReg + \"\\n\";\r\n\r\n\t\tif (this._pShader.usesGlobalPosFragment) {\r\n\t\t\tthis._pSharedRegisters.globalPositionVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.globalPositionVarying + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\r\n\t\t}\r\n\t}\r\n    private compileLocalPositionCode()\r\n    {\r\n        this._pSharedRegisters.localPositionVarying = this._pRegisterCache.getFreeVarying();\r\n        this._pVertexCode += \"mov \" + this._pSharedRegisters.localPositionVarying + \", \" + this._pSharedRegisters.localPosition + \"\\n\";\r\n    }\r\n\t/**\r\n\t * Calculate the (possibly animated) UV coordinates.\r\n\t */\r\n\tprivate compileUVCode()\r\n\t{\r\n\t\tvar uvAttributeReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\tthis._pShader.uvBufferIndex = uvAttributeReg.index;\r\n\r\n\t\tvar varying:ShaderRegisterElement = this._pSharedRegisters.uvVarying = this._pRegisterCache.getFreeVarying();\r\n\r\n\t\tif (this._pShader.usesUVTransform) {\r\n\t\t\t// a, b, 0, tx\r\n\t\t\t// c, d, 0, ty\r\n\t\t\tvar uvTransform1:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tvar uvTransform2:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tthis._pShader.uvTransformIndex = uvTransform1.index*4;\r\n\r\n\t\t\tthis._pVertexCode += \"dp4 \" + varying + \".x, \" + uvAttributeReg + \", \" + uvTransform1 + \"\\n\" +\r\n\t\t\t\t\t\t\t\t \"dp4 \" + varying + \".y, \" + uvAttributeReg + \", \" + uvTransform2 + \"\\n\" +\r\n\t\t\t\t\t\t\t\t \"mov \" + varying + \".zw, \" + uvAttributeReg + \".zw \\n\";\r\n\t\t} else {\r\n\t\t\tthis._pShader.uvTransformIndex = -1;\r\n\t\t\tthis._uvTarget = varying.toString();\r\n\t\t\tthis._uvSource = uvAttributeReg.toString();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Provide the secondary UV coordinates.\r\n\t */\r\n\tprivate compileSecondaryUVCode()\r\n\t{\r\n\t\tvar uvAttributeReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\tthis._pShader.secondaryUVBufferIndex = uvAttributeReg.index;\r\n\t\tthis._pSharedRegisters.secondaryUVVarying = this._pRegisterCache.getFreeVarying();\r\n\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.secondaryUVVarying + \", \" + uvAttributeReg + \"\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the view direction.\r\n\t */\r\n\tpublic compileViewDirCode()\r\n\t{\r\n\t\tvar cameraPositionReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pSharedRegisters.viewDirVarying = this._pRegisterCache.getFreeVarying();\r\n\t\tthis._pSharedRegisters.viewDirFragment = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment, this._pShader.viewDirDependencies);\r\n\r\n\t\tthis._pShader.cameraPositionIndex = cameraPositionReg.index*4;\r\n\r\n\t\tif (this._pShader.usesTangentSpace) {\r\n\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tthis._pVertexCode += \"sub \" + temp + \", \" + cameraPositionReg + \", \" + this._pSharedRegisters.localPosition + \"\\n\" +\r\n\t\t\t\t\"m33 \" + this._pSharedRegisters.viewDirVarying + \".xyz, \" + temp + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\"mov \" + this._pSharedRegisters.viewDirVarying + \".w, \" + this._pSharedRegisters.localPosition + \".w\\n\";\r\n\t\t} else {\r\n\t\t\tthis._pVertexCode += \"sub \" + this._pSharedRegisters.viewDirVarying + \", \" + cameraPositionReg + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\r\n\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);\r\n\t\t}\r\n\r\n\t\t//TODO is this required in all cases? (re: distancemappass)\r\n\t\tthis._pFragmentCode += \"nrm \" + this._pSharedRegisters.viewDirFragment + \".xyz, \" + this._pSharedRegisters.viewDirVarying + \"\\n\" +\r\n\t\t\t\"mov \" + this._pSharedRegisters.viewDirFragment + \".w,   \" + this._pSharedRegisters.viewDirVarying + \".w\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the normal.\r\n\t */\r\n\tpublic compileNormalCode()\r\n\t{\r\n\t\tthis._pSharedRegisters.normalFragment = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment, this._pShader.normalDependencies);\r\n\r\n\t\t//simple normal aquisition if no tangent space is being used\r\n\t\tif (this._pShader.outputsNormals && !this._pShader.outputsTangentNormals) {\r\n\t\t\tthis._pVertexCode += this._pRenderPass._iGetNormalVertexCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar normalMatrix:Array<ShaderRegisterElement>;\r\n\r\n\t\tif (!this._pShader.outputsNormals || !this._pShader.usesTangentSpace) {\r\n\t\t\tnormalMatrix = new Array<ShaderRegisterElement>(3);\r\n\t\t\tnormalMatrix[0] = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tnormalMatrix[1] = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tnormalMatrix[2] = this._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tthis._pShader.sceneNormalMatrixIndex = normalMatrix[0].index*4;\r\n\r\n\t\t\tthis._pSharedRegisters.normalVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t}\r\n\r\n\t\tif (this._pShader.outputsNormals) {\r\n\t\t\tif (this._pShader.usesTangentSpace) {\r\n\t\t\t\t// normalize normal + tangent vector and generate (approximated) bitangent used in m33 operation for view\r\n\t\t\t\tthis._pVertexCode += \"nrm \" + this._pSharedRegisters.animatedNormal + \".xyz, \" + this._pSharedRegisters.animatedNormal + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedTangent + \".xyz, \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"crs \" + this._pSharedRegisters.bitangent + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\";\r\n\r\n\t\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShader, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\t} else {\r\n\t\t\t\t//Compiles the vertex shader code for tangent-space normal maps.\r\n\t\t\t\tthis._pSharedRegisters.tangentVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tthis._pSharedRegisters.bitangentVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\t\tthis._pVertexCode += \"m33 \" + temp + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedNormal + \".xyz, \" + temp + \"\\n\" +\r\n\t\t\t\t\t\"m33 \" + temp + \".xyz, \" + this._pSharedRegisters.animatedTangent + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedTangent + \".xyz, \" + temp + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".x  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".x  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".y  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".y  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".z  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".z  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\r\n\t\t\t\t\t\"crs \" + temp + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".y, \" + temp + \".x    \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".y, \" + temp + \".y  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".y, \" + temp + \".z    \\n\";\r\n\r\n\t\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);\r\n\r\n\t\t\t\t//Compiles the fragment shader code for tangent-space normal maps.\r\n\t\t\t\tvar t:ShaderRegisterElement;\r\n\t\t\t\tvar b:ShaderRegisterElement;\r\n\t\t\t\tvar n:ShaderRegisterElement;\r\n\r\n\t\t\t\tt = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(t, 1);\r\n\t\t\t\tb = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(b, 1);\r\n\t\t\t\tn = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(n, 1);\r\n\r\n\t\t\t\tthis._pFragmentCode += \"nrm \" + t + \".xyz, \" + this._pSharedRegisters.tangentVarying + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + t + \".w, \" + this._pSharedRegisters.tangentVarying + \".w\t\\n\" +\r\n\t\t\t\t\t\"nrm \" + b + \".xyz, \" + this._pSharedRegisters.bitangentVarying + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + n + \".xyz, \" + this._pSharedRegisters.normalVarying + \"\\n\";\r\n\r\n\t\t\t\t//compile custom fragment code for normal calcs\r\n\t\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShader, this._pRegisterCache, this._pSharedRegisters) +\r\n\t\t\t\t\t\"m33 \" + this._pSharedRegisters.normalFragment + \".xyz, \" + this._pSharedRegisters.normalFragment + \", \" + t + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalFragment + \".w, \" + this._pSharedRegisters.normalVarying + \".w\\n\";\r\n\r\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(b);\r\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(t);\r\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(n);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// no output, world space is enough\r\n\t\t\tthis._pVertexCode += \"m33 \" + this._pSharedRegisters.normalVarying + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".w, \" + this._pSharedRegisters.animatedNormal + \".w\\n\";\r\n\r\n\t\t\tthis._pFragmentCode += \"nrm \" + this._pSharedRegisters.normalFragment + \".xyz, \" + this._pSharedRegisters.normalVarying + \"\\n\" +\r\n\t\t\t\t\"mov \" + this._pSharedRegisters.normalFragment + \".w, \" + this._pSharedRegisters.normalVarying + \".w\\n\";\r\n\r\n\t\t\tif (this._pShader.tangentDependencies > 0) {\r\n\t\t\t\tthis._pSharedRegisters.tangentVarying = this._pRegisterCache.getFreeVarying();\r\n\r\n\t\t\t\tthis._pVertexCode += \"m33 \" + this._pSharedRegisters.tangentVarying + \".xyz, \" + this._pSharedRegisters.animatedTangent + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".w, \" + this._pSharedRegisters.animatedTangent + \".w\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this._pShader.usesTangentSpace)\r\n\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal);\r\n\t}\r\n\r\n\t/**\r\n\t * Reset all the indices to \"unused\".\r\n\t */\r\n\tpublic pInitRegisterIndices()\r\n\t{\r\n\t\tthis._pShader.pInitRegisterIndices();\r\n\r\n\t\tthis._pAnimatableAttributes = new Array<string>(\"va0\");\r\n\t\tthis._pAnimationTargetRegisters = new Array<string>(\"vt0\");\r\n\t\tthis._pVertexCode = \"\";\r\n\t\tthis._pFragmentCode = \"\";\r\n\t\tthis._pPostAnimationFragmentCode = \"\";\r\n\r\n\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition = this._pRegisterCache.getFreeVertexVectorTemp(), 1);\r\n\r\n\t\t//create commonly shared constant registers\r\n\t\tif (this._pShader.usesCommonData || this._pShader.normalDependencies > 0) {\r\n\t\t\tthis._pSharedRegisters.commons = this._pRegisterCache.getFreeFragmentConstant();\r\n\t\t\tthis._pShader.commonsDataIndex = this._pSharedRegisters.commons.index*4;\r\n\t\t}\r\n\r\n\t\t//Creates the registers to contain the tangent data.\r\n\t\t// need to be created FIRST and in this order (for when using tangent space)\r\n\t\tif (this._pShader.tangentDependencies > 0 || this._pShader.outputsNormals) {\r\n\t\t\tthis._pSharedRegisters.tangentInput = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\t\tthis._pShader.tangentBufferIndex = this._pSharedRegisters.tangentInput.index;\r\n\r\n\t\t\tthis._pSharedRegisters.animatedTangent = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent, 1);\r\n\r\n\t\t\tif (this._pShader.usesTangentSpace) {\r\n\t\t\t\tthis._pSharedRegisters.bitangent = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent, 1);\r\n\t\t\t}\r\n\r\n\t\t\tthis._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString());\r\n\t\t\tthis._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString());\r\n\t\t}\r\n\r\n\t\tif (this._pShader.normalDependencies > 0) {\r\n\t\t\tthis._pSharedRegisters.normalInput = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\t\tthis._pShader.normalBufferIndex = this._pSharedRegisters.normalInput.index;\r\n\r\n\t\t\tthis._pSharedRegisters.animatedNormal = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal, 1);\r\n\r\n\t\t\tthis._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString());\r\n\t\t\tthis._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString());\r\n\t\t}\r\n\r\n\t\tif (this._pShader.colorDependencies > 0) {\r\n\t\t\tthis._pSharedRegisters.colorInput = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\t\tthis._pShader.colorBufferIndex = this._pSharedRegisters.colorInput.index;\r\n\r\n\t\t\tthis._pSharedRegisters.colorVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.colorVarying + \", \" + this._pSharedRegisters.colorInput + \"\\n\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes all resources used by the compiler.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pRegisterCache.dispose();\r\n\t\tthis._pRegisterCache = null;\r\n\t\tthis._pSharedRegisters = null;\r\n\t}\r\n\r\n\t/**\r\n\t * The generated vertex code.\r\n\t */\r\n\tpublic get vertexCode():string\r\n\t{\r\n\t\treturn this._pVertexCode;\r\n\t}\r\n\r\n\t/**\r\n\t * The generated fragment code.\r\n\t */\r\n\tpublic get fragmentCode():string\r\n\t{\r\n\t\treturn this._pFragmentCode;\r\n\t}\r\n\r\n\t/**\r\n\t * The generated fragment code.\r\n\t */\r\n\tpublic get postAnimationFragmentCode():string\r\n\t{\r\n\t\treturn this._pPostAnimationFragmentCode;\r\n\t}\r\n\r\n\t/**\r\n\t * The register name containing the final shaded colour.\r\n\t */\r\n\tpublic get shadedTarget():string\r\n\t{\r\n\t\treturn this._pSharedRegisters.shadedTarget.toString();\r\n\t}\r\n}\r\n\r\nexport = CompilerBase;",
    "import ContextGLProfile\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProfile\");\r\n\r\nimport LightingShader\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/LightingShader\");\r\nimport CompilerBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/compilers/CompilerBase\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport ILightingPass\t\t\t\t= require(\"awayjs-renderergl/lib/render/passes/ILightingPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/renderables/IRenderableClass\");\r\n\r\n/**\r\n * CompilerBase is an abstract base class for shader compilers that use modular shader methods to assemble a\r\n * material. Concrete subclasses are used by the default materials.\r\n *\r\n * @see away.materials.ShadingMethodBase\r\n */\r\nclass LightingCompiler extends CompilerBase\r\n{\r\n\tprivate _shaderLightingObject:LightingShader;\r\n\tprivate _lightingPass:ILightingPass;\r\n\tpublic _pointLightFragmentConstants:Array<ShaderRegisterElement>;\r\n\tpublic _pointLightVertexConstants:Array<ShaderRegisterElement>;\r\n\tpublic _dirLightFragmentConstants:Array<ShaderRegisterElement>;\r\n\tpublic _dirLightVertexConstants:Array<ShaderRegisterElement>;\r\n\r\n\tpublic _pNumProbeRegisters:number;\r\n\r\n\t/**\r\n\t * Creates a new CompilerBase object.\r\n\t * @param profile The compatibility profile of the renderer.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, lightingPass:ILightingPass, shaderLightingObject:LightingShader)\r\n\t{\r\n\t\tsuper(renderableClass, lightingPass, shaderLightingObject);\r\n\r\n\t\tthis._shaderLightingObject = shaderLightingObject;\r\n\t\tthis._lightingPass = lightingPass;\r\n\t}\r\n\r\n\t/**\r\n\t * Compile the code for the methods.\r\n\t */\r\n\tpublic pCompileDependencies()\r\n\t{\r\n\t\tsuper.pCompileDependencies();\r\n\r\n\t\t//compile the lighting code\r\n\t\tif (this._shaderLightingObject.usesShadows)\r\n\t\t\tthis.pCompileShadowCode();\r\n\r\n\t\tif (this._shaderLightingObject.usesLights) {\r\n\t\t\tthis.initLightRegisters();\r\n\t\t\tthis.compileLightCode();\r\n\t\t}\r\n\r\n\t\tif (this._shaderLightingObject.usesProbes)\r\n\t\t\tthis.compileLightProbeCode();\r\n\r\n\t\tthis._pVertexCode += this._lightingPass._iGetPostLightingVertexCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pFragmentCode += this._lightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t}\r\n\r\n\t/**\r\n\t * Provides the code to provide shadow mapping.\r\n\t */\r\n\tpublic pCompileShadowCode()\r\n\t{\r\n\t\tif (this._shaderLightingObject.normalDependencies > 0) {\r\n\t\t\tthis._pSharedRegisters.shadowTarget = this._pSharedRegisters.normalFragment;\r\n\t\t} else {\r\n\t\t\tthis._pSharedRegisters.shadowTarget = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget, 1);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes constant registers to contain light data.\r\n\t */\r\n\tprivate initLightRegisters()\r\n\t{\r\n\t\t// init these first so we're sure they're in sequence\r\n\t\tvar i:number, len:number;\r\n\r\n\t\tif (this._dirLightVertexConstants) {\r\n\t\t\tlen = this._dirLightVertexConstants.length;\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tthis._dirLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\t\tif (this._shaderLightingObject.lightVertexConstantIndex == -1)\r\n\t\t\t\t\tthis._shaderLightingObject.lightVertexConstantIndex = this._dirLightVertexConstants[i].index*4;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._pointLightVertexConstants) {\r\n\t\t\tlen = this._pointLightVertexConstants.length;\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tthis._pointLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\t\tif (this._shaderLightingObject.lightVertexConstantIndex == -1)\r\n\t\t\t\t\tthis._shaderLightingObject.lightVertexConstantIndex = this._pointLightVertexConstants[i].index*4;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlen = this._dirLightFragmentConstants.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._dirLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();\r\n\r\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\r\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = this._dirLightFragmentConstants[i].index*4;\r\n\t\t}\r\n\r\n\t\tlen = this._pointLightFragmentConstants.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._pointLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();\r\n\r\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\r\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = this._pointLightFragmentConstants[i].index*4;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Compiles the shading code for directional and point lights.\r\n\t */\r\n\tprivate compileLightCode()\r\n\t{\r\n\t\tvar diffuseColorReg:ShaderRegisterElement;\r\n\t\tvar specularColorReg:ShaderRegisterElement;\r\n\t\tvar lightPosReg:ShaderRegisterElement;\r\n\t\tvar lightDirReg:ShaderRegisterElement;\r\n\t\tvar vertexRegIndex:number = 0;\r\n\t\tvar fragmentRegIndex:number = 0;\r\n\t\tvar addSpec:boolean = this._shaderLightingObject.usesLightsForSpecular;\r\n\t\tvar addDiff:boolean = this._shaderLightingObject.usesLightsForDiffuse;\r\n\r\n\t\t//compile the shading code for directional lights.\r\n\t\tfor (var i:number = 0; i < this._shaderLightingObject.numDirectionalLights; ++i) {\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace) {\r\n\t\t\t\tlightDirReg = this._dirLightVertexConstants[vertexRegIndex++];\r\n\r\n\t\t\t\tvar lightVarying:ShaderRegisterElement = this._pRegisterCache.getFreeVarying();\r\n\r\n\t\t\t\tthis._pVertexCode += \"m33 \" + lightVarying + \".xyz, \" + lightDirReg + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightVarying + \".w, \" + lightDirReg + \".w\\n\";\r\n\r\n\t\t\t\tlightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addVertexTempUsages(lightDirReg, 1);\r\n\r\n\t\t\t\tthis._pFragmentCode += \"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightDirReg + \".w, \" + lightVarying + \".w\\n\";\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlightDirReg = this._dirLightFragmentConstants[fragmentRegIndex++];\r\n\t\t\t}\r\n\r\n\t\t\tdiffuseColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];\r\n\t\t\tspecularColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];\r\n\r\n\t\t\tif (addDiff)\r\n\t\t\t\tthis._pFragmentCode += this._lightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tif (addSpec)\r\n\t\t\t\tthis._pFragmentCode += this._lightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace)\r\n\t\t\t\tthis._pRegisterCache.removeVertexTempUsage(lightDirReg);\r\n\t\t}\r\n\r\n\t\tvertexRegIndex = 0;\r\n\t\tfragmentRegIndex = 0;\r\n\r\n\t\t//compile the shading code for point lights\r\n\t\tfor (var i:number = 0; i < this._shaderLightingObject.numPointLights; ++i) {\r\n\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment)\r\n\t\t\t\tlightPosReg = this._pointLightVertexConstants[vertexRegIndex++];\r\n\t\t\telse\r\n\t\t\t\tlightPosReg = this._pointLightFragmentConstants[fragmentRegIndex++];\r\n\r\n\t\t\tdiffuseColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];\r\n\t\t\tspecularColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];\r\n\r\n\t\t\tlightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\tthis._pRegisterCache.addFragmentTempUsages(lightDirReg, 1);\r\n\r\n\t\t\tvar lightVarying:ShaderRegisterElement;\r\n\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace) {\r\n\t\t\t\tlightVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t\tthis._pVertexCode += \"sub \" + temp + \", \" + lightPosReg + \", \" + this._pSharedRegisters.localPosition + \"\\n\" +\r\n\t\t\t\t\t\"m33 \" + lightVarying + \".xyz, \" + temp + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightVarying + \".w, \" + this._pSharedRegisters.localPosition + \".w\\n\";\r\n\t\t\t} else if (!this._shaderLightingObject.usesGlobalPosFragment) {\r\n\t\t\t\tlightVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tthis._pVertexCode += \"sub \" + lightVarying + \", \" + lightPosReg + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\r\n\t\t\t} else {\r\n\t\t\t\tlightVarying = lightDirReg;\r\n\t\t\t\tthis._pFragmentCode += \"sub \" + lightDirReg + \", \" + lightPosReg + \", \" + this._pSharedRegisters.globalPositionVarying + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._shaderLightingObject.usesLightFallOff) {\r\n\t\t\t\t// calculate attenuation\r\n\t\t\t\tthis._pFragmentCode += // attenuate\r\n\t\t\t\t\t\"dp3 \" + lightDirReg + \".w, \" + lightVarying + \", \" + lightVarying + \"\\n\" + // w = d - radius\r\n\t\t\t\t\t\"sub \" + lightDirReg + \".w, \" + lightDirReg + \".w, \" + diffuseColorReg + \".w\\n\" + // w = (d - radius)/(max-min)\r\n\t\t\t\t\t\"mul \" + lightDirReg + \".w, \" + lightDirReg + \".w, \" + specularColorReg + \".w\\n\" + // w = clamp(w, 0, 1)\r\n\t\t\t\t\t\"sat \" + lightDirReg + \".w, \" + lightDirReg + \".w\\n\" + // w = 1-w\r\n\t\t\t\t\t\"sub \" + lightDirReg + \".w, \" + this._pSharedRegisters.commons + \".w, \" + lightDirReg + \".w\\n\" + // normalize\r\n\t\t\t\t\t\"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._pFragmentCode += \"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightDirReg + \".w, \" + lightVarying + \".w\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\r\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = lightPosReg.index*4;\r\n\r\n\t\t\tif (addDiff)\r\n\t\t\t\tthis._pFragmentCode += this._lightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tif (addSpec)\r\n\t\t\t\tthis._pFragmentCode += this._lightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tthis._pRegisterCache.removeFragmentTempUsage(lightDirReg);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Compiles shading code for light probes.\r\n\t */\r\n\tprivate compileLightProbeCode()\r\n\t{\r\n\t\tvar weightReg:string;\r\n\t\tvar weightComponents = [ \".x\", \".y\", \".z\", \".w\" ];\r\n\t\tvar weightRegisters:Array<ShaderRegisterElement> = new Array<ShaderRegisterElement>();\r\n\t\tvar i:number;\r\n\t\tvar texReg:ShaderRegisterElement;\r\n\t\tvar addSpec:boolean = this._shaderLightingObject.usesProbesForSpecular;\r\n\t\tvar addDiff:boolean = this._shaderLightingObject.usesProbesForDiffuse;\r\n\r\n\t\tif (addDiff)\r\n\t\t\tthis._shaderLightingObject.lightProbeDiffuseIndices = new Array<number>();\r\n\r\n\t\tif (addSpec)\r\n\t\t\tthis._shaderLightingObject.lightProbeSpecularIndices = new Array<number>();\r\n\r\n\t\tfor (i = 0; i < this._pNumProbeRegisters; ++i) {\r\n\t\t\tweightRegisters[i] = this._pRegisterCache.getFreeFragmentConstant();\r\n\r\n\t\t\tif (i == 0)\r\n\t\t\t\tthis._shaderLightingObject.probeWeightsIndex = weightRegisters[i].index*4;\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < this._shaderLightingObject.numLightProbes; ++i) {\r\n\t\t\tweightReg = weightRegisters[Math.floor(i/4)].toString() + weightComponents[i%4];\r\n\r\n\t\t\tif (addDiff) {\r\n\t\t\t\ttexReg = this._pRegisterCache.getFreeTextureReg();\r\n\t\t\t\tthis._shaderLightingObject.lightProbeDiffuseIndices[i] = texReg.index;\r\n\t\t\t\tthis._pFragmentCode += this._lightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\t}\r\n\r\n\t\t\tif (addSpec) {\r\n\t\t\t\ttexReg = this._pRegisterCache.getFreeTextureReg();\r\n\t\t\t\tthis._shaderLightingObject.lightProbeSpecularIndices[i] = texReg.index;\r\n\t\t\t\tthis._pFragmentCode += this._lightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reset all the indices to \"unused\".\r\n\t */\r\n\tpublic pInitRegisterIndices()\r\n\t{\r\n\t\tsuper.pInitRegisterIndices();\r\n\r\n\t\tthis._shaderLightingObject.lightVertexConstantIndex = -1;\r\n\t\tthis._shaderLightingObject.lightFragmentConstantIndex = -1;\r\n\t\tthis._shaderLightingObject.probeWeightsIndex = -1;\r\n\r\n\t\tthis._pNumProbeRegisters = Math.ceil(this._shaderLightingObject.numLightProbes/4);\r\n\r\n\t\t//init light data\r\n\t\tif (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment) {\r\n\t\t\tthis._pointLightVertexConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights);\r\n\t\t\tthis._pointLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights*2);\r\n\t\t} else {\r\n\t\t\tthis._pointLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights*3);\r\n\t\t}\r\n\r\n\t\tif (this._shaderLightingObject.usesTangentSpace) {\r\n\t\t\tthis._dirLightVertexConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights);\r\n\t\t\tthis._dirLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights*2);\r\n\t\t} else {\r\n\t\t\tthis._dirLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights*3);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = LightingCompiler;",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\n/**\r\n *  Class Merge merges two or more static meshes into one.<code>Merge</code>\r\n */\r\nclass Merge\r\n{\r\n\r\n\t//private const LIMIT:uint = 196605;\r\n\tprivate _objectSpace:boolean;\r\n\tprivate _keepMaterial:boolean;\r\n\tprivate _disposeSources:boolean;\r\n\tprivate _geomVOs:Array<GeometryVO>;\r\n\tprivate _toDispose:Array<Mesh>;\r\n\r\n\t/**\r\n\t * @param    keepMaterial    [optional]    Determines if the merged object uses the recevier mesh material information or keeps its source material(s). Defaults to false.\r\n\t * If false and receiver object has multiple materials, the last material found in receiver submeshes is applied to the merged submesh(es).\r\n\t * @param    disposeSources  [optional]    Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.\r\n\t * If true, only receiver geometry and resulting mesh are kept in  memory.\r\n\t * @param    objectSpace     [optional]    Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.\r\n\t */\r\n\tconstructor(keepMaterial:boolean = false, disposeSources:boolean = false, objectSpace:boolean = false)\r\n\t{\r\n\t\tthis._keepMaterial = keepMaterial;\r\n\t\tthis._disposeSources = disposeSources;\r\n\t\tthis._objectSpace = objectSpace;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.\r\n\t */\r\n\tpublic set disposeSources(b:boolean)\r\n\t{\r\n\t\tthis._disposeSources = b;\r\n\t}\r\n\r\n\tpublic get disposeSources():boolean\r\n\t{\r\n\t\treturn this._disposeSources;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if the material source(s) used for the merging are disposed. Defaults to false.\r\n\t */\r\n\tpublic set keepMaterial(b:boolean)\r\n\t{\r\n\t\tthis._keepMaterial = b;\r\n\t}\r\n\r\n\tpublic get keepMaterial():boolean\r\n\t{\r\n\t\treturn this._keepMaterial;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.\r\n\t */\r\n\tpublic set objectSpace(b:boolean)\r\n\t{\r\n\t\tthis._objectSpace = b;\r\n\t}\r\n\r\n\tpublic get objectSpace():boolean\r\n\t{\r\n\t\treturn this._objectSpace;\r\n\t}\r\n\r\n\t/**\r\n\t * Merges all the children of a container into a single Mesh. If no Mesh object is found, method returns the receiver without modification.\r\n\t *\r\n\t * @param    receiver           The Mesh to receive the merged contents of the container.\r\n\t * @param    objectContainer    The DisplayObjectContainer holding the meshes to be mergd.\r\n\t *\r\n\t * @return The merged Mesh instance.\r\n\t */\r\n\tpublic applyToContainer(receiver:Mesh, objectContainer:DisplayObjectContainer)\r\n\t{\r\n\t\tthis.reset();\r\n\r\n\t\t//collect container meshes\r\n\t\tthis.parseContainer(receiver, objectContainer);\r\n\r\n\t\t//collect receiver\r\n\t\tthis.collect(receiver, false);\r\n\r\n\t\t//merge to receiver\r\n\t\tthis.merge(receiver, this._disposeSources);\r\n\t}\r\n\r\n\t/**\r\n\t * Merges all the meshes found in the Array&lt;Mesh&gt; into a single Mesh.\r\n\t *\r\n\t * @param    receiver    The Mesh to receive the merged contents of the meshes.\r\n\t * @param    meshes      A series of Meshes to be merged with the reciever mesh.\r\n\t */\r\n\tpublic applyToMeshes(receiver:Mesh, meshes:Array<Mesh>)\r\n\t{\r\n\t\tthis.reset();\r\n\r\n\t\tif (!meshes.length)\r\n\t\t\treturn;\r\n\r\n\t\t//collect meshes in vector\r\n\t\tfor (var i:number /*uint*/ = 0; i < meshes.length; i++)\r\n\t\t\tif (meshes[i] != receiver)\r\n\t\t\t\tthis.collect(meshes[i], this._disposeSources);\r\n\r\n\t\t//collect receiver\r\n\t\tthis.collect(receiver, false);\r\n\r\n\t\t//merge to receiver\r\n\t\tthis.merge(receiver, this._disposeSources);\r\n\t}\r\n\r\n\t/**\r\n\t *  Merges 2 meshes into one. It is recommand to use apply when 2 meshes are to be merged. If more need to be merged, use either applyToMeshes or applyToContainer methods.\r\n\t *\r\n\t * @param    receiver    The Mesh to receive the merged contents of both meshes.\r\n\t * @param    mesh        The Mesh to be merged with the receiver mesh\r\n\t */\r\n\tpublic apply(receiver:Mesh, mesh:Mesh)\r\n\t{\r\n\t\tthis.reset();\r\n\r\n\t\t//collect mesh\r\n\t\tthis.collect(mesh, this._disposeSources);\r\n\r\n\t\t//collect receiver\r\n\t\tthis.collect(receiver, false);\r\n\r\n\t\t//merge to receiver\r\n\t\tthis.merge(receiver, this._disposeSources);\r\n\t}\r\n\r\n\tprivate reset()\r\n\t{\r\n\t\tthis._toDispose  = new Array<Mesh>();\r\n\t\tthis._geomVOs = new Array<GeometryVO>();\r\n\t}\r\n\r\n\tprivate merge(destMesh:Mesh, dispose:boolean)\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar subIdx:number /*uint*/;\r\n\t\tvar oldGeom:Geometry;\r\n\t\tvar destGeom:Geometry;\r\n\t\tvar useSubMaterials:boolean;\r\n\r\n\t\toldGeom = destMesh.geometry;\r\n\t\tdestGeom = destMesh.geometry = new Geometry();\r\n\t\tsubIdx = destMesh.subMeshes.length;\r\n\r\n\t\t// Only apply materials directly to sub-meshes if necessary,\r\n\t\t// i.e. if there is more than one material available.\r\n\t\tuseSubMaterials = (this._geomVOs.length > 1);\r\n\r\n\t\tfor (i = 0; i < this._geomVOs.length; i++) {\r\n\t\t\tvar s:number /*uint*/;\r\n\t\t\tvar data:GeometryVO;\r\n\t\t\tvar sub:TriangleSubGeometry = new TriangleSubGeometry(new AttributesBuffer());\r\n\t\t\tsub.autoDeriveNormals = false;\r\n\t\t\tsub.autoDeriveTangents = false;\r\n\r\n\t\t\tdata = this._geomVOs[i];\r\n\t\t\tsub.setIndices(data.indices);\r\n\t\t\tsub.setPositions(data.vertices);\r\n\t\t\tsub.setNormals(data.normals);\r\n\t\t\tsub.setTangents(data.tangents);\r\n\t\t\tsub.setUVs(data.uvs);\r\n\r\n\t\t\tdestGeom.addSubGeometry(sub);\r\n\r\n\t\t\tif (this._keepMaterial && useSubMaterials)\r\n\t\t\t\tdestMesh.subMeshes[subIdx].material = data.material;\r\n\t\t}\r\n\r\n\t\tif (this._keepMaterial && !useSubMaterials && this._geomVOs.length)\r\n\t\t\tdestMesh.material = this._geomVOs[0].material;\r\n\r\n\t\tif (dispose) {\r\n\t\t\tvar m:Mesh;\r\n\t\t\tvar len:number = this._toDispose.length;\r\n\t\t\tfor (var i:number; i < len; i++) {\r\n\t\t\t\tm = this._toDispose[i];\r\n\t\t\t\tm.geometry.dispose();\r\n\t\t\t\tm.dispose();\r\n\t\t\t}\r\n\r\n\t\t\t//dispose of the original receiver geometry\r\n\t\t\toldGeom.dispose();\r\n\t\t}\r\n\r\n\t\tthis._toDispose = null;\r\n\t}\r\n\r\n\tprivate collect(mesh:Mesh, dispose:boolean)\r\n\t{\r\n\t\tif (mesh.geometry) {\r\n\t\t\tvar subIdx:number /*uint*/;\r\n\t\t\tvar subGeometries:Array<TriangleSubGeometry> = <Array<TriangleSubGeometry>> mesh.geometry.subGeometries;\r\n\t\t\tvar calc:number /*uint*/;\r\n\t\t\tfor (subIdx = 0; subIdx < subGeometries.length; subIdx++) {\r\n\t\t\t\tvar i:number /*uint*/;\r\n\t\t\t\tvar len:number /*uint*/;\r\n\t\t\t\tvar iIdx:number /*uint*/, vIdx:number /*uint*/, nIdx:number /*uint*/, tIdx:number /*uint*/, uIdx:number /*uint*/;\r\n\t\t\t\tvar indexOffset:number /*uint*/;\r\n\t\t\t\tvar subGeom:TriangleSubGeometry;\r\n\t\t\t\tvar vo:GeometryVO;\r\n\t\t\t\tvar vertices:Array<number>;\r\n\t\t\t\tvar normals:Array<number>;\r\n\t\t\t\tvar tangents:Array<number>;\r\n\t\t\t\tvar ind:Uint16Array, pd:Float32Array, nd:Float32Array, td:Float32Array, ud:Float32Array;\r\n\r\n\t\t\t\tsubGeom = subGeometries[subIdx];\r\n\t\t\t\tpd = subGeom.positions.get(subGeom.numVertices);\r\n\t\t\t\tnd = subGeom.normals.get(subGeom.numVertices);\r\n\t\t\t\ttd = subGeom.tangents.get(subGeom.numVertices);\r\n\t\t\t\tud = subGeom.uvs.get(subGeom.numVertices);\r\n\r\n\t\t\t\t// Get (or create) a VO for this material\r\n\t\t\t\tvo = this.getSubGeomData(mesh.subMeshes[subIdx].material || mesh.material);\r\n\r\n\t\t\t\t// Vertices and normals are copied to temporary vectors, to be transformed\r\n\t\t\t\t// before concatenated onto those of the data. This is unnecessary if no\r\n\t\t\t\t// transformation will be performed, i.e. for object space merging.\r\n\t\t\t\tvertices = (this._objectSpace)? vo.vertices : new Array<number>();\r\n\t\t\t\tnormals = (this._objectSpace)? vo.normals : new Array<number>();\r\n\t\t\t\ttangents = (this._objectSpace)? vo.tangents : new Array<number>();\r\n\r\n\t\t\t\t// Copy over vertex attributes\r\n\t\t\t\tvIdx = vertices.length;\r\n\t\t\t\tnIdx = normals.length;\r\n\t\t\t\ttIdx = tangents.length;\r\n\t\t\t\tuIdx = vo.uvs.length;\r\n\t\t\t\tlen = subGeom.numVertices;\r\n\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\tcalc = i*3;\r\n\r\n\t\t\t\t\t// Position\r\n\t\t\t\t\tvertices[vIdx++] = pd[calc];\r\n\t\t\t\t\tvertices[vIdx++] = pd[calc + 1];\r\n\t\t\t\t\tvertices[vIdx++] = pd[calc + 2];\r\n\r\n\t\t\t\t\t// Normal\r\n\t\t\t\t\tnormals[nIdx++] = nd[calc];\r\n\t\t\t\t\tnormals[nIdx++] = nd[calc + 1];\r\n\t\t\t\t\tnormals[nIdx++] = nd[calc + 2];\r\n\r\n\t\t\t\t\t// Tangent\r\n\t\t\t\t\ttangents[tIdx++] = td[calc];\r\n\t\t\t\t\ttangents[tIdx++] = td[calc + 1];\r\n\t\t\t\t\ttangents[tIdx++] = td[calc + 2];\r\n\r\n\t\t\t\t\t// UV\r\n\t\t\t\t\tvo.uvs[uIdx++] = ud[i*2];\r\n\t\t\t\t\tvo.uvs[uIdx++] = ud[i*2 + 1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Copy over triangle indices\r\n\t\t\t\tindexOffset = (!this._objectSpace)? vo.vertices.length/3 :0;\r\n\t\t\t\tiIdx = vo.indices.length;\r\n\t\t\t\tlen = subGeom.numElements;\r\n\t\t\t\tind = subGeom.indices.get(len);\r\n\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\tcalc = i*3;\r\n\t\t\t\t\tvo.indices[iIdx++] = ind[calc] + indexOffset;\r\n\t\t\t\t\tvo.indices[iIdx++] = ind[calc + 1] + indexOffset;\r\n\t\t\t\t\tvo.indices[iIdx++] = ind[calc + 2] + indexOffset;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this._objectSpace) {\r\n\t\t\t\t\tmesh.sceneTransform.transformVectors(vertices, vertices);\r\n\t\t\t\t\tMatrix3DUtils.deltaTransformVectors(mesh.sceneTransform, normals, normals);\r\n\t\t\t\t\tMatrix3DUtils.deltaTransformVectors(mesh.sceneTransform, tangents, tangents);\r\n\r\n\t\t\t\t\t// Copy vertex data from temporary (transformed) vectors\r\n\t\t\t\t\tvIdx = vo.vertices.length;\r\n\t\t\t\t\tnIdx = vo.normals.length;\r\n\t\t\t\t\ttIdx = vo.tangents.length;\r\n\t\t\t\t\tlen = vertices.length;\r\n\t\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\t\tvo.vertices[vIdx++] = vertices[i];\r\n\t\t\t\t\t\tvo.normals[nIdx++] = normals[i];\r\n\t\t\t\t\t\tvo.tangents[tIdx++] = tangents[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (dispose)\r\n\t\t\t\tthis._toDispose.push(mesh);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getSubGeomData(material:MaterialBase):GeometryVO\r\n\t{\r\n\t\tvar data:GeometryVO;\r\n\r\n\t\tif (this._keepMaterial) {\r\n\t\t\tvar i:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tlen = this._geomVOs.length;\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\tif (this._geomVOs[i].material == material) {\r\n\t\t\t\t\tdata = this._geomVOs[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (this._geomVOs.length) {\r\n\t\t\t// If materials are not to be kept, all data can be\r\n\t\t\t// put into a single VO, so return that one.\r\n\t\t\tdata = this._geomVOs[0];\r\n\t\t}\r\n\r\n\t\t// No data (for this material) found, create new.\r\n\t\tif (!data) {\r\n\t\t\tdata = new GeometryVO();\r\n\t\t\tdata.vertices = new Array<number>();\r\n\t\t\tdata.normals = new Array<number>();\r\n\t\t\tdata.tangents = new Array<number>();\r\n\t\t\tdata.uvs = new Array<number>();\r\n\t\t\tdata.indices = new Array<number /*uint*/>();\r\n\t\t\tdata.material = material;\r\n\r\n\t\t\tthis._geomVOs.push(data);\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate parseContainer(receiver:Mesh, object:DisplayObjectContainer)\r\n\t{\r\n\t\tvar child:DisplayObjectContainer;\r\n\t\tvar i:number /*uint*/;\r\n\r\n\t\tif (object instanceof Mesh && object != (<DisplayObjectContainer> receiver))\r\n\t\t\tthis.collect(<Mesh> object, this._disposeSources);\r\n\r\n\t\tfor (i = 0; i < object.numChildren; ++i) {\r\n\t\t\tchild = <DisplayObjectContainer> object.getChildAt(i);\r\n\t\t\tthis.parseContainer(receiver, child);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = Merge;\r\n\r\nclass GeometryVO\r\n{\r\n\tpublic uvs:Array<number>;\r\n\tpublic vertices:Array<number>;\r\n\tpublic normals:Array<number>;\r\n\tpublic tangents:Array<number>;\r\n\tpublic indices:Array<number /*uint*/>;\r\n\tpublic material:MaterialBase;\r\n}\r\n",
    "import Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleGeometryTransform\r\n{\r\n\tprivate _defaultVertexTransform:Matrix3D;\r\n\tprivate _defaultInvVertexTransform:Matrix3D;\r\n\tprivate _defaultUVTransform:Matrix;\r\n\r\n\tpublic set vertexTransform(value:Matrix3D)\r\n\t{\r\n\t\tthis._defaultVertexTransform = value;\r\n\t\tthis._defaultInvVertexTransform = value.clone();\r\n\t\tthis._defaultInvVertexTransform.invert();\r\n\t\tthis._defaultInvVertexTransform.transpose();\r\n\t}\r\n\r\n\tpublic set UVTransform(value:Matrix)\r\n\t{\r\n\t\tthis._defaultUVTransform = value;\r\n\t}\r\n\r\n\tpublic get UVTransform():Matrix\r\n\t{\r\n\t\treturn this._defaultUVTransform;\r\n\t}\r\n\r\n\tpublic get vertexTransform():Matrix3D\r\n\t{\r\n\t\treturn this._defaultVertexTransform;\r\n\t}\r\n\r\n\tpublic get invVertexTransform():Matrix3D\r\n\t{\r\n\t\treturn this._defaultInvVertexTransform;\r\n\t}\r\n}\r\n\r\nexport = ParticleGeometryTransform;",
    "import AttributesBuffer\t\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\nimport ParticleGeometry\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/ParticleGeometry\");\r\nimport ParticleGeometryTransform\t\t= require(\"awayjs-renderergl/lib/tools/data/ParticleGeometryTransform\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleGeometryHelper\r\n{\r\n\tpublic static MAX_VERTEX:number /*int*/ = 65535;\r\n\r\n\tpublic static generateGeometry(geometries:Array<Geometry>, transforms:Array<ParticleGeometryTransform> = null):ParticleGeometry\r\n\t{\r\n\t\tvar indicesVector:Array<Array<number>> /*uint*/ = new Array<Array<number>>() /*uint*/;\r\n\t\tvar positionsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar normalsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar tangentsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar uvsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar vertexCounters:Array<number> /*uint*/ = new Array<number>() /*uint*/;\r\n\t\tvar particles:Array<ParticleData> = new Array<ParticleData>();\r\n\t\tvar subGeometries:Array<TriangleSubGeometry> = new Array<TriangleSubGeometry>();\r\n\t\tvar numParticles:number /*uint*/ = geometries.length;\r\n\r\n\t\tvar sourceSubGeometries:Array<TriangleSubGeometry>;\r\n\t\tvar sourceSubGeometry:TriangleSubGeometry;\r\n\t\tvar numSubGeometries:number /*uint*/;\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\t\tvar positions:Array<number>;\r\n\t\tvar normals:Array<number>;\r\n\t\tvar tangents:Array<number>;\r\n\t\tvar uvs:Array<number>;\r\n\t\tvar vertexCounter:number /*uint*/;\r\n\t\tvar subGeometry:TriangleSubGeometry;\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar sub2SubMap:Array<number> /*int*/ = new Array<number>() /*int*/;\r\n\r\n\t\tvar tempVertex:Vector3D = new Vector3D;\r\n\t\tvar tempNormal:Vector3D = new Vector3D;\r\n\t\tvar tempTangents:Vector3D = new Vector3D;\r\n\t\tvar tempUV:Point = new Point;\r\n\r\n\t\tfor (i = 0; i < numParticles; i++) {\r\n\t\t\tsourceSubGeometries = <Array<TriangleSubGeometry>> geometries[i].subGeometries;\r\n\t\t\tnumSubGeometries = sourceSubGeometries.length;\r\n\t\t\tfor (var srcIndex:number /*int*/ = 0; srcIndex < numSubGeometries; srcIndex++) {\r\n\t\t\t\t//create a different particle subgeometry group for each source subgeometry in a particle.\r\n\t\t\t\tif (sub2SubMap.length <= srcIndex) {\r\n\t\t\t\t\tsub2SubMap.push(subGeometries.length);\r\n\t\t\t\t\tindicesVector.push(new Array<number>() /*uint*/);\r\n\t\t\t\t\tpositionsVector.push(new Array<number>());\r\n\t\t\t\t\tnormalsVector.push(new Array<number>());\r\n\t\t\t\t\ttangentsVector.push(new Array<number>());\r\n\t\t\t\t\tuvsVector.push(new Array<number>());\r\n\t\t\t\t\tsubGeometries.push(new TriangleSubGeometry(new AttributesBuffer()));\r\n\t\t\t\t\tvertexCounters.push(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsourceSubGeometry = sourceSubGeometries[srcIndex];\r\n\r\n\t\t\t\t//add a new particle subgeometry if this source subgeometry will take us over the maxvertex limit\r\n\t\t\t\tif (sourceSubGeometry.numVertices + vertexCounters[sub2SubMap[srcIndex]] > ParticleGeometryHelper.MAX_VERTEX) {\r\n\t\t\t\t\t//update submap and add new subgeom vectors\r\n\t\t\t\t\tsub2SubMap[srcIndex] = subGeometries.length;\r\n\t\t\t\t\tindicesVector.push(new Array<number>() /*uint*/);\r\n\t\t\t\t\tpositionsVector.push(new Array<number>());\r\n\t\t\t\t\tnormalsVector.push(new Array<number>());\r\n\t\t\t\t\ttangentsVector.push(new Array<number>());\r\n\t\t\t\t\tuvsVector.push(new Array<number>());\r\n\t\t\t\t\tsubGeometries.push(new TriangleSubGeometry(new AttributesBuffer()));\r\n\t\t\t\t\tvertexCounters.push(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tj = sub2SubMap[srcIndex];\r\n\r\n\t\t\t\t//select the correct vector\r\n\t\t\t\tindices = indicesVector[j];\r\n\t\t\t\tpositions = positionsVector[j];\r\n\t\t\t\tnormals = normalsVector[j];\r\n\t\t\t\ttangents = tangentsVector[j];\r\n\t\t\t\tuvs = uvsVector[j];\r\n\t\t\t\tvertexCounter = vertexCounters[j];\r\n\t\t\t\tsubGeometry = subGeometries[j];\r\n\r\n\t\t\t\tvar particleData:ParticleData = new ParticleData();\r\n\t\t\t\tparticleData.numVertices = sourceSubGeometry.numVertices;\r\n\t\t\t\tparticleData.startVertexIndex = vertexCounter;\r\n\t\t\t\tparticleData.particleIndex = i;\r\n\t\t\t\tparticleData.subGeometry = subGeometry;\r\n\t\t\t\tparticles.push(particleData);\r\n\r\n\t\t\t\tvertexCounters[j] += sourceSubGeometry.numVertices;\r\n\r\n\t\t\t\tvar k:number /*int*/;\r\n\t\t\t\tvar tempLen:number /*int*/;\r\n\t\t\t\tvar compact:TriangleSubGeometry = sourceSubGeometry;\r\n\t\t\t\tvar product:number /*uint*/;\r\n\t\t\t\tvar sourcePositions:Float32Array;\r\n\t\t\t\tvar sourceNormals:Float32Array;\r\n\t\t\t\tvar sourceTangents:Float32Array;\r\n\t\t\t\tvar sourceUVs:Float32Array;\r\n\r\n\t\t\t\tif (compact) {\r\n\t\t\t\t\ttempLen = compact.numVertices;\r\n\t\t\t\t\tsourcePositions = compact.positions.get(tempLen);\r\n\t\t\t\t\tsourceNormals = compact.normals.get(tempLen);\r\n\t\t\t\t\tsourceTangents = compact.tangents.get(tempLen);\r\n\t\t\t\t\tsourceUVs = compact.uvs.get(tempLen);\r\n\r\n\t\t\t\t\tif (transforms) {\r\n\t\t\t\t\t\tvar particleGeometryTransform:ParticleGeometryTransform = transforms[i];\r\n\t\t\t\t\t\tvar vertexTransform:Matrix3D = particleGeometryTransform.vertexTransform;\r\n\t\t\t\t\t\tvar invVertexTransform:Matrix3D = particleGeometryTransform.invVertexTransform;\r\n\t\t\t\t\t\tvar UVTransform:Matrix = particleGeometryTransform.UVTransform;\r\n\r\n\t\t\t\t\t\tfor (k = 0; k < tempLen; k++) {\r\n\t\t\t\t\t\t\t/*\r\n\t\t\t\t\t\t\t * 0 - 2: vertex position X, Y, Z\r\n\t\t\t\t\t\t\t * 3 - 5: normal X, Y, Z\r\n\t\t\t\t\t\t\t * 6 - 8: tangent X, Y, Z\r\n\t\t\t\t\t\t\t * 9 - 10: U V\r\n\t\t\t\t\t\t\t * 11 - 12: Secondary U V*/\r\n\t\t\t\t\t\t\tproduct = k*3;\r\n\t\t\t\t\t\t\ttempVertex.x = sourcePositions[product];\r\n\t\t\t\t\t\t\ttempVertex.y = sourcePositions[product + 1];\r\n\t\t\t\t\t\t\ttempVertex.z = sourcePositions[product + 2];\r\n\t\t\t\t\t\t\ttempNormal.x = sourceNormals[product];\r\n\t\t\t\t\t\t\ttempNormal.y = sourceNormals[product + 1];\r\n\t\t\t\t\t\t\ttempNormal.z = sourceNormals[product + 2];\r\n\t\t\t\t\t\t\ttempTangents.x = sourceTangents[product];\r\n\t\t\t\t\t\t\ttempTangents.y = sourceTangents[product + 1];\r\n\t\t\t\t\t\t\ttempTangents.z = sourceTangents[product + 2];\r\n\t\t\t\t\t\t\ttempUV.x = sourceUVs[k*2];\r\n\t\t\t\t\t\t\ttempUV.y = sourceUVs[k*2 + 1];\r\n\t\t\t\t\t\t\tif (vertexTransform) {\r\n\t\t\t\t\t\t\t\ttempVertex = vertexTransform.transformVector(tempVertex);\r\n\t\t\t\t\t\t\t\ttempNormal = invVertexTransform.deltaTransformVector(tempNormal);\r\n\t\t\t\t\t\t\t\ttempTangents = invVertexTransform.deltaTransformVector(tempNormal);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (UVTransform)\r\n\t\t\t\t\t\t\t\ttempUV = UVTransform.transformPoint(tempUV);\r\n\t\t\t\t\t\t\t//this is faster than that only push one data\r\n\t\t\t\t\t\t\tpositions.push(tempVertex.x, tempVertex.y, tempVertex.z);\r\n\t\t\t\t\t\t\tnormals.push(tempNormal.x, tempNormal.y, tempNormal.z);\r\n\t\t\t\t\t\t\ttangents.push(tempTangents.x, tempTangents.y, tempTangents.z);\r\n\t\t\t\t\t\t\tuvs.push(tempUV.x, tempUV.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (k = 0; k < tempLen; k++) {\r\n\t\t\t\t\t\t\tproduct = k*3;\r\n\t\t\t\t\t\t\t//this is faster than that only push one data\r\n\t\t\t\t\t\t\tpositions.push(sourcePositions[product], sourcePositions[product + 1], sourcePositions[product + 2]);\r\n\t\t\t\t\t\t\tnormals.push(sourceNormals[product], sourceNormals[product + 1], sourceNormals[product + 2]);\r\n\t\t\t\t\t\t\ttangents.push(sourceTangents[product], sourceTangents[product + 1], sourceTangents[product + 2]);\r\n\t\t\t\t\t\t\tuvs.push(sourceUVs[k*2], sourceUVs[k*2 + 1]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//Todo\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttempLen = sourceSubGeometry.numElements;\r\n\t\t\t\tvar sourceIndices:Uint16Array = sourceSubGeometry.indices.get(tempLen);\r\n\t\t\t\tfor (k = 0; k < tempLen; k++) {\r\n\t\t\t\t\tproduct = k*3;\r\n\t\t\t\t\tindices.push(sourceIndices[product] + vertexCounter, sourceIndices[product + 1] + vertexCounter, sourceIndices[product + 2] + vertexCounter);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar particleGeometry:ParticleGeometry = new ParticleGeometry();\r\n\t\tparticleGeometry.particles = particles;\r\n\t\tparticleGeometry.numParticles = numParticles;\r\n\r\n\t\tnumParticles = subGeometries.length;\r\n\t\tfor (i = 0; i < numParticles; i++) {\r\n\t\t\tsubGeometry = subGeometries[i];\r\n\t\t\tsubGeometry.autoDeriveNormals = false;\r\n\t\t\tsubGeometry.autoDeriveTangents = false;\r\n\t\t\tsubGeometry.setIndices(indicesVector[i]);\r\n\t\t\tsubGeometry.setPositions(positionsVector[i]);\r\n\t\t\tsubGeometry.setNormals(normalsVector[i]);\r\n\t\t\tsubGeometry.setTangents(tangentsVector[i]);\r\n\t\t\tsubGeometry.setUVs(uvsVector[i]);\r\n\t\t\tparticleGeometry.addSubGeometry(subGeometry);\r\n\t\t}\r\n\r\n\t\treturn particleGeometry;\r\n\t}\r\n}\r\n\r\nexport = ParticleGeometryHelper;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\n/**\r\n *\r\n */\r\nclass PerspectiveMatrix3D extends Matrix3D\r\n{\r\n\tconstructor(v:Float32Array = null)\r\n\t{\r\n\t\tsuper(v);\r\n\t}\r\n\r\n\tpublic perspectiveFieldOfViewLH(fieldOfViewY:number, aspectRatio:number, zNear:number, zFar:number)\r\n\t{\r\n\t\tvar yScale:number = 1/Math.tan(fieldOfViewY/2);\r\n\t\tvar xScale:number = yScale/aspectRatio;\r\n\r\n\t\tthis.rawData[0] = xScale;\r\n\t\tthis.rawData[1] = 0.0;\r\n\t\tthis.rawData[2] = 0.0;\r\n\t\tthis.rawData[3] = 0.0;\r\n\r\n\t\tthis.rawData[4] = 0.0;\r\n\t\tthis.rawData[5] = yScale;\r\n\t\tthis.rawData[6] = 0.0;\r\n\t\tthis.rawData[7] = 0.0;\r\n\r\n\t\tthis.rawData[8] = 0.0;\r\n\t\tthis.rawData[9] = 0.0;\r\n\t\tthis.rawData[10] = zFar/(zFar - zNear);\r\n\t\tthis.rawData[11] = 1.0;\r\n\r\n\t\tthis.rawData[12] = 0.0;\r\n\t\tthis.rawData[13] = 0.0;\r\n\t\tthis.rawData[14] = (zNear*zFar)/(zNear - zFar);\r\n\t\tthis.rawData[15] = 0.0;\r\n\t}\r\n}\r\n\r\nexport = PerspectiveMatrix3D;",
    "import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport ContextGLDrawMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLDrawMode\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport CurveSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/CurveSubGeometry\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport SubGeometryVOPool\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOPool\");\r\nimport SubGeometryVOBase\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOBase\");\r\n\r\n/**\r\n *\r\n * @class away.pool.CurveSubGeometryVO\r\n */\r\nclass CurveSubGeometryVO extends SubGeometryVOBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static assetClass:IAssetClass = CurveSubGeometry;\r\n\r\n\tprivate _curveSubGeometry:CurveSubGeometry;\r\n\r\n\tconstructor(pool:SubGeometryVOPool, curveSubGeometry:CurveSubGeometry)\r\n\t{\r\n\t\tsuper(pool, curveSubGeometry);\r\n\r\n\t\tthis._curveSubGeometry = curveSubGeometry;\r\n\r\n\t\tthis.invalidateVertices(this._curveSubGeometry.positions);\r\n\t\tthis.invalidateVertices(this._curveSubGeometry.curves);\r\n\t\tthis.invalidateVertices(this._curveSubGeometry.uvs);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis.disposeVertices(this._curveSubGeometry.positions);\r\n\t\tthis.disposeVertices(this._curveSubGeometry.curves);\r\n\t\tthis.disposeVertices(this._curveSubGeometry.uvs);\r\n\r\n\t\tthis._curveSubGeometry = null;\r\n\t}\r\n\r\n\tpublic _render(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t\tif (shader.uvBufferIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.uvBufferIndex, this._curveSubGeometry.uvs, stage);\r\n\r\n\t\tthis.activateVertexBufferVO(0, this._curveSubGeometry.positions, stage);\r\n\t\tthis.activateVertexBufferVO(1, this._curveSubGeometry.curves, stage);\r\n\r\n\t\tsuper._render(shader, stage);\r\n\t}\r\n\r\n\tpublic _drawElements(firstIndex:number, numIndices:number, stage:Stage)\r\n\t{\r\n\t\tthis.getIndexBufferVO(stage).draw(ContextGLDrawMode.TRIANGLES, firstIndex, numIndices);\r\n\t}\r\n\r\n\tpublic _drawArrays(firstVertex:number, numVertices:number, stage:Stage)\r\n\t{\r\n\t\tstage.context.drawVertices(ContextGLDrawMode.TRIANGLES, firstVertex, numVertices);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.CurveSubMeshRenderable}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetOverflowSubGeometry():SubGeometryVOBase\r\n\t{\r\n\t\treturn new CurveSubGeometryVO(this._pool, this._curveSubGeometry);\r\n\t}\r\n}\r\n\r\nexport = CurveSubGeometryVO;",
    "import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport ContextGLDrawMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLDrawMode\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport SubGeometryVOPool\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOPool\");\r\nimport SubGeometryVOBase\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOBase\");\r\n\r\n/**\r\n *\r\n * @class away.pool.LineSubGeometryVO\r\n */\r\nclass LineSubGeometryVO extends SubGeometryVOBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static assetClass:IAssetClass = LineSubGeometry;\r\n\r\n\tprivate _lineSubGeometry:LineSubGeometry;\r\n\r\n\tconstructor(pool:SubGeometryVOPool, lineSubGeometry:LineSubGeometry)\r\n\t{\r\n\t\tsuper(pool, lineSubGeometry);\r\n\r\n\t\tthis._lineSubGeometry = lineSubGeometry;\r\n\r\n\t\tthis.invalidateVertices(this._lineSubGeometry.positions);\r\n\t\tthis.invalidateVertices(this._lineSubGeometry.thickness);\r\n\t\tthis.invalidateVertices(this._lineSubGeometry.colors);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis.disposeVertices(this._lineSubGeometry.positions);\r\n\t\tthis.disposeVertices(this._lineSubGeometry.thickness);\r\n\t\tthis.disposeVertices(this._lineSubGeometry.colors);\r\n\r\n\t\tthis._lineSubGeometry = null;\r\n\t}\r\n\r\n\tpublic _render(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t\tif (shader.colorBufferIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.colorBufferIndex, this._lineSubGeometry.colors, stage);\r\n\r\n\t\tthis.activateVertexBufferVO(0, this._lineSubGeometry.positions, stage, 3);\r\n\t\tthis.activateVertexBufferVO(1, this._lineSubGeometry.positions, stage, 3, 12);\r\n\t\tthis.activateVertexBufferVO(2, this._lineSubGeometry.thickness, stage);\r\n\r\n\t\tsuper._render(shader, stage);\r\n\t}\r\n\r\n\tpublic _drawElements(firstIndex:number, numIndices:number, stage:Stage)\r\n\t{\r\n\t\tthis.getIndexBufferVO(stage).draw(ContextGLDrawMode.TRIANGLES, 0, numIndices);\r\n\t}\r\n\r\n\tpublic _drawArrays(firstVertex:number, numVertices:number, stage:Stage)\r\n\t{\r\n\t\tstage.context.drawVertices(ContextGLDrawMode.TRIANGLES, firstVertex, numVertices);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.LineSubMeshRenderable}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetOverflowSubGeometry():SubGeometryVOBase\r\n\t{\r\n\t\treturn new LineSubGeometryVO(this._pool, this._lineSubGeometry);\r\n\t}\r\n}\r\n\r\nexport = LineSubGeometryVO;",
    "import Sampler2D\t\t\t\t\t= require(\"awayjs-core/lib/data/Sampler2D\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport Image2DObject\t\t\t\t= require(\"awayjs-stagegl/lib/pool/Image2DObject\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport SamplerVOBase\t\t\t\t= require(\"awayjs-renderergl/lib/vos/SamplerVOBase\");\r\n\r\n/**\r\n *\r\n * @class away.pool.Sampler2DVO\r\n */\r\nclass Sampler2DVO extends SamplerVOBase\r\n{\r\n\tprivate _imageObject:Image2DObject;\r\n\tprivate _sampler2D:Sampler2D;\r\n\tprivate _fragmentReg:ShaderRegisterElement;\r\n\tprivate _fragmentIndex:number;\r\n\r\n\tconstructor(stage:Stage, sampler2D:Sampler2D)\r\n\t{\r\n\t\tsuper(stage);\r\n\r\n\t\tthis._sampler2D = sampler2D;\r\n\t\tthis._imageObject = this._stage.getImageObject(this._sampler2D.image2D);\r\n\t\tthis._imageObject.usages++;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._sampler2D = null;\r\n\r\n\t\tthis._imageObject.usages--;\r\n\r\n\t\tif (!this._imageObject.usages) {\r\n\t\t\tthis._imageObject.dispose();\r\n\t\t\tthis._imageObject = null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic initProperties(regCache:ShaderRegisterCache)\r\n\t{\r\n\t\tthis.samplerReg = regCache.getFreeTextureReg();\r\n\t\tthis.samplerIndex = this.samplerReg.index;\r\n\r\n\t\tif (this._sampler2D.imageRect) {\r\n\t\t\tthis._fragmentReg = regCache.getFreeFragmentConstant();\r\n\t\t\tthis._fragmentIndex = this._fragmentReg.index*4;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getFragmentCode(shader:ShaderBase, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, inputReg:ShaderRegisterElement):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar wrap:string = (shader.repeatTextures? \"wrap\":\"clamp\");\r\n\t\tvar format:string = this.getFormatString(this._sampler2D);\r\n\t\tvar filter:string = (shader.useSmoothTextures)? (shader.useMipmapping? \"linear,miplinear\" : \"linear\") : (shader.useMipmapping? \"nearest,mipnearest\" : \"nearest\");\r\n\r\n\t\tvar temp:ShaderRegisterElement;\r\n\r\n\t\t//handles texture atlasing\r\n\t\tif (this._sampler2D.imageRect) {\r\n\t\t\ttemp = regCache.getFreeFragmentVectorTemp();\r\n\r\n\t\t\tcode += \"mul \" + temp + \", \" + inputReg + \", \" + this._fragmentReg + \".xy\\n\";\r\n\t\t\tcode += \"add \" + temp + \", \" + temp + \", \" + this._fragmentReg + \".zw\\n\";\r\n\t\t} else {\r\n\t\t\ttemp = inputReg;\r\n\t\t}\r\n\r\n\t\tcode += \"tex \" + targetReg + \", \" + temp + \", \" + this.samplerReg + \" <2d,\" + filter + \",\" + format + wrap + \">\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic activate(shader:ShaderBase)\r\n\t{\r\n\t\tthis._imageObject.activate(this.samplerIndex, this._sampler2D.repeat || shader.repeatTextures, this._sampler2D.smooth || shader.useSmoothTextures, this._sampler2D.mipmap || shader.useMipmapping);\r\n\r\n\t\tif (this._sampler2D.imageRect) {\r\n\t\t\tvar index:number = this._fragmentIndex;\r\n\t\t\tvar data:Float32Array = shader.fragmentConstantData;\r\n\t\t\tdata[index] = this._sampler2D.scaleX;\r\n\t\t\tdata[index + 1] = this._sampler2D.scaleY;\r\n\t\t\tdata[index + 2] = this._sampler2D.offsetX;\r\n\t\t\tdata[index + 3] = this._sampler2D.offsetY;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = Sampler2DVO;",
    "import SamplerCube\t\t\t\t\t= require(\"awayjs-core/lib/data/SamplerCube\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ImageCubeObject\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ImageCubeObject\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport SamplerVOBase\t\t\t\t= require(\"awayjs-renderergl/lib/vos/SamplerVOBase\");\r\n\r\n/**\r\n *\r\n * @class away.pool.BitmapObject\r\n */\r\nclass SamplerCubeVO extends SamplerVOBase\r\n{\r\n\tprivate _imageObject:ImageCubeObject;\r\n\tprivate _samplerCube:SamplerCube;\r\n\r\n\tconstructor(stage:Stage, samplerCube:SamplerCube)\r\n\t{\r\n\t\tsuper(stage);\r\n\r\n\t\tthis._samplerCube = samplerCube;\r\n\t\tthis._imageObject = this._stage.getImageObject(this._samplerCube.imageCube);\r\n\t\tthis._imageObject.usages++;\r\n\t}\r\n\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._samplerCube = null\r\n\r\n\t\tthis._imageObject.usages--;\r\n\r\n\t\tif (!this._imageObject.usages) {\r\n\t\t\tthis._imageObject.dispose();\r\n\t\t\tthis._imageObject = null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic initProperties(regCache:ShaderRegisterCache)\r\n\t{\r\n\t\tthis.samplerReg = regCache.getFreeTextureReg();\r\n\r\n\t\tthis.samplerIndex = this.samplerReg.index;\r\n\t}\r\n\r\n\tpublic getFragmentCode(shader:ShaderBase, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, inputReg:ShaderRegisterElement):string\r\n\t{\r\n\t\tvar filter:string;\r\n\t\tvar format:string = this.getFormatString(this._samplerCube);\r\n\t\tvar filter:string = (shader.useSmoothTextures)? (shader.useMipmapping? \"linear,miplinear\" : \"linear\") : (shader.useMipmapping? \"nearest,mipnearest\" : \"nearest\");\r\n\r\n\t\treturn \"tex \" + targetReg + \", \" + inputReg + \", \" + this.samplerReg + \" <cube,\" + format + filter + \">\\n\";\r\n\t}\r\n\r\n\tpublic activate(shader:ShaderBase)\r\n\t{\r\n\t\tthis._imageObject.activate(this.samplerIndex, false, this._samplerCube.smooth || shader.useSmoothTextures, this._samplerCube.mipmap || shader.useMipmapping);\r\n\t}\r\n}\r\n\r\nexport = SamplerCubeVO;",
    "import SamplerBase\t\t\t\t\t= require(\"awayjs-core/lib/data/SamplerBase\");\r\n\r\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\n\r\n\r\n/**\r\n *\r\n * @class away.pool.SamplerVOBase\r\n */\r\nclass SamplerVOBase\r\n{\r\n\tpublic _stage:Stage;\r\n\r\n\tpublic samplerReg:ShaderRegisterElement;\r\n\r\n\tpublic samplerIndex:number;\r\n\r\n\tconstructor(stage:Stage)\r\n\t{\r\n\t\tthis._stage = stage;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._stage = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a texture format string for the sample instruction.\r\n\t * @param texture The texture for which to get the format string.\r\n\t * @return\r\n\t *\r\n\t * @protected\r\n\t */\r\n\tpublic getFormatString(bitmap:SamplerBase):string\r\n\t{\r\n\t\tswitch (bitmap.format) {\r\n\t\t\tcase ContextGLTextureFormat.COMPRESSED:\r\n\t\t\t\treturn \"dxt1,\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase ContextGLTextureFormat.COMPRESSED_ALPHA:\r\n\t\t\t\treturn \"dxt5,\";\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn \"\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SamplerVOBase;",
    "import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport Single2DTexture\t\t\t\t= require(\"awayjs-display/lib/textures/Single2DTexture\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport TextureVOPool\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOPool\");\r\nimport TextureVOBase\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOBase\");\r\nimport Sampler2DVO\t\t\t\t\t= require(\"awayjs-renderergl/lib/vos/Sampler2DVO\");\r\n\r\n/**\r\n *\r\n * @class away.pool.Single2DTextureVO\r\n */\r\nclass Single2DTextureVO extends TextureVOBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static assetClass:IAssetClass = Single2DTexture;\r\n\r\n\tprivate _single2DTexture:Single2DTexture;\r\n\r\n\tprivate _sampler2DVO:Sampler2DVO;\r\n\r\n\tconstructor(pool:TextureVOPool, single2DTexture:Single2DTexture, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, single2DTexture, stage);\r\n\r\n\t\tthis._single2DTexture = single2DTexture;\r\n\r\n\t\tthis._sampler2DVO = new Sampler2DVO(stage, this._single2DTexture.sampler2D);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._single2DTexture = null;\r\n\r\n\t\tthis._sampler2DVO.dispose();\r\n\t\tthis._sampler2DVO = null;\r\n\t}\r\n\r\n\tpublic _iInitRegisters(shader:ShaderBase, regCache:ShaderRegisterCache)\r\n\t{\r\n\t\tthis._sampler2DVO.initProperties(regCache);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param shader\r\n\t * @param regCache\r\n\t * @param targetReg The register in which to store the sampled colour.\r\n\t * @param uvReg The uv coordinate vector with which to sample the texture map.\r\n\t * @returns {string}\r\n\t * @private\r\n\t */\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, inputReg:ShaderRegisterElement):string\r\n\t{\r\n\t\treturn this._sampler2DVO.getFragmentCode(shader, targetReg, regCache, inputReg);\r\n\t}\r\n\r\n\tpublic activate(shader:ShaderBase)\r\n\t{\r\n\t\tthis._sampler2DVO.activate(shader);\r\n\t}\r\n}\r\n\r\nexport = Single2DTextureVO;",
    "import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport SingleCubeTexture\t\t\t= require(\"awayjs-display/lib/textures/SingleCubeTexture\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport TextureVOPool\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOPool\");\r\nimport TextureVOBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOBase\");\r\nimport SamplerCubeVO\t\t\t= require(\"awayjs-renderergl/lib/vos/SamplerCubeVO\");\r\n\r\n/**\r\n *\r\n * @class away.pool.TextureDataBase\r\n */\r\nclass SingleCubeTextureVO extends TextureVOBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static assetClass:IAssetClass = SingleCubeTexture;\r\n\r\n\r\n\tprivate _singleCubeTexture:SingleCubeTexture;\r\n\r\n\tprivate _samplerCubeVO:SamplerCubeVO;\r\n\r\n\tconstructor(pool:TextureVOPool, singleCubeTexture:SingleCubeTexture, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, singleCubeTexture, stage);\r\n\r\n\t\tthis._singleCubeTexture = singleCubeTexture;\r\n\r\n\t\tthis._samplerCubeVO = new SamplerCubeVO(stage, this._singleCubeTexture.samplerCube);\r\n\t}\r\n\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis._singleCubeTexture = null;\r\n\r\n\t\tthis._samplerCubeVO.dispose();\r\n\t\tthis._samplerCubeVO = null;\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shader:ShaderBase, includeInput:boolean = true)\r\n\t{\r\n\t\tif (includeInput)\r\n\t\t\tshader.usesLocalPosFragment = true;\r\n\t}\r\n\r\n\tpublic _iInitRegisters(shader:ShaderBase, regCache:ShaderRegisterCache)\r\n\t{\r\n\t\tthis._samplerCubeVO.initProperties(regCache);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param shader\r\n\t * @param regCache\r\n\t * @param targetReg The register in which to store the sampled colour.\r\n\t * @param uvReg The direction vector with which to sample the cube map.\r\n\t * @returns {string}\r\n\t * @private\r\n\t */\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, inputReg:ShaderRegisterElement):string\r\n\t{\r\n\t\treturn this._samplerCubeVO.getFragmentCode(shader, targetReg, regCache, inputReg);\r\n\t}\r\n\r\n\tpublic activate(shader:ShaderBase)\r\n\t{\r\n\t\tthis._samplerCubeVO.activate(shader);\r\n\t}\r\n}\r\n\r\nexport = SingleCubeTextureVO;",
    "import AttributesView\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesView\");\r\nimport AttributesBuffer\t\t\t\t= require(\"awayjs-core/lib/attributes/AttributesBuffer\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\nimport SubGeometryUtils\t\t\t\t= require(\"awayjs-display/lib/utils/SubGeometryUtils\");\r\nimport AttributesBufferVO\t\t\t= require(\"awayjs-stagegl/lib/vos/AttributesBufferVO\");\r\n\r\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport ISubGeometryVO\t\t\t\t= require(\"awayjs-display/lib/vos/ISubGeometryVO\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport SubGeometryVOPool\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOPool\");\r\n\r\n/**\r\n *\r\n * @class away.pool.SubGeometryVOBaseBase\r\n */\r\nclass SubGeometryVOBase implements ISubGeometryVO\r\n{\r\n\tpublic usages:number = 0;\r\n\tpublic _pool:SubGeometryVOPool;\r\n\tprivate _subGeometry:SubGeometryBase;\r\n\tprivate _onIndicesUpdatedDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _onIndicesDisposedDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _onVerticesUpdatedDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _onVerticesDisposedDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _overflow:SubGeometryVOBase;\r\n\tprivate _indices:AttributesBuffer;\r\n\tprivate _indexBuffer:AttributesBufferVO;\r\n\tprivate _indicesDirty:boolean;\r\n\tprivate _vertices:Object = new Object();\r\n\tprivate _vertexBuffers:Object = new Object();\r\n\tprivate _verticesDirty:Object = new Object();\r\n\r\n\tpublic _indexMappings:Array<number> = Array<number>();\r\n\t\r\n\tprivate _numIndices:number;\r\n\r\n\tprivate _numVertices:number;\r\n\r\n\tpublic invalid:boolean;\r\n\r\n\tpublic get subGeometry()\r\n\t{\r\n\t\treturn this._subGeometry;\r\n\t}\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get numIndices():number\r\n\t{\r\n\t\treturn this._numIndices;\r\n\t}\r\n\r\n\tconstructor(pool:SubGeometryVOPool, subGeometry:SubGeometryBase)\r\n\t{\r\n\t\tthis._pool = pool;\r\n\t\tthis._subGeometry = subGeometry;\r\n\r\n\t\tthis._onIndicesUpdatedDelegate = (event:SubGeometryEvent) => this._onIndicesUpdated(event);\r\n\t\tthis._onIndicesDisposedDelegate = (event:SubGeometryEvent) => this._onIndicesDisposed(event);\r\n\t\tthis._onVerticesUpdatedDelegate = (event:SubGeometryEvent) => this._onVerticesUpdated(event);\r\n\t\tthis._onVerticesDisposedDelegate = (event:SubGeometryEvent) => this._onVerticesDisposed(event);\r\n\r\n\t\tthis._subGeometry.addEventListener(SubGeometryEvent.INDICES_DISPOSED, this._onIndicesDisposedDelegate);\r\n\t\tthis._subGeometry.addEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdatedDelegate);\r\n\r\n\t\tthis._subGeometry.addEventListener(SubGeometryEvent.VERTICES_DISPOSED, this._onVerticesDisposedDelegate);\r\n\t\tthis._subGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\r\n\r\n\t\tthis.invalidateIndices();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get indexMappings():Array<number>\r\n\t{\r\n\t\tif (this._indicesDirty)\r\n\t\t\tthis._updateIndices();\r\n\r\n\t\treturn this._indexMappings;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getIndexBufferVO(stage:Stage):AttributesBufferVO\r\n\t{\r\n\t\tif (this._indicesDirty)\r\n\t\t\tthis._updateIndices();\r\n\r\n\t\treturn (this._indexBuffer = stage.getAttributesBufferVO(this._indices));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getVertexBufferVO(attributesView:AttributesView, stage:Stage):AttributesBufferVO\r\n\t{\r\n\t\tvar bufferId:number = attributesView.buffer.id;\r\n\t\tif (this._indicesDirty)\r\n\t\t\tthis._updateIndices();\r\n\r\n\t\tif (this._verticesDirty[bufferId])\r\n\t\t\tthis._updateVertices(attributesView);\r\n\r\n\t\treturn (this._vertexBuffers[bufferId] = stage.getAttributesBufferVO(this._vertices[bufferId]));\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic activateVertexBufferVO(index:number, attributesView:AttributesView, stage:Stage, dimensions:number = 0, offset:number = 0)\r\n\t{\r\n\t\tthis.getVertexBufferVO(attributesView, stage).activate(index, attributesView.size, dimensions || attributesView.dimensions, attributesView.offset + offset);\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidateIndices()\r\n\t{\r\n\t\tif (!this._subGeometry.indices)\r\n\t\t\treturn;\r\n\r\n\t\tthis._indicesDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic disposeIndices()\r\n\t{\r\n\t\tif (this._indexBuffer) {\r\n\t\t\tthis._indexBuffer.dispose();\r\n\t\t\tthis._indexBuffer = null;\r\n\t\t}\r\n\r\n\t\tthis._indices = null;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param attributesView\r\n\t */\r\n\tpublic invalidateVertices(attributesView:AttributesView)\r\n\t{\r\n\t\tif (!attributesView)\r\n\t\t\treturn;\r\n\r\n\t\tvar bufferId:number = attributesView.buffer.id;\r\n\r\n\t\tthis._verticesDirty[bufferId] = true;\r\n\t}\r\n\t\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic disposeVertices(attributesView:AttributesView)\r\n\t{\r\n\t\tif (!attributesView)\r\n\t\t\treturn;\r\n\r\n\t\tvar bufferId:number = attributesView.buffer.id;\r\n\r\n\t\tif (this._vertexBuffers[bufferId]) {\r\n\t\t\tthis._vertexBuffers[bufferId].dispose();\r\n\t\t\tdelete this._vertexBuffers[bufferId];\r\n\t\t}\r\n\r\n\t\tthis._vertices = null;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pool.disposeItem(this._subGeometry);\r\n\t\tthis._pool = null;\r\n\r\n\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.INDICES_DISPOSED, this._onIndicesDisposedDelegate);\r\n\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdatedDelegate);\r\n\r\n\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.VERTICES_DISPOSED, this._onVerticesDisposedDelegate);\r\n\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\r\n\r\n\t\tthis._subGeometry = null;\r\n\r\n\t\tthis.disposeIndices();\r\n\r\n\t\tif (this._overflow) {\r\n\t\t\tthis._overflow.dispose();\r\n\t\t\tthis._overflow = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidate()\r\n\t{\r\n\t\tthis.invalid = true;\r\n\t}\r\n\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, inputReg:ShaderRegisterElement = null):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\tpublic _iRender(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t\tif (this._indicesDirty)\r\n\t\t\tthis._updateIndices();\r\n\r\n\t\tthis._render(shader, stage);\r\n\r\n\t\tif (this._overflow)\r\n\t\t\tthis._overflow._iRender(shader, stage);\r\n\t}\r\n\r\n\tpublic _render(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t\tif (this._indices)\r\n\t\t\tthis._drawElements(0, this._numIndices, stage);\r\n\t\telse\r\n\t\t\tthis._drawArrays(0, this._numVertices, stage);\r\n\t}\r\n\r\n\tpublic _drawElements(firstIndex:number, numIndices:number, stage:Stage)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\tpublic _drawArrays(firstVertex:number, numVertices:number, stage:Stage)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _updateIndices(indexOffset:number = 0)\r\n\t{\r\n\t\tthis._indices = SubGeometryUtils.getSubIndices(this._subGeometry.indices, this._subGeometry.numVertices, this._indexMappings, indexOffset);\r\n\r\n\t\tthis._numIndices = this._indices.count*this._subGeometry.indices.dimensions;\r\n\r\n\t\tindexOffset += this._numIndices;\r\n\r\n\t\t//check if there is more to split\r\n\t\tif (indexOffset < this._subGeometry.indices.count*this._subGeometry.indices.dimensions) {\r\n\t\t\tif (!this._overflow)\r\n\t\t\t\tthis._overflow = this._pGetOverflowSubGeometry();\r\n\r\n\t\t\tthis._overflow._updateIndices(indexOffset);\r\n\t\t} else if (this._overflow) {\r\n\t\t\tthis._overflow.dispose();\r\n\t\t\tthis._overflow = null;\r\n\t\t}\r\n\r\n\t\tthis._indicesDirty = false;\r\n\t\t\r\n\t\t//invalidate vertices if index mappings exist\r\n\t\tif (this._indexMappings.length)\r\n\t\t\tfor (var key in this._verticesDirty)\r\n\t\t\t\tthis._verticesDirty[key] = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param attributesView\r\n\t * @private\r\n\t */\r\n\tprivate _updateVertices(attributesView:AttributesView)\r\n\t{\r\n\t\tthis._numVertices = attributesView.count;\r\n\r\n\t\tvar bufferId:number = attributesView.buffer.id;\r\n\r\n\t\tthis._vertices[bufferId] = SubGeometryUtils.getSubVertices(attributesView.buffer, this._indexMappings);\r\n\r\n\t\tthis._verticesDirty[bufferId] = false;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param event\r\n\t * @private\r\n\t */\r\n\tprivate _onIndicesUpdated(event:SubGeometryEvent)\r\n\t{\r\n\t\tthis.invalidateIndices();\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param event\r\n\t * @private\r\n\t */\r\n\tprivate _onIndicesDisposed(event:SubGeometryEvent)\r\n\t{\r\n\t\tthis.disposeIndices();\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param event\r\n\t * @private\r\n\t */\r\n\tprivate _onVerticesUpdated(event:SubGeometryEvent)\r\n\t{\r\n\t\tthis.invalidateVertices(event.attributesView);\r\n\t}\r\n\t\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param event\r\n\t * @private\r\n\t */\r\n\tprivate _onVerticesDisposed(event:SubGeometryEvent)\r\n\t{\r\n\t\tthis.disposeVertices(event.attributesView);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.TriangleSubMeshRenderable}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetOverflowSubGeometry():SubGeometryVOBase\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n}\r\n\r\nexport = SubGeometryVOBase;",
    "import Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\n\r\nimport ISubGeometryVOClass\t\t\t= require(\"awayjs-renderergl/lib/vos/ISubGeometryVOClass\");\r\nimport SubGeometryVOBase\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOBase\");\r\nimport TriangleSubGeometryVO\t\t= require(\"awayjs-renderergl/lib/vos/TriangleSubGeometryVO\");\r\nimport LineSubGeometryVO\t\t\t= require(\"awayjs-renderergl/lib/vos/LineSubGeometryVO\");\r\nimport CurveSubGeometryVO\t\t\t= require(\"awayjs-renderergl/lib/vos/CurveSubGeometryVO\");\r\n\r\n/**\r\n * @class away.pool.SubGeometryVOPool\r\n */\r\nclass SubGeometryVOPool\r\n{\r\n\tprivate static classPool:Object = new Object();\r\n\r\n\tpublic static _pool:SubGeometryVOPool;\r\n\r\n\tprivate _pool:Object = new Object();\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param subGeometryDataClass\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param materialOwner\r\n\t * @returns ISubGeometry\r\n\t */\r\n\tpublic getItem(subGeometry:SubGeometryBase):SubGeometryVOBase\r\n\t{\r\n\t\treturn (this._pool[subGeometry.id] || (this._pool[subGeometry.id] = subGeometry._iAddSubGeometryVO(new (SubGeometryVOPool.getClass(subGeometry))(this, subGeometry))));\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param materialOwner\r\n\t */\r\n\tpublic disposeItem(subGeometry:SubGeometryBase)\r\n\t{\r\n\t\tsubGeometry._iRemoveSubGeometryVO(this._pool[subGeometry.id]);\r\n\r\n\t\tdelete this._pool[subGeometry.id];\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableClass\r\n\t * @returns RenderPool\r\n\t */\r\n\tpublic static getPool():SubGeometryVOPool\r\n\t{\r\n\t\treturn (SubGeometryVOPool._pool || (SubGeometryVOPool._pool = new SubGeometryVOPool()));\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param subMeshClass\r\n\t */\r\n\tpublic static registerClass(subGeometryVOClass:ISubGeometryVOClass)\r\n\t{\r\n\t\tSubGeometryVOPool.classPool[subGeometryVOClass.assetClass.assetType] = subGeometryVOClass;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param subGeometry\r\n\t */\r\n\tpublic static getClass(subGeometry:SubGeometryBase):ISubGeometryVOClass\r\n\t{\r\n\t\treturn SubGeometryVOPool.classPool[subGeometry.assetType];\r\n\t}\r\n\r\n\tprivate static main = SubGeometryVOPool.addDefaults();\r\n\r\n\tprivate static addDefaults()\r\n\t{\r\n\t\tSubGeometryVOPool.registerClass(CurveSubGeometryVO);\r\n\t\tSubGeometryVOPool.registerClass(LineSubGeometryVO);\r\n\t\tSubGeometryVOPool.registerClass(TriangleSubGeometryVO);\r\n\t}\r\n}\r\n\r\nexport = SubGeometryVOPool;",
    "import AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ITextureVO\t\t\t\t\t= require(\"awayjs-display/lib/pool/ITextureVO\");\r\nimport TextureBase\t\t\t\t\t= require(\"awayjs-display/lib/textures/TextureBase\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport TextureVOPool\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOPool\");\r\n\r\n/**\r\n *\r\n * @class away.pool.TextureVOBaseBase\r\n */\r\nclass TextureVOBase implements ITextureVO\r\n{\r\n\tprivate _pool:TextureVOPool;\r\n\tprivate _texture:TextureBase;\r\n\r\n\tpublic _stage:Stage;\r\n\r\n\tpublic invalid:boolean;\r\n\r\n\tconstructor(pool:TextureVOPool, texture:TextureBase, stage:Stage)\r\n\t{\r\n\t\tthis._pool = pool;\r\n\t\tthis._texture = texture;\r\n\t\tthis._stage = stage;\r\n\t}\r\n\r\n\tpublic _iInitRegisters(shader:ShaderBase, regCache:ShaderRegisterCache)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pool.disposeItem(this._texture);\r\n\t\tthis._pool = null;\r\n\t\tthis._texture = null;\r\n\t\tthis._stage = null;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidate()\r\n\t{\r\n\t\tthis.invalid = true;\r\n\t}\r\n\r\n\tpublic _iGetFragmentCode(shader:ShaderBase, targetReg:ShaderRegisterElement, regCache:ShaderRegisterCache, inputReg:ShaderRegisterElement = null):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\tpublic activate(shader:ShaderBase)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n}\r\n\r\nexport = TextureVOBase;",
    "import Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport TextureBase\t\t\t\t\t= require(\"awayjs-display/lib/textures/TextureBase\");\r\n\r\nimport ITextureVOClass\t\t\t= require(\"awayjs-renderergl/lib/vos/ITextureVOClass\");\r\nimport TextureVOBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/vos/TextureVOBase\");\r\nimport Single2DTextureVO\t\t= require(\"awayjs-renderergl/lib/vos/Single2DTextureVO\");\r\nimport SingleCubeTextureVO\t\t= require(\"awayjs-renderergl/lib/vos/SingleCubeTextureVO\");\r\n\r\n/**\r\n * @class away.pool.TextureVOPool\r\n */\r\nclass TextureVOPool\r\n{\r\n\tprivate static classPool:Object = new Object();\r\n\r\n\tpublic _stage:Stage;\r\n\tprivate _pool:Object = new Object();\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param textureDataClass\r\n\t */\r\n\tconstructor(stage:Stage)\r\n\t{\r\n\t\tthis._stage = stage;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param materialOwner\r\n\t * @returns ITexture\r\n\t */\r\n\tpublic getItem(texture:TextureBase):TextureVOBase\r\n\t{\r\n\t\treturn (this._pool[texture.id] || (this._pool[texture.id] = texture._iAddTextureVO(new (TextureVOPool.getClass(texture))(this, texture, this._stage))));\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param materialOwner\r\n\t */\r\n\tpublic disposeItem(texture:TextureBase)\r\n\t{\r\n\t\ttexture._iRemoveTextureVO(this._pool[texture.id]);\r\n\r\n\t\tdelete this._pool[texture.id];\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var id in this._pool)\r\n\t\t\tthis._pool[id].dispose();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param subMeshClass\r\n\t */\r\n\tpublic static registerClass(textureVOClass:ITextureVOClass)\r\n\t{\r\n\t\tTextureVOPool.classPool[textureVOClass.assetClass.assetType] = textureVOClass;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param subGeometry\r\n\t */\r\n\tpublic static getClass(texture:TextureBase):ITextureVOClass\r\n\t{\r\n\t\treturn TextureVOPool.classPool[texture.assetType];\r\n\t}\r\n\r\n\tprivate static main = TextureVOPool.addDefaults();\r\n\r\n\tprivate static addDefaults()\r\n\t{\r\n\t\tTextureVOPool.registerClass(Single2DTextureVO);\r\n\t\tTextureVOPool.registerClass(SingleCubeTextureVO);\r\n\t}\r\n}\r\n\r\nexport = TextureVOPool;",
    "import IAssetClass\t\t\t\t\t= require(\"awayjs-core/lib/library/IAssetClass\");\r\n\r\nimport ContextGLDrawMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLDrawMode\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\n\r\nimport ShaderBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/shaders/ShaderRegisterElement\");\r\nimport SubGeometryVOPool\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOPool\");\r\nimport SubGeometryVOBase\t\t\t= require(\"awayjs-renderergl/lib/vos/SubGeometryVOBase\");\r\n\r\n/**\r\n *\r\n * @class away.pool.TriangleSubGeometryVO\r\n */\r\nclass TriangleSubGeometryVO extends SubGeometryVOBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static assetClass:IAssetClass = TriangleSubGeometry;\r\n\r\n\tprivate _triangleSubGeometry:TriangleSubGeometry;\r\n\r\n\tconstructor(pool:SubGeometryVOPool, triangleSubGeometry:TriangleSubGeometry)\r\n\t{\r\n\t\tsuper(pool, triangleSubGeometry);\r\n\r\n\t\tthis._triangleSubGeometry = triangleSubGeometry;\r\n\r\n\t\tthis.invalidateVertices(this._triangleSubGeometry.positions);\r\n\t\tthis.invalidateVertices(this._triangleSubGeometry.normals);\r\n\t\tthis.invalidateVertices(this._triangleSubGeometry.tangents);\r\n\t\tthis.invalidateVertices(this._triangleSubGeometry.uvs);\r\n\t\tthis.invalidateVertices(this._triangleSubGeometry.secondaryUVs);\r\n\t\tthis.invalidateVertices(this._triangleSubGeometry.jointIndices);\r\n\t\tthis.invalidateVertices(this._triangleSubGeometry.jointWeights);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tsuper.dispose();\r\n\r\n\t\tthis.disposeVertices(this._triangleSubGeometry.positions);\r\n\t\tthis.disposeVertices(this._triangleSubGeometry.normals);\r\n\t\tthis.disposeVertices(this._triangleSubGeometry.tangents);\r\n\t\tthis.disposeVertices(this._triangleSubGeometry.uvs);\r\n\t\tthis.disposeVertices(this._triangleSubGeometry.secondaryUVs);\r\n\t\tthis.disposeVertices(this._triangleSubGeometry.jointIndices);\r\n\t\tthis.disposeVertices(this._triangleSubGeometry.jointWeights);\r\n\r\n\t\tthis._triangleSubGeometry = null;\r\n\t}\r\n\r\n\tpublic _render(shader:ShaderBase, stage:Stage)\r\n\t{\r\n\t\tif (shader.uvBufferIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.uvBufferIndex, this._triangleSubGeometry.uvs, stage);\r\n\r\n\t\tif (shader.secondaryUVBufferIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.secondaryUVBufferIndex, this._triangleSubGeometry.secondaryUVs, stage);\r\n\r\n\t\tif (shader.normalBufferIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.normalBufferIndex, this._triangleSubGeometry.normals, stage);\r\n\r\n\t\tif (shader.tangentBufferIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.tangentBufferIndex, this._triangleSubGeometry.tangents, stage);\r\n\r\n\t\tif (shader.jointIndexIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.jointIndexIndex, this._triangleSubGeometry.jointIndices, stage);\r\n\r\n\t\tif (shader.jointWeightIndex >= 0)\r\n\t\t\tthis.activateVertexBufferVO(shader.jointIndexIndex, this._triangleSubGeometry.jointWeights, stage);\r\n\r\n\t\tthis.activateVertexBufferVO(0, this._triangleSubGeometry.positions, stage);\r\n\r\n\r\n\t\tsuper._render(shader, stage);\r\n\t}\r\n\r\n\tpublic _drawElements(firstIndex:number, numIndices:number, stage:Stage)\r\n\t{\r\n\t\tthis.getIndexBufferVO(stage).draw(ContextGLDrawMode.TRIANGLES, 0, numIndices);\r\n\t}\r\n\r\n\tpublic _drawArrays(firstVertex:number, numVertices:number, stage:Stage)\r\n\t{\r\n\t\tstage.context.drawVertices(ContextGLDrawMode.TRIANGLES, firstVertex, numVertices);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.TriangleSubMeshRenderable}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetOverflowSubGeometry():SubGeometryVOBase\r\n\t{\r\n\t\treturn new TriangleSubGeometryVO(this._pool, this._triangleSubGeometry);\r\n\t}\r\n}\r\n\r\nexport = TriangleSubGeometryVO;"
  ],
  "sourceRoot": ""
}