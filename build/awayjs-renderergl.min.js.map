{
  "version": 3,
  "sources": [
    "node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "awayjs-renderergl.js",
    "awayjs-renderergl/lib/DefaultRenderer.ts",
    "awayjs-renderergl/lib/DepthRenderer.ts",
    "awayjs-renderergl/lib/DistanceRenderer.ts",
    "awayjs-renderergl/lib/Filter3DRenderer.ts",
    "awayjs-renderergl/lib/animators/AnimationSetBase.ts",
    "awayjs-renderergl/lib/animators/AnimatorBase.ts",
    "awayjs-renderergl/lib/animators/ParticleAnimationSet.ts",
    "awayjs-renderergl/lib/animators/ParticleAnimator.ts",
    "awayjs-renderergl/lib/animators/SkeletonAnimationSet.ts",
    "awayjs-renderergl/lib/animators/SkeletonAnimator.ts",
    "awayjs-renderergl/lib/animators/VertexAnimationSet.ts",
    "awayjs-renderergl/lib/animators/VertexAnimator.ts",
    "awayjs-renderergl/lib/animators/data/AnimationRegisterCache.ts",
    "awayjs-renderergl/lib/animators/data/AnimationSubGeometry.ts",
    "awayjs-renderergl/lib/animators/data/ColorSegmentPoint.ts",
    "awayjs-renderergl/lib/animators/data/JointPose.ts",
    "awayjs-renderergl/lib/animators/data/ParticleAnimationData.ts",
    "awayjs-renderergl/lib/animators/data/ParticleData.ts",
    "awayjs-renderergl/lib/animators/data/ParticlePropertiesMode.ts",
    "awayjs-renderergl/lib/animators/data/ParticleProperties.ts",
    "awayjs-renderergl/lib/animators/data/SkeletonJoint.ts",
    "awayjs-renderergl/lib/animators/data/SkeletonPose.ts",
    "awayjs-renderergl/lib/animators/data/Skeleton.ts",
    "awayjs-renderergl/lib/animators/data/VertexAnimationMode.ts",
    "awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleColorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleFollowNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleNodeBase.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticlePositionNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleScaleNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleTimeNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleUVNode.ts",
    "awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonClipNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode.ts",
    "awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode.ts",
    "awayjs-renderergl/lib/animators/nodes/VertexClipNode.ts",
    "awayjs-renderergl/lib/animators/states/AnimationClipState.ts",
    "awayjs-renderergl/lib/animators/states/AnimationStateBase.ts",
    "awayjs-renderergl/lib/animators/states/ParticleAccelerationState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleBezierCurveState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleBillboardState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleColorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleFollowState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleInitialColorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleOrbitState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleOscillatorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticlePositionState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleScaleState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleStateBase.ts",
    "awayjs-renderergl/lib/animators/states/ParticleTimeState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleUVState.ts",
    "awayjs-renderergl/lib/animators/states/ParticleVelocityState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonClipState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonDifferenceState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonDirectionalState.ts",
    "awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState.ts",
    "awayjs-renderergl/lib/animators/states/VertexClipState.ts",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode.ts",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState.ts",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransition.ts",
    "awayjs-renderergl/lib/base/ParticleGeometry.ts",
    "awayjs-renderergl/lib/base/RendererBase.ts",
    "awayjs-renderergl/lib/compilation/DepthRenderObject.ts",
    "awayjs-renderergl/lib/compilation/DistanceRenderObject.ts",
    "awayjs-renderergl/lib/compilation/RegisterPool.ts",
    "awayjs-renderergl/lib/compilation/RenderBasicMaterialObject.ts",
    "awayjs-renderergl/lib/compilation/RenderObjectBase.ts",
    "awayjs-renderergl/lib/compilation/RenderObjectPool.ts",
    "awayjs-renderergl/lib/compilation/ShaderCompilerBase.ts",
    "awayjs-renderergl/lib/compilation/ShaderLightingCompiler.ts",
    "awayjs-renderergl/lib/compilation/ShaderLightingObject.ts",
    "awayjs-renderergl/lib/compilation/ShaderObjectBase.ts",
    "awayjs-renderergl/lib/compilation/ShaderRegisterCache.ts",
    "awayjs-renderergl/lib/compilation/ShaderRegisterData.ts",
    "awayjs-renderergl/lib/compilation/ShaderRegisterElement.ts",
    "awayjs-renderergl/lib/compilation/SkyboxRenderObject.ts",
    "awayjs-renderergl/lib/errors/AnimationSetError.ts",
    "awayjs-renderergl/lib/events/AnimationStateEvent.ts",
    "awayjs-renderergl/lib/events/AnimatorEvent.ts",
    "awayjs-renderergl/lib/events/ShadingMethodEvent.ts",
    "awayjs-renderergl/lib/filters/Filter3DBase.ts",
    "awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase.ts",
    "awayjs-renderergl/lib/managers/DefaultMaterialManager.ts",
    "awayjs-renderergl/lib/managers/RTTBufferManager.ts",
    "awayjs-renderergl/lib/passes/BasicMaterialPass.ts",
    "awayjs-renderergl/lib/passes/DepthPass.ts",
    "awayjs-renderergl/lib/passes/DistancePass.ts",
    "awayjs-renderergl/lib/passes/RenderPassBase.ts",
    "awayjs-renderergl/lib/passes/SkyboxPass.ts",
    "awayjs-renderergl/lib/pick/JSPickingCollider.ts",
    "awayjs-renderergl/lib/pick/PickingColliderBase.ts",
    "awayjs-renderergl/lib/pick/ShaderPicker.ts",
    "awayjs-renderergl/lib/pool/BillboardRenderable.ts",
    "awayjs-renderergl/lib/pool/CurveSubMeshRenderable.ts",
    "awayjs-renderergl/lib/pool/LineSegmentRenderable.ts",
    "awayjs-renderergl/lib/pool/LineSubMeshRenderable.ts",
    "awayjs-renderergl/lib/pool/RenderableBase.ts",
    "awayjs-renderergl/lib/pool/RenderablePoolBase.ts",
    "awayjs-renderergl/lib/pool/RendererPoolBase.ts",
    "awayjs-renderergl/lib/pool/SkyboxRenderable.ts",
    "awayjs-renderergl/lib/pool/TriangleSubMeshRenderable.ts",
    "awayjs-renderergl/lib/tools/commands/Merge.ts",
    "awayjs-renderergl/lib/tools/data/ParticleGeometryTransform.ts",
    "awayjs-renderergl/lib/utils/ParticleGeometryHelper.ts",
    "awayjs-renderergl/lib/utils/PerspectiveMatrix3D.ts",
    "awayjs-renderergl/lib/utils/ShaderCompilerHelper.ts"
  ],
  "names": [
    "require",
    "e",
    "t",
    "n",
    "r",
    "s",
    "o",
    "u",
    "a",
    "i",
    "f",
    "Error",
    "code",
    "l",
    "exports",
    "call",
    "length",
    "awayjs-renderergl/lib/DefaultRenderer",
    "module",
    "__extends",
    "this",
    "d",
    "b",
    "p",
    "hasOwnProperty",
    "__",
    "constructor",
    "prototype",
    "Matrix3D",
    "Vector3D",
    "RenderTexture",
    "ContextGLCompareMode",
    "ContextGLClearMask",
    "DepthRenderer",
    "DistanceRenderer",
    "Filter3DRenderer",
    "RendererBase",
    "RenderablePoolBase",
    "SkyboxRenderable",
    "RTTBufferManager",
    "DefaultRenderer",
    "_super",
    "rendererPoolClass",
    "stage",
    "_skyboxProjection",
    "_width",
    "width",
    "window",
    "innerWidth",
    "_pRttBufferManager",
    "viewWidth",
    "_height",
    "height",
    "innerHeight",
    "viewHeight",
    "Object",
    "defineProperty",
    "get",
    "_antiAlias",
    "set",
    "value",
    "_pBackBufferInvalid",
    "enumerable",
    "configurable",
    "_depthPrepass",
    "_pFilter3DRenderer",
    "filters",
    "dispose",
    "_pStage",
    "_pRequireDepthRender",
    "requireDepthRender",
    "_pDepthRender",
    "render",
    "entityCollector",
    "recoverFromDisposal",
    "pUpdateBackBuffer",
    "_shareContext",
    "_pContext",
    "clear",
    "DEPTH",
    "textureRatioX",
    "textureRatioY",
    "pRenderSceneDepthToTexture",
    "pRenderDepthPrepass",
    "_iRender",
    "_pScissorRect",
    "present",
    "bufferClear",
    "pExecuteRender",
    "target",
    "scissorRect",
    "surfaceSelector",
    "updateLights",
    "dirLights",
    "directionalLights",
    "pointLights",
    "len",
    "light",
    "shadowMapper",
    "castsShadows",
    "autoUpdateShadows",
    "_iShadowsInvalid",
    "iRenderDepthMap",
    "_pDepthRenderer",
    "_pDistanceRenderer",
    "pDraw",
    "skyBox",
    "setDepthTest",
    "ALWAYS",
    "drawSkybox",
    "_pGetRenderObject",
    "renderable",
    "renderObjectOwner",
    "getRenderObject",
    "_pool",
    "_skyboxRenderablePool",
    "getItem",
    "camera",
    "updateSkyboxProjection",
    "renderObject",
    "pass",
    "passes",
    "activatePass",
    "deactivatePass",
    "near",
    "copyFrom",
    "_pRttViewProjectionMatrix",
    "copyRowTo",
    "camPos",
    "scenePosition",
    "cx",
    "x",
    "cy",
    "y",
    "cz",
    "z",
    "cw",
    "Math",
    "sqrt",
    "signX",
    "signY",
    "inverse",
    "clone",
    "invert",
    "q",
    "transformVector",
    "w",
    "copyRowFrom",
    "disableColor",
    "_pDepthTextureInvalid",
    "initDepthTexture",
    "context",
    "configureBackBuffer",
    "iSetStage",
    "getInstance",
    "_pRendererPoolClass",
    "getPool",
    "textureWidth",
    "textureHeight",
    "awayjs-core/lib/geom/Matrix3D",
    "undefined",
    "awayjs-core/lib/geom/Vector3D",
    "awayjs-core/lib/textures/RenderTexture",
    "awayjs-renderergl/lib/DepthRenderer",
    "awayjs-renderergl/lib/DistanceRenderer",
    "awayjs-renderergl/lib/Filter3DRenderer",
    "awayjs-renderergl/lib/base/RendererBase",
    "awayjs-renderergl/lib/managers/RTTBufferManager",
    "awayjs-renderergl/lib/pool/RenderablePoolBase",
    "awayjs-renderergl/lib/pool/SkyboxRenderable",
    "awayjs-stagegl/lib/base/ContextGLClearMask",
    "awayjs-stagegl/lib/base/ContextGLCompareMode",
    "_iBackgroundR",
    "_iBackgroundG",
    "_iBackgroundB",
    "getDepthRenderObject",
    "getDistanceRenderObject",
    "Event",
    "ContextGLBlendFactor",
    "ContextGLVertexBufferFormat",
    "_this",
    "_filterSizesInvalid",
    "_onRTTResizeDelegate",
    "event",
    "onRTTResize",
    "_stage",
    "_rttManager",
    "addEventListener",
    "RESIZE",
    "_requireDepthRender",
    "getMainInputTexture",
    "_filterTasksInvalid",
    "updateFilterTasks",
    "_mainInputTexture",
    "_filters",
    "updateFilterSizes",
    "_tasks",
    "Array",
    "filter",
    "setRenderTargets",
    "concat",
    "tasks",
    "depthTexture",
    "task",
    "indexBuffer",
    "vertexBuffer",
    "renderToTextureVertexBuffer",
    "update",
    "setVertexBufferAt",
    "FLOAT_2",
    "renderToScreenVertexBuffer",
    "setTextureAt",
    "setProgram",
    "getProgram",
    "activate",
    "setBlendFactors",
    "ONE",
    "ZERO",
    "drawTriangles",
    "deactivate",
    "removeEventListener",
    "awayjs-core/lib/events/Event",
    "awayjs-stagegl/lib/base/ContextGLBlendFactor",
    "awayjs-stagegl/lib/base/ContextGLVertexBufferFormat",
    "awayjs-renderergl/lib/animators/AnimationSetBase",
    "AssetType",
    "NamedAssetBase",
    "AbstractMethodError",
    "AnimationSetError",
    "AnimationSetBase",
    "_animations",
    "_animationNames",
    "_animationDictionary",
    "_pFindTempReg",
    "exclude",
    "excludeAnother",
    "reg",
    "indexOf",
    "_usesCPU",
    "resetGPUCompatibility",
    "cancelGPUCompatibility",
    "getAGALVertexCode",
    "shaderObject",
    "getAGALFragmentCode",
    "shadedTarget",
    "getAGALUVCode",
    "doneAGALCode",
    "ANIMATION_SET",
    "hasAnimation",
    "name",
    "getAnimation",
    "addAnimation",
    "node",
    "push",
    "awayjs-core/lib/errors/AbstractMethodError",
    "awayjs-core/lib/library/AssetType",
    "awayjs-core/lib/library/NamedAssetBase",
    "awayjs-renderergl/lib/errors/AnimationSetError",
    "awayjs-renderergl/lib/animators/AnimatorBase",
    "RequestAnimationFrame",
    "getTimer",
    "AnimatorEvent",
    "AnimatorBase",
    "animationSet",
    "_autoUpdate",
    "_time",
    "_playbackSpeed",
    "_pOwners",
    "_pAbsoluteTime",
    "_animationStates",
    "updatePosition",
    "_pAnimationSet",
    "_broadcaster",
    "onEnterFrame",
    "getAnimationState",
    "className",
    "stateClass",
    "uID",
    "id",
    "getAnimationStateByName",
    "_pActiveState",
    "_pActiveAnimationName",
    "start",
    "stop",
    "phase",
    "setRenderState",
    "vertexConstantOffset",
    "vertexStreamOffset",
    "_isPlaying",
    "hasEventListener",
    "START",
    "_startEvent",
    "dispatchEvent",
    "STOP",
    "_stopEvent",
    "time",
    "dt",
    "playbackSpeed",
    "_pUpdateDeltaTime",
    "reset",
    "offset",
    "addOwner",
    "mesh",
    "removeOwner",
    "splice",
    "applyPositionDelta",
    "delta",
    "positionDelta",
    "dist",
    "translateLocal",
    "dispatchCycleEvent",
    "CYCLE_COMPLETE",
    "_cycleEvent",
    "testGPUCompatibility",
    "ANIMATOR",
    "getRenderableSubGeometry",
    "sourceSubGeometry",
    "awayjs-core/lib/utils/RequestAnimationFrame",
    "awayjs-core/lib/utils/getTimer",
    "awayjs-renderergl/lib/events/AnimatorEvent",
    "awayjs-renderergl/lib/animators/ParticleAnimationSet",
    "AnimationRegisterCache",
    "AnimationSubGeometry",
    "ParticleAnimationData",
    "ParticleProperties",
    "ParticlePropertiesMode",
    "ParticleTimeNode",
    "ParticleAnimationSet",
    "usesDuration",
    "usesLooping",
    "usesDelay",
    "_animationSubGeometries",
    "_particleNodes",
    "_localDynamicNodes",
    "_localStaticNodes",
    "_totalLenOfOneVertex",
    "_timeNode",
    "_iProcessAnimationSetting",
    "mode",
    "LOCAL_STATIC",
    "_iDataOffset",
    "dataLength",
    "LOCAL_DYNAMIC",
    "priority",
    "_iAnimationRegisterCache",
    "animationRegisterCache",
    "profile",
    "numUsedVertexConstants",
    "vertexAttributesOffset",
    "numUsedStreams",
    "varyingsOffset",
    "numUsedVaryings",
    "fragmentConstantOffset",
    "numUsedFragmentConstants",
    "hasUVNode",
    "needVelocity",
    "hasBillboard",
    "sourceRegisters",
    "animatableAttributes",
    "targetRegisters",
    "animationTargetRegisters",
    "needFragmentAnimation",
    "usesFragmentAnimation",
    "needUVAnimation",
    "usesUVTransform",
    "hasColorAddNode",
    "hasColorMulNode",
    "getInitCode",
    "POST_PRIORITY",
    "getCombinationCode",
    "COLOR_PRIORITY",
    "initColorRegisters",
    "getColorPassCode",
    "setUVSourceAndTarget",
    "uvSource",
    "uvTarget",
    "uvAttribute",
    "toString",
    "uvVar",
    "getColorCombinationCode",
    "setDataLength",
    "setVertexConst",
    "vertexZeroConst",
    "index",
    "key",
    "getAnimationSubGeometry",
    "subMesh",
    "parentMesh",
    "animationSubGeometry",
    "subGeometry",
    "_iGenerateAnimationSubGeometries",
    "initParticleFunc",
    "geometry",
    "j",
    "k",
    "newAnimationSubGeometry",
    "localNode",
    "subMeshes",
    "shareAnimationGeometry",
    "createVertexData",
    "numVertices",
    "particles",
    "particlesLength",
    "numParticles",
    "particleProperties",
    "particle",
    "oneDataLen",
    "oneDataOffset",
    "counterForVertex",
    "counterForOneData",
    "oneData",
    "vertexData",
    "vertexLength",
    "startingOffset",
    "vertexOffset",
    "total",
    "startTime",
    "duration",
    "delay",
    "initParticleScope",
    "_iGeneratePropertyOfOneParticle",
    "particleIndex",
    "numProcessedVertices",
    "animationParticles",
    "awayjs-renderergl/lib/animators/data/AnimationRegisterCache",
    "awayjs-renderergl/lib/animators/data/AnimationSubGeometry",
    "awayjs-renderergl/lib/animators/data/ParticleAnimationData",
    "awayjs-renderergl/lib/animators/data/ParticleProperties",
    "awayjs-renderergl/lib/animators/data/ParticlePropertiesMode",
    "awayjs-renderergl/lib/animators/nodes/ParticleTimeNode",
    "awayjs-renderergl/lib/animators/ParticleAnimator",
    "ContextGLProgramType",
    "ParticleAnimator",
    "particleAnimationSet",
    "_animationParticleStates",
    "_animatorParticleStates",
    "_timeParticleStates",
    "_animatorSubGeometries",
    "_particleAnimationSet",
    "state",
    "particleNodes",
    "needUpdateTime",
    "animatorSubGeometry",
    "getAnimatorSubGeometry",
    "setProgramConstantsFromArray",
    "VERTEX",
    "vertexConstantData",
    "numVertexConstant",
    "numFragmentConstant",
    "FRAGMENT",
    "fragmentConstantData",
    "resetTime",
    "awayjs-stagegl/lib/base/ContextGLProgramType",
    "awayjs-renderergl/lib/animators/SkeletonAnimationSet",
    "SkeletonAnimationSet",
    "jointsPerVertex",
    "_jointsPerVertex",
    "indexOffset0",
    "indexOffset1",
    "indexOffset2",
    "indexStream",
    "weightStream",
    "indices",
    "weights",
    "temp1",
    "temp2",
    "dot",
    "src",
    "awayjs-renderergl/lib/animators/SkeletonAnimator",
    "TriangleSubGeometry",
    "SubGeometryEvent",
    "JointPose",
    "SkeletonPose",
    "AnimationStateEvent",
    "SkeletonAnimator",
    "skeleton",
    "forceCPU",
    "_globalPose",
    "_morphedSubGeometry",
    "_morphedSubGeometryDirty",
    "_skeleton",
    "_forceCPU",
    "_numJoints",
    "numJoints",
    "_globalMatrices",
    "_onTransitionCompleteDelegate",
    "onTransitionComplete",
    "_onIndicesUpdateDelegate",
    "onIndicesUpdate",
    "_onVerticesUpdateDelegate",
    "onVerticesUpdate",
    "_globalPropertiesDirty",
    "updateGlobalProperties",
    "_useCondensedIndices",
    "play",
    "transition",
    "NaN",
    "_pActiveNode",
    "getAnimationNode",
    "TRANSITION_COMPLETE",
    "_activeSkeletonState",
    "isNaN",
    "useCondensedIndices",
    "updateCondensedMatrices",
    "condensedIndexLookUp",
    "numCondensedJoints",
    "_condensedMatrices",
    "usesCPU",
    "morphSubGeometry",
    "activateBuffer",
    "getVertexData",
    "JOINT_INDEX_DATA",
    "getVertexOffset",
    "JOINT_INDEX_FORMAT",
    "JOINT_WEIGHT_DATA",
    "JOINT_WEIGHT_FORMAT",
    "srcIndex",
    "localToGlobalPose",
    "getSkeletonPose",
    "mtxOffset",
    "globalPoses",
    "jointPoses",
    "raw",
    "ox",
    "oy",
    "oz",
    "ow",
    "xy2",
    "xz2",
    "xw2",
    "yz2",
    "yw2",
    "zw2",
    "n11",
    "n12",
    "n13",
    "n21",
    "n22",
    "n23",
    "n31",
    "n32",
    "n33",
    "m11",
    "m12",
    "m13",
    "m14",
    "m21",
    "m22",
    "m23",
    "m24",
    "m31",
    "m32",
    "m33",
    "m34",
    "joints",
    "pose",
    "quat",
    "vec",
    "orientation",
    "translation",
    "inverseBindPose",
    "targetSubGeometry",
    "autoDeriveNormals",
    "autoDeriveTangents",
    "autoDeriveUVs",
    "INDICES_UPDATED",
    "VERTICES_UPDATED",
    "sourcePositions",
    "positions",
    "sourceNormals",
    "vertexNormals",
    "sourceTangents",
    "vertexTangents",
    "jointIndices",
    "jointWeights",
    "targetPositions",
    "targetNormals",
    "targetTangents",
    "vx",
    "vy",
    "vz",
    "nx",
    "ny",
    "nz",
    "tx",
    "ty",
    "tz",
    "weight",
    "vertX",
    "vertY",
    "vertZ",
    "normX",
    "normY",
    "normZ",
    "tangX",
    "tangY",
    "tangZ",
    "updatePositions",
    "updateVertexNormals",
    "updateVertexTangents",
    "sourcePose",
    "targetPose",
    "globalJointPose",
    "numJointPoses",
    "parentIndex",
    "joint",
    "parentPose",
    "or",
    "tr",
    "x1",
    "y1",
    "z1",
    "w1",
    "x2",
    "y2",
    "z2",
    "w2",
    "x3",
    "y3",
    "z3",
    "type",
    "animationNode",
    "animationState",
    "updateIndices",
    "morphGeometry",
    "dataType",
    "UV_DATA",
    "updateUVs",
    "uvs",
    "SECONDARY_UV_DATA",
    "secondaryUVs",
    "awayjs-display/lib/base/TriangleSubGeometry",
    "awayjs-display/lib/events/SubGeometryEvent",
    "awayjs-renderergl/lib/animators/data/JointPose",
    "awayjs-renderergl/lib/animators/data/SkeletonPose",
    "awayjs-renderergl/lib/events/AnimationStateEvent",
    "awayjs-renderergl/lib/animators/VertexAnimationSet",
    "VertexAnimationMode",
    "VertexAnimationSet",
    "numPoses",
    "blendMode",
    "_numPoses",
    "_blendMode",
    "ABSOLUTE",
    "getAbsoluteAGALCode",
    "getAdditiveAGALCode",
    "regs",
    "constantReg",
    "streamIndex",
    "tangentDependencies",
    "outputsNormals",
    "normalDependencies",
    "awayjs-renderergl/lib/animators/data/VertexAnimationMode",
    "awayjs-renderergl/lib/animators/VertexAnimator",
    "VertexDataPool",
    "VertexAnimator",
    "vertexAnimationSet",
    "_poses",
    "_weights",
    "_vertexAnimationSet",
    "_activeVertexState",
    "geometryFlag",
    "currentGeometry",
    "nextGeometry",
    "blendWeight",
    "_iInvalidateRenderableGeometries",
    "setNullPose",
    "subGeom",
    "subGeometries",
    "_iIndex",
    "getIndexData",
    "POSITION_DATA",
    "getOffset",
    "POSITION_FORMAT",
    "NORMAL_DATA",
    "NORMAL_FORMAT",
    "awayjs-stagegl/lib/pool/VertexDataPool",
    "ShaderRegisterCache",
    "ShaderRegisterElement",
    "indexDictionary",
    "rotationRegisters",
    "positionAttribute",
    "getRegisterFromString",
    "scaleAndRotateTarget",
    "addVertexTempUsages",
    "regName",
    "getFreeVertexConstant",
    "vertexOneConst",
    "vertexTwoConst",
    "positionTarget",
    "getFreeVertexVectorTemp",
    "velocityTarget",
    "vertexTime",
    "vertexLife",
    "tempTime",
    "UVAttribute",
    "UVVaring",
    "setRegisterIndex",
    "parameterIndex",
    "registerIndex",
    "getRegisterIndex",
    "colorMulTarget",
    "colorMulVary",
    "getFreeVarying",
    "colorAddTarget",
    "colorAddVary",
    "colorTarget",
    "addFragmentTempUsages",
    "temp",
    "split",
    "parseInt",
    "_numVertexConstant",
    "_numFragmentConstant",
    "_index",
    "setVertexConstFromArray",
    "data",
    "setVertexConstFromMatrix",
    "matrix",
    "rawData",
    "setFragmentConst",
    "awayjs-renderergl/lib/compilation/ShaderRegisterCache",
    "awayjs-renderergl/lib/compilation/ShaderRegisterElement",
    "_pVertexBuffer",
    "_pBufferContext",
    "_pBufferDirty",
    "previousTime",
    "Number",
    "NEGATIVE_INFINITY",
    "_iUniqueId",
    "SUBGEOM_ID_COUNT",
    "totalLenOfOneVertex",
    "_numVertices",
    "_pVertexData",
    "activateVertexBuffer",
    "bufferOffset",
    "format",
    "contextIndex",
    "stageIndex",
    "buffer",
    "createVertexBuffer",
    "uploadFromArray",
    "pop",
    "invalidateBuffer",
    "awayjs-renderergl/lib/animators/data/ColorSegmentPoint",
    "ColorSegmentPoint",
    "life",
    "color",
    "_life",
    "_color",
    "Quaternion",
    "toMatrix3D",
    "appendTranslation",
    "awayjs-core/lib/geom/Quaternion",
    "totalTime",
    "startVertexIndex",
    "awayjs-renderergl/lib/animators/data/ParticleData",
    "ParticleData",
    "GLOBAL",
    "awayjs-renderergl/lib/animators/data/SkeletonJoint",
    "SkeletonJoint",
    "SKELETON_POSE",
    "jointPoseFromName",
    "jointName",
    "jointPoseIndex",
    "jointPoseIndexFromName",
    "jointPose",
    "cloneJointPose",
    "thisJointPose",
    "awayjs-renderergl/lib/animators/data/Skeleton",
    "Skeleton",
    "jointFromName",
    "jointIndex",
    "jointIndexFromName",
    "SKELETON",
    "ADDITIVE",
    "awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase",
    "AnimationNodeBase",
    "AnimationClipNodeBase",
    "_pLooping",
    "_pTotalDuration",
    "_pStitchDirty",
    "_pStitchFinalFrame",
    "_pNumFrames",
    "_pDurations",
    "_pTotalDelta",
    "fixedFrameRate",
    "_pUpdateStitch",
    "_pLastFrame",
    "awayjs-display/lib/animators/nodes/AnimationNodeBase",
    "awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode",
    "ParticleNodeBase",
    "ParticleAccelerationState",
    "ParticleAccelerationNode",
    "acceleration",
    "_pStateClass",
    "_acceleration",
    "pGetAGALVertexCode",
    "accelerationValue",
    "_pMode",
    "getFreeVertexAttribute",
    "ACCELERATION_INDEX",
    "removeVertexTempUsage",
    "animator",
    "param",
    "tempAcceleration",
    "ACCELERATION_VECTOR3D",
    "_pOneData",
    "awayjs-renderergl/lib/animators/nodes/ParticleNodeBase",
    "awayjs-renderergl/lib/animators/states/ParticleAccelerationState",
    "awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode",
    "ParticleBezierCurveState",
    "ParticleBezierCurveNode",
    "controlPoint",
    "endPoint",
    "_iControlPoint",
    "_iEndPoint",
    "controlValue",
    "BEZIER_CONTROL_INDEX",
    "endValue",
    "BEZIER_END_INDEX",
    "rev_time",
    "time_2",
    "time_temp",
    "distance",
    "bezierControl",
    "BEZIER_CONTROL_VECTOR3D",
    "bezierEnd",
    "BEZIER_END_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleBezierCurveState",
    "awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode",
    "ParticleBillboardState",
    "ParticleBillboardNode",
    "billboardAxis",
    "_iBillboardAxis",
    "rotationMatrixRegister",
    "MATRIX_INDEX",
    "shaderRegisterElement",
    "awayjs-renderergl/lib/animators/states/ParticleBillboardState",
    "awayjs-renderergl/lib/animators/nodes/ParticleColorNode",
    "ColorTransform",
    "ParticleColorState",
    "ParticleColorNode",
    "usesMultiplier",
    "usesOffset",
    "usesCycle",
    "usesPhase",
    "startColor",
    "endColor",
    "cycleDuration",
    "cyclePhase",
    "_iUsesMultiplier",
    "_iUsesOffset",
    "_iUsesCycle",
    "_iUsesPhase",
    "_iStartColor",
    "_iEndColor",
    "_iCycleDuration",
    "_iCyclePhase",
    "cycleConst",
    "CYCLE_INDEX",
    "sin",
    "getFreeVertexSingleTemp",
    "startMultiplierValue",
    "deltaMultiplierValue",
    "START_MULTIPLIER_INDEX",
    "DELTA_MULTIPLIER_INDEX",
    "startOffsetValue",
    "deltaOffsetValue",
    "START_OFFSET_INDEX",
    "DELTA_OFFSET_INDEX",
    "COLOR_START_COLORTRANSFORM",
    "COLOR_END_COLORTRANSFORM",
    "redMultiplier",
    "greenMultiplier",
    "blueMultiplier",
    "alphaMultiplier",
    "redOffset",
    "greenOffset",
    "blueOffset",
    "alphaOffset",
    "awayjs-core/lib/geom/ColorTransform",
    "awayjs-renderergl/lib/animators/states/ParticleColorState",
    "awayjs-renderergl/lib/animators/nodes/ParticleFollowNode",
    "ParticleFollowState",
    "ParticleFollowNode",
    "usesPosition",
    "usesRotation",
    "smooth",
    "_iUsesPosition",
    "_iUsesRotation",
    "_iSmooth",
    "rotationAttribute",
    "FOLLOW_ROTATION_INDEX",
    "temp3",
    "temp4",
    "FOLLOW_POSITION_INDEX",
    "awayjs-renderergl/lib/animators/states/ParticleFollowState",
    "awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode",
    "ParticleInitialColorState",
    "ParticleInitialColorNode",
    "initialColor",
    "_iInitialColor",
    "multiplierValue",
    "MULTIPLIER_INDEX",
    "offsetValue",
    "OFFSET_INDEX",
    "COLOR_INITIAL_COLORTRANSFORM",
    "awayjs-renderergl/lib/animators/states/ParticleInitialColorState",
    "_pDataLength",
    "MODES",
    "_priority",
    1,
    2,
    "awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode",
    "ParticleOrbitState",
    "ParticleOrbitNode",
    "usesEulers",
    "radius",
    "eulers",
    "_iUsesEulers",
    "_iRadius",
    "_iEulers",
    "orbitRegister",
    "ORBIT_INDEX",
    "eulersMatrixRegister",
    "EULERS_INDEX",
    "cos",
    "degree",
    "orbit",
    "ORBIT_VECTOR3D",
    "PI",
    "awayjs-renderergl/lib/animators/states/ParticleOrbitState",
    "awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode",
    "ParticleOscillatorState",
    "ParticleOscillatorNode",
    "oscillator",
    "_iOscillator",
    "oscillatorRegister",
    "OSCILLATOR_INDEX",
    "dgree",
    "drift",
    "OSCILLATOR_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleOscillatorState",
    "awayjs-renderergl/lib/animators/nodes/ParticlePositionNode",
    "ParticlePositionState",
    "ParticlePositionNode",
    "position",
    "_iPosition",
    "POSITION_INDEX",
    "POSITION_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticlePositionState",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode",
    "ParticleRotateToHeadingState",
    "ParticleRotateToHeadingNode",
    "nrmVel",
    "xAxis",
    "R",
    "R_rev",
    "cos2",
    "tempSingle",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode",
    "ParticleRotateToPositionState",
    "ParticleRotateToPositionNode",
    "nrmDirection",
    "o_temp",
    "awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState",
    "awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode",
    "ParticleRotationalVelocityState",
    "ParticleRotationalVelocityNode",
    "rotationalVelocity",
    "_iRotationalVelocity",
    "rotationRegister",
    "ROTATIONALVELOCITY_INDEX",
    "Rtemp",
    "rotate",
    "ROTATIONALVELOCITY_VECTOR3D",
    "normalize",
    "awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState",
    "awayjs-renderergl/lib/animators/nodes/ParticleScaleNode",
    "ParticleScaleState",
    "ParticleScaleNode",
    "minScale",
    "maxScale",
    "_iMinScale",
    "_iMaxScale",
    "scaleRegister",
    "SCALE_INDEX",
    "scale",
    "SCALE_VECTOR3D",
    "abs",
    "awayjs-renderergl/lib/animators/states/ParticleScaleState",
    "awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode",
    "ParticleSegmentedColorState",
    "ParticleSegmentedColorNode",
    "numSegmentPoint",
    "segmentPoints",
    "_iNumSegmentPoint",
    "_iSegmentPoints",
    "accMultiplierColor",
    "tempColor",
    "accTime",
    "lifeTimeRegister",
    "TIME_DATA_INDEX",
    "startMulValue",
    "deltaMulValues",
    "deltaOffsetValues",
    "awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState",
    "awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode",
    "ParticleSpriteSheetState",
    "ParticleSpriteSheetNode",
    "numColumns",
    "numRows",
    "totalFrames",
    "MAX_VALUE",
    "_iNumColumns",
    "_iNumRows",
    "_iTotalFrames",
    "min",
    "uvParamConst1",
    "uvParamConst2",
    "UV_INDEX_0",
    "UV_INDEX_1",
    "uTotal",
    "uStep",
    "vStep",
    "uSpeed",
    "cycle",
    "phaseTime",
    "vOffset",
    "v",
    "uvCycle",
    "UV_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState",
    "ParticleTimeState",
    "_iUsesDuration",
    "_iUsesLooping",
    "_iUsesDelay",
    "timeStreamRegister",
    "TIME_STREAM_INDEX",
    "timeConst",
    "TIME_CONSTANT_INDEX",
    "div",
    "sge",
    "awayjs-renderergl/lib/animators/states/ParticleTimeState",
    "awayjs-renderergl/lib/animators/nodes/ParticleUVNode",
    "ParticleUVState",
    "ParticleUVNode",
    "axis",
    "_cycle",
    "_scale",
    "_axis",
    "updateUVData",
    "uvConst",
    "UV_INDEX",
    "axisIndex",
    "_iUvData",
    "U_AXIS",
    "V_AXIS",
    "awayjs-renderergl/lib/animators/states/ParticleUVState",
    "awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode",
    "ParticleVelocityState",
    "ParticleVelocityNode",
    "velocity",
    "_iVelocity",
    "velocityValue",
    "VELOCITY_INDEX",
    "_tempVelocity",
    "VELOCITY_VECTOR3D",
    "awayjs-renderergl/lib/animators/states/ParticleVelocityState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode",
    "SkeletonBinaryLERPState",
    "SkeletonBinaryLERPNode",
    "awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonClipNode",
    "SkeletonClipState",
    "SkeletonClipNode",
    "_frames",
    "highQuality",
    "addFrame",
    "skeletonPose",
    "p1",
    "p2",
    "subtract",
    "awayjs-renderergl/lib/animators/states/SkeletonClipState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode",
    "SkeletonDifferenceState",
    "SkeletonDifferenceNode",
    "awayjs-renderergl/lib/animators/states/SkeletonDifferenceState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode",
    "SkeletonDirectionalState",
    "SkeletonDirectionalNode",
    "awayjs-renderergl/lib/animators/states/SkeletonDirectionalState",
    "awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode",
    "SkeletonNaryLERPState",
    "SkeletonNaryLERPNode",
    "_iInputs",
    "_numInputs",
    "getInputIndex",
    "input",
    "getInputAt",
    "addInput",
    "awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState",
    "awayjs-renderergl/lib/animators/nodes/VertexClipNode",
    "VertexClipState",
    "VertexClipNode",
    "_translations",
    "awayjs-renderergl/lib/animators/states/VertexClipState",
    "awayjs-renderergl/lib/animators/states/AnimationClipState",
    "AnimationStateBase",
    "AnimationClipState",
    "animationClipNode",
    "_pFramesDirty",
    "_animationClipNode",
    "_pUpdateFrames",
    "_pBlendWeight",
    "_pCurrentFrame",
    "_pNextFrame",
    "looping",
    "_pStartTime",
    "totalDuration",
    "_pTime",
    "_pUpdateTime",
    "_pTimeDir",
    "lastFrame",
    "notifyPlaybackComplete",
    "floor",
    "dur",
    "frameTime",
    "durations",
    "_animationStatePlaybackComplete",
    "PLAYBACK_COMPLETE",
    "_pAnimator",
    "awayjs-renderergl/lib/animators/states/AnimationStateBase",
    "_pRootDelta",
    "_pPositionDeltaDirty",
    "_pAnimationNode",
    "_pUpdatePositionDelta",
    "awayjs-renderergl/lib/animators/states/IAnimationState",
    "awayjs-renderergl/lib/animators/states/ISkeletonAnimationState",
    "awayjs-renderergl/lib/animators/states/IVertexAnimationState",
    "ParticleStateBase",
    "particleAccelerationNode",
    "_particleAccelerationNode",
    "updateAccelerationData",
    "FLOAT_3",
    "_halfAcceleration",
    "awayjs-renderergl/lib/animators/states/ParticleStateBase",
    "particleBezierCurveNode",
    "_particleBezierCurveNode",
    "_controlPoint",
    "_endPoint",
    "controlIndex",
    "endIndex",
    "MathConsts",
    "Orientation3D",
    "particleNode",
    "_matrix",
    "_billboardAxis",
    "comps",
    "pos",
    "sourceEntity",
    "sceneTransform",
    "look",
    "right",
    "crossProduct",
    "decompose",
    "AXIS_ANGLE",
    "copyColumnFrom",
    "appendRotation",
    "RADIANS_TO_DEGREES",
    "append",
    "inverseSceneTransform",
    "identity",
    "awayjs-core/lib/geom/MathConsts",
    "awayjs-core/lib/geom/Orientation3D",
    "particleColorNode",
    "_particleColorNode",
    "_usesMultiplier",
    "_usesOffset",
    "_usesCycle",
    "_usesPhase",
    "_startColor",
    "_endColor",
    "_cycleDuration",
    "_cyclePhase",
    "updateColorData",
    "dataOffset",
    "_cycleData",
    "FLOAT_4",
    "_startMultiplierData",
    "_deltaMultiplierData",
    "_startOffsetData",
    "_deltaOffsetData",
    "particleFollowNode",
    "_targetPos",
    "_targetEuler",
    "_temp",
    "_particleFollowNode",
    "_smooth",
    "_followTarget",
    "transform",
    "scaleX",
    "scaleY",
    "scaleZ",
    "rotationX",
    "rotationY",
    "rotationZ",
    "scaleBy",
    "DEGREES_TO_RADIANS",
    "_prePos",
    "_preEuler",
    "currentTime",
    "deltaTime",
    "needProcess",
    "processPositionAndRotation",
    "processPosition",
    "precessRotation",
    "changed",
    "interpolatedPos",
    "posVelocity",
    "inc",
    "add",
    "interpolatedRotation",
    "rotationVelocity",
    "particleInitialColorNode",
    "_particleInitialColorNode",
    "_initialColor",
    "_multiplierData",
    "_offsetData",
    "particleOrbitNode",
    "_particleOrbitNode",
    "_usesEulers",
    "_eulers",
    "_radius",
    "updateOrbitData",
    "_orbitData",
    "_eulersMatrix",
    "X_AXIS",
    "Y_AXIS",
    "Z_AXIS",
    "particleOscillatorNode",
    "_particleOscillatorNode",
    "_oscillator",
    "updateOscillatorData",
    "_oscillatorData",
    "particlePositionNode",
    "_particlePositionNode",
    "_position",
    "getPositions",
    "_pDynamicProperties",
    "setPositions",
    "_pDynamicPropertiesDirty",
    "_pUpdateDynamicProperties",
    "particleRotateToPositionNode",
    "_particleRotateToPositionNode",
    "_offset",
    "particleRotationNode",
    "_particleRotationalVelocityNode",
    "_rotationalVelocity",
    "updateRotationalVelocityData",
    "getRotationalVelocities",
    "setRotationalVelocities",
    "_rotationalVelocityData",
    "rotation",
    "particleScaleNode",
    "_particleScaleNode",
    "_minScale",
    "_maxScale",
    "updateScaleData",
    "_scaleData",
    "particleSegmentedColorNode",
    "_segmentPoints",
    "_numSegmentPoint",
    "_timeLifeData",
    "particleSpriteSheetNode",
    "_particleSpriteSheetNode",
    "_totalFrames",
    "_numColumns",
    "_numRows",
    "updateSpriteSheetData",
    "_spriteSheetData",
    "_particleNode",
    "_pNeedUpdateTime",
    "animationParticle",
    "particleTimeNode",
    "_particleTimeNode",
    "particleTime",
    "particleUVNode",
    "_particleUVNode",
    "particleVelocityNode",
    "_particleVelocityNode",
    "_velocity",
    "getVelocities",
    "setVelocities",
    "skeletonAnimationNode",
    "_blendWeight",
    "_skeletonPose",
    "_skeletonPoseDirty",
    "_skeletonAnimationNode",
    "_inputA",
    "inputA",
    "_inputB",
    "inputB",
    "updateSkeletonPose",
    "deltA",
    "deltB",
    "endPose",
    "endPoses",
    "poses1",
    "poses2",
    "pose1",
    "pose2",
    "lerp",
    "skeletonClipNode",
    "_rootPos",
    "_skeletonClipNode",
    "frames",
    "_currentPose",
    "_nextPose",
    "currentPose",
    "nextPose",
    "slerp",
    "p3",
    "totalDelta",
    "_pOldFrame",
    "dx",
    "dy",
    "dz",
    "stitchFinalFrame",
    "_baseInput",
    "baseInput",
    "_differenceInput",
    "differenceInput",
    "basePoses",
    "diffPoses",
    "base",
    "diff",
    "basePos",
    "diffPos",
    "_tempQuat",
    "multiply",
    "_direction",
    "_blendDirty",
    "_forward",
    "forward",
    "_backward",
    "backward",
    "_left",
    "left",
    "_right",
    "updateBlend",
    "_pUdateTime",
    "_blendWeights",
    "_inputs",
    "numInputs",
    "getBlendWeightAt",
    "setBlendWeightAt",
    "poses",
    "endTr",
    "endQuat",
    "firstPose",
    "w0",
    "x0",
    "y0",
    "z0",
    "vertexClipNode",
    "_vertexClipNode",
    "_currentGeometry",
    "_nextGeometry",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode",
    "CrossfadeTransitionState",
    "CrossfadeTransitionNode",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState",
    "_crossfadeTransitionNode",
    "startBlend",
    "blendSpeed",
    "_animationStateTransitionComplete",
    "awayjs-renderergl/lib/animators/transitions/CrossfadeTransition",
    "CrossfadeTransition",
    "startNode",
    "endNode",
    "crossFadeTransitionNode",
    "awayjs-renderergl/lib/animators/transitions/IAnimationTransition",
    "awayjs-renderergl/lib/base/ParticleGeometry",
    "Geometry",
    "ParticleGeometry",
    "apply",
    "arguments",
    "awayjs-display/lib/base/Geometry",
    "Point",
    "Rectangle",
    "EventDispatcher",
    "RenderableMergeSort",
    "RendererEvent",
    "StageEvent",
    "EntityCollector",
    "DefaultMaterialManager",
    "AGALMiniAssembler",
    "StageManager",
    "RendererPoolBase",
    "_numUsedStreams",
    "_numUsedTextures",
    "_viewPort",
    "_backgroundR",
    "_backgroundG",
    "_backgroundB",
    "_backgroundAlpha",
    "_localPos",
    "_globalPos",
    "_pNumTriangles",
    "_disableColor",
    "_renderBlended",
    "_onViewportUpdatedDelegate",
    "onViewportUpdated",
    "_onContextUpdateDelegate",
    "onContextUpdate",
    "renderableSorter",
    "_rendererPool",
    "getFreeStage",
    "updateGlobalPos",
    "notifyScissorUpdate",
    "shader",
    "numUsedTextures",
    "programData",
    "program",
    "createProgram",
    "vertexByteCode",
    "assemble",
    "vertexString",
    "fragmentByteCode",
    "fragmentString",
    "upload",
    "_iActivate",
    "_iDeactivate",
    "_iCreateEntityCollector",
    "CONTEXT_CREATED",
    "CONTEXT_RECREATED",
    "VIEWPORT_UPDATED",
    "_viewportDirty",
    "_scissorDirty",
    "viewProjection",
    "appendScale",
    "_iRenderCascades",
    "numCascades",
    "scissorRects",
    "cameras",
    "pCollectRenderables",
    "setRenderTarget",
    "LESS",
    "head",
    "_pOpaqueRenderableHead",
    "first",
    "LESS_EQUAL",
    "_pBlendedRenderableHead",
    "item",
    "entityHead",
    "_pCamera",
    "_iEntryPoint",
    "_pCameraForward",
    "forwardVector",
    "entity",
    "_iCollectRenderables",
    "next",
    "sortOpaqueRenderables",
    "sortBlendedRenderables",
    "_snapshotRequired",
    "_snapshotBitmapData",
    "drawToBitmapData",
    "queueSnapshot",
    "bmd",
    "setColorMask",
    "drawRenderables",
    "renderable2",
    "_renderObjectOwner",
    "alphaThreshold",
    "_scissorUpdated",
    "SCISSOR_UPDATED",
    "notifyViewportUpdate",
    "_viewPortUpdated",
    "viewPort",
    "applyRenderable",
    "getDefaultMaterial",
    "renderableOwner",
    "renderObjectId",
    "renderOrderId",
    "cascaded",
    "zIndex",
    "zOffset",
    "dotProduct",
    "renderSceneTransform",
    "getRenderSceneTransform",
    "requiresBlending",
    "numTriangles",
    "overflow",
    "awayjs-core/lib/events/EventDispatcher",
    "awayjs-core/lib/geom/Point",
    "awayjs-core/lib/geom/Rectangle",
    "awayjs-display/lib/events/RendererEvent",
    "awayjs-display/lib/events/StageEvent",
    "awayjs-display/lib/managers/DefaultMaterialManager",
    "awayjs-display/lib/sort/RenderableMergeSort",
    "awayjs-display/lib/traverse/EntityCollector",
    "awayjs-renderergl/lib/pool/RendererPoolBase",
    "awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler",
    "awayjs-stagegl/lib/managers/StageManager",
    "awayjs-renderergl/lib/compilation/DepthRenderObject",
    "RenderObjectBase",
    "DepthPass",
    "DepthRenderObject",
    "pool",
    "renderableClass",
    "_pAddScreenPass",
    "awayjs-renderergl/lib/compilation/RenderObjectBase",
    "awayjs-renderergl/lib/passes/DepthPass",
    "awayjs-renderergl/lib/compilation/DistanceRenderObject",
    "DistancePass",
    "DistanceRenderObject",
    "awayjs-renderergl/lib/passes/DistancePass",
    "awayjs-renderergl/lib/compilation/IRenderObjectClass",
    "awayjs-renderergl/lib/compilation/RegisterPool",
    "RegisterPool",
    "regCount",
    "persistent",
    "_regName",
    "_regCount",
    "_persistent",
    "initRegisters",
    "requestFreeVectorReg",
    "isRegisterUsed",
    "_usedVectorCount",
    "_vectorRegisters",
    "requestFreeRegComponent",
    "_usedSingleCount",
    "_registerComponents",
    "addUsage",
    "register",
    "usageCount",
    "_component",
    "removeUsage",
    "hasRegisteredRegs",
    "hash",
    "_initPool",
    "_regPool",
    "_regCompsPool",
    "_initArray",
    "vectorRegisters",
    "registerComponents",
    "val",
    "c",
    "awayjs-renderergl/lib/compilation/RenderBasicMaterialObject",
    "BlendMode",
    "BasicMaterialPass",
    "RenderBasicMaterialObject",
    "material",
    "_material",
    "_screenPass",
    "_pUpdateRenderObject",
    "_pRequiresBlending",
    "NORMAL",
    "alphaBlending",
    "colorTransform",
    "preserveAlpha",
    "setBlendMode",
    "LAYER",
    "awayjs-core/lib/base/BlendMode",
    "awayjs-renderergl/lib/passes/BasicMaterialPass",
    "_forceSeparateMVP",
    "_invalidAnimation",
    "_invalidRenderObject",
    "_passes",
    "_renderableClass",
    "_onPassChangeDelegate",
    "onPassChange",
    "_updateAnimation",
    "_renderOrderId",
    "_iIncludeDependencies",
    "useMipmapping",
    "mipmap",
    "useSmoothTextures",
    "assetType",
    "MATERIAL",
    "useAlphaPremultiplied",
    "alphaPremultiplied",
    "useBothSides",
    "bothSides",
    "repeatTextures",
    "repeat",
    "animateUVs",
    "texture",
    "_pClearScreenPasses",
    "disposeItem",
    "invalidateRenderObject",
    "invalidatePasses",
    "invalidatePass",
    "invalidateAnimation",
    "enabledGPUAnimation",
    "_getEnabledGPUAnimation",
    "mult",
    "usesAnimation",
    "invalidateProgram",
    "_pRemoveScreenPass",
    "CHANGE",
    "owners",
    "iOwners",
    "numOwners",
    "awayjs-renderergl/lib/compilation/RenderObjectPool",
    "RenderObjectPool",
    "renderObjectClass",
    "_renderObjectPool",
    "_renderObjectClass",
    "_iAddRenderObject",
    "_iRemoveRenderObject",
    "awayjs-renderergl/lib/compilation/ShaderCompilerBase",
    "ShaderRegisterData",
    "ShaderCompilerBase",
    "renderPass",
    "_pVertexCode",
    "_pFragmentCode",
    "_pPostAnimationFragmentCode",
    "_pRenderableClass",
    "_pRenderPass",
    "_pShaderObject",
    "_pSharedRegisters",
    "_pRegisterCache",
    "compile",
    "pIncludeDependencies",
    "pInitRegisterIndices",
    "pCompileDependencies",
    "_iGetVertexCode",
    "_iGetFragmentCode",
    "fragmentOutputRegister",
    "removeFragmentTempUsage",
    "initConstantData",
    "_pAnimatableAttributes",
    "_pAnimationTargetRegisters",
    "_uvSource",
    "_uvTarget",
    "_iInitConstantData",
    "_pOutputsNormals",
    "outputsTangentNormals",
    "_pOutputsTangentNormals",
    "usesTangentSpace",
    "_pUsesTangentSpace",
    "viewDirDependencies",
    "globalPosDependencies",
    "getFreeFragmentVectorTemp",
    "compileGlobalPositionCode",
    "localPosDependencies",
    "compileLocalPositionCode",
    "uvDependencies",
    "compileUVCode",
    "secondaryUVDependencies",
    "compileSecondaryUVCode",
    "compileNormalCode",
    "compileViewDirCode",
    "_iGetPreLightingVertexCode",
    "_iGetPreLightingFragmentCode",
    "globalPositionVertex",
    "sceneMatrixReg",
    "sceneMatrixIndex",
    "localPosition",
    "usesGlobalPosFragment",
    "globalPositionVarying",
    "localPositionVarying",
    "uvAttributeReg",
    "uvBufferIndex",
    "varying",
    "uvVarying",
    "uvTransform1",
    "uvTransform2",
    "uvTransformIndex",
    "secondaryUVBufferIndex",
    "secondaryUVVarying",
    "cameraPositionReg",
    "viewDirVarying",
    "viewDirFragment",
    "cameraPositionIndex",
    "animatedTangent",
    "normalFragment",
    "_iGetNormalVertexCode",
    "_iGetNormalFragmentCode",
    "normalMatrix",
    "sceneNormalMatrixIndex",
    "normalVarying",
    "animatedNormal",
    "bitangent",
    "tangentVarying",
    "bitangentVarying",
    "normalInput",
    "commons",
    "getFreeFragmentConstant",
    "commonsDataIndex",
    "tangentInput",
    "tangentBufferIndex",
    "normalBufferIndex",
    "colorDependencies",
    "colorInput",
    "colorBufferIndex",
    "colorVarying",
    "awayjs-renderergl/lib/compilation/ShaderRegisterData",
    "awayjs-renderergl/lib/compilation/ShaderLightingCompiler",
    "ShaderLightingCompiler",
    "renderLightingPass",
    "shaderLightingObject",
    "_shaderLightingObject",
    "_renderLightingPass",
    "usesShadows",
    "pCompileShadowCode",
    "usesLights",
    "initLightRegisters",
    "compileLightCode",
    "usesProbes",
    "compileLightProbeCode",
    "_iGetPostLightingVertexCode",
    "_iGetPostLightingFragmentCode",
    "shadowTarget",
    "_dirLightVertexConstants",
    "lightVertexConstantIndex",
    "_pointLightVertexConstants",
    "_dirLightFragmentConstants",
    "lightFragmentConstantIndex",
    "_pointLightFragmentConstants",
    "diffuseColorReg",
    "specularColorReg",
    "lightPosReg",
    "lightDirReg",
    "vertexRegIndex",
    "fragmentRegIndex",
    "addSpec",
    "usesLightsForSpecular",
    "addDiff",
    "usesLightsForDiffuse",
    "numDirectionalLights",
    "lightVarying",
    "_iGetPerLightDiffuseFragmentCode",
    "_iGetPerLightSpecularFragmentCode",
    "numPointLights",
    "usesLightFallOff",
    "weightReg",
    "weightComponents",
    "weightRegisters",
    "texReg",
    "usesProbesForSpecular",
    "usesProbesForDiffuse",
    "lightProbeDiffuseIndices",
    "lightProbeSpecularIndices",
    "_pNumProbeRegisters",
    "probeWeightsIndex",
    "numLightProbes",
    "getFreeTextureReg",
    "_iGetPerProbeDiffuseFragmentCode",
    "_iGetPerProbeSpecularFragmentCode",
    "ceil",
    "awayjs-renderergl/lib/compilation/ShaderLightingObject",
    "LightSources",
    "ContextGLProfile",
    "ShaderObjectBase",
    "ShaderLightingObject",
    "_includeCasters",
    "numAllLights",
    "diffuseLightSources",
    "_iUsesDiffuse",
    "specularLightSources",
    "_iUsesSpecular",
    "combinedLightSources",
    "enableLightFallOff",
    "BASELINE_CONSTRAINED",
    "numLights",
    "LIGHTS",
    "PROBES",
    "_iUsesShadows",
    "createCompiler",
    "lightPicker",
    "collectLights",
    "updateProbes",
    "dirLight",
    "pointLight",
    "dirPos",
    "numLightTypes",
    "ambientR",
    "ambientG",
    "ambientB",
    "cast",
    "directionalLightsOffset",
    "castingDirectionalLights",
    "sceneDirection",
    "_iAmbientR",
    "_iAmbientG",
    "_iAmbientB",
    "_pInverseSceneMatrix",
    "_iDiffuseR",
    "_iDiffuseG",
    "_iDiffuseB",
    "_iSpecularR",
    "_iSpecularG",
    "_iSpecularB",
    "pointLightsOffset",
    "castingPointLights",
    "_pRadius",
    "_pFallOffFactor",
    "probe",
    "lightProbes",
    "lightProbeWeights",
    "lightProbesOffset",
    "activateCubeTexture",
    "diffuseMap",
    "specularMap",
    "awayjs-display/lib/materials/LightSources",
    "awayjs-renderergl/lib/compilation/ShaderObjectBase",
    "awayjs-stagegl/lib/base/ContextGLProfile",
    "LineSubGeometry",
    "ContextGLTriangleFace",
    "_invalidShader",
    "_invalidProgram",
    "_animationVertexCode",
    "_animationFragmentCode",
    "_defaultCulling",
    "BACK",
    "_renderPass",
    "_updateProgram",
    "_programData",
    "projectionDependencies",
    "registerCache",
    "setCulling",
    "NONE",
    "projection",
    "coordinateSystem",
    "UV_FORMAT",
    "SECONDARY_UV_FORMAT",
    "TANGENT_DATA",
    "TANGENT_FORMAT",
    "COLOR_DATA",
    "COLOR_FORMAT",
    "uvTransform",
    "copyRawDataTo",
    "invalidateShader",
    "compiler",
    "_calcAnimationCode",
    "getProgramData",
    "vertexCode",
    "fragmentCode",
    "postAnimationFragmentCode",
    "usages",
    "awayjs-display/lib/base/LineSubGeometry",
    "awayjs-stagegl/lib/base/ContextGLTriangleFace",
    "_numUsedVertexConstants",
    "_numUsedFragmentConstants",
    "_numUsedVaryings",
    "_profile",
    "_fragmentTempCache",
    "_vertexTempCache",
    "_varyingCache",
    "_textureCache",
    "_vertexAttributesCache",
    "_fragmentConstantsCache",
    "_vertexConstantsCache",
    "_fragmentOutputRegister",
    "_vertexOutputRegister",
    "_vertexAttributesOffset",
    "_vertexConstantOffset",
    "_varyingsOffset",
    "_fragmentConstantOffset",
    "getFreeFragmentSingleTemp",
    "component",
    "_toStr",
    "COMPONENTS",
    "awayjs-renderergl/lib/compilation/SkyboxRenderObject",
    "SkyboxPass",
    "SkyboxRenderObject",
    "awayjs-renderergl/lib/passes/SkyboxPass",
    "message",
    "awayjs-core/lib/errors/Error",
    "_animator",
    "_animationState",
    "_animationNode",
    "awayjs-renderergl/lib/events/ShadingMethodEvent",
    "ShadingMethodEvent",
    "SHADER_INVALIDATED",
    "awayjs-renderergl/lib/filters/Filter3DBase",
    "Filter3DBase",
    "pAddTask",
    "_textureWidth",
    "_textureHeight",
    "mainTarget",
    "awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase",
    "ContextGLTextureFormat",
    "Filter3DTaskBase",
    "_scaledTextureWidth",
    "_scaledTextureHeight",
    "_textureDimensionsInvalid",
    "_program3DInvalid",
    "_textureScale",
    "_target",
    "pUpdateTextures",
    "_program3D",
    "pInvalidateProgram",
    "pUpdateProgram",
    "pGetVertexCode",
    "pGetFragmentCode",
    "createTexture",
    "BGRA",
    "awayjs-stagegl/lib/base/ContextGLTextureFormat",
    "awayjs-renderergl/lib/managers/DefaultMaterialManager",
    "BitmapData",
    "BitmapTexture",
    "BasicMaterial",
    "LINE_SUB_MESH",
    "_defaultLineMaterial",
    "createDefaultLineMaterial",
    "_defaultTriangleMaterial",
    "createDefaultTriangleMaterial",
    "getDefaultTexture",
    "_defaultTexture",
    "createDefaultTexture",
    "_defaultBitmapData",
    "createCheckeredBitmapData",
    "setPixel",
    "awayjs-core/lib/base/BitmapData",
    "awayjs-core/lib/textures/BitmapTexture",
    "awayjs-display/lib/materials/BasicMaterial",
    "TextureUtils",
    "_viewWidth",
    "_viewHeight",
    "_buffersInvalid",
    "_renderToTextureRect",
    "_instances",
    "rttBufferManager",
    "getRTTBufferManagerFromStage",
    "vo",
    "RTTBufferManagerVO",
    "stage3d",
    "rttbfm",
    "deleteRTTBufferManager",
    "updateRTTBuffers",
    "_textureRatioX",
    "_textureRatioY",
    "getBestPowerOf2",
    "_renderToTextureVertexBuffer",
    "_renderToScreenVertexBuffer",
    "_indexBuffer",
    "textureVerts",
    "screenVerts",
    "createIndexBuffer",
    "u1",
    "u2",
    "v1",
    "v2",
    "awayjs-core/lib/utils/TextureUtils",
    "ShaderCompilerHelper",
    "RenderPassBase",
    "_diffuseR",
    "_diffuseG",
    "_diffuseB",
    "_diffuseA",
    "_shader",
    "regCache",
    "sharedReg",
    "alphaReg",
    "targetReg",
    "diffuseInputReg",
    "_texturesIndex",
    "getTex2DSampleCode",
    "cutOffReg",
    "_fragmentConstantsIndex",
    "activateTexture",
    "awayjs-renderergl/lib/passes/RenderPassBase",
    "awayjs-renderergl/lib/utils/ShaderCompilerHelper",
    "sharedRegisters",
    "dataReg1",
    "dataReg2",
    "projectionFragment",
    "albedo",
    "far",
    "awayjs-renderergl/lib/passes/IRenderLightingPass",
    "awayjs-renderergl/lib/passes/IRenderPassBase",
    "ArgumentError",
    "_preserveAlpha",
    "_depthCompareMode",
    "_blendFactorSource",
    "_blendFactorDest",
    "_pEnableBlending",
    "_writeDepth",
    "_renderObject",
    "SOURCE_ALPHA",
    "ONE_MINUS_SOURCE_ALPHA",
    "MULTIPLY",
    "SOURCE_COLOR",
    "ADD",
    "ALPHA",
    "awayjs-core/lib/errors/ArgumentError",
    "_skybox",
    "mip",
    "getFormatStringForTexture",
    "cubeMap",
    "awayjs-renderergl/lib/pick/JSPickingCollider",
    "PickingColliderBase",
    "JSPickingCollider",
    "findClosestCollision",
    "_findClosestCollision",
    "_pTestRenderableCollision",
    "pickingCollisionVO",
    "shortestCollisionDistance",
    "i0",
    "i1",
    "i2",
    "rx",
    "ry",
    "rz",
    "coeff",
    "p0x",
    "p0y",
    "p0z",
    "p1x",
    "p1y",
    "p1z",
    "p2x",
    "p2y",
    "p2z",
    "s0x",
    "s0y",
    "s0z",
    "s1x",
    "s1y",
    "s1z",
    "nl",
    "nDotV",
    "D",
    "disToPlane",
    "Q1Q2",
    "Q1Q1",
    "Q2Q2",
    "RQ1",
    "RQ2",
    "indexData",
    "collisionTriangleIndex",
    "positionData",
    "positionStride",
    "dataPerVertex",
    "positionOffset",
    "uvData",
    "uvStride",
    "uvOffset",
    "numIndices",
    "rayDirection",
    "rayPosition",
    "rayEntryDistance",
    "localNormal",
    "uv",
    "_pGetCollisionUV",
    "awayjs-renderergl/lib/pick/PickingColliderBase",
    "BillboardRenderable",
    "TriangleSubMeshRenderable",
    "_billboardRenderablePool",
    "_subMeshRenderablePool",
    "_pPetCollisionNormal",
    "triangleIndex",
    "normal",
    "p0",
    "side0",
    "side1",
    "uIndex",
    "uv0",
    "uv1",
    "uv2",
    "setLocalRay",
    "localDirection",
    "testBillboardCollision",
    "billboard",
    "localRayPosition",
    "localRayDirection",
    "testMeshCollision",
    "findClosest",
    "awayjs-renderergl/lib/pool/BillboardRenderable",
    "awayjs-renderergl/lib/pool/TriangleSubMeshRenderable",
    "awayjs-renderergl/lib/pick/ShaderPicker",
    "Debug",
    "Matrix3DUtils",
    "ShaderPicker",
    "shaderPickingDetails",
    "_onlyMouseEnabled",
    "_interactives",
    "_localHitPosition",
    "_hitUV",
    "_localHitNormal",
    "_rayPos",
    "_rayDir",
    "_shaderPickingDetails",
    "_id",
    "_viewportData",
    "_boundOffsetScale",
    "getViewCollision",
    "view",
    "collector",
    "iEntityCollector",
    "renderer",
    "_context",
    "_projX",
    "_projY",
    "_potentialFound",
    "_blendedRenderableHead",
    "_opaqueRenderableHead",
    "_bitmapData",
    "_hitColor",
    "getPixel",
    "_hitRenderable",
    "_hitEntity",
    "_iIsMouseEnabled",
    "_collisionVO",
    "_iPickingCollisionVO",
    "getHitDetails",
    "_faceIndex",
    "getSceneCollision",
    "direction",
    "scene",
    "MOUSE_SCISSOR_RECT",
    "_interactiveId",
    "_objectProgram",
    "initObjectProgram",
    "CALCULATION_MATRIX",
    "setProgramConstantsFromMatrix",
    "getIndexBuffer",
    "updateRay",
    "getRay",
    "throwPIR",
    "initTriangleProgram",
    "_triangleProgram",
    "getApproximatePosition",
    "getPreciseDetails",
    "bounds",
    "getBox",
    "col",
    "scX",
    "scY",
    "scZ",
    "offsX",
    "offsY",
    "offsZ",
    "localViewProjection",
    "depth",
    "setScissorRectangle",
    "t1",
    "t2",
    "t3",
    "v0x",
    "v0y",
    "v0z",
    "v1x",
    "v1y",
    "v1z",
    "v2x",
    "v2y",
    "v2z",
    "ni1",
    "ni2",
    "ni3",
    "n1",
    "n2",
    "n3",
    "nLength",
    "dot00",
    "dot01",
    "dot02",
    "dot11",
    "dot12",
    "invDenom",
    "ui1",
    "ui2",
    "ui3",
    "normals",
    "normalStride",
    "normalOffset",
    "getPrecisePosition",
    "invSceneTransform",
    "px",
    "py",
    "pz",
    "RAW_DATA_CONTAINER",
    "awayjs-core/lib/geom/Matrix3DUtils",
    "awayjs-core/lib/utils/Debug",
    "RenderableBase",
    "_billboard",
    "_pGetSubGeometry",
    "_materialGeometry",
    "_pVertexDataDirty",
    "viewMatrixReg",
    "viewMatrixIndex",
    "matrix3D",
    "awayjs-renderergl/lib/pool/RenderableBase",
    "awayjs-renderergl/lib/pool/CurveSubMeshRenderable",
    "CurveSubGeometry",
    "CurveSubMeshRenderable",
    "level",
    "indexOffset",
    "_constants",
    "curves",
    "CURVE_DATA",
    "sd",
    "standardDerivatives",
    "curve",
    "curveX",
    "curveY",
    "out",
    "free",
    "free1",
    "free2",
    "less",
    "half",
    "pxx",
    "pxy",
    "pyx",
    "pyy",
    "fx",
    "fy",
    "CURVE_FORMAT",
    "_pGetOverflowRenderable",
    "_level",
    "awayjs-display/lib/base/CurveSubGeometry",
    "awayjs-renderergl/lib/pool/IRenderableClass",
    "awayjs-renderergl/lib/pool/IRendererPoolClass",
    "awayjs-renderergl/lib/pool/LineSegmentRenderable",
    "LineSegmentRenderable",
    "lineSegment",
    "_thickness",
    "_lineSegment",
    "_calcMatrix",
    "_lineGeometry",
    "START_POSITION_DATA",
    "END_POSITION_DATA",
    "THICKNESS_DATA",
    "startPostion",
    "end",
    "endPosition",
    "startPositions",
    "endPositions",
    "thickness",
    "updateThickness",
    "pONE_VECTOR",
    "pFRONT_VECTOR",
    "THICKNESS_FORMAT",
    "awayjs-renderergl/lib/pool/LineSubMeshRenderable",
    "LineSubMeshRenderable",
    "startColors",
    "SubGeometryBase",
    "RenderableOwnerEvent",
    "IndexDataPool",
    "_geometryDirty",
    "_indexDataDirty",
    "_vertexData",
    "_vertexOffset",
    "_onIndicesUpdatedDelegate",
    "_onIndicesUpdated",
    "_onVerticesUpdatedDelegate",
    "_onVerticesUpdated",
    "_onRenderObjectOwnerUpdatedDelegate",
    "_onRenderObjectOwnerUpdated",
    "_indexOffset",
    "RENDER_OBJECT_OWNER_UPDATED",
    "_updateIndexData",
    "_overflow",
    "_numTriangles",
    "_indexData",
    "_updateVertexData",
    "_concatenateArrays",
    "VERTEX_DATA",
    "invalidateGeometry",
    "invalidateIndexData",
    "invalidateVertexData",
    "_iFillIndexData",
    "_updateGeometry",
    "_subGeometry",
    "concatenateArrays",
    "awayjs-display/lib/base/SubGeometryBase",
    "awayjs-display/lib/events/RenderableOwnerEvent",
    "awayjs-stagegl/lib/pool/IndexDataPool",
    "_renderablePool",
    "_materialRenderObjectPool",
    "_skyboxRenderObjectPool",
    "_depthRenderObjectPool",
    "_distanceRenderObjectPool",
    "_iAddRenderable",
    "getMaterialRenderObject",
    "getSkyboxRenderObject",
    "_iRemoveRenderable",
    "disposePool",
    "pools",
    "_pools",
    "_renderer",
    "_pUpdatePool",
    "_lineSegmentRenderablePool",
    "_triangleSubMeshRenderablePool",
    "_lineSubMeshRenderablePool",
    "_curveSubMeshRenderablePool",
    "applyBillboard",
    "applyLineSegment",
    "applyTriangleSubMesh",
    "triangleSubMesh",
    "applyCurveSubMesh",
    "curveSubMesh",
    "applyLineSubMesh",
    "lineSubMesh",
    "skybox",
    "_vertexArray",
    "_geometry",
    "FLOAT_1",
    "awayjs-renderergl/lib/tools/commands/Merge",
    "Mesh",
    "Merge",
    "keepMaterial",
    "disposeSources",
    "objectSpace",
    "_keepMaterial",
    "_disposeSources",
    "_objectSpace",
    "applyToContainer",
    "receiver",
    "objectContainer",
    "parseContainer",
    "collect",
    "merge",
    "applyToMeshes",
    "meshes",
    "_toDispose",
    "_geomVOs",
    "destMesh",
    "subIdx",
    "oldGeom",
    "destGeom",
    "useSubMaterials",
    "sub",
    "vertices",
    "tangents",
    "addSubGeometry",
    "m",
    "calc",
    "iIdx",
    "vIdx",
    "nIdx",
    "tIdx",
    "uIdx",
    "pd",
    "nd",
    "td",
    "ud",
    "getSubGeomData",
    "transformVectors",
    "deltaTransformVectors",
    "GeometryVO",
    "object",
    "child",
    "numChildren",
    "getChildAt",
    "awayjs-display/lib/entities/Mesh",
    "awayjs-renderergl/lib/tools/data/ParticleGeometryTransform",
    "ParticleGeometryTransform",
    "_defaultVertexTransform",
    "_defaultInvVertexTransform",
    "transpose",
    "_defaultUVTransform",
    "awayjs-renderergl/lib/utils/ParticleGeometryHelper",
    "ParticleGeometryHelper",
    "generateGeometry",
    "geometries",
    "transforms",
    "indicesVector",
    "positionsVector",
    "normalsVector",
    "tangentsVector",
    "uvsVector",
    "vertexCounters",
    "sourceSubGeometries",
    "numSubGeometries",
    "vertexCounter",
    "sub2SubMap",
    "tempVertex",
    "tempNormal",
    "tempTangents",
    "tempUV",
    "MAX_VERTEX",
    "particleData",
    "tempLen",
    "compact",
    "product",
    "sourceUVs",
    "particleGeometryTransform",
    "vertexTransform",
    "invVertexTransform",
    "UVTransform",
    "deltaTransformVector",
    "transformPoint",
    "sourceIndices",
    "particleGeometry",
    "awayjs-renderergl/lib/utils/PerspectiveMatrix3D",
    "PerspectiveMatrix3D",
    "perspectiveFieldOfViewLH",
    "fieldOfViewY",
    "aspectRatio",
    "zNear",
    "zFar",
    "yScale",
    "tan",
    "xScale",
    "copyRawDataFrom",
    "inputReg",
    "mipmaps",
    "uvReg",
    "forceWrap",
    "wrap",
    "getTexCubeSampleCode",
    "COMPRESSED",
    "COMPRESSED_ALPHA"
  ],
  "mappings": "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",
  "file": "awayjs-renderergl.min.js",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    null,
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport RenderTexture\t\t\t\t= require(\"awayjs-core/lib/textures/RenderTexture\");\r\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\r\n\r\nimport LightBase\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\r\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport ShadowMapperBase\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLClearMask\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\n\r\nimport DepthRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/DepthRenderer\");\r\nimport DistanceRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/DistanceRenderer\");\r\nimport Filter3DRenderer\t\t\t\t= require(\"awayjs-renderergl/lib/Filter3DRenderer\");\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\r\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport SkyboxRenderable\t\t\t\t= require(\"awayjs-renderergl/lib/pool/SkyboxRenderable\");\r\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * The DefaultRenderer class provides the default rendering method. It renders the scene graph objects using the\r\n * materials assigned to them.\r\n *\r\n * @class away.render.DefaultRenderer\r\n */\r\nclass DefaultRenderer extends RendererBase implements IRenderer\r\n{\r\n\tpublic _pRequireDepthRender:boolean;\r\n\tprivate _skyboxRenderablePool:RenderablePoolBase;\r\n\r\n\tprivate _pDistanceRenderer:DepthRenderer;\r\n\tprivate _pDepthRenderer:DepthRenderer;\r\n\tprivate _skyboxProjection:Matrix3D = new Matrix3D();\r\n\tpublic _pFilter3DRenderer:Filter3DRenderer;\r\n\r\n\tpublic _pDepthRender:TextureProxyBase;\r\n\r\n\tprivate _antiAlias:number;\r\n\r\n\tpublic get antiAlias():number\r\n\t{\r\n\t\treturn this._antiAlias;\r\n\t}\r\n\r\n\tpublic set antiAlias(value:number)\r\n\t{\r\n\t\tif (this._antiAlias == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._antiAlias = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get depthPrepass():boolean\r\n\t{\r\n\t\treturn this._depthPrepass;\r\n\t}\r\n\r\n\tpublic set depthPrepass(value:boolean)\r\n\t{\r\n\t\tthis._depthPrepass = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {*}\r\n\t */\r\n\tpublic get filters3d():Array<Filter3DBase>\r\n\t{\r\n\t\treturn this._pFilter3DRenderer? this._pFilter3DRenderer.filters : null;\r\n\t}\r\n\tpublic set filters3d(value:Array<Filter3DBase>)\r\n\t{\r\n\t\tif (value && value.length == 0)\r\n\t\t\tvalue = null;\r\n\r\n\t\tif (this._pFilter3DRenderer && !value) {\r\n\t\t\tthis._pFilter3DRenderer.dispose();\r\n\t\t\tthis._pFilter3DRenderer = null;\r\n\t\t} else if (!this._pFilter3DRenderer && value) {\r\n\t\t\tthis._pFilter3DRenderer = new Filter3DRenderer(this._pStage);\r\n\t\t\tthis._pFilter3DRenderer.filters = value;\r\n\t\t}\r\n\r\n\t\tif (this._pFilter3DRenderer) {\r\n\t\t\tthis._pFilter3DRenderer.filters = value;\r\n\t\t\tthis._pRequireDepthRender = this._pFilter3DRenderer.requireDepthRender;\r\n\t\t} else {\r\n\t\t\tthis._pRequireDepthRender = false;\r\n\r\n\t\t\tif (this._pDepthRender) {\r\n\t\t\t\tthis._pDepthRender.dispose();\r\n\t\t\t\tthis._pDepthRender = null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new DefaultRenderer object.\r\n\t *\r\n\t * @param antiAlias The amount of anti-aliasing to use.\r\n\t * @param renderMode The render mode to use.\r\n\t */\r\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\r\n\t{\r\n\t\tsuper(rendererPoolClass, stage);\r\n\r\n\t\tif (this._width == 0)\r\n\t\t\tthis.width = window.innerWidth;\r\n\t\telse\r\n\t\t\tthis._pRttBufferManager.viewWidth = this._width;\r\n\r\n\t\tif (this._height == 0)\r\n\t\t\tthis.height = window.innerHeight;\r\n\t\telse\r\n\t\t\tthis._pRttBufferManager.viewHeight = this._height;\r\n\t}\r\n\r\n\tpublic render(entityCollector:CollectorBase)\r\n\t{\r\n\t\tsuper.render(entityCollector);\r\n\r\n\t\tif (!this._pStage.recoverFromDisposal()) {//if context has Disposed by the OS,don't render at this frame\r\n\t\t\tthis._pBackBufferInvalid = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._pBackBufferInvalid)// reset or update render settings\r\n\t\t\tthis.pUpdateBackBuffer();\r\n\r\n\t\tif (this._shareContext && this._pContext)\r\n\t\t\tthis._pContext.clear(0, 0, 0, 1, 1, 0, ContextGLClearMask.DEPTH);\r\n\r\n\t\tif (this._pFilter3DRenderer) {\r\n\t\t\tthis.textureRatioX = this._pRttBufferManager.textureRatioX;\r\n\t\t\tthis.textureRatioY = this._pRttBufferManager.textureRatioY;\r\n\t\t} else {\r\n\t\t\tthis.textureRatioX = 1;\r\n\t\t\tthis.textureRatioY = 1;\r\n\t\t}\r\n\r\n\t\tif (this._pRequireDepthRender)\r\n\t\t\tthis.pRenderSceneDepthToTexture(<EntityCollector> entityCollector);\r\n\r\n\t\tif (this._depthPrepass)\r\n\t\t\tthis.pRenderDepthPrepass(<EntityCollector> entityCollector);\r\n\r\n\t\tif (this._pFilter3DRenderer && this._pContext) { //TODO\r\n\t\t\t//this._iRender(entityCollector, this._pFilter3DRenderer.getMainInputTexture(this._pStage), this._pRttBufferManager.renderToTextureRect);\r\n\t\t\t//this._pFilter3DRenderer.render(this._pStage, entityCollector.camera, this._pDepthRender);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif (this._shareContext)\r\n\t\t\t\tthis._iRender(entityCollector, null, this._pScissorRect);\r\n\t\t\telse\r\n\t\t\t\tthis._iRender(entityCollector);\r\n\t\t}\r\n\r\n\t\tsuper.render(entityCollector);\r\n\r\n\t\tif (!this._shareContext && this._pContext)\r\n\t\t\tthis._pContext.present();\r\n\r\n\t\t// register that a view has been rendered\r\n\t\tthis._pStage.bufferClear = false;\r\n\t}\r\n\r\n\tpublic pExecuteRender(entityCollector:EntityCollector, target:TextureProxyBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\r\n\t{\r\n\t\tthis.updateLights(entityCollector);\r\n\r\n\t\tsuper.pExecuteRender(entityCollector, target, scissorRect, surfaceSelector);\r\n\t}\r\n\r\n\tprivate updateLights(entityCollector:EntityCollector)\r\n\t{\r\n\t\tvar dirLights:Array<DirectionalLight> = entityCollector.directionalLights;\r\n\t\tvar pointLights:Array<PointLight> = entityCollector.pointLights;\r\n\t\tvar len:number, i:number;\r\n\t\tvar light:LightBase;\r\n\t\tvar shadowMapper:ShadowMapperBase;\r\n\r\n\t\tlen = dirLights.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tlight = dirLights[i];\r\n\r\n\t\t\tshadowMapper = light.shadowMapper;\r\n\r\n\t\t\tif (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid ))\r\n\t\t\t\tshadowMapper.iRenderDepthMap(entityCollector, this._pDepthRenderer);\r\n\t\t}\r\n\r\n\t\tlen = pointLights.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tlight = pointLights[i];\r\n\r\n\t\t\tshadowMapper = light.shadowMapper;\r\n\r\n\t\t\tif (light.castsShadows && (shadowMapper.autoUpdateShadows || shadowMapper._iShadowsInvalid))\r\n\t\t\t\tshadowMapper.iRenderDepthMap(entityCollector, this._pDistanceRenderer);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic pDraw(entityCollector:EntityCollector)\r\n\t{\r\n\t\tif (entityCollector.skyBox) {\r\n\t\t\tthis._pContext.setDepthTest(false, ContextGLCompareMode.ALWAYS);\r\n\r\n\t\t\tthis.drawSkybox(entityCollector);\r\n\t\t}\r\n\r\n\t\tsuper.pDraw(entityCollector);\r\n\t}\r\n\r\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn <RenderObjectBase> renderObjectOwner.getRenderObject(renderable._pool);\r\n\t}\r\n\r\n\t/**\r\n\t * Draw the skybox if present.\r\n\t *\r\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\r\n\t */\r\n\tprivate drawSkybox(entityCollector:EntityCollector)\r\n\t{\r\n\t\tvar skyBox:SkyboxRenderable = <SkyboxRenderable> this._skyboxRenderablePool.getItem(entityCollector.skyBox);\r\n\r\n\t\tvar camera:Camera = entityCollector.camera;\r\n\r\n\t\tthis.updateSkyboxProjection(camera);\r\n\r\n\t\tvar renderObject:RenderObjectBase = skyBox.renderObject = this._pGetRenderObject(skyBox, skyBox.renderObjectOwner);\r\n\t\tvar pass:RenderPassBase = renderObject.passes[0];\r\n\r\n\t\tthis.activatePass(skyBox, pass, camera);\r\n\t\tskyBox._iRender(pass, camera, this._skyboxProjection);\r\n\t\tthis.deactivatePass(skyBox, pass);\r\n\t}\r\n\r\n\tprivate updateSkyboxProjection(camera:Camera)\r\n\t{\r\n\t\tvar near:Vector3D = new Vector3D();\r\n\r\n\t\tthis._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);\r\n\t\tthis._skyboxProjection.copyRowTo(2, near);\r\n\r\n\t\tvar camPos:Vector3D = camera.scenePosition;\r\n\r\n\t\tvar cx:number = near.x;\r\n\t\tvar cy:number = near.y;\r\n\t\tvar cz:number = near.z;\r\n\t\tvar cw:number = -(near.x*camPos.x + near.y*camPos.y + near.z*camPos.z + Math.sqrt(cx*cx + cy*cy + cz*cz));\r\n\r\n\t\tvar signX:number = cx >= 0? 1 : -1;\r\n\t\tvar signY:number = cy >= 0? 1 : -1;\r\n\r\n\t\tvar p:Vector3D = new Vector3D(signX, signY, 1, 1);\r\n\r\n\t\tvar inverse:Matrix3D = this._skyboxProjection.clone();\r\n\t\tinverse.invert();\r\n\r\n\t\tvar q:Vector3D = inverse.transformVector(p);\r\n\r\n\t\tthis._skyboxProjection.copyRowTo(3, p);\r\n\r\n\t\tvar a:number = (q.x*p.x + q.y*p.y + q.z*p.z + q.w*p.w)/(cx*q.x + cy*q.y + cz*q.z + cw*q.w);\r\n\r\n\t\tthis._skyboxProjection.copyRowFrom(2, new Vector3D(cx*a, cy*a, cz*a, cw*a));\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tif (!this._shareContext)\r\n\t\t\tthis._pStage.dispose();\r\n\r\n\t\tthis._skyboxRenderablePool.dispose();\r\n\t\tthis._skyboxRenderablePool = null;\r\n\r\n\t\tthis._pRttBufferManager.dispose();\r\n\t\tthis._pRttBufferManager = null;\r\n\r\n\t\tthis._pDepthRenderer.dispose();\r\n\t\tthis._pDistanceRenderer.dispose();\r\n\t\tthis._pDepthRenderer = null;\r\n\t\tthis._pDistanceRenderer = null;\r\n\r\n\t\tthis._pDepthRender = null;\r\n\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic pRenderDepthPrepass(entityCollector:EntityCollector)\r\n\t{\r\n\t\tthis._pDepthRenderer.disableColor = true;\r\n\r\n\t\tif (this._pFilter3DRenderer) { //TODO\r\n//\t\t\t\tthis._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;\r\n//\t\t\t\tthis._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;\r\n//\t\t\t\tthis._pDepthRenderer._iRender(entityCollector, this._pFilter3DRenderer.getMainInputTexture(this._pStage), this._pRttBufferManager.renderToTextureRect);\r\n\t\t} else {\r\n\t\t\tthis._pDepthRenderer.textureRatioX = 1;\r\n\t\t\tthis._pDepthRenderer.textureRatioY = 1;\r\n\t\t\tthis._pDepthRenderer._iRender(entityCollector);\r\n\t\t}\r\n\r\n\t\tthis._pDepthRenderer.disableColor = false;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic pRenderSceneDepthToTexture(entityCollector:EntityCollector)\r\n\t{\r\n\t\tif (this._pDepthTextureInvalid || !this._pDepthRender)\r\n\t\t\tthis.initDepthTexture(<IContextGL> this._pStage.context);\r\n\r\n\t\tthis._pDepthRenderer.textureRatioX = this._pRttBufferManager.textureRatioX;\r\n\t\tthis._pDepthRenderer.textureRatioY = this._pRttBufferManager.textureRatioY;\r\n\t\tthis._pDepthRenderer._iRender(entityCollector, this._pDepthRender);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Updates the backbuffer dimensions.\r\n\t */\r\n\tpublic pUpdateBackBuffer()\r\n\t{\r\n\t\t// No reason trying to configure back buffer if there is no context available.\r\n\t\t// Doing this anyway (and relying on _stage to cache width/height for\r\n\t\t// context does get available) means usesSoftwareRendering won't be reliable.\r\n\t\tif (this._pStage.context && !this._shareContext) {\r\n\t\t\tif (this._width && this._height) {\r\n\t\t\t\tthis._pStage.configureBackBuffer(this._width, this._height, this._antiAlias, true);\r\n\t\t\t\tthis._pBackBufferInvalid = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic iSetStage(value:Stage)\r\n\t{\r\n\t\tsuper.iSetStage(value);\r\n\r\n\t\tif (this._pStage) {\r\n\t\t\tthis._pRttBufferManager = RTTBufferManager.getInstance(this._pStage);\r\n\r\n\t\t\tthis._pDepthRenderer = new DepthRenderer(this._pRendererPoolClass, this._pStage);\r\n\t\t\tthis._pDistanceRenderer = new DistanceRenderer(this._pRendererPoolClass, this._pStage);\r\n\r\n\t\t\tthis._skyboxRenderablePool = RenderablePoolBase.getPool(SkyboxRenderable, this._pStage);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate initDepthTexture(context:IContextGL):void\r\n\t{\r\n\t\tthis._pDepthTextureInvalid = false;\r\n\r\n\t\tif (this._pDepthRender)\r\n\t\t\tthis._pDepthRender.dispose();\r\n\r\n\t\tthis._pDepthRender = new RenderTexture(this._pRttBufferManager.textureWidth, this._pRttBufferManager.textureHeight);\r\n\t}\r\n}\r\n\r\nexport = DefaultRenderer;",
    "import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\r\n\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\r\n\r\n\r\n/**\r\n * The DepthRenderer class renders 32-bit depth information encoded as RGBA\r\n *\r\n * @class away.render.DepthRenderer\r\n */\r\nclass DepthRenderer extends RendererBase\r\n{\r\n\t/**\r\n\t * Creates a new DepthRenderer object.\r\n\t * @param renderBlended Indicates whether semi-transparent objects should be rendered.\r\n\t * @param distanceBased Indicates whether the written depth value is distance-based or projected depth-based\r\n\t */\r\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\r\n\t{\r\n\t\tsuper(rendererPoolClass, stage);\r\n\r\n\t\tthis._iBackgroundR = 1;\r\n\t\tthis._iBackgroundG = 1;\r\n\t\tthis._iBackgroundB = 1;\r\n\r\n\t}\r\n\r\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn renderable._pool.getDepthRenderObject(renderObjectOwner);\r\n\t}\r\n}\r\n\r\nexport = DepthRenderer;",
    "import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\r\n\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\r\n\r\n\r\n/**\r\n * The DistanceRenderer class renders 32-bit depth information encoded as RGBA\r\n *\r\n * @class away.render.DistanceRenderer\r\n */\r\nclass DistanceRenderer extends RendererBase\r\n{\r\n\t/**\r\n\t * Creates a new DistanceRenderer object.\r\n\t * @param renderBlended Indicates whether semi-transparent objects should be rendered.\r\n\t * @param distanceBased Indicates whether the written depth value is distance-based or projected depth-based\r\n\t */\r\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\r\n\t{\r\n\t\tsuper(rendererPoolClass, stage);\r\n\r\n\t\tthis._iBackgroundR = 1;\r\n\t\tthis._iBackgroundG = 1;\r\n\t\tthis._iBackgroundB = 1;\r\n\r\n\t}\r\n\r\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn renderable._pool.getDistanceRenderObject(renderObjectOwner);\r\n\t}\r\n}\r\n\r\nexport = DistanceRenderer;",
    "import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\r\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\r\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\r\n\r\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\r\nimport Filter3DBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/filters/Filter3DBase\");\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\n/**\r\n * @class away.render.Filter3DRenderer\r\n */\r\nclass Filter3DRenderer\r\n{\r\n\tprivate _filters:Array<Filter3DBase>;\r\n\tprivate _tasks:Array<Filter3DTaskBase>;\r\n\tprivate _filterTasksInvalid:boolean;\r\n\tprivate _mainInputTexture:ITexture;\r\n\tprivate _requireDepthRender:boolean;\r\n\tprivate _rttManager:RTTBufferManager;\r\n\tprivate _stage:Stage;\r\n\tprivate _filterSizesInvalid:boolean = true;\r\n\tprivate _onRTTResizeDelegate:(event:Event) => void;\r\n\r\n\tconstructor(stage:Stage)\r\n\t{\r\n\t\tthis._onRTTResizeDelegate = (event:Event) => this.onRTTResize(event);\r\n\r\n\t\tthis._stage = stage;\r\n\t\tthis._rttManager = RTTBufferManager.getInstance(stage);\r\n\t\tthis._rttManager.addEventListener(Event.RESIZE, this._onRTTResizeDelegate);\r\n\r\n\t}\r\n\r\n\tprivate onRTTResize(event:Event)\r\n\t{\r\n\t\tthis._filterSizesInvalid = true;\r\n\t}\r\n\r\n\tpublic get requireDepthRender():boolean\r\n\t{\r\n\t\treturn this._requireDepthRender;\r\n\t}\r\n\r\n\tpublic getMainInputTexture(stage:Stage):ITexture\r\n\t{\r\n\t\tif (this._filterTasksInvalid) {\r\n\r\n\t\t\tthis.updateFilterTasks(stage);\r\n\r\n\t\t}\r\n\r\n\t\treturn this._mainInputTexture;\r\n\t}\r\n\r\n\tpublic get filters():Filter3DBase[]\r\n\t{\r\n\t\treturn this._filters;\r\n\t}\r\n\r\n\tpublic set filters(value:Filter3DBase[])\r\n\t{\r\n\t\tthis._filters = value;\r\n\r\n\t\tthis._filterTasksInvalid = true;\r\n\r\n\t\tthis._requireDepthRender = false;\r\n\r\n\t\tif (!this._filters) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tfor (var i:number = 0; i < this._filters.length; ++i) {\r\n\r\n\t\t\t// TODO: check logic:\r\n\t\t\t// this._requireDepthRender ||=  Boolean ( this._filters[i].requireDepthRender )\r\n\r\n\t\t\tvar s:any = this._filters[i];\r\n\t\t\tvar b:boolean = <boolean> ( s.requireDepthRender == null )? false : s.requireDepthRender;\r\n\r\n\t\t\tthis._requireDepthRender = this._requireDepthRender || b;\r\n\r\n\t\t}\r\n\r\n\t\tthis._filterSizesInvalid = true;\r\n\r\n\t}\r\n\r\n\tprivate updateFilterTasks(stage:Stage)\r\n\t{\r\n\t\tvar len:number;\r\n\r\n\t\tif (this._filterSizesInvalid) {\r\n\r\n\t\t\tthis.updateFilterSizes();\r\n\r\n\t\t}\r\n\r\n\t\tif (!this._filters) {\r\n\t\t\tthis._tasks = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._tasks = new Array<Filter3DTaskBase>();\r\n\r\n\t\tlen = this._filters.length - 1;\r\n\r\n\t\tvar filter:Filter3DBase;\r\n\r\n\t\tfor (var i:number = 0; i <= len; ++i) {\r\n\r\n\t\t\t// make sure all internal tasks are linked together\r\n\t\t\tfilter = this._filters[i];\r\n\r\n\t\t\t// TODO: check logic\r\n\t\t\t// filter.setRenderTargets(i == len? null : Filter3DBase(_filters[i + 1]).getMainInputTexture(stage), stage);\r\n\r\n\t\t\tfilter.setRenderTargets(i == len? null : this._filters[i + 1].getMainInputTexture(stage), stage);\r\n\r\n\t\t\tthis._tasks = this._tasks.concat(filter.tasks);\r\n\r\n\t\t}\r\n\r\n\t\tthis._mainInputTexture = this._filters[0].getMainInputTexture(stage);\r\n\r\n\t}\r\n\r\n\tpublic render(stage:Stage, camera:Camera, depthTexture:ITexture)\r\n\t{\r\n\t\tvar len:number;\r\n\t\tvar i:number;\r\n\t\tvar task:Filter3DTaskBase;\r\n\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n\r\n\t\tvar indexBuffer:IIndexBuffer = this._rttManager.indexBuffer;\r\n\r\n\t\tvar vertexBuffer:IVertexBuffer = this._rttManager.renderToTextureVertexBuffer;\r\n\r\n\t\tif (!this._filters) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._filterSizesInvalid) {\r\n\t\t\tthis.updateFilterSizes();\r\n\t\t}\r\n\r\n\t\tif (this._filterTasksInvalid) {\r\n\t\t\tthis.updateFilterTasks(stage);\r\n\t\t}\r\n\r\n\t\tlen = this._filters.length;\r\n\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._filters[i].update(stage, camera);\r\n\t\t}\r\n\r\n\t\tlen = this._tasks.length;\r\n\r\n\t\tif (len > 1) {\r\n\t\t\tcontext.setVertexBufferAt(0, vertexBuffer, 0, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t\tcontext.setVertexBufferAt(1, vertexBuffer, 2, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\r\n\t\t\ttask = this._tasks[i];\r\n\r\n\t\t\t//stage.setRenderTarget(task.target); //TODO\r\n\r\n\t\t\tif (!task.target) {\r\n\r\n\t\t\t\tstage.scissorRect = null;\r\n\t\t\t\tvertexBuffer = this._rttManager.renderToScreenVertexBuffer;\r\n\t\t\t\tcontext.setVertexBufferAt(0, vertexBuffer, 0, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t\t\tcontext.setVertexBufferAt(1, vertexBuffer, 2, ContextGLVertexBufferFormat.FLOAT_2);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcontext.setTextureAt(0, task.getMainInputTexture(stage));\r\n\t\t\tcontext.setProgram(task.getProgram(stage));\r\n\t\t\tcontext.clear(0.0, 0.0, 0.0, 0.0);\r\n\r\n\t\t\ttask.activate(stage, camera, depthTexture);\r\n\r\n\t\t\tcontext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\t\t\tcontext.drawTriangles(indexBuffer, 0, 2);\r\n\r\n\t\t\ttask.deactivate(stage);\r\n\t\t}\r\n\r\n\t\tcontext.setTextureAt(0, null);\r\n\t\tcontext.setVertexBufferAt(0, null);\r\n\t\tcontext.setVertexBufferAt(1, null);\r\n\t}\r\n\r\n\tprivate updateFilterSizes()\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._filters.length; ++i) {\r\n\t\t\tthis._filters[i].textureWidth = this._rttManager.textureWidth;\r\n\t\t\tthis._filters[i].textureHeight = this._rttManager.textureHeight;\r\n\t\t}\r\n\r\n\t\tthis._filterSizesInvalid = true;\r\n\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._rttManager.removeEventListener(Event.RESIZE, this._onRTTResizeDelegate);\r\n\t\tthis._rttManager = null;\r\n\t\tthis._stage = null;\r\n\t}\r\n}\r\n\r\nexport = Filter3DRenderer;",
    "import AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport IAsset\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\n\r\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetError\t\t\t= require(\"awayjs-renderergl/lib/errors/AnimationSetError\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\n/**\r\n * Provides an abstract base class for data set classes that hold animation data for use in animator classes.\r\n *\r\n * @see away.animators.AnimatorBase\r\n */\r\nclass AnimationSetBase extends NamedAssetBase implements IAsset\r\n{\r\n\tprivate _usesCPU:boolean;\r\n\tprivate _animations:Array<AnimationNodeBase> = new Array<AnimationNodeBase>();\r\n\tprivate _animationNames:Array<string> = new Array<string>();\r\n\tprivate _animationDictionary:Object = new Object();\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves a temporary GPU register that's still free.\r\n\t *\r\n\t * @param exclude An array of non-free temporary registers.\r\n\t * @param excludeAnother An additional register that's not free.\r\n\t * @return A temporary register that can be used.\r\n\t */\r\n\tpublic _pFindTempReg(exclude:Array<string>, excludeAnother:string = null):string\r\n\t{\r\n\t\tvar i:number /*uint*/ = 0;\r\n\t\tvar reg:string;\r\n\r\n\t\twhile (true) {\r\n\t\t\treg = \"vt\" + i;\r\n\t\t\tif (exclude.indexOf(reg) == -1 && excludeAnother != reg)\r\n\t\t\t\treturn reg;\r\n\t\t\t++i;\r\n\t\t}\r\n\r\n\t\t// can't be reached\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the properties of the animation data contained within the set combined with\r\n\t * the vertex registers already in use on shading materials allows the animation data to utilise\r\n\t * GPU calls.\r\n\t */\r\n\tpublic get usesCPU():boolean\r\n\t{\r\n\t\treturn this._usesCPU;\r\n\t}\r\n\r\n\t/**\r\n\t * Called by the material to reset the GPU indicator before testing whether register space in the shader\r\n\t * is available for running GPU-based animation code.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic resetGPUCompatibility()\r\n\t{\r\n\t\tthis._usesCPU = false;\r\n\t}\r\n\r\n\tpublic cancelGPUCompatibility()\r\n\t{\r\n\t\tthis._usesCPU = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn AssetType.ANIMATION_SET;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of animation state objects that make up the contents of the animation data set.\r\n\t */\r\n\tpublic get animations():Array<AnimationNodeBase>\r\n\t{\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of animation state objects that make up the contents of the animation data set.\r\n\t */\r\n\tpublic get animationNames():Array<string>\r\n\t{\r\n\t\treturn this._animationNames;\r\n\t}\r\n\r\n\t/**\r\n\t * Check to determine whether a state is registered in the animation set under the given name.\r\n\t *\r\n\t * @param stateName The name of the animation state object to be checked.\r\n\t */\r\n\tpublic hasAnimation(name:string):boolean\r\n\t{\r\n\t\treturn this._animationDictionary[name] != null;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the animation state object registered in the animation data set under the given name.\r\n\t *\r\n\t * @param stateName The name of the animation state object to be retrieved.\r\n\t */\r\n\tpublic getAnimation(name:string):AnimationNodeBase\r\n\t{\r\n\t\treturn this._animationDictionary[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an animation state object to the aniamtion data set under the given name.\r\n\t *\r\n\t * @param stateName The name under which the animation state object will be stored.\r\n\t * @param animationState The animation state object to be staored in the set.\r\n\t */\r\n\tpublic addAnimation(node:AnimationNodeBase)\r\n\t{\r\n\t\tif (this._animationDictionary[node.name])\r\n\t\t\tthrow new AnimationSetError(\"root node name '\" + node.name + \"' already exists in the set\");\r\n\r\n\t\tthis._animationDictionary[node.name] = node;\r\n\r\n\t\tthis._animations.push(node);\r\n\r\n\t\tthis._animationNames.push(node.name);\r\n\t}\r\n\r\n\t/**\r\n\t * Cleans up any resources used by the current object.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t}\r\n}\r\n\r\nexport = AnimationSetBase;",
    "import Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport RequestAnimationFrame\t\t= require(\"awayjs-core/lib/utils/RequestAnimationFrame\");\r\nimport getTimer\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/getTimer\");\r\n\r\nimport IAnimationSet\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\nimport IAnimator\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimator\");\r\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IAnimationState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport TriangleSubMeshRenderable\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\r\nimport AnimatorEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimatorEvent\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\n\r\n/**\r\n * Dispatched when playback of an animation inside the animator object starts.\r\n *\r\n * @eventType away3d.events.AnimatorEvent\r\n */\r\n//[Event(name=\"start\", type=\"away3d.events.AnimatorEvent\")]\r\n\r\n/**\r\n * Dispatched when playback of an animation inside the animator object stops.\r\n *\r\n * @eventType away3d.events.AnimatorEvent\r\n */\r\n//[Event(name=\"stop\", type=\"away3d.events.AnimatorEvent\")]\r\n\r\n/**\r\n * Dispatched when playback of an animation reaches the end of an animation.\r\n *\r\n * @eventType away3d.events.AnimatorEvent\r\n */\r\n//[Event(name=\"cycle_complete\", type=\"away3d.events.AnimatorEvent\")]\r\n\r\n/**\r\n * Provides an abstract base class for animator classes that control animation output from a data set subtype of <code>AnimationSetBase</code>.\r\n *\r\n * @see away.animators.AnimationSetBase\r\n */\r\nclass AnimatorBase extends NamedAssetBase implements IAnimator\r\n{\r\n\tprivate _broadcaster:RequestAnimationFrame;\r\n\tprivate _isPlaying:boolean;\r\n\tprivate _autoUpdate:boolean = true;\r\n\tprivate _startEvent:AnimatorEvent;\r\n\tprivate _stopEvent:AnimatorEvent;\r\n\tprivate _cycleEvent:AnimatorEvent;\r\n\tprivate _time:number /*int*/ = 0;\r\n\tprivate _playbackSpeed:number = 1;\r\n\r\n\tpublic _pAnimationSet:IAnimationSet;\r\n\tpublic _pOwners:Array<Mesh> = new Array<Mesh>();\r\n\tpublic _pActiveNode:AnimationNodeBase;\r\n\tpublic _pActiveState:IAnimationState;\r\n\tpublic _pActiveAnimationName:string;\r\n\tpublic _pAbsoluteTime:number = 0;\r\n\r\n\tprivate _animationStates:Object = new Object();\r\n\r\n\t/**\r\n\t * Enables translation of the animated mesh from data returned per frame via the positionDelta property of the active animation node. Defaults to true.\r\n\t *\r\n\t * @see away.animators.IAnimationState#positionDelta\r\n\t */\r\n\tpublic updatePosition:boolean = true;\r\n\r\n\tpublic getAnimationState(node:AnimationNodeBase):IAnimationState\r\n\t{\r\n\t\tvar className:any = node.stateClass;\r\n\t\tvar uID:number = node.id;\r\n\r\n\t\tif (this._animationStates[uID] == null)\r\n\t\t\tthis._animationStates[uID] = new className(this, node);\r\n\r\n\t\treturn this._animationStates[uID];\r\n\t}\r\n\r\n\tpublic getAnimationStateByName(name:string):IAnimationState\r\n\t{\r\n\t\treturn this.getAnimationState(this._pAnimationSet.getAnimation(name));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the internal absolute time of the animator, calculated by the current time and the playback speed.\r\n\t *\r\n\t * @see #time\r\n\t * @see #playbackSpeed\r\n\t */\r\n\tpublic get absoluteTime():number\r\n\t{\r\n\t\treturn this._pAbsoluteTime;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the animation data set in use by the animator.\r\n\t */\r\n\tpublic get animationSet():IAnimationSet\r\n\t{\r\n\t\treturn this._pAnimationSet;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current active animation state.\r\n\t */\r\n\tpublic get activeState():IAnimationState\r\n\t{\r\n\t\treturn this._pActiveState;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current active animation node.\r\n\t */\r\n\tpublic get activeAnimation():AnimationNodeBase\r\n\t{\r\n\t\treturn this._pAnimationSet.getAnimation(this._pActiveAnimationName);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current active animation node.\r\n\t */\r\n\tpublic get activeAnimationName():string\r\n\t{\r\n\t\treturn this._pActiveAnimationName;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines whether the animators internal update mechanisms are active. Used in cases\r\n\t * where manual updates are required either via the <code>time</code> property or <code>update()</code> method.\r\n\t * Defaults to true.\r\n\t *\r\n\t * @see #time\r\n\t * @see #update()\r\n\t */\r\n\tpublic get autoUpdate():boolean\r\n\t{\r\n\t\treturn this._autoUpdate;\r\n\t}\r\n\r\n\tpublic set autoUpdate(value:boolean)\r\n\t{\r\n\t\tif (this._autoUpdate == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._autoUpdate = value;\r\n\r\n\t\tif (this._autoUpdate)\r\n\t\t\tthis.start(); else\r\n\t\t\tthis.stop();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets and sets the internal time clock of the animator.\r\n\t */\r\n\tpublic get time():number /*int*/\r\n\t{\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\tpublic set time(value:number /*int*/)\r\n\t{\r\n\t\tif (this._time == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis.update(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the animation phase of the current active state's animation clip(s).\r\n\t *\r\n\t * @param value The phase value to use. 0 represents the beginning of an animation clip, 1 represents the end.\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._pActiveState.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>AnimatorBase</code> object.\r\n\t *\r\n\t * @param animationSet The animation data set to be used by the animator object.\r\n\t */\r\n\tconstructor(animationSet:IAnimationSet)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pAnimationSet = animationSet;\r\n\r\n\t\tthis._broadcaster = new RequestAnimationFrame(this.onEnterFrame, this);\r\n\t}\r\n\r\n\t/**\r\n\t * The amount by which passed time should be scaled. Used to slow down or speed up animations. Defaults to 1.\r\n\t */\r\n\tpublic get playbackSpeed():number\r\n\t{\r\n\t\treturn this._playbackSpeed;\r\n\t}\r\n\r\n\tpublic set playbackSpeed(value:number)\r\n\t{\r\n\t\tthis._playbackSpeed = value;\r\n\t}\r\n\r\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * Resumes the automatic playback clock controling the active state of the animator.\r\n\t */\r\n\tpublic start()\r\n\t{\r\n\t\tif (this._isPlaying || !this._autoUpdate)\r\n\t\t\treturn;\r\n\r\n\t\tthis._time = this._pAbsoluteTime = getTimer();\r\n\r\n\t\tthis._isPlaying = true;\r\n\r\n\t\tthis._broadcaster.start();\r\n\r\n\t\tif (!this.hasEventListener(AnimatorEvent.START))\r\n\t\t\treturn;\r\n\r\n\t\tif (this._startEvent == null)\r\n\t\t\tthis._startEvent = new AnimatorEvent(AnimatorEvent.START, this);\r\n\r\n\t\tthis.dispatchEvent(this._startEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * Pauses the automatic playback clock of the animator, in case manual updates are required via the\r\n\t * <code>time</code> property or <code>update()</code> method.\r\n\t *\r\n\t * @see #time\r\n\t * @see #update()\r\n\t */\r\n\tpublic stop()\r\n\t{\r\n\t\tif (!this._isPlaying)\r\n\t\t\treturn;\r\n\r\n\t\tthis._isPlaying = false;\r\n\r\n\t\tthis._broadcaster.stop();\r\n\r\n\t\tif (!this.hasEventListener(AnimatorEvent.STOP))\r\n\t\t\treturn;\r\n\r\n\t\tif (this._stopEvent == null)\r\n\t\t\tthis._stopEvent = new AnimatorEvent(AnimatorEvent.STOP, this);\r\n\r\n\t\tthis.dispatchEvent(this._stopEvent);\r\n\t}\r\n\r\n\t/**\r\n\t * Provides a way to manually update the active state of the animator when automatic\r\n\t * updates are disabled.\r\n\t *\r\n\t * @see #stop()\r\n\t * @see #autoUpdate\r\n\t */\r\n\tpublic update(time:number /*int*/)\r\n\t{\r\n\t\tvar dt:number = (time - this._time)*this.playbackSpeed;\r\n\r\n\t\tthis._pUpdateDeltaTime(dt);\r\n\r\n\t\tthis._time = time;\r\n\t}\r\n\r\n\tpublic reset(name:string, offset:number = 0)\r\n\t{\r\n\t\tthis.getAnimationState(this._pAnimationSet.getAnimation(name)).offset(offset + this._pAbsoluteTime);\r\n\t}\r\n\r\n\t/**\r\n\t * Used by the mesh object to which the animator is applied, registers the owner for internal use.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic addOwner(mesh:Mesh)\r\n\t{\r\n\t\tthis._pOwners.push(mesh);\r\n\t}\r\n\r\n\t/**\r\n\t * Used by the mesh object from which the animator is removed, unregisters the owner for internal use.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic removeOwner(mesh:Mesh)\r\n\t{\r\n\t\tthis._pOwners.splice(this._pOwners.indexOf(mesh), 1);\r\n\t}\r\n\r\n\t/**\r\n\t * Internal abstract method called when the time delta property of the animator's contents requires updating.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tthis._pAbsoluteTime += dt;\r\n\r\n\t\tthis._pActiveState.update(this._pAbsoluteTime);\r\n\r\n\t\tif (this.updatePosition)\r\n\t\t\tthis.applyPositionDelta();\r\n\t}\r\n\r\n\t/**\r\n\t * Enter frame event handler for automatically updating the active state of the animator.\r\n\t */\r\n\tprivate onEnterFrame(event:Event = null)\r\n\t{\r\n\t\tthis.update(getTimer());\r\n\t}\r\n\r\n\tprivate applyPositionDelta()\r\n\t{\r\n\t\tvar delta:Vector3D = this._pActiveState.positionDelta;\r\n\t\tvar dist:number = delta.length;\r\n\t\tvar len:number /*uint*/;\r\n\t\tif (dist > 0) {\r\n\t\t\tlen = this._pOwners.length;\r\n\t\t\tfor (var i:number /*uint*/ = 0; i < len; ++i)\r\n\t\t\t\tthis._pOwners[i].translateLocal(delta, dist);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *  for internal use.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic dispatchCycleEvent()\r\n\t{\r\n\t\tif (this.hasEventListener(AnimatorEvent.CYCLE_COMPLETE)) {\r\n\t\t\tif (this._cycleEvent == null)\r\n\t\t\t\tthis._cycleEvent = new AnimatorEvent(AnimatorEvent.CYCLE_COMPLETE, this);\r\n\r\n\t\t\tthis.dispatchEvent(this._cycleEvent);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn AssetType.ANIMATOR;\r\n\t}\r\n\r\n\r\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\r\n\t{\r\n\t\t//nothing to do here\r\n\t\treturn sourceSubGeometry;\r\n\t}\r\n}\r\n\r\nexport = AnimatorBase;",
    "import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleTimeNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode\");\r\nimport ParticleGeometry\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/ParticleGeometry\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\n\r\n\r\n/**\r\n * The animation data set used by particle-based animators, containing particle animation data.\r\n *\r\n * @see away.animators.ParticleAnimator\r\n */\r\nclass ParticleAnimationSet extends AnimationSetBase implements IAnimationSet\r\n{\r\n\t/** @private */\r\n\tpublic _iAnimationRegisterCache:AnimationRegisterCache;\r\n\r\n\t//all other nodes dependent on it\r\n\tprivate _timeNode:ParticleTimeNode;\r\n\r\n\t/**\r\n\t * Property used by particle nodes that require compilation at the end of the shader\r\n\t */\r\n\tpublic static POST_PRIORITY:number /*int*/ = 9;\r\n\r\n\t/**\r\n\t * Property used by particle nodes that require color compilation\r\n\t */\r\n\tpublic static COLOR_PRIORITY:number /*int*/ = 18;\r\n\r\n\tprivate _animationSubGeometries:Object = new Object();\r\n\tprivate _particleNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\r\n\tprivate _localDynamicNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\r\n\tprivate _localStaticNodes:Array<ParticleNodeBase> = new Array<ParticleNodeBase>();\r\n\tprivate _totalLenOfOneVertex:number /*int*/ = 0;\r\n\r\n\t//set true if has an node which will change UV\r\n\tpublic hasUVNode:boolean;\r\n\t//set if the other nodes need to access the velocity\r\n\tpublic needVelocity:boolean;\r\n\t//set if has a billboard node.\r\n\tpublic hasBillboard:boolean;\r\n\t//set if has an node which will apply color multiple operation\r\n\tpublic hasColorMulNode:boolean;\r\n\t//set if has an node which will apply color add operation\r\n\tpublic hasColorAddNode:boolean;\r\n\r\n\t/**\r\n\t * Initialiser function for static particle properties. Needs to reference a with the following format\r\n\t *\r\n\t * <code>\r\n\t * initParticleFunc(prop:ParticleProperties)\r\n\t * {\r\n\t * \t\t//code for settings local properties\r\n\t * }\r\n\t * </code>\r\n\t *\r\n\t * Aside from setting any properties required in particle animation nodes using local static properties, the initParticleFunc function\r\n\t * is required to time node requirements as they may be needed. These properties on the ParticleProperties object can include\r\n\t * <code>startTime</code>, <code>duration</code> and <code>delay</code>. The use of these properties is determined by the setting\r\n\t * arguments passed in the constructor of the particle animation set. By default, only the <code>startTime</code> property is required.\r\n\t */\r\n\tpublic initParticleFunc:Function;\r\n\r\n\t/**\r\n\t * Initialiser function scope for static particle properties\r\n\t */\r\n\tpublic initParticleScope:Object;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleAnimationSet</code>\r\n\t *\r\n\t * @param    [optional] usesDuration    Defines whether the animation set uses the <code>duration</code> data in its static properties to determine how long a particle is visible for. Defaults to false.\r\n\t * @param    [optional] usesLooping     Defines whether the animation set uses a looping timeframe for each particle determined by the <code>startTime</code>, <code>duration</code> and <code>delay</code> data in its static properties function. Defaults to false. Requires <code>usesDuration</code> to be true.\r\n\t * @param    [optional] usesDelay       Defines whether the animation set uses the <code>delay</code> data in its static properties to determine how long a particle is hidden for. Defaults to false. Requires <code>usesLooping</code> to be true.\r\n\t */\r\n\tconstructor(usesDuration:boolean = false, usesLooping:boolean = false, usesDelay:boolean = false)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\t//automatically add a particle time node to the set\r\n\t\tthis.addAnimation(this._timeNode = new ParticleTimeNode(usesDuration, usesLooping, usesDelay));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of the particle animation nodes contained within the set.\r\n\t */\r\n\tpublic get particleNodes():Array<ParticleNodeBase>\r\n\t{\r\n\t\treturn this._particleNodes;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic addAnimation(node:AnimationNodeBase)\r\n\t{\r\n\t\tvar i:number /*int*/;\r\n\t\tvar n:ParticleNodeBase = <ParticleNodeBase> node;\r\n\t\tn._iProcessAnimationSetting(this);\r\n\t\tif (n.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tn._iDataOffset = this._totalLenOfOneVertex;\r\n\t\t\tthis._totalLenOfOneVertex += n.dataLength;\r\n\t\t\tthis._localStaticNodes.push(n);\r\n\t\t} else if (n.mode == ParticlePropertiesMode.LOCAL_DYNAMIC)\r\n\t\t\tthis._localDynamicNodes.push(n);\r\n\r\n\t\tfor (i = this._particleNodes.length - 1; i >= 0; i--) {\r\n\t\t\tif (this._particleNodes[i].priority <= n.priority)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis._particleNodes.splice(i + 1, 0, n);\r\n\r\n\t\tsuper.addAnimation(node);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n//\t\t\tthis._iAnimationRegisterCache = pass.animationRegisterCache;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n//\t\t\tvar offset:number /*int*/ = this._iAnimationRegisterCache.vertexAttributesOffset;\r\n//\t\t\tvar used:number /*int*/ = this._iAnimationRegisterCache.numUsedStreams;\r\n//\t\t\tfor (var i:number /*int*/ = offset; i < used; i++)\r\n//\t\t\t\tcontext.setVertexBufferAt(i, null);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\t//grab animationRegisterCache from the materialpassbase or create a new one if the first time\r\n\t\tthis._iAnimationRegisterCache = shaderObject.animationRegisterCache;\r\n\r\n\t\tif (this._iAnimationRegisterCache == null)\r\n\t\t\tthis._iAnimationRegisterCache = shaderObject.animationRegisterCache = new AnimationRegisterCache(shaderObject.profile);\r\n\r\n\t\t//reset animationRegisterCache\r\n\t\tthis._iAnimationRegisterCache.vertexConstantOffset = shaderObject.numUsedVertexConstants;\r\n\t\tthis._iAnimationRegisterCache.vertexAttributesOffset = shaderObject.numUsedStreams;\r\n\t\tthis._iAnimationRegisterCache.varyingsOffset = shaderObject.numUsedVaryings;\r\n\t\tthis._iAnimationRegisterCache.fragmentConstantOffset = shaderObject.numUsedFragmentConstants;\r\n\t\tthis._iAnimationRegisterCache.hasUVNode = this.hasUVNode;\r\n\t\tthis._iAnimationRegisterCache.needVelocity = this.needVelocity;\r\n\t\tthis._iAnimationRegisterCache.hasBillboard = this.hasBillboard;\r\n\t\tthis._iAnimationRegisterCache.sourceRegisters = shaderObject.animatableAttributes;\r\n\t\tthis._iAnimationRegisterCache.targetRegisters = shaderObject.animationTargetRegisters;\r\n\t\tthis._iAnimationRegisterCache.needFragmentAnimation = shaderObject.usesFragmentAnimation;\r\n\t\tthis._iAnimationRegisterCache.needUVAnimation = !shaderObject.usesUVTransform;\r\n\t\tthis._iAnimationRegisterCache.hasColorAddNode = this.hasColorAddNode;\r\n\t\tthis._iAnimationRegisterCache.hasColorMulNode = this.hasColorMulNode;\r\n\t\tthis._iAnimationRegisterCache.reset();\r\n\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tcode += this._iAnimationRegisterCache.getInitCode();\r\n\r\n\t\tvar node:ParticleNodeBase;\r\n\t\tvar i:number /*int*/;\r\n\r\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\r\n\t\t\tnode = this._particleNodes[i];\r\n\t\t\tif (node.priority < ParticleAnimationSet.POST_PRIORITY)\r\n\t\t\t\tcode += node.getAGALVertexCode(shaderObject, this._iAnimationRegisterCache);\r\n\t\t}\r\n\r\n\t\tcode += this._iAnimationRegisterCache.getCombinationCode();\r\n\r\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\r\n\t\t\tnode = this._particleNodes[i];\r\n\t\t\tif (node.priority >= ParticleAnimationSet.POST_PRIORITY && node.priority < ParticleAnimationSet.COLOR_PRIORITY)\r\n\t\t\t\tcode += node.getAGALVertexCode(shaderObject, this._iAnimationRegisterCache);\r\n\t\t}\r\n\r\n\t\tcode += this._iAnimationRegisterCache.initColorRegisters();\r\n\r\n\t\tfor (i = 0; i < this._particleNodes.length; i++) {\r\n\t\t\tnode = this._particleNodes[i];\r\n\t\t\tif (node.priority >= ParticleAnimationSet.COLOR_PRIORITY)\r\n\t\t\t\tcode += node.getAGALVertexCode(shaderObject, this._iAnimationRegisterCache);\r\n\t\t}\r\n\t\tcode += this._iAnimationRegisterCache.getColorPassCode();\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.hasUVNode) {\r\n\t\t\tthis._iAnimationRegisterCache.setUVSourceAndTarget(shaderObject.uvSource, shaderObject.uvTarget);\r\n\t\t\tcode += \"mov \" + this._iAnimationRegisterCache.uvTarget + \".xy,\" + this._iAnimationRegisterCache.uvAttribute.toString() + \"\\n\";\r\n\t\t\tvar node:ParticleNodeBase;\r\n\t\t\tfor (var i:number /*uint*/ = 0; i < this._particleNodes.length; i++)\r\n\t\t\t\tnode = this._particleNodes[i];\r\n\t\t\t\tcode += node.getAGALUVCode(shaderObject, this._iAnimationRegisterCache);\r\n\t\t\tcode += \"mov \" + this._iAnimationRegisterCache.uvVar.toString() + \",\" + this._iAnimationRegisterCache.uvTarget + \".xy\\n\";\r\n\t\t} else\r\n\t\t\tcode += \"mov \" + shaderObject.uvTarget + \",\" + shaderObject.uvSource + \"\\n\";\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\r\n\t{\r\n\t\treturn this._iAnimationRegisterCache.getColorCombinationCode(shadedTarget);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tthis._iAnimationRegisterCache.setDataLength();\r\n\r\n\t\t//set vertexZeroConst,vertexOneConst,vertexTwoConst\r\n\t\tthis._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index, 0, 1, 2, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get usesCPU():boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic cancelGPUCompatibility()\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var key in this._animationSubGeometries)\r\n\t\t\t(<AnimationSubGeometry> this._animationSubGeometries[key]).dispose();\r\n\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\tpublic getAnimationSubGeometry(subMesh:ISubMesh)\r\n\t{\r\n\t\tvar mesh:Mesh = subMesh.parentMesh;\r\n\t\tvar animationSubGeometry:AnimationSubGeometry = (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\r\n\r\n\t\tif (animationSubGeometry)\r\n\t\t\treturn animationSubGeometry;\r\n\r\n\t\tthis._iGenerateAnimationSubGeometries(mesh);\r\n\r\n\t\treturn (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\r\n\t}\r\n\r\n\r\n\t/** @private */\r\n\tpublic _iGenerateAnimationSubGeometries(mesh:Mesh)\r\n\t{\r\n\t\tif (this.initParticleFunc == null)\r\n\t\t\tthrow(new Error(\"no initParticleFunc set\"));\r\n\r\n\t\tvar geometry:ParticleGeometry = <ParticleGeometry> mesh.geometry;\r\n\r\n\t\tif (!geometry)\r\n\t\t\tthrow(new Error(\"Particle animation can only be performed on a ParticleGeometry object\"));\r\n\r\n\t\tvar i:number /*int*/, j:number /*int*/, k:number /*int*/;\r\n\t\tvar animationSubGeometry:AnimationSubGeometry;\r\n\t\tvar newAnimationSubGeometry:boolean = false;\r\n\t\tvar subGeometry:SubGeometryBase;\r\n\t\tvar subMesh:ISubMesh;\r\n\t\tvar localNode:ParticleNodeBase;\r\n\r\n\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\r\n\t\t\tsubMesh = mesh.subMeshes[i];\r\n\t\t\tsubGeometry = subMesh.subGeometry;\r\n\t\t\tif (mesh.shareAnimationGeometry) {\r\n\t\t\t\tanimationSubGeometry = this._animationSubGeometries[subGeometry.id];\r\n\r\n\t\t\t\tif (animationSubGeometry)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tanimationSubGeometry = new AnimationSubGeometry();\r\n\r\n\t\t\tif (mesh.shareAnimationGeometry)\r\n\t\t\t\tthis._animationSubGeometries[subGeometry.id] = animationSubGeometry;\r\n\t\t\telse\r\n\t\t\t\tthis._animationSubGeometries[subMesh.id] = animationSubGeometry;\r\n\r\n\t\t\tnewAnimationSubGeometry = true;\r\n\r\n\t\t\t//create the vertexData vector that will be used for local node data\r\n\t\t\tanimationSubGeometry.createVertexData(subGeometry.numVertices, this._totalLenOfOneVertex);\r\n\t\t}\r\n\r\n\t\tif (!newAnimationSubGeometry)\r\n\t\t\treturn;\r\n\r\n\t\tvar particles:Array<ParticleData> = geometry.particles;\r\n\t\tvar particlesLength:number /*uint*/ = particles.length;\r\n\t\tvar numParticles:number /*uint*/ = geometry.numParticles;\r\n\t\tvar particleProperties:ParticleProperties = new ParticleProperties();\r\n\t\tvar particle:ParticleData;\r\n\r\n\t\tvar oneDataLen:number /*int*/;\r\n\t\tvar oneDataOffset:number /*int*/;\r\n\t\tvar counterForVertex:number /*int*/;\r\n\t\tvar counterForOneData:number /*int*/;\r\n\t\tvar oneData:Array<number>;\r\n\t\tvar numVertices:number /*uint*/;\r\n\t\tvar vertexData:Array<number>;\r\n\t\tvar vertexLength:number /*uint*/;\r\n\t\tvar startingOffset:number /*uint*/;\r\n\t\tvar vertexOffset:number /*uint*/;\r\n\r\n\t\t//default values for particle param\r\n\t\tparticleProperties.total = numParticles;\r\n\t\tparticleProperties.startTime = 0;\r\n\t\tparticleProperties.duration = 1000;\r\n\t\tparticleProperties.delay = 0.1;\r\n\r\n\t\ti = 0;\r\n\t\tj = 0;\r\n\t\twhile (i < numParticles) {\r\n\t\t\tparticleProperties.index = i;\r\n\r\n\t\t\t//call the init on the particle parameters\r\n\t\t\tthis.initParticleFunc.call(this.initParticleScope, particleProperties);\r\n\r\n\t\t\t//create the next set of node properties for the particle\r\n\t\t\tfor (k = 0; k < this._localStaticNodes.length; k++)\r\n\t\t\t\tthis._localStaticNodes[k]._iGeneratePropertyOfOneParticle(particleProperties);\r\n\r\n\t\t\t//loop through all particle data for the curent particle\r\n\t\t\twhile (j < particlesLength && (particle = particles[j]).particleIndex == i) {\r\n\t\t\t\t//find the target animationSubGeometry\r\n\t\t\t\tfor (k = 0; k < mesh.subMeshes.length; k++) {\r\n\t\t\t\t\tsubMesh = mesh.subMeshes[k];\r\n\t\t\t\t\tif (subMesh.subGeometry == particle.subGeometry) {\r\n\t\t\t\t\t\tanimationSubGeometry = (mesh.shareAnimationGeometry)? this._animationSubGeometries[subMesh.subGeometry.id] : this._animationSubGeometries[subMesh.id];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnumVertices = particle.numVertices;\r\n\t\t\t\tvertexData = animationSubGeometry.vertexData;\r\n\t\t\t\tvertexLength = numVertices*this._totalLenOfOneVertex;\r\n\t\t\t\tstartingOffset = animationSubGeometry.numProcessedVertices*this._totalLenOfOneVertex;\r\n\r\n\t\t\t\t//loop through each static local node in the animation set\r\n\t\t\t\tfor (k = 0; k < this._localStaticNodes.length; k++) {\r\n\t\t\t\t\tlocalNode = this._localStaticNodes[k];\r\n\t\t\t\t\toneData = localNode.oneData;\r\n\t\t\t\t\toneDataLen = localNode.dataLength;\r\n\t\t\t\t\toneDataOffset = startingOffset + localNode._iDataOffset;\r\n\r\n\t\t\t\t\t//loop through each vertex set in the vertex data\r\n\t\t\t\t\tfor (counterForVertex = 0; counterForVertex < vertexLength; counterForVertex += this._totalLenOfOneVertex) {\r\n\t\t\t\t\t\tvertexOffset = oneDataOffset + counterForVertex;\r\n\r\n\t\t\t\t\t\t//add the data for the local node to the vertex data\r\n\t\t\t\t\t\tfor (counterForOneData = 0; counterForOneData < oneDataLen; counterForOneData++)\r\n\t\t\t\t\t\t\tvertexData[vertexOffset + counterForOneData] = oneData[counterForOneData];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//store particle properties if they need to be retreived for dynamic local nodes\r\n\t\t\t\tif (this._localDynamicNodes.length)\r\n\t\t\t\t\tanimationSubGeometry.animationParticles.push(new ParticleAnimationData(i, particleProperties.startTime, particleProperties.duration, particleProperties.delay, particle));\r\n\r\n\t\t\t\tanimationSubGeometry.numProcessedVertices += numVertices;\r\n\r\n\t\t\t\t//next index\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\r\n\t\t\t//next particle\r\n\t\t\ti++;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleAnimationSet;",
    "import ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\r\n\r\n/**\r\n * Provides an interface for assigning paricle-based animation data sets to mesh-based entity objects\r\n * and controlling the various available states of animation through an interative playhead that can be\r\n * automatically updated or manually triggered.\r\n *\r\n * Requires that the containing geometry of the parent mesh is particle geometry\r\n *\r\n * @see away.base.ParticleGeometry\r\n */\r\nclass ParticleAnimator extends AnimatorBase\r\n{\r\n\r\n\tprivate _particleAnimationSet:ParticleAnimationSet;\r\n\tprivate _animationParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\r\n\tprivate _animatorParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\r\n\tprivate _timeParticleStates:Array<ParticleStateBase> = new Array<ParticleStateBase>();\r\n\tprivate _totalLenOfOneVertex:number /*uint*/ = 0;\r\n\tprivate _animatorSubGeometries:Object = new Object();\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleAnimator</code> object.\r\n\t *\r\n\t * @param particleAnimationSet The animation data set containing the particle animations used by the animator.\r\n\t */\r\n\tconstructor(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tsuper(particleAnimationSet);\r\n\t\tthis._particleAnimationSet = particleAnimationSet;\r\n\r\n\t\tvar state:ParticleStateBase;\r\n\t\tvar node:ParticleNodeBase;\r\n\r\n\t\tfor (var i:number = 0; i < this._particleAnimationSet.particleNodes.length; i++) {\r\n\t\t\tnode = this._particleAnimationSet.particleNodes[i];\r\n\t\t\tstate = <ParticleStateBase> this.getAnimationState(node);\r\n\t\t\tif (node.mode == ParticlePropertiesMode.LOCAL_DYNAMIC) {\r\n\t\t\t\tthis._animatorParticleStates.push(state);\r\n\t\t\t\tnode._iDataOffset = this._totalLenOfOneVertex;\r\n\t\t\t\tthis._totalLenOfOneVertex += node.dataLength;\r\n\t\t\t} else {\r\n\t\t\t\tthis._animationParticleStates.push(state);\r\n\t\t\t}\r\n\t\t\tif (state.needUpdateTime)\r\n\t\t\t\tthis._timeParticleStates.push(state);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\treturn new ParticleAnimator(this._particleAnimationSet);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\tvar animationRegisterCache:AnimationRegisterCache = this._particleAnimationSet._iAnimationRegisterCache;\r\n\r\n\t\tvar subMesh:ISubMesh = (<TriangleSubMeshRenderable> renderable).subMesh;\r\n\t\tvar state:ParticleStateBase;\r\n\t\tvar i:number;\r\n\r\n\t\tif (!subMesh)\r\n\t\t\tthrow(new Error(\"Must be subMesh\"));\r\n\r\n\t\t//process animation sub geometries\r\n\t\tvar animationSubGeometry:AnimationSubGeometry = this._particleAnimationSet.getAnimationSubGeometry(subMesh);\r\n\r\n\t\tfor (i = 0; i < this._animationParticleStates.length; i++)\r\n\t\t\tthis._animationParticleStates[i].setRenderState(stage, renderable, animationSubGeometry, animationRegisterCache, camera);\r\n\r\n\t\t//process animator subgeometries\r\n\t\tvar animatorSubGeometry:AnimationSubGeometry = this.getAnimatorSubGeometry(subMesh);\r\n\r\n\t\tfor (i = 0; i < this._animatorParticleStates.length; i++)\r\n\t\t\tthis._animatorParticleStates[i].setRenderState(stage, renderable, animatorSubGeometry, animationRegisterCache, camera);\r\n\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, animationRegisterCache.vertexConstantOffset, animationRegisterCache.vertexConstantData, animationRegisterCache.numVertexConstant);\r\n\r\n\t\tif (animationRegisterCache.numFragmentConstant > 0)\r\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, animationRegisterCache.fragmentConstantOffset, animationRegisterCache.fragmentConstantData, animationRegisterCache.numFragmentConstant);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic start()\r\n\t{\r\n\t\tsuper.start();\r\n\r\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\r\n\t\t\tthis._timeParticleStates[i].offset(this._pAbsoluteTime);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tthis._pAbsoluteTime += dt;\r\n\r\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\r\n\t\t\tthis._timeParticleStates[i].update(this._pAbsoluteTime);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic resetTime(offset:number /*int*/ = 0)\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._timeParticleStates.length; i++)\r\n\t\t\tthis._timeParticleStates[i].offset(this._pAbsoluteTime + offset);\r\n\t\tthis.update(this.time);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var key in this._animatorSubGeometries)\r\n\t\t\t(<AnimationSubGeometry> this._animatorSubGeometries[key]).dispose();\r\n\t}\r\n\r\n\tprivate getAnimatorSubGeometry(subMesh:ISubMesh):AnimationSubGeometry\r\n\t{\r\n\t\tif (!this._animatorParticleStates.length)\r\n\t\t\treturn;\r\n\r\n\t\tvar subGeometry:SubGeometryBase = subMesh.subGeometry;\r\n\t\tvar animatorSubGeometry:AnimationSubGeometry = this._animatorSubGeometries[subGeometry.id] = new AnimationSubGeometry();\r\n\r\n\t\t//create the vertexData vector that will be used for local state data\r\n\t\tanimatorSubGeometry.createVertexData(subGeometry.numVertices, this._totalLenOfOneVertex);\r\n\r\n\t\t//pass the particles data to the animator subGeometry\r\n\t\tanimatorSubGeometry.animationParticles = this._particleAnimationSet.getAnimationSubGeometry(subMesh).animationParticles;\r\n\t}\r\n}\r\n\r\nexport = ParticleAnimator;",
    "import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\n\r\n/**\r\n * The animation data set used by skeleton-based animators, containing skeleton animation data.\r\n *\r\n * @see away.animators.SkeletonAnimator\r\n */\r\nclass SkeletonAnimationSet extends AnimationSetBase implements IAnimationSet\r\n{\r\n\tprivate _jointsPerVertex:number /*uint*/;\r\n\r\n\t/**\r\n\t * Returns the amount of skeleton joints that can be linked to a single vertex via skinned weight values. For GPU-base animation, the\r\n\t * maximum allowed value is 4.\r\n\t */\r\n\tpublic get jointsPerVertex():number /*uint*/\r\n\t{\r\n\t\treturn this._jointsPerVertex;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonAnimationSet</code> object.\r\n\t *\r\n\t * @param jointsPerVertex Sets the amount of skeleton joints that can be linked to a single vertex via skinned weight values. For GPU-base animation, the maximum allowed value is 4. Defaults to 4.\r\n\t */\r\n\tconstructor(jointsPerVertex:number /*uint*/ = 4)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._jointsPerVertex = jointsPerVertex;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\tvar len:number /*uint*/ = shaderObject.animatableAttributes.length;\r\n\r\n\t\tvar indexOffset0:number /*uint*/ = shaderObject.numUsedVertexConstants;\r\n\t\tvar indexOffset1:number /*uint*/ = indexOffset0 + 1;\r\n\t\tvar indexOffset2:number /*uint*/ = indexOffset0 + 2;\r\n\t\tvar indexStream:string = \"va\" + shaderObject.numUsedStreams;\r\n\t\tvar weightStream:string = \"va\" + (shaderObject.numUsedStreams + 1);\r\n\t\tvar indices:Array<string> = [ indexStream + \".x\", indexStream + \".y\", indexStream + \".z\", indexStream + \".w\" ];\r\n\t\tvar weights:Array<string> = [ weightStream + \".x\", weightStream + \".y\", weightStream + \".z\", weightStream + \".w\" ];\r\n\t\tvar temp1:string = this._pFindTempReg(shaderObject.animationTargetRegisters);\r\n\t\tvar temp2:string = this._pFindTempReg(shaderObject.animationTargetRegisters, temp1);\r\n\t\tvar dot:string = \"dp4\";\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\r\n\t\t\tvar src:string = shaderObject.animatableAttributes[i];\r\n\r\n\t\t\tfor (var j:number /*uint*/ = 0; j < this._jointsPerVertex; ++j) {\r\n\t\t\t\tcode += dot + \" \" + temp1 + \".x, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset0 + \"]\\n\" +\r\n\t\t\t\t\tdot + \" \" + temp1 + \".y, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset1 + \"]\\n\" +\r\n\t\t\t\t\tdot + \" \" + temp1 + \".z, \" + src + \", vc[\" + indices[j] + \"+\" + indexOffset2 + \"]\\n\" +\r\n\t\t\t\t\t\"mov \" + temp1 + \".w, \" + src + \".w\\n\" +\r\n\t\t\t\t\t\"mul \" + temp1 + \", \" + temp1 + \", \" + weights[j] + \"\\n\"; // apply weight\r\n\r\n\t\t\t\t// add or mov to target. Need to write to a temp reg first, because an output can be a target\r\n\t\t\t\tif (j == 0)\r\n\t\t\t\t\tcode += \"mov \" + temp2 + \", \" + temp1 + \"\\n\"; else\r\n\t\t\t\t\tcode += \"add \" + temp2 + \", \" + temp2 + \", \" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\t\t\t// switch to dp3 once positions have been transformed, from now on, it should only be vectors instead of points\r\n\t\t\tdot = \"dp3\";\r\n\t\t\tcode += \"mov \" + shaderObject.animationTargetRegisters[i] + \", \" + temp2 + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar streamOffset:number /*uint*/ = pass.numUsedStreams;\r\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n//\t\t\tcontext.setVertexBufferAt(streamOffset, null);\r\n//\t\t\tcontext.setVertexBufferAt(streamOffset + 1, null);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\treturn \"mov \" + shaderObject.uvTarget + \",\" + shaderObject.uvSource + \"\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = SkeletonAnimationSet;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport TriangleSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport SubGeometryEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\n\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\r\n\r\n/**\r\n * Provides an interface for assigning skeleton-based animation data sets to mesh-based entity objects\r\n * and controlling the various available states of animation through an interative playhead that can be\r\n * automatically updated or manually triggered.\r\n */\r\nclass SkeletonAnimator extends AnimatorBase\r\n{\r\n\tprivate _globalMatrices:Array<number>;\r\n\tprivate _globalPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _globalPropertiesDirty:boolean;\r\n\tprivate _numJoints:number /*uint*/;\r\n\tprivate _morphedSubGeometry:Object = new Object();\r\n\tprivate _morphedSubGeometryDirty:Object = new Object();\r\n\tprivate _condensedMatrices:Array<number>;\r\n\r\n\tprivate _skeleton:Skeleton;\r\n\tprivate _forceCPU:boolean;\r\n\tprivate _useCondensedIndices:boolean;\r\n\tprivate _jointsPerVertex:number /*uint*/;\r\n\tprivate _activeSkeletonState:ISkeletonAnimationState;\r\n\tprivate _onTransitionCompleteDelegate:(event:AnimationStateEvent) => void;\r\n\r\n\tprivate _onIndicesUpdateDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _onVerticesUpdateDelegate:(event:SubGeometryEvent) => void;\r\n\r\n\t/**\r\n\t * returns the calculated global matrices of the current skeleton pose.\r\n\t *\r\n\t * @see #globalPose\r\n\t */\r\n\tpublic get globalMatrices():Array<number>\r\n\t{\r\n\t\tif (this._globalPropertiesDirty)\r\n\t\t\tthis.updateGlobalProperties();\r\n\r\n\t\treturn this._globalMatrices;\r\n\t}\r\n\r\n\t/**\r\n\t * returns the current skeleton pose output from the animator.\r\n\t *\r\n\t * @see away.animators.data.SkeletonPose\r\n\t */\r\n\tpublic get globalPose():SkeletonPose\r\n\t{\r\n\t\tif (this._globalPropertiesDirty)\r\n\t\t\tthis.updateGlobalProperties();\r\n\r\n\t\treturn this._globalPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the skeleton object in use by the animator - this defines the number and heirarchy of joints used by the\r\n\t * skinned geoemtry to which skeleon animator is applied.\r\n\t */\r\n\tpublic get skeleton():Skeleton\r\n\t{\r\n\t\treturn this._skeleton;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the skeleton animator is disabled by default for GPU rendering, something that allows the animator to perform calculation on the GPU.\r\n\t * Defaults to false.\r\n\t */\r\n\tpublic get forceCPU():boolean\r\n\t{\r\n\t\treturn this._forceCPU;\r\n\t}\r\n\r\n\t/**\r\n\t * Offers the option of enabling GPU accelerated animation on skeletons larger than 32 joints\r\n\t * by condensing the number of joint index values required per mesh. Only applicable to\r\n\t * skeleton animations that utilise more than one mesh object. Defaults to false.\r\n\t */\r\n\tpublic get useCondensedIndices():boolean\r\n\t{\r\n\t\treturn this._useCondensedIndices;\r\n\t}\r\n\r\n\tpublic set useCondensedIndices(value:boolean)\r\n\t{\r\n\t\tthis._useCondensedIndices = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonAnimator</code> object.\r\n\t *\r\n\t * @param skeletonAnimationSet The animation data set containing the skeleton animations used by the animator.\r\n\t * @param skeleton The skeleton object used for calculating the resulting global matrices for transforming skinned mesh data.\r\n\t * @param forceCPU Optional value that only allows the animator to perform calculation on the CPU. Defaults to false.\r\n\t */\r\n\tconstructor(animationSet:SkeletonAnimationSet, skeleton:Skeleton, forceCPU:boolean = false)\r\n\t{\r\n\t\tsuper(animationSet);\r\n\r\n\t\tthis._skeleton = skeleton;\r\n\t\tthis._forceCPU = forceCPU;\r\n\t\tthis._jointsPerVertex = animationSet.jointsPerVertex;\r\n\r\n\t\tthis._numJoints = this._skeleton.numJoints;\r\n\t\tthis._globalMatrices = new Array<number>(this._numJoints*12);\r\n\r\n\t\tvar j:number /*int*/ = 0;\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numJoints; ++i) {\r\n\t\t\tthis._globalMatrices[j++] = 1;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 1;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t\tthis._globalMatrices[j++] = 1;\r\n\t\t\tthis._globalMatrices[j++] = 0;\r\n\t\t}\r\n\r\n\t\tthis._onTransitionCompleteDelegate = (event:AnimationStateEvent) => this.onTransitionComplete(event);\r\n\t\tthis._onIndicesUpdateDelegate = (event:SubGeometryEvent) => this.onIndicesUpdate(event);\r\n\t\tthis._onVerticesUpdateDelegate = (event:SubGeometryEvent) => this.onVerticesUpdate(event);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\t/* The cast to SkeletonAnimationSet should never fail, as _animationSet can only be set\r\n\t\t through the constructor, which will only accept a SkeletonAnimationSet. */\r\n\t\treturn new SkeletonAnimator(<SkeletonAnimationSet> this._pAnimationSet, this._skeleton, this._forceCPU);\r\n\t}\r\n\r\n\t/**\r\n\t * Plays an animation state registered with the given name in the animation data set.\r\n\t *\r\n\t * @param name The data set name of the animation state to be played.\r\n\t * @param transition An optional transition object that determines how the animator will transition from the currently active animation state.\r\n\t * @param offset An option offset time (in milliseconds) that resets the state's internal clock to the absolute time of the animator plus the offset value. Required for non-looping animation states.\r\n\t */\r\n\tpublic play(name:string, transition:IAnimationTransition = null, offset:number = NaN)\r\n\t{\r\n\t\tif (this._pActiveAnimationName == name)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pActiveAnimationName = name;\r\n\r\n\t\tif (!this._pAnimationSet.hasAnimation(name))\r\n\t\t\tthrow new Error(\"Animation root node \" + name + \" not found!\");\r\n\r\n\t\tif (transition && this._pActiveNode) {\r\n\t\t\t//setup the transition\r\n\t\t\tthis._pActiveNode = transition.getAnimationNode(this, this._pActiveNode, this._pAnimationSet.getAnimation(name), this._pAbsoluteTime);\r\n\t\t\tthis._pActiveNode.addEventListener(AnimationStateEvent.TRANSITION_COMPLETE, this._onTransitionCompleteDelegate);\r\n\t\t} else\r\n\t\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(name);\r\n\r\n\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\r\n\r\n\t\tif (this.updatePosition) {\r\n\t\t\t//update straight away to reset position deltas\r\n\t\t\tthis._pActiveState.update(this._pAbsoluteTime);\r\n\t\t\tthis._pActiveState.positionDelta;\r\n\t\t}\r\n\r\n\t\tthis._activeSkeletonState = <ISkeletonAnimationState> this._pActiveState;\r\n\r\n\t\tthis.start();\r\n\r\n\t\t//apply a time offset if specified\r\n\t\tif (!isNaN(offset))\r\n\t\t\tthis.reset(name, offset);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\t// do on request of globalProperties\r\n\t\tif (this._globalPropertiesDirty)\r\n\t\t\tthis.updateGlobalProperties();\r\n\r\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> (<TriangleSubMesh> (<TriangleSubMeshRenderable> renderable).subMesh).subGeometry;\r\n\r\n\t\tsubGeometry.useCondensedIndices = this._useCondensedIndices;\r\n\r\n\t\tif (this._useCondensedIndices) {\r\n\t\t\t// using a condensed data set\r\n\t\t\tthis.updateCondensedMatrices(subGeometry.condensedIndexLookUp, subGeometry.numCondensedJoints);\r\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._condensedMatrices, subGeometry.numCondensedJoints*3);\r\n\t\t} else {\r\n\t\t\tif (this._pAnimationSet.usesCPU) {\r\n\t\t\t\tif (this._morphedSubGeometryDirty[subGeometry.id])\r\n\t\t\t\t\tthis.morphSubGeometry(<TriangleSubMeshRenderable> renderable, subGeometry);\r\n\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._globalMatrices, this._numJoints*3);\r\n\t\t}\r\n\r\n\t\tstage.activateBuffer(vertexStreamOffset, renderable.getVertexData(TriangleSubGeometry.JOINT_INDEX_DATA), renderable.getVertexOffset(TriangleSubGeometry.JOINT_INDEX_DATA), renderable.JOINT_INDEX_FORMAT);\r\n\t\tstage.activateBuffer(vertexStreamOffset + 1, renderable.getVertexData(TriangleSubGeometry.JOINT_WEIGHT_DATA), renderable.getVertexOffset(TriangleSubGeometry.JOINT_WEIGHT_DATA), renderable.JOINT_WEIGHT_FORMAT);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tif (!this._useCondensedIndices && (this._forceCPU || this._jointsPerVertex > 4 || shaderObject.numUsedVertexConstants + this._numJoints*3 > 128))\r\n\t\t\tthis._pAnimationSet.cancelGPUCompatibility();\r\n\t}\r\n\r\n\t/**\r\n\t * Applies the calculated time delta to the active animation state node or state transition object.\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tsuper._pUpdateDeltaTime(dt);\r\n\r\n\t\t//invalidate pose matrices\r\n\t\tthis._globalPropertiesDirty = true;\r\n\r\n\t\t//trigger geometry invalidation if using CPU animation\r\n\t\tif (this._pAnimationSet.usesCPU)\r\n\t\t\tfor (var key in this._morphedSubGeometryDirty)\r\n\t\t\t\tthis._morphedSubGeometryDirty[key] = true;\r\n\t}\r\n\r\n\tprivate updateCondensedMatrices(condensedIndexLookUp:Array<number> /*uint*/, numJoints:number /*uint*/)\r\n\t{\r\n\t\tvar i:number /*uint*/ = 0, j:number /*uint*/ = 0;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar srcIndex:number /*uint*/;\r\n\r\n\t\tthis._condensedMatrices = new Array<number>();\r\n\r\n\t\tdo {\r\n\t\t\tsrcIndex = condensedIndexLookUp[i]*4;\r\n\t\t\tlen = srcIndex + 12;\r\n\t\t\t// copy into condensed\r\n\t\t\twhile (srcIndex < len)\r\n\t\t\t\tthis._condensedMatrices[j++] = this._globalMatrices[srcIndex++];\r\n\t\t} while (++i < numJoints);\r\n\t}\r\n\r\n\tprivate updateGlobalProperties()\r\n\t{\r\n\t\tthis._globalPropertiesDirty = false;\r\n\r\n\t\t//get global pose\r\n\t\tthis.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton), this._globalPose, this._skeleton);\r\n\r\n\t\t// convert pose to matrix\r\n\t\tvar mtxOffset:number /*uint*/ = 0;\r\n\t\tvar globalPoses:Array<JointPose> = this._globalPose.jointPoses;\r\n\t\tvar raw:Array<number>;\r\n\t\tvar ox:number, oy:number, oz:number, ow:number;\r\n\t\tvar xy2:number, xz2:number, xw2:number;\r\n\t\tvar yz2:number, yw2:number, zw2:number;\r\n\t\tvar n11:number, n12:number, n13:number;\r\n\t\tvar n21:number, n22:number, n23:number;\r\n\t\tvar n31:number, n32:number, n33:number;\r\n\t\tvar m11:number, m12:number, m13:number, m14:number;\r\n\t\tvar m21:number, m22:number, m23:number, m24:number;\r\n\t\tvar m31:number, m32:number, m33:number, m34:number;\r\n\t\tvar joints:Array<SkeletonJoint> = this._skeleton.joints;\r\n\t\tvar pose:JointPose;\r\n\t\tvar quat:Quaternion;\r\n\t\tvar vec:Vector3D;\r\n\t\tvar t:number;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numJoints; ++i) {\r\n\t\t\tpose = globalPoses[i];\r\n\t\t\tquat = pose.orientation;\r\n\t\t\tvec = pose.translation;\r\n\t\t\tox = quat.x;\r\n\t\t\toy = quat.y;\r\n\t\t\toz = quat.z;\r\n\t\t\tow = quat.w;\r\n\r\n\t\t\txy2 = (t = 2.0*ox)*oy;\r\n\t\t\txz2 = t*oz;\r\n\t\t\txw2 = t*ow;\r\n\t\t\tyz2 = (t = 2.0*oy)*oz;\r\n\t\t\tyw2 = t*ow;\r\n\t\t\tzw2 = 2.0*oz*ow;\r\n\r\n\t\t\tyz2 = 2.0*oy*oz;\r\n\t\t\tyw2 = 2.0*oy*ow;\r\n\t\t\tzw2 = 2.0*oz*ow;\r\n\t\t\tox *= ox;\r\n\t\t\toy *= oy;\r\n\t\t\toz *= oz;\r\n\t\t\tow *= ow;\r\n\r\n\t\t\tn11 = (t = ox - oy) - oz + ow;\r\n\t\t\tn12 = xy2 - zw2;\r\n\t\t\tn13 = xz2 + yw2;\r\n\t\t\tn21 = xy2 + zw2;\r\n\t\t\tn22 = -t - oz + ow;\r\n\t\t\tn23 = yz2 - xw2;\r\n\t\t\tn31 = xz2 - yw2;\r\n\t\t\tn32 = yz2 + xw2;\r\n\t\t\tn33 = -ox - oy + oz + ow;\r\n\r\n\t\t\t// prepend inverse bind pose\r\n\t\t\traw = joints[i].inverseBindPose;\r\n\t\t\tm11 = raw[0];\r\n\t\t\tm12 = raw[4];\r\n\t\t\tm13 = raw[8];\r\n\t\t\tm14 = raw[12];\r\n\t\t\tm21 = raw[1];\r\n\t\t\tm22 = raw[5];\r\n\t\t\tm23 = raw[9];\r\n\t\t\tm24 = raw[13];\r\n\t\t\tm31 = raw[2];\r\n\t\t\tm32 = raw[6];\r\n\t\t\tm33 = raw[10];\r\n\t\t\tm34 = raw[14];\r\n\r\n\t\t\tthis._globalMatrices[mtxOffset] = n11*m11 + n12*m21 + n13*m31;\r\n\t\t\tthis._globalMatrices[mtxOffset + 1] = n11*m12 + n12*m22 + n13*m32;\r\n\t\t\tthis._globalMatrices[mtxOffset + 2] = n11*m13 + n12*m23 + n13*m33;\r\n\t\t\tthis._globalMatrices[mtxOffset + 3] = n11*m14 + n12*m24 + n13*m34 + vec.x;\r\n\t\t\tthis._globalMatrices[mtxOffset + 4] = n21*m11 + n22*m21 + n23*m31;\r\n\t\t\tthis._globalMatrices[mtxOffset + 5] = n21*m12 + n22*m22 + n23*m32;\r\n\t\t\tthis._globalMatrices[mtxOffset + 6] = n21*m13 + n22*m23 + n23*m33;\r\n\t\t\tthis._globalMatrices[mtxOffset + 7] = n21*m14 + n22*m24 + n23*m34 + vec.y;\r\n\t\t\tthis._globalMatrices[mtxOffset + 8] = n31*m11 + n32*m21 + n33*m31;\r\n\t\t\tthis._globalMatrices[mtxOffset + 9] = n31*m12 + n32*m22 + n33*m32;\r\n\t\t\tthis._globalMatrices[mtxOffset + 10] = n31*m13 + n32*m23 + n33*m33;\r\n\t\t\tthis._globalMatrices[mtxOffset + 11] = n31*m14 + n32*m24 + n33*m34 + vec.z;\r\n\r\n\t\t\tmtxOffset = mtxOffset + 12;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\r\n\t{\r\n\t\tthis._morphedSubGeometryDirty[sourceSubGeometry.id] = true;\r\n\r\n\t\t//early out for GPU animations\r\n\t\tif (!this._pAnimationSet.usesCPU)\r\n\t\t\treturn sourceSubGeometry;\r\n\r\n\t\tvar targetSubGeometry:TriangleSubGeometry;\r\n\r\n\t\tif (!(targetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id])) {\r\n\t\t\t//not yet stored\r\n\t\t\ttargetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id] = sourceSubGeometry.clone();\r\n\t\t\t//turn off auto calculations on the morphed geometry\r\n\t\t\ttargetSubGeometry.autoDeriveNormals = false;\r\n\t\t\ttargetSubGeometry.autoDeriveTangents = false;\r\n\t\t\ttargetSubGeometry.autoDeriveUVs = false;\r\n\t\t\t//add event listeners for any changes in UV values on the source geometry\r\n\t\t\tsourceSubGeometry.addEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdateDelegate);\r\n\t\t\tsourceSubGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdateDelegate);\r\n\t\t}\r\n\r\n\t\treturn targetSubGeometry;\r\n\t}\r\n\r\n\t/**\r\n\t * If the animation can't be performed on GPU, transform vertices manually\r\n\t * @param subGeom The subgeometry containing the weights and joint index data per vertex.\r\n\t * @param pass The material pass for which we need to transform the vertices\r\n\t */\r\n\tpublic morphSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry)\r\n\t{\r\n\t\tthis._morphedSubGeometryDirty[sourceSubGeometry.id] = false;\r\n\r\n\t\tvar sourcePositions:Array<number> = sourceSubGeometry.positions;\r\n\t\tvar sourceNormals:Array<number> = sourceSubGeometry.vertexNormals;\r\n\t\tvar sourceTangents:Array<number> = sourceSubGeometry.vertexTangents;\r\n\r\n\t\tvar jointIndices:Array<number> = sourceSubGeometry.jointIndices;\r\n\t\tvar jointWeights:Array<number> = sourceSubGeometry.jointWeights;\r\n\r\n\t\tvar targetSubGeometry = this._morphedSubGeometry[sourceSubGeometry.id];\r\n\r\n\t\tvar targetPositions:Array<number> = targetSubGeometry.positions;\r\n\t\tvar targetNormals:Array<number> = targetSubGeometry.vertexNormals;\r\n\t\tvar targetTangents:Array<number> = targetSubGeometry.vertexTangents;\r\n\r\n\t\tvar index:number /*uint*/ = 0;\r\n\t\tvar j:number /*uint*/ = 0;\r\n\t\tvar k:number /*uint*/;\r\n\t\tvar vx:number, vy:number, vz:number;\r\n\t\tvar nx:number, ny:number, nz:number;\r\n\t\tvar tx:number, ty:number, tz:number;\r\n\t\tvar len:number /*int*/ = sourcePositions.length;\r\n\t\tvar weight:number;\r\n\t\tvar vertX:number, vertY:number, vertZ:number;\r\n\t\tvar normX:number, normY:number, normZ:number;\r\n\t\tvar tangX:number, tangY:number, tangZ:number;\r\n\t\tvar m11:number, m12:number, m13:number, m14:number;\r\n\t\tvar m21:number, m22:number, m23:number, m24:number;\r\n\t\tvar m31:number, m32:number, m33:number, m34:number;\r\n\r\n\t\twhile (index < len) {\r\n\t\t\tvertX = sourcePositions[index];\r\n\t\t\tvertY = sourcePositions[index + 1];\r\n\t\t\tvertZ = sourcePositions[index + 2];\r\n\t\t\tnormX = sourceNormals[index];\r\n\t\t\tnormY = sourceNormals[index + 1];\r\n\t\t\tnormZ = sourceNormals[index + 2];\r\n\t\t\ttangX = sourceTangents[index];\r\n\t\t\ttangY = sourceTangents[index + 1];\r\n\t\t\ttangZ = sourceTangents[index + 2];\r\n\t\t\tvx = 0;\r\n\t\t\tvy = 0;\r\n\t\t\tvz = 0;\r\n\t\t\tnx = 0;\r\n\t\t\tny = 0;\r\n\t\t\tnz = 0;\r\n\t\t\ttx = 0;\r\n\t\t\tty = 0;\r\n\t\t\ttz = 0;\r\n\t\t\tk = 0;\r\n\t\t\twhile (k < this._jointsPerVertex) {\r\n\t\t\t\tweight = jointWeights[j];\r\n\t\t\t\tif (weight > 0) {\r\n\t\t\t\t\t// implicit /3*12 (/3 because indices are multiplied by 3 for gpu matrix access, *12 because it's the matrix size)\r\n\t\t\t\t\tvar mtxOffset:number /*uint*/ = jointIndices[j++] << 2;\r\n\t\t\t\t\tm11 = this._globalMatrices[mtxOffset];\r\n\t\t\t\t\tm12 = this._globalMatrices[mtxOffset + 1];\r\n\t\t\t\t\tm13 = this._globalMatrices[mtxOffset + 2];\r\n\t\t\t\t\tm14 = this._globalMatrices[mtxOffset + 3];\r\n\t\t\t\t\tm21 = this._globalMatrices[mtxOffset + 4];\r\n\t\t\t\t\tm22 = this._globalMatrices[mtxOffset + 5];\r\n\t\t\t\t\tm23 = this._globalMatrices[mtxOffset + 6];\r\n\t\t\t\t\tm24 = this._globalMatrices[mtxOffset + 7];\r\n\t\t\t\t\tm31 = this._globalMatrices[mtxOffset + 8];\r\n\t\t\t\t\tm32 = this._globalMatrices[mtxOffset + 9];\r\n\t\t\t\t\tm33 = this._globalMatrices[mtxOffset + 10];\r\n\t\t\t\t\tm34 = this._globalMatrices[mtxOffset + 11];\r\n\t\t\t\t\tvx += weight*(m11*vertX + m12*vertY + m13*vertZ + m14);\r\n\t\t\t\t\tvy += weight*(m21*vertX + m22*vertY + m23*vertZ + m24);\r\n\t\t\t\t\tvz += weight*(m31*vertX + m32*vertY + m33*vertZ + m34);\r\n\t\t\t\t\tnx += weight*(m11*normX + m12*normY + m13*normZ);\r\n\t\t\t\t\tny += weight*(m21*normX + m22*normY + m23*normZ);\r\n\t\t\t\t\tnz += weight*(m31*normX + m32*normY + m33*normZ);\r\n\t\t\t\t\ttx += weight*(m11*tangX + m12*tangY + m13*tangZ);\r\n\t\t\t\t\tty += weight*(m21*tangX + m22*tangY + m23*tangZ);\r\n\t\t\t\t\ttz += weight*(m31*tangX + m32*tangY + m33*tangZ);\r\n\t\t\t\t\t++k;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tj += (this._jointsPerVertex - k);\r\n\t\t\t\t\tk = this._jointsPerVertex;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttargetPositions[index] = vx;\r\n\t\t\ttargetPositions[index + 1] = vy;\r\n\t\t\ttargetPositions[index + 2] = vz;\r\n\t\t\ttargetNormals[index] = nx;\r\n\t\t\ttargetNormals[index + 1] = ny;\r\n\t\t\ttargetNormals[index + 2] = nz;\r\n\t\t\ttargetTangents[index] = tx;\r\n\t\t\ttargetTangents[index + 1] = ty;\r\n\t\t\ttargetTangents[index + 2] = tz;\r\n\r\n\t\t\tindex += 3;\r\n\t\t}\r\n\r\n\t\ttargetSubGeometry.updatePositions(targetPositions);\r\n\t\ttargetSubGeometry.updateVertexNormals(targetNormals);\r\n\t\ttargetSubGeometry.updateVertexTangents(targetTangents);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a local hierarchical skeleton pose to a global pose\r\n\t * @param targetPose The SkeletonPose object that will contain the global pose.\r\n\t * @param skeleton The skeleton containing the joints, and as such, the hierarchical data to transform to global poses.\r\n\t */\r\n\tprivate localToGlobalPose(sourcePose:SkeletonPose, targetPose:SkeletonPose, skeleton:Skeleton)\r\n\t{\r\n\t\tvar globalPoses:Array<JointPose> = targetPose.jointPoses;\r\n\t\tvar globalJointPose:JointPose;\r\n\t\tvar joints:Array<SkeletonJoint> = skeleton.joints;\r\n\t\tvar len:number /*uint*/ = sourcePose.numJointPoses;\r\n\t\tvar jointPoses:Array<JointPose> = sourcePose.jointPoses;\r\n\t\tvar parentIndex:number /*int*/;\r\n\t\tvar joint:SkeletonJoint;\r\n\t\tvar parentPose:JointPose;\r\n\t\tvar pose:JointPose;\r\n\t\tvar or:Quaternion;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar t:Vector3D;\r\n\t\tvar q:Quaternion;\r\n\r\n\t\tvar x1:number, y1:number, z1:number, w1:number;\r\n\t\tvar x2:number, y2:number, z2:number, w2:number;\r\n\t\tvar x3:number, y3:number, z3:number;\r\n\r\n\t\t// :s\r\n\t\tif (globalPoses.length != len)\r\n\t\t\tglobalPoses.length = len;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tglobalJointPose = globalPoses[i];\r\n\r\n\t\t\tif (globalJointPose == null)\r\n\t\t\t\tglobalJointPose = globalPoses[i] = new JointPose();\r\n\r\n\t\t\tjoint = joints[i];\r\n\t\t\tparentIndex = joint.parentIndex;\r\n\t\t\tpose = jointPoses[i];\r\n\r\n\t\t\tq = globalJointPose.orientation;\r\n\t\t\tt = globalJointPose.translation;\r\n\r\n\t\t\tif (parentIndex < 0) {\r\n\t\t\t\ttr = pose.translation;\r\n\t\t\t\tor = pose.orientation;\r\n\t\t\t\tq.x = or.x;\r\n\t\t\t\tq.y = or.y;\r\n\t\t\t\tq.z = or.z;\r\n\t\t\t\tq.w = or.w;\r\n\t\t\t\tt.x = tr.x;\r\n\t\t\t\tt.y = tr.y;\r\n\t\t\t\tt.z = tr.z;\r\n\t\t\t} else {\r\n\t\t\t\t// append parent pose\r\n\t\t\t\tparentPose = globalPoses[parentIndex];\r\n\r\n\t\t\t\t// rotate point\r\n\t\t\t\tor = parentPose.orientation;\r\n\t\t\t\ttr = pose.translation;\r\n\t\t\t\tx2 = or.x;\r\n\t\t\t\ty2 = or.y;\r\n\t\t\t\tz2 = or.z;\r\n\t\t\t\tw2 = or.w;\r\n\t\t\t\tx3 = tr.x;\r\n\t\t\t\ty3 = tr.y;\r\n\t\t\t\tz3 = tr.z;\r\n\r\n\t\t\t\tw1 = -x2*x3 - y2*y3 - z2*z3;\r\n\t\t\t\tx1 = w2*x3 + y2*z3 - z2*y3;\r\n\t\t\t\ty1 = w2*y3 - x2*z3 + z2*x3;\r\n\t\t\t\tz1 = w2*z3 + x2*y3 - y2*x3;\r\n\r\n\t\t\t\t// append parent translation\r\n\t\t\t\ttr = parentPose.translation;\r\n\t\t\t\tt.x = -w1*x2 + x1*w2 - y1*z2 + z1*y2 + tr.x;\r\n\t\t\t\tt.y = -w1*y2 + x1*z2 + y1*w2 - z1*x2 + tr.y;\r\n\t\t\t\tt.z = -w1*z2 - x1*y2 + y1*x2 + z1*w2 + tr.z;\r\n\r\n\t\t\t\t// append parent orientation\r\n\t\t\t\tx1 = or.x;\r\n\t\t\t\ty1 = or.y;\r\n\t\t\t\tz1 = or.z;\r\n\t\t\t\tw1 = or.w;\r\n\t\t\t\tor = pose.orientation;\r\n\t\t\t\tx2 = or.x;\r\n\t\t\t\ty2 = or.y;\r\n\t\t\t\tz2 = or.z;\r\n\t\t\t\tw2 = or.w;\r\n\r\n\t\t\t\tq.w = w1*w2 - x1*x2 - y1*y2 - z1*z2;\r\n\t\t\t\tq.x = w1*x2 + x1*w2 + y1*z2 - z1*y2;\r\n\t\t\t\tq.y = w1*y2 - x1*z2 + y1*w2 + z1*x2;\r\n\t\t\t\tq.z = w1*z2 + x1*y2 - y1*x2 + z1*w2;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onTransitionComplete(event:AnimationStateEvent)\r\n\t{\r\n\t\tif (event.type == AnimationStateEvent.TRANSITION_COMPLETE) {\r\n\t\t\tevent.animationNode.removeEventListener(AnimationStateEvent.TRANSITION_COMPLETE, this._onTransitionCompleteDelegate);\r\n\t\t\t//if this is the current active state transition, revert control to the active node\r\n\t\t\tif (this._pActiveState == event.animationState) {\r\n\t\t\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(this._pActiveAnimationName);\r\n\t\t\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\r\n\t\t\t\tthis._activeSkeletonState = <ISkeletonAnimationState> this._pActiveState;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onIndicesUpdate(event:SubGeometryEvent)\r\n\t{\r\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> event.target;\r\n\r\n\t\t(<TriangleSubGeometry> this._morphedSubGeometry[subGeometry.id]).updateIndices(subGeometry.indices);\r\n\t}\r\n\r\n\tprivate onVerticesUpdate(event:SubGeometryEvent)\r\n\t{\r\n\t\tvar subGeometry:TriangleSubGeometry = <TriangleSubGeometry> event.target;\r\n\t\tvar morphGeometry:TriangleSubGeometry = <TriangleSubGeometry> this._morphedSubGeometry[subGeometry.id];\r\n\r\n\t\tswitch(event.dataType) {\r\n\t\t\tcase TriangleSubGeometry.UV_DATA:\r\n\t\t\t\tmorphGeometry.updateUVs(subGeometry.uvs);\r\n\t\t\tcase TriangleSubGeometry.SECONDARY_UV_DATA:\r\n\t\t\t\tmorphGeometry.updateUVs(subGeometry.secondaryUVs);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonAnimator;",
    "import IAnimationSet\t\t\t\t\t= require(\"awayjs-display/lib/animators/IAnimationSet\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport VertexAnimationMode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/VertexAnimationMode\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\n\r\n/**\r\n * The animation data set used by vertex-based animators, containing vertex animation state data.\r\n *\r\n * @see VertexAnimator\r\n */\r\nclass VertexAnimationSet extends AnimationSetBase implements IAnimationSet\r\n{\r\n\tprivate _numPoses:number /*uint*/;\r\n\tprivate _blendMode:string;\r\n\r\n\t/**\r\n\t * Returns the number of poses made available at once to the GPU animation code.\r\n\t */\r\n\tpublic get numPoses():number /*uint*/\r\n\t{\r\n\t\treturn this._numPoses;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the active blend mode of the vertex animator object.\r\n\t */\r\n\tpublic get blendMode():string\r\n\t{\r\n\t\treturn this._blendMode;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether or not normal data is used in last set GPU pass of the vertex shader.\r\n\t */\r\n//\t\tpublic get useNormals():boolean\r\n//\t\t{\r\n//\t\t\treturn this._uploadNormals;\r\n//\t\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>VertexAnimationSet</code> object.\r\n\t *\r\n\t * @param numPoses The number of poses made available at once to the GPU animation code.\r\n\t * @param blendMode Optional value for setting the animation mode of the vertex animator object.\r\n\t *\r\n\t * @see away3d.animators.data.VertexAnimationMode\r\n\t */\r\n\tconstructor(numPoses:number /*uint*/ = 2, blendMode:string = \"absolute\")\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._numPoses = numPoses;\r\n\t\tthis._blendMode = blendMode;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE)\r\n\t\t\treturn this.getAbsoluteAGALCode(shaderObject);\r\n\t\telse\r\n\t\t\treturn this.getAdditiveAGALCode(shaderObject);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic activate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar uID:number = pass._iUniqueId;\r\n//\t\t\tthis._uploadNormals = <boolean> this._useNormals[uID];\r\n//\t\t\tthis._uploadTangents = <boolean> this._useTangents[uID];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic deactivate(shaderObject:ShaderObjectBase, stage:Stage)\r\n\t{\r\n//\t\t\tvar uID:number = pass._iUniqueId;\r\n//\t\t\tvar index:number /*uint*/ = this._streamIndices[uID];\r\n//\t\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n//\t\t\tcontext.setVertexBufferAt(index, null);\r\n//\t\t\tif (this._uploadNormals)\r\n//\t\t\t\tcontext.setVertexBufferAt(index + 1, null);\r\n//\t\t\tif (this._uploadTangents)\r\n//\t\t\t\tcontext.setVertexBufferAt(index + 2, null);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, shadedTarget:string):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\treturn \"mov \" + shaderObject.uvTarget + \",\" + shaderObject.uvSource + \"\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic doneAGALCode(shaderObject:ShaderObjectBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Generates the vertex AGAL code for absolute blending.\r\n\t */\r\n\tprivate getAbsoluteAGALCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar temp1:string = this._pFindTempReg(shaderObject.animationTargetRegisters);\r\n\t\tvar temp2:string = this._pFindTempReg(shaderObject.animationTargetRegisters, temp1);\r\n\t\tvar regs:Array<string> = new Array<string>(\"x\", \"y\", \"z\", \"w\");\r\n\t\tvar len:number /*uint*/ = shaderObject.animatableAttributes.length;\r\n\t\tvar constantReg:string = \"vc\" + shaderObject.numUsedVertexConstants;\r\n\r\n\t\tif (len > 2)\r\n\t\t\tlen = 2;\r\n\t\tvar streamIndex:number /*uint*/ = shaderObject.numUsedStreams;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tcode += \"mul \" + temp1 + \", \" + shaderObject.animatableAttributes[i] + \", \" + constantReg + \".\" + regs[0] + \"\\n\";\r\n\r\n\t\t\tfor (var j:number /*uint*/ = 1; j < this._numPoses; ++j) {\r\n\t\t\t\tcode += \"mul \" + temp2 + \", va\" + streamIndex + \", \" + constantReg + \".\" + regs[j] + \"\\n\";\r\n\r\n\t\t\t\tif (j < this._numPoses - 1)\r\n\t\t\t\t\tcode += \"add \" + temp1 + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\r\n\t\t\t\t++streamIndex;\r\n\t\t\t}\r\n\r\n\t\t\tcode += \"add \" + shaderObject.animationTargetRegisters[i] + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\t\t}\r\n\r\n\t\t// add code for bitangents if tangents are used\r\n\t\tif (shaderObject.tangentDependencies > 0 || shaderObject.outputsNormals) {\r\n\t\t\tcode += \"dp3 \" + temp1 + \".x, \" + shaderObject.animatableAttributes[2] + \", \" + shaderObject.animationTargetRegisters[1] + \"\\n\" +\r\n\t\t\t\t\"mul \" + temp1 + \", \" + shaderObject.animationTargetRegisters[1] + \", \" + temp1 + \".x\\n\" +\r\n\t\t\t\t\"sub \" + shaderObject.animationTargetRegisters[2] + \", \" + shaderObject.animationTargetRegisters[2] + \", \" + temp1 + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates the vertex AGAL code for additive blending.\r\n\t */\r\n\tprivate getAdditiveAGALCode(shaderObject:ShaderObjectBase):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar len:number /*uint*/ = shaderObject.animatableAttributes.length;\r\n\t\tvar regs:Array<string> = [\"x\", \"y\", \"z\", \"w\"];\r\n\t\tvar temp1:string = this._pFindTempReg(shaderObject.animationTargetRegisters);\r\n\t\tvar k:number /*uint*/;\r\n\r\n\t\tvar streamIndex:number /*uint*/ = shaderObject.numUsedStreams;\r\n\r\n\t\tif (len > 2)\r\n\t\t\tlen = 2;\r\n\r\n\t\tcode += \"mov  \" + shaderObject.animationTargetRegisters[0] + \", \" + shaderObject.animatableAttributes[0] + \"\\n\";\r\n\t\tif (shaderObject.normalDependencies > 0)\r\n\t\t\tcode += \"mov \" + shaderObject.animationTargetRegisters[1] + \", \" + shaderObject.animatableAttributes[1] + \"\\n\";\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tfor (var j:number /*uint*/ = 0; j < this._numPoses; ++j) {\r\n\t\t\t\tcode += \"mul \" + temp1 + \", va\" + (streamIndex + k) + \", vc\" + shaderObject.numUsedVertexConstants + \".\" + regs[j] + \"\\n\" +\r\n\t\t\t\t\t\"add \" + shaderObject.animationTargetRegisters[i] + \", \" + shaderObject.animationTargetRegisters[i] + \", \" + temp1 + \"\\n\";\r\n\t\t\t\tk++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (shaderObject.tangentDependencies > 0 || shaderObject.outputsNormals) {\r\n\t\t\tcode += \"dp3 \" + temp1 + \".x, \" + shaderObject.animatableAttributes[2] + \", \" + shaderObject.animationTargetRegisters[1] + \"\\n\" +\r\n\t\t\t\t\"mul \" + temp1 + \", \" + shaderObject.animationTargetRegisters[1] + \", \" + temp1 + \".x\\n\" +\r\n\t\t\t\t\"sub \" + shaderObject.animationTargetRegisters[2] + \", \" + shaderObject.animatableAttributes[2] + \", \" + temp1 + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n}\r\n\r\nexport = VertexAnimationSet;",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport TriangleSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport VertexDataPool\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexDataPool\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport VertexAnimationMode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/VertexAnimationMode\");\r\nimport IVertexAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IVertexAnimationState\");\r\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\r\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\n\r\n/**\r\n * Provides an interface for assigning vertex-based animation data sets to mesh-based entity objects\r\n * and controlling the various available states of animation through an interative playhead that can be\r\n * automatically updated or manually triggered.\r\n */\r\nclass VertexAnimator extends AnimatorBase\r\n{\r\n\tprivate _vertexAnimationSet:VertexAnimationSet;\r\n\tprivate _poses:Array<Geometry> = new Array<Geometry>();\r\n\tprivate _weights:Array<number> = Array<number>(1, 0, 0, 0);\r\n\tprivate _numPoses:number /*uint*/;\r\n\tprivate _blendMode:string;\r\n\tprivate _activeVertexState:IVertexAnimationState;\r\n\r\n\t/**\r\n\t * Creates a new <code>VertexAnimator</code> object.\r\n\t *\r\n\t * @param vertexAnimationSet The animation data set containing the vertex animations used by the animator.\r\n\t */\r\n\tconstructor(vertexAnimationSet:VertexAnimationSet)\r\n\t{\r\n\t\tsuper(vertexAnimationSet);\r\n\r\n\t\tthis._vertexAnimationSet = vertexAnimationSet;\r\n\t\tthis._numPoses = vertexAnimationSet.numPoses;\r\n\t\tthis._blendMode = vertexAnimationSet.blendMode;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic clone():AnimatorBase\r\n\t{\r\n\t\treturn new VertexAnimator(this._vertexAnimationSet);\r\n\t}\r\n\r\n\t/**\r\n\t * Plays a sequence with a given name. If the sequence is not found, it may not be loaded yet, and it will retry every frame.\r\n\t * @param sequenceName The name of the clip to be played.\r\n\t */\r\n\tpublic play(name:string, transition:IAnimationTransition = null, offset:number = NaN)\r\n\t{\r\n\t\tif (this._pActiveAnimationName == name)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pActiveAnimationName = name;\r\n\r\n\t\t//TODO: implement transitions in vertex animator\r\n\r\n\t\tif (!this._pAnimationSet.hasAnimation(name))\r\n\t\t\tthrow new Error(\"Animation root node \" + name + \" not found!\");\r\n\r\n\t\tthis._pActiveNode = this._pAnimationSet.getAnimation(name);\r\n\r\n\t\tthis._pActiveState = this.getAnimationState(this._pActiveNode);\r\n\r\n\t\tif (this.updatePosition) {\r\n\t\t\t//update straight away to reset position deltas\r\n\t\t\tthis._pActiveState.update(this._pAbsoluteTime);\r\n\t\t\tthis._pActiveState.positionDelta;\r\n\t\t}\r\n\r\n\t\tthis._activeVertexState = <IVertexAnimationState> this._pActiveState;\r\n\r\n\t\tthis.start();\r\n\r\n\t\t//apply a time offset if specified\r\n\t\tif (!isNaN(offset))\r\n\t\t\tthis.reset(name, offset);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateDeltaTime(dt:number)\r\n\t{\r\n\t\tsuper._pUpdateDeltaTime(dt);\r\n\r\n\t\tvar geometryFlag:boolean = false;\r\n\r\n\t\tif (this._poses[0] != this._activeVertexState.currentGeometry) {\r\n\t\t\tthis._poses[0] = this._activeVertexState.currentGeometry;\r\n\t\t\tgeometryFlag = true;\r\n\t\t}\r\n\r\n\t\tif (this._poses[1] != this._activeVertexState.nextGeometry) {\r\n\t\t\tthis._poses[1] = this._activeVertexState.nextGeometry;\r\n\t\t\tgeometryFlag = true;\r\n\t\t}\r\n\r\n\t\tthis._weights[0] = 1 - (this._weights[1] = this._activeVertexState.blendWeight);\r\n\r\n\t\tif (geometryFlag) {\r\n\t\t\t//invalidate meshes\r\n\t\t\tvar mesh:Mesh;\r\n\t\t\tvar len:number = this._pOwners.length;\r\n\t\t\tfor (var i:number = 0; i < len; i++) {\r\n\t\t\t\tmesh = this._pOwners[i];\r\n\t\t\t\tmesh._iInvalidateRenderableGeometries();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, camera:Camera, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\t// todo: add code for when running on cpu\r\n\r\n\t\t// if no poses defined, set temp data\r\n\t\tif (!this._poses.length) {\r\n\t\t\tthis.setNullPose(shaderObject, renderable, stage, vertexConstantOffset, vertexStreamOffset);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// this type of animation can only be SubMesh\r\n\t\tvar subMesh:TriangleSubMesh = <TriangleSubMesh> (<TriangleSubMeshRenderable> renderable).subMesh;\r\n\t\tvar subGeom:SubGeometryBase;\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/ = this._numPoses;\r\n\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._weights, 1);\r\n\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE)\r\n\t\t\ti = 1;\r\n\t\telse\r\n\t\t\ti = 0;\r\n\r\n\t\tfor (; i < len; ++i) {\r\n\t\t\tsubGeom = this._poses[i].subGeometries[subMesh._iIndex] || subMesh.subGeometry;\r\n\r\n\t\t\tstage.activateBuffer(vertexStreamOffset++, VertexDataPool.getItem(subGeom, renderable.getIndexData(), TriangleSubGeometry.POSITION_DATA), subGeom.getOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\r\n\r\n\t\t\tif (shaderObject.normalDependencies > 0)\r\n\t\t\t\tstage.activateBuffer(vertexStreamOffset++, VertexDataPool.getItem(subGeom, renderable.getIndexData(), TriangleSubGeometry.NORMAL_DATA), subGeom.getOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate setNullPose(shaderObject:ShaderObjectBase, renderable:RenderableBase, stage:Stage, vertexConstantOffset:number /*int*/, vertexStreamOffset:number /*int*/)\r\n\t{\r\n\t\tstage.context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, vertexConstantOffset, this._weights, 1);\r\n\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE) {\r\n\t\t\tvar len:number /*uint*/ = this._numPoses;\r\n\t\t\tfor (var i:number /*uint*/ = 1; i < len; ++i) {\r\n\t\t\t\tstage.activateBuffer(vertexStreamOffset++, renderable.getVertexData(TriangleSubGeometry.POSITION_DATA), renderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\r\n\r\n\t\t\t\tif (shaderObject.normalDependencies > 0)\r\n\t\t\t\t\tstage.activateBuffer(vertexStreamOffset++, renderable.getVertexData(TriangleSubGeometry.NORMAL_DATA), renderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// todo: set temp data for additive?\r\n\t}\r\n\r\n\t/**\r\n\t * Verifies if the animation will be used on cpu. Needs to be true for all passes for a material to be able to use it on gpu.\r\n\t * Needs to be called if gpu code is potentially required.\r\n\t */\r\n\tpublic testGPUCompatibility(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t}\r\n\r\n\tpublic getRenderableSubGeometry(renderable:TriangleSubMeshRenderable, sourceSubGeometry:TriangleSubGeometry):TriangleSubGeometry\r\n\t{\r\n\t\tif (this._blendMode == VertexAnimationMode.ABSOLUTE && this._poses.length)\r\n\t\t\treturn <TriangleSubGeometry> this._poses[0].subGeometries[renderable.subMesh._iIndex] || sourceSubGeometry;\r\n\r\n\t\t//nothing to do here\r\n\t\treturn sourceSubGeometry;\r\n\t}\r\n}\r\n\r\nexport = VertexAnimator;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nimport AnimationNodeBase\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\n\r\n/**\r\n * ...\r\n */\r\nclass AnimationRegisterCache extends ShaderRegisterCache\r\n{\r\n\t//vertex\r\n\tpublic positionAttribute:ShaderRegisterElement;\r\n\tpublic uvAttribute:ShaderRegisterElement;\r\n\tpublic positionTarget:ShaderRegisterElement;\r\n\tpublic scaleAndRotateTarget:ShaderRegisterElement;\r\n\tpublic velocityTarget:ShaderRegisterElement;\r\n\tpublic vertexTime:ShaderRegisterElement;\r\n\tpublic vertexLife:ShaderRegisterElement;\r\n\tpublic vertexZeroConst:ShaderRegisterElement;\r\n\tpublic vertexOneConst:ShaderRegisterElement;\r\n\tpublic vertexTwoConst:ShaderRegisterElement;\r\n\tpublic uvTarget:ShaderRegisterElement;\r\n\tpublic colorAddTarget:ShaderRegisterElement;\r\n\tpublic colorMulTarget:ShaderRegisterElement;\r\n\t//vary\r\n\tpublic colorAddVary:ShaderRegisterElement;\r\n\tpublic colorMulVary:ShaderRegisterElement;\r\n\r\n\t//fragment\r\n\r\n\tpublic uvVar:ShaderRegisterElement;\r\n\r\n\t//these are targets only need to rotate ( normal and tangent )\r\n\tpublic rotationRegisters:Array<ShaderRegisterElement>;\r\n\r\n\tpublic needFragmentAnimation:boolean;\r\n\tpublic needUVAnimation:boolean;\r\n\r\n\tpublic sourceRegisters:Array<string>;\r\n\tpublic targetRegisters:Array<string>;\r\n\r\n\tprivate indexDictionary:Object = new Object();\r\n\r\n\t//set true if has an node which will change UV\r\n\tpublic hasUVNode:boolean;\r\n\t//set if the other nodes need to access the velocity\r\n\tpublic needVelocity:boolean;\r\n\t//set if has a billboard node.\r\n\tpublic hasBillboard:boolean;\r\n\t//set if has an node which will apply color multiple operation\r\n\tpublic hasColorMulNode:boolean;\r\n\t//set if has an node which will apply color add operation\r\n\tpublic hasColorAddNode:boolean;\r\n\r\n\tconstructor(profile:string)\r\n\t{\r\n\t\tsuper(profile);\r\n\t}\r\n\r\n\tpublic reset()\r\n\t{\r\n\t\tsuper.reset();\r\n\r\n\t\tthis.rotationRegisters = new Array<ShaderRegisterElement>();\r\n\t\tthis.positionAttribute = this.getRegisterFromString(this.sourceRegisters[0]);\r\n\t\tthis.scaleAndRotateTarget = this.getRegisterFromString(this.targetRegisters[0]);\r\n\t\tthis.addVertexTempUsages(this.scaleAndRotateTarget, 1);\r\n\r\n\t\tfor (var i:number /*int*/ = 1; i < this.targetRegisters.length; i++) {\r\n\t\t\tthis.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[i]));\r\n\t\t\tthis.addVertexTempUsages(this.rotationRegisters[i - 1], 1);\r\n\t\t}\r\n\r\n\t\tthis.scaleAndRotateTarget = new ShaderRegisterElement(this.scaleAndRotateTarget.regName, this.scaleAndRotateTarget.index); //only use xyz, w is used as vertexLife\r\n\r\n\t\t//allot const register\r\n\r\n\t\tthis.vertexZeroConst = this.getFreeVertexConstant();\r\n\t\tthis.vertexZeroConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 0);\r\n\t\tthis.vertexOneConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 1);\r\n\t\tthis.vertexTwoConst = new ShaderRegisterElement(this.vertexZeroConst.regName, this.vertexZeroConst.index, 2);\r\n\r\n\t\t//allot temp register\r\n\t\tthis.positionTarget = this.getFreeVertexVectorTemp();\r\n\t\tthis.addVertexTempUsages(this.positionTarget, 1);\r\n\t\tthis.positionTarget = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index);\r\n\r\n\t\tif (this.needVelocity) {\r\n\t\t\tthis.velocityTarget = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(this.velocityTarget, 1);\r\n\t\t\tthis.velocityTarget = new ShaderRegisterElement(this.velocityTarget.regName, this.velocityTarget.index);\r\n\t\t\tthis.vertexTime = new ShaderRegisterElement(this.velocityTarget.regName, this.velocityTarget.index, 3);\r\n\t\t\tthis.vertexLife = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index, 3);\r\n\t\t} else {\r\n\t\t\tvar tempTime:ShaderRegisterElement = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(tempTime, 1);\r\n\t\t\tthis.vertexTime = new ShaderRegisterElement(tempTime.regName, tempTime.index, 0);\r\n\t\t\tthis.vertexLife = new ShaderRegisterElement(tempTime.regName, tempTime.index, 1);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic setUVSourceAndTarget(UVAttribute:string, UVVaring:string)\r\n\t{\r\n\t\tthis.uvVar = this.getRegisterFromString(UVVaring);\r\n\t\tthis.uvAttribute = this.getRegisterFromString(UVAttribute);\r\n\t\t//uv action is processed after normal actions,so use offsetTarget as uvTarget\r\n\t\tthis.uvTarget = new ShaderRegisterElement(this.positionTarget.regName, this.positionTarget.index);\r\n\t}\r\n\r\n\tpublic setRegisterIndex(node:AnimationNodeBase, parameterIndex:number /*int*/, registerIndex:number /*int*/)\r\n\t{\r\n\t\t//8 should be enough for any node.\r\n\t\tvar t:Array<number> /*int*/ = this.indexDictionary[node.id];\r\n\r\n\t\tif (t == null)\r\n\t\t\tt = this.indexDictionary[node.id] = new Array<number>(8) /*int*/;\r\n\r\n\t\tt[parameterIndex] = registerIndex;\r\n\t}\r\n\r\n\tpublic getRegisterIndex(node:AnimationNodeBase, parameterIndex:number /*int*/):number /*int*/\r\n\t{\r\n\t\treturn (<Array<number>> this.indexDictionary[node.id])[parameterIndex];\r\n\t}\r\n\r\n\tpublic getInitCode():string\r\n\t{\r\n\t\tvar len:number /*int*/ = this.sourceRegisters.length;\r\n\t\tvar code:string = \"\";\r\n\t\tfor (var i:number /*int*/ = 0; i < len; i++)\r\n\t\t\tcode += \"mov \" + this.targetRegisters[i] + \",\" + this.sourceRegisters[i] + \"\\n\";\r\n\r\n\t\tcode += \"mov \" + this.positionTarget + \".xyz,\" + this.vertexZeroConst.toString() + \"\\n\";\r\n\r\n\t\tif (this.needVelocity)\r\n\t\t\tcode += \"mov \" + this.velocityTarget + \".xyz,\" + this.vertexZeroConst.toString() + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic getCombinationCode():string\r\n\t{\r\n\t\treturn \"add \" + this.scaleAndRotateTarget + \".xyz,\" + this.scaleAndRotateTarget + \".xyz,\" + this.positionTarget + \".xyz\\n\";\r\n\t}\r\n\r\n\tpublic initColorRegisters():string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.hasColorMulNode) {\r\n\t\t\tthis.colorMulTarget = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(this.colorMulTarget, 1);\r\n\t\t\tthis.colorMulVary = this.getFreeVarying();\r\n\t\t\tcode += \"mov \" + this.colorMulTarget + \",\" + this.vertexOneConst + \"\\n\";\r\n\t\t}\r\n\t\tif (this.hasColorAddNode) {\r\n\t\t\tthis.colorAddTarget = this.getFreeVertexVectorTemp();\r\n\t\t\tthis.addVertexTempUsages(this.colorAddTarget, 1);\r\n\t\t\tthis.colorAddVary = this.getFreeVarying();\r\n\t\t\tcode += \"mov \" + this.colorAddTarget + \",\" + this.vertexZeroConst + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic getColorPassCode():string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.needFragmentAnimation && (this.hasColorAddNode || this.hasColorMulNode)) {\r\n\t\t\tif (this.hasColorMulNode)\r\n\t\t\t\tcode += \"mov \" + this.colorMulVary + \",\" + this.colorMulTarget + \"\\n\";\r\n\t\t\tif (this.hasColorAddNode)\r\n\t\t\t\tcode += \"mov \" + this.colorAddVary + \",\" + this.colorAddTarget + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic getColorCombinationCode(shadedTarget:string):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (this.needFragmentAnimation && (this.hasColorAddNode || this.hasColorMulNode)) {\r\n\t\t\tvar colorTarget:ShaderRegisterElement = this.getRegisterFromString(shadedTarget);\r\n\t\t\tthis.addFragmentTempUsages(colorTarget, 1);\r\n\t\t\tif (this.hasColorMulNode)\r\n\t\t\t\tcode += \"mul \" + colorTarget + \",\" + colorTarget + \",\" + this.colorMulVary + \"\\n\";\r\n\t\t\tif (this.hasColorAddNode)\r\n\t\t\t\tcode += \"add \" + colorTarget + \",\" + colorTarget + \",\" + this.colorAddVary + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\tprivate getRegisterFromString(code:string):ShaderRegisterElement\r\n\t{\r\n\t\tvar temp:Array<string> = code.split(/(\\d+)/);\r\n\t\treturn new ShaderRegisterElement(temp[0], parseInt(temp[1]));\r\n\t}\r\n\r\n\tpublic vertexConstantData:Array<number> = new Array<number>();\r\n\tpublic fragmentConstantData:Array<number> = new Array<number>();\r\n\r\n\tprivate _numVertexConstant:number /*int*/;\r\n\tprivate _numFragmentConstant:number /*int*/;\r\n\r\n\tpublic get numVertexConstant():number /*int*/\r\n\t{\r\n\t\treturn this._numVertexConstant;\r\n\t}\r\n\r\n\tpublic get numFragmentConstant():number /*int*/\r\n\t{\r\n\t\treturn this._numFragmentConstant;\r\n\t}\r\n\r\n\tpublic setDataLength()\r\n\t{\r\n\t\tthis._numVertexConstant = this.numUsedVertexConstants - this.vertexConstantOffset;\r\n\t\tthis._numFragmentConstant = this.numUsedFragmentConstants - this.fragmentConstantOffset;\r\n\t\tthis.vertexConstantData.length = this._numVertexConstant*4;\r\n\t\tthis.fragmentConstantData.length = this._numFragmentConstant*4;\r\n\t}\r\n\r\n\tpublic setVertexConst(index:number /*int*/, x:number = 0, y:number = 0, z:number = 0, w:number = 0)\r\n\t{\r\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\r\n\t\tthis.vertexConstantData[_index++] = x;\r\n\t\tthis.vertexConstantData[_index++] = y;\r\n\t\tthis.vertexConstantData[_index++] = z;\r\n\t\tthis.vertexConstantData[_index] = w;\r\n\t}\r\n\r\n\tpublic setVertexConstFromArray(index:number /*int*/, data:Array<number>)\r\n\t{\r\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\r\n\t\tfor (var i:number /*int*/ = 0; i < data.length; i++)\r\n\t\t\tthis.vertexConstantData[_index++] = data[i];\r\n\t}\r\n\r\n\tpublic setVertexConstFromMatrix(index:number /*int*/, matrix:Matrix3D)\r\n\t{\r\n\t\tvar rawData:Array<number> = matrix.rawData;\r\n\t\tvar _index:number /*int*/ = (index - this.vertexConstantOffset)*4;\r\n\t\tthis.vertexConstantData[_index++] = rawData[0];\r\n\t\tthis.vertexConstantData[_index++] = rawData[4];\r\n\t\tthis.vertexConstantData[_index++] = rawData[8];\r\n\t\tthis.vertexConstantData[_index++] = rawData[12];\r\n\t\tthis.vertexConstantData[_index++] = rawData[1];\r\n\t\tthis.vertexConstantData[_index++] = rawData[5];\r\n\t\tthis.vertexConstantData[_index++] = rawData[9];\r\n\t\tthis.vertexConstantData[_index++] = rawData[13];\r\n\t\tthis.vertexConstantData[_index++] = rawData[2];\r\n\t\tthis.vertexConstantData[_index++] = rawData[6];\r\n\t\tthis.vertexConstantData[_index++] = rawData[10];\r\n\t\tthis.vertexConstantData[_index++] = rawData[14];\r\n\t\tthis.vertexConstantData[_index++] = rawData[3];\r\n\t\tthis.vertexConstantData[_index++] = rawData[7];\r\n\t\tthis.vertexConstantData[_index++] = rawData[11];\r\n\t\tthis.vertexConstantData[_index] = rawData[15];\r\n\r\n\t}\r\n\r\n\tpublic setFragmentConst(index:number /*int*/, x:number = 0, y:number = 0, z:number = 0, w:number = 0)\r\n\t{\r\n\t\tvar _index:number /*int*/ = (index - this.fragmentConstantOffset)*4;\r\n\t\tthis.fragmentConstantData[_index++] = x;\r\n\t\tthis.fragmentConstantData[_index++] = y;\r\n\t\tthis.fragmentConstantData[_index++] = z;\r\n\t\tthis.fragmentConstantData[_index] = w;\r\n\t}\r\n}\r\n\r\nexport = AnimationRegisterCache;",
    "import Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IVertexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\r\n\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass AnimationSubGeometry\r\n{\r\n\tpublic static SUBGEOM_ID_COUNT:number = 0;\r\n\r\n\tpublic _pVertexData:Array<number>;\r\n\r\n\tpublic _pVertexBuffer:Array<IVertexBuffer> = new Array<IVertexBuffer>(8);\r\n\tpublic _pBufferContext:Array<IContextGL> = new Array<IContextGL>(8);\r\n\tpublic _pBufferDirty:Array<boolean> = new Array<boolean>(8);\r\n\r\n\tprivate _numVertices:number /*uint*/;\r\n\r\n\tprivate _totalLenOfOneVertex:number /*uint*/;\r\n\r\n\tpublic numProcessedVertices:number /*int*/ = 0;\r\n\r\n\tpublic previousTime:number = Number.NEGATIVE_INFINITY;\r\n\r\n\tpublic animationParticles:Array<ParticleAnimationData> = new Array<ParticleAnimationData>();\r\n\r\n\t/**\r\n\t * An id for this animation subgeometry, used to identify animation subgeometries when using animation sets.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iUniqueId:number;//Arcane\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tfor (var i:number /*int*/ = 0; i < 8; i++)\r\n\t\t\tthis._pBufferDirty[i] = true;\r\n\r\n\t\tthis._iUniqueId = AnimationSubGeometry.SUBGEOM_ID_COUNT++;\r\n\t}\r\n\r\n\tpublic createVertexData(numVertices:number /*uint*/, totalLenOfOneVertex:number /*uint*/)\r\n\t{\r\n\t\tthis._numVertices = numVertices;\r\n\t\tthis._totalLenOfOneVertex = totalLenOfOneVertex;\r\n\t\tthis._pVertexData = new Array<number>(numVertices*totalLenOfOneVertex);\r\n\t}\r\n\r\n\tpublic activateVertexBuffer(index:number /*int*/, bufferOffset:number /*int*/, stage:Stage, format:string)\r\n\t{\r\n\t\tvar contextIndex:number /*int*/ = stage.stageIndex;\r\n\t\tvar context:IContextGL = <IContextGL> stage.context;\r\n\r\n\t\tvar buffer:IVertexBuffer = this._pVertexBuffer[contextIndex];\r\n\t\tif (!buffer || this._pBufferContext[contextIndex] != context) {\r\n\t\t\tbuffer = this._pVertexBuffer[contextIndex] = context.createVertexBuffer(this._numVertices, this._totalLenOfOneVertex);\r\n\t\t\tthis._pBufferContext[contextIndex] = context;\r\n\t\t\tthis._pBufferDirty[contextIndex] = true;\r\n\t\t}\r\n\t\tif (this._pBufferDirty[contextIndex]) {\r\n\t\t\tbuffer.uploadFromArray(this._pVertexData, 0, this._numVertices);\r\n\t\t\tthis._pBufferDirty[contextIndex] = false;\r\n\t\t}\r\n\t\tcontext.setVertexBufferAt(index, buffer, bufferOffset, format);\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\twhile (this._pVertexBuffer.length) {\r\n\t\t\tvar vertexBuffer:IVertexBuffer = this._pVertexBuffer.pop()\r\n\r\n\t\t\tif (vertexBuffer)\r\n\t\t\t\tvertexBuffer.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic invalidateBuffer()\r\n\t{\r\n\t\tfor (var i:number /*int*/ = 0; i < 8; i++)\r\n\t\t\tthis._pBufferDirty[i] = true;\r\n\t}\r\n\r\n\tpublic get vertexData():Array<number>\r\n\t{\r\n\t\treturn this._pVertexData;\r\n\t}\r\n\r\n\tpublic get numVertices():number /*uint*/\r\n\t{\r\n\t\treturn this._numVertices;\r\n\t}\r\n\r\n\tpublic get totalLenOfOneVertex():number /*uint*/\r\n\t{\r\n\t\treturn this._totalLenOfOneVertex;\r\n\t}\r\n}\r\n\r\nexport = AnimationSubGeometry;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\n\r\nclass ColorSegmentPoint\r\n{\r\n\tprivate _color:ColorTransform;\r\n\tprivate _life:number;\r\n\r\n\tconstructor(life:number, color:ColorTransform)\r\n\t{\r\n\t\t//0<life<1\r\n\t\tif (life <= 0 || life >= 1)\r\n\t\t\tthrow(new Error(\"life exceeds range (0,1)\"));\r\n\t\tthis._life = life;\r\n\t\tthis._color = color;\r\n\t}\r\n\r\n\tpublic get color():ColorTransform\r\n\t{\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tpublic get life():number\r\n\t{\r\n\t\treturn this._life;\r\n\t}\r\n\r\n}\r\n\r\nexport = ColorSegmentPoint;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\n/**\r\n * Contains transformation data for a skeleton joint, used for skeleton animation.\r\n *\r\n * @see away.animation.Skeleton\r\n * @see away.animation.SkeletonJoint\r\n *\r\n * todo: support (uniform) scale\r\n */\r\nclass JointPose\r\n{\r\n\t/**\r\n\t * The name of the joint to which the pose is associated\r\n\t */\r\n\tpublic name:string; // intention is that this should be used only at load time, not in the main loop\r\n\r\n\t/**\r\n\t * The rotation of the pose stored as a quaternion\r\n\t */\r\n\tpublic orientation:Quaternion = new Quaternion();\r\n\r\n\t/**\r\n\t * The translation of the pose\r\n\t */\r\n\tpublic translation:Vector3D = new Vector3D();\r\n\r\n\tconstructor()\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the transformation to a Matrix3D representation.\r\n\t *\r\n\t * @param target An optional target matrix to store the transformation. If not provided, it will create a new instance.\r\n\t * @return The transformation matrix of the pose.\r\n\t */\r\n\tpublic toMatrix3D(target:Matrix3D = null):Matrix3D\r\n\t{\r\n\t\tif (target == null)\r\n\t\t\ttarget = new Matrix3D();\r\n\r\n\t\tthis.orientation.toMatrix3D(target);\r\n\t\ttarget.appendTranslation(this.translation.x, this.translation.y, this.translation.z);\r\n\t\treturn target;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies the transformation data from a source pose object into the existing pose object.\r\n\t *\r\n\t * @param pose The source pose to copy from.\r\n\t */\r\n\tpublic copyFrom(pose:JointPose)\r\n\t{\r\n\t\tvar or:Quaternion = pose.orientation;\r\n\t\tvar tr:Vector3D = pose.translation;\r\n\t\tthis.orientation.x = or.x;\r\n\t\tthis.orientation.y = or.y;\r\n\t\tthis.orientation.z = or.z;\r\n\t\tthis.orientation.w = or.w;\r\n\t\tthis.translation.x = tr.x;\r\n\t\tthis.translation.y = tr.y;\r\n\t\tthis.translation.z = tr.z;\r\n\t}\r\n}\r\n\r\nexport = JointPose;",
    "import ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleAnimationData\r\n{\r\n\tpublic index:number /*uint*/;\r\n\tpublic startTime:number;\r\n\tpublic totalTime:number;\r\n\tpublic duration:number;\r\n\tpublic delay:number;\r\n\tpublic startVertexIndex:number /*uint*/;\r\n\tpublic numVertices:number /*uint*/;\r\n\r\n\tconstructor(index:number /*uint*/, startTime:number, duration:number, delay:number, particle:ParticleData)\r\n\t{\r\n\t\tthis.index = index;\r\n\t\tthis.startTime = startTime;\r\n\t\tthis.totalTime = duration + delay;\r\n\t\tthis.duration = duration;\r\n\t\tthis.delay = delay;\r\n\t\tthis.startVertexIndex = particle.startVertexIndex;\r\n\t\tthis.numVertices = particle.numVertices;\r\n\t}\r\n}\r\n\r\nexport = ParticleAnimationData;",
    "import TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\n\r\nclass ParticleData\r\n{\r\n\tpublic particleIndex:number /*uint*/;\r\n\tpublic numVertices:number /*uint*/;\r\n\tpublic startVertexIndex:number /*uint*/;\r\n\tpublic subGeometry:TriangleSubGeometry;\r\n}\r\n\r\nexport = ParticleData",
    "/**\r\n * Options for setting the properties mode of a particle animation node.\r\n */\r\nclass ParticlePropertiesMode\r\n{\r\n\t/**\r\n\t * Mode that defines the particle node as acting on global properties (ie. the properties set in the node constructor or the corresponding animation state).\r\n\t */\r\n\tpublic static GLOBAL:number /*uint*/ = 0;\r\n\r\n\t/**\r\n\t * Mode that defines the particle node as acting on local static properties (ie. the properties of particles set in the initialising on the animation set).\r\n\t */\r\n\tpublic static LOCAL_STATIC:number /*uint*/ = 1;\r\n\r\n\t/**\r\n\t * Mode that defines the particle node as acting on local dynamic properties (ie. the properties of the particles set in the corresponding animation state).\r\n\t */\r\n\tpublic static LOCAL_DYNAMIC:number /*uint*/ = 2;\r\n}\r\n\r\nexport = ParticlePropertiesMode;",
    "/**\r\n * Dynamic class for holding the local properties of a particle, used for processing the static properties\r\n * of particles in the particle animation set before beginning upload to the GPU.\r\n */\r\nclass ParticleProperties\r\n{\r\n\t/**\r\n\t * The index of the current particle being set.\r\n\t */\r\n\tpublic index:number /*uint*/;\r\n\r\n\t/**\r\n\t * The total number of particles being processed by the particle animation set.\r\n\t */\r\n\tpublic total:number /*uint*/;\r\n\r\n\t/**\r\n\t * The start time of the particle.\r\n\t */\r\n\tpublic startTime:number;\r\n\r\n\t/**\r\n\t * The duration of the particle, an optional value used when the particle aniamtion set settings for <code>useDuration</code> are enabled in the constructor.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t */\r\n\tpublic duration:number;\r\n\r\n\t/**\r\n\t * The delay between cycles of the particle, an optional value used when the particle aniamtion set settings for <code>useLooping</code> and  <code>useDelay</code> are enabled in the constructor.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t */\r\n\tpublic delay:number;\r\n}\r\n\r\nexport = ParticleProperties;",
    "/**\r\n * A value obect representing a single joint in a skeleton object.\r\n *\r\n * @see away.animators.Skeleton\r\n */\r\nclass SkeletonJoint\r\n{\r\n\t/**\r\n\t * The index of the parent joint in the skeleton's joints vector.\r\n\t *\r\n\t * @see away.animators.Skeleton#joints\r\n\t */\r\n\tpublic parentIndex:number /*int*/ = -1;\r\n\r\n\t/**\r\n\t * The name of the joint\r\n\t */\r\n\tpublic name:string; // intention is that this should be used only at load time, not in the main loop\r\n\r\n\t/**\r\n\t * The inverse bind pose matrix, as raw data, used to transform vertices to bind joint space in preparation for transformation using the joint matrix.\r\n\t */\r\n\tpublic inverseBindPose:Array<number>;\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonJoint</code> object\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t}\r\n}\r\n\r\nexport = SkeletonJoint;",
    "import AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport NamedAssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\r\n\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\n\r\n\r\n/**\r\n * A collection of pose objects, determining the pose for an entire skeleton.\r\n * The <code>jointPoses</code> vector object corresponds to a skeleton's <code>joints</code> vector object, however, there is no\r\n * reference to a skeleton's instance, since several skeletons can be influenced by the same pose (eg: animation\r\n * clips are added to any animator with a valid skeleton)\r\n *\r\n * @see away.animators.Skeleton\r\n * @see away.animators.JointPose\r\n */\r\nclass SkeletonPose extends NamedAssetBase implements IAsset\r\n{\r\n\t/**\r\n\t * A flat list of pose objects that comprise the skeleton pose. The pose indices correspond to the target skeleton's joint indices.\r\n\t *\r\n\t * @see away.animators.Skeleton#joints\r\n\t */\r\n\tpublic jointPoses:Array<JointPose>;\r\n\r\n\t/**\r\n\t * The total number of joint poses in the skeleton pose.\r\n\t */\r\n\tpublic get numJointPoses():number /*uint*/\r\n\t{\r\n\t\treturn this.jointPoses.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonPose</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis.jointPoses = new Array<JointPose>();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn AssetType.SKELETON_POSE;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the joint pose object with the given joint name, otherwise returns a null object.\r\n\t *\r\n\t * @param jointName The name of the joint object whose pose is to be found.\r\n\t * @return The pose object with the given joint name.\r\n\t */\r\n\tpublic jointPoseFromName(jointName:string):JointPose\r\n\t{\r\n\t\tvar jointPoseIndex:number /*int*/ = this.jointPoseIndexFromName(jointName);\r\n\t\tif (jointPoseIndex != -1)\r\n\t\t\treturn this.jointPoses[jointPoseIndex]; else\r\n\t\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the pose index, given the joint name. -1 is returned if the joint name is not found in the pose.\r\n\t *\r\n\t * @param The name of the joint object whose pose is to be found.\r\n\t * @return The index of the pose object in the jointPoses Array\r\n\t *\r\n\t * @see #jointPoses\r\n\t */\r\n\tpublic jointPoseIndexFromName(jointName:string):number /*int*/\r\n\t{\r\n\t\t// this is implemented as a linear search, rather than a possibly\r\n\t\t// more optimal method (Dictionary lookup, for example) because:\r\n\t\t// a) it is assumed that it will be called once for each joint\r\n\t\t// b) it is assumed that it will be called only during load, and not during main loop\r\n\t\t// c) maintaining a dictionary (for safety) would dictate an interface to access JointPoses,\r\n\t\t//    rather than direct array access.  this would be sub-optimal.\r\n\t\tvar jointPoseIndex:number /*int*/;\r\n\t\tvar jointPose:JointPose;\r\n\t\tfor (var i:number /*uint*/; i < this.jointPoses.length; i++) {\r\n\t\t\tjointPose = this.jointPoses[i];\r\n\t\t\tif (jointPose.name == jointName)\r\n\t\t\t\treturn jointPoseIndex;\r\n\t\t\tjointPoseIndex++;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a copy of the <code>SkeletonPose</code> object, with a dulpicate of its component joint poses.\r\n\t *\r\n\t * @return SkeletonPose\r\n\t */\r\n\tpublic clone():SkeletonPose\r\n\t{\r\n\t\tvar clone:SkeletonPose = new SkeletonPose();\r\n\t\tvar numJointPoses:number /*uint*/ = this.jointPoses.length;\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJointPoses; i++) {\r\n\t\t\tvar cloneJointPose:JointPose = new JointPose();\r\n\t\t\tvar thisJointPose:JointPose = this.jointPoses[i];\r\n\t\t\tcloneJointPose.name = thisJointPose.name;\r\n\t\t\tcloneJointPose.copyFrom(thisJointPose);\r\n\t\t\tclone.jointPoses[i] = cloneJointPose;\r\n\t\t}\r\n\t\treturn clone;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis.jointPoses.length = 0;\r\n\t}\r\n}\r\n\r\nexport = SkeletonPose;",
    "import SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\n\r\nimport AssetType\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport NamedAssetBase\t\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\r\n\r\n/**\r\n * A Skeleton object is a hierarchical grouping of joint objects that can be used for skeletal animation.\r\n *\r\n * @see away.animators.SkeletonJoint\r\n */\r\nclass Skeleton extends NamedAssetBase implements IAsset\r\n{\r\n\t/**\r\n\t * A flat list of joint objects that comprise the skeleton. Every joint except for the root has a parentIndex\r\n\t * property that is an index into this list.\r\n\t * A child joint should always have a higher index than its parent.\r\n\t */\r\n\tpublic joints:Array<SkeletonJoint>;\r\n\r\n\t/**\r\n\t * The total number of joints in the skeleton.\r\n\t */\r\n\tpublic get numJoints():number /*uint*/\r\n\t{\r\n\t\treturn this.joints.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>Skeleton</code> object\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\t// in the long run, it might be a better idea to not store Joint objects, but keep all data in Vectors, that we can upload easily?\r\n\t\tthis.joints = new Array<SkeletonJoint>();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the joint object in the skeleton with the given name, otherwise returns a null object.\r\n\t *\r\n\t * @param jointName The name of the joint object to be found.\r\n\t * @return The joint object with the given name.\r\n\t *\r\n\t * @see #joints\r\n\t */\r\n\tpublic jointFromName(jointName:string):SkeletonJoint\r\n\t{\r\n\t\tvar jointIndex:number /*int*/ = this.jointIndexFromName(jointName);\r\n\t\tif (jointIndex != -1)\r\n\t\t\treturn this.joints[jointIndex]; else\r\n\t\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the joint index, given the joint name. -1 is returned if the joint name is not found.\r\n\t *\r\n\t * @param jointName The name of the joint object to be found.\r\n\t * @return The index of the joint object in the joints Array\r\n\t *\r\n\t * @see #joints\r\n\t */\r\n\tpublic jointIndexFromName(jointName:string):number /*int*/\r\n\t{\r\n\t\t// this is implemented as a linear search, rather than a possibly\r\n\t\t// more optimal method (Dictionary lookup, for example) because:\r\n\t\t// a) it is assumed that it will be called once for each joint\r\n\t\t// b) it is assumed that it will be called only during load, and not during main loop\r\n\t\t// c) maintaining a dictionary (for safety) would dictate an interface to access SkeletonJoints,\r\n\t\t//    rather than direct array access.  this would be sub-optimal.\r\n\t\tvar jointIndex:number /*int*/;\r\n\t\tvar joint:SkeletonJoint;\r\n\t\tfor (var i:number /*int*/; i < this.joints.length; i++) {\r\n\t\t\tjoint = this.joints[i];\r\n\t\t\tif (joint.name == jointName)\r\n\t\t\t\treturn jointIndex;\r\n\t\t\tjointIndex++;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis.joints.length = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get assetType():string\r\n\t{\r\n\t\treturn AssetType.SKELETON;\r\n\t}\r\n}\r\n\r\nexport = Skeleton;",
    "/**\r\n * Options for setting the animation mode of a vertex animator object.\r\n *\r\n * @see away.animators.VertexAnimator\r\n */\r\nclass VertexAnimationMode\r\n{\r\n\t/**\r\n\t * Animation mode that adds all outputs from active vertex animation state to form the current vertex animation pose.\r\n\t */\r\n\tpublic static ADDITIVE:string = \"additive\";\r\n\r\n\t/**\r\n\t * Animation mode that picks the output from a single vertex animation state to form the current vertex animation pose.\r\n\t */\r\n\tpublic static ABSOLUTE:string = \"absolute\";\r\n}\r\n\r\nexport = VertexAnimationMode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\n/**\r\n * Provides an abstract base class for nodes with time-based animation data in an animation blend tree.\r\n */\r\nclass AnimationClipNodeBase extends AnimationNodeBase\r\n{\r\n\tpublic _pLooping:boolean = true;\r\n\tpublic _pTotalDuration:number /*uint*/ = 0;\r\n\tpublic _pLastFrame:number /*uint*/;\r\n\r\n\tpublic _pStitchDirty:boolean = true;\r\n\tpublic _pStitchFinalFrame:boolean = false;\r\n\tpublic _pNumFrames:number /*uint*/ = 0;\r\n\r\n\tpublic _pDurations:Array<number> = new Array<number>();\r\n\t/*uint*/\r\n\tpublic _pTotalDelta:Vector3D = new Vector3D();\r\n\r\n\tpublic fixedFrameRate:boolean = true;\r\n\r\n\t/**\r\n\t * Determines whether the contents of the animation node have looping characteristics enabled.\r\n\t */\r\n\tpublic get looping():boolean\r\n\t{\r\n\t\treturn this._pLooping;\r\n\t}\r\n\r\n\tpublic set looping(value:boolean)\r\n\t{\r\n\t\tif (this._pLooping == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pLooping = value;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines if looping content blends the final frame of animation data with the first (true) or works on the\r\n\t * assumption that both first and last frames are identical (false). Defaults to false.\r\n\t */\r\n\tpublic get stitchFinalFrame():boolean\r\n\t{\r\n\t\treturn this._pStitchFinalFrame;\r\n\t}\r\n\r\n\tpublic set stitchFinalFrame(value:boolean)\r\n\t{\r\n\t\tif (this._pStitchFinalFrame == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pStitchFinalFrame = value;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\tpublic get totalDuration():number /*uint*/\r\n\t{\r\n\t\tif (this._pStitchDirty)\r\n\t\t\tthis._pUpdateStitch();\r\n\r\n\t\treturn this._pTotalDuration;\r\n\t}\r\n\r\n\tpublic get totalDelta():Vector3D\r\n\t{\r\n\t\tif (this._pStitchDirty)\r\n\t\t\tthis._pUpdateStitch();\r\n\r\n\t\treturn this._pTotalDelta;\r\n\t}\r\n\r\n\tpublic get lastFrame():number /*uint*/\r\n\t{\r\n\t\tif (this._pStitchDirty)\r\n\t\t\tthis._pUpdateStitch();\r\n\r\n\t\treturn this._pLastFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a vector of time values representing the duration (in milliseconds) of each animation frame in the clip.\r\n\t */\r\n\tpublic get durations():Array<number> /*uint*/\r\n\t{\r\n\t\treturn this._pDurations;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>AnimationClipNodeBase</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the node's final frame stitch state.\r\n\t *\r\n\t * @see #stitchFinalFrame\r\n\t */\r\n\tpublic _pUpdateStitch()\r\n\t{\r\n\t\tthis._pStitchDirty = false;\r\n\r\n\t\tthis._pLastFrame = (this._pStitchFinalFrame)? this._pNumFrames : this._pNumFrames - 1;\r\n\r\n\t\tthis._pTotalDuration = 0;\r\n\t\tthis._pTotalDelta.x = 0;\r\n\t\tthis._pTotalDelta.y = 0;\r\n\t\tthis._pTotalDelta.z = 0;\r\n\t}\r\n}\r\n\r\nexport = AnimationClipNodeBase;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleAccelerationState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleAccelerationState\");\r\n\r\n/**\r\n * A particle animation node used to apply a constant acceleration vector to the motion of a particle.\r\n */\r\nclass ParticleAccelerationNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _acceleration:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for acceleration node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the direction of acceleration on the particle.\r\n\t */\r\n\tpublic static ACCELERATION_VECTOR3D:string = \"AccelerationVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleAccelerationNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] acceleration    Defines the default acceleration vector of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, acceleration:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleAcceleration\", mode, 3);\r\n\r\n\t\tthis._pStateClass = ParticleAccelerationState;\r\n\r\n\t\tthis._acceleration = acceleration || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic pGetAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar accelerationValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleAccelerationState.ACCELERATION_INDEX, accelerationValue.index);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\r\n\t\tvar code:string = \"mul \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + accelerationValue + \"\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"mul \" + temp2 + \",\" + temp + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + temp2 + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t}\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tcode += \"mul \" + temp + \",\" + temp + \",\" + animationRegisterCache.vertexTime + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + temp + \",\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleAccelerationState\r\n\t{\r\n\t\treturn <ParticleAccelerationState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar tempAcceleration:Vector3D = param[ParticleAccelerationNode.ACCELERATION_VECTOR3D];\r\n\t\tif (!tempAcceleration)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleAccelerationNode.ACCELERATION_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = tempAcceleration.x/2;\r\n\t\tthis._pOneData[1] = tempAcceleration.y/2;\r\n\t\tthis._pOneData[2] = tempAcceleration.z/2;\r\n\t}\r\n}\r\n\r\nexport = ParticleAccelerationNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleBezierCurveState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState\");\r\n\r\n/**\r\n * A particle animation node used to control the position of a particle over time along a bezier curve.\r\n */\r\nclass ParticleBezierCurveNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iControlPoint:Vector3D;\r\n\t/** @private */\r\n\tpublic _iEndPoint:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for bezier curve node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the control point position (0, 1, 2) of the curve.\r\n\t */\r\n\tpublic static BEZIER_CONTROL_VECTOR3D:string = \"BezierControlVector3D\";\r\n\r\n\t/**\r\n\t * Reference for bezier curve node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the end point position (0, 1, 2) of the curve.\r\n\t */\r\n\tpublic static BEZIER_END_VECTOR3D:string = \"BezierEndVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleBezierCurveNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] controlPoint    Defines the default control point of the node, used when in global mode.\r\n\t * @param    [optional] endPoint        Defines the default end point of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, controlPoint:Vector3D = null, endPoint:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleBezierCurve\", mode, 6);\r\n\r\n\t\tthis._pStateClass = ParticleBezierCurveState;\r\n\r\n\t\tthis._iControlPoint = controlPoint || new Vector3D();\r\n\t\tthis._iEndPoint = endPoint || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar controlValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBezierCurveState.BEZIER_CONTROL_INDEX, controlValue.index);\r\n\r\n\t\tvar endValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBezierCurveState.BEZIER_END_INDEX, endValue.index);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar rev_time:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\tvar time_2:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\tvar time_temp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"sub \" + rev_time + \",\" + animationRegisterCache.vertexOneConst + \",\" + animationRegisterCache.vertexLife + \"\\n\";\r\n\t\tcode += \"mul \" + time_2 + \",\" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexLife + \"\\n\";\r\n\r\n\t\tcode += \"mul \" + time_temp + \",\" + animationRegisterCache.vertexLife + \",\" + rev_time + \"\\n\";\r\n\t\tcode += \"mul \" + time_temp + \",\" + time_temp + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\tcode += \"mul \" + distance + \".xyz,\" + time_temp + \",\" + controlValue + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\tcode += \"mul \" + distance + \".xyz,\" + time_2 + \",\" + endValue + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tcode += \"mul \" + time_2 + \",\" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"sub \" + time_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + time_2 + \"\\n\";\r\n\t\t\tcode += \"mul \" + time_temp + \",\" + animationRegisterCache.vertexTwoConst + \",\" + time_temp + \"\\n\";\r\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + controlValue + \",\" + time_temp + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + endValue + \",\" + time_2 + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleBezierCurveState\r\n\t{\r\n\t\treturn <ParticleBezierCurveState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar bezierControl:Vector3D = param[ParticleBezierCurveNode.BEZIER_CONTROL_VECTOR3D];\r\n\t\tif (!bezierControl)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleBezierCurveNode.BEZIER_CONTROL_VECTOR3D + \" in param!\");\r\n\r\n\t\tvar bezierEnd:Vector3D = param[ParticleBezierCurveNode.BEZIER_END_VECTOR3D];\r\n\t\tif (!bezierEnd)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleBezierCurveNode.BEZIER_END_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = bezierControl.x;\r\n\t\tthis._pOneData[1] = bezierControl.y;\r\n\t\tthis._pOneData[2] = bezierControl.z;\r\n\t\tthis._pOneData[3] = bezierEnd.x;\r\n\t\tthis._pOneData[4] = bezierEnd.y;\r\n\t\tthis._pOneData[5] = bezierEnd.z;\r\n\t}\r\n}\r\n\r\nexport = ParticleBezierCurveNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleBillboardState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleBillboardState\");\r\n\r\n/**\r\n * A particle animation node that controls the rotation of a particle to always face the camera.\r\n */\r\nclass ParticleBillboardNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iBillboardAxis:Vector3D;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleBillboardNode</code>\r\n\t */\r\n\tconstructor(billboardAxis:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleBillboard\", ParticlePropertiesMode.GLOBAL, 0, 4);\r\n\r\n\t\tthis._pStateClass = ParticleBillboardState;\r\n\r\n\t\tthis._iBillboardAxis = billboardAxis;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleBillboardState.MATRIX_INDEX, rotationMatrixRegister.index);\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\tvar code:string = \"m33 \" + temp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \",\" + rotationMatrixRegister + \"\\n\" +\r\n\t\t\t\t\t\t  \"mov \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\r\n\r\n\t\tvar shaderRegisterElement:ShaderRegisterElement;\r\n\t\tfor (var i:number /*uint*/ = 0; i < animationRegisterCache.rotationRegisters.length; i++) {\r\n\t\t\tshaderRegisterElement = animationRegisterCache.rotationRegisters[i];\r\n\t\t\tcode += \"m33 \" + temp + \".xyz,\" + shaderRegisterElement + \",\" + rotationMatrixRegister + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + shaderRegisterElement + \".xyz,\" + shaderRegisterElement + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleBillboardState\r\n\t{\r\n\t\treturn <ParticleBillboardState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.hasBillboard = true;\r\n\t}\r\n}\r\n\r\nexport = ParticleBillboardNode;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleColorState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleColorState\");\r\n\r\n/**\r\n * A particle animation node used to control the color variation of a particle over time.\r\n */\r\nclass ParticleColorNode extends ParticleNodeBase\r\n{\r\n\t//default values used when creating states\r\n\t/** @private */\r\n\tpublic _iUsesMultiplier:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesOffset:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\t/** @private */\r\n\tpublic _iStartColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iEndColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\r\n\t/**\r\n\t * Reference for color node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>ColorTransform</code> object representing the start color transform applied to the particle.\r\n\t */\r\n\tpublic static COLOR_START_COLORTRANSFORM:string = \"ColorStartColorTransform\";\r\n\r\n\t/**\r\n\t * Reference for color node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>ColorTransform</code> object representing the end color transform applied to the particle.\r\n\t */\r\n\tpublic static COLOR_END_COLORTRANSFORM:string = \"ColorEndColorTransform\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleColorNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] usesMultiplier  Defines whether the node uses multiplier data in the shader for its color transformations. Defaults to true.\r\n\t * @param    [optional] usesOffset      Defines whether the node uses offset data in the shader for its color transformations. Defaults to true.\r\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of the animation independent of particle duration. Defaults to false.\r\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the cycle rotation of the particle. Defaults to false.\r\n\t * @param    [optional] startColor      Defines the default start color transform of the node, when in global mode.\r\n\t * @param    [optional] endColor        Defines the default end color transform of the node, when in global mode.\r\n\t * @param    [optional] cycleDuration   Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesMultiplier:boolean = true, usesOffset:boolean = true, usesCycle:boolean = false, usesPhase:boolean = false, startColor:ColorTransform = null, endColor:ColorTransform = null, cycleDuration:number = 1, cyclePhase:number = 0)\r\n\t{\r\n\t\tsuper(\"ParticleColor\", mode, (usesMultiplier && usesOffset)? 16 : 8, ParticleAnimationSet.COLOR_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleColorState;\r\n\r\n\t\tthis._iUsesMultiplier = usesMultiplier;\r\n\t\tthis._iUsesOffset = usesOffset;\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iStartColor = startColor || new ColorTransform();\r\n\t\tthis._iEndColor = endColor || new ColorTransform();\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tif (this._iUsesCycle) {\r\n\t\t\t\tvar cycleConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.CYCLE_INDEX, cycleConst.index);\r\n\r\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\t\t\tvar sin:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\t\t\tcode += \"mul \" + sin + \",\" + animationRegisterCache.vertexTime + \",\" + cycleConst + \".x\\n\";\r\n\r\n\t\t\t\tif (this._iUsesPhase)\r\n\t\t\t\t\tcode += \"add \" + sin + \",\" + sin + \",\" + cycleConst + \".y\\n\";\r\n\r\n\t\t\t\tcode += \"sin \" + sin + \",\" + sin + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tvar startMultiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\t\tvar deltaMultiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.START_MULTIPLIER_INDEX, startMultiplierValue.index);\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.DELTA_MULTIPLIER_INDEX, deltaMultiplierValue.index);\r\n\r\n\t\t\t\tcode += \"mul \" + temp + \",\" + deltaMultiplierValue + \",\" + (this._iUsesCycle? sin : animationRegisterCache.vertexLife) + \"\\n\";\r\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + startMultiplierValue + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + temp + \",\" + animationRegisterCache.colorMulTarget + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tvar startOffsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tvar deltaOffsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.START_OFFSET_INDEX, startOffsetValue.index);\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleColorState.DELTA_OFFSET_INDEX, deltaOffsetValue.index);\r\n\r\n\t\t\t\tcode += \"mul \" + temp + \",\" + deltaOffsetValue + \",\" + (this._iUsesCycle? sin : animationRegisterCache.vertexLife) + \"\\n\";\r\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + startOffsetValue + \"\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + temp + \",\" + animationRegisterCache.colorAddTarget + \"\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleColorState\r\n\t{\r\n\t\treturn <ParticleColorState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tif (this._iUsesMultiplier)\r\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\r\n\t\tif (this._iUsesOffset)\r\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar startColor:ColorTransform = param[ParticleColorNode.COLOR_START_COLORTRANSFORM];\r\n\t\tif (!startColor)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleColorNode.COLOR_START_COLORTRANSFORM + \" in param!\"));\r\n\r\n\t\tvar endColor:ColorTransform = param[ParticleColorNode.COLOR_END_COLORTRANSFORM];\r\n\t\tif (!endColor)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleColorNode.COLOR_END_COLORTRANSFORM + \" in param!\"));\r\n\r\n\t\tvar i:number /*uint*/ = 0;\r\n\r\n\t\tif (!this._iUsesCycle) {\r\n\t\t\t//multiplier\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tthis._pOneData[i++] = startColor.redMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = startColor.greenMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = startColor.blueMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = startColor.alphaMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.redMultiplier - startColor.redMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.greenMultiplier - startColor.greenMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.blueMultiplier - startColor.blueMultiplier;\r\n\t\t\t\tthis._pOneData[i++] = endColor.alphaMultiplier - startColor.alphaMultiplier;\r\n\t\t\t}\r\n\r\n\t\t\t//offset\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tthis._pOneData[i++] = startColor.redOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = startColor.greenOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = startColor.blueOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = startColor.alphaOffset/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.redOffset - startColor.redOffset)/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.greenOffset - startColor.greenOffset)/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.blueOffset - startColor.blueOffset)/255;\r\n\t\t\t\tthis._pOneData[i++] = (endColor.alphaOffset - startColor.alphaOffset)/255;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//multiplier\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redMultiplier + endColor.redMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenMultiplier + endColor.greenMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueMultiplier + endColor.blueMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaMultiplier + endColor.alphaMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redMultiplier - endColor.redMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenMultiplier - endColor.greenMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueMultiplier - endColor.blueMultiplier)/2;\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaMultiplier - endColor.alphaMultiplier)/2;\r\n\t\t\t}\r\n\r\n\t\t\t//offset\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redOffset + endColor.redOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenOffset + endColor.greenOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueOffset + endColor.blueOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaOffset + endColor.alphaOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.redOffset - endColor.redOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.greenOffset - endColor.greenOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.blueOffset - endColor.blueOffset)/(255*2);\r\n\t\t\t\tthis._pOneData[i++] = (startColor.alphaOffset - endColor.alphaOffset)/(255*2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nexport = ParticleColorNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleFollowState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleFollowState\");\r\n\r\n/**\r\n * A particle animation node used to create a follow behaviour on a particle system.\r\n */\r\nclass ParticleFollowNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesPosition:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesRotation:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iSmooth:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleFollowNode</code>\r\n\t *\r\n\t * @param    [optional] usesPosition     Defines wehether the individual particle reacts to the position of the target.\r\n\t * @param    [optional] usesRotation     Defines wehether the individual particle reacts to the rotation of the target.\r\n\t * @param    [optional] smooth     Defines wehether the state calculate the interpolated value.\r\n\t */\r\n\tconstructor(usesPosition:boolean = true, usesRotation:boolean = true, smooth:boolean = false)\r\n\t{\r\n\t\tsuper(\"ParticleFollow\", ParticlePropertiesMode.LOCAL_DYNAMIC, (usesPosition && usesRotation)? 6 : 3, ParticleAnimationSet.POST_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleFollowState;\r\n\r\n\t\tthis._iUsesPosition = usesPosition;\r\n\t\tthis._iUsesRotation = usesRotation;\r\n\t\tthis._iSmooth = smooth;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\t//TODO: use Quaternion to implement this function\r\n\t\tvar code:string = \"\";\r\n\t\tif (this._iUsesRotation) {\r\n\t\t\tvar rotationAttribute:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleFollowState.FOLLOW_ROTATION_INDEX, rotationAttribute.index);\r\n\r\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\r\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tvar temp4:ShaderRegisterElement;\r\n\t\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(temp3, 1);\r\n\t\t\t\ttemp4 = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t}\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\r\n\t\t\tif (animationRegisterCache.hasBillboard)\r\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(temp3);\r\n\r\n\t\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\t\tvar i:number /*int*/;\r\n\r\n\t\t\t//x axis\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"sin \" + temp3 + \".y,\" + rotationAttribute + \".x\\n\";\r\n\t\t\tcode += \"cos \" + temp3 + \".z,\" + rotationAttribute + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".z\\n\";\r\n\t\t\tcode += \"neg \" + temp2 + \".z,\" + temp3 + \".y\\n\";\r\n\r\n\t\t\tif (animationRegisterCache.hasBillboard)\r\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\telse {\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\t//y axis\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"cos \" + temp1 + \".x,\" + rotationAttribute + \".y\\n\";\r\n\t\t\tcode += \"sin \" + temp1 + \".z,\" + rotationAttribute + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"neg \" + temp3 + \".x,\" + temp1 + \".z\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + temp1 + \".x\\n\";\r\n\r\n\t\t\tif (animationRegisterCache.hasBillboard)\r\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\telse {\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\t//z axis\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"sin \" + temp2 + \".x,\" + rotationAttribute + \".z\\n\";\r\n\t\t\tcode += \"cos \" + temp2 + \".y,\" + rotationAttribute + \".z\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp2 + \".y\\n\";\r\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp2 + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\r\n\t\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\t\tcode += \"m33 \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + temp4 + \".xyz,\" + temp4 + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp4 + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t\t} else {\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._iUsesPosition) {\r\n\t\t\tvar positionAttribute:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleFollowState.FOLLOW_POSITION_INDEX, positionAttribute.index);\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + positionAttribute + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleFollowState\r\n\t{\r\n\t\treturn <ParticleFollowState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = ParticleFollowNode;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleInitialColorState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleInitialColorState\");\r\n\r\n/**\r\n *\r\n */\r\nclass ParticleInitialColorNode extends ParticleNodeBase\r\n{\r\n\t//default values used when creating states\r\n\t/** @private */\r\n\tpublic _iUsesMultiplier:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesOffset:boolean;\r\n\t/** @private */\r\n\tpublic _iInitialColor:ColorTransform;\r\n\r\n\t/**\r\n\t * Reference for color node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>ColorTransform</code> object representing the color transform applied to the particle.\r\n\t */\r\n\tpublic static COLOR_INITIAL_COLORTRANSFORM:string = \"ColorInitialColorTransform\";\r\n\r\n\tconstructor(mode:number /*uint*/, usesMultiplier:boolean = true, usesOffset:boolean = false, initialColor:ColorTransform = null)\r\n\t{\r\n\t\tsuper(\"ParticleInitialColor\", mode, (usesMultiplier && usesOffset)? 8 : 4, ParticleAnimationSet.COLOR_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleInitialColorState;\r\n\r\n\t\tthis._iUsesMultiplier = usesMultiplier;\r\n\t\tthis._iUsesOffset = usesOffset;\r\n\t\tthis._iInitialColor = initialColor || new ColorTransform();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tvar multiplierValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.MULTIPLIER_INDEX, multiplierValue.index);\r\n\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + multiplierValue + \",\" + animationRegisterCache.colorMulTarget + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tvar offsetValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.LOCAL_STATIC)? animationRegisterCache.getFreeVertexAttribute() : animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleInitialColorState.OFFSET_INDEX, offsetValue.index);\r\n\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + offsetValue + \",\" + animationRegisterCache.colorAddTarget + \"\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tif (this._iUsesMultiplier)\r\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\r\n\t\tif (this._iUsesOffset)\r\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar initialColor:ColorTransform = param[ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM];\r\n\t\tif (!initialColor)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleInitialColorNode.COLOR_INITIAL_COLORTRANSFORM + \" in param!\"));\r\n\r\n\t\tvar i:number /*uint*/ = 0;\r\n\r\n\t\t//multiplier\r\n\t\tif (this._iUsesMultiplier) {\r\n\t\t\tthis._pOneData[i++] = initialColor.redMultiplier;\r\n\t\t\tthis._pOneData[i++] = initialColor.greenMultiplier;\r\n\t\t\tthis._pOneData[i++] = initialColor.blueMultiplier;\r\n\t\t\tthis._pOneData[i++] = initialColor.alphaMultiplier;\r\n\t\t}\r\n\t\t//offset\r\n\t\tif (this._iUsesOffset) {\r\n\t\t\tthis._pOneData[i++] = initialColor.redOffset/255;\r\n\t\t\tthis._pOneData[i++] = initialColor.greenOffset/255;\r\n\t\t\tthis._pOneData[i++] = initialColor.blueOffset/255;\r\n\t\t\tthis._pOneData[i++] = initialColor.alphaOffset/255;\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleInitialColorNode;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\n\r\n/**\r\n * Provides an abstract base class for particle animation nodes.\r\n */\r\nclass ParticleNodeBase extends AnimationNodeBase\r\n{\r\n\tprivate _priority:number /*int*/;\r\n\r\n\tpublic _pMode:number /*uint*/;\r\n\tpublic _pDataLength:number /*uint*/ = 3;\r\n\tpublic _pOneData:Array<number>;\r\n\r\n\tpublic _iDataOffset:number /*uint*/;\r\n\r\n\t//modes alias\r\n\tprivate static GLOBAL:string = 'Global';\r\n\tprivate static LOCAL_STATIC:string = 'LocalStatic';\r\n\tprivate static LOCAL_DYNAMIC:string = 'LocalDynamic';\r\n\r\n\t//modes list\r\n\tprivate static MODES:Object =\r\n\t{\r\n\t\t0:ParticleNodeBase.GLOBAL,\r\n\t\t1:ParticleNodeBase.LOCAL_STATIC,\r\n\t\t2:ParticleNodeBase.LOCAL_DYNAMIC\r\n\t};\r\n\r\n\t/**\r\n\t * Returns the property mode of the particle animation node. Typically set in the node constructor\r\n\t *\r\n\t * @see away.animators.ParticlePropertiesMode\r\n\t */\r\n\tpublic get mode():number /*uint*/\r\n\t{\r\n\t\treturn this._pMode;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the priority of the particle animation node, used to order the agal generated in a particle animation set. Set automatically on instantiation.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t * @see #getAGALVertexCode\r\n\t */\r\n\tpublic get priority():number /*int*/\r\n\t{\r\n\t\treturn this._priority;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the length of the data used by the node when in <code>LOCAL_STATIC</code> mode. Used to generate the local static data of the particle animation set.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t * @see #getAGALVertexCode\r\n\t */\r\n\tpublic get dataLength():number /*int*/\r\n\t{\r\n\t\treturn this._pDataLength;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the generated data vector of the node after one particle pass during the generation of all local static data of the particle animation set.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet\r\n\t * @see #generatePropertyOfOneParticle\r\n\t */\r\n\tpublic get oneData():Array<number>\r\n\t{\r\n\t\treturn this._pOneData;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleNodeBase</code> object.\r\n\t *\r\n\t * @param               name            Defines the generic name of the particle animation node.\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param               dataLength      Defines the length of the data used by the node when in <code>LOCAL_STATIC</code> mode.\r\n\t * @param    [optional] priority        the priority of the particle animation node, used to order the agal generated in a particle animation set. Defaults to 1.\r\n\t */\r\n\tconstructor(name:string, mode:number /*uint*/, dataLength:number /*uint*/, priority:number /*int*/ = 1)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tname = name + ParticleNodeBase.MODES[mode];\r\n\r\n\t\tthis.name = name;\r\n\t\tthis._pMode = mode;\r\n\t\tthis._priority = priority;\r\n\t\tthis._pDataLength = dataLength;\r\n\r\n\t\tthis._pOneData = new Array<number>(this._pDataLength);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the AGAL code of the particle animation node for use in the vertex shader.\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the AGAL code of the particle animation node for use in the fragment shader.\r\n\t */\r\n\tpublic getAGALFragmentCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the AGAL code of the particle animation node for use in the fragment shader when UV coordinates are required.\r\n\t */\r\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Called internally by the particle animation set when assigning the set of static properties originally defined by the initParticleFunc of the set.\r\n\t *\r\n\t * @see away.animators.ParticleAnimationSet#initParticleFunc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Called internally by the particle animation set when determining the requirements of the particle animation node AGAL.\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = ParticleNodeBase;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleOrbitState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleOrbitState\");\r\n\r\n/**\r\n * A particle animation node used to control the position of a particle over time around a circular orbit.\r\n */\r\nclass ParticleOrbitNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesEulers:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iRadius:number;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\t/** @private */\r\n\tpublic _iEulers:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for orbit node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the radius (x), cycle speed (y) and cycle phase (z) of the motion on the particle.\r\n\t */\r\n\tpublic static ORBIT_VECTOR3D:string = \"OrbitVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleOrbitNode</code> object.\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] usesEulers      Defines whether the node uses the <code>eulers</code> property in the shader to calculate a rotation on the orbit. Defaults to true.\r\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of the orbit independent of particle duration. Defaults to false.\r\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the cycle rotation of the particle. Defaults to false.\r\n\t * @param    [optional] radius          Defines the radius of the orbit when in global mode. Defaults to 100.\r\n\t * @param    [optional] cycleDuration   Defines the duration of the orbit in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the phase of the orbit in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t * @param    [optional] eulers          Defines the euler rotation in degrees, applied to the orientation of the orbit when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesEulers:boolean = true, usesCycle:boolean = false, usesPhase:boolean = false, radius:number = 100, cycleDuration:number = 1, cyclePhase:number = 0, eulers:Vector3D = null)\r\n\t{\r\n\t\tvar len:number /*int*/ = 3;\r\n\t\tif (usesPhase)\r\n\t\t\tlen++;\r\n\t\tsuper(\"ParticleOrbit\", mode, len);\r\n\r\n\t\tthis._pStateClass = ParticleOrbitState;\r\n\r\n\t\tthis._iUsesEulers = usesEulers;\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iRadius = radius;\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t\tthis._iEulers = eulers || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar orbitRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOrbitState.ORBIT_INDEX, orbitRegister.index);\r\n\r\n\t\tvar eulersMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOrbitState.EULERS_INDEX, eulersMatrixRegister.index);\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp1.regName, temp1.index);\r\n\r\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 0);\r\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 1);\r\n\t\tvar degree:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index, 2);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tcode += \"mul \" + degree + \",\" + animationRegisterCache.vertexTime + \",\" + orbitRegister + \".y\\n\";\r\n\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tcode += \"add \" + degree + \",\" + degree + \",\" + orbitRegister + \".w\\n\";\r\n\t\t} else\r\n\t\t\tcode += \"mul \" + degree + \",\" + animationRegisterCache.vertexLife + \",\" + orbitRegister + \".y\\n\";\r\n\r\n\t\tcode += \"cos \" + cos + \",\" + degree + \"\\n\";\r\n\t\tcode += \"sin \" + sin + \",\" + degree + \"\\n\";\r\n\t\tcode += \"mul \" + distance + \".x,\" + cos + \",\" + orbitRegister + \".x\\n\";\r\n\t\tcode += \"mul \" + distance + \".y,\" + sin + \",\" + orbitRegister + \".x\\n\";\r\n\t\tcode += \"mov \" + distance + \".wz\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\tif (this._iUsesEulers)\r\n\t\t\tcode += \"m44 \" + distance + \",\" + distance + \",\" + eulersMatrixRegister + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tcode += \"neg \" + distance + \".x,\" + sin + \"\\n\";\r\n\t\t\tcode += \"mov \" + distance + \".y,\" + cos + \"\\n\";\r\n\t\t\tcode += \"mov \" + distance + \".zw,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tif (this._iUsesEulers)\r\n\t\t\t\tcode += \"m44 \" + distance + \",\" + distance + \",\" + eulersMatrixRegister + \"\\n\";\r\n\t\t\tcode += \"mul \" + distance + \",\" + distance + \",\" + orbitRegister + \".z\\n\";\r\n\t\t\tcode += \"div \" + distance + \",\" + distance + \",\" + orbitRegister + \".y\\n\";\r\n\t\t\tif (!this._iUsesCycle)\r\n\t\t\t\tcode += \"div \" + distance + \",\" + distance + \",\" + animationRegisterCache.vertexLife + \"\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleOrbitState\r\n\t{\r\n\t\treturn <ParticleOrbitState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\t//Vector3D.x is radius, Vector3D.y is cycle duration, Vector3D.z is phase\r\n\t\tvar orbit:Vector3D = param[ParticleOrbitNode.ORBIT_VECTOR3D];\r\n\t\tif (!orbit)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleOrbitNode.ORBIT_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = orbit.x;\r\n\t\tif (this._iUsesCycle && orbit.y <= 0)\r\n\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\tthis._pOneData[1] = Math.PI*2/(!this._iUsesCycle? 1 : orbit.y);\r\n\t\tthis._pOneData[2] = orbit.x*Math.PI*2;\r\n\t\tif (this._iUsesPhase)\r\n\t\t\tthis._pOneData[3] = orbit.z*Math.PI/180;\r\n\t}\r\n}\r\n\r\nexport = ParticleOrbitNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleOscillatorState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleOscillatorState\");\r\n\r\n/**\r\n * A particle animation node used to control the position of a particle over time using simple harmonic motion.\r\n */\r\nclass ParticleOscillatorNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iOscillator:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for ocsillator node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the axis (x,y,z) and cycle speed (w) of the motion on the particle.\r\n\t */\r\n\tpublic static OSCILLATOR_VECTOR3D:string = \"OscillatorVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleOscillatorNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] oscillator      Defines the default oscillator axis (x, y, z) and cycleDuration (w) of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, oscillator:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleOscillator\", mode, 4);\r\n\r\n\t\tthis._pStateClass = ParticleOscillatorState;\r\n\r\n\t\tthis._iOscillator = oscillator || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar oscillatorRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleOscillatorState.OSCILLATOR_INDEX, oscillatorRegister.index);\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar dgree:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar distance:ShaderRegisterElement = new ShaderRegisterElement(temp2.regName, temp2.index);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"mul \" + dgree + \",\" + animationRegisterCache.vertexTime + \",\" + oscillatorRegister + \".w\\n\";\r\n\t\tcode += \"sin \" + sin + \",\" + dgree + \"\\n\";\r\n\t\tcode += \"mul \" + distance + \".xyz,\" + sin + \",\" + oscillatorRegister + \".xyz\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity) {\r\n\t\t\tcode += \"cos \" + cos + \",\" + dgree + \"\\n\";\r\n\t\t\tcode += \"mul \" + distance + \".xyz,\" + cos + \",\" + oscillatorRegister + \".xyz\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + distance + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleOscillatorState\r\n\t{\r\n\t\treturn <ParticleOscillatorState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\t//(Vector3D.x,Vector3D.y,Vector3D.z) is oscillator axis, Vector3D.w is oscillator cycle duration\r\n\t\tvar drift:Vector3D = param[ParticleOscillatorNode.OSCILLATOR_VECTOR3D];\r\n\t\tif (!drift)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleOscillatorNode.OSCILLATOR_VECTOR3D + \" in param!\"));\r\n\r\n\t\tthis._pOneData[0] = drift.x;\r\n\t\tthis._pOneData[1] = drift.y;\r\n\t\tthis._pOneData[2] = drift.z;\r\n\t\tif (drift.w <= 0)\r\n\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\t\tthis._pOneData[3] = Math.PI*2/drift.w;\r\n\t}\r\n}\r\n\r\nexport = ParticleOscillatorNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticlePositionState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticlePositionState\");\r\n\r\n/**\r\n * A particle animation node used to set the starting position of a particle.\r\n */\r\nclass ParticlePositionNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iPosition:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for position node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing position of the particle.\r\n\t */\r\n\tpublic static POSITION_VECTOR3D:string = \"PositionVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticlePositionNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] position        Defines the default position of the particle when in global mode. Defaults to 0,0,0.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, position:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticlePosition\", mode, 3);\r\n\r\n\t\tthis._pStateClass = ParticlePositionState;\r\n\r\n\t\tthis._iPosition = position || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar positionAttribute:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticlePositionState.POSITION_INDEX, positionAttribute.index);\r\n\r\n\t\treturn \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticlePositionState\r\n\t{\r\n\t\treturn <ParticlePositionState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar offset:Vector3D = param[ParticlePositionNode.POSITION_VECTOR3D];\r\n\t\tif (!offset)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticlePositionNode.POSITION_VECTOR3D + \" in param!\"));\r\n\r\n\t\tthis._pOneData[0] = offset.x;\r\n\t\tthis._pOneData[1] = offset.y;\r\n\t\tthis._pOneData[2] = offset.z;\r\n\t}\r\n}\r\n\r\nexport = ParticlePositionNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotateToHeadingState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState\");\r\n\r\n/**\r\n * A particle animation node used to control the rotation of a particle to match its heading vector.\r\n */\r\nclass ParticleRotateToHeadingNode extends ParticleNodeBase\r\n{\r\n\t/**\r\n\t * Creates a new <code>ParticleBillboardNode</code>\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(\"ParticleRotateToHeading\", ParticlePropertiesMode.GLOBAL, 0, 3);\r\n\r\n\t\tthis._pStateClass = ParticleRotateToHeadingState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\tvar i:number /*int*/;\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\r\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToHeadingState.MATRIX_INDEX, rotationMatrixRegister.index);\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\r\n\r\n\t\t\t//process the velocity\r\n\t\t\tcode += \"m33 \" + temp1 + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz,\" + rotationMatrixRegister + \"\\n\";\r\n\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".xy,\" + temp1 + \".xy\\n\";\r\n\t\t\tcode += \"nrm \" + temp3 + \".xyz,\" + temp3 + \".xyz\\n\";\r\n\r\n\t\t\t//temp3.x=cos,temp3.y=sin\r\n\t\t\t//only process z axis\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t} else {\r\n\t\t\tvar nrmVel:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(nrmVel, 1);\r\n\r\n\t\t\tvar xAxis:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(xAxis, 1);\r\n\r\n\t\t\tvar R:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(R, 1);\r\n\t\t\tvar R_rev:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(R.regName, R.index, 3);\r\n\t\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(R_rev.regName, R_rev.index, 3);\r\n\t\t\tvar cos2:ShaderRegisterElement = new ShaderRegisterElement(nrmVel.regName, nrmVel.index, 3);\r\n\t\t\tvar tempSingle:ShaderRegisterElement = sin;\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(nrmVel);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(xAxis);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(R);\r\n\r\n\t\t\tcode += \"mov \" + xAxis + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + xAxis + \".yz,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\r\n\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t\tcode += \"dp3 \" + cos2 + \",\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + xAxis + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t//use R as temp to judge if nrm is (0,0,0).\r\n\t\t\t//if nrm is (0,0,0) ,change it to (0,0,1).\r\n\t\t\tcode += \"dp3 \" + R + \".x,\" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"sge \" + R + \".x,\" + animationRegisterCache.vertexZeroConst + \",\" + R + \".x\\n\";\r\n\t\t\tcode += \"add \" + nrmVel + \".z,\" + R + \".x,\" + nrmVel + \".z\\n\";\r\n\r\n\t\t\tcode += \"add \" + tempSingle + \",\" + cos2 + \",\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"sqt \" + cos + \",\" + tempSingle + \"\\n\";\r\n\r\n\t\t\tcode += \"sub \" + tempSingle + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos2 + \"\\n\";\r\n\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\tcode += \"sqt \" + sin + \",\" + tempSingle + \"\\n\";\r\n\r\n\t\t\tcode += \"mul \" + R + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\r\n\t\t\t//use cos as R.w\r\n\r\n\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t\t//use cos as R_rev.w\r\n\r\n\t\t\t//nrmVel and xAxis are used as temp register\r\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + R + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\r\n\t\t\t//use cos as R.w\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + R + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\r\n\t\t\tcode += \"crs \" + R + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\t//code += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" +R_rev + \".w\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\t\tcode += \"add \" + R + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t//just repeat the calculate above\r\n\t\t\t\t//because of the limited registers, no need to optimise\r\n\t\t\t\tcode += \"mov \" + xAxis + \".x,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\t\tcode += \"mov \" + xAxis + \".yz,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\t\t\t\tcode += \"dp3 \" + cos2 + \",\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + xAxis + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"dp3 \" + R + \".x,\" + nrmVel + \".xyz,\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"sge \" + R + \".x,\" + animationRegisterCache.vertexZeroConst + \",\" + R + \".x\\n\";\r\n\t\t\t\tcode += \"add \" + nrmVel + \".z,\" + R + \".x,\" + nrmVel + \".z\\n\";\r\n\t\t\t\tcode += \"add \" + tempSingle + \",\" + cos2 + \",\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\t\tcode += \"sqt \" + cos + \",\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + tempSingle + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos2 + \"\\n\";\r\n\t\t\t\tcode += \"div \" + tempSingle + \",\" + tempSingle + \",\" + animationRegisterCache.vertexTwoConst + \"\\n\";\r\n\t\t\t\tcode += \"sqt \" + sin + \",\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + R + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + R + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\t\t\t\tcode += \"crs \" + R + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"add \" + R + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + R + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotateToHeadingState\r\n\t{\r\n\t\treturn <ParticleRotateToHeadingState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.needVelocity = true;\r\n\t}\r\n}\r\n\r\nexport = ParticleRotateToHeadingNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotateToPositionState\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState\");\r\n\r\n/**\r\n * A particle animation node used to control the rotation of a particle to face to a position\r\n */\r\nclass ParticleRotateToPositionNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iPosition:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for the position the particle will rotate to face for a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the position that the particle must face.\r\n\t */\r\n\tpublic static POSITION_VECTOR3D:string = \"RotateToPositionVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleRotateToPositionNode</code>\r\n\t */\r\n\tconstructor(mode:number /*uint*/, position:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleRotateToPosition\", mode, 3, 3);\r\n\r\n\t\tthis._pStateClass = ParticleRotateToPositionState;\r\n\r\n\t\tthis._iPosition = position || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar positionAttribute:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToPositionState.POSITION_INDEX, positionAttribute.index);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\tvar i:number /*int*/;\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tvar temp1:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp1, 1);\r\n\t\t\tvar temp2:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp2, 1);\r\n\t\t\tvar temp3:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\tvar rotationMatrixRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotateToPositionState.MATRIX_INDEX, rotationMatrixRegister.index);\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp1);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp2);\r\n\r\n\t\t\t//process the position\r\n\t\t\tcode += \"sub \" + temp1 + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\tcode += \"m33 \" + temp1 + \".xyz,\" + temp1 + \".xyz,\" + rotationMatrixRegister + \"\\n\";\r\n\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".xy,\" + temp1 + \".xy\\n\";\r\n\t\t\tcode += \"nrm \" + temp3 + \".xyz,\" + temp3 + \".xyz\\n\";\r\n\r\n\t\t\t//temp3.x=cos,temp3.y=sin\r\n\t\t\t//only process z axis\r\n\t\t\tcode += \"mov \" + temp2 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".x,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp2 + \".y,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp1 + \".x,\" + temp3 + \".x\\n\";\r\n\t\t\tcode += \"neg \" + temp1 + \".y,\" + temp3 + \".y\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mov \" + temp3 + \".z,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"m33 \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp1 + \"\\n\";\r\n\t\t\tfor (i = 0; i < len; i++)\r\n\t\t\t\tcode += \"m33 \" + animationRegisterCache.rotationRegisters[i] + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \",\" + temp1 + \"\\n\";\r\n\t\t} else {\r\n\t\t\tvar nrmDirection:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(nrmDirection, 1);\r\n\r\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\t\tvar o_temp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\t\tvar tempSingle:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 3);\r\n\r\n\t\t\tvar R:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(R, 1);\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(nrmDirection);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(R);\r\n\r\n\t\t\tcode += \"sub \" + nrmDirection + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\r\n\t\t\tcode += \"mov \" + sin + \",\" + nrmDirection + \".y\\n\";\r\n\t\t\tcode += \"mul \" + cos + \",\" + sin + \",\" + sin + \"\\n\";\r\n\t\t\tcode += \"sub \" + cos + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"sqt \" + cos + \",\" + cos + \"\\n\";\r\n\r\n\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".y\\n\";\r\n\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".y\\n\";\r\n\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\r\n\t\t\tcode += \"sub \" + animationRegisterCache.scaleAndRotateTarget + \".y,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\r\n\t\t\tcode += \"abs \" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\t\t\tcode += \"sge \" + R + \".z,\" + R + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\tcode += \"mul \" + R + \".x,\" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\r\n\t\t\t//judgu if nrmDirection=(0,1,0);\r\n\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"dp3 \" + sin + \",\" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\tcode += \"sge \" + tempSingle + \",\" + animationRegisterCache.vertexZeroConst + \",\" + sin + \"\\n\";\r\n\r\n\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\r\n\t\t\tcode += \"sub \" + sin + \",\" + animationRegisterCache.vertexOneConst + \",\" + tempSingle + \"\\n\";\r\n\t\t\tcode += \"mul \" + sin + \",\" + sin + \",\" + nrmDirection + \".x\\n\";\r\n\r\n\t\t\tcode += \"mov \" + cos + \",\" + nrmDirection + \".z\\n\";\r\n\t\t\tcode += \"neg \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"sub \" + o_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"mul \" + o_temp + \",\" + R + \".x,\" + tempSingle + \"\\n\";\r\n\t\t\tcode += \"add \" + cos + \",\" + cos + \",\" + o_temp + \"\\n\";\r\n\r\n\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".x\\n\";\r\n\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.scaleAndRotateTarget + \".x\\n\";\r\n\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".z\\n\";\r\n\r\n\t\t\tcode += \"sub \" + animationRegisterCache.scaleAndRotateTarget + \".x,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t//just repeat the calculate above\r\n\t\t\t\t//because of the limited registers, no need to optimise\r\n\t\t\t\tcode += \"sub \" + nrmDirection + \".xyz,\" + positionAttribute + \".xyz,\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\t\tcode += \"mov \" + sin + \",\" + nrmDirection + \".y\\n\";\r\n\t\t\t\tcode += \"mul \" + cos + \",\" + sin + \",\" + sin + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + cos + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"sqt \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".y\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".y\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"sub \" + animationRegisterCache.rotationRegisters[i] + \".y,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\t\t\t\tcode += \"abs \" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\t\t\t\tcode += \"sge \" + R + \".z,\" + R + \".y,\" + animationRegisterCache.vertexOneConst + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".x,\" + R + \".y,\" + nrmDirection + \".y\\n\";\r\n\t\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\tcode += \"dp3 \" + sin + \",\" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\t\tcode += \"sge \" + tempSingle + \",\" + animationRegisterCache.vertexZeroConst + \",\" + sin + \"\\n\";\r\n\t\t\t\tcode += \"mov \" + nrmDirection + \".y,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\tcode += \"nrm \" + nrmDirection + \".xyz,\" + nrmDirection + \".xyz\\n\";\r\n\t\t\t\tcode += \"sub \" + sin + \",\" + animationRegisterCache.vertexOneConst + \",\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + sin + \",\" + sin + \",\" + nrmDirection + \".x\\n\";\r\n\t\t\t\tcode += \"mov \" + cos + \",\" + nrmDirection + \".z\\n\";\r\n\t\t\t\tcode += \"neg \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"sub \" + o_temp + \",\" + animationRegisterCache.vertexOneConst + \",\" + cos + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + o_temp + \",\" + R + \".x,\" + tempSingle + \"\\n\";\r\n\t\t\t\tcode += \"add \" + cos + \",\" + cos + \",\" + o_temp + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".x,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".x\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".y,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".z,\" + sin + \",\" + animationRegisterCache.rotationRegisters[i] + \".x\\n\";\r\n\t\t\t\tcode += \"mul \" + R + \".w,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \".z\\n\";\r\n\t\t\t\tcode += \"sub \" + animationRegisterCache.rotationRegisters[i] + \".x,\" + R + \".x,\" + R + \".y\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \".z,\" + R + \".z,\" + R + \".w\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotateToPositionState\r\n\t{\r\n\t\treturn <ParticleRotateToPositionState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar offset:Vector3D = param[ParticleRotateToPositionNode.POSITION_VECTOR3D];\r\n\t\tif (!offset)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleRotateToPositionNode.POSITION_VECTOR3D + \" in param!\"));\r\n\r\n\t\tthis._pOneData[0] = offset.x;\r\n\t\tthis._pOneData[1] = offset.y;\r\n\t\tthis._pOneData[2] = offset.z;\r\n\t}\r\n}\r\n\r\nexport = ParticleRotateToPositionNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotationalVelocityState\t= require(\"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState\");\r\n\r\n/**\r\n * A particle animation node used to set the starting rotational velocity of a particle.\r\n */\r\nclass ParticleRotationalVelocityNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iRotationalVelocity:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for rotational velocity node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the rotational velocity around an axis of the particle.\r\n\t */\r\n\tpublic static ROTATIONALVELOCITY_VECTOR3D:string = \"RotationalVelocityVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleRotationalVelocityNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, rotationalVelocity:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleRotationalVelocity\", mode, 4);\r\n\r\n\t\tthis._pStateClass = ParticleRotationalVelocityState;\r\n\r\n\t\tthis._iRotationalVelocity = rotationalVelocity || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar rotationRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX, rotationRegister.index);\r\n\r\n\t\tvar nrmVel:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(nrmVel, 1);\r\n\r\n\t\tvar xAxis:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(xAxis, 1);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tanimationRegisterCache.addVertexTempUsages(temp, 1);\r\n\t\tvar Rtemp:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index);\r\n\t\tvar R_rev:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tR_rev = new ShaderRegisterElement(R_rev.regName, R_rev.index);\r\n\r\n\t\tvar cos:ShaderRegisterElement = new ShaderRegisterElement(Rtemp.regName, Rtemp.index, 3);\r\n\t\tvar sin:ShaderRegisterElement = new ShaderRegisterElement(R_rev.regName, R_rev.index, 3);\r\n\r\n\t\tanimationRegisterCache.removeVertexTempUsage(nrmVel);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(xAxis);\r\n\t\tanimationRegisterCache.removeVertexTempUsage(temp);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"mov \" + nrmVel + \".xyz,\" + rotationRegister + \".xyz\\n\";\r\n\t\tcode += \"mov \" + nrmVel + \".w,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\r\n\t\tcode += \"mul \" + cos + \",\" + animationRegisterCache.vertexTime + \",\" + rotationRegister + \".w\\n\";\r\n\r\n\t\tcode += \"sin \" + sin + \",\" + cos + \"\\n\";\r\n\t\tcode += \"cos \" + cos + \",\" + cos + \"\\n\";\r\n\r\n\t\tcode += \"mul \" + Rtemp + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\r\n\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t//nrmVel and xAxis are used as temp register\r\n\t\tcode += \"crs \" + nrmVel + \".xyz,\" + Rtemp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\r\n\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\tcode += \"dp3 \" + xAxis + \".w,\" + Rtemp + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz\\n\";\r\n\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\r\n\t\tcode += \"crs \" + Rtemp + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\t//use cos as R_rev.w\r\n\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\tcode += \"add \" + Rtemp + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\r\n\t\tcode += \"add \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\r\n\t\tvar len:number /*int*/ = animationRegisterCache.rotationRegisters.length;\r\n\t\tfor (var i:number /*int*/ = 0; i < len; i++) {\r\n\t\t\tcode += \"mov \" + nrmVel + \".xyz,\" + rotationRegister + \".xyz\\n\";\r\n\t\t\tcode += \"mov \" + nrmVel + \".w,\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\tcode += \"mul \" + cos + \",\" + animationRegisterCache.vertexTime + \",\" + rotationRegister + \".w\\n\";\r\n\t\t\tcode += \"sin \" + sin + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"cos \" + cos + \",\" + cos + \"\\n\";\r\n\t\t\tcode += \"mul \" + Rtemp + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + R_rev + \".xyz,\" + sin + \",\" + nrmVel + \".xyz\\n\";\r\n\t\t\tcode += \"neg \" + R_rev + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\tcode += \"crs \" + nrmVel + \".xyz,\" + Rtemp + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + cos + \",\" + animationRegisterCache.rotationRegisters[i] + \"\\n\";\r\n\t\t\tcode += \"add \" + nrmVel + \".xyz,\" + nrmVel + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"dp3 \" + xAxis + \".w,\" + Rtemp + \".xyz,\" + animationRegisterCache.rotationRegisters[i] + \"\\n\";\r\n\t\t\tcode += \"neg \" + nrmVel + \".w,\" + xAxis + \".w\\n\";\r\n\t\t\tcode += \"crs \" + Rtemp + \".xyz,\" + nrmVel + \".xyz,\" + R_rev + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyzw,\" + nrmVel + \".xyzw,\" + cos + \"\\n\";\r\n\t\t\tcode += \"add \" + Rtemp + \".xyz,\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t\tcode += \"mul \" + xAxis + \".xyz,\" + nrmVel + \".w,\" + R_rev + \".xyz\\n\";\r\n\t\t\tcode += \"add \" + animationRegisterCache.rotationRegisters[i] + \",\" + Rtemp + \".xyz,\" + xAxis + \".xyz\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleRotationalVelocityState\r\n\t{\r\n\t\treturn <ParticleRotationalVelocityState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\t//(Vector3d.x,Vector3d.y,Vector3d.z) is rotation axis,Vector3d.w is cycle duration\r\n\t\tvar rotate:Vector3D = param[ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D];\r\n\t\tif (!rotate)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleRotationalVelocityNode.ROTATIONALVELOCITY_VECTOR3D + \" in param!\"));\r\n\r\n\t\tif (rotate.length <= 0)\r\n\t\t\trotate.z = 1; //set the default direction\r\n\t\telse\r\n\t\t\trotate.normalize();\r\n\r\n\t\tthis._pOneData[0] = rotate.x;\r\n\t\tthis._pOneData[1] = rotate.y;\r\n\t\tthis._pOneData[2] = rotate.z;\r\n\t\tif (rotate.w <= 0)\r\n\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\t\t// it's used as angle/2 in agal\r\n\t\tthis._pOneData[3] = Math.PI/rotate.w;\r\n\t}\r\n}\r\n\r\nexport = ParticleRotationalVelocityNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleScaleState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleScaleState\");\r\n\r\n/**\r\n * A particle animation node used to control the scale variation of a particle over time.\r\n */\r\nclass ParticleScaleNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iMinScale:number;\r\n\t/** @private */\r\n\tpublic _iMaxScale:number;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\r\n\t/**\r\n\t * Reference for scale node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> representing the min scale (x), max scale(y), optional cycle speed (z) and phase offset (w) applied to the particle.\r\n\t */\r\n\tpublic static SCALE_VECTOR3D:string = \"ScaleVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleScaleNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] usesCycle       Defines whether the node uses the <code>cycleDuration</code> property in the shader to calculate the period of animation independent of particle duration. Defaults to false.\r\n\t * @param    [optional] usesPhase       Defines whether the node uses the <code>cyclePhase</code> property in the shader to calculate a starting offset to the animation cycle. Defaults to false.\r\n\t * @param    [optional] minScale        Defines the default min scale transform of the node, when in global mode. Defaults to 1.\r\n\t * @param    [optional] maxScale        Defines the default max color transform of the node, when in global mode. Defaults to 1.\r\n\t * @param    [optional] cycleDuration   Defines the default duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the default phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesCycle:boolean, usesPhase:boolean, minScale:number = 1, maxScale:number = 1, cycleDuration:number = 1, cyclePhase:number = 0)\r\n\t{\r\n\t\tsuper(\"ParticleScale\", mode, (usesCycle && usesPhase)? 4 : ((usesCycle || usesPhase)? 3 : 2), 3);\r\n\r\n\t\tthis._pStateClass = ParticleScaleState;\r\n\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iMinScale = minScale;\r\n\t\tthis._iMaxScale = maxScale;\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\r\n\t\tvar scaleRegister:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleScaleState.SCALE_INDEX, scaleRegister.index);\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tcode += \"mul \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + scaleRegister + \".z\\n\";\r\n\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tcode += \"add \" + temp + \",\" + temp + \",\" + scaleRegister + \".w\\n\";\r\n\r\n\t\t\tcode += \"sin \" + temp + \",\" + temp + \"\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"mul \" + temp + \",\" + scaleRegister + \".y,\" + ((this._iUsesCycle)? temp : animationRegisterCache.vertexLife) + \"\\n\";\r\n\t\tcode += \"add \" + temp + \",\" + scaleRegister + \".x,\" + temp + \"\\n\";\r\n\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleScaleState\r\n\t{\r\n\t\treturn <ParticleScaleState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar scale:Vector3D = param[ParticleScaleNode.SCALE_VECTOR3D];\r\n\t\tif (!scale)\r\n\t\t\tthrow(new Error(\"there is no \" + ParticleScaleNode.SCALE_VECTOR3D + \" in param!\"));\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tthis._pOneData[0] = (scale.x + scale.y)/2;\r\n\t\t\tthis._pOneData[1] = Math.abs(scale.x - scale.y)/2;\r\n\t\t\tif (scale.z <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tthis._pOneData[2] = Math.PI*2/scale.z;\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tthis._pOneData[3] = scale.w*Math.PI/180;\r\n\t\t} else {\r\n\t\t\tthis._pOneData[0] = scale.x;\r\n\t\t\tthis._pOneData[1] = scale.y - scale.x;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleScaleNode;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ColorSegmentPoint\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ColorSegmentPoint\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleSegmentedColorState\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState\");\r\n\r\n/**\r\n *\r\n */\r\nclass ParticleSegmentedColorNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesMultiplier:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesOffset:boolean;\r\n\t/** @private */\r\n\tpublic _iStartColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iEndColor:ColorTransform;\r\n\t/** @private */\r\n\tpublic _iNumSegmentPoint:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iSegmentPoints:Array<ColorSegmentPoint>;\r\n\r\n\tconstructor(usesMultiplier:boolean, usesOffset:boolean, numSegmentPoint:number /*int*/, startColor:ColorTransform, endColor:ColorTransform, segmentPoints:Array<ColorSegmentPoint>)\r\n\t{\r\n\t\t//because of the stage3d register limitation, it only support the global mode\r\n\t\tsuper(\"ParticleSegmentedColor\", ParticlePropertiesMode.GLOBAL, 0, ParticleAnimationSet.COLOR_PRIORITY);\r\n\r\n\t\tthis._pStateClass = ParticleSegmentedColorState;\r\n\r\n\t\tif (numSegmentPoint > 4)\r\n\t\t\tthrow(new Error(\"the numSegmentPoint must be less or equal 4\"));\r\n\t\tthis._iUsesMultiplier = usesMultiplier;\r\n\t\tthis._iUsesOffset = usesOffset;\r\n\t\tthis._iNumSegmentPoint = numSegmentPoint;\r\n\t\tthis._iStartColor = startColor;\r\n\t\tthis._iEndColor = endColor;\r\n\t\tthis._iSegmentPoints = segmentPoints;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tif (this._iUsesMultiplier)\r\n\t\t\tparticleAnimationSet.hasColorMulNode = true;\r\n\t\tif (this._iUsesOffset)\r\n\t\t\tparticleAnimationSet.hasColorAddNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tvar accMultiplierColor:ShaderRegisterElement;\r\n\t\t\t//var accOffsetColor:ShaderRegisterElement;\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\taccMultiplierColor = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t\tanimationRegisterCache.addVertexTempUsages(accMultiplierColor, 1);\r\n\t\t\t}\r\n\r\n\t\t\tvar tempColor:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tanimationRegisterCache.addVertexTempUsages(tempColor, 1);\r\n\r\n\t\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tvar accTime:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\t\tvar tempTime:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\r\n\t\t\tif (this._iUsesMultiplier)\r\n\t\t\t\tanimationRegisterCache.removeVertexTempUsage(accMultiplierColor);\r\n\r\n\t\t\tanimationRegisterCache.removeVertexTempUsage(tempColor);\r\n\r\n\t\t\t//for saving all the life values (at most 4)\r\n\t\t\tvar lifeTimeRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.TIME_DATA_INDEX, lifeTimeRegister.index);\r\n\r\n\t\t\tvar i:number /*int*/;\r\n\r\n\t\t\tvar startMulValue:ShaderRegisterElement;\r\n\t\t\tvar deltaMulValues:Array<ShaderRegisterElement>;\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tstartMulValue = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_MULTIPLIER_INDEX, startMulValue.index);\r\n\t\t\t\tdeltaMulValues = new Array<ShaderRegisterElement>();\r\n\t\t\t\tfor (i = 0; i < this._iNumSegmentPoint + 1; i++)\r\n\t\t\t\t\tdeltaMulValues.push(animationRegisterCache.getFreeVertexConstant());\r\n\t\t\t}\r\n\r\n\t\t\tvar startOffsetValue:ShaderRegisterElement;\r\n\t\t\tvar deltaOffsetValues:Array<ShaderRegisterElement>;\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tstartOffsetValue = animationRegisterCache.getFreeVertexConstant();\r\n\t\t\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSegmentedColorState.START_OFFSET_INDEX, startOffsetValue.index);\r\n\t\t\t\tdeltaOffsetValues = new Array<ShaderRegisterElement>();\r\n\t\t\t\tfor (i = 0; i < this._iNumSegmentPoint + 1; i++)\r\n\t\t\t\t\tdeltaOffsetValues.push(animationRegisterCache.getFreeVertexConstant());\r\n\t\t\t}\r\n\r\n\t\t\tif (this._iUsesMultiplier)\r\n\t\t\t\tcode += \"mov \" + accMultiplierColor + \",\" + startMulValue + \"\\n\";\r\n\t\t\tif (this._iUsesOffset)\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + startOffsetValue + \"\\n\";\r\n\r\n\t\t\tfor (i = 0; i < this._iNumSegmentPoint; i++) {\r\n\t\t\t\tswitch (i) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\r\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".y\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".y\\n\";\r\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".z\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".z\\n\";\r\n\t\t\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t\t\t\tcode += \"min \" + tempTime + \",\" + tempTime + \",\" + lifeTimeRegister + \".w\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaMulValues[i] + \"\\n\";\r\n\t\t\t\t\tcode += \"add \" + accMultiplierColor + \",\" + accMultiplierColor + \",\" + tempColor + \"\\n\";\r\n\t\t\t\t}\r\n\t\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaOffsetValues[i] + \"\\n\";\r\n\t\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + tempColor + \"\\n\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//for the last segment:\r\n\t\t\tif (this._iNumSegmentPoint == 0)\r\n\t\t\t\ttempTime = animationRegisterCache.vertexLife;\r\n\t\t\telse {\r\n\t\t\t\tswitch (this._iNumSegmentPoint) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + animationRegisterCache.vertexLife + \",\" + lifeTimeRegister + \".x\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".y\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".z\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\tcode += \"sub \" + accTime + \",\" + accTime + \",\" + lifeTimeRegister + \".w\\n\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcode += \"max \" + tempTime + \",\" + accTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\t\t}\r\n\t\t\tif (this._iUsesMultiplier) {\r\n\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaMulValues[this._iNumSegmentPoint] + \"\\n\";\r\n\t\t\t\tcode += \"add \" + accMultiplierColor + \",\" + accMultiplierColor + \",\" + tempColor + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.colorMulTarget + \",\" + animationRegisterCache.colorMulTarget + \",\" + accMultiplierColor + \"\\n\";\r\n\t\t\t}\r\n\t\t\tif (this._iUsesOffset) {\r\n\t\t\t\tcode += \"mul \" + tempColor + \",\" + tempTime + \",\" + deltaOffsetValues[this._iNumSegmentPoint] + \"\\n\";\r\n\t\t\t\tcode += \"add \" + animationRegisterCache.colorAddTarget + \",\" + animationRegisterCache.colorAddTarget + \",\" + tempColor + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleSegmentedColorNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleSpriteSheetState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState\");\r\n\r\n/**\r\n * A particle animation node used when a spritesheet texture is required to animate the particle.\r\n * NB: to enable use of this node, the <code>repeat</code> property on the material has to be set to true.\r\n */\r\nclass ParticleSpriteSheetNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesCycle:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iUsesPhase:boolean;\r\n\r\n\t/** @private */\r\n\tpublic _iTotalFrames:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iNumColumns:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iNumRows:number /*int*/;\r\n\t/** @private */\r\n\tpublic _iCycleDuration:number;\r\n\t/** @private */\r\n\tpublic _iCyclePhase:number;\r\n\r\n\t/**\r\n\t * Reference for spritesheet node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> representing the cycleDuration (x), optional phaseTime (y).\r\n\t */\r\n\tpublic static UV_VECTOR3D:string = \"UVVector3D\";\r\n\r\n\t/**\r\n\t * Defines the number of columns in the spritesheet, when in global mode. Defaults to 1. Read only.\r\n\t */\r\n\tpublic get numColumns():number\r\n\t{\r\n\t\treturn this._iNumColumns;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the number of rows in the spritesheet, when in global mode. Defaults to 1. Read only.\r\n\t */\r\n\tpublic get numRows():number\r\n\t{\r\n\t\treturn this._iNumRows;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows. Read only.\r\n\t */\r\n\tpublic get totalFrames():number\r\n\t{\r\n\t\treturn this._iTotalFrames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleSpriteSheetNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] numColumns      Defines the number of columns in the spritesheet, when in global mode. Defaults to 1.\r\n\t * @param    [optional] numRows         Defines the number of rows in the spritesheet, when in global mode. Defaults to 1.\r\n\t * @param    [optional] cycleDuration   Defines the default cycle duration in seconds, when in global mode. Defaults to 1.\r\n\t * @param    [optional] cyclePhase      Defines the default cycle phase, when in global mode. Defaults to 0.\r\n\t * @param    [optional] totalFrames     Defines the total number of frames used by the spritesheet, when in global mode. Defaults to the number defined by numColumns and numRows.\r\n\t * @param    [optional] looping         Defines whether the spritesheet animation is set to loop indefinitely. Defaults to true.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, usesCycle:boolean, usesPhase:boolean, numColumns:number /*int*/ = 1, numRows:number /*uint*/ = 1, cycleDuration:number = 1, cyclePhase:number = 0, totalFrames:number /*uint*/ = Number.MAX_VALUE)\r\n\t{\r\n\t\tsuper(\"ParticleSpriteSheet\", mode, usesCycle? (usesPhase? 3 : 2) : 1, ParticleAnimationSet.POST_PRIORITY + 1);\r\n\r\n\t\tthis._pStateClass = ParticleSpriteSheetState;\r\n\r\n\t\tthis._iUsesCycle = usesCycle;\r\n\t\tthis._iUsesPhase = usesPhase;\r\n\r\n\t\tthis._iNumColumns = numColumns;\r\n\t\tthis._iNumRows = numRows;\r\n\t\tthis._iCyclePhase = cyclePhase;\r\n\t\tthis._iCycleDuration = cycleDuration;\r\n\t\tthis._iTotalFrames = Math.min(totalFrames, numColumns*numRows);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\t//get 2 vc\r\n\t\tvar uvParamConst1:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tvar uvParamConst2:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_0, uvParamConst1.index);\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleSpriteSheetState.UV_INDEX_1, uvParamConst2.index);\r\n\r\n\t\tvar uTotal:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 0);\r\n\t\tvar uStep:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 1);\r\n\t\tvar vStep:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst1.regName, uvParamConst1.index, 2);\r\n\r\n\t\tvar uSpeed:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 0);\r\n\t\tvar cycle:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 1);\r\n\t\tvar phaseTime:ShaderRegisterElement = new ShaderRegisterElement(uvParamConst2.regName, uvParamConst2.index, 2);\r\n\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar time:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 0);\r\n\t\tvar vOffset:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 1);\r\n\t\ttemp = new ShaderRegisterElement(temp.regName, temp.index, 2);\r\n\t\tvar temp2:ShaderRegisterElement = new ShaderRegisterElement(temp.regName, temp.index, 3);\r\n\r\n\t\tvar u:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 0);\r\n\t\tvar v:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, 1);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\t//scale uv\r\n\t\tcode += \"mul \" + u + \",\" + u + \",\" + uStep + \"\\n\";\r\n\t\tif (this._iNumRows > 1)\r\n\t\t\tcode += \"mul \" + v + \",\" + v + \",\" + vStep + \"\\n\";\r\n\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tcode += \"add \" + time + \",\" + animationRegisterCache.vertexTime + \",\" + phaseTime + \"\\n\";\r\n\t\t\telse\r\n\t\t\t\tcode += \"mov \" + time + \",\" + animationRegisterCache.vertexTime + \"\\n\";\r\n\t\t\tcode += \"div \" + time + \",\" + time + \",\" + cycle + \"\\n\";\r\n\t\t\tcode += \"frc \" + time + \",\" + time + \"\\n\";\r\n\t\t\tcode += \"mul \" + time + \",\" + time + \",\" + cycle + \"\\n\";\r\n\t\t\tcode += \"mul \" + temp + \",\" + time + \",\" + uSpeed + \"\\n\";\r\n\t\t} else\r\n\t\t\tcode += \"mul \" + temp.toString() + \",\" + animationRegisterCache.vertexLife + \",\" + uTotal + \"\\n\";\r\n\r\n\t\tif (this._iNumRows > 1) {\r\n\t\t\tcode += \"frc \" + temp2 + \",\" + temp + \"\\n\";\r\n\t\t\tcode += \"sub \" + vOffset + \",\" + temp + \",\" + temp2 + \"\\n\";\r\n\t\t\tcode += \"mul \" + vOffset + \",\" + vOffset + \",\" + vStep + \"\\n\";\r\n\t\t\tcode += \"add \" + v + \",\" + v + \",\" + vOffset + \"\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"div \" + temp2 + \",\" + temp + \",\" + uStep + \"\\n\";\r\n\t\tcode += \"frc \" + temp + \",\" + temp2 + \"\\n\";\r\n\t\tcode += \"sub \" + temp2 + \",\" + temp2 + \",\" + temp + \"\\n\";\r\n\t\tcode += \"mul \" + temp + \",\" + temp2 + \",\" + uStep + \"\\n\";\r\n\r\n\t\tif (this._iNumRows > 1)\r\n\t\t\tcode += \"frc \" + temp + \",\" + temp + \"\\n\";\r\n\t\tcode += \"add \" + u + \",\" + u + \",\" + temp + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleSpriteSheetState\r\n\t{\r\n\t\treturn <ParticleSpriteSheetState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.hasUVNode = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tif (this._iUsesCycle) {\r\n\t\t\tvar uvCycle:Vector3D = param[ParticleSpriteSheetNode.UV_VECTOR3D];\r\n\t\t\tif (!uvCycle)\r\n\t\t\t\tthrow(new Error(\"there is no \" + ParticleSpriteSheetNode.UV_VECTOR3D + \" in param!\"));\r\n\t\t\tif (uvCycle.x <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tvar uTotal:number = this._iTotalFrames/this._iNumColumns;\r\n\t\t\tthis._pOneData[0] = uTotal/uvCycle.x;\r\n\t\t\tthis._pOneData[1] = uvCycle.x;\r\n\t\t\tif (this._iUsesPhase)\r\n\t\t\t\tthis._pOneData[2] = uvCycle.y;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleSpriteSheetNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleTimeState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleTimeState\");\r\n\r\n/**\r\n * A particle animation node used as the base node for timekeeping inside a particle. Automatically added to a particle animation set on instatiation.\r\n */\r\nclass ParticleTimeNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUsesDuration:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesDelay:boolean;\r\n\t/** @private */\r\n\tpublic _iUsesLooping:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleTimeNode</code>\r\n\t *\r\n\t * @param    [optional] usesDuration    Defines whether the node uses the <code>duration</code> data in the static properties to determine how long a particle is visible for. Defaults to false.\r\n\t * @param    [optional] usesDelay       Defines whether the node uses the <code>delay</code> data in the static properties to determine how long a particle is hidden for. Defaults to false. Requires <code>usesDuration</code> to be true.\r\n\t * @param    [optional] usesLooping     Defines whether the node creates a looping timeframe for each particle determined by the <code>startTime</code>, <code>duration</code> and <code>delay</code> data in the static properties function. Defaults to false. Requires <code>usesLooping</code> to be true.\r\n\t */\r\n\tconstructor(usesDuration:boolean = false, usesLooping:boolean = false, usesDelay:boolean = false)\r\n\t{\r\n\t\tthis._pStateClass = ParticleTimeState;\r\n\r\n\t\tthis._iUsesDuration = usesDuration;\r\n\t\tthis._iUsesLooping = usesLooping;\r\n\t\tthis._iUsesDelay = usesDelay;\r\n\r\n\t\tsuper(\"ParticleTime\", ParticlePropertiesMode.LOCAL_STATIC, 4, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar timeStreamRegister:ShaderRegisterElement = animationRegisterCache.getFreeVertexAttribute(); //timeStreamRegister.x is start，timeStreamRegister.y is during time\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleTimeState.TIME_STREAM_INDEX, timeStreamRegister.index);\r\n\t\tvar timeConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleTimeState.TIME_CONSTANT_INDEX, timeConst.index);\r\n\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"sub \" + animationRegisterCache.vertexTime + \",\" + timeConst + \",\" + timeStreamRegister + \".x\\n\";\r\n\t\t//if time=0,set the position to zero.\r\n\t\tvar temp:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\tcode += \"sge \" + temp + \",\" + animationRegisterCache.vertexTime + \",\" + animationRegisterCache.vertexZeroConst + \"\\n\";\r\n\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + temp + \"\\n\";\r\n\t\tif (this._iUsesDuration) {\r\n\t\t\tif (this._iUsesLooping) {\r\n\t\t\t\tvar div:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\t\t\tif (this._iUsesDelay) {\r\n\t\t\t\t\tcode += \"div \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".z\\n\";\r\n\t\t\t\t\tcode += \"frc \" + div + \",\" + div + \"\\n\";\r\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.vertexTime + \",\" + div + \",\" + timeStreamRegister + \".z\\n\";\r\n\t\t\t\t\tcode += \"slt \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".y\\n\";\r\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + div + \"\\n\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcode += \"mul \" + div + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".w\\n\";\r\n\t\t\t\t\tcode += \"frc \" + div + \",\" + div + \"\\n\";\r\n\t\t\t\t\tcode += \"mul \" + animationRegisterCache.vertexTime + \",\" + div + \",\" + timeStreamRegister + \".y\\n\";\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar sge:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\t\t\t\tcode += \"sge \" + sge + \",\" + timeStreamRegister + \".y,\" + animationRegisterCache.vertexTime + \"\\n\";\r\n\t\t\t\tcode += \"mul \" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + animationRegisterCache.scaleAndRotateTarget + \".xyz,\" + sge + \"\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tcode += \"mul \" + animationRegisterCache.vertexLife + \",\" + animationRegisterCache.vertexTime + \",\" + timeStreamRegister + \".w\\n\";\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleTimeState\r\n\t{\r\n\t\treturn <ParticleTimeState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tthis._pOneData[0] = param.startTime;\r\n\t\tthis._pOneData[1] = param.duration;\r\n\t\tthis._pOneData[2] = param.delay + param.duration;\r\n\t\tthis._pOneData[3] = 1/param.duration;\r\n\r\n\t}\r\n}\r\n\r\nexport = ParticleTimeNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimationSet\");\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleUVState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleUVState\");\r\n\r\n/**\r\n * A particle animation node used to control the UV offset and scale of a particle over time.\r\n */\r\nclass ParticleUVNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iUvData:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static U_AXIS:string = \"x\";\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static V_AXIS:string = \"y\";\r\n\r\n\tprivate _cycle:number;\r\n\tprivate _scale:number;\r\n\tprivate _axis:string;\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleTimeNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] cycle           Defines whether the time track is in loop mode. Defaults to false.\r\n\t * @param    [optional] scale           Defines whether the time track is in loop mode. Defaults to false.\r\n\t * @param    [optional] axis            Defines whether the time track is in loop mode. Defaults to false.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, cycle:number = 1, scale:number = 1, axis:string = \"x\")\r\n\t{\r\n\t\t//because of the stage3d register limitation, it only support the global mode\r\n\t\tsuper(\"ParticleUV\", ParticlePropertiesMode.GLOBAL, 4, ParticleAnimationSet.POST_PRIORITY + 1);\r\n\r\n\t\tthis._pStateClass = ParticleUVState;\r\n\r\n\t\tthis._cycle = cycle;\r\n\t\tthis._scale = scale;\r\n\t\tthis._axis = axis;\r\n\r\n\t\tthis.updateUVData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get cycle():number\r\n\t{\r\n\t\treturn this._cycle;\r\n\t}\r\n\r\n\tpublic set cycle(value:number)\r\n\t{\r\n\t\tthis._cycle = value;\r\n\r\n\t\tthis.updateUVData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get scale():number\r\n\t{\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\tpublic set scale(value:number)\r\n\t{\r\n\t\tthis._scale = value;\r\n\r\n\t\tthis.updateUVData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get axis():string\r\n\t{\r\n\t\treturn this._axis;\r\n\t}\r\n\r\n\tpublic set axis(value:string)\r\n\t{\r\n\t\tthis._axis = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALUVCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\tvar uvConst:ShaderRegisterElement = animationRegisterCache.getFreeVertexConstant();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleUVState.UV_INDEX, uvConst.index);\r\n\r\n\t\tvar axisIndex:number = this._axis == \"x\"? 0 : (this._axis == \"y\"? 1 : 2);\r\n\r\n\t\tvar target:ShaderRegisterElement = new ShaderRegisterElement(animationRegisterCache.uvTarget.regName, animationRegisterCache.uvTarget.index, axisIndex);\r\n\r\n\t\tvar sin:ShaderRegisterElement = animationRegisterCache.getFreeVertexSingleTemp();\r\n\r\n\t\tif (this._scale != 1)\r\n\t\t\tcode += \"mul \" + target + \",\" + target + \",\" + uvConst + \".y\\n\";\r\n\r\n\t\tcode += \"mul \" + sin + \",\" + animationRegisterCache.vertexTime + \",\" + uvConst + \".x\\n\";\r\n\t\tcode += \"sin \" + sin + \",\" + sin + \"\\n\";\r\n\t\tcode += \"add \" + target + \",\" + target + \",\" + sin + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleUVState\r\n\t{\r\n\t\treturn <ParticleUVState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\tprivate updateUVData()\r\n\t{\r\n\t\tthis._iUvData = new Vector3D(Math.PI*2/this._cycle, this._scale, 0, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iProcessAnimationSetting(particleAnimationSet:ParticleAnimationSet)\r\n\t{\r\n\t\tparticleAnimationSet.hasUVNode = true;\r\n\t}\r\n}\r\n\r\nexport = ParticleUVNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport ShaderObjectBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterElement\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nimport ParticleProperties\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleProperties\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleVelocityState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleVelocityState\");\r\n\r\n/**\r\n * A particle animation node used to set the starting velocity of a particle.\r\n */\r\nclass ParticleVelocityNode extends ParticleNodeBase\r\n{\r\n\t/** @private */\r\n\tpublic _iVelocity:Vector3D;\r\n\r\n\t/**\r\n\t * Reference for velocity node properties on a single particle (when in local property mode).\r\n\t * Expects a <code>Vector3D</code> object representing the direction of movement on the particle.\r\n\t */\r\n\tpublic static VELOCITY_VECTOR3D:string = \"VelocityVector3D\";\r\n\r\n\t/**\r\n\t * Creates a new <code>ParticleVelocityNode</code>\r\n\t *\r\n\t * @param               mode            Defines whether the mode of operation acts on local properties of a particle or global properties of the node.\r\n\t * @param    [optional] velocity        Defines the default velocity vector of the node, used when in global mode.\r\n\t */\r\n\tconstructor(mode:number /*uint*/, velocity:Vector3D = null)\r\n\t{\r\n\t\tsuper(\"ParticleVelocity\", mode, 3);\r\n\r\n\t\tthis._pStateClass = ParticleVelocityState;\r\n\r\n\t\tthis._iVelocity = velocity || new Vector3D();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAGALVertexCode(shaderObject:ShaderObjectBase, animationRegisterCache:AnimationRegisterCache):string\r\n\t{\r\n\t\tvar velocityValue:ShaderRegisterElement = (this._pMode == ParticlePropertiesMode.GLOBAL)? animationRegisterCache.getFreeVertexConstant() : animationRegisterCache.getFreeVertexAttribute();\r\n\t\tanimationRegisterCache.setRegisterIndex(this, ParticleVelocityState.VELOCITY_INDEX, velocityValue.index);\r\n\r\n\t\tvar distance:ShaderRegisterElement = animationRegisterCache.getFreeVertexVectorTemp();\r\n\t\tvar code:string = \"\";\r\n\t\tcode += \"mul \" + distance + \",\" + animationRegisterCache.vertexTime + \",\" + velocityValue + \"\\n\";\r\n\t\tcode += \"add \" + animationRegisterCache.positionTarget + \".xyz,\" + distance + \",\" + animationRegisterCache.positionTarget + \".xyz\\n\";\r\n\r\n\t\tif (animationRegisterCache.needVelocity)\r\n\t\t\tcode += \"add \" + animationRegisterCache.velocityTarget + \".xyz,\" + velocityValue + \".xyz,\" + animationRegisterCache.velocityTarget + \".xyz\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):ParticleVelocityState\r\n\t{\r\n\t\treturn <ParticleVelocityState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGeneratePropertyOfOneParticle(param:ParticleProperties)\r\n\t{\r\n\t\tvar _tempVelocity:Vector3D = param[ParticleVelocityNode.VELOCITY_VECTOR3D];\r\n\t\tif (!_tempVelocity)\r\n\t\t\tthrow new Error(\"there is no \" + ParticleVelocityNode.VELOCITY_VECTOR3D + \" in param!\");\r\n\r\n\t\tthis._pOneData[0] = _tempVelocity.x;\r\n\t\tthis._pOneData[1] = _tempVelocity.y;\r\n\t\tthis._pOneData[2] = _tempVelocity.z;\r\n\t}\r\n}\r\n\r\nexport = ParticleVelocityNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonBinaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState\");\r\n\r\n/**\r\n * A skeleton animation node that uses two animation node inputs to blend a lineraly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonBinaryLERPNode extends AnimationNodeBase\r\n{\r\n\t/**\r\n\t * Defines input node A to use for the blended output.\r\n\t */\r\n\tpublic inputA:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines input node B to use for the blended output.\r\n\t */\r\n\tpublic inputB:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonBinaryLERPNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonBinaryLERPState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonBinaryLERPState\r\n\t{\r\n\t\treturn <SkeletonBinaryLERPState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = SkeletonBinaryLERPNode;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\r\nimport SkeletonClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonClipState\");\r\n\r\n/**\r\n * A skeleton animation node containing time-based animation data as individual skeleton poses.\r\n */\r\nclass SkeletonClipNode extends AnimationClipNodeBase\r\n{\r\n\tprivate _frames:Array<SkeletonPose> = new Array<SkeletonPose>();\r\n\r\n\t/**\r\n\t * Determines whether to use SLERP equations (true) or LERP equations (false) in the calculation\r\n\t * of the output skeleton pose. Defaults to false.\r\n\t */\r\n\tpublic highQuality:boolean = false;\r\n\r\n\t/**\r\n\t * Returns a vector of skeleton poses representing the pose of each animation frame in the clip.\r\n\t */\r\n\tpublic get frames():Array<SkeletonPose>\r\n\t{\r\n\t\treturn this._frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonClipNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonClipState;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a skeleton pose frame to the internal timeline of the animation node.\r\n\t *\r\n\t * @param skeletonPose The skeleton pose object to add to the timeline of the node.\r\n\t * @param duration The specified duration of the frame in milliseconds.\r\n\t */\r\n\tpublic addFrame(skeletonPose:SkeletonPose, duration:number /*number /*uint*/)\r\n\t{\r\n\t\tthis._frames.push(skeletonPose);\r\n\t\tthis._pDurations.push(duration);\r\n\r\n\t\tthis._pNumFrames = this._pDurations.length;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonClipState\r\n\t{\r\n\t\treturn <SkeletonClipState> animator.getAnimationState(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateStitch()\r\n\t{\r\n\t\tsuper._pUpdateStitch();\r\n\r\n\t\tvar i:number /*uint*/ = this._pNumFrames - 1;\r\n\t\tvar p1:Vector3D, p2:Vector3D, delta:Vector3D;\r\n\t\twhile (i--) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[i];\r\n\t\t\tp1 = this._frames[i].jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[i + 1].jointPoses[0].translation;\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\r\n\t\tif (this._pStitchFinalFrame || !this._pLooping) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[this._pNumFrames - 1];\r\n\t\t\tp1 = this._frames[0].jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[1].jointPoses[0].translation;\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonClipNode;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonDifferenceState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState\");\r\n\r\n/**\r\n * A skeleton animation node that uses a difference input pose with a base input pose to blend a linearly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonDifferenceNode extends AnimationNodeBase\r\n{\r\n\t/**\r\n\t * Defines a base input node to use for the blended output.\r\n\t */\r\n\tpublic baseInput:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines a difference input node to use for the blended output.\r\n\t */\r\n\tpublic differenceInput:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonAdditiveNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonDifferenceState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonDifferenceState\r\n\t{\r\n\t\treturn <SkeletonDifferenceState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = SkeletonDifferenceNode",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonDirectionalState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState\");\r\n\r\n/**\r\n * A skeleton animation node that uses four directional input poses with an input direction to blend a linearly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonDirectionalNode extends AnimationNodeBase\r\n{\r\n\t/**\r\n\t * Defines the forward configured input node to use for the blended output.\r\n\t */\r\n\tpublic forward:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines the backwards configured input node to use for the blended output.\r\n\t */\r\n\tpublic backward:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines the left configured input node to use for the blended output.\r\n\t */\r\n\tpublic left:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Defines the right configured input node to use for the blended output.\r\n\t */\r\n\tpublic right:AnimationNodeBase;\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonDirectionalState;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonDirectionalState\r\n\t{\r\n\t\treturn <SkeletonDirectionalState> animator.getAnimationState(this);\r\n\t}\r\n\r\n}\r\n\r\nexport = SkeletonDirectionalNode;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport SkeletonNaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState\");\r\n\r\n/**\r\n * A skeleton animation node that uses an n-dimensional array of animation node inputs to blend a lineraly interpolated output of a skeleton pose.\r\n */\r\nclass SkeletonNaryLERPNode extends AnimationNodeBase\r\n{\r\n\tpublic _iInputs:Array<AnimationNodeBase> = new Array<AnimationNodeBase>();\r\n\r\n\tprivate _numInputs:number /*uint*/;\r\n\r\n\tpublic get numInputs():number /*uint*/\r\n\t{\r\n\t\treturn this._numInputs;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>SkeletonNaryLERPNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = SkeletonNaryLERPState;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an integer representing the input index of the given skeleton animation node.\r\n\t *\r\n\t * @param input The skeleton animation node for with the input index is requested.\r\n\t */\r\n\tpublic getInputIndex(input:AnimationNodeBase):number /*int*/\r\n\t{\r\n\t\treturn this._iInputs.indexOf(input);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the skeleton animation node object that resides at the given input index.\r\n\t *\r\n\t * @param index The input index for which the skeleton animation node is requested.\r\n\t */\r\n\tpublic getInputAt(index:number /*uint*/):AnimationNodeBase\r\n\t{\r\n\t\treturn this._iInputs[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a new skeleton animation node input to the animation node.\r\n\t */\r\n\tpublic addInput(input:AnimationNodeBase)\r\n\t{\r\n\t\tthis._iInputs[this._numInputs++] = input;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getAnimationState(animator:AnimatorBase):SkeletonNaryLERPState\r\n\t{\r\n\t\treturn <SkeletonNaryLERPState> animator.getAnimationState(this);\r\n\t}\r\n}\r\n\r\nexport = SkeletonNaryLERPNode",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\r\nimport VertexClipState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/VertexClipState\");\r\n\r\n/**\r\n * A vertex animation node containing time-based animation data as individual geometry obejcts.\r\n */\r\nclass VertexClipNode extends AnimationClipNodeBase\r\n{\r\n\tprivate _frames:Array<Geometry> = new Array<Geometry>();\r\n\tprivate _translations:Array<Vector3D> = new Array<Vector3D>();\r\n\r\n\t/**\r\n\t * Returns a vector of geometry frames representing the vertex values of each animation frame in the clip.\r\n\t */\r\n\tpublic get frames():Array<Geometry>\r\n\t{\r\n\t\treturn this._frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>VertexClipNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = VertexClipState;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a geometry object to the internal timeline of the animation node.\r\n\t *\r\n\t * @param geometry The geometry object to add to the timeline of the node.\r\n\t * @param duration The specified duration of the frame in milliseconds.\r\n\t * @param translation The absolute translation of the frame, used in root delta calculations for mesh movement.\r\n\t */\r\n\tpublic addFrame(geometry:Geometry, duration:number /*uint*/, translation:Vector3D = null)\r\n\t{\r\n\t\tthis._frames.push(geometry);\r\n\t\tthis._pDurations.push(duration);\r\n\t\tthis._translations.push(translation || new Vector3D());\r\n\r\n\t\tthis._pNumFrames = this._pDurations.length;\r\n\r\n\t\tthis._pStitchDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateStitch()\r\n\t{\r\n\t\tsuper._pUpdateStitch();\r\n\r\n\t\tvar i:number /*uint*/ = this._pNumFrames - 1;\r\n\t\tvar p1:Vector3D, p2:Vector3D, delta:Vector3D;\r\n\t\twhile (i--) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[i];\r\n\t\t\tp1 = this._translations[i];\r\n\t\t\tp2 = this._translations[i + 1];\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\r\n\t\tif (this._pNumFrames > 1 && (this._pStitchFinalFrame || !this._pLooping)) {\r\n\t\t\tthis._pTotalDuration += this._pDurations[this._pNumFrames - 1];\r\n\t\t\tp1 = this._translations[0];\r\n\t\t\tp2 = this._translations[1];\r\n\t\t\tdelta = p2.subtract(p1);\r\n\t\t\tthis._pTotalDelta.x += delta.x;\r\n\t\t\tthis._pTotalDelta.y += delta.y;\r\n\t\t\tthis._pTotalDelta.z += delta.z;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = VertexClipNode;",
    "import AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\nimport AnimationClipNodeBase\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\n\r\n/**\r\n *\r\n */\r\nclass AnimationClipState extends AnimationStateBase\r\n{\r\n\tprivate _animationClipNode:AnimationClipNodeBase;\r\n\tprivate _animationStatePlaybackComplete:AnimationStateEvent;\r\n\tpublic _pBlendWeight:number;\r\n\tpublic _pCurrentFrame:number /*uint*/;\r\n\tpublic _pNextFrame:number /*uint*/;\r\n\r\n\tpublic _pOldFrame:number /*uint*/;\r\n\tpublic _pTimeDir:number /*int*/;\r\n\tpublic _pFramesDirty:boolean = true;\r\n\r\n\t/**\r\n\t * Returns a fractional value between 0 and 1 representing the blending ratio of the current playhead position\r\n\t * between the current frame (0) and next frame (1) of the animation.\r\n\t *\r\n\t * @see #currentFrame\r\n\t * @see #nextFrame\r\n\t */\r\n\tpublic get blendWeight():number\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._pBlendWeight;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get currentFrame():number /*uint*/\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._pCurrentFrame;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the next frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get nextFrame():number /*uint*/\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._pNextFrame;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, animationClipNode:AnimationClipNodeBase)\r\n\t{\r\n\t\tsuper(animator, animationClipNode);\r\n\r\n\t\tthis._animationClipNode = animationClipNode;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic update(time:number /*int*/)\r\n\t{\r\n\t\tif (!this._animationClipNode.looping) {\r\n\t\t\tif (time > this._pStartTime + this._animationClipNode.totalDuration)\r\n\t\t\t\ttime = this._pStartTime + this._animationClipNode.totalDuration; else if (time < this._pStartTime)\r\n\t\t\t\ttime = this._pStartTime;\r\n\t\t}\r\n\r\n\t\tif (this._pTime == time - this._pStartTime)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tvar time:number /*int*/ = value*this._animationClipNode.totalDuration + this._pStartTime;\r\n\r\n\t\tif (this._pTime == time - this._pStartTime)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._pFramesDirty = true;\r\n\r\n\t\tthis._pTimeDir = (time - this._pStartTime > this._pTime)? 1 : -1;\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the nodes internal playhead to determine the current and next animation frame, and the blendWeight between the two.\r\n\t *\r\n\t * @see #currentFrame\r\n\t * @see #nextFrame\r\n\t * @see #blendWeight\r\n\t */\r\n\tpublic _pUpdateFrames()\r\n\t{\r\n\t\tthis._pFramesDirty = false;\r\n\r\n\t\tvar looping:boolean = this._animationClipNode.looping;\r\n\t\tvar totalDuration:number /*uint*/ = this._animationClipNode.totalDuration;\r\n\t\tvar lastFrame:number /*uint*/ = this._animationClipNode.lastFrame;\r\n\t\tvar time:number /*int*/ = this._pTime;\r\n\r\n\t\t//trace(\"time\", time, totalDuration)\r\n\t\tif (looping && (time >= totalDuration || time < 0)) {\r\n\t\t\ttime %= totalDuration;\r\n\t\t\tif (time < 0)\r\n\t\t\t\ttime += totalDuration;\r\n\t\t}\r\n\r\n\t\tif (!looping && time >= totalDuration) {\r\n\t\t\tthis.notifyPlaybackComplete();\r\n\t\t\tthis._pCurrentFrame = lastFrame;\r\n\t\t\tthis._pNextFrame = lastFrame;\r\n\t\t\tthis._pBlendWeight = 0;\r\n\t\t} else if (!looping && time <= 0) {\r\n\t\t\tthis._pCurrentFrame = 0;\r\n\t\t\tthis._pNextFrame = 0;\r\n\t\t\tthis._pBlendWeight = 0;\r\n\t\t} else if (this._animationClipNode.fixedFrameRate) {\r\n\t\t\tvar t:number = time/totalDuration*lastFrame;\r\n\t\t\tthis._pCurrentFrame = Math.floor(t);\r\n\t\t\tthis._pBlendWeight = t - this._pCurrentFrame;\r\n\t\t\tthis._pNextFrame = this._pCurrentFrame + 1;\r\n\t\t} else {\r\n\t\t\tthis._pCurrentFrame = 0;\r\n\t\t\tthis._pNextFrame = 0;\r\n\r\n\t\t\tvar dur:number /*uint*/ = 0, frameTime:number /*uint*/;\r\n\t\t\tvar durations:Array<number> /*uint*/ = this._animationClipNode.durations;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tframeTime = dur;\r\n\t\t\t\tdur += durations[this._pNextFrame];\r\n\t\t\t\tthis._pCurrentFrame = this._pNextFrame++;\r\n\t\t\t} while (time > dur);\r\n\r\n\t\t\tif (this._pCurrentFrame == lastFrame) {\r\n\t\t\t\tthis._pCurrentFrame = 0;\r\n\t\t\t\tthis._pNextFrame = 1;\r\n\t\t\t}\r\n\r\n\t\t\tthis._pBlendWeight = (time - frameTime)/durations[this._pCurrentFrame];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate notifyPlaybackComplete()\r\n\t{\r\n\t\tif (this._animationStatePlaybackComplete == null)\r\n\t\t\tthis._animationStatePlaybackComplete = new AnimationStateEvent(AnimationStateEvent.PLAYBACK_COMPLETE, this._pAnimator, this, this._animationClipNode);\r\n\r\n\t\tthis._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete);\r\n\t}\r\n}\r\n\r\nexport = AnimationClipState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport IAnimationState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\r\n\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\n\r\n/**\r\n *\r\n */\r\nclass AnimationStateBase implements IAnimationState\r\n{\r\n\tpublic _pAnimationNode:AnimationNodeBase;\r\n\tpublic _pRootDelta:Vector3D = new Vector3D();\r\n\tpublic _pPositionDeltaDirty:boolean = true;\r\n\r\n\tpublic _pTime:number;\r\n\tpublic _pStartTime:number = 0;\r\n\tpublic _pAnimator:AnimatorBase;\r\n\r\n\t/**\r\n\t * Returns a 3d vector representing the translation delta of the animating entity for the current timestep of animation\r\n\t */\r\n\tpublic get positionDelta():Vector3D\r\n\t{\r\n\t\tif (this._pPositionDeltaDirty) {\r\n\r\n\t\t\tthis._pUpdatePositionDelta();\r\n\t\t}\r\n\r\n\t\treturn this._pRootDelta;\r\n\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, animationNode:AnimationNodeBase)\r\n\t{\r\n\t\tthis._pAnimator = animator;\r\n\t\tthis._pAnimationNode = animationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the start time of the node to a  new value.\r\n\t *\r\n\t * @param startTime The absolute start time (in milliseconds) of the node's starting time.\r\n\t */\r\n\tpublic offset(startTime:number)\r\n\t{\r\n\t\tthis._pStartTime = startTime;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the configuration of the node to its current state.\r\n\t *\r\n\t * @param time The absolute time (in milliseconds) of the animator's play head position.\r\n\t *\r\n\t * @see AnimatorBase#update()\r\n\t */\r\n\tpublic update(time:number)\r\n\t{\r\n\t\tif (this._pTime == time - this._pStartTime) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tthis._pUpdateTime(time);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the animation phase of the node.\r\n\t *\r\n\t * @param value The phase value to use. 0 represents the beginning of an animation clip, 1 represents the end.\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the node's internal playhead position.\r\n\t *\r\n\t * @param time The local time (in milliseconds) of the node's playhead position.\r\n\t */\r\n\tpublic _pUpdateTime(time:number)\r\n\t{\r\n\t\tthis._pTime = time - this._pStartTime;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the node's root delta position\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t}\r\n}\r\n\r\nexport = AnimationStateBase;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleAccelerationNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleAccelerationState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static ACCELERATION_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _particleAccelerationNode:ParticleAccelerationNode;\r\n\tprivate _acceleration:Vector3D;\r\n\tprivate _halfAcceleration:Vector3D;\r\n\t\r\n\t/**\r\n\t * Defines the acceleration vector of the state, used when in global mode.\r\n\t */\r\n\tpublic get acceleration():Vector3D\r\n\t{\r\n\t\treturn this._acceleration;\r\n\t}\r\n\t\r\n\tpublic set acceleration(value:Vector3D)\r\n\t{\r\n\t\tthis._acceleration.x = value.x;\r\n\t\tthis._acceleration.y = value.y;\r\n\t\tthis._acceleration.z = value.z;\r\n\r\n\t\tthis.updateAccelerationData();\r\n\t}\r\n\t\r\n\tconstructor(animator:ParticleAnimator, particleAccelerationNode:ParticleAccelerationNode)\r\n\t{\r\n\t\tsuper(animator, particleAccelerationNode);\r\n\r\n\t\tthis._particleAccelerationNode = particleAccelerationNode;\r\n\t\tthis._acceleration = this._particleAccelerationNode._acceleration;\r\n\r\n\t\tthis.updateAccelerationData();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleAccelerationState.ACCELERATION_INDEX);\r\n\t\t\r\n\t\tif (this._particleAccelerationNode.mode == ParticlePropertiesMode.LOCAL_STATIC)\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleAccelerationNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\telse\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._halfAcceleration.x, this._halfAcceleration.y, this._halfAcceleration.z);\r\n\t}\r\n\t\r\n\tprivate updateAccelerationData()\r\n\t{\r\n\t\tif (this._particleAccelerationNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tthis._halfAcceleration = new Vector3D(this._acceleration.x/2, this._acceleration.y/2, this._acceleration.z/2);\r\n\t}\r\n}\r\n\r\nexport = ParticleAccelerationState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleBezierCurveNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n/**\r\n * ...\r\n */\r\nclass ParticleBezierCurveState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static BEZIER_CONTROL_INDEX:number /*int*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static BEZIER_END_INDEX:number /*int*/ = 1;\r\n\r\n\tprivate _particleBezierCurveNode:ParticleBezierCurveNode;\r\n\tprivate _controlPoint:Vector3D;\r\n\tprivate _endPoint:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default control point of the node, used when in global mode.\r\n\t */\r\n\tpublic get controlPoint():Vector3D\r\n\t{\r\n\t\treturn this._controlPoint;\r\n\t}\r\n\r\n\tpublic set controlPoint(value:Vector3D)\r\n\t{\r\n\t\tthis._controlPoint = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the default end point of the node, used when in global mode.\r\n\t */\r\n\tpublic get endPoint():Vector3D\r\n\t{\r\n\t\treturn this._endPoint;\r\n\t}\r\n\r\n\tpublic set endPoint(value:Vector3D)\r\n\t{\r\n\t\tthis._endPoint = value;\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleBezierCurveNode:ParticleBezierCurveNode)\r\n\t{\r\n\t\tsuper(animator, particleBezierCurveNode);\r\n\r\n\t\tthis._particleBezierCurveNode = particleBezierCurveNode;\r\n\t\tthis._controlPoint = this._particleBezierCurveNode._iControlPoint;\r\n\t\tthis._endPoint = this._particleBezierCurveNode._iEndPoint;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar controlIndex:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBezierCurveState.BEZIER_CONTROL_INDEX);\r\n\t\tvar endIndex:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBezierCurveState.BEZIER_END_INDEX);\r\n\r\n\t\tif (this._particleBezierCurveNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(controlIndex, this._particleBezierCurveNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(endIndex, this._particleBezierCurveNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else {\r\n\t\t\tanimationRegisterCache.setVertexConst(controlIndex, this._controlPoint.x, this._controlPoint.y, this._controlPoint.z);\r\n\t\t\tanimationRegisterCache.setVertexConst(endIndex, this._endPoint.x, this._endPoint.y, this._endPoint.z);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleBezierCurveState;",
    "import MathConsts\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport Orientation3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Orientation3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleBillboardNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleBillboardState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _matrix:Matrix3D = new Matrix3D;\r\n\r\n\tprivate _billboardAxis:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleBillboardNode)\r\n\t{\r\n\t\tsuper(animator, particleNode);\r\n\r\n\t\tthis._billboardAxis = particleNode._iBillboardAxis;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar comps:Array<Vector3D>;\r\n\t\tif (this._billboardAxis) {\r\n\t\t\tvar pos:Vector3D = renderable.sourceEntity.sceneTransform.position;\r\n\t\t\tvar look:Vector3D = camera.sceneTransform.position.subtract(pos);\r\n\t\t\tvar right:Vector3D = look.crossProduct(this._billboardAxis);\r\n\t\t\tright.normalize();\r\n\t\t\tlook = this.billboardAxis.crossProduct(right);\r\n\t\t\tlook.normalize();\r\n\r\n\t\t\t//create a quick inverse projection matrix\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tcomps = this._matrix.decompose(Orientation3D.AXIS_ANGLE);\r\n\t\t\tthis._matrix.copyColumnFrom(0, right);\r\n\t\t\tthis._matrix.copyColumnFrom(1, this.billboardAxis);\r\n\t\t\tthis._matrix.copyColumnFrom(2, look);\r\n\t\t\tthis._matrix.copyColumnFrom(3, pos);\r\n\t\t\tthis._matrix.appendRotation(-comps[1].w*MathConsts.RADIANS_TO_DEGREES, comps[1]);\r\n\t\t} else {\r\n\t\t\t//create a quick inverse projection matrix\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\r\n\r\n\t\t\t//decompose using axis angle rotations\r\n\t\t\tcomps = this._matrix.decompose(Orientation3D.AXIS_ANGLE);\r\n\r\n\t\t\t//recreate the matrix with just the rotation data\r\n\t\t\tthis._matrix.identity();\r\n\t\t\tthis._matrix.appendRotation(-comps[1].w*MathConsts.RADIANS_TO_DEGREES, comps[1]);\r\n\t\t}\r\n\r\n\t\t//set a new matrix transform constant\r\n\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleBillboardState.MATRIX_INDEX), this._matrix);\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the billboard axis.\r\n\t */\r\n\tpublic get billboardAxis():Vector3D\r\n\t{\r\n\t\treturn this.billboardAxis;\r\n\t}\r\n\r\n\tpublic set billboardAxis(value:Vector3D)\r\n\t{\r\n\t\tthis.billboardAxis = value? value.clone() : null;\r\n\t\tif (this.billboardAxis)\r\n\t\t\tthis.billboardAxis.normalize();\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleBillboardState;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleColorNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleColorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n * @author ...\r\n */\r\nclass ParticleColorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static START_MULTIPLIER_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static DELTA_MULTIPLIER_INDEX:number /*uint*/ = 1;\r\n\r\n\t/** @private */\r\n\tpublic static START_OFFSET_INDEX:number /*uint*/ = 2;\r\n\r\n\t/** @private */\r\n\tpublic static DELTA_OFFSET_INDEX:number /*uint*/ = 3;\r\n\r\n\t/** @private */\r\n\tpublic static CYCLE_INDEX:number /*uint*/ = 4;\r\n\r\n\tprivate _particleColorNode:ParticleColorNode;\r\n\tprivate _usesMultiplier:boolean;\r\n\tprivate _usesOffset:boolean;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _startColor:ColorTransform;\r\n\tprivate _endColor:ColorTransform;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _cycleData:Vector3D;\r\n\tprivate _startMultiplierData:Vector3D;\r\n\tprivate _deltaMultiplierData:Vector3D;\r\n\tprivate _startOffsetData:Vector3D;\r\n\tprivate _deltaOffsetData:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the start color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get startColor():ColorTransform\r\n\t{\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tpublic set startColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._startColor = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the end color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get endColor():ColorTransform\r\n\t{\r\n\t\treturn this._endColor;\r\n\t}\r\n\r\n\tpublic set endColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._endColor = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleColorNode:ParticleColorNode)\r\n\t{\r\n\t\tsuper(animator, particleColorNode);\r\n\r\n\t\tthis._particleColorNode = particleColorNode;\r\n\t\tthis._usesMultiplier = this._particleColorNode._iUsesMultiplier;\r\n\t\tthis._usesOffset = this._particleColorNode._iUsesOffset;\r\n\t\tthis._usesCycle = this._particleColorNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleColorNode._iUsesPhase;\r\n\t\tthis._startColor = this._particleColorNode._iStartColor;\r\n\t\tthis._endColor = this._particleColorNode._iEndColor;\r\n\t\tthis._cycleDuration = this._particleColorNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleColorNode._iCyclePhase;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tvar dataOffset:number /*uint*/ = this._particleColorNode._iDataOffset;\r\n\t\t\tif (this._usesCycle)\r\n\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.CYCLE_INDEX), this._cycleData.x, this._cycleData.y, this._cycleData.z, this._cycleData.w);\r\n\r\n\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_MULTIPLIER_INDEX), this._startMultiplierData.x, this._startMultiplierData.y, this._startMultiplierData.z, this._startMultiplierData.w);\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_MULTIPLIER_INDEX), this._deltaMultiplierData.x, this._deltaMultiplierData.y, this._deltaMultiplierData.z, this._deltaMultiplierData.w);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._usesOffset) {\r\n\t\t\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.START_OFFSET_INDEX), this._startOffsetData.x, this._startOffsetData.y, this._startOffsetData.z, this._startOffsetData.w);\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleColorState.DELTA_OFFSET_INDEX), this._deltaOffsetData.x, this._deltaOffsetData.y, this._deltaOffsetData.z, this._deltaOffsetData.w);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateColorData()\r\n\t{\r\n\t\tif (this._usesCycle) {\r\n\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tthis._cycleData = new Vector3D(Math.PI*2/this._cycleDuration, this._cyclePhase*Math.PI/180, 0, 0);\r\n\t\t}\r\n\t\tif (this._particleColorNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\t\tthis._startMultiplierData = new Vector3D((this._startColor.redMultiplier + this._endColor.redMultiplier)/2, (this._startColor.greenMultiplier + this._endColor.greenMultiplier)/2, (this._startColor.blueMultiplier + this._endColor.blueMultiplier)/2, (this._startColor.alphaMultiplier + this._endColor.alphaMultiplier)/2);\r\n\t\t\t\t\tthis._deltaMultiplierData = new Vector3D((this._endColor.redMultiplier - this._startColor.redMultiplier)/2, (this._endColor.greenMultiplier - this._startColor.greenMultiplier)/2, (this._endColor.blueMultiplier - this._startColor.blueMultiplier)/2, (this._endColor.alphaMultiplier - this._startColor.alphaMultiplier)/2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._usesOffset) {\r\n\t\t\t\t\tthis._startOffsetData = new Vector3D((this._startColor.redOffset + this._endColor.redOffset)/(255*2), (this._startColor.greenOffset + this._endColor.greenOffset)/(255*2), (this._startColor.blueOffset + this._endColor.blueOffset)/(255*2), (this._startColor.alphaOffset + this._endColor.alphaOffset)/(255*2));\r\n\t\t\t\t\tthis._deltaOffsetData = new Vector3D((this._endColor.redOffset - this._startColor.redOffset)/(255*2), (this._endColor.greenOffset - this._startColor.greenOffset)/(255*2), (this._endColor.blueOffset - this._startColor.blueOffset)/(255*2), (this._endColor.alphaOffset - this._startColor.alphaOffset)/(255*2));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\t\tthis._startMultiplierData = new Vector3D(this._startColor.redMultiplier, this._startColor.greenMultiplier, this._startColor.blueMultiplier, this._startColor.alphaMultiplier);\r\n\t\t\t\t\tthis._deltaMultiplierData = new Vector3D((this._endColor.redMultiplier - this._startColor.redMultiplier), (this._endColor.greenMultiplier - this._startColor.greenMultiplier), (this._endColor.blueMultiplier - this._startColor.blueMultiplier), (this._endColor.alphaMultiplier - this._startColor.alphaMultiplier));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._usesOffset) {\r\n\t\t\t\t\tthis._startOffsetData = new Vector3D(this._startColor.redOffset/255, this._startColor.greenOffset/255, this._startColor.blueOffset/255, this._startColor.alphaOffset/255);\r\n\t\t\t\t\tthis._deltaOffsetData = new Vector3D((this._endColor.redOffset - this._startColor.redOffset)/255, (this._endColor.greenOffset - this._startColor.greenOffset)/255, (this._endColor.blueOffset - this._startColor.blueOffset )/255, (this._endColor.alphaOffset - this._startColor.alphaOffset)/255);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleColorState;",
    "import MathConsts\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/MathConsts\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticleFollowNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleFollowState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static FOLLOW_POSITION_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static FOLLOW_ROTATION_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleFollowNode:ParticleFollowNode;\r\n\tprivate _followTarget:DisplayObject;\r\n\r\n\tprivate _targetPos:Vector3D = new Vector3D();\r\n\tprivate _targetEuler:Vector3D = new Vector3D();\r\n\tprivate _prePos:Vector3D;\r\n\tprivate _preEuler:Vector3D;\r\n\tprivate _smooth:boolean;\r\n\r\n\t//temporary vector3D for calculation\r\n\tprivate _temp:Vector3D = new Vector3D();\r\n\r\n\tconstructor(animator:ParticleAnimator, particleFollowNode:ParticleFollowNode)\r\n\t{\r\n\t\tsuper(animator, particleFollowNode, true);\r\n\r\n\t\tthis._particleFollowNode = particleFollowNode;\r\n\t\tthis._smooth = particleFollowNode._iSmooth;\r\n\t}\r\n\r\n\tpublic get followTarget():DisplayObject\r\n\t{\r\n\t\treturn this._followTarget;\r\n\t}\r\n\r\n\tpublic set followTarget(value:DisplayObject)\r\n\t{\r\n\t\tthis._followTarget = value;\r\n\t}\r\n\r\n\tpublic get smooth():boolean\r\n\t{\r\n\t\treturn this._smooth;\r\n\t}\r\n\r\n\tpublic set smooth(value:boolean)\r\n\t{\r\n\t\tthis._smooth = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._followTarget) {\r\n\t\t\tif (this._particleFollowNode._iUsesPosition) {\r\n\t\t\t\tthis._targetPos.x = this._followTarget.transform.position.x/renderable.sourceEntity.scaleX;\r\n\t\t\t\tthis._targetPos.y = this._followTarget.transform.position.y/renderable.sourceEntity.scaleY;\r\n\t\t\t\tthis._targetPos.z = this._followTarget.transform.position.z/renderable.sourceEntity.scaleZ;\r\n\t\t\t}\r\n\t\t\tif (this._particleFollowNode._iUsesRotation) {\r\n\t\t\t\tthis._targetEuler.x = this._followTarget.rotationX;\r\n\t\t\t\tthis._targetEuler.y = this._followTarget.rotationY;\r\n\t\t\t\tthis._targetEuler.z = this._followTarget.rotationZ;\r\n\t\t\t\tthis._targetEuler.scaleBy(MathConsts.DEGREES_TO_RADIANS);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//initialization\r\n\t\tif (!this._prePos)\r\n\t\t\tthis._prePos = this._targetPos.clone();\r\n\t\tif (!this._preEuler)\r\n\t\t\tthis._preEuler = this._targetEuler.clone();\r\n\r\n\t\tvar currentTime:number = this._pTime/1000;\r\n\t\tvar previousTime:number = animationSubGeometry.previousTime;\r\n\t\tvar deltaTime:number = currentTime - previousTime;\r\n\r\n\t\tvar needProcess:boolean = previousTime != currentTime;\r\n\r\n\t\tif (this._particleFollowNode._iUsesPosition && this._particleFollowNode._iUsesRotation) {\r\n\t\t\tif (needProcess)\r\n\t\t\t\tthis.processPositionAndRotation(currentTime, deltaTime, animationSubGeometry);\r\n\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset + 3, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else if (this._particleFollowNode._iUsesPosition) {\r\n\t\t\tif (needProcess)\r\n\t\t\t\tthis.processPosition(currentTime, deltaTime, animationSubGeometry);\r\n\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_POSITION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else if (this._particleFollowNode._iUsesRotation) {\r\n\t\t\tif (needProcess)\r\n\t\t\t\tthis.precessRotation(currentTime, deltaTime, animationSubGeometry);\r\n\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleFollowState.FOLLOW_ROTATION_INDEX), this._particleFollowNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t}\r\n\r\n\t\tthis._prePos.copyFrom(this._targetPos);\r\n\t\tthis._targetEuler.copyFrom(this._targetEuler);\r\n\t\tanimationSubGeometry.previousTime = currentTime;\r\n\t}\r\n\r\n\tprivate processPosition(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\r\n\t\tvar changed:boolean = false;\r\n\t\tvar len:number /*uint*/ = data.length;\r\n\t\tvar interpolatedPos:Vector3D;\r\n\t\tvar posVelocity:Vector3D;\r\n\t\tif (this._smooth) {\r\n\t\t\tposVelocity = this._prePos.subtract(this._targetPos);\r\n\t\t\tposVelocity.scaleBy(1/deltaTime);\r\n\t\t} else\r\n\t\t\tinterpolatedPos = this._targetPos;\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\r\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\r\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\r\n\t\t\tif (t - deltaTime <= 0) {\r\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\r\n\r\n\t\t\t\tif (this._smooth) {\r\n\t\t\t\t\tthis._temp.copyFrom(posVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedPos = this._targetPos.add(this._temp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (changed)\r\n\t\t\tanimationSubGeometry.invalidateBuffer();\r\n\r\n\t}\r\n\r\n\tprivate precessRotation(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\r\n\t\tvar changed:boolean = false;\r\n\t\tvar len:number /*uint*/ = data.length;\r\n\r\n\t\tvar interpolatedRotation:Vector3D;\r\n\t\tvar rotationVelocity:Vector3D;\r\n\r\n\t\tif (this._smooth) {\r\n\t\t\trotationVelocity = this._preEuler.subtract(this._targetEuler);\r\n\t\t\trotationVelocity.scaleBy(1/deltaTime);\r\n\t\t} else\r\n\t\t\tinterpolatedRotation = this._targetEuler;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\r\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\r\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\r\n\t\t\tif (t - deltaTime <= 0) {\r\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\r\n\r\n\t\t\t\tif (this._smooth) {\r\n\t\t\t\t\tthis._temp.copyFrom(rotationVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedRotation = this._targetEuler.add(this._temp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (vertexData[inc] != interpolatedRotation.x || vertexData[inc + 1] != interpolatedRotation.y || vertexData[inc + 2] != interpolatedRotation.z) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (changed)\r\n\t\t\tanimationSubGeometry.invalidateBuffer();\r\n\r\n\t}\r\n\r\n\tprivate processPositionAndRotation(currentTime:number, deltaTime:number, animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tvar data:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\r\n\t\tvar changed:boolean = false;\r\n\t\tvar len:number /*uint*/ = data.length;\r\n\r\n\t\tvar interpolatedPos:Vector3D;\r\n\t\tvar interpolatedRotation:Vector3D;\r\n\r\n\t\tvar posVelocity:Vector3D;\r\n\t\tvar rotationVelocity:Vector3D;\r\n\t\tif (this._smooth) {\r\n\t\t\tposVelocity = this._prePos.subtract(this._targetPos);\r\n\t\t\tposVelocity.scaleBy(1/deltaTime);\r\n\t\t\trotationVelocity = this._preEuler.subtract(this._targetEuler);\r\n\t\t\trotationVelocity.scaleBy(1/deltaTime);\r\n\t\t} else {\r\n\t\t\tinterpolatedPos = this._targetPos;\r\n\t\t\tinterpolatedRotation = this._targetEuler;\r\n\t\t}\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; i++) {\r\n\t\t\tvar k:number = (currentTime - data[i].startTime)/data[i].totalTime;\r\n\t\t\tvar t:number = (k - Math.floor(k))*data[i].totalTime;\r\n\t\t\tif (t - deltaTime <= 0) {\r\n\t\t\t\tvar inc:number /*int*/ = data[i].startVertexIndex*animationSubGeometry.totalLenOfOneVertex + this._particleFollowNode._iDataOffset;\r\n\t\t\t\tif (this._smooth) {\r\n\t\t\t\t\tthis._temp.copyFrom(posVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedPos = this._targetPos.add(this._temp);\r\n\r\n\t\t\t\t\tthis._temp.copyFrom(rotationVelocity);\r\n\t\t\t\t\tthis._temp.scaleBy(t);\r\n\t\t\t\t\tinterpolatedRotation = this._targetEuler.add(this._temp);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (vertexData[inc] != interpolatedPos.x || vertexData[inc + 1] != interpolatedPos.y || vertexData[inc + 2] != interpolatedPos.z || vertexData[inc + 3] != interpolatedRotation.x || vertexData[inc + 4] != interpolatedRotation.y || vertexData[inc + 5] != interpolatedRotation.z) {\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t\tfor (var j:number /*uint*/ = 0; j < data[i].numVertices; j++) {\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedPos.z;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.x;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.y;\r\n\t\t\t\t\t\tvertexData[inc++] = interpolatedRotation.z;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (changed)\r\n\t\t\tanimationSubGeometry.invalidateBuffer();\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleFollowState;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleInitialColorNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n*\r\n*/\r\nclass ParticleInitialColorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MULTIPLIER_INDEX:number /*uint*/ = 0;\r\n\t/** @private */\r\n\tpublic static OFFSET_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleInitialColorNode:ParticleInitialColorNode;\r\n\tprivate _usesMultiplier:boolean;\r\n\tprivate _usesOffset:boolean;\r\n\tprivate _initialColor:ColorTransform;\r\n\tprivate _multiplierData:Vector3D;\r\n\tprivate _offsetData:Vector3D;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleInitialColorNode:ParticleInitialColorNode)\r\n\t{\r\n\t\tsuper(animator, particleInitialColorNode);\r\n\r\n\t\tthis._particleInitialColorNode = particleInitialColorNode;\r\n\t\tthis._usesMultiplier = particleInitialColorNode._iUsesMultiplier;\r\n\t\tthis._usesOffset = particleInitialColorNode._iUsesOffset;\r\n\t\tthis._initialColor = particleInitialColorNode._iInitialColor;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the initial color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get initialColor():ColorTransform\r\n\t{\r\n\t\treturn this._initialColor;\r\n\t}\r\n\r\n\tpublic set initialColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._initialColor = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\t// TODO: not used\r\n\t\trenderable = renderable;\r\n\t\tcamera = camera;\r\n\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tif (this._particleInitialColorNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\tvar dataOffset:number /*uint*/ = this._particleInitialColorNode._iDataOffset;\r\n\t\t\t\tif (this._usesMultiplier) {\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\t\tdataOffset += 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._usesOffset)\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), dataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t} else {\r\n\t\t\t\tif (this._usesMultiplier)\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.MULTIPLIER_INDEX), this._multiplierData.x, this._multiplierData.y, this._multiplierData.z, this._multiplierData.w);\r\n\t\t\t\tif (this._usesOffset)\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleInitialColorState.OFFSET_INDEX), this._offsetData.x, this._offsetData.y, this._offsetData.z, this._offsetData.w);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateColorData()\r\n\t{\r\n\t\tif (this._particleInitialColorNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._usesMultiplier)\r\n\t\t\t\tthis._multiplierData = new Vector3D(this._initialColor.redMultiplier, this._initialColor.greenMultiplier, this._initialColor.blueMultiplier, this._initialColor.alphaMultiplier);\r\n\t\t\tif (this._usesOffset)\r\n\t\t\t\tthis._offsetData = new Vector3D(this._initialColor.redOffset/255, this._initialColor.greenOffset/255, this._initialColor.blueOffset/255, this._initialColor.alphaOffset/255);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleInitialColorState;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleOrbitNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleOrbitState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static ORBIT_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static EULERS_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleOrbitNode:ParticleOrbitNode;\r\n\tprivate _usesEulers:boolean;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _radius:number;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _eulers:Vector3D;\r\n\tprivate _orbitData:Vector3D;\r\n\tprivate _eulersMatrix:Matrix3D;\r\n\r\n\t/**\r\n\t * Defines the radius of the orbit when in global mode. Defaults to 100.\r\n\t */\r\n\tpublic get radius():number\r\n\t{\r\n\t\treturn this._radius;\r\n\t}\r\n\r\n\tpublic set radius(value:number)\r\n\t{\r\n\t\tthis._radius = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the duration of the orbit in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the phase of the orbit in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the euler rotation in degrees, applied to the orientation of the orbit when in global mode.\r\n\t */\r\n\tpublic get eulers():Vector3D\r\n\t{\r\n\t\treturn this._eulers;\r\n\t}\r\n\r\n\tpublic set eulers(value:Vector3D)\r\n\t{\r\n\t\tthis._eulers = value;\r\n\r\n\t\tthis.updateOrbitData();\r\n\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleOrbitNode:ParticleOrbitNode)\r\n\t{\r\n\t\tsuper(animator, particleOrbitNode);\r\n\r\n\t\tthis._particleOrbitNode = particleOrbitNode;\r\n\t\tthis._usesEulers = this._particleOrbitNode._iUsesEulers;\r\n\t\tthis._usesCycle = this._particleOrbitNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleOrbitNode._iUsesPhase;\r\n\t\tthis._eulers = this._particleOrbitNode._iEulers;\r\n\t\tthis._radius = this._particleOrbitNode._iRadius;\r\n\t\tthis._cycleDuration = this._particleOrbitNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleOrbitNode._iCyclePhase;\r\n\t\tthis.updateOrbitData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOrbitState.ORBIT_INDEX);\r\n\r\n\t\tif (this._particleOrbitNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tif (this._usesPhase)\r\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOrbitNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\telse\r\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOrbitNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t} else\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._orbitData.x, this._orbitData.y, this._orbitData.z, this._orbitData.w);\r\n\r\n\t\tif (this._usesEulers)\r\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOrbitState.EULERS_INDEX), this._eulersMatrix);\r\n\t}\r\n\r\n\tprivate updateOrbitData()\r\n\t{\r\n\t\tif (this._usesEulers) {\r\n\t\t\tthis._eulersMatrix = new Matrix3D();\r\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.x, Vector3D.X_AXIS);\r\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.y, Vector3D.Y_AXIS);\r\n\t\t\tthis._eulersMatrix.appendRotation(this._eulers.z, Vector3D.Z_AXIS);\r\n\t\t}\r\n\t\tif (this._particleOrbitNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tthis._orbitData = new Vector3D(this._radius, 0, this._radius*Math.PI*2, this._cyclePhase*Math.PI/180);\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\t\tthis._orbitData.y = Math.PI*2/this._cycleDuration;\r\n\t\t\t} else\r\n\t\t\t\tthis._orbitData.y = Math.PI*2;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleOrbitState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleOscillatorNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleOscillatorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static OSCILLATOR_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleOscillatorNode:ParticleOscillatorNode;\r\n\tprivate _oscillator:Vector3D;\r\n\tprivate _oscillatorData:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default oscillator axis (x, y, z) and cycleDuration (w) of the state, used when in global mode.\r\n\t */\r\n\tpublic get oscillator():Vector3D\r\n\t{\r\n\t\treturn this._oscillator;\r\n\t}\r\n\r\n\tpublic set oscillator(value:Vector3D)\r\n\t{\r\n\t\tthis._oscillator = value;\r\n\r\n\t\tthis.updateOscillatorData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleOscillatorNode:ParticleOscillatorNode)\r\n\t{\r\n\t\tsuper(animator, particleOscillatorNode);\r\n\r\n\t\tthis._particleOscillatorNode = particleOscillatorNode;\r\n\t\tthis._oscillator = this._particleOscillatorNode._iOscillator;\r\n\r\n\t\tthis.updateOscillatorData();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleOscillatorState.OSCILLATOR_INDEX);\r\n\r\n\t\tif (this._particleOscillatorNode.mode == ParticlePropertiesMode.LOCAL_STATIC)\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleOscillatorNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\telse\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._oscillatorData.x, this._oscillatorData.y, this._oscillatorData.z, this._oscillatorData.w);\r\n\t}\r\n\r\n\tprivate updateOscillatorData()\r\n\t{\r\n\t\tif (this._particleOscillatorNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._oscillator.w <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\r\n\t\t\tif (this._oscillatorData == null)\r\n\t\t\t\tthis._oscillatorData = new Vector3D();\r\n\r\n\t\t\tthis._oscillatorData.x = this._oscillator.x;\r\n\t\t\tthis._oscillatorData.y = this._oscillator.y;\r\n\t\t\tthis._oscillatorData.z = this._oscillator.z;\r\n\t\t\tthis._oscillatorData.w = Math.PI*2/this._oscillator.w;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleOscillatorState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticlePositionNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n * @author ...\r\n */\r\nclass ParticlePositionState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static POSITION_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particlePositionNode:ParticlePositionNode;\r\n\tprivate _position:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the position of the particle when in global mode. Defaults to 0,0,0.\r\n\t */\r\n\tpublic get position():Vector3D\r\n\t{\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tpublic set position(value:Vector3D)\r\n\t{\r\n\t\tthis._position = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getPositions():Array<Vector3D>\r\n\t{\r\n\t\treturn this._pDynamicProperties;\r\n\t}\r\n\r\n\tpublic setPositions(value:Array<Vector3D>)\r\n\t{\r\n\t\tthis._pDynamicProperties = value;\r\n\r\n\t\tthis._pDynamicPropertiesDirty = new Object();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particlePositionNode:ParticlePositionNode)\r\n\t{\r\n\t\tsuper(animator, particlePositionNode);\r\n\r\n\t\tthis._particlePositionNode = particlePositionNode;\r\n\t\tthis._position = this._particlePositionNode._iPosition;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._particlePositionNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\r\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\r\n\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticlePositionState.POSITION_INDEX);\r\n\r\n\t\tif (this._particlePositionNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._position.x, this._position.y, this._position.z);\r\n\t\telse\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particlePositionNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t}\r\n}\r\n\r\nexport = ParticlePositionState;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport ParticleRotateToHeadingNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleRotateToHeadingState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _matrix:Matrix3D = new Matrix3D();\r\n\r\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleNodeBase)\r\n\t{\r\n\t\tsuper(animator, particleNode);\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\r\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToHeadingState.MATRIX_INDEX), this._matrix);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleRotateToHeadingState;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleRotateToPositionNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleRotateToPositionState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static MATRIX_INDEX:number /*int*/ = 0;\r\n\t/** @private */\r\n\tpublic static POSITION_INDEX:number /*int*/ = 1;\r\n\r\n\tprivate _particleRotateToPositionNode:ParticleRotateToPositionNode;\r\n\tprivate _position:Vector3D;\r\n\tprivate _matrix:Matrix3D = new Matrix3D();\r\n\tprivate _offset:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the position of the point the particle will rotate to face when in global mode. Defaults to 0,0,0.\r\n\t */\r\n\tpublic get position():Vector3D\r\n\t{\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tpublic set position(value:Vector3D)\r\n\t{\r\n\t\tthis._position = value;\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleRotateToPositionNode:ParticleRotateToPositionNode)\r\n\t{\r\n\t\tsuper(animator, particleRotateToPositionNode);\r\n\r\n\t\tthis._particleRotateToPositionNode = particleRotateToPositionNode;\r\n\t\tthis._position = this._particleRotateToPositionNode._iPosition;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToPositionState.POSITION_INDEX);\r\n\r\n\t\tif (animationRegisterCache.hasBillboard) {\r\n\t\t\tthis._matrix.copyFrom(renderable.sourceEntity.sceneTransform);\r\n\t\t\tthis._matrix.append(camera.inverseSceneTransform);\r\n\t\t\tanimationRegisterCache.setVertexConstFromMatrix(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotateToPositionState.MATRIX_INDEX), this._matrix);\r\n\t\t}\r\n\r\n\t\tif (this._particleRotateToPositionNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tthis._offset = renderable.sourceEntity.inverseSceneTransform.transformVector(this._position);\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._offset.x, this._offset.y, this._offset.z);\r\n\t\t} else\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleRotateToPositionNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleRotateToPositionState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleRotationalVelocityNode\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleRotationalVelocityState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static ROTATIONALVELOCITY_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleRotationalVelocityNode:ParticleRotationalVelocityNode;\r\n\tprivate _rotationalVelocityData:Vector3D;\r\n\tprivate _rotationalVelocity:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default rotationalVelocity of the state, used when in global mode.\r\n\t */\r\n\tpublic get rotationalVelocity():Vector3D\r\n\t{\r\n\t\treturn this._rotationalVelocity;\r\n\t}\r\n\r\n\tpublic set rotationalVelocity(value:Vector3D)\r\n\t{\r\n\t\tthis._rotationalVelocity = value;\r\n\r\n\t\tthis.updateRotationalVelocityData();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getRotationalVelocities():Array<Vector3D>\r\n\t{\r\n\t\treturn this._pDynamicProperties;\r\n\t}\r\n\r\n\tpublic setRotationalVelocities(value:Array<Vector3D>)\r\n\t{\r\n\t\tthis._pDynamicProperties = value;\r\n\r\n\t\tthis._pDynamicPropertiesDirty = new Object();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleRotationNode:ParticleRotationalVelocityNode)\r\n\t{\r\n\t\tsuper(animator, particleRotationNode);\r\n\r\n\t\tthis._particleRotationalVelocityNode = particleRotationNode;\r\n\t\tthis._rotationalVelocity = this._particleRotationalVelocityNode._iRotationalVelocity;\r\n\r\n\t\tthis.updateRotationalVelocityData();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\r\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\r\n\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX);\r\n\r\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._rotationalVelocityData.x, this._rotationalVelocityData.y, this._rotationalVelocityData.z, this._rotationalVelocityData.w);\r\n\t\telse\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleRotationalVelocityNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t}\r\n\r\n\tprivate updateRotationalVelocityData()\r\n\t{\r\n\t\tif (this._particleRotationalVelocityNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._rotationalVelocity.w <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must greater than zero\"));\r\n\t\t\tvar rotation:Vector3D = this._rotationalVelocity.clone();\r\n\r\n\t\t\tif (rotation.length <= 0)\r\n\t\t\t\trotation.z = 1; //set the default direction\r\n\t\t\telse\r\n\t\t\t\trotation.normalize();\r\n\t\t\t// w is used as angle/2 in agal\r\n\t\t\tthis._rotationalVelocityData = new Vector3D(rotation.x, rotation.y, rotation.z, Math.PI/rotation.w);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleRotationalVelocityState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleScaleNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleScaleState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static SCALE_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleScaleNode:ParticleScaleNode;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _minScale:number;\r\n\tprivate _maxScale:number;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _scaleData:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the end scale of the state, when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get minScale():number\r\n\t{\r\n\t\treturn this._minScale;\r\n\t}\r\n\r\n\tpublic set minScale(value:number)\r\n\t{\r\n\t\tthis._minScale = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the end scale of the state, when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get maxScale():number\r\n\t{\r\n\t\treturn this._maxScale;\r\n\t}\r\n\r\n\tpublic set maxScale(value:number)\r\n\t{\r\n\t\tthis._maxScale = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the duration of the animation in seconds, used as a period independent of particle duration when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the phase of the cycle in degrees, used as the starting offset of the cycle when in global mode. Defaults to 0.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleScaleNode:ParticleScaleNode)\r\n\t{\r\n\t\tsuper(animator, particleScaleNode);\r\n\r\n\t\tthis._particleScaleNode = particleScaleNode;\r\n\t\tthis._usesCycle = this._particleScaleNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleScaleNode._iUsesPhase;\r\n\t\tthis._minScale = this._particleScaleNode._iMinScale;\r\n\t\tthis._maxScale = this._particleScaleNode._iMaxScale;\r\n\t\tthis._cycleDuration = this._particleScaleNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleScaleNode._iCyclePhase;\r\n\r\n\t\tthis.updateScaleData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleScaleState.SCALE_INDEX);\r\n\r\n\t\tif (this._particleScaleNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._usesPhase)\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\t\t\t\telse\r\n\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\t} else\r\n\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleScaleNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t} else\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._scaleData.x, this._scaleData.y, this._scaleData.z, this._scaleData.w);\r\n\t}\r\n\r\n\tprivate updateScaleData()\r\n\t{\r\n\t\tif (this._particleScaleNode.mode == ParticlePropertiesMode.GLOBAL) {\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\t\tthis._scaleData = new Vector3D((this._minScale + this._maxScale)/2, Math.abs(this._minScale - this._maxScale)/2, Math.PI*2/this._cycleDuration, this._cyclePhase*Math.PI/180);\r\n\t\t\t} else\r\n\t\t\t\tthis._scaleData = new Vector3D(this._minScale, this._maxScale - this._minScale, 0, 0);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleScaleState;",
    "import ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ColorSegmentPoint\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ColorSegmentPoint\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleSegmentedColorNode\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n *\r\n */\r\nclass ParticleSegmentedColorState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static START_MULTIPLIER_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static START_OFFSET_INDEX:number /*uint*/ = 1;\r\n\r\n\t/** @private */\r\n\tpublic static TIME_DATA_INDEX:number /*uint*/ = 2;\r\n\r\n\tprivate _usesMultiplier:boolean;\r\n\tprivate _usesOffset:boolean;\r\n\tprivate _startColor:ColorTransform;\r\n\tprivate _endColor:ColorTransform;\r\n\tprivate _segmentPoints:Array<ColorSegmentPoint>;\r\n\tprivate _numSegmentPoint:number /*int*/;\r\n\r\n\tprivate _timeLifeData:Array<number>;\r\n\tprivate _multiplierData:Array<number>;\r\n\tprivate _offsetData:Array<number>;\r\n\r\n\t/**\r\n\t * Defines the start color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get startColor():ColorTransform\r\n\t{\r\n\t\treturn this._startColor;\r\n\t}\r\n\r\n\tpublic set startColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._startColor = value;\r\n\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the end color transform of the state, when in global mode.\r\n\t */\r\n\tpublic get endColor():ColorTransform\r\n\t{\r\n\t\treturn this._endColor;\r\n\t}\r\n\r\n\tpublic set endColor(value:ColorTransform)\r\n\t{\r\n\t\tthis._endColor = value;\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the number of segments.\r\n\t */\r\n\tpublic get numSegmentPoint():number /*int*/\r\n\t{\r\n\t\treturn this._numSegmentPoint;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the key points of color\r\n\t */\r\n\tpublic get segmentPoints():Array<ColorSegmentPoint>\r\n\t{\r\n\t\treturn this._segmentPoints;\r\n\t}\r\n\r\n\tpublic set segmentPoints(value:Array<ColorSegmentPoint>)\r\n\t{\r\n\t\tthis._segmentPoints = value;\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tpublic get usesMultiplier():boolean\r\n\t{\r\n\t\treturn this._usesMultiplier;\r\n\t}\r\n\r\n\tpublic get usesOffset():boolean\r\n\t{\r\n\t\treturn this._usesOffset;\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleSegmentedColorNode:ParticleSegmentedColorNode)\r\n\t{\r\n\t\tsuper(animator, particleSegmentedColorNode);\r\n\r\n\t\tthis._usesMultiplier = particleSegmentedColorNode._iUsesMultiplier;\r\n\t\tthis._usesOffset = particleSegmentedColorNode._iUsesOffset;\r\n\t\tthis._startColor = particleSegmentedColorNode._iStartColor;\r\n\t\tthis._endColor = particleSegmentedColorNode._iEndColor;\r\n\t\tthis._segmentPoints = particleSegmentedColorNode._iSegmentPoints;\r\n\t\tthis._numSegmentPoint = particleSegmentedColorNode._iNumSegmentPoint;\r\n\t\tthis.updateColorData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needFragmentAnimation) {\r\n\t\t\tif (this._numSegmentPoint > 0)\r\n\t\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.TIME_DATA_INDEX), this._timeLifeData[0], this._timeLifeData[1], this._timeLifeData[2], this._timeLifeData[3]);\r\n\t\t\tif (this._usesMultiplier)\r\n\t\t\t\tanimationRegisterCache.setVertexConstFromArray(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.START_MULTIPLIER_INDEX), this._multiplierData);\r\n\t\t\tif (this._usesOffset)\r\n\t\t\t\tanimationRegisterCache.setVertexConstFromArray(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSegmentedColorState.START_OFFSET_INDEX), this._offsetData);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateColorData()\r\n\t{\r\n\t\tthis._timeLifeData = new Array<number>();\r\n\t\tthis._multiplierData = new Array<number>();\r\n\t\tthis._offsetData = new Array<number>();\r\n\t\tvar i:number /*int*/;\r\n\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\r\n\t\t\tif (i == 0)\r\n\t\t\t\tthis._timeLifeData.push(this._segmentPoints[i].life);\r\n\t\t\telse\r\n\t\t\t\tthis._timeLifeData.push(this._segmentPoints[i].life - this._segmentPoints[i - 1].life);\r\n\t\t}\r\n\t\tif (this._numSegmentPoint == 0)\r\n\t\t\tthis._timeLifeData.push(1);\r\n\t\telse\r\n\t\t\tthis._timeLifeData.push(1 - this._segmentPoints[i - 1].life);\r\n\r\n\t\tif (this._usesMultiplier) {\r\n\t\t\tthis._multiplierData.push(this._startColor.redMultiplier, this._startColor.greenMultiplier, this._startColor.blueMultiplier, this._startColor.alphaMultiplier);\r\n\t\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\r\n\t\t\t\tif (i == 0)\r\n\t\t\t\t\tthis._multiplierData.push((this._segmentPoints[i].color.redMultiplier - this._startColor.redMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.greenMultiplier - this._startColor.greenMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.blueMultiplier - this._startColor.blueMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.alphaMultiplier - this._startColor.alphaMultiplier)/this._timeLifeData[i]);\r\n\t\t\t\telse\r\n\t\t\t\t\tthis._multiplierData.push((this._segmentPoints[i].color.redMultiplier - this._segmentPoints[i - 1].color.redMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.greenMultiplier - this._segmentPoints[i - 1].color.greenMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.blueMultiplier - this._segmentPoints[i - 1].color.blueMultiplier)/this._timeLifeData[i], (this._segmentPoints[i].color.alphaMultiplier - this._segmentPoints[i - 1].color.alphaMultiplier)/this._timeLifeData[i]);\r\n\t\t\t}\r\n\t\t\tif (this._numSegmentPoint == 0)\r\n\t\t\t\tthis._multiplierData.push(this._endColor.redMultiplier - this._startColor.redMultiplier, this._endColor.greenMultiplier - this._startColor.greenMultiplier, this._endColor.blueMultiplier - this._startColor.blueMultiplier, this._endColor.alphaMultiplier - this._startColor.alphaMultiplier);\r\n\t\t\telse\r\n\t\t\t\tthis._multiplierData.push((this._endColor.redMultiplier - this._segmentPoints[i - 1].color.redMultiplier)/this._timeLifeData[i], (this._endColor.greenMultiplier - this._segmentPoints[i - 1].color.greenMultiplier)/this._timeLifeData[i], (this._endColor.blueMultiplier - this._segmentPoints[i - 1].color.blueMultiplier)/this._timeLifeData[i], (this._endColor.alphaMultiplier - this._segmentPoints[i - 1].color.alphaMultiplier)/this._timeLifeData[i]);\r\n\t\t}\r\n\r\n\t\tif (this._usesOffset) {\r\n\t\t\tthis._offsetData.push(this._startColor.redOffset/255, this._startColor.greenOffset/255, this._startColor.blueOffset/255, this._startColor.alphaOffset/255);\r\n\t\t\tfor (i = 0; i < this._numSegmentPoint; i++) {\r\n\t\t\t\tif (i == 0)\r\n\t\t\t\t\tthis._offsetData.push((this._segmentPoints[i].color.redOffset - this._startColor.redOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.greenOffset - this._startColor.greenOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.blueOffset - this._startColor.blueOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.alphaOffset - this._startColor.alphaOffset)/this._timeLifeData[i]/255);\r\n\t\t\t\telse\r\n\t\t\t\t\tthis._offsetData.push((this._segmentPoints[i].color.redOffset - this._segmentPoints[i - 1].color.redOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.greenOffset - this._segmentPoints[i - 1].color.greenOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.blueOffset - this._segmentPoints[i - 1].color.blueOffset)/this._timeLifeData[i]/255, (this._segmentPoints[i].color.alphaOffset - this._segmentPoints[i - 1].color.alphaOffset)/this._timeLifeData[i]/255);\r\n\t\t\t}\r\n\t\t\tif (this._numSegmentPoint == 0)\r\n\t\t\t\tthis._offsetData.push((this._endColor.redOffset - this._startColor.redOffset)/255, (this._endColor.greenOffset - this._startColor.greenOffset)/255, (this._endColor.blueOffset - this._startColor.blueOffset)/255, (this._endColor.alphaOffset - this._startColor.alphaOffset)/255);\r\n\t\t\telse\r\n\t\t\t\tthis._offsetData.push((this._endColor.redOffset - this._segmentPoints[i - 1].color.redOffset)/this._timeLifeData[i]/255, (this._endColor.greenOffset - this._segmentPoints[i - 1].color.greenOffset)/this._timeLifeData[i]/255, (this._endColor.blueOffset - this._segmentPoints[i - 1].color.blueOffset)/this._timeLifeData[i]/255, (this._endColor.alphaOffset - this._segmentPoints[i - 1].color.alphaOffset)/this._timeLifeData[i]/255);\r\n\t\t}\r\n\t\t//cut off the data\r\n\t\tthis._timeLifeData.length = 4;\r\n\t}\r\n}\r\n\r\nexport = ParticleSegmentedColorState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleSpriteSheetNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleSpriteSheetState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static UV_INDEX_0:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static UV_INDEX_1:number /*uint*/ = 1;\r\n\r\n\tprivate _particleSpriteSheetNode:ParticleSpriteSheetNode;\r\n\tprivate _usesCycle:boolean;\r\n\tprivate _usesPhase:boolean;\r\n\tprivate _totalFrames:number /*int*/;\r\n\tprivate _numColumns:number /*int*/;\r\n\tprivate _numRows:number /*int*/;\r\n\tprivate _cycleDuration:number;\r\n\tprivate _cyclePhase:number;\r\n\tprivate _spriteSheetData:Array<number>;\r\n\r\n\t/**\r\n\t * Defines the cycle phase, when in global mode. Defaults to zero.\r\n\t */\r\n\tpublic get cyclePhase():number\r\n\t{\r\n\t\treturn this._cyclePhase;\r\n\t}\r\n\r\n\tpublic set cyclePhase(value:number)\r\n\t{\r\n\t\tthis._cyclePhase = value;\r\n\r\n\t\tthis.updateSpriteSheetData();\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the cycle duration in seconds, when in global mode. Defaults to 1.\r\n\t */\r\n\tpublic get cycleDuration():number\r\n\t{\r\n\t\treturn this._cycleDuration;\r\n\t}\r\n\r\n\tpublic set cycleDuration(value:number)\r\n\t{\r\n\t\tthis._cycleDuration = value;\r\n\r\n\t\tthis.updateSpriteSheetData();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleSpriteSheetNode:ParticleSpriteSheetNode)\r\n\t{\r\n\t\tsuper(animator, particleSpriteSheetNode);\r\n\r\n\t\tthis._particleSpriteSheetNode = particleSpriteSheetNode;\r\n\r\n\t\tthis._usesCycle = this._particleSpriteSheetNode._iUsesCycle;\r\n\t\tthis._usesPhase = this._particleSpriteSheetNode._iUsesCycle;\r\n\t\tthis._totalFrames = this._particleSpriteSheetNode._iTotalFrames;\r\n\t\tthis._numColumns = this._particleSpriteSheetNode._iNumColumns;\r\n\t\tthis._numRows = this._particleSpriteSheetNode._iNumRows;\r\n\t\tthis._cycleDuration = this._particleSpriteSheetNode._iCycleDuration;\r\n\t\tthis._cyclePhase = this._particleSpriteSheetNode._iCyclePhase;\r\n\r\n\t\tthis.updateSpriteSheetData();\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needUVAnimation) {\r\n\t\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSpriteSheetState.UV_INDEX_0), this._spriteSheetData[0], this._spriteSheetData[1], this._spriteSheetData[2], this._spriteSheetData[3]);\r\n\t\t\tif (this._usesCycle) {\r\n\t\t\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleSpriteSheetState.UV_INDEX_1);\r\n\t\t\t\tif (this._particleSpriteSheetNode.mode == ParticlePropertiesMode.LOCAL_STATIC) {\r\n\t\t\t\t\tif (this._usesPhase)\r\n\t\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleSpriteSheetNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleSpriteSheetNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_2);\r\n\t\t\t\t} else\r\n\t\t\t\t\tanimationRegisterCache.setVertexConst(index, this._spriteSheetData[4], this._spriteSheetData[5]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateSpriteSheetData()\r\n\t{\r\n\t\tthis._spriteSheetData = new Array<number>(8);\r\n\r\n\t\tvar uTotal:number = this._totalFrames/this._numColumns;\r\n\r\n\t\tthis._spriteSheetData[0] = uTotal;\r\n\t\tthis._spriteSheetData[1] = 1/this._numColumns;\r\n\t\tthis._spriteSheetData[2] = 1/this._numRows;\r\n\r\n\t\tif (this._usesCycle) {\r\n\t\t\tif (this._cycleDuration <= 0)\r\n\t\t\t\tthrow(new Error(\"the cycle duration must be greater than zero\"));\r\n\t\t\tthis._spriteSheetData[4] = uTotal/this._cycleDuration;\r\n\t\t\tthis._spriteSheetData[5] = this._cycleDuration;\r\n\t\t\tif (this._usesPhase)\r\n\t\t\t\tthis._spriteSheetData[6] = this._cyclePhase;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ParticleSpriteSheetState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleAnimationData\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleAnimationData\");\r\nimport ParticleNodeBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleStateBase extends AnimationStateBase\r\n{\r\n\tprivate _particleNode:ParticleNodeBase;\r\n\r\n\tpublic _pDynamicProperties:Array<Vector3D> = new Array<Vector3D>();\r\n\tpublic _pDynamicPropertiesDirty:Object = new Object();\r\n\r\n\tpublic _pNeedUpdateTime:boolean;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleNode:ParticleNodeBase, needUpdateTime:boolean = false)\r\n\t{\r\n\t\tsuper(animator, particleNode);\r\n\r\n\t\tthis._particleNode = particleNode;\r\n\t\tthis._pNeedUpdateTime = needUpdateTime;\r\n\t}\r\n\r\n\tpublic get needUpdateTime():boolean\r\n\t{\r\n\t\treturn this._pNeedUpdateTime;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic _pUpdateDynamicProperties(animationSubGeometry:AnimationSubGeometry)\r\n\t{\r\n\t\tthis._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId] = true;\r\n\r\n\t\tvar animationParticles:Array<ParticleAnimationData> = animationSubGeometry.animationParticles;\r\n\t\tvar vertexData:Array<number> = animationSubGeometry.vertexData;\r\n\t\tvar totalLenOfOneVertex:number /*uint*/ = animationSubGeometry.totalLenOfOneVertex;\r\n\t\tvar dataLength:number /*uint*/ = this._particleNode.dataLength;\r\n\t\tvar dataOffset:number /*uint*/ = this._particleNode._iDataOffset;\r\n\t\tvar vertexLength:number /*uint*/;\r\n\t\t//\t\t\tvar particleOffset:number /*uint*/;\r\n\t\tvar startingOffset:number /*uint*/;\r\n\t\tvar vertexOffset:number /*uint*/;\r\n\t\tvar data:Vector3D;\r\n\t\tvar animationParticle:ParticleAnimationData;\r\n\r\n\t\t//\t\t\tvar numParticles:number /*uint*/ = _positions.length/dataLength;\r\n\t\tvar numParticles:number /*uint*/ = this._pDynamicProperties.length;\r\n\t\tvar i:number /*uint*/ = 0;\r\n\t\tvar j:number /*uint*/ = 0;\r\n\t\tvar k:number /*uint*/ = 0;\r\n\r\n\t\t//loop through all particles\r\n\t\twhile (i < numParticles) {\r\n\t\t\t//loop through each particle data for the current particle\r\n\t\t\twhile (j < numParticles && (animationParticle = animationParticles[j]).index == i) {\r\n\t\t\t\tdata = this._pDynamicProperties[i];\r\n\t\t\t\tvertexLength = animationParticle.numVertices*totalLenOfOneVertex;\r\n\t\t\t\tstartingOffset = animationParticle.startVertexIndex*totalLenOfOneVertex + dataOffset;\r\n\t\t\t\t//loop through each vertex in the particle data\r\n\t\t\t\tfor (k = 0; k < vertexLength; k += totalLenOfOneVertex) {\r\n\t\t\t\t\tvertexOffset = startingOffset + k;\r\n\t\t\t\t\t//\t\t\t\t\t\tparticleOffset = i * dataLength;\r\n\t\t\t\t\t//loop through all vertex data for the current particle data\r\n\t\t\t\t\tfor (k = 0; k < vertexLength; k += totalLenOfOneVertex) {\r\n\t\t\t\t\t\tvertexOffset = startingOffset + k;\r\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.x;\r\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.y;\r\n\t\t\t\t\t\tvertexData[vertexOffset++] = data.z;\r\n\r\n\t\t\t\t\t\tif (dataLength == 4)\r\n\t\t\t\t\t\t\tvertexData[vertexOffset++] = data.w;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t//loop through each value in the particle vertex\r\n\t\t\t\t\t\t//\t\t\t\t\t\tswitch(dataLength) {\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t//\t\t\t\t\t\t\t\tvertexData[vertexOffset++] = _positions[particleOffset++];\r\n\t\t\t\t\t\t//\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\tanimationSubGeometry.invalidateBuffer();\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleStateBase;",
    "import Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleTimeNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleTimeState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static TIME_STREAM_INDEX:number /*uint*/ = 0;\r\n\r\n\t/** @private */\r\n\tpublic static TIME_CONSTANT_INDEX:number /*uint*/ = 1;\r\n\r\n\tprivate _particleTimeNode:ParticleTimeNode;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleTimeNode:ParticleTimeNode)\r\n\t{\r\n\t\tsuper(animator, particleTimeNode, true);\r\n\r\n\t\tthis._particleTimeNode = particleTimeNode;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tanimationSubGeometry.activateVertexBuffer(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleTimeState.TIME_STREAM_INDEX), this._particleTimeNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_4);\r\n\r\n\t\tvar particleTime:number = this._pTime/1000;\r\n\t\tanimationRegisterCache.setVertexConst(animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleTimeState.TIME_CONSTANT_INDEX), particleTime, particleTime, particleTime, particleTime);\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleTimeState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticleUVNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleUVNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleUVState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static UV_INDEX:number /*uint*/ = 0;\r\n\r\n\tprivate _particleUVNode:ParticleUVNode;\r\n\r\n\tconstructor(animator:ParticleAnimator, particleUVNode:ParticleUVNode)\r\n\t{\r\n\t\tsuper(animator, particleUVNode);\r\n\r\n\t\tthis._particleUVNode = particleUVNode;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (animationRegisterCache.needUVAnimation) {\r\n\t\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleUVState.UV_INDEX);\r\n\t\t\tvar data:Vector3D = this._particleUVNode._iUvData;\r\n\t\t\tanimationRegisterCache.setVertexConst(index, data.x, data.y);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = ParticleUVState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLVertexBufferFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\n\r\nimport ParticleAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/ParticleAnimator\");\r\nimport AnimationRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport AnimationSubGeometry\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationSubGeometry\");\r\nimport ParticlePropertiesMode\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode\");\r\nimport ParticleVelocityNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode\");\r\nimport ParticleStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ParticleStateBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleVelocityState extends ParticleStateBase\r\n{\r\n\t/** @private */\r\n\tpublic static VELOCITY_INDEX:number /*int*/ = 0;\r\n\r\n\tprivate _particleVelocityNode:ParticleVelocityNode;\r\n\tprivate _velocity:Vector3D;\r\n\r\n\t/**\r\n\t * Defines the default velocity vector of the state, used when in global mode.\r\n\t */\r\n\tpublic get velocity():Vector3D\r\n\t{\r\n\t\treturn this._velocity;\r\n\t}\r\n\r\n\tpublic set velocity(value:Vector3D)\r\n\t{\r\n\t\tthis._velocity = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getVelocities():Array<Vector3D>\r\n\t{\r\n\t\treturn this._pDynamicProperties;\r\n\t}\r\n\r\n\tpublic setVelocities(value:Array<Vector3D>)\r\n\t{\r\n\t\tthis._pDynamicProperties = value;\r\n\r\n\t\tthis._pDynamicPropertiesDirty = new Object();\r\n\t}\r\n\r\n\tconstructor(animator:ParticleAnimator, particleVelocityNode:ParticleVelocityNode)\r\n\t{\r\n\t\tsuper(animator, particleVelocityNode);\r\n\r\n\t\tthis._particleVelocityNode = particleVelocityNode;\r\n\t\tthis._velocity = this._particleVelocityNode._iVelocity;\r\n\t}\r\n\r\n\tpublic setRenderState(stage:Stage, renderable:RenderableBase, animationSubGeometry:AnimationSubGeometry, animationRegisterCache:AnimationRegisterCache, camera:Camera)\r\n\t{\r\n\t\tif (this._particleVelocityNode.mode == ParticlePropertiesMode.LOCAL_DYNAMIC && !this._pDynamicPropertiesDirty[animationSubGeometry._iUniqueId])\r\n\t\t\tthis._pUpdateDynamicProperties(animationSubGeometry);\r\n\r\n\t\tvar index:number /*int*/ = animationRegisterCache.getRegisterIndex(this._pAnimationNode, ParticleVelocityState.VELOCITY_INDEX);\r\n\r\n\t\tif (this._particleVelocityNode.mode == ParticlePropertiesMode.GLOBAL)\r\n\t\t\tanimationRegisterCache.setVertexConst(index, this._velocity.x, this._velocity.y, this._velocity.z);\r\n\t\telse\r\n\t\t\tanimationSubGeometry.activateVertexBuffer(index, this._particleVelocityNode._iDataOffset, stage, ContextGLVertexBufferFormat.FLOAT_3);\r\n\t}\r\n}\r\n\r\nexport = ParticleVelocityState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonBinaryLERPState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _blendWeight:number = 0;\r\n\tprivate _skeletonAnimationNode:SkeletonBinaryLERPNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _inputA:ISkeletonAnimationState;\r\n\tprivate _inputB:ISkeletonAnimationState;\r\n\r\n\t/**\r\n\t * Defines a fractional value between 0 and 1 representing the blending ratio between inputA (0) and inputB (1),\r\n\t * used to produce the skeleton pose output.\r\n\t *\r\n\t * @see inputA\r\n\t * @see inputB\r\n\t */\r\n\tpublic get blendWeight():number\r\n\t{\r\n\t\treturn this._blendWeight;\r\n\t}\r\n\r\n\tpublic set blendWeight(value:number)\r\n\t{\r\n\t\tthis._blendWeight = value;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonBinaryLERPNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tthis._inputA = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.inputA);\r\n\t\tthis._inputB = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.inputB);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tthis._inputA.phase(value);\r\n\t\tthis._inputB.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._inputA.update(time);\r\n\t\tthis._inputB.update(time);\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tvar deltA:Vector3D = this._inputA.positionDelta;\r\n\t\tvar deltB:Vector3D = this._inputB.positionDelta;\r\n\r\n\t\tthis._pRootDelta.x = deltA.x + this._blendWeight*(deltB.x - deltA.x);\r\n\t\tthis._pRootDelta.y = deltA.y + this._blendWeight*(deltB.y - deltA.y);\r\n\t\tthis._pRootDelta.z = deltA.z + this._blendWeight*(deltB.z - deltA.z);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the blendWeight value between input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tvar endPose:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar poses1:Array<JointPose> = this._inputA.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar poses2:Array<JointPose> = this._inputB.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar pose1:JointPose, pose2:JointPose;\r\n\t\tvar p1:Vector3D, p2:Vector3D;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tpose1 = poses1[i];\r\n\t\t\tpose2 = poses2[i];\r\n\t\t\tp1 = pose1.translation;\r\n\t\t\tp2 = pose2.translation;\r\n\r\n\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._blendWeight);\r\n\r\n\t\t\ttr = endPose.translation;\r\n\t\t\ttr.x = p1.x + this._blendWeight*(p2.x - p1.x);\r\n\t\t\ttr.y = p1.y + this._blendWeight*(p2.y - p1.y);\r\n\t\t\ttr.z = p1.z + this._blendWeight*(p2.z - p1.z);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonBinaryLERPState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport AnimationClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationClipState\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonClipState extends AnimationClipState implements ISkeletonAnimationState\r\n{\r\n\tprivate _rootPos:Vector3D = new Vector3D();\r\n\tprivate _frames:Array<SkeletonPose>;\r\n\tprivate _skeletonClipNode:SkeletonClipNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _currentPose:SkeletonPose;\r\n\tprivate _nextPose:SkeletonPose;\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get currentPose():SkeletonPose\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._currentPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the next skeleton pose frame of animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic get nextPose():SkeletonPose\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._nextPose;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonClipNode:SkeletonClipNode)\r\n\t{\r\n\t\tsuper(animator, skeletonClipNode);\r\n\r\n\t\tthis._skeletonClipNode = skeletonClipNode;\r\n\t\tthis._frames = this._skeletonClipNode.frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateFrames()\r\n\t{\r\n\t\tsuper._pUpdateFrames();\r\n\r\n\t\tthis._currentPose = this._frames[this._pCurrentFrame];\r\n\r\n\t\tif (this._skeletonClipNode.looping && this._pNextFrame >= this._skeletonClipNode.lastFrame) {\r\n\t\t\tthis._nextPose = this._frames[0];\r\n\t\t\t(<SkeletonAnimator> this._pAnimator).dispatchCycleEvent();\r\n\t\t} else\r\n\t\t\tthis._nextPose = this._frames[this._pNextFrame];\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the internal playhead position.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tif (!this._skeletonClipNode.totalDuration)\r\n\t\t\treturn;\r\n\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\tvar currentPose:Array<JointPose> = this._currentPose.jointPoses;\r\n\t\tvar nextPose:Array<JointPose> = this._nextPose.jointPoses;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\t\tvar p1:Vector3D, p2:Vector3D;\r\n\t\tvar pose1:JointPose, pose2:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar endPose:JointPose;\r\n\t\tvar tr:Vector3D;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tif ((numJoints != currentPose.length) || (numJoints != nextPose.length))\r\n\t\t\tthrow new Error(\"joint counts don't match!\");\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tpose1 = currentPose[i];\r\n\t\t\tpose2 = nextPose[i];\r\n\t\t\tp1 = pose1.translation;\r\n\t\t\tp2 = pose2.translation;\r\n\r\n\t\t\tif (this._skeletonClipNode.highQuality)\r\n\t\t\t\tendPose.orientation.slerp(pose1.orientation, pose2.orientation, this._pBlendWeight); else\r\n\t\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._pBlendWeight);\r\n\r\n\t\t\tif (i > 0) {\r\n\t\t\t\ttr = endPose.translation;\r\n\t\t\t\ttr.x = p1.x + this._pBlendWeight*(p2.x - p1.x);\r\n\t\t\t\ttr.y = p1.y + this._pBlendWeight*(p2.y - p1.y);\r\n\t\t\t\ttr.z = p1.z + this._pBlendWeight*(p2.z - p1.z);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\tvar p1:Vector3D, p2:Vector3D, p3:Vector3D;\r\n\t\tvar totalDelta:Vector3D = this._skeletonClipNode.totalDelta;\r\n\r\n\t\t// jumping back, need to reset position\r\n\t\tif ((this._pTimeDir > 0 && this._pNextFrame < this._pOldFrame) || (this._pTimeDir < 0 && this._pNextFrame > this._pOldFrame)) {\r\n\t\t\tthis._rootPos.x -= totalDelta.x*this._pTimeDir;\r\n\t\t\tthis._rootPos.y -= totalDelta.y*this._pTimeDir;\r\n\t\t\tthis._rootPos.z -= totalDelta.z*this._pTimeDir;\r\n\t\t}\r\n\r\n\t\tvar dx:number = this._rootPos.x;\r\n\t\tvar dy:number = this._rootPos.y;\r\n\t\tvar dz:number = this._rootPos.z;\r\n\r\n\t\tif (this._skeletonClipNode.stitchFinalFrame && this._pNextFrame == this._skeletonClipNode.lastFrame) {\r\n\t\t\tp1 = this._frames[0].jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[1].jointPoses[0].translation;\r\n\t\t\tp3 = this._currentPose.jointPoses[0].translation;\r\n\r\n\t\t\tthis._rootPos.x = p3.x + p1.x + this._pBlendWeight*(p2.x - p1.x);\r\n\t\t\tthis._rootPos.y = p3.y + p1.y + this._pBlendWeight*(p2.y - p1.y);\r\n\t\t\tthis._rootPos.z = p3.z + p1.z + this._pBlendWeight*(p2.z - p1.z);\r\n\t\t} else {\r\n\t\t\tp1 = this._currentPose.jointPoses[0].translation;\r\n\t\t\tp2 = this._frames[this._pNextFrame].jointPoses[0].translation; //cover the instances where we wrap the pose but still want the final frame translation values\r\n\t\t\tthis._rootPos.x = p1.x + this._pBlendWeight*(p2.x - p1.x);\r\n\t\t\tthis._rootPos.y = p1.y + this._pBlendWeight*(p2.y - p1.y);\r\n\t\t\tthis._rootPos.z = p1.z + this._pBlendWeight*(p2.z - p1.z);\r\n\t\t}\r\n\r\n\t\tthis._pRootDelta.x = this._rootPos.x - dx;\r\n\t\tthis._pRootDelta.y = this._rootPos.y - dy;\r\n\t\tthis._pRootDelta.z = this._rootPos.z - dz;\r\n\r\n\t\tthis._pOldFrame = this._pNextFrame;\r\n\t}\r\n}\r\n\r\nexport = SkeletonClipState;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonDifferenceNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonDifferenceState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _blendWeight:number = 0;\r\n\tprivate static _tempQuat:Quaternion = new Quaternion();\r\n\tprivate _skeletonAnimationNode:SkeletonDifferenceNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _baseInput:ISkeletonAnimationState;\r\n\tprivate _differenceInput:ISkeletonAnimationState;\r\n\r\n\t/**\r\n\t * Defines a fractional value between 0 and 1 representing the blending ratio between the base input (0) and difference input (1),\r\n\t * used to produce the skeleton pose output.\r\n\t *\r\n\t * @see #baseInput\r\n\t * @see #differenceInput\r\n\t */\r\n\tpublic get blendWeight():number\r\n\t{\r\n\t\treturn this._blendWeight;\r\n\t}\r\n\r\n\tpublic set blendWeight(value:number)\r\n\t{\r\n\t\tthis._blendWeight = value;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonDifferenceNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tthis._baseInput = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.baseInput);\r\n\t\tthis._differenceInput = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.differenceInput);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tthis._baseInput.phase(value);\r\n\t\tthis._baseInput.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._baseInput.update(time);\r\n\t\tthis._differenceInput.update(time);\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tvar deltA:Vector3D = this._baseInput.positionDelta;\r\n\t\tvar deltB:Vector3D = this._differenceInput.positionDelta;\r\n\r\n\t\tthis.positionDelta.x = deltA.x + this._blendWeight*deltB.x;\r\n\t\tthis.positionDelta.y = deltA.y + this._blendWeight*deltB.y;\r\n\t\tthis.positionDelta.z = deltA.z + this._blendWeight*deltB.z;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the blendWeight value between base input and difference input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tvar endPose:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar basePoses:Array<JointPose> = this._baseInput.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar diffPoses:Array<JointPose> = this._differenceInput.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar base:JointPose, diff:JointPose;\r\n\t\tvar basePos:Vector3D, diffPos:Vector3D;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tbase = basePoses[i];\r\n\t\t\tdiff = diffPoses[i];\r\n\t\t\tbasePos = base.translation;\r\n\t\t\tdiffPos = diff.translation;\r\n\r\n\t\t\tSkeletonDifferenceState._tempQuat.multiply(diff.orientation, base.orientation);\r\n\t\t\tendPose.orientation.lerp(base.orientation, SkeletonDifferenceState._tempQuat, this._blendWeight);\r\n\r\n\t\t\ttr = endPose.translation;\r\n\t\t\ttr.x = basePos.x + this._blendWeight*diffPos.x;\r\n\t\t\ttr.y = basePos.y + this._blendWeight*diffPos.y;\r\n\t\t\ttr.z = basePos.z + this._blendWeight*diffPos.z;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonDifferenceState;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonDirectionalNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonDirectionalState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _skeletonAnimationNode:SkeletonDirectionalNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _inputA:ISkeletonAnimationState;\r\n\tprivate _inputB:ISkeletonAnimationState;\r\n\tprivate _blendWeight:number = 0;\r\n\tprivate _direction:number = 0;\r\n\tprivate _blendDirty:boolean = true;\r\n\tprivate _forward:ISkeletonAnimationState;\r\n\tprivate _backward:ISkeletonAnimationState;\r\n\tprivate _left:ISkeletonAnimationState;\r\n\tprivate _right:ISkeletonAnimationState;\r\n\r\n\t/**\r\n\t * Defines the direction in degrees of the aniamtion between the forwards (0), right(90) backwards (180) and left(270) input nodes,\r\n\t * used to produce the skeleton pose output.\r\n\t */\r\n\tpublic set direction(value:number)\r\n\t{\r\n\t\tif (this._direction == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._direction = value;\r\n\r\n\t\tthis._blendDirty = true;\r\n\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t}\r\n\r\n\tpublic get direction():number\r\n\t{\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonDirectionalNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tthis._forward = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.forward);\r\n\t\tthis._backward = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.backward);\r\n\t\tthis._left = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.left);\r\n\t\tthis._right = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode.right);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tthis._inputA.phase(value);\r\n\t\tthis._inputB.phase(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUdateTime(time:number /*int*/)\r\n\t{\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._inputA.update(time);\r\n\t\tthis._inputB.update(time);\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tvar deltA:Vector3D = this._inputA.positionDelta;\r\n\t\tvar deltB:Vector3D = this._inputB.positionDelta;\r\n\r\n\t\tthis.positionDelta.x = deltA.x + this._blendWeight*(deltB.x - deltA.x);\r\n\t\tthis.positionDelta.y = deltA.y + this._blendWeight*(deltB.y - deltA.y);\r\n\t\tthis.positionDelta.z = deltA.z + this._blendWeight*(deltB.z - deltA.z);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the direction value between forward, backwards, left and right input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tif (this._blendDirty)\r\n\t\t\tthis.updateBlend();\r\n\r\n\t\tvar endPose:JointPose;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar poses1:Array<JointPose> = this._inputA.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar poses2:Array<JointPose> = this._inputB.getSkeletonPose(skeleton).jointPoses;\r\n\t\tvar pose1:JointPose, pose2:JointPose;\r\n\t\tvar p1:Vector3D, p2:Vector3D;\r\n\t\tvar tr:Vector3D;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < numJoints; ++i) {\r\n\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\tif (endPose == null)\r\n\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\tpose1 = poses1[i];\r\n\t\t\tpose2 = poses2[i];\r\n\t\t\tp1 = pose1.translation;\r\n\t\t\tp2 = pose2.translation;\r\n\r\n\t\t\tendPose.orientation.lerp(pose1.orientation, pose2.orientation, this._blendWeight);\r\n\r\n\t\t\ttr = endPose.translation;\r\n\t\t\ttr.x = p1.x + this._blendWeight*(p2.x - p1.x);\r\n\t\t\ttr.y = p1.y + this._blendWeight*(p2.y - p1.y);\r\n\t\t\ttr.z = p1.z + this._blendWeight*(p2.z - p1.z);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the blend value for the animation output based on the direction value between forward, backwards, left and right input nodes.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tprivate updateBlend()\r\n\t{\r\n\t\tthis._blendDirty = false;\r\n\r\n\t\tif (this._direction < 0 || this._direction > 360) {\r\n\t\t\tthis._direction %= 360;\r\n\t\t\tif (this._direction < 0)\r\n\t\t\t\tthis._direction += 360;\r\n\t\t}\r\n\r\n\t\tif (this._direction < 90) {\r\n\t\t\tthis._inputA = this._forward;\r\n\t\t\tthis._inputB = this._right;\r\n\t\t\tthis._blendWeight = this._direction/90;\r\n\t\t} else if (this._direction < 180) {\r\n\t\t\tthis._inputA = this._right;\r\n\t\t\tthis._inputB = this._backward;\r\n\t\t\tthis._blendWeight = (this._direction - 90)/90;\r\n\t\t} else if (this._direction < 270) {\r\n\t\t\tthis._inputA = this._backward;\r\n\t\t\tthis._inputB = this._left;\r\n\t\t\tthis._blendWeight = (this._direction - 180)/90;\r\n\t\t} else {\r\n\t\t\tthis._inputA = this._left;\r\n\t\t\tthis._inputB = this._forward;\r\n\t\t\tthis._blendWeight = (this._direction - 270)/90;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = SkeletonDirectionalState;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonNaryLERPNode\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode\");\r\nimport AnimationStateBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationStateBase\");\r\nimport ISkeletonAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass SkeletonNaryLERPState extends AnimationStateBase implements ISkeletonAnimationState\r\n{\r\n\tprivate _skeletonAnimationNode:SkeletonNaryLERPNode;\r\n\tprivate _skeletonPose:SkeletonPose = new SkeletonPose();\r\n\tprivate _skeletonPoseDirty:boolean = true;\r\n\tprivate _blendWeights:Array<number> = new Array<number>();\r\n\tprivate _inputs:Array<ISkeletonAnimationState> = new Array<ISkeletonAnimationState>();\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:SkeletonNaryLERPNode)\r\n\t{\r\n\t\tsuper(animator, skeletonAnimationNode);\r\n\r\n\t\tthis._skeletonAnimationNode = skeletonAnimationNode;\r\n\r\n\t\tvar i:number /*uint*/ = this._skeletonAnimationNode.numInputs;\r\n\r\n\t\twhile (i--)\r\n\t\t\tthis._inputs[i] = <ISkeletonAnimationState> animator.getAnimationState(this._skeletonAnimationNode._iInputs[i]);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic phase(value:number)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = true;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tif (this._blendWeights[j])\r\n\t\t\t\tthis._inputs[j].update(value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUdateTime(time:number /*int*/)\r\n\t{\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tif (this._blendWeights[j])\r\n\t\t\t\tthis._inputs[j].update(time);\r\n\t\t}\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the current skeleton pose of the animation in the clip based on the internal playhead position.\r\n\t */\r\n\tpublic getSkeletonPose(skeleton:Skeleton):SkeletonPose\r\n\t{\r\n\t\tif (this._skeletonPoseDirty)\r\n\t\t\tthis.updateSkeletonPose(skeleton);\r\n\r\n\t\treturn this._skeletonPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the blend weight of the skeleton aniamtion node that resides at the given input index.\r\n\t *\r\n\t * @param index The input index for which the skeleton animation node blend weight is requested.\r\n\t */\r\n\tpublic getBlendWeightAt(index:number /*uint*/):number\r\n\t{\r\n\t\treturn this._blendWeights[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the blend weight of the skeleton aniamtion node that resides at the given input index.\r\n\t *\r\n\t * @param index The input index on which the skeleton animation node blend weight is to be set.\r\n\t * @param blendWeight The blend weight value to use for the given skeleton animation node index.\r\n\t */\r\n\tpublic setBlendWeightAt(index:number /*uint*/, blendWeight:number)\r\n\t{\r\n\t\tthis._blendWeights[index] = blendWeight;\r\n\r\n\t\tthis._pPositionDeltaDirty = true;\r\n\t\tthis._skeletonPoseDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\tthis._pPositionDeltaDirty = false;\r\n\r\n\t\tvar delta:Vector3D;\r\n\t\tvar weight:number;\r\n\r\n\t\tthis.positionDelta.x = 0;\r\n\t\tthis.positionDelta.y = 0;\r\n\t\tthis.positionDelta.z = 0;\r\n\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tweight = this._blendWeights[j];\r\n\r\n\t\t\tif (weight) {\r\n\t\t\t\tdelta = this._inputs[j].positionDelta;\r\n\t\t\t\tthis.positionDelta.x += weight*delta.x;\r\n\t\t\t\tthis.positionDelta.y += weight*delta.y;\r\n\t\t\t\tthis.positionDelta.z += weight*delta.z;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the output skeleton pose of the node based on the blend weight values given to the input nodes.\r\n\t *\r\n\t * @param skeleton The skeleton used by the animator requesting the ouput pose.\r\n\t */\r\n\tprivate updateSkeletonPose(skeleton:Skeleton)\r\n\t{\r\n\t\tthis._skeletonPoseDirty = false;\r\n\r\n\t\tvar weight:number;\r\n\t\tvar endPoses:Array<JointPose> = this._skeletonPose.jointPoses;\r\n\t\tvar poses:Array<JointPose>;\r\n\t\tvar endPose:JointPose, pose:JointPose;\r\n\t\tvar endTr:Vector3D, tr:Vector3D;\r\n\t\tvar endQuat:Quaternion, q:Quaternion;\r\n\t\tvar firstPose:Array<JointPose>;\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar w0:number, x0:number, y0:number, z0:number;\r\n\t\tvar w1:number, x1:number, y1:number, z1:number;\r\n\t\tvar numJoints:number /*uint*/ = skeleton.numJoints;\r\n\r\n\t\t// :s\r\n\t\tif (endPoses.length != numJoints)\r\n\t\t\tendPoses.length = numJoints;\r\n\r\n\t\tfor (var j:number /*uint*/ = 0; j < this._skeletonAnimationNode.numInputs; ++j) {\r\n\t\t\tweight = this._blendWeights[j];\r\n\r\n\t\t\tif (!weight)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tposes = this._inputs[j].getSkeletonPose(skeleton).jointPoses;\r\n\r\n\t\t\tif (!firstPose) {\r\n\t\t\t\tfirstPose = poses;\r\n\t\t\t\tfor (i = 0; i < numJoints; ++i) {\r\n\t\t\t\t\tendPose = endPoses[i];\r\n\r\n\t\t\t\t\tif (endPose == null)\r\n\t\t\t\t\t\tendPose = endPoses[i] = new JointPose();\r\n\r\n\t\t\t\t\tpose = poses[i];\r\n\t\t\t\t\tq = pose.orientation;\r\n\t\t\t\t\ttr = pose.translation;\r\n\r\n\t\t\t\t\tendQuat = endPose.orientation;\r\n\r\n\t\t\t\t\tendQuat.x = weight*q.x;\r\n\t\t\t\t\tendQuat.y = weight*q.y;\r\n\t\t\t\t\tendQuat.z = weight*q.z;\r\n\t\t\t\t\tendQuat.w = weight*q.w;\r\n\r\n\t\t\t\t\tendTr = endPose.translation;\r\n\t\t\t\t\tendTr.x = weight*tr.x;\r\n\t\t\t\t\tendTr.y = weight*tr.y;\r\n\t\t\t\t\tendTr.z = weight*tr.z;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor (i = 0; i < skeleton.numJoints; ++i) {\r\n\t\t\t\t\tendPose = endPoses[i];\r\n\t\t\t\t\tpose = poses[i];\r\n\r\n\t\t\t\t\tq = firstPose[i].orientation;\r\n\t\t\t\t\tx0 = q.x;\r\n\t\t\t\t\ty0 = q.y;\r\n\t\t\t\t\tz0 = q.z;\r\n\t\t\t\t\tw0 = q.w;\r\n\r\n\t\t\t\t\tq = pose.orientation;\r\n\t\t\t\t\ttr = pose.translation;\r\n\r\n\t\t\t\t\tx1 = q.x;\r\n\t\t\t\t\ty1 = q.y;\r\n\t\t\t\t\tz1 = q.z;\r\n\t\t\t\t\tw1 = q.w;\r\n\t\t\t\t\t// find shortest direction\r\n\t\t\t\t\tif (x0*x1 + y0*y1 + z0*z1 + w0*w1 < 0) {\r\n\t\t\t\t\t\tx1 = -x1;\r\n\t\t\t\t\t\ty1 = -y1;\r\n\t\t\t\t\t\tz1 = -z1;\r\n\t\t\t\t\t\tw1 = -w1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tendQuat = endPose.orientation;\r\n\t\t\t\t\tendQuat.x += weight*x1;\r\n\t\t\t\t\tendQuat.y += weight*y1;\r\n\t\t\t\t\tendQuat.z += weight*z1;\r\n\t\t\t\t\tendQuat.w += weight*w1;\r\n\r\n\t\t\t\t\tendTr = endPose.translation;\r\n\t\t\t\t\tendTr.x += weight*tr.x;\r\n\t\t\t\t\tendTr.y += weight*tr.y;\r\n\t\t\t\t\tendTr.z += weight*tr.z;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < skeleton.numJoints; ++i)\r\n\t\t\tendPoses[i].orientation.normalize();\r\n\t}\r\n}\r\n\r\nexport = SkeletonNaryLERPState;",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport AnimationClipState\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/AnimationClipState\");\r\nimport IVertexAnimationState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IVertexAnimationState\");\r\n\r\n/**\r\n *\r\n */\r\nclass VertexClipState extends AnimationClipState implements IVertexAnimationState\r\n{\r\n\tprivate _frames:Array<Geometry>;\r\n\tprivate _vertexClipNode:VertexClipNode;\r\n\tprivate _currentGeometry:Geometry;\r\n\tprivate _nextGeometry:Geometry;\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get currentGeometry():Geometry\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._currentGeometry;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get nextGeometry():Geometry\r\n\t{\r\n\t\tif (this._pFramesDirty)\r\n\t\t\tthis._pUpdateFrames();\r\n\r\n\t\treturn this._nextGeometry;\r\n\t}\r\n\r\n\tconstructor(animator:AnimatorBase, vertexClipNode:VertexClipNode)\r\n\t{\r\n\t\tsuper(animator, vertexClipNode);\r\n\r\n\t\tthis._vertexClipNode = vertexClipNode;\r\n\t\tthis._frames = this._vertexClipNode.frames;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateFrames()\r\n\t{\r\n\t\tsuper._pUpdateFrames();\r\n\r\n\t\tthis._currentGeometry = this._frames[this._pCurrentFrame];\r\n\r\n\t\tif (this._vertexClipNode.looping && this._pNextFrame >= this._vertexClipNode.lastFrame) {\r\n\t\t\tthis._nextGeometry = this._frames[0];\r\n\t\t\t(<VertexAnimator> this._pAnimator).dispatchCycleEvent();\r\n\t\t} else\r\n\t\t\tthis._nextGeometry = this._frames[this._pNextFrame];\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdatePositionDelta()\r\n\t{\r\n\t\t//TODO:implement positiondelta functionality for vertex animations\r\n\t}\r\n}\r\n\r\nexport = VertexClipState;",
    "import SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\r\nimport CrossfadeTransitionState\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState\");\r\n\r\n/**\r\n * A skeleton animation node that uses two animation node inputs to blend a lineraly interpolated output of a skeleton pose.\r\n */\r\nclass CrossfadeTransitionNode extends SkeletonBinaryLERPNode\r\n{\r\n\tpublic blendSpeed:number;\r\n\r\n\tpublic startBlend:number /*int*/;\r\n\r\n\t/**\r\n\t * Creates a new <code>CrossfadeTransitionNode</code> object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pStateClass = CrossfadeTransitionState;\r\n\t}\r\n}\r\n\r\nexport = CrossfadeTransitionNode;",
    "import AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport SkeletonBinaryLERPNode\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode\");\r\nimport SkeletonBinaryLERPState\t\t\t= require(\"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState\");\r\nimport CrossfadeTransitionNode\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode\");\r\nimport AnimationStateEvent\t\t\t\t= require(\"awayjs-renderergl/lib/events/AnimationStateEvent\");\r\n\r\n/**\r\n *\r\n */\r\nclass CrossfadeTransitionState extends SkeletonBinaryLERPState\r\n{\r\n\tprivate _crossfadeTransitionNode:CrossfadeTransitionNode;\r\n\tprivate _animationStateTransitionComplete:AnimationStateEvent;\r\n\r\n\tconstructor(animator:AnimatorBase, skeletonAnimationNode:CrossfadeTransitionNode)\r\n\t{\r\n\t\tsuper(animator, <SkeletonBinaryLERPNode> skeletonAnimationNode);\r\n\r\n\t\tthis._crossfadeTransitionNode = skeletonAnimationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateTime(time:number /*int*/)\r\n\t{\r\n\t\tthis.blendWeight = Math.abs(time - this._crossfadeTransitionNode.startBlend)/(1000*this._crossfadeTransitionNode.blendSpeed);\r\n\r\n\t\tif (this.blendWeight >= 1) {\r\n\t\t\tthis.blendWeight = 1;\r\n\r\n\t\t\tif (this._animationStateTransitionComplete == null)\r\n\t\t\t\tthis._animationStateTransitionComplete = new AnimationStateEvent(AnimationStateEvent.TRANSITION_COMPLETE, this._pAnimator, this, this._crossfadeTransitionNode);\r\n\r\n\t\t\tthis._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete);\r\n\t\t}\r\n\r\n\t\tsuper._pUpdateTime(time);\r\n\t}\r\n}\r\n\r\nexport = CrossfadeTransitionState;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport CrossfadeTransitionNode\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode\");\r\nimport IAnimationTransition\t\t\t\t= require(\"awayjs-renderergl/lib/animators/transitions/IAnimationTransition\");\r\n\r\n/**\r\n *\r\n */\r\nclass CrossfadeTransition implements IAnimationTransition\r\n{\r\n\tpublic blendSpeed:number = 0.5;\r\n\r\n\tconstructor(blendSpeed:number)\r\n\t{\r\n\t\tthis.blendSpeed = blendSpeed;\r\n\t}\r\n\r\n\tpublic getAnimationNode(animator:AnimatorBase, startNode:AnimationNodeBase, endNode:AnimationNodeBase, startBlend:number /*int*/):AnimationNodeBase\r\n\t{\r\n\t\tvar crossFadeTransitionNode:CrossfadeTransitionNode = new CrossfadeTransitionNode();\r\n\t\tcrossFadeTransitionNode.inputA = startNode;\r\n\t\tcrossFadeTransitionNode.inputB = endNode;\r\n\t\tcrossFadeTransitionNode.blendSpeed = this.blendSpeed;\r\n\t\tcrossFadeTransitionNode.startBlend = startBlend;\r\n\r\n\t\treturn <AnimationNodeBase> crossFadeTransitionNode;\r\n\t}\r\n}\r\n\r\nexport = CrossfadeTransition;",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\n\r\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\n\r\n/**\r\n * @class away.base.ParticleGeometry\r\n */\r\nclass ParticleGeometry extends Geometry\r\n{\r\n\tpublic particles:Array<ParticleData>;\r\n\r\n\tpublic numParticles:number /*uint*/;\r\n\r\n}\r\n\r\nexport = ParticleGeometry;",
    "import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Plane3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Plane3D\");\r\nimport Point\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\r\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport EntityListItem\t\t\t\t= require(\"awayjs-display/lib/pool/EntityListItem\");\r\nimport IEntitySorter\t\t\t\t= require(\"awayjs-display/lib/sort/IEntitySorter\");\r\nimport RenderableMergeSort\t\t\t= require(\"awayjs-display/lib/sort/RenderableMergeSort\");\r\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\r\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport RendererEvent\t\t\t\t= require(\"awayjs-display/lib/events/RendererEvent\");\r\nimport StageEvent\t\t\t\t\t= require(\"awayjs-display/lib/events/StageEvent\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport EntityCollector\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\nimport CollectorBase\t\t\t\t= require(\"awayjs-display/lib/traverse/CollectorBase\");\r\nimport ShadowCasterCollector\t\t= require(\"awayjs-display/lib/traverse/ShadowCasterCollector\");\r\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\nimport AGALMiniAssembler\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport StageManager\t\t\t\t\t= require(\"awayjs-stagegl/lib/managers/StageManager\");\r\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\r\n\r\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport IRendererPoolClass\t\t\t= require(\"awayjs-renderergl/lib/pool/IRendererPoolClass\");\r\nimport RTTBufferManager\t\t\t\t= require(\"awayjs-renderergl/lib/managers/RTTBufferManager\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\nimport RendererPoolBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RendererPoolBase\");\r\n\r\n\r\n/**\r\n * RendererBase forms an abstract base class for classes that are used in the rendering pipeline to render the\r\n * contents of a partition\r\n *\r\n * @class away.render.RendererBase\r\n */\r\nclass RendererBase extends EventDispatcher\r\n{\r\n\tprivate _numUsedStreams:number = 0;\r\n\tprivate _numUsedTextures:number = 0;\r\n\r\n\tprivate _rendererPool:RendererPoolBase;\r\n\r\n\tpublic _pRendererPoolClass:IRendererPoolClass;\r\n\tpublic _pContext:IContextGL;\r\n\tpublic _pStage:Stage;\r\n\r\n\tpublic _pCamera:Camera;\r\n\tpublic _iEntryPoint:Vector3D;\r\n\tpublic _pCameraForward:Vector3D;\r\n\r\n\tpublic _pRttBufferManager:RTTBufferManager;\r\n\tprivate _viewPort:Rectangle = new Rectangle();\r\n\tprivate _viewportDirty:boolean;\r\n\tprivate _scissorDirty:boolean;\r\n\r\n\tpublic _pBackBufferInvalid:boolean = true;\r\n\tpublic _pDepthTextureInvalid:boolean = true;\r\n\tpublic _depthPrepass:boolean = false;\r\n\tprivate _backgroundR:number = 0;\r\n\tprivate _backgroundG:number = 0;\r\n\tprivate _backgroundB:number = 0;\r\n\tprivate _backgroundAlpha:number = 1;\r\n\tpublic _shareContext:boolean = false;\r\n\r\n\t// only used by renderers that need to render geometry to textures\r\n\tpublic _width:number;\r\n\tpublic _height:number;\r\n\r\n\tpublic textureRatioX:number = 1;\r\n\tpublic textureRatioY:number = 1;\r\n\r\n\tprivate _snapshotBitmapData:BitmapData;\r\n\tprivate _snapshotRequired:boolean;\r\n\r\n\tpublic _pRttViewProjectionMatrix:Matrix3D = new Matrix3D();\r\n\r\n\tprivate _localPos:Point = new Point();\r\n\tprivate _globalPos:Point = new Point();\r\n\tpublic _pScissorRect:Rectangle = new Rectangle();\r\n\r\n\tprivate _scissorUpdated:RendererEvent;\r\n\tprivate _viewPortUpdated:RendererEvent;\r\n\r\n\tprivate _onContextUpdateDelegate:Function;\r\n\tprivate _onViewportUpdatedDelegate;\r\n\r\n\tpublic _pNumTriangles:number = 0;\r\n\r\n\tpublic _pOpaqueRenderableHead:RenderableBase;\r\n\tpublic _pBlendedRenderableHead:RenderableBase;\r\n\tpublic _disableColor:boolean = false;\r\n\tpublic _renderBlended:boolean = true;\r\n\r\n\r\n\tpublic get renderBlended():boolean\r\n\t{\r\n\t\treturn this._renderBlended;\r\n\t}\r\n\r\n\tpublic set renderBlended(value:boolean)\r\n\t{\r\n\t\tthis._renderBlended = value;\r\n\t}\r\n\r\n\r\n\tpublic get disableColor():boolean\r\n\t{\r\n\t\treturn this._disableColor;\r\n\t}\r\n\r\n\tpublic set disableColor(value:boolean)\r\n\t{\r\n\t\tthis._disableColor = value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get numTriangles():number\r\n\t{\r\n\t\treturn this._pNumTriangles;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderableSorter:IEntitySorter;\r\n\r\n\r\n\t/**\r\n\t * A viewPort rectangle equivalent of the Stage size and position.\r\n\t */\r\n\tpublic get viewPort():Rectangle\r\n\t{\r\n\t\treturn this._viewPort;\r\n\t}\r\n\r\n\t/**\r\n\t * A scissor rectangle equivalent of the view size and position.\r\n\t */\r\n\tpublic get scissorRect():Rectangle\r\n\t{\r\n\t\treturn this._pScissorRect;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get x():number\r\n\t{\r\n\t\treturn this._localPos.x;\r\n\t}\r\n\r\n\tpublic set x(value:number)\r\n\t{\r\n\t\tif (this.x == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._globalPos.x = this._localPos.x = value;\r\n\r\n\t\tthis.updateGlobalPos();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get y():number\r\n\t{\r\n\t\treturn this._localPos.y;\r\n\t}\r\n\r\n\tpublic set y(value:number)\r\n\t{\r\n\t\tif (this.y == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._globalPos.y = this._localPos.y = value;\r\n\r\n\t\tthis.updateGlobalPos();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get width():number\r\n\t{\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tpublic set width(value:number)\r\n\t{\r\n\t\tif (this._width == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._width = value;\r\n\t\tthis._pScissorRect.width = value;\r\n\r\n\t\tif (this._pRttBufferManager)\r\n\t\t\tthis._pRttBufferManager.viewWidth = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t\tthis._pDepthTextureInvalid = true;\r\n\r\n\t\tthis.notifyScissorUpdate();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get height():number\r\n\t{\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tpublic set height(value:number)\r\n\t{\r\n\t\tif (this._height == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._height = value;\r\n\t\tthis._pScissorRect.height = value;\r\n\r\n\t\tif (this._pRttBufferManager)\r\n\t\t\tthis._pRttBufferManager.viewHeight = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t\tthis._pDepthTextureInvalid = true;\r\n\r\n\t\tthis.notifyScissorUpdate();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new RendererBase object.\r\n\t */\r\n\tconstructor(rendererPoolClass:IRendererPoolClass = null, stage:Stage = null)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._pRendererPoolClass = rendererPoolClass;\r\n\r\n\t\tthis._onViewportUpdatedDelegate = (event:StageEvent) => this.onViewportUpdated(event)\r\n\t\tthis._onContextUpdateDelegate = (event:Event) => this.onContextUpdate(event);\r\n\r\n\t\t//default sorting algorithm\r\n\t\tthis.renderableSorter = new RenderableMergeSort();\r\n\r\n\t\tthis._rendererPool = (rendererPoolClass)? new this._pRendererPoolClass(this) : new RendererPoolBase(this);\r\n\r\n\t\tthis.stage = stage || StageManager.getInstance().getFreeStage();\r\n\t}\r\n\r\n\tpublic activatePass(renderable:RenderableBase, pass:RenderPassBase, camera:Camera)\r\n\t{\r\n\t\t//clear unused vertex streams\r\n\t\tfor (var i = pass.shader.numUsedStreams; i < this._numUsedStreams; i++)\r\n\t\t\tthis._pContext.setVertexBufferAt(i, null);\r\n\r\n\t\t//clear unused texture streams\r\n\t\tfor (var i = pass.shader.numUsedTextures; i < this._numUsedTextures; i++)\r\n\t\t\tthis._pContext.setTextureAt(i, null);\r\n\r\n\t\t//check program data is uploaded\r\n\t\tvar programData:ProgramData = pass.shader.programData;\r\n\r\n\t\tif (!programData.program) {\r\n\t\t\tprogramData.program = this._pContext.createProgram();\r\n\t\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + programData.vertexString + \"endpart\"))['vertex'].data;\r\n\t\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + programData.fragmentString + \"endpart\"))['fragment'].data;\r\n\t\t\tprogramData.program.upload(vertexByteCode, fragmentByteCode);\r\n\t\t}\r\n\r\n\t\t//set program data\r\n\t\tthis._pContext.setProgram(programData.program);\r\n\r\n\t\t//activate shader object through renderable\r\n\t\trenderable._iActivate(pass, camera);\r\n\t}\r\n\r\n\tpublic deactivatePass(renderable:RenderableBase, pass:RenderPassBase)\r\n\t{\r\n\t\t//deactivate shader object\r\n\t\trenderable._iDeactivate(pass);\r\n\r\n\t\tthis._numUsedStreams = pass.shader.numUsedStreams;\r\n\t\tthis._numUsedTextures = pass.shader.numUsedTextures;\r\n\t}\r\n\r\n\tpublic _iCreateEntityCollector():CollectorBase\r\n\t{\r\n\t\treturn new EntityCollector();\r\n\t}\r\n\r\n\t/**\r\n\t * The background color's red component, used when clearing.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic get _iBackgroundR():number\r\n\t{\r\n\t\treturn this._backgroundR;\r\n\t}\r\n\r\n\tpublic set _iBackgroundR(value:number)\r\n\t{\r\n\t\tif (this._backgroundR == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundR = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/**\r\n\t * The background color's green component, used when clearing.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic get _iBackgroundG():number\r\n\t{\r\n\t\treturn this._backgroundG;\r\n\t}\r\n\r\n\tpublic set _iBackgroundG(value:number)\r\n\t{\r\n\t\tif (this._backgroundG == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundG = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/**\r\n\t * The background color's blue component, used when clearing.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic get _iBackgroundB():number\r\n\t{\r\n\t\treturn this._backgroundB;\r\n\t}\r\n\r\n\tpublic set _iBackgroundB(value:number)\r\n\t{\r\n\t\tif (this._backgroundB == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundB = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\tpublic get context():IContextGL\r\n\t{\r\n\t\treturn this._pContext;\r\n\t}\r\n\r\n\t/**\r\n\t * The Stage that will provide the ContextGL used for rendering.\r\n\t */\r\n\tpublic get stage():Stage\r\n\t{\r\n\t\treturn this._pStage;\r\n\t}\r\n\r\n\tpublic set stage(value:Stage)\r\n\t{\r\n\t\tif (this._pStage == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis.iSetStage(value);\r\n\t}\r\n\r\n\tpublic iSetStage(value:Stage)\r\n\t{\r\n\t\tif (this._pStage)\r\n\t\t\tthis.dispose();\r\n\r\n\t\tif (value) {\r\n\t\t\tthis._pStage = value;\r\n\r\n\t\t\tthis._rendererPool.stage = this._pStage;\r\n\r\n\t\t\tthis._pStage.addEventListener(StageEvent.CONTEXT_CREATED, this._onContextUpdateDelegate);\r\n\t\t\tthis._pStage.addEventListener(StageEvent.CONTEXT_RECREATED, this._onContextUpdateDelegate);\r\n\t\t\tthis._pStage.addEventListener(StageEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\r\n\r\n\t\t\t/*\r\n\t\t\t if (_backgroundImageRenderer)\r\n\t\t\t _backgroundImageRenderer.stage = value;\r\n\t\t\t */\r\n\t\t\tif (this._pStage.context)\r\n\t\t\t\tthis._pContext = <IContextGL> this._pStage.context;\r\n\t\t}\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\r\n\t\tthis.updateGlobalPos();\r\n\t}\r\n\r\n\t/**\r\n\t * Defers control of ContextGL clear() and present() calls to Stage, enabling multiple Stage frameworks\r\n\t * to share the same ContextGL object.\r\n\t */\r\n\tpublic get shareContext():boolean\r\n\t{\r\n\t\treturn this._shareContext;\r\n\t}\r\n\r\n\tpublic set shareContext(value:boolean)\r\n\t{\r\n\t\tif (this._shareContext == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._shareContext = value;\r\n\r\n\t\tthis.updateGlobalPos();\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes the resources used by the RendererBase.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._rendererPool.dispose();\r\n\r\n\t\tthis._pStage.removeEventListener(StageEvent.CONTEXT_CREATED, this._onContextUpdateDelegate);\r\n\t\tthis._pStage.removeEventListener(StageEvent.CONTEXT_RECREATED, this._onContextUpdateDelegate);\r\n\t\tthis._pStage.removeEventListener(StageEvent.VIEWPORT_UPDATED, this._onViewportUpdatedDelegate);\r\n\r\n\t\tthis._pStage = null;\r\n\t\tthis._pContext = null;\r\n\t\t/*\r\n\t\t if (_backgroundImageRenderer) {\r\n\t\t _backgroundImageRenderer.dispose();\r\n\t\t _backgroundImageRenderer = null;\r\n\t\t }\r\n\t\t */\r\n\t}\r\n\r\n\tpublic render(entityCollector:CollectorBase)\r\n\t{\r\n\t\tthis._viewportDirty = false;\r\n\t\tthis._scissorDirty = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the potentially visible geometry to the back buffer or texture.\r\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\r\n\t * @param target An option target texture to render to.\r\n\t * @param surfaceSelector The index of a CubeTexture's face to render to.\r\n\t * @param additionalClearMask Additional clear mask information, in case extra clear channels are to be omitted.\r\n\t */\r\n\tpublic _iRender(entityCollector:CollectorBase, target:TextureProxyBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\r\n\t{\r\n\t\t//TODO refactor setTarget so that rendertextures are created before this check\r\n\t\tif (!this._pStage || !this._pContext)\r\n\t\t\treturn;\r\n\r\n\t\tthis._pRttViewProjectionMatrix.copyFrom(entityCollector.camera.viewProjection);\r\n\t\tthis._pRttViewProjectionMatrix.appendScale(this.textureRatioX, this.textureRatioY, 1);\r\n\r\n\t\tthis.pExecuteRender(entityCollector, target, scissorRect, surfaceSelector);\r\n\r\n\t\t// generate mip maps on target (if target exists) //TODO\r\n\t\t//if (target)\r\n\t\t//\t(<Texture>target).generateMipmaps();\r\n\r\n\t\t// clear buffers\r\n\t\tfor (var i:number = 0; i < 8; ++i) {\r\n\t\t\tthis._pContext.setVertexBufferAt(i, null);\r\n\t\t\tthis._pContext.setTextureAt(i, null);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _iRenderCascades(entityCollector:ShadowCasterCollector, target:TextureProxyBase, numCascades:number, scissorRects:Array<Rectangle>, cameras:Array<Camera>)\r\n\t{\r\n\t\tthis.pCollectRenderables(entityCollector);\r\n\r\n\t\tthis._pStage.setRenderTarget(target, true, 0);\r\n\t\tthis._pContext.clear(1, 1, 1, 1, 1, 0);\r\n\r\n\t\tthis._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\t\tthis._pContext.setDepthTest(true, ContextGLCompareMode.LESS);\r\n\r\n\t\tvar head:RenderableBase = this._pOpaqueRenderableHead;\r\n\r\n\t\tvar first:boolean = true;\r\n\r\n\t\t//TODO cascades must have separate collectors, rather than separate draw commands\r\n\t\tfor (var i:number = numCascades - 1; i >= 0; --i) {\r\n\t\t\tthis._pStage.scissorRect = scissorRects[i];\r\n\t\t\t//this.drawCascadeRenderables(head, cameras[i], first? null : cameras[i].frustumPlanes);\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\t//line required for correct rendering when using away3d with starling. DO NOT REMOVE UNLESS STARLING INTEGRATION IS RETESTED!\r\n\t\tthis._pContext.setDepthTest(false, ContextGLCompareMode.LESS_EQUAL);\r\n\r\n\t\tthis._pStage.scissorRect = null;\r\n\t}\r\n\r\n\tpublic pCollectRenderables(entityCollector:CollectorBase)\r\n\t{\r\n\t\t//reset head values\r\n\t\tthis._pBlendedRenderableHead = null;\r\n\t\tthis._pOpaqueRenderableHead = null;\r\n\t\tthis._pNumTriangles = 0;\r\n\r\n\t\t//grab entity head\r\n\t\tvar item:EntityListItem = entityCollector.entityHead;\r\n\r\n\t\t//set temp values for entry point and camera forward vector\r\n\t\tthis._pCamera = entityCollector.camera;\r\n\t\tthis._iEntryPoint = this._pCamera.scenePosition;\r\n\t\tthis._pCameraForward = this._pCamera.transform.forwardVector;\r\n\r\n\t\t//iterate through all entities\r\n\t\twhile (item) {\r\n\t\t\titem.entity._iCollectRenderables(this._rendererPool);\r\n\t\t\titem = item.next;\r\n\t\t}\r\n\r\n\t\t//sort the resulting renderables\r\n\t\tthis._pOpaqueRenderableHead = <RenderableBase> this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead);\r\n\t\tthis._pBlendedRenderableHead = <RenderableBase> this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead);\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the potentially visible geometry to the back buffer or texture. Only executed if everything is set up.\r\n\t *\r\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\r\n\t * @param target An option target texture to render to.\r\n\t * @param surfaceSelector The index of a CubeTexture's face to render to.\r\n\t * @param additionalClearMask Additional clear mask information, in case extra clear channels are to be omitted.\r\n\t */\r\n\tpublic pExecuteRender(entityCollector:CollectorBase, target:TextureProxyBase = null, scissorRect:Rectangle = null, surfaceSelector:number = 0)\r\n\t{\r\n\t\tthis._pStage.setRenderTarget(target, true, surfaceSelector);\r\n\r\n\t\tif ((target || !this._shareContext) && !this._depthPrepass)\r\n\t\t\tthis._pContext.clear(this._backgroundR, this._backgroundG, this._backgroundB, this._backgroundAlpha, 1, 0);\r\n\r\n\t\tthis._pStage.scissorRect = scissorRect;\r\n\r\n\t\t/*\r\n\t\t if (_backgroundImageRenderer)\r\n\t\t _backgroundImageRenderer.render();\r\n\t\t */\r\n\t\tthis.pCollectRenderables(entityCollector);\r\n\r\n\t\tthis._pContext.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\r\n\t\tthis.pDraw(entityCollector);\r\n\r\n\t\t//line required for correct rendering when using away3d with starling. DO NOT REMOVE UNLESS STARLING INTEGRATION IS RETESTED!\r\n\t\t//this._pContext.setDepthTest(false, ContextGLCompareMode.LESS_EQUAL); //oopsie\r\n\r\n\t\tif (!this._shareContext) {\r\n\t\t\tif (this._snapshotRequired && this._snapshotBitmapData) {\r\n\t\t\t\tthis._pContext.drawToBitmapData(this._snapshotBitmapData);\r\n\t\t\t\tthis._snapshotRequired = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._pStage.scissorRect = null;\r\n\t}\r\n\r\n\t/*\r\n\t * Will draw the renderer's output on next render to the provided bitmap data.\r\n\t * */\r\n\tpublic queueSnapshot(bmd:BitmapData)\r\n\t{\r\n\t\tthis._snapshotRequired = true;\r\n\t\tthis._snapshotBitmapData = bmd;\r\n\t}\r\n\r\n\t/**\r\n\t * Performs the actual drawing of geometry to the target.\r\n\t * @param entityCollector The EntityCollector object containing the potentially visible geometry.\r\n\t */\r\n\tpublic pDraw(entityCollector:CollectorBase)\r\n\t{\r\n\t\tthis._pContext.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);\r\n\r\n\t\tif (this._disableColor)\r\n\t\t\tthis._pContext.setColorMask(false, false, false, false);\r\n\r\n\t\tthis.drawRenderables(this._pOpaqueRenderableHead, entityCollector);\r\n\r\n\t\tif (this._renderBlended)\r\n\t\t\tthis.drawRenderables(this._pBlendedRenderableHead, entityCollector);\r\n\r\n\t\tif (this._disableColor)\r\n\t\t\tthis._pContext.setColorMask(true, true, true, true);\r\n\t}\r\n\r\n\t//private drawCascadeRenderables(renderable:RenderableBase, camera:Camera, cullPlanes:Array<Plane3D>)\r\n\t//{\r\n\t//\tvar renderable2:RenderableBase;\r\n\t//\tvar renderObject:RenderObjectBase;\r\n\t//\tvar pass:RenderPassBase;\r\n\t//\r\n\t//\twhile (renderable) {\r\n\t//\t\trenderable2 = renderable;\r\n\t//\t\trenderObject = renderable.renderObject;\r\n\t//\t\tpass = renderObject.passes[0] //assuming only one pass per material\r\n\t//\r\n\t//\t\tthis.activatePass(renderable, pass, camera);\r\n\t//\r\n\t//\t\tdo {\r\n\t//\t\t\t// if completely in front, it will fall in a different cascade\r\n\t//\t\t\t// do not use near and far planes\r\n\t//\t\t\tif (!cullPlanes || renderable2.sourceEntity.worldBounds.isInFrustum(cullPlanes, 4)) {\r\n\t//\t\t\t\trenderable2._iRender(pass, camera, this._pRttViewProjectionMatrix);\r\n\t//\t\t\t} else {\r\n\t//\t\t\t\trenderable2.cascaded = true;\r\n\t//\t\t\t}\r\n\t//\r\n\t//\t\t\trenderable2 = renderable2.next;\r\n\t//\r\n\t//\t\t} while (renderable2 && renderable2.renderObject == renderObject && !renderable2.cascaded);\r\n\t//\r\n\t//\t\tthis.deactivatePass(renderable, pass);\r\n\t//\r\n\t//\t\trenderable = renderable2;\r\n\t//\t}\r\n\t//}\r\n\r\n\t/**\r\n\t * Draw a list of renderables.\r\n\t *\r\n\t * @param renderables The renderables to draw.\r\n\t * @param entityCollector The EntityCollector containing all potentially visible information.\r\n\t */\r\n\tpublic drawRenderables(renderable:RenderableBase, entityCollector:CollectorBase)\r\n\t{\r\n\t\tvar i:number;\r\n\t\tvar len:number;\r\n\t\tvar renderable2:RenderableBase;\r\n\t\tvar renderObject:RenderObjectBase;\r\n\t\tvar passes:Array<RenderPassBase>;\r\n\t\tvar pass:RenderPassBase;\r\n\t\tvar camera:Camera = entityCollector.camera;\r\n\r\n\r\n\t\twhile (renderable) {\r\n\t\t\trenderObject = renderable.renderObject;\r\n\t\t\tpasses = renderObject.passes;\r\n\r\n\t\t\t// otherwise this would result in depth rendered anyway because fragment shader kil is ignored\r\n\t\t\tif (this._disableColor && renderObject._renderObjectOwner.alphaThreshold != 0) {\r\n\t\t\t\trenderable2 = renderable;\r\n\t\t\t\t// fast forward\r\n\t\t\t\tdo {\r\n\t\t\t\t\trenderable2 = renderable2.next;\r\n\r\n\t\t\t\t} while (renderable2 && renderable2.renderObject == renderObject);\r\n\t\t\t} else {\r\n\t\t\t\t//iterate through each shader object\r\n\t\t\t\tlen = passes.length;\r\n\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\trenderable2 = renderable;\r\n\t\t\t\t\tpass = passes[i];\r\n\r\n\t\t\t\t\tthis.activatePass(renderable, pass, camera);\r\n\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\trenderable2._iRender(pass, camera, this._pRttViewProjectionMatrix);\r\n\r\n\t\t\t\t\t\trenderable2 = renderable2.next;\r\n\r\n\t\t\t\t\t} while (renderable2 && renderable2.renderObject == renderObject);\r\n\r\n\t\t\t\t\tthis.deactivatePass(renderable, pass);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\trenderable = renderable2;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Assign the context once retrieved\r\n\t */\r\n\tprivate onContextUpdate(event:Event)\r\n\t{\r\n\t\tthis._pContext = <IContextGL> this._pStage.context;\r\n\t}\r\n\r\n\tpublic get _iBackgroundAlpha():number\r\n\t{\r\n\t\treturn this._backgroundAlpha;\r\n\t}\r\n\r\n\tpublic set _iBackgroundAlpha(value:number)\r\n\t{\r\n\t\tif (this._backgroundAlpha == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._backgroundAlpha = value;\r\n\r\n\t\tthis._pBackBufferInvalid = true;\r\n\t}\r\n\r\n\t/*\r\n\t public get iBackground():Texture2DBase\r\n\t {\r\n\t return this._background;\r\n\t }\r\n\t */\r\n\r\n\t/*\r\n\t public set iBackground(value:Texture2DBase)\r\n\t {\r\n\t if (this._backgroundImageRenderer && !value) {\r\n\t this._backgroundImageRenderer.dispose();\r\n\t this._backgroundImageRenderer = null;\r\n\t }\r\n\r\n\t if (!this._backgroundImageRenderer && value)\r\n\t {\r\n\r\n\t this._backgroundImageRenderer = new BackgroundImageRenderer(this._pStage);\r\n\r\n\t }\r\n\r\n\r\n\t this._background = value;\r\n\r\n\t if (this._backgroundImageRenderer)\r\n\t this._backgroundImageRenderer.texture = value;\r\n\t }\r\n\t */\r\n\t/*\r\n\t public get backgroundImageRenderer():BackgroundImageRenderer\r\n\t {\r\n\t return _backgroundImageRenderer;\r\n\t }\r\n\t */\r\n\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tprivate notifyScissorUpdate()\r\n\t{\r\n\t\tif (this._scissorDirty)\r\n\t\t\treturn;\r\n\r\n\t\tthis._scissorDirty = true;\r\n\r\n\t\tif (!this._scissorUpdated)\r\n\t\t\tthis._scissorUpdated = new RendererEvent(RendererEvent.SCISSOR_UPDATED);\r\n\r\n\t\tthis.dispatchEvent(this._scissorUpdated);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @private\r\n\t */\r\n\tprivate notifyViewportUpdate()\r\n\t{\r\n\t\tif (this._viewportDirty)\r\n\t\t\treturn;\r\n\r\n\t\tthis._viewportDirty = true;\r\n\r\n\t\tif (!this._viewPortUpdated)\r\n\t\t\tthis._viewPortUpdated = new RendererEvent(RendererEvent.VIEWPORT_UPDATED);\r\n\r\n\t\tthis.dispatchEvent(this._viewPortUpdated);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic onViewportUpdated(event:StageEvent)\r\n\t{\r\n\t\tthis._viewPort = this._pStage.viewPort;\r\n\t\t//TODO stop firing viewport updated for every stagegl viewport change\r\n\r\n\t\tif (this._shareContext) {\r\n\t\t\tthis._pScissorRect.x = this._globalPos.x - this._pStage.x;\r\n\t\t\tthis._pScissorRect.y = this._globalPos.y - this._pStage.y;\r\n\t\t\tthis.notifyScissorUpdate();\r\n\t\t}\r\n\r\n\t\tthis.notifyViewportUpdate();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic updateGlobalPos()\r\n\t{\r\n\t\tif (this._shareContext) {\r\n\t\t\tthis._pScissorRect.x = this._globalPos.x - this._viewPort.x;\r\n\t\t\tthis._pScissorRect.y = this._globalPos.y - this._viewPort.y;\r\n\t\t} else {\r\n\t\t\tthis._pScissorRect.x = 0;\r\n\t\t\tthis._pScissorRect.y = 0;\r\n\t\t\tthis._viewPort.x = this._globalPos.x;\r\n\t\t\tthis._viewPort.y = this._globalPos.y;\r\n\t\t}\r\n\r\n\t\tthis.notifyScissorUpdate();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param renderable\r\n\t * @protected\r\n\t */\r\n\tpublic applyRenderable(renderable:RenderableBase)\r\n\t{\r\n\t\t//set local vars for faster referencing\r\n\t\tvar renderObject:RenderObjectBase = this._pGetRenderObject(renderable, renderable.renderObjectOwner || DefaultMaterialManager.getDefaultMaterial(renderable.renderableOwner));\r\n\r\n\t\trenderable.renderObject = renderObject;\r\n\t\trenderable.renderObjectId = renderObject.renderObjectId;\r\n\t\trenderable.renderOrderId = renderObject.renderOrderId;\r\n\r\n\t\trenderable.cascaded = false;\r\n\r\n\t\tvar entity:IEntity = renderable.sourceEntity;\r\n\t\tvar position:Vector3D = entity.scenePosition;\r\n\r\n\t\t// project onto camera's z-axis\r\n\t\tposition = this._iEntryPoint.subtract(position);\r\n\t\trenderable.zIndex = entity.zOffset + position.dotProduct(this._pCameraForward);\r\n\r\n\t\t//store reference to scene transform\r\n\t\trenderable.renderSceneTransform = renderable.sourceEntity.getRenderSceneTransform(this._pCamera);\r\n\r\n\t\tif (renderObject.requiresBlending) {\r\n\t\t\trenderable.next = this._pBlendedRenderableHead;\r\n\t\t\tthis._pBlendedRenderableHead = renderable;\r\n\t\t} else {\r\n\t\t\trenderable.next = this._pOpaqueRenderableHead;\r\n\t\t\tthis._pOpaqueRenderableHead = renderable;\r\n\t\t}\r\n\r\n\t\tthis._pNumTriangles += renderable.numTriangles;\r\n\r\n\t\t//handle any overflow for renderables with data that exceeds GPU limitations\r\n\t\tif (renderable.overflow)\r\n\t\t\tthis.applyRenderable(renderable.overflow);\r\n\t}\r\n\r\n\tpublic _pGetRenderObject(renderable:RenderableBase, renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n}\r\n\r\nexport = RendererBase;",
    "import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport DepthPass\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/DepthPass\");\r\n\r\n/**\r\n * DepthRenderObject forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass DepthRenderObject extends RenderObjectBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"depth\";\r\n\r\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, renderObjectOwner, renderableClass, stage);\r\n\r\n\t\tthis._pAddScreenPass(new DepthPass(this, renderObjectOwner, renderableClass, this._stage));\r\n\t}\r\n}\r\n\r\nexport = DepthRenderObject;",
    "﻿import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport DistancePass\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/DistancePass\");\r\n\r\n/**\r\n * DistanceRenderObject is a pass that writes distance values to a depth map as a 32-bit value exploded over the 4 texture channels.\r\n * This is used to render omnidirectional shadow maps.\r\n */\r\nclass DistanceRenderObject extends RenderObjectBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"distance\";\r\n\r\n\t/**\r\n\t * Creates a new DistanceRenderObject object.\r\n\t *\r\n\t * @param material The material to which this pass belongs.\r\n\t */\r\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, renderObjectOwner, renderableClass, stage);\r\n\r\n\t\tthis._pAddScreenPass(new DistancePass(this, renderObjectOwner, renderableClass, this._stage));\r\n\t}\r\n}\r\n\r\nexport = DistanceRenderObject;",
    "import ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\n/**\r\n * RegisterPool is used by the shader compilation process to keep track of which registers of a certain type are\r\n * currently used and should not be allowed to be written to. Either entire registers can be requested and locked,\r\n * or single components (x, y, z, w) of a single register.\r\n * It is used by ShaderRegisterCache to track usages of individual register types.\r\n *\r\n * @see away.materials.ShaderRegisterCache\r\n */\r\nclass RegisterPool\r\n{\r\n\tprivate static _regPool:Object = new Object();\r\n\tprivate static _regCompsPool:Object = new Object();\r\n\r\n\tprivate _vectorRegisters:Array<ShaderRegisterElement>;\r\n\tprivate _registerComponents;\r\n\r\n\tprivate _regName:string;\r\n\tprivate _usedSingleCount:Array<Array<number>>;\r\n\tprivate _usedVectorCount:Array<number> /*uint*/;\r\n\tprivate _regCount:number;\r\n\r\n\tprivate _persistent:boolean;\r\n\r\n\t/**\r\n\t * Creates a new RegisterPool object.\r\n\t * @param regName The base name of the register type (\"ft\" for fragment temporaries, \"vc\" for vertex constants, etc)\r\n\t * @param regCount The amount of available registers of this type.\r\n\t * @param persistent Whether or not registers, once reserved, can be freed again. For example, temporaries are not persistent, but constants are.\r\n\t */\r\n\tconstructor(regName:string, regCount:number, persistent:boolean = true)\r\n\t{\r\n\t\tthis._regName = regName;\r\n\t\tthis._regCount = regCount;\r\n\t\tthis._persistent = persistent;\r\n\t\tthis.initRegisters(regName, regCount);\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an entire vector register that's still available.\r\n\t */\r\n\tpublic requestFreeVectorReg():ShaderRegisterElement\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._regCount; ++i) {\r\n\t\t\tif (!this.isRegisterUsed(i)) {\r\n\t\t\t\tif (this._persistent)\r\n\t\t\t\t\tthis._usedVectorCount[i]++;\r\n\r\n\t\t\t\treturn this._vectorRegisters[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthrow new Error(\"Register overflow!\");\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve a single vector component that's still available.\r\n\t */\r\n\tpublic requestFreeRegComponent():ShaderRegisterElement\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._regCount; ++i) {\r\n\t\t\tif (this._usedVectorCount[i] > 0)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tfor (var j:number = 0; j < 4; ++j) {\r\n\t\t\t\tif (this._usedSingleCount[j][i] == 0) {\r\n\t\t\t\t\tif (this._persistent)\r\n\t\t\t\t\t\tthis._usedSingleCount[j][i]++;\r\n\r\n\t\t\t\t\treturn this._registerComponents[j][i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthrow new Error(\"Register overflow!\");\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a register as used, so it cannot be retrieved. The register won't be able to be used until removeUsage\r\n\t * has been called usageCount times again.\r\n\t * @param register The register to mark as used.\r\n\t * @param usageCount The amount of usages to add.\r\n\t */\r\n\tpublic addUsage(register:ShaderRegisterElement, usageCount:number)\r\n\t{\r\n\t\tif (register._component > -1)\r\n\t\t\tthis._usedSingleCount[register._component][register.index] += usageCount;\r\n\t\telse\r\n\t\t\tthis._usedVectorCount[register.index] += usageCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a usage from a register. When usages reach 0, the register is freed again.\r\n\t * @param register The register for which to remove a usage.\r\n\t */\r\n\tpublic removeUsage(register:ShaderRegisterElement)\r\n\t{\r\n\t\tif (register._component > -1) {\r\n\t\t\tif (--this._usedSingleCount[register._component][register.index] < 0)\r\n\t\t\t\tthrow new Error(\"More usages removed than exist!\");\r\n\t\t} else {\r\n\t\t\tif (--this._usedVectorCount[register.index] < 0)\r\n\t\t\t\tthrow new Error(\"More usages removed than exist!\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes any resources used by the current RegisterPool object.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._vectorRegisters = null;\r\n\t\tthis._registerComponents = null;\r\n\t\tthis._usedSingleCount = null;\r\n\t\tthis._usedVectorCount = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not any registers are in use.\r\n\t */\r\n\tpublic hasRegisteredRegs():boolean\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._regCount; ++i)\r\n\t\t\tif (this.isRegisterUsed(i))\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes all registers.\r\n\t */\r\n\tprivate initRegisters(regName:string, regCount:number)\r\n\t{\r\n\t\tvar hash:string = RegisterPool._initPool(regName, regCount);\r\n\r\n\t\tthis._vectorRegisters = RegisterPool._regPool[hash];\r\n\t\tthis._registerComponents = RegisterPool._regCompsPool[hash];\r\n\r\n\t\tthis._usedVectorCount = this._initArray(Array<number>(regCount), 0);\r\n\r\n\t\tthis._usedSingleCount = new Array<Array<number>>(4);\r\n\t\tthis._usedSingleCount[0] = this._initArray(new Array<number>(regCount), 0);\r\n\t\tthis._usedSingleCount[1] = this._initArray(new Array<number>(regCount), 0);\r\n\t\tthis._usedSingleCount[2] = this._initArray(new Array<number>(regCount), 0);\r\n\t\tthis._usedSingleCount[3] = this._initArray(new Array<number>(regCount), 0);\r\n\t}\r\n\r\n\tprivate static _initPool(regName:string, regCount:number):string\r\n\t{\r\n\t\tvar hash:string = regName + regCount;\r\n\r\n\t\tif (RegisterPool._regPool[hash] != undefined)\r\n\t\t\treturn hash;\r\n\r\n\t\tvar vectorRegisters:Array<ShaderRegisterElement> = new Array<ShaderRegisterElement>(regCount);\r\n\t\tRegisterPool._regPool[hash] = vectorRegisters;\r\n\r\n\t\tvar registerComponents = [\r\n\t\t\t[],\r\n\t\t\t[],\r\n\t\t\t[],\r\n\t\t\t[]\r\n\t\t];\r\n\t\tRegisterPool._regCompsPool[hash] = registerComponents;\r\n\r\n\t\tfor (var i:number = 0; i < regCount; ++i) {\r\n\r\n\t\t\tvectorRegisters[i] = new ShaderRegisterElement(regName, i);\r\n\r\n\t\t\tfor (var j:number = 0; j < 4; ++j)\r\n\t\t\t\tregisterComponents[j][i] = new ShaderRegisterElement(regName, i, j);\r\n\t\t}\r\n\r\n\t\treturn hash;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Check if the temp register is either used for single or vector use\r\n\t */\r\n\tprivate isRegisterUsed(index:number):boolean\r\n\t{\r\n\t\tif (this._usedVectorCount[index] > 0)\r\n\t\t\treturn true;\r\n\r\n\t\tfor (var i:number = 0; i < 4; ++i)\r\n\t\t\tif (this._usedSingleCount[i][index] > 0)\r\n\t\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tprivate _initArray(a:Array<any>, val:any):Array<any>\r\n\t{\r\n\t\tvar l:number = a.length;\r\n\r\n\t\tfor (var c:number = 0; c < l; c++)\r\n\t\t\ta[c] = val;\r\n\r\n\t\treturn a;\r\n\t}\r\n}\r\n\r\nexport = RegisterPool;\r\n",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport BasicMaterialPass\t\t\t= require(\"awayjs-renderergl/lib/passes/BasicMaterialPass\");\r\n\r\n/**\r\n * RenderMaterialObject forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass RenderBasicMaterialObject extends RenderObjectBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"basic\";\r\n\r\n\tprivate _material:BasicMaterial;\r\n\tprivate _screenPass:BasicMaterialPass;\r\n\r\n\r\n\tconstructor(pool:RenderObjectPool, material:BasicMaterial, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, material, renderableClass, stage);\r\n\r\n\t\tthis._material = material;\r\n\r\n\t\tthis._pAddScreenPass(this._screenPass = new BasicMaterialPass(this, material, renderableClass, this._stage));\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateRenderObject()\r\n\t{\r\n\t\tsuper._pUpdateRenderObject();\r\n\r\n\t\tthis._pRequiresBlending = (this._material.blendMode != BlendMode.NORMAL || this._material.alphaBlending || (this._material.colorTransform && this._material.colorTransform.alphaMultiplier < 1));\r\n\t\tthis._screenPass.preserveAlpha = this._material.preserveAlpha;//this._pRequiresBlending;\r\n\t\tthis._screenPass.setBlendMode((this._renderObjectOwner.blendMode == BlendMode.NORMAL && this._pRequiresBlending)? BlendMode.LAYER : this._material.blendMode);\r\n\t\t//this._screenPass.forceSeparateMVP = false;\r\n\t}\r\n}\r\n\r\nexport = RenderBasicMaterialObject;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\n\r\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\n\r\n/**\r\n *\r\n * @class away.pool.ScreenPasses\r\n */\r\nclass RenderObjectBase implements IRenderObject\r\n{\r\n\tpublic _forceSeparateMVP:boolean = false;\r\n\r\n\tprivate _pool:RenderObjectPool;\r\n\tpublic _renderObjectOwner:IRenderObjectOwner;\r\n\tpublic _renderableClass:IRenderableClass;\r\n\tpublic _stage:Stage;\r\n\r\n\tprivate _renderOrderId:number;\r\n\tprivate _invalidAnimation:boolean = true;\r\n\tprivate _invalidRenderObject:boolean = true;\r\n\tprivate _passes:Array<RenderPassBase> = new Array<RenderPassBase>();\r\n\r\n\r\n\r\n\tpublic _pRequiresBlending:boolean = false;\r\n\r\n\tprivate _onPassChangeDelegate:(event:Event) => void;\r\n\r\n\tpublic renderObjectId:number;\r\n\r\n\t/**\r\n\t * Indicates whether or not the renderable requires alpha blending during rendering.\r\n\t */\r\n\tpublic get requiresBlending():boolean\r\n\t{\r\n\t\treturn this._pRequiresBlending;\r\n\t}\r\n\r\n\tpublic get renderOrderId():number\r\n\t{\r\n\t\tif (this._invalidAnimation)\r\n\t\t\tthis._updateAnimation();\r\n\r\n\t\treturn this._renderOrderId;\r\n\t}\r\n\r\n\tpublic get passes():Array<RenderPassBase>\r\n\t{\r\n\t\tif (this._invalidAnimation)\r\n\t\t\tthis._updateAnimation();\r\n\r\n\t\treturn this._passes;\r\n\t}\r\n\r\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tthis._pool = pool;\r\n\t\tthis.renderObjectId = renderObjectOwner.id;\r\n\t\tthis._renderObjectOwner = renderObjectOwner;\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._stage = stage;\r\n\r\n\r\n\t\tthis._onPassChangeDelegate = (event:Event) => this.onPassChange(event);\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tthis._renderableClass._iIncludeDependencies(shaderObject);\r\n\r\n\t\tshaderObject.alphaThreshold = this._renderObjectOwner.alphaThreshold;\r\n\t\tshaderObject.useMipmapping = this._renderObjectOwner.mipmap;\r\n\t\tshaderObject.useSmoothTextures = this._renderObjectOwner.smooth;\r\n\r\n\t\tif (this._renderObjectOwner.assetType = AssetType.MATERIAL) {\r\n\t\t\tvar material:MaterialBase = <MaterialBase> this._renderObjectOwner;\r\n\t\t\tshaderObject.useAlphaPremultiplied = material.alphaPremultiplied;\r\n\t\t\tshaderObject.useBothSides = material.bothSides;\r\n\t\t\tshaderObject.repeatTextures = material.repeat;\r\n\t\t\tshaderObject.usesUVTransform = material.animateUVs;\r\n\t\t\tshaderObject.texture = material.texture;\r\n\t\t\tshaderObject.color = material.color;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pClearScreenPasses();\r\n\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; i++)\r\n\t\t\tthis._passes[i].dispose();\r\n\r\n\t\tthis._passes = null;\r\n\r\n\t\tthis._pool.disposeItem(this._renderObjectOwner);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidateRenderObject()\r\n\t{\r\n\t\tthis._invalidRenderObject = true;\r\n\t\tthis._invalidAnimation = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidatePasses()\r\n\t{\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; i++)\r\n\t\t\tthis._passes[i].invalidatePass();\r\n\r\n\t\tthis._invalidAnimation = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidateAnimation()\r\n\t{\r\n\t\tthis._invalidAnimation = true;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param renderObjectOwner\r\n\t */\r\n\tprivate _updateAnimation()\r\n\t{\r\n\t\tif (this._invalidRenderObject)\r\n\t\t\tthis._pUpdateRenderObject();\r\n\r\n\t\tthis._invalidAnimation = false;\r\n\r\n\t\tvar enabledGPUAnimation:boolean = this._getEnabledGPUAnimation();\r\n\r\n\t\tvar renderOrderId = 0;\r\n\t\tvar mult:number = 1;\r\n\t\tvar shaderObject:ShaderObjectBase;\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; i++) {\r\n\t\t\tshaderObject = this._passes[i].shader;\r\n\r\n\t\t\tif (shaderObject.usesAnimation != enabledGPUAnimation) {\r\n\t\t\t\tshaderObject.usesAnimation = enabledGPUAnimation;\r\n\t\t\t\tshaderObject.invalidateProgram();\r\n\t\t\t}\r\n\r\n\t\t\trenderOrderId += shaderObject.programData.id*mult;\r\n\t\t\tmult *= 1000;\r\n\t\t}\r\n\r\n\t\tthis._renderOrderId = renderOrderId;\r\n\t}\r\n\r\n\t/**\r\n\t * Performs any processing that needs to occur before any of its passes are used.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _pUpdateRenderObject()\r\n\t{\r\n\t\tthis._invalidRenderObject = false;\r\n\r\n\t\t//overrride to update shader object properties\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a pass from the renderObjectOwner.\r\n\t * @param pass The pass to be removed.\r\n\t */\r\n\tpublic _pRemoveScreenPass(pass:RenderPassBase)\r\n\t{\r\n\t\tpass.removeEventListener(Event.CHANGE, this._onPassChangeDelegate);\r\n\t\tthis._passes.splice(this._passes.indexOf(pass), 1);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all passes from the renderObjectOwner\r\n\t */\r\n\tpublic _pClearScreenPasses()\r\n\t{\r\n\t\tvar len:number = this._passes.length;\r\n\t\tfor (var i:number = 0; i < len; ++i)\r\n\t\t\tthis._passes[i].removeEventListener(Event.CHANGE, this._onPassChangeDelegate);\r\n\r\n\t\tthis._passes.length = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a pass to the renderObjectOwner\r\n\t * @param pass\r\n\t */\r\n\tpublic _pAddScreenPass(pass:RenderPassBase)\r\n\t{\r\n\t\tthis._passes.push(pass);\r\n\t\tpass.addEventListener(Event.CHANGE, this._onPassChangeDelegate);\r\n\t}\r\n\r\n\t/**\r\n\t * Listener for when a pass's shader code changes. It recalculates the render order id.\r\n\t */\r\n\tprivate onPassChange(event:Event)\r\n\t{\r\n\t\tthis.invalidateAnimation();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * test if animation will be able to run on gpu BEFORE compiling materials\r\n\t * test if the shader objects supports animating the animation set in the vertex shader\r\n\t * if any object using this material fails to support accelerated animations for any of the shader objects,\r\n\t * we should do everything on cpu (otherwise we have the cost of both gpu + cpu animations)\r\n\t */\r\n\tprivate _getEnabledGPUAnimation():boolean\r\n\t{\r\n\t\tif (this._renderObjectOwner.animationSet) {\r\n\t\t\tthis._renderObjectOwner.animationSet.resetGPUCompatibility();\r\n\r\n\t\t\tvar owners:Array<IRenderableOwner> = this._renderObjectOwner.iOwners;\r\n\t\t\tvar numOwners:number = owners.length;\r\n\r\n\t\t\tvar len:number = this._passes.length;\r\n\t\t\tfor (var i:number = 0; i < len; i++)\r\n\t\t\t\tfor (var j:number = 0; j < numOwners; j++)\r\n\t\t\t\t\tif (owners[j].animator)\r\n\t\t\t\t\t\t(<AnimatorBase> owners[j].animator).testGPUCompatibility(this._passes[i].shader);\r\n\r\n\t\t\treturn !this._renderObjectOwner.animationSet.usesCPU;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport = RenderObjectBase;",
    "import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport IRenderObjectClass\t\t\t= require(\"awayjs-renderergl/lib/compilation/IRenderObjectClass\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * @class away.pool.RenderObjectPool\r\n */\r\nclass RenderObjectPool\r\n{\r\n\tprivate _renderObjectPool:Object = new Object();\r\n\tprivate _renderObjectClass:IRenderObjectClass;\r\n\tprivate _renderableClass:IRenderableClass;\r\n\tprivate _stage:Stage;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderObjectClass\r\n\t */\r\n\tconstructor(renderObjectClass:IRenderObjectClass, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tthis._renderObjectClass = renderObjectClass;\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._stage = stage;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableOwner\r\n\t * @returns IRenderable\r\n\t */\r\n\tpublic getItem(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn (this._renderObjectPool[renderObjectOwner.id] || (this._renderObjectPool[renderObjectOwner.id] = renderObjectOwner._iAddRenderObject(new this._renderObjectClass(this, renderObjectOwner, this._renderableClass, this._stage))))\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableOwner\r\n\t */\r\n\tpublic disposeItem(renderObjectOwner:IRenderObjectOwner)\r\n\t{\r\n\t\trenderObjectOwner._iRemoveRenderObject(this._renderObjectPool[renderObjectOwner.id]);\r\n\r\n\t\tthis._renderObjectPool[renderObjectOwner.id] = null;\r\n\t}\r\n}\r\n\r\nexport = RenderObjectPool;",
    "import AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport IRenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderPassBase\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\n\r\n/**\r\n * ShaderCompilerBase is an abstract base class for shader compilers that use modular shader methods to assemble a\r\n * material. Concrete subclasses are used by the default materials.\r\n *\r\n * @see away.materials.ShadingMethodBase\r\n */\r\nclass ShaderCompilerBase\r\n{\r\n\tpublic _pShaderObject:ShaderObjectBase;\r\n\tpublic _pSharedRegisters:ShaderRegisterData;\r\n\tpublic _pRegisterCache:ShaderRegisterCache;\r\n\tpublic _pRenderableClass:IRenderableClass;\r\n\tpublic _pRenderPass:IRenderPassBase;\r\n\r\n\tpublic _pVertexCode:string = ''; // Changed to emtpy string- AwayTS\r\n\tpublic _pFragmentCode:string = '';// Changed to emtpy string - AwayTS\r\n\tpublic _pPostAnimationFragmentCode:string = '';// Changed to emtpy string - AwayTS\r\n\r\n\t//The attributes that need to be animated by animators.\r\n\tpublic _pAnimatableAttributes:Array<string>;\r\n\r\n\t//The target registers for animated properties, written to by the animators.\r\n\tpublic _pAnimationTargetRegisters:Array<string>;\r\n\r\n\t//The target register to place the animated UV coordinate.\r\n\tprivate _uvTarget:string;\r\n\r\n\t//The souce register providing the UV coordinate to animate.\r\n\tprivate _uvSource:string;\r\n\r\n\t/**\r\n\t * Creates a new ShaderCompilerBase object.\r\n\t * @param profile The compatibility profile of the renderer.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, renderPass:IRenderPassBase, shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tthis._pRenderableClass = renderableClass;\r\n\t\tthis._pRenderPass = renderPass;\r\n\t\tthis._pShaderObject = shaderObject;\r\n\r\n\t\tthis._pSharedRegisters = new ShaderRegisterData();\r\n\r\n\t\tthis._pRegisterCache = new ShaderRegisterCache(shaderObject.profile);\r\n\t\tthis._pRegisterCache.vertexAttributesOffset = renderableClass.vertexAttributesOffset;\r\n\t\tthis._pRegisterCache.reset();\r\n\t}\r\n\r\n\t/**\r\n\t * Compiles the code after all setup on the compiler has finished.\r\n\t */\r\n\tpublic compile()\r\n\t{\r\n\t\tthis._pShaderObject.reset();\r\n\r\n\t\tthis.pIncludeDependencies();\r\n\r\n\t\tthis.pInitRegisterIndices();\r\n\r\n\t\tthis.pCompileDependencies();\r\n\r\n\t\t//compile custom vertex & fragment codes\r\n\t\tthis._pVertexCode += this._pRenderPass._iGetVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pPostAnimationFragmentCode += this._pRenderPass._iGetFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t//assign the final output color to the output register\r\n\t\tthis._pPostAnimationFragmentCode += \"mov \" + this._pRegisterCache.fragmentOutputRegister + \", \" + this._pSharedRegisters.shadedTarget + \"\\n\";\r\n\t\tthis._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget);\r\n\r\n\t\t//initialise the required shader constants\r\n\t\tthis._pShaderObject.initConstantData(this._pRegisterCache, this._pAnimatableAttributes, this._pAnimationTargetRegisters, this._uvSource, this._uvTarget);\r\n\t\tthis._pRenderPass._iInitConstantData(this._pShaderObject);\r\n\t}\r\n\r\n\tpublic pIncludeDependencies()\r\n\t{\r\n\t\tthis._pShaderObject._iIncludeDependencies();\r\n\r\n\t\tthis._pShaderObject.outputsNormals = this._pRenderPass._pOutputsNormals(this._pShaderObject);\r\n\t\tthis._pShaderObject.outputsTangentNormals = this._pShaderObject.outputsNormals && this._pRenderPass._pOutputsTangentNormals(this._pShaderObject);\r\n\t\tthis._pShaderObject.usesTangentSpace = this._pShaderObject.outputsTangentNormals && this._pRenderPass._pUsesTangentSpace(this._pShaderObject);\r\n\r\n\t\tif (!this._pShaderObject.usesTangentSpace && this._pShaderObject.viewDirDependencies > 0)\r\n\t\t\tthis._pShaderObject.globalPosDependencies++;\r\n\t}\r\n\r\n\t/**\r\n\t * Compile the code for the methods.\r\n\t */\r\n\tpublic pCompileDependencies()\r\n\t{\r\n\t\tthis._pSharedRegisters.shadedTarget = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget, 1);\r\n\r\n\t\t//compile the world-space position if required\r\n\t\tif (this._pShaderObject.globalPosDependencies > 0)\r\n\t\t\tthis.compileGlobalPositionCode();\r\n\r\n        //compile the local-space position if required\r\n        if (this._pShaderObject.localPosDependencies > 0)\r\n            this.compileLocalPositionCode();\r\n\r\n\t\t//Calculate the (possibly animated) UV coordinates.\r\n\t\tif (this._pShaderObject.uvDependencies > 0)\r\n\t\t\tthis.compileUVCode();\r\n\r\n\t\tif (this._pShaderObject.secondaryUVDependencies > 0)\r\n\t\t\tthis.compileSecondaryUVCode();\r\n\r\n\t\tif (this._pShaderObject.normalDependencies > 0)\r\n\t\t\tthis.compileNormalCode();\r\n\r\n\t\tif (this._pShaderObject.viewDirDependencies > 0)\r\n\t\t\tthis.compileViewDirCode();\r\n\r\n\t\t//collect code from material\r\n\t\tthis._pVertexCode += this._pRenderableClass._iGetVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pFragmentCode += this._pRenderableClass._iGetFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t//collect code from pass\r\n\t\tthis._pVertexCode += this._pRenderPass._iGetPreLightingVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pFragmentCode += this._pRenderPass._iGetPreLightingFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t}\r\n\r\n\tprivate compileGlobalPositionCode()\r\n\t{\r\n\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex = this._pRegisterCache.getFreeVertexVectorTemp(), this._pShaderObject.globalPosDependencies);\r\n\r\n\t\tvar sceneMatrixReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\tthis._pShaderObject.sceneMatrixIndex = sceneMatrixReg.index*4;\r\n\r\n\t\tthis._pVertexCode += \"m44 \" + this._pSharedRegisters.globalPositionVertex + \", \" + this._pSharedRegisters.localPosition + \", \" + sceneMatrixReg + \"\\n\";\r\n\r\n\t\tif (this._pShaderObject.usesGlobalPosFragment) {\r\n\t\t\tthis._pSharedRegisters.globalPositionVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.globalPositionVarying + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\r\n\t\t}\r\n\t}\r\n    private compileLocalPositionCode()\r\n    {\r\n        this._pSharedRegisters.localPositionVarying = this._pRegisterCache.getFreeVarying();\r\n        this._pVertexCode += \"mov \" + this._pSharedRegisters.localPositionVarying + \", \" + this._pSharedRegisters.localPosition + \"\\n\";\r\n    }\r\n\t/**\r\n\t * Calculate the (possibly animated) UV coordinates.\r\n\t */\r\n\tprivate compileUVCode()\r\n\t{\r\n\t\tvar uvAttributeReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\tthis._pShaderObject.uvBufferIndex = uvAttributeReg.index;\r\n\r\n\t\tvar varying:ShaderRegisterElement = this._pRegisterCache.getFreeVarying();\r\n\r\n\t\tthis._pSharedRegisters.uvVarying = varying;\r\n\r\n\t\tif (this._pShaderObject.usesUVTransform) {\r\n\t\t\t// a, b, 0, tx\r\n\t\t\t// c, d, 0, ty\r\n\t\t\tvar uvTransform1:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tvar uvTransform2:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tthis._pShaderObject.uvTransformIndex = uvTransform1.index*4;\r\n\r\n\t\t\tthis._pVertexCode += \"dp4 \" + varying + \".x, \" + uvAttributeReg + \", \" + uvTransform1 + \"\\n\" +\r\n\t\t\t\t\t\t\t\t \"dp4 \" + varying + \".y, \" + uvAttributeReg + \", \" + uvTransform2 + \"\\n\" +\r\n\t\t\t\t\t\t\t\t \"mov \" + varying + \".zw, \" + uvAttributeReg + \".zw \\n\";\r\n\t\t} else {\r\n\t\t\tthis._pShaderObject.uvTransformIndex = -1;\r\n\t\t\tthis._uvTarget = varying.toString();\r\n\t\t\tthis._uvSource = uvAttributeReg.toString();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Provide the secondary UV coordinates.\r\n\t */\r\n\tprivate compileSecondaryUVCode()\r\n\t{\r\n\t\tvar uvAttributeReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\tthis._pShaderObject.secondaryUVBufferIndex = uvAttributeReg.index;\r\n\t\tthis._pSharedRegisters.secondaryUVVarying = this._pRegisterCache.getFreeVarying();\r\n\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.secondaryUVVarying + \", \" + uvAttributeReg + \"\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the view direction.\r\n\t */\r\n\tpublic compileViewDirCode()\r\n\t{\r\n\t\tvar cameraPositionReg:ShaderRegisterElement = this._pRegisterCache.getFreeVertexConstant();\r\n\t\tthis._pSharedRegisters.viewDirVarying = this._pRegisterCache.getFreeVarying();\r\n\t\tthis._pSharedRegisters.viewDirFragment = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment, this._pShaderObject.viewDirDependencies);\r\n\r\n\t\tthis._pShaderObject.cameraPositionIndex = cameraPositionReg.index*4;\r\n\r\n\t\tif (this._pShaderObject.usesTangentSpace) {\r\n\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tthis._pVertexCode += \"sub \" + temp + \", \" + cameraPositionReg + \", \" + this._pSharedRegisters.localPosition + \"\\n\" +\r\n\t\t\t\t\"m33 \" + this._pSharedRegisters.viewDirVarying + \".xyz, \" + temp + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\"mov \" + this._pSharedRegisters.viewDirVarying + \".w, \" + this._pSharedRegisters.localPosition + \".w\\n\";\r\n\t\t} else {\r\n\t\t\tthis._pVertexCode += \"sub \" + this._pSharedRegisters.viewDirVarying + \", \" + cameraPositionReg + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\r\n\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);\r\n\t\t}\r\n\r\n\t\t//TODO is this required in all cases? (re: distancemappass)\r\n\t\tthis._pFragmentCode += \"nrm \" + this._pSharedRegisters.viewDirFragment + \".xyz, \" + this._pSharedRegisters.viewDirVarying + \"\\n\" +\r\n\t\t\t\"mov \" + this._pSharedRegisters.viewDirFragment + \".w,   \" + this._pSharedRegisters.viewDirVarying + \".w\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the normal.\r\n\t */\r\n\tpublic compileNormalCode()\r\n\t{\r\n\t\tthis._pSharedRegisters.normalFragment = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment, this._pShaderObject.normalDependencies);\r\n\r\n\t\t//simple normal aquisition if no tangent space is being used\r\n\t\tif (this._pShaderObject.outputsNormals && !this._pShaderObject.outputsTangentNormals) {\r\n\t\t\tthis._pVertexCode += this._pRenderPass._iGetNormalVertexCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar normalMatrix:Array<ShaderRegisterElement>;\r\n\r\n\t\tif (!this._pShaderObject.outputsNormals || !this._pShaderObject.usesTangentSpace) {\r\n\t\t\tnormalMatrix = new Array<ShaderRegisterElement>(3);\r\n\t\t\tnormalMatrix[0] = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tnormalMatrix[1] = this._pRegisterCache.getFreeVertexConstant();\r\n\t\t\tnormalMatrix[2] = this._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tthis._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\tthis._pShaderObject.sceneNormalMatrixIndex = normalMatrix[0].index*4;\r\n\r\n\t\t\tthis._pSharedRegisters.normalVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t}\r\n\r\n\t\tif (this._pShaderObject.outputsNormals) {\r\n\t\t\tif (this._pShaderObject.usesTangentSpace) {\r\n\t\t\t\t// normalize normal + tangent vector and generate (approximated) bitangent used in m33 operation for view\r\n\t\t\t\tthis._pVertexCode += \"nrm \" + this._pSharedRegisters.animatedNormal + \".xyz, \" + this._pSharedRegisters.animatedNormal + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedTangent + \".xyz, \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"crs \" + this._pSharedRegisters.bitangent + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\";\r\n\r\n\t\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\t} else {\r\n\t\t\t\t//Compiles the vertex shader code for tangent-space normal maps.\r\n\t\t\t\tthis._pSharedRegisters.tangentVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tthis._pSharedRegisters.bitangentVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\r\n\t\t\t\tthis._pVertexCode += \"m33 \" + temp + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedNormal + \".xyz, \" + temp + \"\\n\" +\r\n\t\t\t\t\t\"m33 \" + temp + \".xyz, \" + this._pSharedRegisters.animatedTangent + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + this._pSharedRegisters.animatedTangent + \".xyz, \" + temp + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".x  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".x  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".y  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".y  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".x, \" + this._pSharedRegisters.animatedTangent + \".z  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".z, \" + this._pSharedRegisters.animatedNormal + \".z  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".w, \" + this._pSharedRegisters.normalInput + \".w  \\n\" +\r\n\t\t\t\t\t\"crs \" + temp + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".y, \" + temp + \".x    \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.bitangentVarying + \".y, \" + temp + \".y  \\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".y, \" + temp + \".z    \\n\";\r\n\r\n\t\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);\r\n\r\n\t\t\t\t//Compiles the fragment shader code for tangent-space normal maps.\r\n\t\t\t\tvar t:ShaderRegisterElement;\r\n\t\t\t\tvar b:ShaderRegisterElement;\r\n\t\t\t\tvar n:ShaderRegisterElement;\r\n\r\n\t\t\t\tt = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(t, 1);\r\n\t\t\t\tb = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(b, 1);\r\n\t\t\t\tn = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addFragmentTempUsages(n, 1);\r\n\r\n\t\t\t\tthis._pFragmentCode += \"nrm \" + t + \".xyz, \" + this._pSharedRegisters.tangentVarying + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + t + \".w, \" + this._pSharedRegisters.tangentVarying + \".w\t\\n\" +\r\n\t\t\t\t\t\"nrm \" + b + \".xyz, \" + this._pSharedRegisters.bitangentVarying + \"\\n\" +\r\n\t\t\t\t\t\"nrm \" + n + \".xyz, \" + this._pSharedRegisters.normalVarying + \"\\n\";\r\n\r\n\t\t\t\t//compile custom fragment code for normal calcs\r\n\t\t\t\tthis._pFragmentCode += this._pRenderPass._iGetNormalFragmentCode(this._pShaderObject, this._pRegisterCache, this._pSharedRegisters) +\r\n\t\t\t\t\t\"m33 \" + this._pSharedRegisters.normalFragment + \".xyz, \" + this._pSharedRegisters.normalFragment + \", \" + t + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.normalFragment + \".w, \" + this._pSharedRegisters.normalVarying + \".w\\n\";\r\n\r\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(b);\r\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(t);\r\n\t\t\t\tthis._pRegisterCache.removeFragmentTempUsage(n);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// no output, world space is enough\r\n\t\t\tthis._pVertexCode += \"m33 \" + this._pSharedRegisters.normalVarying + \".xyz, \" + this._pSharedRegisters.animatedNormal + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\"mov \" + this._pSharedRegisters.normalVarying + \".w, \" + this._pSharedRegisters.animatedNormal + \".w\\n\";\r\n\r\n\t\t\tthis._pFragmentCode += \"nrm \" + this._pSharedRegisters.normalFragment + \".xyz, \" + this._pSharedRegisters.normalVarying + \"\\n\" +\r\n\t\t\t\t\"mov \" + this._pSharedRegisters.normalFragment + \".w, \" + this._pSharedRegisters.normalVarying + \".w\\n\";\r\n\r\n\t\t\tif (this._pShaderObject.tangentDependencies > 0) {\r\n\t\t\t\tthis._pSharedRegisters.tangentVarying = this._pRegisterCache.getFreeVarying();\r\n\r\n\t\t\t\tthis._pVertexCode += \"m33 \" + this._pSharedRegisters.tangentVarying + \".xyz, \" + this._pSharedRegisters.animatedTangent + \", \" + normalMatrix[0] + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + this._pSharedRegisters.tangentVarying + \".w, \" + this._pSharedRegisters.animatedTangent + \".w\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this._pShaderObject.usesTangentSpace)\r\n\t\t\tthis._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal);\r\n\t}\r\n\r\n\t/**\r\n\t * Reset all the indices to \"unused\".\r\n\t */\r\n\tpublic pInitRegisterIndices()\r\n\t{\r\n\t\tthis._pShaderObject.pInitRegisterIndices();\r\n\r\n\t\tthis._pAnimatableAttributes = new Array<string>(\"va0\");\r\n\t\tthis._pAnimationTargetRegisters = new Array<string>(\"vt0\");\r\n\t\tthis._pVertexCode = \"\";\r\n\t\tthis._pFragmentCode = \"\";\r\n\t\tthis._pPostAnimationFragmentCode = \"\";\r\n\r\n\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition = this._pRegisterCache.getFreeVertexVectorTemp(), 1);\r\n\r\n\t\t//create commonly shared constant registers\r\n\t\tthis._pSharedRegisters.commons = this._pRegisterCache.getFreeFragmentConstant();\r\n\t\tthis._pShaderObject.commonsDataIndex = this._pSharedRegisters.commons.index*4;\r\n\r\n\t\t//Creates the registers to contain the tangent data.\r\n\t\t// need to be created FIRST and in this order (for when using tangent space)\r\n\t\tif (this._pShaderObject.tangentDependencies > 0 || this._pShaderObject.outputsNormals) {\r\n\t\t\tthis._pSharedRegisters.tangentInput = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\t\tthis._pShaderObject.tangentBufferIndex = this._pSharedRegisters.tangentInput.index;\r\n\r\n\t\t\tthis._pSharedRegisters.animatedTangent = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent, 1);\r\n\r\n\t\t\tif (this._pShaderObject.usesTangentSpace) {\r\n\t\t\t\tthis._pSharedRegisters.bitangent = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent, 1);\r\n\t\t\t}\r\n\r\n\t\t\tthis._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString());\r\n\t\t\tthis._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString());\r\n\t\t}\r\n\r\n\t\tif (this._pShaderObject.normalDependencies > 0) {\r\n\t\t\tthis._pSharedRegisters.normalInput = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\t\tthis._pShaderObject.normalBufferIndex = this._pSharedRegisters.normalInput.index;\r\n\r\n\t\t\tthis._pSharedRegisters.animatedNormal = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\tthis._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal, 1);\r\n\r\n\t\t\tthis._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString());\r\n\t\t\tthis._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString());\r\n\t\t}\r\n\r\n\t\tif (this._pShaderObject.colorDependencies > 0) {\r\n\t\t\tthis._pSharedRegisters.colorInput = this._pRegisterCache.getFreeVertexAttribute();\r\n\t\t\tthis._pShaderObject.colorBufferIndex = this._pSharedRegisters.colorInput.index;\r\n\r\n\t\t\tthis._pSharedRegisters.colorVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\tthis._pVertexCode += \"mov \" + this._pSharedRegisters.colorVarying + \", \" + this._pSharedRegisters.colorInput + \"\\n\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes all resources used by the compiler.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pRegisterCache.dispose();\r\n\t\tthis._pRegisterCache = null;\r\n\t\tthis._pSharedRegisters = null;\r\n\t}\r\n\r\n\t/**\r\n\t * The generated vertex code.\r\n\t */\r\n\tpublic get vertexCode():string\r\n\t{\r\n\t\treturn this._pVertexCode;\r\n\t}\r\n\r\n\t/**\r\n\t * The generated fragment code.\r\n\t */\r\n\tpublic get fragmentCode():string\r\n\t{\r\n\t\treturn this._pFragmentCode;\r\n\t}\r\n\r\n\t/**\r\n\t * The generated fragment code.\r\n\t */\r\n\tpublic get postAnimationFragmentCode():string\r\n\t{\r\n\t\treturn this._pPostAnimationFragmentCode;\r\n\t}\r\n\r\n\t/**\r\n\t * The register name containing the final shaded colour.\r\n\t */\r\n\tpublic get shadedTarget():string\r\n\t{\r\n\t\treturn this._pSharedRegisters.shadedTarget.toString();\r\n\t}\r\n}\r\n\r\nexport = ShaderCompilerBase;",
    "import ContextGLProfile\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProfile\");\r\n\r\nimport ShaderLightingObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingObject\");\r\nimport ShaderCompilerBase\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderCompilerBase\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport IRenderLightingPass\t\t= require(\"awayjs-renderergl/lib/passes/IRenderLightingPass\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\n\r\n/**\r\n * ShaderCompilerBase is an abstract base class for shader compilers that use modular shader methods to assemble a\r\n * material. Concrete subclasses are used by the default materials.\r\n *\r\n * @see away.materials.ShadingMethodBase\r\n */\r\nclass ShaderLightingCompiler extends ShaderCompilerBase\r\n{\r\n\tprivate _shaderLightingObject:ShaderLightingObject;\r\n\tprivate _renderLightingPass:IRenderLightingPass;\r\n\tpublic _pointLightFragmentConstants:Array<ShaderRegisterElement>;\r\n\tpublic _pointLightVertexConstants:Array<ShaderRegisterElement>;\r\n\tpublic _dirLightFragmentConstants:Array<ShaderRegisterElement>;\r\n\tpublic _dirLightVertexConstants:Array<ShaderRegisterElement>;\r\n\r\n\tpublic _pNumProbeRegisters:number;\r\n\r\n\t/**\r\n\t * Creates a new ShaderCompilerBase object.\r\n\t * @param profile The compatibility profile of the renderer.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, renderLightingPass:IRenderLightingPass, shaderLightingObject:ShaderLightingObject)\r\n\t{\r\n\t\tsuper(renderableClass, renderLightingPass, shaderLightingObject);\r\n\r\n\t\tthis._shaderLightingObject = shaderLightingObject;\r\n\t\tthis._renderLightingPass = renderLightingPass;\r\n\t}\r\n\r\n\t/**\r\n\t * Compile the code for the methods.\r\n\t */\r\n\tpublic pCompileDependencies()\r\n\t{\r\n\t\tsuper.pCompileDependencies();\r\n\r\n\t\t//compile the lighting code\r\n\t\tif (this._shaderLightingObject.usesShadows)\r\n\t\t\tthis.pCompileShadowCode();\r\n\r\n\t\tif (this._shaderLightingObject.usesLights) {\r\n\t\t\tthis.initLightRegisters();\r\n\t\t\tthis.compileLightCode();\r\n\t\t}\r\n\r\n\t\tif (this._shaderLightingObject.usesProbes)\r\n\t\t\tthis.compileLightProbeCode();\r\n\r\n\t\tthis._pVertexCode += this._renderLightingPass._iGetPostLightingVertexCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t\tthis._pFragmentCode += this._renderLightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject, this._pRegisterCache, this._pSharedRegisters);\r\n\t}\r\n\r\n\t/**\r\n\t * Provides the code to provide shadow mapping.\r\n\t */\r\n\tpublic pCompileShadowCode()\r\n\t{\r\n\t\tif (this._shaderLightingObject.normalDependencies > 0) {\r\n\t\t\tthis._pSharedRegisters.shadowTarget = this._pSharedRegisters.normalFragment;\r\n\t\t} else {\r\n\t\t\tthis._pSharedRegisters.shadowTarget = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\tthis._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget, 1);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes constant registers to contain light data.\r\n\t */\r\n\tprivate initLightRegisters()\r\n\t{\r\n\t\t// init these first so we're sure they're in sequence\r\n\t\tvar i:number, len:number;\r\n\r\n\t\tif (this._dirLightVertexConstants) {\r\n\t\t\tlen = this._dirLightVertexConstants.length;\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tthis._dirLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\t\tif (this._shaderLightingObject.lightVertexConstantIndex == -1)\r\n\t\t\t\t\tthis._shaderLightingObject.lightVertexConstantIndex = this._dirLightVertexConstants[i].index*4;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._pointLightVertexConstants) {\r\n\t\t\tlen = this._pointLightVertexConstants.length;\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tthis._pointLightVertexConstants[i] = this._pRegisterCache.getFreeVertexConstant();\r\n\r\n\t\t\t\tif (this._shaderLightingObject.lightVertexConstantIndex == -1)\r\n\t\t\t\t\tthis._shaderLightingObject.lightVertexConstantIndex = this._pointLightVertexConstants[i].index*4;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlen = this._dirLightFragmentConstants.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._dirLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();\r\n\r\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\r\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = this._dirLightFragmentConstants[i].index*4;\r\n\t\t}\r\n\r\n\t\tlen = this._pointLightFragmentConstants.length;\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._pointLightFragmentConstants[i] = this._pRegisterCache.getFreeFragmentConstant();\r\n\r\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\r\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = this._pointLightFragmentConstants[i].index*4;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Compiles the shading code for directional and point lights.\r\n\t */\r\n\tprivate compileLightCode()\r\n\t{\r\n\t\tvar diffuseColorReg:ShaderRegisterElement;\r\n\t\tvar specularColorReg:ShaderRegisterElement;\r\n\t\tvar lightPosReg:ShaderRegisterElement;\r\n\t\tvar lightDirReg:ShaderRegisterElement;\r\n\t\tvar vertexRegIndex:number = 0;\r\n\t\tvar fragmentRegIndex:number = 0;\r\n\t\tvar addSpec:boolean = this._shaderLightingObject.usesLightsForSpecular;\r\n\t\tvar addDiff:boolean = this._shaderLightingObject.usesLightsForDiffuse;\r\n\r\n\t\t//compile the shading code for directional lights.\r\n\t\tfor (var i:number = 0; i < this._shaderLightingObject.numDirectionalLights; ++i) {\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace) {\r\n\t\t\t\tlightDirReg = this._dirLightVertexConstants[vertexRegIndex++];\r\n\r\n\t\t\t\tvar lightVarying:ShaderRegisterElement = this._pRegisterCache.getFreeVarying();\r\n\r\n\t\t\t\tthis._pVertexCode += \"m33 \" + lightVarying + \".xyz, \" + lightDirReg + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightVarying + \".w, \" + lightDirReg + \".w\\n\";\r\n\r\n\t\t\t\tlightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\t\tthis._pRegisterCache.addVertexTempUsages(lightDirReg, 1);\r\n\r\n\t\t\t\tthis._pFragmentCode += \"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightDirReg + \".w, \" + lightVarying + \".w\\n\";\r\n\r\n\t\t\t} else {\r\n\t\t\t\tlightDirReg = this._dirLightFragmentConstants[fragmentRegIndex++];\r\n\t\t\t}\r\n\r\n\t\t\tdiffuseColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];\r\n\t\t\tspecularColorReg = this._dirLightFragmentConstants[fragmentRegIndex++];\r\n\r\n\t\t\tif (addDiff)\r\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tif (addSpec)\r\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace)\r\n\t\t\t\tthis._pRegisterCache.removeVertexTempUsage(lightDirReg);\r\n\t\t}\r\n\r\n\t\tvertexRegIndex = 0;\r\n\t\tfragmentRegIndex = 0;\r\n\r\n\t\t//compile the shading code for point lights\r\n\t\tfor (var i:number = 0; i < this._shaderLightingObject.numPointLights; ++i) {\r\n\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment)\r\n\t\t\t\tlightPosReg = this._pointLightVertexConstants[vertexRegIndex++];\r\n\t\t\telse\r\n\t\t\t\tlightPosReg = this._pointLightFragmentConstants[fragmentRegIndex++];\r\n\r\n\t\t\tdiffuseColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];\r\n\t\t\tspecularColorReg = this._pointLightFragmentConstants[fragmentRegIndex++];\r\n\r\n\t\t\tlightDirReg = this._pRegisterCache.getFreeFragmentVectorTemp();\r\n\t\t\tthis._pRegisterCache.addFragmentTempUsages(lightDirReg, 1);\r\n\r\n\t\t\tvar lightVarying:ShaderRegisterElement;\r\n\r\n\t\t\tif (this._shaderLightingObject.usesTangentSpace) {\r\n\t\t\t\tlightVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tvar temp:ShaderRegisterElement = this._pRegisterCache.getFreeVertexVectorTemp();\r\n\t\t\t\tthis._pVertexCode += \"sub \" + temp + \", \" + lightPosReg + \", \" + this._pSharedRegisters.localPosition + \"\\n\" +\r\n\t\t\t\t\t\"m33 \" + lightVarying + \".xyz, \" + temp + \", \" + this._pSharedRegisters.animatedTangent + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightVarying + \".w, \" + this._pSharedRegisters.localPosition + \".w\\n\";\r\n\t\t\t} else if (!this._shaderLightingObject.usesGlobalPosFragment) {\r\n\t\t\t\tlightVarying = this._pRegisterCache.getFreeVarying();\r\n\t\t\t\tthis._pVertexCode += \"sub \" + lightVarying + \", \" + lightPosReg + \", \" + this._pSharedRegisters.globalPositionVertex + \"\\n\";\r\n\t\t\t} else {\r\n\t\t\t\tlightVarying = lightDirReg;\r\n\t\t\t\tthis._pFragmentCode += \"sub \" + lightDirReg + \", \" + lightPosReg + \", \" + this._pSharedRegisters.globalPositionVarying + \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._shaderLightingObject.usesLightFallOff) {\r\n\t\t\t\t// calculate attenuation\r\n\t\t\t\tthis._pFragmentCode += // attenuate\r\n\t\t\t\t\t\"dp3 \" + lightDirReg + \".w, \" + lightVarying + \", \" + lightVarying + \"\\n\" + // w = d - radius\r\n\t\t\t\t\t\"sub \" + lightDirReg + \".w, \" + lightDirReg + \".w, \" + diffuseColorReg + \".w\\n\" + // w = (d - radius)/(max-min)\r\n\t\t\t\t\t\"mul \" + lightDirReg + \".w, \" + lightDirReg + \".w, \" + specularColorReg + \".w\\n\" + // w = clamp(w, 0, 1)\r\n\t\t\t\t\t\"sat \" + lightDirReg + \".w, \" + lightDirReg + \".w\\n\" + // w = 1-w\r\n\t\t\t\t\t\"sub \" + lightDirReg + \".w, \" + this._pSharedRegisters.commons + \".w, \" + lightDirReg + \".w\\n\" + // normalize\r\n\t\t\t\t\t\"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._pFragmentCode += \"nrm \" + lightDirReg + \".xyz, \" + lightVarying + \"\\n\" +\r\n\t\t\t\t\t\"mov \" + lightDirReg + \".w, \" + lightVarying + \".w\\n\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._shaderLightingObject.lightFragmentConstantIndex == -1)\r\n\t\t\t\tthis._shaderLightingObject.lightFragmentConstantIndex = lightPosReg.index*4;\r\n\r\n\t\t\tif (addDiff)\r\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject, lightDirReg, diffuseColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tif (addSpec)\r\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject, lightDirReg, specularColorReg, this._pRegisterCache, this._pSharedRegisters);\r\n\r\n\t\t\tthis._pRegisterCache.removeFragmentTempUsage(lightDirReg);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Compiles shading code for light probes.\r\n\t */\r\n\tprivate compileLightProbeCode()\r\n\t{\r\n\t\tvar weightReg:string;\r\n\t\tvar weightComponents = [ \".x\", \".y\", \".z\", \".w\" ];\r\n\t\tvar weightRegisters:Array<ShaderRegisterElement> = new Array<ShaderRegisterElement>();\r\n\t\tvar i:number;\r\n\t\tvar texReg:ShaderRegisterElement;\r\n\t\tvar addSpec:boolean = this._shaderLightingObject.usesProbesForSpecular;\r\n\t\tvar addDiff:boolean = this._shaderLightingObject.usesProbesForDiffuse;\r\n\r\n\t\tif (addDiff)\r\n\t\t\tthis._shaderLightingObject.lightProbeDiffuseIndices = new Array<number>();\r\n\r\n\t\tif (addSpec)\r\n\t\t\tthis._shaderLightingObject.lightProbeSpecularIndices = new Array<number>();\r\n\r\n\t\tfor (i = 0; i < this._pNumProbeRegisters; ++i) {\r\n\t\t\tweightRegisters[i] = this._pRegisterCache.getFreeFragmentConstant();\r\n\r\n\t\t\tif (i == 0)\r\n\t\t\t\tthis._shaderLightingObject.probeWeightsIndex = weightRegisters[i].index*4;\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < this._shaderLightingObject.numLightProbes; ++i) {\r\n\t\t\tweightReg = weightRegisters[Math.floor(i/4)].toString() + weightComponents[i%4];\r\n\r\n\t\t\tif (addDiff) {\r\n\t\t\t\ttexReg = this._pRegisterCache.getFreeTextureReg();\r\n\t\t\t\tthis._shaderLightingObject.lightProbeDiffuseIndices[i] = texReg.index;\r\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\t}\r\n\r\n\t\t\tif (addSpec) {\r\n\t\t\t\ttexReg = this._pRegisterCache.getFreeTextureReg();\r\n\t\t\t\tthis._shaderLightingObject.lightProbeSpecularIndices[i] = texReg.index;\r\n\t\t\t\tthis._pFragmentCode += this._renderLightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject, texReg, weightReg, this._pRegisterCache, this._pSharedRegisters);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reset all the indices to \"unused\".\r\n\t */\r\n\tpublic pInitRegisterIndices()\r\n\t{\r\n\t\tsuper.pInitRegisterIndices();\r\n\r\n\t\tthis._shaderLightingObject.lightVertexConstantIndex = -1;\r\n\t\tthis._shaderLightingObject.lightFragmentConstantIndex = -1;\r\n\t\tthis._shaderLightingObject.probeWeightsIndex = -1;\r\n\r\n\t\tthis._pNumProbeRegisters = Math.ceil(this._shaderLightingObject.numLightProbes/4);\r\n\r\n\t\t//init light data\r\n\t\tif (this._shaderLightingObject.usesTangentSpace || !this._shaderLightingObject.usesGlobalPosFragment) {\r\n\t\t\tthis._pointLightVertexConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights);\r\n\t\t\tthis._pointLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights*2);\r\n\t\t} else {\r\n\t\t\tthis._pointLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numPointLights*3);\r\n\t\t}\r\n\r\n\t\tif (this._shaderLightingObject.usesTangentSpace) {\r\n\t\t\tthis._dirLightVertexConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights);\r\n\t\t\tthis._dirLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights*2);\r\n\t\t} else {\r\n\t\t\tthis._dirLightFragmentConstants = new Array<ShaderRegisterElement>(this._shaderLightingObject.numDirectionalLights*3);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ShaderLightingCompiler;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport DirectionalLight\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport LightProbe\t\t\t\t\t= require(\"awayjs-display/lib/entities/LightProbe\");\r\nimport PointLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport LightSources\t\t\t\t\t= require(\"awayjs-display/lib/materials/LightSources\");\r\n\r\nimport ContextGLProfile\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProfile\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\n\r\nimport IRenderLightingPass\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderLightingPass\");\r\nimport ShaderLightingCompiler\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderLightingCompiler\");\r\n\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport ShaderCompilerBase\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderCompilerBase\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\n\r\n/**\r\n * ShaderObjectBase keeps track of the number of dependencies for \"named registers\" used across a pass.\r\n * Named registers are that are not necessarily limited to a single method. They are created by the compiler and\r\n * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed\r\n * each time a method has been compiled into the shader.\r\n *\r\n * @see RegisterPool.addUsage\r\n */\r\nclass ShaderLightingObject extends ShaderObjectBase\r\n{\r\n\tpublic _renderLightingPass:IRenderLightingPass;\r\n\r\n\tprivate _includeCasters:boolean = true;\r\n\r\n\t/**\r\n\t * The first index for the fragment constants containing the light data.\r\n\t */\r\n\tpublic lightFragmentConstantIndex:number;\r\n\r\n\t/**\r\n\t * The starting index if the vertex constant to which light data needs to be uploaded.\r\n\t */\r\n\tpublic lightVertexConstantIndex:number;\r\n\r\n\t/**\r\n\t * Indices for the light probe diffuse textures.\r\n\t */\r\n\tpublic lightProbeDiffuseIndices:Array<number> /*uint*/;\r\n\r\n\t/**\r\n\t * Indices for the light probe specular textures.\r\n\t */\r\n\tpublic lightProbeSpecularIndices:Array<number> /*uint*/;\r\n\r\n\t/**\r\n\t * The index of the fragment constant containing the weights for the light probes.\r\n\t */\r\n\tpublic probeWeightsIndex:number;\r\n\r\n\tpublic numLights:number;\r\n\tpublic numDirectionalLights:number;\r\n\tpublic numPointLights:number;\r\n\tpublic numLightProbes:number;\r\n\r\n\tpublic usesLightFallOff:boolean;\r\n\r\n\tpublic usesShadows:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the shader uses any lights.\r\n\t */\r\n\tpublic usesLights:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the shader uses any light probes.\r\n\t */\r\n\tpublic usesProbes:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the lights uses any specular components.\r\n\t */\r\n\tpublic usesLightsForSpecular:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the probes uses any specular components.\r\n\t */\r\n\tpublic usesProbesForSpecular:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the lights uses any diffuse components.\r\n\t */\r\n\tpublic usesLightsForDiffuse:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether the probes uses any diffuse components.\r\n\t */\r\n\tpublic usesProbesForDiffuse:boolean;\r\n\r\n\t/**\r\n\t * Creates a new MethodCompilerVO object.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, renderLightingPass:IRenderLightingPass, stage:Stage)\r\n\t{\r\n\t\tsuper(renderableClass, renderLightingPass, stage);\r\n\r\n\t\tthis._renderLightingPass = renderLightingPass;\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies()\r\n\t{\r\n\t\tthis.numPointLights = this._renderLightingPass.numPointLights;\r\n\t\tthis.numDirectionalLights = this._renderLightingPass.numDirectionalLights;\r\n\t\tthis.numLightProbes = this._renderLightingPass.numLightProbes;\r\n\r\n\t\tvar numAllLights:number = this._renderLightingPass.numPointLights + this._renderLightingPass.numDirectionalLights;\r\n\t\tvar numLightProbes:number = this._renderLightingPass.numLightProbes;\r\n\t\tvar diffuseLightSources:number = this._renderLightingPass._iUsesDiffuse(this)? this._renderLightingPass.diffuseLightSources : 0x00;\r\n\t\tvar specularLightSources:number = this._renderLightingPass._iUsesSpecular(this)? this._renderLightingPass.specularLightSources : 0x00;\r\n\t\tvar combinedLightSources:number = diffuseLightSources | specularLightSources;\r\n\r\n\t\tthis.usesLightFallOff = this._renderLightingPass.enableLightFallOff && this.profile != ContextGLProfile.BASELINE_CONSTRAINED;\r\n\t\tthis.numLights = numAllLights + numLightProbes;\r\n\t\tthis.usesLights = numAllLights > 0 && (combinedLightSources & LightSources.LIGHTS) != 0;\r\n\t\tthis.usesProbes = numLightProbes > 0 && (combinedLightSources & LightSources.PROBES) != 0;\r\n\t\tthis.usesLightsForSpecular = numAllLights > 0 && (specularLightSources & LightSources.LIGHTS) != 0;\r\n\t\tthis.usesProbesForSpecular = numLightProbes > 0 && (specularLightSources & LightSources.PROBES) != 0;\r\n\t\tthis.usesLightsForDiffuse = numAllLights > 0 && (diffuseLightSources & LightSources.LIGHTS) != 0;\r\n\t\tthis.usesProbesForDiffuse = numLightProbes > 0 && (diffuseLightSources & LightSources.PROBES) != 0;\r\n\t\tthis.usesShadows = this._renderLightingPass._iUsesShadows(this);\r\n\r\n\t\t//IMPORTANT this must occur after shader lighting initialisation above\r\n\t\tsuper._iIncludeDependencies();\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method to create a concrete compiler object for this object\r\n\t *\r\n\t * @param materialPassVO\r\n\t * @returns {away.materials.ShaderLightingCompiler}\r\n\t */\r\n\tpublic createCompiler(renderableClass:IRenderableClass, renderPass:IRenderLightingPass):ShaderCompilerBase\r\n\t{\r\n\t\treturn new ShaderLightingCompiler(renderableClass, renderPass, this);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears dependency counts for all registers. Called when recompiling a pass.\r\n\t */\r\n\tpublic reset()\r\n\t{\r\n\t\tsuper.reset();\r\n\r\n\t\tthis.numLights = 0;\r\n\t\tthis.usesLightFallOff = true;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param renderable\r\n\t * @param stage\r\n\t * @param camera\r\n\t */\r\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(renderable, camera, viewProjection);\r\n\r\n\t\tif (this._renderLightingPass.lightPicker)\r\n\t\t\tthis._renderLightingPass.lightPicker.collectLights(renderable);\r\n\r\n\t\tif (this.usesLights)\r\n\t\t\tthis.updateLights();\r\n\r\n\t\tif (this.usesProbes)\r\n\t\t\tthis.updateProbes();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates constant data render state used by the lights. This method is optional for subclasses to implement.\r\n\t */\r\n\tprivate updateLights()\r\n\t{\r\n\t\tvar dirLight:DirectionalLight;\r\n\t\tvar pointLight:PointLight;\r\n\t\tvar i:number = 0;\r\n\t\tvar k:number = 0;\r\n\t\tvar len:number;\r\n\t\tvar dirPos:Vector3D;\r\n\t\tvar total:number = 0;\r\n\t\tvar numLightTypes:number = this.usesShadows? 2 : 1;\r\n\t\tvar l:number;\r\n\t\tvar offset:number;\r\n\r\n\t\tthis.ambientR = this.ambientG = this.ambientB = 0;\r\n\r\n\t\tl = this.lightVertexConstantIndex;\r\n\t\tk = this.lightFragmentConstantIndex;\r\n\r\n\t\tvar cast:number = 0;\r\n\t\tvar dirLights:Array<DirectionalLight> = this._renderLightingPass.lightPicker.directionalLights;\r\n\t\toffset = this._renderLightingPass.directionalLightsOffset;\r\n\t\tlen = this._renderLightingPass.lightPicker.directionalLights.length;\r\n\r\n\t\tif (offset > len) {\r\n\t\t\tcast = 1;\r\n\t\t\toffset -= len;\r\n\t\t}\r\n\r\n\t\tfor (; cast < numLightTypes; ++cast) {\r\n\t\t\tif (cast)\r\n\t\t\t\tdirLights = this._renderLightingPass.lightPicker.castingDirectionalLights;\r\n\r\n\t\t\tlen = dirLights.length;\r\n\r\n\t\t\tif (len > this.numDirectionalLights)\r\n\t\t\t\tlen = this.numDirectionalLights;\r\n\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tdirLight = dirLights[offset + i];\r\n\t\t\t\tdirPos = dirLight.sceneDirection;\r\n\r\n\t\t\t\tthis.ambientR += dirLight._iAmbientR;\r\n\t\t\t\tthis.ambientG += dirLight._iAmbientG;\r\n\t\t\t\tthis.ambientB += dirLight._iAmbientB;\r\n\r\n\t\t\t\tif (this.usesTangentSpace) {\r\n\t\t\t\t\tvar x:number = -dirPos.x;\r\n\t\t\t\t\tvar y:number = -dirPos.y;\r\n\t\t\t\t\tvar z:number = -dirPos.z;\r\n\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.x;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.y;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = -dirPos.z;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iDiffuseB;\r\n\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = dirLight._iSpecularB;\r\n\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\r\n\t\t\t\tif (++total == this.numDirectionalLights) {\r\n\t\t\t\t\t// break loop\r\n\t\t\t\t\ti = len;\r\n\t\t\t\t\tcast = numLightTypes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// more directional supported than currently picked, need to clamp all to 0\r\n\t\tif (this.numDirectionalLights > total) {\r\n\t\t\ti = k + (this.numDirectionalLights - total)*12;\r\n\r\n\t\t\twhile (k < i)\r\n\t\t\t\tthis.fragmentConstantData[k++] = 0;\r\n\t\t}\r\n\r\n\t\ttotal = 0;\r\n\r\n\t\tvar pointLights:Array<PointLight> = this._renderLightingPass.lightPicker.pointLights;\r\n\t\toffset = this._renderLightingPass.pointLightsOffset;\r\n\t\tlen = this._renderLightingPass.lightPicker.pointLights.length;\r\n\r\n\t\tif (offset > len) {\r\n\t\t\tcast = 1;\r\n\t\t\toffset -= len;\r\n\t\t} else {\r\n\t\t\tcast = 0;\r\n\t\t}\r\n\r\n\t\tfor (; cast < numLightTypes; ++cast) {\r\n\t\t\tif (cast)\r\n\t\t\t\tpointLights = this._renderLightingPass.lightPicker.castingPointLights;\r\n\r\n\t\t\tlen = pointLights.length;\r\n\r\n\t\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\t\tpointLight = pointLights[offset + i];\r\n\t\t\t\tdirPos = pointLight.scenePosition;\r\n\r\n\t\t\t\tthis.ambientR += pointLight._iAmbientR;\r\n\t\t\t\tthis.ambientG += pointLight._iAmbientG;\r\n\t\t\t\tthis.ambientB += pointLight._iAmbientB;\r\n\r\n\t\t\t\tif (this.usesTangentSpace) {\r\n\t\t\t\t\tx = dirPos.x;\r\n\t\t\t\t\ty = dirPos.y;\r\n\t\t\t\t\tz = dirPos.z;\r\n\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z + this._pInverseSceneMatrix[12];\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z + this._pInverseSceneMatrix[13];\r\n\t\t\t\t\tthis.vertexConstantData[l++] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z + this._pInverseSceneMatrix[14];\r\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\r\n\t\t\t\t} else if (!this.usesGlobalPosFragment) {\r\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.x;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.y;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = dirPos.z;\r\n\t\t\t\t\tthis.vertexConstantData[l++] = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.x;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.y;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = dirPos.z;\r\n\t\t\t\t\tthis.fragmentConstantData[k++] = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iDiffuseB;\r\n\r\n\t\t\t\tvar radius:number = pointLight._pRadius;\r\n\t\t\t\tthis.fragmentConstantData[k++] = radius*radius;\r\n\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularR;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularG;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._iSpecularB;\r\n\t\t\t\tthis.fragmentConstantData[k++] = pointLight._pFallOffFactor;\r\n\r\n\t\t\t\tif (++total == this.numPointLights) {\r\n\t\t\t\t\t// break loop\r\n\t\t\t\t\ti = len;\r\n\t\t\t\t\tcast = numLightTypes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// more directional supported than currently picked, need to clamp all to 0\r\n\t\tif (this.numPointLights > total) {\r\n\t\t\ti = k + (total - this.numPointLights)*12;\r\n\r\n\t\t\tfor (; k < i; ++k)\r\n\t\t\t\tthis.fragmentConstantData[k] = 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates constant data render state used by the light probes. This method is optional for subclasses to implement.\r\n\t */\r\n\tprivate updateProbes()\r\n\t{\r\n\t\tvar probe:LightProbe;\r\n\t\tvar lightProbes:Array<LightProbe> = this._renderLightingPass.lightPicker.lightProbes;\r\n\t\tvar weights:Array<number> = this._renderLightingPass.lightPicker.lightProbeWeights;\r\n\t\tvar len:number = lightProbes.length - this._renderLightingPass.lightProbesOffset;\r\n\t\tvar addDiff:boolean = this.usesProbesForDiffuse;\r\n\t\tvar addSpec:boolean = this.usesProbesForSpecular;\r\n\r\n\t\tif (!(addDiff || addSpec))\r\n\t\t\treturn;\r\n\r\n\t\tif (len > this.numLightProbes)\r\n\t\t\tlen = this.numLightProbes;\r\n\r\n\t\tfor (var i:number = 0; i < len; ++i) {\r\n\t\t\tprobe = lightProbes[ this._renderLightingPass.lightProbesOffset + i];\r\n\r\n\t\t\tif (addDiff)\r\n\t\t\t\tthis._stage.activateCubeTexture(this.lightProbeDiffuseIndices[i], probe.diffuseMap, this.useSmoothTextures, this.useMipmapping);\r\n\r\n\t\t\tif (addSpec)\r\n\t\t\t\tthis._stage.activateCubeTexture(this.lightProbeSpecularIndices[i], probe.specularMap, this.useSmoothTextures, this.useMipmapping);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < len; ++i)\r\n\t\t\tthis.fragmentConstantData[this.probeWeightsIndex + i] = weights[this._renderLightingPass.lightProbesOffset + i];\r\n\t}\r\n}\r\n\r\nexport = ShaderLightingObject;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\r\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\n\r\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLTriangleFace\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ProgramData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/ProgramData\");\r\n\r\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport AnimationRegisterCache\t\t= require(\"awayjs-renderergl/lib/animators/data/AnimationRegisterCache\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport IRenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderPassBase\");\r\nimport ShaderCompilerBase\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderCompilerBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\r\n\r\n/**\r\n * ShaderObjectBase keeps track of the number of dependencies for \"named registers\" used across a pass.\r\n * Named registers are that are not necessarily limited to a single method. They are created by the compiler and\r\n * passed on to methods. The compiler uses the results to reserve usages through RegisterPool, which can be removed\r\n * each time a method has been compiled into the shader.\r\n *\r\n * @see RegisterPool.addUsage\r\n */\r\nclass ShaderObjectBase\r\n{\r\n\tprivate _renderableClass:IRenderableClass;\r\n\tprivate _renderPass:IRenderPassBase;\r\n\tpublic _stage:Stage;\r\n\tprivate _programData:ProgramData;\r\n\r\n\tprivate _invalidShader:boolean = true;\r\n\tprivate _invalidProgram:boolean = true;\r\n\tprivate _animationVertexCode:string = \"\";\r\n\tprivate _animationFragmentCode:string = \"\";\r\n\r\n\tpublic get programData():ProgramData\r\n\t{\r\n\t\tif (this._invalidProgram)\r\n\t\t\tthis._updateProgram();\r\n\r\n\t\treturn this._programData;\r\n\t}\r\n\r\n\tpublic profile:string;\r\n\r\n\tpublic usesAnimation:boolean;\r\n\r\n\tprivate _defaultCulling:string = ContextGLTriangleFace.BACK;\r\n\r\n\tpublic _pInverseSceneMatrix:Array<number> = new Array<number>();\r\n\r\n\tpublic animationRegisterCache:AnimationRegisterCache;\r\n\r\n\t/**\r\n\t * The amount of used vertex constants in the vertex code. Used by the animation code generation to know from which index on registers are available.\r\n\t */\r\n\tpublic numUsedVertexConstants:number;\r\n\r\n\t/**\r\n\t * The amount of used fragment constants in the fragment code. Used by the animation code generation to know from which index on registers are available.\r\n\t */\r\n\tpublic numUsedFragmentConstants:number;\r\n\r\n\t/**\r\n\t * The amount of used vertex streams in the vertex code. Used by the animation code generation to know from which index on streams are available.\r\n\t */\r\n\tpublic numUsedStreams:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic numUsedTextures:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic numUsedVaryings:number;\r\n\r\n\tpublic animatableAttributes:Array<string>;\r\n\tpublic animationTargetRegisters:Array<string>;\r\n\tpublic uvSource:string;\r\n\tpublic uvTarget:string;\r\n\r\n\tpublic useAlphaPremultiplied:boolean;\r\n\tpublic useBothSides:boolean;\r\n\tpublic useMipmapping:boolean;\r\n\tpublic useSmoothTextures:boolean;\r\n\tpublic repeatTextures:boolean;\r\n\tpublic usesUVTransform:boolean;\r\n\tpublic alphaThreshold:number;\r\n\tpublic texture:Texture2DBase;\r\n\tpublic color:number;\r\n\r\n\r\n\t//set ambient values to default\r\n\tpublic ambientR:number = 0xFF;\r\n\tpublic ambientG:number = 0xFF;\r\n\tpublic ambientB:number = 0xFF;\r\n\r\n\t/**\r\n\t * Indicates whether the pass requires any fragment animation code.\r\n\t */\r\n\tpublic usesFragmentAnimation:boolean;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the projected position.\r\n\t */\r\n\tpublic projectionDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the normal vector.\r\n\t */\r\n\tpublic normalDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the vertex color.\r\n\t */\r\n\tpublic colorDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the view direction.\r\n\t */\r\n\tpublic viewDirDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the primary UV coordinates.\r\n\t */\r\n\tpublic uvDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the secondary UV coordinates.\r\n\t */\r\n\tpublic secondaryUVDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the local position. This can be 0 while hasGlobalPosDependencies is true when\r\n\t * the global position is used as a temporary value (fe to calculate the view direction)\r\n\t */\r\n\tpublic localPosDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of dependencies on the global position. This can be 0 while hasGlobalPosDependencies is true when\r\n\t * the global position is used as a temporary value (fe to calculate the view direction)\r\n\t */\r\n\tpublic globalPosDependencies:number;\r\n\r\n\t/**\r\n\t * The amount of tangent vector dependencies (fragment shader).\r\n\t */\r\n\tpublic tangentDependencies:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic outputsNormals:boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic outputsColors:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether or not normal calculations are expected in tangent space. This is only the case if no world-space\r\n\t * dependencies exist.\r\n\t */\r\n\tpublic usesTangentSpace:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether or not normal calculations are output in tangent space.\r\n\t */\r\n\tpublic outputsTangentNormals:boolean;\r\n\r\n\t/**\r\n\t * Indicates whether there are any dependencies on the world-space position vector.\r\n\t */\r\n\tpublic usesGlobalPosFragment:boolean = false;\r\n\r\n\tpublic vertexConstantData:Array<number> = new Array<number>();\r\n\tpublic fragmentConstantData:Array<number> = new Array<number>();\r\n\r\n\t/**\r\n\t * The index for the common data register.\r\n\t */\r\n\tpublic commonsDataIndex:number;\r\n\r\n\t/**\r\n\t * The index for the UV vertex attribute stream.\r\n\t */\r\n\tpublic uvBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the secondary UV vertex attribute stream.\r\n\t */\r\n\tpublic secondaryUVBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the vertex normal attribute stream.\r\n\t */\r\n\tpublic normalBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the color attribute stream.\r\n\t */\r\n\tpublic colorBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index for the vertex tangent attribute stream.\r\n\t */\r\n\tpublic tangentBufferIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the view matrix.\r\n\t */\r\n\tpublic viewMatrixIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the scene matrix.\r\n\t */\r\n\tpublic sceneMatrixIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the uniform scene matrix (the inverse transpose).\r\n\t */\r\n\tpublic sceneNormalMatrixIndex:number;\r\n\r\n\t/**\r\n\t * The index of the vertex constant containing the camera position.\r\n\t */\r\n\tpublic cameraPositionIndex:number;\r\n\r\n\t/**\r\n\t * The index for the UV transformation matrix vertex constant.\r\n\t */\r\n\tpublic uvTransformIndex:number;\r\n\r\n\t/**\r\n\t * Creates a new MethodCompilerVO object.\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, renderPass:IRenderPassBase, stage:Stage)\r\n\t{\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._renderPass = renderPass;\r\n\t\tthis._stage = stage;\r\n\t\tthis.profile = this._stage.profile;\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies()\r\n\t{\r\n\t\tthis._renderPass._iIncludeDependencies(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method to create a concrete compiler object for this object\r\n\t *\r\n\t * @param renderableClass\r\n\t * @param renderPass\r\n\t * @param stage\r\n\t * @returns {ShaderCompilerBase}\r\n\t */\r\n\tpublic createCompiler(renderableClass:IRenderableClass, renderPass:IRenderPassBase):ShaderCompilerBase\r\n\t{\r\n\t\treturn new ShaderCompilerBase(renderableClass, renderPass, this);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears dependency counts for all registers. Called when recompiling a pass.\r\n\t */\r\n\tpublic reset()\r\n\t{\r\n\t\tthis.projectionDependencies = 0;\r\n\t\tthis.normalDependencies = 0;\r\n\t\tthis.colorDependencies = 0;\r\n\t\tthis.viewDirDependencies = 0;\r\n\t\tthis.uvDependencies = 0;\r\n\t\tthis.secondaryUVDependencies = 0;\r\n\t\tthis.globalPosDependencies = 0;\r\n\t\tthis.localPosDependencies = 0;\r\n\t\tthis.tangentDependencies = 0;\r\n\t\tthis.usesGlobalPosFragment = false;\r\n\t\tthis.usesFragmentAnimation = false;\r\n\t\tthis.usesTangentSpace = false;\r\n\t\tthis.outputsNormals = false;\r\n\t\tthis.outputsTangentNormals = false;\r\n\t}\r\n\r\n\tpublic pInitRegisterIndices()\r\n\t{\r\n\t\tthis.commonsDataIndex = -1;\r\n\t\tthis.cameraPositionIndex = -1;\r\n\t\tthis.uvBufferIndex = -1;\r\n\t\tthis.uvTransformIndex = -1;\r\n\t\tthis.secondaryUVBufferIndex = -1;\r\n\t\tthis.normalBufferIndex = -1;\r\n\t\tthis.colorBufferIndex = -1;\r\n\t\tthis.tangentBufferIndex = -1;\r\n\t\tthis.sceneMatrixIndex = -1;\r\n\t\tthis.sceneNormalMatrixIndex = -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the unchanging constant data for this shader object.\r\n\t */\r\n\tpublic initConstantData(registerCache:ShaderRegisterCache, animatableAttributes:Array<string>, animationTargetRegisters:Array<string>, uvSource:string, uvTarget:string)\r\n\t{\r\n\t\t//Updates the amount of used register indices.\r\n\t\tthis.numUsedVertexConstants = registerCache.numUsedVertexConstants;\r\n\t\tthis.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;\r\n\t\tthis.numUsedStreams = registerCache.numUsedStreams;\r\n\t\tthis.numUsedTextures = registerCache.numUsedTextures;\r\n\t\tthis.numUsedVaryings = registerCache.numUsedVaryings;\r\n\t\tthis.numUsedFragmentConstants = registerCache.numUsedFragmentConstants;\r\n\r\n\t\tthis.animatableAttributes = animatableAttributes;\r\n\t\tthis.animationTargetRegisters = animationTargetRegisters;\r\n\t\tthis.uvSource = uvSource;\r\n\t\tthis.uvTarget = uvTarget;\r\n\r\n\t\tthis.vertexConstantData.length = this.numUsedVertexConstants*4;\r\n\t\tthis.fragmentConstantData.length = this.numUsedFragmentConstants*4;\r\n\r\n\t\t//Initializes commonly required constant values.\r\n\t\tthis.fragmentConstantData[this.commonsDataIndex] = .5;\r\n\t\tthis.fragmentConstantData[this.commonsDataIndex + 1] = 0;\r\n\t\tthis.fragmentConstantData[this.commonsDataIndex + 2] = 1/255;\r\n\t\tthis.fragmentConstantData[this.commonsDataIndex + 3] = 1;\r\n\r\n\t\t//Initializes the default UV transformation matrix.\r\n\t\tif (this.uvTransformIndex >= 0) {\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex] = 1;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 2] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = 1;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 6] = 0;\r\n\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = 0;\r\n\t\t}\r\n\r\n\t\tif (this.cameraPositionIndex >= 0)\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 3] = 1;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tif (this.usesAnimation)\r\n\t\t\t(<AnimationSetBase> this._renderPass.animationSet).activate(this, this._stage);\r\n\r\n\t\tthis._stage.context.setCulling(this.useBothSides? ContextGLTriangleFace.NONE : this._defaultCulling, camera.projection.coordinateSystem);\r\n\r\n\t\tif (!this.usesTangentSpace && this.cameraPositionIndex >= 0) {\r\n\t\t\tvar pos:Vector3D = camera.scenePosition;\r\n\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex] = pos.x;\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 1] = pos.y;\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 2] = pos.z;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iDeactivate()\r\n\t{\r\n\t\tif (this.usesAnimation)\r\n\t\t\t(<AnimationSetBase> this._renderPass.animationSet).deactivate(this, this._stage);\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t *\r\n\t *\r\n\t * @param renderable\r\n\t * @param stage\r\n\t * @param camera\r\n\t */\r\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tif (renderable.renderableOwner.animator)\r\n\t\t\t(<AnimatorBase> renderable.renderableOwner.animator).setRenderState(this, renderable, this._stage, camera, this.numUsedVertexConstants, this.numUsedStreams);\r\n\r\n\t\tif (this.uvBufferIndex >= 0)\r\n\t\t\tthis._stage.activateBuffer(this.uvBufferIndex, renderable.getVertexData(TriangleSubGeometry.UV_DATA), renderable.getVertexOffset(TriangleSubGeometry.UV_DATA), TriangleSubGeometry.UV_FORMAT);\r\n\r\n\t\tif (this.secondaryUVBufferIndex >= 0)\r\n\t\t\tthis._stage.activateBuffer(this.secondaryUVBufferIndex, renderable.getVertexData(TriangleSubGeometry.SECONDARY_UV_DATA), renderable.getVertexOffset(TriangleSubGeometry.SECONDARY_UV_DATA), TriangleSubGeometry.SECONDARY_UV_FORMAT);\r\n\r\n\t\tif (this.normalBufferIndex >= 0)\r\n\t\t\tthis._stage.activateBuffer(this.normalBufferIndex, renderable.getVertexData(TriangleSubGeometry.NORMAL_DATA), renderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA), TriangleSubGeometry.NORMAL_FORMAT);\r\n\r\n\t\tif (this.tangentBufferIndex >= 0)\r\n\t\t\tthis._stage.activateBuffer(this.tangentBufferIndex, renderable.getVertexData(TriangleSubGeometry.TANGENT_DATA), renderable.getVertexOffset(TriangleSubGeometry.TANGENT_DATA), TriangleSubGeometry.TANGENT_FORMAT);\r\n\r\n\t\tif (this.colorBufferIndex >= 0)\r\n\t\t\tthis._stage.activateBuffer(this.colorBufferIndex, renderable.getVertexData(LineSubGeometry.COLOR_DATA), renderable.getVertexOffset(LineSubGeometry.COLOR_DATA), LineSubGeometry.COLOR_FORMAT);\r\n\r\n\r\n\t\tif (this.usesUVTransform) {\r\n\t\t\tvar uvTransform:Matrix = renderable.renderableOwner.uvTransform.matrix;\r\n\r\n\t\t\tif (uvTransform) {\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex] = uvTransform.a;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = uvTransform.b;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = uvTransform.tx;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = uvTransform.c;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = uvTransform.d;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = uvTransform.ty;\r\n\t\t\t} else {\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex] = 1;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 1] = 0;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 3] = 0;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 4] = 0;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 5] = 1;\r\n\t\t\t\tthis.vertexConstantData[this.uvTransformIndex + 7] = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.sceneNormalMatrixIndex >= 0)\r\n\t\t\trenderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData, this.sceneNormalMatrixIndex, false);\r\n\r\n\t\tif (this.usesTangentSpace && this.cameraPositionIndex >= 0) {\r\n\r\n\t\t\trenderable.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);\r\n\t\t\tvar pos:Vector3D = camera.scenePosition;\r\n\t\t\tvar x:number = pos.x;\r\n\t\t\tvar y:number = pos.y;\r\n\t\t\tvar z:number = pos.z;\r\n\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex] = this._pInverseSceneMatrix[0]*x + this._pInverseSceneMatrix[4]*y + this._pInverseSceneMatrix[8]*z + this._pInverseSceneMatrix[12];\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 1] = this._pInverseSceneMatrix[1]*x + this._pInverseSceneMatrix[5]*y + this._pInverseSceneMatrix[9]*z + this._pInverseSceneMatrix[13];\r\n\t\t\tthis.vertexConstantData[this.cameraPositionIndex + 2] = this._pInverseSceneMatrix[2]*x + this._pInverseSceneMatrix[6]*y + this._pInverseSceneMatrix[10]*z + this._pInverseSceneMatrix[14];\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic invalidateProgram()\r\n\t{\r\n\t\tthis._invalidProgram = true;\r\n\t}\r\n\r\n\tpublic invalidateShader()\r\n\t{\r\n\t\tthis._invalidShader = true;\r\n\t\tthis._invalidProgram = true;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._programData.dispose();\r\n\t\tthis._programData = null;\r\n\t}\r\n\r\n\tprivate _updateProgram()\r\n\t{\r\n\t\tthis._invalidProgram = false;\r\n\r\n\t\tvar compiler:ShaderCompilerBase;\r\n\r\n\t\tif (this._invalidShader) {\r\n\t\t\tthis._invalidShader = false;\r\n\r\n\t\t\tcompiler = this.createCompiler(this._renderableClass, this._renderPass);\r\n\t\t\tcompiler.compile();\r\n\t\t}\r\n\r\n\t\tthis._calcAnimationCode(compiler.shadedTarget);\r\n\r\n\t\tvar programData:ProgramData = this._stage.getProgramData(this._animationVertexCode + compiler.vertexCode, compiler.fragmentCode + this._animationFragmentCode + compiler.postAnimationFragmentCode);\r\n\r\n\t\t//check program data hasn't changed, keep count of program usages\r\n\t\tif (this._programData != programData) {\r\n\t\t\tif (this._programData)\r\n\t\t\t\tthis._programData.dispose();\r\n\r\n\t\t\tthis._programData = programData;\r\n\r\n\t\t\tprogramData.usages++;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _calcAnimationCode(shadedTarget:string)\r\n\t{\r\n\t\t//reset code\r\n\t\tthis._animationVertexCode = \"\";\r\n\t\tthis._animationFragmentCode = \"\";\r\n\r\n\t\t//check to see if GPU animation is used\r\n\t\tif (this.usesAnimation) {\r\n\r\n\t\t\tvar animationSet:AnimationSetBase = <AnimationSetBase> this._renderPass.animationSet;\r\n\r\n\t\t\tthis._animationVertexCode += animationSet.getAGALVertexCode(this);\r\n\r\n\t\t\tif (this.uvDependencies > 0 && !this.usesUVTransform)\r\n\t\t\t\tthis._animationVertexCode += animationSet.getAGALUVCode(this);\r\n\r\n\t\t\tif (this.usesFragmentAnimation)\r\n\t\t\t\tthis._animationFragmentCode += animationSet.getAGALFragmentCode(this, shadedTarget);\r\n\r\n\t\t\tanimationSet.doneAGALCode(this);\r\n\r\n\t\t} else {\r\n\t\t\t// simply write attributes to targets, do not animate them\r\n\t\t\t// projection will pick up on targets[0] to do the projection\r\n\t\t\tvar len:number = this.animatableAttributes.length;\r\n\t\t\tfor (var i:number = 0; i < len; ++i)\r\n\t\t\t\tthis._animationVertexCode += \"mov \" + this.animationTargetRegisters[i] + \", \" + this.animatableAttributes[i] + \"\\n\";\r\n\r\n\t\t\tif (this.uvDependencies > 0 && !this.usesUVTransform)\r\n\t\t\t\tthis._animationVertexCode += \"mov \" + this.uvTarget + \",\" + this.uvSource + \"\\n\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ShaderObjectBase;",
    "import RegisterPool\t\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RegisterPool\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\n/**\r\n * ShaderRegister Cache provides the usage management system for all registers during shading compilation.\r\n */\r\nclass ShaderRegisterCache\r\n{\r\n\tprivate _fragmentTempCache:RegisterPool;\r\n\tprivate _vertexTempCache:RegisterPool;\r\n\tprivate _varyingCache:RegisterPool;\r\n\tprivate _fragmentConstantsCache:RegisterPool;\r\n\tprivate _vertexConstantsCache:RegisterPool;\r\n\tprivate _textureCache:RegisterPool;\r\n\tprivate _vertexAttributesCache:RegisterPool;\r\n\tprivate _vertexConstantOffset:number; //TODO: check if this should be initialised to 0\r\n\tprivate _vertexAttributesOffset:number;//TODO: check if this should be initialised to 0\r\n\tprivate _varyingsOffset:number;//TODO: check if this should be initialised to 0\r\n\tprivate _fragmentConstantOffset:number;//TODO: check if this should be initialised to 0\r\n\r\n\tprivate _fragmentOutputRegister:ShaderRegisterElement;\r\n\tprivate _vertexOutputRegister:ShaderRegisterElement;\r\n\tprivate _numUsedVertexConstants:number = 0;\r\n\tprivate _numUsedFragmentConstants:number = 0;\r\n\tprivate _numUsedStreams:number = 0;\r\n\tprivate _numUsedTextures:number = 0;\r\n\tprivate _numUsedVaryings:number = 0;\r\n\tprivate _profile:string;\r\n\r\n\t/**\r\n\t * Create a new ShaderRegisterCache object.\r\n\t *\r\n\t * @param profile The compatibility profile used by the renderer.\r\n\t */\r\n\tconstructor(profile:string)\r\n\t{\r\n\t\tthis._profile = profile;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets all registers.\r\n\t */\r\n\tpublic reset()\r\n\t{\r\n\t\tthis._fragmentTempCache = new RegisterPool(\"ft\", 8, false);\r\n\t\tthis._vertexTempCache = new RegisterPool(\"vt\", 8, false);\r\n\t\tthis._varyingCache = new RegisterPool(\"v\", 8);\r\n\t\tthis._textureCache = new RegisterPool(\"fs\", 8);\r\n\t\tthis._vertexAttributesCache = new RegisterPool(\"va\", 8);\r\n\t\tthis._fragmentConstantsCache = new RegisterPool(\"fc\", 28);\r\n\t\tthis._vertexConstantsCache = new RegisterPool(\"vc\", 128);\r\n\t\tthis._fragmentOutputRegister = new ShaderRegisterElement(\"oc\", -1);\r\n\t\tthis._vertexOutputRegister = new ShaderRegisterElement(\"op\", -1);\r\n\t\tthis._numUsedVertexConstants = 0;\r\n\t\tthis._numUsedStreams = 0;\r\n\t\tthis._numUsedTextures = 0;\r\n\t\tthis._numUsedVaryings = 0;\r\n\t\tthis._numUsedFragmentConstants = 0;\r\n\r\n\t\tvar i:number;\r\n\r\n\t\tfor (i = 0; i < this._vertexAttributesOffset; ++i)\r\n\t\t\tthis.getFreeVertexAttribute();\r\n\r\n\t\tfor (i = 0; i < this._vertexConstantOffset; ++i)\r\n\t\t\tthis.getFreeVertexConstant();\r\n\r\n\t\tfor (i = 0; i < this._varyingsOffset; ++i)\r\n\t\t\tthis.getFreeVarying();\r\n\r\n\t\tfor (i = 0; i < this._fragmentConstantOffset; ++i)\r\n\t\t\tthis.getFreeFragmentConstant();\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes all resources used.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._fragmentTempCache.dispose();\r\n\t\tthis._vertexTempCache.dispose();\r\n\t\tthis._varyingCache.dispose();\r\n\t\tthis._fragmentConstantsCache.dispose();\r\n\t\tthis._vertexAttributesCache.dispose();\r\n\r\n\t\tthis._fragmentTempCache = null;\r\n\t\tthis._vertexTempCache = null;\r\n\t\tthis._varyingCache = null;\r\n\t\tthis._fragmentConstantsCache = null;\r\n\t\tthis._vertexAttributesCache = null;\r\n\t\tthis._fragmentOutputRegister = null;\r\n\t\tthis._vertexOutputRegister = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a fragment temporary register as used, so it cannot be retrieved. The register won't be able to be used until removeUsage\r\n\t * has been called usageCount times again.\r\n\t * @param register The register to mark as used.\r\n\t * @param usageCount The amount of usages to add.\r\n\t */\r\n\tpublic addFragmentTempUsages(register:ShaderRegisterElement, usageCount:number)\r\n\t{\r\n\t\tthis._fragmentTempCache.addUsage(register, usageCount);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a usage from a fragment temporary register. When usages reach 0, the register is freed again.\r\n\t * @param register The register for which to remove a usage.\r\n\t */\r\n\tpublic removeFragmentTempUsage(register:ShaderRegisterElement)\r\n\t{\r\n\t\tthis._fragmentTempCache.removeUsage(register);\r\n\t}\r\n\r\n\t/**\r\n\t * Marks a vertex temporary register as used, so it cannot be retrieved. The register won't be able to be used\r\n\t * until removeUsage has been called usageCount times again.\r\n\t * @param register The register to mark as used.\r\n\t * @param usageCount The amount of usages to add.\r\n\t */\r\n\tpublic addVertexTempUsages(register:ShaderRegisterElement, usageCount:number)\r\n\t{\r\n\t\tthis._vertexTempCache.addUsage(register, usageCount);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a usage from a vertex temporary register. When usages reach 0, the register is freed again.\r\n\t * @param register The register for which to remove a usage.\r\n\t */\r\n\tpublic removeVertexTempUsage(register:ShaderRegisterElement)\r\n\t{\r\n\t\tthis._vertexTempCache.removeUsage(register);\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an entire fragment temporary register that's still available. The register won't be able to be used until removeUsage\r\n\t * has been called usageCount times again.\r\n\t */\r\n\tpublic getFreeFragmentVectorTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._fragmentTempCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve a single component from a fragment temporary register that's still available.\r\n\t */\r\n\tpublic getFreeFragmentSingleTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._fragmentTempCache.requestFreeRegComponent();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available varying register\r\n\t */\r\n\tpublic getFreeVarying():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedVaryings;\r\n\t\treturn this._varyingCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available fragment constant register\r\n\t */\r\n\tpublic getFreeFragmentConstant():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedFragmentConstants;\r\n\t\treturn this._fragmentConstantsCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available vertex constant register\r\n\t */\r\n\tpublic getFreeVertexConstant():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedVertexConstants;\r\n\t\treturn this._vertexConstantsCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an entire vertex temporary register that's still available.\r\n\t */\r\n\tpublic getFreeVertexVectorTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._vertexTempCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve a single component from a vertex temporary register that's still available.\r\n\t */\r\n\tpublic getFreeVertexSingleTemp():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._vertexTempCache.requestFreeRegComponent();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available vertex attribute register\r\n\t */\r\n\tpublic getFreeVertexAttribute():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedStreams;\r\n\t\treturn this._vertexAttributesCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve an available texture register\r\n\t */\r\n\tpublic getFreeTextureReg():ShaderRegisterElement\r\n\t{\r\n\t\t++this._numUsedTextures;\r\n\t\treturn this._textureCache.requestFreeVectorReg();\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve vertex constants.\r\n\t */\r\n\tpublic get vertexConstantOffset():number\r\n\t{\r\n\t\treturn this._vertexConstantOffset;\r\n\t}\r\n\r\n\tpublic set vertexConstantOffset(vertexConstantOffset:number)\r\n\t{\r\n\t\tthis._vertexConstantOffset = vertexConstantOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve vertex attributes.\r\n\t */\r\n\tpublic get vertexAttributesOffset():number\r\n\t{\r\n\t\treturn this._vertexAttributesOffset;\r\n\t}\r\n\r\n\tpublic set vertexAttributesOffset(value:number)\r\n\t{\r\n\t\tthis._vertexAttributesOffset = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve varying registers.\r\n\t */\r\n\tpublic get varyingsOffset():number\r\n\t{\r\n\t\treturn this._varyingsOffset;\r\n\t}\r\n\r\n\tpublic set varyingsOffset(value:number)\r\n\t{\r\n\t\tthis._varyingsOffset = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates the start index from which to retrieve fragment constants.\r\n\t */\r\n\tpublic get fragmentConstantOffset():number\r\n\t{\r\n\t\treturn this._fragmentConstantOffset;\r\n\t}\r\n\r\n\tpublic set fragmentConstantOffset(value:number)\r\n\t{\r\n\t\tthis._fragmentConstantOffset = value;\r\n\t}\r\n\r\n\t/**\r\n\t * The fragment output register.\r\n\t */\r\n\tpublic get fragmentOutputRegister():ShaderRegisterElement\r\n\t{\r\n\t\treturn this._fragmentOutputRegister;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used vertex constant registers.\r\n\t */\r\n\tpublic get numUsedVertexConstants():number\r\n\t{\r\n\t\treturn this._numUsedVertexConstants;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used fragment constant registers.\r\n\t */\r\n\tpublic get numUsedFragmentConstants():number\r\n\t{\r\n\t\treturn this._numUsedFragmentConstants;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used vertex streams.\r\n\t */\r\n\tpublic get numUsedStreams():number\r\n\t{\r\n\t\treturn this._numUsedStreams;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used texture slots.\r\n\t */\r\n\tpublic get numUsedTextures():number\r\n\t{\r\n\t\treturn this._numUsedTextures;\r\n\t}\r\n\r\n\t/**\r\n\t * The amount of used varying registers.\r\n\t */\r\n\tpublic get numUsedVaryings():number\r\n\t{\r\n\t\treturn this._numUsedVaryings;\r\n\t}\r\n}\r\n\r\nexport = ShaderRegisterCache;",
    "import ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\n/**\r\n * ShaderRegisterData contains the \"named\" registers, generated by the compiler and to be passed on to the methods.\r\n */\r\nclass ShaderRegisterData\r\n{\r\n\tpublic normalVarying:ShaderRegisterElement;\r\n\tpublic colorVarying:ShaderRegisterElement\r\n\tpublic tangentVarying:ShaderRegisterElement;\r\n\tpublic bitangentVarying:ShaderRegisterElement;\r\n\tpublic uvVarying:ShaderRegisterElement;\r\n\tpublic secondaryUVVarying:ShaderRegisterElement;\r\n\tpublic viewDirVarying:ShaderRegisterElement;\r\n\tpublic shadowTarget:ShaderRegisterElement;\r\n\tpublic shadedTarget:ShaderRegisterElement;\r\n\tpublic globalPositionVertex:ShaderRegisterElement;\r\n\tpublic globalPositionVarying:ShaderRegisterElement;\r\n    public localPositionVarying:ShaderRegisterElement;\r\n\tpublic localPosition:ShaderRegisterElement;\r\n\tpublic normalInput:ShaderRegisterElement;\r\n\tpublic colorInput:ShaderRegisterElement;\r\n\tpublic tangentInput:ShaderRegisterElement;\r\n\tpublic animatedNormal:ShaderRegisterElement;\r\n\tpublic animatedTangent:ShaderRegisterElement;\r\n\tpublic commons:ShaderRegisterElement;\r\n\tpublic projectionFragment:ShaderRegisterElement;\r\n\tpublic normalFragment:ShaderRegisterElement;\r\n\tpublic viewDirFragment:ShaderRegisterElement;\r\n\tpublic bitangent:ShaderRegisterElement;\r\n\r\n\tconstructor()\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = ShaderRegisterData;",
    "/**\r\n * A single register element (an entire register or a single register's component) used by the RegisterPool.\r\n */\r\nclass ShaderRegisterElement\r\n{\r\n\tprivate _regName:string;\r\n\tprivate _index:number;\r\n\tprivate _toStr:string;\r\n\r\n\tprivate static COMPONENTS = [\"x\", \"y\", \"z\", \"w\"];\r\n\r\n\tpublic _component:number;\r\n\r\n\t/**\r\n\t * Creates a new ShaderRegisterElement object.\r\n\t *\r\n\t * @param regName The name of the register.\r\n\t * @param index The index of the register.\r\n\t * @param component The register's component, if not the entire register is represented.\r\n\t */\r\n\tconstructor(regName:string, index:number, component:number = -1)\r\n\t{\r\n\t\tthis._component = component;\r\n\t\tthis._regName = regName;\r\n\t\tthis._index = index;\r\n\r\n\t\tthis._toStr = this._regName;\r\n\r\n\t\tif (this._index >= 0)\r\n\t\t\tthis._toStr += this._index;\r\n\r\n\t\tif (component > -1)\r\n\t\t\tthis._toStr += \".\" + ShaderRegisterElement.COMPONENTS[component];\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the register or the components AGAL string representation.\r\n\t */\r\n\tpublic toString():string\r\n\t{\r\n\t\treturn this._toStr;\r\n\t}\r\n\r\n\t/**\r\n\t * The register's name.\r\n\t */\r\n\tpublic get regName():string\r\n\t{\r\n\t\treturn this._regName;\r\n\t}\r\n\r\n\t/**\r\n\t * The register's index.\r\n\t */\r\n\tpublic get index():number\r\n\t{\r\n\t\treturn this._index;\r\n\t}\r\n}\r\n\r\nexport = ShaderRegisterElement;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport SkyboxPass\t\t\t\t\t= require(\"awayjs-renderergl/lib/passes/SkyboxPass\");\r\n\r\n/**\r\n * SkyboxRenderObject forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass SkyboxRenderObject extends RenderObjectBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"skybox\";\r\n\r\n\tprivate _screenPass:SkyboxPass;\r\n\r\n\tconstructor(pool:RenderObjectPool, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, renderObjectOwner, renderableClass, stage);\r\n\r\n\t\tthis._screenPass = new SkyboxPass(this, renderObjectOwner, renderableClass, this._stage);\r\n\r\n\t\tthis._pAddScreenPass(this._screenPass);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pUpdateRenderObject()\r\n\t{\r\n\t\tsuper._pUpdateRenderObject();\r\n\r\n\t\tthis._pRequiresBlending = (this._renderObjectOwner.blendMode != BlendMode.NORMAL);\r\n\r\n\t\tthis._screenPass.setBlendMode((this._renderObjectOwner.blendMode == BlendMode.NORMAL && this._pRequiresBlending)? BlendMode.LAYER : this._renderObjectOwner.blendMode);\r\n\t}\r\n}\r\n\r\nexport = SkyboxRenderObject;",
    "import Error\t\t\t\t\t\t= require(\"awayjs-core/lib/errors/Error\");\r\n\r\nclass AnimationSetError extends Error\r\n{\r\n\tconstructor(message:string)\r\n\t{\r\n\t\tsuper(message);\r\n\t}\r\n}\r\n\r\nexport = AnimationSetError;",
    "import AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\n\r\nimport Event\t\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\n\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport IAnimationState\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/states/IAnimationState\");\r\n\r\n/**\r\n * Dispatched to notify changes in an animation state's state.\r\n */\r\nclass AnimationStateEvent extends Event\r\n{\r\n\t/**\r\n\t * Dispatched when a non-looping clip node inside an animation state reaches the end of its timeline.\r\n\t */\r\n\tpublic static PLAYBACK_COMPLETE:string = \"playbackComplete\";\r\n\r\n\tpublic static TRANSITION_COMPLETE:string = \"transitionComplete\";\r\n\r\n\tprivate _animator:AnimatorBase;\r\n\tprivate _animationState:IAnimationState;\r\n\tprivate _animationNode:AnimationNodeBase;\r\n\r\n\t/**\r\n\t * Create a new <code>AnimatonStateEvent</code>\r\n\t *\r\n\t * @param type The event type.\r\n\t * @param animator The animation state object that is the subject of this event.\r\n\t * @param animationNode The animation node inside the animation state from which the event originated.\r\n\t */\r\n\tconstructor(type:string, animator:AnimatorBase, animationState:IAnimationState, animationNode:AnimationNodeBase)\r\n\t{\r\n\t\tsuper(type);\r\n\r\n\t\tthis._animator = animator;\r\n\t\tthis._animationState = animationState;\r\n\t\tthis._animationNode = animationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * The animator object that is the subject of this event.\r\n\t */\r\n\tpublic get animator():AnimatorBase\r\n\t{\r\n\t\treturn this._animator;\r\n\t}\r\n\r\n\t/**\r\n\t * The animation state object that is the subject of this event.\r\n\t */\r\n\tpublic get animationState():IAnimationState\r\n\t{\r\n\t\treturn this._animationState;\r\n\t}\r\n\r\n\t/**\r\n\t * The animation node inside the animation state from which the event originated.\r\n\t */\r\n\tpublic get animationNode():AnimationNodeBase\r\n\t{\r\n\t\treturn this._animationNode;\r\n\t}\r\n\r\n\t/**\r\n\t * Clones the event.\r\n\t *\r\n\t * @return An exact duplicate of the current object.\r\n\t */\r\n\tpublic clone():Event\r\n\t{\r\n\t\treturn new AnimationStateEvent(this.type, this._animator, this._animationState, this._animationNode);\r\n\t}\r\n}\r\n\r\nexport = AnimationStateEvent;",
    "import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\n\r\nimport AnimatorBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\n\r\n/**\r\n * Dispatched to notify changes in an animator's state.\r\n */\r\nclass AnimatorEvent extends Event\r\n{\r\n\t/**\r\n\t * Defines the value of the type property of a start event object.\r\n\t */\r\n\tpublic static START:string = \"start\";\r\n\r\n\t/**\r\n\t * Defines the value of the type property of a stop event object.\r\n\t */\r\n\tpublic static STOP:string = \"stop\";\r\n\r\n\t/**\r\n\t * Defines the value of the type property of a cycle complete event object.\r\n\t */\r\n\tpublic static CYCLE_COMPLETE:string = \"cycle_complete\";\r\n\r\n\tprivate _animator:AnimatorBase;\r\n\r\n\t/**\r\n\t * Create a new <code>AnimatorEvent</code> object.\r\n\t *\r\n\t * @param type The event type.\r\n\t * @param animator The animator object that is the subject of this event.\r\n\t */\r\n\tconstructor(type:string, animator:AnimatorBase)\r\n\t{\r\n\t\tsuper(type);\r\n\t\tthis._animator = animator;\r\n\t}\r\n\r\n\tpublic get animator():AnimatorBase\r\n\t{\r\n\t\treturn this._animator;\r\n\t}\r\n\r\n\t/**\r\n\t * Clones the event.\r\n\t *\r\n\t * @return An exact duplicate of the current event object.\r\n\t */\r\n\tpublic clone():Event\r\n\t{\r\n\t\treturn new AnimatorEvent(this.type, this._animator);\r\n\t}\r\n}\r\n\r\nexport = AnimatorEvent;",
    "import Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\n\r\nclass ShadingMethodEvent extends Event\r\n{\r\n\tpublic static SHADER_INVALIDATED:string = \"ShaderInvalidated\";\r\n\r\n\tconstructor(type:string)\r\n\t{\r\n\r\n\t\tsuper(type);\r\n\r\n\t}\r\n}\r\n\r\nexport = ShadingMethodEvent;",
    "import Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\r\n\r\nimport Filter3DTaskBase\t\t\t\t= require(\"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase\");\r\n\r\nclass Filter3DBase\r\n{\r\n\tprivate _tasks:Array<Filter3DTaskBase>;\r\n\tprivate _requireDepthRender:boolean;\r\n\tprivate _textureWidth:number;\r\n\tprivate _textureHeight:number;\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tthis._tasks = new Array<Filter3DTaskBase>();\r\n\t}\r\n\r\n\tpublic get requireDepthRender():boolean\r\n\t{\r\n\t\treturn this._requireDepthRender;\r\n\t}\r\n\r\n\tpublic pAddTask(filter:Filter3DTaskBase)\r\n\t{\r\n\t\tthis._tasks.push(filter);\r\n\r\n\t\tif (this._requireDepthRender == null)\r\n\t\t\tthis._requireDepthRender = filter.requireDepthRender;\r\n\t}\r\n\r\n\tpublic get tasks():Filter3DTaskBase[]\r\n\t{\r\n\t\treturn this._tasks;\r\n\t}\r\n\r\n\tpublic getMainInputTexture(stage:Stage):ITexture\r\n\t{\r\n\t\treturn this._tasks[0].getMainInputTexture(stage);\r\n\t}\r\n\r\n\tpublic get textureWidth():number\r\n\t{\r\n\t\treturn this._textureWidth;\r\n\t}\r\n\r\n\tpublic set textureWidth(value:number)\r\n\t{\r\n\t\tthis._textureWidth = value;\r\n\r\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\r\n\t\t\tthis._tasks[i].textureWidth = value;\r\n\t}\r\n\r\n\tpublic get textureHeight():number\r\n\t{\r\n\t\treturn this._textureHeight;\r\n\t}\r\n\r\n\tpublic set textureHeight(value:number)\r\n\t{\r\n\t\tthis._textureHeight = value;\r\n\r\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\r\n\t\t\tthis._tasks[i].textureHeight = value;\r\n\t}\r\n\r\n\t// link up the filters correctly with the next filter\r\n\tpublic setRenderTargets(mainTarget:ITexture, stage:Stage)\r\n\t{\r\n\t\tthis._tasks[this._tasks.length - 1].target = mainTarget;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var i:number = 0; i < this._tasks.length; ++i)\r\n\t\t\tthis._tasks[i].dispose();\r\n\t}\r\n\r\n\tpublic update(stage:Stage, camera:Camera)\r\n\t{\r\n\r\n\t}\r\n}\r\n\r\nexport = Filter3DBase;",
    "import AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport ByteArray\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport AGALMiniAssembler\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\r\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IProgram\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\r\nimport ITexture\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITexture\");\r\n\r\nclass Filter3DTaskBase\r\n{\r\n\tprivate _mainInputTexture:ITexture;\r\n\r\n\tprivate _scaledTextureWidth:number = -1;\r\n\tprivate _scaledTextureHeight:number = -1;\r\n\tprivate _textureWidth:number = -1;\r\n\tprivate _textureHeight:number = -1;\r\n\tprivate _textureDimensionsInvalid:boolean = true;\r\n\tprivate _program3DInvalid:boolean = true;\r\n\tprivate _program3D:IProgram;\r\n\tprivate _target:ITexture;\r\n\tprivate _requireDepthRender:boolean;\r\n\tprivate _textureScale:number = 0;\r\n\r\n\tconstructor(requireDepthRender:boolean = false)\r\n\t{\r\n\r\n\t\tthis._requireDepthRender = requireDepthRender;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * The texture scale for the input of this texture. This will define the output of the previous entry in the chain\r\n\t */\r\n\tpublic get textureScale():number\r\n\t{\r\n\t\treturn this._textureScale;\r\n\t}\r\n\r\n\tpublic set textureScale(value:number)\r\n\t{\r\n\t\tif (this._textureScale == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._textureScale = value;\r\n\t\tthis._scaledTextureWidth = this._textureWidth >> this._textureScale;\r\n\t\tthis._scaledTextureHeight = this._textureHeight >> this._textureScale;\r\n\t\tthis._textureDimensionsInvalid = true;\r\n\t}\r\n\r\n\tpublic get target():ITexture\r\n\t{\r\n\t\treturn this._target;\r\n\t}\r\n\r\n\tpublic set target(value:ITexture)\r\n\t{\r\n\t\tthis._target = value;\r\n\t}\r\n\r\n\tpublic get textureWidth():number\r\n\t{\r\n\t\treturn this._textureWidth;\r\n\t}\r\n\r\n\tpublic set textureWidth(value:number)\r\n\t{\r\n\t\tif (this._textureWidth == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._textureWidth = value;\r\n\t\tthis._scaledTextureWidth = this._textureWidth >> this._textureScale;\r\n\t\tthis._textureDimensionsInvalid = true;\r\n\t}\r\n\r\n\tpublic get textureHeight():number\r\n\t{\r\n\t\treturn this._textureHeight;\r\n\t}\r\n\r\n\tpublic set textureHeight(value:number)\r\n\t{\r\n\t\tif (this._textureHeight == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._textureHeight = value;\r\n\t\tthis._scaledTextureHeight = this._textureHeight >> this._textureScale;\r\n\t\tthis._textureDimensionsInvalid = true;\r\n\t}\r\n\r\n\tpublic getMainInputTexture(stage:Stage):ITexture\r\n\t{\r\n\t\tif (this._textureDimensionsInvalid)\r\n\t\t\tthis.pUpdateTextures(stage);\r\n\r\n\t\treturn this._mainInputTexture;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tif (this._mainInputTexture)\r\n\t\t\tthis._mainInputTexture.dispose();\r\n\r\n\t\tif (this._program3D)\r\n\t\t\tthis._program3D.dispose();\r\n\t}\r\n\r\n\tpublic pInvalidateProgram()\r\n\t{\r\n\t\tthis._program3DInvalid = true;\r\n\t}\r\n\r\n\tpublic pUpdateProgram(stage:Stage)\r\n\t{\r\n\t\tif (this._program3D)\r\n\t\t\tthis._program3D.dispose();\r\n\r\n\t\tthis._program3D = stage.context.createProgram();\r\n\r\n\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + this.pGetVertexCode() + \"endpart\"))['vertex'].data;\r\n\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + this.pGetFragmentCode() + \"endpart\"))['fragment'].data;\r\n\t\tthis._program3D.upload(vertexByteCode, fragmentByteCode);\r\n\t\tthis._program3DInvalid = false;\r\n\t}\r\n\r\n\tpublic pGetVertexCode():string\r\n\t{\r\n\t\t// TODO: imeplement AGAL <> GLSL\r\n\r\n\t\treturn \"mov op, va0\\n\" + \"mov v0, va1\\n\";\r\n\t}\r\n\r\n\tpublic pGetFragmentCode():string\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tpublic pUpdateTextures(stage:Stage)\r\n\t{\r\n\t\tif (this._mainInputTexture)\r\n\t\t\tthis._mainInputTexture.dispose();\r\n\r\n\t\tthis._mainInputTexture = stage.context.createTexture(this._scaledTextureWidth, this._scaledTextureHeight, ContextGLTextureFormat.BGRA, true);\r\n\r\n\t\tthis._textureDimensionsInvalid = false;\r\n\t}\r\n\r\n\tpublic getProgram(stage:Stage):IProgram\r\n\t{\r\n\t\tif (this._program3DInvalid)\r\n\t\t\tthis.pUpdateProgram(stage);\r\n\r\n\t\treturn this._program3D;\r\n\t}\r\n\r\n\tpublic activate(stage:Stage, camera:Camera, depthTexture:ITexture)\r\n\t{\r\n\t}\r\n\r\n\tpublic deactivate(stage:Stage)\r\n\t{\r\n\t}\r\n\r\n\tpublic get requireDepthRender():boolean\r\n\t{\r\n\t\treturn this._requireDepthRender;\r\n\t}\r\n\r\n}\r\n\r\nexport = Filter3DTaskBase;",
    "import BitmapData\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\r\nimport AssetType\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetType\");\r\nimport BitmapTexture\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport BasicMaterial\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\n\r\nclass DefaultMaterialManager\r\n{\r\n\tprivate static _defaultBitmapData:BitmapData;\r\n\tprivate static _defaultTriangleMaterial:BasicMaterial;\r\n\tprivate static _defaultLineMaterial:BasicMaterial;\r\n\tprivate static _defaultTexture:BitmapTexture;\r\n\r\n\tpublic static getDefaultMaterial(renderableOwner:IRenderableOwner = null):BasicMaterial\r\n\t{\r\n\t\tif (renderableOwner != null && renderableOwner.assetType == AssetType.LINE_SUB_MESH) {\r\n\t\t\tif (!DefaultMaterialManager._defaultLineMaterial)\r\n\t\t\t\tDefaultMaterialManager.createDefaultLineMaterial();\r\n\t\t\treturn DefaultMaterialManager._defaultLineMaterial;\r\n\t\t} else {\r\n\t\t\tif (!DefaultMaterialManager._defaultTriangleMaterial)\r\n\t\t\t\tDefaultMaterialManager.createDefaultTriangleMaterial();\r\n\t\t\treturn DefaultMaterialManager._defaultTriangleMaterial;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static getDefaultTexture(renderableOwner:IRenderableOwner = null):BitmapTexture\r\n\t{\r\n\t\tif (!DefaultMaterialManager._defaultTexture)\r\n\t\t\tDefaultMaterialManager.createDefaultTexture();\r\n\t\treturn DefaultMaterialManager._defaultTexture;\r\n\t}\r\n\r\n\tprivate static createDefaultTexture()\r\n\t{\r\n\t\tDefaultMaterialManager._defaultBitmapData = DefaultMaterialManager.createCheckeredBitmapData();\r\n\t\tDefaultMaterialManager._defaultTexture = new BitmapTexture(DefaultMaterialManager._defaultBitmapData);\r\n\t\tDefaultMaterialManager._defaultTexture.name = \"defaultTexture\";\r\n\t}\r\n\r\n\tpublic static createCheckeredBitmapData():BitmapData\r\n\t{\r\n\t\tvar b:BitmapData = new BitmapData(8, 8, false, 0x000000);\r\n\t\t//create chekerboard\r\n\t\tvar i:number, j:number;\r\n\t\tfor (i = 0; i < 8; i++) {\r\n\t\t\tfor (j = 0; j < 8; j++) {\r\n\t\t\t\tif ((j & 1) ^ (i & 1)) {\r\n\t\t\t\t\tb.setPixel(i, j, 0XFFFFFF);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn b;\r\n\t}\r\n\r\n\tprivate static createDefaultTriangleMaterial()\r\n\t{\r\n\t\tif (!DefaultMaterialManager._defaultTexture)\r\n\t\t\tDefaultMaterialManager.createDefaultTexture();\r\n\t\tDefaultMaterialManager._defaultTriangleMaterial = new BasicMaterial(DefaultMaterialManager._defaultTexture);\r\n\t\tDefaultMaterialManager._defaultTriangleMaterial.mipmap = false;\r\n\t\tDefaultMaterialManager._defaultTriangleMaterial.smooth = false;\r\n\t\tDefaultMaterialManager._defaultTriangleMaterial.name = \"defaultTriangleMaterial\";\r\n\t}\r\n\r\n\tprivate static createDefaultLineMaterial()\r\n\t{\r\n\t\tDefaultMaterialManager._defaultLineMaterial = new BasicMaterial();\r\n\t\tDefaultMaterialManager._defaultLineMaterial.name = \"defaultLineMaterial\";\r\n\t}\r\n}\r\n\r\nexport = DefaultMaterialManager;",
    "import Rectangle\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport TextureUtils\t\t\t\t\t= require(\"awayjs-core/lib/utils/TextureUtils\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IIndexBuffer\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IIndexBuffer\");\r\nimport IVertexBuffer\t\t\t\t= require(\"awayjs-stagegl/lib/base/IVertexBuffer\");\r\n\r\nclass RTTBufferManager extends EventDispatcher\r\n{\r\n\tprivate static _instances:Array<RTTBufferManagerVO>;\r\n\r\n\tprivate _renderToTextureVertexBuffer:IVertexBuffer;\r\n\tprivate _renderToScreenVertexBuffer:IVertexBuffer;\r\n\r\n\tprivate _indexBuffer:IIndexBuffer;\r\n\tprivate _stage:Stage;\r\n\tprivate _viewWidth:number = -1;\r\n\tprivate _viewHeight:number = -1;\r\n\tprivate _textureWidth:number = -1;\r\n\tprivate _textureHeight:number = -1;\r\n\tprivate _renderToTextureRect:Rectangle;\r\n\tprivate _buffersInvalid:boolean = true;\r\n\r\n\tprivate _textureRatioX:number;\r\n\tprivate _textureRatioY:number;\r\n\r\n\tconstructor(stage:Stage)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._renderToTextureRect = new Rectangle();\r\n\r\n\t\tthis._stage = stage;\r\n\r\n\t}\r\n\r\n\tpublic static getInstance(stage:Stage):RTTBufferManager\r\n\t{\r\n\t\tif (!stage)\r\n\t\t\tthrow new Error(\"stage key cannot be null!\");\r\n\r\n\t\tif (RTTBufferManager._instances == null)\r\n\t\t\tRTTBufferManager._instances = new Array<RTTBufferManagerVO>();\r\n\r\n\t\tvar rttBufferManager:RTTBufferManager = RTTBufferManager.getRTTBufferManagerFromStage(stage);\r\n\r\n\t\tif (rttBufferManager == null) {\r\n\t\t\trttBufferManager = new RTTBufferManager(stage);\r\n\r\n\t\t\tvar vo:RTTBufferManagerVO = new RTTBufferManagerVO();\r\n\r\n\t\t\tvo.stage3d = stage;\r\n\t\t\tvo.rttbfm = rttBufferManager;\r\n\r\n\t\t\tRTTBufferManager._instances.push(vo);\r\n\t\t}\r\n\r\n\t\treturn rttBufferManager;\r\n\r\n\t}\r\n\r\n\tprivate static getRTTBufferManagerFromStage(stage:Stage):RTTBufferManager\r\n\t{\r\n\r\n\t\tvar l:number = RTTBufferManager._instances.length;\r\n\t\tvar r:RTTBufferManagerVO;\r\n\r\n\t\tfor (var c:number = 0; c < l; c++) {\r\n\t\t\tr = RTTBufferManager._instances[ c ];\r\n\r\n\t\t\tif (r.stage3d === stage)\r\n\t\t\t\treturn r.rttbfm;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate static deleteRTTBufferManager(stage:Stage):void\r\n\t{\r\n\t\tvar l:number = RTTBufferManager._instances.length;\r\n\t\tvar r:RTTBufferManagerVO;\r\n\r\n\t\tfor (var c:number = 0; c < l; c++) {\r\n\t\t\tr = RTTBufferManager._instances[ c ];\r\n\r\n\t\t\tif (r.stage3d === stage) {\r\n\t\t\t\tRTTBufferManager._instances.splice(c, 1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get textureRatioX():number\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._textureRatioX;\r\n\t}\r\n\r\n\tpublic get textureRatioY():number\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._textureRatioY;\r\n\t}\r\n\r\n\tpublic get viewWidth():number\r\n\t{\r\n\t\treturn this._viewWidth;\r\n\t}\r\n\r\n\tpublic set viewWidth(value:number)\r\n\t{\r\n\t\tif (value == this._viewWidth)\r\n\t\t\treturn;\r\n\r\n\t\tthis._viewWidth = value;\r\n\r\n\t\tthis._buffersInvalid = true;\r\n\r\n\t\tthis._textureWidth = TextureUtils.getBestPowerOf2(this._viewWidth);\r\n\r\n\t\tif (this._textureWidth > this._viewWidth) {\r\n\t\t\tthis._renderToTextureRect.x = Math.floor((this._textureWidth - this._viewWidth)*.5);\r\n\t\t\tthis._renderToTextureRect.width = this._viewWidth;\r\n\t\t} else {\r\n\t\t\tthis._renderToTextureRect.x = 0;\r\n\t\t\tthis._renderToTextureRect.width = this._textureWidth;\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent(new Event(Event.RESIZE));\r\n\t}\r\n\r\n\tpublic get viewHeight():number\r\n\t{\r\n\t\treturn this._viewHeight;\r\n\t}\r\n\r\n\tpublic set viewHeight(value:number)\r\n\t{\r\n\t\tif (value == this._viewHeight)\r\n\t\t\treturn;\r\n\r\n\t\tthis._viewHeight = value;\r\n\r\n\t\tthis._buffersInvalid = true;\r\n\r\n\t\tthis._textureHeight = TextureUtils.getBestPowerOf2(this._viewHeight);\r\n\r\n\t\tif (this._textureHeight > this._viewHeight) {\r\n\t\t\tthis._renderToTextureRect.y = Math.floor((this._textureHeight - this._viewHeight)*.5);\r\n\t\t\tthis._renderToTextureRect.height = this._viewHeight;\r\n\t\t} else {\r\n\t\t\tthis._renderToTextureRect.y = 0;\r\n\t\t\tthis._renderToTextureRect.height = this._textureHeight;\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent(new Event(Event.RESIZE));\r\n\t}\r\n\r\n\tpublic get renderToTextureVertexBuffer():IVertexBuffer\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._renderToTextureVertexBuffer;\r\n\t}\r\n\r\n\tpublic get renderToScreenVertexBuffer():IVertexBuffer\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._renderToScreenVertexBuffer;\r\n\r\n\t}\r\n\r\n\tpublic get indexBuffer():IIndexBuffer\r\n\t{\r\n\t\treturn this._indexBuffer;\r\n\t}\r\n\r\n\tpublic get renderToTextureRect():Rectangle\r\n\t{\r\n\t\tif (this._buffersInvalid)\r\n\t\t\tthis.updateRTTBuffers();\r\n\r\n\t\treturn this._renderToTextureRect;\r\n\t}\r\n\r\n\tpublic get textureWidth():number\r\n\t{\r\n\t\treturn this._textureWidth;\r\n\t}\r\n\r\n\tpublic get textureHeight():number\r\n\t{\r\n\t\treturn this._textureHeight;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tRTTBufferManager.deleteRTTBufferManager(this._stage);\r\n\r\n\t\tif (this._indexBuffer) {\r\n\t\t\tthis._indexBuffer.dispose();\r\n\t\t\tthis._renderToScreenVertexBuffer.dispose();\r\n\t\t\tthis._renderToTextureVertexBuffer.dispose();\r\n\t\t\tthis._renderToScreenVertexBuffer = null;\r\n\t\t\tthis._renderToTextureVertexBuffer = null;\r\n\t\t\tthis._indexBuffer = null;\r\n\t\t}\r\n\t}\r\n\r\n\t// todo: place all this in a separate model, since it's used all over the place\r\n\t// maybe it even has a place in the core (together with screenRect etc)?\r\n\t// needs to be stored per view of course\r\n\tprivate updateRTTBuffers()\r\n\t{\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tvar textureVerts:number[];\r\n\t\tvar screenVerts:number[];\r\n\r\n\t\tvar x:number;\r\n\t\tvar y:number;\r\n\r\n\t\tif (this._renderToTextureVertexBuffer == null)\r\n\t\t\tthis._renderToTextureVertexBuffer = context.createVertexBuffer(4, 5);\r\n\r\n\t\tif (this._renderToScreenVertexBuffer == null)\r\n\t\t\tthis._renderToScreenVertexBuffer = context.createVertexBuffer(4, 5);\r\n\r\n\t\tif (!this._indexBuffer) {\r\n\t\t\tthis._indexBuffer = context.createIndexBuffer(6);\r\n\r\n\t\t\tthis._indexBuffer.uploadFromArray([2, 1, 0, 3, 2, 0], 0, 6);\r\n\t\t}\r\n\r\n\t\tthis._textureRatioX = x = Math.min(this._viewWidth/this._textureWidth, 1);\r\n\t\tthis._textureRatioY = y = Math.min(this._viewHeight/this._textureHeight, 1);\r\n\r\n\t\tvar u1:number = (1 - x)*.5;\r\n\t\tvar u2:number = (x + 1)*.5;\r\n\t\tvar v1:number = (y + 1)*.5;\r\n\t\tvar v2:number = (1 - y)*.5;\r\n\r\n\t\t// last element contains indices for data per vertex that can be passed to the vertex shader if necessary (ie: frustum corners for deferred rendering)\r\n\t\ttextureVerts = [    -x, -y, u1, v1, 0, x, -y, u2, v1, 1, x, y, u2, v2, 2, -x, y, u1, v2, 3 ];\r\n\r\n\t\tscreenVerts = [     -1, -1, u1, v1, 0, 1, -1, u2, v1, 1, 1, 1, u2, v2, 2, -1, 1, u1, v2, 3 ];\r\n\r\n\t\tthis._renderToTextureVertexBuffer.uploadFromArray(textureVerts, 0, 4);\r\n\t\tthis._renderToScreenVertexBuffer.uploadFromArray(screenVerts, 0, 4);\r\n\r\n\t\tthis._buffersInvalid = false;\r\n\t}\r\n}\r\n\r\nexport = RTTBufferManager;\r\n\r\nclass RTTBufferManagerVO\r\n{\r\n\tpublic stage3d:Stage;\r\n\r\n\tpublic rttbfm:RTTBufferManager;\r\n}",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\r\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\r\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n\r\n/**\r\n * BasicMaterialPass forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass BasicMaterialPass extends RenderPassBase\r\n{\r\n\tprivate _diffuseR:number = 1;\r\n\tprivate _diffuseG:number = 1;\r\n\tprivate _diffuseB:number = 1;\r\n\tprivate _diffuseA:number = 1;\r\n\r\n\tprivate _fragmentConstantsIndex:number;\r\n\tprivate _texturesIndex:number;\r\n\r\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\r\n\r\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tsuper._iIncludeDependencies(shaderObject);\r\n\r\n\t\tif (shaderObject.texture != null)\r\n\t\t\tshaderObject.uvDependencies++;\r\n\r\n    }\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n        var alphaReg:ShaderRegisterElement;\r\n\r\n        if (this.preserveAlpha) {\r\n            alphaReg = regCache.getFreeFragmentSingleTemp();\r\n            regCache.addFragmentTempUsages(alphaReg, 1);\r\n            code += \"mov \" + alphaReg + \", \" + sharedReg.shadedTarget + \".w\\n\";\r\n        }\r\n\r\n\t\tvar targetReg:ShaderRegisterElement = sharedReg.shadedTarget;\r\n\t\tvar diffuseInputReg:ShaderRegisterElement;\r\n\r\n\t\tif (shaderObject.texture != null) {\r\n\t\t\tdiffuseInputReg = regCache.getFreeTextureReg();\r\n\r\n\t\t\tthis._texturesIndex = diffuseInputReg.index;\r\n\r\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(targetReg, sharedReg, diffuseInputReg, shaderObject.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\r\n\r\n\t\t\tif (shaderObject.alphaThreshold > 0) {\r\n\t\t\t\tvar cutOffReg:ShaderRegisterElement = regCache.getFreeFragmentConstant();\r\n\t\t\t\tthis._fragmentConstantsIndex = cutOffReg.index*4;\r\n\r\n\t\t\t\tcode += \"sub \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\" + \"kil \" + targetReg + \".w\\n\" + \"add \" + targetReg + \".w, \" + targetReg + \".w, \" + cutOffReg + \".x\\n\";\r\n\t\t\t}\r\n\t\t} else if (shaderObject.colorBufferIndex != -1) {\r\n\r\n\t\t\tcode += \"mov \" + targetReg + \", \" + sharedReg.colorVarying + \"\\n\";\r\n\t\t} else {\r\n\t\t\tdiffuseInputReg = regCache.getFreeFragmentConstant();\r\n\r\n\t\t\tthis._fragmentConstantsIndex = diffuseInputReg.index*4;\r\n\r\n\t\t\tcode += \"mov \" + targetReg + \", \" + diffuseInputReg + \"\\n\";\r\n\t\t}\r\n\r\n        if (this.preserveAlpha) {\r\n            code += \"mul \" + sharedReg.shadedTarget + \".w, \" + sharedReg.shadedTarget + \".w, \" + alphaReg + \"\\n\";\r\n            regCache.removeFragmentTempUsage(alphaReg);\r\n        }\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tif (this._shader.texture != null) {\r\n\t\t\tthis._stage.activateTexture(this._texturesIndex, this._shader.texture, this._shader.repeatTextures, this._shader.useSmoothTextures, this._shader.useMipmapping);\r\n\r\n\t\t\tif (this._shader.alphaThreshold > 0)\r\n\t\t\t\tthis._shader.fragmentConstantData[this._fragmentConstantsIndex] = this._shader.alphaThreshold;\r\n\t\t} else if (this._shader.colorBufferIndex == -1) {\r\n\t\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\t\tvar data:Array<number> = this._shader.fragmentConstantData;\r\n\t\t\tdata[index] = this._diffuseR;\r\n\t\t\tdata[index + 1] = this._diffuseG;\r\n\t\t\tdata[index + 2] = this._diffuseB;\r\n\t\t\tdata[index + 3] = this._diffuseA;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = BasicMaterialPass;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\n\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\r\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\r\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * DepthRenderObject forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass DepthPass extends RenderPassBase\r\n{\r\n\r\n\tprivate _fragmentConstantsIndex:number;\r\n\tprivate _texturesIndex:number;\r\n\r\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\r\n\r\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tsuper._iIncludeDependencies(shaderObject);\r\n\r\n\t\tshaderObject.projectionDependencies++;\r\n\r\n\t\tif (shaderObject.alphaThreshold > 0)\r\n\t\t\tshaderObject.uvDependencies++;\r\n\t}\r\n\r\n\r\n\tpublic _iInitConstantData(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tsuper._iInitConstantData(shaderObject);\r\n\r\n\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\r\n\t\tdata[index] = 1.0;\r\n\t\tdata[index + 1] = 255.0;\r\n\t\tdata[index + 2] = 65025.0;\r\n\t\tdata[index + 3] = 16581375.0;\r\n\t\tdata[index + 4] = 1.0/255.0;\r\n\t\tdata[index + 5] = 1.0/255.0;\r\n\t\tdata[index + 6] = 1.0/255.0;\r\n\t\tdata[index + 7] = 0.0;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\t\tvar targetReg:ShaderRegisterElement = sharedRegisters.shadedTarget;\r\n\t\tvar diffuseInputReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\r\n\t\tvar dataReg1:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\r\n\t\tthis._fragmentConstantsIndex = dataReg1.index*4;\r\n\r\n\t\tvar temp1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp1, 1);\r\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp2, 1);\r\n\r\n\t\tcode += \"div \" + temp1 + \", \" + sharedRegisters.projectionFragment + \", \" + sharedRegisters.projectionFragment + \".w\\n\" + //\"sub ft2.z, fc0.x, ft2.z\\n\" +    //invert\r\n\t\t\"mul \" + temp1 + \", \" + dataReg1 + \", \" + temp1 + \".z\\n\" +\r\n\t\t\"frc \" + temp1 + \", \" + temp1 + \"\\n\" +\r\n\t\t\"mul \" + temp2 + \", \" + temp1 + \".yzww, \" + dataReg2 + \"\\n\";\r\n\r\n\t\t//codeF += \"mov ft1.w, fc1.w\t\\n\" +\r\n\t\t//    \"mov ft0.w, fc0.x\t\\n\";\r\n\r\n\t\tif (shaderObject.texture && shaderObject.alphaThreshold > 0) {\r\n\t\t\tdiffuseInputReg = registerCache.getFreeTextureReg();\r\n\r\n\t\t\tthis._texturesIndex = diffuseInputReg.index;\r\n\r\n\t\t\tvar albedo:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(albedo, sharedRegisters, diffuseInputReg, shaderObject.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\r\n\r\n\t\t\tvar cutOffReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\r\n\t\t\tcode += \"sub \" + albedo + \".w, \" + albedo + \".w, \" + cutOffReg + \".x\\n\" +\r\n\t\t\t\"kil \" + albedo + \".w\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"sub \" + targetReg + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\r\n\t\tregisterCache.removeFragmentTempUsage(temp1);\r\n\t\tregisterCache.removeFragmentTempUsage(temp2);\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\r\n\t\tif (this._shader.texture && this._shader.alphaThreshold > 0) {\r\n\t\t\tthis._stage.activateTexture(this._texturesIndex, this._shader.texture, this._shader.repeatTextures, this._shader.useSmoothTextures, this._shader.useMipmapping);\r\n\r\n\t\t\tthis._shader.fragmentConstantData[this._fragmentConstantsIndex + 8] = this._shader.alphaThreshold;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = DepthPass;",
    "﻿import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\n\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\r\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\r\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * DistancePass is a pass that writes distance values to a depth map as a 32-bit value exploded over the 4 texture channels.\r\n * This is used to render omnidirectional shadow maps.\r\n */\r\nclass DistancePass extends RenderPassBase\r\n{\r\n\tprivate _fragmentConstantsIndex:number;\r\n\tprivate _texturesIndex:number;\r\n\r\n\t/**\r\n\t * Creates a new DistancePass object.\r\n\t *\r\n\t * @param material The material to which this pass belongs.\r\n\t */\r\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\r\n\r\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\r\n\t}\r\n\r\n\t/**\r\n\t * Initializes the unchanging constant data for this material.\r\n\t */\r\n\tpublic _iInitConstantData(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tsuper._iInitConstantData(shaderObject);\r\n\r\n\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\tvar data:Array<number> = shaderObject.fragmentConstantData;\r\n\t\tdata[index + 4] = 1.0/255.0;\r\n\t\tdata[index + 5] = 1.0/255.0;\r\n\t\tdata[index + 6] = 1.0/255.0;\r\n\t\tdata[index + 7] = 0.0;\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tsuper._iIncludeDependencies(shaderObject);\r\n\r\n\t\tshaderObject.projectionDependencies++;\r\n\t\tshaderObject.viewDirDependencies++;\r\n\r\n\t\tif (shaderObject.alphaThreshold > 0)\r\n\t\t\tshaderObject.uvDependencies++;\r\n\r\n\t\tif (shaderObject.viewDirDependencies > 0)\r\n\t\t\tshaderObject.globalPosDependencies++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string;\r\n\t\tvar targetReg:ShaderRegisterElement = sharedRegisters.shadedTarget;\r\n\t\tvar diffuseInputReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\r\n\t\tvar dataReg1:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\t\tvar dataReg2:ShaderRegisterElement = registerCache.getFreeFragmentConstant()\r\n\r\n\t\tthis._fragmentConstantsIndex = dataReg1.index*4;\r\n\r\n\t\tvar temp1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp1, 1);\r\n\t\tvar temp2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(temp2, 1);\r\n\r\n\t\t// squared distance to view\r\n\t\tcode = \"dp3 \" + temp1 + \".z, \" + sharedRegisters.viewDirVarying + \".xyz, \" + sharedRegisters.viewDirVarying + \".xyz\\n\" +\r\n\t\t\t   \"mul \" + temp1 + \", \" + dataReg1 + \", \" + temp1 + \".z\\n\" +\r\n\t\t\t   \"frc \" + temp1 + \", \" + temp1 + \"\\n\" +\r\n\t\t\t   \"mul \" + temp2 + \", \" + temp1 + \".yzww, \" + dataReg2 + \"\\n\";\r\n\r\n\t\tif (shaderObject.alphaThreshold > 0) {\r\n\t\t\tdiffuseInputReg = registerCache.getFreeTextureReg();\r\n\r\n\t\t\tthis._texturesIndex = diffuseInputReg.index;\r\n\r\n\t\t\tvar albedo:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\t\tcode += ShaderCompilerHelper.getTex2DSampleCode(albedo, sharedRegisters, diffuseInputReg, shaderObject.texture, shaderObject.useSmoothTextures, shaderObject.repeatTextures, shaderObject.useMipmapping);\r\n\r\n\t\t\tvar cutOffReg:ShaderRegisterElement = registerCache.getFreeFragmentConstant();\r\n\r\n\t\t\tcode += \"sub \" + albedo + \".w, \" + albedo + \".w, \" + cutOffReg + \".x\\n\" +\r\n\t\t\t\t\"kil \" + albedo + \".w\\n\";\r\n\t\t}\r\n\r\n\t\tcode += \"sub \" + targetReg + \", \" + temp1 + \", \" + temp2 + \"\\n\";\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\r\n\t\tvar f:number = camera.projection.far;\r\n\r\n\t\tf = 1/(2*f*f);\r\n\t\t// sqrt(f*f+f*f) is largest possible distance for any frustum, so we need to divide by it. Rarely a tight fit, but with 32 bits precision, it's enough.\r\n\t\tvar index:number = this._fragmentConstantsIndex;\r\n\t\tvar data:Array<number> = this._shader.fragmentConstantData;\r\n\t\tdata[index] = 1.0*f;\r\n\t\tdata[index + 1] = 255.0*f;\r\n\t\tdata[index + 2] = 65025.0*f;\r\n\t\tdata[index + 3] = 16581375.0*f;\r\n\r\n\t\tif (this._shader.alphaThreshold > 0) {\r\n\t\t\tthis._stage.activateTexture(this._texturesIndex, this._shader.texture, this._shader.repeatTextures, this._shader.useSmoothTextures, this._shader.useMipmapping);\r\n\r\n\t\t\tdata[index + 8] = this._shader.alphaThreshold;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = DistancePass;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport NamedAssetBase\t\t\t\t= require(\"awayjs-core/lib/library/NamedAssetBase\");\r\nimport ArgumentError\t\t\t\t= require(\"awayjs-core/lib/errors/ArgumentError\");\r\nimport Event\t\t\t\t\t\t= require(\"awayjs-core/lib/events/Event\");\r\nimport EventDispatcher\t\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport LightPickerBase\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\")\r\nimport ContextGLBlendFactor\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\n\r\nimport AnimationSetBase\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport IRenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/IRenderPassBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\n\r\n/**\r\n * RenderPassBase provides an abstract base class for material shader passes. A material pass constitutes at least\r\n * a render call per required renderable.\r\n */\r\nclass RenderPassBase extends EventDispatcher implements IRenderPassBase\r\n{\r\n\tprivate _renderObject:RenderObjectBase;\r\n\tpublic _renderObjectOwner:IRenderObjectOwner;\r\n\tpublic _renderableClass:IRenderableClass;\r\n\tpublic _stage:Stage;\r\n\t\r\n\tpublic _shader:ShaderObjectBase;\r\n\r\n\tprivate _preserveAlpha:boolean = true;\r\n\tprivate _forceSeparateMVP:boolean = false;\r\n\r\n\tprivate _depthCompareMode:string = ContextGLCompareMode.LESS_EQUAL;\r\n\r\n\tprivate _blendFactorSource:string = ContextGLBlendFactor.ONE;\r\n\tprivate _blendFactorDest:string = ContextGLBlendFactor.ZERO;\r\n\r\n\tpublic _pEnableBlending:boolean = false;\r\n\r\n\tprivate _writeDepth:boolean = true;\r\n\r\n\tpublic get shader():ShaderObjectBase\r\n\t{\r\n\t\treturn this._shader;\r\n\t}\r\n\r\n\tpublic get animationSet():AnimationSetBase\r\n\t{\r\n\t\treturn <AnimationSetBase> this._renderObjectOwner.animationSet;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the output alpha value should remain unchanged compared to the material's original alpha.\r\n\t */\r\n\tpublic get preserveAlpha():boolean\r\n\t{\r\n\t\treturn this._preserveAlpha;\r\n\t}\r\n\r\n\tpublic set preserveAlpha(value:boolean)\r\n\t{\r\n\t\tif (this._preserveAlpha == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._preserveAlpha = value;\r\n\r\n\t\tthis.invalidatePass();\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the screen projection should be calculated by forcing a separate scene matrix and\r\n\t * view-projection matrix. This is used to prevent rounding errors when using multiple passes with different\r\n\t * projection code.\r\n\t */\r\n\tpublic get forceSeparateMVP():boolean\r\n\t{\r\n\t\treturn this._forceSeparateMVP;\r\n\t}\r\n\r\n\tpublic set forceSeparateMVP(value:boolean)\r\n\t{\r\n\t\tif (this._forceSeparateMVP == value)\r\n\t\t\treturn;\r\n\r\n\t\tthis._forceSeparateMVP = value;\r\n\r\n\t\tthis.invalidatePass();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new RenderPassBase object.\r\n\t */\r\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper();\r\n\r\n\t\tthis._renderObject = renderObject;\r\n\t\tthis._renderObjectOwner = renderObjectOwner;\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._stage = stage;\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * Indicate whether this pass should write to the depth buffer or not. Ignored when blending is enabled.\r\n\t */\r\n\tpublic get writeDepth():boolean\r\n\t{\r\n\t\treturn this._writeDepth;\r\n\t}\r\n\r\n\tpublic set writeDepth(value:boolean)\r\n\t{\r\n\t\tthis._writeDepth = value;\r\n\t}\r\n\r\n\t/**\r\n\t * The depth compare mode used to render the renderables using this material.\r\n\t *\r\n\t * @see away.stagegl.ContextGLCompareMode\r\n\t */\r\n\tpublic get depthCompareMode():string\r\n\t{\r\n\t\treturn this._depthCompareMode;\r\n\t}\r\n\r\n\tpublic set depthCompareMode(value:string)\r\n\t{\r\n\t\tthis._depthCompareMode = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Cleans up any resources used by the current object.\r\n\t * @param deep Indicates whether other resources should be cleaned up, that could potentially be shared across different instances.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._shader.dispose();\r\n\r\n\t\tthis._shader = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Renders the current pass. Before calling renderPass, activatePass needs to be called with the same index.\r\n\t * @param pass The pass used to render the renderable.\r\n\t * @param renderable The IRenderable object to draw.\r\n\t * @param stage The Stage object used for rendering.\r\n\t * @param entityCollector The EntityCollector object that contains the visible scene data.\r\n\t * @param viewProjection The view-projection matrix used to project to the screen. This is not the same as\r\n\t * camera.viewProjection as it includes the scaling factors when rendering to textures.\r\n\t *\r\n\t * @internal\r\n\t */\r\n\tpublic _iRender(renderable:RenderableBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tthis._shader._iRender(renderable, camera, viewProjection);\r\n\t}\r\n\t/**\r\n\t * The blend mode to use when drawing this renderable. The following blend modes are supported:\r\n\t * <ul>\r\n\t * <li>BlendMode.NORMAL: No blending, unless the material inherently needs it</li>\r\n\t * <li>BlendMode.LAYER: Force blending. This will draw the object the same as NORMAL, but without writing depth writes.</li>\r\n\t * <li>BlendMode.MULTIPLY</li>\r\n\t * <li>BlendMode.ADD</li>\r\n\t * <li>BlendMode.ALPHA</li>\r\n\t * </ul>\r\n\t */\r\n\tpublic setBlendMode(value:string)\r\n\t{\r\n\t\tswitch (value) {\r\n\t\t\tcase BlendMode.NORMAL:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ONE;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ZERO;\r\n\t\t\t\tthis._pEnableBlending = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.LAYER:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.SOURCE_ALPHA;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA;\r\n\t\t\t\tthis._pEnableBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.MULTIPLY:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ZERO;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.SOURCE_COLOR;\r\n\t\t\t\tthis._pEnableBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.ADD:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.SOURCE_ALPHA;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.ONE;\r\n\t\t\t\tthis._pEnableBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase BlendMode.ALPHA:\r\n\t\t\t\tthis._blendFactorSource = ContextGLBlendFactor.ZERO;\r\n\t\t\t\tthis._blendFactorDest = ContextGLBlendFactor.SOURCE_ALPHA;\r\n\t\t\t\tthis._pEnableBlending = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new ArgumentError(\"Unsupported blend mode!\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the render state for the pass that is independent of the rendered object. This needs to be called before\r\n\t * calling renderPass. Before activating a pass, the previously used pass needs to be deactivated.\r\n\t * @param stage The Stage object which is currently used for rendering.\r\n\t * @param camera The camera from which the scene is viewed.\r\n\t * @private\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tthis._stage.context.setDepthTest(( this._writeDepth && !this._pEnableBlending ), this._depthCompareMode);\r\n\r\n\t\tif (this._pEnableBlending)\r\n\t\t\tthis._stage.context.setBlendFactors(this._blendFactorSource, this._blendFactorDest);\r\n\r\n\t\tthis._shader._iActivate(camera);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the render state for the pass. This needs to be called before activating another pass.\r\n\t * @param stage The Stage used for rendering\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iDeactivate()\r\n\t{\r\n\t\tthis._shader._iDeactivate();\r\n\r\n\t\t//For the love of god don't remove this if you want your multi-material shadows to not flicker like shit\r\n\t\tthis._stage.context.setDepthTest(true, ContextGLCompareMode.LESS_EQUAL);\r\n\t}\r\n\r\n\t/**\r\n\t * Marks the shader program as invalid, so it will be recompiled before the next render.\r\n\t *\r\n\t * @param updateMaterial Indicates whether the invalidation should be performed on the entire material. Should always pass \"true\" unless it's called from the material itself.\r\n\t */\r\n\tpublic invalidatePass()\r\n\t{\r\n\t\tthis._shader.invalidateShader();\r\n\r\n\t\tthis.dispatchEvent(new Event(Event.CHANGE));\r\n\t}\r\n\r\n\tpublic _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tthis._renderObject._iIncludeDependencies(shaderObject);\r\n\t\t\r\n\t\tif (this._forceSeparateMVP)\r\n\t\t\tshaderObject.globalPosDependencies++;\r\n\t}\r\n\r\n\r\n\tpublic _iInitConstantData(shaderObject:ShaderObjectBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic _iGetPreLightingVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetPreLightingFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetNormalVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic _iGetNormalFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not normals are calculated at all.\r\n\t */\r\n\tpublic _pOutputsNormals(shaderObject:ShaderObjectBase):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not normals are calculated in tangent space.\r\n\t */\r\n\tpublic _pOutputsTangentNormals(shaderObject:ShaderObjectBase):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not normals are allowed in tangent space. This is only the case if no object-space\r\n\t * dependencies exist.\r\n\t */\r\n\tpublic _pUsesTangentSpace(shaderObject:ShaderObjectBase):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport = RenderPassBase;",
    "import BlendMode\t\t\t\t\t= require(\"awayjs-core/lib/base/BlendMode\");\r\nimport Matrix\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Texture2DBase\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\n\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\n\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\r\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\r\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\n\r\n/**\r\n * SkyboxPass forms an abstract base class for the default shaded materials provided by Stage,\r\n * using material methods to define their appearance.\r\n */\r\nclass SkyboxPass extends RenderPassBase\r\n{\r\n\tpublic _skybox:Skybox;\r\n\r\n\tconstructor(renderObject:RenderObjectBase, renderObjectOwner:IRenderObjectOwner, renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tsuper(renderObject, renderObjectOwner, renderableClass, stage);\r\n\r\n\t\tthis._skybox = <Skybox> renderObjectOwner;\r\n\r\n\t\tthis._shader = new ShaderObjectBase(renderableClass, this, this._stage);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t* @inheritDoc\r\n\t*/\r\n\tpublic _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\t//var cubeMapReg:ShaderRegisterElement = registerCache.getFreeTextureReg();\r\n\r\n\t\t//this._texturesIndex = cubeMapReg.index;\r\n\r\n\t\t//ShaderCompilerHelper.getTexCubeSampleCode(sharedRegisters.shadedTarget, cubeMapReg, this._cubeTexture, shaderObject.useSmoothTextures, shaderObject.useMipmapping);\r\n\r\n\t\tvar mip:string = \",mipnone\";\r\n\r\n\t\tif (shaderObject.useMipmapping)\r\n\t\t\tmip = \",miplinear\";\r\n\r\n\t\treturn \"tex ft0, v0, fs0 <cube,\" + ShaderCompilerHelper.getFormatStringForTexture(this._skybox.cubeMap) + \"linear,clamp\" + mip + \">\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(camera);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setDepthTest(false, ContextGLCompareMode.LESS);\r\n\t\tthis._stage.activateCubeTexture(0, this._skybox.cubeMap, this._shader.useSmoothTextures, this._shader.useMipmapping);\r\n\t}\r\n}\r\n\r\nexport = SkyboxPass;",
    "import Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport PickingCollisionVO\t\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\r\nimport IPickingCollider\t\t\t\t\t= require(\"awayjs-display/lib/pick/IPickingCollider\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport PickingColliderBase\t\t\t\t= require(\"awayjs-renderergl/lib/pick/PickingColliderBase\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * Pure JS picking collider for display objects. Used with the <code>RaycastPicker</code> picking object.\r\n *\r\n * @see away.base.DisplayObject#pickingCollider\r\n * @see away.pick.RaycastPicker\r\n *\r\n * @class away.pick.JSPickingCollider\r\n */\r\nclass JSPickingCollider extends PickingColliderBase implements IPickingCollider\r\n{\r\n\tprivate _findClosestCollision:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>JSPickingCollider</code> object.\r\n\t *\r\n\t * @param findClosestCollision Determines whether the picking collider searches for the closest collision along the ray. Defaults to false.\r\n\t */\r\n\tconstructor(stage:Stage, findClosestCollision:boolean = false)\r\n\t{\r\n\t\tsuper(stage);\r\n\r\n\t\tthis._findClosestCollision = findClosestCollision;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pTestRenderableCollision(renderable:RenderableBase, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number):boolean\r\n\t{\r\n\t\tvar t:number;\r\n\t\tvar i0:number, i1:number, i2:number;\r\n\t\tvar rx:number, ry:number, rz:number;\r\n\t\tvar nx:number, ny:number, nz:number;\r\n\t\tvar cx:number, cy:number, cz:number;\r\n\t\tvar coeff:number, u:number, v:number, w:number;\r\n\t\tvar p0x:number, p0y:number, p0z:number;\r\n\t\tvar p1x:number, p1y:number, p1z:number;\r\n\t\tvar p2x:number, p2y:number, p2z:number;\r\n\t\tvar s0x:number, s0y:number, s0z:number;\r\n\t\tvar s1x:number, s1y:number, s1z:number;\r\n\t\tvar nl:number, nDotV:number, D:number, disToPlane:number;\r\n\t\tvar Q1Q2:number, Q1Q1:number, Q2Q2:number, RQ1:number, RQ2:number;\r\n\t\tvar indexData:Array<number> = renderable.getIndexData().data;\r\n\t\tvar collisionTriangleIndex:number = -1;\r\n\t\tvar bothSides:boolean = (<MaterialBase> renderable.renderObjectOwner).bothSides;\r\n\r\n\t\tvar positionData:Array<number> = renderable.getVertexData(TriangleSubGeometry.POSITION_DATA).data;\r\n\t\tvar positionStride:number = renderable.getVertexData(TriangleSubGeometry.POSITION_DATA).dataPerVertex;\r\n\t\tvar positionOffset:number = renderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA);\r\n\t\tvar uvData:Array<number> = renderable.getVertexData(TriangleSubGeometry.UV_DATA).data;\r\n\t\tvar uvStride:number = renderable.getVertexData(TriangleSubGeometry.UV_DATA).dataPerVertex;\r\n\t\tvar uvOffset:number = renderable.getVertexOffset(TriangleSubGeometry.UV_DATA);\r\n\t\tvar numIndices:number = indexData.length;\r\n\r\n\t\tfor (var index:number = 0; index < numIndices; index += 3) { // sweep all triangles\r\n\t\t\t// evaluate triangle indices\r\n\t\t\ti0 = positionOffset + indexData[ index ]*positionStride;\r\n\t\t\ti1 = positionOffset + indexData[ (index + 1) ]*positionStride;\r\n\t\t\ti2 = positionOffset + indexData[ (index + 2) ]*positionStride;\r\n\r\n\t\t\t// evaluate triangle positions\r\n\t\t\tp0x = positionData[ i0 ];\r\n\t\t\tp0y = positionData[ (i0 + 1) ];\r\n\t\t\tp0z = positionData[ (i0 + 2) ];\r\n\t\t\tp1x = positionData[ i1 ];\r\n\t\t\tp1y = positionData[ (i1 + 1) ];\r\n\t\t\tp1z = positionData[ (i1 + 2) ];\r\n\t\t\tp2x = positionData[ i2 ];\r\n\t\t\tp2y = positionData[ (i2 + 1) ];\r\n\t\t\tp2z = positionData[ (i2 + 2) ];\r\n\r\n\t\t\t// evaluate sides and triangle normal\r\n\t\t\ts0x = p1x - p0x; // s0 = p1 - p0\r\n\t\t\ts0y = p1y - p0y;\r\n\t\t\ts0z = p1z - p0z;\r\n\t\t\ts1x = p2x - p0x; // s1 = p2 - p0\r\n\t\t\ts1y = p2y - p0y;\r\n\t\t\ts1z = p2z - p0z;\r\n\t\t\tnx = s0y*s1z - s0z*s1y; // n = s0 x s1\r\n\t\t\tny = s0z*s1x - s0x*s1z;\r\n\t\t\tnz = s0x*s1y - s0y*s1x;\r\n\t\t\tnl = 1/Math.sqrt(nx*nx + ny*ny + nz*nz); // normalize n\r\n\t\t\tnx *= nl;\r\n\t\t\tny *= nl;\r\n\t\t\tnz *= nl;\r\n\r\n\t\t\t// -- plane intersection test --\r\n\t\t\tnDotV = nx*this.rayDirection.x + ny* +this.rayDirection.y + nz*this.rayDirection.z; // rayDirection . normal\r\n\t\t\tif (( !bothSides && nDotV < 0.0 ) || ( bothSides && nDotV != 0.0 )) { // an intersection must exist\r\n\t\t\t\t// find collision t\r\n\t\t\t\tD = -( nx*p0x + ny*p0y + nz*p0z );\r\n\t\t\t\tdisToPlane = -( nx*this.rayPosition.x + ny*this.rayPosition.y + nz*this.rayPosition.z + D );\r\n\t\t\t\tt = disToPlane/nDotV;\r\n\t\t\t\t// find collision point\r\n\t\t\t\tcx = this.rayPosition.x + t*this.rayDirection.x;\r\n\t\t\t\tcy = this.rayPosition.y + t*this.rayDirection.y;\r\n\t\t\t\tcz = this.rayPosition.z + t*this.rayDirection.z;\r\n\t\t\t\t// collision point inside triangle? ( using barycentric coordinates )\r\n\t\t\t\tQ1Q2 = s0x*s1x + s0y*s1y + s0z*s1z;\r\n\t\t\t\tQ1Q1 = s0x*s0x + s0y*s0y + s0z*s0z;\r\n\t\t\t\tQ2Q2 = s1x*s1x + s1y*s1y + s1z*s1z;\r\n\t\t\t\trx = cx - p0x;\r\n\t\t\t\try = cy - p0y;\r\n\t\t\t\trz = cz - p0z;\r\n\t\t\t\tRQ1 = rx*s0x + ry*s0y + rz*s0z;\r\n\t\t\t\tRQ2 = rx*s1x + ry*s1y + rz*s1z;\r\n\t\t\t\tcoeff = 1/( Q1Q1*Q2Q2 - Q1Q2*Q1Q2 );\r\n\t\t\t\tv = coeff*( Q2Q2*RQ1 - Q1Q2*RQ2 );\r\n\t\t\t\tw = coeff*( -Q1Q2*RQ1 + Q1Q1*RQ2 );\r\n\t\t\t\tif (v < 0)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tif (w < 0)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tu = 1 - v - w;\r\n\t\t\t\tif (!( u < 0 ) && t > 0 && t < shortestCollisionDistance) { // all tests passed\r\n\t\t\t\t\tshortestCollisionDistance = t;\r\n\t\t\t\t\tcollisionTriangleIndex = index/3;\r\n\t\t\t\t\tpickingCollisionVO.rayEntryDistance = t;\r\n\t\t\t\t\tpickingCollisionVO.localPosition = new Vector3D(cx, cy, cz);\r\n\t\t\t\t\tpickingCollisionVO.localNormal = new Vector3D(nx, ny, nz);\r\n\t\t\t\t\tpickingCollisionVO.uv = this._pGetCollisionUV(indexData, uvData, index, v, w, u, uvOffset, uvStride);\r\n\t\t\t\t\tpickingCollisionVO.index = index;\r\n//\t\t\t\t\t\tpickingCollisionVO.subGeometryIndex = this.pGetMeshSubMeshIndex(renderable);\r\n\r\n\t\t\t\t\t// if not looking for best hit, first found will do...\r\n\t\t\t\t\tif (!this._findClosestCollision)\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (collisionTriangleIndex >= 0)\r\n\t\t\treturn true;\r\n\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport = JSPickingCollider;",
    "import Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AbstractMethodError\t\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\n\r\nimport ISubMesh\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/ISubMesh\");\r\nimport PickingCollisionVO\t\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\r\nimport Billboard\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport BillboardRenderable\t\t\t\t= require(\"awayjs-renderergl/lib/pool/BillboardRenderable\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport TriangleSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\r\nimport RenderablePoolBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\n\r\n/**\r\n * An abstract base class for all picking collider classes. It should not be instantiated directly.\r\n *\r\n * @class away.pick.PickingColliderBase\r\n */\r\nclass PickingColliderBase\r\n{\r\n\tprivate _billboardRenderablePool:RenderablePoolBase;\r\n\tprivate _subMeshRenderablePool:RenderablePoolBase;\r\n\r\n\tpublic rayPosition:Vector3D;\r\n\tpublic rayDirection:Vector3D;\r\n\r\n\tconstructor(stage:Stage)\r\n\t{\r\n\t\t//TODO\r\n\t\tthis._billboardRenderablePool = RenderablePoolBase.getPool(BillboardRenderable, stage);\r\n\t\tthis._subMeshRenderablePool = RenderablePoolBase.getPool(TriangleSubMeshRenderable, stage);\r\n\t}\r\n\r\n\tpublic _pPetCollisionNormal(indexData:Array<number> /*uint*/, vertexData:Array<number>, triangleIndex:number):Vector3D // PROTECTED\r\n\t{\r\n\t\tvar normal:Vector3D = new Vector3D();\r\n\t\tvar i0:number = indexData[ triangleIndex ]*3;\r\n\t\tvar i1:number = indexData[ triangleIndex + 1 ]*3;\r\n\t\tvar i2:number = indexData[ triangleIndex + 2 ]*3;\r\n\t\tvar p0:Vector3D = new Vector3D(vertexData[ i0 ], vertexData[ i0 + 1 ], vertexData[ i0 + 2 ]);\r\n\t\tvar p1:Vector3D = new Vector3D(vertexData[ i1 ], vertexData[ i1 + 1 ], vertexData[ i1 + 2 ]);\r\n\t\tvar p2:Vector3D = new Vector3D(vertexData[ i2 ], vertexData[ i2 + 1 ], vertexData[ i2 + 2 ]);\r\n\t\tvar side0:Vector3D = p1.subtract(p0);\r\n\t\tvar side1:Vector3D = p2.subtract(p0);\r\n\t\tnormal = side0.crossProduct(side1);\r\n\t\tnormal.normalize();\r\n\t\treturn normal;\r\n\t}\r\n\r\n\tpublic _pGetCollisionUV(indexData:Array<number> /*uint*/, uvData:Array<number>, triangleIndex:number, v:number, w:number, u:number, uvOffset:number, uvStride:number):Point // PROTECTED\r\n\t{\r\n\t\tvar uv:Point = new Point();\r\n\t\tvar uIndex:number = indexData[ triangleIndex ]*uvStride + uvOffset;\r\n\t\tvar uv0:Vector3D = new Vector3D(uvData[ uIndex ], uvData[ uIndex + 1 ]);\r\n\t\tuIndex = indexData[ triangleIndex + 1 ]*uvStride + uvOffset;\r\n\t\tvar uv1:Vector3D = new Vector3D(uvData[ uIndex ], uvData[ uIndex + 1 ]);\r\n\t\tuIndex = indexData[ triangleIndex + 2 ]*uvStride + uvOffset;\r\n\t\tvar uv2:Vector3D = new Vector3D(uvData[ uIndex ], uvData[ uIndex + 1 ]);\r\n\t\tuv.x = u*uv0.x + v*uv1.x + w*uv2.x;\r\n\t\tuv.y = u*uv0.y + v*uv1.y + w*uv2.y;\r\n\t\treturn uv;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pTestRenderableCollision(renderable:RenderableBase, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number):boolean\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic setLocalRay(localPosition:Vector3D, localDirection:Vector3D)\r\n\t{\r\n\t\tthis.rayPosition = localPosition;\r\n\t\tthis.rayDirection = localDirection;\r\n\t}\r\n\r\n\t/**\r\n\t * Tests a <code>Billboard</code> object for a collision with the picking ray.\r\n\t *\r\n\t * @param billboard The billboard instance to be tested.\r\n\t * @param pickingCollisionVO The collision object used to store the collision results\r\n\t * @param shortestCollisionDistance The current value of the shortest distance to a detected collision along the ray.\r\n\t * @param findClosest\r\n\t */\r\n\tpublic testBillboardCollision(billboard:Billboard, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number)\r\n\t{\r\n\t\tthis.setLocalRay(pickingCollisionVO.localRayPosition, pickingCollisionVO.localRayDirection);\r\n\t\tpickingCollisionVO.renderableOwner = null;\r\n\r\n\t\tif (this._pTestRenderableCollision(<RenderableBase> this._billboardRenderablePool.getItem(billboard), pickingCollisionVO, shortestCollisionDistance)) {\r\n\t\t\tshortestCollisionDistance = pickingCollisionVO.rayEntryDistance;\r\n\r\n\t\t\tpickingCollisionVO.renderableOwner = billboard;\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Tests a <code>Mesh</code> object for a collision with the picking ray.\r\n\t *\r\n\t * @param mesh The mesh instance to be tested.\r\n\t * @param pickingCollisionVO The collision object used to store the collision results\r\n\t * @param shortestCollisionDistance The current value of the shortest distance to a detected collision along the ray.\r\n\t * @param findClosest\r\n\t */\r\n\tpublic testMeshCollision(mesh:Mesh, pickingCollisionVO:PickingCollisionVO, shortestCollisionDistance:number, findClosest:boolean):boolean\r\n\t{\r\n\t\tthis.setLocalRay(pickingCollisionVO.localRayPosition, pickingCollisionVO.localRayDirection);\r\n\t\tpickingCollisionVO.renderableOwner = null;\r\n\r\n\t\tvar subMesh:ISubMesh;\r\n\r\n\t\tvar len:number = mesh.subMeshes.length;\r\n\t\tfor (var i:number = 0; i < len; ++i) {\r\n\t\t\tsubMesh = mesh.subMeshes[i];\r\n\r\n\t\t\tif (this._pTestRenderableCollision(<RenderableBase> this._subMeshRenderablePool.getItem(subMesh), pickingCollisionVO, shortestCollisionDistance)) {\r\n\t\t\t\tshortestCollisionDistance = pickingCollisionVO.rayEntryDistance;\r\n\r\n\t\t\t\tpickingCollisionVO.renderableOwner = subMesh;\r\n\r\n\t\t\t\tif (!findClosest)\r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn pickingCollisionVO.renderableOwner != null;\r\n\t}\r\n}\r\n\r\nexport = PickingColliderBase;",
    "import Debug\t\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/Debug\");\r\nimport BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/base/BitmapData\");\r\nimport Box\t\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Box\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\nimport Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\nimport Rectangle\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Rectangle\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Scene\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/Scene\");\r\nimport View\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/containers/View\");\r\nimport IPicker\t\t\t\t\t\t\t= require(\"awayjs-display/lib/pick/IPicker\");\r\nimport PickingCollisionVO\t\t\t\t= require(\"awayjs-display/lib/pick/PickingCollisionVO\");\r\nimport EntityCollector\t\t\t\t\t= require(\"awayjs-display/lib/traverse/EntityCollector\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport IEntity\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport AGALMiniAssembler\t\t\t\t= require(\"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler\");\r\nimport Stage\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLBlendFactor\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLBlendFactor\");\r\nimport ContextGLClearMask\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLClearMask\");\r\nimport ContextGLCompareMode\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLProgramType\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport ContextGLTriangleFace\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTriangleFace\");\r\nimport IContextGL\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport IProgram\t\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IProgram\");\r\nimport ITextureBase\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ITextureBase\");\r\n\r\nimport DefaultRenderer\t\t\t\t\t= require(\"awayjs-renderergl/lib/DefaultRenderer\");\r\nimport RenderableBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\n\r\n/**\r\n * Picks a 3d object from a view or scene by performing a separate render pass on the scene around the area being picked using key color values,\r\n * then reading back the color value of the pixel in the render representing the picking ray. Requires multiple passes and readbacks for retriving details\r\n * on an entity that has its shaderPickingDetails property set to true.\r\n *\r\n * A read-back operation from any GPU is not a very efficient process, and the amount of processing used can vary significantly between different hardware.\r\n *\r\n * @see away.entities.Entity#shaderPickingDetails\r\n *\r\n * @class away.pick.ShaderPicker\r\n */\r\nclass ShaderPicker implements IPicker\r\n{\r\n\tprivate _opaqueRenderableHead:RenderableBase;\r\n\tprivate _blendedRenderableHead:RenderableBase;\r\n\r\n\tprivate _stage:Stage;\r\n\tprivate _context:IContextGL;\r\n\tprivate _onlyMouseEnabled:boolean = true;\r\n\r\n\tprivate _objectProgram:IProgram;\r\n\tprivate _triangleProgram:IProgram;\r\n\tprivate _bitmapData:BitmapData;\r\n\tprivate _viewportData:Array<number>;\r\n\tprivate _boundOffsetScale:Array<number>;\r\n\tprivate _id:Array<number>;\r\n\r\n\tprivate _interactives:Array<RenderableBase> = new Array<RenderableBase>();\r\n\tprivate _interactiveId:number;\r\n\tprivate _hitColor:number;\r\n\tprivate _projX:number;\r\n\tprivate _projY:number;\r\n\r\n\tprivate _hitRenderable:RenderableBase;\r\n\tprivate _hitEntity:IEntity;\r\n\tprivate _localHitPosition:Vector3D = new Vector3D();\r\n\tprivate _hitUV:Point = new Point();\r\n\tprivate _faceIndex:number;\r\n\tprivate _subGeometryIndex:number;\r\n\r\n\tprivate _localHitNormal:Vector3D = new Vector3D();\r\n\r\n\tprivate _rayPos:Vector3D = new Vector3D();\r\n\tprivate _rayDir:Vector3D = new Vector3D();\r\n\tprivate _potentialFound:boolean;\r\n\tprivate static MOUSE_SCISSOR_RECT:Rectangle = new Rectangle(0, 0, 1, 1);\r\n\r\n\tprivate _shaderPickingDetails:boolean;\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic get onlyMouseEnabled():boolean\r\n\t{\r\n\t\treturn this._onlyMouseEnabled;\r\n\t}\r\n\r\n\tpublic set onlyMouseEnabled(value:boolean)\r\n\t{\r\n\t\tthis._onlyMouseEnabled = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new <code>ShaderPicker</code> object.\r\n\t *\r\n\t * @param shaderPickingDetails Determines whether the picker includes a second pass to calculate extra\r\n\t * properties such as uv and normal coordinates.\r\n\t */\r\n\tconstructor(shaderPickingDetails:boolean = false)\r\n\t{\r\n\t\tthis._shaderPickingDetails = shaderPickingDetails;\r\n\r\n\t\tthis._id = new Array<number>(4);\r\n\t\tthis._viewportData = new Array<number>(4); // first 2 contain scale, last 2 translation\r\n\t\tthis._boundOffsetScale = new Array<number>(8); // first 2 contain scale, last 2 translation\r\n\t\tthis._boundOffsetScale[3] = 0;\r\n\t\tthis._boundOffsetScale[7] = 1;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getViewCollision(x:number, y:number, view:View):PickingCollisionVO\r\n\t{\r\n\t\tvar collector:EntityCollector = <EntityCollector> view.iEntityCollector;\r\n\r\n\t\tthis._stage = (<DefaultRenderer> view.renderer).stage;\r\n\r\n\t\tif (!this._stage)\r\n\t\t\treturn null;\r\n\r\n\t\tthis._context = <IContextGL> this._stage.context;\r\n\r\n\t\tthis._viewportData[0] = view.width;\r\n\t\tthis._viewportData[1] = view.height;\r\n\t\tthis._viewportData[2] = -(this._projX = 2*x/view.width - 1);\r\n\t\tthis._viewportData[3] = this._projY = 2*y/view.height - 1;\r\n\r\n\t\t// _potentialFound will be set to true if any object is actually rendered\r\n\t\tthis._potentialFound = false;\r\n\r\n\t\t//reset head values\r\n\t\tthis._blendedRenderableHead = null;\r\n\t\tthis._opaqueRenderableHead = null;\r\n\r\n\t\tthis.pDraw(collector, null);\r\n\r\n\t\t// clear buffers\r\n\t\tthis._context.setVertexBufferAt(0, null);\r\n\r\n\t\tif (!this._context || !this._potentialFound)\r\n\t\t\treturn null;\r\n\r\n\t\tif (!this._bitmapData)\r\n\t\t\tthis._bitmapData = new BitmapData(1, 1, false, 0);\r\n\r\n\t\tthis._context.drawToBitmapData(this._bitmapData);\r\n\t\tthis._hitColor = this._bitmapData.getPixel(0, 0);\r\n\r\n\t\tif (!this._hitColor) {\r\n\t\t\tthis._context.present();\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tthis._hitRenderable = this._interactives[this._hitColor - 1];\r\n\t\tthis._hitEntity = this._hitRenderable.sourceEntity;\r\n\r\n\t\tif (this._onlyMouseEnabled && !this._hitEntity._iIsMouseEnabled())\r\n\t\t\treturn null;\r\n\r\n\t\tvar _collisionVO:PickingCollisionVO = this._hitEntity._iPickingCollisionVO;\r\n\t\tif (this._shaderPickingDetails) {\r\n\t\t\tthis.getHitDetails(view.camera);\r\n\t\t\t_collisionVO.localPosition = this._localHitPosition;\r\n\t\t\t_collisionVO.localNormal = this._localHitNormal;\r\n\t\t\t_collisionVO.uv = this._hitUV;\r\n\t\t\t_collisionVO.index = this._faceIndex;\r\n\t\t\t//_collisionVO.subGeometryIndex = this._subGeometryIndex;\r\n\r\n\t\t} else {\r\n\t\t\t_collisionVO.localPosition = null;\r\n\t\t\t_collisionVO.localNormal = null;\r\n\t\t\t_collisionVO.uv = null;\r\n\t\t\t_collisionVO.index = 0;\r\n\t\t\t//_collisionVO.subGeometryIndex = 0;\r\n\t\t}\r\n\r\n\t\treturn _collisionVO;\r\n\t}\r\n\r\n\t//*/\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic getSceneCollision(position:Vector3D, direction:Vector3D, scene:Scene):PickingCollisionVO\r\n\t{\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic pDraw(entityCollector:EntityCollector, target:ITextureBase)\r\n\t{\r\n\r\n\t\tvar camera:Camera = entityCollector.camera;\r\n\r\n\t\tthis._context.clear(0, 0, 0, 1);\r\n\t\tthis._stage.scissorRect = ShaderPicker.MOUSE_SCISSOR_RECT;\r\n\r\n\t\tthis._interactives.length = this._interactiveId = 0;\r\n\r\n\t\tif (!this._objectProgram)\r\n\t\t\tthis.initObjectProgram();\r\n\r\n\t\tthis._context.setBlendFactors(ContextGLBlendFactor.ONE, ContextGLBlendFactor.ZERO);\r\n\t\tthis._context.setDepthTest(true, ContextGLCompareMode.LESS);\r\n\t\tthis._context.setProgram(this._objectProgram);\r\n\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 4, this._viewportData, 1);\r\n\t\t//this.drawRenderables(entityCollector.opaqueRenderableHead, camera);\r\n\t\t//this.drawRenderables(entityCollector.blendedRenderableHead, camera);\r\n\t\t//TODO: reimplement ShaderPicker inheriting from RendererBase\r\n\t}\r\n\r\n\t/**\r\n\t * Draw a list of renderables.\r\n\t * @param renderables The renderables to draw.\r\n\t * @param camera The camera for which to render.\r\n\t */\r\n\tprivate drawRenderables(renderable:RenderableBase, camera:Camera)\r\n\t{\r\n\t\tvar matrix:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\t\tvar viewProjection:Matrix3D = camera.viewProjection;\r\n\r\n\t\twhile (renderable) {\r\n\t\t\t// it's possible that the renderable was already removed from the scene\r\n\t\t\tif (!renderable.sourceEntity.scene || !renderable.sourceEntity._iIsMouseEnabled()) {\r\n\t\t\t\trenderable = renderable.next;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tthis._potentialFound = true;\r\n\r\n\t\t\tthis._context.setCulling((<MaterialBase> renderable.renderObjectOwner).bothSides? ContextGLTriangleFace.NONE : ContextGLTriangleFace.BACK, camera.projection.coordinateSystem);\r\n\r\n\t\t\tthis._interactives[this._interactiveId++] = renderable;\r\n\t\t\t// color code so that reading from bitmapdata will contain the correct value\r\n\t\t\tthis._id[1] = (this._interactiveId >> 8)/255; // on green channel\r\n\t\t\tthis._id[2] = (this._interactiveId & 0xff)/255; // on blue channel\r\n\r\n\t\t\tmatrix.copyFrom(renderable.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix.append(viewProjection);\r\n\t\t\tthis._context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, matrix, true);\r\n\t\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, this._id, 1);\r\n\t\t\tthis._stage.activateBuffer(0, renderable.getVertexData(TriangleSubGeometry.POSITION_DATA), renderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\r\n\t\t\tthis._context.drawTriangles(this._stage.getIndexBuffer(renderable.getIndexData()), 0, renderable.numTriangles);\r\n\r\n\t\t\trenderable = renderable.next;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate updateRay(camera:Camera)\r\n\t{\r\n\t\tthis._rayPos = camera.scenePosition;\r\n\r\n\t\tthis._rayDir = camera.getRay(this._projX, this._projY, 1);\r\n\t\tthis._rayDir.normalize();\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the Program that color-codes objects.\r\n\t */\r\n\tprivate initObjectProgram()\r\n\t{\r\n\t\tvar vertexCode:string;\r\n\t\tvar fragmentCode:string;\r\n\r\n\t\tthis._objectProgram = this._context.createProgram();\r\n\r\n\t\tvertexCode = \"m44 vt0, va0, vc0\t\t\t\\n\" + \"mul vt1.xy, vt0.w, vc4.zw\t\\n\" + \"add vt0.xy, vt0.xy, vt1.xy\t\\n\" + \"mul vt0.xy, vt0.xy, vc4.xy\t\\n\" + \"mov op, vt0\t\\n\";\r\n\t\tfragmentCode = \"mov oc, fc0\"; // write identifier\r\n\r\n\t\tDebug.throwPIR('ShaderPicker', 'initTriangleProgram', 'Dependency: initObjectProgram')\r\n\t\t//_objectProgram.upload(new AGALMiniAssembler().assemble(ContextGLProgramType.VERTEX, vertexCode),new AGALMiniAssembler().assemble(ContextGLProgramType.FRAGMENT, fragmentCode));\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the Program that renders positions.\r\n\t */\r\n\r\n\tprivate initTriangleProgram()\r\n\t{\r\n\t\tvar vertexCode:string;\r\n\t\tvar fragmentCode:string;\r\n\r\n\t\tthis._triangleProgram = this._context.createProgram();\r\n\r\n\t\t// todo: add animation code\r\n\t\tvertexCode = \"add vt0, va0, vc5 \t\t\t\\n\" + \"mul vt0, vt0, vc6 \t\t\t\\n\" + \"mov v0, vt0\t\t\t\t\\n\" + \"m44 vt0, va0, vc0\t\t\t\\n\" + \"mul vt1.xy, vt0.w, vc4.zw\t\\n\" + \"add vt0.xy, vt0.xy, vt1.xy\t\\n\" + \"mul vt0.xy, vt0.xy, vc4.xy\t\\n\" + \"mov op, vt0\t\\n\";\r\n\t\tfragmentCode = \"mov oc, v0\"; // write identifier\r\n\r\n\t\tvar vertexByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part vertex 1\\n\" + vertexCode + \"endpart\"))['vertex'].data;\r\n\t\tvar fragmentByteCode:ByteArray = (new AGALMiniAssembler().assemble(\"part fragment 1\\n\" + fragmentCode + \"endpart\"))['fragment'].data;\r\n\t\tthis._triangleProgram.upload(vertexByteCode, fragmentByteCode);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets more detailed information about the hir position, if required.\r\n\t * @param camera The camera used to view the hit object.\r\n\t */\r\n\tprivate getHitDetails(camera:Camera)\r\n\t{\r\n\t\tthis.getApproximatePosition(camera);\r\n\t\tthis.getPreciseDetails(camera);\r\n\t}\r\n\r\n\t/**\r\n\t * Finds a first-guess approximate position about the hit position.\r\n\t *\r\n\t * @param camera The camera used to view the hit object.\r\n\t */\r\n\tprivate getApproximatePosition(camera:Camera)\r\n\t{\r\n\t\tvar bounds:Box = this._hitRenderable.sourceEntity.getBox();\r\n\t\tvar col:number;\r\n\t\tvar scX:number, scY:number, scZ:number;\r\n\t\tvar offsX:number, offsY:number, offsZ:number;\r\n\t\tvar localViewProjection:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\tlocalViewProjection.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(camera));\r\n\t\tlocalViewProjection.append(camera.viewProjection);\r\n\t\tif (!this._triangleProgram) {\r\n\t\t\tthis.initTriangleProgram();\r\n\t\t}\r\n\r\n\t\tthis._boundOffsetScale[4] = 1/(scX = bounds.width);\r\n\t\tthis._boundOffsetScale[5] = 1/(scY = bounds.height);\r\n\t\tthis._boundOffsetScale[6] = 1/(scZ = bounds.depth);\r\n\t\tthis._boundOffsetScale[0] = offsX = -bounds.x;\r\n\t\tthis._boundOffsetScale[1] = offsY = -bounds.y;\r\n\t\tthis._boundOffsetScale[2] = offsZ = -bounds.z;\r\n\r\n\t\tthis._context.setProgram(this._triangleProgram);\r\n\t\tthis._context.clear(0, 0, 0, 0, 1, 0, ContextGLClearMask.DEPTH);\r\n\t\tthis._context.setScissorRectangle(ShaderPicker.MOUSE_SCISSOR_RECT);\r\n\t\tthis._context.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, localViewProjection, true);\r\n\t\tthis._context.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, this._boundOffsetScale, 2);\r\n\r\n\t\tthis._stage.activateBuffer(0, this._hitRenderable.getVertexData(TriangleSubGeometry.POSITION_DATA), this._hitRenderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\r\n\t\tthis._context.drawTriangles(this._stage.getIndexBuffer(this._hitRenderable.getIndexData()), 0, this._hitRenderable.numTriangles);\r\n\r\n\t\tthis._context.drawToBitmapData(this._bitmapData);\r\n\r\n\t\tcol = this._bitmapData.getPixel(0, 0);\r\n\r\n\t\tthis._localHitPosition.x = ((col >> 16) & 0xff)*scX/255 - offsX;\r\n\t\tthis._localHitPosition.y = ((col >> 8) & 0xff)*scY/255 - offsY;\r\n\t\tthis._localHitPosition.z = (col & 0xff)*scZ/255 - offsZ;\r\n\t}\r\n\r\n\t/**\r\n\t * Use the approximate position info to find the face under the mouse position from which we can derive the precise\r\n\t * ray-face intersection point, then use barycentric coordinates to figure out the uv coordinates, etc.\r\n\t * @param camera The camera used to view the hit object.\r\n\t */\r\n\tprivate getPreciseDetails(camera:Camera)\r\n\t{\r\n\t\tvar len:number = indices.length;\r\n\t\tvar x1:number, y1:number, z1:number;\r\n\t\tvar x2:number, y2:number, z2:number;\r\n\t\tvar x3:number, y3:number, z3:number;\r\n\t\tvar i:number = 0, j:number = 1, k:number = 2;\r\n\t\tvar t1:number, t2:number, t3:number;\r\n\t\tvar v0x:number, v0y:number, v0z:number;\r\n\t\tvar v1x:number, v1y:number, v1z:number;\r\n\t\tvar v2x:number, v2y:number, v2z:number;\r\n\t\tvar ni1:number, ni2:number, ni3:number;\r\n\t\tvar n1:number, n2:number, n3:number, nLength:number;\r\n\t\tvar dot00:number, dot01:number, dot02:number, dot11:number, dot12:number;\r\n\t\tvar s:number, t:number, invDenom:number;\r\n\t\tvar x:number = this._localHitPosition.x, y:number = this._localHitPosition.y, z:number = this._localHitPosition.z;\r\n\t\tvar u:number, v:number;\r\n\t\tvar ui1:number, ui2:number, ui3:number;\r\n\t\tvar s0x:number, s0y:number, s0z:number;\r\n\t\tvar s1x:number, s1y:number, s1z:number;\r\n\t\tvar nl:number;\r\n\t\tvar indices:Array<number> = this._hitRenderable.getIndexData().data;\r\n\r\n\t\tvar positions:Array<number> = this._hitRenderable.getVertexData(TriangleSubGeometry.POSITION_DATA).data;\r\n\t\tvar positionStride:number = this._hitRenderable.getVertexData(TriangleSubGeometry.POSITION_DATA).dataPerVertex;\r\n\t\tvar positionOffset:number = this._hitRenderable.getVertexOffset(TriangleSubGeometry.POSITION_DATA);\r\n\r\n\t\tvar uvs:Array<number> = this._hitRenderable.getVertexData(TriangleSubGeometry.UV_DATA).data;\r\n\t\tvar uvStride:number = this._hitRenderable.getVertexData(TriangleSubGeometry.UV_DATA).dataPerVertex;\r\n\t\tvar uvOffset:number = this._hitRenderable.getVertexOffset(TriangleSubGeometry.UV_DATA);\r\n\r\n\t\tvar normals:Array<number> = this._hitRenderable.getVertexData(TriangleSubGeometry.NORMAL_DATA).data;\r\n\t\tvar normalStride:number = this._hitRenderable.getVertexData(TriangleSubGeometry.NORMAL_DATA).dataPerVertex;\r\n\t\tvar normalOffset:number = this._hitRenderable.getVertexOffset(TriangleSubGeometry.NORMAL_DATA);\r\n\r\n\t\tthis.updateRay(camera);\r\n\r\n\t\twhile (i < len) {\r\n\t\t\tt1 = positionOffset + indices[i]*positionStride;\r\n\t\t\tt2 = positionOffset + indices[j]*positionStride;\r\n\t\t\tt3 = positionOffset + indices[k]*positionStride;\r\n\t\t\tx1 = positions[t1];\r\n\t\t\ty1 = positions[t1 + 1];\r\n\t\t\tz1 = positions[t1 + 2];\r\n\t\t\tx2 = positions[t2];\r\n\t\t\ty2 = positions[t2 + 1];\r\n\t\t\tz2 = positions[t2 + 2];\r\n\t\t\tx3 = positions[t3];\r\n\t\t\ty3 = positions[t3 + 1];\r\n\t\t\tz3 = positions[t3 + 2];\r\n\r\n\t\t\t// if within bounds\r\n\t\t\tif (!(    (x < x1 && x < x2 && x < x3) || (y < y1 && y < y2 && y < y3) || (z < z1 && z < z2 && z < z3) || (x > x1 && x > x2 && x > x3) || (y > y1 && y > y2 && y > y3) || (z > z1 && z > z2 && z > z3))) {\r\n\r\n\t\t\t\t// calculate barycentric coords for approximated position\r\n\t\t\t\tv0x = x3 - x1;\r\n\t\t\t\tv0y = y3 - y1;\r\n\t\t\t\tv0z = z3 - z1;\r\n\t\t\t\tv1x = x2 - x1;\r\n\t\t\t\tv1y = y2 - y1;\r\n\t\t\t\tv1z = z2 - z1;\r\n\t\t\t\tv2x = x - x1;\r\n\t\t\t\tv2y = y - y1;\r\n\t\t\t\tv2z = z - z1;\r\n\t\t\t\tdot00 = v0x*v0x + v0y*v0y + v0z*v0z;\r\n\t\t\t\tdot01 = v0x*v1x + v0y*v1y + v0z*v1z;\r\n\t\t\t\tdot02 = v0x*v2x + v0y*v2y + v0z*v2z;\r\n\t\t\t\tdot11 = v1x*v1x + v1y*v1y + v1z*v1z;\r\n\t\t\t\tdot12 = v1x*v2x + v1y*v2y + v1z*v2z;\r\n\t\t\t\tinvDenom = 1/(dot00*dot11 - dot01*dot01);\r\n\t\t\t\ts = (dot11*dot02 - dot01*dot12)*invDenom;\r\n\t\t\t\tt = (dot00*dot12 - dot01*dot02)*invDenom;\r\n\r\n\t\t\t\t// if inside the current triangle, fetch details hit information\r\n\t\t\t\tif (s >= 0 && t >= 0 && (s + t) <= 1) {\r\n\r\n\t\t\t\t\tni1 = normalOffset + indices[i]*normalStride;\r\n\t\t\t\t\tni2 = normalOffset + indices[j]*normalStride;\r\n\t\t\t\t\tni3 = normalOffset + indices[k]*normalStride;\r\n\r\n\t\t\t\t\tn1 = indices[ni1] + indices[ni2] + indices[ni3];\r\n\t\t\t\t\tn2 = indices[ni1 + 1] + indices[ni2 + 1] + indices[ni3 + 1];\r\n\t\t\t\t\tn3 = indices[ni1 + 2] + indices[ni2 + 2] + indices[ni3 + 2];\r\n\r\n\t\t\t\t\tnLength = Math.sqrt(n1*n1 + n2*n2 + n3*n3);\r\n\r\n\t\t\t\t\tn1 /= nLength;\r\n\t\t\t\t\tn2 /= nLength;\r\n\t\t\t\t\tn3 /= nLength;\r\n\r\n\t\t\t\t\t// this is def the triangle, now calculate precise coords\r\n\t\t\t\t\tthis.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform, n1, n2, n3, x1, y1, z1);\r\n\r\n\t\t\t\t\tv2x = this._localHitPosition.x - x1;\r\n\t\t\t\t\tv2y = this._localHitPosition.y - y1;\r\n\t\t\t\t\tv2z = this._localHitPosition.z - z1;\r\n\r\n\t\t\t\t\ts0x = x2 - x1; // s0 = p1 - p0\r\n\t\t\t\t\ts0y = y2 - y1;\r\n\t\t\t\t\ts0z = z2 - z1;\r\n\t\t\t\t\ts1x = x3 - x1; // s1 = p2 - p0\r\n\t\t\t\t\ts1y = y3 - y1;\r\n\t\t\t\t\ts1z = z3 - z1;\r\n\t\t\t\t\tthis._localHitNormal.x = s0y*s1z - s0z*s1y; // n = s0 x s1\r\n\t\t\t\t\tthis._localHitNormal.y = s0z*s1x - s0x*s1z;\r\n\t\t\t\t\tthis._localHitNormal.z = s0x*s1y - s0y*s1x;\r\n\t\t\t\t\tnl = 1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x + this._localHitNormal.y*this._localHitNormal.y + this._localHitNormal.z*this._localHitNormal.z); // normalize n\r\n\t\t\t\t\tthis._localHitNormal.x *= nl;\r\n\t\t\t\t\tthis._localHitNormal.y *= nl;\r\n\t\t\t\t\tthis._localHitNormal.z *= nl;\r\n\r\n\t\t\t\t\tdot02 = v0x*v2x + v0y*v2y + v0z*v2z;\r\n\t\t\t\t\tdot12 = v1x*v2x + v1y*v2y + v1z*v2z;\r\n\t\t\t\t\ts = (dot11*dot02 - dot01*dot12)*invDenom;\r\n\t\t\t\t\tt = (dot00*dot12 - dot01*dot02)*invDenom;\r\n\r\n\t\t\t\t\tui1 = uvOffset + indices[i]*uvStride\r\n\t\t\t\t\tui2 = uvOffset + indices[j]*uvStride\r\n\t\t\t\t\tui3 = uvOffset + indices[k]*uvStride\r\n\r\n\t\t\t\t\tu = uvs[ui1];\r\n\t\t\t\t\tv = uvs[ui1 + 1];\r\n\t\t\t\t\tthis._hitUV.x = u + t*(uvs[ui2] - u) + s*(uvs[ui3] - u);\r\n\t\t\t\t\tthis._hitUV.y = v + t*(uvs[ui2 + 1] - v) + s*(uvs[ui3 + 1] - v);\r\n\r\n\t\t\t\t\tthis._faceIndex = i;\r\n\t\t\t\t\t//TODO add back subGeometryIndex value\r\n\t\t\t\t\t//this._subGeometryIndex = away.utils.GeometryUtils.getMeshSubGeometryIndex(subGeom);\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ti += 3;\r\n\t\t\tj += 3;\r\n\t\t\tk += 3;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the precise hit position by unprojecting the screen coordinate back unto the hit face's plane and\r\n\t * calculating the intersection point.\r\n\t * @param camera The camera used to render the object.\r\n\t * @param invSceneTransform The inverse scene transformation of the hit object.\r\n\t * @param nx The x-coordinate of the face's plane normal.\r\n\t * @param ny The y-coordinate of the face plane normal.\r\n\t * @param nz The z-coordinate of the face plane normal.\r\n\t * @param px The x-coordinate of a point on the face's plane (ie a face vertex)\r\n\t * @param py The y-coordinate of a point on the face's plane (ie a face vertex)\r\n\t * @param pz The z-coordinate of a point on the face's plane (ie a face vertex)\r\n\t */\r\n\r\n\tprivate getPrecisePosition(invSceneTransform:Matrix3D, nx:number, ny:number, nz:number, px:number, py:number, pz:number)\r\n\t{\r\n\t\t// calculate screen ray and find exact intersection position with triangle\r\n\t\tvar rx:number, ry:number, rz:number;\r\n\t\tvar ox:number, oy:number, oz:number;\r\n\t\tvar t:number;\r\n\t\tvar raw:Array<number> = Matrix3DUtils.RAW_DATA_CONTAINER;\r\n\t\tvar cx:number = this._rayPos.x, cy:number = this._rayPos.y, cz:number = this._rayPos.z;\r\n\r\n\t\t// unprojected projection point, gives ray dir in cam space\r\n\t\tox = this._rayDir.x;\r\n\t\toy = this._rayDir.y;\r\n\t\toz = this._rayDir.z;\r\n\r\n\t\t// transform ray dir and origin (cam pos) to object space\r\n\t\t//invSceneTransform.copyRawDataTo( raw  );\r\n\t\tinvSceneTransform.copyRawDataTo(raw);\r\n\t\trx = raw[0]*ox + raw[4]*oy + raw[8]*oz;\r\n\t\try = raw[1]*ox + raw[5]*oy + raw[9]*oz;\r\n\t\trz = raw[2]*ox + raw[6]*oy + raw[10]*oz;\r\n\r\n\t\tox = raw[0]*cx + raw[4]*cy + raw[8]*cz + raw[12];\r\n\t\toy = raw[1]*cx + raw[5]*cy + raw[9]*cz + raw[13];\r\n\t\toz = raw[2]*cx + raw[6]*cy + raw[10]*cz + raw[14];\r\n\r\n\t\tt = ((px - ox)*nx + (py - oy)*ny + (pz - oz)*nz)/(rx*nx + ry*ny + rz*nz);\r\n\r\n\t\tthis._localHitPosition.x = ox + rx*t;\r\n\t\tthis._localHitPosition.y = oy + ry*t;\r\n\t\tthis._localHitPosition.z = oz + rz*t;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._bitmapData.dispose();\r\n\t\tif (this._triangleProgram)\r\n\t\t\tthis._triangleProgram.dispose();\r\n\r\n\t\tif (this._objectProgram)\r\n\t\t\tthis._objectProgram.dispose();\r\n\r\n\t\tthis._triangleProgram = null;\r\n\t\tthis._objectProgram = null;\r\n\t\tthis._bitmapData = null;\r\n\t\tthis._hitRenderable = null;\r\n\t\tthis._hitEntity = null;\r\n\t}\r\n}\r\n\r\nexport = ShaderPicker;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\n\r\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\n\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * @class away.pool.RenderableListItem\r\n */\r\nclass BillboardRenderable extends RenderableBase\r\n{\r\n\tprivate static _materialGeometry:Object = new Object();\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"billboard\";\r\n\r\n\tpublic static vertexAttributesOffset:number = 1;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate _billboard:Billboard;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param billboard\r\n\t */\r\n\tconstructor(pool:RenderablePoolBase, billboard:Billboard, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, billboard, billboard, billboard.material, stage);\r\n\r\n\t\tthis._billboard = billboard;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {away.base.TriangleSubGeometry}\r\n\t */\r\n\tpublic _pGetSubGeometry():SubGeometryBase\r\n\t{\r\n\t\tvar material:MaterialBase = this._billboard.material;\r\n\r\n\t\tvar geometry:TriangleSubGeometry = BillboardRenderable._materialGeometry[material.id];\r\n\r\n\t\tif (!geometry) {\r\n\t\t\tgeometry = BillboardRenderable._materialGeometry[material.id] = new TriangleSubGeometry(true);\r\n\t\t\tgeometry.autoDeriveNormals = false;\r\n\t\t\tgeometry.autoDeriveTangents = false;\r\n\t\t\tgeometry.updateIndices(Array<number>(0, 1, 2, 0, 2, 3));\r\n\t\t\tgeometry.updatePositions(Array<number>(0, material.height, 0, material.width, material.height, 0, material.width, 0, 0, 0, 0, 0));\r\n\t\t\tgeometry.updateVertexNormals(Array<number>(1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0));\r\n\t\t\tgeometry.updateVertexTangents(Array<number>(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1));\r\n\t\t\tgeometry.updateUVs(Array<number>(0, 0, 1, 0, 1, 1, 0, 1));\r\n\t\t} else {\r\n\t\t\tgeometry.updatePositions(Array<number>(0, material.height, 0, material.width, material.height, 0, material.width, 0, 0, 0, 0, 0));\r\n\t\t}\r\n\r\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.POSITION_DATA] = true;\r\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.NORMAL_DATA] = true;\r\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.TANGENT_DATA] = true;\r\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.UV_DATA] = true;\r\n\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\t//get the projection coordinates\r\n\t\tvar position:ShaderRegisterElement = (shaderObject.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\r\n\r\n\t\t//reserving vertex constants for projection matrix\r\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tshaderObject.viewMatrixIndex = viewMatrixReg.index*4;\r\n\r\n\t\tif (shaderObject.projectionDependencies > 0) {\r\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\r\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \", \" + viewMatrixReg + \"\\n\" +\r\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\r\n\t\t\t\"mov op, \" + temp + \"\\n\";\r\n\t\t} else {\r\n\t\t\tcode += \"m44 op, \" + position + \", \" + viewMatrixReg + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(pass, camera);\r\n\r\n\t\t//buffer the same for all materials, so can set here\r\n\t\tthis._stage.activateBuffer(0, this.getVertexData(TriangleSubGeometry.POSITION_DATA), this.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(pass, camera, viewProjection);\r\n\r\n\t\tvar shader:ShaderObjectBase = pass.shader;\r\n\r\n\t\tif (shader.sceneMatrixIndex >= 0) {\r\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\r\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t} else {\r\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix3D.append(viewProjection);\r\n\r\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t}\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\r\n\r\n\t\tthis._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\r\n\t}\r\n}\r\n\r\nexport = BillboardRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport CurveSubMesh\t\t\t\t    = require(\"awayjs-display/lib/base/CurveSubMesh\");\r\nimport CurveSubGeometry\t\t    \t= require(\"awayjs-display/lib/base/CurveSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextWebGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/ContextWebGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\n\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * @class away.pool.TriangleSubMeshRenderable\r\n */\r\nclass CurveSubMeshRenderable extends RenderableBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"curvesubmesh\";\r\n\r\n\tpublic static vertexAttributesOffset:number = 2;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic subMesh:CurveSubMesh;\r\n\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t */\r\n\tconstructor(pool:RenderablePoolBase, subMesh:CurveSubMesh, stage:Stage, level:number = 0, indexOffset:number = 0)\r\n\t{\r\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);\r\n\r\n\t\tthis.subMesh = subMesh;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {SubGeometryBase}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():CurveSubGeometry\r\n\t{\r\n\t\tvar subGeometry:CurveSubGeometry;\r\n\r\n\t\tif (this.subMesh.animator)\r\n\t\t\tsubGeometry = <CurveSubGeometry> this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry);\r\n\t\telse\r\n\t\t\tsubGeometry = this.subMesh.subGeometry;\r\n\r\n\t\tthis._pVertexDataDirty[CurveSubGeometry.POSITION_DATA] = true;\r\n\r\n\t\tif (subGeometry.curves)\r\n\t\t\tthis._pVertexDataDirty[CurveSubGeometry.CURVE_DATA] = true;\r\n\r\n\t\tif (subGeometry.uvs)\r\n\t\t\tthis._pVertexDataDirty[CurveSubGeometry.UV_DATA] = true;\r\n\r\n\t\treturn subGeometry;\r\n\t}\r\n\r\n\r\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n        shaderObject.localPosDependencies++;\r\n\t}\r\n\r\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\t//get the projection coordinates\r\n\t\tvar position:ShaderRegisterElement = (shaderObject.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\r\n\r\n\t\t//reserving vertex constants for projection matrix\r\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tshaderObject.viewMatrixIndex = viewMatrixReg.index*4;\r\n\r\n\r\n\t\tif (shaderObject.projectionDependencies > 0) {\r\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\r\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \".xyw, \" + viewMatrixReg + \"\\n\" +\r\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\r\n\t\t\t\"mov v2 va1 \\n\" +\r\n\t\t\t\"mov op, \" + temp + \"\\n\";\r\n\r\n\t\t} else {\r\n\t\t\tcode += \"mov v2 va1 \\n\";\r\n\t\t\tcode += \"m44 op, \" + position + \".xyw, \" + viewMatrixReg + \"\\n\";\r\n\t\t}\r\n\t\treturn code;\r\n\t}\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public static _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n    {\r\n\t\tvar sd:boolean = (<ContextWebGL>shaderObject._stage.context).standardDerivatives;\r\n\r\n\t\tvar curve:String = \"v2\";\r\n\t\tvar curveX:String = \"v2.x\";//sharedRegisters.uvVarying //shaderObject.uvTarget;\r\n\t\tvar curveY:String = \"v2.y\";//sharedRegisters.uvVarying //shaderObject.uvTarget;\r\n\t\tvar pos:ShaderRegisterElement = sharedRegisters.localPositionVarying;\r\n\t\tvar out:ShaderRegisterElement = sharedRegisters.shadedTarget;//registerCache.fragmentOutputRegister.toString();\r\n\r\n\t\t//get some free registers\r\n\t\tvar free:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(free, 1);\r\n\t\tvar free1:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(free1, 1);\r\n\t\tvar free2:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n\t\tregisterCache.addFragmentTempUsages(free2, 1);\r\n\r\n\t\t//distance from curve\r\n\t\tvar d:String = free + \".x\";//registerCache.getFreeFragmentConstant().toString();\r\n\t\tvar less:String = free + \".y\";//registerCache.getFreeFragmentSingleTemp().toString();\r\n\t\tvar half:String = free + \".z\";//registerCache.getFreeFragmentSingleTemp().toString();\r\n\r\n\t\tvar px:String = free + \".xy\";\r\n\t\tvar pxx:String = free + \".x\";\r\n\t\tvar pxy:String = free + \".y\";\r\n\t\tvar py:String = free1 + \".xy\";\r\n\t\tvar pyx:String = free1 + \".x\";\r\n\t\tvar pyy:String = free1 + \".y\";\r\n\r\n\t\tvar fx:String = free2 + \".x\";\r\n\t\tvar fy:String = free2 + \".y\";\r\n\t\tvar len:String = free2 + \".z\";\r\n\r\n\r\n\t\tvar dist:String = \"fc7.z\";\r\n\r\n\r\n\t\tvar code:string = \"\";\r\n\r\n\t\t//derivatives\r\n\t\tcode += \"ddx \" + px + \" \" + curve+\"\\n\";\r\n\t\tcode += \"ddy \" + py + \" \" + curve+\"\\n\";\r\n\r\n\t\tcode += \"mul \" + fx + \" \" + curveX + \" \" + pxx + \"\\n\";\r\n\t\tcode += \"mul \" + fx + \" \" + fx + \" \" + dist + \"\\n\";\r\n\t\tcode += \"sub \" + fx + \" \" + fx + \" \" + pxy + \"\\n\";\r\n\r\n\t\tcode += \"mul \" + fy + \" \" + curveY + \" \" + pyx + \"\\n\";\r\n\t\tcode += \"mul \" + fy + \" \" + fy + \" \" + dist + \"\\n\";\r\n\t\tcode += \"sub \" + fy + \" \" + fy + \" \" + pyy + \"\\n\";\r\n\r\n\t\t//len\r\n\t\tcode += \"mul \" + fx + \" \" + fx + \" \" + fx+\"\\n\";\r\n\t\tcode += \"mul \" + fy + \" \" + fy + \" \" + fy+\"\\n\";\r\n\t\tcode += \"add \" + len + \" \" + fx + \" \" + fy+\"\\n\";\r\n\t\tcode += \"sqt \" + len + \" \" + len+\"\\n\";\r\n\r\n\r\n\t\t//distance\r\n\t\tcode += \"mul \" + d + \" \" + curveX + \" \" + curveX+\"\\n\";\r\n\t\tcode += \"sub \" + d + \" \" + d + \" \" + curveY+\"\\n\";\r\n\r\n\t\t//flip\r\n\t\tcode += \"mul \"+ d + \" \" + d + \" \" + pos + \".z \" + \"\\n\";\r\n\t\t//code += \"abs \"+ d + \" \" + d + \"\\n\";\r\n\r\n\t\tcode += \"div \" + d + \" \" + d + \" \" + len +\"\\n\";\r\n\t\t/*\r\n\r\n\t\t//AA\r\n\t\tcode += \"mul \" + dx + \" \" + dx + \" \" + dx+\"\\n\";\r\n\t\tcode += \"mul \" + dy + \" \" + dy + \" \" + dy+\"\\n\";\r\n\t\tcode += \"add \" + t + \" \" + dx + \" \" +  dy+\"\\n\";\r\n\t\tcode += \"sqt \" + t + \" \" + t+\"\\n\";\r\n\t\t*/\r\n\r\n\t\tcode += \"sub \"+ d + \" fc7.w \" + d + \"\\n\";\r\n\r\n\r\n\r\n\t\t//code += \"add \" + t + \" \" + t + \" \" +  t+\"\\n\";\r\n\r\n\t//\r\n\r\n\t//\tcode += \"add \" + d + \" \" + d + \" \" + \" fc7.x\\n\";\r\n\r\n\t\t// code += \"mov \"+ out + \" \" + sharedRegisters.uvVarying+\"\\n\";\r\n\r\n\t\t// code += \"mul \"+ d + \" \" + d + \" \" + less + \"\\n\";\r\n\t\t//code += \"sub \"+ d + \" \" + d + \" \" + pos + \".z \" + \"\\n\";\r\n\t\t/*\r\n\t\tcode += \"mul \"+ d + \" \" + d + \" \" + pos + \".z \" + \"\\n\";\r\n\t\tcode += \"mov \"+ half + \" fc7.x\\n\";\r\n\t\tcode += \"slt \"+ less + \" \" + d + \" \" + half + \"\\n\";\r\n\t\tcode += \"mul \"+ d + \" \" + d + \" \" + less + \"\\n\";\r\n\t\tcode += \"abs \"+ d + \" \" + d + \"\\n\";*/\r\n\t\t//code += \"ddx \" + d + \" \" + curve + \".x\\n\";\r\n\t\t// code += \"kil \" + less + \"\\n\";\r\n\t\t//  code += \"sub \"+ less + \" \" + less + \" \" + pos + \".z \" + \"\\n\";\r\n\r\n\t\tcode += \"mov \" + out + \".w \" + d + \"\\n\";\r\n\t\treturn code;\r\n\t\t/*\r\n        var curve:String = \"v2\";//sharedRegisters.uvVarying //shaderObject.uvTarget;\r\n        var pos:ShaderRegisterElement = sharedRegisters.localPositionVarying;\r\n        var out:ShaderRegisterElement = sharedRegisters.shadedTarget;//registerCache.fragmentOutputRegister.toString();\r\n\r\n        var free:ShaderRegisterElement = registerCache.getFreeFragmentVectorTemp();\r\n        var d:String = free + \".x\";//registerCache.getFreeFragmentConstant().toString();\r\n        var less:String = free + \".y\";//registerCache.getFreeFragmentSingleTemp().toString();\r\n        var half:String = free + \".z\";//registerCache.getFreeFragmentSingleTemp().toString();\r\n\r\n        var code:string = \"\";\r\n        code += \"mov \" + d + \" \" + curve + \".x\\n\";\r\n        code += \"mul \" + d + \" \" + d + \" \" + d+\"\\n\";\r\n        code += \"sub \" + d + \" \" + d + \" \" + curve+\".y\\n\";\r\n\r\n             // code += \"mov \"+ out + \" \" + sharedRegisters.uvVarying+\"\\n\";\r\n\r\n       // code += \"mul \"+ d + \" \" + d + \" \" + less + \"\\n\";\r\n        //code += \"sub \"+ d + \" \" + d + \" \" + pos + \".z \" + \"\\n\";\r\n        code += \"mul \"+ d + \" \" + d + \" \" + pos + \".z \" + \"\\n\";\r\n        code += \"mov \"+ half + \" fc7.x\\n\";\r\n        code += \"slt \"+ less + \" \" + d + \" \" + half + \"\\n\";\r\n        code += \"mul \"+ d + \" \" + d + \" \" + less + \"\\n\";\r\n        code += \"abs \"+ d + \" \" + d + \"\\n\";\r\n\t\tcode += \"ddx \" + d + \" \" + curve + \".x\\n\";\r\n       // code += \"kil \" + less + \"\\n\";\r\n      //  code += \"sub \"+ less + \" \" + less + \" \" + pos + \".z \" + \"\\n\";\r\n\r\n        code += \"mov \" + out + \".w \" + less + \"\\n\";\r\n        return code;*/\r\n    }\r\n    private _constants:Array<number> = new Array<number>(0, 1, 2, 0.5);\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public _iActivate(pass:RenderPassBase, camera:Camera)\r\n    {\r\n        super._iActivate(pass, camera);\r\n\r\n        var context:IContextGL = this._stage.context;\r\n\r\n        context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 7, this._constants, 1);\r\n\r\n    }\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(pass, camera, viewProjection);\r\n\r\n\t\tvar shader:ShaderObjectBase = pass.shader;\r\n\r\n\t\tif (shader.sceneMatrixIndex >= 0) {\r\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\r\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t} else {\r\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix3D.append(viewProjection);\r\n\r\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t}\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\r\n\r\n\t\tthis._stage.activateBuffer(0, this.getVertexData(CurveSubGeometry.POSITION_DATA), this.getVertexOffset(CurveSubGeometry.POSITION_DATA), CurveSubGeometry.POSITION_FORMAT);\r\n        this._stage.activateBuffer(1, this.getVertexData(CurveSubGeometry.CURVE_DATA), this.getVertexOffset(CurveSubGeometry.CURVE_DATA), CurveSubGeometry.CURVE_FORMAT);\r\n\r\n        this._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.TriangleSubMeshRenderable}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\r\n\t{\r\n\t\treturn new CurveSubMeshRenderable(this._pool, <CurveSubMesh> this.renderableOwner, this._stage, this._level + 1, indexOffset);\r\n\t}\r\n}\r\n\r\nexport = CurveSubMeshRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\r\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport LineSegment\t\t\t\t\t= require(\"awayjs-display/lib/entities/LineSegment\");\r\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * @class away.pool.LineSubMeshRenderable\r\n */\r\nclass LineSegmentRenderable extends RenderableBase\r\n{\r\n\tprivate static _lineGeometry:Object = new Object();\r\n\r\n\tpublic static pONE_VECTOR:Array<number> = Array<number>(1, 1, 1, 1);\r\n\tpublic static pFRONT_VECTOR:Array<number> = Array<number>(0, 0, -1, 0);\r\n\r\n\tprivate _constants:Array<number> = new Array<number>(0, 0, 0, 0);\r\n\tprivate _calcMatrix:Matrix3D;\r\n\tprivate _thickness:number = 1.25;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"linesegment\";\r\n\r\n\tpublic static vertexAttributesOffset:number = 3;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate _lineSegment:LineSegment;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param dataOffset\r\n\t */\r\n\tconstructor(pool:RenderablePoolBase, lineSegment:LineSegment, stage:Stage, level:number = 0, indexOffset:number = 0)\r\n\t{\r\n\t\tsuper(pool, lineSegment, lineSegment, lineSegment.material, stage, level, indexOffset);\r\n\r\n\t\tthis._lineSegment = lineSegment;\r\n\r\n\t\tthis._calcMatrix = new Matrix3D();\r\n\r\n\t\tthis._constants[1] = 1/255;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {base.LineSubGeometry}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():LineSubGeometry\r\n\t{\r\n\t\tvar geometry:LineSubGeometry = LineSegmentRenderable._lineGeometry[this._lineSegment.id] || (LineSegmentRenderable._lineGeometry[this._lineSegment.id] = new LineSubGeometry());\r\n\r\n\t\tthis._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;\r\n\t\tthis._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;\r\n\t\tthis._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;\r\n\t\tthis._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;\r\n\r\n\t\tvar start:Vector3D = this._lineSegment.startPostion;\r\n\t\tvar end:Vector3D = this._lineSegment.endPosition;\r\n\r\n\t\tvar startPositions:Array<number>;\r\n\t\tvar endPositions:Array<number>;\r\n\t\tvar thickness:Array<number>;\r\n\r\n\t\tif (geometry.indices != null) {\r\n\t\t\tstartPositions = geometry.startPositions;\r\n\t\t\tendPositions = geometry.endPositions;\r\n\t\t\tthickness = geometry.thickness;\r\n\t\t} else {\r\n\t\t\tstartPositions = new Array<number>(3);\r\n\t\t\tendPositions = new Array<number>(3);\r\n\t\t\tthickness = new Array<number>(1);\r\n\t\t}\r\n\r\n\t\tstartPositions[0] = start.x;\r\n\t\tstartPositions[1] = start.y;\r\n\t\tstartPositions[2] = start.z;\r\n\t\tendPositions[0] = end.x;\r\n\t\tendPositions[1] = end.y;\r\n\t\tendPositions[2] = end.z;\r\n\t\tthickness[0] = this._lineSegment.thickness;\r\n\r\n\t\tgeometry.updatePositions(startPositions, endPositions);\r\n\t\tgeometry.updateThickness(thickness);\r\n\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tshaderObject.colorDependencies++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic static _iGetVertexCode(shader:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"m44 vt0, va0, vc8\t\t\t\\n\" + // transform Q0 to eye space\r\n\t\t\t\"m44 vt1, va1, vc8\t\t\t\\n\" + // transform Q1 to eye space\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\r\n\t\t\t\t// test if behind camera near plane\r\n\t\t\t\t// if 0 - Q0.z < Camera.near then the point needs to be clipped\r\n\t\t\t\t//\"neg vt5.x, vt0.z\t\t\t\t\\n\" + // 0 - Q0.z\r\n\t\t\t\"slt vt5.x, vt0.z, vc7.z\t\t\t\\n\" + // behind = ( 0 - Q0.z < -Camera.near ) ? 1 : 0\r\n\t\t\t\"sub vt5.y, vc5.x, vt5.x\t\t\t\\n\" + // !behind = 1 - behind\r\n\r\n\t\t\t\t// p = point on the plane (0,0,-near)\r\n\t\t\t\t// n = plane normal (0,0,-1)\r\n\t\t\t\t// D = Q1 - Q0\r\n\t\t\t\t// t = ( dot( n, ( p - Q0 ) ) / ( dot( n, d )\r\n\r\n\t\t\t\t// solve for t where line crosses Camera.near\r\n\t\t\t\"add vt4.x, vt0.z, vc7.z\t\t\t\\n\" + // Q0.z + ( -Camera.near )\r\n\t\t\t\"sub vt4.y, vt0.z, vt1.z\t\t\t\\n\" + // Q0.z - Q1.z\r\n\r\n\t\t\t\t// fix divide by zero for horizontal lines\r\n\t\t\t\"seq vt4.z, vt4.y vc6.x\t\t\t\\n\" + // offset = (Q0.z - Q1.z)==0 ? 1 : 0\r\n\t\t\t\"add vt4.y, vt4.y, vt4.z\t\t\t\\n\" + // ( Q0.z - Q1.z ) + offset\r\n\r\n\t\t\t\"div vt4.z, vt4.x, vt4.y\t\t\t\\n\" + // t = ( Q0.z - near ) / ( Q0.z - Q1.z )\r\n\r\n\t\t\t\"mul vt4.xyz, vt4.zzz, vt2.xyz\t\\n\" + // t(L)\r\n\t\t\t\"add vt3.xyz, vt0.xyz, vt4.xyz\t\\n\" + // Qclipped = Q0 + t(L)\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // Qclipped.w = 1\r\n\r\n\t\t\t\t// If necessary, replace Q0 with new Qclipped\r\n\t\t\t\"mul vt0, vt0, vt5.yyyy\t\t\t\\n\" + // !behind * Q0\r\n\t\t\t\"mul vt3, vt3, vt5.xxxx\t\t\t\\n\" + // behind * Qclipped\r\n\t\t\t\"add vt0, vt0, vt3\t\t\t\t\\n\" + // newQ0 = Q0 + Qclipped\r\n\r\n\t\t\t\t// calculate side vector for line\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\t\t\t\"nrm vt2.xyz, vt2.xyz\t\t\t\\n\" + // normalize( L )\r\n\t\t\t\"nrm vt5.xyz, vt0.xyz\t\t\t\\n\" + // D = normalize( Q1 )\r\n\t\t\t\"mov vt5.w, vc5.x\t\t\t\t\\n\" + // D.w = 1\r\n\t\t\t\"crs vt3.xyz, vt2, vt5\t\t\t\\n\" + // S = L x D\r\n\t\t\t\"nrm vt3.xyz, vt3.xyz\t\t\t\\n\" + // normalize( S )\r\n\r\n\t\t\t\t// face the side vector properly for the given point\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, va2.xxx\t\\n\" + // S *= weight\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // S.w = 1\r\n\r\n\t\t\t\t// calculate the amount required to move at the point's distance to correspond to the line's pixel width\r\n\t\t\t\t// scale the side vector by that amount\r\n\t\t\t\"dp3 vt4.x, vt0, vc6\t\t\t\\n\" + // distance = dot( view )\r\n\t\t\t\"mul vt4.x, vt4.x, vc7.x\t\t\t\\n\" + // distance *= vpsod\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, vt4.xxx\t\\n\" + // S.xyz *= pixelScaleFactor\r\n\r\n\t\t\t\t// add scaled side vector to Q0 and transform to clip space\r\n\t\t\t\"add vt0.xyz, vt0.xyz, vt3.xyz\t\\n\" + // Q0 + S\r\n\r\n\t\t\t\"m44 op, vt0, vc0\t\t\t\\n\"  // transform Q0 to clip space\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(pass, camera);\r\n\r\n\t\tthis._constants[0] = this._thickness/((this._stage.scissorRect)? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));\r\n\r\n\t\t// value to convert distance from camera to model length per pixel width\r\n\t\tthis._constants[2] = camera.projection.near;\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSegmentRenderable.pONE_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSegmentRenderable.pFRONT_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);\r\n\r\n\t\t// projection matrix\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(pass, camera, viewProjection);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tthis._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);\r\n\t\tthis._calcMatrix.append(camera.inverseSceneTransform);\r\n\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);\r\n\r\n\t\tthis._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\r\n\t\tthis._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\r\n\t\tthis._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);\r\n\r\n\t\tcontext.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.LineSubMeshRenderable}\r\n\t * @private\r\n\t */\r\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\r\n\t{\r\n\t\treturn new LineSegmentRenderable(this._pool, <LineSegment> this.renderableOwner, this._stage, this._level + 1, indexOffset);\r\n\t}\r\n}\r\n\r\nexport = LineSegmentRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\r\nimport LineSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/LineSubGeometry\");\r\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport DefaultMaterialManager\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * @class away.pool.LineSubMeshRenderable\r\n */\r\nclass LineSubMeshRenderable extends RenderableBase\r\n{\r\n\tpublic static pONE_VECTOR:Array<number> = Array<number>(1, 1, 1, 1);\r\n\tpublic static pFRONT_VECTOR:Array<number> = Array<number>(0, 0, -1, 0);\r\n\r\n\tprivate _constants:Array<number> = new Array<number>(0, 0, 0, 0);\r\n\tprivate _calcMatrix:Matrix3D;\r\n\tprivate _thickness:number = 1.25;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"linesubmesh\";\r\n\r\n\tpublic static vertexAttributesOffset:number = 3;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic subMesh:LineSubMesh;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param dataOffset\r\n\t */\r\n\tconstructor(pool:RenderablePoolBase, subMesh:LineSubMesh, stage:Stage, level:number = 0, indexOffset:number = 0)\r\n\t{\r\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);\r\n\r\n\t\tthis.subMesh = subMesh;\r\n\r\n\t\tthis._calcMatrix = new Matrix3D();\r\n\r\n\t\tthis._constants[1] = 1/255;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {base.LineSubGeometry}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():LineSubGeometry\r\n\t{\r\n\t\tvar subGeometry:LineSubGeometry = this.subMesh.subGeometry;\r\n\r\n\t\tthis._pVertexDataDirty[LineSubGeometry.START_POSITION_DATA] = true;\r\n\t\tthis._pVertexDataDirty[LineSubGeometry.END_POSITION_DATA] = true;\r\n\r\n\t\tif (subGeometry.thickness)\r\n\t\t\tthis._pVertexDataDirty[LineSubGeometry.THICKNESS_DATA] = true;\r\n\r\n\t\tif (subGeometry.startColors)\r\n\t\t\tthis._pVertexDataDirty[LineSubGeometry.COLOR_DATA] = true;\r\n\r\n\t\treturn subGeometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\t\tshaderObject.colorDependencies++;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic static _iGetVertexCode(shader:ShaderObjectBase, regCache:ShaderRegisterCache, sharedReg:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"m44 vt0, va0, vc8\t\t\t\\n\" + // transform Q0 to eye space\r\n\t\t\t\"m44 vt1, va1, vc8\t\t\t\\n\" + // transform Q1 to eye space\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\r\n\t\t\t\t// test if behind camera near plane\r\n\t\t\t\t// if 0 - Q0.z < Camera.near then the point needs to be clipped\r\n\t\t\t\t//\"neg vt5.x, vt0.z\t\t\t\t\\n\" + // 0 - Q0.z\r\n\t\t\t\"slt vt5.x, vt0.z, vc7.z\t\t\t\\n\" + // behind = ( 0 - Q0.z < -Camera.near ) ? 1 : 0\r\n\t\t\t\"sub vt5.y, vc5.x, vt5.x\t\t\t\\n\" + // !behind = 1 - behind\r\n\r\n\t\t\t\t// p = point on the plane (0,0,-near)\r\n\t\t\t\t// n = plane normal (0,0,-1)\r\n\t\t\t\t// D = Q1 - Q0\r\n\t\t\t\t// t = ( dot( n, ( p - Q0 ) ) / ( dot( n, d )\r\n\r\n\t\t\t\t// solve for t where line crosses Camera.near\r\n\t\t\t\"add vt4.x, vt0.z, vc7.z\t\t\t\\n\" + // Q0.z + ( -Camera.near )\r\n\t\t\t\"sub vt4.y, vt0.z, vt1.z\t\t\t\\n\" + // Q0.z - Q1.z\r\n\r\n\t\t\t\t// fix divide by zero for horizontal lines\r\n\t\t\t\"seq vt4.z, vt4.y vc6.x\t\t\t\\n\" + // offset = (Q0.z - Q1.z)==0 ? 1 : 0\r\n\t\t\t\"add vt4.y, vt4.y, vt4.z\t\t\t\\n\" + // ( Q0.z - Q1.z ) + offset\r\n\r\n\t\t\t\"div vt4.z, vt4.x, vt4.y\t\t\t\\n\" + // t = ( Q0.z - near ) / ( Q0.z - Q1.z )\r\n\r\n\t\t\t\"mul vt4.xyz, vt4.zzz, vt2.xyz\t\\n\" + // t(L)\r\n\t\t\t\"add vt3.xyz, vt0.xyz, vt4.xyz\t\\n\" + // Qclipped = Q0 + t(L)\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // Qclipped.w = 1\r\n\r\n\t\t\t\t// If necessary, replace Q0 with new Qclipped\r\n\t\t\t\"mul vt0, vt0, vt5.yyyy\t\t\t\\n\" + // !behind * Q0\r\n\t\t\t\"mul vt3, vt3, vt5.xxxx\t\t\t\\n\" + // behind * Qclipped\r\n\t\t\t\"add vt0, vt0, vt3\t\t\t\t\\n\" + // newQ0 = Q0 + Qclipped\r\n\r\n\t\t\t\t// calculate side vector for line\r\n\t\t\t\"sub vt2, vt1, vt0 \t\t\t\\n\" + // L = Q1 - Q0\r\n\t\t\t\"nrm vt2.xyz, vt2.xyz\t\t\t\\n\" + // normalize( L )\r\n\t\t\t\"nrm vt5.xyz, vt0.xyz\t\t\t\\n\" + // D = normalize( Q1 )\r\n\t\t\t\"mov vt5.w, vc5.x\t\t\t\t\\n\" + // D.w = 1\r\n\t\t\t\"crs vt3.xyz, vt2, vt5\t\t\t\\n\" + // S = L x D\r\n\t\t\t\"nrm vt3.xyz, vt3.xyz\t\t\t\\n\" + // normalize( S )\r\n\r\n\t\t\t\t// face the side vector properly for the given point\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, va2.xxx\t\\n\" + // S *= weight\r\n\t\t\t\"mov vt3.w, vc5.x\t\t\t\\n\" + // S.w = 1\r\n\r\n\t\t\t\t// calculate the amount required to move at the point's distance to correspond to the line's pixel width\r\n\t\t\t\t// scale the side vector by that amount\r\n\t\t\t\"dp3 vt4.x, vt0, vc6\t\t\t\\n\" + // distance = dot( view )\r\n\t\t\t\"mul vt4.x, vt4.x, vc7.x\t\t\t\\n\" + // distance *= vpsod\r\n\t\t\t\"mul vt3.xyz, vt3.xyz, vt4.xxx\t\\n\" + // S.xyz *= pixelScaleFactor\r\n\r\n\t\t\t\t// add scaled side vector to Q0 and transform to clip space\r\n\t\t\t\"add vt0.xyz, vt0.xyz, vt3.xyz\t\\n\" + // Q0 + S\r\n\r\n\t\t\t\"m44 op, vt0, vc0\t\t\t\\n\"  // transform Q0 to clip space\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\r\n\t{\r\n\t\tsuper._iActivate(pass, camera);\r\n\r\n\t\tthis._constants[0] = this._thickness/((this._stage.scissorRect)? Math.min(this._stage.scissorRect.width, this._stage.scissorRect.height) : Math.min(this._stage.width, this._stage.height));\r\n\r\n\t\t// value to convert distance from camera to model length per pixel width\r\n\t\tthis._constants[2] = camera.projection.near;\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 5, LineSubMeshRenderable.pONE_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 6, LineSubMeshRenderable.pFRONT_VECTOR, 1);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 7, this._constants, 1);\r\n\r\n\t\t// projection matrix\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, camera.projection.matrix, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(pass, camera, viewProjection);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tthis._calcMatrix.copyFrom(this.sourceEntity.sceneTransform);\r\n\t\tthis._calcMatrix.append(camera.inverseSceneTransform);\r\n\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 8, this._calcMatrix, true);\r\n\r\n\t\tthis._stage.activateBuffer(0, this.getVertexData(LineSubGeometry.START_POSITION_DATA), this.getVertexOffset(LineSubGeometry.START_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\r\n\t\tthis._stage.activateBuffer(1, this.getVertexData(LineSubGeometry.END_POSITION_DATA), this.getVertexOffset(LineSubGeometry.END_POSITION_DATA), LineSubGeometry.POSITION_FORMAT);\r\n\t\tthis._stage.activateBuffer(2, this.getVertexData(LineSubGeometry.THICKNESS_DATA), this.getVertexOffset(LineSubGeometry.THICKNESS_DATA), LineSubGeometry.THICKNESS_FORMAT);\r\n\r\n\t\tcontext.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.LineSubMeshRenderable}\r\n\t * @private\r\n\t */\r\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\r\n\t{\r\n\t\treturn new LineSubMeshRenderable(this._pool, <LineSubMesh> this.renderableOwner, this._stage, this._level + 1, indexOffset);\r\n\t}\r\n}\r\n\r\nexport = LineSubMeshRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport AbstractMethodError\t\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport SubGeometryBase\t\t\t\t= require(\"awayjs-display/lib/base/SubGeometryBase\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport IRenderable\t\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderable\");\r\nimport IEntity\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/IEntity\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport RenderableOwnerEvent\t\t\t= require(\"awayjs-display/lib/events/RenderableOwnerEvent\");\r\nimport SubGeometryEvent\t\t\t\t= require(\"awayjs-display/lib/events/SubGeometryEvent\");\r\nimport IRenderer\t\t\t\t\t= require(\"awayjs-display/lib/render/IRenderer\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport IndexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexData\");\r\nimport IndexDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/IndexDataPool\");\r\nimport VertexData\t\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexData\");\r\nimport VertexDataPool\t\t\t\t= require(\"awayjs-stagegl/lib/pool/VertexDataPool\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * @class RenderableListItem\r\n */\r\nclass RenderableBase implements IRenderable\r\n{\r\n\r\n\tprivate _onIndicesUpdatedDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _onVerticesUpdatedDelegate:(event:SubGeometryEvent) => void;\r\n\tprivate _onRenderObjectOwnerUpdatedDelegate:(event:RenderableOwnerEvent) => void;\r\n\r\n\tprivate _subGeometry:SubGeometryBase;\r\n\tprivate _geometryDirty:boolean = true;\r\n\tprivate _indexData:IndexData;\r\n\tprivate _indexDataDirty:boolean = true;\r\n\tprivate _vertexData:Object = new Object();\r\n\tpublic _pVertexDataDirty:Object = new Object();\r\n\tprivate _vertexOffset:Object = new Object();\r\n\r\n\tpublic _level:number;\r\n\tprivate _indexOffset:number;\r\n\tprivate _overflow:RenderableBase;\r\n\tprivate _numTriangles:number;\r\n\tprivate _concatenateArrays:boolean;\r\n\r\n\tpublic JOINT_INDEX_FORMAT:string;\r\n\tpublic JOINT_WEIGHT_FORMAT:string;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic _pool:RenderablePoolBase;\r\n\r\n\tpublic _stage:Stage;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get overflow():RenderableBase\r\n\t{\r\n\t\tif (this._indexDataDirty)\r\n\t\t\tthis._updateIndexData();\r\n\r\n\t\treturn this._overflow;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic get numTriangles():number\r\n\t{\r\n\t\treturn this._numTriangles;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic next:RenderableBase;\r\n\r\n\tpublic id:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderObjectId:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderOrderId:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic zIndex:number;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic cascaded:boolean;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderSceneTransform:Matrix3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic sourceEntity:IEntity;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderableOwner:IRenderableOwner;\r\n\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderObjectOwner:IRenderObjectOwner;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic renderObject:RenderObjectBase;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getIndexData():IndexData\r\n\t{\r\n\t\tif (this._indexDataDirty)\r\n\t\t\tthis._updateIndexData();\r\n\r\n\t\treturn this._indexData;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getVertexData(dataType:string):VertexData\r\n\t{\r\n\t\tif (this._indexDataDirty)\r\n\t\t\tthis._updateIndexData();\r\n\r\n\t\tif (this._pVertexDataDirty[dataType])\r\n\t\t\tthis._updateVertexData(dataType);\r\n\r\n\t\treturn this._vertexData[this._concatenateArrays? TriangleSubGeometry.VERTEX_DATA : dataType]\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic getVertexOffset(dataType:string):number\r\n\t{\r\n\t\tif (this._indexDataDirty)\r\n\t\t\tthis._updateIndexData();\r\n\r\n\t\tif (this._pVertexDataDirty[dataType])\r\n\t\t\tthis._updateVertexData(dataType);\r\n\r\n\t\treturn this._vertexOffset[dataType];\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param sourceEntity\r\n\t * @param renderableOwner\r\n\t * @param subGeometry\r\n\t * @param animationSubGeometry\r\n\t */\r\n\tconstructor(pool:RenderablePoolBase, sourceEntity:IEntity, renderableOwner:IRenderableOwner, renderObjectOwner:IRenderObjectOwner, stage:Stage, level:number = 0, indexOffset:number = 0)\r\n\t{\r\n\t\tthis._onIndicesUpdatedDelegate = (event:SubGeometryEvent) => this._onIndicesUpdated(event);\r\n\t\tthis._onVerticesUpdatedDelegate = (event:SubGeometryEvent) => this._onVerticesUpdated(event);\r\n\t\tthis._onRenderObjectOwnerUpdatedDelegate = (event:RenderableOwnerEvent) => this._onRenderObjectOwnerUpdated(event);\r\n\r\n\t\t//store a reference to the pool for later disposal\r\n\t\tthis._pool = pool;\r\n\t\tthis._stage = stage;\r\n\r\n\t\t//reference to level of overflow\r\n\t\tthis._level = level;\r\n\r\n\t\t//reference to the offset on indices (if this is an overflow renderable)\r\n\t\tthis._indexOffset = indexOffset;\r\n\r\n\t\tthis.sourceEntity = sourceEntity;\r\n\r\n\t\tthis.renderableOwner = renderableOwner;\r\n\r\n\t\tthis.renderableOwner.addEventListener(RenderableOwnerEvent.RENDER_OBJECT_OWNER_UPDATED, this._onRenderObjectOwnerUpdatedDelegate)\r\n\r\n\t\tthis.renderObjectOwner = renderObjectOwner;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._pool.disposeItem(this.renderableOwner);\r\n\r\n\t\tthis._indexData.dispose();\r\n\t\tthis._indexData = null;\r\n\r\n\t\tfor (var dataType in this._vertexData) {\r\n\t\t\t(<VertexData> this._vertexData[dataType]).dispose();\r\n\t\t\tthis._vertexData[dataType] = null;\r\n\t\t}\r\n\r\n\t\tif (this._overflow) {\r\n\t\t\tthis._overflow.dispose();\r\n\t\t\tthis._overflow = null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic invalidateGeometry()\r\n\t{\r\n\t\tthis._geometryDirty = true;\r\n\r\n\t\t//invalidate indices\r\n\t\tif (this._level == 0)\r\n\t\t\tthis._indexDataDirty = true;\r\n\r\n\t\tif (this._overflow)\r\n\t\t\tthis._overflow.invalidateGeometry();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic invalidateIndexData()\r\n\t{\r\n\t\tthis._indexDataDirty = true;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param dataType\r\n\t */\r\n\tpublic invalidateVertexData(dataType:string)\r\n\t{\r\n\t\tthis._pVertexDataDirty[dataType] = true;\r\n\t}\r\n\r\n\tpublic _pGetSubGeometry():SubGeometryBase\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tpublic static _iGetFragmentCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param subGeometry\r\n\t * @param offset\r\n\t * @internal\r\n\t */\r\n\tpublic _iFillIndexData(indexOffset:number)\r\n\t{\r\n\t\tif (this._geometryDirty)\r\n\t\t\tthis._updateGeometry();\r\n\r\n\t\tthis._indexData = IndexDataPool.getItem(this._subGeometry, this._level, indexOffset);\r\n\r\n\t\tthis._numTriangles = this._indexData.data.length/3;\r\n\r\n\t\tindexOffset = this._indexData.offset;\r\n\r\n\t\t//check if there is more to split\r\n\t\tif (indexOffset < this._subGeometry.indices.length) {\r\n\t\t\tif (!this._overflow)\r\n\t\t\t\tthis._overflow = this._pGetOverflowRenderable(indexOffset);\r\n\r\n\t\t\tthis._overflow._iFillIndexData(indexOffset);\r\n\t\t} else if (this._overflow) {\r\n\t\t\tthis._overflow.dispose();\r\n\t\t\tthis._overflow = null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the render state for the pass that is independent of the rendered object. This needs to be called before\r\n\t * calling renderPass. Before activating a pass, the previously used pass needs to be deactivated.\r\n\t * @param stage The Stage object which is currently used for rendering.\r\n\t * @param camera The camera from which the scene is viewed.\r\n\t * @private\r\n\t */\r\n\tpublic _iActivate(pass:RenderPassBase, camera:Camera)\r\n\t{\r\n\t\tpass._iActivate(camera);\r\n\t}\r\n\r\n\t/**\r\n\t * Renders an object to the current render target.\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tpass._iRender(this, camera, viewProjection);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the render state for the pass. This needs to be called before activating another pass.\r\n\t * @param stage The Stage used for rendering\r\n\t *\r\n\t * @private\r\n\t */\r\n\tpublic _iDeactivate(pass:RenderPassBase)\r\n\t{\r\n\t\tpass._iDeactivate();\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @private\r\n\t */\r\n\tprivate _updateGeometry()\r\n\t{\r\n\t\tif (this._subGeometry) {\r\n\t\t\tif (this._level == 0)\r\n\t\t\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdatedDelegate);\r\n\t\t\tthis._subGeometry.removeEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\r\n\t\t}\r\n\r\n\t\tthis._subGeometry = this._pGetSubGeometry();\r\n\r\n\t\tthis._concatenateArrays = this._subGeometry.concatenateArrays;\r\n\r\n\t\tif (this._subGeometry) {\r\n\t\t\tif (this._level == 0)\r\n\t\t\t\tthis._subGeometry.addEventListener(SubGeometryEvent.INDICES_UPDATED, this._onIndicesUpdatedDelegate);\r\n\t\t\tthis._subGeometry.addEventListener(SubGeometryEvent.VERTICES_UPDATED, this._onVerticesUpdatedDelegate);\r\n\t\t}\r\n\r\n\t\t//dispose\r\n//\t\t\tif (this._indexData) {\r\n//\t\t\t\tthis._indexData.dispose(); //TODO where is a good place to dispose?\r\n//\t\t\t\tthis._indexData = null;\r\n//\t\t\t}\r\n\r\n//\t\t\tfor (var dataType in this._vertexData) {\r\n//\t\t\t\t(<VertexData> this._vertexData[dataType]).dispose(); //TODO where is a good place to dispose?\r\n//\t\t\t\tthis._vertexData[dataType] = null;\r\n//\t\t\t}\r\n\r\n\t\tthis._geometryDirty = false;\r\n\r\n\t\t//specific vertex data types have to be invalidated in the specific renderable\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @private\r\n\t */\r\n\tprivate _updateIndexData()\r\n\t{\r\n\t\tthis._iFillIndexData(this._indexOffset);\r\n\r\n\t\tthis._indexDataDirty = false;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param dataType\r\n\t * @private\r\n\t */\r\n\tprivate _updateVertexData(dataType:string)\r\n\t{\r\n\t\tthis._vertexOffset[dataType] = this._subGeometry.getOffset(dataType);\r\n\r\n\t\tif (this._subGeometry.concatenateArrays)\r\n\t\t\tdataType = SubGeometryBase.VERTEX_DATA;\r\n\r\n\t\tthis._vertexData[dataType] = VertexDataPool.getItem(this._subGeometry, this.getIndexData(), dataType);\r\n\r\n\t\tthis._pVertexDataDirty[dataType] = false;\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param event\r\n\t * @private\r\n\t */\r\n\tprivate _onIndicesUpdated(event:SubGeometryEvent)\r\n\t{\r\n\t\tthis.invalidateIndexData();\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param event\r\n\t * @private\r\n\t */\r\n\tprivate _onVerticesUpdated(event:SubGeometryEvent)\r\n\t{\r\n\t\tthis._concatenateArrays = (<SubGeometryBase> event.target).concatenateArrays;\r\n\r\n\t\tthis.invalidateVertexData(event.dataType);\r\n\t}\r\n\r\n\tprivate _onRenderObjectOwnerUpdated(event:RenderableOwnerEvent)\r\n\t{\r\n\t\t//TODO flag unused renderObjects for deletion\r\n\t\tthis.renderObjectOwner = event.renderObjectOwner;\r\n\t}\r\n}\r\n\r\nexport = RenderableBase;",
    "import IRenderObjectOwner\t\t\t= require(\"awayjs-display/lib/base/IRenderObjectOwner\");\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport MaterialBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport IRenderablePool\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderablePool\");\r\nimport IRenderObject\t\t\t\t= require(\"awayjs-display/lib/pool/IRenderObject\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport IRenderableClass\t\t\t\t= require(\"awayjs-renderergl/lib/pool/IRenderableClass\");\r\nimport RenderObjectPool\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectPool\");\r\nimport RenderBasicMaterialObject\t= require(\"awayjs-renderergl/lib/compilation/RenderBasicMaterialObject\");\r\nimport SkyboxRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/SkyboxRenderObject\");\r\nimport DepthRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/DepthRenderObject\");\r\nimport DistanceRenderObject\t\t\t= require(\"awayjs-renderergl/lib/compilation/DistanceRenderObject\");\r\nimport RenderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/RenderObjectBase\");\r\n\r\n/**\r\n * @class away.pool.RenderablePoolBase\r\n */\r\nclass RenderablePoolBase implements IRenderablePool\r\n{\r\n\tpublic static _pools:Object = new Object();\r\n\r\n\tpublic _stage:Stage;\r\n\tpublic _renderablePool:Object = new Object();\r\n\tpublic _renderableClass:IRenderableClass;\r\n\r\n\tprivate _materialRenderObjectPool:RenderObjectPool;\r\n\tprivate _skyboxRenderObjectPool:RenderObjectPool;\r\n\tprivate _depthRenderObjectPool:RenderObjectPool;\r\n\tprivate _distanceRenderObjectPool:RenderObjectPool;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableClass\r\n\t */\r\n\tconstructor(renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tthis._renderableClass = renderableClass;\r\n\t\tthis._stage = stage;\r\n\r\n\t\tthis._materialRenderObjectPool = new RenderObjectPool(RenderBasicMaterialObject, this._renderableClass, this._stage);\r\n\t\tthis._skyboxRenderObjectPool = new RenderObjectPool(SkyboxRenderObject, this._renderableClass, this._stage);\r\n\t\tthis._depthRenderObjectPool = new RenderObjectPool(DepthRenderObject, this._renderableClass, this._stage);\r\n\t\tthis._distanceRenderObjectPool = new RenderObjectPool(DistanceRenderObject, this._renderableClass, this._stage);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableOwner\r\n\t * @returns IRenderable\r\n\t */\r\n\tpublic getItem(renderableOwner:IRenderableOwner):RenderableBase\r\n\t{\r\n\t\treturn (this._renderablePool[renderableOwner.id] || (this._renderablePool[renderableOwner.id] = renderableOwner._iAddRenderable(new this._renderableClass(this, renderableOwner, this._stage))))\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param material\r\n\t * @param renderable\r\n\t */\r\n\tpublic getMaterialRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn this._materialRenderObjectPool.getItem(renderObjectOwner);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param material\r\n\t * @param renderable\r\n\t */\r\n\tpublic getSkyboxRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn this._skyboxRenderObjectPool.getItem(renderObjectOwner);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param material\r\n\t * @param renderable\r\n\t */\r\n\tpublic getDepthRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn this._depthRenderObjectPool.getItem(renderObjectOwner);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param material\r\n\t * @param renderable\r\n\t */\r\n\tpublic getDistanceRenderObject(renderObjectOwner:IRenderObjectOwner):RenderObjectBase\r\n\t{\r\n\t\treturn this._distanceRenderObjectPool.getItem(renderObjectOwner);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableOwner\r\n\t */\r\n\tpublic disposeItem(renderableOwner:IRenderableOwner)\r\n\t{\r\n\t\trenderableOwner._iRemoveRenderable(this._renderablePool[renderableOwner.id]);\r\n\r\n\t\tthis._renderablePool[renderableOwner.id] = null;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\t\tfor (var id in this._renderablePool)\r\n\t\t\tthis._renderablePool[id].dispose();\r\n\r\n\t\tRenderablePoolBase.disposePool(this._renderableClass, this._stage);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableClass\r\n\t * @returns RenderablePoolBase\r\n\t */\r\n\tpublic static getPool(renderableClass:IRenderableClass, stage:Stage):RenderablePoolBase\r\n\t{\r\n\t\tvar pools:Object = (RenderablePoolBase._pools[stage.stageIndex] || (RenderablePoolBase._pools[stage.stageIndex] = new Object()));\r\n\r\n\t\treturn (pools[renderableClass.id] || (pools[renderableClass.id] = new RenderablePoolBase(renderableClass, stage)));\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param renderableClass\r\n\t */\r\n\tpublic static disposePool(renderableClass:IRenderableClass, stage:Stage)\r\n\t{\r\n\t\tvar pools:Object = RenderablePoolBase._pools[stage.stageIndex];\r\n\r\n\t\tif (pools == undefined)\r\n\t\t\treturn;\r\n\r\n\t\tif (pools[renderableClass.id])\r\n\t\t\tpools[renderableClass.id] = undefined;\r\n\t}\r\n}\r\n\r\nexport = RenderablePoolBase;",
    "\r\nimport LineSubMesh\t\t\t\t\t= require(\"awayjs-display/lib/base/LineSubMesh\");\r\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport CurveSubMesh\t\t\t    \t= require(\"awayjs-display/lib/base/CurveSubMesh\");\r\nimport IRendererPool\t\t\t\t= require(\"awayjs-display/lib/pool/IRendererPool\");\r\nimport Billboard\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport LineSegment\t\t\t\t\t= require(\"awayjs-display/lib/entities/LineSegment\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\n\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport BillboardRenderable\t\t\t= require(\"awayjs-renderergl/lib/pool/BillboardRenderable\");\r\nimport LineSegmentRenderable\t\t= require(\"awayjs-renderergl/lib/pool/LineSegmentRenderable\");\r\nimport LineSubMeshRenderable\t\t= require(\"awayjs-renderergl/lib/pool/LineSubMeshRenderable\");\r\nimport TriangleSubMeshRenderable\t= require(\"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable\");\r\nimport CurveSubMeshRenderable\t    = require(\"awayjs-renderergl/lib/pool/CurveSubMeshRenderable\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport RendererBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/RendererBase\");\r\n\r\n/**\r\n * RendererPoolBase forms an abstract base class for classes that are used in the rendering pipeline to render the\r\n * contents of a partition\r\n *\r\n * @class away.render.RendererPoolBase\r\n */\r\nclass RendererPoolBase implements IRendererPool\r\n{\r\n\tpublic _billboardRenderablePool:RenderablePoolBase;\r\n\tpublic _lineSegmentRenderablePool:RenderablePoolBase;\r\n\tpublic _triangleSubMeshRenderablePool:RenderablePoolBase;\r\n\tpublic _lineSubMeshRenderablePool:RenderablePoolBase;\r\n    public _curveSubMeshRenderablePool:RenderablePoolBase;\r\n\r\n\tpublic _pStage:Stage;\r\n\r\n\r\n\tprivate _renderer:RendererBase;\r\n\t\r\n\t/**\r\n\t * Creates a new RendererPoolBase object.\r\n\t */\r\n\tconstructor(renderer:RendererBase)\r\n\t{\r\n\t\tthis._renderer = renderer;\r\n\t}\r\n\r\n\t/**\r\n\t * The Stage that will provide the ContextGL used for rendering.\r\n\t */\r\n\tpublic get stage():Stage\r\n\t{\r\n\t\treturn this._pStage;\r\n\t}\r\n\r\n\tpublic set stage(value:Stage)\r\n\t{\r\n\t\tif (this._pStage == value)\r\n\t\t\treturn;\r\n\r\n\t\tif (this._pStage)\r\n\t\t\tthis.dispose();\r\n\r\n\t\tthis._pStage = value;\r\n\r\n\t\tif (this._pStage)\r\n\t\t\tthis._pUpdatePool();\r\n\t}\r\n\r\n\tpublic _pUpdatePool()\r\n\t{\r\n\t\tthis._billboardRenderablePool = RenderablePoolBase.getPool(BillboardRenderable, this._pStage);\r\n\t\tthis._lineSegmentRenderablePool = RenderablePoolBase.getPool(LineSegmentRenderable, this._pStage);\r\n\t\tthis._triangleSubMeshRenderablePool = RenderablePoolBase.getPool(TriangleSubMeshRenderable, this._pStage);\r\n\t\tthis._lineSubMeshRenderablePool = RenderablePoolBase.getPool(LineSubMeshRenderable, this._pStage);\r\n        this._curveSubMeshRenderablePool = RenderablePoolBase.getPool(CurveSubMeshRenderable, this._pStage);\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes the resources used by the RendererPoolBase.\r\n\t */\r\n\tpublic dispose()\r\n\t{\r\n\t\tthis._billboardRenderablePool.dispose();\r\n\t\tthis._billboardRenderablePool = null;\r\n\r\n\t\tthis._lineSegmentRenderablePool.dispose();\r\n\t\tthis._lineSegmentRenderablePool = null;\r\n\r\n\t\tthis._triangleSubMeshRenderablePool.dispose();\r\n\t\tthis._triangleSubMeshRenderablePool = null;\r\n\r\n\t\tthis._lineSubMeshRenderablePool.dispose();\r\n\t\tthis._lineSubMeshRenderablePool = null;\r\n\r\n        this._curveSubMeshRenderablePool.dispose();\r\n        this._curveSubMeshRenderablePool = null;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param billboard\r\n\t * @protected\r\n\t */\r\n\tpublic applyBillboard(billboard:Billboard)\r\n\t{\r\n\t\tthis._renderer.applyRenderable(this._billboardRenderablePool.getItem(billboard));\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param lineSubMesh\r\n\t */\r\n\tpublic applyLineSegment(lineSegment:LineSegment)\r\n\t{\r\n\t\tthis._renderer.applyRenderable(this._lineSegmentRenderablePool.getItem(lineSegment));\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param triangleSubMesh\r\n\t */\r\n\tpublic applyTriangleSubMesh(triangleSubMesh:TriangleSubMesh)\r\n\t{\r\n\t\tthis._renderer.applyRenderable(this._triangleSubMeshRenderablePool.getItem(triangleSubMesh));\r\n\t}\r\n    /**\r\n     *\r\n     * @param curveSubMesh\r\n     */\r\n    public applyCurveSubMesh(curveSubMesh:CurveSubMesh)\r\n    {\r\n        this._renderer.applyRenderable(this._curveSubMeshRenderablePool.getItem(curveSubMesh));\r\n    }\r\n\t/**\r\n\t *\r\n\t * @param lineSubMesh\r\n\t */\r\n\tpublic applyLineSubMesh(lineSubMesh:LineSubMesh)\r\n\t{\r\n\t\tthis._renderer.applyRenderable(this._lineSubMeshRenderablePool.getItem(lineSubMesh));\r\n\t}\r\n}\r\n\r\nexport = RendererPoolBase;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport CubeTextureBase\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\n\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Skybox\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport ContextGLCompareMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLCompareMode\");\r\nimport ContextGLMipFilter\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLMipFilter\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\nimport ContextGLTextureFilter\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFilter\");\r\nimport ContextGLWrapMode\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLWrapMode\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\n\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport ShaderCompilerHelper\t\t\t= require(\"awayjs-renderergl/lib/utils/ShaderCompilerHelper\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * @class away.pool.SkyboxRenderable\r\n */\r\nclass SkyboxRenderable extends RenderableBase\r\n{\r\n\tprivate _vertexArray:Array<number>;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"skybox\";\r\n\r\n\tpublic static vertexAttributesOffset:number = 1;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tprivate static _geometry:TriangleSubGeometry;\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param skybox\r\n\t */\r\n\tconstructor(pool:RenderablePoolBase, skybox:Skybox, stage:Stage)\r\n\t{\r\n\t\tsuper(pool, skybox, skybox, skybox, stage);\r\n\r\n\t\tthis._vertexArray = new Array<number>(0, 0, 0, 0, 1, 1, 1, 1);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @returns {away.base.TriangleSubGeometry}\r\n\t * @private\r\n\t */\r\n\tpublic _pGetSubGeometry():TriangleSubGeometry\r\n\t{\r\n\t\tvar geometry:TriangleSubGeometry = SkyboxRenderable._geometry;\r\n\r\n\t\tif (!geometry) {\r\n\t\t\tgeometry = SkyboxRenderable._geometry = new TriangleSubGeometry(true);\r\n\t\t\tgeometry.autoDeriveNormals = false;\r\n\t\t\tgeometry.autoDeriveTangents = false;\r\n\t\t\tgeometry.updateIndices(Array<number>(0, 1, 2, 2, 3, 0, 6, 5, 4, 4, 7, 6, 2, 6, 7, 7, 3, 2, 4, 5, 1, 1, 0, 4, 4, 0, 3, 3, 7, 4, 2, 1, 5, 5, 6, 2));\r\n\t\t\tgeometry.updatePositions(Array<number>(-1, 1, -1, 1, 1, -1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 1, -1, -1, 1));\r\n\t\t}\r\n\r\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.POSITION_DATA] = true;\r\n\r\n\t\treturn geometry;\r\n\t}\r\n\r\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\treturn \"mul vt0, va0, vc5\\n\" +\r\n\t\t\t\"add vt0, vt0, vc4\\n\" +\r\n\t\t\t\"m44 op, vt0, vc0\\n\" +\r\n\t\t\t\"mov v0, va0\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(pass, camera, viewProjection);\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tvar pos:Vector3D = camera.scenePosition;\r\n\t\tthis._vertexArray[0] = pos.x;\r\n\t\tthis._vertexArray[1] = pos.y;\r\n\t\tthis._vertexArray[2] = pos.z;\r\n\t\tthis._vertexArray[4] = this._vertexArray[5] = this._vertexArray[6] = camera.projection.far/Math.sqrt(3);\r\n\t\tcontext.setProgramConstantsFromMatrix(ContextGLProgramType.VERTEX, 0, viewProjection, true);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 4, this._vertexArray, 2);\r\n\r\n\t\tthis._stage.activateBuffer(0, this.getVertexData(TriangleSubGeometry.POSITION_DATA), this.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\r\n\t\tcontext.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\r\n\t}\r\n}\r\n\r\nexport = SkyboxRenderable;",
    "import Matrix3D\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Matrix3DUtils\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\n\r\nimport IRenderableOwner\t\t\t\t= require(\"awayjs-display/lib/base/IRenderableOwner\");\r\nimport TriangleSubMesh\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubMesh\");\r\nimport TriangleSubGeometry\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Camera\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\n\r\nimport ContextGLVertexBufferFormat\t= require(\"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat\");\r\nimport IContextGL\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/IContextGL\");\r\nimport Stage\t\t\t\t\t\t= require(\"awayjs-stagegl/lib/base/Stage\");\r\nimport ContextGLProgramType\t\t\t= require(\"awayjs-stagegl/lib/base/ContextGLProgramType\");\r\n\r\nimport ShaderObjectBase\t\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderObjectBase\");\r\nimport ShaderRegisterCache\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterCache\");\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\nimport RenderableBase\t\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderableBase\");\r\nimport RenderablePoolBase\t\t\t= require(\"awayjs-renderergl/lib/pool/RenderablePoolBase\");\r\nimport RenderPassBase\t\t\t\t= require(\"awayjs-renderergl/lib/passes/RenderPassBase\");\r\n\r\n/**\r\n * @class away.pool.TriangleSubMeshRenderable\r\n */\r\nclass TriangleSubMeshRenderable extends RenderableBase\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic static id:string = \"trianglesubmesh\";\r\n\r\n\tpublic static vertexAttributesOffset:number = 1;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic subMesh:TriangleSubMesh;\r\n\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param subMesh\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t */\r\n\tconstructor(pool:RenderablePoolBase, subMesh:TriangleSubMesh, stage:Stage, level:number = 0, indexOffset:number = 0)\r\n\t{\r\n\t\tsuper(pool, subMesh.parentMesh, subMesh, subMesh.material, stage, level, indexOffset);\r\n\r\n\t\tthis.subMesh = subMesh;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @returns {SubGeometryBase}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetSubGeometry():TriangleSubGeometry\r\n\t{\r\n\t\tvar subGeometry:TriangleSubGeometry;\r\n\r\n\t\tif (this.subMesh.animator)\r\n\t\t\tsubGeometry = <TriangleSubGeometry> this.subMesh.animator.getRenderableSubGeometry(this, this.subMesh.subGeometry);\r\n\t\telse\r\n\t\t\tsubGeometry = this.subMesh.subGeometry;\r\n\r\n\t\tthis._pVertexDataDirty[TriangleSubGeometry.POSITION_DATA] = true;\r\n\r\n\t\tif (subGeometry.vertexNormals)\r\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.NORMAL_DATA] = true;\r\n\r\n\t\tif (subGeometry.vertexTangents)\r\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.TANGENT_DATA] = true;\r\n\r\n\t\tif (subGeometry.uvs)\r\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.UV_DATA] = true;\r\n\r\n\t\tif (subGeometry.secondaryUVs)\r\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.SECONDARY_UV_DATA] = true;\r\n\r\n\t\tif (subGeometry.jointIndices)\r\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.JOINT_INDEX_DATA] = true;\r\n\r\n\t\tif (subGeometry.jointWeights)\r\n\t\t\tthis._pVertexDataDirty[TriangleSubGeometry.JOINT_WEIGHT_DATA] = true;\r\n\r\n\t\tswitch(subGeometry.jointsPerVertex) {\r\n\t\t\tcase 1:\r\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tthis.JOINT_INDEX_FORMAT = this.JOINT_WEIGHT_FORMAT = ContextGLVertexBufferFormat.FLOAT_4;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\r\n\t\treturn subGeometry;\r\n\t}\r\n\r\n\r\n\tpublic static _iIncludeDependencies(shaderObject:ShaderObjectBase)\r\n\t{\r\n\r\n\t}\r\n\r\n\tpublic static _iGetVertexCode(shaderObject:ShaderObjectBase, registerCache:ShaderRegisterCache, sharedRegisters:ShaderRegisterData):string\r\n\t{\r\n\t\tvar code:string = \"\";\r\n\r\n\t\t//get the projection coordinates\r\n\t\tvar position:ShaderRegisterElement = (shaderObject.globalPosDependencies > 0)? sharedRegisters.globalPositionVertex : sharedRegisters.localPosition;\r\n\r\n\t\t//reserving vertex constants for projection matrix\r\n\t\tvar viewMatrixReg:ShaderRegisterElement = registerCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tregisterCache.getFreeVertexConstant();\r\n\t\tshaderObject.viewMatrixIndex = viewMatrixReg.index*4;\r\n\r\n\t\tif (shaderObject.projectionDependencies > 0) {\r\n\t\t\tsharedRegisters.projectionFragment = registerCache.getFreeVarying();\r\n\t\t\tvar temp:ShaderRegisterElement = registerCache.getFreeVertexVectorTemp();\r\n\t\t\tcode += \"m44 \" + temp + \", \" + position + \", \" + viewMatrixReg + \"\\n\" +\r\n\t\t\t\"mov \" + sharedRegisters.projectionFragment + \", \" + temp + \"\\n\" +\r\n\t\t\t\"mov op, \" + temp + \"\\n\";\r\n\t\t} else {\r\n\t\t\tcode += \"m44 op, \" + position + \", \" + viewMatrixReg + \"\\n\";\r\n\t\t}\r\n\r\n\t\treturn code;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iRender(pass:RenderPassBase, camera:Camera, viewProjection:Matrix3D)\r\n\t{\r\n\t\tsuper._iRender(pass, camera, viewProjection);\r\n\r\n\t\tvar shader:ShaderObjectBase = pass.shader;\r\n\r\n\t\tif (shader.sceneMatrixIndex >= 0) {\r\n\t\t\tthis.sourceEntity.getRenderSceneTransform(camera).copyRawDataTo(shader.vertexConstantData, shader.sceneMatrixIndex, true);\r\n\t\t\tviewProjection.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t} else {\r\n\t\t\tvar matrix3D:Matrix3D = Matrix3DUtils.CALCULATION_MATRIX;\r\n\r\n\t\t\tmatrix3D.copyFrom(this.sourceEntity.getRenderSceneTransform(camera));\r\n\t\t\tmatrix3D.append(viewProjection);\r\n\r\n\t\t\tmatrix3D.copyRawDataTo(shader.vertexConstantData, shader.viewMatrixIndex, true);\r\n\t\t}\r\n\r\n\t\tvar context:IContextGL = this._stage.context;\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.VERTEX, 0, shader.vertexConstantData, shader.numUsedVertexConstants);\r\n\t\tcontext.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT, 0, shader.fragmentConstantData, shader.numUsedFragmentConstants);\r\n\r\n\t\tthis._stage.activateBuffer(0, this.getVertexData(TriangleSubGeometry.POSITION_DATA), this.getVertexOffset(TriangleSubGeometry.POSITION_DATA), TriangleSubGeometry.POSITION_FORMAT);\r\n\t\tthis._stage.context.drawTriangles(this._stage.getIndexBuffer(this.getIndexData()), 0, this.numTriangles);\r\n\t}\r\n\r\n\t/**\r\n\t * //TODO\r\n\t *\r\n\t * @param pool\r\n\t * @param renderableOwner\r\n\t * @param level\r\n\t * @param indexOffset\r\n\t * @returns {away.pool.TriangleSubMeshRenderable}\r\n\t * @protected\r\n\t */\r\n\tpublic _pGetOverflowRenderable(indexOffset:number):RenderableBase\r\n\t{\r\n\t\treturn new TriangleSubMeshRenderable(this._pool, <TriangleSubMesh> this.renderableOwner, this._stage, this._level + 1, indexOffset);\r\n\t}\r\n}\r\n\r\nexport = TriangleSubMeshRenderable;",
    "import Matrix3DUtils\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3DUtils\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\n/**\r\n *  Class Merge merges two or more static meshes into one.<code>Merge</code>\r\n */\r\nclass Merge\r\n{\r\n\r\n\t//private const LIMIT:uint = 196605;\r\n\tprivate _objectSpace:boolean;\r\n\tprivate _keepMaterial:boolean;\r\n\tprivate _disposeSources:boolean;\r\n\tprivate _geomVOs:Array<GeometryVO>;\r\n\tprivate _toDispose:Array<Mesh>;\r\n\r\n\t/**\r\n\t * @param    keepMaterial    [optional]    Determines if the merged object uses the recevier mesh material information or keeps its source material(s). Defaults to false.\r\n\t * If false and receiver object has multiple materials, the last material found in receiver submeshes is applied to the merged submesh(es).\r\n\t * @param    disposeSources  [optional]    Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.\r\n\t * If true, only receiver geometry and resulting mesh are kept in  memory.\r\n\t * @param    objectSpace     [optional]    Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.\r\n\t */\r\n\tconstructor(keepMaterial:boolean = false, disposeSources:boolean = false, objectSpace:boolean = false)\r\n\t{\r\n\t\tthis._keepMaterial = keepMaterial;\r\n\t\tthis._disposeSources = disposeSources;\r\n\t\tthis._objectSpace = objectSpace;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if the mesh and geometry source(s) used for the merging are disposed. Defaults to false.\r\n\t */\r\n\tpublic set disposeSources(b:boolean)\r\n\t{\r\n\t\tthis._disposeSources = b;\r\n\t}\r\n\r\n\tpublic get disposeSources():boolean\r\n\t{\r\n\t\treturn this._disposeSources;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if the material source(s) used for the merging are disposed. Defaults to false.\r\n\t */\r\n\tpublic set keepMaterial(b:boolean)\r\n\t{\r\n\t\tthis._keepMaterial = b;\r\n\t}\r\n\r\n\tpublic get keepMaterial():boolean\r\n\t{\r\n\t\treturn this._keepMaterial;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if source mesh(es) is/are merged using objectSpace or worldspace. Defaults to false.\r\n\t */\r\n\tpublic set objectSpace(b:boolean)\r\n\t{\r\n\t\tthis._objectSpace = b;\r\n\t}\r\n\r\n\tpublic get objectSpace():boolean\r\n\t{\r\n\t\treturn this._objectSpace;\r\n\t}\r\n\r\n\t/**\r\n\t * Merges all the children of a container into a single Mesh. If no Mesh object is found, method returns the receiver without modification.\r\n\t *\r\n\t * @param    receiver           The Mesh to receive the merged contents of the container.\r\n\t * @param    objectContainer    The DisplayObjectContainer holding the meshes to be mergd.\r\n\t *\r\n\t * @return The merged Mesh instance.\r\n\t */\r\n\tpublic applyToContainer(receiver:Mesh, objectContainer:DisplayObjectContainer)\r\n\t{\r\n\t\tthis.reset();\r\n\r\n\t\t//collect container meshes\r\n\t\tthis.parseContainer(receiver, objectContainer);\r\n\r\n\t\t//collect receiver\r\n\t\tthis.collect(receiver, false);\r\n\r\n\t\t//merge to receiver\r\n\t\tthis.merge(receiver, this._disposeSources);\r\n\t}\r\n\r\n\t/**\r\n\t * Merges all the meshes found in the Array&lt;Mesh&gt; into a single Mesh.\r\n\t *\r\n\t * @param    receiver    The Mesh to receive the merged contents of the meshes.\r\n\t * @param    meshes      A series of Meshes to be merged with the reciever mesh.\r\n\t */\r\n\tpublic applyToMeshes(receiver:Mesh, meshes:Array<Mesh>)\r\n\t{\r\n\t\tthis.reset();\r\n\r\n\t\tif (!meshes.length)\r\n\t\t\treturn;\r\n\r\n\t\t//collect meshes in vector\r\n\t\tfor (var i:number /*uint*/ = 0; i < meshes.length; i++)\r\n\t\t\tif (meshes[i] != receiver)\r\n\t\t\t\tthis.collect(meshes[i], this._disposeSources);\r\n\r\n\t\t//collect receiver\r\n\t\tthis.collect(receiver, false);\r\n\r\n\t\t//merge to receiver\r\n\t\tthis.merge(receiver, this._disposeSources);\r\n\t}\r\n\r\n\t/**\r\n\t *  Merges 2 meshes into one. It is recommand to use apply when 2 meshes are to be merged. If more need to be merged, use either applyToMeshes or applyToContainer methods.\r\n\t *\r\n\t * @param    receiver    The Mesh to receive the merged contents of both meshes.\r\n\t * @param    mesh        The Mesh to be merged with the receiver mesh\r\n\t */\r\n\tpublic apply(receiver:Mesh, mesh:Mesh)\r\n\t{\r\n\t\tthis.reset();\r\n\r\n\t\t//collect mesh\r\n\t\tthis.collect(mesh, this._disposeSources);\r\n\r\n\t\t//collect receiver\r\n\t\tthis.collect(receiver, false);\r\n\r\n\t\t//merge to receiver\r\n\t\tthis.merge(receiver, this._disposeSources);\r\n\t}\r\n\r\n\tprivate reset()\r\n\t{\r\n\t\tthis._toDispose  = new Array<Mesh>();\r\n\t\tthis._geomVOs = new Array<GeometryVO>();\r\n\t}\r\n\r\n\tprivate merge(destMesh:Mesh, dispose:boolean)\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar subIdx:number /*uint*/;\r\n\t\tvar oldGeom:Geometry;\r\n\t\tvar destGeom:Geometry;\r\n\t\tvar useSubMaterials:boolean;\r\n\r\n\t\toldGeom = destMesh.geometry;\r\n\t\tdestGeom = destMesh.geometry = new Geometry();\r\n\t\tsubIdx = destMesh.subMeshes.length;\r\n\r\n\t\t// Only apply materials directly to sub-meshes if necessary,\r\n\t\t// i.e. if there is more than one material available.\r\n\t\tuseSubMaterials = (this._geomVOs.length > 1);\r\n\r\n\t\tfor (i = 0; i < this._geomVOs.length; i++) {\r\n\t\t\tvar s:number /*uint*/;\r\n\t\t\tvar data:GeometryVO;\r\n\t\t\tvar sub:TriangleSubGeometry = new TriangleSubGeometry(true);\r\n\t\t\tsub.autoDeriveNormals = false;\r\n\t\t\tsub.autoDeriveTangents = false;\r\n\r\n\t\t\tdata = this._geomVOs[i];\r\n\t\t\tsub.updateIndices(data.indices);\r\n\t\t\tsub.updatePositions(data.vertices);\r\n\t\t\tsub.updateVertexNormals(data.normals);\r\n\t\t\tsub.updateVertexTangents(data.tangents);\r\n\t\t\tsub.updateUVs(data.uvs);\r\n\r\n\t\t\tdestGeom.addSubGeometry(sub);\r\n\r\n\t\t\tif (this._keepMaterial && useSubMaterials)\r\n\t\t\t\tdestMesh.subMeshes[subIdx].material = data.material;\r\n\t\t}\r\n\r\n\t\tif (this._keepMaterial && !useSubMaterials && this._geomVOs.length)\r\n\t\t\tdestMesh.material = this._geomVOs[0].material;\r\n\r\n\t\tif (dispose) {\r\n\t\t\tvar m:Mesh;\r\n\t\t\tvar len:number = this._toDispose.length;\r\n\t\t\tfor (var i:number; i < len; i++) {\r\n\t\t\t\tm = this._toDispose[i];\r\n\t\t\t\tm.geometry.dispose();\r\n\t\t\t\tm.dispose();\r\n\t\t\t}\r\n\r\n\t\t\t//dispose of the original receiver geometry\r\n\t\t\toldGeom.dispose();\r\n\t\t}\r\n\r\n\t\tthis._toDispose = null;\r\n\t}\r\n\r\n\tprivate collect(mesh:Mesh, dispose:boolean)\r\n\t{\r\n\t\tif (mesh.geometry) {\r\n\t\t\tvar subIdx:number /*uint*/;\r\n\t\t\tvar subGeometries:Array<TriangleSubGeometry> = <Array<TriangleSubGeometry>> mesh.geometry.subGeometries;\r\n\t\t\tvar calc:number /*uint*/;\r\n\t\t\tfor (subIdx = 0; subIdx < subGeometries.length; subIdx++) {\r\n\t\t\t\tvar i:number /*uint*/;\r\n\t\t\t\tvar len:number /*uint*/;\r\n\t\t\t\tvar iIdx:number /*uint*/, vIdx:number /*uint*/, nIdx:number /*uint*/, tIdx:number /*uint*/, uIdx:number /*uint*/;\r\n\t\t\t\tvar indexOffset:number /*uint*/;\r\n\t\t\t\tvar subGeom:TriangleSubGeometry;\r\n\t\t\t\tvar vo:GeometryVO;\r\n\t\t\t\tvar vertices:Array<number>;\r\n\t\t\t\tvar normals:Array<number>;\r\n\t\t\t\tvar tangents:Array<number>;\r\n\t\t\t\tvar pd:Array<number>, nd:Array<number>, td:Array<number>, ud:Array<number>;\r\n\r\n\t\t\t\tsubGeom = subGeometries[subIdx];\r\n\t\t\t\tpd = subGeom.positions;\r\n\t\t\t\tnd = subGeom.vertexNormals;\r\n\t\t\t\ttd = subGeom.vertexTangents;\r\n\t\t\t\tud = subGeom.uvs;\r\n\r\n\t\t\t\t// Get (or create) a VO for this material\r\n\t\t\t\tvo = this.getSubGeomData(mesh.subMeshes[subIdx].material || mesh.material);\r\n\r\n\t\t\t\t// Vertices and normals are copied to temporary vectors, to be transformed\r\n\t\t\t\t// before concatenated onto those of the data. This is unnecessary if no\r\n\t\t\t\t// transformation will be performed, i.e. for object space merging.\r\n\t\t\t\tvertices = (this._objectSpace)? vo.vertices : new Array<number>();\r\n\t\t\t\tnormals = (this._objectSpace)? vo.normals : new Array<number>();\r\n\t\t\t\ttangents = (this._objectSpace)? vo.tangents : new Array<number>();\r\n\r\n\t\t\t\t// Copy over vertex attributes\r\n\t\t\t\tvIdx = vertices.length;\r\n\t\t\t\tnIdx = normals.length;\r\n\t\t\t\ttIdx = tangents.length;\r\n\t\t\t\tuIdx = vo.uvs.length;\r\n\t\t\t\tlen = subGeom.numVertices;\r\n\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\tcalc = i*3;\r\n\r\n\t\t\t\t\t// Position\r\n\t\t\t\t\tvertices[vIdx++] = pd[calc];\r\n\t\t\t\t\tvertices[vIdx++] = pd[calc + 1];\r\n\t\t\t\t\tvertices[vIdx++] = pd[calc + 2];\r\n\r\n\t\t\t\t\t// Normal\r\n\t\t\t\t\tnormals[nIdx++] = nd[calc];\r\n\t\t\t\t\tnormals[nIdx++] = nd[calc + 1];\r\n\t\t\t\t\tnormals[nIdx++] = nd[calc + 2];\r\n\r\n\t\t\t\t\t// Tangent\r\n\t\t\t\t\ttangents[tIdx++] = td[calc];\r\n\t\t\t\t\ttangents[tIdx++] = td[calc + 1];\r\n\t\t\t\t\ttangents[tIdx++] = td[calc + 2];\r\n\r\n\t\t\t\t\t// UV\r\n\t\t\t\t\tvo.uvs[uIdx++] = ud[i*2];\r\n\t\t\t\t\tvo.uvs[uIdx++] = ud[i*2 + 1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Copy over triangle indices\r\n\t\t\t\tindexOffset = (!this._objectSpace)? vo.vertices.length/3 :0;\r\n\t\t\t\tiIdx = vo.indices.length;\r\n\t\t\t\tlen = subGeom.numTriangles;\r\n\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\tcalc = i*3;\r\n\t\t\t\t\tvo.indices[iIdx++] = subGeom.indices[calc] + indexOffset;\r\n\t\t\t\t\tvo.indices[iIdx++] = subGeom.indices[calc + 1] + indexOffset;\r\n\t\t\t\t\tvo.indices[iIdx++] = subGeom.indices[calc + 2] + indexOffset;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this._objectSpace) {\r\n\t\t\t\t\tmesh.sceneTransform.transformVectors(vertices, vertices);\r\n\t\t\t\t\tMatrix3DUtils.deltaTransformVectors(mesh.sceneTransform, normals, normals);\r\n\t\t\t\t\tMatrix3DUtils.deltaTransformVectors(mesh.sceneTransform, tangents, tangents);\r\n\r\n\t\t\t\t\t// Copy vertex data from temporary (transformed) vectors\r\n\t\t\t\t\tvIdx = vo.vertices.length;\r\n\t\t\t\t\tnIdx = vo.normals.length;\r\n\t\t\t\t\ttIdx = vo.tangents.length;\r\n\t\t\t\t\tlen = vertices.length;\r\n\t\t\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\t\t\tvo.vertices[vIdx++] = vertices[i];\r\n\t\t\t\t\t\tvo.normals[nIdx++] = normals[i];\r\n\t\t\t\t\t\tvo.tangents[tIdx++] = tangents[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (dispose)\r\n\t\t\t\tthis._toDispose.push(mesh);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getSubGeomData(material:MaterialBase):GeometryVO\r\n\t{\r\n\t\tvar data:GeometryVO;\r\n\r\n\t\tif (this._keepMaterial) {\r\n\t\t\tvar i:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tlen = this._geomVOs.length;\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\tif (this._geomVOs[i].material == material) {\r\n\t\t\t\t\tdata = this._geomVOs[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (this._geomVOs.length) {\r\n\t\t\t// If materials are not to be kept, all data can be\r\n\t\t\t// put into a single VO, so return that one.\r\n\t\t\tdata = this._geomVOs[0];\r\n\t\t}\r\n\r\n\t\t// No data (for this material) found, create new.\r\n\t\tif (!data) {\r\n\t\t\tdata = new GeometryVO();\r\n\t\t\tdata.vertices = new Array<number>();\r\n\t\t\tdata.normals = new Array<number>();\r\n\t\t\tdata.tangents = new Array<number>();\r\n\t\t\tdata.uvs = new Array<number>();\r\n\t\t\tdata.indices = new Array<number /*uint*/>();\r\n\t\t\tdata.material = material;\r\n\r\n\t\t\tthis._geomVOs.push(data);\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate parseContainer(receiver:Mesh, object:DisplayObjectContainer)\r\n\t{\r\n\t\tvar child:DisplayObjectContainer;\r\n\t\tvar i:number /*uint*/;\r\n\r\n\t\tif (object instanceof Mesh && object != (<DisplayObjectContainer> receiver))\r\n\t\t\tthis.collect(<Mesh> object, this._disposeSources);\r\n\r\n\t\tfor (i = 0; i < object.numChildren; ++i) {\r\n\t\t\tchild = <DisplayObjectContainer> object.getChildAt(i);\r\n\t\t\tthis.parseContainer(receiver, child);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = Merge;\r\n\r\nclass GeometryVO\r\n{\r\n\tpublic uvs:Array<number>;\r\n\tpublic vertices:Array<number>;\r\n\tpublic normals:Array<number>;\r\n\tpublic tangents:Array<number>;\r\n\tpublic indices:Array<number /*uint*/>;\r\n\tpublic material:MaterialBase;\r\n}\r\n",
    "import Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleGeometryTransform\r\n{\r\n\tprivate _defaultVertexTransform:Matrix3D;\r\n\tprivate _defaultInvVertexTransform:Matrix3D;\r\n\tprivate _defaultUVTransform:Matrix;\r\n\r\n\tpublic set vertexTransform(value:Matrix3D)\r\n\t{\r\n\t\tthis._defaultVertexTransform = value;\r\n\t\tthis._defaultInvVertexTransform = value.clone();\r\n\t\tthis._defaultInvVertexTransform.invert();\r\n\t\tthis._defaultInvVertexTransform.transpose();\r\n\t}\r\n\r\n\tpublic set UVTransform(value:Matrix)\r\n\t{\r\n\t\tthis._defaultUVTransform = value;\r\n\t}\r\n\r\n\tpublic get UVTransform():Matrix\r\n\t{\r\n\t\treturn this._defaultUVTransform;\r\n\t}\r\n\r\n\tpublic get vertexTransform():Matrix3D\r\n\t{\r\n\t\treturn this._defaultVertexTransform;\r\n\t}\r\n\r\n\tpublic get invVertexTransform():Matrix3D\r\n\t{\r\n\t\treturn this._defaultInvVertexTransform;\r\n\t}\r\n}\r\n\r\nexport = ParticleGeometryTransform;",
    "import Matrix\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Point\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Point\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-display/lib/base/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-display/lib/base/TriangleSubGeometry\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport ParticleData\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/ParticleData\");\r\nimport ParticleGeometry\t\t\t\t\t= require(\"awayjs-renderergl/lib/base/ParticleGeometry\");\r\nimport ParticleGeometryTransform\t\t= require(\"awayjs-renderergl/lib/tools/data/ParticleGeometryTransform\");\r\n\r\n/**\r\n * ...\r\n */\r\nclass ParticleGeometryHelper\r\n{\r\n\tpublic static MAX_VERTEX:number /*int*/ = 65535;\r\n\r\n\tpublic static generateGeometry(geometries:Array<Geometry>, transforms:Array<ParticleGeometryTransform> = null):ParticleGeometry\r\n\t{\r\n\t\tvar indicesVector:Array<Array<number>> /*uint*/ = new Array<Array<number>>() /*uint*/;\r\n\t\tvar positionsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar normalsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar tangentsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar uvsVector:Array<Array<number>> = new Array<Array<number>>();\r\n\t\tvar vertexCounters:Array<number> /*uint*/ = new Array<number>() /*uint*/;\r\n\t\tvar particles:Array<ParticleData> = new Array<ParticleData>();\r\n\t\tvar subGeometries:Array<TriangleSubGeometry> = new Array<TriangleSubGeometry>();\r\n\t\tvar numParticles:number /*uint*/ = geometries.length;\r\n\r\n\t\tvar sourceSubGeometries:Array<TriangleSubGeometry>;\r\n\t\tvar sourceSubGeometry:TriangleSubGeometry;\r\n\t\tvar numSubGeometries:number /*uint*/;\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\t\tvar positions:Array<number>;\r\n\t\tvar normals:Array<number>;\r\n\t\tvar tangents:Array<number>;\r\n\t\tvar uvs:Array<number>;\r\n\t\tvar vertexCounter:number /*uint*/;\r\n\t\tvar subGeometry:TriangleSubGeometry;\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar sub2SubMap:Array<number> /*int*/ = new Array<number>() /*int*/;\r\n\r\n\t\tvar tempVertex:Vector3D = new Vector3D;\r\n\t\tvar tempNormal:Vector3D = new Vector3D;\r\n\t\tvar tempTangents:Vector3D = new Vector3D;\r\n\t\tvar tempUV:Point = new Point;\r\n\r\n\t\tfor (i = 0; i < numParticles; i++) {\r\n\t\t\tsourceSubGeometries = <Array<TriangleSubGeometry>> geometries[i].subGeometries;\r\n\t\t\tnumSubGeometries = sourceSubGeometries.length;\r\n\t\t\tfor (var srcIndex:number /*int*/ = 0; srcIndex < numSubGeometries; srcIndex++) {\r\n\t\t\t\t//create a different particle subgeometry group for each source subgeometry in a particle.\r\n\t\t\t\tif (sub2SubMap.length <= srcIndex) {\r\n\t\t\t\t\tsub2SubMap.push(subGeometries.length);\r\n\t\t\t\t\tindicesVector.push(new Array<number>() /*uint*/);\r\n\t\t\t\t\tpositionsVector.push(new Array<number>());\r\n\t\t\t\t\tnormalsVector.push(new Array<number>());\r\n\t\t\t\t\ttangentsVector.push(new Array<number>());\r\n\t\t\t\t\tuvsVector.push(new Array<number>());\r\n\t\t\t\t\tsubGeometries.push(new TriangleSubGeometry(true));\r\n\t\t\t\t\tvertexCounters.push(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsourceSubGeometry = sourceSubGeometries[srcIndex];\r\n\r\n\t\t\t\t//add a new particle subgeometry if this source subgeometry will take us over the maxvertex limit\r\n\t\t\t\tif (sourceSubGeometry.numVertices + vertexCounters[sub2SubMap[srcIndex]] > ParticleGeometryHelper.MAX_VERTEX) {\r\n\t\t\t\t\t//update submap and add new subgeom vectors\r\n\t\t\t\t\tsub2SubMap[srcIndex] = subGeometries.length;\r\n\t\t\t\t\tindicesVector.push(new Array<number>() /*uint*/);\r\n\t\t\t\t\tpositionsVector.push(new Array<number>());\r\n\t\t\t\t\tnormalsVector.push(new Array<number>());\r\n\t\t\t\t\ttangentsVector.push(new Array<number>());\r\n\t\t\t\t\tuvsVector.push(new Array<number>());\r\n\t\t\t\t\tsubGeometries.push(new TriangleSubGeometry(true));\r\n\t\t\t\t\tvertexCounters.push(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tj = sub2SubMap[srcIndex];\r\n\r\n\t\t\t\t//select the correct vector\r\n\t\t\t\tindices = indicesVector[j];\r\n\t\t\t\tpositions = positionsVector[j];\r\n\t\t\t\tnormals = normalsVector[j];\r\n\t\t\t\ttangents = tangentsVector[j];\r\n\t\t\t\tuvs = uvsVector[j];\r\n\t\t\t\tvertexCounter = vertexCounters[j];\r\n\t\t\t\tsubGeometry = subGeometries[j];\r\n\r\n\t\t\t\tvar particleData:ParticleData = new ParticleData();\r\n\t\t\t\tparticleData.numVertices = sourceSubGeometry.numVertices;\r\n\t\t\t\tparticleData.startVertexIndex = vertexCounter;\r\n\t\t\t\tparticleData.particleIndex = i;\r\n\t\t\t\tparticleData.subGeometry = subGeometry;\r\n\t\t\t\tparticles.push(particleData);\r\n\r\n\t\t\t\tvertexCounters[j] += sourceSubGeometry.numVertices;\r\n\r\n\t\t\t\tvar k:number /*int*/;\r\n\t\t\t\tvar tempLen:number /*int*/;\r\n\t\t\t\tvar compact:TriangleSubGeometry = sourceSubGeometry;\r\n\t\t\t\tvar product:number /*uint*/;\r\n\t\t\t\tvar sourcePositions:Array<number>;\r\n\t\t\t\tvar sourceNormals:Array<number>;\r\n\t\t\t\tvar sourceTangents:Array<number>;\r\n\t\t\t\tvar sourceUVs:Array<number>;\r\n\r\n\t\t\t\tif (compact) {\r\n\t\t\t\t\ttempLen = compact.numVertices;\r\n\t\t\t\t\tcompact.numTriangles;\r\n\t\t\t\t\tsourcePositions = compact.positions;\r\n\t\t\t\t\tsourceNormals = compact.vertexNormals;\r\n\t\t\t\t\tsourceTangents = compact.vertexTangents;\r\n\t\t\t\t\tsourceUVs = compact.uvs;\r\n\r\n\t\t\t\t\tif (transforms) {\r\n\t\t\t\t\t\tvar particleGeometryTransform:ParticleGeometryTransform = transforms[i];\r\n\t\t\t\t\t\tvar vertexTransform:Matrix3D = particleGeometryTransform.vertexTransform;\r\n\t\t\t\t\t\tvar invVertexTransform:Matrix3D = particleGeometryTransform.invVertexTransform;\r\n\t\t\t\t\t\tvar UVTransform:Matrix = particleGeometryTransform.UVTransform;\r\n\r\n\t\t\t\t\t\tfor (k = 0; k < tempLen; k++) {\r\n\t\t\t\t\t\t\t/*\r\n\t\t\t\t\t\t\t * 0 - 2: vertex position X, Y, Z\r\n\t\t\t\t\t\t\t * 3 - 5: normal X, Y, Z\r\n\t\t\t\t\t\t\t * 6 - 8: tangent X, Y, Z\r\n\t\t\t\t\t\t\t * 9 - 10: U V\r\n\t\t\t\t\t\t\t * 11 - 12: Secondary U V*/\r\n\t\t\t\t\t\t\tproduct = k*3;\r\n\t\t\t\t\t\t\ttempVertex.x = sourcePositions[product];\r\n\t\t\t\t\t\t\ttempVertex.y = sourcePositions[product + 1];\r\n\t\t\t\t\t\t\ttempVertex.z = sourcePositions[product + 2];\r\n\t\t\t\t\t\t\ttempNormal.x = sourceNormals[product];\r\n\t\t\t\t\t\t\ttempNormal.y = sourceNormals[product + 1];\r\n\t\t\t\t\t\t\ttempNormal.z = sourceNormals[product + 2];\r\n\t\t\t\t\t\t\ttempTangents.x = sourceTangents[product];\r\n\t\t\t\t\t\t\ttempTangents.y = sourceTangents[product + 1];\r\n\t\t\t\t\t\t\ttempTangents.z = sourceTangents[product + 2];\r\n\t\t\t\t\t\t\ttempUV.x = sourceUVs[k*2];\r\n\t\t\t\t\t\t\ttempUV.y = sourceUVs[k*2 + 1];\r\n\t\t\t\t\t\t\tif (vertexTransform) {\r\n\t\t\t\t\t\t\t\ttempVertex = vertexTransform.transformVector(tempVertex);\r\n\t\t\t\t\t\t\t\ttempNormal = invVertexTransform.deltaTransformVector(tempNormal);\r\n\t\t\t\t\t\t\t\ttempTangents = invVertexTransform.deltaTransformVector(tempNormal);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (UVTransform)\r\n\t\t\t\t\t\t\t\ttempUV = UVTransform.transformPoint(tempUV);\r\n\t\t\t\t\t\t\t//this is faster than that only push one data\r\n\t\t\t\t\t\t\tsourcePositions.push(tempVertex.x, tempVertex.y, tempVertex.z);\r\n\t\t\t\t\t\t\tsourceNormals.push(tempNormal.x, tempNormal.y, tempNormal.z);\r\n\t\t\t\t\t\t\tsourceTangents.push(tempTangents.x, tempTangents.y, tempTangents.z);\r\n\t\t\t\t\t\t\tsourceUVs.push(tempUV.x, tempUV.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (k = 0; k < tempLen; k++) {\r\n\t\t\t\t\t\t\tproduct = k*3;\r\n\t\t\t\t\t\t\t//this is faster than that only push one data\r\n\t\t\t\t\t\t\tpositions.push(sourcePositions[product], sourcePositions[product + 1], sourcePositions[product + 2]);\r\n\t\t\t\t\t\t\tnormals.push(sourceNormals[product], sourceNormals[product + 1], sourceNormals[product + 2]);\r\n\t\t\t\t\t\t\ttangents.push(sourceTangents[product], sourceTangents[product + 1], sourceTangents[product + 2]);\r\n\t\t\t\t\t\t\tuvs.push(sourceUVs[k*2], sourceUVs[k*2 + 1]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//Todo\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar sourceIndices:Array<number> /*uint*/ = sourceSubGeometry.indices;\r\n\t\t\t\ttempLen = sourceSubGeometry.numTriangles;\r\n\t\t\t\tfor (k = 0; k < tempLen; k++) {\r\n\t\t\t\t\tproduct = k*3;\r\n\t\t\t\t\tindices.push(sourceIndices[product] + vertexCounter, sourceIndices[product + 1] + vertexCounter, sourceIndices[product + 2] + vertexCounter);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar particleGeometry:ParticleGeometry = new ParticleGeometry();\r\n\t\tparticleGeometry.particles = particles;\r\n\t\tparticleGeometry.numParticles = numParticles;\r\n\r\n\t\tnumParticles = subGeometries.length;\r\n\t\tfor (i = 0; i < numParticles; i++) {\r\n\t\t\tsubGeometry = subGeometries[i];\r\n\t\t\tsubGeometry.autoDeriveNormals = false;\r\n\t\t\tsubGeometry.autoDeriveTangents = false;\r\n\t\t\tsubGeometry.updateIndices(indicesVector[i]);\r\n\t\t\tsubGeometry.updatePositions(positionsVector[i]);\r\n\t\t\tsubGeometry.updateVertexNormals(normalsVector[i]);\r\n\t\t\tsubGeometry.updateVertexTangents(tangentsVector[i]);\r\n\t\t\tsubGeometry.updateUVs(uvsVector[i]);\r\n\t\t\tparticleGeometry.addSubGeometry(subGeometry);\r\n\t\t}\r\n\r\n\t\treturn particleGeometry;\r\n\t}\r\n}\r\n\r\nexport = ParticleGeometryHelper;",
    "import Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\n/**\r\n *\r\n */\r\nclass PerspectiveMatrix3D extends Matrix3D\r\n{\r\n\tconstructor(v:Array<number> = null)\r\n\t{\r\n\t\tsuper(v);\r\n\t}\r\n\r\n\tpublic perspectiveFieldOfViewLH(fieldOfViewY:number, aspectRatio:number, zNear:number, zFar:number)\r\n\t{\r\n\t\tvar yScale:number = 1/Math.tan(fieldOfViewY/2);\r\n\t\tvar xScale:number = yScale/aspectRatio;\r\n\r\n\t\tthis.copyRawDataFrom([xScale, 0.0, 0.0, 0.0, 0.0, yScale, 0.0, 0.0, 0.0, 0.0, zFar/(zFar - zNear), 1.0, 0.0, 0.0, (zNear*zFar)/(zNear - zFar), 0.0]);\r\n\t}\r\n}\r\n\r\nexport = PerspectiveMatrix3D;",
    "import TextureProxyBase\t\t\t\t= require(\"awayjs-core/lib/textures/TextureProxyBase\");\r\n\r\nimport ContextGLTextureFormat\t\t= require(\"awayjs-stagegl/lib/base/ContextGLTextureFormat\");\r\n\r\nimport ShaderRegisterData\t\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterData\");\r\nimport ShaderRegisterElement\t\t= require(\"awayjs-renderergl/lib/compilation/ShaderRegisterElement\");\r\n\r\nclass ShaderCompilerHelper\r\n{\r\n\t/**\r\n\t * A helper method that generates standard code for sampling from a texture using the normal uv coordinates.\r\n\t * @param vo The MethodVO object linking this method with the pass currently being compiled.\r\n\t * @param sharedReg The shared register object for the shader.\r\n\t * @param inputReg The texture stream register.\r\n\t * @param texture The texture which will be assigned to the given slot.\r\n\t * @param uvReg An optional uv register if coordinates different from the primary uv coordinates are to be used.\r\n\t * @param forceWrap If true, texture wrapping is enabled regardless of the material setting.\r\n\t * @return The fragment code that performs the sampling.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\tpublic static getTex2DSampleCode(targetReg:ShaderRegisterElement, sharedReg:ShaderRegisterData, inputReg:ShaderRegisterElement, texture:TextureProxyBase, smooth:boolean, repeat:boolean, mipmaps:boolean, uvReg:ShaderRegisterElement = null, forceWrap:string = null):string\r\n\t{\r\n\t\tvar wrap:string = forceWrap || (repeat? \"wrap\":\"clamp\");\r\n\t\tvar format:string = ShaderCompilerHelper.getFormatStringForTexture(texture);\r\n\t\tvar filter:string = (smooth)? (mipmaps? \"linear,miplinear\" : \"linear\") : (mipmaps? \"nearest,mipnearest\" : \"nearest\");\r\n\r\n\t\tif (uvReg == null)\r\n\t\t\tuvReg = sharedReg.uvVarying;\r\n\r\n\t\treturn \"tex \" + targetReg + \", \" + uvReg + \", \" + inputReg + \" <2d,\" + filter + \",\" + format + wrap + \">\\n\";\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * A helper method that generates standard code for sampling from a cube texture.\r\n\t * @param vo The MethodVO object linking this method with the pass currently being compiled.\r\n\t * @param targetReg The register in which to store the sampled colour.\r\n\t * @param inputReg The texture stream register.\r\n\t * @param texture The cube map which will be assigned to the given slot.\r\n\t * @param uvReg The direction vector with which to sample the cube map.\r\n\t *\r\n\t * @protected\r\n\t */\r\n\tpublic static getTexCubeSampleCode(targetReg:ShaderRegisterElement, inputReg:ShaderRegisterElement, texture:TextureProxyBase, smooth:boolean, mipmaps:boolean, uvReg:ShaderRegisterElement):string\r\n\t{\r\n\t\tvar filter:string;\r\n\t\tvar format:string = ShaderCompilerHelper.getFormatStringForTexture(texture);\r\n\t\tvar filter:string = (smooth)? (mipmaps? \"linear,miplinear\" : \"linear\") : (mipmaps? \"nearest,mipnearest\" : \"nearest\");\r\n\r\n\t\treturn \"tex \" + targetReg + \", \" + uvReg + \", \" + inputReg + \" <cube,\" + format + filter + \">\\n\";\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a texture format string for the sample instruction.\r\n\t * @param texture The texture for which to get the format string.\r\n\t * @return\r\n\t *\r\n\t * @protected\r\n\t */\r\n\tpublic static getFormatStringForTexture(texture:TextureProxyBase):string\r\n\t{\r\n\t\tswitch (texture.format) {\r\n\t\t\tcase ContextGLTextureFormat.COMPRESSED:\r\n\t\t\t\treturn \"dxt1,\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase ContextGLTextureFormat.COMPRESSED_ALPHA:\r\n\t\t\t\treturn \"dxt5,\";\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\treturn \"\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = ShaderCompilerHelper;"
  ],
  "sourceRoot": ""
}