require=function e(t,r,i){function a(n,o){if(!r[n]){if(!t[n]){var l=typeof require=="function"&&require;if(!o&&l)return l(n,!0);if(s)return s(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var c=r[n]={exports:{}};t[n][0].call(c.exports,function(e){var r=t[n][1][e];return a(r?r:e)},c,c.exports,e,t,r,i)}return r[n].exports}var s=typeof require=="function"&&require;for(var n=0;n<i.length;n++)a(i[n]);return a}({1:[function(e,t,r){"use strict";var i=e("./lib/animators");r.animators=i;var a=e("./lib/elements");r.elements=a;var s=e("./lib/errors");r.errors=s;var n=e("./lib/events");r.events=n;var o=e("./lib/filters");r.filters=o;var l=e("./lib/managers");r.managers=l;var h=e("./lib/renderables");r.renderables=h;var c=e("./lib/shaders");r.shaders=c;var u=e("./lib/sort");r.sort=u;var d=e("./lib/surfaces");r.surfaces=d;var p=e("./lib/textures");r.textures=p;var f=e("./lib/tools");r.tools=f;var _=e("./lib/utils");r.utils=_;var m=e("./lib/DefaultRenderer");r.DefaultRenderer=m.DefaultRenderer;var g=e("./lib/DepthRenderer");r.DepthRenderer=g.DepthRenderer;var y=e("./lib/DistanceRenderer");r.DistanceRenderer=y.DistanceRenderer;var v=e("./lib/Filter3DRenderer");r.Filter3DRenderer=v.Filter3DRenderer;var x=e("./lib/RendererBase");r.RendererBase=x.RendererBase;var b=e("awayjs-display/lib/materials/BasicMaterial");var P=e("awayjs-display/lib/display/Skybox");var S=e("awayjs-display/lib/display/Billboard");var C=e("awayjs-display/lib/display/LineSegment");var w=e("awayjs-display/lib/graphics/LineElements");var D=e("awayjs-display/lib/graphics/TriangleElements");var T=e("awayjs-display/lib/graphics/Graphic");var A=e("awayjs-display/lib/textures/Single2DTexture");var R=e("awayjs-display/lib/textures/SingleCubeTexture");var O=e("awayjs-stagegl/lib/base/Stage");d.SurfacePool.registerAbstraction(d.GL_BasicMaterialSurface,b.BasicMaterial);d.SurfacePool.registerAbstraction(d.GL_SkyboxSurface,P.Skybox);O.Stage.registerAbstraction(a.GL_LineElements,w.LineElements);O.Stage.registerAbstraction(a.GL_TriangleElements,D.TriangleElements);c.ShaderBase.registerAbstraction(p.GL_Single2DTexture,A.Single2DTexture);c.ShaderBase.registerAbstraction(p.GL_SingleCubeTexture,R.SingleCubeTexture);x.RendererBase.registerAbstraction(h.GL_BillboardRenderable,S.Billboard);x.RendererBase.registerAbstraction(h.GL_LineSegmentRenderable,C.LineSegment);x.RendererBase.registerAbstraction(h.GL_GraphicRenderable,T.Graphic);x.RendererBase.registerAbstraction(h.GL_SkyboxRenderable,P.Skybox)},{"./lib/DefaultRenderer":"awayjs-renderergl/lib/DefaultRenderer","./lib/DepthRenderer":"awayjs-renderergl/lib/DepthRenderer","./lib/DistanceRenderer":"awayjs-renderergl/lib/DistanceRenderer","./lib/Filter3DRenderer":"awayjs-renderergl/lib/Filter3DRenderer","./lib/RendererBase":"awayjs-renderergl/lib/RendererBase","./lib/animators":"awayjs-renderergl/lib/animators","./lib/elements":"awayjs-renderergl/lib/elements","./lib/errors":"awayjs-renderergl/lib/errors","./lib/events":"awayjs-renderergl/lib/events","./lib/filters":"awayjs-renderergl/lib/filters","./lib/managers":"awayjs-renderergl/lib/managers","./lib/renderables":"awayjs-renderergl/lib/renderables","./lib/shaders":"awayjs-renderergl/lib/shaders","./lib/sort":"awayjs-renderergl/lib/sort","./lib/surfaces":"awayjs-renderergl/lib/surfaces","./lib/textures":"awayjs-renderergl/lib/textures","./lib/tools":"awayjs-renderergl/lib/tools","./lib/utils":"awayjs-renderergl/lib/utils","awayjs-display/lib/display/Billboard":undefined,"awayjs-display/lib/display/LineSegment":undefined,"awayjs-display/lib/display/Skybox":undefined,"awayjs-display/lib/graphics/Graphic":undefined,"awayjs-display/lib/graphics/LineElements":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined,"awayjs-display/lib/materials/BasicMaterial":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-display/lib/textures/SingleCubeTexture":undefined,"awayjs-stagegl/lib/base/Stage":undefined}],"awayjs-renderergl/lib/DefaultRenderer":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/image/BitmapImage2D");var s=e("awayjs-stagegl/lib/base/ContextGLClearMask");var n=e("./RendererBase");var o=e("./DepthRenderer");var l=e("./DistanceRenderer");var h=e("./Filter3DRenderer");var c=e("./managers/RTTBufferManager");var u=function(e){i(t,e);function t(t,r,i,a){if(t===void 0){t=null}if(r===void 0){r=false}if(i===void 0){i="baseline"}if(a===void 0){a="auto"}e.call(this,t,null,r,i,a);this._antiAlias=0;this._directionalLights=new Array;this._pointLights=new Array;this._lightProbes=new Array;if(t)this.shareContext=true;this._pRttBufferManager=c.RTTBufferManager.getInstance(this._pStage);this._pDepthRenderer=new o.DepthRenderer(this._pStage);this._pDistanceRenderer=new l.DistanceRenderer(this._pStage);if(this._width==0)this.width=window.innerWidth;else this._pRttBufferManager.viewWidth=this._width;if(this._height==0)this.height=window.innerHeight;else this._pRttBufferManager.viewHeight=this._height}Object.defineProperty(t.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(e){if(this._antiAlias==e)return;this._antiAlias=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(e){this._depthPrepass=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(e){if(e&&e.length==0)e=null;if(this._pFilter3DRenderer&&!e){this._pFilter3DRenderer.dispose();this._pFilter3DRenderer=null}else if(!this._pFilter3DRenderer&&e){this._pFilter3DRenderer=new h.Filter3DRenderer(this._pStage);this._pFilter3DRenderer.filters=e}if(this._pFilter3DRenderer){this._pFilter3DRenderer.filters=e;this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender}else{this._pRequireDepthRender=false;if(this._pDepthRender){this._pDepthRender.dispose();this._pDepthRender=null}}},enumerable:true,configurable:true});t.prototype.enterNode=function(t){var r=e.prototype.enterNode.call(this,t);if(r&&t.debugVisible)this.applyEntity(t.bounds.boundsPrimitive);return r};t.prototype.render=function(t,r){e.prototype.render.call(this,t,r);if(!this._pStage.recoverFromDisposal()){this._pBackBufferInvalid=true;return}if(this._pBackBufferInvalid)this.pUpdateBackBuffer();if(this.shareContext&&this._pContext)this._pContext.clear(0,0,0,1,1,0,s.ContextGLClearMask.DEPTH);if(this._pFilter3DRenderer){this.textureRatioX=this._pRttBufferManager.textureRatioX;this.textureRatioY=this._pRttBufferManager.textureRatioY}else{this.textureRatioX=1;this.textureRatioY=1}if(this._pRequireDepthRender)this.pRenderSceneDepthToTexture(t,r);if(this._depthPrepass)this.pRenderDepthPrepass(t,r);this._directionalLights.length=0;this._pointLights.length=0;this._lightProbes.length=0;if(this._pFilter3DRenderer&&this._pContext){this._iRender(t,r,this._pFilter3DRenderer.getMainInputTexture(this._pStage),this._pRttBufferManager.renderToTextureRect);this._pFilter3DRenderer.render(this._pStage,t,this._pDepthRender)}else{if(this.shareContext)this._iRender(t,r,null,this._pScissorRect);else this._iRender(t,r)}if(!this.shareContext&&this._pContext)this._pContext.present();this._pStage.bufferClear=false};t.prototype.pExecuteRender=function(t,r,i,a){if(r===void 0){r=null}if(i===void 0){i=null}if(a===void 0){a=0}this.updateLights(t);e.prototype.pExecuteRender.call(this,t,r,i,a)};t.prototype.updateLights=function(e){var t,r;var i;var a;t=this._directionalLights.length;for(r=0;r<t;++r){i=this._directionalLights[r];a=i.shadowMapper;if(i.shadowsEnabled&&(a.autoUpdateShadows||a._iShadowsInvalid))a.iRenderDepthMap(e,i.scene,this._pDepthRenderer)}t=this._pointLights.length;for(r=0;r<t;++r){i=this._pointLights[r];a=i.shadowMapper;if(i.shadowsEnabled&&(a.autoUpdateShadows||a._iShadowsInvalid))a.iRenderDepthMap(e,i.scene,this._pDistanceRenderer)}};t.prototype.applyDirectionalLight=function(e){this._directionalLights.push(e)};t.prototype.applyLightProbe=function(e){this._lightProbes.push(e)};t.prototype.applyPointLight=function(e){this._pointLights.push(e)};t.prototype.dispose=function(){if(!this.shareContext)this._pStage.dispose();this._pRttBufferManager.dispose();this._pRttBufferManager=null;this._pDepthRenderer.dispose();this._pDistanceRenderer.dispose();this._pDepthRenderer=null;this._pDistanceRenderer=null;this._pDepthRender=null;e.prototype.dispose.call(this)};t.prototype.pRenderDepthPrepass=function(e,t){this._pDepthRenderer.disableColor=true;if(this._pFilter3DRenderer){this._pDepthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX;this._pDepthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY;this._pDepthRenderer._iRender(e,t,this._pFilter3DRenderer.getMainInputTexture(this._pStage),this._pRttBufferManager.renderToTextureRect)}else{this._pDepthRenderer.textureRatioX=1;this._pDepthRenderer.textureRatioY=1;this._pDepthRenderer._iRender(e,t)}this._pDepthRenderer.disableColor=false};t.prototype.pRenderSceneDepthToTexture=function(e,t){if(this._pDepthTextureInvalid||!this._pDepthRender)this.initDepthTexture(this._pStage.context);this._pDepthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX;this._pDepthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY;this._pDepthRenderer._iRender(e,t,this._pDepthRender)};t.prototype.pUpdateBackBuffer=function(){if(this._pStage.context&&!this.shareContext){if(this._width&&this._height){this._pStage.configureBackBuffer(this._width,this._height,this._antiAlias,true);this._pBackBufferInvalid=false}}};t.prototype.initDepthTexture=function(e){this._pDepthTextureInvalid=false;if(this._pDepthRender)this._pDepthRender.dispose();this._pDepthRender=new a.BitmapImage2D(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight)};return t}(n.RendererBase);r.DefaultRenderer=u},{"./DepthRenderer":"awayjs-renderergl/lib/DepthRenderer","./DistanceRenderer":"awayjs-renderergl/lib/DistanceRenderer","./Filter3DRenderer":"awayjs-renderergl/lib/Filter3DRenderer","./RendererBase":"awayjs-renderergl/lib/RendererBase","./managers/RTTBufferManager":"awayjs-renderergl/lib/managers/RTTBufferManager","awayjs-core/lib/image/BitmapImage2D":undefined,"awayjs-stagegl/lib/base/ContextGLClearMask":undefined}],"awayjs-renderergl/lib/DepthRenderer":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("./RendererBase");var s=e("./surfaces/GL_DepthSurface");var n=function(e){i(t,e);function t(t){if(t===void 0){t=null}e.call(this,t,s.GL_DepthSurface);this._iBackgroundR=1;this._iBackgroundG=1;this._iBackgroundB=1}t.prototype.enterNode=function(t){var r=t._iCollectionMark!=a.RendererBase._iCollectionMark&&t.isCastingShadow();if(!r){t._iCollectionMark=a.RendererBase._iCollectionMark;return false}return e.prototype.enterNode.call(this,t)};return t}(a.RendererBase);r.DepthRenderer=n},{"./RendererBase":"awayjs-renderergl/lib/RendererBase","./surfaces/GL_DepthSurface":"awayjs-renderergl/lib/surfaces/GL_DepthSurface"}],"awayjs-renderergl/lib/DistanceRenderer":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("./RendererBase");var s=e("./surfaces/GL_DistanceSurface");var n=function(e){i(t,e);function t(t){if(t===void 0){t=null}e.call(this,t,s.GL_DistanceSurface);this._iBackgroundR=1;this._iBackgroundG=1;this._iBackgroundB=1}t.prototype.enterNode=function(t){var r=t._iCollectionMark!=a.RendererBase._iCollectionMark&&t.isCastingShadow();if(!r){t._iCollectionMark=a.RendererBase._iCollectionMark;return false}return e.prototype.enterNode.call(this,t)};return t}(a.RendererBase);r.DistanceRenderer=n},{"./RendererBase":"awayjs-renderergl/lib/RendererBase","./surfaces/GL_DistanceSurface":"awayjs-renderergl/lib/surfaces/GL_DistanceSurface"}],"awayjs-renderergl/lib/Filter3DRenderer":[function(e,t,r){"use strict";var i=e("awayjs-stagegl/lib/base/ContextGLDrawMode");var a=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("./events/RTTEvent");var o=e("./managers/RTTBufferManager");var l=function(){function e(e){var t=this;this._filterSizesInvalid=true;this._onRTTResizeDelegate=function(e){return t.onRTTResize(e)};this._stage=e;this._rttManager=o.RTTBufferManager.getInstance(e);this._rttManager.addEventListener(n.RTTEvent.RESIZE,this._onRTTResizeDelegate)}e.prototype.onRTTResize=function(e){this._filterSizesInvalid=true};Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(e){if(this._filterTasksInvalid)this.updateFilterTasks(e);return this._mainInputTexture};Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(e){this._filters=e;this._filterTasksInvalid=true;this._requireDepthRender=false;if(!this._filters)return;for(var t=0;t<this._filters.length;++t)if(this._filters[t].requireDepthRender)this._requireDepthRender=true;this._filterSizesInvalid=true},enumerable:true,configurable:true});e.prototype.updateFilterTasks=function(e){var t;if(this._filterSizesInvalid)this.updateFilterSizes();if(!this._filters){this._tasks=null;return}this._tasks=new Array;t=this._filters.length-1;var r;for(var i=0;i<=t;++i){r=this._filters[i];r.setRenderTargets(i==t?null:this._filters[i+1].getMainInputTexture(e),e);this._tasks=this._tasks.concat(r.tasks)}this._mainInputTexture=this._filters[0].getMainInputTexture(e)};e.prototype.render=function(e,t,r){var n;var o;var l;var h=e.context;var c=this._rttManager.indexBuffer;var u=this._rttManager.renderToTextureVertexBuffer;if(!this._filters)return;if(this._filterSizesInvalid)this.updateFilterSizes();if(this._filterTasksInvalid)this.updateFilterTasks(e);n=this._filters.length;for(o=0;o<n;++o)this._filters[o].update(e,t);n=this._tasks.length;if(n>1){h.setProgram(this._tasks[0].getProgram(e));h.setVertexBufferAt(this._tasks[0]._positionIndex,u,0,s.ContextGLVertexBufferFormat.FLOAT_2);h.setVertexBufferAt(this._tasks[0]._uvIndex,u,8,s.ContextGLVertexBufferFormat.FLOAT_2)}for(o=0;o<n;++o){l=this._tasks[o];e.setRenderTarget(l.target);h.setProgram(l.getProgram(e));e.getAbstraction(l.getMainInputTexture(e)).activate(l._inputTextureIndex,false);if(!l.target){e.scissorRect=null;u=this._rttManager.renderToScreenVertexBuffer;h.setVertexBufferAt(l._positionIndex,u,0,s.ContextGLVertexBufferFormat.FLOAT_2);h.setVertexBufferAt(l._uvIndex,u,8,s.ContextGLVertexBufferFormat.FLOAT_2)}h.clear(0,0,0,0);l.activate(e,t,r);h.setBlendFactors(a.ContextGLBlendFactor.ONE,a.ContextGLBlendFactor.ZERO);h.drawIndices(i.ContextGLDrawMode.TRIANGLES,c,0,6);l.deactivate(e)}h.setTextureAt(0,null);h.setVertexBufferAt(0,null);h.setVertexBufferAt(1,null)};e.prototype.updateFilterSizes=function(){for(var e=0;e<this._filters.length;++e){this._filters[e].textureWidth=this._rttManager.textureWidth;this._filters[e].textureHeight=this._rttManager.textureHeight;this._filters[e].rttManager=this._rttManager}this._filterSizesInvalid=true};e.prototype.dispose=function(){this._rttManager.removeEventListener(n.RTTEvent.RESIZE,this._onRTTResizeDelegate);this._rttManager=null;this._stage=null};return e}();r.Filter3DRenderer=l},{"./events/RTTEvent":"awayjs-renderergl/lib/events/RTTEvent","./managers/RTTBufferManager":"awayjs-renderergl/lib/managers/RTTBufferManager","awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLDrawMode":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/RendererBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3D");var s=e("awayjs-core/lib/geom/Matrix3DUtils");var n=e("awayjs-core/lib/geom/Point");var o=e("awayjs-core/lib/geom/Rectangle");var l=e("awayjs-core/lib/geom/Vector3D");var h=e("awayjs-core/lib/events/EventDispatcher");var c=e("awayjs-display/lib/events/RendererEvent");var u=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");var d=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var p=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var f=e("awayjs-stagegl/lib/events/StageEvent");var _=e("awayjs-stagegl/lib/managers/StageManager");var m=e("./surfaces/SurfacePool");var g=e("./sort/RenderableMergeSort");var y=function(e){i(t,e);function t(t,r,i,s,h){var c=this;if(t===void 0){t=null}if(r===void 0){r=null}if(i===void 0){i=false}if(s===void 0){s="baseline"}if(h===void 0){h="auto"}e.call(this);this._objectPools=new Object;this._abstractionPool=new Object;this._activeMasksConfig=new Array;this._registeredMasks=new Array;this._numUsedStreams=0;this._numUsedTextures=0;this._cameraForward=new l.Vector3D;this._viewPort=new o.Rectangle;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this._depthPrepass=false;this._backgroundR=0;this._backgroundG=0;this._backgroundB=0;this._backgroundAlpha=1;this.textureRatioX=1;this.textureRatioY=1;this._pRttViewProjectionMatrix=new a.Matrix3D;this._localPos=new n.Point;this._globalPos=new n.Point;this._pScissorRect=new o.Rectangle;this._pNumElements=0;this._disableColor=false;this._renderBlended=true;this._numCullPlanes=0;this._onViewportUpdatedDelegate=function(e){return c.onViewportUpdated(e)};this._onContextUpdateDelegate=function(e){return c.onContextUpdate(e)};this.renderableSorter=new g.RenderableMergeSort;this._pStage=t||_.StageManager.getInstance().getFreeStage(i,s,h);this._pStage.addEventListener(f.StageEvent.CONTEXT_CREATED,this._onContextUpdateDelegate);this._pStage.addEventListener(f.StageEvent.CONTEXT_RECREATED,this._onContextUpdateDelegate);this._pStage.addEventListener(f.StageEvent.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate);this._surfaceClassGL=r;if(this._pStage.context)this._pContext=this._pStage.context}Object.defineProperty(t.prototype,"cullPlanes",{get:function(){return this._customCullPlanes},set:function(e){this._customCullPlanes=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderBlended",{get:function(){return this._renderBlended},set:function(e){this._renderBlended=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"disableColor",{get:function(){return this._disableColor},set:function(e){this._disableColor=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numElements",{get:function(){return this._pNumElements},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scissorRect",{get:function(){return this._pScissorRect},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._localPos.x},set:function(e){if(this.x==e)return;this._globalPos.x=this._localPos.x=e;this.updateGlobalPos()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._localPos.y},set:function(e){if(this.y==e)return;this._globalPos.y=this._localPos.y=e;this.updateGlobalPos()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){if(this._width==e)return;this._width=e;this._pScissorRect.width=e;if(this._pRttBufferManager)this._pRttBufferManager.viewWidth=e;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this.notifyScissorUpdate()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){if(this._height==e)return;this._height=e;this._pScissorRect.height=e;if(this._pRttBufferManager)this._pRttBufferManager.viewHeight=e;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this.notifyScissorUpdate()},enumerable:true,configurable:true});t.prototype.getAbstraction=function(e){return this._abstractionPool[e.id]||(this._abstractionPool[e.id]=new t._abstractionClassPool[e.assetType](e,this))};t.prototype.clearAbstraction=function(e){this._abstractionPool[e.id]=null};t.prototype.getSurfacePool=function(e){return this._objectPools[e.elementsType]||(this._objectPools[e.elementsType]=new m.SurfacePool(e.elementsClass,this._pStage,this._surfaceClassGL))};t.registerAbstraction=function(e,r){t._abstractionClassPool[r.assetType]=e};t.prototype.activatePass=function(e,t){var r;for(r=e.shader.numUsedStreams;r<this._numUsedStreams;r++)this._pContext.setVertexBufferAt(r,null);for(r=e.shader.numUsedTextures;r<this._numUsedTextures;r++)this._pContext.setTextureAt(r,null);var i=e.shader.programData;if(!i.program){i.program=this._pContext.createProgram();var a=(new u.AGALMiniAssembler).assemble("part vertex 1\n"+i.vertexString+"endpart")["vertex"].data;var s=(new u.AGALMiniAssembler).assemble("part fragment 1\n"+i.fragmentString+"endpart")["fragment"].data;i.program.upload(a,s)}this._pContext.setProgram(i.program);e._iActivate(t)};t.prototype.deactivatePass=function(e){e._iDeactivate();this._numUsedStreams=e.shader.numUsedStreams;this._numUsedTextures=e.shader.numUsedTextures};Object.defineProperty(t.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(e){if(this._backgroundR==e)return;this._backgroundR=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(e){if(this._backgroundG==e)return;this._backgroundG=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(e){if(this._backgroundB==e)return;this._backgroundB=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"context",{get:function(){return this._pContext},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stage",{get:function(){return this._pStage},enumerable:true,configurable:true});t.prototype.dispose=function(){for(var e in this._abstractionPool)this._abstractionPool[e].clear();this._abstractionPool=null;this._pStage.removeEventListener(f.StageEvent.CONTEXT_CREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(f.StageEvent.CONTEXT_RECREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(f.StageEvent.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate);this._pStage=null;this._pContext=null};t.prototype.render=function(e,t){this._viewportDirty=false;this._scissorDirty=false};t.prototype._iRender=function(e,r,i,a,n){if(i===void 0){i=null}if(a===void 0){a=null}if(n===void 0){n=0}if(!this._pStage||!this._pContext)return;this._pBlendedRenderableHead=null;this._pOpaqueRenderableHead=null;this._pNumElements=0;this._cullPlanes=this._customCullPlanes?this._customCullPlanes:e.frustumPlanes;this._numCullPlanes=this._cullPlanes?this._cullPlanes.length:0;this._cameraPosition=e.scenePosition;this._cameraTransform=e.sceneTransform;this._cameraForward=s.Matrix3DUtils.getForward(e.sceneTransform,this._cameraForward);t._iCollectionMark++;r.traversePartitions(this);if(this.renderableSorter){this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead);this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)}this._pRttViewProjectionMatrix.copyFrom(e.viewProjection);this._pRttViewProjectionMatrix.appendScale(this.textureRatioX,this.textureRatioY,1);this.pExecuteRender(e,i,a,n);for(var o=0;o<8;++o){this._pContext.setVertexBufferAt(o,null);this._pContext.setTextureAt(o,null)}};t.prototype._iRenderCascades=function(e,t,r,i,a,s){this._pStage.setRenderTarget(r,true,0);this._pContext.clear(1,1,1,1,1,0);this._pContext.setBlendFactors(d.ContextGLBlendFactor.ONE,d.ContextGLBlendFactor.ZERO);this._pContext.setDepthTest(true,p.ContextGLCompareMode.LESS);var n=this._pOpaqueRenderableHead;var o=true;for(var l=i-1;l>=0;--l){this._pStage.scissorRect=a[l];o=false}this._pContext.setDepthTest(false,p.ContextGLCompareMode.LESS_EQUAL);this._pStage.scissorRect=null};t.prototype.pExecuteRender=function(e,t,r,i){if(t===void 0){t=null}if(r===void 0){r=null}if(i===void 0){i=0}this._pStage.setRenderTarget(t,true,i);if((t||!this.shareContext)&&!this._depthPrepass)this._pContext.clear(this._backgroundR,this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0);this._pStage.scissorRect=r;this._pContext.setBlendFactors(d.ContextGLBlendFactor.ONE,d.ContextGLBlendFactor.ZERO);this.pDraw(e);if(!this.shareContext){if(this._snapshotRequired&&this._snapshotBitmapImage2D){this._pContext.drawToBitmapImage2D(this._snapshotBitmapImage2D);this._snapshotRequired=false}}this._pStage.scissorRect=null};t.prototype.queueSnapshot=function(e){this._snapshotRequired=true;this._snapshotBitmapImage2D=e};t.prototype.pDraw=function(e){this._pContext.setDepthTest(true,p.ContextGLCompareMode.LESS);if(this._disableColor)this._pContext.setColorMask(false,false,false,false);this.drawRenderables(e,this._pOpaqueRenderableHead);if(this._renderBlended)this.drawRenderables(e,this._pBlendedRenderableHead);if(this._disableColor)this._pContext.setColorMask(true,true,true,true)};t.prototype.drawRenderables=function(e,t){var r;var i;var a;var s;var n;var o;this._pContext.setStencilActions("frontAndBack","always","keep","keep","keep");this._registeredMasks.length=0;var l=this._pContext["_gl"];if(l){l.disable(l.STENCIL_TEST)}this._maskConfig=0;while(t){s=t.surfaceGL;n=s.passes;if(this._disableColor&&s._surface.alphaThreshold!=0){a=t;do{a=a.next}while(a&&a.surfaceGL==s)}else{if(this._activeMasksDirty||this._checkMasksConfig(t.masksConfig)){this._activeMasksConfig=t.masksConfig;if(!this._activeMasksConfig.length){if(l){l.disable(l.STENCIL_TEST);l.stencilFunc(l.ALWAYS,0,255);l.stencilOp(l.KEEP,l.KEEP,l.KEEP)}}else{this._renderMasks(e,t.sourceEntity._iAssignedMasks())}this._activeMasksDirty=false}i=n.length;for(r=0;r<i;r++){a=t;o=n[r];this.activatePass(o,e);do{if(a.maskId!==-1){if(r==0)this._registerMask(a)}else{a._iRender(o,e,this._pRttViewProjectionMatrix)}a=a.next}while(a&&a.surfaceGL==s&&!(this._activeMasksDirty=this._checkMasksConfig(a.masksConfig)));this.deactivatePass(o)}}t=a}};t.prototype.onContextUpdate=function(e){this._pContext=this._pStage.context};Object.defineProperty(t.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(e){if(this._backgroundAlpha==e)return;this._backgroundAlpha=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});t.prototype.notifyScissorUpdate=function(){if(this._scissorDirty)return;this._scissorDirty=true;if(!this._scissorUpdated)this._scissorUpdated=new c.RendererEvent(c.RendererEvent.SCISSOR_UPDATED);this.dispatchEvent(this._scissorUpdated)};t.prototype.notifyViewportUpdate=function(){if(this._viewportDirty)return;this._viewportDirty=true;if(!this._viewPortUpdated)this._viewPortUpdated=new c.RendererEvent(c.RendererEvent.VIEWPORT_UPDATED);this.dispatchEvent(this._viewPortUpdated)};t.prototype.onViewportUpdated=function(e){this._viewPort=this._pStage.viewPort;if(this.shareContext){this._pScissorRect.x=this._globalPos.x-this._pStage.x;this._pScissorRect.y=this._globalPos.y-this._pStage.y;this.notifyScissorUpdate()}this.notifyViewportUpdate()};t.prototype.updateGlobalPos=function(){if(this.shareContext){this._pScissorRect.x=this._globalPos.x-this._viewPort.x;this._pScissorRect.y=this._globalPos.y-this._viewPort.y}else{this._pScissorRect.x=0;this._pScissorRect.y=0;this._viewPort.x=this._globalPos.x;this._viewPort.y=this._globalPos.y}this.notifyScissorUpdate()};t.prototype.enterNode=function(e){var r=e._iCollectionMark!=t._iCollectionMark&&e.isRenderable()&&e.isInFrustum(this._cullPlanes,this._numCullPlanes);e._iCollectionMark=t._iCollectionMark;return r};t.prototype.applyEntity=function(e){this._sourceEntity=e;this._zIndex=e.zOffset+this._cameraPosition.subtract(e.scenePosition).dotProduct(this._cameraForward);this._renderSceneTransform=e.getRenderSceneTransform(this._cameraTransform);e._acceptTraverser(this)};t.prototype.applyRenderable=function(e){var t=this.getAbstraction(e);var r=t.surfaceGL;t.surfaceID=r.surfaceID;t.renderOrderId=r.renderOrderId;t.cascaded=false;t.sourceEntity=this._sourceEntity;t.zIndex=this._zIndex;t.maskId=this._sourceEntity._iAssignedMaskId();t.masksConfig=this._sourceEntity._iMasksConfig();t.renderSceneTransform=this._renderSceneTransform;if(r.requiresBlending){t.next=this._pBlendedRenderableHead;this._pBlendedRenderableHead=t}else{t.next=this._pOpaqueRenderableHead;this._pOpaqueRenderableHead=t}this._pNumElements+=t.elementsGL.elements.numElements};t.prototype.applyDirectionalLight=function(e){};t.prototype.applyLightProbe=function(e){};t.prototype.applyPointLight=function(e){};t.prototype.applySkybox=function(e){};t.prototype._registerMask=function(e){this._registeredMasks.push(e)};t.prototype._renderMasks=function(e,t){var r=this._pContext["_gl"];this._pContext.setColorMask(false,false,false,false);r.enable(r.STENCIL_TEST);this._maskConfig++;r.stencilFunc(r.ALWAYS,this._maskConfig,255);r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE);var i=t.length;var a=this._registeredMasks.length;var s;var n;var o;var l;for(var h=0;h<i;++h){if(h!=0){r.stencilFunc(r.EQUAL,this._maskConfig,255);r.stencilOp(r.KEEP,r.INCR,r.INCR);this._maskConfig++}n=t[h];o=n.length;for(var c=0;c<o;++c){l=n[c];for(var u=0;u<a;++u){s=this._registeredMasks[u];if(s.maskId==l.id){this._drawMask(e,s)}}}}r.stencilFunc(r.EQUAL,this._maskConfig,255);r.stencilOp(r.KEEP,r.KEEP,r.KEEP);this._pContext.setColorMask(true,true,true,true);this._pContext.setDepthTest(true,p.ContextGLCompareMode.LESS)};t.prototype._drawMask=function(e,t){var r=t.surfaceGL;var i=r.passes;var a=i.length;var s=i[a-1];this.activatePass(s,e);this._pContext.setDepthTest(false,p.ContextGLCompareMode.LESS);t._iRender(s,e,this._pRttViewProjectionMatrix);this.deactivatePass(s)};t.prototype._checkMasksConfig=function(e){if(this._activeMasksConfig.length!=e.length)return true;var t=e.length;var r;var i;var a;var s;for(var n=0;n<t;n++){i=e[n];r=i.length;s=this._activeMasksConfig[n];a=s.length;if(a!=r)return true;for(var o=0;o<r;o++){if(s[o]!=i[o])return true}}return false};t._iCollectionMark=0;t._abstractionClassPool=new Object;return t}(h.EventDispatcher);r.RendererBase=y},{"./sort/RenderableMergeSort":"awayjs-renderergl/lib/sort/RenderableMergeSort","./surfaces/SurfacePool":"awayjs-renderergl/lib/surfaces/SurfacePool","awayjs-core/lib/events/EventDispatcher":undefined,"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Matrix3DUtils":undefined,"awayjs-core/lib/geom/Point":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-display/lib/events/RendererEvent":undefined,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":undefined,"awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined,"awayjs-stagegl/lib/events/StageEvent":undefined,"awayjs-stagegl/lib/managers/StageManager":undefined}],"awayjs-renderergl/lib/animators/AnimationSetBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/library/AssetBase");
var s=e("awayjs-core/lib/errors/AbstractMethodError");var n=e("../errors/AnimationSetError");var o=function(e){i(t,e);function t(){e.call(this);this._animations=new Array;this._animationNames=new Array;this._animationDictionary=new Object}t.prototype._pFindTempReg=function(e,t){if(t===void 0){t=null}var r=0;var i;while(true){i="vt"+r;if(e.indexOf(i)==-1&&t!=i)return i;++r}};Object.defineProperty(t.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:true,configurable:true});t.prototype.resetGPUCompatibility=function(){this._usesCPU=false};t.prototype.cancelGPUCompatibility=function(){this._usesCPU=true};t.prototype.getAGALVertexCode=function(e,t,r){throw new s.AbstractMethodError};t.prototype.getAGALFragmentCode=function(e,t,r){throw new s.AbstractMethodError};t.prototype.getAGALUVCode=function(e,t,r){throw new s.AbstractMethodError};t.prototype.doneAGALCode=function(e){throw new s.AbstractMethodError};Object.defineProperty(t.prototype,"assetType",{get:function(){return t.assetType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:true,configurable:true});t.prototype.hasAnimation=function(e){return this._animationDictionary[e]!=null};t.prototype.getAnimation=function(e){return this._animationDictionary[e]};t.prototype.addAnimation=function(e){if(this._animationDictionary[e.name])throw new n.AnimationSetError("root node name '"+e.name+"' already exists in the set");this._animationDictionary[e.name]=e;this._animations.push(e);this._animationNames.push(e.name)};t.prototype.dispose=function(){};t.assetType="[asset AnimationSet]";return t}(a.AssetBase);r.AnimationSetBase=o},{"../errors/AnimationSetError":"awayjs-renderergl/lib/errors/AnimationSetError","awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AssetBase":undefined}],"awayjs-renderergl/lib/animators/AnimatorBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/library/AssetBase");var s=e("awayjs-core/lib/errors/AbstractMethodError");var n=e("awayjs-core/lib/utils/RequestAnimationFrame");var o=e("awayjs-core/lib/utils/getTimer");var l=e("../events/AnimatorEvent");var h=function(e){i(t,e);function t(t){e.call(this);this._autoUpdate=true;this._time=0;this._playbackSpeed=1;this._pOwners=new Array;this._pAbsoluteTime=0;this._animationStates=new Object;this.updatePosition=true;this._pAnimationSet=t;this._broadcaster=new n.RequestAnimationFrame(this.onEnterFrame,this)}t.prototype.getAnimationState=function(e){var t=e.stateClass;var r=e.id;if(this._animationStates[r]==null)this._animationStates[r]=new t(this,e);return this._animationStates[r]};t.prototype.getAnimationStateByName=function(e){return this.getAnimationState(this._pAnimationSet.getAnimation(e))};Object.defineProperty(t.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){if(this._autoUpdate==e)return;this._autoUpdate=e;if(this._autoUpdate)this.start();else this.stop()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(e){if(this._time==e)return;this.update(e)},enumerable:true,configurable:true});t.prototype.phase=function(e){this._pActiveState.phase(e)};Object.defineProperty(t.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(e){this._playbackSpeed=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,t,r,i){throw new s.AbstractMethodError};t.prototype.start=function(){if(this._isPlaying||!this._autoUpdate)return;this._time=this._pAbsoluteTime=o.getTimer();this._isPlaying=true;this._broadcaster.start();if(!this.hasEventListener(l.AnimatorEvent.START))return;if(this._startEvent==null)this._startEvent=new l.AnimatorEvent(l.AnimatorEvent.START,this);this.dispatchEvent(this._startEvent)};t.prototype.stop=function(){if(!this._isPlaying)return;this._isPlaying=false;this._broadcaster.stop();if(!this.hasEventListener(l.AnimatorEvent.STOP))return;if(this._stopEvent==null)this._stopEvent=new l.AnimatorEvent(l.AnimatorEvent.STOP,this);this.dispatchEvent(this._stopEvent)};t.prototype.update=function(e){var t=(e-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(t);this._time=e};t.prototype.reset=function(e,t){if(t===void 0){t=0}this.getAnimationState(this._pAnimationSet.getAnimation(e)).offset(t+this._pAbsoluteTime)};t.prototype.addOwner=function(e){this._pOwners.push(e)};t.prototype.removeOwner=function(e){this._pOwners.splice(this._pOwners.indexOf(e),1)};t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e;this._pActiveState.update(this._pAbsoluteTime);if(this.updatePosition)this.applyPositionDelta()};t.prototype.onEnterFrame=function(e){if(e===void 0){e=null}this.update(o.getTimer())};t.prototype.applyPositionDelta=function(){var e=this._pActiveState.positionDelta;var t=e.length;var r;if(t>0){r=this._pOwners.length;for(var i=0;i<r;++i)this._pOwners[i].transform.translateLocal(e,t)}};t.prototype.dispatchCycleEvent=function(){if(this.hasEventListener(l.AnimatorEvent.CYCLE_COMPLETE)){if(this._cycleEvent==null)this._cycleEvent=new l.AnimatorEvent(l.AnimatorEvent.CYCLE_COMPLETE,this);this.dispatchEvent(this._cycleEvent)}};t.prototype.clone=function(){throw new s.AbstractMethodError};t.prototype.dispose=function(){};t.prototype.invalidateElements=function(){var e;var t=this._pOwners.length;for(var r=0;r<t;r++){e=this._pOwners[r];e.graphics.invalidateElements()}};t.prototype.testGPUCompatibility=function(e){throw new s.AbstractMethodError};Object.defineProperty(t.prototype,"assetType",{get:function(){return t.assetType},enumerable:true,configurable:true});t.prototype.getRenderableElements=function(e,t){return t};t.assetType="[asset Animator]";return t}(a.AssetBase);r.AnimatorBase=h},{"../events/AnimatorEvent":"awayjs-renderergl/lib/events/AnimatorEvent","awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AssetBase":undefined,"awayjs-core/lib/utils/RequestAnimationFrame":undefined,"awayjs-core/lib/utils/getTimer":undefined}],"awayjs-renderergl/lib/animators/ParticleAnimationSet":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../animators/AnimationSetBase");var s=e("../animators/data/AnimationRegisterData");var n=e("../animators/data/AnimationElements");var o=e("../animators/data/ParticleAnimationData");var l=e("../animators/data/ParticleProperties");var h=e("../animators/data/ParticlePropertiesMode");var c=e("../animators/nodes/ParticleTimeNode");var u=function(e){i(t,e);function t(t,r,i){if(t===void 0){t=false}if(r===void 0){r=false}if(i===void 0){i=false}e.call(this);this._animationElements=new Object;this._particleNodes=new Array;this._localDynamicNodes=new Array;this._localStaticNodes=new Array;this._totalLenOfOneVertex=0;this.shareAnimationGraphics=true;this.addAnimation(this._timeNode=new c.ParticleTimeNode(t,r,i))}Object.defineProperty(t.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:true,configurable:true});t.prototype.addAnimation=function(t){var r;var i=t;i._iProcessAnimationSetting(this);if(i.mode==h.ParticlePropertiesMode.LOCAL_STATIC){i._iDataOffset=this._totalLenOfOneVertex;this._totalLenOfOneVertex+=i.dataLength;this._localStaticNodes.push(i)}else if(i.mode==h.ParticlePropertiesMode.LOCAL_DYNAMIC)this._localDynamicNodes.push(i);for(r=this._particleNodes.length-1;r>=0;r--){if(this._particleNodes[r].priority<=i.priority)break}this._particleNodes.splice(r+1,0,i);e.prototype.addAnimation.call(this,t)};t.prototype.getAGALVertexCode=function(e,r,i){this._iAnimationRegisterData=e.animationRegisterData;if(this._iAnimationRegisterData==null)this._iAnimationRegisterData=e.animationRegisterData=new s.AnimationRegisterData;this._iAnimationRegisterData.reset(r,i,this.needVelocity);var a="";var n=i.animatableAttributes.length;for(var o=0;o<n;o++)a+="mov "+i.animationTargetRegisters[o]+","+i.animatableAttributes[o]+"\n";a+="mov "+this._iAnimationRegisterData.positionTarget+".xyz,"+this._iAnimationRegisterData.vertexZeroConst+"\n";if(this.needVelocity)a+="mov "+this._iAnimationRegisterData.velocityTarget+".xyz,"+this._iAnimationRegisterData.vertexZeroConst+"\n";var l;var o;for(o=0;o<this._particleNodes.length;o++){l=this._particleNodes[o];if(l.priority<t.POST_PRIORITY)a+=l.getAGALVertexCode(e,this,r,this._iAnimationRegisterData)}a+="add "+this._iAnimationRegisterData.scaleAndRotateTarget+".xyz,"+this._iAnimationRegisterData.scaleAndRotateTarget+".xyz,"+this._iAnimationRegisterData.positionTarget+".xyz\n";for(o=0;o<this._particleNodes.length;o++){l=this._particleNodes[o];if(l.priority>=t.POST_PRIORITY&&l.priority<t.COLOR_PRIORITY)a+=l.getAGALVertexCode(e,this,r,this._iAnimationRegisterData)}if(this.hasColorMulNode){this._iAnimationRegisterData.colorMulTarget=r.getFreeVertexVectorTemp();r.addVertexTempUsages(this._iAnimationRegisterData.colorMulTarget,1);this._iAnimationRegisterData.colorMulVary=r.getFreeVarying();a+="mov "+this._iAnimationRegisterData.colorMulTarget+","+this._iAnimationRegisterData.vertexOneConst+"\n"}if(this.hasColorAddNode){this._iAnimationRegisterData.colorAddTarget=r.getFreeVertexVectorTemp();r.addVertexTempUsages(this._iAnimationRegisterData.colorAddTarget,1);this._iAnimationRegisterData.colorAddVary=r.getFreeVarying();a+="mov "+this._iAnimationRegisterData.colorAddTarget+","+this._iAnimationRegisterData.vertexZeroConst+"\n"}for(o=0;o<this._particleNodes.length;o++){l=this._particleNodes[o];if(l.priority>=t.COLOR_PRIORITY)a+=l.getAGALVertexCode(e,this,r,this._iAnimationRegisterData)}if(e.usesFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){if(this.hasColorMulNode)a+="mov "+this._iAnimationRegisterData.colorMulVary+","+this._iAnimationRegisterData.colorMulTarget+"\n";if(this.hasColorAddNode)a+="mov "+this._iAnimationRegisterData.colorAddVary+","+this._iAnimationRegisterData.colorAddTarget+"\n"}return a};t.prototype.getAGALUVCode=function(e,t,r){var i="";if(this.hasUVNode){this._iAnimationRegisterData.setUVSourceAndTarget(r);i+="mov "+this._iAnimationRegisterData.uvTarget+".xy,"+this._iAnimationRegisterData.uvAttribute.toString()+"\n";var a;for(var s=0;s<this._particleNodes.length;s++)a=this._particleNodes[s];i+=a.getAGALUVCode(e,this,t,this._iAnimationRegisterData);i+="mov "+this._iAnimationRegisterData.uvVar+","+this._iAnimationRegisterData.uvTarget+".xy\n"}else i+="mov "+r.uvTarget+","+r.uvSource+"\n";return i};t.prototype.getAGALFragmentCode=function(e,t,r){var i="";if(e.usesFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){if(this.hasColorMulNode)i+="mul "+r+","+r+","+this._iAnimationRegisterData.colorMulVary+"\n";if(this.hasColorAddNode)i+="add "+r+","+r+","+this._iAnimationRegisterData.colorAddVary+"\n"}return i};t.prototype.doneAGALCode=function(e){e.setVertexConst(this._iAnimationRegisterData.vertexZeroConst.index,0,1,2,0)};Object.defineProperty(t.prototype,"usesCPU",{get:function(){return false},enumerable:true,configurable:true});t.prototype.cancelGPUCompatibility=function(){};t.prototype.dispose=function(){for(var t in this._animationElements)this._animationElements[t].dispose();e.prototype.dispose.call(this)};t.prototype.getAnimationElements=function(e){var t=this.shareAnimationGraphics?this._animationElements[e.elements.id]:this._animationElements[e.id];if(t)return t;this._iGenerateAnimationElements(e.parent);return this.shareAnimationGraphics?this._animationElements[e.elements.id]:this._animationElements[e.id]};t.prototype._iGenerateAnimationElements=function(e){if(this.initParticleFunc==null)throw new Error("no initParticleFunc set");var t,r,i;var a;var s=false;var h;var c;var u;for(t=0;t<e.count;t++){c=e.getGraphicAt(t);h=c.elements;if(this.shareAnimationGraphics){a=this._animationElements[h.id];if(a)continue}a=new n.AnimationElements;if(this.shareAnimationGraphics)this._animationElements[h.id]=a;else this._animationElements[c.id]=a;s=true;a.createVertexData(h.numVertices,this._totalLenOfOneVertex)}if(!s)return;var d=e.particles;var p=d.length;var f=e.numParticles;var _=new l.ParticleProperties;var m;var g;var y;var v;var x;var b;var P;var S;var C;var w;var D;_.total=f;_.startTime=0;_.duration=1e3;_.delay=.1;t=0;r=0;while(t<f){_.index=t;this.initParticleFunc.call(this.initParticleScope,_);for(i=0;i<this._localStaticNodes.length;i++)this._localStaticNodes[i]._iGeneratePropertyOfOneParticle(_);while(r<p&&(m=d[r]).particleIndex==t){for(i=0;i<e.count;i++){c=e.getGraphicAt(i);if(c.elements==m.elements){a=this.shareAnimationGraphics?this._animationElements[c.elements.id]:this._animationElements[c.id];break}}P=m.numVertices;S=a.vertexData;C=P*this._totalLenOfOneVertex;w=a.numProcessedVertices*this._totalLenOfOneVertex;for(i=0;i<this._localStaticNodes.length;i++){u=this._localStaticNodes[i];b=u.oneData;g=u.dataLength;y=w+u._iDataOffset;for(v=0;v<C;v+=this._totalLenOfOneVertex){D=y+v;for(x=0;x<g;x++)S[D+x]=b[x]}}if(this._localDynamicNodes.length)a.animationParticles.push(new o.ParticleAnimationData(t,_.startTime,_.duration,_.delay,m));a.numProcessedVertices+=P;r++}t++}};t.POST_PRIORITY=9;t.COLOR_PRIORITY=18;return t}(a.AnimationSetBase);r.ParticleAnimationSet=u},{"../animators/AnimationSetBase":"awayjs-renderergl/lib/animators/AnimationSetBase","../animators/data/AnimationElements":"awayjs-renderergl/lib/animators/data/AnimationElements","../animators/data/AnimationRegisterData":"awayjs-renderergl/lib/animators/data/AnimationRegisterData","../animators/data/ParticleAnimationData":"awayjs-renderergl/lib/animators/data/ParticleAnimationData","../animators/data/ParticleProperties":"awayjs-renderergl/lib/animators/data/ParticleProperties","../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../animators/nodes/ParticleTimeNode":"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode"}],"awayjs-renderergl/lib/animators/ParticleAnimator":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../animators/AnimatorBase");var s=e("../animators/data/AnimationElements");var n=e("../animators/data/ParticlePropertiesMode");var o=function(e){i(t,e);function t(t){e.call(this,t);this._animationParticleStates=new Array;this._animatorParticleStates=new Array;this._timeParticleStates=new Array;this._totalLenOfOneVertex=0;this._animatorSubGeometries=new Object;this._particleAnimationSet=t;var r;var i;for(var a=0;a<this._particleAnimationSet.particleNodes.length;a++){i=this._particleAnimationSet.particleNodes[a];r=this.getAnimationState(i);if(i.mode==n.ParticlePropertiesMode.LOCAL_DYNAMIC){this._animatorParticleStates.push(r);i._iDataOffset=this._totalLenOfOneVertex;this._totalLenOfOneVertex+=i.dataLength}else{this._animationParticleStates.push(r)}if(r.needUpdateTime)this._timeParticleStates.push(r)}}t.prototype.clone=function(){return new t(this._particleAnimationSet)};t.prototype.setRenderState=function(e,t,r,i){var a=this._particleAnimationSet._iAnimationRegisterData;var s=t.graphic;if(!s)throw new Error("Must be graphic");var n=this._particleAnimationSet.getAnimationElements(s);var o;for(o=0;o<this._animationParticleStates.length;o++)this._animationParticleStates[o].setRenderState(e,t,n,a,i,r);var l=this.getAnimatorElements(s);for(o=0;o<this._animatorParticleStates.length;o++)this._animatorParticleStates[o].setRenderState(e,t,l,a,i,r)};t.prototype.testGPUCompatibility=function(e){};t.prototype.start=function(){e.prototype.start.call(this);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime)};t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e;for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].update(this._pAbsoluteTime)};t.prototype.resetTime=function(e){if(e===void 0){e=0}for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime+e);this.update(this.time)};t.prototype.dispose=function(){for(var e in this._animatorSubGeometries)this._animatorSubGeometries[e].dispose()};t.prototype.getAnimatorElements=function(e){if(!this._animatorParticleStates.length)return;var t=e.elements;var r=this._animatorSubGeometries[t.id]=new s.AnimationElements;r.createVertexData(t.numVertices,this._totalLenOfOneVertex);r.animationParticles=this._particleAnimationSet.getAnimationElements(e).animationParticles};return t}(a.AnimatorBase);r.ParticleAnimator=o},{"../animators/AnimatorBase":"awayjs-renderergl/lib/animators/AnimatorBase","../animators/data/AnimationElements":"awayjs-renderergl/lib/animators/data/AnimationElements","../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"}],"awayjs-renderergl/lib/animators/SkeletonAnimationSet":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../animators/AnimationSetBase");var s=function(e){i(t,e);function t(t){if(t===void 0){t=4}e.call(this);this._jointsPerVertex=t}Object.defineProperty(t.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"matricesIndex",{get:function(){return this._matricesIndex},enumerable:true,configurable:true});t.prototype.getAGALVertexCode=function(e,t,r){this._matricesIndex=t.numUsedVertexConstants;var i=this._matricesIndex;var a=this._matricesIndex+1;var s=this._matricesIndex+2;var n=t.getFreeVertexAttribute();e.jointIndexIndex=n.index;var o=t.getFreeVertexAttribute();e.jointWeightIndex=o.index;var l=[n+".x",n+".y",n+".z",n+".w"];var h=[o+".x",o+".y",o+".z",o+".w"];var c=t.getFreeVertexVectorTemp();var u="dp4";var d="";var p=r.animatableAttributes.length;for(var f=0;f<p;++f){var _=r.animatableAttributes[f];var m=r.animationTargetRegisters[f];for(var g=0;g<this._jointsPerVertex;++g){t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();d+=u+" "+c+".x, "+_+", vc["+l[g]+"+"+i+"]\n"+u+" "+c+".y, "+_+", vc["+l[g]+"+"+a+"]\n"+u+" "+c+".z, "+_+", vc["+l[g]+"+"+s+"]\n"+"mov "+c+".w, "+_+".w\n"+"mul "+c+", "+c+", "+h[g]+"\n";if(g==0)d+="mov "+m+", "+c+"\n";else d+="add "+m+", "+m+", "+c+"\n"}u="dp3"}return d};t.prototype.getAGALFragmentCode=function(e,t,r){return""};t.prototype.getAGALUVCode=function(e,t,r){return"mov "+r.uvTarget+","+r.uvSource+"\n"};t.prototype.doneAGALCode=function(e){};return t}(a.AnimationSetBase);r.SkeletonAnimationSet=s},{"../animators/AnimationSetBase":"awayjs-renderergl/lib/animators/AnimationSetBase"}],"awayjs-renderergl/lib/animators/SkeletonAnimator":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/events/ElementsEvent");var s=e("../animators/AnimatorBase");var n=e("../animators/data/JointPose");var o=e("../animators/data/SkeletonPose");var l=e("../events/AnimationStateEvent");var h=function(e){i(t,e);function t(t,r,i){var a=this;if(i===void 0){i=false}e.call(this,t);this._globalPose=new o.SkeletonPose;this._morphedElements=new Object;this._morphedElementsDirty=new Object;this._skeletonAnimationSet=t;this._skeleton=r;this._forceCPU=i;this._jointsPerVertex=t.jointsPerVertex;this._numJoints=this._skeleton.numJoints;this._globalMatrices=new Float32Array(this._numJoints*12);var s=0;for(var n=0;n<this._numJoints;++n){this._globalMatrices[s++]=1;this._globalMatrices[s++]=0;this._globalMatrices[s++]=0;this._globalMatrices[s++]=0;this._globalMatrices[s++]=0;this._globalMatrices[s++]=1;this._globalMatrices[s++]=0;this._globalMatrices[s++]=0;this._globalMatrices[s++]=0;this._globalMatrices[s++]=0;this._globalMatrices[s++]=1;this._globalMatrices[s++]=0}this._onTransitionCompleteDelegate=function(e){return a.onTransitionComplete(e)};this._onIndicesUpdateDelegate=function(e){return a.onIndicesUpdate(e)};this._onVerticesUpdateDelegate=function(e){return a.onVerticesUpdate(e)}}Object.defineProperty(t.prototype,"globalMatrices",{get:function(){if(this._globalPropertiesDirty)this.updateGlobalProperties();return this._globalMatrices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"globalPose",{get:function(){if(this._globalPropertiesDirty)this.updateGlobalProperties();return this._globalPose},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(e){this._useCondensedIndices=e},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this._skeletonAnimationSet,this._skeleton,this._forceCPU)};t.prototype.play=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=NaN}if(this._pActiveAnimationName==e)return;this._pActiveAnimationName=e;if(!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");if(t&&this._pActiveNode){this._pActiveNode=t.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(e),this._pAbsoluteTime);this._pActiveNode.addEventListener(l.AnimationStateEvent.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)}else this._pActiveNode=this._pAnimationSet.getAnimation(e);this._pActiveState=this.getAnimationState(this._pActiveNode);if(this.updatePosition){this._pActiveState.update(this._pAbsoluteTime);this._pActiveState.positionDelta}this._activeSkeletonState=this._pActiveState;this.start();if(!isNaN(r))this.reset(e,r)};t.prototype.setRenderState=function(e,t,r,i){if(this._globalPropertiesDirty)this.updateGlobalProperties();var a=t.graphic.elements;a.useCondensedIndices=this._useCondensedIndices;if(this._useCondensedIndices){this.updateCondensedMatrices(a.condensedIndexLookUp);e.setVertexConstFromArray(this._skeletonAnimationSet.matricesIndex,this._condensedMatrices)}else{if(this._pAnimationSet.usesCPU){if(this._morphedElementsDirty[a.id])this.morphElements(t,a);return}e.setVertexConstFromArray(this._skeletonAnimationSet.matricesIndex,this._globalMatrices)}};t.prototype.testGPUCompatibility=function(e){if(!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||e.numUsedVertexConstants+this._numJoints*3>128))this._pAnimationSet.cancelGPUCompatibility()};t.prototype._pUpdateDeltaTime=function(t){e.prototype._pUpdateDeltaTime.call(this,t);this._globalPropertiesDirty=true;if(this._pAnimationSet.usesCPU)this.invalidateElements()};t.prototype.updateCondensedMatrices=function(e){var t=0,r=0;var i=e.length;var a;this._condensedMatrices=new Float32Array(i*12);for(var s=0;s<i;s++){a=e[s]*12;r=12;while(r--)this._condensedMatrices[t++]=this._globalMatrices[a++]}};t.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=false;this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);var e=0;var t=this._globalPose.jointPoses;var r;var i,a,s,n;var o,l,h;var c,u,d;var p,f,_;var m,g,y;var v,x,b;var P,S,C,w;var D,T,A,R;var O,V,j,L;var E=this._skeleton.joints;var B;var I;var F;var M;for(var N=0;N<this._numJoints;++N){B=t[N];I=B.orientation;F=B.translation;i=I.x;a=I.y;s=I.z;n=I.w;o=(M=2*i)*a;l=M*s;h=M*n;c=(M=2*a)*s;u=M*n;d=2*s*n;c=2*a*s;u=2*a*n;d=2*s*n;i*=i;a*=a;s*=s;n*=n;p=(M=i-a)-s+n;f=o-d;_=l+u;m=o+d;g=-M-s+n;y=c-h;v=l-u;x=c+h;b=-i-a+s+n;r=E[N].inverseBindPose;P=r[0];S=r[4];C=r[8];w=r[12];D=r[1];T=r[5];A=r[9];R=r[13];O=r[2];V=r[6];j=r[10];L=r[14];this._globalMatrices[e]=p*P+f*D+_*O;this._globalMatrices[e+1]=p*S+f*T+_*V;this._globalMatrices[e+2]=p*C+f*A+_*j;this._globalMatrices[e+3]=p*w+f*R+_*L+F.x;this._globalMatrices[e+4]=m*P+g*D+y*O;this._globalMatrices[e+5]=m*S+g*T+y*V;this._globalMatrices[e+6]=m*C+g*A+y*j;this._globalMatrices[e+7]=m*w+g*R+y*L+F.y;this._globalMatrices[e+8]=v*P+x*D+b*O;this._globalMatrices[e+9]=v*S+x*T+b*V;this._globalMatrices[e+10]=v*C+x*A+b*j;this._globalMatrices[e+11]=v*w+x*R+b*L+F.z;e=e+12}};t.prototype.getRenderableElements=function(e,t){this._morphedElementsDirty[t.id]=true;if(!this._pAnimationSet.usesCPU)return t;var r;if(!(r=this._morphedElements[t.id])){t.normals;t.tangents;r=this._morphedElements[t.id]=t.clone();r.autoDeriveNormals=false;r.autoDeriveTangents=false;t.addEventListener(a.ElementsEvent.INVALIDATE_INDICES,this._onIndicesUpdateDelegate);t.addEventListener(a.ElementsEvent.INVALIDATE_VERTICES,this._onVerticesUpdateDelegate)}return r};t.prototype.morphElements=function(e,t){this._morphedElementsDirty[t.id]=false;var r=t.numVertices;var i=t.positions.get(r);var a=t.normals.get(r);var s=t.tangents.get(r);var n=t.positions.dimensions;var o=t.jointIndices.get(r);var l=t.jointWeights.get(r);var h=this._morphedElements[t.id];var c=h.positions.get(r);var u=h.normals.get(r);var d=h.tangents.get(r);var p=0;var f=0;var _=0;var m=0;var g;var y,v,x;var b,P,S;var C,w,D;var T;var A,R,O;var V,j,L;var E,B,I;var F,M,N,G;var k,z,U,X;var W,H,q,Z;while(p<r){f=p*n;A=i[f];R=i[f+1];O=n==3?i[f+2]:0;_=p*3;V=a[_];j=a[_+1];L=a[_+2];E=s[_];B=s[_+1];I=s[_+2];y=0;v=0;x=0;b=0;P=0;S=0;C=0;w=0;D=0;g=0;while(g<this._jointsPerVertex){T=l[m];if(T>0){var Y=o[m++]<<2;F=this._globalMatrices[Y];M=this._globalMatrices[Y+1];N=this._globalMatrices[Y+2];G=this._globalMatrices[Y+3];k=this._globalMatrices[Y+4];z=this._globalMatrices[Y+5];U=this._globalMatrices[Y+6];X=this._globalMatrices[Y+7];W=this._globalMatrices[Y+8];H=this._globalMatrices[Y+9];q=this._globalMatrices[Y+10];Z=this._globalMatrices[Y+11];y+=T*(F*A+M*R+N*O+G);v+=T*(k*A+z*R+U*O+X);x+=T*(W*A+H*R+q*O+Z);b+=T*(F*V+M*j+N*L);P+=T*(k*V+z*j+U*L);S+=T*(W*V+H*j+q*L);C+=T*(F*E+M*B+N*I);w+=T*(k*E+z*B+U*I);D+=T*(W*E+H*B+q*I);++g}else{m+=this._jointsPerVertex-g;g=this._jointsPerVertex}}c[f]=y;c[f+1]=v;if(n==3)c[f+2]=x;u[_]=b;u[_+1]=P;u[_+2]=S;d[_]=C;d[_+1]=w;d[_+2]=D;p++}h.setPositions(c);h.setNormals(u);h.setTangents(d)};t.prototype.localToGlobalPose=function(e,t,r){var i=t.jointPoses;var a;var s=r.joints;var o=e.numJointPoses;var l=e.jointPoses;var h;var c;var u;var d;var p;var f;var _;var m;var g,y,v,x;var b,P,S,C;var w,D,T;if(i.length!=o)i.length=o;for(var A=0;A<o;++A){a=i[A];if(a==null)a=i[A]=new n.JointPose;c=s[A];h=c.parentIndex;d=l[A];m=a.orientation;_=a.translation;if(h<0){f=d.translation;p=d.orientation;m.x=p.x;m.y=p.y;m.z=p.z;m.w=p.w;_.x=f.x;_.y=f.y;_.z=f.z}else{u=i[h];p=u.orientation;f=d.translation;b=p.x;P=p.y;S=p.z;C=p.w;w=f.x;D=f.y;T=f.z;x=-b*w-P*D-S*T;g=C*w+P*T-S*D;y=C*D-b*T+S*w;v=C*T+b*D-P*w;f=u.translation;_.x=-x*b+g*C-y*S+v*P+f.x;_.y=-x*P+g*S+y*C-v*b+f.y;_.z=-x*S-g*P+y*b+v*C+f.z;g=p.x;y=p.y;v=p.z;x=p.w;p=d.orientation;b=p.x;P=p.y;S=p.z;C=p.w;m.w=x*C-g*b-y*P-v*S;m.x=x*b+g*C+y*S-v*P;m.y=x*P-g*S+y*C+v*b;m.z=x*S+g*P-y*b+v*C}}};t.prototype.onTransitionComplete=function(e){if(e.type==l.AnimationStateEvent.TRANSITION_COMPLETE){e.animationNode.removeEventListener(l.AnimationStateEvent.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate);if(this._pActiveState==e.animationState){this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName);this._pActiveState=this.getAnimationState(this._pActiveNode);this._activeSkeletonState=this._pActiveState}}};t.prototype.onIndicesUpdate=function(e){var t=e.target;this._morphedElements[t.id].setIndices(t.indices)};t.prototype.onVerticesUpdate=function(e){var t=e.target;var r=this._morphedElements[t.id];switch(e.attributesView){case t.uvs:r.setUVs(t.uvs.get(t.numVertices));break;case t.getCustomAtributes("secondaryUVs"):r.setCustomAttributes("secondaryUVs",t.getCustomAtributes("secondaryUVs").get(t.numVertices));break}};return t}(s.AnimatorBase);r.SkeletonAnimator=h},{"../animators/AnimatorBase":"awayjs-renderergl/lib/animators/AnimatorBase","../animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","../animators/data/SkeletonPose":"awayjs-renderergl/lib/animators/data/SkeletonPose","../events/AnimationStateEvent":"awayjs-renderergl/lib/events/AnimationStateEvent","awayjs-display/lib/events/ElementsEvent":undefined}],"awayjs-renderergl/lib/animators/VertexAnimationSet":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../animators/AnimationSetBase");var s=e("../animators/data/AnimationRegisterData");var n=e("../animators/data/VertexAnimationMode");var o=function(e){i(t,e);function t(t,r){if(t===void 0){t=2}if(r===void 0){r="absolute"}e.call(this);this._numPoses=t;this._blendMode=r}Object.defineProperty(t.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:true,configurable:true});t.prototype.getAGALVertexCode=function(e,t,r){this._iAnimationRegisterData=e.animationRegisterData;if(this._iAnimationRegisterData==null)this._iAnimationRegisterData=e.animationRegisterData=new s.AnimationRegisterData;if(this._blendMode==n.VertexAnimationMode.ABSOLUTE)return this.getAbsoluteAGALCode(e,t,r);else return this.getAdditiveAGALCode(e,t,r)};t.prototype.getAGALFragmentCode=function(e,t,r){return""};t.prototype.getAGALUVCode=function(e,t,r){return"mov "+r.uvTarget+","+r.uvSource+"\n"};t.prototype.doneAGALCode=function(e){};t.prototype.getAbsoluteAGALCode=function(e,t,r){var i="";var a=t.getFreeVertexVectorTemp();t.addVertexTempUsages(a,1);var s=t.getFreeVertexVectorTemp();var n=new Array(".x",".y",".z",".w");var o=r.animatableAttributes.length;var l=t.getFreeVertexConstant();this._iAnimationRegisterData.weightsIndex=l.index;this._iAnimationRegisterData.poseIndices=new Array(this._numPoses);var h;var c=0;if(o>2)o=2;for(var u=0;u<o;++u){i+="mul "+a+", "+r.animatableAttributes[u]+", "+l+n[0]+"\n";for(var d=1;d<this._numPoses;++d){h=t.getFreeVertexAttribute();this._iAnimationRegisterData.poseIndices[c++]=h.index;i+="mul "+s+", "+h+", "+l+n[d]+"\n";if(d<this._numPoses-1)i+="add "+a+", "+a+", "+s+"\n"}i+="add "+r.animationTargetRegisters[u]+", "+a+", "+s+"\n"}if(e.tangentDependencies>0||e.outputsNormals){i+="dp3 "+a+".x, "+r.animatableAttributes[2]+", "+r.animationTargetRegisters[1]+"\n"+"mul "+a+", "+r.animationTargetRegisters[1]+", "+a+".x\n"+"sub "+r.animationTargetRegisters[2]+", "+r.animationTargetRegisters[2]+", "+a+"\n"}return i};t.prototype.getAdditiveAGALCode=function(e,t,r){var i="";var a=r.animatableAttributes.length;
var s=[".x",".y",".z",".w"];var n=t.getFreeVertexVectorTemp();var o=t.getFreeVertexConstant();this._iAnimationRegisterData.weightsIndex=o.index;this._iAnimationRegisterData.poseIndices=new Array(this._numPoses);var l;var h=0;if(a>2)a=2;i+="mov  "+r.animationTargetRegisters[0]+", "+r.animatableAttributes[0]+"\n";if(e.normalDependencies>0)i+="mov "+r.animationTargetRegisters[1]+", "+r.animatableAttributes[1]+"\n";for(var c=0;c<a;++c){for(var u=0;u<this._numPoses;++u){l=t.getFreeVertexAttribute();this._iAnimationRegisterData.poseIndices[h++]=l.index;i+="mul "+n+", "+l+", "+o+s[u]+"\n"+"add "+r.animationTargetRegisters[c]+", "+r.animationTargetRegisters[c]+", "+n+"\n"}}if(e.tangentDependencies>0||e.outputsNormals){i+="dp3 "+n+".x, "+r.animatableAttributes[2]+", "+r.animationTargetRegisters[1]+"\n"+"mul "+n+", "+r.animationTargetRegisters[1]+", "+n+".x\n"+"sub "+r.animationTargetRegisters[2]+", "+r.animatableAttributes[2]+", "+n+"\n"}return i};return t}(a.AnimationSetBase);r.VertexAnimationSet=o},{"../animators/AnimationSetBase":"awayjs-renderergl/lib/animators/AnimationSetBase","../animators/data/AnimationRegisterData":"awayjs-renderergl/lib/animators/data/AnimationRegisterData","../animators/data/VertexAnimationMode":"awayjs-renderergl/lib/animators/data/VertexAnimationMode"}],"awayjs-renderergl/lib/animators/VertexAnimator":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/graphics/TriangleElements");var s=e("../animators/AnimatorBase");var n=e("../animators/data/VertexAnimationMode");var o=function(e){i(t,e);function t(t){e.call(this,t);this._poses=new Array;this._weights=new Float32Array([1,0,0,0]);this._vertexAnimationSet=t}t.prototype.clone=function(){return new t(this._vertexAnimationSet)};t.prototype.play=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=NaN}if(this._pActiveAnimationName==e)return;this._pActiveAnimationName=e;if(!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(e);this._pActiveState=this.getAnimationState(this._pActiveNode);if(this.updatePosition){this._pActiveState.update(this._pAbsoluteTime);this._pActiveState.positionDelta}this._activeVertexState=this._pActiveState;this.start();if(!isNaN(r))this.reset(e,r)};t.prototype._pUpdateDeltaTime=function(t){e.prototype._pUpdateDeltaTime.call(this,t);var r=false;if(this._poses[0]!=this._activeVertexState.currentGraphics){this._poses[0]=this._activeVertexState.currentGraphics;r=true}if(this._poses[1]!=this._activeVertexState.nextGraphics)this._poses[1]=this._activeVertexState.nextGraphics;this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight);if(r)this.invalidateElements()};t.prototype.setRenderState=function(e,t,r,i){var s=t.graphic;var o=s.elements;if(!this._poses.length){this.setNullPose(e,o,r);return}var l=e.animationRegisterData;var h;var c=this._vertexAnimationSet.numPoses;e.setVertexConstFromArray(l.weightsIndex,this._weights);if(this._vertexAnimationSet.blendMode==n.VertexAnimationMode.ABSOLUTE)h=1;else h=0;var u;var d=0;for(;h<c;++h){o=this._poses[h].getGraphicAt(s._iIndex).elements||s.elements;u=r.getAbstraction(o);u._indexMappings=r.getAbstraction(s.elements).getIndexMappings();if(o.isAsset(a.TriangleElements)){u.activateVertexBufferVO(l.poseIndices[d++],o.positions);if(e.normalDependencies>0)u.activateVertexBufferVO(l.poseIndices[d++],o.normals)}}};t.prototype.setNullPose=function(e,t,r){var i=e.animationRegisterData;e.setVertexConstFromArray(i.weightsIndex,this._weights);var s=r.getAbstraction(t);var o=0;if(this._vertexAnimationSet.blendMode==n.VertexAnimationMode.ABSOLUTE){var l=this._vertexAnimationSet.numPoses;for(var h=1;h<l;++h){if(t.isAsset(a.TriangleElements)){s.activateVertexBufferVO(i.poseIndices[o++],t.positions);if(e.normalDependencies>0)s.activateVertexBufferVO(i.poseIndices[o++],t.normals)}}}};t.prototype.testGPUCompatibility=function(e){};t.prototype.getRenderableElements=function(e,t){if(this._vertexAnimationSet.blendMode==n.VertexAnimationMode.ABSOLUTE&&this._poses.length)return this._poses[0].getGraphicAt(e.graphic._iIndex).elements||t;return t};return t}(s.AnimatorBase);r.VertexAnimator=o},{"../animators/AnimatorBase":"awayjs-renderergl/lib/animators/AnimatorBase","../animators/data/VertexAnimationMode":"awayjs-renderergl/lib/animators/data/VertexAnimationMode","awayjs-display/lib/graphics/TriangleElements":undefined}],"awayjs-renderergl/lib/animators/data/AnimationElements":[function(e,t,r){"use strict";var i=function(){function e(){this._pVertexBuffer=new Array(8);this._pBufferContext=new Array(8);this._pBufferDirty=new Array(8);this.numProcessedVertices=0;this.previousTime=Number.NEGATIVE_INFINITY;this.animationParticles=new Array;for(var t=0;t<8;t++)this._pBufferDirty[t]=true;this._iUniqueId=e.SUBGEOM_ID_COUNT++}e.prototype.createVertexData=function(e,t){this._numVertices=e;this._totalLenOfOneVertex=t;this._pVertexData=new Array(e*t)};e.prototype.activateVertexBuffer=function(e,t,r,i){var a=r.stageIndex;var s=r.context;var n=this._pVertexBuffer[a];if(!n||this._pBufferContext[a]!=s){n=this._pVertexBuffer[a]=s.createVertexBuffer(this._numVertices,this._totalLenOfOneVertex*4);this._pBufferContext[a]=s;this._pBufferDirty[a]=true}if(this._pBufferDirty[a]){n.uploadFromArray(this._pVertexData,0,this._numVertices);this._pBufferDirty[a]=false}s.setVertexBufferAt(e,n,t*4,i)};e.prototype.dispose=function(){while(this._pVertexBuffer.length){var e=this._pVertexBuffer.pop();if(e)e.dispose()}};e.prototype.invalidateBuffer=function(){for(var e=0;e<8;e++)this._pBufferDirty[e]=true};Object.defineProperty(e.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:true,configurable:true});e.SUBGEOM_ID_COUNT=0;return e}();r.AnimationElements=i},{}],"awayjs-renderergl/lib/animators/data/AnimationRegisterData":[function(e,t,r){"use strict";var i=e("../../shaders/ShaderRegisterElement");var a=function(){function e(){this.indexDictionary=new Object}e.prototype.reset=function(e,t,r){this.rotationRegisters=new Array;this.positionAttribute=t.animatableAttributes[0];this.scaleAndRotateTarget=t.animationTargetRegisters[0];for(var a=1;a<t.animationTargetRegisters.length;a++)this.rotationRegisters.push(t.animationTargetRegisters[a]);this.vertexZeroConst=e.getFreeVertexConstant();this.vertexZeroConst=new i.ShaderRegisterElement(this.vertexZeroConst.regName,this.vertexZeroConst.index,0);this.vertexOneConst=new i.ShaderRegisterElement(this.vertexZeroConst.regName,this.vertexZeroConst.index,1);this.vertexTwoConst=new i.ShaderRegisterElement(this.vertexZeroConst.regName,this.vertexZeroConst.index,2);this.positionTarget=e.getFreeVertexVectorTemp();e.addVertexTempUsages(this.positionTarget,1);this.positionTarget=new i.ShaderRegisterElement(this.positionTarget.regName,this.positionTarget.index);if(r){this.velocityTarget=e.getFreeVertexVectorTemp();e.addVertexTempUsages(this.velocityTarget,1);this.velocityTarget=new i.ShaderRegisterElement(this.velocityTarget.regName,this.velocityTarget.index);this.vertexTime=new i.ShaderRegisterElement(this.velocityTarget.regName,this.velocityTarget.index,3);this.vertexLife=new i.ShaderRegisterElement(this.positionTarget.regName,this.positionTarget.index,3)}else{var s=e.getFreeVertexVectorTemp();e.addVertexTempUsages(s,1);this.vertexTime=new i.ShaderRegisterElement(s.regName,s.index,0);this.vertexLife=new i.ShaderRegisterElement(s.regName,s.index,1)}};e.prototype.setUVSourceAndTarget=function(e){this.uvVar=e.uvTarget;this.uvAttribute=e.uvSource;this.uvTarget=new i.ShaderRegisterElement(this.positionTarget.regName,this.positionTarget.index)};e.prototype.setRegisterIndex=function(e,t,r){var i=this.indexDictionary[e.id];if(i==null)i=this.indexDictionary[e.id]=new Array(8);i[t]=r};e.prototype.getRegisterIndex=function(e,t){return this.indexDictionary[e.id][t]};return e}();r.AnimationRegisterData=a},{"../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement"}],"awayjs-renderergl/lib/animators/data/ColorSegmentPoint":[function(e,t,r){"use strict";var i=function(){function e(e,t){if(e<=0||e>=1)throw new Error("life exceeds range (0,1)");this._life=e;this._color=t}Object.defineProperty(e.prototype,"color",{get:function(){return this._color},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"life",{get:function(){return this._life},enumerable:true,configurable:true});return e}();r.ColorSegmentPoint=i},{}],"awayjs-renderergl/lib/animators/data/JointPose":[function(e,t,r){"use strict";var i=e("awayjs-core/lib/geom/Matrix3D");var a=e("awayjs-core/lib/geom/Quaternion");var s=e("awayjs-core/lib/geom/Vector3D");var n=function(){function e(){this.orientation=new a.Quaternion;this.translation=new s.Vector3D}e.prototype.toMatrix3D=function(e){if(e===void 0){e=null}if(e==null)e=new i.Matrix3D;this.orientation.toMatrix3D(e);e.appendTranslation(this.translation.x,this.translation.y,this.translation.z);return e};e.prototype.copyFrom=function(e){var t=e.orientation;var r=e.translation;this.orientation.x=t.x;this.orientation.y=t.y;this.orientation.z=t.z;this.orientation.w=t.w;this.translation.x=r.x;this.translation.y=r.y;this.translation.z=r.z};return e}();r.JointPose=n},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Quaternion":undefined,"awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/data/ParticleAnimationData":[function(e,t,r){"use strict";var i=function(){function e(e,t,r,i,a){this.index=e;this.startTime=t;this.totalTime=r+i;this.duration=r;this.delay=i;this.startVertexIndex=a.startVertexIndex;this.numVertices=a.numVertices}return e}();r.ParticleAnimationData=i},{}],"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":[function(e,t,r){"use strict";var i=function(){function e(){}e.GLOBAL=0;e.LOCAL_STATIC=1;e.LOCAL_DYNAMIC=2;return e}();r.ParticlePropertiesMode=i},{}],"awayjs-renderergl/lib/animators/data/ParticleProperties":[function(e,t,r){"use strict";var i=function(){function e(){}return e}();r.ParticleProperties=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonJoint":[function(e,t,r){"use strict";var i=function(){function e(){this.parentIndex=-1}return e}();r.SkeletonJoint=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonPose":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/library/AssetBase");var s=e("../../animators/data/JointPose");var n=function(e){i(t,e);function t(){e.call(this);this.jointPoses=new Array}Object.defineProperty(t.prototype,"numJointPoses",{get:function(){return this.jointPoses.length},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"assetType",{get:function(){return t.assetType},enumerable:true,configurable:true});t.prototype.jointPoseFromName=function(e){var t=this.jointPoseIndexFromName(e);if(t!=-1)return this.jointPoses[t];else return null};t.prototype.jointPoseIndexFromName=function(e){var t;var r;for(var i;i<this.jointPoses.length;i++){r=this.jointPoses[i];if(r.name==e)return t;t++}return-1};t.prototype.clone=function(){var e=new t;var r=this.jointPoses.length;for(var i=0;i<r;i++){var a=new s.JointPose;var n=this.jointPoses[i];a.name=n.name;a.copyFrom(n);e.jointPoses[i]=a}return e};t.prototype.dispose=function(){this.jointPoses.length=0};t.assetType="[asset SkeletonPose]";return t}(a.AssetBase);r.SkeletonPose=n},{"../../animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","awayjs-core/lib/library/AssetBase":undefined}],"awayjs-renderergl/lib/animators/data/Skeleton":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/library/AssetBase");var s=function(e){i(t,e);function t(){e.call(this);this.joints=new Array}Object.defineProperty(t.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:true,configurable:true});t.prototype.jointFromName=function(e){var t=this.jointIndexFromName(e);if(t!=-1)return this.joints[t];else return null};t.prototype.jointIndexFromName=function(e){var t;var r;for(var i;i<this.joints.length;i++){r=this.joints[i];if(r.name==e)return t;t++}return-1};t.prototype.dispose=function(){this.joints.length=0};Object.defineProperty(t.prototype,"assetType",{get:function(){return t.assetType},enumerable:true,configurable:true});t.assetType="[asset Skeleton]";return t}(a.AssetBase);r.Skeleton=s},{"awayjs-core/lib/library/AssetBase":undefined}],"awayjs-renderergl/lib/animators/data/VertexAnimationMode":[function(e,t,r){"use strict";var i=function(){function e(){}e.ADDITIVE="additive";e.ABSOLUTE="absolute";return e}();r.VertexAnimationMode=i},{}],"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var n=function(e){i(t,e);function t(){e.call(this);this._pLooping=true;this._pTotalDuration=0;this._pStitchDirty=true;this._pStitchFinalFrame=false;this._pNumFrames=0;this._pDurations=new Array;this._pTotalDelta=new a.Vector3D;this.fixedFrameRate=true}Object.defineProperty(t.prototype,"looping",{get:function(){return this._pLooping},set:function(e){if(this._pLooping==e)return;this._pLooping=e;this._pStitchDirty=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(e){if(this._pStitchFinalFrame==e)return;this._pStitchFinalFrame=e;this._pStitchDirty=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalDuration",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pTotalDuration},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalDelta",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pTotalDelta},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lastFrame",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pLastFrame},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"durations",{get:function(){return this._pDurations},enumerable:true,configurable:true});t.prototype._pUpdateStitch=function(){this._pStitchDirty=false;this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1;this._pTotalDuration=0;this._pTotalDelta.x=0;this._pTotalDelta.y=0;this._pTotalDelta.z=0};return t}(s.AnimationNodeBase);r.AnimationClipNodeBase=n},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleAccelerationState");var l=function(e){i(t,e);function t(t,r){if(r===void 0){r=null}e.call(this,"ParticleAcceleration",t,3);this._pStateClass=o.ParticleAccelerationState;this._acceleration=r||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleAccelerationState.ACCELERATION_INDEX,a.index);var n=r.getFreeVertexVectorTemp();r.addVertexTempUsages(n,1);var l="mul "+n+","+i.vertexTime+","+a+"\n";if(t.needVelocity){var h=r.getFreeVertexVectorTemp();l+="mul "+h+","+n+","+i.vertexTwoConst+"\n";l+="add "+i.velocityTarget+".xyz,"+h+".xyz,"+i.velocityTarget+".xyz\n"}r.removeVertexTempUsage(n);l+="mul "+n+","+n+","+i.vertexTime+"\n";l+="add "+i.positionTarget+".xyz,"+n+","+i.positionTarget+".xyz\n";return l};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.ACCELERATION_VECTOR3D];if(!r)throw new Error("there is no "+t.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=r.x/2;this._pOneData[1]=r.y/2;this._pOneData[2]=r.z/2};t.ACCELERATION_VECTOR3D="AccelerationVector3D";return t}(n.ParticleNodeBase);r.ParticleAccelerationNode=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleAccelerationState":"awayjs-renderergl/lib/animators/states/ParticleAccelerationState","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleBezierCurveState");var l=e("../../shaders/ShaderRegisterElement");var h=function(e){i(t,e);function t(t,r,i){if(r===void 0){r=null}if(i===void 0){i=null}e.call(this,"ParticleBezierCurve",t,6);this._pStateClass=o.ParticleBezierCurveState;this._iControlPoint=r||new a.Vector3D;this._iEndPoint=i||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleBezierCurveState.BEZIER_CONTROL_INDEX,a.index);var n=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleBezierCurveState.BEZIER_END_INDEX,n.index);var h=r.getFreeVertexVectorTemp();var c=new l.ShaderRegisterElement(h.regName,h.index,0);var u=new l.ShaderRegisterElement(h.regName,h.index,1);var d=new l.ShaderRegisterElement(h.regName,h.index,2);r.addVertexTempUsages(h,1);var p=r.getFreeVertexVectorTemp();var f=new l.ShaderRegisterElement(p.regName,p.index);r.removeVertexTempUsage(h);var _="";_+="sub "+c+","+i.vertexOneConst+","+i.vertexLife+"\n";_+="mul "+u+","+i.vertexLife+","+i.vertexLife+"\n";_+="mul "+d+","+i.vertexLife+","+c+"\n";_+="mul "+d+","+d+","+i.vertexTwoConst+"\n";_+="mul "+f+".xyz,"+d+","+a+"\n";_+="add "+i.positionTarget+".xyz,"+f+".xyz,"+i.positionTarget+".xyz\n";_+="mul "+f+".xyz,"+u+","+n+"\n";_+="add "+i.positionTarget+".xyz,"+f+".xyz,"+i.positionTarget+".xyz\n";if(t.needVelocity){_+="mul "+u+","+i.vertexLife+","+i.vertexTwoConst+"\n";_+="sub "+d+","+i.vertexOneConst+","+u+"\n";_+="mul "+d+","+i.vertexTwoConst+","+d+"\n";_+="mul "+f+".xyz,"+a+","+d+"\n";_+="add "+i.velocityTarget+".xyz,"+f+".xyz,"+i.velocityTarget+".xyz\n";_+="mul "+f+".xyz,"+n+","+u+"\n";_+="add "+i.velocityTarget+".xyz,"+f+".xyz,"+i.velocityTarget+".xyz\n"}return _};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.BEZIER_CONTROL_VECTOR3D];if(!r)throw new Error("there is no "+t.BEZIER_CONTROL_VECTOR3D+" in param!");var i=e[t.BEZIER_END_VECTOR3D];if(!i)throw new Error("there is no "+t.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=r.x;this._pOneData[1]=r.y;this._pOneData[2]=r.z;this._pOneData[3]=i.x;this._pOneData[4]=i.y;this._pOneData[5]=i.z};t.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D";t.BEZIER_END_VECTOR3D="BezierEndVector3D";return t}(n.ParticleNodeBase);r.ParticleBezierCurveNode=h},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleBezierCurveState":"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/data/ParticlePropertiesMode");var s=e("../../animators/nodes/ParticleNodeBase");var n=e("../../animators/states/ParticleBillboardState");var o=function(e){i(t,e);function t(t){if(t===void 0){t=null}e.call(this,"ParticleBillboard",a.ParticlePropertiesMode.GLOBAL,0,4);this._pStateClass=n.ParticleBillboardState;this._iBillboardAxis=t}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=r.getFreeVertexConstant();i.setRegisterIndex(this,n.ParticleBillboardState.MATRIX_INDEX,a.index);r.getFreeVertexConstant();r.getFreeVertexConstant();r.getFreeVertexConstant();var s=r.getFreeVertexVectorTemp();var o="m33 "+s+".xyz,"+i.scaleAndRotateTarget+","+a+"\n"+"mov "+i.scaleAndRotateTarget+".xyz,"+s+"\n";var l;for(var h=0;h<i.rotationRegisters.length;h++){l=i.rotationRegisters[h];o+="m33 "+s+".xyz,"+l+","+a+"\n"+"mov "+l+".xyz,"+l+"\n"}return o};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){e.hasBillboard=true};return t}(s.ParticleNodeBase);r.ParticleBillboardNode=o},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleBillboardState":"awayjs-renderergl/lib/animators/states/ParticleBillboardState"}],"awayjs-renderergl/lib/animators/nodes/ParticleColorNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/ColorTransform");var s=e("../../animators/ParticleAnimationSet");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/nodes/ParticleNodeBase");var l=e("../../animators/states/ParticleColorState");var h=function(e){i(t,e);function t(t,r,i,n,o,h,c,u,d){if(r===void 0){r=true}if(i===void 0){i=true}if(n===void 0){n=false}if(o===void 0){o=false}if(h===void 0){h=null}if(c===void 0){c=null}if(u===void 0){u=1}if(d===void 0){d=0}e.call(this,"ParticleColor",t,r&&i?16:8,s.ParticleAnimationSet.COLOR_PRIORITY);this._pStateClass=l.ParticleColorState;this._iUsesMultiplier=r;this._iUsesOffset=i;this._iUsesCycle=n;this._iUsesPhase=o;this._iStartColor=h||new a.ColorTransform;this._iEndColor=c||new a.ColorTransform;this._iCycleDuration=u;this._iCyclePhase=d}t.prototype.getAGALVertexCode=function(e,t,r,i){var a="";if(e.usesFragmentAnimation){var s=r.getFreeVertexVectorTemp();if(this._iUsesCycle){var o=r.getFreeVertexConstant();i.setRegisterIndex(this,l.ParticleColorState.CYCLE_INDEX,o.index);r.addVertexTempUsages(s,1);var h=r.getFreeVertexSingleTemp();r.removeVertexTempUsage(s);a+="mul "+h+","+i.vertexTime+","+o+".x\n";if(this._iUsesPhase)a+="add "+h+","+h+","+o+".y\n";a+="sin "+h+","+h+"\n"}if(this._iUsesMultiplier){var c=this._pMode==n.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();var u=this._pMode==n.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,l.ParticleColorState.START_MULTIPLIER_INDEX,c.index);i.setRegisterIndex(this,l.ParticleColorState.DELTA_MULTIPLIER_INDEX,u.index);a+="mul "+s+","+u+","+(this._iUsesCycle?h:i.vertexLife)+"\n";a+="add "+s+","+s+","+c+"\n";a+="mul "+i.colorMulTarget+","+s+","+i.colorMulTarget+"\n"}if(this._iUsesOffset){var d=this._pMode==n.ParticlePropertiesMode.LOCAL_STATIC?r.getFreeVertexAttribute():r.getFreeVertexConstant();var p=this._pMode==n.ParticlePropertiesMode.LOCAL_STATIC?r.getFreeVertexAttribute():r.getFreeVertexConstant();i.setRegisterIndex(this,l.ParticleColorState.START_OFFSET_INDEX,d.index);i.setRegisterIndex(this,l.ParticleColorState.DELTA_OFFSET_INDEX,p.index);a+="mul "+s+","+p+","+(this._iUsesCycle?h:i.vertexLife)+"\n";a+="add "+s+","+s+","+d+"\n";a+="add "+i.colorAddTarget+","+s+","+i.colorAddTarget+"\n"}}return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){if(this._iUsesMultiplier)e.hasColorMulNode=true;if(this._iUsesOffset)e.hasColorAddNode=true};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.COLOR_START_COLORTRANSFORM];if(!r)throw new Error("there is no "+t.COLOR_START_COLORTRANSFORM+" in param!");var i=e[t.COLOR_END_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_END_COLORTRANSFORM+" in param!");var a=0;if(!this._iUsesCycle){if(this._iUsesMultiplier){this._pOneData[a++]=r.redMultiplier;this._pOneData[a++]=r.greenMultiplier;this._pOneData[a++]=r.blueMultiplier;this._pOneData[a++]=r.alphaMultiplier;this._pOneData[a++]=i.redMultiplier-r.redMultiplier;this._pOneData[a++]=i.greenMultiplier-r.greenMultiplier;this._pOneData[a++]=i.blueMultiplier-r.blueMultiplier;this._pOneData[a++]=i.alphaMultiplier-r.alphaMultiplier}if(this._iUsesOffset){this._pOneData[a++]=r.redOffset/255;this._pOneData[a++]=r.greenOffset/255;this._pOneData[a++]=r.blueOffset/255;this._pOneData[a++]=r.alphaOffset/255;this._pOneData[a++]=(i.redOffset-r.redOffset)/255;this._pOneData[a++]=(i.greenOffset-r.greenOffset)/255;this._pOneData[a++]=(i.blueOffset-r.blueOffset)/255;this._pOneData[a++]=(i.alphaOffset-r.alphaOffset)/255}}else{if(this._iUsesMultiplier){this._pOneData[a++]=(r.redMultiplier+i.redMultiplier)/2;this._pOneData[a++]=(r.greenMultiplier+i.greenMultiplier)/2;this._pOneData[a++]=(r.blueMultiplier+i.blueMultiplier)/2;this._pOneData[a++]=(r.alphaMultiplier+i.alphaMultiplier)/2;this._pOneData[a++]=(r.redMultiplier-i.redMultiplier)/2;this._pOneData[a++]=(r.greenMultiplier-i.greenMultiplier)/2;this._pOneData[a++]=(r.blueMultiplier-i.blueMultiplier)/2;this._pOneData[a++]=(r.alphaMultiplier-i.alphaMultiplier)/2}if(this._iUsesOffset){this._pOneData[a++]=(r.redOffset+i.redOffset)/(255*2);this._pOneData[a++]=(r.greenOffset+i.greenOffset)/(255*2);this._pOneData[a++]=(r.blueOffset+i.blueOffset)/(255*2);this._pOneData[a++]=(r.alphaOffset+i.alphaOffset)/(255*2);this._pOneData[a++]=(r.redOffset-i.redOffset)/(255*2);this._pOneData[a++]=(r.greenOffset-i.greenOffset)/(255*2);this._pOneData[a++]=(r.blueOffset-i.blueOffset)/(255*2);this._pOneData[a++]=(r.alphaOffset-i.alphaOffset)/(255*2)}}};t.COLOR_START_COLORTRANSFORM="ColorStartColorTransform";t.COLOR_END_COLORTRANSFORM="ColorEndColorTransform";return t}(o.ParticleNodeBase);r.ParticleColorNode=h},{"../../animators/ParticleAnimationSet":"awayjs-renderergl/lib/animators/ParticleAnimationSet","../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleColorState":"awayjs-renderergl/lib/animators/states/ParticleColorState","awayjs-core/lib/geom/ColorTransform":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/ParticleAnimationSet");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleFollowState");var l=function(e){i(t,e);function t(t,r,i){if(t===void 0){t=true}if(r===void 0){r=true}if(i===void 0){i=false}e.call(this,"ParticleFollow",s.ParticlePropertiesMode.LOCAL_DYNAMIC,t&&r?6:3,a.ParticleAnimationSet.POST_PRIORITY);this._pStateClass=o.ParticleFollowState;this._iUsesPosition=t;this._iUsesRotation=r;this._iSmooth=i}t.prototype.getAGALVertexCode=function(e,t,r,i){var a="";if(this._iUsesRotation){var s=r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleFollowState.FOLLOW_ROTATION_INDEX,s.index);var n=r.getFreeVertexVectorTemp();r.addVertexTempUsages(n,1);var l=r.getFreeVertexVectorTemp();r.addVertexTempUsages(l,1);var h=r.getFreeVertexVectorTemp();var c;if(t.hasBillboard){r.addVertexTempUsages(h,1);c=r.getFreeVertexVectorTemp()}r.removeVertexTempUsage(n);r.removeVertexTempUsage(l);if(t.hasBillboard)r.removeVertexTempUsage(h);var u=i.rotationRegisters.length;var d;a+="mov "+n+","+i.vertexZeroConst+"\n";a+="mov "+n+".x,"+i.vertexOneConst+"\n";a+="mov "+h+","+i.vertexZeroConst+"\n";a+="sin "+h+".y,"+s+".x\n";a+="cos "+h+".z,"+s+".x\n";a+="mov "+l+".x,"+i.vertexZeroConst+"\n";a+="mov "+l+".y,"+h+".z\n";a+="neg "+l+".z,"+h+".y\n";if(t.hasBillboard)a+="m33 "+c+".xyz,"+i.positionTarget+".xyz,"+n+"\n";else{a+="m33 "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+n+"\n";for(d=0;d<u;d++)a+="m33 "+i.rotationRegisters[d]+".xyz,"+i.rotationRegisters[d]+","+n+"\n"}a+="mov "+n+","+i.vertexZeroConst+"\n";a+="cos "+n+".x,"+s+".y\n";a+="sin "+n+".z,"+s+".y\n";a+="mov "+l+","+i.vertexZeroConst+"\n";a+="mov "+l+".y,"+i.vertexOneConst+"\n";a+="mov "+h+","+i.vertexZeroConst+"\n";a+="neg "+h+".x,"+n+".z\n";a+="mov "+h+".z,"+n+".x\n";if(t.hasBillboard)a+="m33 "+c+".xyz,"+c+".xyz,"+n+"\n";else{a+="m33 "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+n+"\n";for(d=0;d<u;d++)a+="m33 "+i.rotationRegisters[d]+".xyz,"+i.rotationRegisters[d]+","+n+"\n"}a+="mov "+l+","+i.vertexZeroConst+"\n";a+="sin "+l+".x,"+s+".z\n";a+="cos "+l+".y,"+s+".z\n";a+="mov "+n+","+i.vertexZeroConst+"\n";a+="mov "+n+".x,"+l+".y\n";a+="neg "+n+".y,"+l+".x\n";a+="mov "+h+","+i.vertexZeroConst+"\n";a+="mov "+h+".z,"+i.vertexOneConst+"\n";if(t.hasBillboard){a+="m33 "+c+".xyz,"+c+".xyz,"+n+"\n";a+="sub "+c+".xyz,"+c+".xyz,"+i.positionTarget+".xyz\n";a+="add "+i.scaleAndRotateTarget+".xyz,"+c+".xyz,"+i.scaleAndRotateTarget+".xyz\n"}else{a+="m33 "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+n+"\n";for(d=0;d<u;d++)a+="m33 "+i.rotationRegisters[d]+".xyz,"+i.rotationRegisters[d]+","+n+"\n"}}if(this._iUsesPosition){var p=r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleFollowState.FOLLOW_POSITION_INDEX,p.index);a+="add "+i.scaleAndRotateTarget+".xyz,"+p+","+i.scaleAndRotateTarget+".xyz\n"}return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(n.ParticleNodeBase);r.ParticleFollowNode=l},{"../../animators/ParticleAnimationSet":"awayjs-renderergl/lib/animators/ParticleAnimationSet","../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleFollowState":"awayjs-renderergl/lib/animators/states/ParticleFollowState"}],
"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/ColorTransform");var s=e("../../animators/ParticleAnimationSet");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/nodes/ParticleNodeBase");var l=e("../../animators/states/ParticleInitialColorState");var h=function(e){i(t,e);function t(t,r,i,n){if(r===void 0){r=true}if(i===void 0){i=false}if(n===void 0){n=null}e.call(this,"ParticleInitialColor",t,r&&i?8:4,s.ParticleAnimationSet.COLOR_PRIORITY);this._pStateClass=l.ParticleInitialColorState;this._iUsesMultiplier=r;this._iUsesOffset=i;this._iInitialColor=n||new a.ColorTransform}t.prototype.getAGALVertexCode=function(e,t,r,i){var a="";if(e.usesFragmentAnimation){if(this._iUsesMultiplier){var s=this._pMode==n.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,l.ParticleInitialColorState.MULTIPLIER_INDEX,s.index);a+="mul "+i.colorMulTarget+","+s+","+i.colorMulTarget+"\n"}if(this._iUsesOffset){var o=this._pMode==n.ParticlePropertiesMode.LOCAL_STATIC?r.getFreeVertexAttribute():r.getFreeVertexConstant();i.setRegisterIndex(this,l.ParticleInitialColorState.OFFSET_INDEX,o.index);a+="add "+i.colorAddTarget+","+o+","+i.colorAddTarget+"\n"}}return a};t.prototype._iProcessAnimationSetting=function(e){if(this._iUsesMultiplier)e.hasColorMulNode=true;if(this._iUsesOffset)e.hasColorAddNode=true};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.COLOR_INITIAL_COLORTRANSFORM];if(!r)throw new Error("there is no "+t.COLOR_INITIAL_COLORTRANSFORM+" in param!");var i=0;if(this._iUsesMultiplier){this._pOneData[i++]=r.redMultiplier;this._pOneData[i++]=r.greenMultiplier;this._pOneData[i++]=r.blueMultiplier;this._pOneData[i++]=r.alphaMultiplier}if(this._iUsesOffset){this._pOneData[i++]=r.redOffset/255;this._pOneData[i++]=r.greenOffset/255;this._pOneData[i++]=r.blueOffset/255;this._pOneData[i++]=r.alphaOffset/255}};t.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform";return t}(o.ParticleNodeBase);r.ParticleInitialColorNode=h},{"../../animators/ParticleAnimationSet":"awayjs-renderergl/lib/animators/ParticleAnimationSet","../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleInitialColorState":"awayjs-renderergl/lib/animators/states/ParticleInitialColorState","awayjs-core/lib/geom/ColorTransform":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var s=function(e){i(t,e);function t(r,i,a,s){if(s===void 0){s=1}e.call(this);this._pDataLength=3;r=r+t.MODES[i];this.name=r;this._pMode=i;this._priority=s;this._pDataLength=a;this._pOneData=new Array(this._pDataLength)}Object.defineProperty(t.prototype,"mode",{get:function(){return this._pMode},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"oneData",{get:function(){return this._pOneData},enumerable:true,configurable:true});t.prototype.getAGALVertexCode=function(e,t,r,i){return""};t.prototype.getAGALFragmentCode=function(e,t,r,i){return""};t.prototype.getAGALUVCode=function(e,t,r,i){return""};t.prototype._iGeneratePropertyOfOneParticle=function(e){};t.prototype._iProcessAnimationSetting=function(e){};t.GLOBAL="Global";t.LOCAL_STATIC="LocalStatic";t.LOCAL_DYNAMIC="LocalDynamic";t.MODES={0:t.GLOBAL,1:t.LOCAL_STATIC,2:t.LOCAL_DYNAMIC};return t}(a.AnimationNodeBase);r.ParticleNodeBase=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleOrbitState");var l=e("../../shaders/ShaderRegisterElement");var h=function(e){i(t,e);function t(t,r,i,s,n,l,h,c){if(r===void 0){r=true}if(i===void 0){i=false}if(s===void 0){s=false}if(n===void 0){n=100}if(l===void 0){l=1}if(h===void 0){h=0}if(c===void 0){c=null}var u=3;if(s)u++;e.call(this,"ParticleOrbit",t,u);this._pStateClass=o.ParticleOrbitState;this._iUsesEulers=r;this._iUsesCycle=i;this._iUsesPhase=s;this._iRadius=n;this._iCycleDuration=l;this._iCyclePhase=h;this._iEulers=c||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleOrbitState.ORBIT_INDEX,a.index);var n=r.getFreeVertexConstant();i.setRegisterIndex(this,o.ParticleOrbitState.EULERS_INDEX,n.index);r.getFreeVertexConstant();r.getFreeVertexConstant();r.getFreeVertexConstant();var h=r.getFreeVertexVectorTemp();r.addVertexTempUsages(h,1);var c=new l.ShaderRegisterElement(h.regName,h.index);var u=r.getFreeVertexVectorTemp();var d=new l.ShaderRegisterElement(u.regName,u.index,0);var p=new l.ShaderRegisterElement(u.regName,u.index,1);var f=new l.ShaderRegisterElement(u.regName,u.index,2);r.removeVertexTempUsage(h);var _="";if(this._iUsesCycle){_+="mul "+f+","+i.vertexTime+","+a+".y\n";if(this._iUsesPhase)_+="add "+f+","+f+","+a+".w\n"}else _+="mul "+f+","+i.vertexLife+","+a+".y\n";_+="cos "+d+","+f+"\n";_+="sin "+p+","+f+"\n";_+="mul "+c+".x,"+d+","+a+".x\n";_+="mul "+c+".y,"+p+","+a+".x\n";_+="mov "+c+".wz"+i.vertexZeroConst+"\n";if(this._iUsesEulers)_+="m44 "+c+","+c+","+n+"\n";_+="add "+i.positionTarget+".xyz,"+c+".xyz,"+i.positionTarget+".xyz\n";if(t.needVelocity){_+="neg "+c+".x,"+p+"\n";_+="mov "+c+".y,"+d+"\n";_+="mov "+c+".zw,"+i.vertexZeroConst+"\n";if(this._iUsesEulers)_+="m44 "+c+","+c+","+n+"\n";_+="mul "+c+","+c+","+a+".z\n";_+="div "+c+","+c+","+a+".y\n";if(!this._iUsesCycle)_+="div "+c+","+c+","+i.vertexLife+"\n";_+="add "+i.velocityTarget+".xyz,"+i.velocityTarget+".xyz,"+c+".xyz\n"}return _};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.ORBIT_VECTOR3D];if(!r)throw new Error("there is no "+t.ORBIT_VECTOR3D+" in param!");this._pOneData[0]=r.x;if(this._iUsesCycle&&r.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=Math.PI*2/(!this._iUsesCycle?1:r.y);this._pOneData[2]=r.x*Math.PI*2;if(this._iUsesPhase)this._pOneData[3]=r.z*Math.PI/180};t.ORBIT_VECTOR3D="OrbitVector3D";return t}(n.ParticleNodeBase);r.ParticleOrbitNode=h},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleOrbitState":"awayjs-renderergl/lib/animators/states/ParticleOrbitState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleOscillatorState");var l=e("../../shaders/ShaderRegisterElement");var h=function(e){i(t,e);function t(t,r){if(r===void 0){r=null}e.call(this,"ParticleOscillator",t,4);this._pStateClass=o.ParticleOscillatorState;this._iOscillator=r||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleOscillatorState.OSCILLATOR_INDEX,a.index);var n=r.getFreeVertexVectorTemp();var h=new l.ShaderRegisterElement(n.regName,n.index,0);var c=new l.ShaderRegisterElement(n.regName,n.index,1);var u=new l.ShaderRegisterElement(n.regName,n.index,2);r.addVertexTempUsages(n,1);var d=r.getFreeVertexVectorTemp();var p=new l.ShaderRegisterElement(d.regName,d.index);r.removeVertexTempUsage(n);var f="";f+="mul "+h+","+i.vertexTime+","+a+".w\n";f+="sin "+c+","+h+"\n";f+="mul "+p+".xyz,"+c+","+a+".xyz\n";f+="add "+i.positionTarget+".xyz,"+p+".xyz,"+i.positionTarget+".xyz\n";if(t.needVelocity){f+="cos "+u+","+h+"\n";f+="mul "+p+".xyz,"+u+","+a+".xyz\n";f+="add "+i.velocityTarget+".xyz,"+p+".xyz,"+i.velocityTarget+".xyz\n"}return f};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.OSCILLATOR_VECTOR3D];if(!r)throw new Error("there is no "+t.OSCILLATOR_VECTOR3D+" in param!");this._pOneData[0]=r.x;this._pOneData[1]=r.y;this._pOneData[2]=r.z;if(r.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI*2/r.w};t.OSCILLATOR_VECTOR3D="OscillatorVector3D";return t}(n.ParticleNodeBase);r.ParticleOscillatorNode=h},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleOscillatorState":"awayjs-renderergl/lib/animators/states/ParticleOscillatorState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticlePositionState");var l=function(e){i(t,e);function t(t,r){if(r===void 0){r=null}e.call(this,"ParticlePosition",t,3);this._pStateClass=o.ParticlePositionState;this._iPosition=r||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticlePositionState.POSITION_INDEX,a.index);return"add "+i.positionTarget+".xyz,"+a+".xyz,"+i.positionTarget+".xyz\n"};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.POSITION_VECTOR3D];if(!r)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=r.x;this._pOneData[1]=r.y;this._pOneData[2]=r.z};t.POSITION_VECTOR3D="PositionVector3D";return t}(n.ParticleNodeBase);r.ParticlePositionNode=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticlePositionState":"awayjs-renderergl/lib/animators/states/ParticlePositionState","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/data/ParticlePropertiesMode");var s=e("../../animators/nodes/ParticleNodeBase");var n=e("../../animators/states/ParticleRotateToHeadingState");var o=e("../../shaders/ShaderRegisterElement");var l=function(e){i(t,e);function t(){e.call(this,"ParticleRotateToHeading",a.ParticlePropertiesMode.GLOBAL,0,3);this._pStateClass=n.ParticleRotateToHeadingState}t.prototype.getAGALVertexCode=function(e,t,r,i){var a="";var s=i.rotationRegisters.length;var l;if(t.hasBillboard){var h=r.getFreeVertexVectorTemp();r.addVertexTempUsages(h,1);var c=r.getFreeVertexVectorTemp();r.addVertexTempUsages(c,1);var u=r.getFreeVertexVectorTemp();var d=r.getFreeVertexConstant();i.setRegisterIndex(this,n.ParticleRotateToHeadingState.MATRIX_INDEX,d.index);r.getFreeVertexConstant();r.getFreeVertexConstant();r.getFreeVertexConstant();r.removeVertexTempUsage(h);r.removeVertexTempUsage(c);a+="m33 "+h+".xyz,"+i.velocityTarget+".xyz,"+d+"\n";a+="mov "+u+","+i.vertexZeroConst+"\n";a+="mov "+u+".xy,"+h+".xy\n";a+="nrm "+u+".xyz,"+u+".xyz\n";a+="mov "+c+","+i.vertexZeroConst+"\n";a+="mov "+c+".x,"+u+".y\n";a+="mov "+c+".y,"+u+".x\n";a+="mov "+h+","+i.vertexZeroConst+"\n";a+="mov "+h+".x,"+u+".x\n";a+="neg "+h+".y,"+u+".y\n";a+="mov "+u+","+i.vertexZeroConst+"\n";a+="mov "+u+".z,"+i.vertexOneConst+"\n";a+="m33 "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+h+"\n";for(l=0;l<s;l++)a+="m33 "+i.rotationRegisters[l]+".xyz,"+i.rotationRegisters[l]+","+h+"\n"}else{var p=r.getFreeVertexVectorTemp();r.addVertexTempUsages(p,1);var f=r.getFreeVertexVectorTemp();r.addVertexTempUsages(f,1);var _=r.getFreeVertexVectorTemp();r.addVertexTempUsages(_,1);var m=r.getFreeVertexVectorTemp();var g=new o.ShaderRegisterElement(_.regName,_.index,3);var y=new o.ShaderRegisterElement(m.regName,m.index,3);var v=new o.ShaderRegisterElement(p.regName,p.index,3);var x=y;r.removeVertexTempUsage(p);r.removeVertexTempUsage(f);r.removeVertexTempUsage(_);a+="mov "+f+".x,"+i.vertexOneConst+"\n";a+="mov "+f+".yz,"+i.vertexZeroConst+"\n";a+="nrm "+p+".xyz,"+i.velocityTarget+".xyz\n";a+="dp3 "+v+","+p+".xyz,"+f+".xyz\n";a+="crs "+p+".xyz,"+f+".xyz,"+p+".xyz\n";a+="nrm "+p+".xyz,"+p+".xyz\n";a+="dp3 "+_+".x,"+p+".xyz,"+p+".xyz\n";a+="sge "+_+".x,"+i.vertexZeroConst+","+_+".x\n";a+="add "+p+".z,"+_+".x,"+p+".z\n";a+="add "+x+","+v+","+i.vertexOneConst+"\n";a+="div "+x+","+x+","+i.vertexTwoConst+"\n";a+="sqt "+g+","+x+"\n";a+="sub "+x+","+i.vertexOneConst+","+v+"\n";a+="div "+x+","+x+","+i.vertexTwoConst+"\n";a+="sqt "+y+","+x+"\n";a+="mul "+_+".xyz,"+y+","+p+".xyz\n";a+="mul "+m+".xyz,"+y+","+p+".xyz\n";a+="neg "+m+".xyz,"+m+".xyz\n";a+="crs "+p+".xyz,"+_+".xyz,"+i.scaleAndRotateTarget+".xyz\n";a+="mul "+f+".xyz,"+g+","+i.scaleAndRotateTarget+".xyz\n";a+="add "+p+".xyz,"+p+".xyz,"+f+".xyz\n";a+="dp3 "+f+".w,"+_+".xyz,"+i.scaleAndRotateTarget+".xyz\n";a+="neg "+p+".w,"+f+".w\n";a+="crs "+_+".xyz,"+p+".xyz,"+m+".xyz\n";a+="mul "+f+".xyzw,"+p+".xyzw,"+g+"\n";a+="add "+_+".xyz,"+_+".xyz,"+f+".xyz\n";a+="mul "+f+".xyz,"+p+".w,"+m+".xyz\n";a+="add "+i.scaleAndRotateTarget+".xyz,"+_+".xyz,"+f+".xyz\n";for(l=0;l<s;l++){a+="mov "+f+".x,"+i.vertexOneConst+"\n";a+="mov "+f+".yz,"+i.vertexZeroConst+"\n";a+="nrm "+p+".xyz,"+i.velocityTarget+".xyz\n";a+="dp3 "+v+","+p+".xyz,"+f+".xyz\n";a+="crs "+p+".xyz,"+f+".xyz,"+p+".xyz\n";a+="nrm "+p+".xyz,"+p+".xyz\n";a+="dp3 "+_+".x,"+p+".xyz,"+p+".xyz\n";a+="sge "+_+".x,"+i.vertexZeroConst+","+_+".x\n";a+="add "+p+".z,"+_+".x,"+p+".z\n";a+="add "+x+","+v+","+i.vertexOneConst+"\n";a+="div "+x+","+x+","+i.vertexTwoConst+"\n";a+="sqt "+g+","+x+"\n";a+="sub "+x+","+i.vertexOneConst+","+v+"\n";a+="div "+x+","+x+","+i.vertexTwoConst+"\n";a+="sqt "+y+","+x+"\n";a+="mul "+_+".xyz,"+y+","+p+".xyz\n";a+="mul "+m+".xyz,"+y+","+p+".xyz\n";a+="neg "+m+".xyz,"+m+".xyz\n";a+="crs "+p+".xyz,"+_+".xyz,"+i.rotationRegisters[l]+".xyz\n";a+="mul "+f+".xyz,"+g+","+i.rotationRegisters[l]+".xyz\n";a+="add "+p+".xyz,"+p+".xyz,"+f+".xyz\n";a+="dp3 "+f+".w,"+_+".xyz,"+i.rotationRegisters[l]+".xyz\n";a+="neg "+p+".w,"+f+".w\n";a+="crs "+_+".xyz,"+p+".xyz,"+m+".xyz\n";a+="mul "+f+".xyzw,"+p+".xyzw,"+g+"\n";a+="add "+_+".xyz,"+_+".xyz,"+f+".xyz\n";a+="mul "+f+".xyz,"+p+".w,"+m+".xyz\n";a+="add "+i.rotationRegisters[l]+".xyz,"+_+".xyz,"+f+".xyz\n"}}return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){e.needVelocity=true};return t}(s.ParticleNodeBase);r.ParticleRotateToHeadingNode=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleRotateToHeadingState":"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement"}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleRotateToPositionState");var l=e("../../shaders/ShaderRegisterElement");var h=function(e){i(t,e);function t(t,r){if(r===void 0){r=null}e.call(this,"ParticleRotateToPosition",t,3,3);this._pStateClass=o.ParticleRotateToPositionState;this._iPosition=r||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleRotateToPositionState.POSITION_INDEX,a.index);var n="";var h=i.rotationRegisters.length;var c;if(t.hasBillboard){var u=r.getFreeVertexVectorTemp();r.addVertexTempUsages(u,1);var d=r.getFreeVertexVectorTemp();r.addVertexTempUsages(d,1);var p=r.getFreeVertexVectorTemp();var f=r.getFreeVertexConstant();i.setRegisterIndex(this,o.ParticleRotateToPositionState.MATRIX_INDEX,f.index);r.getFreeVertexConstant();r.getFreeVertexConstant();r.getFreeVertexConstant();r.removeVertexTempUsage(u);r.removeVertexTempUsage(d);n+="sub "+u+".xyz,"+a+".xyz,"+i.positionTarget+".xyz\n";n+="m33 "+u+".xyz,"+u+".xyz,"+f+"\n";n+="mov "+p+","+i.vertexZeroConst+"\n";n+="mov "+p+".xy,"+u+".xy\n";n+="nrm "+p+".xyz,"+p+".xyz\n";n+="mov "+d+","+i.vertexZeroConst+"\n";n+="mov "+d+".x,"+p+".y\n";n+="mov "+d+".y,"+p+".x\n";n+="mov "+u+","+i.vertexZeroConst+"\n";n+="mov "+u+".x,"+p+".x\n";n+="neg "+u+".y,"+p+".y\n";n+="mov "+p+","+i.vertexZeroConst+"\n";n+="mov "+p+".z,"+i.vertexOneConst+"\n";n+="m33 "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+u+"\n";for(c=0;c<h;c++)n+="m33 "+i.rotationRegisters[c]+".xyz,"+i.rotationRegisters[c]+","+u+"\n"}else{var _=r.getFreeVertexVectorTemp();r.addVertexTempUsages(_,1);var m=r.getFreeVertexVectorTemp();r.addVertexTempUsages(m,1);var g=new l.ShaderRegisterElement(m.regName,m.index,0);var y=new l.ShaderRegisterElement(m.regName,m.index,1);var v=new l.ShaderRegisterElement(m.regName,m.index,2);var x=new l.ShaderRegisterElement(m.regName,m.index,3);var b=r.getFreeVertexVectorTemp();r.addVertexTempUsages(b,1);r.removeVertexTempUsage(_);r.removeVertexTempUsage(m);r.removeVertexTempUsage(b);n+="sub "+_+".xyz,"+a+".xyz,"+i.positionTarget+".xyz\n";n+="nrm "+_+".xyz,"+_+".xyz\n";n+="mov "+y+","+_+".y\n";n+="mul "+g+","+y+","+y+"\n";n+="sub "+g+","+i.vertexOneConst+","+g+"\n";n+="sqt "+g+","+g+"\n";n+="mul "+b+".x,"+g+","+i.scaleAndRotateTarget+".y\n";n+="mul "+b+".y,"+y+","+i.scaleAndRotateTarget+".z\n";n+="mul "+b+".z,"+y+","+i.scaleAndRotateTarget+".y\n";n+="mul "+b+".w,"+g+","+i.scaleAndRotateTarget+".z\n";n+="sub "+i.scaleAndRotateTarget+".y,"+b+".x,"+b+".y\n";n+="add "+i.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n";n+="abs "+b+".y,"+_+".y\n";n+="sge "+b+".z,"+b+".y,"+i.vertexOneConst+"\n";n+="mul "+b+".x,"+b+".y,"+_+".y\n";n+="mov "+_+".y,"+i.vertexZeroConst+"\n";n+="dp3 "+y+","+_+".xyz,"+_+".xyz\n";n+="sge "+x+","+i.vertexZeroConst+","+y+"\n";n+="mov "+_+".y,"+i.vertexZeroConst+"\n";n+="nrm "+_+".xyz,"+_+".xyz\n";n+="sub "+y+","+i.vertexOneConst+","+x+"\n";n+="mul "+y+","+y+","+_+".x\n";n+="mov "+g+","+_+".z\n";n+="neg "+g+","+g+"\n";n+="sub "+v+","+i.vertexOneConst+","+g+"\n";n+="mul "+v+","+b+".x,"+x+"\n";n+="add "+g+","+g+","+v+"\n";n+="mul "+b+".x,"+g+","+i.scaleAndRotateTarget+".x\n";n+="mul "+b+".y,"+y+","+i.scaleAndRotateTarget+".z\n";n+="mul "+b+".z,"+y+","+i.scaleAndRotateTarget+".x\n";n+="mul "+b+".w,"+g+","+i.scaleAndRotateTarget+".z\n";n+="sub "+i.scaleAndRotateTarget+".x,"+b+".x,"+b+".y\n";n+="add "+i.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n";for(c=0;c<h;c++){n+="sub "+_+".xyz,"+a+".xyz,"+i.positionTarget+".xyz\n";n+="nrm "+_+".xyz,"+_+".xyz\n";n+="mov "+y+","+_+".y\n";n+="mul "+g+","+y+","+y+"\n";n+="sub "+g+","+i.vertexOneConst+","+g+"\n";n+="sqt "+g+","+g+"\n";n+="mul "+b+".x,"+g+","+i.rotationRegisters[c]+".y\n";n+="mul "+b+".y,"+y+","+i.rotationRegisters[c]+".z\n";n+="mul "+b+".z,"+y+","+i.rotationRegisters[c]+".y\n";n+="mul "+b+".w,"+g+","+i.rotationRegisters[c]+".z\n";n+="sub "+i.rotationRegisters[c]+".y,"+b+".x,"+b+".y\n";n+="add "+i.rotationRegisters[c]+".z,"+b+".z,"+b+".w\n";n+="abs "+b+".y,"+_+".y\n";n+="sge "+b+".z,"+b+".y,"+i.vertexOneConst+"\n";n+="mul "+b+".x,"+b+".y,"+_+".y\n";n+="mov "+_+".y,"+i.vertexZeroConst+"\n";n+="dp3 "+y+","+_+".xyz,"+_+".xyz\n";n+="sge "+x+","+i.vertexZeroConst+","+y+"\n";n+="mov "+_+".y,"+i.vertexZeroConst+"\n";n+="nrm "+_+".xyz,"+_+".xyz\n";n+="sub "+y+","+i.vertexOneConst+","+x+"\n";n+="mul "+y+","+y+","+_+".x\n";n+="mov "+g+","+_+".z\n";n+="neg "+g+","+g+"\n";n+="sub "+v+","+i.vertexOneConst+","+g+"\n";n+="mul "+v+","+b+".x,"+x+"\n";n+="add "+g+","+g+","+v+"\n";n+="mul "+b+".x,"+g+","+i.rotationRegisters[c]+".x\n";n+="mul "+b+".y,"+y+","+i.rotationRegisters[c]+".z\n";n+="mul "+b+".z,"+y+","+i.rotationRegisters[c]+".x\n";n+="mul "+b+".w,"+g+","+i.rotationRegisters[c]+".z\n";n+="sub "+i.rotationRegisters[c]+".x,"+b+".x,"+b+".y\n";n+="add "+i.rotationRegisters[c]+".z,"+b+".z,"+b+".w\n"}}return n};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.POSITION_VECTOR3D];if(!r)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=r.x;this._pOneData[1]=r.y;this._pOneData[2]=r.z};t.POSITION_VECTOR3D="RotateToPositionVector3D";return t}(n.ParticleNodeBase);r.ParticleRotateToPositionNode=h},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleRotateToPositionState":"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleRotationalVelocityState");var l=e("../../shaders/ShaderRegisterElement");var h=function(e){i(t,e);function t(t,r){if(r===void 0){r=null}e.call(this,"ParticleRotationalVelocity",t,4);this._pStateClass=o.ParticleRotationalVelocityState;this._iRotationalVelocity=r||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX,a.index);var n=r.getFreeVertexVectorTemp();r.addVertexTempUsages(n,1);var h=r.getFreeVertexVectorTemp();r.addVertexTempUsages(h,1);var c=r.getFreeVertexVectorTemp();r.addVertexTempUsages(c,1);var u=new l.ShaderRegisterElement(c.regName,c.index);var d=r.getFreeVertexVectorTemp();d=new l.ShaderRegisterElement(d.regName,d.index);var p=new l.ShaderRegisterElement(u.regName,u.index,3);var f=new l.ShaderRegisterElement(d.regName,d.index,3);r.removeVertexTempUsage(n);r.removeVertexTempUsage(h);r.removeVertexTempUsage(c);var _="";_+="mov "+n+".xyz,"+a+".xyz\n";_+="mov "+n+".w,"+i.vertexZeroConst+"\n";_+="mul "+p+","+i.vertexTime+","+a+".w\n";_+="sin "+f+","+p+"\n";_+="cos "+p+","+p+"\n";_+="mul "+u+".xyz,"+f+","+n+".xyz\n";_+="mul "+d+".xyz,"+f+","+n+".xyz\n";_+="neg "+d+".xyz,"+d+".xyz\n";_+="crs "+n+".xyz,"+u+".xyz,"+i.scaleAndRotateTarget+".xyz\n";_+="mul "+h+".xyz,"+p+","+i.scaleAndRotateTarget+".xyz\n";_+="add "+n+".xyz,"+n+".xyz,"+h+".xyz\n";_+="dp3 "+h+".w,"+u+".xyz,"+i.scaleAndRotateTarget+".xyz\n";_+="neg "+n+".w,"+h+".w\n";_+="crs "+u+".xyz,"+n+".xyz,"+d+".xyz\n";_+="mul "+h+".xyzw,"+n+".xyzw,"+p+"\n";_+="add "+u+".xyz,"+u+".xyz,"+h+".xyz\n";_+="mul "+h+".xyz,"+n+".w,"+d+".xyz\n";_+="add "+i.scaleAndRotateTarget+".xyz,"+u+".xyz,"+h+".xyz\n";var m=i.rotationRegisters.length;for(var g=0;g<m;g++){_+="mov "+n+".xyz,"+a+".xyz\n";_+="mov "+n+".w,"+i.vertexZeroConst+"\n";_+="mul "+p+","+i.vertexTime+","+a+".w\n";_+="sin "+f+","+p+"\n";_+="cos "+p+","+p+"\n";_+="mul "+u+".xyz,"+f+","+n+".xyz\n";_+="mul "+d+".xyz,"+f+","+n+".xyz\n";_+="neg "+d+".xyz,"+d+".xyz\n";_+="crs "+n+".xyz,"+u+".xyz,"+i.rotationRegisters[g]+".xyz\n";_+="mul "+h+".xyz,"+p+","+i.rotationRegisters[g]+"\n";_+="add "+n+".xyz,"+n+".xyz,"+h+".xyz\n";_+="dp3 "+h+".w,"+u+".xyz,"+i.rotationRegisters[g]+"\n";_+="neg "+n+".w,"+h+".w\n";_+="crs "+u+".xyz,"+n+".xyz,"+d+".xyz\n";_+="mul "+h+".xyzw,"+n+".xyzw,"+p+"\n";_+="add "+u+".xyz,"+u+".xyz,"+h+".xyz\n";_+="mul "+h+".xyz,"+n+".w,"+d+".xyz\n";_+="add "+i.rotationRegisters[g]+","+u+".xyz,"+h+".xyz\n"}return _};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.ROTATIONALVELOCITY_VECTOR3D];if(!r)throw new Error("there is no "+t.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(r.length<=0)r.z=1;else r.normalize();this._pOneData[0]=r.x;this._pOneData[1]=r.y;this._pOneData[2]=r.z;if(r.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/r.w};t.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D";return t}(n.ParticleNodeBase);r.ParticleRotationalVelocityNode=h},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleRotationalVelocityState":"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/data/ParticlePropertiesMode");var s=e("../../animators/nodes/ParticleNodeBase");var n=e("../../animators/states/ParticleScaleState");var o=function(e){i(t,e);function t(t,r,i,a,s,o,l){if(a===void 0){a=1}if(s===void 0){s=1}if(o===void 0){o=1}if(l===void 0){l=0}e.call(this,"ParticleScale",t,r&&i?4:r||i?3:2,3);this._pStateClass=n.ParticleScaleState;this._iUsesCycle=r;this._iUsesPhase=i;this._iMinScale=a;this._iMaxScale=s;this._iCycleDuration=o;this._iCyclePhase=l}t.prototype.getAGALVertexCode=function(e,t,r,i){var s="";var o=r.getFreeVertexSingleTemp();var l=this._pMode==a.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,n.ParticleScaleState.SCALE_INDEX,l.index);if(this._iUsesCycle){s+="mul "+o+","+i.vertexTime+","+l+".z\n";if(this._iUsesPhase)s+="add "+o+","+o+","+l+".w\n";s+="sin "+o+","+o+"\n"}s+="mul "+o+","+l+".y,"+(this._iUsesCycle?o:i.vertexLife)+"\n";s+="add "+o+","+l+".x,"+o+"\n";s+="mul "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+o+"\n";return s};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.SCALE_VECTOR3D];if(!r)throw new Error("there is no "+t.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){this._pOneData[0]=(r.x+r.y)/2;this._pOneData[1]=Math.abs(r.x-r.y)/2;if(r.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=Math.PI*2/r.z;if(this._iUsesPhase)this._pOneData[3]=r.w*Math.PI/180}else{this._pOneData[0]=r.x;this._pOneData[1]=r.y-r.x}};t.SCALE_VECTOR3D="ScaleVector3D";return t}(s.ParticleNodeBase);r.ParticleScaleNode=o},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleScaleState":"awayjs-renderergl/lib/animators/states/ParticleScaleState"}],"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/ParticleAnimationSet");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleSegmentedColorState");var l=e("../../shaders/ShaderRegisterElement");var h=function(e){i(t,e);function t(t,r,i,n,l,h){e.call(this,"ParticleSegmentedColor",s.ParticlePropertiesMode.GLOBAL,0,a.ParticleAnimationSet.COLOR_PRIORITY);this._pStateClass=o.ParticleSegmentedColorState;if(i>4)throw new Error("the numSegmentPoint must be less or equal 4");this._iUsesMultiplier=t;this._iUsesOffset=r;this._iNumSegmentPoint=i;this._iStartColor=n;this._iEndColor=l;this._iSegmentPoints=h}t.prototype._iProcessAnimationSetting=function(e){if(this._iUsesMultiplier)e.hasColorMulNode=true;if(this._iUsesOffset)e.hasColorAddNode=true};t.prototype.getAGALVertexCode=function(e,t,r,i){var a="";if(e.usesFragmentAnimation){var s;if(this._iUsesMultiplier){s=r.getFreeVertexVectorTemp();r.addVertexTempUsages(s,1)}var n=r.getFreeVertexVectorTemp();r.addVertexTempUsages(n,1);var h=r.getFreeVertexVectorTemp();var c=new l.ShaderRegisterElement(h.regName,h.index,0);var u=new l.ShaderRegisterElement(h.regName,h.index,1);if(this._iUsesMultiplier)r.removeVertexTempUsage(s);r.removeVertexTempUsage(n);var d=r.getFreeVertexConstant();i.setRegisterIndex(this,o.ParticleSegmentedColorState.TIME_DATA_INDEX,d.index);var p;var f;var _;if(this._iUsesMultiplier){f=r.getFreeVertexConstant();i.setRegisterIndex(this,o.ParticleSegmentedColorState.START_MULTIPLIER_INDEX,f.index);_=new Array;for(p=0;p<this._iNumSegmentPoint+1;p++)_.push(r.getFreeVertexConstant())}var m;var g;if(this._iUsesOffset){m=r.getFreeVertexConstant();
i.setRegisterIndex(this,o.ParticleSegmentedColorState.START_OFFSET_INDEX,m.index);g=new Array;for(p=0;p<this._iNumSegmentPoint+1;p++)g.push(r.getFreeVertexConstant())}if(this._iUsesMultiplier)a+="mov "+s+","+f+"\n";if(this._iUsesOffset)a+="add "+i.colorAddTarget+","+i.colorAddTarget+","+m+"\n";for(p=0;p<this._iNumSegmentPoint;p++){switch(p){case 0:a+="min "+u+","+i.vertexLife+","+d+".x\n";break;case 1:a+="sub "+c+","+i.vertexLife+","+d+".x\n";a+="max "+u+","+c+","+i.vertexZeroConst+"\n";a+="min "+u+","+u+","+d+".y\n";break;case 2:a+="sub "+c+","+c+","+d+".y\n";a+="max "+u+","+c+","+i.vertexZeroConst+"\n";a+="min "+u+","+u+","+d+".z\n";break;case 3:a+="sub "+c+","+c+","+d+".z\n";a+="max "+u+","+c+","+i.vertexZeroConst+"\n";a+="min "+u+","+u+","+d+".w\n";break}if(this._iUsesMultiplier){a+="mul "+n+","+u+","+_[p]+"\n";a+="add "+s+","+s+","+n+"\n"}if(this._iUsesOffset){a+="mul "+n+","+u+","+g[p]+"\n";a+="add "+i.colorAddTarget+","+i.colorAddTarget+","+n+"\n"}}if(this._iNumSegmentPoint==0)u=i.vertexLife;else{switch(this._iNumSegmentPoint){case 1:a+="sub "+c+","+i.vertexLife+","+d+".x\n";break;case 2:a+="sub "+c+","+c+","+d+".y\n";break;case 3:a+="sub "+c+","+c+","+d+".z\n";break;case 4:a+="sub "+c+","+c+","+d+".w\n";break}a+="max "+u+","+c+","+i.vertexZeroConst+"\n"}if(this._iUsesMultiplier){a+="mul "+n+","+u+","+_[this._iNumSegmentPoint]+"\n";a+="add "+s+","+s+","+n+"\n";a+="mul "+i.colorMulTarget+","+i.colorMulTarget+","+s+"\n"}if(this._iUsesOffset){a+="mul "+n+","+u+","+g[this._iNumSegmentPoint]+"\n";a+="add "+i.colorAddTarget+","+i.colorAddTarget+","+n+"\n"}}return a};return t}(n.ParticleNodeBase);r.ParticleSegmentedColorNode=h},{"../../animators/ParticleAnimationSet":"awayjs-renderergl/lib/animators/ParticleAnimationSet","../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleSegmentedColorState":"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement"}],"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/ParticleAnimationSet");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleSpriteSheetState");var l=e("../../shaders/ShaderRegisterElement");var h=function(e){i(t,e);function t(t,r,i,s,n,l,h,c){if(s===void 0){s=1}if(n===void 0){n=1}if(l===void 0){l=1}if(h===void 0){h=0}if(c===void 0){c=Number.MAX_VALUE}e.call(this,"ParticleSpriteSheet",t,r?i?3:2:1,a.ParticleAnimationSet.POST_PRIORITY+1);this._pStateClass=o.ParticleSpriteSheetState;this._iUsesCycle=r;this._iUsesPhase=i;this._iNumColumns=s;this._iNumRows=n;this._iCyclePhase=h;this._iCycleDuration=l;this._iTotalFrames=Math.min(c,s*n)}Object.defineProperty(t.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalFrames",{get:function(){return this._iTotalFrames},enumerable:true,configurable:true});t.prototype.getAGALUVCode=function(e,t,r,i){var a=r.getFreeVertexConstant();var n=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleSpriteSheetState.UV_INDEX_0,a.index);i.setRegisterIndex(this,o.ParticleSpriteSheetState.UV_INDEX_1,n.index);var h=new l.ShaderRegisterElement(a.regName,a.index,0);var c=new l.ShaderRegisterElement(a.regName,a.index,1);var u=new l.ShaderRegisterElement(a.regName,a.index,2);var d=new l.ShaderRegisterElement(n.regName,n.index,0);var p=new l.ShaderRegisterElement(n.regName,n.index,1);var f=new l.ShaderRegisterElement(n.regName,n.index,2);var _=r.getFreeVertexVectorTemp();var m=new l.ShaderRegisterElement(_.regName,_.index,0);var g=new l.ShaderRegisterElement(_.regName,_.index,1);_=new l.ShaderRegisterElement(_.regName,_.index,2);var y=new l.ShaderRegisterElement(_.regName,_.index,3);var v=new l.ShaderRegisterElement(i.uvTarget.regName,i.uvTarget.index,0);var x=new l.ShaderRegisterElement(i.uvTarget.regName,i.uvTarget.index,1);var b="";b+="mul "+v+","+v+","+c+"\n";if(this._iNumRows>1)b+="mul "+x+","+x+","+u+"\n";if(this._iUsesCycle){if(this._iUsesPhase)b+="add "+m+","+i.vertexTime+","+f+"\n";else b+="mov "+m+","+i.vertexTime+"\n";b+="div "+m+","+m+","+p+"\n";b+="frc "+m+","+m+"\n";b+="mul "+m+","+m+","+p+"\n";b+="mul "+_+","+m+","+d+"\n"}else b+="mul "+_.toString()+","+i.vertexLife+","+h+"\n";if(this._iNumRows>1){b+="frc "+y+","+_+"\n";b+="sub "+g+","+_+","+y+"\n";b+="mul "+g+","+g+","+u+"\n";b+="add "+x+","+x+","+g+"\n"}b+="div "+y+","+_+","+c+"\n";b+="frc "+_+","+y+"\n";b+="sub "+y+","+y+","+_+"\n";b+="mul "+_+","+y+","+c+"\n";if(this._iNumRows>1)b+="frc "+_+","+_+"\n";b+="add "+v+","+v+","+_+"\n";return b};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=true};t.prototype._iGeneratePropertyOfOneParticle=function(e){if(this._iUsesCycle){var r=e[t.UV_VECTOR3D];if(!r)throw new Error("there is no "+t.UV_VECTOR3D+" in param!");if(r.x<=0)throw new Error("the cycle duration must be greater than zero");var i=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=i/r.x;this._pOneData[1]=r.x;if(this._iUsesPhase)this._pOneData[2]=r.y}};t.UV_VECTOR3D="UVVector3D";return t}(n.ParticleNodeBase);r.ParticleSpriteSheetNode=h},{"../../animators/ParticleAnimationSet":"awayjs-renderergl/lib/animators/ParticleAnimationSet","../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleSpriteSheetState":"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement"}],"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/data/ParticlePropertiesMode");var s=e("../../animators/nodes/ParticleNodeBase");var n=e("../../animators/states/ParticleTimeState");var o=function(e){i(t,e);function t(t,r,i){if(t===void 0){t=false}if(r===void 0){r=false}if(i===void 0){i=false}e.call(this,"ParticleTime",a.ParticlePropertiesMode.LOCAL_STATIC,4,0);this._pStateClass=n.ParticleTimeState;this._iUsesDuration=t;this._iUsesLooping=r;this._iUsesDelay=i}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=r.getFreeVertexAttribute();i.setRegisterIndex(this,n.ParticleTimeState.TIME_STREAM_INDEX,a.index);var s=r.getFreeVertexConstant();i.setRegisterIndex(this,n.ParticleTimeState.TIME_CONSTANT_INDEX,s.index);var o="";o+="sub "+i.vertexTime+","+s+","+a+".x\n";var l=r.getFreeVertexSingleTemp();o+="sge "+l+","+i.vertexTime+","+i.vertexZeroConst+"\n";o+="mul "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+l+"\n";if(this._iUsesDuration){if(this._iUsesLooping){var h=r.getFreeVertexSingleTemp();if(this._iUsesDelay){o+="div "+h+","+i.vertexTime+","+a+".z\n";o+="frc "+h+","+h+"\n";o+="mul "+i.vertexTime+","+h+","+a+".z\n";o+="slt "+h+","+i.vertexTime+","+a+".y\n";o+="mul "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+h+"\n"}else{o+="mul "+h+","+i.vertexTime+","+a+".w\n";o+="frc "+h+","+h+"\n";o+="mul "+i.vertexTime+","+h+","+a+".y\n"}}else{var c=r.getFreeVertexSingleTemp();o+="sge "+c+","+a+".y,"+i.vertexTime+"\n";o+="mul "+i.scaleAndRotateTarget+".xyz,"+i.scaleAndRotateTarget+".xyz,"+c+"\n"}}o+="mul "+i.vertexLife+","+i.vertexTime+","+a+".w\n";return o};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){this._pOneData[0]=e.startTime;this._pOneData[1]=e.duration;this._pOneData[2]=e.delay+e.duration;this._pOneData[3]=1/e.duration};return t}(s.ParticleNodeBase);r.ParticleTimeNode=o},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleTimeState":"awayjs-renderergl/lib/animators/states/ParticleTimeState"}],"awayjs-renderergl/lib/animators/nodes/ParticleUVNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/ParticleAnimationSet");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/nodes/ParticleNodeBase");var l=e("../../animators/states/ParticleUVState");var h=e("../../shaders/ShaderRegisterElement");var c=function(e){i(t,e);function t(t,r,i,a){if(r===void 0){r=1}if(i===void 0){i=1}if(a===void 0){a="x"}e.call(this,"ParticleUV",n.ParticlePropertiesMode.GLOBAL,4,s.ParticleAnimationSet.POST_PRIORITY+1);this._pStateClass=l.ParticleUVState;this._cycle=r;this._scale=i;this._axis=a;this.updateUVData()}Object.defineProperty(t.prototype,"cycle",{get:function(){return this._cycle},set:function(e){this._cycle=e;this.updateUVData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e;this.updateUVData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"axis",{get:function(){return this._axis},set:function(e){this._axis=e},enumerable:true,configurable:true});t.prototype.getAGALUVCode=function(e,t,r,i){var a="";var s=r.getFreeVertexConstant();i.setRegisterIndex(this,l.ParticleUVState.UV_INDEX,s.index);var n=this._axis=="x"?0:this._axis=="y"?1:2;var o=new h.ShaderRegisterElement(i.uvTarget.regName,i.uvTarget.index,n);var c=r.getFreeVertexSingleTemp();if(this._scale!=1)a+="mul "+o+","+o+","+s+".y\n";a+="mul "+c+","+i.vertexTime+","+s+".x\n";a+="sin "+c+","+c+"\n";a+="add "+o+","+o+","+c+"\n";return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype.updateUVData=function(){this._iUvData=new a.Vector3D(Math.PI*2/this._cycle,this._scale,0,0)};t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=true};t.U_AXIS="x";t.V_AXIS="y";return t}(o.ParticleNodeBase);r.ParticleUVNode=c},{"../../animators/ParticleAnimationSet":"awayjs-renderergl/lib/animators/ParticleAnimationSet","../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleUVState":"awayjs-renderergl/lib/animators/states/ParticleUVState","../../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/nodes/ParticleNodeBase");var o=e("../../animators/states/ParticleVelocityState");var l=function(e){i(t,e);function t(t,r){if(r===void 0){r=null}e.call(this,"ParticleVelocity",t,3);this._pStateClass=o.ParticleVelocityState;this._iVelocity=r||new a.Vector3D}t.prototype.getAGALVertexCode=function(e,t,r,i){var a=this._pMode==s.ParticlePropertiesMode.GLOBAL?r.getFreeVertexConstant():r.getFreeVertexAttribute();i.setRegisterIndex(this,o.ParticleVelocityState.VELOCITY_INDEX,a.index);var n=r.getFreeVertexVectorTemp();var l="";l+="mul "+n+","+i.vertexTime+","+a+"\n";l+="add "+i.positionTarget+".xyz,"+n+","+i.positionTarget+".xyz\n";if(t.needVelocity)l+="add "+i.velocityTarget+".xyz,"+a+".xyz,"+i.velocityTarget+".xyz\n";return l};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var r=e[t.VELOCITY_VECTOR3D];if(!r)throw new Error("there is no "+t.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=r.x;this._pOneData[1]=r.y;this._pOneData[2]=r.z};t.VELOCITY_VECTOR3D="VelocityVector3D";return t}(n.ParticleNodeBase);r.ParticleVelocityNode=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","../../animators/states/ParticleVelocityState":"awayjs-renderergl/lib/animators/states/ParticleVelocityState","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var s=e("../../animators/states/SkeletonBinaryLERPState");var n=function(e){i(t,e);function t(){e.call(this);this._pStateClass=s.SkeletonBinaryLERPState}t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a.AnimationNodeBase);r.SkeletonBinaryLERPNode=n},{"../../animators/states/SkeletonBinaryLERPState":"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState","awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/nodes/AnimationClipNodeBase");var s=e("../../animators/states/SkeletonClipState");var n=function(e){i(t,e);function t(){e.call(this);this._frames=new Array;this.highQuality=false;this._pStateClass=s.SkeletonClipState}Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:true,configurable:true});t.prototype.addFrame=function(e,t){this._frames.push(e);this._pDurations.push(t);this._pNumFrames=this._pDurations.length;this._pStitchDirty=true};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);var t=this._pNumFrames-1;var r,i,a;while(t--){this._pTotalDuration+=this._pDurations[t];r=this._frames[t].jointPoses[0].translation;i=this._frames[t+1].jointPoses[0].translation;a=i.subtract(r);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}if(this._pStitchFinalFrame||!this._pLooping){this._pTotalDuration+=this._pDurations[this._pNumFrames-1];r=this._frames[0].jointPoses[0].translation;i=this._frames[1].jointPoses[0].translation;a=i.subtract(r);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}};return t}(a.AnimationClipNodeBase);r.SkeletonClipNode=n},{"../../animators/nodes/AnimationClipNodeBase":"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase","../../animators/states/SkeletonClipState":"awayjs-renderergl/lib/animators/states/SkeletonClipState"}],"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var s=e("../../animators/states/SkeletonDifferenceState");var n=function(e){i(t,e);function t(){e.call(this);this._pStateClass=s.SkeletonDifferenceState}t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a.AnimationNodeBase);r.SkeletonDifferenceNode=n;Object.defineProperty(r,"__esModule",{value:true});r.default=n},{"../../animators/states/SkeletonDifferenceState":"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState","awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var s=e("../../animators/states/SkeletonDirectionalState");var n=function(e){i(t,e);function t(){e.call(this);this._pStateClass=s.SkeletonDirectionalState}t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a.AnimationNodeBase);r.SkeletonDirectionalNode=n},{"../../animators/states/SkeletonDirectionalState":"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState","awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var s=e("../../animators/states/SkeletonNaryLERPState");var n=function(e){i(t,e);function t(){e.call(this);this._iInputs=new Array;this._pStateClass=s.SkeletonNaryLERPState}Object.defineProperty(t.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:true,configurable:true});t.prototype.getInputIndex=function(e){return this._iInputs.indexOf(e)};t.prototype.getInputAt=function(e){return this._iInputs[e]};t.prototype.addInput=function(e){this._iInputs[this._numInputs++]=e};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a.AnimationNodeBase);r.SkeletonNaryLERPNode=n;Object.defineProperty(r,"__esModule",{value:true});r.default=n},{"../../animators/states/SkeletonNaryLERPState":"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState","awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/VertexClipNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/nodes/AnimationClipNodeBase");var n=e("../../animators/states/VertexClipState");var o=function(e){i(t,e);function t(){e.call(this);this._frames=new Array;this._translations=new Array;this._pStateClass=n.VertexClipState}Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:true,configurable:true});t.prototype.addFrame=function(e,t,r){if(r===void 0){r=null}this._frames.push(e);this._pDurations.push(t);this._translations.push(r||new a.Vector3D);this._pNumFrames=this._pDurations.length;this._pStitchDirty=true};t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);var t=this._pNumFrames-1;var r,i,a;while(t--){this._pTotalDuration+=this._pDurations[t];r=this._translations[t];i=this._translations[t+1];a=i.subtract(r);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}if(this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)){this._pTotalDuration+=this._pDurations[this._pNumFrames-1];r=this._translations[0];i=this._translations[1];a=i.subtract(r);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}};return t}(s.AnimationClipNodeBase);r.VertexClipNode=o},{"../../animators/nodes/AnimationClipNodeBase":"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase","../../animators/states/VertexClipState":"awayjs-renderergl/lib/animators/states/VertexClipState","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/states/AnimationClipState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/states/AnimationStateBase");var s=e("../../events/AnimationStateEvent");var n=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._pFramesDirty=true;this._animationClipNode=r}Object.defineProperty(t.prototype,"blendWeight",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pBlendWeight},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentFrame",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pCurrentFrame},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"nextFrame",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pNextFrame},enumerable:true,configurable:true});t.prototype.update=function(e){if(!this._animationClipNode.looping){if(e>this._pStartTime+this._animationClipNode.totalDuration)e=this._pStartTime+this._animationClipNode.totalDuration;else if(e<this._pStartTime)e=this._pStartTime}if(this._pTime==e-this._pStartTime)return;this._pUpdateTime(e)};t.prototype.phase=function(e){var t=e*this._animationClipNode.totalDuration+this._pStartTime;if(this._pTime==t-this._pStartTime)return;this._pUpdateTime(t)};t.prototype._pUpdateTime=function(t){this._pFramesDirty=true;this._pTimeDir=t-this._pStartTime>this._pTime?1:-1;e.prototype._pUpdateTime.call(this,t)};t.prototype._pUpdateFrames=function(){this._pFramesDirty=false;var e=this._animationClipNode.looping;var t=this._animationClipNode.totalDuration;var r=this._animationClipNode.lastFrame;var i=this._pTime;if(e&&(i>=t||i<0)){i%=t;if(i<0)i+=t}if(!e&&i>=t){this.notifyPlaybackComplete();this._pCurrentFrame=r;this._pNextFrame=r;this._pBlendWeight=0}else if(!e&&i<=0){this._pCurrentFrame=0;this._pNextFrame=0;this._pBlendWeight=0}else if(this._animationClipNode.fixedFrameRate){var a=i/t*r;this._pCurrentFrame=Math.floor(a);this._pBlendWeight=a-this._pCurrentFrame;this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0;this._pNextFrame=0;var s=0,n;var o=this._animationClipNode.durations;do{n=s;s+=o[this._pNextFrame];this._pCurrentFrame=this._pNextFrame++}while(i>s);if(this._pCurrentFrame==r){this._pCurrentFrame=0;this._pNextFrame=1}this._pBlendWeight=(i-n)/o[this._pCurrentFrame]}};t.prototype.notifyPlaybackComplete=function(){if(this._animationStatePlaybackComplete==null)this._animationStatePlaybackComplete=new s.AnimationStateEvent(s.AnimationStateEvent.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode);this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)};return t}(a.AnimationStateBase);r.AnimationClipState=n},{"../../animators/states/AnimationStateBase":"awayjs-renderergl/lib/animators/states/AnimationStateBase","../../events/AnimationStateEvent":"awayjs-renderergl/lib/events/AnimationStateEvent"}],"awayjs-renderergl/lib/animators/states/AnimationStateBase":[function(e,t,r){"use strict";var i=e("awayjs-core/lib/geom/Vector3D");var a=function(){function e(e,t){this._pRootDelta=new i.Vector3D;this._pPositionDeltaDirty=true;this._pStartTime=0;this._pAnimator=e;this._pAnimationNode=t}Object.defineProperty(e.prototype,"positionDelta",{get:function(){if(this._pPositionDeltaDirty){this._pUpdatePositionDelta()}return this._pRootDelta},enumerable:true,configurable:true});e.prototype.offset=function(e){this._pStartTime=e;this._pPositionDeltaDirty=true};e.prototype.update=function(e){if(this._pTime==e-this._pStartTime){return}this._pUpdateTime(e)};e.prototype.phase=function(e){};e.prototype._pUpdateTime=function(e){this._pTime=e-this._pStartTime;this._pPositionDeltaDirty=true};e.prototype._pUpdatePositionDelta=function(){};return e}();r.AnimationStateBase=a},{"awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/states/IAnimationState":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/animators/states/IVertexAnimationState":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleAccelerationNode=r;this._acceleration=this._particleAccelerationNode._acceleration;this.updateAccelerationData()}Object.defineProperty(t.prototype,"acceleration",{get:function(){return this._acceleration},set:function(e){this._acceleration.x=e.x;this._acceleration.y=e.y;this._acceleration.z=e.z;this.updateAccelerationData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,o,l){var h=a.getRegisterIndex(this._pAnimationNode,t.ACCELERATION_INDEX);if(this._particleAccelerationNode.mode==n.ParticlePropertiesMode.LOCAL_STATIC)i.activateVertexBuffer(h,this._particleAccelerationNode._iDataOffset,l,s.ContextGLVertexBufferFormat.FLOAT_3);else e.setVertexConst(h,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)};t.prototype.updateAccelerationData=function(){if(this._particleAccelerationNode.mode==n.ParticlePropertiesMode.GLOBAL)this._halfAcceleration=new a.Vector3D(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2)};t.ACCELERATION_INDEX=0;return t}(o.ParticleStateBase);r.ParticleAccelerationState=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/states/ParticleStateBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleBezierCurveNode=r;this._controlPoint=this._particleBezierCurveNode._iControlPoint;this._endPoint=this._particleBezierCurveNode._iEndPoint}Object.defineProperty(t.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(e){this._controlPoint=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endPoint",{get:function(){return this._endPoint},set:function(e){this._endPoint=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,n,o,l){var h=n.getRegisterIndex(this._pAnimationNode,t.BEZIER_CONTROL_INDEX);var c=n.getRegisterIndex(this._pAnimationNode,t.BEZIER_END_INDEX);if(this._particleBezierCurveNode.mode==s.ParticlePropertiesMode.LOCAL_STATIC){i.activateVertexBuffer(h,this._particleBezierCurveNode._iDataOffset,l,a.ContextGLVertexBufferFormat.FLOAT_3);i.activateVertexBuffer(c,this._particleBezierCurveNode._iDataOffset+3,l,a.ContextGLVertexBufferFormat.FLOAT_3)}else{e.setVertexConst(h,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z);e.setVertexConst(c,this._endPoint.x,this._endPoint.y,this._endPoint.z)}};t.BEZIER_CONTROL_INDEX=0;t.BEZIER_END_INDEX=1;return t}(n.ParticleStateBase);r.ParticleBezierCurveState=o},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleBillboardState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/MathConsts");var s=e("awayjs-core/lib/geom/Matrix3D");var n=e("awayjs-core/lib/geom/Orientation3D");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._matrix=new s.Matrix3D;this._billboardAxis=r._iBillboardAxis}t.prototype.setRenderState=function(e,r,i,s,o,l){var h;if(this._billboardAxis){var c=r.sourceEntity.sceneTransform.position;var u=o.sceneTransform.position.subtract(c);var d=u.crossProduct(this._billboardAxis);d.normalize();u=this.billboardAxis.crossProduct(d);u.normalize();this._matrix.copyFrom(r.sourceEntity.sceneTransform);h=this._matrix.decompose(n.Orientation3D.AXIS_ANGLE);this._matrix.copyColumnFrom(0,d);this._matrix.copyColumnFrom(1,this.billboardAxis);this._matrix.copyColumnFrom(2,u);this._matrix.copyColumnFrom(3,c);this._matrix.appendRotation(-h[1].w*a.MathConsts.RADIANS_TO_DEGREES,h[1])}else{this._matrix.copyFrom(r.sourceEntity.sceneTransform);this._matrix.append(o.inverseSceneTransform);h=this._matrix.decompose(n.Orientation3D.AXIS_ANGLE);this._matrix.identity();this._matrix.appendRotation(-h[1].w*a.MathConsts.RADIANS_TO_DEGREES,h[1])}e.setVertexConstFromMatrix(s.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)};Object.defineProperty(t.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(e){this.billboardAxis=e?e.clone():null;if(this.billboardAxis)this.billboardAxis.normalize()},enumerable:true,configurable:true});t.MATRIX_INDEX=0;return t}(o.ParticleStateBase);r.ParticleBillboardState=l},{"../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/MathConsts":undefined,"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Orientation3D":undefined}],"awayjs-renderergl/lib/animators/states/ParticleColorState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleColorNode=r;this._usesMultiplier=this._particleColorNode._iUsesMultiplier;this._usesOffset=this._particleColorNode._iUsesOffset;this._usesCycle=this._particleColorNode._iUsesCycle;this._usesPhase=this._particleColorNode._iUsesPhase;this._startColor=this._particleColorNode._iStartColor;this._endColor=this._particleColorNode._iEndColor;this._cycleDuration=this._particleColorNode._iCycleDuration;
this._cyclePhase=this._particleColorNode._iCyclePhase;this.updateColorData()}Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateColorData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,o,l){if(e.usesFragmentAnimation){var h=this._particleColorNode._iDataOffset;var c;if(this._usesCycle)e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w);if(this._usesMultiplier){if(this._particleColorNode.mode==n.ParticlePropertiesMode.LOCAL_STATIC){i.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),h,l,s.ContextGLVertexBufferFormat.FLOAT_4);h+=4;i.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),h,l,s.ContextGLVertexBufferFormat.FLOAT_4);h+=4}else{e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w);e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w)}}if(this._usesOffset){if(this._particleColorNode.mode==n.ParticlePropertiesMode.LOCAL_STATIC){i.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),h,l,s.ContextGLVertexBufferFormat.FLOAT_4);h+=4;i.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),h,l,s.ContextGLVertexBufferFormat.FLOAT_4)}else{e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w);e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)}}}};t.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new a.Vector3D(Math.PI*2/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}if(this._particleColorNode.mode==n.ParticlePropertiesMode.GLOBAL){if(this._usesCycle){if(this._usesMultiplier){this._startMultiplierData=new a.Vector3D((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2);this._deltaMultiplierData=new a.Vector3D((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)}if(this._usesOffset){this._startOffsetData=new a.Vector3D((this._startColor.redOffset+this._endColor.redOffset)/(255*2),(this._startColor.greenOffset+this._endColor.greenOffset)/(255*2),(this._startColor.blueOffset+this._endColor.blueOffset)/(255*2),(this._startColor.alphaOffset+this._endColor.alphaOffset)/(255*2));this._deltaOffsetData=new a.Vector3D((this._endColor.redOffset-this._startColor.redOffset)/(255*2),(this._endColor.greenOffset-this._startColor.greenOffset)/(255*2),(this._endColor.blueOffset-this._startColor.blueOffset)/(255*2),(this._endColor.alphaOffset-this._startColor.alphaOffset)/(255*2))}}else{if(this._usesMultiplier){this._startMultiplierData=new a.Vector3D(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier);this._deltaMultiplierData=new a.Vector3D(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)}if(this._usesOffset){this._startOffsetData=new a.Vector3D(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255);this._deltaOffsetData=new a.Vector3D((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255)}}}};t.START_MULTIPLIER_INDEX=0;t.DELTA_MULTIPLIER_INDEX=1;t.START_OFFSET_INDEX=2;t.DELTA_OFFSET_INDEX=3;t.CYCLE_INDEX=4;return t}(o.ParticleStateBase);r.ParticleColorState=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleFollowState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/MathConsts");var s=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r,true);this._targetPos=new s.Vector3D;this._targetEuler=new s.Vector3D;this._temp=new s.Vector3D;this._particleFollowNode=r;this._smooth=r._iSmooth}Object.defineProperty(t.prototype,"followTarget",{get:function(){return this._followTarget},set:function(e){this._followTarget=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"smooth",{get:function(){return this._smooth},set:function(e){this._smooth=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,s,o,l){if(this._followTarget){if(this._particleFollowNode._iUsesPosition){this._targetPos.x=this._followTarget.transform.position.x/r.sourceEntity.scaleX;this._targetPos.y=this._followTarget.transform.position.y/r.sourceEntity.scaleY;this._targetPos.z=this._followTarget.transform.position.z/r.sourceEntity.scaleZ}if(this._particleFollowNode._iUsesRotation){this._targetEuler.x=this._followTarget.rotationX;this._targetEuler.y=this._followTarget.rotationY;this._targetEuler.z=this._followTarget.rotationZ;this._targetEuler.scaleBy(a.MathConsts.DEGREES_TO_RADIANS)}}if(!this._prePos)this._prePos=this._targetPos.clone();if(!this._preEuler)this._preEuler=this._targetEuler.clone();var h=this._pTime/1e3;var c=i.previousTime;var u=h-c;var d=c!=h;if(this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation){if(d)this.processPositionAndRotation(h,u,i);i.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,l,n.ContextGLVertexBufferFormat.FLOAT_3);i.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,l,n.ContextGLVertexBufferFormat.FLOAT_3)}else if(this._particleFollowNode._iUsesPosition){if(d)this.processPosition(h,u,i);i.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,l,n.ContextGLVertexBufferFormat.FLOAT_3)}else if(this._particleFollowNode._iUsesRotation){if(d)this.precessRotation(h,u,i);i.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,l,n.ContextGLVertexBufferFormat.FLOAT_3)}this._prePos.copyFrom(this._targetPos);this._targetEuler.copyFrom(this._targetEuler);i.previousTime=h};t.prototype.processPosition=function(e,t,r){var i=r.animationParticles;var a=r.vertexData;var s=false;var n=i.length;var o;var l;if(this._smooth){l=this._prePos.subtract(this._targetPos);l.scaleBy(1/t)}else o=this._targetPos;for(var h=0;h<n;h++){var c=(e-i[h].startTime)/i[h].totalTime;var u=(c-Math.floor(c))*i[h].totalTime;if(u-t<=0){var d=i[h].startVertexIndex*r.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(l);this._temp.scaleBy(u);o=this._targetPos.add(this._temp)}if(a[d]!=o.x||a[d+1]!=o.y||a[d+2]!=o.z){s=true;for(var p=0;p<i[h].numVertices;p++){a[d++]=o.x;a[d++]=o.y;a[d++]=o.z}}}}if(s)r.invalidateBuffer()};t.prototype.precessRotation=function(e,t,r){var i=r.animationParticles;var a=r.vertexData;var s=false;var n=i.length;var o;var l;if(this._smooth){l=this._preEuler.subtract(this._targetEuler);l.scaleBy(1/t)}else o=this._targetEuler;for(var h=0;h<n;h++){var c=(e-i[h].startTime)/i[h].totalTime;var u=(c-Math.floor(c))*i[h].totalTime;if(u-t<=0){var d=i[h].startVertexIndex*r.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(l);this._temp.scaleBy(u);o=this._targetEuler.add(this._temp)}if(a[d]!=o.x||a[d+1]!=o.y||a[d+2]!=o.z){s=true;for(var p=0;p<i[h].numVertices;p++){a[d++]=o.x;a[d++]=o.y;a[d++]=o.z}}}}if(s)r.invalidateBuffer()};t.prototype.processPositionAndRotation=function(e,t,r){var i=r.animationParticles;var a=r.vertexData;var s=false;var n=i.length;var o;var l;var h;var c;if(this._smooth){h=this._prePos.subtract(this._targetPos);h.scaleBy(1/t);c=this._preEuler.subtract(this._targetEuler);c.scaleBy(1/t)}else{o=this._targetPos;l=this._targetEuler}for(var u=0;u<n;u++){var d=(e-i[u].startTime)/i[u].totalTime;var p=(d-Math.floor(d))*i[u].totalTime;if(p-t<=0){var f=i[u].startVertexIndex*r.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(h);this._temp.scaleBy(p);o=this._targetPos.add(this._temp);this._temp.copyFrom(c);this._temp.scaleBy(p);l=this._targetEuler.add(this._temp)}if(a[f]!=o.x||a[f+1]!=o.y||a[f+2]!=o.z||a[f+3]!=l.x||a[f+4]!=l.y||a[f+5]!=l.z){s=true;for(var _=0;_<i[u].numVertices;_++){a[f++]=o.x;a[f++]=o.y;a[f++]=o.z;a[f++]=l.x;a[f++]=l.y;a[f++]=l.z}}}}if(s)r.invalidateBuffer()};t.FOLLOW_POSITION_INDEX=0;t.FOLLOW_ROTATION_INDEX=1;return t}(o.ParticleStateBase);r.ParticleFollowState=l},{"../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/MathConsts":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleInitialColorNode=r;this._usesMultiplier=r._iUsesMultiplier;this._usesOffset=r._iUsesOffset;this._initialColor=r._iInitialColor;this.updateColorData()}Object.defineProperty(t.prototype,"initialColor",{get:function(){return this._initialColor},set:function(e){this._initialColor=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,o,l){if(e.usesFragmentAnimation){var h;if(this._particleInitialColorNode.mode==n.ParticlePropertiesMode.LOCAL_STATIC){var c=this._particleInitialColorNode._iDataOffset;if(this._usesMultiplier){i.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),c,l,s.ContextGLVertexBufferFormat.FLOAT_4);c+=4}if(this._usesOffset)i.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),c,l,s.ContextGLVertexBufferFormat.FLOAT_4)}else{if(this._usesMultiplier)e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w);if(this._usesOffset)e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)}}};t.prototype.updateColorData=function(){if(this._particleInitialColorNode.mode==n.ParticlePropertiesMode.GLOBAL){if(this._usesMultiplier)this._multiplierData=new a.Vector3D(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier);if(this._usesOffset)this._offsetData=new a.Vector3D(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)}};t.MULTIPLIER_INDEX=0;t.OFFSET_INDEX=1;return t}(o.ParticleStateBase);r.ParticleInitialColorState=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleOrbitState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3D");var s=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var o=e("../../animators/data/ParticlePropertiesMode");var l=e("../../animators/states/ParticleStateBase");var h=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleOrbitNode=r;this._usesEulers=this._particleOrbitNode._iUsesEulers;this._usesCycle=this._particleOrbitNode._iUsesCycle;this._usesPhase=this._particleOrbitNode._iUsesPhase;this._eulers=this._particleOrbitNode._iEulers;this._radius=this._particleOrbitNode._iRadius;this._cycleDuration=this._particleOrbitNode._iCycleDuration;this._cyclePhase=this._particleOrbitNode._iCyclePhase;this.updateOrbitData()}Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"eulers",{get:function(){return this._eulers},set:function(e){this._eulers=e;this.updateOrbitData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,s,l){var h=a.getRegisterIndex(this._pAnimationNode,t.ORBIT_INDEX);if(this._particleOrbitNode.mode==o.ParticlePropertiesMode.LOCAL_STATIC){if(this._usesPhase)i.activateVertexBuffer(h,this._particleOrbitNode._iDataOffset,l,n.ContextGLVertexBufferFormat.FLOAT_4);else i.activateVertexBuffer(h,this._particleOrbitNode._iDataOffset,l,n.ContextGLVertexBufferFormat.FLOAT_3)}else e.setVertexConst(h,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w);if(this._usesEulers)e.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.EULERS_INDEX),this._eulersMatrix)};t.prototype.updateOrbitData=function(){if(this._usesEulers){this._eulersMatrix=new a.Matrix3D;this._eulersMatrix.appendRotation(this._eulers.x,s.Vector3D.X_AXIS);this._eulersMatrix.appendRotation(this._eulers.y,s.Vector3D.Y_AXIS);this._eulersMatrix.appendRotation(this._eulers.z,s.Vector3D.Z_AXIS)}if(this._particleOrbitNode.mode==o.ParticlePropertiesMode.GLOBAL){this._orbitData=new s.Vector3D(this._radius,0,this._radius*Math.PI*2,this._cyclePhase*Math.PI/180);if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=Math.PI*2/this._cycleDuration}else this._orbitData.y=Math.PI*2}};t.ORBIT_INDEX=0;t.EULERS_INDEX=1;return t}(l.ParticleStateBase);r.ParticleOrbitState=h},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleOscillatorNode=r;this._oscillator=this._particleOscillatorNode._iOscillator;this.updateOscillatorData()}Object.defineProperty(t.prototype,"oscillator",{get:function(){return this._oscillator},set:function(e){this._oscillator=e;this.updateOscillatorData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,o,l){var h=a.getRegisterIndex(this._pAnimationNode,t.OSCILLATOR_INDEX);if(this._particleOscillatorNode.mode==n.ParticlePropertiesMode.LOCAL_STATIC)i.activateVertexBuffer(h,this._particleOscillatorNode._iDataOffset,l,s.ContextGLVertexBufferFormat.FLOAT_4);else e.setVertexConst(h,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)};t.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==n.ParticlePropertiesMode.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");if(this._oscillatorData==null)this._oscillatorData=new a.Vector3D;this._oscillatorData.x=this._oscillator.x;this._oscillatorData.y=this._oscillator.y;this._oscillatorData.z=this._oscillator.z;this._oscillatorData.w=Math.PI*2/this._oscillator.w}};t.OSCILLATOR_INDEX=0;return t}(o.ParticleStateBase);r.ParticleOscillatorState=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticlePositionState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/states/ParticleStateBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particlePositionNode=r;this._position=this._particlePositionNode._iPosition}Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:true,configurable:true});t.prototype.getPositions=function(){return this._pDynamicProperties};t.prototype.setPositions=function(e){this._pDynamicProperties=e;this._pDynamicPropertiesDirty=new Object};t.prototype.setRenderState=function(e,r,i,n,o,l){if(this._particlePositionNode.mode==s.ParticlePropertiesMode.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[i._iUniqueId])this._pUpdateDynamicProperties(i);var h=n.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);if(this._particlePositionNode.mode==s.ParticlePropertiesMode.GLOBAL)e.setVertexConst(h,this._position.x,this._position.y,this._position.z);else i.activateVertexBuffer(h,this._particlePositionNode._iDataOffset,l,a.ContextGLVertexBufferFormat.FLOAT_3)};t.POSITION_INDEX=0;return t}(n.ParticleStateBase);r.ParticlePositionState=o},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3D");var s=e("../../animators/states/ParticleStateBase");var n=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._matrix=new a.Matrix3D}t.prototype.setRenderState=function(e,r,i,a,s,n){if(this._pParticleAnimator.animationSet.hasBillboard){this._matrix.copyFrom(r.sourceEntity.sceneTransform);this._matrix.append(s.inverseSceneTransform);e.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)}};t.MATRIX_INDEX=0;return t}(s.ParticleStateBase);r.ParticleRotateToHeadingState=n},{"../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Matrix3D":undefined}],"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._matrix=new a.Matrix3D;this._particleRotateToPositionNode=r;this._position=this._particleRotateToPositionNode._iPosition}Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,o,l){var h=a.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);if(this._pParticleAnimator.animationSet.hasBillboard){this._matrix.copyFrom(r.sourceEntity.sceneTransform);this._matrix.append(o.inverseSceneTransform);e.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)}if(this._particleRotateToPositionNode.mode==n.ParticlePropertiesMode.GLOBAL){this._offset=r.sourceEntity.inverseSceneTransform.transformVector(this._position);e.setVertexConst(h,this._offset.x,this._offset.y,this._offset.z)}else i.activateVertexBuffer(h,this._particleRotateToPositionNode._iDataOffset,l,s.ContextGLVertexBufferFormat.FLOAT_3)};t.MATRIX_INDEX=0;t.POSITION_INDEX=1;return t}(o.ParticleStateBase);r.ParticleRotateToPositionState=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleRotationalVelocityNode=r;this._rotationalVelocity=this._particleRotationalVelocityNode._iRotationalVelocity;this.updateRotationalVelocityData()}Object.defineProperty(t.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(e){this._rotationalVelocity=e;this.updateRotationalVelocityData()},enumerable:true,configurable:true});t.prototype.getRotationalVelocities=function(){return this._pDynamicProperties};t.prototype.setRotationalVelocities=function(e){this._pDynamicProperties=e;this._pDynamicPropertiesDirty=new Object};t.prototype.setRenderState=function(e,r,i,a,o,l){if(this._particleRotationalVelocityNode.mode==n.ParticlePropertiesMode.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[i._iUniqueId])this._pUpdateDynamicProperties(i);var h=a.getRegisterIndex(this._pAnimationNode,t.ROTATIONALVELOCITY_INDEX);if(this._particleRotationalVelocityNode.mode==n.ParticlePropertiesMode.GLOBAL)e.setVertexConst(h,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w);else i.activateVertexBuffer(h,this._particleRotationalVelocityNode._iDataOffset,l,s.ContextGLVertexBufferFormat.FLOAT_4)};t.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==n.ParticlePropertiesMode.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var e=this._rotationalVelocity.clone();if(e.length<=0)e.z=1;else e.normalize();this._rotationalVelocityData=new a.Vector3D(e.x,e.y,e.z,Math.PI/e.w)}};t.ROTATIONALVELOCITY_INDEX=0;return t}(o.ParticleStateBase);r.ParticleRotationalVelocityState=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleScaleState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("../../animators/data/ParticlePropertiesMode");var o=e("../../animators/states/ParticleStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleScaleNode=r;this._usesCycle=this._particleScaleNode._iUsesCycle;this._usesPhase=this._particleScaleNode._iUsesPhase;this._minScale=this._particleScaleNode._iMinScale;this._maxScale=this._particleScaleNode._iMaxScale;this._cycleDuration=this._particleScaleNode._iCycleDuration;this._cyclePhase=this._particleScaleNode._iCyclePhase;this.updateScaleData()}Object.defineProperty(t.prototype,"minScale",{get:function(){return this._minScale},set:function(e){this._minScale=e;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateScaleData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,o,l){var h=a.getRegisterIndex(this._pAnimationNode,t.SCALE_INDEX);if(this._particleScaleNode.mode==n.ParticlePropertiesMode.LOCAL_STATIC){if(this._usesCycle){if(this._usesPhase)i.activateVertexBuffer(h,this._particleScaleNode._iDataOffset,l,s.ContextGLVertexBufferFormat.FLOAT_4);else i.activateVertexBuffer(h,this._particleScaleNode._iDataOffset,l,s.ContextGLVertexBufferFormat.FLOAT_3)}else i.activateVertexBuffer(h,this._particleScaleNode._iDataOffset,l,s.ContextGLVertexBufferFormat.FLOAT_2)}else e.setVertexConst(h,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)};t.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==n.ParticlePropertiesMode.GLOBAL){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new a.Vector3D((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,Math.PI*2/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new a.Vector3D(this._minScale,this._maxScale-this._minScale,0,0)}};t.SCALE_INDEX=0;return t}(o.ParticleStateBase);r.ParticleScaleState=l},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/states/ParticleStateBase");var s=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._usesMultiplier=r._iUsesMultiplier;this._usesOffset=r._iUsesOffset;this._startColor=r._iStartColor;this._endColor=r._iEndColor;this._segmentPoints=r._iSegmentPoints;this._numSegmentPoint=r._iNumSegmentPoint;this.updateColorData()}Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(e){this._segmentPoints=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,a,s,n){if(e.usesFragmentAnimation){if(this._numSegmentPoint>0)e.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]);if(this._usesMultiplier)e.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._multiplierData);if(this._usesOffset)e.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._offsetData)}};t.prototype.updateColorData=function(){
this._timeLifeData=new Float32Array(4);this._multiplierData=new Float32Array(4*(this._numSegmentPoint+1));this._offsetData=new Float32Array(4*(this._numSegmentPoint+1));var e;var t=0;var r=this._numSegmentPoint>3?3:this._numSegmentPoint;for(e=0;e<r;e++){if(e==0)this._timeLifeData[t++]=this._segmentPoints[e].life;else this._timeLifeData[t++]=this._segmentPoints[e].life-this._segmentPoints[e-1].life}e=r;if(this._numSegmentPoint==0)this._timeLifeData[t++]=1;else this._timeLifeData[t++]=1-this._segmentPoints[e-1].life;if(this._usesMultiplier){t=0;this._multiplierData[t++]=this._startColor.redMultiplier;this._multiplierData[t++]=this._startColor.greenMultiplier;this._multiplierData[t++]=this._startColor.blueMultiplier;this._multiplierData[t++]=this._startColor.alphaMultiplier;for(e=0;e<this._numSegmentPoint;e++){if(e==0){this._multiplierData[t++]=(this._segmentPoints[e].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._segmentPoints[e].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._segmentPoints[e].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._segmentPoints[e].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[e]}else{this._multiplierData[t++]=(this._segmentPoints[e].color.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._segmentPoints[e].color.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._segmentPoints[e].color.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._segmentPoints[e].color.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e]}}e=this._numSegmentPoint;if(this._numSegmentPoint==0){this._multiplierData[t++]=this._endColor.redMultiplier-this._startColor.redMultiplier;this._multiplierData[t++]=this._endColor.greenMultiplier-this._startColor.greenMultiplier;this._multiplierData[t++]=this._endColor.blueMultiplier-this._startColor.blueMultiplier;this._multiplierData[t++]=this._endColor.alphaMultiplier-this._startColor.alphaMultiplier}else{this._multiplierData[t++]=(this._endColor.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._endColor.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._endColor.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e];this._multiplierData[t++]=(this._endColor.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e]}}if(this._usesOffset){t=0;this._offsetData[t++]=this._startColor.redOffset/255;this._offsetData[t++]=this._startColor.greenOffset/255;this._offsetData[t++]=this._startColor.blueOffset/255;this._offsetData[t++]=this._startColor.alphaOffset/255;for(e=0;e<this._numSegmentPoint;e++){if(e==0){this._offsetData[t++]=(this._segmentPoints[e].color.redOffset-this._startColor.redOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._segmentPoints[e].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._segmentPoints[e].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._segmentPoints[e].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[e]/255}else{this._offsetData[t++]=(this._segmentPoints[e].color.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._segmentPoints[e].color.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._segmentPoints[e].color.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._segmentPoints[e].color.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255}}e=this._numSegmentPoint;if(this._numSegmentPoint==0){this._offsetData[t++]=(this._endColor.redOffset-this._startColor.redOffset)/255;this._offsetData[t++]=(this._endColor.greenOffset-this._startColor.greenOffset)/255;this._offsetData[t++]=(this._endColor.blueOffset-this._startColor.blueOffset)/255;this._offsetData[t++]=(this._endColor.alphaOffset-this._startColor.alphaOffset)/255}else{this._offsetData[e]=(this._endColor.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._endColor.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._endColor.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255;this._offsetData[t++]=(this._endColor.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255}}};t.START_MULTIPLIER_INDEX=0;t.START_OFFSET_INDEX=1;t.TIME_DATA_INDEX=2;return t}(a.ParticleStateBase);r.ParticleSegmentedColorState=s},{"../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase"}],"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/states/ParticleStateBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleSpriteSheetNode=r;this._usesCycle=this._particleSpriteSheetNode._iUsesCycle;this._usesPhase=this._particleSpriteSheetNode._iUsesCycle;this._totalFrames=this._particleSpriteSheetNode._iTotalFrames;this._numColumns=this._particleSpriteSheetNode._iNumColumns;this._numRows=this._particleSpriteSheetNode._iNumRows;this._cycleDuration=this._particleSpriteSheetNode._iCycleDuration;this._cyclePhase=this._particleSpriteSheetNode._iCyclePhase;this.updateSpriteSheetData()}Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateSpriteSheetData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateSpriteSheetData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,r,i,n,o,l){if(!e.usesUVTransform){e.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]);if(this._usesCycle){var h=n.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_1);if(this._particleSpriteSheetNode.mode==s.ParticlePropertiesMode.LOCAL_STATIC){if(this._usesPhase)i.activateVertexBuffer(h,this._particleSpriteSheetNode._iDataOffset,l,a.ContextGLVertexBufferFormat.FLOAT_3);else i.activateVertexBuffer(h,this._particleSpriteSheetNode._iDataOffset,l,a.ContextGLVertexBufferFormat.FLOAT_2)}else e.setVertexConst(h,this._spriteSheetData[4],this._spriteSheetData[5])}}};t.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var e=this._totalFrames/this._numColumns;this._spriteSheetData[0]=e;this._spriteSheetData[1]=1/this._numColumns;this._spriteSheetData[2]=1/this._numRows;if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=e/this._cycleDuration;this._spriteSheetData[5]=this._cycleDuration;if(this._usesPhase)this._spriteSheetData[6]=this._cyclePhase}};t.UV_INDEX_0=0;t.UV_INDEX_1=1;return t}(n.ParticleStateBase);r.ParticleSpriteSheetState=o},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleStateBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/states/AnimationStateBase");var s=function(e){i(t,e);function t(t,r,i){if(i===void 0){i=false}e.call(this,t,r);this._pDynamicProperties=new Array;this._pDynamicPropertiesDirty=new Object;this._pParticleAnimator=t;this._particleNode=r;this._pNeedUpdateTime=i}Object.defineProperty(t.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,t,r,i,a,s){};t.prototype._pUpdateDynamicProperties=function(e){this._pDynamicPropertiesDirty[e._iUniqueId]=true;var t=e.animationParticles;var r=e.vertexData;var i=e.totalLenOfOneVertex;var a=this._particleNode.dataLength;var s=this._particleNode._iDataOffset;var n;var o;var l;var h;var c;var u=this._pDynamicProperties.length;var d=0;var p=0;var f=0;while(d<u){while(p<u&&(c=t[p]).index==d){h=this._pDynamicProperties[d];n=c.numVertices*i;o=c.startVertexIndex*i+s;for(f=0;f<n;f+=i){l=o+f;for(f=0;f<n;f+=i){l=o+f;r[l++]=h.x;r[l++]=h.y;r[l++]=h.z;if(a==4)r[l++]=h.w}}p++}d++}e.invalidateBuffer()};return t}(a.AnimationStateBase);r.ParticleStateBase=s},{"../../animators/states/AnimationStateBase":"awayjs-renderergl/lib/animators/states/AnimationStateBase"}],"awayjs-renderergl/lib/animators/states/ParticleTimeState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("../../animators/states/ParticleStateBase");var n=function(e){i(t,e);function t(t,r){e.call(this,t,r,true);this._particleTimeNode=r}t.prototype.setRenderState=function(e,r,i,s,n,o){i.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,o,a.ContextGLVertexBufferFormat.FLOAT_4);var l=this._pTime/1e3;e.setVertexConst(s.getRegisterIndex(this._pAnimationNode,t.TIME_CONSTANT_INDEX),l,l,l,l)};t.TIME_STREAM_INDEX=0;t.TIME_CONSTANT_INDEX=1;return t}(s.ParticleStateBase);r.ParticleTimeState=n},{"../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleUVState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/states/ParticleStateBase");var s=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleUVNode=r}t.prototype.setRenderState=function(e,r,i,a,s,n){if(!e.usesUVTransform){var o=a.getRegisterIndex(this._pAnimationNode,t.UV_INDEX);var l=this._particleUVNode._iUvData;e.setVertexConst(o,l.x,l.y)}};t.UV_INDEX=0;return t}(a.ParticleStateBase);r.ParticleUVState=s},{"../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase"}],"awayjs-renderergl/lib/animators/states/ParticleVelocityState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("../../animators/data/ParticlePropertiesMode");var n=e("../../animators/states/ParticleStateBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._particleVelocityNode=r;this._velocity=this._particleVelocityNode._iVelocity}Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity=e},enumerable:true,configurable:true});t.prototype.getVelocities=function(){return this._pDynamicProperties};t.prototype.setVelocities=function(e){this._pDynamicProperties=e;this._pDynamicPropertiesDirty=new Object};t.prototype.setRenderState=function(e,r,i,n,o,l){if(this._particleVelocityNode.mode==s.ParticlePropertiesMode.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[i._iUniqueId])this._pUpdateDynamicProperties(i);var h=n.getRegisterIndex(this._pAnimationNode,t.VELOCITY_INDEX);if(this._particleVelocityNode.mode==s.ParticlePropertiesMode.GLOBAL)e.setVertexConst(h,this._velocity.x,this._velocity.y,this._velocity.z);else i.activateVertexBuffer(h,this._particleVelocityNode._iDataOffset,l,a.ContextGLVertexBufferFormat.FLOAT_3)};t.VELOCITY_INDEX=0;return t}(n.ParticleStateBase);r.ParticleVelocityState=o},{"../../animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","../../animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/data/JointPose");var s=e("../../animators/data/SkeletonPose");var n=e("../../animators/states/AnimationStateBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._blendWeight=0;this._skeletonPose=new s.SkeletonPose;this._skeletonPoseDirty=true;this._skeletonAnimationNode=r;this._inputA=t.getAnimationState(this._skeletonAnimationNode.inputA);this._inputB=t.getAnimationState(this._skeletonAnimationNode.inputB)}Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true},enumerable:true,configurable:true});t.prototype.phase=function(e){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._inputA.phase(e);this._inputB.phase(e)};t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=true;this._inputA.update(t);this._inputB.update(t);e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var e=this._inputA.positionDelta;var t=this._inputB.positionDelta;this._pRootDelta.x=e.x+this._blendWeight*(t.x-e.x);this._pRootDelta.y=e.y+this._blendWeight*(t.y-e.y);this._pRootDelta.z=e.z+this._blendWeight*(t.z-e.z)};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;var t;var r=this._skeletonPose.jointPoses;var i=this._inputA.getSkeletonPose(e).jointPoses;var s=this._inputB.getSkeletonPose(e).jointPoses;var n,o;var l,h;var c;var u=e.numJoints;if(r.length!=u)r.length=u;for(var d=0;d<u;++d){t=r[d];if(t==null)t=r[d]=new a.JointPose;n=i[d];o=s[d];l=n.translation;h=o.translation;t.orientation.lerp(n.orientation,o.orientation,this._blendWeight);c=t.translation;c.x=l.x+this._blendWeight*(h.x-l.x);c.y=l.y+this._blendWeight*(h.y-l.y);c.z=l.z+this._blendWeight*(h.z-l.z)}};return t}(n.AnimationStateBase);r.SkeletonBinaryLERPState=o},{"../../animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","../../animators/data/SkeletonPose":"awayjs-renderergl/lib/animators/data/SkeletonPose","../../animators/states/AnimationStateBase":"awayjs-renderergl/lib/animators/states/AnimationStateBase"}],"awayjs-renderergl/lib/animators/states/SkeletonClipState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Vector3D");var s=e("../../animators/data/JointPose");var n=e("../../animators/data/SkeletonPose");var o=e("../../animators/states/AnimationClipState");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._rootPos=new a.Vector3D;this._skeletonPose=new n.SkeletonPose;this._skeletonPoseDirty=true;this._skeletonClipNode=r;this._frames=this._skeletonClipNode.frames}Object.defineProperty(t.prototype,"currentPose",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._currentPose},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"nextPose",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._nextPose},enumerable:true,configurable:true});t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=true;e.prototype._pUpdateTime.call(this,t)};t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this);this._currentPose=this._frames[this._pCurrentFrame];if(this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame){this._nextPose=this._frames[0];this._pAnimator.dispatchCycleEvent()}else this._nextPose=this._frames[this._pNextFrame]};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;if(!this._skeletonClipNode.totalDuration)return;if(this._pFramesDirty)this._pUpdateFrames();var t=this._currentPose.jointPoses;var r=this._nextPose.jointPoses;var i=e.numJoints;var a,n;var o,l;var h=this._skeletonPose.jointPoses;var c;var u;if(h.length!=i)h.length=i;if(i!=t.length||i!=r.length)throw new Error("joint counts don't match!");for(var d=0;d<i;++d){c=h[d];if(c==null)c=h[d]=new s.JointPose;o=t[d];l=r[d];a=o.translation;n=l.translation;if(this._skeletonClipNode.highQuality)c.orientation.slerp(o.orientation,l.orientation,this._pBlendWeight);else c.orientation.lerp(o.orientation,l.orientation,this._pBlendWeight);if(d>0){u=c.translation;u.x=a.x+this._pBlendWeight*(n.x-a.x);u.y=a.y+this._pBlendWeight*(n.y-a.y);u.z=a.z+this._pBlendWeight*(n.z-a.z)}}};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;if(this._pFramesDirty)this._pUpdateFrames();var e,t,r;var i=this._skeletonClipNode.totalDelta;if(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame){this._rootPos.x-=i.x*this._pTimeDir;this._rootPos.y-=i.y*this._pTimeDir;this._rootPos.z-=i.z*this._pTimeDir}var a=this._rootPos.x;var s=this._rootPos.y;var n=this._rootPos.z;if(this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame){e=this._frames[0].jointPoses[0].translation;t=this._frames[1].jointPoses[0].translation;r=this._currentPose.jointPoses[0].translation;this._rootPos.x=r.x+e.x+this._pBlendWeight*(t.x-e.x);this._rootPos.y=r.y+e.y+this._pBlendWeight*(t.y-e.y);this._rootPos.z=r.z+e.z+this._pBlendWeight*(t.z-e.z)}else{e=this._currentPose.jointPoses[0].translation;t=this._frames[this._pNextFrame].jointPoses[0].translation;this._rootPos.x=e.x+this._pBlendWeight*(t.x-e.x);this._rootPos.y=e.y+this._pBlendWeight*(t.y-e.y);this._rootPos.z=e.z+this._pBlendWeight*(t.z-e.z)}this._pRootDelta.x=this._rootPos.x-a;this._pRootDelta.y=this._rootPos.y-s;this._pRootDelta.z=this._rootPos.z-n;this._pOldFrame=this._pNextFrame};return t}(o.AnimationClipState);r.SkeletonClipState=l},{"../../animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","../../animators/data/SkeletonPose":"awayjs-renderergl/lib/animators/data/SkeletonPose","../../animators/states/AnimationClipState":"awayjs-renderergl/lib/animators/states/AnimationClipState","awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Quaternion");var s=e("../../animators/data/JointPose");var n=e("../../animators/data/SkeletonPose");var o=e("../../animators/states/AnimationStateBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._blendWeight=0;this._skeletonPose=new n.SkeletonPose;this._skeletonPoseDirty=true;this._skeletonAnimationNode=r;this._baseInput=t.getAnimationState(this._skeletonAnimationNode.baseInput);this._differenceInput=t.getAnimationState(this._skeletonAnimationNode.differenceInput)}Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true},enumerable:true,configurable:true});t.prototype.phase=function(e){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._baseInput.phase(e);this._baseInput.phase(e)};t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=true;this._baseInput.update(t);this._differenceInput.update(t);e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var e=this._baseInput.positionDelta;var t=this._differenceInput.positionDelta;this.positionDelta.x=e.x+this._blendWeight*t.x;this.positionDelta.y=e.y+this._blendWeight*t.y;this.positionDelta.z=e.z+this._blendWeight*t.z};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;var r;var i=this._skeletonPose.jointPoses;var a=this._baseInput.getSkeletonPose(e).jointPoses;var n=this._differenceInput.getSkeletonPose(e).jointPoses;var o,l;var h,c;var u;var d=e.numJoints;if(i.length!=d)i.length=d;for(var p=0;p<d;++p){r=i[p];if(r==null)r=i[p]=new s.JointPose;o=a[p];l=n[p];h=o.translation;c=l.translation;t._tempQuat.multiply(l.orientation,o.orientation);r.orientation.lerp(o.orientation,t._tempQuat,this._blendWeight);u=r.translation;u.x=h.x+this._blendWeight*c.x;u.y=h.y+this._blendWeight*c.y;u.z=h.z+this._blendWeight*c.z}};t._tempQuat=new a.Quaternion;return t}(o.AnimationStateBase);r.SkeletonDifferenceState=l},{"../../animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","../../animators/data/SkeletonPose":"awayjs-renderergl/lib/animators/data/SkeletonPose","../../animators/states/AnimationStateBase":"awayjs-renderergl/lib/animators/states/AnimationStateBase","awayjs-core/lib/geom/Quaternion":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/data/JointPose");var s=e("../../animators/data/SkeletonPose");var n=e("../../animators/states/AnimationStateBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._skeletonPose=new s.SkeletonPose;this._skeletonPoseDirty=true;this._blendWeight=0;this._direction=0;this._blendDirty=true;this._skeletonAnimationNode=r;this._forward=t.getAnimationState(this._skeletonAnimationNode.forward);this._backward=t.getAnimationState(this._skeletonAnimationNode.backward);this._left=t.getAnimationState(this._skeletonAnimationNode.left);this._right=t.getAnimationState(this._skeletonAnimationNode.right)}Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){if(this._direction==e)return;this._direction=e;this._blendDirty=true;this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true},enumerable:true,configurable:true});t.prototype.phase=function(e){if(this._blendDirty)this.updateBlend();this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._inputA.phase(e);this._inputB.phase(e)};t.prototype._pUdateTime=function(t){if(this._blendDirty)this.updateBlend();this._skeletonPoseDirty=true;this._inputA.update(t);this._inputB.update(t);e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;if(this._blendDirty)this.updateBlend();var e=this._inputA.positionDelta;var t=this._inputB.positionDelta;this.positionDelta.x=e.x+this._blendWeight*(t.x-e.x);this.positionDelta.y=e.y+this._blendWeight*(t.y-e.y);this.positionDelta.z=e.z+this._blendWeight*(t.z-e.z)};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;if(this._blendDirty)this.updateBlend();var t;var r=this._skeletonPose.jointPoses;var i=this._inputA.getSkeletonPose(e).jointPoses;var s=this._inputB.getSkeletonPose(e).jointPoses;var n,o;var l,h;var c;var u=e.numJoints;if(r.length!=u)r.length=u;for(var d=0;d<u;++d){t=r[d];if(t==null)t=r[d]=new a.JointPose;n=i[d];o=s[d];l=n.translation;h=o.translation;t.orientation.lerp(n.orientation,o.orientation,this._blendWeight);c=t.translation;c.x=l.x+this._blendWeight*(h.x-l.x);c.y=l.y+this._blendWeight*(h.y-l.y);c.z=l.z+this._blendWeight*(h.z-l.z)}};t.prototype.updateBlend=function(){this._blendDirty=false;if(this._direction<0||this._direction>360){this._direction%=360;if(this._direction<0)this._direction+=360}if(this._direction<90){this._inputA=this._forward;this._inputB=this._right;this._blendWeight=this._direction/90}else if(this._direction<180){this._inputA=this._right;this._inputB=this._backward;this._blendWeight=(this._direction-90)/90}else if(this._direction<270){this._inputA=this._backward;this._inputB=this._left;this._blendWeight=(this._direction-180)/90}else{this._inputA=this._left;this._inputB=this._forward;this._blendWeight=(this._direction-270)/90}};return t}(n.AnimationStateBase);r.SkeletonDirectionalState=o},{"../../animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","../../animators/data/SkeletonPose":"awayjs-renderergl/lib/animators/data/SkeletonPose","../../animators/states/AnimationStateBase":"awayjs-renderergl/lib/animators/states/AnimationStateBase"}],"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/data/JointPose");var s=e("../../animators/data/SkeletonPose");var n=e("../../animators/states/AnimationStateBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._skeletonPose=new s.SkeletonPose;this._skeletonPoseDirty=true;this._blendWeights=new Array;this._inputs=new Array;this._skeletonAnimationNode=r;var i=this._skeletonAnimationNode.numInputs;while(i--)this._inputs[i]=t.getAnimationState(this._skeletonAnimationNode._iInputs[i])}t.prototype.phase=function(e){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;for(var t=0;t<this._skeletonAnimationNode.numInputs;++t){if(this._blendWeights[t])this._inputs[t].update(e)}};t.prototype._pUdateTime=function(t){for(var r=0;r<this._skeletonAnimationNode.numInputs;++r){if(this._blendWeights[r])this._inputs[r].update(t)}e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype.getBlendWeightAt=function(e){return this._blendWeights[e]};t.prototype.setBlendWeightAt=function(e,t){this._blendWeights[e]=t;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var e;var t;this.positionDelta.x=0;this.positionDelta.y=0;this.positionDelta.z=0;for(var r=0;r<this._skeletonAnimationNode.numInputs;++r){t=this._blendWeights[r];if(t){e=this._inputs[r].positionDelta;this.positionDelta.x+=t*e.x;this.positionDelta.y+=t*e.y;this.positionDelta.z+=t*e.z}}};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;var t;var r=this._skeletonPose.jointPoses;var i;var s,n;var o,l;var h,c;var u;var d;var p,f,_,m;var g,y,v,x;var b=e.numJoints;if(r.length!=b)r.length=b;for(var P=0;P<this._skeletonAnimationNode.numInputs;++P){t=this._blendWeights[P];if(!t)continue;i=this._inputs[P].getSkeletonPose(e).jointPoses;if(!u){u=i;for(d=0;d<b;++d){s=r[d];if(s==null)s=r[d]=new a.JointPose;n=i[d];c=n.orientation;l=n.translation;h=s.orientation;h.x=t*c.x;h.y=t*c.y;h.z=t*c.z;h.w=t*c.w;o=s.translation;o.x=t*l.x;o.y=t*l.y;o.z=t*l.z}}else{for(d=0;d<e.numJoints;++d){s=r[d];n=i[d];c=u[d].orientation;f=c.x;_=c.y;m=c.z;p=c.w;c=n.orientation;l=n.translation;y=c.x;v=c.y;x=c.z;g=c.w;if(f*y+_*v+m*x+p*g<0){y=-y;v=-v;x=-x;g=-g}h=s.orientation;h.x+=t*y;h.y+=t*v;h.z+=t*x;h.w+=t*g;o=s.translation;o.x+=t*l.x;o.y+=t*l.y;o.z+=t*l.z}}}for(d=0;d<e.numJoints;++d)r[d].orientation.normalize()};return t}(n.AnimationStateBase);r.SkeletonNaryLERPState=o},{"../../animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","../../animators/data/SkeletonPose":"awayjs-renderergl/lib/animators/data/SkeletonPose","../../animators/states/AnimationStateBase":"awayjs-renderergl/lib/animators/states/AnimationStateBase"}],"awayjs-renderergl/lib/animators/states/VertexClipState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/states/AnimationClipState");var s=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._vertexClipNode=r;this._frames=this._vertexClipNode.frames}Object.defineProperty(t.prototype,"currentGraphics",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._currentGraphics},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"nextGraphics",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._nextGraphics},enumerable:true,configurable:true});t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this);this._currentGraphics=this._frames[this._pCurrentFrame];if(this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame){this._nextGraphics=this._frames[0];this._pAnimator.dispatchCycleEvent()}else this._nextGraphics=this._frames[this._pNextFrame]};t.prototype._pUpdatePositionDelta=function(){};return t}(a.AnimationClipState);r.VertexClipState=s},{"../../animators/states/AnimationClipState":"awayjs-renderergl/lib/animators/states/AnimationClipState"}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/nodes/SkeletonBinaryLERPNode");var s=e("../../animators/transitions/CrossfadeTransitionState");var n=function(e){i(t,e);function t(){e.call(this);this._pStateClass=s.CrossfadeTransitionState}return t}(a.SkeletonBinaryLERPNode);r.CrossfadeTransitionNode=n},{"../../animators/nodes/SkeletonBinaryLERPNode":"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode","../../animators/transitions/CrossfadeTransitionState":"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState"}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../animators/states/SkeletonBinaryLERPState");var s=e("../../animators/../events/AnimationStateEvent");
var n=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._crossfadeTransitionNode=r}t.prototype._pUpdateTime=function(t){this.blendWeight=Math.abs(t-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed);if(this.blendWeight>=1){this.blendWeight=1;if(this._animationStateTransitionComplete==null)this._animationStateTransitionComplete=new s.AnimationStateEvent(s.AnimationStateEvent.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode);this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)}e.prototype._pUpdateTime.call(this,t)};return t}(a.SkeletonBinaryLERPState);r.CrossfadeTransitionState=n},{"../../animators/../events/AnimationStateEvent":"awayjs-renderergl/lib/events/AnimationStateEvent","../../animators/states/SkeletonBinaryLERPState":"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState"}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransition":[function(e,t,r){"use strict";var i=e("../../animators/transitions/CrossfadeTransitionNode");var a=function(){function e(e){this.blendSpeed=.5;this.blendSpeed=e}e.prototype.getAnimationNode=function(e,t,r,a){var s=new i.CrossfadeTransitionNode;s.inputA=t;s.inputB=r;s.blendSpeed=this.blendSpeed;s.startBlend=a;return s};return e}();r.CrossfadeTransition=a},{"../../animators/transitions/CrossfadeTransitionNode":"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode"}],"awayjs-renderergl/lib/animators/transitions/IAnimationTransition":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/animators":[function(e,t,r){"use strict";var i=e("./animators/data/AnimationElements");r.AnimationElements=i.AnimationElements;var a=e("./animators/data/AnimationRegisterData");r.AnimationRegisterData=a.AnimationRegisterData;var s=e("./animators/data/ColorSegmentPoint");r.ColorSegmentPoint=s.ColorSegmentPoint;var n=e("./animators/data/JointPose");r.JointPose=n.JointPose;var o=e("./animators/data/ParticleAnimationData");r.ParticleAnimationData=o.ParticleAnimationData;var l=e("./animators/data/ParticleProperties");r.ParticleProperties=l.ParticleProperties;var h=e("./animators/data/ParticlePropertiesMode");r.ParticlePropertiesMode=h.ParticlePropertiesMode;var c=e("./animators/data/Skeleton");r.Skeleton=c.Skeleton;var u=e("./animators/data/SkeletonJoint");r.SkeletonJoint=u.SkeletonJoint;var d=e("./animators/data/SkeletonPose");r.SkeletonPose=d.SkeletonPose;var p=e("./animators/data/VertexAnimationMode");r.VertexAnimationMode=p.VertexAnimationMode;var f=e("./animators/nodes/AnimationClipNodeBase");r.AnimationClipNodeBase=f.AnimationClipNodeBase;var _=e("./animators/nodes/ParticleAccelerationNode");r.ParticleAccelerationNode=_.ParticleAccelerationNode;var m=e("./animators/nodes/ParticleBezierCurveNode");r.ParticleBezierCurveNode=m.ParticleBezierCurveNode;var g=e("./animators/nodes/ParticleBillboardNode");r.ParticleBillboardNode=g.ParticleBillboardNode;var y=e("./animators/nodes/ParticleColorNode");r.ParticleColorNode=y.ParticleColorNode;var v=e("./animators/nodes/ParticleFollowNode");r.ParticleFollowNode=v.ParticleFollowNode;var x=e("./animators/nodes/ParticleInitialColorNode");r.ParticleInitialColorNode=x.ParticleInitialColorNode;var b=e("./animators/nodes/ParticleNodeBase");r.ParticleNodeBase=b.ParticleNodeBase;var P=e("./animators/nodes/ParticleOrbitNode");r.ParticleOrbitNode=P.ParticleOrbitNode;var S=e("./animators/nodes/ParticleOscillatorNode");r.ParticleOscillatorNode=S.ParticleOscillatorNode;var C=e("./animators/nodes/ParticlePositionNode");r.ParticlePositionNode=C.ParticlePositionNode;var w=e("./animators/nodes/ParticleRotateToHeadingNode");r.ParticleRotateToHeadingNode=w.ParticleRotateToHeadingNode;var D=e("./animators/nodes/ParticleRotateToPositionNode");r.ParticleRotateToPositionNode=D.ParticleRotateToPositionNode;var T=e("./animators/nodes/ParticleRotationalVelocityNode");r.ParticleRotationalVelocityNode=T.ParticleRotationalVelocityNode;var A=e("./animators/nodes/ParticleScaleNode");r.ParticleScaleNode=A.ParticleScaleNode;var R=e("./animators/nodes/ParticleSegmentedColorNode");r.ParticleSegmentedColorNode=R.ParticleSegmentedColorNode;var O=e("./animators/nodes/ParticleSpriteSheetNode");r.ParticleSpriteSheetNode=O.ParticleSpriteSheetNode;var V=e("./animators/nodes/ParticleTimeNode");r.ParticleTimeNode=V.ParticleTimeNode;var j=e("./animators/nodes/ParticleUVNode");r.ParticleUVNode=j.ParticleUVNode;var L=e("./animators/nodes/ParticleVelocityNode");r.ParticleVelocityNode=L.ParticleVelocityNode;var E=e("./animators/nodes/SkeletonBinaryLERPNode");r.SkeletonBinaryLERPNode=E.SkeletonBinaryLERPNode;var B=e("./animators/nodes/SkeletonClipNode");r.SkeletonClipNode=B.SkeletonClipNode;var I=e("./animators/nodes/SkeletonDifferenceNode");r.SkeletonDifferenceNode=I.SkeletonDifferenceNode;var F=e("./animators/nodes/SkeletonDirectionalNode");r.SkeletonDirectionalNode=F.SkeletonDirectionalNode;var M=e("./animators/nodes/SkeletonNaryLERPNode");r.SkeletonNaryLERPNode=M.SkeletonNaryLERPNode;var N=e("./animators/nodes/VertexClipNode");r.VertexClipNode=N.VertexClipNode;var G=e("./animators/states/AnimationClipState");r.AnimationClipState=G.AnimationClipState;var k=e("./animators/states/AnimationStateBase");r.AnimationStateBase=k.AnimationStateBase;var z=e("./animators/states/ParticleAccelerationState");r.ParticleAccelerationState=z.ParticleAccelerationState;var U=e("./animators/states/ParticleBezierCurveState");r.ParticleBezierCurveState=U.ParticleBezierCurveState;var X=e("./animators/states/ParticleBillboardState");r.ParticleBillboardState=X.ParticleBillboardState;var W=e("./animators/states/ParticleColorState");r.ParticleColorState=W.ParticleColorState;var H=e("./animators/states/ParticleFollowState");r.ParticleFollowState=H.ParticleFollowState;var q=e("./animators/states/ParticleInitialColorState");r.ParticleInitialColorState=q.ParticleInitialColorState;var Z=e("./animators/states/ParticleStateBase");r.ParticleStateBase=Z.ParticleStateBase;var Y=e("./animators/states/ParticleOrbitState");r.ParticleOrbitState=Y.ParticleOrbitState;var J=e("./animators/states/ParticleOscillatorState");r.ParticleOscillatorState=J.ParticleOscillatorState;var Q=e("./animators/states/ParticlePositionState");r.ParticlePositionState=Q.ParticlePositionState;var K=e("./animators/states/ParticleRotateToHeadingState");r.ParticleRotateToHeadingState=K.ParticleRotateToHeadingState;var $=e("./animators/states/ParticleRotateToPositionState");r.ParticleRotateToPositionState=$.ParticleRotateToPositionState;var ee=e("./animators/states/ParticleRotationalVelocityState");r.ParticleRotationalVelocityState=ee.ParticleRotationalVelocityState;var te=e("./animators/states/ParticleScaleState");r.ParticleScaleState=te.ParticleScaleState;var re=e("./animators/states/ParticleSegmentedColorState");r.ParticleSegmentedColorState=re.ParticleSegmentedColorState;var ie=e("./animators/states/ParticleSpriteSheetState");r.ParticleSpriteSheetState=ie.ParticleSpriteSheetState;var ae=e("./animators/states/ParticleTimeState");r.ParticleTimeState=ae.ParticleTimeState;var se=e("./animators/states/ParticleUVState");r.ParticleUVState=se.ParticleUVState;var ne=e("./animators/states/ParticleVelocityState");r.ParticleVelocityState=ne.ParticleVelocityState;var oe=e("./animators/states/SkeletonBinaryLERPState");r.SkeletonBinaryLERPState=oe.SkeletonBinaryLERPState;var le=e("./animators/states/SkeletonClipState");r.SkeletonClipState=le.SkeletonClipState;var he=e("./animators/states/SkeletonDifferenceState");r.SkeletonDifferenceState=he.SkeletonDifferenceState;var ce=e("./animators/states/SkeletonDirectionalState");r.SkeletonDirectionalState=ce.SkeletonDirectionalState;var ue=e("./animators/states/SkeletonNaryLERPState");r.SkeletonNaryLERPState=ue.SkeletonNaryLERPState;var de=e("./animators/states/VertexClipState");r.VertexClipState=de.VertexClipState;var pe=e("./animators/transitions/CrossfadeTransition");r.CrossfadeTransition=pe.CrossfadeTransition;var fe=e("./animators/transitions/CrossfadeTransitionNode");r.CrossfadeTransitionNode=fe.CrossfadeTransitionNode;var _e=e("./animators/transitions/CrossfadeTransitionState");r.CrossfadeTransitionState=_e.CrossfadeTransitionState;var me=e("./animators/AnimationSetBase");r.AnimationSetBase=me.AnimationSetBase;var ge=e("./animators/AnimatorBase");r.AnimatorBase=ge.AnimatorBase;var ye=e("./animators/ParticleAnimationSet");r.ParticleAnimationSet=ye.ParticleAnimationSet;var ve=e("./animators/ParticleAnimator");r.ParticleAnimator=ve.ParticleAnimator;var xe=e("./animators/SkeletonAnimationSet");r.SkeletonAnimationSet=xe.SkeletonAnimationSet;var be=e("./animators/SkeletonAnimator");r.SkeletonAnimator=be.SkeletonAnimator;var Pe=e("./animators/VertexAnimationSet");r.VertexAnimationSet=Pe.VertexAnimationSet;var Se=e("./animators/VertexAnimator");r.VertexAnimator=Se.VertexAnimator},{"./animators/AnimationSetBase":"awayjs-renderergl/lib/animators/AnimationSetBase","./animators/AnimatorBase":"awayjs-renderergl/lib/animators/AnimatorBase","./animators/ParticleAnimationSet":"awayjs-renderergl/lib/animators/ParticleAnimationSet","./animators/ParticleAnimator":"awayjs-renderergl/lib/animators/ParticleAnimator","./animators/SkeletonAnimationSet":"awayjs-renderergl/lib/animators/SkeletonAnimationSet","./animators/SkeletonAnimator":"awayjs-renderergl/lib/animators/SkeletonAnimator","./animators/VertexAnimationSet":"awayjs-renderergl/lib/animators/VertexAnimationSet","./animators/VertexAnimator":"awayjs-renderergl/lib/animators/VertexAnimator","./animators/data/AnimationElements":"awayjs-renderergl/lib/animators/data/AnimationElements","./animators/data/AnimationRegisterData":"awayjs-renderergl/lib/animators/data/AnimationRegisterData","./animators/data/ColorSegmentPoint":"awayjs-renderergl/lib/animators/data/ColorSegmentPoint","./animators/data/JointPose":"awayjs-renderergl/lib/animators/data/JointPose","./animators/data/ParticleAnimationData":"awayjs-renderergl/lib/animators/data/ParticleAnimationData","./animators/data/ParticleProperties":"awayjs-renderergl/lib/animators/data/ParticleProperties","./animators/data/ParticlePropertiesMode":"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode","./animators/data/Skeleton":"awayjs-renderergl/lib/animators/data/Skeleton","./animators/data/SkeletonJoint":"awayjs-renderergl/lib/animators/data/SkeletonJoint","./animators/data/SkeletonPose":"awayjs-renderergl/lib/animators/data/SkeletonPose","./animators/data/VertexAnimationMode":"awayjs-renderergl/lib/animators/data/VertexAnimationMode","./animators/nodes/AnimationClipNodeBase":"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase","./animators/nodes/ParticleAccelerationNode":"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode","./animators/nodes/ParticleBezierCurveNode":"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode","./animators/nodes/ParticleBillboardNode":"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode","./animators/nodes/ParticleColorNode":"awayjs-renderergl/lib/animators/nodes/ParticleColorNode","./animators/nodes/ParticleFollowNode":"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode","./animators/nodes/ParticleInitialColorNode":"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode","./animators/nodes/ParticleNodeBase":"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase","./animators/nodes/ParticleOrbitNode":"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode","./animators/nodes/ParticleOscillatorNode":"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode","./animators/nodes/ParticlePositionNode":"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode","./animators/nodes/ParticleRotateToHeadingNode":"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode","./animators/nodes/ParticleRotateToPositionNode":"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode","./animators/nodes/ParticleRotationalVelocityNode":"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode","./animators/nodes/ParticleScaleNode":"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode","./animators/nodes/ParticleSegmentedColorNode":"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode","./animators/nodes/ParticleSpriteSheetNode":"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode","./animators/nodes/ParticleTimeNode":"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode","./animators/nodes/ParticleUVNode":"awayjs-renderergl/lib/animators/nodes/ParticleUVNode","./animators/nodes/ParticleVelocityNode":"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode","./animators/nodes/SkeletonBinaryLERPNode":"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode","./animators/nodes/SkeletonClipNode":"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode","./animators/nodes/SkeletonDifferenceNode":"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode","./animators/nodes/SkeletonDirectionalNode":"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode","./animators/nodes/SkeletonNaryLERPNode":"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode","./animators/nodes/VertexClipNode":"awayjs-renderergl/lib/animators/nodes/VertexClipNode","./animators/states/AnimationClipState":"awayjs-renderergl/lib/animators/states/AnimationClipState","./animators/states/AnimationStateBase":"awayjs-renderergl/lib/animators/states/AnimationStateBase","./animators/states/ParticleAccelerationState":"awayjs-renderergl/lib/animators/states/ParticleAccelerationState","./animators/states/ParticleBezierCurveState":"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState","./animators/states/ParticleBillboardState":"awayjs-renderergl/lib/animators/states/ParticleBillboardState","./animators/states/ParticleColorState":"awayjs-renderergl/lib/animators/states/ParticleColorState","./animators/states/ParticleFollowState":"awayjs-renderergl/lib/animators/states/ParticleFollowState","./animators/states/ParticleInitialColorState":"awayjs-renderergl/lib/animators/states/ParticleInitialColorState","./animators/states/ParticleOrbitState":"awayjs-renderergl/lib/animators/states/ParticleOrbitState","./animators/states/ParticleOscillatorState":"awayjs-renderergl/lib/animators/states/ParticleOscillatorState","./animators/states/ParticlePositionState":"awayjs-renderergl/lib/animators/states/ParticlePositionState","./animators/states/ParticleRotateToHeadingState":"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState","./animators/states/ParticleRotateToPositionState":"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState","./animators/states/ParticleRotationalVelocityState":"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState","./animators/states/ParticleScaleState":"awayjs-renderergl/lib/animators/states/ParticleScaleState","./animators/states/ParticleSegmentedColorState":"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState","./animators/states/ParticleSpriteSheetState":"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState","./animators/states/ParticleStateBase":"awayjs-renderergl/lib/animators/states/ParticleStateBase","./animators/states/ParticleTimeState":"awayjs-renderergl/lib/animators/states/ParticleTimeState","./animators/states/ParticleUVState":"awayjs-renderergl/lib/animators/states/ParticleUVState","./animators/states/ParticleVelocityState":"awayjs-renderergl/lib/animators/states/ParticleVelocityState","./animators/states/SkeletonBinaryLERPState":"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState","./animators/states/SkeletonClipState":"awayjs-renderergl/lib/animators/states/SkeletonClipState","./animators/states/SkeletonDifferenceState":"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState","./animators/states/SkeletonDirectionalState":"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState","./animators/states/SkeletonNaryLERPState":"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState","./animators/states/VertexClipState":"awayjs-renderergl/lib/animators/states/VertexClipState","./animators/transitions/CrossfadeTransition":"awayjs-renderergl/lib/animators/transitions/CrossfadeTransition","./animators/transitions/CrossfadeTransitionNode":"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode","./animators/transitions/CrossfadeTransitionState":"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState"}],"awayjs-renderergl/lib/elements/GL_ElementsBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/library/AbstractionBase");var s=e("awayjs-core/lib/errors/AbstractMethodError");var n=e("awayjs-core/lib/events/AssetEvent");var o=e("awayjs-display/lib/events/ElementsEvent");var l=e("awayjs-display/lib/utils/ElementsUtils");var h=function(e){i(t,e);function t(t,r){var i=this;e.call(this,t,r);this.usages=0;this._vertices=new Object;this._verticesUpdated=new Object;this._indexMappings=Array();this._numIndices=0;this._elements=t;this._stage=r;this._onInvalidateIndicesDelegate=function(e){return i._onInvalidateIndices(e)};this._onClearIndicesDelegate=function(e){return i._onClearIndices(e)};this._onInvalidateVerticesDelegate=function(e){return i._onInvalidateVertices(e)};this._onClearVerticesDelegate=function(e){return i._onClearVertices(e)};this._elements.addEventListener(o.ElementsEvent.CLEAR_INDICES,this._onClearIndicesDelegate);this._elements.addEventListener(o.ElementsEvent.INVALIDATE_INDICES,this._onInvalidateIndicesDelegate);this._elements.addEventListener(o.ElementsEvent.CLEAR_VERTICES,this._onClearVerticesDelegate);this._elements.addEventListener(o.ElementsEvent.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate)}Object.defineProperty(t.prototype,"elementsType",{get:function(){throw new s.AbstractMethodError},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"elementsClass",{get:function(){throw new s.AbstractMethodError},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});t.prototype.getIndexMappings=function(){if(!this._indicesUpdated)this._updateIndices();return this._indexMappings};t.prototype.getIndexBufferGL=function(){if(!this._indicesUpdated)this._updateIndices();return this._indices};t.prototype.getVertexBufferGL=function(e){if(!this._indicesUpdated)this._updateIndices();var t=e.buffer.id;if(!this._verticesUpdated[t])this._updateVertices(e);return this._vertices[t]};t.prototype.activateVertexBufferVO=function(e,t,r,i){if(r===void 0){r=0}if(i===void 0){i=0}this.getVertexBufferGL(t).activate(e,t.size,r||t.dimensions,t.offset+i,t.unsigned)};t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._elements.removeEventListener(o.ElementsEvent.CLEAR_INDICES,this._onClearIndicesDelegate);this._elements.removeEventListener(o.ElementsEvent.INVALIDATE_INDICES,this._onInvalidateIndicesDelegate);this._elements.removeEventListener(o.ElementsEvent.CLEAR_VERTICES,this._onClearVerticesDelegate);this._elements.removeEventListener(o.ElementsEvent.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate);this._elements=null;if(this._overflow){this._overflow.onClear(t);this._overflow=null}};t.prototype._setRenderState=function(e,t,r,i){if(!this._verticesUpdated)this._updateIndices()};t.prototype.draw=function(e,t,r,i,a,n){throw new s.AbstractMethodError};t.prototype._updateIndices=function(e){if(e===void 0){e=0}var t=this._elements.indices;if(t){this._indices=this._stage.getAbstraction(l.ElementsUtils.getSubIndices(t,this._elements.numVertices,this._indexMappings,e));this._numIndices=this._indices._attributesBuffer.count*t.dimensions}else{this._indices=null;this._numIndices=0;this._indexMappings=Array()}e+=this._numIndices;if(t&&e<t.count*this._elements.indices.dimensions){if(!this._overflow)this._overflow=this._pGetOverflowElements();this._overflow._updateIndices(e)}else if(this._overflow){this._overflow.onClear(new n.AssetEvent(n.AssetEvent.CLEAR,this._elements));this._overflow=null}this._indicesUpdated=true;if(this._indexMappings.length)for(var r in this._verticesUpdated)this._verticesUpdated[r]=false};t.prototype._updateVertices=function(e){this._numVertices=this._elements.numVertices;var t=e.buffer.id;this._vertices[t]=this._stage.getAbstraction(l.ElementsUtils.getSubVertices(e.buffer,this._indexMappings));this._verticesUpdated[t]=true};t.prototype._onInvalidateIndices=function(e){if(!e.attributesView)return;this._indicesUpdated=false};t.prototype._onClearIndices=function(e){if(!e.attributesView)return;this._indices.onClear(new n.AssetEvent(n.AssetEvent.CLEAR,e.attributesView));this._indices=null};t.prototype._onInvalidateVertices=function(e){if(!e.attributesView)return;var t=e.attributesView.buffer.id;this._verticesUpdated[t]=false};t.prototype._onClearVertices=function(e){if(!e.attributesView)return;var t=e.attributesView.buffer.id;if(this._vertices[t]){this._vertices[t].onClear(new n.AssetEvent(n.AssetEvent.CLEAR,e.attributesView));delete this._vertices[t];delete this._verticesUpdated[t]}};t.prototype._pGetOverflowElements=function(){throw new s.AbstractMethodError};return t}(a.AbstractionBase);r.GL_ElementsBase=h},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-core/lib/library/AbstractionBase":undefined,"awayjs-display/lib/events/ElementsEvent":undefined,"awayjs-display/lib/utils/ElementsUtils":undefined}],"awayjs-renderergl/lib/elements/GL_LineElements":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3D");var s=e("awayjs-stagegl/lib/base/ContextGLDrawMode");var n=e("awayjs-stagegl/lib/base/ContextGLProgramType");var o=e("../elements/GL_ElementsBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._calcMatrix=new a.Matrix3D;this._thickness=1.25;this._lineElements=t}Object.defineProperty(t.prototype,"elementsType",{get:function(){return t.elementsType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"elementsClass",{get:function(){return t},enumerable:true,configurable:true});t._iIncludeDependencies=function(e){e.colorDependencies++};t._iGetVertexCode=function(e,t,r){var i=e.globalPosDependencies>0?r.globalPositionVertex:r.animatedPosition;var a=t.getFreeVertexAttribute();var s=t.getFreeVertexAttribute();var n=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();e.viewMatrixIndex=n.index*4;t.getFreeVertexConstant();var o=t.getFreeVertexConstant();var l=t.getFreeVertexConstant();var h=t.getFreeVertexConstant();var c=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();e.sceneMatrixIndex=c.index*4;var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var d=t.getFreeVertexVectorTemp();t.addVertexTempUsages(d,1);var p=t.getFreeVertexVectorTemp();t.addVertexTempUsages(p,1);var f=t.getFreeVertexVectorTemp();t.addVertexTempUsages(f,1);var _=t.getFreeVertexVectorTemp();t.addVertexTempUsages(_,1);var m=t.getFreeVertexVectorTemp();t.addVertexTempUsages(m,1);return"m44 "+u+", "+i+", "+c+"			\n"+"m44 "+d+", "+a+", "+c+"			\n"+"sub "+p+", "+d+", "+u+" 			\n"+"slt "+f+".x, "+u+".z, "+h+".z			\n"+"sub "+f+".y, "+o+".x, "+f+".x			\n"+"add "+m+".x, "+u+".z, "+h+".z			\n"+"sub "+m+".y, "+u+".z, "+d+".z			\n"+"seq "+m+".z, "+m+".y "+l+".x			\n"+"add "+m+".y, "+m+".y, "+m+".z			\n"+"div "+m+".z, "+m+".x, "+m+".y			\n"+"mul "+m+".xyz, "+m+".zzz, "+p+".xyz	\n"+"add "+_+".xyz, "+u+".xyz, "+m+".xyz	\n"+"mov "+_+".w, "+o+".x			\n"+"mul "+u+", "+u+", "+f+".yyyy			\n"+"mul "+_+", "+_+", "+f+".xxxx			\n"+"add "+u+", "+u+", "+_+"				\n"+"nrm "+p+".xyz, "+p+".xyz			\n"+"nrm "+f+".xyz, "+u+".xyz			\n"+"mov "+f+".w, "+o+".x				\n"+"crs "+_+".xyz, "+p+", "+f+"			\n"+"nrm "+_+".xyz, "+_+".xyz			\n"+"mul "+_+".xyz, "+_+".xyz, "+s+".xxx	\n"+"mov "+_+".w, "+o+".x			\n"+"dp3 "+m+".x, "+u+", "+l+"			\n"+"mul "+m+".x, "+m+".x, "+h+".x			\n"+"mul "+_+".xyz, "+_+".xyz, "+m+".xxx	\n"+"add "+u+".xyz, "+u+".xyz, "+_+".xyz	\n"+"m44 op, "+u+", "+n+"			\n"};t._iGetFragmentCode=function(e,t,r){return""};t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._lineElements=null};t.prototype._setRenderState=function(t,r,i,a){e.prototype._setRenderState.call(this,t,r,i,a);if(r.colorBufferIndex>=0)this.activateVertexBufferVO(r.colorBufferIndex,this._lineElements.colors);this.activateVertexBufferVO(0,this._lineElements.positions,3);this.activateVertexBufferVO(2,this._lineElements.positions,3,12);this.activateVertexBufferVO(3,this._lineElements.thickness);r.vertexConstantData[4+16]=1;r.vertexConstantData[5+16]=1;r.vertexConstantData[6+16]=1;r.vertexConstantData[7+16]=1;r.vertexConstantData[10+16]=-1;r.vertexConstantData[12+16]=this._thickness/(this._stage.scissorRect?Math.min(this._stage.scissorRect.width,this._stage.scissorRect.height):Math.min(this._stage.width,this._stage.height));r.vertexConstantData[13+16]=1/255;r.vertexConstantData[14+16]=i.projection.near;var s=this._stage.context};t.prototype.draw=function(e,t,r,i,a,o){var l=this._stage.context;r.projection.matrix.copyRawDataTo(t.vertexConstantData,t.viewMatrixIndex,true);this._calcMatrix.copyFrom(e.sourceEntity.sceneTransform);this._calcMatrix.append(r.inverseSceneTransform);this._calcMatrix.copyRawDataTo(t.vertexConstantData,t.sceneMatrixIndex,true);l.setProgramConstantsFromArray(n.ContextGLProgramType.VERTEX,t.vertexConstantData);if(this._indices)this.getIndexBufferGL().draw(s.ContextGLDrawMode.TRIANGLES,0,this.numIndices);else this._stage.context.drawVertices(s.ContextGLDrawMode.TRIANGLES,o,a||this.numVertices)};t.prototype._pGetOverflowElements=function(){return new t(this._lineElements,this._stage)};t.elementsType="[elements Line]";return t}(o.GL_ElementsBase);r.GL_LineElements=l},{"../elements/GL_ElementsBase":"awayjs-renderergl/lib/elements/GL_ElementsBase","awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-stagegl/lib/base/ContextGLDrawMode":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/elements/GL_SkyboxElements":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3D");var s=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLDrawMode");var o=e("awayjs-stagegl/lib/base/ContextGLProgramType");var l=e("../elements/GL_TriangleElements");var h=function(e){i(t,e);function t(){e.apply(this,arguments);this._skyboxProjection=new a.Matrix3D}Object.defineProperty(t.prototype,"elementsType",{get:function(){return t.elementsType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"elementsClass",{get:function(){return t},enumerable:true,configurable:true});t._iIncludeDependencies=function(e){};t._iGetVertexCode=function(e,t,r){var i="";var a=e.globalPosDependencies>0?r.globalPositionVertex:r.animatedPosition;var s=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();e.viewMatrixIndex=s.index*4;var n=t.getFreeVertexConstant();e.scenePositionIndex=n.index*4;var o=t.getFreeVertexConstant();var l=t.getFreeVertexVectorTemp();i+="mul "+l+", "+a+", "+o+"\n"+"add "+l+", "+l+", "+n+"\n";if(e.projectionDependencies>0){r.projectionFragment=t.getFreeVarying();i+="m44 "+l+", "+l+", "+s+"\n"+"mov "+r.projectionFragment+", "+l+"\n"+"mov op, "+l+"\n"}else{i+="m44 op, "+l+", "+s+"\n"}return i};t._iGetFragmentCode=function(e,t,r){return""};t.prototype.draw=function(e,t,r,i,a,l){var h=t.scenePositionIndex;var c=r.scenePosition;t.vertexConstantData[h++]=2*c.x;t.vertexConstantData[h++]=2*c.y;t.vertexConstantData[h++]=2*c.z;t.vertexConstantData[h++]=1;t.vertexConstantData[h++]=t.vertexConstantData[h++]=t.vertexConstantData[h++]=r.projection.far/Math.sqrt(3);t.vertexConstantData[h]=1;var u=new s.Vector3D;this._skyboxProjection.copyFrom(i);this._skyboxProjection.copyRowTo(2,u);var d=r.scenePosition;var p=u.x;var f=u.y;var _=u.z;var m=-(u.x*d.x+u.y*d.y+u.z*d.z+Math.sqrt(p*p+f*f+_*_));var g=p>=0?1:-1;var y=f>=0?1:-1;var v=new s.Vector3D(g,y,1,1);var x=this._skyboxProjection.clone();x.invert();var b=x.transformVector(v);this._skyboxProjection.copyRowTo(3,v);var P=(b.x*v.x+b.y*v.y+b.z*v.z+b.w*v.w)/(p*b.x+f*b.y+_*b.z+m*b.w);this._skyboxProjection.copyRowFrom(2,new s.Vector3D(p*P,f*P,_*P,m*P));if(t.sceneMatrixIndex>=0){e.renderSceneTransform.copyRawDataTo(t.vertexConstantData,t.sceneMatrixIndex,true);this._skyboxProjection.copyRawDataTo(t.vertexConstantData,t.viewMatrixIndex,true)}else{this._skyboxProjection.copyRawDataTo(t.vertexConstantData,t.viewMatrixIndex,true)}var S=this._stage.context;S.setProgramConstantsFromArray(o.ContextGLProgramType.VERTEX,t.vertexConstantData);S.setProgramConstantsFromArray(o.ContextGLProgramType.FRAGMENT,t.fragmentConstantData);if(this._indices)this.getIndexBufferGL().draw(n.ContextGLDrawMode.TRIANGLES,0,this.numIndices);else this._stage.context.drawVertices(n.ContextGLDrawMode.TRIANGLES,l,a||this.numVertices)};t.elementsType="[elements Skybox]";return t}(l.GL_TriangleElements);r.GL_SkyboxElements=h},{"../elements/GL_TriangleElements":"awayjs-renderergl/lib/elements/GL_TriangleElements","awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-stagegl/lib/base/ContextGLDrawMode":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/elements/GL_TriangleElements":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3DUtils");var s=e("awayjs-stagegl/lib/base/ContextGLDrawMode");var n=e("awayjs-stagegl/lib/base/ContextGLProgramType");var o=e("../elements/GL_ElementsBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._triangleElements=t}Object.defineProperty(t.prototype,"elementsType",{get:function(){return t.elementsType},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"elementsClass",{get:function(){return t},enumerable:true,configurable:true});t._iIncludeDependencies=function(e){};t._iGetVertexCode=function(e,t,r){var i="";var a=e.globalPosDependencies>0?r.globalPositionVertex:r.animatedPosition;var s=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();e.viewMatrixIndex=s.index*4;if(e.projectionDependencies>0){r.projectionFragment=t.getFreeVarying();var n=t.getFreeVertexVectorTemp();i+="m44 "+n+", "+a+", "+s+"\n"+"mov "+r.projectionFragment+", "+n+"\n"+"mov op, "+n+"\n"}else{i+="m44 op, "+a+", "+s+"\n"}return i};t._iGetFragmentCode=function(e,t,r){return""};t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._triangleElements=null};t.prototype._setRenderState=function(t,r,i,a){e.prototype._setRenderState.call(this,t,r,i,a);if(r.normalIndex>=0&&this._triangleElements.autoDeriveNormals)this._triangleElements.normals;if(r.tangentIndex>=0&&this._triangleElements.autoDeriveTangents)this._triangleElements.tangents;if(r.curvesIndex>=0)this.activateVertexBufferVO(r.curvesIndex,this._triangleElements.getCustomAtributes("curves"));
if(r.uvIndex>=0)this.activateVertexBufferVO(r.uvIndex,this._triangleElements.uvs||this._triangleElements.positions);if(r.secondaryUVIndex>=0)this.activateVertexBufferVO(r.secondaryUVIndex,this._triangleElements.getCustomAtributes("secondaryUVs")||this._triangleElements.uvs||this._triangleElements.positions);if(r.normalIndex>=0)this.activateVertexBufferVO(r.normalIndex,this._triangleElements.normals);if(r.tangentIndex>=0)this.activateVertexBufferVO(r.tangentIndex,this._triangleElements.tangents);if(r.jointIndexIndex>=0)this.activateVertexBufferVO(r.jointIndexIndex,this._triangleElements.jointIndices);if(r.jointWeightIndex>=0)this.activateVertexBufferVO(r.jointIndexIndex,this._triangleElements.jointWeights);this.activateVertexBufferVO(0,this._triangleElements.positions)};t.prototype.draw=function(e,t,r,i,o,l){if(t.sceneMatrixIndex>=0){e.renderSceneTransform.copyRawDataTo(t.vertexConstantData,t.sceneMatrixIndex,true);i.copyRawDataTo(t.vertexConstantData,t.viewMatrixIndex,true)}else{var h=a.Matrix3DUtils.CALCULATION_MATRIX;h.copyFrom(e.renderSceneTransform);h.append(i);h.copyRawDataTo(t.vertexConstantData,t.viewMatrixIndex,true)}var c=this._stage.context;c.setProgramConstantsFromArray(n.ContextGLProgramType.VERTEX,t.vertexConstantData);c.setProgramConstantsFromArray(n.ContextGLProgramType.FRAGMENT,t.fragmentConstantData);if(this._indices)this.getIndexBufferGL().draw(s.ContextGLDrawMode.TRIANGLES,0,this.numIndices);else this._stage.context.drawVertices(s.ContextGLDrawMode.TRIANGLES,l,o||this.numVertices)};t.prototype._pGetOverflowElements=function(){return new t(this._triangleElements,this._stage)};t.elementsType="[elements Triangle]";return t}(o.GL_ElementsBase);r.GL_TriangleElements=l},{"../elements/GL_ElementsBase":"awayjs-renderergl/lib/elements/GL_ElementsBase","awayjs-core/lib/geom/Matrix3DUtils":undefined,"awayjs-stagegl/lib/base/ContextGLDrawMode":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/elements/IElementsClassGL":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/elements":[function(e,t,r){"use strict";var i=e("./elements/GL_ElementsBase");r.GL_ElementsBase=i.GL_ElementsBase;var a=e("./elements/GL_LineElements");r.GL_LineElements=a.GL_LineElements;var s=e("./elements/GL_SkyboxElements");r.GL_SkyboxElements=s.GL_SkyboxElements;var n=e("./elements/GL_TriangleElements");r.GL_TriangleElements=n.GL_TriangleElements},{"./elements/GL_ElementsBase":"awayjs-renderergl/lib/elements/GL_ElementsBase","./elements/GL_LineElements":"awayjs-renderergl/lib/elements/GL_LineElements","./elements/GL_SkyboxElements":"awayjs-renderergl/lib/elements/GL_SkyboxElements","./elements/GL_TriangleElements":"awayjs-renderergl/lib/elements/GL_TriangleElements"}],"awayjs-renderergl/lib/errors/AnimationSetError":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/errors/ErrorBase");var s=function(e){i(t,e);function t(t){e.call(this,t)}return t}(a.ErrorBase);r.AnimationSetError=s},{"awayjs-core/lib/errors/ErrorBase":undefined}],"awayjs-renderergl/lib/errors":[function(e,t,r){"use strict";var i=e("./errors/AnimationSetError");r.AnimationSetError=i.AnimationSetError},{"./errors/AnimationSetError":"awayjs-renderergl/lib/errors/AnimationSetError"}],"awayjs-renderergl/lib/events/AnimationStateEvent":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/EventBase");var s=function(e){i(t,e);function t(t,r,i,a){e.call(this,t);this._animator=r;this._animationState=i;this._animationNode=a}Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationState",{get:function(){return this._animationState},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.type,this._animator,this._animationState,this._animationNode)};t.PLAYBACK_COMPLETE="playbackComplete";t.TRANSITION_COMPLETE="transitionComplete";return t}(a.EventBase);r.AnimationStateEvent=s},{"awayjs-core/lib/events/EventBase":undefined}],"awayjs-renderergl/lib/events/AnimatorEvent":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/EventBase");var s=function(e){i(t,e);function t(t,r){e.call(this,t);this._animator=r}Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.type,this._animator)};t.START="animatorStart";t.STOP="animatorStop";t.CYCLE_COMPLETE="animatorCycleComplete";return t}(a.EventBase);r.AnimatorEvent=s},{"awayjs-core/lib/events/EventBase":undefined}],"awayjs-renderergl/lib/events/PassEvent":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/EventBase");var s=function(e){i(t,e);function t(t,r){e.call(this,t);this._pass=r}Object.defineProperty(t.prototype,"pass",{get:function(){return this._pass},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.type,this._pass)};t.INVALIDATE="invalidatePass";return t}(a.EventBase);r.PassEvent=s},{"awayjs-core/lib/events/EventBase":undefined}],"awayjs-renderergl/lib/events/RTTEvent":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/EventBase");var s=function(e){i(t,e);function t(t,r){e.call(this,t);this._rttManager=r}Object.defineProperty(t.prototype,"rttManager",{get:function(){return this._rttManager},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.type,this._rttManager)};t.RESIZE="rttManagerResize";return t}(a.EventBase);r.RTTEvent=s},{"awayjs-core/lib/events/EventBase":undefined}],"awayjs-renderergl/lib/events/ShadingMethodEvent":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/EventBase");var s=function(e){i(t,e);function t(t){e.call(this,t)}t.SHADER_INVALIDATED="ShaderInvalidated";return t}(a.EventBase);r.ShadingMethodEvent=s},{"awayjs-core/lib/events/EventBase":undefined}],"awayjs-renderergl/lib/events":[function(e,t,r){"use strict";var i=e("./events/AnimationStateEvent");r.AnimationStateEvent=i.AnimationStateEvent;var a=e("./events/AnimatorEvent");r.AnimatorEvent=a.AnimatorEvent;var s=e("./events/PassEvent");r.PassEvent=s.PassEvent;var n=e("./events/RTTEvent");r.RTTEvent=n.RTTEvent;var o=e("./events/ShadingMethodEvent");r.ShadingMethodEvent=o.ShadingMethodEvent},{"./events/AnimationStateEvent":"awayjs-renderergl/lib/events/AnimationStateEvent","./events/AnimatorEvent":"awayjs-renderergl/lib/events/AnimatorEvent","./events/PassEvent":"awayjs-renderergl/lib/events/PassEvent","./events/RTTEvent":"awayjs-renderergl/lib/events/RTTEvent","./events/ShadingMethodEvent":"awayjs-renderergl/lib/events/ShadingMethodEvent"}],"awayjs-renderergl/lib/filters/BlurFilter3D":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../filters/tasks/Filter3DHBlurTask");var s=e("../filters/tasks/Filter3DVBlurTask");var n=e("../filters/Filter3DBase");var o=function(e){i(t,e);function t(t,r,i){if(t===void 0){t=3}if(r===void 0){r=3}if(i===void 0){i=-1}e.call(this);this._hBlurTask=new a.Filter3DHBlurTask(t,i);this._vBlurTask=new s.Filter3DVBlurTask(r,i);this.addTask(this._hBlurTask);this.addTask(this._vBlurTask)}Object.defineProperty(t.prototype,"blurX",{get:function(){return this._hBlurTask.amount},set:function(e){this._hBlurTask.amount=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"blurY",{get:function(){return this._vBlurTask.amount},set:function(e){this._vBlurTask.amount=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stepSize",{get:function(){return this._hBlurTask.stepSize},set:function(e){this._hBlurTask.stepSize=e;this._vBlurTask.stepSize=e},enumerable:true,configurable:true});t.prototype.setRenderTargets=function(t,r){this._hBlurTask.target=this._vBlurTask.getMainInputTexture(r);e.prototype.setRenderTargets.call(this,t,r)};return t}(n.Filter3DBase);r.BlurFilter3D=o},{"../filters/Filter3DBase":"awayjs-renderergl/lib/filters/Filter3DBase","../filters/tasks/Filter3DHBlurTask":"awayjs-renderergl/lib/filters/tasks/Filter3DHBlurTask","../filters/tasks/Filter3DVBlurTask":"awayjs-renderergl/lib/filters/tasks/Filter3DVBlurTask"}],"awayjs-renderergl/lib/filters/CompositeFilter3D":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../filters/tasks/Filter3DCompositeTask");var s=e("../filters/Filter3DBase");var n=function(e){i(t,e);function t(t,r){if(r===void 0){r=1}e.call(this);this._compositeTask=new a.Filter3DCompositeTask(t,r);this.addTask(this._compositeTask)}Object.defineProperty(t.prototype,"exposure",{get:function(){return this._compositeTask.exposure},set:function(e){this._compositeTask.exposure=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"overlayTexture",{get:function(){return this._compositeTask.overlayTexture},set:function(e){this._compositeTask.overlayTexture=e},enumerable:true,configurable:true});return t}(s.Filter3DBase);r.CompositeFilter3D=n},{"../filters/Filter3DBase":"awayjs-renderergl/lib/filters/Filter3DBase","../filters/tasks/Filter3DCompositeTask":"awayjs-renderergl/lib/filters/tasks/Filter3DCompositeTask"}],"awayjs-renderergl/lib/filters/FXAAFilter3D":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../filters/tasks/Filter3DFXAATask");var s=e("../filters/Filter3DBase");var n=function(e){i(t,e);function t(t,r){if(r===void 0){r=-1}e.call(this);this._fxaaTask=new a.Filter3DFXAATask(t,r);this.addTask(this._fxaaTask)}Object.defineProperty(t.prototype,"amount",{get:function(){return this._fxaaTask.amount},set:function(e){this._fxaaTask.amount=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stepSize",{get:function(){return this._fxaaTask.stepSize},set:function(e){this._fxaaTask.stepSize=e},enumerable:true,configurable:true});return t}(s.Filter3DBase);r.FXAAFilter3D=n},{"../filters/Filter3DBase":"awayjs-renderergl/lib/filters/Filter3DBase","../filters/tasks/Filter3DFXAATask":"awayjs-renderergl/lib/filters/tasks/Filter3DFXAATask"}],"awayjs-renderergl/lib/filters/Filter3DBase":[function(e,t,r){"use strict";var i=function(){function e(){this._tasks=new Array}Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});e.prototype.addTask=function(e){this._tasks.push(e);if(this._requireDepthRender==null)this._requireDepthRender=e.requireDepthRender};Object.defineProperty(e.prototype,"tasks",{get:function(){return this._tasks},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(e){return this._tasks[0].getMainInputTexture(e)};Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureWidth=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rttManager",{get:function(){return this._rttManager},set:function(e){this._rttManager=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].rttManager=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){this._textureHeight=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureHeight=e},enumerable:true,configurable:true});e.prototype.setRenderTargets=function(e,t){this._tasks[this._tasks.length-1].target=e};e.prototype.dispose=function(){for(var e=0;e<this._tasks.length;++e)this._tasks[e].dispose()};e.prototype.update=function(e,t){};return e}();r.Filter3DBase=i},{}],"awayjs-renderergl/lib/filters/tasks/Filter3DCompositeTask":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLProgramType");var s=e("../../filters/tasks/Filter3DTaskBase");var n=function(e){i(t,e);function t(t,r){if(r===void 0){r=1}e.call(this);this._data=new Float32Array([r,.5,2,-1,0,0,0,0]);this._blendMode=t}Object.defineProperty(t.prototype,"overlayTexture",{get:function(){return this._overlayTexture},set:function(e){this._overlayTexture=e;this._overlayWidth=this._overlayTexture.width;this._overlayHeight=this._overlayTexture.height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"exposure",{get:function(){return this._data[0]},set:function(e){this._data[0]=e},enumerable:true,configurable:true});t.prototype.getFragmentCode=function(){var e=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(e,1);var t=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(t,1);var r=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(r,1);var i=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(i,1);var a=this._registerCache.getFreeTextureReg();this._inputTextureIndex=a.index;var s=this._registerCache.getFreeTextureReg();this._overlayTextureIndex=s.index;var n=this._registerCache.getFreeFragmentConstant();this._exposureIndex=n.index*4;var o=this._registerCache.getFreeFragmentConstant();this._scalingIndex=o.index*4;var l;l="tex "+e+", "+this._uvVarying+", "+a+" <2d,linear,clamp>\n"+"mul "+t+", "+this._uvVarying+", "+o+".zw\n"+"add "+t+", "+t+", "+o+".xy\n"+"tex "+t+", "+t+", "+s+" <2d,linear,clamp>\n"+"mul "+t+", "+t+", "+n+".xxx\n"+"add "+t+", "+t+", "+n+".xxx\n";switch(this._blendMode){case"multiply":l+="mul oc, "+e+", "+t+"\n";break;case"add":l+="add oc, "+e+", "+t+"\n";break;case"subtract":l+="sub oc, "+e+", "+t+"\n";break;case"overlay":l+="sge "+r+", "+e+", "+n+".yyy\n";l+="sub "+e+", "+r+", "+e+"\n";l+="sub "+t+", "+t+", "+r+"\n";l+="mul "+t+", "+t+", "+e+"\n";l+="sub "+i+", "+r+", "+n+".yyy\n";l+="div "+t+", "+t+", "+i+"\n";l+="add oc, "+t+", "+r+"\n";break;case"normal":l+="mov oc, "+e+"\n";break;default:throw new Error("Unknown blend mode")}return l};t.prototype.activate=function(e,t,r){this._data[4]=-.5*(this._scaledTextureWidth-this._overlayWidth)/this._overlayWidth;this._data[5]=-.5*(this._scaledTextureHeight-this._overlayHeight)/this._overlayHeight;this._data[6]=this._scaledTextureWidth/this._overlayWidth;this._data[7]=this._scaledTextureHeight/this._overlayHeight;var i=e.context;i.setProgramConstantsFromArray(a.ContextGLProgramType.FRAGMENT,this._data);e.getAbstraction(this._overlayTexture).activate(this._overlayTextureIndex,false)};t.prototype.deactivate=function(e){e.context.setTextureAt(1,null)};return t}(s.Filter3DTaskBase);r.Filter3DCompositeTask=n},{"../../filters/tasks/Filter3DTaskBase":"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase","awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/filters/tasks/Filter3DFXAATask":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLProgramType");var s=e("../../filters/tasks/Filter3DTaskBase");var n=function(e){i(t,e);function t(t,r){if(t===void 0){t=1}if(r===void 0){r=-1}e.call(this);this._stepSize=1;this._data=new Float32Array(20);this._data.set([.299,.587,.114,0],0);this._data.set([.25,.5,.75,1],4);this._data.set([1/1024,1/1024,-1,1],8);this._data.set([1/128,1/8,8,0],12);this._data.set([1/3-.5,2/3-.5,0/3-.5,3/3-.5],16);this.amount=t;this.stepSize=r}Object.defineProperty(t.prototype,"amount",{get:function(){return this._amount},set:function(e){if(this._amount==e)return;this._amount=e;this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stepSize",{get:function(){return this._stepSize},set:function(e){if(this._stepSize==e)return;this._stepSize=e;this.calculateStepSize();this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});t.prototype.getFragmentCode=function(){var e="fc0";var t="fc0.w";var r="fc1.x";var i="fc1.y";var a="fc1.z";var s="fc1.w";var n="fc2.xy";var o="fc2.x";var l="fc2.y";var h="fc2.z";var c="fc2.w";var u="fc3.x";var d="fc3.y";var p="fc3.z";var f="fc4.x";var _="fc4.y";var m="fc4.z";var g="fc4.w";var y="v0";var v="ft0.xy";var x="ft0.x";var b="ft0.y";var P="ft2.x";var S="ft2.y";var C="ft2.z";var w="ft2.w";var D="ft3.x";var T="ft3.y";var A="ft3.z";var R="ft3.w";var O="ft1";var V="ft4";var j="ft4.x";var L="ft4.y";var E="ft4.xy";var B="ft5.x";var I="ft5.y";var F="ft6";var M="ft7";var N="ft5.x";var G="ft5.y";var k="fs0";var z=O;var U=z+".xy";var X=new Array;X.push("tex",O,y,k,"<2d wrap linear>","\n");X.push("dp3",D,O,e,"\n");X.push("mov",v,y,"\n");X.push("sub",v,v,n,"\n");X.push("tex",O,v,k,"<2d wrap linear>","\n");X.push("dp3",P,O,e,"\n");X.push("mov",v,y,"\n");X.push("add",v,v,n,"\n");X.push("tex",O,v,k,"<2d wrap linear>","\n");X.push("dp3",w,O,e,"\n");X.push("mov",v,y,"\n");X.push("sub",b,b,l,"\n");X.push("add",x,x,o,"\n");X.push("tex",O,v,k,"<2d wrap linear>","\n");X.push("dp3",S,O,e,"\n");X.push("mov",v,y,"\n");X.push("add",b,b,l,"\n");X.push("sub",x,x,o,"\n");X.push("tex",O,v,k,"<2d wrap linear>","\n");X.push("dp3",C,O,e,"\n");X.push("add",T,P,S,"\n");X.push("add",A,C,w,"\n");X.push("sub",j,T,A,"\n");X.push("neg",j,j,"\n");X.push("add",T,P,C,"\n");X.push("add",A,S,w,"\n");X.push("sub",L,T,A,"\n");X.push("add",T,T,A,"\n");X.push("mul",T,T,d,"\n");X.push("mul",T,T,r,"\n");X.push("max",B,T,u,"\n");X.push("abs",T,j,"\n");X.push("abs",A,L,"\n");X.push("min",T,T,A,"\n");X.push("add",T,T,B,"\n");X.push("rcp",I,T,"\n");X.push("mul",T,j,I,"\n");X.push("mov",A,p,"\n");X.push("neg",A,A,"\n");X.push("max",T,T,A,"\n");X.push("min",T,p,T,"\n");X.push("mul",j,T,o,"\n");X.push("mul",T,L,I,"\n");X.push("mov",A,p,"\n");X.push("neg",A,A,"\n");X.push("max",T,T,A,"\n");X.push("min",T,p,T,"\n");X.push("mul",L,T,l,"\n");X.push("mul",U,E,f,"\n");X.push("add",v,y,U,"\n");X.push("tex",F,v,k,"<2d wrap linear>","\n");X.push("mul",U,E,_,"\n");X.push("add",v,y,U,"\n");X.push("tex",O,v,k,"<2d wrap linear>","\n");X.push("add",F,F,O,"\n");X.push("mul",F,F,i,"\n");X.push("mul",U,E,m,"\n");X.push("add",v,y,U,"\n");X.push("tex",M,v,k,"<2d wrap linear>","\n");X.push("mul",U,E,g,"\n");X.push("add",v,y,U,"\n");X.push("tex",O,v,k,"<2d wrap linear>","\n");X.push("add",M,M,O,"\n");X.push("mul",M,M,r,"\n");X.push("mul",O,F,i,"\n");X.push("add",M,M,O,"\n");X.push("min",T,C,w,"\n");X.push("min",A,P,S,"\n");X.push("min",T,T,A,"\n");X.push("min",N,T,D,"\n");X.push("max",T,C,w,"\n");X.push("max",A,P,S,"\n");X.push("max",T,T,A,"\n");X.push("max",G,T,D,"\n");X.push("dp3",T,e,M,"\n");X.push("slt",A,T,N,"\n");X.push("sge",R,T,G,"\n");X.push("mul",A,A,R,"\n");X.push("mul",F,F,A,"\n");X.push("sub",A,s,A,"\n");X.push("mul",M,M,A,"\n");X.push("add","oc",F,M,"\n");return X.join(" ")};t.prototype.activate=function(e,t,r){e.context.setProgramConstantsFromArray(a.ContextGLProgramType.FRAGMENT,this._data)};t.prototype.updateTextures=function(t){e.prototype.updateTextures.call(this,t);this.updateBlurData()};t.prototype.updateBlurData=function(){if(this._rttManager){this._data[8]=1/this._textureWidth;this._data[9]=1/this._textureHeight}};t.prototype.calculateStepSize=function(){this._realStepSize=1};t.MAX_AUTO_SAMPLES=15;return t}(s.Filter3DTaskBase);r.Filter3DFXAATask=n},{"../../filters/tasks/Filter3DTaskBase":"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase","awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/filters/tasks/Filter3DHBlurTask":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLProgramType");var s=e("../../filters/tasks/Filter3DTaskBase");var n=function(e){i(t,e);function t(t,r){if(r===void 0){r=-1}e.call(this);this._stepSize=1;this._amount=t;this._data=new Float32Array([0,0,0,1]);this.stepSize=r}Object.defineProperty(t.prototype,"amount",{get:function(){return this._amount},set:function(e){if(this._amount==e)return;this._amount=e;this.invalidateProgram();this.updateBlurData();this.calculateStepSize()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stepSize",{get:function(){return this._stepSize},set:function(e){if(this._stepSize==e)return;this._stepSize=e;this.calculateStepSize();this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});t.prototype.getFragmentCode=function(){var e;var t=1;e="mov ft0, v0	\n"+"sub ft0.x, v0.x, fc0.x\n";e+="tex ft1, ft0, fs0 <2d,linear,clamp>\n";for(var r=this._realStepSize;r<=this._amount;r+=this._realStepSize){e+="add ft0.x, ft0.x, fc0.y\n"+"tex ft2, ft0, fs0 <2d,linear,clamp>\n"+"add ft1, ft1, ft2\n";++t}e+="mul oc, ft1, fc0.z\n";this._data[2]=1/t;return e};t.prototype.activate=function(e,t,r){e.context.setProgramConstantsFromArray(a.ContextGLProgramType.FRAGMENT,this._data)};t.prototype.updateTextures=function(t){e.prototype.updateTextures.call(this,t);this.updateBlurData()};t.prototype.updateBlurData=function(){var e=1/this._textureWidth;this._data[0]=this._amount*.5*e;this._data[1]=this._realStepSize*e};t.prototype.calculateStepSize=function(){this._realStepSize=this._stepSize>0?this._stepSize:this._amount>t.MAX_AUTO_SAMPLES?this._amount/t.MAX_AUTO_SAMPLES:1};t.MAX_AUTO_SAMPLES=15;return t}(s.Filter3DTaskBase);r.Filter3DHBlurTask=n},{"../../filters/tasks/Filter3DTaskBase":"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase","awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase":[function(e,t,r){"use strict";var i=e("awayjs-core/lib/image/Image2D");var a=e("awayjs-core/lib/errors/AbstractMethodError");var s=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");var n=e("../../shaders/ShaderRegisterCache");var o=function(){function e(e){if(e===void 0){e=false}this._scaledTextureWidth=-1;this._scaledTextureHeight=-1;this._textureWidth=-1;this._textureHeight=-1;this._textureDimensionsInvalid=true;this._program3DInvalid=true;this._textureScale=0;this._requireDepthRender=e;this._registerCache=new n.ShaderRegisterCache("baseline")}Object.defineProperty(e.prototype,"textureScale",{get:function(){return this._textureScale},set:function(e){if(this._textureScale==e)return;this._textureScale=e;this._scaledTextureWidth=this._textureWidth>>this._textureScale;this._scaledTextureHeight=this._textureHeight>>this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rttManager",{get:function(){return this._rttManager},set:function(e){if(this._rttManager==e)return;this._rttManager=e;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){if(this._textureWidth==e)return;this._textureWidth=e;this._scaledTextureWidth=this._textureWidth>>this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){if(this._textureHeight==e)return;this._textureHeight=e;this._scaledTextureHeight=this._textureHeight>>this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(e){if(this._textureDimensionsInvalid)this.updateTextures(e);return this._mainInputTexture};e.prototype.dispose=function(){if(this._mainInputTexture)this._mainInputTexture.dispose();if(this._program3D)this._program3D.dispose()};e.prototype.invalidateProgram=function(){this._program3DInvalid=true};e.prototype.updateProgram=function(e){if(this._program3D)this._program3D.dispose();this._program3D=e.context.createProgram();this._registerCache.reset();var t=(new s.AGALMiniAssembler).assemble("part vertex 1\n"+this.getVertexCode()+"endpart")["vertex"].data;var r=(new s.AGALMiniAssembler).assemble("part fragment 1\n"+this.getFragmentCode()+"endpart")["fragment"].data;this._program3D.upload(t,r);this._program3DInvalid=false};e.prototype.getVertexCode=function(){var e=this._registerCache.getFreeVertexAttribute();this._positionIndex=e.index;var t=this._registerCache.getFreeVertexAttribute();this._uvIndex=t.index;this._uvVarying=this._registerCache.getFreeVarying();var r;r="mov op, "+e+"\n"+"mov "+this._uvVarying+", "+t+"\n";return r};e.prototype.getFragmentCode=function(){throw new a.AbstractMethodError};e.prototype.updateTextures=function(e){if(this._mainInputTexture)this._mainInputTexture.dispose();this._mainInputTexture=new i.Image2D(this._scaledTextureWidth,this._scaledTextureHeight);this._textureDimensionsInvalid=false};e.prototype.getProgram=function(e){if(this._program3DInvalid)this.updateProgram(e);return this._program3D};e.prototype.activate=function(e,t,r){};e.prototype.deactivate=function(e){};Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});return e}();r.Filter3DTaskBase=o},{"../../shaders/ShaderRegisterCache":"awayjs-renderergl/lib/shaders/ShaderRegisterCache","awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/image/Image2D":undefined,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":undefined}],"awayjs-renderergl/lib/filters/tasks/Filter3DVBlurTask":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-stagegl/lib/base/ContextGLProgramType");var s=e("../../filters/tasks/Filter3DTaskBase");var n=function(e){i(t,e);function t(t,r){if(r===void 0){r=-1}e.call(this);this._stepSize=1;this._amount=t;this._data=new Float32Array([0,0,0,1]);this.stepSize=r}Object.defineProperty(t.prototype,"amount",{get:function(){return this._amount},set:function(e){if(this._amount==e)return;this._amount=e;this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stepSize",{get:function(){return this._stepSize},set:function(e){if(this._stepSize==e)return;this._stepSize=e;this.calculateStepSize();this.invalidateProgram();this.updateBlurData()},enumerable:true,configurable:true});t.prototype.getFragmentCode=function(){var e;var t=1;e="mov ft0, v0	\n"+"sub ft0.y, v0.y, fc0.x\n";e+="tex ft1, ft0, fs0 <2d,linear,clamp>\n";for(var r=this._realStepSize;r<=this._amount;r+=this._realStepSize){e+="add ft0.y, ft0.y, fc0.y\n";e+="tex ft2, ft0, fs0 <2d,linear,clamp>\n"+"add ft1, ft1, ft2\n";++t}e+="mul oc, ft1, fc0.z\n";this._data[2]=1/t;return e};t.prototype.activate=function(e,t,r){e.context.setProgramConstantsFromArray(a.ContextGLProgramType.FRAGMENT,this._data)};t.prototype.updateTextures=function(t){e.prototype.updateTextures.call(this,t);this.updateBlurData()};t.prototype.updateBlurData=function(){var e=1/this._textureHeight;this._data[0]=this._amount*.5*e;this._data[1]=this._realStepSize*e};t.prototype.calculateStepSize=function(){this._realStepSize=this._stepSize>0?this._stepSize:this._amount>t.MAX_AUTO_SAMPLES?this._amount/t.MAX_AUTO_SAMPLES:1};t.MAX_AUTO_SAMPLES=15;return t}(s.Filter3DTaskBase);r.Filter3DVBlurTask=n},{"../../filters/tasks/Filter3DTaskBase":"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase","awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/filters":[function(e,t,r){"use strict";var i=e("./filters/tasks/Filter3DCompositeTask");r.Filter3DCompositeTask=i.Filter3DCompositeTask;var a=e("./filters/tasks/Filter3DFXAATask");r.Filter3DFXAATask=a.Filter3DFXAATask;var s=e("./filters/tasks/Filter3DHBlurTask");r.Filter3DHBlurTask=s.Filter3DHBlurTask;var n=e("./filters/tasks/Filter3DTaskBase");r.Filter3DTaskBase=n.Filter3DTaskBase;var o=e("./filters/tasks/Filter3DVBlurTask");r.Filter3DVBlurTask=o.Filter3DVBlurTask;var l=e("./filters/BlurFilter3D");r.BlurFilter3D=l.BlurFilter3D;var h=e("./filters/CompositeFilter3D");r.CompositeFilter3D=h.CompositeFilter3D;var c=e("./filters/Filter3DBase");r.Filter3DBase=c.Filter3DBase;var u=e("./filters/FXAAFilter3D");r.FXAAFilter3D=u.FXAAFilter3D},{"./filters/BlurFilter3D":"awayjs-renderergl/lib/filters/BlurFilter3D","./filters/CompositeFilter3D":"awayjs-renderergl/lib/filters/CompositeFilter3D","./filters/FXAAFilter3D":"awayjs-renderergl/lib/filters/FXAAFilter3D","./filters/Filter3DBase":"awayjs-renderergl/lib/filters/Filter3DBase","./filters/tasks/Filter3DCompositeTask":"awayjs-renderergl/lib/filters/tasks/Filter3DCompositeTask","./filters/tasks/Filter3DFXAATask":"awayjs-renderergl/lib/filters/tasks/Filter3DFXAATask","./filters/tasks/Filter3DHBlurTask":"awayjs-renderergl/lib/filters/tasks/Filter3DHBlurTask","./filters/tasks/Filter3DTaskBase":"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase","./filters/tasks/Filter3DVBlurTask":"awayjs-renderergl/lib/filters/tasks/Filter3DVBlurTask"}],"awayjs-renderergl/lib/managers/RTTBufferManager":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Rectangle");var s=e("awayjs-core/lib/events/EventDispatcher");var n=e("awayjs-core/lib/utils/ImageUtils");var o=e("../events/RTTEvent");var l=function(e){i(t,e);function t(t){e.call(this);this._viewWidth=-1;this._viewHeight=-1;this._textureWidth=-1;this._textureHeight=-1;this._buffersInvalid=true;this._renderToTextureRect=new a.Rectangle;this._stage=t}t.getInstance=function(e){if(!e)throw new Error("stage key cannot be null!");if(t._instances==null)t._instances=new Array;var r=t.getRTTBufferManagerFromStage(e);if(r==null){r=new t(e);var i=new h;i.stage3d=e;i.rttbfm=r;t._instances.push(i)}return r};t.getRTTBufferManagerFromStage=function(e){var r=t._instances.length;var i;for(var a=0;a<r;a++){i=t._instances[a];
if(i.stage3d===e)return i.rttbfm}return null};t.deleteRTTBufferManager=function(e){var r=t._instances.length;var i;for(var a=0;a<r;a++){i=t._instances[a];if(i.stage3d===e){t._instances.splice(a,1);return}}};Object.defineProperty(t.prototype,"textureRatioX",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._textureRatioX},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureRatioY",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._textureRatioY},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(e){if(e==this._viewWidth)return;this._viewWidth=e;this._buffersInvalid=true;this._textureWidth=n.ImageUtils.getBestPowerOf2(this._viewWidth);if(this._textureWidth>this._viewWidth){this._renderToTextureRect.x=Math.floor((this._textureWidth-this._viewWidth)*.5);this._renderToTextureRect.width=this._viewWidth}else{this._renderToTextureRect.x=0;this._renderToTextureRect.width=this._textureWidth}this.dispatchEvent(new o.RTTEvent(o.RTTEvent.RESIZE,this))},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(e){if(e==this._viewHeight)return;this._viewHeight=e;this._buffersInvalid=true;this._textureHeight=n.ImageUtils.getBestPowerOf2(this._viewHeight);if(this._textureHeight>this._viewHeight){this._renderToTextureRect.y=Math.floor((this._textureHeight-this._viewHeight)*.5);this._renderToTextureRect.height=this._viewHeight}else{this._renderToTextureRect.y=0;this._renderToTextureRect.height=this._textureHeight}this.dispatchEvent(new o.RTTEvent(o.RTTEvent.RESIZE,this))},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderToTextureVertexBuffer",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToTextureVertexBuffer},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderToScreenVertexBuffer",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToScreenVertexBuffer},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderToTextureRect",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToTextureRect},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:true,configurable:true});t.prototype.dispose=function(){t.deleteRTTBufferManager(this._stage);if(this._indexBuffer){this._indexBuffer.dispose();this._renderToScreenVertexBuffer.dispose();this._renderToTextureVertexBuffer.dispose();this._renderToScreenVertexBuffer=null;this._renderToTextureVertexBuffer=null;this._indexBuffer=null}};t.prototype.updateRTTBuffers=function(){var e=this._stage.context;var t;var r;var i;var a;if(this._renderToTextureVertexBuffer==null)this._renderToTextureVertexBuffer=e.createVertexBuffer(4,20);if(this._renderToScreenVertexBuffer==null)this._renderToScreenVertexBuffer=e.createVertexBuffer(4,20);if(!this._indexBuffer){this._indexBuffer=e.createIndexBuffer(6);this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6)}this._textureRatioX=i=Math.min(this._viewWidth/this._textureWidth,1);this._textureRatioY=a=Math.min(this._viewHeight/this._textureHeight,1);var s=(1-i)*.5;var n=(i+1)*.5;var o=(1-a)*.5;var l=(a+1)*.5;t=[-i,-a,s,o,0,i,-a,n,o,1,i,a,n,l,2,-i,a,s,l,3];r=[-1,-1,s,o,0,1,-1,n,o,1,1,1,n,l,2,-1,1,s,l,3];this._renderToTextureVertexBuffer.uploadFromArray(t,0,4);this._renderToScreenVertexBuffer.uploadFromArray(r,0,4);this._buffersInvalid=false};return t}(s.EventDispatcher);r.RTTBufferManager=l;var h=function(){function e(){}return e}()},{"../events/RTTEvent":"awayjs-renderergl/lib/events/RTTEvent","awayjs-core/lib/events/EventDispatcher":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-core/lib/utils/ImageUtils":undefined}],"awayjs-renderergl/lib/managers":[function(e,t,r){"use strict";var i=e("./managers/RTTBufferManager");r.RTTBufferManager=i.RTTBufferManager},{"./managers/RTTBufferManager":"awayjs-renderergl/lib/managers/RTTBufferManager"}],"awayjs-renderergl/lib/renderables/GL_BillboardRenderable":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/attributes/AttributesBuffer");var s=e("awayjs-display/lib/graphics/TriangleElements");var n=e("awayjs-display/lib/managers/DefaultMaterialManager");var o=e("../renderables/GL_RenderableBase");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._billboard=t}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._billboard=null};t.prototype._pGetElements=function(){var e=this._billboard.material.getTextureAt(0);var r=-1;if(e)r=((this.renderable.style?this.renderable.style.getSamplerAt(e)||e.getSamplerAt(0):e.getSamplerAt(0))||n.DefaultMaterialManager.getDefaultSampler()).id;this._id=r;var i=t._samplerElements[r];var o=this._billboard.billboardWidth;var l=this._billboard.billboardHeight;var h=this._billboard.billboardRect;if(!i){i=t._samplerElements[r]=new s.TriangleElements(new a.AttributesBuffer(11,4));i.autoDeriveNormals=false;i.autoDeriveTangents=false;i.setIndices(Array(0,1,2,0,2,3));i.setPositions(Array(-h.x,l-h.y,0,o-h.x,l-h.y,0,o-h.x,-h.y,0,-h.x,-h.y,0));i.setNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0));i.setTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1));i.setUVs(Array(0,0,1,0,1,1,0,1))}else{i.setPositions(Array(-h.x,l-h.y,0,o-h.x,l-h.y,0,o-h.x,-h.y,0,-h.x,-h.y,0))}return this._stage.getAbstraction(i)};t.prototype._pGetSurface=function(){return this._renderer.getSurfacePool(this.elementsGL).getAbstraction(this._billboard.material||n.DefaultMaterialManager.getDefaultMaterial(this.renderable))};t._samplerElements=new Object;return t}(o.GL_RenderableBase);r.GL_BillboardRenderable=l},{"../renderables/GL_RenderableBase":"awayjs-renderergl/lib/renderables/GL_RenderableBase","awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined,"awayjs-display/lib/managers/DefaultMaterialManager":undefined}],"awayjs-renderergl/lib/renderables/GL_GraphicRenderable":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/managers/DefaultMaterialManager");var s=e("../renderables/GL_RenderableBase");var n=function(e){i(t,e);function t(t,r){e.call(this,t,r);this.graphic=t}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this.graphic=null};t.prototype._pGetElements=function(){this._offset=this.graphic.offset;this._count=this.graphic.count;return this._stage.getAbstraction(this.renderable.animator?this.renderable.animator.getRenderableElements(this,this.graphic.elements):this.graphic.elements)};t.prototype._pGetSurface=function(){return this._renderer.getSurfacePool(this.elementsGL).getAbstraction(this.graphic.material||a.DefaultMaterialManager.getDefaultMaterial(this.renderable))};return t}(s.GL_RenderableBase);r.GL_GraphicRenderable=n},{"../renderables/GL_RenderableBase":"awayjs-renderergl/lib/renderables/GL_RenderableBase","awayjs-display/lib/managers/DefaultMaterialManager":undefined}],"awayjs-renderergl/lib/renderables/GL_LineSegmentRenderable":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/graphics/LineElements");var s=e("awayjs-display/lib/managers/DefaultMaterialManager");var n=e("../renderables/GL_RenderableBase");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._lineSegment=t}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._lineSegment=null};t.prototype._pGetElements=function(){var e=t._lineGraphics[this._lineSegment.id]||(t._lineGraphics[this._lineSegment.id]=new a.LineElements);var r=this._lineSegment.startPostion;var i=this._lineSegment.endPosition;var s=new Float32Array(6);var n=new Float32Array(1);s[0]=r.x;s[1]=r.y;s[2]=r.z;s[3]=i.x;s[4]=i.y;s[5]=i.z;n[0]=this._lineSegment.thickness;e.setPositions(s);e.setThickness(n);return this._stage.getAbstraction(e)};t.prototype._pGetSurface=function(){return this._renderer.getSurfacePool(this.elementsGL).getAbstraction(this._lineSegment.material||s.DefaultMaterialManager.getDefaultMaterial(this.renderable))};t.prototype._pGetOverflowRenderable=function(e){return new t(this.renderable,this._renderer)};t._lineGraphics=new Object;return t}(n.GL_RenderableBase);r.GL_LineSegmentRenderable=o},{"../renderables/GL_RenderableBase":"awayjs-renderergl/lib/renderables/GL_RenderableBase","awayjs-display/lib/graphics/LineElements":undefined,"awayjs-display/lib/managers/DefaultMaterialManager":undefined}],"awayjs-renderergl/lib/renderables/GL_RenderableBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/errors/AbstractMethodError");var s=e("awayjs-core/lib/events/AssetEvent");var n=e("awayjs-core/lib/library/AbstractionBase");var o=e("awayjs-display/lib/events/RenderableEvent");var l=function(e){i(t,e);function t(t,r){var i=this;e.call(this,t,r);this._count=0;this._offset=0;this._elementsDirty=true;this._surfaceDirty=true;this.images=new Array;this.samplers=new Array;this._onInvalidateSurfaceDelegate=function(e){return i._onInvalidateSurface(e)};this._onInvalidateElementsDelegate=function(e){return i.onInvalidateElements(e)};this._renderer=r;this._stage=r.stage;this.renderable=t;this.renderable.addEventListener(o.RenderableEvent.INVALIDATE_SURFACE,this._onInvalidateSurfaceDelegate);this.renderable.addEventListener(o.RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate)}Object.defineProperty(t.prototype,"elementsGL",{get:function(){if(this._elementsDirty)this._updateElements();return this._elementsGL},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"surfaceGL",{get:function(){if(this._surfaceDirty)this._updateSurface();return this._surfaceGL},enumerable:true,configurable:true});t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this.next=null;this.masksConfig=null;this.renderSceneTransform=null;this._renderer=null;this._stage=null;this.sourceEntity=null;this.renderable.removeEventListener(o.RenderableEvent.INVALIDATE_SURFACE,this._onInvalidateSurfaceDelegate);this.renderable.removeEventListener(o.RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate);this.renderable=null;this._surfaceGL.usages--;if(!this._surfaceGL.usages)this._surfaceGL.onClear(new s.AssetEvent(s.AssetEvent.CLEAR,this._surfaceGL.surface));this._surfaceGL=null;this._elementsGL=null};t.prototype.onInvalidateElements=function(e){this._elementsDirty=true};t.prototype._onInvalidateSurface=function(e){this._surfaceDirty=true};t.prototype._pGetElements=function(){throw new a.AbstractMethodError};t.prototype._pGetSurface=function(){throw new a.AbstractMethodError};t.prototype._iRender=function(e,t,r){this._setRenderState(e,t,r);this._elementsGL.draw(this,e.shader,t,r,this._count,this._offset)};t.prototype._setRenderState=function(e,t,r){if(this._elementsDirty)this._updateElements();e._setRenderState(this,t,r);if(e.shader.activeElements!=this._elementsGL){e.shader.activeElements=this._elementsGL;this._elementsGL._setRenderState(this,e.shader,t,r)}};t.prototype._updateElements=function(){this._elementsGL=this._pGetElements();this._elementsDirty=false};t.prototype._updateSurface=function(){var e=this._pGetSurface();if(this._surfaceGL!=e){if(this._surfaceGL){this._surfaceGL.usages--;if(!this._surfaceGL.usages)this._surfaceGL.onClear(new s.AssetEvent(s.AssetEvent.CLEAR,this._surfaceGL.surface))}this._surfaceGL=e;this._surfaceGL.usages++}var t=e.numImages;this.images.length=t;this.samplers.length=t;this.uvMatrix=this.renderable.style?this.renderable.style.uvMatrix:this._surfaceGL.surface.style?this._surfaceGL.surface.style.uvMatrix:null;var r=this._surfaceGL.surface.getNumTextures();var i;var t;var a;var n;var o;for(var l=0;l<r;l++){i=this._surfaceGL.surface.getTextureAt(l);t=i.getNumImages();for(var h=0;h<t;h++){o=e.getImageIndex(i,h);a=this.renderable.style?this.renderable.style.getImageAt(i,h):null;this.images[o]=a?this._stage.getAbstraction(a):null;n=this.renderable.style?this.renderable.style.getSamplerAt(i,h):null;this.samplers[o]=n?this._stage.getAbstraction(n):null}}this._surfaceDirty=false};return t}(n.AbstractionBase);r.GL_RenderableBase=l},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-core/lib/library/AbstractionBase":undefined,"awayjs-display/lib/events/RenderableEvent":undefined}],"awayjs-renderergl/lib/renderables/GL_SkyboxRenderable":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/attributes/AttributesBuffer");var s=e("awayjs-display/lib/graphics/TriangleElements");var n=e("../renderables/GL_RenderableBase");var o=e("../elements/GL_SkyboxElements");var l=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._skybox=t}t.prototype._pGetElements=function(){var e=t._elementsGL;if(!e){var r=new s.TriangleElements(new a.AttributesBuffer(11,4));r.autoDeriveNormals=false;r.autoDeriveTangents=false;r.setIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2));r.setPositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1));e=t._elementsGL=new o.GL_SkyboxElements(r,this._stage)}return e};t.prototype._pGetSurface=function(){return this._renderer.getSurfacePool(this.elementsGL).getAbstraction(this._skybox)};t._iIncludeDependencies=function(e){};return t}(n.GL_RenderableBase);r.GL_SkyboxRenderable=l},{"../elements/GL_SkyboxElements":"awayjs-renderergl/lib/elements/GL_SkyboxElements","../renderables/GL_RenderableBase":"awayjs-renderergl/lib/renderables/GL_RenderableBase","awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined}],"awayjs-renderergl/lib/renderables":[function(e,t,r){"use strict";var i=e("./renderables/GL_BillboardRenderable");r.GL_BillboardRenderable=i.GL_BillboardRenderable;var a=e("./renderables/GL_GraphicRenderable");r.GL_GraphicRenderable=a.GL_GraphicRenderable;var s=e("./renderables/GL_LineSegmentRenderable");r.GL_LineSegmentRenderable=s.GL_LineSegmentRenderable;var n=e("./renderables/GL_RenderableBase");r.GL_RenderableBase=n.GL_RenderableBase;var o=e("./renderables/GL_SkyboxRenderable");r.GL_SkyboxRenderable=o.GL_SkyboxRenderable},{"./renderables/GL_BillboardRenderable":"awayjs-renderergl/lib/renderables/GL_BillboardRenderable","./renderables/GL_GraphicRenderable":"awayjs-renderergl/lib/renderables/GL_GraphicRenderable","./renderables/GL_LineSegmentRenderable":"awayjs-renderergl/lib/renderables/GL_LineSegmentRenderable","./renderables/GL_RenderableBase":"awayjs-renderergl/lib/renderables/GL_RenderableBase","./renderables/GL_SkyboxRenderable":"awayjs-renderergl/lib/renderables/GL_SkyboxRenderable"}],"awayjs-renderergl/lib/shaders/LightingShader":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/materials/LightSources");var s=e("awayjs-stagegl/lib/base/ContextGLProfile");var n=e("../shaders/ShaderBase");var o=e("../shaders/compilers/LightingCompiler");var l=function(e){i(t,e);function t(t,r,i){e.call(this,t,r,i);this._includeCasters=true;this._lightingPass=r}t.prototype._iIncludeDependencies=function(){this.numPointLights=this._lightingPass.numPointLights;this.numDirectionalLights=this._lightingPass.numDirectionalLights;this.numLightProbes=this._lightingPass.numLightProbes;var t=this._lightingPass.numPointLights+this._lightingPass.numDirectionalLights;var r=this._lightingPass.numLightProbes;var i=this._lightingPass._iUsesDiffuse(this)?this._lightingPass.diffuseLightSources:0;var n=this._lightingPass._iUsesSpecular(this)?this._lightingPass.specularLightSources:0;var o=i|n;this.usesLightFallOff=this._lightingPass.enableLightFallOff&&this.profile!=s.ContextGLProfile.BASELINE_CONSTRAINED;this.usesCommonData=this.usesLightFallOff;this.numLights=t+r;this.usesLights=t>0&&(o&a.LightSources.LIGHTS)!=0;this.usesProbes=r>0&&(o&a.LightSources.PROBES)!=0;this.usesLightsForSpecular=t>0&&(n&a.LightSources.LIGHTS)!=0;this.usesProbesForSpecular=r>0&&(n&a.LightSources.PROBES)!=0;this.usesLightsForDiffuse=t>0&&(i&a.LightSources.LIGHTS)!=0;this.usesProbesForDiffuse=r>0&&(i&a.LightSources.PROBES)!=0;this.usesShadows=this._lightingPass._iUsesShadows(this);e.prototype._iIncludeDependencies.call(this)};t.prototype.createCompiler=function(e,t){return new o.LightingCompiler(e,t,this)};t.prototype._setRenderState=function(t,r,i){e.prototype._setRenderState.call(this,t,r,i);if(this._lightingPass.lightPicker)this._lightingPass.lightPicker.collectLights(t.sourceEntity);if(this.usesLights)this.updateLights();if(this.usesProbes)this.updateProbes()};t.prototype.updateLights=function(){var e;var t;var r=0;var i=0;var a;var s;var n=0;var o=this.usesShadows?2:1;var l;var h;this.ambientR=this.ambientG=this.ambientB=0;l=this.lightVertexConstantIndex;i=this.lightFragmentConstantIndex;var c=0;var u=this._lightingPass.lightPicker.directionalLights;h=this._lightingPass.directionalLightsOffset;a=this._lightingPass.lightPicker.directionalLights.length;if(h>a){c=1;h-=a}for(;c<o;++c){if(c)u=this._lightingPass.lightPicker.castingDirectionalLights;a=u.length;if(a>this.numDirectionalLights)a=this.numDirectionalLights;for(r=0;r<a;++r){e=u[h+r];s=e.sceneDirection;this.ambientR+=e._iAmbientR;this.ambientG+=e._iAmbientG;this.ambientB+=e._iAmbientB;if(this.usesTangentSpace){var d=-s.x;var p=-s.y;var f=-s.z;this.vertexConstantData[l++]=this._pInverseSceneMatrix[0]*d+this._pInverseSceneMatrix[4]*p+this._pInverseSceneMatrix[8]*f;this.vertexConstantData[l++]=this._pInverseSceneMatrix[1]*d+this._pInverseSceneMatrix[5]*p+this._pInverseSceneMatrix[9]*f;this.vertexConstantData[l++]=this._pInverseSceneMatrix[2]*d+this._pInverseSceneMatrix[6]*p+this._pInverseSceneMatrix[10]*f;this.vertexConstantData[l++]=1}else{this.fragmentConstantData[i++]=-s.x;this.fragmentConstantData[i++]=-s.y;this.fragmentConstantData[i++]=-s.z;this.fragmentConstantData[i++]=1}this.fragmentConstantData[i++]=e._iDiffuseR;this.fragmentConstantData[i++]=e._iDiffuseG;this.fragmentConstantData[i++]=e._iDiffuseB;this.fragmentConstantData[i++]=1;this.fragmentConstantData[i++]=e._iSpecularR;this.fragmentConstantData[i++]=e._iSpecularG;this.fragmentConstantData[i++]=e._iSpecularB;this.fragmentConstantData[i++]=1;if(++n==this.numDirectionalLights){r=a;c=o}}}if(this.numDirectionalLights>n){r=i+(this.numDirectionalLights-n)*12;while(i<r)this.fragmentConstantData[i++]=0}n=0;var _=this._lightingPass.lightPicker.pointLights;h=this._lightingPass.pointLightsOffset;a=this._lightingPass.lightPicker.pointLights.length;if(h>a){c=1;h-=a}else{c=0}for(;c<o;++c){if(c)_=this._lightingPass.lightPicker.castingPointLights;a=_.length;for(r=0;r<a;++r){t=_[h+r];s=t.scenePosition;this.ambientR+=t._iAmbientR;this.ambientG+=t._iAmbientG;this.ambientB+=t._iAmbientB;if(this.usesTangentSpace){d=s.x;p=s.y;f=s.z;this.vertexConstantData[l++]=this._pInverseSceneMatrix[0]*d+this._pInverseSceneMatrix[4]*p+this._pInverseSceneMatrix[8]*f+this._pInverseSceneMatrix[12];this.vertexConstantData[l++]=this._pInverseSceneMatrix[1]*d+this._pInverseSceneMatrix[5]*p+this._pInverseSceneMatrix[9]*f+this._pInverseSceneMatrix[13];this.vertexConstantData[l++]=this._pInverseSceneMatrix[2]*d+this._pInverseSceneMatrix[6]*p+this._pInverseSceneMatrix[10]*f+this._pInverseSceneMatrix[14];this.vertexConstantData[l++]=1}else if(!this.usesGlobalPosFragment){this.vertexConstantData[l++]=s.x;this.vertexConstantData[l++]=s.y;this.vertexConstantData[l++]=s.z;this.vertexConstantData[l++]=1}else{this.fragmentConstantData[i++]=s.x;this.fragmentConstantData[i++]=s.y;this.fragmentConstantData[i++]=s.z;this.fragmentConstantData[i++]=1}this.fragmentConstantData[i++]=t._iDiffuseR;this.fragmentConstantData[i++]=t._iDiffuseG;this.fragmentConstantData[i++]=t._iDiffuseB;var m=t._pRadius;this.fragmentConstantData[i++]=m*m;this.fragmentConstantData[i++]=t._iSpecularR;this.fragmentConstantData[i++]=t._iSpecularG;this.fragmentConstantData[i++]=t._iSpecularB;this.fragmentConstantData[i++]=t._pFallOffFactor;if(++n==this.numPointLights){r=a;c=o}}}if(this.numPointLights>n){r=i+(n-this.numPointLights)*12;for(;i<r;++i)this.fragmentConstantData[i]=0}};t.prototype.updateProbes=function(){var e;var t=this._lightingPass.lightPicker.lightProbes;var r=this._lightingPass.lightPicker.lightProbeWeights;var i=t.length-this._lightingPass.lightProbesOffset;var a=this.usesProbesForDiffuse;var s=this.usesProbesForSpecular;if(!(a||s))return;if(i>this.numLightProbes)i=this.numLightProbes;for(var n=0;n<i;++n){e=t[this._lightingPass.lightProbesOffset+n];if(a)this._stage.getAbstraction(e.diffuseMap).activate(this.lightProbeDiffuseIndices[n],e.diffuseSampler.mipmap);if(s)this._stage.getAbstraction(e.specularMap).activate(this.lightProbeSpecularIndices[n],e.diffuseSampler.mipmap)}for(n=0;n<i;++n)this.fragmentConstantData[this.probeWeightsIndex+n]=r[this._lightingPass.lightProbesOffset+n]};return t}(n.ShaderBase);r.LightingShader=l},{"../shaders/ShaderBase":"awayjs-renderergl/lib/shaders/ShaderBase","../shaders/compilers/LightingCompiler":"awayjs-renderergl/lib/shaders/compilers/LightingCompiler","awayjs-display/lib/materials/LightSources":undefined,"awayjs-stagegl/lib/base/ContextGLProfile":undefined}],"awayjs-renderergl/lib/shaders/RegisterPool":[function(e,t,r){"use strict";var i=e("../shaders/ShaderRegisterElement");var a=function(){function e(e,t,r){if(r===void 0){r=true}this._regName=e;this._regCount=t;this._persistent=r;this.initRegisters(e,t)}e.prototype.requestFreeVectorReg=function(){for(var e=0;e<this._regCount;++e){if(!this.isRegisterUsed(e)){if(this._persistent)this._usedVectorCount[e]++;return this._vectorRegisters[e]}}throw new Error("Register overflow!")};e.prototype.requestFreeRegComponent=function(){for(var e=0;e<this._regCount;++e){if(this._usedVectorCount[e]>0)continue;for(var t=0;t<4;++t){if(this._usedSingleCount[t][e]==0){if(this._persistent)this._usedSingleCount[t][e]++;return this._registerComponents[t][e]}}}throw new Error("Register overflow!")};e.prototype.addUsage=function(e,t){if(e._component>-1)this._usedSingleCount[e._component][e.index]+=t;else this._usedVectorCount[e.index]+=t};e.prototype.removeUsage=function(e){if(e._component>-1){if(--this._usedSingleCount[e._component][e.index]<0)throw new Error("More usages removed than exist!")}else{if(--this._usedVectorCount[e.index]<0)throw new Error("More usages removed than exist!")}};e.prototype.dispose=function(){this._vectorRegisters=null;this._registerComponents=null;this._usedSingleCount=null;this._usedVectorCount=null};e.prototype.hasRegisteredRegs=function(){for(var e=0;e<this._regCount;++e)if(this.isRegisterUsed(e))return true;return false};e.prototype.initRegisters=function(t,r){var i=e._initPool(t,r);this._vectorRegisters=e._regPool[i];this._registerComponents=e._regCompsPool[i];this._usedVectorCount=this._initArray(Array(r),0);this._usedSingleCount=new Array(4);this._usedSingleCount[0]=this._initArray(new Array(r),0);this._usedSingleCount[1]=this._initArray(new Array(r),0);this._usedSingleCount[2]=this._initArray(new Array(r),0);this._usedSingleCount[3]=this._initArray(new Array(r),0)};e._initPool=function(t,r){var a=t+r;if(e._regPool[a]!=undefined)return a;var s=new Array(r);e._regPool[a]=s;var n=[[],[],[],[]];e._regCompsPool[a]=n;for(var o=0;o<r;++o){s[o]=new i.ShaderRegisterElement(t,o);for(var l=0;l<4;++l)n[l][o]=new i.ShaderRegisterElement(t,o,l)}return a};e.prototype.isRegisterUsed=function(e){if(this._usedVectorCount[e]>0)return true;for(var t=0;t<4;++t)if(this._usedSingleCount[t][e]>0)return true;return false};e.prototype._initArray=function(e,t){var r=e.length;for(var i=0;i<r;i++)e[i]=t;return e};e._regPool=new Object;e._regCompsPool=new Object;return e}();r.RegisterPool=a},{"../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement"}],"awayjs-renderergl/lib/shaders/ShaderBase":[function(e,t,r){"use strict";var i=e("awayjs-core/lib/image/BlendMode");var a=e("awayjs-core/lib/errors/ArgumentError");var s=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var n=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var o=e("awayjs-stagegl/lib/base/ContextGLTriangleFace");var l=e("../shaders/compilers/CompilerBase");var h=function(){function e(e,t,r){this._abstractionPool=new Object;this._blendFactorSource=s.ContextGLBlendFactor.ONE;this._blendFactorDest=s.ContextGLBlendFactor.ZERO;this._invalidProgram=true;this._animationVertexCode="";this._animationFragmentCode="";this.usesBlending=false;this.useImageRect=false;this.usesCurves=false;this.depthCompareMode=n.ContextGLCompareMode.LESS;this.writeDepth=true;this._defaultCulling=o.ContextGLTriangleFace.BACK;this._pInverseSceneMatrix=new Float32Array(16);this.ambientR=255;this.ambientG=255;this.ambientB=255;this.usesGlobalPosFragment=false;this.usesPositionFragment=false;this.imageIndices=new Array;this._elementsClass=e;this._pass=t;this._stage=r;this.profile=this._stage.profile}Object.defineProperty(e.prototype,"programData",{get:function(){if(this._invalidProgram)this._updateProgram();return this._programData},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"usesAnimation",{get:function(){return this._usesAnimation},set:function(e){if(this._usesAnimation==e)return;this._usesAnimation=e;this.invalidateProgram()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedVertexConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedFragmentConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedStreams},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){if(this._invalidProgram)this._updateProgram();return this._numUsedTextures},enumerable:true,configurable:true});e.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new e._abstractionClassPool[t.assetType](t,this))};e.prototype.clearAbstraction=function(e){this._abstractionPool[e.id]=null};e.registerAbstraction=function(t,r){e._abstractionClassPool[r.assetType]=t};e.prototype.getImageIndex=function(e,t){if(t===void 0){t=0}return this._pass.getImageIndex(e,t)};e.prototype._iIncludeDependencies=function(){this._pass._iIncludeDependencies(this)};e.prototype.createCompiler=function(e,t){return new l.CompilerBase(e,t,this)};e.prototype.reset=function(){this.projectionDependencies=0;this.normalDependencies=0;this.colorDependencies=0;this.viewDirDependencies=0;this.uvDependencies=0;this.secondaryUVDependencies=0;this.globalPosDependencies=0;this.tangentDependencies=0;this.usesCommonData=false;this.usesGlobalPosFragment=false;this.usesPositionFragment=false;this.usesFragmentAnimation=false;this.usesTangentSpace=false;this.outputsNormals=false;this.outputsTangentNormals=false};e.prototype.pInitRegisterIndices=function(){this.commonsDataIndex=-1;this.cameraPositionIndex=-1;this.curvesIndex=-1;this.uvIndex=-1;this.uvMatrixIndex=-1;this.colorTransformIndex=-1;this.secondaryUVIndex=-1;this.normalIndex=-1;this.colorBufferIndex=-1;this.tangentIndex=-1;this.sceneMatrixIndex=-1;this.sceneNormalMatrixIndex=-1;this.jointIndexIndex=-1;this.jointWeightIndex=-1;this.imageIndices.length=0};e.prototype.initConstantData=function(e){this._numUsedVertexConstants=e.numUsedVertexConstants;this._numUsedFragmentConstants=e.numUsedFragmentConstants;this._numUsedStreams=e.numUsedStreams;this._numUsedTextures=e.numUsedTextures;this.vertexConstantData=new Float32Array(e.numUsedVertexConstants*4);this.fragmentConstantData=new Float32Array(e.numUsedFragmentConstants*4);if(this.commonsDataIndex>=0){this.fragmentConstantData[this.commonsDataIndex]=.5;this.fragmentConstantData[this.commonsDataIndex+1]=0;this.fragmentConstantData[this.commonsDataIndex+2]=1/255;this.fragmentConstantData[this.commonsDataIndex+3]=1}if(this.uvMatrixIndex>=0){this.vertexConstantData[this.uvMatrixIndex]=1;this.vertexConstantData[this.uvMatrixIndex+1]=0;this.vertexConstantData[this.uvMatrixIndex+2]=0;this.vertexConstantData[this.uvMatrixIndex+3]=0;this.vertexConstantData[this.uvMatrixIndex+4]=0;this.vertexConstantData[this.uvMatrixIndex+5]=1;this.vertexConstantData[this.uvMatrixIndex+6]=0;this.vertexConstantData[this.uvMatrixIndex+7]=0}if(this.colorTransformIndex>=0){this.fragmentConstantData[this.colorTransformIndex]=1;this.fragmentConstantData[this.colorTransformIndex+1]=1;this.fragmentConstantData[this.colorTransformIndex+2]=1;this.fragmentConstantData[this.colorTransformIndex+3]=1;this.fragmentConstantData[this.colorTransformIndex+4]=0;this.fragmentConstantData[this.colorTransformIndex+5]=0;this.fragmentConstantData[this.colorTransformIndex+6]=0;this.fragmentConstantData[this.colorTransformIndex+7]=0}if(this.cameraPositionIndex>=0)this.vertexConstantData[this.cameraPositionIndex+3]=1;this._pass._iInitConstantData(this);if(this.usesAnimation)this._pass.animationSet.doneAGALCode(this)};e.prototype.setBlendMode=function(e){switch(e){case i.BlendMode.NORMAL:this._blendFactorSource=s.ContextGLBlendFactor.ONE;this._blendFactorDest=s.ContextGLBlendFactor.ZERO;this.usesBlending=false;break;case i.BlendMode.LAYER:this._blendFactorSource=s.ContextGLBlendFactor.SOURCE_ALPHA;this._blendFactorDest=s.ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA;this.usesBlending=true;break;case i.BlendMode.MULTIPLY:this._blendFactorSource=s.ContextGLBlendFactor.ZERO;this._blendFactorDest=s.ContextGLBlendFactor.SOURCE_COLOR;this.usesBlending=true;break;case i.BlendMode.ADD:this._blendFactorSource=s.ContextGLBlendFactor.SOURCE_ALPHA;this._blendFactorDest=s.ContextGLBlendFactor.ONE;this.usesBlending=true;break;case i.BlendMode.ALPHA:this._blendFactorSource=s.ContextGLBlendFactor.ZERO;this._blendFactorDest=s.ContextGLBlendFactor.SOURCE_ALPHA;this.usesBlending=true;break;default:throw new a.ArgumentError("Unsupported blend mode!")}};e.prototype._iActivate=function(e){this._stage.context.setCulling(this.useBothSides?o.ContextGLTriangleFace.NONE:this._defaultCulling,e.projection.coordinateSystem);if(!this.usesTangentSpace&&this.cameraPositionIndex>=0){var t=e.scenePosition;this.vertexConstantData[this.cameraPositionIndex]=t.x;this.vertexConstantData[this.cameraPositionIndex+1]=t.y;this.vertexConstantData[this.cameraPositionIndex+2]=t.z}this._stage.context.setDepthTest(this.writeDepth&&!this.usesBlending,this.depthCompareMode);if(this.usesBlending)this._stage.context.setBlendFactors(this._blendFactorSource,this._blendFactorDest);
this.activeElements=null};e.prototype._iDeactivate=function(){this._stage.context.setDepthTest(true,n.ContextGLCompareMode.LESS);this.activeElements=null};e.prototype._setRenderState=function(e,t,r){if(e.renderable.animator)e.renderable.animator.setRenderState(this,e,this._stage,t);if(this.usesUVTransform){var i=e.uvMatrix;if(i){this.vertexConstantData[this.uvMatrixIndex]=i.a;this.vertexConstantData[this.uvMatrixIndex+1]=i.b;this.vertexConstantData[this.uvMatrixIndex+3]=i.tx;this.vertexConstantData[this.uvMatrixIndex+4]=i.c;this.vertexConstantData[this.uvMatrixIndex+5]=i.d;this.vertexConstantData[this.uvMatrixIndex+7]=i.ty}else{this.vertexConstantData[this.uvMatrixIndex]=1;this.vertexConstantData[this.uvMatrixIndex+1]=0;this.vertexConstantData[this.uvMatrixIndex+3]=0;this.vertexConstantData[this.uvMatrixIndex+4]=0;this.vertexConstantData[this.uvMatrixIndex+5]=1;this.vertexConstantData[this.uvMatrixIndex+7]=0}}if(this.usesColorTransform){var a=e.sourceEntity._iAssignedColorTransform();if(a){this.fragmentConstantData[this.colorTransformIndex]=a.redMultiplier;this.fragmentConstantData[this.colorTransformIndex+1]=a.greenMultiplier;this.fragmentConstantData[this.colorTransformIndex+2]=a.blueMultiplier;this.fragmentConstantData[this.colorTransformIndex+3]=a.alphaMultiplier;this.fragmentConstantData[this.colorTransformIndex+4]=a.redOffset/255;this.fragmentConstantData[this.colorTransformIndex+5]=a.greenOffset/255;this.fragmentConstantData[this.colorTransformIndex+6]=a.blueOffset/255;this.fragmentConstantData[this.colorTransformIndex+7]=a.alphaOffset/255}else{this.fragmentConstantData[this.colorTransformIndex]=1;this.fragmentConstantData[this.colorTransformIndex+1]=1;this.fragmentConstantData[this.colorTransformIndex+2]=1;this.fragmentConstantData[this.colorTransformIndex+3]=1;this.fragmentConstantData[this.colorTransformIndex+4]=0;this.fragmentConstantData[this.colorTransformIndex+5]=0;this.fragmentConstantData[this.colorTransformIndex+6]=0;this.fragmentConstantData[this.colorTransformIndex+7]=0}}if(this.sceneNormalMatrixIndex>=0)e.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData,this.sceneNormalMatrixIndex,false);if(this.usesTangentSpace&&this.cameraPositionIndex>=0){e.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);var s=t.scenePosition;var n=s.x;var o=s.y;var l=s.z;this.vertexConstantData[this.cameraPositionIndex]=this._pInverseSceneMatrix[0]*n+this._pInverseSceneMatrix[4]*o+this._pInverseSceneMatrix[8]*l+this._pInverseSceneMatrix[12];this.vertexConstantData[this.cameraPositionIndex+1]=this._pInverseSceneMatrix[1]*n+this._pInverseSceneMatrix[5]*o+this._pInverseSceneMatrix[9]*l+this._pInverseSceneMatrix[13];this.vertexConstantData[this.cameraPositionIndex+2]=this._pInverseSceneMatrix[2]*n+this._pInverseSceneMatrix[6]*o+this._pInverseSceneMatrix[10]*l+this._pInverseSceneMatrix[14]}};e.prototype.invalidateProgram=function(){this._invalidProgram=true};e.prototype.dispose=function(){this._programData.dispose();this._programData=null};e.prototype._updateProgram=function(){this._invalidProgram=false;var e=this.createCompiler(this._elementsClass,this._pass);e.compile();this._calcAnimationCode(e._pRegisterCache,e.shadedTarget,e._pSharedRegisters);this.initConstantData(e._pRegisterCache);var t=this._stage.getProgramData(this._animationVertexCode+e.vertexCode,e.fragmentCode+this._animationFragmentCode+e.postAnimationFragmentCode);if(this._programData!=t){if(this._programData)this._programData.dispose();this._programData=t;t.usages++}};e.prototype._calcAnimationCode=function(e,t,r){this._animationVertexCode="";this._animationFragmentCode="";if(this.usesAnimation){var i=this._pass.animationSet;this._animationVertexCode+=i.getAGALVertexCode(this,e,r);if(this.uvDependencies>0&&!this.usesUVTransform)this._animationVertexCode+=i.getAGALUVCode(this,e,r);if(this.usesFragmentAnimation)this._animationFragmentCode+=i.getAGALFragmentCode(this,e,t)}else{var a=r.animatableAttributes.length;for(var s=0;s<a;++s)this._animationVertexCode+="mov "+r.animationTargetRegisters[s]+", "+r.animatableAttributes[s]+"\n";if(this.uvDependencies>0&&!this.usesUVTransform)this._animationVertexCode+="mov "+r.uvTarget+","+r.uvSource+"\n"}};e.prototype.setVertexConst=function(e,t,r,i,a){if(t===void 0){t=0}if(r===void 0){r=0}if(i===void 0){i=0}if(a===void 0){a=0}e*=4;this.vertexConstantData[e++]=t;this.vertexConstantData[e++]=r;this.vertexConstantData[e++]=i;this.vertexConstantData[e]=a};e.prototype.setVertexConstFromArray=function(e,t){e*=4;for(var r=0;r<t.length;r++)this.vertexConstantData[e++]=t[r]};e.prototype.setVertexConstFromMatrix=function(e,t){e*=4;var r=t.rawData;this.vertexConstantData[e++]=r[0];this.vertexConstantData[e++]=r[4];this.vertexConstantData[e++]=r[8];this.vertexConstantData[e++]=r[12];this.vertexConstantData[e++]=r[1];this.vertexConstantData[e++]=r[5];this.vertexConstantData[e++]=r[9];this.vertexConstantData[e++]=r[13];this.vertexConstantData[e++]=r[2];this.vertexConstantData[e++]=r[6];this.vertexConstantData[e++]=r[10];this.vertexConstantData[e++]=r[14];this.vertexConstantData[e++]=r[3];this.vertexConstantData[e++]=r[7];this.vertexConstantData[e++]=r[11];this.vertexConstantData[e]=r[15]};e.prototype.setFragmentConst=function(e,t,r,i,a){if(t===void 0){t=0}if(r===void 0){r=0}if(i===void 0){i=0}if(a===void 0){a=0}e*=4;this.fragmentConstantData[e++]=t;this.fragmentConstantData[e++]=r;this.fragmentConstantData[e++]=i;this.fragmentConstantData[e]=a};e._abstractionClassPool=new Object;return e}();r.ShaderBase=h},{"../shaders/compilers/CompilerBase":"awayjs-renderergl/lib/shaders/compilers/CompilerBase","awayjs-core/lib/errors/ArgumentError":undefined,"awayjs-core/lib/image/BlendMode":undefined,"awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined,"awayjs-stagegl/lib/base/ContextGLTriangleFace":undefined}],"awayjs-renderergl/lib/shaders/ShaderRegisterCache":[function(e,t,r){"use strict";var i=e("../shaders/RegisterPool");var a=e("../shaders/ShaderRegisterElement");var s=function(){function e(e){this._numUsedVertexConstants=0;this._numUsedFragmentConstants=0;this._numUsedStreams=0;this._numUsedTextures=0;this._numUsedVaryings=0;this._profile=e;this.reset()}e.prototype.reset=function(){this._fragmentTempCache=new i.RegisterPool("ft",8,false);this._vertexTempCache=new i.RegisterPool("vt",8,false);this._varyingCache=new i.RegisterPool("v",8);this._textureCache=new i.RegisterPool("fs",8);this._vertexAttributesCache=new i.RegisterPool("va",8);this._fragmentConstantsCache=new i.RegisterPool("fc",28);this._vertexConstantsCache=new i.RegisterPool("vc",128);this._fragmentOutputRegister=new a.ShaderRegisterElement("oc",-1);this._vertexOutputRegister=new a.ShaderRegisterElement("op",-1);this._numUsedVertexConstants=0;this._numUsedStreams=0;this._numUsedTextures=0;this._numUsedVaryings=0;this._numUsedFragmentConstants=0};e.prototype.dispose=function(){this._fragmentTempCache.dispose();this._vertexTempCache.dispose();this._varyingCache.dispose();this._fragmentConstantsCache.dispose();this._vertexAttributesCache.dispose();this._fragmentTempCache=null;this._vertexTempCache=null;this._varyingCache=null;this._fragmentConstantsCache=null;this._vertexAttributesCache=null;this._fragmentOutputRegister=null;this._vertexOutputRegister=null};e.prototype.addFragmentTempUsages=function(e,t){this._fragmentTempCache.addUsage(e,t)};e.prototype.removeFragmentTempUsage=function(e){this._fragmentTempCache.removeUsage(e)};e.prototype.addVertexTempUsages=function(e,t){this._vertexTempCache.addUsage(e,t)};e.prototype.removeVertexTempUsage=function(e){this._vertexTempCache.removeUsage(e)};e.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()};e.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()};e.prototype.getFreeVarying=function(){++this._numUsedVaryings;return this._varyingCache.requestFreeVectorReg()};e.prototype.getFreeFragmentConstant=function(){++this._numUsedFragmentConstants;return this._fragmentConstantsCache.requestFreeVectorReg()};e.prototype.getFreeVertexConstant=function(){++this._numUsedVertexConstants;return this._vertexConstantsCache.requestFreeVectorReg()};e.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()};e.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()};e.prototype.getFreeVertexAttribute=function(){++this._numUsedStreams;return this._vertexAttributesCache.requestFreeVectorReg()};e.prototype.getFreeTextureReg=function(){++this._numUsedTextures;return this._textureCache.requestFreeVectorReg()};Object.defineProperty(e.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:true,configurable:true});return e}();r.ShaderRegisterCache=s},{"../shaders/RegisterPool":"awayjs-renderergl/lib/shaders/RegisterPool","../shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement"}],"awayjs-renderergl/lib/shaders/ShaderRegisterData":[function(e,t,r){"use strict";var i=function(){function e(){this.textures=new Array;this.animatableAttributes=new Array;this.animationTargetRegisters=new Array}return e}();r.ShaderRegisterData=i},{}],"awayjs-renderergl/lib/shaders/ShaderRegisterElement":[function(e,t,r){"use strict";var i=function(){function e(t,r,i){if(i===void 0){i=-1}this._component=i;this._regName=t;this._index=r;this._toStr=this._regName;if(this._index>=0)this._toStr+=this._index;if(i>-1)this._toStr+="."+e.COMPONENTS[i]}e.prototype.toString=function(){return this._toStr};Object.defineProperty(e.prototype,"regName",{get:function(){return this._regName},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:true,configurable:true});e.COMPONENTS=["x","y","z","w"];return e}();r.ShaderRegisterElement=i},{}],"awayjs-renderergl/lib/shaders/compilers/CompilerBase":[function(e,t,r){"use strict";var i=e("../../shaders/ShaderRegisterCache");var a=e("../../shaders/ShaderRegisterData");var s=function(){function e(e,t,r){this._pVertexCode="";this._pFragmentCode="";this._pPostAnimationFragmentCode="";this._pElementsClass=e;this._pRenderPass=t;this._pShader=r;this._pSharedRegisters=new a.ShaderRegisterData;this._pRegisterCache=new i.ShaderRegisterCache(r.profile)}e.prototype.compile=function(){this._pShader.reset();this._pShader._iIncludeDependencies();this.pInitRegisterIndices();this.pCompileDependencies();this._pVertexCode+=this._pRenderPass._iGetVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pPostAnimationFragmentCode+=this._pRenderPass._iGetFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);if(this._pShader.usesColorTransform)this.compileColorTransformCode();else this._pShader.colorTransformIndex=-1;this._pPostAnimationFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister+", "+this._pSharedRegisters.shadedTarget+"\n";this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget)};e.prototype.compileColorTransformCode=function(){var e=this._pRegisterCache.getFreeFragmentConstant();var t=this._pRegisterCache.getFreeFragmentConstant();this._pShader.colorTransformIndex=e.index*4;this._pPostAnimationFragmentCode+="mul "+this._pSharedRegisters.shadedTarget+", "+this._pSharedRegisters.shadedTarget+", "+e+"\n";this._pPostAnimationFragmentCode+="add "+this._pSharedRegisters.shadedTarget+", "+this._pSharedRegisters.shadedTarget+", "+t+"\n"};e.prototype.pCompileDependencies=function(){this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1);if(this._pShader.globalPosDependencies>0)this.compileGlobalPositionCode();if(this._pShader.usesPositionFragment)this.compilePositionCode();if(this._pShader.usesCurves)this.compileCurvesCode();if(this._pShader.uvDependencies>0)this.compileUVCode();if(this._pShader.secondaryUVDependencies>0)this.compileSecondaryUVCode();if(this._pShader.normalDependencies>0)this.compileNormalCode();if(this._pShader.viewDirDependencies>0)this.compileViewDirCode();this._pVertexCode+=this._pElementsClass._iGetVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pElementsClass._iGetFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pVertexCode+=this._pRenderPass._iGetPreLightingVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pRenderPass._iGetPreLightingFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters)};e.prototype.compileGlobalPositionCode=function(){this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp(),this._pShader.globalPosDependencies);var e=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pShader.sceneMatrixIndex=e.index*4;this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex+", "+this._pSharedRegisters.animatedPosition+", "+e+"\n";if(this._pShader.usesGlobalPosFragment){this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying+", "+this._pSharedRegisters.globalPositionVertex+"\n"}};e.prototype.compilePositionCode=function(){this._pSharedRegisters.positionVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.positionVarying+", "+this._pSharedRegisters.animatedPosition+"\n"};e.prototype.compileCurvesCode=function(){this._pSharedRegisters.curvesInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.curvesIndex=this._pSharedRegisters.curvesInput.index;this._pSharedRegisters.curvesVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.curvesVarying+", "+this._pSharedRegisters.curvesInput+"\n";var e=this._pRegisterCache.getFreeFragmentSingleTemp();this._pFragmentCode+="mul "+e+", "+this._pSharedRegisters.curvesVarying+".y, "+this._pSharedRegisters.curvesVarying+".y\n"+"sub "+e+", "+e+", "+this._pSharedRegisters.curvesVarying+".z\n"+"mul "+e+", "+e+", "+this._pSharedRegisters.curvesVarying+".x\n"+"kil "+e+"\n"};e.prototype.compileUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShader.uvIndex=e.index;var t=this._pSharedRegisters.uvVarying=this._pRegisterCache.getFreeVarying();if(this._pShader.usesUVTransform){var r=this._pRegisterCache.getFreeVertexConstant();var i=this._pRegisterCache.getFreeVertexConstant();this._pShader.uvMatrixIndex=r.index*4;this._pVertexCode+="dp4 "+t+".x, "+e+", "+r+"\n"+"dp4 "+t+".y, "+e+", "+i+"\n"+"mov "+t+".zw, "+e+".zw \n"}else{this._pShader.uvMatrixIndex=-1;this._pSharedRegisters.uvTarget=t;this._pSharedRegisters.uvSource=e}};e.prototype.compileSecondaryUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShader.secondaryUVIndex=e.index;this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.secondaryUVVarying+", "+e+"\n"};e.prototype.compileViewDirCode=function(){var e=this._pRegisterCache.getFreeVertexConstant();this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pShader.viewDirDependencies);this._pShader.cameraPositionIndex=e.index*4;if(this._pShader.usesTangentSpace){var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+t+", "+e+", "+this._pSharedRegisters.animatedPosition+"\n"+"m33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+t+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.animatedPosition+".w\n"}else{this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+e+", "+this._pSharedRegisters.globalPositionVertex+"\n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex)}this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\n"+"mov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w\n"};e.prototype.compileNormalCode=function(){this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pShader.normalDependencies);if(this._pShader.outputsNormals&&!this._pShader.outputsTangentNormals){this._pVertexCode+=this._pRenderPass._iGetNormalVertexCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pRenderPass._iGetNormalFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters);return}var e;if(!this._pShader.outputsNormals||!this._pShader.usesTangentSpace){e=new Array(3);e[0]=this._pRegisterCache.getFreeVertexConstant();e[1]=this._pRegisterCache.getFreeVertexConstant();e[2]=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pShader.sceneNormalMatrixIndex=e[0].index*4;this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying()}if(this._pShader.outputsNormals){if(this._pShader.usesTangentSpace){this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\n"+"nrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\n"+"crs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n";this._pFragmentCode+=this._pRenderPass._iGetNormalFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters)}else{this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="m33 "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\n"+"nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+t+"\n"+"m33 "+t+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\n"+"nrm "+this._pSharedRegisters.animatedTangent+".xyz, "+t+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".x  \n"+"mov "+this._pSharedRegisters.tangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".x  \n"+"mov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".y  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".y  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"mov "+this._pSharedRegisters.normalVarying+".x, "+this._pSharedRegisters.animatedTangent+".z  \n"+"mov "+this._pSharedRegisters.normalVarying+".z, "+this._pSharedRegisters.animatedNormal+".z  \n"+"mov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"crs "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".y, "+t+".x    \n"+"mov "+this._pSharedRegisters.bitangentVarying+".y, "+t+".y  \n"+"mov "+this._pSharedRegisters.normalVarying+".y, "+t+".z    \n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);var r;var i;var a;r=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(r,1);i=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(i,1);a=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(a,1);this._pFragmentCode+="nrm "+r+".xyz, "+this._pSharedRegisters.tangentVarying+"\n"+"mov "+r+".w, "+this._pSharedRegisters.tangentVarying+".w	\n"+"nrm "+i+".xyz, "+this._pSharedRegisters.bitangentVarying+"\n"+"nrm "+a+".xyz, "+this._pSharedRegisters.normalVarying+"\n";this._pFragmentCode+=this._pRenderPass._iGetNormalFragmentCode(this._pShader,this._pRegisterCache,this._pSharedRegisters)+"m33 "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalFragment+", "+r+"\n"+"mov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n";this._pRegisterCache.removeFragmentTempUsage(i);this._pRegisterCache.removeFragmentTempUsage(r);this._pRegisterCache.removeFragmentTempUsage(a)}}else{this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\n"+"mov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w\n";this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\n"+"mov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n";if(this._pShader.tangentDependencies>0){this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+this._pSharedRegisters.tangentVarying+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.animatedTangent+".w\n"}}if(!this._pShader.usesTangentSpace)this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal)};e.prototype.pInitRegisterIndices=function(){this._pShader.pInitRegisterIndices();this._pSharedRegisters.animatedPosition=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedPosition,1);this._pSharedRegisters.animatableAttributes.push(this._pRegisterCache.getFreeVertexAttribute());this._pSharedRegisters.animationTargetRegisters.push(this._pSharedRegisters.animatedPosition);this._pVertexCode="";this._pFragmentCode="";this._pPostAnimationFragmentCode="";if(this._pShader.usesCommonData||this._pShader.normalDependencies>0){this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant();this._pShader.commonsDataIndex=this._pSharedRegisters.commons.index*4}if(this._pShader.tangentDependencies>0||this._pShader.outputsNormals){this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.tangentIndex=this._pSharedRegisters.tangentInput.index;this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1);if(this._pShader.usesTangentSpace){this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1)}this._pSharedRegisters.animatableAttributes.push(this._pSharedRegisters.tangentInput);this._pSharedRegisters.animationTargetRegisters.push(this._pSharedRegisters.animatedTangent)}if(this._pShader.normalDependencies>0){this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.normalIndex=this._pSharedRegisters.normalInput.index;this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1);this._pSharedRegisters.animatableAttributes.push(this._pSharedRegisters.normalInput);this._pSharedRegisters.animationTargetRegisters.push(this._pSharedRegisters.animatedNormal)}if(this._pShader.colorDependencies>0){this._pSharedRegisters.colorInput=this._pRegisterCache.getFreeVertexAttribute();this._pShader.colorBufferIndex=this._pSharedRegisters.colorInput.index;this._pSharedRegisters.colorVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.colorVarying+", "+this._pSharedRegisters.colorInput+"\n"}};e.prototype.dispose=function(){this._pRegisterCache.dispose();this._pRegisterCache=null;this._pSharedRegisters=null};Object.defineProperty(e.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"postAnimationFragmentCode",{get:function(){return this._pPostAnimationFragmentCode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget},enumerable:true,configurable:true});return e}();r.CompilerBase=s},{"../../shaders/ShaderRegisterCache":"awayjs-renderergl/lib/shaders/ShaderRegisterCache","../../shaders/ShaderRegisterData":"awayjs-renderergl/lib/shaders/ShaderRegisterData"}],"awayjs-renderergl/lib/shaders/compilers/LightingCompiler":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../../shaders/compilers/CompilerBase");var s=function(e){i(t,e);function t(t,r,i){e.call(this,t,r,i);this._shaderLightingObject=i;this._lightingPass=r}t.prototype.pCompileDependencies=function(){e.prototype.pCompileDependencies.call(this);if(this._shaderLightingObject.usesShadows)this.pCompileShadowCode();if(this._shaderLightingObject.usesLights){this.initLightRegisters();this.compileLightCode()}if(this._shaderLightingObject.usesProbes)this.compileLightProbeCode();this._pVertexCode+=this._lightingPass._iGetPostLightingVertexCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._lightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters)};t.prototype.pCompileShadowCode=function(){if(this._shaderLightingObject.normalDependencies>0){this._pSharedRegisters.shadowTarget=this._pSharedRegisters.normalFragment}else{this._pSharedRegisters.shadowTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget,1)}};t.prototype.initLightRegisters=function(){var e,t;if(this._dirLightVertexConstants){t=this._dirLightVertexConstants.length;for(e=0;e<t;++e){this._dirLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant();if(this._shaderLightingObject.lightVertexConstantIndex==-1)this._shaderLightingObject.lightVertexConstantIndex=this._dirLightVertexConstants[e].index*4}}if(this._pointLightVertexConstants){t=this._pointLightVertexConstants.length;for(e=0;e<t;++e){this._pointLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant();if(this._shaderLightingObject.lightVertexConstantIndex==-1)this._shaderLightingObject.lightVertexConstantIndex=this._pointLightVertexConstants[e].index*4}}t=this._dirLightFragmentConstants.length;for(e=0;e<t;++e){this._dirLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant();if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=this._dirLightFragmentConstants[e].index*4}t=this._pointLightFragmentConstants.length;for(e=0;e<t;++e){this._pointLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant();if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=this._pointLightFragmentConstants[e].index*4}};t.prototype.compileLightCode=function(){var e;var t;var r;var i;var a=0;var s=0;var n=this._shaderLightingObject.usesLightsForSpecular;var o=this._shaderLightingObject.usesLightsForDiffuse;for(var l=0;l<this._shaderLightingObject.numDirectionalLights;++l){if(this._shaderLightingObject.usesTangentSpace){i=this._dirLightVertexConstants[a++];var h=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+h+".xyz, "+i+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+h+".w, "+i+".w\n";i=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addVertexTempUsages(i,1);this._pFragmentCode+="nrm "+i+".xyz, "+h+"\n"+"mov "+i+".w, "+h+".w\n"}else{i=this._dirLightFragmentConstants[s++]}e=this._dirLightFragmentConstants[s++];t=this._dirLightFragmentConstants[s++];if(o)this._pFragmentCode+=this._lightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters);if(n)this._pFragmentCode+=this._lightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,i,t,this._pRegisterCache,this._pSharedRegisters);if(this._shaderLightingObject.usesTangentSpace)this._pRegisterCache.removeVertexTempUsage(i)}a=0;s=0;for(var l=0;l<this._shaderLightingObject.numPointLights;++l){if(this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment)r=this._pointLightVertexConstants[a++];else r=this._pointLightFragmentConstants[s++];e=this._pointLightFragmentConstants[s++];t=this._pointLightFragmentConstants[s++];i=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(i,1);var h;if(this._shaderLightingObject.usesTangentSpace){h=this._pRegisterCache.getFreeVarying();var c=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+c+", "+r+", "+this._pSharedRegisters.animatedPosition+"\n"+"m33 "+h+".xyz, "+c+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+h+".w, "+this._pSharedRegisters.animatedPosition+".w\n"}else if(!this._shaderLightingObject.usesGlobalPosFragment){h=this._pRegisterCache.getFreeVarying();this._pVertexCode+="sub "+h+", "+r+", "+this._pSharedRegisters.globalPositionVertex+"\n"}else{h=i;this._pFragmentCode+="sub "+i+", "+r+", "+this._pSharedRegisters.globalPositionVarying+"\n"}if(this._shaderLightingObject.usesLightFallOff){this._pFragmentCode+="dp3 "+i+".w, "+h+", "+h+"\n"+"sub "+i+".w, "+i+".w, "+e+".w\n"+"mul "+i+".w, "+i+".w, "+t+".w\n"+"sat "+i+".w, "+i+".w\n"+"sub "+i+".w, "+this._pSharedRegisters.commons+".w, "+i+".w\n"+"nrm "+i+".xyz, "+h+"\n"}else{this._pFragmentCode+="nrm "+i+".xyz, "+h+"\n"+"mov "+i+".w, "+h+".w\n"}if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=r.index*4;if(o)this._pFragmentCode+=this._lightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters);if(n)this._pFragmentCode+=this._lightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,i,t,this._pRegisterCache,this._pSharedRegisters);this._pRegisterCache.removeFragmentTempUsage(i)}};t.prototype.compileLightProbeCode=function(){var e;var t=[".x",".y",".z",".w"];var r=new Array;var i;var a;var s=this._shaderLightingObject.usesProbesForSpecular;var n=this._shaderLightingObject.usesProbesForDiffuse;if(n)this._shaderLightingObject.lightProbeDiffuseIndices=new Array;if(s)this._shaderLightingObject.lightProbeSpecularIndices=new Array;for(i=0;i<this._pNumProbeRegisters;++i){
r[i]=this._pRegisterCache.getFreeFragmentConstant();if(i==0)this._shaderLightingObject.probeWeightsIndex=r[i].index*4}for(i=0;i<this._shaderLightingObject.numLightProbes;++i){e=r[Math.floor(i/4)].toString()+t[i%4];if(n){a=this._pRegisterCache.getFreeTextureReg();this._shaderLightingObject.lightProbeDiffuseIndices[i]=a.index;this._pFragmentCode+=this._lightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject,a,e,this._pRegisterCache,this._pSharedRegisters)}if(s){a=this._pRegisterCache.getFreeTextureReg();this._shaderLightingObject.lightProbeSpecularIndices[i]=a.index;this._pFragmentCode+=this._lightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject,a,e,this._pRegisterCache,this._pSharedRegisters)}}};t.prototype.pInitRegisterIndices=function(){e.prototype.pInitRegisterIndices.call(this);this._shaderLightingObject.lightVertexConstantIndex=-1;this._shaderLightingObject.lightFragmentConstantIndex=-1;this._shaderLightingObject.probeWeightsIndex=-1;this._pNumProbeRegisters=Math.ceil(this._shaderLightingObject.numLightProbes/4);if(this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment){this._pointLightVertexConstants=new Array(this._shaderLightingObject.numPointLights);this._pointLightFragmentConstants=new Array(this._shaderLightingObject.numPointLights*2)}else{this._pointLightFragmentConstants=new Array(this._shaderLightingObject.numPointLights*3)}if(this._shaderLightingObject.usesTangentSpace){this._dirLightVertexConstants=new Array(this._shaderLightingObject.numDirectionalLights);this._dirLightFragmentConstants=new Array(this._shaderLightingObject.numDirectionalLights*2)}else{this._dirLightFragmentConstants=new Array(this._shaderLightingObject.numDirectionalLights*3)}};return t}(a.CompilerBase);r.LightingCompiler=s},{"../../shaders/compilers/CompilerBase":"awayjs-renderergl/lib/shaders/compilers/CompilerBase"}],"awayjs-renderergl/lib/shaders":[function(e,t,r){"use strict";var i=e("./shaders/compilers/CompilerBase");r.CompilerBase=i.CompilerBase;var a=e("./shaders/compilers/LightingCompiler");r.LightingCompiler=a.LightingCompiler;var s=e("./shaders/LightingShader");r.LightingShader=s.LightingShader;var n=e("./shaders/RegisterPool");r.RegisterPool=n.RegisterPool;var o=e("./shaders/ShaderBase");r.ShaderBase=o.ShaderBase;var l=e("./shaders/ShaderRegisterCache");r.ShaderRegisterCache=l.ShaderRegisterCache;var h=e("./shaders/ShaderRegisterData");r.ShaderRegisterData=h.ShaderRegisterData;var c=e("./shaders/ShaderRegisterElement");r.ShaderRegisterElement=c.ShaderRegisterElement},{"./shaders/LightingShader":"awayjs-renderergl/lib/shaders/LightingShader","./shaders/RegisterPool":"awayjs-renderergl/lib/shaders/RegisterPool","./shaders/ShaderBase":"awayjs-renderergl/lib/shaders/ShaderBase","./shaders/ShaderRegisterCache":"awayjs-renderergl/lib/shaders/ShaderRegisterCache","./shaders/ShaderRegisterData":"awayjs-renderergl/lib/shaders/ShaderRegisterData","./shaders/ShaderRegisterElement":"awayjs-renderergl/lib/shaders/ShaderRegisterElement","./shaders/compilers/CompilerBase":"awayjs-renderergl/lib/shaders/compilers/CompilerBase","./shaders/compilers/LightingCompiler":"awayjs-renderergl/lib/shaders/compilers/LightingCompiler"}],"awayjs-renderergl/lib/sort/IEntitySorter":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/sort/RenderableMergeSort":[function(e,t,r){"use strict";var i=function(){function e(){}e.prototype.sortBlendedRenderables=function(e){var t;var r;var i;if(!e||!e.next){return e}i=e;r=e.next;while(r){r=r.next;if(r){i=i.next;r=r.next}}t=i.next;i.next=null;e=this.sortBlendedRenderables(e);t=this.sortBlendedRenderables(t);var a;var s;var n;if(!e)return t;if(!t)return e;while(e&&t){if(e.zIndex<t.zIndex){n=e;e=e.next}else{n=t;t=t.next}if(!a)a=n;else s.next=n;s=n}if(e)s.next=e;else if(t)s.next=t;return a};e.prototype.sortOpaqueRenderables=function(e){var t;var r,i;if(!e||!e.next){return e}i=e;r=e.next;while(r){r=r.next;if(r){i=i.next;r=r.next}}t=i.next;i.next=null;e=this.sortOpaqueRenderables(e);t=this.sortOpaqueRenderables(t);var a;var s;var n;var o=0;if(!e)return t;if(!t)return e;while(e&&t&&e!=null&&t!=null){var l=e.renderOrderId;var h=t.renderOrderId;if(l==h){var c=e.surfaceID;var u=t.surfaceID;if(c==u){if(e.zIndex<t.zIndex)o=1;else o=-1}else if(c>u){o=1}else{o=-1}}else if(l>h){o=1}else{o=-1}if(o<0){n=e;e=e.next}else{n=t;t=t.next}if(!a){a=n;s=n}else{s.next=n;s=n}}if(e)s.next=e;else if(t)s.next=t;return a};return e}();r.RenderableMergeSort=i},{}],"awayjs-renderergl/lib/sort/RenderableNullSort":[function(e,t,r){"use strict";var i=function(){function e(){}e.prototype.sortBlendedRenderables=function(e){return e};e.prototype.sortOpaqueRenderables=function(e){return e};return e}();r.RenderableNullSort=i},{}],"awayjs-renderergl/lib/sort":[function(e,t,r){"use strict";var i=e("./sort/RenderableMergeSort");r.RenderableMergeSort=i.RenderableMergeSort;var a=e("./sort/RenderableNullSort");r.RenderableNullSort=a.RenderableNullSort},{"./sort/RenderableMergeSort":"awayjs-renderergl/lib/sort/RenderableMergeSort","./sort/RenderableNullSort":"awayjs-renderergl/lib/sort/RenderableNullSort"}],"awayjs-renderergl/lib/surfaces/GL_BasicMaterialSurface":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/image/BlendMode");var s=e("../surfaces/passes/BasicMaterialPass");var n=e("../surfaces/GL_SurfaceBase");var o=function(e){i(t,e);function t(t,r,i){e.call(this,t,r,i);this._material=t;this._pAddPass(this._pass=new s.BasicMaterialPass(this,t,r,this._stage))}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._material=null};t.prototype._pUpdateRender=function(){e.prototype._pUpdateRender.call(this);this._pRequiresBlending=this._material.blendMode!=a.BlendMode.NORMAL||this._material.alphaBlending||this._material.colorTransform&&this._material.colorTransform.alphaMultiplier<1;this._pass.preserveAlpha=this._material.preserveAlpha;this._pass.shader.setBlendMode(this._surface.blendMode==a.BlendMode.NORMAL&&this._pRequiresBlending?a.BlendMode.LAYER:this._material.blendMode)};return t}(n.GL_SurfaceBase);r.GL_BasicMaterialSurface=o},{"../surfaces/GL_SurfaceBase":"awayjs-renderergl/lib/surfaces/GL_SurfaceBase","../surfaces/passes/BasicMaterialPass":"awayjs-renderergl/lib/surfaces/passes/BasicMaterialPass","awayjs-core/lib/image/BlendMode":undefined}],"awayjs-renderergl/lib/surfaces/GL_DepthSurface":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../surfaces/GL_SurfacePassBase");var s=e("../shaders/ShaderBase");var n=function(e){i(t,e);function t(t,r,i){e.call(this,t,r,i);this._shader=new s.ShaderBase(r,this,this._stage);this._pAddPass(this)}t.prototype.invalidate=function(){e.prototype.invalidate.call(this);this._textureVO=this._surface.getTextureAt(0)?this._shader.getAbstraction(this._surface.getTextureAt(0)):null};t.prototype._iIncludeDependencies=function(t){e.prototype._iIncludeDependencies.call(this,t);t.projectionDependencies++;if(t.alphaThreshold>0)t.uvDependencies++};t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var r=this._fragmentConstantsIndex;var i=t.fragmentConstantData;i[r]=1;i[r+1]=255;i[r+2]=65025;i[r+3]=16581375;i[r+4]=1/255;i[r+5]=1/255;i[r+6]=1/255;i[r+7]=0};t.prototype._iGetFragmentCode=function(e,t,r){var i="";var a=r.shadedTarget;var s=t.getFreeFragmentConstant();var n=t.getFreeFragmentConstant();this._fragmentConstantsIndex=s.index*4;var o=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(o,1);var l=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(l,1);i+="div "+o+", "+r.projectionFragment+", "+r.projectionFragment+".w\n"+"mul "+o+", "+s+", "+o+".z\n"+"frc "+o+", "+o+"\n"+"mul "+l+", "+o+".yzww, "+n+"\n";if(this._textureVO&&e.alphaThreshold>0){var h=t.getFreeFragmentVectorTemp();i+=this._textureVO._iGetFragmentCode(h,t,r,r.uvVarying);var c=t.getFreeFragmentConstant();i+="sub "+h+".w, "+h+".w, "+c+".x\n"+"kil "+h+".w\n"}i+="sub "+a+", "+o+", "+l+"\n";t.removeFragmentTempUsage(o);t.removeFragmentTempUsage(l);return i};t.prototype._iActivate=function(t){e.prototype._iActivate.call(this,t);if(this._textureVO&&this._shader.alphaThreshold>0){this._textureVO.activate(this);this._shader.fragmentConstantData[this._fragmentConstantsIndex+8]=this._shader.alphaThreshold}};return t}(a.GL_SurfacePassBase);r.GL_DepthSurface=n},{"../shaders/ShaderBase":"awayjs-renderergl/lib/shaders/ShaderBase","../surfaces/GL_SurfacePassBase":"awayjs-renderergl/lib/surfaces/GL_SurfacePassBase"}],"awayjs-renderergl/lib/surfaces/GL_DistanceSurface":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../surfaces/GL_SurfacePassBase");var s=e("../shaders/ShaderBase");var n=function(e){i(t,e);function t(t,r,i){e.call(this,t,r,i);this._shader=new s.ShaderBase(r,this,this._stage);this._pAddPass(this)}t.prototype.invalidate=function(){e.prototype.invalidate.call(this);this._textureVO=this._surface.getTextureAt(0)?this._shader.getAbstraction(this._surface.getTextureAt(0)):null};t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var r=this._fragmentConstantsIndex;var i=t.fragmentConstantData;i[r+4]=1/255;i[r+5]=1/255;i[r+6]=1/255;i[r+7]=0};t.prototype._iIncludeDependencies=function(t){e.prototype._iIncludeDependencies.call(this,t);t.projectionDependencies++;t.viewDirDependencies++;if(t.alphaThreshold>0)t.uvDependencies++;if(t.viewDirDependencies>0)t.globalPosDependencies++};t.prototype._iGetFragmentCode=function(e,t,r){var i;var a=r.shadedTarget;var s=t.getFreeFragmentConstant();var n=t.getFreeFragmentConstant();this._fragmentConstantsIndex=s.index*4;var o=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(o,1);var l=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(l,1);i="dp3 "+o+".z, "+r.viewDirVarying+".xyz, "+r.viewDirVarying+".xyz\n"+"mul "+o+", "+s+", "+o+".z\n"+"frc "+o+", "+o+"\n"+"mul "+l+", "+o+".yzww, "+n+"\n";if(this._textureVO&&e.alphaThreshold>0){var h=t.getFreeFragmentVectorTemp();i+=this._textureVO._iGetFragmentCode(h,t,r,r.uvVarying);var c=t.getFreeFragmentConstant();i+="sub "+h+".w, "+h+".w, "+c+".x\n"+"kil "+h+".w\n"}i+="sub "+a+", "+o+", "+l+"\n";return i};t.prototype._iActivate=function(t){e.prototype._iActivate.call(this,t);var r=t.projection.far;r=1/(2*r*r);var i=this._fragmentConstantsIndex;var a=this._shader.fragmentConstantData;a[i]=1*r;a[i+1]=255*r;a[i+2]=65025*r;a[i+3]=16581375*r;if(this._textureVO&&this._shader.alphaThreshold>0){this._textureVO.activate(this);a[i+8]=this._shader.alphaThreshold}};return t}(a.GL_SurfacePassBase);r.GL_DistanceSurface=n},{"../shaders/ShaderBase":"awayjs-renderergl/lib/shaders/ShaderBase","../surfaces/GL_SurfacePassBase":"awayjs-renderergl/lib/surfaces/GL_SurfacePassBase"}],"awayjs-renderergl/lib/surfaces/GL_SkyboxSurface":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/AssetEvent");var s=e("awayjs-core/lib/image/BlendMode");var n=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var o=e("../surfaces/GL_SurfacePassBase");var l=e("../shaders/ShaderBase");var h=function(e){i(t,e);function t(t,r,i){e.call(this,t,r,i);this._skybox=t;this._shader=new l.ShaderBase(r,this,this._stage);this._texture=this._shader.getAbstraction(this._skybox.texture);this._pAddPass(this)}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._texture.onClear(new a.AssetEvent(a.AssetEvent.CLEAR,this._skybox.texture));this._texture=null;this._skybox=null};t.prototype._pUpdateRender=function(){e.prototype._pUpdateRender.call(this);this._pRequiresBlending=this._surface.blendMode!=s.BlendMode.NORMAL;this.shader.setBlendMode(this._surface.blendMode==s.BlendMode.NORMAL&&this._pRequiresBlending?s.BlendMode.LAYER:this._surface.blendMode)};t.prototype._iIncludeDependencies=function(t){e.prototype._iIncludeDependencies.call(this,t);t.usesPositionFragment=true};t.prototype._iGetFragmentCode=function(e,t,r){return this._texture._iGetFragmentCode(r.shadedTarget,t,r,r.positionVarying)};t.prototype._setRenderState=function(t,r,i){e.prototype._setRenderState.call(this,t,r,i);this._texture._setRenderState(t)};t.prototype._iActivate=function(t){e.prototype._iActivate.call(this,t);this._stage.context.setDepthTest(false,n.ContextGLCompareMode.LESS);this._texture.activate(this)};return t}(o.GL_SurfacePassBase);r.GL_SkyboxSurface=h},{"../shaders/ShaderBase":"awayjs-renderergl/lib/shaders/ShaderBase","../surfaces/GL_SurfacePassBase":"awayjs-renderergl/lib/surfaces/GL_SurfacePassBase","awayjs-core/lib/events/AssetEvent":undefined,"awayjs-core/lib/image/BlendMode":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-renderergl/lib/surfaces/GL_SurfaceBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/library/AbstractionBase");var s=e("awayjs-display/lib/events/SurfaceEvent");var n=e("awayjs-display/lib/materials/MaterialBase");var o=e("awayjs-display/lib/managers/DefaultMaterialManager");var l=e("../events/PassEvent");var h=function(e){i(t,e);function t(t,r,i){var a=this;e.call(this,t,i);this.usages=0;this._forceSeparateMVP=false;this._usesAnimation=true;this._invalidAnimation=true;this._invalidRender=true;this._invalidImages=true;this._passes=new Array;this._imageIndices=new Object;this._pRequiresBlending=false;this.images=new Array;this.samplers=new Array;this._onInvalidateAnimationDelegate=function(e){return a.onInvalidateAnimation(e)};this._onInvalidatePassesDelegate=function(e){return a.onInvalidatePasses(e)};this.surfaceID=t.id;this._surface=t;this._elementsClass=r;this._stage=i.stage;this._surface.addEventListener(s.SurfaceEvent.INVALIDATE_ANIMATION,this._onInvalidateAnimationDelegate);this._surface.addEventListener(s.SurfaceEvent.INVALIDATE_PASSES,this._onInvalidatePassesDelegate);this._onPassInvalidateDelegate=function(e){return a.onPassInvalidate(e)}}Object.defineProperty(t.prototype,"requiresBlending",{get:function(){return this._pRequiresBlending},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderOrderId",{get:function(){if(this._invalidAnimation)this._updateAnimation();return this._renderOrderId},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"passes",{get:function(){if(this._invalidAnimation)this._updateAnimation();return this._passes},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"surface",{get:function(){return this._surface},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numImages",{get:function(){if(this._invalidImages)this._updateImages();return this._numImages},enumerable:true,configurable:true});t.prototype._iIncludeDependencies=function(e){this._elementsClass._iIncludeDependencies(e);e.alphaThreshold=this._surface.alphaThreshold;e.useImageRect=this._surface.imageRect;e.usesCurves=this._surface.curves;if(this._surface instanceof n.MaterialBase){var t=this._surface;e.useAlphaPremultiplied=t.alphaPremultiplied;e.useBothSides=t.bothSides;e.usesUVTransform=t.animateUVs;e.usesColorTransform=t.useColorTransform}};t.prototype.getImageIndex=function(e,t){if(t===void 0){t=0}if(this._invalidImages)this._updateImages();return this._imageIndices[e.id][t]};t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._surface=null;this._elementsClass=null;this._stage=null;var r=this._passes.length;for(var i=0;i<r;i++){this._passes[i].removeEventListener(l.PassEvent.INVALIDATE,this._onPassInvalidateDelegate);this._passes[i].dispose()}this._passes=null};t.prototype.onInvalidate=function(t){e.prototype.onInvalidate.call(this,t);this._invalidRender=true;this._invalidAnimation=true};t.prototype.onInvalidatePasses=function(e){var t=this._passes.length;for(var r=0;r<t;r++)this._passes[r].invalidate();this._invalidAnimation=true;this._invalidImages=true};t.prototype.onInvalidateAnimation=function(e){this._invalidAnimation=true};t.prototype._updateAnimation=function(){if(this._invalidRender)this._pUpdateRender();this._invalidAnimation=false;var e=this._getEnabledGPUAnimation();var t=0;var r=1;var i;var a=this._passes.length;for(var s=0;s<a;s++){i=this._passes[s].shader;i.usesAnimation=e;t+=i.programData.id*r;r*=1e3}if(this._usesAnimation!=e){this._usesAnimation=e;var n=this._surface.iOwners;var o=n.length;for(var l=0;l<o;l++)n[l].invalidateElements()}this._renderOrderId=t};t.prototype._updateImages=function(){this._invalidImages=false;var e=this._surface.getNumTextures();var t;var r;var i;var a;var s;var n=0;for(var l=0;l<e;l++){t=this._surface.getTextureAt(l);r=t.getNumImages();i=this._imageIndices[t.id]=new Array;for(var h=0;h<r;h++){a=t.getImageAt(h)||(this._surface.style?this._surface.style.getImageAt(t,h):null)||o.DefaultMaterialManager.getDefaultImage2D();this.images[n]=this._stage.getAbstraction(a);s=t.getSamplerAt(h)||(this._surface.style?this._surface.style.getSamplerAt(t,h):null)||o.DefaultMaterialManager.getDefaultSampler();this.samplers[n]=this._stage.getAbstraction(s);i[h]=n++}}this._numImages=n};t.prototype._pUpdateRender=function(){this._invalidRender=false};t.prototype._pRemovePass=function(e){e.removeEventListener(l.PassEvent.INVALIDATE,this._onPassInvalidateDelegate);this._passes.splice(this._passes.indexOf(e),1)};t.prototype._pClearPasses=function(){var e=this._passes.length;for(var t=0;t<e;++t)this._passes[t].removeEventListener(l.PassEvent.INVALIDATE,this._onPassInvalidateDelegate);this._passes.length=0};t.prototype._pAddPass=function(e){this._passes.push(e);e.addEventListener(l.PassEvent.INVALIDATE,this._onPassInvalidateDelegate)};t.prototype.onPassInvalidate=function(e){this._invalidAnimation=true};t.prototype._getEnabledGPUAnimation=function(){if(this._surface.animationSet){this._surface.animationSet.resetGPUCompatibility();var e=this._surface.iOwners;var t=e.length;var r=this._passes.length;var i;for(var a=0;a<r;a++){i=this._passes[a].shader;i.usesAnimation=false;for(var s=0;s<t;s++)if(e[s].animator)e[s].animator.testGPUCompatibility(i)}return!this._surface.animationSet.usesCPU}return false};return t}(a.AbstractionBase);r.GL_SurfaceBase=h},{"../events/PassEvent":"awayjs-renderergl/lib/events/PassEvent","awayjs-core/lib/library/AbstractionBase":undefined,"awayjs-display/lib/events/SurfaceEvent":undefined,"awayjs-display/lib/managers/DefaultMaterialManager":undefined,"awayjs-display/lib/materials/MaterialBase":undefined}],"awayjs-renderergl/lib/surfaces/GL_SurfacePassBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../events/PassEvent");var s=e("../surfaces/GL_SurfaceBase");var n=function(e){i(t,e);function t(){e.apply(this,arguments)}Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationSet",{get:function(){return this._surface.animationSet},enumerable:true,configurable:true});t.prototype.invalidate=function(){this._shader.invalidateProgram();this.dispatchEvent(new a.PassEvent(a.PassEvent.INVALIDATE,this))};t.prototype.dispose=function(){if(this._shader){this._shader.dispose();this._shader=null}};t.prototype._setRenderState=function(e,t,r){this._shader._setRenderState(e,t,r)};t.prototype._iActivate=function(e){this._shader._iActivate(e)};t.prototype._iDeactivate=function(){this._shader._iDeactivate()};t.prototype._iInitConstantData=function(e){};t.prototype._iGetPreLightingVertexCode=function(e,t,r){return""};t.prototype._iGetPreLightingFragmentCode=function(e,t,r){return""};t.prototype._iGetVertexCode=function(e,t,r){return""};t.prototype._iGetFragmentCode=function(e,t,r){return""};t.prototype._iGetNormalVertexCode=function(e,t,r){return""};t.prototype._iGetNormalFragmentCode=function(e,t,r){return""};return t}(s.GL_SurfaceBase);r.GL_SurfacePassBase=n},{"../events/PassEvent":"awayjs-renderergl/lib/events/PassEvent","../surfaces/GL_SurfaceBase":"awayjs-renderergl/lib/surfaces/GL_SurfaceBase"}],"awayjs-renderergl/lib/surfaces/ISurfaceClassGL":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/surfaces/SurfacePool":[function(e,t,r){"use strict";var i=function(){function e(e,t,r){if(r===void 0){r=null}this._abstractionPool=new Object;this._elementsClass=e;this._stage=t;this._surfaceClassGL=r}Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},enumerable:true,configurable:true});e.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new(this._surfaceClassGL||e._abstractionClassPool[t.assetType])(t,this._elementsClass,this))};e.prototype.clearAbstraction=function(e){delete this._abstractionPool[e.id]};e.registerAbstraction=function(t,r){e._abstractionClassPool[r.assetType]=t};e._abstractionClassPool=new Object;return e}();r.SurfacePool=i},{}],"awayjs-renderergl/lib/surfaces/passes/BasicMaterialPass":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/AssetEvent");var s=e("../../shaders/ShaderBase");var n=e("../../surfaces/passes/PassBase");var o=function(e){i(t,e);function t(t,r,i,a){e.call(this,t,r,i,a);this._diffuseR=1;this._diffuseG=1;this._diffuseB=1;this._diffuseA=1;this._shader=new s.ShaderBase(i,this,this._stage);this.invalidate()}t.prototype._iIncludeDependencies=function(t){e.prototype._iIncludeDependencies.call(this,t);if(this._textureVO!=null)t.uvDependencies++};t.prototype.invalidate=function(){e.prototype.invalidate.call(this);this._textureVO=this._surface.getTextureAt(0)?this._shader.getAbstraction(this._surface.getTextureAt(0)):null};t.prototype.dispose=function(){if(this._textureVO){this._textureVO.onClear(new a.AssetEvent(a.AssetEvent.CLEAR,this._surface.getTextureAt(0)));this._textureVO=null}e.prototype.dispose.call(this)};t.prototype._iGetFragmentCode=function(e,t,r){var i="";var a;if(this.preserveAlpha){a=t.getFreeFragmentSingleTemp();t.addFragmentTempUsages(a,1);i+="mov "+a+", "+r.shadedTarget+".w\n"}var s=r.shadedTarget;if(this._textureVO!=null){i+=this._textureVO._iGetFragmentCode(s,t,r,r.uvVarying);if(e.alphaThreshold>0){var n=t.getFreeFragmentConstant();this._fragmentConstantsIndex=n.index*4;i+="sub "+s+".w, "+s+".w, "+n+".x\n"+"kil "+s+".w\n"+"add "+s+".w, "+s+".w, "+n+".x\n"}}else if(e.colorBufferIndex!=-1){i+="mov "+s+", "+r.colorVarying+"\n"}else{var o=t.getFreeFragmentConstant();this._fragmentConstantsIndex=o.index*4;i+="mov "+s+", "+o+"\n"}if(this.preserveAlpha){i+="mul "+r.shadedTarget+".w, "+r.shadedTarget+".w, "+a+"\n";t.removeFragmentTempUsage(a)}return i};t.prototype._setRenderState=function(t,r,i){e.prototype._setRenderState.call(this,t,r,i);if(this._textureVO!=null)this._textureVO._setRenderState(t)};t.prototype._iActivate=function(t){e.prototype._iActivate.call(this,t);if(this._textureVO!=null){this._textureVO.activate(this._render);if(this._shader.alphaThreshold>0)this._shader.fragmentConstantData[this._fragmentConstantsIndex]=this._shader.alphaThreshold}else if(this._shader.colorBufferIndex==-1){var r=this._fragmentConstantsIndex;var i=this._shader.fragmentConstantData;i[r]=this._diffuseR;i[r+1]=this._diffuseG;i[r+2]=this._diffuseB;i[r+3]=this._diffuseA}};return t}(n.PassBase);r.BasicMaterialPass=o},{"../../shaders/ShaderBase":"awayjs-renderergl/lib/shaders/ShaderBase","../../surfaces/passes/PassBase":"awayjs-renderergl/lib/surfaces/passes/PassBase","awayjs-core/lib/events/AssetEvent":undefined}],"awayjs-renderergl/lib/surfaces/passes/ILightingPass":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/surfaces/passes/IPass":[function(e,t,r){"use strict"},{}],"awayjs-renderergl/lib/surfaces/passes/PassBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/events/EventDispatcher");var s=e("../../events/PassEvent");var n=function(e){i(t,e);function t(t,r,i,a){e.call(this);this._preserveAlpha=true;this._forceSeparateMVP=false;this._render=t;this._surface=r;this._elementsClass=i;this._stage=a}Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationSet",{get:function(){return this._surface.animationSet},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(e){if(this._preserveAlpha==e)return;this._preserveAlpha=e;this.invalidate()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(e){if(this._forceSeparateMVP==e)return;this._forceSeparateMVP=e;this.invalidate()},enumerable:true,configurable:true});t.prototype.getImageIndex=function(e,t){if(t===void 0){t=0}return this._render.getImageIndex(e,t)};t.prototype.invalidate=function(){this._shader.invalidateProgram();this.dispatchEvent(new s.PassEvent(s.PassEvent.INVALIDATE,this))};t.prototype.dispose=function(){this._render=null;this._surface=null;this._elementsClass=null;this._stage=null;if(this._shader){this._shader.dispose();this._shader=null}};t.prototype._setRenderState=function(e,t,r){this._shader._setRenderState(e,t,r)};t.prototype._iActivate=function(e){this._shader._iActivate(e)};t.prototype._iDeactivate=function(){this._shader._iDeactivate()};t.prototype._iIncludeDependencies=function(e){this._render._iIncludeDependencies(e);if(this._forceSeparateMVP)e.globalPosDependencies++};t.prototype._iInitConstantData=function(e){};t.prototype._iGetPreLightingVertexCode=function(e,t,r){return""};t.prototype._iGetPreLightingFragmentCode=function(e,t,r){return""};t.prototype._iGetVertexCode=function(e,t,r){return""};t.prototype._iGetFragmentCode=function(e,t,r){return""};t.prototype._iGetNormalVertexCode=function(e,t,r){return""};t.prototype._iGetNormalFragmentCode=function(e,t,r){return""};return t}(a.EventDispatcher);r.PassBase=n},{"../../events/PassEvent":"awayjs-renderergl/lib/events/PassEvent","awayjs-core/lib/events/EventDispatcher":undefined}],"awayjs-renderergl/lib/surfaces":[function(e,t,r){"use strict";var i=e("./surfaces/passes/BasicMaterialPass");r.BasicMaterialPass=i.BasicMaterialPass;var a=e("./surfaces/passes/PassBase");r.PassBase=a.PassBase;var s=e("./surfaces/GL_BasicMaterialSurface");r.GL_BasicMaterialSurface=s.GL_BasicMaterialSurface;var n=e("./surfaces/GL_DepthSurface");r.GL_DepthSurface=n.GL_DepthSurface;var o=e("./surfaces/GL_DistanceSurface");r.GL_DistanceSurface=o.GL_DistanceSurface;var l=e("./surfaces/GL_SkyboxSurface");r.GL_SkyboxSurface=l.GL_SkyboxSurface;var h=e("./surfaces/GL_SurfaceBase");r.GL_SurfaceBase=h.GL_SurfaceBase;var c=e("./surfaces/GL_SurfacePassBase");r.GL_SurfacePassBase=c.GL_SurfacePassBase;var u=e("./surfaces/SurfacePool");r.SurfacePool=u.SurfacePool},{"./surfaces/GL_BasicMaterialSurface":"awayjs-renderergl/lib/surfaces/GL_BasicMaterialSurface","./surfaces/GL_DepthSurface":"awayjs-renderergl/lib/surfaces/GL_DepthSurface","./surfaces/GL_DistanceSurface":"awayjs-renderergl/lib/surfaces/GL_DistanceSurface","./surfaces/GL_SkyboxSurface":"awayjs-renderergl/lib/surfaces/GL_SkyboxSurface","./surfaces/GL_SurfaceBase":"awayjs-renderergl/lib/surfaces/GL_SurfaceBase","./surfaces/GL_SurfacePassBase":"awayjs-renderergl/lib/surfaces/GL_SurfacePassBase","./surfaces/SurfacePool":"awayjs-renderergl/lib/surfaces/SurfacePool","./surfaces/passes/BasicMaterialPass":"awayjs-renderergl/lib/surfaces/passes/BasicMaterialPass","./surfaces/passes/PassBase":"awayjs-renderergl/lib/surfaces/passes/PassBase"}],"awayjs-renderergl/lib/textures/GL_Single2DTexture":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-display/lib/textures/MappingMode");var s=e("../textures/GL_TextureBase");var n=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._single2DTexture=t}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._single2DTexture=null};t.prototype._iGetFragmentCode=function(e,t,r,i){var s="";var n="wrap";var o="";var l="linear,miplinear";var h;if(this._single2DTexture.mappingMode==a.MappingMode.RADIAL_GRADIENT){h=t.getFreeFragmentVectorTemp();s+="mul "+h+".xy, "+i+", "+i+"\n";s+="mul "+h+".xy, "+i+", "+i+"\n";s+="add "+h+".x, "+h+".x, "+h+".y\n";s+="sub "+h+".y, "+h+".y, "+h+".y\n";s+="sqt "+h+".x, "+h+".x, "+h+".x\n";i=h}if(this._shader.useImageRect){var c=t.getFreeFragmentConstant();this._samplerIndex=c.index*4;h=t.getFreeFragmentVectorTemp();s+="mul "+h+", "+i+", "+c+".xy\n";s+="add "+h+", "+h+", "+c+".zw\n";i=h}this._imageIndex=this._shader.getImageIndex(this._single2DTexture,0);var u=this.getTextureReg(this._imageIndex,t,r);this._textureIndex=u.index;s+="tex "+e+", "+i+", "+u+" <2d,"+l+","+o+n+">\n";return s};t.prototype.activate=function(e){var t=e.samplers[this._imageIndex];t.activate(this._textureIndex);var r=e.images[this._imageIndex];r.activate(this._textureIndex,t._sampler.mipmap);if(this._shader.useImageRect){var i=this._samplerIndex;var a=this._shader.fragmentConstantData;if(!t._sampler.imageRect){a[i]=1;a[i+1]=1;a[i+2]=0;a[i+3]=0}else{a[i]=t._sampler.imageRect.width;a[i+1]=t._sampler.imageRect.height;a[i+2]=t._sampler.imageRect.x;a[i+3]=t._sampler.imageRect.y}}};t.prototype._setRenderState=function(e){var t=e.samplers[this._imageIndex];if(t)t.activate(this._textureIndex);var r=e.images[this._imageIndex];if(r)r.activate(this._textureIndex,t._sampler.mipmap);if(this._shader.useImageRect&&t){var i=this._samplerIndex;var a=this._shader.fragmentConstantData;if(!t._sampler.imageRect){a[i]=1;a[i+1]=1;a[i+2]=0;a[i+3]=0}else{a[i]=t._sampler.imageRect.width;a[i+1]=t._sampler.imageRect.height;a[i+2]=t._sampler.imageRect.x;a[i+3]=t._sampler.imageRect.y}}};return t}(s.GL_TextureBase);r.GL_Single2DTexture=n},{"../textures/GL_TextureBase":"awayjs-renderergl/lib/textures/GL_TextureBase","awayjs-display/lib/textures/MappingMode":undefined}],"awayjs-renderergl/lib/textures/GL_SingleCubeTexture":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("../textures/GL_TextureBase");var s=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._singleCubeTexture=t}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._singleCubeTexture=null};t.prototype._iIncludeDependencies=function(e){if(e===void 0){e=true}if(e)this._shader.usesPositionFragment=true};t.prototype._iGetFragmentCode=function(e,t,r,i){var a="";var s="linear,miplinear";this._imageIndex=this._shader.getImageIndex(this._singleCubeTexture,0);var n=this.getTextureReg(this._imageIndex,t,r);this._textureIndex=n.index;return"tex "+e+", "+i+", "+n+" <cube,"+a+s+">\n";
};t.prototype.activate=function(e){var t=e.samplers[this._imageIndex];if(t)t.activate(this._textureIndex);if(e.images[this._imageIndex])e.images[this._imageIndex].activate(this._textureIndex,t._sampler.mipmap)};t.prototype._setRenderState=function(e){var t=e.samplers[this._imageIndex];if(t)t.activate(this._textureIndex);if(e.images[this._imageIndex]&&t)e.images[this._imageIndex].activate(this._textureIndex,t._sampler.mipmap)};return t}(a.GL_TextureBase);r.GL_SingleCubeTexture=s},{"../textures/GL_TextureBase":"awayjs-renderergl/lib/textures/GL_TextureBase"}],"awayjs-renderergl/lib/textures/GL_TextureBase":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/errors/AbstractMethodError");var s=e("awayjs-core/lib/library/AbstractionBase");var n=e("awayjs-stagegl/lib/base/ContextGLTextureFormat");var o=function(e){i(t,e);function t(t,r){e.call(this,t,r);this._texture=t;this._shader=r;this._stage=r._stage}t.prototype.onClear=function(t){e.prototype.onClear.call(this,t);this._texture=null;this._shader=null;this._stage=null};t.prototype._iGetFragmentCode=function(e,t,r,i){if(i===void 0){i=null}throw new a.AbstractMethodError};t.prototype._setRenderState=function(e){};t.prototype.activate=function(e){};t.prototype.getTextureReg=function(e,t,r){var i=this._shader.imageIndices.indexOf(e);if(i==-1){var a=t.getFreeTextureReg();r.textures.push(a);this._shader.imageIndices.push(e);return a}return r.textures[i]};t.prototype.getFormatString=function(e){switch(e.format){case n.ContextGLTextureFormat.COMPRESSED:return"dxt1,";case n.ContextGLTextureFormat.COMPRESSED_ALPHA:return"dxt5,";default:return""}};return t}(s.AbstractionBase);r.GL_TextureBase=o},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AbstractionBase":undefined,"awayjs-stagegl/lib/base/ContextGLTextureFormat":undefined}],"awayjs-renderergl/lib/textures":[function(e,t,r){"use strict";var i=e("./textures/GL_Single2DTexture");r.GL_Single2DTexture=i.GL_Single2DTexture;var a=e("./textures/GL_SingleCubeTexture");r.GL_SingleCubeTexture=a.GL_SingleCubeTexture;var s=e("./textures/GL_TextureBase");r.GL_TextureBase=s.GL_TextureBase},{"./textures/GL_Single2DTexture":"awayjs-renderergl/lib/textures/GL_Single2DTexture","./textures/GL_SingleCubeTexture":"awayjs-renderergl/lib/textures/GL_SingleCubeTexture","./textures/GL_TextureBase":"awayjs-renderergl/lib/textures/GL_TextureBase"}],"awayjs-renderergl/lib/tools/commands/Merge":[function(e,t,r){"use strict";var i=e("awayjs-core/lib/attributes/AttributesBuffer");var a=e("awayjs-core/lib/geom/Matrix3DUtils");var s=e("awayjs-display/lib/graphics/TriangleElements");var n=e("awayjs-display/lib/display/Sprite");var o=function(){function e(e,t,r){if(e===void 0){e=false}if(t===void 0){t=false}if(r===void 0){r=false}this._keepMaterial=e;this._disposeSources=t;this._objectSpace=r}Object.defineProperty(e.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(e){this._disposeSources=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(e){this._keepMaterial=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(e){this._objectSpace=e},enumerable:true,configurable:true});e.prototype.applyToContainer=function(e,t){this.reset();this.parseContainer(e,t);this.collect(e,false);this.merge(e,this._disposeSources)};e.prototype.applyToSpritees=function(e,t){this.reset();if(!t.length)return;for(var r=0;r<t.length;r++)if(t[r]!=e)this.collect(t[r],this._disposeSources);this.collect(e,false);this.merge(e,this._disposeSources)};e.prototype.apply=function(e,t){this.reset();this.collect(t,this._disposeSources);this.collect(e,false);this.merge(e,this._disposeSources)};e.prototype.reset=function(){this._toDispose=new Array;this._graphicVOs=new Array};e.prototype.merge=function(e,t){var r;var a;var n;a=e.graphics;n=this._graphicVOs.length>1;for(r=0;r<this._graphicVOs.length;r++){var o=new s.TriangleElements(new i.AttributesBuffer);o.autoDeriveNormals=false;o.autoDeriveTangents=false;var l=this._graphicVOs[r];o.setIndices(l.indices);o.setPositions(l.vertices);o.setNormals(l.normals);o.setTangents(l.tangents);o.setUVs(l.uvs);a.addGraphic(o);if(this._keepMaterial&&n)e.graphics[r].material=l.material}if(this._keepMaterial&&!n&&this._graphicVOs.length)e.material=this._graphicVOs[0].material;if(t){var h=this._toDispose.length;for(var r;r<h;r++)this._toDispose[r].dispose()}this._toDispose=null};e.prototype.collect=function(e,t){var r;var i;for(r=0;r<e.graphics.count;r++){var s;var n;var o,l,h,c,u;var d;var p;var f;var _;var m;var g;var y,v,x,b,P;p=e.graphics.getGraphicAt(r).elements;v=p.positions.get(p.numVertices);x=p.normals.get(p.numVertices);b=p.tangents.get(p.numVertices);P=p.uvs.get(p.numVertices);f=this.getGraphicData(e.graphics.getGraphicAt(r).material);_=this._objectSpace?f.vertices:new Array;m=this._objectSpace?f.normals:new Array;g=this._objectSpace?f.tangents:new Array;l=_.length;h=m.length;c=g.length;u=f.uvs.length;n=p.numVertices;for(s=0;s<n;s++){i=s*3;_[l++]=v[i];_[l++]=v[i+1];_[l++]=v[i+2];m[h++]=x[i];m[h++]=x[i+1];m[h++]=x[i+2];g[c++]=b[i];g[c++]=b[i+1];g[c++]=b[i+2];f.uvs[u++]=P[s*2];f.uvs[u++]=P[s*2+1]}d=!this._objectSpace?f.vertices.length/3:0;o=f.indices.length;n=p.numElements;y=p.indices.get(n);for(s=0;s<n;s++){i=s*3;f.indices[o++]=y[i]+d;f.indices[o++]=y[i+1]+d;f.indices[o++]=y[i+2]+d}if(!this._objectSpace){e.sceneTransform.transformVectors(_,_);a.Matrix3DUtils.deltaTransformVectors(e.sceneTransform,m,m);a.Matrix3DUtils.deltaTransformVectors(e.sceneTransform,g,g);l=f.vertices.length;h=f.normals.length;c=f.tangents.length;n=_.length;for(s=0;s<n;s++){f.vertices[l++]=_[s];f.normals[h++]=m[s];f.tangents[c++]=g[s]}}}if(t)this._toDispose.push(e)};e.prototype.getGraphicData=function(e){var t;if(this._keepMaterial){var r;var i;i=this._graphicVOs.length;for(r=0;r<i;r++){if(this._graphicVOs[r].material==e){t=this._graphicVOs[r];break}}}else if(this._graphicVOs.length){t=this._graphicVOs[0]}if(!t){t=new l;t.vertices=new Array;t.normals=new Array;t.tangents=new Array;t.uvs=new Array;t.indices=new Array;t.material=e;this._graphicVOs.push(t)}return t};e.prototype.parseContainer=function(e,t){var r;var i;if(t instanceof n.Sprite&&t!=e)this.collect(t,this._disposeSources);for(i=0;i<t.numChildren;++i){r=t.getChildAt(i);this.parseContainer(e,r)}};return e}();r.Merge=o;var l=function(){function e(){}return e}();r.GraphicVO=l},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/geom/Matrix3DUtils":undefined,"awayjs-display/lib/display/Sprite":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined}],"awayjs-renderergl/lib/tools/data/ParticleGraphicsTransform":[function(e,t,r){"use strict";var i=function(){function e(){}Object.defineProperty(e.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(e){this._defaultVertexTransform=e;this._defaultInvVertexTransform=e.clone();this._defaultInvVertexTransform.invert();this._defaultInvVertexTransform.transpose()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(e){this._defaultUVTransform=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:true,configurable:true});return e}();r.ParticleGraphicsTransform=i},{}],"awayjs-renderergl/lib/tools":[function(e,t,r){"use strict";var i=e("./tools/commands/Merge");r.Merge=i.Merge;var a=e("./tools/data/ParticleGraphicsTransform");r.ParticleGraphicsTransform=a.ParticleGraphicsTransform},{"./tools/commands/Merge":"awayjs-renderergl/lib/tools/commands/Merge","./tools/data/ParticleGraphicsTransform":"awayjs-renderergl/lib/tools/data/ParticleGraphicsTransform"}],"awayjs-renderergl/lib/utils/ParticleGraphicsHelper":[function(e,t,r){"use strict";var i=e("awayjs-core/lib/attributes/AttributesBuffer");var a=e("awayjs-core/lib/geom/Point");var s=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-display/lib/animators/data/ParticleData");var o=e("awayjs-display/lib/graphics/TriangleElements");var l=function(){function e(){}e.generateGraphics=function(t,r,l){if(l===void 0){l=null}var h=new Array;var c=new Array;var u=new Array;var d=new Array;var p=new Array;var f=new Array;var _=new Array;var m=new Array;var g=r.length;var y;var v;var x;var b;var P;var S;var C;var w;var D;var T;var A;var R;var O=new Array;var V=new s.Vector3D;var j=new s.Vector3D;var L=new s.Vector3D;var E=new a.Point;for(A=0;A<g;A++){y=r[A];x=y.count;for(var B=0;B<x;B++){if(O.length<=B){O.push(m.length);h.push(new Array);c.push(new Array);u.push(new Array);d.push(new Array);p.push(new Array);m.push(new o.TriangleElements(new i.AttributesBuffer));f.push(0)}v=y.getGraphicAt(B).elements;if(v.numVertices+f[O[B]]>e.MAX_VERTEX){O[B]=m.length;h.push(new Array);c.push(new Array);u.push(new Array);d.push(new Array);p.push(new Array);m.push(new o.TriangleElements(new i.AttributesBuffer));f.push(0)}R=O[B];b=h[R];P=c[R];S=u[R];C=d[R];w=p[R];D=f[R];T=m[R];var I=new n.ParticleData;I.numVertices=v.numVertices;I.startVertexIndex=D;I.particleIndex=A;I.elements=T;_.push(I);f[R]+=v.numVertices;var F;var M;var N=v;var G;var k;var z;var U;var X;if(N){M=N.numVertices;k=N.positions.get(M);z=N.normals.get(M);U=N.tangents.get(M);X=N.uvs.get(M);if(l){var W=l[A];var H=W.vertexTransform;var q=W.invVertexTransform;var Z=W.UVTransform;for(F=0;F<M;F++){G=F*3;V.x=k[G];V.y=k[G+1];V.z=k[G+2];j.x=z[G];j.y=z[G+1];j.z=z[G+2];L.x=U[G];L.y=U[G+1];L.z=U[G+2];E.x=X[F*2];E.y=X[F*2+1];if(H){V=H.transformVector(V);j=q.deltaTransformVector(j);L=q.deltaTransformVector(j)}if(Z)E=Z.transformPoint(E);P.push(V.x,V.y,V.z);S.push(j.x,j.y,j.z);C.push(L.x,L.y,L.z);w.push(E.x,E.y)}}else{for(F=0;F<M;F++){G=F*3;P.push(k[G],k[G+1],k[G+2]);S.push(z[G],z[G+1],z[G+2]);C.push(U[G],U[G+1],U[G+2]);w.push(X[F*2],X[F*2+1])}}}else{}M=v.numElements;var Y=v.indices.get(M);for(F=0;F<M;F++){G=F*3;b.push(Y[G]+D,Y[G+1]+D,Y[G+2]+D)}}}t.particles=_;t.numParticles=g;g=m.length;for(A=0;A<g;A++){T=m[A];T.autoDeriveNormals=false;T.autoDeriveTangents=false;T.setIndices(h[A]);T.setPositions(c[A]);T.setNormals(u[A]);T.setTangents(d[A]);T.setUVs(p[A]);t.addGraphic(T)}};e.MAX_VERTEX=65535;return e}();r.ParticleGraphicsHelper=l},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/geom/Point":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-display/lib/animators/data/ParticleData":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined}],"awayjs-renderergl/lib/utils/PerspectiveMatrix3D":[function(e,t,r){"use strict";var i=this&&this.__extends||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)};var a=e("awayjs-core/lib/geom/Matrix3D");var s=function(e){i(t,e);function t(t){if(t===void 0){t=null}e.call(this,t)}t.prototype.perspectiveFieldOfViewLH=function(e,t,r,i){var a=1/Math.tan(e/2);var s=a/t;this.rawData[0]=s;this.rawData[1]=0;this.rawData[2]=0;this.rawData[3]=0;this.rawData[4]=0;this.rawData[5]=a;this.rawData[6]=0;this.rawData[7]=0;this.rawData[8]=0;this.rawData[9]=0;this.rawData[10]=i/(i-r);this.rawData[11]=1;this.rawData[12]=0;this.rawData[13]=0;this.rawData[14]=r*i/(r-i);this.rawData[15]=0};return t}(a.Matrix3D);r.PerspectiveMatrix3D=s},{"awayjs-core/lib/geom/Matrix3D":undefined}],"awayjs-renderergl/lib/utils":[function(e,t,r){"use strict";var i=e("./utils/ParticleGraphicsHelper");r.ParticleGraphicsHelper=i.ParticleGraphicsHelper;var a=e("./utils/PerspectiveMatrix3D");r.PerspectiveMatrix3D=a.PerspectiveMatrix3D},{"./utils/ParticleGraphicsHelper":"awayjs-renderergl/lib/utils/ParticleGraphicsHelper","./utils/PerspectiveMatrix3D":"awayjs-renderergl/lib/utils/PerspectiveMatrix3D"}]},{},[1]);
//# sourceMappingURL=awayjs-renderergl.min.js.map
