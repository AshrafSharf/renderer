require=function e(t,i,r){function a(s,o){if(!i[s]){if(!t[s]){var l=typeof require=="function"&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var p=i[s]={exports:{}};t[s][0].call(p.exports,function(e){var i=t[s][1][e];return a(i?i:e)},p,p.exports,e,t,i,r)}return i[s].exports}var n=typeof require=="function"&&require;for(var s=0;s<r.length;s++)a(r[s]);return a}({"awayjs-renderergl/lib/DefaultRenderer":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3D");var n=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-core/lib/textures/RenderTexture");var o=e("awayjs-display/lib/pool/RenderablePool");var l=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var h=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var p=e("awayjs-stagegl/lib/base/ContextGLClearMask");var u=e("awayjs-stagegl/lib/managers/StageManager");var d=e("awayjs-renderergl/lib/DepthRenderer");var c=e("awayjs-renderergl/lib/Filter3DRenderer");var f=e("awayjs-renderergl/lib/base/RendererBase");var _=e("awayjs-renderergl/lib/pool/SkyboxRenderable");var g=e("awayjs-renderergl/lib/managers/RTTBufferManager");var m=e("awayjs-renderergl/lib/passes/DepthMapPass");var y=e("awayjs-renderergl/lib/passes/DistanceMapPass");var v=function(e){r(t,e);function t(t,i,r){if(t===void 0){t=false}if(i===void 0){i="baseline"}if(r===void 0){r="auto"}e.call(this);this._skyboxProjection=new a;this._skyboxRenderablePool=o.getPool(_);this._pDepthRenderer=new d(new m);this._pDistanceRenderer=new d(new y);if(this._pStage==null)this.stage=u.getInstance().getFreeStage(t,i,r);this._pRttBufferManager=g.getInstance(this._pStage);if(this._width==0)this.width=window.innerWidth;else this._pRttBufferManager.viewWidth=this._width;if(this._height==0)this.height=window.innerHeight;else this._pRttBufferManager.viewHeight=this._height}Object.defineProperty(t.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(e){if(this._antiAlias==e)return;this._antiAlias=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(e){this._depthPrepass=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(e){if(e&&e.length==0)e=null;if(this._pFilter3DRenderer&&!e){this._pFilter3DRenderer.dispose();this._pFilter3DRenderer=null}else if(!this._pFilter3DRenderer&&e){this._pFilter3DRenderer=new c(this._pStage);this._pFilter3DRenderer.filters=e}if(this._pFilter3DRenderer){this._pFilter3DRenderer.filters=e;this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender}else{this._pRequireDepthRender=false;if(this._pDepthRender){this._pDepthRender.dispose();this._pDepthRender=null}}},enumerable:true,configurable:true});t.prototype.render=function(t){e.prototype.render.call(this,t);if(!this._pStage.recoverFromDisposal()){this._pBackBufferInvalid=true;return}if(this._pBackBufferInvalid)this.pUpdateBackBuffer();if(this._shareContext&&this._pContext)this._pContext.clear(0,0,0,1,1,0,p.DEPTH);if(this._pFilter3DRenderer){this.textureRatioX=this._pRttBufferManager.textureRatioX;this.textureRatioY=this._pRttBufferManager.textureRatioY}else{this.textureRatioX=1;this.textureRatioY=1}if(this._pRequireDepthRender)this.pRenderSceneDepthToTexture(t);if(this._depthPrepass)this.pRenderDepthPrepass(t);if(this._pFilter3DRenderer&&this._pContext){}else{if(this._shareContext)this._iRender(t,null,this._pScissorRect);else this._iRender(t)}e.prototype.render.call(this,t);if(!this._shareContext&&this._pContext)this._pContext.present();this._pStage.bufferClear=false};t.prototype.pExecuteRender=function(t,i,r,a){if(i===void 0){i=null}if(r===void 0){r=null}if(a===void 0){a=0}this.updateLights(t);if(i){this.pCollectRenderables(t);this.drawRenderables(this._pOpaqueRenderableHead,t);this.drawRenderables(this._pBlendedRenderableHead,t)}e.prototype.pExecuteRender.call(this,t,i,r,a)};t.prototype.updateLights=function(e){var t=e.directionalLights;var i=e.pointLights;var r,a;var n;var s;r=t.length;for(a=0;a<r;++a){n=t[a];s=n.shadowMapper;if(n.castsShadows&&(s.autoUpdateShadows||s._iShadowsInvalid))s.iRenderDepthMap(e,this._pDepthRenderer)}r=i.length;for(a=0;a<r;++a){n=i[a];s=n.shadowMapper;if(n.castsShadows&&(s.autoUpdateShadows||s._iShadowsInvalid))s.iRenderDepthMap(e,this._pDistanceRenderer)}};t.prototype.pDraw=function(e,t){if(!t)this.pCollectRenderables(e);this._pContext.setBlendFactors(l.ONE,l.ZERO);if(e.skyBox){this._pContext.setDepthTest(false,h.ALWAYS);this.drawSkybox(e)}this._pContext.setDepthTest(true,h.LESS_EQUAL);this.drawRenderables(this._pOpaqueRenderableHead,e);this.drawRenderables(this._pBlendedRenderableHead,e)};t.prototype.drawSkybox=function(e){var t=this._skyboxRenderablePool.getItem(e.skyBox);var i=e.skyBox.material;var r=e.camera;this.updateSkyboxProjection(r);var a=this.getMaterial(i,this._pStage.profile).getMaterialPass(i._iScreenPasses[0],this._pStage.profile);i._iActivatePass(a,this,r);i._iRenderPass(a,t,this._pStage,r,this._skyboxProjection);i._iDeactivatePass(a,this)};t.prototype.updateSkyboxProjection=function(e){var t=new n;this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix);this._skyboxProjection.copyRowTo(2,t);var i=e.scenePosition;var r=t.x;var a=t.y;var s=t.z;var o=-(t.x*i.x+t.y*i.y+t.z*i.z+Math.sqrt(r*r+a*a+s*s));var l=r>=0?1:-1;var h=a>=0?1:-1;var p=new n(l,h,1,1);var u=this._skyboxProjection.clone();u.invert();var d=u.transformVector(p);this._skyboxProjection.copyRowTo(3,p);var c=(d.x*p.x+d.y*p.y+d.z*p.z+d.w*p.w)/(r*d.x+a*d.y+s*d.z+o*d.w);this._skyboxProjection.copyRowFrom(2,new n(r*c,a*c,s*c,o*c))};t.prototype.drawRenderables=function(e,t){var i;var r;var a;var n;var s;var o=this._pStage.context;var l=t.camera;var h;while(e){s=this.getMaterial(e.material,this._pStage.profile);a=e.material._iScreenPasses;r=e.material._iNumScreenPasses();for(i=0;i<r;i++){h=e;n=s.getMaterialPass(a[i],this._pStage.profile);e.material._iActivatePass(n,this,l);do{e.material._iRenderPass(n,h,this._pStage,l,this._pRttViewProjectionMatrix);h=h.next}while(h&&h.material==e.material);s.material._iDeactivatePass(n,this)}e=h}};t.prototype.dispose=function(){if(!this._shareContext)this._pStage.dispose();this._pDepthRenderer.dispose();this._pDistanceRenderer.dispose();this._pDepthRenderer=null;this._pDistanceRenderer=null;this._pDepthRender=null;e.prototype.dispose.call(this)};t.prototype.pRenderDepthPrepass=function(e){this._pDepthRenderer.disableColor=true;if(this._pFilter3DRenderer){}else{this._pDepthRenderer.textureRatioX=1;this._pDepthRenderer.textureRatioY=1;this._pDepthRenderer._iRender(e)}this._pDepthRenderer.disableColor=false};t.prototype.pRenderSceneDepthToTexture=function(e){if(this._pDepthTextureInvalid||!this._pDepthRender)this.initDepthTexture(this._pStage.context);this._pDepthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX;this._pDepthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY;this._pDepthRenderer._iRender(e,this._pDepthRender)};t.prototype.pUpdateBackBuffer=function(){if(this._pStage.context&&!this._shareContext){if(this._width&&this._height){this._pStage.configureBackBuffer(this._width,this._height,this._antiAlias,true);this._pBackBufferInvalid=false}}};t.prototype.iSetStage=function(t){e.prototype.iSetStage.call(this,t);this._pDistanceRenderer.iSetStage(t);this._pDepthRenderer.iSetStage(t)};t.prototype.initDepthTexture=function(e){this._pDepthTextureInvalid=false;if(this._pDepthRender)this._pDepthRender.dispose();this._pDepthRender=new s(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight)};return t}(f);t.exports=v},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/textures/RenderTexture":undefined,"awayjs-display/lib/pool/RenderablePool":undefined,"awayjs-renderergl/lib/DepthRenderer":undefined,"awayjs-renderergl/lib/Filter3DRenderer":undefined,"awayjs-renderergl/lib/base/RendererBase":undefined,"awayjs-renderergl/lib/managers/RTTBufferManager":undefined,"awayjs-renderergl/lib/passes/DepthMapPass":undefined,"awayjs-renderergl/lib/passes/DistanceMapPass":undefined,"awayjs-renderergl/lib/pool/SkyboxRenderable":undefined,"awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLClearMask":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined,"awayjs-stagegl/lib/managers/StageManager":undefined}],"awayjs-renderergl/lib/DepthRenderer":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var n=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var s=e("awayjs-renderergl/lib/base/RendererBase");var o=function(e){r(t,e);function t(t,i){if(i===void 0){i=false}e.call(this);this._pass=t;this._renderBlended=i;this._iBackgroundR=1;this._iBackgroundG=1;this._iBackgroundB=1}Object.defineProperty(t.prototype,"disableColor",{get:function(){return this._disableColor},set:function(e){this._disableColor=e},enumerable:true,configurable:true});t.prototype._iRenderCascades=function(e,t,i,r,s){this.pCollectRenderables(e);this._pStage.setRenderTarget(t,true,0);this._pContext.clear(1,1,1,1,1,0);this._pContext.setBlendFactors(a.ONE,a.ZERO);this._pContext.setDepthTest(true,n.LESS);var o=this._pOpaqueRenderableHead;var l=true;for(var h=i-1;h>=0;--h){this._pStage.scissorRect=r[h];this.drawCascadeRenderables(o,s[h],l?null:s[h].frustumPlanes);l=false}this._pContext.setDepthTest(false,n.LESS_EQUAL);this._pStage.scissorRect=null};t.prototype.drawCascadeRenderables=function(e,t,i){var r;var a;var n=this._pStage.context;var s;while(e){a=this.getMaterial(e.material,this._pStage.profile);s=e;r=a.getMaterialPass(this._pass,this._pStage.profile);if(r.key=="")this.calcAnimationCode(e.material,r);e.material._iActivatePass(r,this,t);do{if(!i||s.sourceEntity.worldBounds.isInFrustum(i,4)){s.material._iRenderPass(r,s,this._pStage,t,this._pRttViewProjectionMatrix)}else{s.cascaded=true}s=s.next}while(s&&s.material==e.material&&!s.cascaded);e.material._iDeactivatePass(r,this);e=s}};t.prototype.pDraw=function(e,t){this.pCollectRenderables(e);this._pContext.setBlendFactors(a.ONE,a.ZERO);this._pContext.setDepthTest(true,n.LESS);this.drawRenderables(this._pOpaqueRenderableHead,e);if(this._disableColor)this._pContext.setColorMask(false,false,false,false);if(this._renderBlended)this.drawRenderables(this._pBlendedRenderableHead,e);if(this._disableColor)this._pContext.setColorMask(true,true,true,true)};t.prototype.drawRenderables=function(e,t){var i;var r;var a=this._pStage.context;var n=t.camera;var s;while(e){r=this.getMaterial(e.material,this._pStage.profile);if(this._disableColor&&e.material.alphaThreshold!=0){s=e;do{s=s.next}while(s&&s.material==e.material)}else{s=e;i=r.getMaterialPass(this._pass,this._pStage.profile);if(i.key=="")this.calcAnimationCode(e.material,i);e.material._iActivatePass(i,this,n);do{s.material._iRenderPass(i,s,this._pStage,n,this._pRttViewProjectionMatrix);s=s.next}while(s&&s.material==e.material);e.material._iDeactivatePass(i,this)}e=s}};return t}(s);t.exports=o},{"awayjs-renderergl/lib/base/RendererBase":undefined,"awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-renderergl/lib/Filter3DRenderer":[function(e,t,i){var r=e("awayjs-core/lib/events/Event");var a=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/managers/RTTBufferManager");var o=function(){function e(e){var t=this;this._filterSizesInvalid=true;this._onRTTResizeDelegate=function(e){return t.onRTTResize(e)};this._stage=e;this._rttManager=s.getInstance(e);this._rttManager.addEventListener(r.RESIZE,this._onRTTResizeDelegate)}e.prototype.onRTTResize=function(e){this._filterSizesInvalid=true};Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(e){if(this._filterTasksInvalid){this.updateFilterTasks(e)}return this._mainInputTexture};Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(e){this._filters=e;this._filterTasksInvalid=true;this._requireDepthRender=false;if(!this._filters){return}for(var t=0;t<this._filters.length;++t){var i=this._filters[t];var r=i.requireDepthRender==null?false:i.requireDepthRender;this._requireDepthRender=this._requireDepthRender||r}this._filterSizesInvalid=true},enumerable:true,configurable:true});e.prototype.updateFilterTasks=function(e){var t;if(this._filterSizesInvalid){this.updateFilterSizes()}if(!this._filters){this._tasks=null;return}this._tasks=new Array;t=this._filters.length-1;var i;for(var r=0;r<=t;++r){i=this._filters[r];i.setRenderTargets(r==t?null:this._filters[r+1].getMainInputTexture(e),e);this._tasks=this._tasks.concat(i.tasks)}this._mainInputTexture=this._filters[0].getMainInputTexture(e)};e.prototype.render=function(e,t,i){var r;var s;var o;var l=e.context;var h=this._rttManager.indexBuffer;var p=this._rttManager.renderToTextureVertexBuffer;if(!this._filters){return}if(this._filterSizesInvalid){this.updateFilterSizes()}if(this._filterTasksInvalid){this.updateFilterTasks(e)}r=this._filters.length;for(s=0;s<r;++s){this._filters[s].update(e,t)}r=this._tasks.length;if(r>1){l.setVertexBufferAt(0,p,0,n.FLOAT_2);l.setVertexBufferAt(1,p,2,n.FLOAT_2)}for(s=0;s<r;++s){o=this._tasks[s];if(!o.target){e.scissorRect=null;p=this._rttManager.renderToScreenVertexBuffer;l.setVertexBufferAt(0,p,0,n.FLOAT_2);l.setVertexBufferAt(1,p,2,n.FLOAT_2)}l.setTextureAt(0,o.getMainInputTexture(e));l.setProgram(o.getProgram(e));l.clear(0,0,0,0);o.activate(e,t,i);l.setBlendFactors(a.ONE,a.ZERO);l.drawTriangles(h,0,2);o.deactivate(e)}l.setTextureAt(0,null);l.setVertexBufferAt(0,null);l.setVertexBufferAt(1,null)};e.prototype.updateFilterSizes=function(){for(var e=0;e<this._filters.length;++e){this._filters[e].textureWidth=this._rttManager.textureWidth;this._filters[e].textureHeight=this._rttManager.textureHeight}this._filterSizesInvalid=true};e.prototype.dispose=function(){this._rttManager.removeEventListener(r.RESIZE,this._onRTTResizeDelegate);this._rttManager=null;this._stage=null};return e}();t.exports=o},{"awayjs-core/lib/events/Event":undefined,"awayjs-renderergl/lib/managers/RTTBufferManager":undefined,"awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/AnimationSetBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/library/AssetType");var n=e("awayjs-core/lib/library/NamedAssetBase");var s=e("awayjs-core/lib/errors/AbstractMethodError");var o=e("awayjs-renderergl/lib/errors/AnimationSetError");var l=function(e){r(t,e);function t(){e.call(this);this._animations=new Array;this._animationNames=new Array;this._animationDictionary=new Object}t.prototype._pFindTempReg=function(e,t){if(t===void 0){t=null}var i=0;var r;while(true){r="vt"+i;if(e.indexOf(r)==-1&&t!=r)return r;++i}return null};Object.defineProperty(t.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:true,configurable:true});t.prototype.resetGPUCompatibility=function(){this._usesCPU=false};t.prototype.cancelGPUCompatibility=function(){this._usesCPU=true};t.prototype.getAGALVertexCode=function(e){throw new s};t.prototype.activate=function(e,t){throw new s};t.prototype.deactivate=function(e,t){throw new s};t.prototype.getAGALFragmentCode=function(e,t){throw new s};t.prototype.getAGALUVCode=function(e){throw new s};t.prototype.doneAGALCode=function(e){throw new s};Object.defineProperty(t.prototype,"assetType",{get:function(){return a.ANIMATION_SET},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:true,configurable:true});t.prototype.hasAnimation=function(e){return this._animationDictionary[e]!=null};t.prototype.getAnimation=function(e){return this._animationDictionary[e]};t.prototype.addAnimation=function(e){if(this._animationDictionary[e.name])throw new o("root node name '"+e.name+"' already exists in the set");this._animationDictionary[e.name]=e;this._animations.push(e);this._animationNames.push(e.name)};t.prototype.dispose=function(){};return t}(n);t.exports=l},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AssetType":undefined,"awayjs-core/lib/library/NamedAssetBase":undefined,"awayjs-renderergl/lib/errors/AnimationSetError":undefined}],"awayjs-renderergl/lib/animators/AnimatorBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/library/AssetType");var n=e("awayjs-core/lib/library/NamedAssetBase");var s=e("awayjs-core/lib/errors/AbstractMethodError");var o=e("awayjs-core/lib/utils/RequestAnimationFrame");var l=e("awayjs-core/lib/utils/getTimer");var h=e("awayjs-renderergl/lib/events/AnimatorEvent");var p=function(e){r(t,e);function t(t){e.call(this);this._autoUpdate=true;this._time=0;this._playbackSpeed=1;this._pOwners=new Array;this._pAbsoluteTime=0;this._animationStates=new Object;this.updatePosition=true;this._pAnimationSet=t;this._broadcaster=new o(this.onEnterFrame,this)}t.prototype.getAnimationState=function(e){var t=e.stateClass;var i=e.id;if(this._animationStates[i]==null)this._animationStates[i]=new t(this,e);return this._animationStates[i]};t.prototype.getAnimationStateByName=function(e){return this.getAnimationState(this._pAnimationSet.getAnimation(e))};Object.defineProperty(t.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){if(this._autoUpdate==e)return;this._autoUpdate=e;if(this._autoUpdate)this.start();else this.stop()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(e){if(this._time==e)return;this.update(e)},enumerable:true,configurable:true});t.prototype.phase=function(e){this._pActiveState.phase(e)};Object.defineProperty(t.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(e){this._playbackSpeed=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,t,i,r,a,n){throw new s};t.prototype.start=function(){if(this._isPlaying||!this._autoUpdate)return;this._time=this._pAbsoluteTime=l();this._isPlaying=true;this._broadcaster.start();if(!this.hasEventListener(h.START))return;if(this._startEvent==null)this._startEvent=new h(h.START,this);this.dispatchEvent(this._startEvent)};t.prototype.stop=function(){if(!this._isPlaying)return;this._isPlaying=false;this._broadcaster.stop();if(!this.hasEventListener(h.STOP))return;if(this._stopEvent==null)this._stopEvent=new h(h.STOP,this);this.dispatchEvent(this._stopEvent)};t.prototype.update=function(e){var t=(e-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(t);this._time=e};t.prototype.reset=function(e,t){if(t===void 0){t=0}this.getAnimationState(this._pAnimationSet.getAnimation(e)).offset(t+this._pAbsoluteTime)};t.prototype.addOwner=function(e){this._pOwners.push(e)};t.prototype.removeOwner=function(e){this._pOwners.splice(this._pOwners.indexOf(e),1)};t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e;this._pActiveState.update(this._pAbsoluteTime);if(this.updatePosition)this.applyPositionDelta()};t.prototype.onEnterFrame=function(e){if(e===void 0){e=null}this.update(l())};t.prototype.applyPositionDelta=function(){var e=this._pActiveState.positionDelta;var t=e.length;var i;if(t>0){i=this._pOwners.length;for(var r=0;r<i;++r)this._pOwners[r].translateLocal(e,t)}};t.prototype.dispatchCycleEvent=function(){if(this.hasEventListener(h.CYCLE_COMPLETE)){if(this._cycleEvent==null)this._cycleEvent=new h(h.CYCLE_COMPLETE,this);this.dispatchEvent(this._cycleEvent)}};t.prototype.clone=function(){throw new s};t.prototype.dispose=function(){};t.prototype.testGPUCompatibility=function(e){throw new s};Object.defineProperty(t.prototype,"assetType",{get:function(){return a.ANIMATOR},enumerable:true,configurable:true});t.prototype.getRenderableSubGeometry=function(e,t){return t};return t}(n);t.exports=p},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/library/AssetType":undefined,"awayjs-core/lib/library/NamedAssetBase":undefined,"awayjs-core/lib/utils/RequestAnimationFrame":undefined,"awayjs-core/lib/utils/getTimer":undefined,"awayjs-renderergl/lib/events/AnimatorEvent":undefined}],"awayjs-renderergl/lib/animators/ParticleAnimationSet":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/AnimationSetBase");var n=e("awayjs-renderergl/lib/animators/data/AnimationRegisterCache");var s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry");var o=e("awayjs-renderergl/lib/animators/data/ParticleAnimationData");var l=e("awayjs-renderergl/lib/animators/data/ParticleProperties");var h=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var p=e("awayjs-renderergl/lib/animators/nodes/ParticleTimeNode");var u=function(e){r(t,e);function t(t,i,r){if(t===void 0){t=false}if(i===void 0){i=false}if(r===void 0){r=false}e.call(this);this._animationSubGeometries=new Object;this._particleNodes=new Array;this._localDynamicNodes=new Array;this._localStaticNodes=new Array;this._totalLenOfOneVertex=0;this.addAnimation(this._timeNode=new p(t,i,r))}Object.defineProperty(t.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:true,configurable:true});t.prototype.addAnimation=function(t){var i;var r=t;r._iProcessAnimationSetting(this);if(r.mode==h.LOCAL_STATIC){r._iDataOffset=this._totalLenOfOneVertex;this._totalLenOfOneVertex+=r.dataLength;this._localStaticNodes.push(r)}else if(r.mode==h.LOCAL_DYNAMIC)this._localDynamicNodes.push(r);for(i=this._particleNodes.length-1;i>=0;i--){if(this._particleNodes[i].priority<=r.priority)break}this._particleNodes.splice(i+1,0,r);e.prototype.addAnimation.call(this,t)};t.prototype.activate=function(e,t){};t.prototype.deactivate=function(e,t){};t.prototype.getAGALVertexCode=function(e){this._iAnimationRegisterCache=e.animationRegisterCache;if(this._iAnimationRegisterCache==null)this._iAnimationRegisterCache=e.animationRegisterCache=new n(e.profile);this._iAnimationRegisterCache.vertexConstantOffset=e.numUsedVertexConstants;this._iAnimationRegisterCache.vertexAttributesOffset=e.numUsedStreams;this._iAnimationRegisterCache.varyingsOffset=e.numUsedVaryings;this._iAnimationRegisterCache.fragmentConstantOffset=e.numUsedFragmentConstants;this._iAnimationRegisterCache.hasUVNode=this.hasUVNode;this._iAnimationRegisterCache.needVelocity=this.needVelocity;this._iAnimationRegisterCache.hasBillboard=this.hasBillboard;this._iAnimationRegisterCache.sourceRegisters=e.animatableAttributes;this._iAnimationRegisterCache.targetRegisters=e.animationTargetRegisters;this._iAnimationRegisterCache.needFragmentAnimation=e.usesFragmentAnimation;this._iAnimationRegisterCache.needUVAnimation=!e.usesUVTransform;this._iAnimationRegisterCache.hasColorAddNode=this.hasColorAddNode;this._iAnimationRegisterCache.hasColorMulNode=this.hasColorMulNode;this._iAnimationRegisterCache.reset();var i="";i+=this._iAnimationRegisterCache.getInitCode();var r;var a;for(a=0;a<this._particleNodes.length;a++){r=this._particleNodes[a];if(r.priority<t.POST_PRIORITY)i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache)}i+=this._iAnimationRegisterCache.getCombinationCode();for(a=0;a<this._particleNodes.length;a++){r=this._particleNodes[a];if(r.priority>=t.POST_PRIORITY&&r.priority<t.COLOR_PRIORITY)i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache)}i+=this._iAnimationRegisterCache.initColorRegisters();for(a=0;a<this._particleNodes.length;a++){r=this._particleNodes[a];if(r.priority>=t.COLOR_PRIORITY)i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache)}i+=this._iAnimationRegisterCache.getColorPassCode();return i};t.prototype.getAGALUVCode=function(e){var t="";if(this.hasUVNode){this._iAnimationRegisterCache.setUVSourceAndTarget(e.uvSource,e.uvTarget);t+="mov "+this._iAnimationRegisterCache.uvTarget+".xy,"+this._iAnimationRegisterCache.uvAttribute.toString()+"\n";var i;for(var r=0;r<this._particleNodes.length;r++)i=this._particleNodes[r];t+=i.getAGALUVCode(e,this._iAnimationRegisterCache);t+="mov "+this._iAnimationRegisterCache.uvVar.toString()+","+this._iAnimationRegisterCache.uvTarget+".xy\n"}else t+="mov "+e.uvTarget+","+e.uvSource+"\n";return t};t.prototype.getAGALFragmentCode=function(e,t){return this._iAnimationRegisterCache.getColorCombinationCode(t)};t.prototype.doneAGALCode=function(e){this._iAnimationRegisterCache.setDataLength();this._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index,0,1,2,0)};Object.defineProperty(t.prototype,"usesCPU",{get:function(){return false},enumerable:true,configurable:true});t.prototype.cancelGPUCompatibility=function(){};t.prototype.dispose=function(){for(var t in this._animationSubGeometries)this._animationSubGeometries[t].dispose();e.prototype.dispose.call(this)};t.prototype.getAnimationSubGeometry=function(e){var t=e.parentMesh;var i=t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id];if(i)return i;this._iGenerateAnimationSubGeometries(t);return t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id]};t.prototype._iGenerateAnimationSubGeometries=function(e){if(this.initParticleFunc==null)throw new Error("no initParticleFunc set");var t=e.geometry;if(!t)throw new Error("Particle animation can only be performed on a ParticleGeometry object");var i,r,a;var n;var h=false;var p;var u;var d;for(i=0;i<e.subMeshes.length;i++){u=e.subMeshes[i];p=u.subGeometry;if(e.shareAnimationGeometry){n=this._animationSubGeometries[p.id];if(n)continue}n=new s;if(e.shareAnimationGeometry)this._animationSubGeometries[p.id]=n;else this._animationSubGeometries[u.id]=n;h=true;n.createVertexData(p.numVertices,this._totalLenOfOneVertex)}if(!h)return;var c=t.particles;var f=c.length;var _=t.numParticles;var g=new l;var m;var y;var v;var b;var x;var w;var P;var C;var D;var T;var S;g.total=_;g.startTime=0;g.duration=1e3;g.delay=.1;i=0;r=0;while(i<_){g.index=i;this.initParticleFunc.call(this.initParticleScope,g);for(a=0;a<this._localStaticNodes.length;a++)this._localStaticNodes[a]._iGeneratePropertyOfOneParticle(g);while(r<f&&(m=c[r]).particleIndex==i){for(a=0;a<e.subMeshes.length;a++){u=e.subMeshes[a];if(u.subGeometry==m.subGeometry){n=e.shareAnimationGeometry?this._animationSubGeometries[u.subGeometry.id]:this._animationSubGeometries[u.id];break}}P=m.numVertices;C=n.vertexData;D=P*this._totalLenOfOneVertex;T=n.numProcessedVertices*this._totalLenOfOneVertex;for(a=0;a<this._localStaticNodes.length;a++){d=this._localStaticNodes[a];w=d.oneData;y=d.dataLength;v=T+d._iDataOffset;for(b=0;b<D;b+=this._totalLenOfOneVertex){S=v+b;for(x=0;x<y;x++)C[S+x]=w[x]}}if(this._localDynamicNodes.length)n.animationParticles.push(new o(i,g.startTime,g.duration,g.delay,m));n.numProcessedVertices+=P;r++}i++}};t.POST_PRIORITY=9;t.COLOR_PRIORITY=18;return t}(a);t.exports=u},{"awayjs-renderergl/lib/animators/AnimationSetBase":undefined,"awayjs-renderergl/lib/animators/data/AnimationRegisterCache":undefined,"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":undefined,"awayjs-renderergl/lib/animators/data/ParticleAnimationData":undefined,"awayjs-renderergl/lib/animators/data/ParticleProperties":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":undefined}],"awayjs-renderergl/lib/animators/ParticleAnimator":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLProgramType");var n=e("awayjs-renderergl/lib/animators/AnimatorBase");var s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry");var o=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var l=function(e){r(t,e);function t(t){e.call(this,t);this._animationParticleStates=new Array;this._animatorParticleStates=new Array;this._timeParticleStates=new Array;this._totalLenOfOneVertex=0;this._animatorSubGeometries=new Object;this._particleAnimationSet=t;var i;var r;for(var a=0;a<this._particleAnimationSet.particleNodes.length;a++){r=this._particleAnimationSet.particleNodes[a];i=this.getAnimationState(r);if(r.mode==o.LOCAL_DYNAMIC){this._animatorParticleStates.push(i);r._iDataOffset=this._totalLenOfOneVertex;this._totalLenOfOneVertex+=r.dataLength}else{this._animationParticleStates.push(i)}if(i.needUpdateTime)this._timeParticleStates.push(i)}}t.prototype.clone=function(){return new t(this._particleAnimationSet)};t.prototype.setRenderState=function(e,t,i,r,n,s){var o=this._particleAnimationSet._iAnimationRegisterCache;var l=t.subMesh;var h;var p;if(!l)throw new Error("Must be subMesh");var u=this._particleAnimationSet.getAnimationSubGeometry(l);for(p=0;p<this._animationParticleStates.length;p++)this._animationParticleStates[p].setRenderState(i,t,u,o,r);var d=this.getAnimatorSubGeometry(l);for(p=0;p<this._animatorParticleStates.length;p++)this._animatorParticleStates[p].setRenderState(i,t,d,o,r);i.context.setProgramConstantsFromArray(a.VERTEX,o.vertexConstantOffset,o.vertexConstantData,o.numVertexConstant);if(o.numFragmentConstant>0)i.context.setProgramConstantsFromArray(a.FRAGMENT,o.fragmentConstantOffset,o.fragmentConstantData,o.numFragmentConstant)};t.prototype.testGPUCompatibility=function(e){};t.prototype.start=function(){e.prototype.start.call(this);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime)};t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e;for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].update(this._pAbsoluteTime)};t.prototype.resetTime=function(e){if(e===void 0){e=0}for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime+e);this.update(this.time)};t.prototype.dispose=function(){for(var e in this._animatorSubGeometries)this._animatorSubGeometries[e].dispose()};t.prototype.getAnimatorSubGeometry=function(e){if(!this._animatorParticleStates.length)return;var t=e.subGeometry;
var i=this._animatorSubGeometries[t.id]=new s;i.createVertexData(t.numVertices,this._totalLenOfOneVertex);i.animationParticles=this._particleAnimationSet.getAnimationSubGeometry(e).animationParticles};return t}(n);t.exports=l},{"awayjs-renderergl/lib/animators/AnimatorBase":undefined,"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/animators/SkeletonAnimationSet":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/AnimationSetBase");var n=function(e){r(t,e);function t(t){if(t===void 0){t=4}e.call(this);this._jointsPerVertex=t}Object.defineProperty(t.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:true,configurable:true});t.prototype.getAGALVertexCode=function(e){var t=e.animatableAttributes.length;var i=e.numUsedVertexConstants;var r=i+1;var a=i+2;var n="va"+e.numUsedStreams;var s="va"+(e.numUsedStreams+1);var o=[n+".x",n+".y",n+".z",n+".w"];var l=[s+".x",s+".y",s+".z",s+".w"];var h=this._pFindTempReg(e.animationTargetRegisters);var p=this._pFindTempReg(e.animationTargetRegisters,h);var u="dp4";var d="";for(var c=0;c<t;++c){var f=e.animatableAttributes[c];for(var _=0;_<this._jointsPerVertex;++_){d+=u+" "+h+".x, "+f+", vc["+o[_]+"+"+i+"]\n"+u+" "+h+".y, "+f+", vc["+o[_]+"+"+r+"]\n"+u+" "+h+".z, "+f+", vc["+o[_]+"+"+a+"]\n"+"mov "+h+".w, "+f+".w\n"+"mul "+h+", "+h+", "+l[_]+"\n";if(_==0)d+="mov "+p+", "+h+"\n";else d+="add "+p+", "+p+", "+h+"\n"}u="dp3";d+="mov "+e.animationTargetRegisters[c]+", "+p+"\n"}return d};t.prototype.activate=function(e,t){};t.prototype.deactivate=function(e,t){};t.prototype.getAGALFragmentCode=function(e,t){return""};t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"};t.prototype.doneAGALCode=function(e){};return t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/AnimationSetBase":undefined}],"awayjs-renderergl/lib/animators/SkeletonAnimator":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/TriangleSubGeometry");var n=e("awayjs-display/lib/events/SubGeometryEvent");var s=e("awayjs-stagegl/lib/base/ContextGLProgramType");var o=e("awayjs-renderergl/lib/animators/AnimatorBase");var l=e("awayjs-renderergl/lib/animators/data/JointPose");var h=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var p=e("awayjs-renderergl/lib/events/AnimationStateEvent");var u=function(e){r(t,e);function t(t,i,r){var a=this;if(r===void 0){r=false}e.call(this,t);this._globalPose=new h;this._morphedSubGeometry=new Object;this._morphedSubGeometryDirty=new Object;this._skeleton=i;this._forceCPU=r;this._jointsPerVertex=t.jointsPerVertex;this._numJoints=this._skeleton.numJoints;this._globalMatrices=new Array(this._numJoints*12);var n=0;for(var s=0;s<this._numJoints;++s){this._globalMatrices[n++]=1;this._globalMatrices[n++]=0;this._globalMatrices[n++]=0;this._globalMatrices[n++]=0;this._globalMatrices[n++]=0;this._globalMatrices[n++]=1;this._globalMatrices[n++]=0;this._globalMatrices[n++]=0;this._globalMatrices[n++]=0;this._globalMatrices[n++]=0;this._globalMatrices[n++]=1;this._globalMatrices[n++]=0}this._onTransitionCompleteDelegate=function(e){return a.onTransitionComplete(e)};this._onIndicesUpdateDelegate=function(e){return a.onIndicesUpdate(e)};this._onVerticesUpdateDelegate=function(e){return a.onVerticesUpdate(e)}}Object.defineProperty(t.prototype,"globalMatrices",{get:function(){if(this._globalPropertiesDirty)this.updateGlobalProperties();return this._globalMatrices},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"globalPose",{get:function(){if(this._globalPropertiesDirty)this.updateGlobalProperties();return this._globalPose},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(e){this._useCondensedIndices=e},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this._pAnimationSet,this._skeleton,this._forceCPU)};t.prototype.play=function(e,t,i){if(t===void 0){t=null}if(i===void 0){i=NaN}if(this._pActiveAnimationName==e)return;this._pActiveAnimationName=e;if(!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");if(t&&this._pActiveNode){this._pActiveNode=t.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(e),this._pAbsoluteTime);this._pActiveNode.addEventListener(p.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)}else this._pActiveNode=this._pAnimationSet.getAnimation(e);this._pActiveState=this.getAnimationState(this._pActiveNode);if(this.updatePosition){this._pActiveState.update(this._pAbsoluteTime);this._pActiveState.positionDelta}this._activeSkeletonState=this._pActiveState;this.start();if(!isNaN(i))this.reset(e,i)};t.prototype.setRenderState=function(e,t,i,r,n,o){if(this._globalPropertiesDirty)this.updateGlobalProperties();var l=t.subMesh.subGeometry;l.useCondensedIndices=this._useCondensedIndices;if(this._useCondensedIndices){this.updateCondensedMatrices(l.condensedIndexLookUp,l.numCondensedJoints);i.context.setProgramConstantsFromArray(s.VERTEX,n,this._condensedMatrices,l.numCondensedJoints*3)}else{if(this._pAnimationSet.usesCPU){if(this._morphedSubGeometryDirty[l.id])this.morphSubGeometry(t,l);return}i.context.setProgramConstantsFromArray(s.VERTEX,n,this._globalMatrices,this._numJoints*3)}i.activateBuffer(o,t.getVertexData(a.JOINT_INDEX_DATA),t.getVertexOffset(a.JOINT_INDEX_DATA),t.JOINT_INDEX_FORMAT);i.activateBuffer(o+1,t.getVertexData(a.JOINT_WEIGHT_DATA),t.getVertexOffset(a.JOINT_WEIGHT_DATA),t.JOINT_WEIGHT_FORMAT)};t.prototype.testGPUCompatibility=function(e){if(!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||e.numUsedVertexConstants+this._numJoints*3>128))this._pAnimationSet.cancelGPUCompatibility()};t.prototype._pUpdateDeltaTime=function(t){e.prototype._pUpdateDeltaTime.call(this,t);this._globalPropertiesDirty=true;if(this._pAnimationSet.usesCPU)for(var i in this._morphedSubGeometryDirty)this._morphedSubGeometryDirty[i]=true};t.prototype.updateCondensedMatrices=function(e,t){var i=0,r=0;var a;var n;this._condensedMatrices=new Array;do{n=e[i]*4;a=n+12;while(n<a)this._condensedMatrices[r++]=this._globalMatrices[n++]}while(++i<t)};t.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=false;this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);var e=0;var t=this._globalPose.jointPoses;var i;var r,a,n,s;var o,l,h;var p,u,d;var c,f,_;var g,m,y;var v,b,x;var w,P,C,D;var T,S,O,A;var R,j,V,I;var N=this._skeleton.joints;var L;var M;var F;var E;for(var B=0;B<this._numJoints;++B){L=t[B];M=L.orientation;F=L.translation;r=M.x;a=M.y;n=M.z;s=M.w;o=(E=2*r)*a;l=E*n;h=E*s;p=(E=2*a)*n;u=E*s;d=2*n*s;p=2*a*n;u=2*a*s;d=2*n*s;r*=r;a*=a;n*=n;s*=s;c=(E=r-a)-n+s;f=o-d;_=l+u;g=o+d;m=-E-n+s;y=p-h;v=l-u;b=p+h;x=-r-a+n+s;i=N[B].inverseBindPose;w=i[0];P=i[4];C=i[8];D=i[12];T=i[1];S=i[5];O=i[9];A=i[13];R=i[2];j=i[6];V=i[10];I=i[14];this._globalMatrices[e]=c*w+f*T+_*R;this._globalMatrices[e+1]=c*P+f*S+_*j;this._globalMatrices[e+2]=c*C+f*O+_*V;this._globalMatrices[e+3]=c*D+f*A+_*I+F.x;this._globalMatrices[e+4]=g*w+m*T+y*R;this._globalMatrices[e+5]=g*P+m*S+y*j;this._globalMatrices[e+6]=g*C+m*O+y*V;this._globalMatrices[e+7]=g*D+m*A+y*I+F.y;this._globalMatrices[e+8]=v*w+b*T+x*R;this._globalMatrices[e+9]=v*P+b*S+x*j;this._globalMatrices[e+10]=v*C+b*O+x*V;this._globalMatrices[e+11]=v*D+b*A+x*I+F.z;e=e+12}};t.prototype.getRenderableSubGeometry=function(e,t){this._morphedSubGeometryDirty[t.id]=true;if(!this._pAnimationSet.usesCPU)return t;var i;if(!(i=this._morphedSubGeometry[t.id])){i=this._morphedSubGeometry[t.id]=t.clone();i.autoDeriveNormals=false;i.autoDeriveTangents=false;i.autoDeriveUVs=false;t.addEventListener(n.INDICES_UPDATED,this._onIndicesUpdateDelegate);t.addEventListener(n.VERTICES_UPDATED,this._onVerticesUpdateDelegate)}return i};t.prototype.morphSubGeometry=function(e,t){this._morphedSubGeometryDirty[t.id]=false;var i=t.positions;var r=t.vertexNormals;var a=t.vertexTangents;var n=t.jointIndices;var s=t.jointWeights;var o=this._morphedSubGeometry[t.id];var l=o.positions;var h=o.vertexNormals;var p=o.vertexTangents;var u=0;var d=0;var c;var f,_,g;var m,y,v;var b,x,w;var P=i.length;var C;var D,T,S;var O,A,R;var j,V,I;var N,L,M,F;var E,B,z,U;var G,k,X,W;while(u<P){D=i[u];T=i[u+1];S=i[u+2];O=r[u];A=r[u+1];R=r[u+2];j=a[u];V=a[u+1];I=a[u+2];f=0;_=0;g=0;m=0;y=0;v=0;b=0;x=0;w=0;c=0;while(c<this._jointsPerVertex){C=s[d];if(C>0){var H=n[d++]<<2;N=this._globalMatrices[H];L=this._globalMatrices[H+1];M=this._globalMatrices[H+2];F=this._globalMatrices[H+3];E=this._globalMatrices[H+4];B=this._globalMatrices[H+5];z=this._globalMatrices[H+6];U=this._globalMatrices[H+7];G=this._globalMatrices[H+8];k=this._globalMatrices[H+9];X=this._globalMatrices[H+10];W=this._globalMatrices[H+11];f+=C*(N*D+L*T+M*S+F);_+=C*(E*D+B*T+z*S+U);g+=C*(G*D+k*T+X*S+W);m+=C*(N*O+L*A+M*R);y+=C*(E*O+B*A+z*R);v+=C*(G*O+k*A+X*R);b+=C*(N*j+L*V+M*I);x+=C*(E*j+B*V+z*I);w+=C*(G*j+k*V+X*I);++c}else{d+=this._jointsPerVertex-c;c=this._jointsPerVertex}}l[u]=f;l[u+1]=_;l[u+2]=g;h[u]=m;h[u+1]=y;h[u+2]=v;p[u]=b;p[u+1]=x;p[u+2]=w;u+=3}o.updatePositions(l);o.updateVertexNormals(h);o.updateVertexTangents(p)};t.prototype.localToGlobalPose=function(e,t,i){var r=t.jointPoses;var a;var n=i.joints;var s=e.numJointPoses;var o=e.jointPoses;var h;var p;var u;var d;var c;var f;var _;var g;var m,y,v,b;var x,w,P,C;var D,T,S;if(r.length!=s)r.length=s;for(var O=0;O<s;++O){a=r[O];if(a==null)a=r[O]=new l;p=n[O];h=p.parentIndex;d=o[O];g=a.orientation;_=a.translation;if(h<0){f=d.translation;c=d.orientation;g.x=c.x;g.y=c.y;g.z=c.z;g.w=c.w;_.x=f.x;_.y=f.y;_.z=f.z}else{u=r[h];c=u.orientation;f=d.translation;x=c.x;w=c.y;P=c.z;C=c.w;D=f.x;T=f.y;S=f.z;b=-x*D-w*T-P*S;m=C*D+w*S-P*T;y=C*T-x*S+P*D;v=C*S+x*T-w*D;f=u.translation;_.x=-b*x+m*C-y*P+v*w+f.x;_.y=-b*w+m*P+y*C-v*x+f.y;_.z=-b*P-m*w+y*x+v*C+f.z;m=c.x;y=c.y;v=c.z;b=c.w;c=d.orientation;x=c.x;w=c.y;P=c.z;C=c.w;g.w=b*C-m*x-y*w-v*P;g.x=b*x+m*C+y*P-v*w;g.y=b*w-m*P+y*C+v*x;g.z=b*P+m*w-y*x+v*C}}};t.prototype.onTransitionComplete=function(e){if(e.type==p.TRANSITION_COMPLETE){e.animationNode.removeEventListener(p.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate);if(this._pActiveState==e.animationState){this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName);this._pActiveState=this.getAnimationState(this._pActiveNode);this._activeSkeletonState=this._pActiveState}}};t.prototype.onIndicesUpdate=function(e){var t=e.target;this._morphedSubGeometry[t.id].updateIndices(t.indices)};t.prototype.onVerticesUpdate=function(e){var t=e.target;var i=this._morphedSubGeometry[t.id];switch(e.dataType){case a.UV_DATA:i.updateUVs(t.uvs);case a.SECONDARY_UV_DATA:i.updateUVs(t.secondaryUVs)}};return t}(o);t.exports=u},{"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-display/lib/events/SubGeometryEvent":undefined,"awayjs-renderergl/lib/animators/AnimatorBase":undefined,"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/events/AnimationStateEvent":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/animators/VertexAnimationSet":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/AnimationSetBase");var n=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode");var s=function(e){r(t,e);function t(t,i){if(t===void 0){t=2}if(i===void 0){i="absolute"}e.call(this);this._numPoses=t;this._blendMode=i}Object.defineProperty(t.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:true,configurable:true});t.prototype.getAGALVertexCode=function(e){if(this._blendMode==n.ABSOLUTE)return this.getAbsoluteAGALCode(e);else return this.getAdditiveAGALCode(e)};t.prototype.activate=function(e,t){};t.prototype.deactivate=function(e,t){};t.prototype.getAGALFragmentCode=function(e,t){return""};t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"};t.prototype.doneAGALCode=function(e){};t.prototype.getAbsoluteAGALCode=function(e){var t="";var i=this._pFindTempReg(e.animationTargetRegisters);var r=this._pFindTempReg(e.animationTargetRegisters,i);var a=new Array("x","y","z","w");var n=e.animatableAttributes.length;var s="vc"+e.numUsedVertexConstants;if(n>2)n=2;var o=e.numUsedStreams;for(var l=0;l<n;++l){t+="mul "+i+", "+e.animatableAttributes[l]+", "+s+"."+a[0]+"\n";for(var h=1;h<this._numPoses;++h){t+="mul "+r+", va"+o+", "+s+"."+a[h]+"\n";if(h<this._numPoses-1)t+="add "+i+", "+i+", "+r+"\n";++o}t+="add "+e.animationTargetRegisters[l]+", "+i+", "+r+"\n"}if(e.tangentDependencies>0||e.outputsNormals){t+="dp3 "+i+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\n"+"mul "+i+", "+e.animationTargetRegisters[1]+", "+i+".x\n"+"sub "+e.animationTargetRegisters[2]+", "+e.animationTargetRegisters[2]+", "+i+"\n"}return t};t.prototype.getAdditiveAGALCode=function(e){var t="";var i=e.animatableAttributes.length;var r=["x","y","z","w"];var a=this._pFindTempReg(e.animationTargetRegisters);var n;var s=e.numUsedStreams;if(i>2)i=2;t+="mov  "+e.animationTargetRegisters[0]+", "+e.animatableAttributes[0]+"\n";if(e.normalDependencies>0)t+="mov "+e.animationTargetRegisters[1]+", "+e.animatableAttributes[1]+"\n";for(var o=0;o<i;++o){for(var l=0;l<this._numPoses;++l){t+="mul "+a+", va"+(s+n)+", vc"+e.numUsedVertexConstants+"."+r[l]+"\n"+"add "+e.animationTargetRegisters[o]+", "+e.animationTargetRegisters[o]+", "+a+"\n";n++}}if(e.tangentDependencies>0||e.outputsNormals){t+="dp3 "+a+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\n"+"mul "+a+", "+e.animationTargetRegisters[1]+", "+a+".x\n"+"sub "+e.animationTargetRegisters[2]+", "+e.animatableAttributes[2]+", "+a+"\n"}return t};return t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/AnimationSetBase":undefined,"awayjs-renderergl/lib/animators/data/VertexAnimationMode":undefined}],"awayjs-renderergl/lib/animators/VertexAnimator":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/TriangleSubGeometry");var n=e("awayjs-stagegl/lib/base/ContextGLProgramType");var s=e("awayjs-stagegl/lib/pool/VertexDataPool");var o=e("awayjs-renderergl/lib/animators/AnimatorBase");var l=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode");var h=function(e){r(t,e);function t(t){e.call(this,t);this._poses=new Array;this._weights=Array(1,0,0,0);this._vertexAnimationSet=t;this._numPoses=t.numPoses;this._blendMode=t.blendMode}t.prototype.clone=function(){return new t(this._vertexAnimationSet)};t.prototype.play=function(e,t,i){if(t===void 0){t=null}if(i===void 0){i=NaN}if(this._pActiveAnimationName==e)return;this._pActiveAnimationName=e;if(!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(e);this._pActiveState=this.getAnimationState(this._pActiveNode);if(this.updatePosition){this._pActiveState.update(this._pAbsoluteTime);this._pActiveState.positionDelta}this._activeVertexState=this._pActiveState;this.start();if(!isNaN(i))this.reset(e,i)};t.prototype._pUpdateDeltaTime=function(t){e.prototype._pUpdateDeltaTime.call(this,t);var i=false;if(this._poses[0]!=this._activeVertexState.currentGeometry){this._poses[0]=this._activeVertexState.currentGeometry;i=true}if(this._poses[1]!=this._activeVertexState.nextGeometry){this._poses[1]=this._activeVertexState.nextGeometry;i=true}this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight);if(i){var r;var a=this._pOwners.length;for(var n=0;n<a;n++){r=this._pOwners[n];r._iInvalidateRenderableGeometries()}}};t.prototype.setRenderState=function(e,t,i,r,o,h){if(!this._poses.length){this.setNullPose(e,t,i,o,h);return}var p=t.subMesh;var u;var d;var c=this._numPoses;i.context.setProgramConstantsFromArray(n.VERTEX,o,this._weights,1);if(this._blendMode==l.ABSOLUTE)d=1;else d=0;for(;d<c;++d){u=this._poses[d].subGeometries[p._iIndex]||p.subGeometry;i.activateBuffer(h++,s.getItem(u,t.getIndexData(),a.POSITION_DATA),u.getOffset(a.POSITION_DATA),a.POSITION_FORMAT);if(e.normalDependencies>0)i.activateBuffer(h++,s.getItem(u,t.getIndexData(),a.NORMAL_DATA),u.getOffset(a.NORMAL_DATA),a.NORMAL_FORMAT)}};t.prototype.setNullPose=function(e,t,i,r,s){i.context.setProgramConstantsFromArray(n.VERTEX,r,this._weights,1);if(this._blendMode==l.ABSOLUTE){var o=this._numPoses;for(var h=1;h<o;++h){i.activateBuffer(s++,t.getVertexData(a.POSITION_DATA),t.getVertexOffset(a.POSITION_DATA),a.POSITION_FORMAT);if(e.normalDependencies>0)i.activateBuffer(s++,t.getVertexData(a.NORMAL_DATA),t.getVertexOffset(a.NORMAL_DATA),a.NORMAL_FORMAT)}}};t.prototype.testGPUCompatibility=function(e){};t.prototype.getRenderableSubGeometry=function(e,t){if(this._blendMode==l.ABSOLUTE&&this._poses.length)return this._poses[0].subGeometries[e.subMesh._iIndex]||t;return t};return t}(o);t.exports=h},{"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/animators/AnimatorBase":undefined,"awayjs-renderergl/lib/animators/data/VertexAnimationMode":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined,"awayjs-stagegl/lib/pool/VertexDataPool":undefined}],"awayjs-renderergl/lib/animators/data/AnimationRegisterCache":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/compilation/ShaderRegisterCache");var n=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var s=function(e){r(t,e);function t(t){e.call(this,t);this.indexDictionary=new Object;this.vertexConstantData=new Array;this.fragmentConstantData=new Array}t.prototype.reset=function(){e.prototype.reset.call(this);this.rotationRegisters=new Array;this.positionAttribute=this.getRegisterFromString(this.sourceRegisters[0]);this.scaleAndRotateTarget=this.getRegisterFromString(this.targetRegisters[0]);this.addVertexTempUsages(this.scaleAndRotateTarget,1);for(var t=1;t<this.targetRegisters.length;t++){this.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[t]));this.addVertexTempUsages(this.rotationRegisters[t-1],1)}this.scaleAndRotateTarget=new n(this.scaleAndRotateTarget.regName,this.scaleAndRotateTarget.index);this.vertexZeroConst=this.getFreeVertexConstant();this.vertexZeroConst=new n(this.vertexZeroConst.regName,this.vertexZeroConst.index,0);this.vertexOneConst=new n(this.vertexZeroConst.regName,this.vertexZeroConst.index,1);this.vertexTwoConst=new n(this.vertexZeroConst.regName,this.vertexZeroConst.index,2);this.positionTarget=this.getFreeVertexVectorTemp();this.addVertexTempUsages(this.positionTarget,1);this.positionTarget=new n(this.positionTarget.regName,this.positionTarget.index);if(this.needVelocity){this.velocityTarget=this.getFreeVertexVectorTemp();this.addVertexTempUsages(this.velocityTarget,1);this.velocityTarget=new n(this.velocityTarget.regName,this.velocityTarget.index);this.vertexTime=new n(this.velocityTarget.regName,this.velocityTarget.index,3);this.vertexLife=new n(this.positionTarget.regName,this.positionTarget.index,3)}else{var i=this.getFreeVertexVectorTemp();this.addVertexTempUsages(i,1);this.vertexTime=new n(i.regName,i.index,0);this.vertexLife=new n(i.regName,i.index,1)}};t.prototype.setUVSourceAndTarget=function(e,t){this.uvVar=this.getRegisterFromString(t);this.uvAttribute=this.getRegisterFromString(e);this.uvTarget=new n(this.positionTarget.regName,this.positionTarget.index)};t.prototype.setRegisterIndex=function(e,t,i){var r=this.indexDictionary[e.id];if(r==null)r=this.indexDictionary[e.id]=new Array(8);r[t]=i};t.prototype.getRegisterIndex=function(e,t){return this.indexDictionary[e.id][t]};t.prototype.getInitCode=function(){var e=this.sourceRegisters.length;var t="";for(var i=0;i<e;i++)t+="mov "+this.targetRegisters[i]+","+this.sourceRegisters[i]+"\n";t+="mov "+this.positionTarget+".xyz,"+this.vertexZeroConst.toString()+"\n";if(this.needVelocity)t+="mov "+this.velocityTarget+".xyz,"+this.vertexZeroConst.toString()+"\n";return t};t.prototype.getCombinationCode=function(){return"add "+this.scaleAndRotateTarget+".xyz,"+this.scaleAndRotateTarget+".xyz,"+this.positionTarget+".xyz\n"};t.prototype.initColorRegisters=function(){var e="";if(this.hasColorMulNode){this.colorMulTarget=this.getFreeVertexVectorTemp();this.addVertexTempUsages(this.colorMulTarget,1);this.colorMulVary=this.getFreeVarying();e+="mov "+this.colorMulTarget+","+this.vertexOneConst+"\n"}if(this.hasColorAddNode){this.colorAddTarget=this.getFreeVertexVectorTemp();this.addVertexTempUsages(this.colorAddTarget,1);this.colorAddVary=this.getFreeVarying();e+="mov "+this.colorAddTarget+","+this.vertexZeroConst+"\n"}return e};t.prototype.getColorPassCode=function(){var e="";if(this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){if(this.hasColorMulNode)e+="mov "+this.colorMulVary+","+this.colorMulTarget+"\n";if(this.hasColorAddNode)e+="mov "+this.colorAddVary+","+this.colorAddTarget+"\n"}return e};t.prototype.getColorCombinationCode=function(e){var t="";if(this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){var i=this.getRegisterFromString(e);this.addFragmentTempUsages(i,1);if(this.hasColorMulNode)t+="mul "+i+","+i+","+this.colorMulVary+"\n";if(this.hasColorAddNode)t+="add "+i+","+i+","+this.colorAddVary+"\n"}return t};t.prototype.getRegisterFromString=function(e){var t=e.split(/(\d+)/);return new n(t[0],parseInt(t[1]))};Object.defineProperty(t.prototype,"numVertexConstant",{get:function(){return this._numVertexConstant},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numFragmentConstant",{get:function(){return this._numFragmentConstant},enumerable:true,configurable:true});t.prototype.setDataLength=function(){this._numVertexConstant=this.numUsedVertexConstants-this.vertexConstantOffset;this._numFragmentConstant=this.numUsedFragmentConstants-this.fragmentConstantOffset;this.vertexConstantData.length=this._numVertexConstant*4;this.fragmentConstantData.length=this._numFragmentConstant*4};t.prototype.setVertexConst=function(e,t,i,r,a){if(t===void 0){t=0}if(i===void 0){i=0}if(r===void 0){r=0}if(a===void 0){a=0}var n=(e-this.vertexConstantOffset)*4;this.vertexConstantData[n++]=t;this.vertexConstantData[n++]=i;this.vertexConstantData[n++]=r;this.vertexConstantData[n]=a};t.prototype.setVertexConstFromArray=function(e,t){var i=(e-this.vertexConstantOffset)*4;for(var r=0;r<t.length;r++)this.vertexConstantData[i++]=t[r]};t.prototype.setVertexConstFromMatrix=function(e,t){var i=t.rawData;var r=(e-this.vertexConstantOffset)*4;this.vertexConstantData[r++]=i[0];this.vertexConstantData[r++]=i[4];this.vertexConstantData[r++]=i[8];this.vertexConstantData[r++]=i[12];this.vertexConstantData[r++]=i[1];this.vertexConstantData[r++]=i[5];this.vertexConstantData[r++]=i[9];this.vertexConstantData[r++]=i[13];this.vertexConstantData[r++]=i[2];this.vertexConstantData[r++]=i[6];this.vertexConstantData[r++]=i[10];this.vertexConstantData[r++]=i[14];this.vertexConstantData[r++]=i[3];this.vertexConstantData[r++]=i[7];this.vertexConstantData[r++]=i[11];this.vertexConstantData[r]=i[15]};t.prototype.setFragmentConst=function(e,t,i,r,a){if(t===void 0){t=0}if(i===void 0){i=0}if(r===void 0){r=0}if(a===void 0){a=0}var n=(e-this.fragmentConstantOffset)*4;this.fragmentConstantData[n++]=t;this.fragmentConstantData[n++]=i;this.fragmentConstantData[n++]=r;this.fragmentConstantData[n]=a};return t}(a);t.exports=s},{"awayjs-renderergl/lib/compilation/ShaderRegisterCache":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":[function(e,t,i){var r=function(){function e(){this._pVertexBuffer=new Array(8);this._pBufferContext=new Array(8);this._pBufferDirty=new Array(8);this.numProcessedVertices=0;this.previousTime=Number.NEGATIVE_INFINITY;this.animationParticles=new Array;for(var t=0;t<8;t++)this._pBufferDirty[t]=true;this._iUniqueId=e.SUBGEOM_ID_COUNT++}e.prototype.createVertexData=function(e,t){this._numVertices=e;this._totalLenOfOneVertex=t;this._pVertexData=new Array(e*t)};e.prototype.activateVertexBuffer=function(e,t,i,r){var a=i.stageIndex;var n=i.context;var s=this._pVertexBuffer[a];if(!s||this._pBufferContext[a]!=n){s=this._pVertexBuffer[a]=n.createVertexBuffer(this._numVertices,this._totalLenOfOneVertex);this._pBufferContext[a]=n;this._pBufferDirty[a]=true}if(this._pBufferDirty[a]){s.uploadFromArray(this._pVertexData,0,this._numVertices);this._pBufferDirty[a]=false}n.setVertexBufferAt(e,s,t,r)};e.prototype.dispose=function(){while(this._pVertexBuffer.length){var e=this._pVertexBuffer.pop();if(e)e.dispose()}};e.prototype.invalidateBuffer=function(){for(var e=0;e<8;e++)this._pBufferDirty[e]=true};Object.defineProperty(e.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:true,configurable:true});e.SUBGEOM_ID_COUNT=0;return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/data/ColorSegmentPoint":[function(e,t,i){var r=function(){function e(e,t){if(e<=0||e>=1)throw new Error("life exceeds range (0,1)");this._life=e;this._color=t}Object.defineProperty(e.prototype,"color",{get:function(){return this._color},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"life",{get:function(){return this._life},enumerable:true,configurable:true});return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/data/JointPose":[function(e,t,i){var r=e("awayjs-core/lib/geom/Matrix3D");var a=e("awayjs-core/lib/geom/Quaternion");var n=e("awayjs-core/lib/geom/Vector3D");var s=function(){function e(){this.orientation=new a;this.translation=new n}e.prototype.toMatrix3D=function(e){if(e===void 0){e=null}if(e==null)e=new r;this.orientation.toMatrix3D(e);e.appendTranslation(this.translation.x,this.translation.y,this.translation.z);return e};e.prototype.copyFrom=function(e){var t=e.orientation;var i=e.translation;this.orientation.x=t.x;this.orientation.y=t.y;this.orientation.z=t.z;this.orientation.w=t.w;this.translation.x=i.x;this.translation.y=i.y;this.translation.z=i.z};return e}();t.exports=s},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Quaternion":undefined,"awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/data/ParticleAnimationData":[function(e,t,i){var r=function(){function e(e,t,i,r,a){this.index=e;this.startTime=t;this.totalTime=i+r;this.duration=i;this.delay=r;this.startVertexIndex=a.startVertexIndex;this.numVertices=a.numVertices}return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/data/ParticleData":[function(e,t,i){var r=function(){function e(){}return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":[function(e,t,i){var r=function(){function e(){}e.GLOBAL=0;e.LOCAL_STATIC=1;e.LOCAL_DYNAMIC=2;return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/data/ParticleProperties":[function(e,t,i){var r=function(){function e(){}return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/data/SkeletonJoint":[function(e,t,i){var r=function(){function e(){this.parentIndex=-1}return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/data/SkeletonPose":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/library/AssetType");var n=e("awayjs-core/lib/library/NamedAssetBase");var s=e("awayjs-renderergl/lib/animators/data/JointPose");var o=function(e){r(t,e);function t(){e.call(this);this.jointPoses=new Array}Object.defineProperty(t.prototype,"numJointPoses",{get:function(){return this.jointPoses.length},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"assetType",{get:function(){return a.SKELETON_POSE},enumerable:true,configurable:true});t.prototype.jointPoseFromName=function(e){var t=this.jointPoseIndexFromName(e);if(t!=-1)return this.jointPoses[t];else return null};t.prototype.jointPoseIndexFromName=function(e){var t;var i;for(var r;r<this.jointPoses.length;r++){i=this.jointPoses[r];if(i.name==e)return t;t++}return-1};t.prototype.clone=function(){var e=new t;var i=this.jointPoses.length;for(var r=0;r<i;r++){var a=new s;var n=this.jointPoses[r];a.name=n.name;a.copyFrom(n);e.jointPoses[r]=a}return e};t.prototype.dispose=function(){this.jointPoses.length=0};return t}(n);t.exports=o},{"awayjs-core/lib/library/AssetType":undefined,"awayjs-core/lib/library/NamedAssetBase":undefined,"awayjs-renderergl/lib/animators/data/JointPose":undefined}],"awayjs-renderergl/lib/animators/data/Skeleton":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/library/AssetType");var n=e("awayjs-core/lib/library/NamedAssetBase");var s=function(e){r(t,e);function t(){e.call(this);this.joints=new Array}Object.defineProperty(t.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:true,configurable:true});t.prototype.jointFromName=function(e){var t=this.jointIndexFromName(e);if(t!=-1)return this.joints[t];else return null};t.prototype.jointIndexFromName=function(e){var t;var i;for(var r;r<this.joints.length;r++){i=this.joints[r];if(i.name==e)return t;t++}return-1};t.prototype.dispose=function(){this.joints.length=0};Object.defineProperty(t.prototype,"assetType",{get:function(){return a.SKELETON},enumerable:true,configurable:true});return t}(n);t.exports=s},{"awayjs-core/lib/library/AssetType":undefined,"awayjs-core/lib/library/NamedAssetBase":undefined}],"awayjs-renderergl/lib/animators/data/VertexAnimationMode":[function(e,t,i){var r=function(){function e(){}e.ADDITIVE="additive";e.ABSOLUTE="absolute";return e}();t.exports=r},{}],"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var s=function(e){r(t,e);function t(){e.call(this);this._pLooping=true;this._pTotalDuration=0;this._pStitchDirty=true;this._pStitchFinalFrame=false;this._pNumFrames=0;this._pDurations=new Array;this._pTotalDelta=new a;this.fixedFrameRate=true}Object.defineProperty(t.prototype,"looping",{get:function(){return this._pLooping},set:function(e){if(this._pLooping==e)return;this._pLooping=e;this._pStitchDirty=true
},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(e){if(this._pStitchFinalFrame==e)return;this._pStitchFinalFrame=e;this._pStitchDirty=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalDuration",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pTotalDuration},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalDelta",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pTotalDelta},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lastFrame",{get:function(){if(this._pStitchDirty)this._pUpdateStitch();return this._pLastFrame},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"durations",{get:function(){return this._pDurations},enumerable:true,configurable:true});t.prototype._pUpdateStitch=function(){this._pStitchDirty=false;this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1;this._pTotalDuration=0;this._pTotalDelta.x=0;this._pTotalDelta.y=0;this._pTotalDelta.z=0};return t}(n);t.exports=s},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var o=e("awayjs-renderergl/lib/animators/states/ParticleAccelerationState");var l=function(e){r(t,e);function t(t,i){if(i===void 0){i=null}e.call(this,"ParticleAcceleration",t,3);this._pStateClass=o;this._acceleration=i||new a}t.prototype.pGetAGALVertexCode=function(e,t){var i=this._pMode==n.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.ACCELERATION_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var a="mul "+r+","+t.vertexTime+","+i+"\n";if(t.needVelocity){var s=t.getFreeVertexVectorTemp();a+="mul "+s+","+r+","+t.vertexTwoConst+"\n";a+="add "+t.velocityTarget+".xyz,"+s+".xyz,"+t.velocityTarget+".xyz\n"}t.removeVertexTempUsage(r);a+="mul "+r+","+r+","+t.vertexTime+"\n";a+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n";return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ACCELERATION_VECTOR3D];if(!i)throw new Error("there is no "+t.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=i.x/2;this._pOneData[1]=i.y/2;this._pOneData[2]=i.z/2};t.ACCELERATION_VECTOR3D="AccelerationVector3D";return t}(s);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleBezierCurveState");var h=function(e){r(t,e);function t(t,i,r){if(i===void 0){i=null}if(r===void 0){r=null}e.call(this,"ParticleBezierCurve",t,6);this._pStateClass=l;this._iControlPoint=i||new a;this._iEndPoint=r||new a}t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.BEZIER_CONTROL_INDEX,i.index);var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.BEZIER_END_INDEX,r.index);var a=t.getFreeVertexVectorTemp();var o=new n(a.regName,a.index,0);var h=new n(a.regName,a.index,1);var p=new n(a.regName,a.index,2);t.addVertexTempUsages(a,1);var u=t.getFreeVertexVectorTemp();var d=new n(u.regName,u.index);t.removeVertexTempUsage(a);var c="";c+="sub "+o+","+t.vertexOneConst+","+t.vertexLife+"\n";c+="mul "+h+","+t.vertexLife+","+t.vertexLife+"\n";c+="mul "+p+","+t.vertexLife+","+o+"\n";c+="mul "+p+","+p+","+t.vertexTwoConst+"\n";c+="mul "+d+".xyz,"+p+","+i+"\n";c+="add "+t.positionTarget+".xyz,"+d+".xyz,"+t.positionTarget+".xyz\n";c+="mul "+d+".xyz,"+h+","+r+"\n";c+="add "+t.positionTarget+".xyz,"+d+".xyz,"+t.positionTarget+".xyz\n";if(t.needVelocity){c+="mul "+h+","+t.vertexLife+","+t.vertexTwoConst+"\n";c+="sub "+p+","+t.vertexOneConst+","+h+"\n";c+="mul "+p+","+t.vertexTwoConst+","+p+"\n";c+="mul "+d+".xyz,"+i+","+p+"\n";c+="add "+t.velocityTarget+".xyz,"+d+".xyz,"+t.velocityTarget+".xyz\n";c+="mul "+d+".xyz,"+r+","+h+"\n";c+="add "+t.velocityTarget+".xyz,"+d+".xyz,"+t.velocityTarget+".xyz\n"}return c};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.BEZIER_CONTROL_VECTOR3D];if(!i)throw new Error("there is no "+t.BEZIER_CONTROL_VECTOR3D+" in param!");var r=e[t.BEZIER_END_VECTOR3D];if(!r)throw new Error("there is no "+t.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=i.x;this._pOneData[1]=i.y;this._pOneData[2]=i.z;this._pOneData[3]=r.x;this._pOneData[4]=r.y;this._pOneData[5]=r.z};t.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D";t.BEZIER_END_VECTOR3D="BezierEndVector3D";return t}(o);t.exports=h},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var s=e("awayjs-renderergl/lib/animators/states/ParticleBillboardState");var o=function(e){r(t,e);function t(t){if(t===void 0){t=null}e.call(this,"ParticleBillboard",a.GLOBAL,0,4);this._pStateClass=s;this._iBillboardAxis=t}t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexConstant();t.setRegisterIndex(this,s.MATRIX_INDEX,i.index);t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();var r=t.getFreeVertexVectorTemp();var a="m33 "+r+".xyz,"+t.scaleAndRotateTarget+","+i+"\n"+"mov "+t.scaleAndRotateTarget+".xyz,"+r+"\n";var n;for(var o=0;o<t.rotationRegisters.length;o++){n=t.rotationRegisters[o];a+="m33 "+r+".xyz,"+n+","+i+"\n"+"mov "+n+".xyz,"+n+"\n"}return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){e.hasBillboard=true};return t}(n);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleBillboardState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleColorNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/ColorTransform");var n=e("awayjs-renderergl/lib/animators/ParticleAnimationSet");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleColorState");var h=function(e){r(t,e);function t(t,i,r,s,o,h,p,u,d){if(i===void 0){i=true}if(r===void 0){r=true}if(s===void 0){s=false}if(o===void 0){o=false}if(h===void 0){h=null}if(p===void 0){p=null}if(u===void 0){u=1}if(d===void 0){d=0}e.call(this,"ParticleColor",t,i&&r?16:8,n.COLOR_PRIORITY);this._pStateClass=l;this._iUsesMultiplier=i;this._iUsesOffset=r;this._iUsesCycle=s;this._iUsesPhase=o;this._iStartColor=h||new a;this._iEndColor=p||new a;this._iCycleDuration=u;this._iCyclePhase=d}t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var r=t.getFreeVertexVectorTemp();if(this._iUsesCycle){var a=t.getFreeVertexConstant();t.setRegisterIndex(this,l.CYCLE_INDEX,a.index);t.addVertexTempUsages(r,1);var n=t.getFreeVertexSingleTemp();t.removeVertexTempUsage(r);i+="mul "+n+","+t.vertexTime+","+a+".x\n";if(this._iUsesPhase)i+="add "+n+","+n+","+a+".y\n";i+="sin "+n+","+n+"\n"}if(this._iUsesMultiplier){var o=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();var h=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.START_MULTIPLIER_INDEX,o.index);t.setRegisterIndex(this,l.DELTA_MULTIPLIER_INDEX,h.index);i+="mul "+r+","+h+","+(this._iUsesCycle?n:t.vertexLife)+"\n";i+="add "+r+","+r+","+o+"\n";i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var p=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();var u=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,l.START_OFFSET_INDEX,p.index);t.setRegisterIndex(this,l.DELTA_OFFSET_INDEX,u.index);i+="mul "+r+","+u+","+(this._iUsesCycle?n:t.vertexLife)+"\n";i+="add "+r+","+r+","+p+"\n";i+="add "+t.colorAddTarget+","+r+","+t.colorAddTarget+"\n"}}return i};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){if(this._iUsesMultiplier)e.hasColorMulNode=true;if(this._iUsesOffset)e.hasColorAddNode=true};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_START_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_START_COLORTRANSFORM+" in param!");var r=e[t.COLOR_END_COLORTRANSFORM];if(!r)throw new Error("there is no "+t.COLOR_END_COLORTRANSFORM+" in param!");var a=0;if(!this._iUsesCycle){if(this._iUsesMultiplier){this._pOneData[a++]=i.redMultiplier;this._pOneData[a++]=i.greenMultiplier;this._pOneData[a++]=i.blueMultiplier;this._pOneData[a++]=i.alphaMultiplier;this._pOneData[a++]=r.redMultiplier-i.redMultiplier;this._pOneData[a++]=r.greenMultiplier-i.greenMultiplier;this._pOneData[a++]=r.blueMultiplier-i.blueMultiplier;this._pOneData[a++]=r.alphaMultiplier-i.alphaMultiplier}if(this._iUsesOffset){this._pOneData[a++]=i.redOffset/255;this._pOneData[a++]=i.greenOffset/255;this._pOneData[a++]=i.blueOffset/255;this._pOneData[a++]=i.alphaOffset/255;this._pOneData[a++]=(r.redOffset-i.redOffset)/255;this._pOneData[a++]=(r.greenOffset-i.greenOffset)/255;this._pOneData[a++]=(r.blueOffset-i.blueOffset)/255;this._pOneData[a++]=(r.alphaOffset-i.alphaOffset)/255}}else{if(this._iUsesMultiplier){this._pOneData[a++]=(i.redMultiplier+r.redMultiplier)/2;this._pOneData[a++]=(i.greenMultiplier+r.greenMultiplier)/2;this._pOneData[a++]=(i.blueMultiplier+r.blueMultiplier)/2;this._pOneData[a++]=(i.alphaMultiplier+r.alphaMultiplier)/2;this._pOneData[a++]=(i.redMultiplier-r.redMultiplier)/2;this._pOneData[a++]=(i.greenMultiplier-r.greenMultiplier)/2;this._pOneData[a++]=(i.blueMultiplier-r.blueMultiplier)/2;this._pOneData[a++]=(i.alphaMultiplier-r.alphaMultiplier)/2}if(this._iUsesOffset){this._pOneData[a++]=(i.redOffset+r.redOffset)/(255*2);this._pOneData[a++]=(i.greenOffset+r.greenOffset)/(255*2);this._pOneData[a++]=(i.blueOffset+r.blueOffset)/(255*2);this._pOneData[a++]=(i.alphaOffset+r.alphaOffset)/(255*2);this._pOneData[a++]=(i.redOffset-r.redOffset)/(255*2);this._pOneData[a++]=(i.greenOffset-r.greenOffset)/(255*2);this._pOneData[a++]=(i.blueOffset-r.blueOffset)/(255*2);this._pOneData[a++]=(i.alphaOffset-r.alphaOffset)/(255*2)}}};t.COLOR_START_COLORTRANSFORM="ColorStartColorTransform";t.COLOR_END_COLORTRANSFORM="ColorEndColorTransform";return t}(o);t.exports=h},{"awayjs-core/lib/geom/ColorTransform":undefined,"awayjs-renderergl/lib/animators/ParticleAnimationSet":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleColorState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var o=e("awayjs-renderergl/lib/animators/states/ParticleFollowState");var l=function(e){r(t,e);function t(t,i,r){if(t===void 0){t=true}if(i===void 0){i=true}if(r===void 0){r=false}e.call(this,"ParticleFollow",n.LOCAL_DYNAMIC,t&&i?6:3,a.POST_PRIORITY);this._pStateClass=o;this._iUsesPosition=t;this._iUsesRotation=i;this._iSmooth=r}t.prototype.getAGALVertexCode=function(e,t){var i="";if(this._iUsesRotation){var r=t.getFreeVertexAttribute();t.setRegisterIndex(this,o.FOLLOW_ROTATION_INDEX,r.index);var a=t.getFreeVertexVectorTemp();t.addVertexTempUsages(a,1);var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);var s=t.getFreeVertexVectorTemp();var l;if(t.hasBillboard){t.addVertexTempUsages(s,1);l=t.getFreeVertexVectorTemp()}t.removeVertexTempUsage(a);t.removeVertexTempUsage(n);if(t.hasBillboard)t.removeVertexTempUsage(s);var h=t.rotationRegisters.length;var p;i+="mov "+a+","+t.vertexZeroConst+"\n";i+="mov "+a+".x,"+t.vertexOneConst+"\n";i+="mov "+s+","+t.vertexZeroConst+"\n";i+="sin "+s+".y,"+r+".x\n";i+="cos "+s+".z,"+r+".x\n";i+="mov "+n+".x,"+t.vertexZeroConst+"\n";i+="mov "+n+".y,"+s+".z\n";i+="neg "+n+".z,"+s+".y\n";if(t.hasBillboard)i+="m33 "+l+".xyz,"+t.positionTarget+".xyz,"+a+"\n";else{i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n";for(p=0;p<h;p++)i+="m33 "+t.rotationRegisters[p]+".xyz,"+t.rotationRegisters[p]+","+a+"\n"}i+="mov "+a+","+t.vertexZeroConst+"\n";i+="cos "+a+".x,"+r+".y\n";i+="sin "+a+".z,"+r+".y\n";i+="mov "+n+","+t.vertexZeroConst+"\n";i+="mov "+n+".y,"+t.vertexOneConst+"\n";i+="mov "+s+","+t.vertexZeroConst+"\n";i+="neg "+s+".x,"+a+".z\n";i+="mov "+s+".z,"+a+".x\n";if(t.hasBillboard)i+="m33 "+l+".xyz,"+l+".xyz,"+a+"\n";else{i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n";for(p=0;p<h;p++)i+="m33 "+t.rotationRegisters[p]+".xyz,"+t.rotationRegisters[p]+","+a+"\n"}i+="mov "+n+","+t.vertexZeroConst+"\n";i+="sin "+n+".x,"+r+".z\n";i+="cos "+n+".y,"+r+".z\n";i+="mov "+a+","+t.vertexZeroConst+"\n";i+="mov "+a+".x,"+n+".y\n";i+="neg "+a+".y,"+n+".x\n";i+="mov "+s+","+t.vertexZeroConst+"\n";i+="mov "+s+".z,"+t.vertexOneConst+"\n";if(t.hasBillboard){i+="m33 "+l+".xyz,"+l+".xyz,"+a+"\n";i+="sub "+l+".xyz,"+l+".xyz,"+t.positionTarget+".xyz\n";i+="add "+t.scaleAndRotateTarget+".xyz,"+l+".xyz,"+t.scaleAndRotateTarget+".xyz\n"}else{i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n";for(p=0;p<h;p++)i+="m33 "+t.rotationRegisters[p]+".xyz,"+t.rotationRegisters[p]+","+a+"\n"}}if(this._iUsesPosition){var u=t.getFreeVertexAttribute();t.setRegisterIndex(this,o.FOLLOW_POSITION_INDEX,u.index);i+="add "+t.scaleAndRotateTarget+".xyz,"+u+","+t.scaleAndRotateTarget+".xyz\n"}return i};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(s);t.exports=l},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleFollowState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/ColorTransform");var n=e("awayjs-renderergl/lib/animators/ParticleAnimationSet");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleInitialColorState");var h=function(e){r(t,e);function t(t,i,r,s){if(i===void 0){i=true}if(r===void 0){r=false}if(s===void 0){s=null}e.call(this,"ParticleInitialColor",t,i&&r?8:4,n.COLOR_PRIORITY);this._pStateClass=l;this._iUsesMultiplier=i;this._iUsesOffset=r;this._iInitialColor=s||new a}t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){if(this._iUsesMultiplier){var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.MULTIPLIER_INDEX,r.index);i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var a=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,l.OFFSET_INDEX,a.index);i+="add "+t.colorAddTarget+","+a+","+t.colorAddTarget+"\n"}}return i};t.prototype._iProcessAnimationSetting=function(e){if(this._iUsesMultiplier)e.hasColorMulNode=true;if(this._iUsesOffset)e.hasColorAddNode=true};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_INITIAL_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_INITIAL_COLORTRANSFORM+" in param!");var r=0;if(this._iUsesMultiplier){this._pOneData[r++]=i.redMultiplier;this._pOneData[r++]=i.greenMultiplier;this._pOneData[r++]=i.blueMultiplier;this._pOneData[r++]=i.alphaMultiplier}if(this._iUsesOffset){this._pOneData[r++]=i.redOffset/255;this._pOneData[r++]=i.greenOffset/255;this._pOneData[r++]=i.blueOffset/255;this._pOneData[r++]=i.alphaOffset/255}};t.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform";return t}(o);t.exports=h},{"awayjs-core/lib/geom/ColorTransform":undefined,"awayjs-renderergl/lib/animators/ParticleAnimationSet":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var n=function(e){r(t,e);function t(i,r,a,n){if(n===void 0){n=1}e.call(this);this._pDataLength=3;i=i+t.MODES[r];this.name=i;this._pMode=r;this._priority=n;this._pDataLength=a;this._pOneData=new Array(this._pDataLength)}Object.defineProperty(t.prototype,"mode",{get:function(){return this._pMode},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"oneData",{get:function(){return this._pOneData},enumerable:true,configurable:true});t.prototype.getAGALVertexCode=function(e,t){return""};t.prototype.getAGALFragmentCode=function(e,t){return""};t.prototype.getAGALUVCode=function(e,t){return""};t.prototype._iGeneratePropertyOfOneParticle=function(e){};t.prototype._iProcessAnimationSetting=function(e){};t.GLOBAL="Global";t.LOCAL_STATIC="LocalStatic";t.LOCAL_DYNAMIC="LocalDynamic";t.MODES={0:t.GLOBAL,1:t.LOCAL_STATIC,2:t.LOCAL_DYNAMIC};return t}(a);t.exports=n},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleOrbitState");var h=function(e){r(t,e);function t(t,i,r,n,s,o,h,p){if(i===void 0){i=true}if(r===void 0){r=false}if(n===void 0){n=false}if(s===void 0){s=100}if(o===void 0){o=1}if(h===void 0){h=0}if(p===void 0){p=null}var u=3;if(n)u++;e.call(this,"ParticleOrbit",t,u);this._pStateClass=l;this._iUsesEulers=i;this._iUsesCycle=r;this._iUsesPhase=n;this._iRadius=s;this._iCycleDuration=o;this._iCyclePhase=h;this._iEulers=p||new a}t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.ORBIT_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,l.EULERS_INDEX,r.index);t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();var a=t.getFreeVertexVectorTemp();t.addVertexTempUsages(a,1);var o=new n(a.regName,a.index);var h=t.getFreeVertexVectorTemp();var p=new n(h.regName,h.index,0);var u=new n(h.regName,h.index,1);var d=new n(h.regName,h.index,2);t.removeVertexTempUsage(a);var c="";if(this._iUsesCycle){c+="mul "+d+","+t.vertexTime+","+i+".y\n";if(this._iUsesPhase)c+="add "+d+","+d+","+i+".w\n"}else c+="mul "+d+","+t.vertexLife+","+i+".y\n";c+="cos "+p+","+d+"\n";c+="sin "+u+","+d+"\n";c+="mul "+o+".x,"+p+","+i+".x\n";c+="mul "+o+".y,"+u+","+i+".x\n";c+="mov "+o+".wz"+t.vertexZeroConst+"\n";if(this._iUsesEulers)c+="m44 "+o+","+o+","+r+"\n";c+="add "+t.positionTarget+".xyz,"+o+".xyz,"+t.positionTarget+".xyz\n";if(t.needVelocity){c+="neg "+o+".x,"+u+"\n";c+="mov "+o+".y,"+p+"\n";c+="mov "+o+".zw,"+t.vertexZeroConst+"\n";if(this._iUsesEulers)c+="m44 "+o+","+o+","+r+"\n";c+="mul "+o+","+o+","+i+".z\n";c+="div "+o+","+o+","+i+".y\n";if(!this._iUsesCycle)c+="div "+o+","+o+","+t.vertexLife+"\n";c+="add "+t.velocityTarget+".xyz,"+t.velocityTarget+".xyz,"+o+".xyz\n"}return c};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ORBIT_VECTOR3D];if(!i)throw new Error("there is no "+t.ORBIT_VECTOR3D+" in param!");this._pOneData[0]=i.x;if(this._iUsesCycle&&i.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=Math.PI*2/(!this._iUsesCycle?1:i.y);this._pOneData[2]=i.x*Math.PI*2;if(this._iUsesPhase)this._pOneData[3]=i.z*Math.PI/180};t.ORBIT_VECTOR3D="OrbitVector3D";return t}(o);t.exports=h},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleOrbitState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleOscillatorState");var h=function(e){r(t,e);function t(t,i){if(i===void 0){i=null}e.call(this,"ParticleOscillator",t,4);this._pStateClass=l;this._iOscillator=i||new a}t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.OSCILLATOR_INDEX,i.index);var r=t.getFreeVertexVectorTemp();var a=new n(r.regName,r.index,0);var o=new n(r.regName,r.index,1);var h=new n(r.regName,r.index,2);t.addVertexTempUsages(r,1);var p=t.getFreeVertexVectorTemp();var u=new n(p.regName,p.index);t.removeVertexTempUsage(r);var d="";d+="mul "+a+","+t.vertexTime+","+i+".w\n";d+="sin "+o+","+a+"\n";d+="mul "+u+".xyz,"+o+","+i+".xyz\n";d+="add "+t.positionTarget+".xyz,"+u+".xyz,"+t.positionTarget+".xyz\n";if(t.needVelocity){d+="cos "+h+","+a+"\n";d+="mul "+u+".xyz,"+h+","+i+".xyz\n";d+="add "+t.velocityTarget+".xyz,"+u+".xyz,"+t.velocityTarget+".xyz\n"}return d};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.OSCILLATOR_VECTOR3D];if(!i)throw new Error("there is no "+t.OSCILLATOR_VECTOR3D+" in param!");this._pOneData[0]=i.x;this._pOneData[1]=i.y;this._pOneData[2]=i.z;if(i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI*2/i.w};t.OSCILLATOR_VECTOR3D="OscillatorVector3D";return t}(o);t.exports=h},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var o=e("awayjs-renderergl/lib/animators/states/ParticlePositionState");var l=function(e){r(t,e);function t(t,i){if(i===void 0){i=null}e.call(this,"ParticlePosition",t,3);this._pStateClass=o;this._iPosition=i||new a}t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==n.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.POSITION_INDEX,i.index);return"add "+t.positionTarget+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n"};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x;this._pOneData[1]=i.y;this._pOneData[2]=i.z};t.POSITION_VECTOR3D="PositionVector3D";return t}(s);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticlePositionState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var o=e("awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState");var l=function(e){r(t,e);function t(){e.call(this,"ParticleRotateToHeading",n.GLOBAL,0,3);this._pStateClass=o}t.prototype.getAGALVertexCode=function(e,t){var i="";var r=t.rotationRegisters.length;var n;if(t.hasBillboard){var s=t.getFreeVertexVectorTemp();t.addVertexTempUsages(s,1);var l=t.getFreeVertexVectorTemp();t.addVertexTempUsages(l,1);var h=t.getFreeVertexVectorTemp();var p=t.getFreeVertexConstant();t.setRegisterIndex(this,o.MATRIX_INDEX,p.index);t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.removeVertexTempUsage(s);t.removeVertexTempUsage(l);i+="m33 "+s+".xyz,"+t.velocityTarget+".xyz,"+p+"\n";i+="mov "+h+","+t.vertexZeroConst+"\n";i+="mov "+h+".xy,"+s+".xy\n";i+="nrm "+h+".xyz,"+h+".xyz\n";i+="mov "+l+","+t.vertexZeroConst+"\n";i+="mov "+l+".x,"+h+".y\n";i+="mov "+l+".y,"+h+".x\n";i+="mov "+s+","+t.vertexZeroConst+"\n";i+="mov "+s+".x,"+h+".x\n";i+="neg "+s+".y,"+h+".y\n";i+="mov "+h+","+t.vertexZeroConst+"\n";i+="mov "+h+".z,"+t.vertexOneConst+"\n";i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+s+"\n";for(n=0;n<r;n++)i+="m33 "+t.rotationRegisters[n]+".xyz,"+t.rotationRegisters[n]+","+s+"\n"}else{var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var d=t.getFreeVertexVectorTemp();t.addVertexTempUsages(d,1);var c=t.getFreeVertexVectorTemp();t.addVertexTempUsages(c,1);var f=t.getFreeVertexVectorTemp();var _=new a(c.regName,c.index,3);var g=new a(f.regName,f.index,3);var m=new a(u.regName,u.index,3);var y=g;t.removeVertexTempUsage(u);t.removeVertexTempUsage(d);t.removeVertexTempUsage(c);i+="mov "+d+".x,"+t.vertexOneConst+"\n";i+="mov "+d+".yz,"+t.vertexZeroConst+"\n";i+="nrm "+u+".xyz,"+t.velocityTarget+".xyz\n";i+="dp3 "+m+","+u+".xyz,"+d+".xyz\n";i+="crs "+u+".xyz,"+d+".xyz,"+u+".xyz\n";i+="nrm "+u+".xyz,"+u+".xyz\n";i+="dp3 "+c+".x,"+u+".xyz,"+u+".xyz\n";i+="sge "+c+".x,"+t.vertexZeroConst+","+c+".x\n";i+="add "+u+".z,"+c+".x,"+u+".z\n";i+="add "+y+","+m+","+t.vertexOneConst+"\n";i+="div "+y+","+y+","+t.vertexTwoConst+"\n";i+="sqt "+_+","+y+"\n";i+="sub "+y+","+t.vertexOneConst+","+m+"\n";i+="div "+y+","+y+","+t.vertexTwoConst+"\n";i+="sqt "+g+","+y+"\n";i+="mul "+c+".xyz,"+g+","+u+".xyz\n";i+="mul "+f+".xyz,"+g+","+u+".xyz\n";i+="neg "+f+".xyz,"+f+".xyz\n";i+="crs "+u+".xyz,"+c+".xyz,"+t.scaleAndRotateTarget+".xyz\n";i+="mul "+d+".xyz,"+_+","+t.scaleAndRotateTarget+".xyz\n";i+="add "+u+".xyz,"+u+".xyz,"+d+".xyz\n";i+="dp3 "+d+".w,"+c+".xyz,"+t.scaleAndRotateTarget+".xyz\n";i+="neg "+u+".w,"+d+".w\n";i+="crs "+c+".xyz,"+u+".xyz,"+f+".xyz\n";i+="mul "+d+".xyzw,"+u+".xyzw,"+_+"\n";i+="add "+c+".xyz,"+c+".xyz,"+d+".xyz\n";i+="mul "+d+".xyz,"+u+".w,"+f+".xyz\n";i+="add "+t.scaleAndRotateTarget+".xyz,"+c+".xyz,"+d+".xyz\n";for(n=0;n<r;n++){i+="mov "+d+".x,"+t.vertexOneConst+"\n";i+="mov "+d+".yz,"+t.vertexZeroConst+"\n";i+="nrm "+u+".xyz,"+t.velocityTarget+".xyz\n";i+="dp3 "+m+","+u+".xyz,"+d+".xyz\n";i+="crs "+u+".xyz,"+d+".xyz,"+u+".xyz\n";i+="nrm "+u+".xyz,"+u+".xyz\n";i+="dp3 "+c+".x,"+u+".xyz,"+u+".xyz\n";i+="sge "+c+".x,"+t.vertexZeroConst+","+c+".x\n";i+="add "+u+".z,"+c+".x,"+u+".z\n";i+="add "+y+","+m+","+t.vertexOneConst+"\n";i+="div "+y+","+y+","+t.vertexTwoConst+"\n";i+="sqt "+_+","+y+"\n";i+="sub "+y+","+t.vertexOneConst+","+m+"\n";i+="div "+y+","+y+","+t.vertexTwoConst+"\n";i+="sqt "+g+","+y+"\n";i+="mul "+c+".xyz,"+g+","+u+".xyz\n";i+="mul "+f+".xyz,"+g+","+u+".xyz\n";i+="neg "+f+".xyz,"+f+".xyz\n";i+="crs "+u+".xyz,"+c+".xyz,"+t.rotationRegisters[n]+".xyz\n";i+="mul "+d+".xyz,"+_+","+t.rotationRegisters[n]+".xyz\n";i+="add "+u+".xyz,"+u+".xyz,"+d+".xyz\n";i+="dp3 "+d+".w,"+c+".xyz,"+t.rotationRegisters[n]+".xyz\n";i+="neg "+u+".w,"+d+".w\n";i+="crs "+c+".xyz,"+u+".xyz,"+f+".xyz\n";i+="mul "+d+".xyzw,"+u+".xyzw,"+_+"\n";i+="add "+c+".xyz,"+c+".xyz,"+d+".xyz\n";i+="mul "+d+".xyz,"+u+".w,"+f+".xyz\n";i+="add "+t.rotationRegisters[n]+".xyz,"+c+".xyz,"+d+".xyz\n"}}return i};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){e.needVelocity=true};return t}(s);t.exports=l},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];
function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState");var h=function(e){r(t,e);function t(t,i){if(i===void 0){i=null}e.call(this,"ParticleRotateToPosition",t,3,3);this._pStateClass=l;this._iPosition=i||new a}t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.POSITION_INDEX,i.index);var r="";var a=t.rotationRegisters.length;var o;if(t.hasBillboard){var h=t.getFreeVertexVectorTemp();t.addVertexTempUsages(h,1);var p=t.getFreeVertexVectorTemp();t.addVertexTempUsages(p,1);var u=t.getFreeVertexVectorTemp();var d=t.getFreeVertexConstant();t.setRegisterIndex(this,l.MATRIX_INDEX,d.index);t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.removeVertexTempUsage(h);t.removeVertexTempUsage(p);r+="sub "+h+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n";r+="m33 "+h+".xyz,"+h+".xyz,"+d+"\n";r+="mov "+u+","+t.vertexZeroConst+"\n";r+="mov "+u+".xy,"+h+".xy\n";r+="nrm "+u+".xyz,"+u+".xyz\n";r+="mov "+p+","+t.vertexZeroConst+"\n";r+="mov "+p+".x,"+u+".y\n";r+="mov "+p+".y,"+u+".x\n";r+="mov "+h+","+t.vertexZeroConst+"\n";r+="mov "+h+".x,"+u+".x\n";r+="neg "+h+".y,"+u+".y\n";r+="mov "+u+","+t.vertexZeroConst+"\n";r+="mov "+u+".z,"+t.vertexOneConst+"\n";r+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+h+"\n";for(o=0;o<a;o++)r+="m33 "+t.rotationRegisters[o]+".xyz,"+t.rotationRegisters[o]+","+h+"\n"}else{var c=t.getFreeVertexVectorTemp();t.addVertexTempUsages(c,1);var f=t.getFreeVertexVectorTemp();t.addVertexTempUsages(f,1);var _=new n(f.regName,f.index,0);var g=new n(f.regName,f.index,1);var m=new n(f.regName,f.index,2);var y=new n(f.regName,f.index,3);var v=t.getFreeVertexVectorTemp();t.addVertexTempUsages(v,1);t.removeVertexTempUsage(c);t.removeVertexTempUsage(f);t.removeVertexTempUsage(v);r+="sub "+c+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n";r+="nrm "+c+".xyz,"+c+".xyz\n";r+="mov "+g+","+c+".y\n";r+="mul "+_+","+g+","+g+"\n";r+="sub "+_+","+t.vertexOneConst+","+_+"\n";r+="sqt "+_+","+_+"\n";r+="mul "+v+".x,"+_+","+t.scaleAndRotateTarget+".y\n";r+="mul "+v+".y,"+g+","+t.scaleAndRotateTarget+".z\n";r+="mul "+v+".z,"+g+","+t.scaleAndRotateTarget+".y\n";r+="mul "+v+".w,"+_+","+t.scaleAndRotateTarget+".z\n";r+="sub "+t.scaleAndRotateTarget+".y,"+v+".x,"+v+".y\n";r+="add "+t.scaleAndRotateTarget+".z,"+v+".z,"+v+".w\n";r+="abs "+v+".y,"+c+".y\n";r+="sge "+v+".z,"+v+".y,"+t.vertexOneConst+"\n";r+="mul "+v+".x,"+v+".y,"+c+".y\n";r+="mov "+c+".y,"+t.vertexZeroConst+"\n";r+="dp3 "+g+","+c+".xyz,"+c+".xyz\n";r+="sge "+y+","+t.vertexZeroConst+","+g+"\n";r+="mov "+c+".y,"+t.vertexZeroConst+"\n";r+="nrm "+c+".xyz,"+c+".xyz\n";r+="sub "+g+","+t.vertexOneConst+","+y+"\n";r+="mul "+g+","+g+","+c+".x\n";r+="mov "+_+","+c+".z\n";r+="neg "+_+","+_+"\n";r+="sub "+m+","+t.vertexOneConst+","+_+"\n";r+="mul "+m+","+v+".x,"+y+"\n";r+="add "+_+","+_+","+m+"\n";r+="mul "+v+".x,"+_+","+t.scaleAndRotateTarget+".x\n";r+="mul "+v+".y,"+g+","+t.scaleAndRotateTarget+".z\n";r+="mul "+v+".z,"+g+","+t.scaleAndRotateTarget+".x\n";r+="mul "+v+".w,"+_+","+t.scaleAndRotateTarget+".z\n";r+="sub "+t.scaleAndRotateTarget+".x,"+v+".x,"+v+".y\n";r+="add "+t.scaleAndRotateTarget+".z,"+v+".z,"+v+".w\n";for(o=0;o<a;o++){r+="sub "+c+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n";r+="nrm "+c+".xyz,"+c+".xyz\n";r+="mov "+g+","+c+".y\n";r+="mul "+_+","+g+","+g+"\n";r+="sub "+_+","+t.vertexOneConst+","+_+"\n";r+="sqt "+_+","+_+"\n";r+="mul "+v+".x,"+_+","+t.rotationRegisters[o]+".y\n";r+="mul "+v+".y,"+g+","+t.rotationRegisters[o]+".z\n";r+="mul "+v+".z,"+g+","+t.rotationRegisters[o]+".y\n";r+="mul "+v+".w,"+_+","+t.rotationRegisters[o]+".z\n";r+="sub "+t.rotationRegisters[o]+".y,"+v+".x,"+v+".y\n";r+="add "+t.rotationRegisters[o]+".z,"+v+".z,"+v+".w\n";r+="abs "+v+".y,"+c+".y\n";r+="sge "+v+".z,"+v+".y,"+t.vertexOneConst+"\n";r+="mul "+v+".x,"+v+".y,"+c+".y\n";r+="mov "+c+".y,"+t.vertexZeroConst+"\n";r+="dp3 "+g+","+c+".xyz,"+c+".xyz\n";r+="sge "+y+","+t.vertexZeroConst+","+g+"\n";r+="mov "+c+".y,"+t.vertexZeroConst+"\n";r+="nrm "+c+".xyz,"+c+".xyz\n";r+="sub "+g+","+t.vertexOneConst+","+y+"\n";r+="mul "+g+","+g+","+c+".x\n";r+="mov "+_+","+c+".z\n";r+="neg "+_+","+_+"\n";r+="sub "+m+","+t.vertexOneConst+","+_+"\n";r+="mul "+m+","+v+".x,"+y+"\n";r+="add "+_+","+_+","+m+"\n";r+="mul "+v+".x,"+_+","+t.rotationRegisters[o]+".x\n";r+="mul "+v+".y,"+g+","+t.rotationRegisters[o]+".z\n";r+="mul "+v+".z,"+g+","+t.rotationRegisters[o]+".x\n";r+="mul "+v+".w,"+_+","+t.rotationRegisters[o]+".z\n";r+="sub "+t.rotationRegisters[o]+".x,"+v+".x,"+v+".y\n";r+="add "+t.rotationRegisters[o]+".z,"+v+".z,"+v+".w\n"}}return r};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x;this._pOneData[1]=i.y;this._pOneData[2]=i.z};t.POSITION_VECTOR3D="RotateToPositionVector3D";return t}(o);t.exports=h},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState");var h=function(e){r(t,e);function t(t,i){if(i===void 0){i=null}e.call(this,"ParticleRotationalVelocity",t,4);this._pStateClass=l;this._iRotationalVelocity=i||new a}t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.ROTATIONALVELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var a=t.getFreeVertexVectorTemp();t.addVertexTempUsages(a,1);var o=t.getFreeVertexVectorTemp();t.addVertexTempUsages(o,1);var h=new n(o.regName,o.index);var p=t.getFreeVertexVectorTemp();p=new n(p.regName,p.index);var u=new n(h.regName,h.index,3);var d=new n(p.regName,p.index,3);t.removeVertexTempUsage(r);t.removeVertexTempUsage(a);t.removeVertexTempUsage(o);var c="";c+="mov "+r+".xyz,"+i+".xyz\n";c+="mov "+r+".w,"+t.vertexZeroConst+"\n";c+="mul "+u+","+t.vertexTime+","+i+".w\n";c+="sin "+d+","+u+"\n";c+="cos "+u+","+u+"\n";c+="mul "+h+".xyz,"+d+","+r+".xyz\n";c+="mul "+p+".xyz,"+d+","+r+".xyz\n";c+="neg "+p+".xyz,"+p+".xyz\n";c+="crs "+r+".xyz,"+h+".xyz,"+t.scaleAndRotateTarget+".xyz\n";c+="mul "+a+".xyz,"+u+","+t.scaleAndRotateTarget+".xyz\n";c+="add "+r+".xyz,"+r+".xyz,"+a+".xyz\n";c+="dp3 "+a+".w,"+h+".xyz,"+t.scaleAndRotateTarget+".xyz\n";c+="neg "+r+".w,"+a+".w\n";c+="crs "+h+".xyz,"+r+".xyz,"+p+".xyz\n";c+="mul "+a+".xyzw,"+r+".xyzw,"+u+"\n";c+="add "+h+".xyz,"+h+".xyz,"+a+".xyz\n";c+="mul "+a+".xyz,"+r+".w,"+p+".xyz\n";c+="add "+t.scaleAndRotateTarget+".xyz,"+h+".xyz,"+a+".xyz\n";var f=t.rotationRegisters.length;for(var _=0;_<f;_++){c+="mov "+r+".xyz,"+i+".xyz\n";c+="mov "+r+".w,"+t.vertexZeroConst+"\n";c+="mul "+u+","+t.vertexTime+","+i+".w\n";c+="sin "+d+","+u+"\n";c+="cos "+u+","+u+"\n";c+="mul "+h+".xyz,"+d+","+r+".xyz\n";c+="mul "+p+".xyz,"+d+","+r+".xyz\n";c+="neg "+p+".xyz,"+p+".xyz\n";c+="crs "+r+".xyz,"+h+".xyz,"+t.rotationRegisters[_]+".xyz\n";c+="mul "+a+".xyz,"+u+","+t.rotationRegisters[_]+"\n";c+="add "+r+".xyz,"+r+".xyz,"+a+".xyz\n";c+="dp3 "+a+".w,"+h+".xyz,"+t.rotationRegisters[_]+"\n";c+="neg "+r+".w,"+a+".w\n";c+="crs "+h+".xyz,"+r+".xyz,"+p+".xyz\n";c+="mul "+a+".xyzw,"+r+".xyzw,"+u+"\n";c+="add "+h+".xyz,"+h+".xyz,"+a+".xyz\n";c+="mul "+a+".xyz,"+r+".w,"+p+".xyz\n";c+="add "+t.rotationRegisters[_]+","+h+".xyz,"+a+".xyz\n"}return c};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ROTATIONALVELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(i.length<=0)i.z=1;else i.normalize();this._pOneData[0]=i.x;this._pOneData[1]=i.y;this._pOneData[2]=i.z;if(i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/i.w};t.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D";return t}(o);t.exports=h},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var s=e("awayjs-renderergl/lib/animators/states/ParticleScaleState");var o=function(e){r(t,e);function t(t,i,r,a,n,o,l){if(a===void 0){a=1}if(n===void 0){n=1}if(o===void 0){o=1}if(l===void 0){l=0}e.call(this,"ParticleScale",t,i&&r?4:i||r?3:2,3);this._pStateClass=s;this._iUsesCycle=i;this._iUsesPhase=r;this._iMinScale=a;this._iMaxScale=n;this._iCycleDuration=o;this._iCyclePhase=l}t.prototype.getAGALVertexCode=function(e,t){var i="";var r=t.getFreeVertexSingleTemp();var n=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,s.SCALE_INDEX,n.index);if(this._iUsesCycle){i+="mul "+r+","+t.vertexTime+","+n+".z\n";if(this._iUsesPhase)i+="add "+r+","+r+","+n+".w\n";i+="sin "+r+","+r+"\n"}i+="mul "+r+","+n+".y,"+(this._iUsesCycle?r:t.vertexLife)+"\n";i+="add "+r+","+n+".x,"+r+"\n";i+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+r+"\n";return i};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.SCALE_VECTOR3D];if(!i)throw new Error("there is no "+t.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){this._pOneData[0]=(i.x+i.y)/2;this._pOneData[1]=Math.abs(i.x-i.y)/2;if(i.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=Math.PI*2/i.z;if(this._iUsesPhase)this._pOneData[3]=i.w*Math.PI/180}else{this._pOneData[0]=i.x;this._pOneData[1]=i.y-i.x}};t.SCALE_VECTOR3D="ScaleVector3D";return t}(n);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleScaleState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var n=e("awayjs-renderergl/lib/animators/ParticleAnimationSet");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState");var h=function(e){r(t,e);function t(t,i,r,a,o,h){e.call(this,"ParticleSegmentedColor",s.GLOBAL,0,n.COLOR_PRIORITY);this._pStateClass=l;if(r>4)throw new Error("the numSegmentPoint must be less or equal 4");this._iUsesMultiplier=t;this._iUsesOffset=i;this._iNumSegmentPoint=r;this._iStartColor=a;this._iEndColor=o;this._iSegmentPoints=h}t.prototype._iProcessAnimationSetting=function(e){if(this._iUsesMultiplier)e.hasColorMulNode=true;if(this._iUsesOffset)e.hasColorAddNode=true};t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var r;if(this._iUsesMultiplier){r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1)}var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);var s=t.getFreeVertexVectorTemp();var o=new a(s.regName,s.index,0);var h=new a(s.regName,s.index,1);if(this._iUsesMultiplier)t.removeVertexTempUsage(r);t.removeVertexTempUsage(n);var p=t.getFreeVertexConstant();t.setRegisterIndex(this,l.TIME_DATA_INDEX,p.index);var u;var d;var c;if(this._iUsesMultiplier){d=t.getFreeVertexConstant();t.setRegisterIndex(this,l.START_MULTIPLIER_INDEX,d.index);c=new Array;for(u=0;u<this._iNumSegmentPoint+1;u++)c.push(t.getFreeVertexConstant())}var f;var _;if(this._iUsesOffset){f=t.getFreeVertexConstant();t.setRegisterIndex(this,l.START_OFFSET_INDEX,f.index);_=new Array;for(u=0;u<this._iNumSegmentPoint+1;u++)_.push(t.getFreeVertexConstant())}if(this._iUsesMultiplier)i+="mov "+r+","+d+"\n";if(this._iUsesOffset)i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+f+"\n";for(u=0;u<this._iNumSegmentPoint;u++){switch(u){case 0:i+="min "+h+","+t.vertexLife+","+p+".x\n";break;case 1:i+="sub "+o+","+t.vertexLife+","+p+".x\n";i+="max "+h+","+o+","+t.vertexZeroConst+"\n";i+="min "+h+","+h+","+p+".y\n";break;case 2:i+="sub "+o+","+o+","+p+".y\n";i+="max "+h+","+o+","+t.vertexZeroConst+"\n";i+="min "+h+","+h+","+p+".z\n";break;case 3:i+="sub "+o+","+o+","+p+".z\n";i+="max "+h+","+o+","+t.vertexZeroConst+"\n";i+="min "+h+","+h+","+p+".w\n";break}if(this._iUsesMultiplier){i+="mul "+n+","+h+","+c[u]+"\n";i+="add "+r+","+r+","+n+"\n"}if(this._iUsesOffset){i+="mul "+n+","+h+","+_[u]+"\n";i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+n+"\n"}}if(this._iNumSegmentPoint==0)h=t.vertexLife;else{switch(this._iNumSegmentPoint){case 1:i+="sub "+o+","+t.vertexLife+","+p+".x\n";break;case 2:i+="sub "+o+","+o+","+p+".y\n";break;case 3:i+="sub "+o+","+o+","+p+".z\n";break;case 4:i+="sub "+o+","+o+","+p+".w\n";break}i+="max "+h+","+o+","+t.vertexZeroConst+"\n"}if(this._iUsesMultiplier){i+="mul "+n+","+h+","+c[this._iNumSegmentPoint]+"\n";i+="add "+r+","+r+","+n+"\n";i+="mul "+t.colorMulTarget+","+t.colorMulTarget+","+r+"\n"}if(this._iUsesOffset){i+="mul "+n+","+h+","+_[this._iNumSegmentPoint]+"\n";i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+n+"\n"}}return i};return t}(o);t.exports=h},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var n=e("awayjs-renderergl/lib/animators/ParticleAnimationSet");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var l=e("awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState");var h=function(e){r(t,e);function t(t,i,r,a,s,o,h,p){if(a===void 0){a=1}if(s===void 0){s=1}if(o===void 0){o=1}if(h===void 0){h=0}if(p===void 0){p=Number.MAX_VALUE}e.call(this,"ParticleSpriteSheet",t,i?r?3:2:1,n.POST_PRIORITY+1);this._pStateClass=l;this._iUsesCycle=i;this._iUsesPhase=r;this._iNumColumns=a;this._iNumRows=s;this._iCyclePhase=h;this._iCycleDuration=o;this._iTotalFrames=Math.min(p,a*s)}Object.defineProperty(t.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"totalFrames",{get:function(){return this._iTotalFrames},enumerable:true,configurable:true});t.prototype.getAGALUVCode=function(e,t){var i=t.getFreeVertexConstant();var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,l.UV_INDEX_0,i.index);t.setRegisterIndex(this,l.UV_INDEX_1,r.index);var n=new a(i.regName,i.index,0);var o=new a(i.regName,i.index,1);var h=new a(i.regName,i.index,2);var p=new a(r.regName,r.index,0);var u=new a(r.regName,r.index,1);var d=new a(r.regName,r.index,2);var c=t.getFreeVertexVectorTemp();var f=new a(c.regName,c.index,0);var _=new a(c.regName,c.index,1);c=new a(c.regName,c.index,2);var g=new a(c.regName,c.index,3);var m=new a(t.uvTarget.regName,t.uvTarget.index,0);var y=new a(t.uvTarget.regName,t.uvTarget.index,1);var v="";v+="mul "+m+","+m+","+o+"\n";if(this._iNumRows>1)v+="mul "+y+","+y+","+h+"\n";if(this._iUsesCycle){if(this._iUsesPhase)v+="add "+f+","+t.vertexTime+","+d+"\n";else v+="mov "+f+","+t.vertexTime+"\n";v+="div "+f+","+f+","+u+"\n";v+="frc "+f+","+f+"\n";v+="mul "+f+","+f+","+u+"\n";v+="mul "+c+","+f+","+p+"\n"}else v+="mul "+c.toString()+","+t.vertexLife+","+n+"\n";if(this._iNumRows>1){v+="frc "+g+","+c+"\n";v+="sub "+_+","+c+","+g+"\n";v+="mul "+_+","+_+","+h+"\n";v+="add "+y+","+y+","+_+"\n"}v+="div "+g+","+c+","+o+"\n";v+="frc "+c+","+g+"\n";v+="sub "+g+","+g+","+c+"\n";v+="mul "+c+","+g+","+o+"\n";if(this._iNumRows>1)v+="frc "+c+","+c+"\n";v+="add "+m+","+m+","+c+"\n";return v};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=true};t.prototype._iGeneratePropertyOfOneParticle=function(e){if(this._iUsesCycle){var i=e[t.UV_VECTOR3D];if(!i)throw new Error("there is no "+t.UV_VECTOR3D+" in param!");if(i.x<=0)throw new Error("the cycle duration must be greater than zero");var r=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=r/i.x;this._pOneData[1]=i.x;if(this._iUsesPhase)this._pOneData[2]=i.y}};t.UV_VECTOR3D="UVVector3D";return t}(o);t.exports=h},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var s=e("awayjs-renderergl/lib/animators/states/ParticleTimeState");var o=function(e){r(t,e);function t(t,i,r){if(t===void 0){t=false}if(i===void 0){i=false}if(r===void 0){r=false}this._pStateClass=s;this._iUsesDuration=t;this._iUsesLooping=i;this._iUsesDelay=r;e.call(this,"ParticleTime",a.LOCAL_STATIC,4,0)}t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexAttribute();t.setRegisterIndex(this,s.TIME_STREAM_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,s.TIME_CONSTANT_INDEX,r.index);var a="";a+="sub "+t.vertexTime+","+r+","+i+".x\n";var n=t.getFreeVertexSingleTemp();a+="sge "+n+","+t.vertexTime+","+t.vertexZeroConst+"\n";a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+n+"\n";if(this._iUsesDuration){if(this._iUsesLooping){var o=t.getFreeVertexSingleTemp();if(this._iUsesDelay){a+="div "+o+","+t.vertexTime+","+i+".z\n";a+="frc "+o+","+o+"\n";a+="mul "+t.vertexTime+","+o+","+i+".z\n";a+="slt "+o+","+t.vertexTime+","+i+".y\n";a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+o+"\n"}else{a+="mul "+o+","+t.vertexTime+","+i+".w\n";a+="frc "+o+","+o+"\n";a+="mul "+t.vertexTime+","+o+","+i+".y\n"}}else{var l=t.getFreeVertexSingleTemp();a+="sge "+l+","+i+".y,"+t.vertexTime+"\n";a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+l+"\n"}}a+="mul "+t.vertexLife+","+t.vertexTime+","+i+".w\n";return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){this._pOneData[0]=e.startTime;this._pOneData[1]=e.duration;this._pOneData[2]=e.delay+e.duration;this._pOneData[3]=1/e.duration};return t}(n);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleTimeState":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleUVNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var s=e("awayjs-renderergl/lib/animators/ParticleAnimationSet");var o=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var l=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var h=e("awayjs-renderergl/lib/animators/states/ParticleUVState");var p=function(e){r(t,e);function t(t,i,r,a){if(i===void 0){i=1}if(r===void 0){r=1}if(a===void 0){a="x"}e.call(this,"ParticleUV",o.GLOBAL,4,s.POST_PRIORITY+1);this._pStateClass=h;this._cycle=i;this._scale=r;this._axis=a;this.updateUVData()}Object.defineProperty(t.prototype,"cycle",{get:function(){return this._cycle},set:function(e){this._cycle=e;this.updateUVData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e;this.updateUVData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"axis",{get:function(){return this._axis},set:function(e){this._axis=e},enumerable:true,configurable:true});t.prototype.getAGALUVCode=function(e,t){var i="";var r=t.getFreeVertexConstant();t.setRegisterIndex(this,h.UV_INDEX,r.index);var a=this._axis=="x"?0:this._axis=="y"?1:2;var s=new n(t.uvTarget.regName,t.uvTarget.index,a);var o=t.getFreeVertexSingleTemp();if(this._scale!=1)i+="mul "+s+","+s+","+r+".y\n";i+="mul "+o+","+t.vertexTime+","+r+".x\n";i+="sin "+o+","+o+"\n";i+="add "+s+","+s+","+o+"\n";return i};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype.updateUVData=function(){this._iUvData=new a(Math.PI*2/this._cycle,this._scale,0,0)};t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=true};t.U_AXIS="x";t.V_AXIS="y";return t}(l);t.exports=p},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/ParticleAnimationSet":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleUVState":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase");var o=e("awayjs-renderergl/lib/animators/states/ParticleVelocityState");var l=function(e){r(t,e);function t(t,i){if(i===void 0){i=null}e.call(this,"ParticleVelocity",t,3);this._pStateClass=o;this._iVelocity=i||new a}t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==n.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.VELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp();var a="";a+="mul "+r+","+t.vertexTime+","+i+"\n";a+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n";if(t.needVelocity)a+="add "+t.velocityTarget+".xyz,"+i+".xyz,"+t.velocityTarget+".xyz\n";return a};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.VELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=i.x;this._pOneData[1]=i.y;this._pOneData[2]=i.z};t.VELOCITY_VECTOR3D="VelocityVector3D";return t}(s);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":undefined,"awayjs-renderergl/lib/animators/states/ParticleVelocityState":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var n=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState");var s=function(e){r(t,e);function t(){e.call(this);this._pStateClass=n}t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined,"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase");var n=e("awayjs-renderergl/lib/animators/states/SkeletonClipState");var s=function(e){r(t,e);function t(){e.call(this);this._frames=new Array;this.highQuality=false;this._pStateClass=n}Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:true,configurable:true});t.prototype.addFrame=function(e,t){this._frames.push(e);this._pDurations.push(t);this._pNumFrames=this._pDurations.length;this._pStitchDirty=true};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);var t=this._pNumFrames-1;var i,r,a;while(t--){this._pTotalDuration+=this._pDurations[t];i=this._frames[t].jointPoses[0].translation;r=this._frames[t+1].jointPoses[0].translation;a=r.subtract(i);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}if(this._pStitchFinalFrame||!this._pLooping){this._pTotalDuration+=this._pDurations[this._pNumFrames-1];i=this._frames[0].jointPoses[0].translation;r=this._frames[1].jointPoses[0].translation;a=r.subtract(i);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}};return t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":undefined,"awayjs-renderergl/lib/animators/states/SkeletonClipState":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var n=e("awayjs-renderergl/lib/animators/states/SkeletonDifferenceState");var s=function(e){r(t,e);function t(){e.call(this);this._pStateClass=n}t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined,"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var n=e("awayjs-renderergl/lib/animators/states/SkeletonDirectionalState");var s=function(e){r(t,e);function t(){e.call(this);this._pStateClass=n}t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined,"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":undefined}],"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase");var n=e("awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState");var s=function(e){r(t,e);function t(){e.call(this);this._iInputs=new Array;this._pStateClass=n}Object.defineProperty(t.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:true,configurable:true});t.prototype.getInputIndex=function(e){return this._iInputs.indexOf(e)};t.prototype.getInputAt=function(e){return this._iInputs[e]};t.prototype.addInput=function(e){this._iInputs[this._numInputs++]=e};t.prototype.getAnimationState=function(e){return e.getAnimationState(this)};return t}(a);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":undefined,"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":undefined}],"awayjs-renderergl/lib/animators/nodes/VertexClipNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase");var s=e("awayjs-renderergl/lib/animators/states/VertexClipState");var o=function(e){r(t,e);function t(){e.call(this);this._frames=new Array;this._translations=new Array;this._pStateClass=s}Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:true,configurable:true});t.prototype.addFrame=function(e,t,i){if(i===void 0){i=null}this._frames.push(e);this._pDurations.push(t);this._translations.push(i||new a);this._pNumFrames=this._pDurations.length;this._pStitchDirty=true};t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);var t=this._pNumFrames-1;var i,r,a;while(t--){this._pTotalDuration+=this._pDurations[t];i=this._translations[t];r=this._translations[t+1];a=r.subtract(i);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}if(this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)){this._pTotalDuration+=this._pDurations[this._pNumFrames-1];i=this._translations[0];r=this._translations[1];a=r.subtract(i);this._pTotalDelta.x+=a.x;this._pTotalDelta.y+=a.y;this._pTotalDelta.z+=a.z}};return t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":undefined,"awayjs-renderergl/lib/animators/states/VertexClipState":undefined}],"awayjs-renderergl/lib/animators/states/AnimationClipState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/states/AnimationStateBase");
var n=e("awayjs-renderergl/lib/events/AnimationStateEvent");var s=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._pFramesDirty=true;this._animationClipNode=i}Object.defineProperty(t.prototype,"blendWeight",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pBlendWeight},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentFrame",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pCurrentFrame},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"nextFrame",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._pNextFrame},enumerable:true,configurable:true});t.prototype.update=function(e){if(!this._animationClipNode.looping){if(e>this._pStartTime+this._animationClipNode.totalDuration)e=this._pStartTime+this._animationClipNode.totalDuration;else if(e<this._pStartTime)e=this._pStartTime}if(this._pTime==e-this._pStartTime)return;this._pUpdateTime(e)};t.prototype.phase=function(e){var t=e*this._animationClipNode.totalDuration+this._pStartTime;if(this._pTime==t-this._pStartTime)return;this._pUpdateTime(t)};t.prototype._pUpdateTime=function(t){this._pFramesDirty=true;this._pTimeDir=t-this._pStartTime>this._pTime?1:-1;e.prototype._pUpdateTime.call(this,t)};t.prototype._pUpdateFrames=function(){this._pFramesDirty=false;var e=this._animationClipNode.looping;var t=this._animationClipNode.totalDuration;var i=this._animationClipNode.lastFrame;var r=this._pTime;if(e&&(r>=t||r<0)){r%=t;if(r<0)r+=t}if(!e&&r>=t){this.notifyPlaybackComplete();this._pCurrentFrame=i;this._pNextFrame=i;this._pBlendWeight=0}else if(!e&&r<=0){this._pCurrentFrame=0;this._pNextFrame=0;this._pBlendWeight=0}else if(this._animationClipNode.fixedFrameRate){var a=r/t*i;this._pCurrentFrame=Math.floor(a);this._pBlendWeight=a-this._pCurrentFrame;this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0;this._pNextFrame=0;var n=0,s;var o=this._animationClipNode.durations;do{s=n;n+=o[this._pNextFrame];this._pCurrentFrame=this._pNextFrame++}while(r>n);if(this._pCurrentFrame==i){this._pCurrentFrame=0;this._pNextFrame=1}this._pBlendWeight=(r-s)/o[this._pCurrentFrame]}};t.prototype.notifyPlaybackComplete=function(){if(this._animationStatePlaybackComplete==null)this._animationStatePlaybackComplete=new n(n.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode);this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)};return t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":undefined,"awayjs-renderergl/lib/events/AnimationStateEvent":undefined}],"awayjs-renderergl/lib/animators/states/AnimationStateBase":[function(e,t,i){var r=e("awayjs-core/lib/geom/Vector3D");var a=function(){function e(e,t){this._pRootDelta=new r;this._pPositionDeltaDirty=true;this._pStartTime=0;this._pAnimator=e;this._pAnimationNode=t}Object.defineProperty(e.prototype,"positionDelta",{get:function(){if(this._pPositionDeltaDirty){this._pUpdatePositionDelta()}return this._pRootDelta},enumerable:true,configurable:true});e.prototype.offset=function(e){this._pStartTime=e;this._pPositionDeltaDirty=true};e.prototype.update=function(e){if(this._pTime==e-this._pStartTime){return}this._pUpdateTime(e)};e.prototype.phase=function(e){};e.prototype._pUpdateTime=function(e){this._pTime=e-this._pStartTime;this._pPositionDeltaDirty=true};e.prototype._pUpdatePositionDelta=function(){};return e}();t.exports=a},{"awayjs-core/lib/geom/Vector3D":undefined}],"awayjs-renderergl/lib/animators/states/IAnimationState":[function(e,t,i){},{}],"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState":[function(e,t,i){},{}],"awayjs-renderergl/lib/animators/states/IVertexAnimationState":[function(e,t,i){},{}],"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleAccelerationNode=i;this._acceleration=this._particleAccelerationNode._acceleration;this.updateAccelerationData()}Object.defineProperty(t.prototype,"acceleration",{get:function(){return this._acceleration},set:function(e){this._acceleration.x=e.x;this._acceleration.y=e.y;this._acceleration.z=e.z;this.updateAccelerationData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,o){var l=a.getRegisterIndex(this._pAnimationNode,t.ACCELERATION_INDEX);if(this._particleAccelerationNode.mode==s.LOCAL_STATIC)r.activateVertexBuffer(l,this._particleAccelerationNode._iDataOffset,e,n.FLOAT_3);else a.setVertexConst(l,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)};t.prototype.updateAccelerationData=function(){if(this._particleAccelerationNode.mode==s.GLOBAL)this._halfAcceleration=new a(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2)};t.ACCELERATION_INDEX=0;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var o=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleBezierCurveNode=i;this._controlPoint=this._particleBezierCurveNode._iControlPoint;this._endPoint=this._particleBezierCurveNode._iEndPoint}Object.defineProperty(t.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(e){this._controlPoint=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endPoint",{get:function(){return this._endPoint},set:function(e){this._endPoint=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,s,o){var l=s.getRegisterIndex(this._pAnimationNode,t.BEZIER_CONTROL_INDEX);var h=s.getRegisterIndex(this._pAnimationNode,t.BEZIER_END_INDEX);if(this._particleBezierCurveNode.mode==n.LOCAL_STATIC){r.activateVertexBuffer(l,this._particleBezierCurveNode._iDataOffset,e,a.FLOAT_3);r.activateVertexBuffer(h,this._particleBezierCurveNode._iDataOffset+3,e,a.FLOAT_3)}else{s.setVertexConst(l,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z);s.setVertexConst(h,this._endPoint.x,this._endPoint.y,this._endPoint.z)}};t.BEZIER_CONTROL_INDEX=0;t.BEZIER_END_INDEX=1;return t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleBillboardState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/MathConsts");var n=e("awayjs-core/lib/geom/Matrix3D");var s=e("awayjs-core/lib/geom/Orientation3D");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._matrix=new n;this._billboardAxis=i._iBillboardAxis}t.prototype.setRenderState=function(e,i,r,n,o){var l;if(this._billboardAxis){var h=i.sourceEntity.sceneTransform.position;var p=o.sceneTransform.position.subtract(h);var u=p.crossProduct(this._billboardAxis);u.normalize();p=this.billboardAxis.crossProduct(u);p.normalize();this._matrix.copyFrom(i.sourceEntity.sceneTransform);l=this._matrix.decompose(s.AXIS_ANGLE);this._matrix.copyColumnFrom(0,u);this._matrix.copyColumnFrom(1,this.billboardAxis);this._matrix.copyColumnFrom(2,p);this._matrix.copyColumnFrom(3,h);this._matrix.appendRotation(-l[1].w*a.RADIANS_TO_DEGREES,l[1])}else{this._matrix.copyFrom(i.sourceEntity.sceneTransform);this._matrix.append(o.inverseSceneTransform);l=this._matrix.decompose(s.AXIS_ANGLE);this._matrix.identity();this._matrix.appendRotation(-l[1].w*a.RADIANS_TO_DEGREES,l[1])}n.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)};Object.defineProperty(t.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(e){this.billboardAxis=e?e.clone():null;if(this.billboardAxis)this.billboardAxis.normalize()},enumerable:true,configurable:true});t.MATRIX_INDEX=0;return t}(o);t.exports=l},{"awayjs-core/lib/geom/MathConsts":undefined,"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Orientation3D":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined}],"awayjs-renderergl/lib/animators/states/ParticleColorState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleColorNode=i;this._usesMultiplier=this._particleColorNode._iUsesMultiplier;this._usesOffset=this._particleColorNode._iUsesOffset;this._usesCycle=this._particleColorNode._iUsesCycle;this._usesPhase=this._particleColorNode._iUsesPhase;this._startColor=this._particleColorNode._iStartColor;this._endColor=this._particleColorNode._iEndColor;this._cycleDuration=this._particleColorNode._iCycleDuration;this._cyclePhase=this._particleColorNode._iCyclePhase;this.updateColorData()}Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateColorData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,o){if(a.needFragmentAnimation){var l=this._particleColorNode._iDataOffset;if(this._usesCycle)a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w);if(this._usesMultiplier){if(this._particleColorNode.mode==s.LOCAL_STATIC){r.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),l,e,n.FLOAT_4);l+=4;r.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),l,e,n.FLOAT_4);l+=4}else{a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w);a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w)}}if(this._usesOffset){if(this._particleColorNode.mode==s.LOCAL_STATIC){r.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),l,e,n.FLOAT_4);l+=4;r.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),l,e,n.FLOAT_4);l+=4}else{a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w);a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)}}}};t.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new a(Math.PI*2/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}if(this._particleColorNode.mode==s.GLOBAL){if(this._usesCycle){if(this._usesMultiplier){this._startMultiplierData=new a((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2);this._deltaMultiplierData=new a((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)}if(this._usesOffset){this._startOffsetData=new a((this._startColor.redOffset+this._endColor.redOffset)/(255*2),(this._startColor.greenOffset+this._endColor.greenOffset)/(255*2),(this._startColor.blueOffset+this._endColor.blueOffset)/(255*2),(this._startColor.alphaOffset+this._endColor.alphaOffset)/(255*2));this._deltaOffsetData=new a((this._endColor.redOffset-this._startColor.redOffset)/(255*2),(this._endColor.greenOffset-this._startColor.greenOffset)/(255*2),(this._endColor.blueOffset-this._startColor.blueOffset)/(255*2),(this._endColor.alphaOffset-this._startColor.alphaOffset)/(255*2))}}else{if(this._usesMultiplier){this._startMultiplierData=new a(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier);this._deltaMultiplierData=new a(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)}if(this._usesOffset){this._startOffsetData=new a(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255);this._deltaOffsetData=new a((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255)}}}};t.START_MULTIPLIER_INDEX=0;t.DELTA_MULTIPLIER_INDEX=1;t.START_OFFSET_INDEX=2;t.DELTA_OFFSET_INDEX=3;t.CYCLE_INDEX=4;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleFollowState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/MathConsts");var n=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i,true);this._targetPos=new n;this._targetEuler=new n;this._temp=new n;this._particleFollowNode=i;this._smooth=i._iSmooth}Object.defineProperty(t.prototype,"followTarget",{get:function(){return this._followTarget},set:function(e){this._followTarget=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"smooth",{get:function(){return this._smooth},set:function(e){this._smooth=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,n,o){if(this._followTarget){if(this._particleFollowNode._iUsesPosition){this._targetPos.x=this._followTarget.transform.position.x/i.sourceEntity.scaleX;this._targetPos.y=this._followTarget.transform.position.y/i.sourceEntity.scaleY;this._targetPos.z=this._followTarget.transform.position.z/i.sourceEntity.scaleZ}if(this._particleFollowNode._iUsesRotation){this._targetEuler.x=this._followTarget.rotationX;this._targetEuler.y=this._followTarget.rotationY;this._targetEuler.z=this._followTarget.rotationZ;this._targetEuler.scaleBy(a.DEGREES_TO_RADIANS)}}if(!this._prePos)this._prePos=this._targetPos.clone();if(!this._preEuler)this._preEuler=this._targetEuler.clone();var l=this._pTime/1e3;var h=r.previousTime;var p=l-h;var u=h!=l;if(this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation){if(u)this.processPositionAndRotation(l,p,r);r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3);r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,e,s.FLOAT_3)}else if(this._particleFollowNode._iUsesPosition){if(u)this.processPosition(l,p,r);r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)}else if(this._particleFollowNode._iUsesRotation){if(u)this.precessRotation(l,p,r);r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)}this._prePos.copyFrom(this._targetPos);this._targetEuler.copyFrom(this._targetEuler);r.previousTime=l};t.prototype.processPosition=function(e,t,i){var r=i.animationParticles;var a=i.vertexData;var n=false;var s=r.length;var o;var l;if(this._smooth){l=this._prePos.subtract(this._targetPos);l.scaleBy(1/t)}else o=this._targetPos;for(var h=0;h<s;h++){var p=(e-r[h].startTime)/r[h].totalTime;var u=(p-Math.floor(p))*r[h].totalTime;if(u-t<=0){var d=r[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(l);this._temp.scaleBy(u);o=this._targetPos.add(this._temp)}if(a[d]!=o.x||a[d+1]!=o.y||a[d+2]!=o.z){n=true;for(var c=0;c<r[h].numVertices;c++){a[d++]=o.x;a[d++]=o.y;a[d++]=o.z}}}}if(n)i.invalidateBuffer()};t.prototype.precessRotation=function(e,t,i){var r=i.animationParticles;var a=i.vertexData;var n=false;var s=r.length;var o;var l;if(this._smooth){l=this._preEuler.subtract(this._targetEuler);l.scaleBy(1/t)}else o=this._targetEuler;for(var h=0;h<s;h++){var p=(e-r[h].startTime)/r[h].totalTime;var u=(p-Math.floor(p))*r[h].totalTime;if(u-t<=0){var d=r[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(l);this._temp.scaleBy(u);o=this._targetEuler.add(this._temp)}if(a[d]!=o.x||a[d+1]!=o.y||a[d+2]!=o.z){n=true;for(var c=0;c<r[h].numVertices;c++){a[d++]=o.x;a[d++]=o.y;a[d++]=o.z}}}}if(n)i.invalidateBuffer()};t.prototype.processPositionAndRotation=function(e,t,i){var r=i.animationParticles;var a=i.vertexData;var n=false;var s=r.length;var o;var l;var h;var p;if(this._smooth){h=this._prePos.subtract(this._targetPos);h.scaleBy(1/t);p=this._preEuler.subtract(this._targetEuler);p.scaleBy(1/t)}else{o=this._targetPos;l=this._targetEuler}for(var u=0;u<s;u++){var d=(e-r[u].startTime)/r[u].totalTime;var c=(d-Math.floor(d))*r[u].totalTime;if(c-t<=0){var f=r[u].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth){this._temp.copyFrom(h);this._temp.scaleBy(c);o=this._targetPos.add(this._temp);this._temp.copyFrom(p);this._temp.scaleBy(c);l=this._targetEuler.add(this._temp)}if(a[f]!=o.x||a[f+1]!=o.y||a[f+2]!=o.z||a[f+3]!=l.x||a[f+4]!=l.y||a[f+5]!=l.z){n=true;for(var _=0;_<r[u].numVertices;_++){a[f++]=o.x;a[f++]=o.y;a[f++]=o.z;a[f++]=l.x;a[f++]=l.y;a[f++]=l.z}}}}if(n)i.invalidateBuffer()};t.FOLLOW_POSITION_INDEX=0;t.FOLLOW_ROTATION_INDEX=1;return t}(o);t.exports=l},{"awayjs-core/lib/geom/MathConsts":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleInitialColorNode=i;this._usesMultiplier=i._iUsesMultiplier;this._usesOffset=i._iUsesOffset;this._initialColor=i._iInitialColor;this.updateColorData()}Object.defineProperty(t.prototype,"initialColor",{get:function(){return this._initialColor},set:function(e){this._initialColor=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,o){i=i;o=o;if(a.needFragmentAnimation){if(this._particleInitialColorNode.mode==s.LOCAL_STATIC){var l=this._particleInitialColorNode._iDataOffset;if(this._usesMultiplier){r.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),l,e,n.FLOAT_4);l+=4}if(this._usesOffset)r.activateVertexBuffer(a.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),l,e,n.FLOAT_4)}else{if(this._usesMultiplier)a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w);if(this._usesOffset)a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)}}};t.prototype.updateColorData=function(){if(this._particleInitialColorNode.mode==s.GLOBAL){if(this._usesMultiplier)this._multiplierData=new a(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier);if(this._usesOffset)this._offsetData=new a(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)}};t.MULTIPLIER_INDEX=0;t.OFFSET_INDEX=1;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleOrbitState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3D");var n=e("awayjs-core/lib/geom/Vector3D");var s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var o=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var l=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var h=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleOrbitNode=i;this._usesEulers=this._particleOrbitNode._iUsesEulers;this._usesCycle=this._particleOrbitNode._iUsesCycle;this._usesPhase=this._particleOrbitNode._iUsesPhase;this._eulers=this._particleOrbitNode._iEulers;this._radius=this._particleOrbitNode._iRadius;this._cycleDuration=this._particleOrbitNode._iCycleDuration;this._cyclePhase=this._particleOrbitNode._iCyclePhase;this.updateOrbitData()}Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateOrbitData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"eulers",{get:function(){return this._eulers},set:function(e){this._eulers=e;this.updateOrbitData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,n){var l=a.getRegisterIndex(this._pAnimationNode,t.ORBIT_INDEX);if(this._particleOrbitNode.mode==o.LOCAL_STATIC){if(this._usesPhase)r.activateVertexBuffer(l,this._particleOrbitNode._iDataOffset,e,s.FLOAT_4);else r.activateVertexBuffer(l,this._particleOrbitNode._iDataOffset,e,s.FLOAT_3)}else a.setVertexConst(l,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w);if(this._usesEulers)a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.EULERS_INDEX),this._eulersMatrix)};t.prototype.updateOrbitData=function(){if(this._usesEulers){this._eulersMatrix=new a;this._eulersMatrix.appendRotation(this._eulers.x,n.X_AXIS);this._eulersMatrix.appendRotation(this._eulers.y,n.Y_AXIS);this._eulersMatrix.appendRotation(this._eulers.z,n.Z_AXIS)}if(this._particleOrbitNode.mode==o.GLOBAL){this._orbitData=new n(this._radius,0,this._radius*Math.PI*2,this._cyclePhase*Math.PI/180);if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=Math.PI*2/this._cycleDuration}else this._orbitData.y=Math.PI*2}};t.ORBIT_INDEX=0;t.EULERS_INDEX=1;return t}(l);t.exports=h},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleOscillatorNode=i;this._oscillator=this._particleOscillatorNode._iOscillator;this.updateOscillatorData()}Object.defineProperty(t.prototype,"oscillator",{get:function(){return this._oscillator},set:function(e){this._oscillator=e;this.updateOscillatorData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,o){var l=a.getRegisterIndex(this._pAnimationNode,t.OSCILLATOR_INDEX);if(this._particleOscillatorNode.mode==s.LOCAL_STATIC)r.activateVertexBuffer(l,this._particleOscillatorNode._iDataOffset,e,n.FLOAT_4);else a.setVertexConst(l,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)};t.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==s.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");if(this._oscillatorData==null)this._oscillatorData=new a;this._oscillatorData.x=this._oscillator.x;this._oscillatorData.y=this._oscillator.y;this._oscillatorData.z=this._oscillator.z;this._oscillatorData.w=Math.PI*2/this._oscillator.w}};t.OSCILLATOR_INDEX=0;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticlePositionState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var o=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particlePositionNode=i;this._position=this._particlePositionNode._iPosition}Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:true,configurable:true});t.prototype.getPositions=function(){return this._pDynamicProperties};t.prototype.setPositions=function(e){this._pDynamicProperties=e;this._pDynamicPropertiesDirty=new Object};t.prototype.setRenderState=function(e,i,r,s,o){if(this._particlePositionNode.mode==n.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[r._iUniqueId])this._pUpdateDynamicProperties(r);var l=s.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);if(this._particlePositionNode.mode==n.GLOBAL)s.setVertexConst(l,this._position.x,this._position.y,this._position.z);else r.activateVertexBuffer(l,this._particlePositionNode._iDataOffset,e,a.FLOAT_3)};t.POSITION_INDEX=0;return t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3D");var n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var s=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._matrix=new a}t.prototype.setRenderState=function(e,i,r,a,n){if(a.hasBillboard){this._matrix.copyFrom(i.sourceEntity.sceneTransform);this._matrix.append(n.inverseSceneTransform);a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)}};t.MATRIX_INDEX=0;return t}(n);t.exports=s},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined}],"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._matrix=new a;this._particleRotateToPositionNode=i;this._position=this._particleRotateToPositionNode._iPosition}Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,o){var l=a.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);if(a.hasBillboard){this._matrix.copyFrom(i.sourceEntity.sceneTransform);this._matrix.append(o.inverseSceneTransform);a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)}if(this._particleRotateToPositionNode.mode==s.GLOBAL){this._offset=i.sourceEntity.inverseSceneTransform.transformVector(this._position);
a.setVertexConst(l,this._offset.x,this._offset.y,this._offset.z)}else r.activateVertexBuffer(l,this._particleRotateToPositionNode._iDataOffset,e,n.FLOAT_3)};t.MATRIX_INDEX=0;t.POSITION_INDEX=1;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleRotationalVelocityNode=i;this._rotationalVelocity=this._particleRotationalVelocityNode._iRotationalVelocity;this.updateRotationalVelocityData()}Object.defineProperty(t.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(e){this._rotationalVelocity=e;this.updateRotationalVelocityData()},enumerable:true,configurable:true});t.prototype.getRotationalVelocities=function(){return this._pDynamicProperties};t.prototype.setRotationalVelocities=function(e){this._pDynamicProperties=e;this._pDynamicPropertiesDirty=new Object};t.prototype.setRenderState=function(e,i,r,a,o){if(this._particleRotationalVelocityNode.mode==s.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[r._iUniqueId])this._pUpdateDynamicProperties(r);var l=a.getRegisterIndex(this._pAnimationNode,t.ROTATIONALVELOCITY_INDEX);if(this._particleRotationalVelocityNode.mode==s.GLOBAL)a.setVertexConst(l,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w);else r.activateVertexBuffer(l,this._particleRotationalVelocityNode._iDataOffset,e,n.FLOAT_4)};t.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==s.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var e=this._rotationalVelocity.clone();if(e.length<=0)e.z=1;else e.normalize();this._rotationalVelocityData=new a(e.x,e.y,e.z,Math.PI/e.w)}};t.ROTATIONALVELOCITY_INDEX=0;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleScaleState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleScaleNode=i;this._usesCycle=this._particleScaleNode._iUsesCycle;this._usesPhase=this._particleScaleNode._iUsesPhase;this._minScale=this._particleScaleNode._iMinScale;this._maxScale=this._particleScaleNode._iMaxScale;this._cycleDuration=this._particleScaleNode._iCycleDuration;this._cyclePhase=this._particleScaleNode._iCyclePhase;this.updateScaleData()}Object.defineProperty(t.prototype,"minScale",{get:function(){return this._minScale},set:function(e){this._minScale=e;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateScaleData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateScaleData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,o){var l=a.getRegisterIndex(this._pAnimationNode,t.SCALE_INDEX);if(this._particleScaleNode.mode==s.LOCAL_STATIC){if(this._usesCycle){if(this._usesPhase)r.activateVertexBuffer(l,this._particleScaleNode._iDataOffset,e,n.FLOAT_4);else r.activateVertexBuffer(l,this._particleScaleNode._iDataOffset,e,n.FLOAT_3)}else r.activateVertexBuffer(l,this._particleScaleNode._iDataOffset,e,n.FLOAT_2)}else a.setVertexConst(l,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)};t.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==s.GLOBAL){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new a((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,Math.PI*2/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new a(this._minScale,this._maxScale-this._minScale,0,0)}};t.SCALE_INDEX=0;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var n=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._usesMultiplier=i._iUsesMultiplier;this._usesOffset=i._iUsesOffset;this._startColor=i._iStartColor;this._endColor=i._iEndColor;this._segmentPoints=i._iSegmentPoints;this._numSegmentPoint=i._iNumSegmentPoint;this.updateColorData()}Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(e){this._segmentPoints=e;this.updateColorData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,a,n){if(a.needFragmentAnimation){if(this._numSegmentPoint>0)a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]);if(this._usesMultiplier)a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._multiplierData);if(this._usesOffset)a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._offsetData)}};t.prototype.updateColorData=function(){this._timeLifeData=new Array;this._multiplierData=new Array;this._offsetData=new Array;var e;for(e=0;e<this._numSegmentPoint;e++){if(e==0)this._timeLifeData.push(this._segmentPoints[e].life);else this._timeLifeData.push(this._segmentPoints[e].life-this._segmentPoints[e-1].life)}if(this._numSegmentPoint==0)this._timeLifeData.push(1);else this._timeLifeData.push(1-this._segmentPoints[e-1].life);if(this._usesMultiplier){this._multiplierData.push(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier);for(e=0;e<this._numSegmentPoint;e++){if(e==0)this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[e]);else this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e])}if(this._numSegmentPoint==0)this._multiplierData.push(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier);else this._multiplierData.push((this._endColor.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._endColor.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._endColor.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._endColor.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e])}if(this._usesOffset){this._offsetData.push(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255);for(e=0;e<this._numSegmentPoint;e++){if(e==0)this._offsetData.push((this._segmentPoints[e].color.redOffset-this._startColor.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[e]/255);else this._offsetData.push((this._segmentPoints[e].color.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255)}if(this._numSegmentPoint==0)this._offsetData.push((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255);else this._offsetData.push((this._endColor.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._endColor.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._endColor.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._endColor.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255)}this._timeLifeData.length=4};t.START_MULTIPLIER_INDEX=0;t.START_OFFSET_INDEX=1;t.TIME_DATA_INDEX=2;return t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined}],"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var o=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleSpriteSheetNode=i;this._usesCycle=this._particleSpriteSheetNode._iUsesCycle;this._usesPhase=this._particleSpriteSheetNode._iUsesCycle;this._totalFrames=this._particleSpriteSheetNode._iTotalFrames;this._numColumns=this._particleSpriteSheetNode._iNumColumns;this._numRows=this._particleSpriteSheetNode._iNumRows;this._cycleDuration=this._particleSpriteSheetNode._iCycleDuration;this._cyclePhase=this._particleSpriteSheetNode._iCyclePhase;this.updateSpriteSheetData()}Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e;this.updateSpriteSheetData()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e;this.updateSpriteSheetData()},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,i,r,s,o){if(s.needUVAnimation){s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]);if(this._usesCycle){var l=s.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_1);if(this._particleSpriteSheetNode.mode==n.LOCAL_STATIC){if(this._usesPhase)r.activateVertexBuffer(l,this._particleSpriteSheetNode._iDataOffset,e,a.FLOAT_3);else r.activateVertexBuffer(l,this._particleSpriteSheetNode._iDataOffset,e,a.FLOAT_2)}else s.setVertexConst(l,this._spriteSheetData[4],this._spriteSheetData[5])}}};t.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var e=this._totalFrames/this._numColumns;this._spriteSheetData[0]=e;this._spriteSheetData[1]=1/this._numColumns;this._spriteSheetData[2]=1/this._numRows;if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=e/this._cycleDuration;this._spriteSheetData[5]=this._cycleDuration;if(this._usesPhase)this._spriteSheetData[6]=this._cyclePhase}};t.UV_INDEX_0=0;t.UV_INDEX_1=1;return t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleStateBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/states/AnimationStateBase");var n=function(e){r(t,e);function t(t,i,r){if(r===void 0){r=false}e.call(this,t,i);this._pDynamicProperties=new Array;this._pDynamicPropertiesDirty=new Object;this._particleNode=i;this._pNeedUpdateTime=r}Object.defineProperty(t.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:true,configurable:true});t.prototype.setRenderState=function(e,t,i,r,a){};t.prototype._pUpdateDynamicProperties=function(e){this._pDynamicPropertiesDirty[e._iUniqueId]=true;var t=e.animationParticles;var i=e.vertexData;var r=e.totalLenOfOneVertex;var a=this._particleNode.dataLength;var n=this._particleNode._iDataOffset;var s;var o;var l;var h;var p;var u=this._pDynamicProperties.length;var d=0;var c=0;var f=0;while(d<u){while(c<u&&(p=t[c]).index==d){h=this._pDynamicProperties[d];s=p.numVertices*r;o=p.startVertexIndex*r+n;for(f=0;f<s;f+=r){l=o+f;for(f=0;f<s;f+=r){l=o+f;i[l++]=h.x;i[l++]=h.y;i[l++]=h.z;if(a==4)i[l++]=h.w}}c++}d++}e.invalidateBuffer()};return t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":undefined}],"awayjs-renderergl/lib/animators/states/ParticleTimeState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var s=function(e){r(t,e);function t(t,i){e.call(this,t,i,true);this._particleTimeNode=i}t.prototype.setRenderState=function(e,i,r,n,s){r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,e,a.FLOAT_4);var o=this._pTime/1e3;n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.TIME_CONSTANT_INDEX),o,o,o,o)};t.TIME_STREAM_INDEX=0;t.TIME_CONSTANT_INDEX=1;return t}(n);t.exports=s},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/ParticleUVState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var n=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleUVNode=i}t.prototype.setRenderState=function(e,i,r,a,n){if(a.needUVAnimation){var s=a.getRegisterIndex(this._pAnimationNode,t.UV_INDEX);var o=this._particleUVNode._iUvData;a.setVertexConst(s,o.x,o.y)}};t.UV_INDEX=0;return t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined}],"awayjs-renderergl/lib/animators/states/ParticleVelocityState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode");var s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase");var o=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._particleVelocityNode=i;this._velocity=this._particleVelocityNode._iVelocity}Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity=e},enumerable:true,configurable:true});t.prototype.getVelocities=function(){return this._pDynamicProperties};t.prototype.setVelocities=function(e){this._pDynamicProperties=e;this._pDynamicPropertiesDirty=new Object};t.prototype.setRenderState=function(e,i,r,s,o){if(this._particleVelocityNode.mode==n.LOCAL_DYNAMIC&&!this._pDynamicPropertiesDirty[r._iUniqueId])this._pUpdateDynamicProperties(r);var l=s.getRegisterIndex(this._pAnimationNode,t.VELOCITY_INDEX);if(this._particleVelocityNode.mode==n.GLOBAL)s.setVertexConst(l,this._velocity.x,this._velocity.y,this._velocity.z);else r.activateVertexBuffer(l,this._particleVelocityNode._iDataOffset,e,a.FLOAT_3)};t.VELOCITY_INDEX=0;return t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":undefined,"awayjs-renderergl/lib/animators/states/ParticleStateBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/data/JointPose");var n=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase");var o=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._blendWeight=0;this._skeletonPose=new n;this._skeletonPoseDirty=true;this._skeletonAnimationNode=i;this._inputA=t.getAnimationState(this._skeletonAnimationNode.inputA);this._inputB=t.getAnimationState(this._skeletonAnimationNode.inputB)}Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true},enumerable:true,configurable:true});t.prototype.phase=function(e){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._inputA.phase(e);this._inputB.phase(e)};t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=true;this._inputA.update(t);this._inputB.update(t);e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var e=this._inputA.positionDelta;var t=this._inputB.positionDelta;this._pRootDelta.x=e.x+this._blendWeight*(t.x-e.x);this._pRootDelta.y=e.y+this._blendWeight*(t.y-e.y);this._pRootDelta.z=e.z+this._blendWeight*(t.z-e.z)};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;var t;var i=this._skeletonPose.jointPoses;var r=this._inputA.getSkeletonPose(e).jointPoses;var n=this._inputB.getSkeletonPose(e).jointPoses;var s,o;var l,h;var p;var u=e.numJoints;if(i.length!=u)i.length=u;for(var d=0;d<u;++d){t=i[d];if(t==null)t=i[d]=new a;s=r[d];o=n[d];l=s.translation;h=o.translation;t.orientation.lerp(s.orientation,o.orientation,this._blendWeight);p=t.translation;p.x=l.x+this._blendWeight*(h.x-l.x);p.y=l.y+this._blendWeight*(h.y-l.y);p.z=l.z+this._blendWeight*(h.z-l.z)}};return t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/animators/states/AnimationStateBase":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonClipState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-renderergl/lib/animators/data/JointPose");var s=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var o=e("awayjs-renderergl/lib/animators/states/AnimationClipState");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._rootPos=new a;this._skeletonPose=new s;this._skeletonPoseDirty=true;this._skeletonClipNode=i;this._frames=this._skeletonClipNode.frames}Object.defineProperty(t.prototype,"currentPose",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._currentPose},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"nextPose",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._nextPose},enumerable:true,configurable:true});t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=true;e.prototype._pUpdateTime.call(this,t)};t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this);this._currentPose=this._frames[this._pCurrentFrame];if(this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame){this._nextPose=this._frames[0];this._pAnimator.dispatchCycleEvent()}else this._nextPose=this._frames[this._pNextFrame]};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;if(!this._skeletonClipNode.totalDuration)return;if(this._pFramesDirty)this._pUpdateFrames();var t=this._currentPose.jointPoses;var i=this._nextPose.jointPoses;var r=e.numJoints;var a,s;var o,l;var h=this._skeletonPose.jointPoses;var p;var u;if(h.length!=r)h.length=r;if(r!=t.length||r!=i.length)throw new Error("joint counts don't match!");for(var d=0;d<r;++d){p=h[d];if(p==null)p=h[d]=new n;o=t[d];l=i[d];a=o.translation;s=l.translation;if(this._skeletonClipNode.highQuality)p.orientation.slerp(o.orientation,l.orientation,this._pBlendWeight);else p.orientation.lerp(o.orientation,l.orientation,this._pBlendWeight);if(d>0){u=p.translation;u.x=a.x+this._pBlendWeight*(s.x-a.x);u.y=a.y+this._pBlendWeight*(s.y-a.y);u.z=a.z+this._pBlendWeight*(s.z-a.z)}}};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;if(this._pFramesDirty)this._pUpdateFrames();var e,t,i;var r=this._skeletonClipNode.totalDelta;if(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame){this._rootPos.x-=r.x*this._pTimeDir;this._rootPos.y-=r.y*this._pTimeDir;this._rootPos.z-=r.z*this._pTimeDir}var a=this._rootPos.x;var n=this._rootPos.y;var s=this._rootPos.z;if(this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame){e=this._frames[0].jointPoses[0].translation;t=this._frames[1].jointPoses[0].translation;i=this._currentPose.jointPoses[0].translation;this._rootPos.x=i.x+e.x+this._pBlendWeight*(t.x-e.x);this._rootPos.y=i.y+e.y+this._pBlendWeight*(t.y-e.y);this._rootPos.z=i.z+e.z+this._pBlendWeight*(t.z-e.z)}else{e=this._currentPose.jointPoses[0].translation;t=this._frames[this._pNextFrame].jointPoses[0].translation;this._rootPos.x=e.x+this._pBlendWeight*(t.x-e.x);this._rootPos.y=e.y+this._pBlendWeight*(t.y-e.y);this._rootPos.z=e.z+this._pBlendWeight*(t.z-e.z)}this._pRootDelta.x=this._rootPos.x-a;this._pRootDelta.y=this._rootPos.y-n;this._pRootDelta.z=this._rootPos.z-s;this._pOldFrame=this._pNextFrame};return t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/animators/states/AnimationClipState":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Quaternion");var n=e("awayjs-renderergl/lib/animators/data/JointPose");var s=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var o=e("awayjs-renderergl/lib/animators/states/AnimationStateBase");var l=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._blendWeight=0;this._skeletonPose=new s;this._skeletonPoseDirty=true;this._skeletonAnimationNode=i;this._baseInput=t.getAnimationState(this._skeletonAnimationNode.baseInput);this._differenceInput=t.getAnimationState(this._skeletonAnimationNode.differenceInput)}Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true},enumerable:true,configurable:true});t.prototype.phase=function(e){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._baseInput.phase(e);this._baseInput.phase(e)};t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=true;this._baseInput.update(t);this._differenceInput.update(t);e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var e=this._baseInput.positionDelta;var t=this._differenceInput.positionDelta;this.positionDelta.x=e.x+this._blendWeight*t.x;this.positionDelta.y=e.y+this._blendWeight*t.y;this.positionDelta.z=e.z+this._blendWeight*t.z};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;var i;var r=this._skeletonPose.jointPoses;var a=this._baseInput.getSkeletonPose(e).jointPoses;var s=this._differenceInput.getSkeletonPose(e).jointPoses;var o,l;var h,p;var u;var d=e.numJoints;if(r.length!=d)r.length=d;for(var c=0;c<d;++c){i=r[c];if(i==null)i=r[c]=new n;o=a[c];l=s[c];h=o.translation;p=l.translation;t._tempQuat.multiply(l.orientation,o.orientation);i.orientation.lerp(o.orientation,t._tempQuat,this._blendWeight);u=i.translation;u.x=h.x+this._blendWeight*p.x;u.y=h.y+this._blendWeight*p.y;u.z=h.z+this._blendWeight*p.z}};t._tempQuat=new a;return t}(o);t.exports=l},{"awayjs-core/lib/geom/Quaternion":undefined,"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/animators/states/AnimationStateBase":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/data/JointPose");var n=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase");var o=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._skeletonPose=new n;this._skeletonPoseDirty=true;this._blendWeight=0;this._direction=0;this._blendDirty=true;this._skeletonAnimationNode=i;this._forward=t.getAnimationState(this._skeletonAnimationNode.forward);this._backward=t.getAnimationState(this._skeletonAnimationNode.backward);this._left=t.getAnimationState(this._skeletonAnimationNode.left);this._right=t.getAnimationState(this._skeletonAnimationNode.right)}Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){if(this._direction==e)return;this._direction=e;this._blendDirty=true;this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true},enumerable:true,configurable:true});t.prototype.phase=function(e){if(this._blendDirty)this.updateBlend();this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;this._inputA.phase(e);this._inputB.phase(e)};t.prototype._pUdateTime=function(t){if(this._blendDirty)this.updateBlend();this._skeletonPoseDirty=true;this._inputA.update(t);this._inputB.update(t);e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;if(this._blendDirty)this.updateBlend();var e=this._inputA.positionDelta;var t=this._inputB.positionDelta;this.positionDelta.x=e.x+this._blendWeight*(t.x-e.x);this.positionDelta.y=e.y+this._blendWeight*(t.y-e.y);this.positionDelta.z=e.z+this._blendWeight*(t.z-e.z)};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;if(this._blendDirty)this.updateBlend();var t;var i=this._skeletonPose.jointPoses;var r=this._inputA.getSkeletonPose(e).jointPoses;var n=this._inputB.getSkeletonPose(e).jointPoses;var s,o;var l,h;var p;var u=e.numJoints;if(i.length!=u)i.length=u;for(var d=0;d<u;++d){t=i[d];if(t==null)t=i[d]=new a;s=r[d];o=n[d];l=s.translation;h=o.translation;t.orientation.lerp(s.orientation,o.orientation,this._blendWeight);p=t.translation;p.x=l.x+this._blendWeight*(h.x-l.x);p.y=l.y+this._blendWeight*(h.y-l.y);p.z=l.z+this._blendWeight*(h.z-l.z)}};t.prototype.updateBlend=function(){this._blendDirty=false;if(this._direction<0||this._direction>360){this._direction%=360;if(this._direction<0)this._direction+=360}if(this._direction<90){this._inputA=this._forward;this._inputB=this._right;this._blendWeight=this._direction/90}else if(this._direction<180){this._inputA=this._right;this._inputB=this._backward;this._blendWeight=(this._direction-90)/90}else if(this._direction<270){this._inputA=this._backward;this._inputB=this._left;this._blendWeight=(this._direction-180)/90}else{this._inputA=this._left;this._inputB=this._forward;this._blendWeight=(this._direction-270)/90}};return t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/animators/states/AnimationStateBase":undefined}],"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];
function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/data/JointPose");var n=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase");var o=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._skeletonPose=new n;this._skeletonPoseDirty=true;this._blendWeights=new Array;this._inputs=new Array;this._skeletonAnimationNode=i;var r=this._skeletonAnimationNode.numInputs;while(r--)this._inputs[r]=t.getAnimationState(this._skeletonAnimationNode._iInputs[r])}t.prototype.phase=function(e){this._skeletonPoseDirty=true;this._pPositionDeltaDirty=true;for(var t=0;t<this._skeletonAnimationNode.numInputs;++t){if(this._blendWeights[t])this._inputs[t].update(e)}};t.prototype._pUdateTime=function(t){for(var i=0;i<this._skeletonAnimationNode.numInputs;++i){if(this._blendWeights[i])this._inputs[i].update(t)}e.prototype._pUpdateTime.call(this,t)};t.prototype.getSkeletonPose=function(e){if(this._skeletonPoseDirty)this.updateSkeletonPose(e);return this._skeletonPose};t.prototype.getBlendWeightAt=function(e){return this._blendWeights[e]};t.prototype.setBlendWeightAt=function(e,t){this._blendWeights[e]=t;this._pPositionDeltaDirty=true;this._skeletonPoseDirty=true};t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=false;var e;var t;this.positionDelta.x=0;this.positionDelta.y=0;this.positionDelta.z=0;for(var i=0;i<this._skeletonAnimationNode.numInputs;++i){t=this._blendWeights[i];if(t){e=this._inputs[i].positionDelta;this.positionDelta.x+=t*e.x;this.positionDelta.y+=t*e.y;this.positionDelta.z+=t*e.z}}};t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=false;var t;var i=this._skeletonPose.jointPoses;var r;var n,s;var o,l;var h,p;var u;var d;var c,f,_,g;var m,y,v,b;var x=e.numJoints;if(i.length!=x)i.length=x;for(var w=0;w<this._skeletonAnimationNode.numInputs;++w){t=this._blendWeights[w];if(!t)continue;r=this._inputs[w].getSkeletonPose(e).jointPoses;if(!u){u=r;for(d=0;d<x;++d){n=i[d];if(n==null)n=i[d]=new a;s=r[d];p=s.orientation;l=s.translation;h=n.orientation;h.x=t*p.x;h.y=t*p.y;h.z=t*p.z;h.w=t*p.w;o=n.translation;o.x=t*l.x;o.y=t*l.y;o.z=t*l.z}}else{for(d=0;d<e.numJoints;++d){n=i[d];s=r[d];p=u[d].orientation;f=p.x;_=p.y;g=p.z;c=p.w;p=s.orientation;l=s.translation;y=p.x;v=p.y;b=p.z;m=p.w;if(f*y+_*v+g*b+c*m<0){y=-y;v=-v;b=-b;m=-m}h=n.orientation;h.x+=t*y;h.y+=t*v;h.z+=t*b;h.w+=t*m;o=n.translation;o.x+=t*l.x;o.y+=t*l.y;o.z+=t*l.z}}}for(d=0;d<e.numJoints;++d)i[d].orientation.normalize()};return t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/animators/states/AnimationStateBase":undefined}],"awayjs-renderergl/lib/animators/states/VertexClipState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/states/AnimationClipState");var n=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._vertexClipNode=i;this._frames=this._vertexClipNode.frames}Object.defineProperty(t.prototype,"currentGeometry",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._currentGeometry},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"nextGeometry",{get:function(){if(this._pFramesDirty)this._pUpdateFrames();return this._nextGeometry},enumerable:true,configurable:true});t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this);this._currentGeometry=this._frames[this._pCurrentFrame];if(this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame){this._nextGeometry=this._frames[0];this._pAnimator.dispatchCycleEvent()}else this._nextGeometry=this._frames[this._pNextFrame]};t.prototype._pUpdatePositionDelta=function(){};return t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/states/AnimationClipState":undefined}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode");var n=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState");var s=function(e){r(t,e);function t(){e.call(this);this._pStateClass=n}return t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":undefined,"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":undefined}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState");var n=e("awayjs-renderergl/lib/events/AnimationStateEvent");var s=function(e){r(t,e);function t(t,i){e.call(this,t,i);this._crossfadeTransitionNode=i}t.prototype._pUpdateTime=function(t){this.blendWeight=Math.abs(t-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed);if(this.blendWeight>=1){this.blendWeight=1;if(this._animationStateTransitionComplete==null)this._animationStateTransitionComplete=new n(n.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode);this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)}e.prototype._pUpdateTime.call(this,t)};return t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":undefined,"awayjs-renderergl/lib/events/AnimationStateEvent":undefined}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransition":[function(e,t,i){var r=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode");var a=function(){function e(e){this.blendSpeed=.5;this.blendSpeed=e}e.prototype.getAnimationNode=function(e,t,i,a){var n=new r;n.inputA=t;n.inputB=i;n.blendSpeed=this.blendSpeed;n.startBlend=a;return n};return e}();t.exports=a},{"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":undefined}],"awayjs-renderergl/lib/animators/transitions/IAnimationTransition":[function(e,t,i){},{}],"awayjs-renderergl/lib/base/ParticleGeometry":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/Geometry");var n=function(e){r(t,e);function t(){e.apply(this,arguments)}return t}(a);t.exports=n},{"awayjs-display/lib/base/Geometry":undefined}],"awayjs-renderergl/lib/base/RendererBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3D");var n=e("awayjs-core/lib/geom/Point");var s=e("awayjs-core/lib/geom/Rectangle");var o=e("awayjs-core/lib/errors/AbstractMethodError");var l=e("awayjs-core/lib/events/EventDispatcher");var h=e("awayjs-display/lib/pool/RenderablePool");var p=e("awayjs-display/lib/sort/RenderableMergeSort");var u=e("awayjs-display/lib/events/RendererEvent");var d=e("awayjs-display/lib/events/StageEvent");var c=e("awayjs-display/lib/traverse/EntityCollector");var f=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");var _=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var g=e("awayjs-renderergl/lib/pool/BillboardRenderable");var m=e("awayjs-renderergl/lib/pool/LineSubMeshRenderable");var y=e("awayjs-renderergl/lib/pool/MaterialDataPool");var v=e("awayjs-renderergl/lib/pool/TriangleSubMeshRenderable");var b=e("awayjs-renderergl/lib/managers/DefaultMaterialManager");var x=function(e){r(t,e);function t(){var t=this;e.call(this);this._numUsedStreams=0;this._numUsedTextures=0;this._viewPort=new s;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this._depthPrepass=false;this._backgroundR=0;this._backgroundG=0;this._backgroundB=0;this._backgroundAlpha=1;this._shareContext=false;this.textureRatioX=1;this.textureRatioY=1;this._pRttViewProjectionMatrix=new a;this._localPos=new n;this._globalPos=new n;this._pScissorRect=new s;this._pNumTriangles=0;this._onViewportUpdatedDelegate=function(e){return t.onViewportUpdated(e)};this._materialDataPool=new y;this._billboardRenderablePool=h.getPool(g);this._triangleSubMeshRenderablePool=h.getPool(v);this._lineSubMeshRenderablePool=h.getPool(m);this._onContextUpdateDelegate=function(e){return t.onContextUpdate(e)};this.renderableSorter=new p}Object.defineProperty(t.prototype,"numTriangles",{get:function(){return this._pNumTriangles},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scissorRect",{get:function(){return this._pScissorRect},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._localPos.x},set:function(e){if(this.x==e)return;this._globalPos.x=this._localPos.x=e;this.updateGlobalPos()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._localPos.y},set:function(e){if(this.y==e)return;this._globalPos.y=this._localPos.y=e;this.updateGlobalPos()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){if(this._width==e)return;this._width=e;this._pScissorRect.width=e;if(this._pRttBufferManager)this._pRttBufferManager.viewWidth=e;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this.notifyScissorUpdate()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){if(this._height==e)return;this._height=e;this._pScissorRect.height=e;if(this._pRttBufferManager)this._pRttBufferManager.viewHeight=e;this._pBackBufferInvalid=true;this._pDepthTextureInvalid=true;this.notifyScissorUpdate()},enumerable:true,configurable:true});t.prototype.getProgram=function(e){if(!e.key.length){e.key=e.animationVertexCode+e.vertexCode+"---"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode}else{return e.programData}var t=this._pStage.getProgramData(e.key);if(e.programData!=t){if(e.programData)e.programData.dispose();e.programData=t;t.usages++}return t};t.prototype.getMaterial=function(e,t){var i=this._materialDataPool.getItem(e);if(i.invalidAnimation){i.invalidAnimation=false;var r=i.getMaterialPasses(t);var a=this.getEnabledGPUAnimation(e,r);var n=0;var s=1;var o;var l=r.length;for(var h=0;h<l;h++){o=r[h];if(o.usesAnimation!=a){o.usesAnimation=a;o.key==""}if(o.key=="")this.calcAnimationCode(e,o);n+=this.getProgram(o).id*s;s*=1e3}i.renderOrderId=n}return i};t.prototype.activateMaterialPass=function(e,t){var i=e.shaderObject;for(var r=i.numUsedStreams;r<this._numUsedStreams;r++)this._pContext.setVertexBufferAt(r,null);for(var r=i.numUsedTextures;r<this._numUsedTextures;r++)this._pContext.setTextureAt(r,null);if(e.usesAnimation)e.material.animationSet.activate(i,this._pStage);i.iActivate(this._pStage,t);var a=this.getProgram(e);if(!a.program){a.program=this._pContext.createProgram();var n=(new f).assemble("part vertex 1\n"+e.animationVertexCode+e.vertexCode+"endpart")["vertex"].data;var s=(new f).assemble("part fragment 1\n"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode+"endpart")["fragment"].data;a.program.upload(n,s)}this._pContext.setProgram(a.program)};t.prototype.deactivateMaterialPass=function(e){var t=e.shaderObject;if(e.usesAnimation)e.material.animationSet.deactivate(t,this._pStage);e.shaderObject.iDeactivate(this._pStage);this._numUsedStreams=t.numUsedStreams;this._numUsedTextures=t.numUsedTextures};t.prototype._iCreateEntityCollector=function(){return new c};Object.defineProperty(t.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(e){if(this._backgroundR==e)return;this._backgroundR=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(e){if(this._backgroundG==e)return;this._backgroundG=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(e){if(this._backgroundB==e)return;this._backgroundB=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"context",{get:function(){return this._pContext},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"stage",{get:function(){return this._pStage},set:function(e){if(e==this._pStage)return;this.iSetStage(e)},enumerable:true,configurable:true});t.prototype.iSetStage=function(e){if(this._pStage){this._pStage.removeEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate)}if(!e){this._pStage=null;this._pContext=null}else{this._pStage=e;this._pStage.addEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate);this._pStage.addEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate);this._pStage.addEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate);if(this._pStage.context)this._pContext=this._pStage.context}this._pBackBufferInvalid=true;this.updateGlobalPos()};Object.defineProperty(t.prototype,"shareContext",{get:function(){return this._shareContext},set:function(e){if(this._shareContext==e)return;this._shareContext=e;this.updateGlobalPos()},enumerable:true,configurable:true});t.prototype.dispose=function(){if(this._pRttBufferManager)this._pRttBufferManager.dispose();this._pRttBufferManager=null;this._pStage.removeEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate);this._pStage.removeEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate);this._pStage=null};t.prototype.render=function(e){this._viewportDirty=false;this._scissorDirty=false};t.prototype._iRender=function(e,t,i,r){if(t===void 0){t=null}if(i===void 0){i=null}if(r===void 0){r=0}if(!this._pStage||!this._pContext)return;this._pRttViewProjectionMatrix.copyFrom(e.camera.viewProjection);this._pRttViewProjectionMatrix.appendScale(this.textureRatioX,this.textureRatioY,1);this.pExecuteRender(e,t,i,r);for(var a=0;a<8;++a){this._pContext.setVertexBufferAt(a,null);this._pContext.setTextureAt(a,null)}};t.prototype._iRenderCascades=function(e,t,i,r,a){};t.prototype.pCollectRenderables=function(e){this._pBlendedRenderableHead=null;this._pOpaqueRenderableHead=null;this._pNumTriangles=0;var t=e.entityHead;this._pCamera=e.camera;this._iEntryPoint=this._pCamera.scenePosition;this._pCameraForward=this._pCamera.transform.forwardVector;while(t){t.entity._iCollectRenderables(this);t=t.next}this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead);this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)};t.prototype.pExecuteRender=function(e,t,i,r){if(t===void 0){t=null}if(i===void 0){i=null}if(r===void 0){r=0}this._pStage.setRenderTarget(t,true,r);if((t||!this._shareContext)&&!this._depthPrepass)this._pContext.clear(this._backgroundR,this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0);this._pContext.setDepthTest(false,_.ALWAYS);this._pStage.scissorRect=i;this.pDraw(e,t);if(!this._shareContext){if(this._snapshotRequired&&this._snapshotBitmapData){this._pContext.drawToBitmapData(this._snapshotBitmapData);this._snapshotRequired=false}}this._pStage.scissorRect=null};t.prototype.queueSnapshot=function(e){this._snapshotRequired=true;this._snapshotBitmapData=e};t.prototype.pDraw=function(e,t){throw new o};t.prototype.onContextUpdate=function(e){this._pContext=this._pStage.context};Object.defineProperty(t.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(e){if(this._backgroundAlpha==e)return;this._backgroundAlpha=e;this._pBackBufferInvalid=true},enumerable:true,configurable:true});t.prototype.notifyScissorUpdate=function(){if(this._scissorDirty)return;this._scissorDirty=true;if(!this._scissorUpdated)this._scissorUpdated=new u(u.SCISSOR_UPDATED);this.dispatchEvent(this._scissorUpdated)};t.prototype.notifyViewportUpdate=function(){if(this._viewportDirty)return;this._viewportDirty=true;if(!this._viewPortUpdated)this._viewPortUpdated=new u(u.VIEWPORT_UPDATED);this.dispatchEvent(this._viewPortUpdated)};t.prototype.onViewportUpdated=function(e){this._viewPort=this._pStage.viewPort;if(this._shareContext){this._pScissorRect.x=this._globalPos.x-this._pStage.x;this._pScissorRect.y=this._globalPos.y-this._pStage.y;this.notifyScissorUpdate()}this.notifyViewportUpdate()};t.prototype.updateGlobalPos=function(){if(this._shareContext){this._pScissorRect.x=this._globalPos.x-this._viewPort.x;this._pScissorRect.y=this._globalPos.y-this._viewPort.y}else{this._pScissorRect.x=0;this._pScissorRect.y=0;this._viewPort.x=this._globalPos.x;this._viewPort.y=this._globalPos.y}this.notifyScissorUpdate()};t.prototype.applyBillboard=function(e){this._applyRenderable(this._billboardRenderablePool.getItem(e))};t.prototype.applyTriangleSubMesh=function(e){this._applyRenderable(this._triangleSubMeshRenderablePool.getItem(e))};t.prototype.applyLineSubMesh=function(e){this._applyRenderable(this._lineSubMeshRenderablePool.getItem(e))};t.prototype._applyRenderable=function(e){var t=e.materialOwner.material;var i=e.sourceEntity;var r=i.scenePosition;if(!t)t=b.getDefaultMaterial(e.materialOwner);t._iUpdateMaterial();e.material=t;e.materialId=t._iMaterialId;e.renderOrderId=this.getMaterial(t,this._pStage.profile).renderOrderId;e.cascaded=false;r=this._iEntryPoint.subtract(r);e.zIndex=i.zOffset+r.dotProduct(this._pCameraForward);e.renderSceneTransform=e.sourceEntity.getRenderSceneTransform(this._pCamera);if(t.requiresBlending){e.next=this._pBlendedRenderableHead;this._pBlendedRenderableHead=e}else{e.next=this._pOpaqueRenderableHead;this._pOpaqueRenderableHead=e}this._pNumTriangles+=e.numTriangles;if(e.overflow)this._applyRenderable(e.overflow)};t.prototype.getEnabledGPUAnimation=function(e,t){if(e.animationSet){e.animationSet.resetGPUCompatibility();var i=e.iOwners;var r=i.length;var a=t.length;for(var n=0;n<a;n++)for(var s=0;s<r;s++)if(i[s].animator)i[s].animator.testGPUCompatibility(t[n].shaderObject);return!e.animationSet.usesCPU}return false};t.prototype.calcAnimationCode=function(e,t){t.key="";t.animationVertexCode="";t.animationFragmentCode="";var i=t.shaderObject;if(t.usesAnimation){var r=e.animationSet;t.animationVertexCode+=r.getAGALVertexCode(i);if(i.uvDependencies>0&&!i.usesUVTransform)t.animationVertexCode+=r.getAGALUVCode(i);if(i.usesFragmentAnimation)t.animationFragmentCode+=r.getAGALFragmentCode(i,t.shadedTarget);r.doneAGALCode(i)}else{var a=i.animatableAttributes.length;for(var n=0;n<a;++n)t.animationVertexCode+="mov "+i.animationTargetRegisters[n]+", "+i.animatableAttributes[n]+"\n";if(i.uvDependencies>0&&!i.usesUVTransform)t.animationVertexCode+="mov "+i.uvTarget+","+i.uvSource+"\n"}};return t}(l);t.exports=x},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/events/EventDispatcher":undefined,"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Point":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-display/lib/events/RendererEvent":undefined,"awayjs-display/lib/events/StageEvent":undefined,"awayjs-display/lib/pool/RenderablePool":undefined,"awayjs-display/lib/sort/RenderableMergeSort":undefined,"awayjs-display/lib/traverse/EntityCollector":undefined,"awayjs-renderergl/lib/managers/DefaultMaterialManager":undefined,"awayjs-renderergl/lib/pool/BillboardRenderable":undefined,"awayjs-renderergl/lib/pool/LineSubMeshRenderable":undefined,"awayjs-renderergl/lib/pool/MaterialDataPool":undefined,"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":undefined,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-renderergl/lib/compilation/RegisterPool":[function(e,t,i){var r=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var a=function(){function e(e,t,i){if(i===void 0){i=true}this._regName=e;this._regCount=t;this._persistent=i;this.initRegisters(e,t)}e.prototype.requestFreeVectorReg=function(){for(var e=0;e<this._regCount;++e){if(!this.isRegisterUsed(e)){if(this._persistent)this._usedVectorCount[e]++;return this._vectorRegisters[e]}}throw new Error("Register overflow!")};e.prototype.requestFreeRegComponent=function(){for(var e=0;e<this._regCount;++e){if(this._usedVectorCount[e]>0)continue;for(var t=0;t<4;++t){if(this._usedSingleCount[t][e]==0){if(this._persistent)this._usedSingleCount[t][e]++;return this._registerComponents[t][e]}}}throw new Error("Register overflow!")};e.prototype.addUsage=function(e,t){if(e._component>-1)this._usedSingleCount[e._component][e.index]+=t;else this._usedVectorCount[e.index]+=t};e.prototype.removeUsage=function(e){if(e._component>-1){if(--this._usedSingleCount[e._component][e.index]<0)throw new Error("More usages removed than exist!")}else{if(--this._usedVectorCount[e.index]<0)throw new Error("More usages removed than exist!")}};e.prototype.dispose=function(){this._vectorRegisters=null;this._registerComponents=null;this._usedSingleCount=null;this._usedVectorCount=null};e.prototype.hasRegisteredRegs=function(){for(var e=0;e<this._regCount;++e)if(this.isRegisterUsed(e))return true;return false};e.prototype.initRegisters=function(t,i){var r=e._initPool(t,i);this._vectorRegisters=e._regPool[r];this._registerComponents=e._regCompsPool[r];this._usedVectorCount=this._initArray(Array(i),0);this._usedSingleCount=new Array(4);this._usedSingleCount[0]=this._initArray(new Array(i),0);this._usedSingleCount[1]=this._initArray(new Array(i),0);this._usedSingleCount[2]=this._initArray(new Array(i),0);this._usedSingleCount[3]=this._initArray(new Array(i),0)};e._initPool=function(t,i){var a=t+i;if(e._regPool[a]!=undefined)return a;var n=new Array(i);e._regPool[a]=n;var s=[[],[],[],[]];e._regCompsPool[a]=s;for(var o=0;o<i;++o){n[o]=new r(t,o);for(var l=0;l<4;++l)s[l][o]=new r(t,o,l)}return a};e.prototype.isRegisterUsed=function(e){if(this._usedVectorCount[e]>0)return true;for(var t=0;t<4;++t)if(this._usedSingleCount[t][e]>0)return true;return false};e.prototype._initArray=function(e,t){var i=e.length;for(var r=0;r<i;r++)e[r]=t;return e};e._regPool=new Object;e._regCompsPool=new Object;return e}();t.exports=a},{"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/compilation/ShaderCompilerBase":[function(e,t,i){var r=e("awayjs-renderergl/lib/compilation/ShaderRegisterCache");var a=e("awayjs-renderergl/lib/compilation/ShaderRegisterData");var n=function(){function e(e,t,i){this._pVertexCode="";this._pFragmentCode="";this._pPostAnimationFragmentCode="";this._pMaterial=e;this._pMaterialPass=t;this._pShaderObject=i;this._pProfile=i.profile;this._pSharedRegisters=new a;this._pRegisterCache=new r(this._pProfile);this._pRegisterCache.vertexAttributesOffset=1;this._pRegisterCache.reset()}e.prototype.compile=function(){this._pShaderObject.reset();this.pCalculateDependencies();this.pInitRegisterIndices();this.pCompileDependencies();this._pVertexCode+=this._pMaterialPass._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);this._pPostAnimationFragmentCode+=this._pMaterialPass._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);this._pPostAnimationFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister+", "+this._pSharedRegisters.shadedTarget+"\n";this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget);this._pShaderObject.initConstantData(this._pRegisterCache,this._pAnimatableAttributes,this._pAnimationTargetRegisters,this._uvSource,this._uvTarget);this._pMaterialPass._iInitConstantData(this._pShaderObject)};e.prototype.pCompileDependencies=function(){this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1);if(this._pShaderObject.globalPosDependencies>0)this.compileGlobalPositionCode();if(this._pShaderObject.uvDependencies>0)this.compileUVCode();if(this._pShaderObject.secondaryUVDependencies>0)this.compileSecondaryUVCode();if(this._pShaderObject.normalDependencies>0)this.compileNormalCode();if(this._pShaderObject.viewDirDependencies>0)this.compileViewDirCode();this._pVertexCode+=this._pMaterial._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pMaterial._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);this._pVertexCode+=this._pMaterialPass._iGetPreLightingVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pMaterialPass._iGetPreLightingFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)};e.prototype.compileGlobalPositionCode=function(){this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp(),this._pShaderObject.globalPosDependencies);var e=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pShaderObject.sceneMatrixIndex=e.index*4;this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex+", "+this._pSharedRegisters.localPosition+", "+e+"\n";if(this._pShaderObject.usesGlobalPosFragment){this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying+", "+this._pSharedRegisters.globalPositionVertex+"\n"}};e.prototype.compileUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.uvBufferIndex=e.index;var t=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.uvVarying=t;if(this._pShaderObject.usesUVTransform){var i=this._pRegisterCache.getFreeVertexConstant();var r=this._pRegisterCache.getFreeVertexConstant();this._pShaderObject.uvTransformIndex=i.index*4;this._pVertexCode+="dp4 "+t+".x, "+e+", "+i+"\n"+"dp4 "+t+".y, "+e+", "+r+"\n"+"mov "+t+".zw, "+e+".zw \n"}else{this._pShaderObject.uvTransformIndex=-1;this._uvTarget=t.toString();this._uvSource=e.toString()}};e.prototype.compileSecondaryUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.secondaryUVBufferIndex=e.index;this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="mov "+this._pSharedRegisters.secondaryUVVarying+", "+e+"\n"};e.prototype.compileViewDirCode=function(){var e=this._pRegisterCache.getFreeVertexConstant();this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pShaderObject.viewDirDependencies);this._pShaderObject.cameraPositionIndex=e.index*4;if(this._pShaderObject.usesTangentSpace){var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+t+", "+e+", "+this._pSharedRegisters.localPosition+"\n"+"m33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+t+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.localPosition+".w\n"}else{this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+e+", "+this._pSharedRegisters.globalPositionVertex+"\n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex)}this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\n"+"mov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w\n"};e.prototype.compileNormalCode=function(){this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pShaderObject.normalDependencies);if(this._pShaderObject.outputsNormals&&!this._pShaderObject.outputsTangentNormals){this._pVertexCode+=this._pMaterialPass._iGetNormalVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);return}var e;if(!this._pShaderObject.outputsNormals||!this._pShaderObject.usesTangentSpace){e=new Array(3);e[0]=this._pRegisterCache.getFreeVertexConstant();e[1]=this._pRegisterCache.getFreeVertexConstant();e[2]=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant();this._pShaderObject.sceneNormalMatrixIndex=e[0].index*4;this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying()}if(this._pShaderObject.outputsNormals){if(this._pShaderObject.usesTangentSpace){this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\n"+"nrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\n"+"crs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n";this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)}else{this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying();this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="m33 "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\n"+"nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+t+"\n"+"m33 "+t+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\n"+"nrm "+this._pSharedRegisters.animatedTangent+".xyz, "+t+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".x  \n"+"mov "+this._pSharedRegisters.tangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".x  \n"+"mov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".y  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".y  \n"+"mov "+this._pSharedRegisters.bitangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"mov "+this._pSharedRegisters.normalVarying+".x, "+this._pSharedRegisters.animatedTangent+".z  \n"+"mov "+this._pSharedRegisters.normalVarying+".z, "+this._pSharedRegisters.animatedNormal+".z  \n"+"mov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.normalInput+".w  \n"+"crs "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".y, "+t+".x    \n"+"mov "+this._pSharedRegisters.bitangentVarying+".y, "+t+".y  \n"+"mov "+this._pSharedRegisters.normalVarying+".y, "+t+".z    \n";this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);var i;var r;var a;i=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(i,1);r=this._pRegisterCache.getFreeFragmentVectorTemp();
this._pRegisterCache.addFragmentTempUsages(r,1);a=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(a,1);this._pFragmentCode+="nrm "+i+".xyz, "+this._pSharedRegisters.tangentVarying+"\n"+"mov "+i+".w, "+this._pSharedRegisters.tangentVarying+".w	\n"+"nrm "+r+".xyz, "+this._pSharedRegisters.bitangentVarying+"\n"+"nrm "+a+".xyz, "+this._pSharedRegisters.normalVarying+"\n";this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)+"m33 "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalFragment+", "+i+"\n"+"mov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n";this._pRegisterCache.removeFragmentTempUsage(r);this._pRegisterCache.removeFragmentTempUsage(i);this._pRegisterCache.removeFragmentTempUsage(a)}}else{this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\n"+"mov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w\n";this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\n"+"mov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n";if(this._pShaderObject.tangentDependencies>0){this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+this._pSharedRegisters.tangentVarying+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\n"+"mov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.animatedTangent+".w\n"}}if(!this._pShaderObject.usesTangentSpace)this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal)};e.prototype.pInitRegisterIndices=function(){this._pShaderObject.pInitRegisterIndices();this._pAnimatableAttributes=new Array("va0");this._pAnimationTargetRegisters=new Array("vt0");this._pVertexCode="";this._pFragmentCode="";this._pPostAnimationFragmentCode="";this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition=this._pRegisterCache.getFreeVertexVectorTemp(),1);this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant();this._pShaderObject.commonsDataIndex=this._pSharedRegisters.commons.index*4;if(this._pShaderObject.tangentDependencies>0||this._pShaderObject.outputsNormals){this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.tangentBufferIndex=this._pSharedRegisters.tangentInput.index;this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1);if(this._pShaderObject.usesTangentSpace){this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1)}this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString());this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString())}if(this._pShaderObject.normalDependencies>0){this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.normalBufferIndex=this._pSharedRegisters.normalInput.index;this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp();this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1);this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString());this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString())}};e.prototype.pCalculateDependencies=function(){this._pShaderObject.useAlphaPremultiplied=this._pMaterial.alphaPremultiplied;this._pShaderObject.useBothSides=this._pMaterial.bothSides;this._pShaderObject.useMipmapping=this._pMaterial.mipmap;this._pShaderObject.useSmoothTextures=this._pMaterial.smooth;this._pShaderObject.repeatTextures=this._pMaterial.repeat;this._pShaderObject.usesUVTransform=this._pMaterial.animateUVs;this._pShaderObject.alphaThreshold=this._pMaterial.alphaThreshold;this._pShaderObject.texture=this._pMaterial.texture;this._pShaderObject.color=this._pMaterial.color;this._pMaterialPass._iIncludeDependencies(this._pShaderObject)};e.prototype.dispose=function(){this._pRegisterCache.dispose();this._pRegisterCache=null;this._pSharedRegisters=null};Object.defineProperty(e.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"postAnimationFragmentCode",{get:function(){return this._pPostAnimationFragmentCode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget.toString()},enumerable:true,configurable:true});return e}();t.exports=n},{"awayjs-renderergl/lib/compilation/ShaderRegisterCache":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterData":undefined}],"awayjs-renderergl/lib/compilation/ShaderLightingCompiler":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/materials/LightSources");var n=e("awayjs-stagegl/lib/base/ContextGLProfile");var s=e("awayjs-renderergl/lib/compilation/ShaderCompilerBase");var o=function(e){r(t,e);function t(t,i,r){e.call(this,t,i,r);this._materialLightingPass=i;this._shaderLightingObject=r}t.prototype.pCompileDependencies=function(){e.prototype.pCompileDependencies.call(this);if(this._shaderLightingObject.usesShadows)this.pCompileShadowCode();if(this._shaderLightingObject.usesLights){this.initLightRegisters();this.compileLightCode()}if(this._shaderLightingObject.usesProbes)this.compileLightProbeCode();this._pVertexCode+=this._materialLightingPass._iGetPostLightingVertexCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters);this._pFragmentCode+=this._materialLightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters)};t.prototype.pCompileShadowCode=function(){if(this._shaderLightingObject.normalDependencies>0){this._pSharedRegisters.shadowTarget=this._pSharedRegisters.normalFragment}else{this._pSharedRegisters.shadowTarget=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget,1)}};t.prototype.initLightRegisters=function(){var e,t;if(this._dirLightVertexConstants){t=this._dirLightVertexConstants.length;for(e=0;e<t;++e){this._dirLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant();if(this._shaderLightingObject.lightVertexConstantIndex==-1)this._shaderLightingObject.lightVertexConstantIndex=this._dirLightVertexConstants[e].index*4}}if(this._pointLightVertexConstants){t=this._pointLightVertexConstants.length;for(e=0;e<t;++e){this._pointLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant();if(this._shaderLightingObject.lightVertexConstantIndex==-1)this._shaderLightingObject.lightVertexConstantIndex=this._pointLightVertexConstants[e].index*4}}t=this._dirLightFragmentConstants.length;for(e=0;e<t;++e){this._dirLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant();if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=this._dirLightFragmentConstants[e].index*4}t=this._pointLightFragmentConstants.length;for(e=0;e<t;++e){this._pointLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant();if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=this._pointLightFragmentConstants[e].index*4}};t.prototype.compileLightCode=function(){var e;var t;var i;var r;var a=0;var n=0;var s=this._shaderLightingObject.usesLightsForSpecular;var o=this._shaderLightingObject.usesLightsForDiffuse;for(var l=0;l<this._materialLightingPass.iNumDirectionalLights;++l){if(this._shaderLightingObject.usesTangentSpace){r=this._dirLightVertexConstants[a++];var h=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+h+".xyz, "+r+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+h+".w, "+r+".w\n";r=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addVertexTempUsages(r,1);this._pFragmentCode+="nrm "+r+".xyz, "+h+"\n"+"mov "+r+".w, "+h+".w\n"}else{r=this._dirLightFragmentConstants[n++]}e=this._dirLightFragmentConstants[n++];t=this._dirLightFragmentConstants[n++];if(o)this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters);if(s)this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters);if(this._shaderLightingObject.usesTangentSpace)this._pRegisterCache.removeVertexTempUsage(r)}a=0;n=0;for(var l=0;l<this._materialLightingPass.iNumPointLights;++l){if(this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment)i=this._pointLightVertexConstants[a++];else i=this._pointLightFragmentConstants[n++];e=this._pointLightFragmentConstants[n++];t=this._pointLightFragmentConstants[n++];r=this._pRegisterCache.getFreeFragmentVectorTemp();this._pRegisterCache.addFragmentTempUsages(r,1);var h;if(this._shaderLightingObject.usesTangentSpace){h=this._pRegisterCache.getFreeVarying();var p=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+p+", "+i+", "+this._pSharedRegisters.localPosition+"\n"+"m33 "+h+".xyz, "+p+", "+this._pSharedRegisters.animatedTangent+"\n"+"mov "+h+".w, "+this._pSharedRegisters.localPosition+".w\n"}else if(!this._shaderLightingObject.usesGlobalPosFragment){h=this._pRegisterCache.getFreeVarying();this._pVertexCode+="sub "+h+", "+i+", "+this._pSharedRegisters.globalPositionVertex+"\n"}else{h=r;this._pFragmentCode+="sub "+r+", "+i+", "+this._pSharedRegisters.globalPositionVarying+"\n"}if(this._shaderLightingObject.usesLightFallOff){this._pFragmentCode+="dp3 "+r+".w, "+h+", "+h+"\n"+"sub "+r+".w, "+r+".w, "+e+".w\n"+"mul "+r+".w, "+r+".w, "+t+".w\n"+"sat "+r+".w, "+r+".w\n"+"sub "+r+".w, "+this._pSharedRegisters.commons+".w, "+r+".w\n"+"nrm "+r+".xyz, "+h+"\n"}else{this._pFragmentCode+="nrm "+r+".xyz, "+h+"\n"+"mov "+r+".w, "+h+".w\n"}if(this._shaderLightingObject.lightFragmentConstantIndex==-1)this._shaderLightingObject.lightFragmentConstantIndex=i.index*4;if(o)this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters);if(s)this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters);this._pRegisterCache.removeFragmentTempUsage(r)}};t.prototype.compileLightProbeCode=function(){var e;var t=[".x",".y",".z",".w"];var i=new Array;var r;var a;var n=this._shaderLightingObject.usesProbesForSpecular;var s=this._shaderLightingObject.usesProbesForDiffuse;if(s)this._shaderLightingObject.lightProbeDiffuseIndices=new Array;if(n)this._shaderLightingObject.lightProbeSpecularIndices=new Array;for(r=0;r<this._pNumProbeRegisters;++r){i[r]=this._pRegisterCache.getFreeFragmentConstant();if(r==0)this._shaderLightingObject.probeWeightsIndex=i[r].index*4}for(r=0;r<this._materialLightingPass.iNumLightProbes;++r){e=i[Math.floor(r/4)].toString()+t[r%4];if(s){a=this._pRegisterCache.getFreeTextureReg();this._shaderLightingObject.lightProbeDiffuseIndices[r]=a.index;this._pFragmentCode+=this._materialLightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject,a,e,this._pRegisterCache,this._pSharedRegisters)}if(n){a=this._pRegisterCache.getFreeTextureReg();this._shaderLightingObject.lightProbeSpecularIndices[r]=a.index;this._pFragmentCode+=this._materialLightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject,a,e,this._pRegisterCache,this._pSharedRegisters)}}};t.prototype.pInitRegisterIndices=function(){e.prototype.pInitRegisterIndices.call(this);this._shaderLightingObject.lightVertexConstantIndex=-1;this._shaderLightingObject.lightFragmentConstantIndex=-1;this._shaderLightingObject.probeWeightsIndex=-1;this._pNumProbeRegisters=Math.ceil(this._materialLightingPass.iNumLightProbes/4);if(this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment){this._pointLightVertexConstants=new Array(this._materialLightingPass.iNumPointLights);this._pointLightFragmentConstants=new Array(this._materialLightingPass.iNumPointLights*2)}else{this._pointLightFragmentConstants=new Array(this._materialLightingPass.iNumPointLights*3)}if(this._shaderLightingObject.usesTangentSpace){this._dirLightVertexConstants=new Array(this._materialLightingPass.iNumDirectionalLights);this._dirLightFragmentConstants=new Array(this._materialLightingPass.iNumDirectionalLights*2)}else{this._dirLightFragmentConstants=new Array(this._materialLightingPass.iNumDirectionalLights*3)}};t.prototype.pCalculateDependencies=function(){var t=this._materialLightingPass.iNumPointLights+this._materialLightingPass.iNumDirectionalLights;var i=this._materialLightingPass.iNumLightProbes;var r=this._pMaterial.diffuseLightSources;var s=this._materialLightingPass._iUsesSpecular()?this._pMaterial.specularLightSources:0;var o=r|s;this._shaderLightingObject.usesLightFallOff=this._pMaterial.enableLightFallOff&&this._shaderLightingObject.profile!=n.BASELINE_CONSTRAINED;this._shaderLightingObject.numLights=t+i;this._shaderLightingObject.numPointLights=this._materialLightingPass.iNumPointLights;this._shaderLightingObject.numDirectionalLights=this._materialLightingPass.iNumDirectionalLights;this._shaderLightingObject.numLightProbes=i;this._shaderLightingObject.pointLightsOffset=this._materialLightingPass.pointLightsOffset;this._shaderLightingObject.directionalLightsOffset=this._materialLightingPass.directionalLightsOffset;this._shaderLightingObject.lightProbesOffset=this._materialLightingPass.lightProbesOffset;this._shaderLightingObject.lightPicker=this._materialLightingPass.lightPicker;this._shaderLightingObject.usesLights=t>0&&(o&a.LIGHTS)!=0;this._shaderLightingObject.usesProbes=i>0&&(o&a.PROBES)!=0;this._shaderLightingObject.usesLightsForSpecular=t>0&&(s&a.LIGHTS)!=0;this._shaderLightingObject.usesProbesForSpecular=i>0&&(s&a.PROBES)!=0;this._shaderLightingObject.usesLightsForDiffuse=t>0&&(r&a.LIGHTS)!=0;this._shaderLightingObject.usesProbesForDiffuse=i>0&&(r&a.PROBES)!=0;this._shaderLightingObject.usesShadows=this._materialLightingPass._iUsesShadows();e.prototype.pCalculateDependencies.call(this)};return t}(s);t.exports=o},{"awayjs-display/lib/materials/LightSources":undefined,"awayjs-renderergl/lib/compilation/ShaderCompilerBase":undefined,"awayjs-stagegl/lib/base/ContextGLProfile":undefined}],"awayjs-renderergl/lib/compilation/ShaderLightingObject":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/compilation/ShaderLightingCompiler");var n=e("awayjs-renderergl/lib/compilation/ShaderObjectBase");var s=function(e){r(t,e);function t(t){e.call(this,t)}t.prototype.createCompiler=function(e,t){return new a(e,t,this)};t.prototype.reset=function(){e.prototype.reset.call(this);this.numLights=0;this.usesLightFallOff=true};t.prototype.setRenderState=function(t,i,r,a){e.prototype.setRenderState.call(this,t,i,r,a);if(this.usesLights)this.updateLights();if(this.usesProbes)this.updateProbes(i)};t.prototype.updateLights=function(){var e;var t;var i=0;var r=0;var a;var n;var s=0;var o=this.usesShadows?2:1;var l;var h;this.ambientR=this.ambientG=this.ambientB=0;l=this.lightVertexConstantIndex;r=this.lightFragmentConstantIndex;var p=0;var u=this.lightPicker.directionalLights;h=this.directionalLightsOffset;a=this.lightPicker.directionalLights.length;if(h>a){p=1;h-=a}for(;p<o;++p){if(p)u=this.lightPicker.castingDirectionalLights;a=u.length;if(a>this.numDirectionalLights)a=this.numDirectionalLights;for(i=0;i<a;++i){e=u[h+i];n=e.sceneDirection;this.ambientR+=e._iAmbientR;this.ambientG+=e._iAmbientG;this.ambientB+=e._iAmbientB;if(this.usesTangentSpace){var d=-n.x;var c=-n.y;var f=-n.z;this.vertexConstantData[l++]=this._pInverseSceneMatrix[0]*d+this._pInverseSceneMatrix[4]*c+this._pInverseSceneMatrix[8]*f;this.vertexConstantData[l++]=this._pInverseSceneMatrix[1]*d+this._pInverseSceneMatrix[5]*c+this._pInverseSceneMatrix[9]*f;this.vertexConstantData[l++]=this._pInverseSceneMatrix[2]*d+this._pInverseSceneMatrix[6]*c+this._pInverseSceneMatrix[10]*f;this.vertexConstantData[l++]=1}else{this.fragmentConstantData[r++]=-n.x;this.fragmentConstantData[r++]=-n.y;this.fragmentConstantData[r++]=-n.z;this.fragmentConstantData[r++]=1}this.fragmentConstantData[r++]=e._iDiffuseR;this.fragmentConstantData[r++]=e._iDiffuseG;this.fragmentConstantData[r++]=e._iDiffuseB;this.fragmentConstantData[r++]=1;this.fragmentConstantData[r++]=e._iSpecularR;this.fragmentConstantData[r++]=e._iSpecularG;this.fragmentConstantData[r++]=e._iSpecularB;this.fragmentConstantData[r++]=1;if(++s==this.numDirectionalLights){i=a;p=o}}}if(this.numDirectionalLights>s){i=r+(this.numDirectionalLights-s)*12;while(r<i)this.fragmentConstantData[r++]=0}s=0;var _=this.lightPicker.pointLights;h=this.pointLightsOffset;a=this.lightPicker.pointLights.length;if(h>a){p=1;h-=a}else{p=0}for(;p<o;++p){if(p)_=this.lightPicker.castingPointLights;a=_.length;for(i=0;i<a;++i){t=_[h+i];n=t.scenePosition;this.ambientR+=t._iAmbientR;this.ambientG+=t._iAmbientG;this.ambientB+=t._iAmbientB;if(this.usesTangentSpace){d=n.x;c=n.y;f=n.z;this.vertexConstantData[l++]=this._pInverseSceneMatrix[0]*d+this._pInverseSceneMatrix[4]*c+this._pInverseSceneMatrix[8]*f+this._pInverseSceneMatrix[12];this.vertexConstantData[l++]=this._pInverseSceneMatrix[1]*d+this._pInverseSceneMatrix[5]*c+this._pInverseSceneMatrix[9]*f+this._pInverseSceneMatrix[13];this.vertexConstantData[l++]=this._pInverseSceneMatrix[2]*d+this._pInverseSceneMatrix[6]*c+this._pInverseSceneMatrix[10]*f+this._pInverseSceneMatrix[14];this.vertexConstantData[l++]=1}else if(!this.usesGlobalPosFragment){this.vertexConstantData[l++]=n.x;this.vertexConstantData[l++]=n.y;this.vertexConstantData[l++]=n.z;this.vertexConstantData[l++]=1}else{this.fragmentConstantData[r++]=n.x;this.fragmentConstantData[r++]=n.y;this.fragmentConstantData[r++]=n.z;this.fragmentConstantData[r++]=1}this.fragmentConstantData[r++]=t._iDiffuseR;this.fragmentConstantData[r++]=t._iDiffuseG;this.fragmentConstantData[r++]=t._iDiffuseB;var g=t._pRadius;this.fragmentConstantData[r++]=g*g;this.fragmentConstantData[r++]=t._iSpecularR;this.fragmentConstantData[r++]=t._iSpecularG;this.fragmentConstantData[r++]=t._iSpecularB;this.fragmentConstantData[r++]=t._pFallOffFactor;if(++s==this.numPointLights){i=a;p=o}}}if(this.numPointLights>s){i=r+(s-this.numPointLights)*12;for(;r<i;++r)this.fragmentConstantData[r]=0}};t.prototype.updateProbes=function(e){var t;var i=this.lightPicker.lightProbes;var r=this.lightPicker.lightProbeWeights;var a=i.length-this.lightProbesOffset;var n=this.usesProbesForDiffuse;var s=this.usesProbesForSpecular;if(!(n||s))return;if(a>this.numLightProbes)a=this.numLightProbes;for(var o=0;o<a;++o){t=i[this.lightProbesOffset+o];if(n)e.activateCubeTexture(this.lightProbeDiffuseIndices[o],t.diffuseMap);if(s)e.activateCubeTexture(this.lightProbeSpecularIndices[o],t.specularMap)}for(o=0;o<a;++o)this.fragmentConstantData[this.probeWeightsIndex+o]=r[this.lightProbesOffset+o]};return t}(n);t.exports=s},{"awayjs-renderergl/lib/compilation/ShaderLightingCompiler":undefined,"awayjs-renderergl/lib/compilation/ShaderObjectBase":undefined}],"awayjs-renderergl/lib/compilation/ShaderObjectBase":[function(e,t,i){var r=e("awayjs-display/lib/base/TriangleSubGeometry");var a=e("awayjs-stagegl/lib/base/ContextGLTriangleFace");var n=e("awayjs-renderergl/lib/compilation/ShaderCompilerBase");var s=function(){function e(e){this._defaultCulling=a.BACK;this._pInverseSceneMatrix=new Array;this.ambientR=255;this.ambientG=255;this.ambientB=255;this.usesGlobalPosFragment=false;this.vertexConstantData=new Array;this.fragmentConstantData=new Array;this.profile=e}e.prototype.createCompiler=function(e,t){return new n(e,t,this)};e.prototype.reset=function(){this.projectionDependencies=0;this.normalDependencies=0;this.viewDirDependencies=0;this.uvDependencies=0;this.secondaryUVDependencies=0;this.globalPosDependencies=0;this.tangentDependencies=0;this.usesGlobalPosFragment=false;this.usesFragmentAnimation=false;this.usesTangentSpace=false;this.outputsNormals=false;this.outputsTangentNormals=false};e.prototype.pInitRegisterIndices=function(){this.commonsDataIndex=-1;this.cameraPositionIndex=-1;this.uvBufferIndex=-1;this.uvTransformIndex=-1;this.secondaryUVBufferIndex=-1;this.normalBufferIndex=-1;this.tangentBufferIndex=-1;this.sceneMatrixIndex=-1;this.sceneNormalMatrixIndex=-1};e.prototype.initConstantData=function(e,t,i,r,a){this.numUsedVertexConstants=e.numUsedVertexConstants;this.numUsedFragmentConstants=e.numUsedFragmentConstants;this.numUsedStreams=e.numUsedStreams;this.numUsedTextures=e.numUsedTextures;this.numUsedVaryings=e.numUsedVaryings;this.numUsedFragmentConstants=e.numUsedFragmentConstants;this.animatableAttributes=t;this.animationTargetRegisters=i;this.uvSource=r;this.uvTarget=a;this.vertexConstantData.length=this.numUsedVertexConstants*4;this.fragmentConstantData.length=this.numUsedFragmentConstants*4;this.fragmentConstantData[this.commonsDataIndex]=.5;this.fragmentConstantData[this.commonsDataIndex+1]=0;this.fragmentConstantData[this.commonsDataIndex+2]=1/255;this.fragmentConstantData[this.commonsDataIndex+3]=1;if(this.uvTransformIndex>=0){this.vertexConstantData[this.uvTransformIndex]=1;this.vertexConstantData[this.uvTransformIndex+1]=0;this.vertexConstantData[this.uvTransformIndex+2]=0;this.vertexConstantData[this.uvTransformIndex+3]=0;this.vertexConstantData[this.uvTransformIndex+4]=0;this.vertexConstantData[this.uvTransformIndex+5]=1;this.vertexConstantData[this.uvTransformIndex+6]=0;this.vertexConstantData[this.uvTransformIndex+7]=0}if(this.cameraPositionIndex>=0)this.vertexConstantData[this.cameraPositionIndex+3]=1};e.prototype.iActivate=function(e,t){e.context.setCulling(this.useBothSides?a.NONE:this._defaultCulling,t.projection.coordinateSystem);if(!this.usesTangentSpace&&this.cameraPositionIndex>=0){var i=t.scenePosition;this.vertexConstantData[this.cameraPositionIndex]=i.x;this.vertexConstantData[this.cameraPositionIndex+1]=i.y;this.vertexConstantData[this.cameraPositionIndex+2]=i.z}};e.prototype.iDeactivate=function(e){};e.prototype.setRenderState=function(e,t,i,a){var n=t.context;if(e.materialOwner.animator)e.materialOwner.animator.setRenderState(this,e,t,i,this.numUsedVertexConstants,this.numUsedStreams);if(this.uvBufferIndex>=0)t.activateBuffer(this.uvBufferIndex,e.getVertexData(r.UV_DATA),e.getVertexOffset(r.UV_DATA),r.UV_FORMAT);if(this.secondaryUVBufferIndex>=0)t.activateBuffer(this.secondaryUVBufferIndex,e.getVertexData(r.SECONDARY_UV_DATA),e.getVertexOffset(r.SECONDARY_UV_DATA),r.SECONDARY_UV_FORMAT);if(this.normalBufferIndex>=0)t.activateBuffer(this.normalBufferIndex,e.getVertexData(r.NORMAL_DATA),e.getVertexOffset(r.NORMAL_DATA),r.NORMAL_FORMAT);if(this.tangentBufferIndex>=0)t.activateBuffer(this.tangentBufferIndex,e.getVertexData(r.TANGENT_DATA),e.getVertexOffset(r.TANGENT_DATA),r.TANGENT_FORMAT);if(this.usesUVTransform){var s=e.materialOwner.uvTransform.matrix;if(s){this.vertexConstantData[this.uvTransformIndex]=s.a;this.vertexConstantData[this.uvTransformIndex+1]=s.b;this.vertexConstantData[this.uvTransformIndex+3]=s.tx;this.vertexConstantData[this.uvTransformIndex+4]=s.c;this.vertexConstantData[this.uvTransformIndex+5]=s.d;this.vertexConstantData[this.uvTransformIndex+7]=s.ty}else{this.vertexConstantData[this.uvTransformIndex]=1;this.vertexConstantData[this.uvTransformIndex+1]=0;this.vertexConstantData[this.uvTransformIndex+3]=0;this.vertexConstantData[this.uvTransformIndex+4]=0;this.vertexConstantData[this.uvTransformIndex+5]=1;this.vertexConstantData[this.uvTransformIndex+7]=0}}if(this.sceneNormalMatrixIndex>=0)e.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData,this.sceneNormalMatrixIndex,false);if(this.usesTangentSpace&&this.cameraPositionIndex>=0){e.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);var o=i.scenePosition;var l=o.x;var h=o.y;var p=o.z;this.vertexConstantData[this.cameraPositionIndex]=this._pInverseSceneMatrix[0]*l+this._pInverseSceneMatrix[4]*h+this._pInverseSceneMatrix[8]*p+this._pInverseSceneMatrix[12];this.vertexConstantData[this.cameraPositionIndex+1]=this._pInverseSceneMatrix[1]*l+this._pInverseSceneMatrix[5]*h+this._pInverseSceneMatrix[9]*p+this._pInverseSceneMatrix[13];this.vertexConstantData[this.cameraPositionIndex+2]=this._pInverseSceneMatrix[2]*l+this._pInverseSceneMatrix[6]*h+this._pInverseSceneMatrix[10]*p+this._pInverseSceneMatrix[14]}};e.prototype.dispose=function(){};return e}();t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/compilation/ShaderCompilerBase":undefined,"awayjs-stagegl/lib/base/ContextGLTriangleFace":undefined}],"awayjs-renderergl/lib/compilation/ShaderRegisterCache":[function(e,t,i){var r=e("awayjs-renderergl/lib/compilation/RegisterPool");var a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement");var n=function(){function e(e){this._numUsedVertexConstants=0;this._numUsedFragmentConstants=0;this._numUsedStreams=0;this._numUsedTextures=0;this._numUsedVaryings=0;this._profile=e}e.prototype.reset=function(){this._fragmentTempCache=new r("ft",8,false);this._vertexTempCache=new r("vt",8,false);this._varyingCache=new r("v",8);this._textureCache=new r("fs",8);this._vertexAttributesCache=new r("va",8);this._fragmentConstantsCache=new r("fc",28);this._vertexConstantsCache=new r("vc",128);this._fragmentOutputRegister=new a("oc",-1);this._vertexOutputRegister=new a("op",-1);this._numUsedVertexConstants=0;this._numUsedStreams=0;this._numUsedTextures=0;this._numUsedVaryings=0;this._numUsedFragmentConstants=0;var e;for(e=0;e<this._vertexAttributesOffset;++e)this.getFreeVertexAttribute();for(e=0;e<this._vertexConstantOffset;++e)this.getFreeVertexConstant();for(e=0;e<this._varyingsOffset;++e)this.getFreeVarying();for(e=0;e<this._fragmentConstantOffset;++e)this.getFreeFragmentConstant()};e.prototype.dispose=function(){this._fragmentTempCache.dispose();this._vertexTempCache.dispose();this._varyingCache.dispose();this._fragmentConstantsCache.dispose();this._vertexAttributesCache.dispose();this._fragmentTempCache=null;this._vertexTempCache=null;this._varyingCache=null;this._fragmentConstantsCache=null;this._vertexAttributesCache=null;this._fragmentOutputRegister=null;this._vertexOutputRegister=null};e.prototype.addFragmentTempUsages=function(e,t){this._fragmentTempCache.addUsage(e,t)};e.prototype.removeFragmentTempUsage=function(e){this._fragmentTempCache.removeUsage(e)};e.prototype.addVertexTempUsages=function(e,t){this._vertexTempCache.addUsage(e,t)};e.prototype.removeVertexTempUsage=function(e){this._vertexTempCache.removeUsage(e)};e.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()};e.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()};e.prototype.getFreeVarying=function(){++this._numUsedVaryings;return this._varyingCache.requestFreeVectorReg()};e.prototype.getFreeFragmentConstant=function(){++this._numUsedFragmentConstants;return this._fragmentConstantsCache.requestFreeVectorReg()};e.prototype.getFreeVertexConstant=function(){++this._numUsedVertexConstants;return this._vertexConstantsCache.requestFreeVectorReg()};e.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()};e.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()};e.prototype.getFreeVertexAttribute=function(){++this._numUsedStreams;return this._vertexAttributesCache.requestFreeVectorReg()};e.prototype.getFreeTextureReg=function(){++this._numUsedTextures;return this._textureCache.requestFreeVectorReg()};Object.defineProperty(e.prototype,"vertexConstantOffset",{get:function(){return this._vertexConstantOffset},set:function(e){this._vertexConstantOffset=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"vertexAttributesOffset",{get:function(){return this._vertexAttributesOffset},set:function(e){this._vertexAttributesOffset=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"varyingsOffset",{get:function(){return this._varyingsOffset},set:function(e){this._varyingsOffset=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fragmentConstantOffset",{get:function(){return this._fragmentConstantOffset},set:function(e){this._fragmentConstantOffset=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:true,configurable:true});return e}();t.exports=n},{"awayjs-renderergl/lib/compilation/RegisterPool":undefined,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":undefined}],"awayjs-renderergl/lib/compilation/ShaderRegisterData":[function(e,t,i){var r=function(){function e(){}return e}();t.exports=r},{}],"awayjs-renderergl/lib/compilation/ShaderRegisterElement":[function(e,t,i){var r=function(){function e(t,i,r){if(r===void 0){r=-1}this._component=r;this._regName=t;this._index=i;this._toStr=this._regName;if(this._index>=0)this._toStr+=this._index;if(r>-1)this._toStr+="."+e.COMPONENTS[r]}e.prototype.toString=function(){return this._toStr};Object.defineProperty(e.prototype,"regName",{get:function(){return this._regName},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:true,configurable:true});e.COMPONENTS=["x","y","z","w"];return e}();t.exports=r},{}],"awayjs-renderergl/lib/errors/AnimationSetError":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/errors/Error");var n=function(e){r(t,e);function t(t){e.call(this,t)}return t}(a);t.exports=n},{"awayjs-core/lib/errors/Error":undefined}],"awayjs-renderergl/lib/events/AnimationStateEvent":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/events/Event");var n=function(e){r(t,e);function t(t,i,r,a){e.call(this,t);this._animator=i;this._animationState=r;this._animationNode=a}Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationState",{get:function(){return this._animationState
},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.type,this._animator,this._animationState,this._animationNode)};t.PLAYBACK_COMPLETE="playbackComplete";t.TRANSITION_COMPLETE="transitionComplete";return t}(a);t.exports=n},{"awayjs-core/lib/events/Event":undefined}],"awayjs-renderergl/lib/events/AnimatorEvent":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/events/Event");var n=function(e){r(t,e);function t(t,i){e.call(this,t);this._animator=i}Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:true,configurable:true});t.prototype.clone=function(){return new t(this.type,this._animator)};t.START="start";t.STOP="stop";t.CYCLE_COMPLETE="cycle_complete";return t}(a);t.exports=n},{"awayjs-core/lib/events/Event":undefined}],"awayjs-renderergl/lib/events/ShadingMethodEvent":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/events/Event");var n=function(e){r(t,e);function t(t){e.call(this,t)}t.SHADER_INVALIDATED="ShaderInvalidated";return t}(a);t.exports=n},{"awayjs-core/lib/events/Event":undefined}],"awayjs-renderergl/lib/filters/Filter3DBase":[function(e,t,i){var r=function(){function e(){this._tasks=new Array}Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});e.prototype.pAddTask=function(e){this._tasks.push(e);if(this._requireDepthRender==null)this._requireDepthRender=e.requireDepthRender};Object.defineProperty(e.prototype,"tasks",{get:function(){return this._tasks},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(e){return this._tasks[0].getMainInputTexture(e)};Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureWidth=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){this._textureHeight=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureHeight=e},enumerable:true,configurable:true});e.prototype.setRenderTargets=function(e,t){this._tasks[this._tasks.length-1].target=e};e.prototype.dispose=function(){for(var e=0;e<this._tasks.length;++e)this._tasks[e].dispose()};e.prototype.update=function(e,t){};return e}();t.exports=r},{}],"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase":[function(e,t,i){var r=e("awayjs-core/lib/errors/AbstractMethodError");var a=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");var n=e("awayjs-stagegl/lib/base/ContextGLTextureFormat");var s=function(){function e(e){if(e===void 0){e=false}this._scaledTextureWidth=-1;this._scaledTextureHeight=-1;this._textureWidth=-1;this._textureHeight=-1;this._textureDimensionsInvalid=true;this._program3DInvalid=true;this._textureScale=0;this._requireDepthRender=e}Object.defineProperty(e.prototype,"textureScale",{get:function(){return this._textureScale},set:function(e){if(this._textureScale==e)return;this._textureScale=e;this._scaledTextureWidth=this._textureWidth>>this._textureScale;this._scaledTextureHeight=this._textureHeight>>this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){if(this._textureWidth==e)return;this._textureWidth=e;this._scaledTextureWidth=this._textureWidth>>this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){if(this._textureHeight==e)return;this._textureHeight=e;this._scaledTextureHeight=this._textureHeight>>this._textureScale;this._textureDimensionsInvalid=true},enumerable:true,configurable:true});e.prototype.getMainInputTexture=function(e){if(this._textureDimensionsInvalid)this.pUpdateTextures(e);return this._mainInputTexture};e.prototype.dispose=function(){if(this._mainInputTexture)this._mainInputTexture.dispose();if(this._program3D)this._program3D.dispose()};e.prototype.pInvalidateProgram=function(){this._program3DInvalid=true};e.prototype.pUpdateProgram=function(e){if(this._program3D)this._program3D.dispose();this._program3D=e.context.createProgram();var t=(new a).assemble("part vertex 1\n"+this.pGetVertexCode()+"endpart")["vertex"].data;var i=(new a).assemble("part fragment 1\n"+this.pGetFragmentCode()+"endpart")["fragment"].data;this._program3D.upload(t,i);this._program3DInvalid=false};e.prototype.pGetVertexCode=function(){return"mov op, va0\n"+"mov v0, va1\n"};e.prototype.pGetFragmentCode=function(){throw new r;return null};e.prototype.pUpdateTextures=function(e){if(this._mainInputTexture)this._mainInputTexture.dispose();this._mainInputTexture=e.context.createTexture(this._scaledTextureWidth,this._scaledTextureHeight,n.BGRA,true);this._textureDimensionsInvalid=false};e.prototype.getProgram=function(e){if(this._program3DInvalid)this.pUpdateProgram(e);return this._program3D};e.prototype.activate=function(e,t,i){};e.prototype.deactivate=function(e){};Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:true,configurable:true});return e}();t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":undefined,"awayjs-stagegl/lib/base/ContextGLTextureFormat":undefined}],"awayjs-renderergl/lib/managers/DefaultMaterialManager":[function(e,t,i){var r=e("awayjs-core/lib/base/BitmapData");var a=e("awayjs-core/lib/library/AssetType");var n=e("awayjs-core/lib/textures/BitmapTexture");var s=e("awayjs-renderergl/lib/materials/LineBasicMaterial");var o=e("awayjs-renderergl/lib/materials/TriangleBasicMaterial");var l=function(){function e(){}e.getDefaultMaterial=function(t){if(t===void 0){t=null}if(t!=null&&t.assetType==a.LINE_SUB_MESH){if(!e._defaultLineMaterial)e.createDefaultLineMaterial();return e._defaultLineMaterial}else{if(!e._defaultTriangleMaterial)e.createDefaultTriangleMaterial();return e._defaultTriangleMaterial}};e.getDefaultTexture=function(t){if(t===void 0){t=null}if(!e._defaultTexture)e.createDefaultTexture();return e._defaultTexture};e.createDefaultTexture=function(){e._defaultBitmapData=e.createCheckeredBitmapData();e._defaultTexture=new n(e._defaultBitmapData,true);e._defaultTexture.name="defaultTexture"};e.createCheckeredBitmapData=function(){var e=new r(8,8,false,0);var t,i;for(t=0;t<8;t++){for(i=0;i<8;i++){if(i&1^t&1){e.setPixel(t,i,16777215)}}}return e};e.createDefaultTriangleMaterial=function(){if(!e._defaultTexture)e.createDefaultTexture();e._defaultTriangleMaterial=new o(e._defaultTexture);e._defaultTriangleMaterial.mipmap=false;e._defaultTriangleMaterial.smooth=false;e._defaultTriangleMaterial.name="defaultTriangleMaterial"};e.createDefaultLineMaterial=function(){e._defaultLineMaterial=new s;e._defaultLineMaterial.name="defaultSegmentMaterial"};return e}();t.exports=l},{"awayjs-core/lib/base/BitmapData":undefined,"awayjs-core/lib/library/AssetType":undefined,"awayjs-core/lib/textures/BitmapTexture":undefined,"awayjs-renderergl/lib/materials/LineBasicMaterial":undefined,"awayjs-renderergl/lib/materials/TriangleBasicMaterial":undefined}],"awayjs-renderergl/lib/managers/RTTBufferManager":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Rectangle");var n=e("awayjs-core/lib/events/Event");var s=e("awayjs-core/lib/events/EventDispatcher");var o=e("awayjs-core/lib/utils/TextureUtils");var l=function(e){r(t,e);function t(t){e.call(this);this._viewWidth=-1;this._viewHeight=-1;this._textureWidth=-1;this._textureHeight=-1;this._buffersInvalid=true;this._renderToTextureRect=new a;this._stage=t}t.getInstance=function(e){if(!e)throw new Error("stage key cannot be null!");if(t._instances==null)t._instances=new Array;var i=t.getRTTBufferManagerFromStage(e);if(i==null){i=new t(e);var r=new h;r.stage3d=e;r.rttbfm=i;t._instances.push(r)}return i};t.getRTTBufferManagerFromStage=function(e){var i=t._instances.length;var r;for(var a=0;a<i;a++){r=t._instances[a];if(r.stage3d===e)return r.rttbfm}return null};t.deleteRTTBufferManager=function(e){var i=t._instances.length;var r;for(var a=0;a<i;a++){r=t._instances[a];if(r.stage3d===e){t._instances.splice(a,1);return}}};Object.defineProperty(t.prototype,"textureRatioX",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._textureRatioX},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureRatioY",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._textureRatioY},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(e){if(e==this._viewWidth)return;this._viewWidth=e;this._buffersInvalid=true;this._textureWidth=o.getBestPowerOf2(this._viewWidth);if(this._textureWidth>this._viewWidth){this._renderToTextureRect.x=Math.floor((this._textureWidth-this._viewWidth)*.5);this._renderToTextureRect.width=this._viewWidth}else{this._renderToTextureRect.x=0;this._renderToTextureRect.width=this._textureWidth}this.dispatchEvent(new n(n.RESIZE))},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(e){if(e==this._viewHeight)return;this._viewHeight=e;this._buffersInvalid=true;this._textureHeight=o.getBestPowerOf2(this._viewHeight);if(this._textureHeight>this._viewHeight){this._renderToTextureRect.y=Math.floor((this._textureHeight-this._viewHeight)*.5);this._renderToTextureRect.height=this._viewHeight}else{this._renderToTextureRect.y=0;this._renderToTextureRect.height=this._textureHeight}this.dispatchEvent(new n(n.RESIZE))},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderToTextureVertexBuffer",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToTextureVertexBuffer},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderToScreenVertexBuffer",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToScreenVertexBuffer},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderToTextureRect",{get:function(){if(this._buffersInvalid)this.updateRTTBuffers();return this._renderToTextureRect},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:true,configurable:true});t.prototype.dispose=function(){t.deleteRTTBufferManager(this._stage);if(this._indexBuffer){this._indexBuffer.dispose();this._renderToScreenVertexBuffer.dispose();this._renderToTextureVertexBuffer.dispose();this._renderToScreenVertexBuffer=null;this._renderToTextureVertexBuffer=null;this._indexBuffer=null}};t.prototype.updateRTTBuffers=function(){var e=this._stage.context;var t;var i;var r;var a;if(this._renderToTextureVertexBuffer==null)this._renderToTextureVertexBuffer=e.createVertexBuffer(4,5);if(this._renderToScreenVertexBuffer==null)this._renderToScreenVertexBuffer=e.createVertexBuffer(4,5);if(!this._indexBuffer){this._indexBuffer=e.createIndexBuffer(6);this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6)}this._textureRatioX=r=Math.min(this._viewWidth/this._textureWidth,1);this._textureRatioY=a=Math.min(this._viewHeight/this._textureHeight,1);var n=(1-r)*.5;var s=(r+1)*.5;var o=(a+1)*.5;var l=(1-a)*.5;t=[-r,-a,n,o,0,r,-a,s,o,1,r,a,s,l,2,-r,a,n,l,3];i=[-1,-1,n,o,0,1,-1,s,o,1,1,1,s,l,2,-1,1,n,l,3];this._renderToTextureVertexBuffer.uploadFromArray(t,0,4);this._renderToScreenVertexBuffer.uploadFromArray(i,0,4);this._buffersInvalid=false};return t}(s);var h=function(){function e(){}return e}();t.exports=l},{"awayjs-core/lib/events/Event":undefined,"awayjs-core/lib/events/EventDispatcher":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-core/lib/utils/TextureUtils":undefined}],"awayjs-renderergl/lib/materials/LineBasicMaterial":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3D");var n=e("awayjs-display/lib/base/LineSubGeometry");var s=e("awayjs-stagegl/lib/base/ContextGLProgramType");var o=e("awayjs-renderergl/lib/materials/MaterialGLBase");var l=e("awayjs-renderergl/lib/passes/LineBasicPass");var h=function(e){r(t,e);function t(t){if(t===void 0){t=1.25}e.call(this);this._constants=new Array(0,0,0,0);this._thickness=t;this.bothSides=true;this._pAddScreenPass(this._screenPass=new l);this._calcMatrix=new a;this._constants[1]=1/255}t.prototype._iGetVertexCode=function(e,t,i){return"m44 vt0, va0, vc8			\n"+"m44 vt1, va1, vc8			\n"+"sub vt2, vt1, vt0 			\n"+"slt vt5.x, vt0.z, vc7.z			\n"+"sub vt5.y, vc5.x, vt5.x			\n"+"add vt4.x, vt0.z, vc7.z			\n"+"sub vt4.y, vt0.z, vt1.z			\n"+"seq vt4.z, vt4.y vc6.x			\n"+"add vt4.y, vt4.y, vt4.z			\n"+"div vt4.z, vt4.x, vt4.y			\n"+"mul vt4.xyz, vt4.zzz, vt2.xyz	\n"+"add vt3.xyz, vt0.xyz, vt4.xyz	\n"+"mov vt3.w, vc5.x			\n"+"mul vt0, vt0, vt5.yyyy			\n"+"mul vt3, vt3, vt5.xxxx			\n"+"add vt0, vt0, vt3				\n"+"sub vt2, vt1, vt0 			\n"+"nrm vt2.xyz, vt2.xyz			\n"+"nrm vt5.xyz, vt0.xyz			\n"+"mov vt5.w, vc5.x				\n"+"crs vt3.xyz, vt2, vt5			\n"+"nrm vt3.xyz, vt3.xyz			\n"+"mul vt3.xyz, vt3.xyz, va2.xxx	\n"+"mov vt3.w, vc5.x			\n"+"dp3 vt4.x, vt0, vc6			\n"+"mul vt4.x, vt4.x, vc7.x			\n"+"mul vt3.xyz, vt3.xyz, vt4.xxx	\n"+"add vt0.xyz, vt0.xyz, vt3.xyz	\n"+"m44 op, vt0, vc0			\n"+"mov v0, va3				\n"};t.prototype._iActivatePass=function(i,r,a){e.prototype._iActivatePass.call(this,i,r,a);var n=r.context;var o=r.stage;this._constants[0]=this._thickness/(o.scissorRect?Math.min(o.scissorRect.width,o.scissorRect.height):Math.min(o.width,o.height));this._constants[2]=a.projection.near;n.setProgramConstantsFromArray(s.VERTEX,5,t.pONE_VECTOR,1);n.setProgramConstantsFromArray(s.VERTEX,6,t.pFRONT_VECTOR,1);n.setProgramConstantsFromArray(s.VERTEX,7,this._constants,1);n.setProgramConstantsFromMatrix(s.VERTEX,0,a.projection.matrix,true)};t.prototype._iRenderPass=function(t,i,r,a,o){e.prototype._iRenderPass.call(this,t,i,r,a,o);var l=r.context;this._calcMatrix.copyFrom(i.sourceEntity.sceneTransform);this._calcMatrix.append(a.inverseSceneTransform);l.setProgramConstantsFromMatrix(s.VERTEX,8,this._calcMatrix,true);r.activateBuffer(0,i.getVertexData(n.START_POSITION_DATA),i.getVertexOffset(n.START_POSITION_DATA),n.POSITION_FORMAT);r.activateBuffer(1,i.getVertexData(n.END_POSITION_DATA),i.getVertexOffset(n.END_POSITION_DATA),n.POSITION_FORMAT);r.activateBuffer(2,i.getVertexData(n.THICKNESS_DATA),i.getVertexOffset(n.THICKNESS_DATA),n.THICKNESS_FORMAT);r.activateBuffer(3,i.getVertexData(n.COLOR_DATA),i.getVertexOffset(n.COLOR_DATA),n.COLOR_FORMAT);l.drawTriangles(r.getIndexBuffer(i.getIndexData()),0,i.numTriangles)};t.pONE_VECTOR=Array(1,1,1,1);t.pFRONT_VECTOR=Array(0,0,-1,0);return t}(o);t.exports=h},{"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-display/lib/base/LineSubGeometry":undefined,"awayjs-renderergl/lib/materials/MaterialGLBase":undefined,"awayjs-renderergl/lib/passes/LineBasicPass":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/materials/MaterialGLBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/materials/MaterialBase");var n=function(e){r(t,e);function t(){e.apply(this,arguments)}t.prototype._iGetVertexCode=function(e,t,i){return""};t.prototype._iGetFragmentCode=function(e,t,i){return""};return t}(a);t.exports=n},{"awayjs-display/lib/materials/MaterialBase":undefined}],"awayjs-renderergl/lib/materials/SkyboxMaterial":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/TriangleSubGeometry");var n=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var s=e("awayjs-stagegl/lib/base/ContextGLMipFilter");var o=e("awayjs-stagegl/lib/base/ContextGLProgramType");var l=e("awayjs-stagegl/lib/base/ContextGLTextureFilter");var h=e("awayjs-stagegl/lib/base/ContextGLWrapMode");var p=e("awayjs-renderergl/lib/materials/MaterialGLBase");var u=e("awayjs-renderergl/lib/passes/SkyboxPass");var d=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var c=function(e){r(t,e);function t(t,i,r,a){if(i===void 0){i=true}if(r===void 0){r=false}if(a===void 0){a=false}e.call(this);this._cubeMap=t;this._pAddScreenPass(this._skyboxPass=new u);this._vertexData=new Array(0,0,0,0,1,1,1,1)}Object.defineProperty(t.prototype,"cubeMap",{get:function(){return this._cubeMap},set:function(e){if(e&&this._cubeMap&&(e.hasMipmaps!=this._cubeMap.hasMipmaps||e.format!=this._cubeMap.format))this._pInvalidatePasses();this._cubeMap=e},enumerable:true,configurable:true});t.prototype._iGetVertexCode=function(e,t,i){return"mul vt0, va0, vc5\n"+"add vt0, vt0, vc4\n"+"m44 op, vt0, vc0\n"+"mov v0, va0\n"};t.prototype._iGetFragmentCode=function(e,t,i){var r=",mipnone";if(this._cubeMap.hasMipmaps)r=",miplinear";return"tex ft0, v0, fs0 <cube,"+d.getFormatStringForTexture(this._cubeMap)+"linear,clamp"+r+">\n"};t.prototype._iActivatePass=function(t,i,r){e.prototype._iActivatePass.call(this,t,i,r);var a=i.context;a.setSamplerStateAt(0,h.CLAMP,l.LINEAR,this._cubeMap.hasMipmaps?s.MIPLINEAR:s.MIPNONE);a.setDepthTest(false,n.LESS);i.stage.activateCubeTexture(0,this._cubeMap)};t.prototype._iRenderPass=function(t,i,r,n,s){e.prototype._iRenderPass.call(this,t,i,r,n,s);var l=r.context;var h=n.scenePosition;this._vertexData[0]=h.x;this._vertexData[1]=h.y;this._vertexData[2]=h.z;this._vertexData[4]=this._vertexData[5]=this._vertexData[6]=n.projection.far/Math.sqrt(3);l.setProgramConstantsFromMatrix(o.VERTEX,0,s,true);l.setProgramConstantsFromArray(o.VERTEX,4,this._vertexData,2);r.activateBuffer(0,i.getVertexData(a.POSITION_DATA),i.getVertexOffset(a.POSITION_DATA),a.POSITION_FORMAT);l.drawTriangles(r.getIndexBuffer(i.getIndexData()),0,i.numTriangles)};return t}(p);t.exports=c},{"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/materials/MaterialGLBase":undefined,"awayjs-renderergl/lib/passes/SkyboxPass":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined,"awayjs-stagegl/lib/base/ContextGLMipFilter":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined,"awayjs-stagegl/lib/base/ContextGLTextureFilter":undefined,"awayjs-stagegl/lib/base/ContextGLWrapMode":undefined}],"awayjs-renderergl/lib/materials/TriangleBasicMaterial":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/textures/Texture2DBase");var n=e("awayjs-display/lib/base/BlendMode");var s=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var o=e("awayjs-renderergl/lib/materials/TriangleMaterialBase");var l=e("awayjs-renderergl/lib/passes/TriangleBasicPass");var h=function(e){r(t,e);function t(t,i,r,n){if(t===void 0){t=null}if(i===void 0){i=null}if(r===void 0){r=false}if(n===void 0){n=false}e.call(this);this._alphaBlending=false;this._alpha=1;this._depthCompareMode=s.LESS_EQUAL;this._screenPass=new l;if(t instanceof a){this.texture=t;this.smooth=i==null?true:false;this.repeat=r;this.mipmap=n}else{this.color=t?Number(t):13421772;this.alpha=i==null?1:Number(i)}}Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){if(this._depthCompareMode==e)return;this._depthCompareMode=e;this._pInvalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){if(e>1)e=1;else if(e<0)e=0;if(this._alpha==e)return;this._alpha=e;this._pInvalidatePasses()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(e){if(this._alphaBlending==e)return;this._alphaBlending=e;this._pInvalidatePasses()},enumerable:true,configurable:true});t.prototype._iUpdateMaterial=function(){if(this._pScreenPassesInvalid){this._pScreenPassesInvalid=false;this.setBlendAndCompareModes();this._pClearScreenPasses();this._pAddScreenPass(this._screenPass)}};t.prototype.setBlendAndCompareModes=function(){this._pRequiresBlending=this._pBlendMode!=n.NORMAL||this._alphaBlending||this._alpha<1;this._screenPass.depthCompareMode=this._depthCompareMode;this._screenPass.preserveAlpha=this._pRequiresBlending;this._screenPass.setBlendMode(this._pBlendMode==n.NORMAL&&this._pRequiresBlending?n.LAYER:this._pBlendMode);this._screenPass.forceSeparateMVP=false};return t}(o);t.exports=h},{"awayjs-core/lib/textures/Texture2DBase":undefined,"awayjs-display/lib/base/BlendMode":undefined,"awayjs-renderergl/lib/materials/TriangleMaterialBase":undefined,"awayjs-renderergl/lib/passes/TriangleBasicPass":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-renderergl/lib/materials/TriangleMaterialBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3DUtils");var n=e("awayjs-display/lib/base/TriangleSubGeometry");var s=e("awayjs-stagegl/lib/base/ContextGLProgramType");var o=e("awayjs-renderergl/lib/materials/MaterialGLBase");var l=function(e){r(t,e);function t(){e.apply(this,arguments)}t.prototype._iGetVertexCode=function(e,t,i){var r="";var a=e.globalPosDependencies>0?i.globalPositionVertex:i.localPosition;var n=t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();t.getFreeVertexConstant();e.viewMatrixIndex=n.index*4;if(e.projectionDependencies>0){i.projectionFragment=t.getFreeVarying();var s=t.getFreeVertexVectorTemp();r+="m44 "+s+", "+a+", "+n+"\n"+"mov "+i.projectionFragment+", "+s+"\n"+"mov op, "+s+"\n"}else{r+="m44 op, "+a+", "+n+"\n"}return r};t.prototype._iRenderPass=function(t,i,r,o,l){e.prototype._iRenderPass.call(this,t,i,r,o,l);var h=t.shaderObject;if(h.sceneMatrixIndex>=0){i.sourceEntity.getRenderSceneTransform(o).copyRawDataTo(h.vertexConstantData,h.sceneMatrixIndex,true);l.copyRawDataTo(h.vertexConstantData,h.viewMatrixIndex,true)}else{var p=a.CALCULATION_MATRIX;p.copyFrom(i.sourceEntity.getRenderSceneTransform(o));p.append(l);p.copyRawDataTo(h.vertexConstantData,h.viewMatrixIndex,true)}var u=r.context;u.setProgramConstantsFromArray(s.VERTEX,0,h.vertexConstantData,h.numUsedVertexConstants);u.setProgramConstantsFromArray(s.FRAGMENT,0,h.fragmentConstantData,h.numUsedFragmentConstants);r.activateBuffer(0,i.getVertexData(n.POSITION_DATA),i.getVertexOffset(n.POSITION_DATA),n.POSITION_FORMAT);u.drawTriangles(r.getIndexBuffer(i.getIndexData()),0,i.numTriangles)};return t}(o);t.exports=l},{"awayjs-core/lib/geom/Matrix3DUtils":undefined,"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/materials/MaterialGLBase":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined}],"awayjs-renderergl/lib/passes/DepthMapPass":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLMipFilter");var n=e("awayjs-stagegl/lib/base/ContextGLTextureFilter");var s=e("awayjs-stagegl/lib/base/ContextGLWrapMode");var o=e("awayjs-renderergl/lib/passes/MaterialPassGLBase");var l=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var h=function(e){r(t,e);function t(){e.call(this)}t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex;var r=t.fragmentConstantData;r[i]=1;r[i+1]=255;r[i+2]=65025;r[i+3]=16581375;r[i+4]=1/255;r[i+5]=1/255;r[i+6]=1/255;r[i+7]=0};t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++;if(e.alphaThreshold>0)e.uvDependencies++};t.prototype._iGetFragmentCode=function(e,t,i){var r="";var a=i.shadedTarget;var n=t.getFreeTextureReg();var s=t.getFreeFragmentConstant();var o=t.getFreeFragmentConstant();this._fragmentConstantsIndex=s.index*4;var h=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(h,1);var p=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(p,1);r+="div "+h+", "+i.projectionFragment+", "+i.projectionFragment+".w\n"+"mul "+h+", "+s+", "+h+".z\n"+"frc "+h+", "+h+"\n"+"mul "+p+", "+h+".yzww, "+o+"\n";if(e.alphaThreshold>0){n=t.getFreeTextureReg();this._texturesIndex=n.index;var u=t.getFreeFragmentVectorTemp();r+=l.getTex2DSampleCode(u,i,n,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var d=t.getFreeFragmentConstant();r+="sub "+u+".w, "+u+".w, "+d+".x\n"+"kil "+u+".w\n"}r+="sub "+a+", "+h+", "+p+"\n";t.removeFragmentTempUsage(h);t.removeFragmentTempUsage(p);return r};t.prototype._iRender=function(e,t,i,r,a){};t.prototype._iActivate=function(t,i,r){e.prototype._iActivate.call(this,t,i,r);var o=i.context;var l=t.shaderObject;if(l.alphaThreshold>0){o.setSamplerStateAt(this._texturesIndex,l.repeatTextures?s.REPEAT:s.CLAMP,l.useSmoothTextures?n.LINEAR:n.NEAREST,l.useMipmapping?a.MIPLINEAR:a.MIPNONE);i.stage.activateTexture(this._texturesIndex,l.texture);l.fragmentConstantData[this._fragmentConstantsIndex+8]=t.shaderObject.alphaThreshold}};return t}(o);t.exports=h},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined,"awayjs-stagegl/lib/base/ContextGLMipFilter":undefined,"awayjs-stagegl/lib/base/ContextGLTextureFilter":undefined,"awayjs-stagegl/lib/base/ContextGLWrapMode":undefined}],"awayjs-renderergl/lib/passes/DistanceMapPass":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLMipFilter");var n=e("awayjs-stagegl/lib/base/ContextGLTextureFilter");var s=e("awayjs-stagegl/lib/base/ContextGLWrapMode");var o=e("awayjs-renderergl/lib/passes/MaterialPassGLBase");var l=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var h=function(e){r(t,e);function t(){e.call(this)}t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex;var r=t.fragmentConstantData;r[i+4]=1/255;r[i+5]=1/255;r[i+6]=1/255;r[i+7]=0};t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++;e.viewDirDependencies++;if(e.alphaThreshold>0)e.uvDependencies++;if(e.viewDirDependencies>0)e.globalPosDependencies++};t.prototype._iGetFragmentCode=function(e,t,i){var r;var a=i.shadedTarget;var n=t.getFreeTextureReg();var s=t.getFreeFragmentConstant();var o=t.getFreeFragmentConstant();this._fragmentConstantsIndex=s.index*4;var h=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(h,1);var p=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(p,1);r="dp3 "+h+".z, "+i.viewDirVarying+".xyz, "+i.viewDirVarying+".xyz\n"+"mul "+h+", "+s+", "+h+".z\n"+"frc "+h+", "+h+"\n"+"mul "+p+", "+h+".yzww, "+o+"\n";if(e.alphaThreshold>0){n=t.getFreeTextureReg();this._texturesIndex=n.index;var u=t.getFreeFragmentVectorTemp();r+=l.getTex2DSampleCode(u,i,n,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var d=t.getFreeFragmentConstant();r+="sub "+u+".w, "+u+".w, "+d+".x\n"+"kil "+u+".w\n"}r+="sub "+a+", "+h+", "+p+"\n";return r};t.prototype._iActivate=function(t,i,r){e.prototype._iActivate.call(this,t,i,r);var o=i.context;var l=t.shaderObject;var h=r.projection.far;h=1/(2*h*h);var p=this._fragmentConstantsIndex;var u=l.fragmentConstantData;u[p]=1*h;u[p+1]=255*h;u[p+2]=65025*h;u[p+3]=16581375*h;if(l.alphaThreshold>0){o.setSamplerStateAt(this._texturesIndex,l.repeatTextures?s.REPEAT:s.CLAMP,l.useSmoothTextures?n.LINEAR:n.NEAREST,l.useMipmapping?a.MIPLINEAR:a.MIPNONE);i.stage.activateTexture(this._texturesIndex,l.texture);u[p+8]=t.shaderObject.alphaThreshold}};return t}(o);t.exports=h},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined,"awayjs-stagegl/lib/base/ContextGLMipFilter":undefined,"awayjs-stagegl/lib/base/ContextGLTextureFilter":undefined,"awayjs-stagegl/lib/base/ContextGLWrapMode":undefined}],"awayjs-renderergl/lib/passes/LightingPassGLBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/errors/AbstractMethodError");var n=e("awayjs-renderergl/lib/passes/MaterialPassGLBase");var s=function(e){r(t,e);function t(){e.call(this);this._pNumPointLights=0;this._pNumDirectionalLights=0;this._pNumLightProbes=0;this._directionalLightsOffset=0;this._pointLightsOffset=0;this._lightProbesOffset=0}Object.defineProperty(t.prototype,"directionalLightsOffset",{get:function(){return this._directionalLightsOffset},set:function(e){this._directionalLightsOffset=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"pointLightsOffset",{get:function(){return this._pointLightsOffset},set:function(e){this._pointLightsOffset=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lightProbesOffset",{get:function(){return this._lightProbesOffset},set:function(e){this._lightProbesOffset=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"iNumPointLights",{get:function(){return this._pNumPointLights},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"iNumDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"iNumLightProbes",{get:function(){return this._pNumLightProbes},enumerable:true,configurable:true});t.prototype._iUsesSpecular=function(){throw new a};t.prototype._iUsesShadows=function(){throw new a};t.prototype._iGetPreLightingVertexCode=function(e,t,i){throw new a};t.prototype._iGetPreLightingFragmentCode=function(e,t,i){throw new a};t.prototype._iGetPerLightDiffuseFragmentCode=function(e,t,i,r,n){throw new a};t.prototype._iGetPerLightSpecularFragmentCode=function(e,t,i,r,n){throw new a};t.prototype._iGetPerProbeDiffuseFragmentCode=function(e,t,i,r,n){throw new a};t.prototype._iGetPerProbeSpecularFragmentCode=function(e,t,i,r,n){throw new a};t.prototype._iGetPostLightingVertexCode=function(e,t,i){throw new a};t.prototype._iGetPostLightingFragmentCode=function(e,t,i){throw new a};return t}(n);t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-renderergl/lib/passes/MaterialPassGLBase":undefined}],"awayjs-renderergl/lib/passes/LineBasicPass":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];
function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/passes/MaterialPassGLBase");var n=function(e){r(t,e);function t(){e.call(this)}t.prototype._iGetFragmentCode=function(e,t,i){var r=i.shadedTarget;return"mov "+r+", v0\n"};return t}(a);t.exports=n},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":undefined}],"awayjs-renderergl/lib/passes/MaterialPassGLBase":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/library/NamedAssetBase");var n=e("awayjs-core/lib/errors/ArgumentError");var s=e("awayjs-core/lib/events/Event");var o=e("awayjs-display/lib/base/BlendMode");var l=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var h=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var p=e("awayjs-renderergl/lib/compilation/ShaderObjectBase");var u=function(e){r(t,e);function t(){var t=this;e.call(this);this._materialPassData=new Array;this._preserveAlpha=true;this._forceSeparateMVP=false;this._depthCompareMode=h.LESS_EQUAL;this._blendFactorSource=l.ONE;this._blendFactorDest=l.ZERO;this._pEnableBlending=false;this._writeDepth=true;this._onLightsChangeDelegate=function(e){return t.onLightsChange(e)}}Object.defineProperty(t.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(e){if(this._preserveAlpha==e)return;this._preserveAlpha=e;this._pInvalidatePass()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(e){if(this._forceSeparateMVP==e)return;this._forceSeparateMVP=e;this._pInvalidatePass()},enumerable:true,configurable:true});t.prototype.createShaderObject=function(e){return new p(e)};Object.defineProperty(t.prototype,"writeDepth",{get:function(){return this._writeDepth},set:function(e){this._writeDepth=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode=e},enumerable:true,configurable:true});t.prototype.dispose=function(){if(this._pLightPicker)this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate);while(this._materialPassData.length)this._materialPassData[0].dispose();this._materialPassData=null};t.prototype._iRender=function(e,t,i,r,a){this.setRenderState(e,t,i,r,a)};t.prototype.setRenderState=function(e,t,i,r,a){e.shaderObject.setRenderState(t,i,r,a)};t.prototype.setBlendMode=function(e){switch(e){case o.NORMAL:this._blendFactorSource=l.ONE;this._blendFactorDest=l.ZERO;this._pEnableBlending=false;break;case o.LAYER:this._blendFactorSource=l.SOURCE_ALPHA;this._blendFactorDest=l.ONE_MINUS_SOURCE_ALPHA;this._pEnableBlending=true;break;case o.MULTIPLY:this._blendFactorSource=l.ZERO;this._blendFactorDest=l.SOURCE_COLOR;this._pEnableBlending=true;break;case o.ADD:this._blendFactorSource=l.SOURCE_ALPHA;this._blendFactorDest=l.ONE;this._pEnableBlending=true;break;case o.ALPHA:this._blendFactorSource=l.ZERO;this._blendFactorDest=l.SOURCE_ALPHA;this._pEnableBlending=true;break;default:throw new n("Unsupported blend mode!")}};t.prototype._iActivate=function(e,t,i){t.context.setDepthTest(this._writeDepth&&!this._pEnableBlending,this._depthCompareMode);if(this._pEnableBlending)t.context.setBlendFactors(this._blendFactorSource,this._blendFactorDest);t.activateMaterialPass(e,i)};t.prototype._iDeactivate=function(e,t){t.deactivateMaterialPass(e);t.context.setDepthTest(true,h.LESS_EQUAL)};t.prototype._pInvalidatePass=function(){var e=this._materialPassData.length;for(var t=0;t<e;t++)this._materialPassData[t].invalidate();this.dispatchEvent(new s(s.CHANGE))};Object.defineProperty(t.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(e){if(this._pLightPicker)this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate);this._pLightPicker=e;if(this._pLightPicker)this._pLightPicker.addEventListener(s.CHANGE,this._onLightsChangeDelegate);this.pUpdateLights()},enumerable:true,configurable:true});t.prototype.onLightsChange=function(e){this.pUpdateLights()};t.prototype.pUpdateLights=function(){};t.prototype._iIncludeDependencies=function(e){if(this._forceSeparateMVP)e.globalPosDependencies++;e.outputsNormals=this._pOutputsNormals(e);e.outputsTangentNormals=e.outputsNormals&&this._pOutputsTangentNormals(e);e.usesTangentSpace=e.outputsTangentNormals&&this._pUsesTangentSpace(e);if(!e.usesTangentSpace&&e.viewDirDependencies>0)e.globalPosDependencies++};t.prototype._iInitConstantData=function(e){};t.prototype._iGetPreLightingVertexCode=function(e,t,i){return""};t.prototype._iGetPreLightingFragmentCode=function(e,t,i){return""};t.prototype._iGetVertexCode=function(e,t,i){return""};t.prototype._iGetFragmentCode=function(e,t,i){return""};t.prototype._iGetNormalVertexCode=function(e,t,i){return""};t.prototype._iGetNormalFragmentCode=function(e,t,i){return""};t.prototype._pOutputsNormals=function(e){return false};t.prototype._pOutputsTangentNormals=function(e){return false};t.prototype._pUsesTangentSpace=function(e){return false};t.prototype._iAddMaterialPassData=function(e){this._materialPassData.push(e);return e};t.prototype._iRemoveMaterialPassData=function(e){this._materialPassData.splice(this._materialPassData.indexOf(e),1);return e};return t}(a);t.exports=u},{"awayjs-core/lib/errors/ArgumentError":undefined,"awayjs-core/lib/events/Event":undefined,"awayjs-core/lib/library/NamedAssetBase":undefined,"awayjs-display/lib/base/BlendMode":undefined,"awayjs-renderergl/lib/compilation/ShaderObjectBase":undefined,"awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined}],"awayjs-renderergl/lib/passes/SkyboxPass":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-renderergl/lib/passes/MaterialPassGLBase");var n=function(e){r(t,e);function t(){e.call(this)}t.prototype._iIncludeDependencies=function(e){e.useMipmapping=false};return t}(a);t.exports=n},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":undefined}],"awayjs-renderergl/lib/passes/TriangleBasicPass":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-stagegl/lib/base/ContextGLMipFilter");var n=e("awayjs-stagegl/lib/base/ContextGLTextureFilter");var s=e("awayjs-stagegl/lib/base/ContextGLWrapMode");var o=e("awayjs-renderergl/lib/passes/MaterialPassGLBase");var l=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper");var h=function(e){r(t,e);function t(){e.call(this);this._diffuseColor=16777215;this._diffuseR=1;this._diffuseG=1;this._diffuseB=1;this._diffuseA=1}Object.defineProperty(t.prototype,"diffuseAlpha",{get:function(){return this._diffuseA},set:function(e){this._diffuseA=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){this._diffuseColor=e;this._diffuseR=(this._diffuseColor>>16&255)/255;this._diffuseG=(this._diffuseColor>>8&255)/255;this._diffuseB=(this._diffuseColor&255)/255},enumerable:true,configurable:true});t.prototype._iGetFragmentCode=function(e,t,i){var r="";var a=i.shadedTarget;var n;if(e.texture!=null){n=t.getFreeTextureReg();this._texturesIndex=n.index;r+=l.getTex2DSampleCode(a,i,n,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);if(e.alphaThreshold>0){var s=t.getFreeFragmentConstant();this._fragmentConstantsIndex=s.index*4;r+="sub "+a+".w, "+a+".w, "+s+".x\n"+"kil "+a+".w\n"+"add "+a+".w, "+a+".w, "+s+".x\n"}}else{n=t.getFreeFragmentConstant();this._fragmentConstantsIndex=n.index*4;r+="mov "+a+", "+n+"\n"}return r};t.prototype._iIncludeDependencies=function(e){if(e.texture!=null)e.uvDependencies++};t.prototype._iActivate=function(t,i,r){e.prototype._iActivate.call(this,t,i,r);var o=t.shaderObject;if(o.texture!=null){i.context.setSamplerStateAt(this._texturesIndex,o.repeatTextures?s.REPEAT:s.CLAMP,o.useSmoothTextures?n.LINEAR:n.NEAREST,o.useMipmapping?a.MIPLINEAR:a.MIPNONE);i.stage.activateTexture(this._texturesIndex,o.texture);if(o.alphaThreshold>0)o.fragmentConstantData[this._fragmentConstantsIndex]=o.alphaThreshold}else{var l=this._fragmentConstantsIndex;var h=o.fragmentConstantData;h[l]=this._diffuseR;h[l+1]=this._diffuseG;h[l+2]=this._diffuseB;h[l+3]=this._diffuseA}};return t}(o);t.exports=h},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":undefined,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":undefined,"awayjs-stagegl/lib/base/ContextGLMipFilter":undefined,"awayjs-stagegl/lib/base/ContextGLTextureFilter":undefined,"awayjs-stagegl/lib/base/ContextGLWrapMode":undefined}],"awayjs-renderergl/lib/pick/JSPickingCollider":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-display/lib/base/TriangleSubGeometry");var s=e("awayjs-renderergl/lib/pick/PickingColliderBase");var o=function(e){r(t,e);function t(t){if(t===void 0){t=false}e.call(this);this._findClosestCollision=t}t.prototype._pTestRenderableCollision=function(e,t,i){var r;var s,o,l;var h,p,u;var d,c,f;var _,g,m;var y,v,b,x;var w,P,C;var D,T,S;var O,A,R;var j,V,I;var N,L,M;var F,E,B,z;var U,G,k,X,W;var H=e.getIndexData().data;var Z=-1;var q=e.materialOwner.material.bothSides;var Y=e.getVertexData(n.POSITION_DATA).data;var J=e.getVertexData(n.POSITION_DATA).dataPerVertex;var Q=e.getVertexOffset(n.POSITION_DATA);var K=e.getVertexData(n.UV_DATA).data;var $=e.getVertexData(n.UV_DATA).dataPerVertex;var et=e.getVertexOffset(n.UV_DATA);var tt=H.length;for(var it=0;it<tt;it+=3){s=Q+H[it]*J;o=Q+H[it+1]*J;l=Q+H[it+2]*J;w=Y[s];P=Y[s+1];C=Y[s+2];D=Y[o];T=Y[o+1];S=Y[o+2];O=Y[l];A=Y[l+1];R=Y[l+2];j=D-w;V=T-P;I=S-C;N=O-w;L=A-P;M=R-C;d=V*M-I*L;c=I*N-j*M;f=j*L-V*N;F=1/Math.sqrt(d*d+c*c+f*f);d*=F;c*=F;f*=F;E=d*this.rayDirection.x+c*+this.rayDirection.y+f*this.rayDirection.z;if(!q&&E<0||q&&E!=0){B=-(d*w+c*P+f*C);z=-(d*this.rayPosition.x+c*this.rayPosition.y+f*this.rayPosition.z+B);r=z/E;_=this.rayPosition.x+r*this.rayDirection.x;g=this.rayPosition.y+r*this.rayDirection.y;m=this.rayPosition.z+r*this.rayDirection.z;U=j*N+V*L+I*M;G=j*j+V*V+I*I;k=N*N+L*L+M*M;h=_-w;p=g-P;u=m-C;X=h*j+p*V+u*I;W=h*N+p*L+u*M;y=1/(G*k-U*U);b=y*(k*X-U*W);x=y*(-U*X+G*W);if(b<0)continue;if(x<0)continue;v=1-b-x;if(!(v<0)&&r>0&&r<i){i=r;Z=it/3;t.rayEntryDistance=r;t.localPosition=new a(_,g,m);t.localNormal=new a(d,c,f);t.uv=this._pGetCollisionUV(H,K,it,b,x,v,et,$);t.index=it;if(!this._findClosestCollision)return true}}}if(Z>=0)return true;return false};return t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/pick/PickingColliderBase":undefined}],"awayjs-renderergl/lib/pick/PickingColliderBase":[function(e,t,i){var r=e("awayjs-core/lib/geom/Point");var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-core/lib/errors/AbstractMethodError");var s=e("awayjs-display/lib/pool/RenderablePool");var o=e("awayjs-renderergl/lib/pool/BillboardRenderable");var l=e("awayjs-renderergl/lib/pool/TriangleSubMeshRenderable");var h=function(){function e(){this._billboardRenderablePool=s.getPool(o);this._subMeshRenderablePool=s.getPool(l)}e.prototype._pPetCollisionNormal=function(e,t,i){var r=new a;var n=e[i]*3;var s=e[i+1]*3;var o=e[i+2]*3;var l=new a(t[n],t[n+1],t[n+2]);var h=new a(t[s],t[s+1],t[s+2]);var p=new a(t[o],t[o+1],t[o+2]);var u=h.subtract(l);var d=p.subtract(l);r=u.crossProduct(d);r.normalize();return r};e.prototype._pGetCollisionUV=function(e,t,i,n,s,o,l,h){var p=new r;var u=e[i]*h+l;var d=new a(t[u],t[u+1]);u=e[i+1]*h+l;var c=new a(t[u],t[u+1]);u=e[i+2]*h+l;var f=new a(t[u],t[u+1]);p.x=o*d.x+n*c.x+s*f.x;p.y=o*d.y+n*c.y+s*f.y;return p};e.prototype._pTestRenderableCollision=function(e,t,i){throw new n};e.prototype.setLocalRay=function(e,t){this.rayPosition=e;this.rayDirection=t};e.prototype.testBillboardCollision=function(e,t,i){this.setLocalRay(t.localRayPosition,t.localRayDirection);t.materialOwner=null;if(this._pTestRenderableCollision(this._billboardRenderablePool.getItem(e),t,i)){i=t.rayEntryDistance;t.materialOwner=e;return true}return false};e.prototype.testMeshCollision=function(e,t,i,r){this.setLocalRay(t.localRayPosition,t.localRayDirection);t.materialOwner=null;var a;var n=e.subMeshes.length;for(var s=0;s<n;++s){a=e.subMeshes[s];if(this._pTestRenderableCollision(this._subMeshRenderablePool.getItem(a),t,i)){i=t.rayEntryDistance;t.materialOwner=a;if(!r)return true}}return t.materialOwner!=null};return e}();t.exports=h},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-core/lib/geom/Point":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-display/lib/pool/RenderablePool":undefined,"awayjs-renderergl/lib/pool/BillboardRenderable":undefined,"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":undefined}],"awayjs-renderergl/lib/pick/ShaderPicker":[function(e,t,i){var r=e("awayjs-core/lib/utils/Debug");var a=e("awayjs-core/lib/base/BitmapData");var n=e("awayjs-core/lib/geom/Matrix3DUtils");var s=e("awayjs-core/lib/geom/Point");var o=e("awayjs-core/lib/geom/Rectangle");var l=e("awayjs-core/lib/geom/Vector3D");var h=e("awayjs-display/lib/base/TriangleSubGeometry");var p=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler");var u=e("awayjs-stagegl/lib/base/ContextGLBlendFactor");var d=e("awayjs-stagegl/lib/base/ContextGLClearMask");var c=e("awayjs-stagegl/lib/base/ContextGLCompareMode");var f=e("awayjs-stagegl/lib/base/ContextGLProgramType");var _=e("awayjs-stagegl/lib/base/ContextGLTriangleFace");var g=function(){function e(e){if(e===void 0){e=false}this._onlyMouseEnabled=true;this._interactives=new Array;this._localHitPosition=new l;this._hitUV=new s;this._localHitNormal=new l;this._rayPos=new l;this._rayDir=new l;this._shaderPickingDetails=e;this._id=new Array(4);this._viewportData=new Array(4);this._boundOffsetScale=new Array(8);this._boundOffsetScale[3]=0;this._boundOffsetScale[7]=1}Object.defineProperty(e.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},set:function(e){this._onlyMouseEnabled=e},enumerable:true,configurable:true});e.prototype.getViewCollision=function(e,t,i){var r=i.iEntityCollector;this._stage=i.renderer.stage;if(!this._stage)return null;this._context=this._stage.context;this._viewportData[0]=i.width;this._viewportData[1]=i.height;this._viewportData[2]=-(this._projX=2*e/i.width-1);this._viewportData[3]=this._projY=2*t/i.height-1;this._potentialFound=false;this._blendedRenderableHead=null;this._opaqueRenderableHead=null;this.pDraw(r,null);this._context.setVertexBufferAt(0,null);if(!this._context||!this._potentialFound)return null;if(!this._bitmapData)this._bitmapData=new a(1,1,false,0);this._context.drawToBitmapData(this._bitmapData);this._hitColor=this._bitmapData.getPixel(0,0);if(!this._hitColor){this._context.present();return null}this._hitRenderable=this._interactives[this._hitColor-1];this._hitEntity=this._hitRenderable.sourceEntity;if(this._onlyMouseEnabled&&!this._hitEntity._iIsMouseEnabled())return null;var n=this._hitEntity._iPickingCollisionVO;if(this._shaderPickingDetails){this.getHitDetails(i.camera);n.localPosition=this._localHitPosition;n.localNormal=this._localHitNormal;n.uv=this._hitUV;n.index=this._faceIndex}else{n.localPosition=null;n.localNormal=null;n.uv=null;n.index=0}return n};e.prototype.getSceneCollision=function(e,t,i){return null};e.prototype.pDraw=function(t,i){var r=t.camera;this._context.clear(0,0,0,1);this._stage.scissorRect=e.MOUSE_SCISSOR_RECT;this._interactives.length=this._interactiveId=0;if(!this._objectProgram)this.initObjectProgram();this._context.setBlendFactors(u.ONE,u.ZERO);this._context.setDepthTest(true,c.LESS);this._context.setProgram(this._objectProgram);this._context.setProgramConstantsFromArray(f.VERTEX,4,this._viewportData,1)};e.prototype.drawRenderables=function(e,t){var i=n.CALCULATION_MATRIX;var r=t.viewProjection;while(e){if(!e.sourceEntity.scene||!e.sourceEntity._iIsMouseEnabled()){e=e.next;continue}this._potentialFound=true;this._context.setCulling(e.materialOwner.material.bothSides?_.NONE:_.BACK,t.projection.coordinateSystem);this._interactives[this._interactiveId++]=e;this._id[1]=(this._interactiveId>>8)/255;this._id[2]=(this._interactiveId&255)/255;i.copyFrom(e.sourceEntity.getRenderSceneTransform(t));i.append(r);this._context.setProgramConstantsFromMatrix(f.VERTEX,0,i,true);this._context.setProgramConstantsFromArray(f.FRAGMENT,0,this._id,1);this._stage.activateBuffer(0,e.getVertexData(h.POSITION_DATA),e.getVertexOffset(h.POSITION_DATA),h.POSITION_FORMAT);this._context.drawTriangles(this._stage.getIndexBuffer(e.getIndexData()),0,e.numTriangles);e=e.next}};e.prototype.updateRay=function(e){this._rayPos=e.scenePosition;this._rayDir=e.getRay(this._projX,this._projY,1);this._rayDir.normalize()};e.prototype.initObjectProgram=function(){var e;var t;this._objectProgram=this._context.createProgram();e="m44 vt0, va0, vc0			\n"+"mul vt1.xy, vt0.w, vc4.zw	\n"+"add vt0.xy, vt0.xy, vt1.xy	\n"+"mul vt0.xy, vt0.xy, vc4.xy	\n"+"mov op, vt0	\n";t="mov oc, fc0";r.throwPIR("ShaderPicker","initTriangleProgram","Dependency: initObjectProgram")};e.prototype.initTriangleProgram=function(){var e;var t;this._triangleProgram=this._context.createProgram();e="add vt0, va0, vc5 			\n"+"mul vt0, vt0, vc6 			\n"+"mov v0, vt0				\n"+"m44 vt0, va0, vc0			\n"+"mul vt1.xy, vt0.w, vc4.zw	\n"+"add vt0.xy, vt0.xy, vt1.xy	\n"+"mul vt0.xy, vt0.xy, vc4.xy	\n"+"mov op, vt0	\n";t="mov oc, v0";var i=(new p).assemble("part vertex 1\n"+e+"endpart")["vertex"].data;var r=(new p).assemble("part fragment 1\n"+t+"endpart")["fragment"].data;this._triangleProgram.upload(i,r)};e.prototype.getHitDetails=function(e){this.getApproximatePosition(e);this.getPreciseDetails(e)};e.prototype.getApproximatePosition=function(t){var i=this._hitRenderable.sourceEntity.bounds.aabb;var r;var a,s,o;var l,p,u;var c=n.CALCULATION_MATRIX;c.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(t));c.append(t.viewProjection);if(!this._triangleProgram){this.initTriangleProgram()}this._boundOffsetScale[4]=1/(a=i.width);this._boundOffsetScale[5]=1/(s=i.height);this._boundOffsetScale[6]=1/(o=i.depth);this._boundOffsetScale[0]=l=-i.x;this._boundOffsetScale[1]=p=-i.y;this._boundOffsetScale[2]=u=-i.z;this._context.setProgram(this._triangleProgram);this._context.clear(0,0,0,0,1,0,d.DEPTH);this._context.setScissorRectangle(e.MOUSE_SCISSOR_RECT);this._context.setProgramConstantsFromMatrix(f.VERTEX,0,c,true);this._context.setProgramConstantsFromArray(f.VERTEX,5,this._boundOffsetScale,2);this._stage.activateBuffer(0,this._hitRenderable.getVertexData(h.POSITION_DATA),this._hitRenderable.getVertexOffset(h.POSITION_DATA),h.POSITION_FORMAT);this._context.drawTriangles(this._stage.getIndexBuffer(this._hitRenderable.getIndexData()),0,this._hitRenderable.numTriangles);this._context.drawToBitmapData(this._bitmapData);r=this._bitmapData.getPixel(0,0);this._localHitPosition.x=(r>>16&255)*a/255-l;this._localHitPosition.y=(r>>8&255)*s/255-p;this._localHitPosition.z=(r&255)*o/255-u};e.prototype.getPreciseDetails=function(e){var t=rt.length;var i,r,a;var n,s,o;var l,p,u;var d=0,c=1,f=2;var _,g,m;var y,v,b;var x,w,P;var C,D,T;var S,O,A;var R,j,V,I;var N,L,M,F,E;var B,z,U;var G=this._localHitPosition.x,k=this._localHitPosition.y,X=this._localHitPosition.z;var W,H;var Z,q,Y;var J,Q,K;var $,et,tt;var it;var rt=this._hitRenderable.getIndexData().data;var at=this._hitRenderable.getVertexData(h.POSITION_DATA).data;var nt=this._hitRenderable.getVertexData(h.POSITION_DATA).dataPerVertex;var st=this._hitRenderable.getVertexOffset(h.POSITION_DATA);var ot=this._hitRenderable.getVertexData(h.UV_DATA).data;var lt=this._hitRenderable.getVertexData(h.UV_DATA).dataPerVertex;var ht=this._hitRenderable.getVertexOffset(h.UV_DATA);var pt=this._hitRenderable.getVertexData(h.NORMAL_DATA).data;var ut=this._hitRenderable.getVertexData(h.NORMAL_DATA).dataPerVertex;var dt=this._hitRenderable.getVertexOffset(h.NORMAL_DATA);this.updateRay(e);while(d<t){_=st+rt[d]*nt;g=st+rt[c]*nt;m=st+rt[f]*nt;i=at[_];r=at[_+1];a=at[_+2];n=at[g];s=at[g+1];o=at[g+2];l=at[m];p=at[m+1];u=at[m+2];if(!(G<i&&G<n&&G<l||k<r&&k<s&&k<p||X<a&&X<o&&X<u||G>i&&G>n&&G>l||k>r&&k>s&&k>p||X>a&&X>o&&X>u)){y=l-i;v=p-r;b=u-a;x=n-i;w=s-r;P=o-a;C=G-i;D=k-r;T=X-a;N=y*y+v*v+b*b;L=y*x+v*w+b*P;M=y*C+v*D+b*T;F=x*x+w*w+P*P;E=x*C+w*D+P*T;U=1/(N*F-L*L);B=(F*M-L*E)*U;z=(N*E-L*M)*U;if(B>=0&&z>=0&&B+z<=1){S=dt+rt[d]*ut;O=dt+rt[c]*ut;A=dt+rt[f]*ut;R=rt[S]+rt[O]+rt[A];j=rt[S+1]+rt[O+1]+rt[A+1];V=rt[S+2]+rt[O+2]+rt[A+2];I=Math.sqrt(R*R+j*j+V*V);R/=I;j/=I;V/=I;this.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform,R,j,V,i,r,a);C=this._localHitPosition.x-i;D=this._localHitPosition.y-r;T=this._localHitPosition.z-a;J=n-i;Q=s-r;K=o-a;$=l-i;et=p-r;tt=u-a;this._localHitNormal.x=Q*tt-K*et;this._localHitNormal.y=K*$-J*tt;this._localHitNormal.z=J*et-Q*$;it=1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x+this._localHitNormal.y*this._localHitNormal.y+this._localHitNormal.z*this._localHitNormal.z);this._localHitNormal.x*=it;this._localHitNormal.y*=it;this._localHitNormal.z*=it;M=y*C+v*D+b*T;E=x*C+w*D+P*T;B=(F*M-L*E)*U;z=(N*E-L*M)*U;Z=ht+rt[d]*lt;q=ht+rt[c]*lt;Y=ht+rt[f]*lt;W=ot[Z];H=ot[Z+1];this._hitUV.x=W+z*(ot[q]-W)+B*(ot[Y]-W);this._hitUV.y=H+z*(ot[q+1]-H)+B*(ot[Y+1]-H);this._faceIndex=d;return}}d+=3;c+=3;f+=3}};e.prototype.getPrecisePosition=function(e,t,i,r,a,s,o){var l,h,p;var u,d,c;var f;var _=n.RAW_DATA_CONTAINER;var g=this._rayPos.x,m=this._rayPos.y,y=this._rayPos.z;u=this._rayDir.x;d=this._rayDir.y;c=this._rayDir.z;e.copyRawDataTo(_);l=_[0]*u+_[4]*d+_[8]*c;h=_[1]*u+_[5]*d+_[9]*c;p=_[2]*u+_[6]*d+_[10]*c;u=_[0]*g+_[4]*m+_[8]*y+_[12];d=_[1]*g+_[5]*m+_[9]*y+_[13];c=_[2]*g+_[6]*m+_[10]*y+_[14];f=((a-u)*t+(s-d)*i+(o-c)*r)/(l*t+h*i+p*r);this._localHitPosition.x=u+l*f;this._localHitPosition.y=d+h*f;this._localHitPosition.z=c+p*f};e.prototype.dispose=function(){this._bitmapData.dispose();if(this._triangleProgram)this._triangleProgram.dispose();if(this._objectProgram)this._objectProgram.dispose();this._triangleProgram=null;this._objectProgram=null;this._bitmapData=null;this._hitRenderable=null;this._hitEntity=null};e.MOUSE_SCISSOR_RECT=new o(0,0,1,1);return e}();t.exports=g},{"awayjs-core/lib/base/BitmapData":undefined,"awayjs-core/lib/geom/Matrix3DUtils":undefined,"awayjs-core/lib/geom/Point":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/utils/Debug":undefined,"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":undefined,"awayjs-stagegl/lib/base/ContextGLBlendFactor":undefined,"awayjs-stagegl/lib/base/ContextGLClearMask":undefined,"awayjs-stagegl/lib/base/ContextGLCompareMode":undefined,"awayjs-stagegl/lib/base/ContextGLProgramType":undefined,"awayjs-stagegl/lib/base/ContextGLTriangleFace":undefined}],"awayjs-renderergl/lib/pool/BillboardRenderable":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/TriangleSubGeometry");var n=e("awayjs-renderergl/lib/pool/RenderableBase");var s=function(e){r(t,e);function t(t,i){e.call(this,t,i,i);this._billboard=i}t.prototype._pGetSubGeometry=function(){var e=this._billboard.material;var i=t._materialGeometry[e.id];if(!i){i=t._materialGeometry[e.id]=new a(true);i.autoDeriveNormals=false;i.autoDeriveTangents=false;i.updateIndices(Array(0,1,2,0,2,3));i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0));i.updateVertexNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0));i.updateVertexTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1));i.updateUVs(Array(0,0,1,0,1,1,0,1))}else{i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0))}this._pVertexDataDirty[a.POSITION_DATA]=true;this._pVertexDataDirty[a.NORMAL_DATA]=true;this._pVertexDataDirty[a.TANGENT_DATA]=true;this._pVertexDataDirty[a.UV_DATA]=true;return i};t._materialGeometry=new Object;t.id="billboard";return t}(n);t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/pool/RenderableBase":undefined}],"awayjs-renderergl/lib/pool/LineSubMeshRenderable":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/LineSubGeometry");var n=e("awayjs-renderergl/lib/pool/RenderableBase");var s=function(e){r(t,e);function t(t,i,r,a){if(r===void 0){r=0}if(a===void 0){a=0}e.call(this,t,i.parentMesh,i,r,a);this.subMesh=i}t.prototype._pGetSubGeometry=function(){var e=this.subMesh.subGeometry;this._pVertexDataDirty[a.START_POSITION_DATA]=true;this._pVertexDataDirty[a.END_POSITION_DATA]=true;if(e.thickness)this._pVertexDataDirty[a.THICKNESS_DATA]=true;if(e.startColors)this._pVertexDataDirty[a.COLOR_DATA]=true;return e};t.prototype._pGetOverflowRenderable=function(e,i,r,a){return new t(e,i,r,a)};t.id="linesubmesh";return t}(n);t.exports=s},{"awayjs-display/lib/base/LineSubGeometry":undefined,"awayjs-renderergl/lib/pool/RenderableBase":undefined}],"awayjs-renderergl/lib/pool/MaterialDataPool":[function(e,t,i){var r=e("awayjs-renderergl/lib/pool/MaterialData");var a=function(){function e(){this._pool=new Object}e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=e._iAddMaterialData(new r(this,e)))};e.prototype.disposeItem=function(e){e._iRemoveMaterialData(this._pool[e.id]);this._pool[e.id]=null};return e}();t.exports=a},{"awayjs-renderergl/lib/pool/MaterialData":undefined}],"awayjs-renderergl/lib/pool/MaterialData":[function(e,t,i){var r=e("awayjs-renderergl/lib/pool/MaterialPassDataPool");var a=function(){function e(e,t){this.invalidAnimation=true;this._pool=e;this.material=t;this._materialPassDataPool=new r(t)}e.prototype.getMaterialPass=function(e,t){var i=this._materialPassDataPool.getItem(e);if(!i.shaderObject){i.shaderObject=e.createShaderObject(t);i.invalid=true}if(i.invalid){i.invalid=false;var r=i.shaderObject.createCompiler(this.material,e);r.compile();i.shadedTarget=r.shadedTarget;i.vertexCode=r.vertexCode;i.fragmentCode=r.fragmentCode;i.postAnimationFragmentCode=r.postAnimationFragmentCode;i.key=""}return i};e.prototype.getMaterialPasses=function(e){if(this._passes==null){var t=this.material._iScreenPasses;var i=t.length;this._passes=new Array(i);for(var r=0;r<i;r++)this._passes[r]=this.getMaterialPass(t[r],e)}return this._passes};e.prototype.dispose=function(){this._materialPassDataPool.disposePool();this._materialPassDataPool=null;this._pool.disposeItem(this.material);this._passes=null};e.prototype.invalidateMaterial=function(){this._passes=null;this.invalidateAnimation()};e.prototype.invalidateAnimation=function(){this.invalidAnimation=true};return e}();t.exports=a},{"awayjs-renderergl/lib/pool/MaterialPassDataPool":undefined}],"awayjs-renderergl/lib/pool/MaterialPassDataPool":[function(e,t,i){var r=e("awayjs-renderergl/lib/pool/MaterialPassData");var a=function(){function e(e){this._pool=new Object;this._material=e}e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=this._material._iAddMaterialPassData(e._iAddMaterialPassData(new r(this,this._material,e))))};e.prototype.disposeItem=function(e){e._iRemoveMaterialPassData(this._pool[e.id]);delete this._pool[e.id]};e.prototype.disposePool=function(){for(var e in this._pool)this._pool[e].materialPass._iRemoveMaterialPassData(this._pool[e]);delete this._pool};return e}();t.exports=a},{"awayjs-renderergl/lib/pool/MaterialPassData":undefined}],"awayjs-renderergl/lib/pool/MaterialPassData":[function(e,t,i){var r=function(){function e(e,t,i){this.animationVertexCode="";this.animationFragmentCode="";this._pool=e;this.material=t;this.materialPass=i}e.prototype.dispose=function(){this._pool.disposeItem(this.materialPass);this.shaderObject.dispose();this.shaderObject=null;this.programData.dispose();this.programData=null};e.prototype.invalidate=function(){this.invalid=true};return e}();t.exports=r},{}],"awayjs-renderergl/lib/pool/RenderableBase":[function(e,t,i){var r=e("awayjs-core/lib/errors/AbstractMethodError");var a=e("awayjs-display/lib/base/SubGeometryBase");var n=e("awayjs-display/lib/base/TriangleSubGeometry");var s=e("awayjs-display/lib/events/SubGeometryEvent");var o=e("awayjs-stagegl/lib/pool/IndexDataPool");var l=e("awayjs-stagegl/lib/pool/VertexDataPool");var h=function(){function e(e,t,i,r,a){var n=this;if(r===void 0){r=0}if(a===void 0){a=0}this._geometryDirty=true;this._indexDataDirty=true;this._vertexData=new Object;this._pVertexDataDirty=new Object;this._vertexOffset=new Object;this._onIndicesUpdatedDelegate=function(e){return n._onIndicesUpdated(e)};this._onVerticesUpdatedDelegate=function(e){return n._onVerticesUpdated(e)};this._pool=e;this._level=r;this._indexOffset=a;this.sourceEntity=t;this.materialOwner=i}Object.defineProperty(e.prototype,"overflow",{get:function(){if(this._indexDataDirty)this._updateIndexData();return this._overflow},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"numTriangles",{get:function(){return this._numTriangles},enumerable:true,configurable:true});e.prototype.getIndexData=function(){if(this._indexDataDirty)this._updateIndexData();return this._indexData};e.prototype.getVertexData=function(e){if(this._indexDataDirty)this._updateIndexData();if(this._pVertexDataDirty[e])this._updateVertexData(e);return this._vertexData[this._concatenateArrays?n.VERTEX_DATA:e]};e.prototype.getVertexOffset=function(e){if(this._indexDataDirty)this._updateIndexData();if(this._pVertexDataDirty[e])this._updateVertexData(e);return this._vertexOffset[e]};e.prototype.dispose=function(){this._pool.disposeItem(this.materialOwner);this._indexData.dispose();this._indexData=null;for(var e in this._vertexData){this._vertexData[e].dispose();this._vertexData[e]=null}if(this._overflow){this._overflow.dispose();this._overflow=null}};e.prototype.invalidateGeometry=function(){this._geometryDirty=true;if(this._level==0)this._indexDataDirty=true;if(this._overflow)this._overflow.invalidateGeometry()};e.prototype.invalidateIndexData=function(){this._indexDataDirty=true};e.prototype.invalidateVertexData=function(e){this._pVertexDataDirty[e]=true};e.prototype._pGetSubGeometry=function(){throw new r};e.prototype._iFillIndexData=function(e){if(this._geometryDirty)this._updateGeometry();this._indexData=o.getItem(this._subGeometry,this._level,e);this._numTriangles=this._indexData.data.length/3;e=this._indexData.offset;if(e<this._subGeometry.indices.length){if(!this._overflow)this._overflow=this._pGetOverflowRenderable(this._pool,this.materialOwner,e,this._level+1);this._overflow._iFillIndexData(e)}else if(this._overflow){this._overflow.dispose();this._overflow=null}};e.prototype._pGetOverflowRenderable=function(e,t,i,a){throw new r};e.prototype._updateGeometry=function(){if(this._subGeometry){if(this._level==0)this._subGeometry.removeEventListener(s.INDICES_UPDATED,this._onIndicesUpdatedDelegate);this._subGeometry.removeEventListener(s.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)}this._subGeometry=this._pGetSubGeometry();this._concatenateArrays=this._subGeometry.concatenateArrays;if(this._subGeometry){if(this._level==0)this._subGeometry.addEventListener(s.INDICES_UPDATED,this._onIndicesUpdatedDelegate);this._subGeometry.addEventListener(s.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)}this._geometryDirty=false};e.prototype._updateIndexData=function(){this._iFillIndexData(this._indexOffset);
this._indexDataDirty=false};e.prototype._updateVertexData=function(e){this._vertexOffset[e]=this._subGeometry.getOffset(e);if(this._subGeometry.concatenateArrays)e=a.VERTEX_DATA;this._vertexData[e]=l.getItem(this._subGeometry,this.getIndexData(),e);this._pVertexDataDirty[e]=false};e.prototype._onIndicesUpdated=function(e){this.invalidateIndexData()};e.prototype._onVerticesUpdated=function(e){this._concatenateArrays=e.target.concatenateArrays;this.invalidateVertexData(e.dataType)};return e}();t.exports=h},{"awayjs-core/lib/errors/AbstractMethodError":undefined,"awayjs-display/lib/base/SubGeometryBase":undefined,"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-display/lib/events/SubGeometryEvent":undefined,"awayjs-stagegl/lib/pool/IndexDataPool":undefined,"awayjs-stagegl/lib/pool/VertexDataPool":undefined}],"awayjs-renderergl/lib/pool/SkyboxRenderable":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/TriangleSubGeometry");var n=e("awayjs-renderergl/lib/pool/RenderableBase");var s=function(e){r(t,e);function t(t,i){e.call(this,t,i,i)}t.prototype._pGetSubGeometry=function(){var e=t._geometry;if(!e){e=t._geometry=new a(true);e.autoDeriveNormals=false;e.autoDeriveTangents=false;e.updateIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2));e.updatePositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1))}this._pVertexDataDirty[a.POSITION_DATA]=true;return e};t.id="skybox";return t}(n);t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/pool/RenderableBase":undefined}],"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-display/lib/base/TriangleSubGeometry");var n=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat");var s=e("awayjs-renderergl/lib/pool/RenderableBase");var o=function(e){r(t,e);function t(t,i,r,a){if(r===void 0){r=0}if(a===void 0){a=0}e.call(this,t,i.parentMesh,i,r,a);this.subMesh=i}t.prototype._pGetSubGeometry=function(){var e;if(this.subMesh.animator)e=this.subMesh.animator.getRenderableSubGeometry(this,this.subMesh.subGeometry);else e=this.subMesh.subGeometry;this._pVertexDataDirty[a.POSITION_DATA]=true;if(e.vertexNormals)this._pVertexDataDirty[a.NORMAL_DATA]=true;if(e.vertexTangents)this._pVertexDataDirty[a.TANGENT_DATA]=true;if(e.uvs)this._pVertexDataDirty[a.UV_DATA]=true;if(e.secondaryUVs)this._pVertexDataDirty[a.SECONDARY_UV_DATA]=true;if(e.jointIndices)this._pVertexDataDirty[a.JOINT_INDEX_DATA]=true;if(e.jointWeights)this._pVertexDataDirty[a.JOINT_WEIGHT_DATA]=true;switch(e.jointsPerVertex){case 1:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=n.FLOAT_1;break;case 2:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=n.FLOAT_2;break;case 3:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=n.FLOAT_3;break;case 4:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=n.FLOAT_4;break;default:}return e};t.prototype._pGetOverflowRenderable=function(e,i,r,a){return new t(e,i,r,a)};t.id="trianglesubmesh";return t}(s);t.exports=o},{"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/pool/RenderableBase":undefined,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":undefined}],"awayjs-renderergl/lib/tools/commands/Merge":[function(e,t,i){var r=e("awayjs-core/lib/geom/Matrix3DUtils");var a=e("awayjs-display/lib/base/Geometry");var n=e("awayjs-display/lib/base/TriangleSubGeometry");var s=e("awayjs-display/lib/entities/Mesh");var o=function(){function e(e,t,i){if(e===void 0){e=false}if(t===void 0){t=false}if(i===void 0){i=false}this._keepMaterial=e;this._disposeSources=t;this._objectSpace=i}Object.defineProperty(e.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(e){this._disposeSources=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(e){this._keepMaterial=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(e){this._objectSpace=e},enumerable:true,configurable:true});e.prototype.applyToContainer=function(e,t){this.reset();this.parseContainer(e,t);this.collect(e,false);this.merge(e,this._disposeSources)};e.prototype.applyToMeshes=function(e,t){this.reset();if(!t.length)return;for(var i=0;i<t.length;i++)if(t[i]!=e)this.collect(t[i],this._disposeSources);this.collect(e,false);this.merge(e,this._disposeSources)};e.prototype.apply=function(e,t){this.reset();this.collect(t,this._disposeSources);this.collect(e,false);this.merge(e,this._disposeSources)};e.prototype.reset=function(){this._toDispose=new Array;this._geomVOs=new Array};e.prototype.merge=function(e,t){var i;var r;var s;var o;var l;s=e.geometry;o=e.geometry=new a;r=e.subMeshes.length;l=this._geomVOs.length>1;for(i=0;i<this._geomVOs.length;i++){var h;var p;var u=new n(true);u.autoDeriveNormals=false;u.autoDeriveTangents=false;p=this._geomVOs[i];u.updateIndices(p.indices);u.updatePositions(p.vertices);u.updateVertexNormals(p.normals);u.updateVertexTangents(p.tangents);u.updateUVs(p.uvs);o.addSubGeometry(u);if(this._keepMaterial&&l)e.subMeshes[r].material=p.material}if(this._keepMaterial&&!l&&this._geomVOs.length)e.material=this._geomVOs[0].material;if(t){var d;var c=this._toDispose.length;for(var i;i<c;i++){d=this._toDispose[i];d.geometry.dispose();d.dispose()}s.dispose()}this._toDispose=null};e.prototype.collect=function(e,t){if(e.geometry){var i;var a=e.geometry.subGeometries;var n;for(i=0;i<a.length;i++){var s;var o;var l,h,p,u,d;var c;var f;var _;var g;var m;var y;var v,b,x,w;f=a[i];v=f.positions;b=f.vertexNormals;x=f.vertexTangents;w=f.uvs;_=this.getSubGeomData(e.subMeshes[i].material||e.material);g=this._objectSpace?_.vertices:new Array;m=this._objectSpace?_.normals:new Array;y=this._objectSpace?_.tangents:new Array;h=g.length;p=m.length;u=y.length;d=_.uvs.length;o=f.numVertices;for(s=0;s<o;s++){n=s*3;g[h++]=v[n];g[h++]=v[n+1];g[h++]=v[n+2];m[p++]=b[n];m[p++]=b[n+1];m[p++]=b[n+2];y[u++]=x[n];y[u++]=x[n+1];y[u++]=x[n+2];_.uvs[d++]=w[s*2];_.uvs[d++]=w[s*2+1]}c=!this._objectSpace?_.vertices.length/3:0;l=_.indices.length;o=f.numTriangles;for(s=0;s<o;s++){n=s*3;_.indices[l++]=f.indices[n]+c;_.indices[l++]=f.indices[n+1]+c;_.indices[l++]=f.indices[n+2]+c}if(!this._objectSpace){e.sceneTransform.transformVectors(g,g);r.deltaTransformVectors(e.sceneTransform,m,m);r.deltaTransformVectors(e.sceneTransform,y,y);h=_.vertices.length;p=_.normals.length;u=_.tangents.length;o=g.length;for(s=0;s<o;s++){_.vertices[h++]=g[s];_.normals[p++]=m[s];_.tangents[u++]=y[s]}}}if(t)this._toDispose.push(e)}};e.prototype.getSubGeomData=function(e){var t;if(this._keepMaterial){var i;var r;r=this._geomVOs.length;for(i=0;i<r;i++){if(this._geomVOs[i].material==e){t=this._geomVOs[i];break}}}else if(this._geomVOs.length){t=this._geomVOs[0]}if(!t){t=new l;t.vertices=new Array;t.normals=new Array;t.tangents=new Array;t.uvs=new Array;t.indices=new Array;t.material=e;this._geomVOs.push(t)}return t};e.prototype.parseContainer=function(e,t){var i;var r;if(t instanceof s&&t!=e)this.collect(t,this._disposeSources);for(r=0;r<t.numChildren;++r){i=t.getChildAt(r);this.parseContainer(e,i)}};return e}();var l=function(){function e(){}return e}();t.exports=o},{"awayjs-core/lib/geom/Matrix3DUtils":undefined,"awayjs-display/lib/base/Geometry":undefined,"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-display/lib/entities/Mesh":undefined}],"awayjs-renderergl/lib/tools/data/ParticleGeometryTransform":[function(e,t,i){var r=function(){function e(){}Object.defineProperty(e.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(e){this._defaultVertexTransform=e;this._defaultInvVertexTransform=e.clone();this._defaultInvVertexTransform.invert();this._defaultInvVertexTransform.transpose()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(e){this._defaultUVTransform=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:true,configurable:true});return e}();t.exports=r},{}],"awayjs-renderergl/lib/utils/ParticleGeometryHelper":[function(e,t,i){var r=e("awayjs-core/lib/geom/Point");var a=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-display/lib/base/TriangleSubGeometry");var s=e("awayjs-renderergl/lib/animators/data/ParticleData");var o=e("awayjs-renderergl/lib/base/ParticleGeometry");var l=function(){function e(){}e.generateGeometry=function(t,i){if(i===void 0){i=null}var l=new Array;var h=new Array;var p=new Array;var u=new Array;var d=new Array;var c=new Array;var f=new Array;var _=new Array;var g=t.length;var m;var y;var v;var b;var x;var w;var P;var C;var D;var T;var S;var O;var A=new Array;var R=new a;var j=new a;var V=new a;var I=new r;for(S=0;S<g;S++){m=t[S].subGeometries;v=m.length;for(var N=0;N<v;N++){if(A.length<=N){A.push(_.length);l.push(new Array);h.push(new Array);p.push(new Array);u.push(new Array);d.push(new Array);_.push(new n(true));c.push(0)}y=m[N];if(y.numVertices+c[A[N]]>e.MAX_VERTEX){A[N]=_.length;l.push(new Array);h.push(new Array);p.push(new Array);u.push(new Array);d.push(new Array);_.push(new n(true));c.push(0)}O=A[N];b=l[O];x=h[O];w=p[O];P=u[O];C=d[O];D=c[O];T=_[O];var L=new s;L.numVertices=y.numVertices;L.startVertexIndex=D;L.particleIndex=S;L.subGeometry=T;f.push(L);c[O]+=y.numVertices;var M;var F;var E=y;var B;var z;var U;var G;var k;if(E){F=E.numVertices;E.numTriangles;z=E.positions;U=E.vertexNormals;G=E.vertexTangents;k=E.uvs;if(i){var X=i[S];var W=X.vertexTransform;var H=X.invVertexTransform;var Z=X.UVTransform;for(M=0;M<F;M++){B=M*3;R.x=z[B];R.y=z[B+1];R.z=z[B+2];j.x=U[B];j.y=U[B+1];j.z=U[B+2];V.x=G[B];V.y=G[B+1];V.z=G[B+2];I.x=k[M*2];I.y=k[M*2+1];if(W){R=W.transformVector(R);j=H.deltaTransformVector(j);V=H.deltaTransformVector(j)}if(Z)I=Z.transformPoint(I);z.push(R.x,R.y,R.z);U.push(j.x,j.y,j.z);G.push(V.x,V.y,V.z);k.push(I.x,I.y)}}else{for(M=0;M<F;M++){B=M*3;x.push(z[B],z[B+1],z[B+2]);w.push(U[B],U[B+1],U[B+2]);P.push(G[B],G[B+1],G[B+2]);C.push(k[M*2],k[M*2+1])}}}else{}var q=y.indices;F=y.numTriangles;for(M=0;M<F;M++){B=M*3;b.push(q[B]+D,q[B+1]+D,q[B+2]+D)}}}var Y=new o;Y.particles=f;Y.numParticles=g;g=_.length;for(S=0;S<g;S++){T=_[S];T.autoDeriveNormals=false;T.autoDeriveTangents=false;T.updateIndices(l[S]);T.updatePositions(h[S]);T.updateVertexNormals(p[S]);T.updateVertexTangents(u[S]);T.updateUVs(d[S]);Y.addSubGeometry(T)}return Y};e.MAX_VERTEX=65535;return e}();t.exports=l},{"awayjs-core/lib/geom/Point":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-display/lib/base/TriangleSubGeometry":undefined,"awayjs-renderergl/lib/animators/data/ParticleData":undefined,"awayjs-renderergl/lib/base/ParticleGeometry":undefined}],"awayjs-renderergl/lib/utils/PerspectiveMatrix3D":[function(e,t,i){var r=this.__extends||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};var a=e("awayjs-core/lib/geom/Matrix3D");var n=function(e){r(t,e);function t(t){if(t===void 0){t=null}e.call(this,t)}t.prototype.perspectiveFieldOfViewLH=function(e,t,i,r){var a=1/Math.tan(e/2);var n=a/t;this.copyRawDataFrom([n,0,0,0,0,a,0,0,0,0,r/(r-i),1,0,0,i*r/(i-r),0])};return t}(a);t.exports=n},{"awayjs-core/lib/geom/Matrix3D":undefined}],"awayjs-renderergl/lib/utils/ShaderCompilerHelper":[function(e,t,i){var r=e("awayjs-stagegl/lib/base/ContextGLTextureFormat");var a=function(){function e(){}e.getTex2DSampleCode=function(t,i,r,a,n,s,o,l,h){if(l===void 0){l=null}if(h===void 0){h=null}var p=h||(s?"wrap":"clamp");var u=e.getFormatStringForTexture(a);var d=o&&a.hasMipmaps;var c=n?d?"linear,miplinear":"linear":d?"nearest,mipnearest":"nearest";if(l==null)l=i.uvVarying;return"tex "+t+", "+l+", "+r+" <2d,"+c+","+u+p+">\n"};e.getTexCubeSampleCode=function(t,i,r,a,n,s){var o;var l=e.getFormatStringForTexture(r);var h=n&&r.hasMipmaps;var o=a?h?"linear,miplinear":"linear":h?"nearest,mipnearest":"nearest";return"tex "+t+", "+s+", "+i+" <cube,"+l+o+">\n"};e.getFormatStringForTexture=function(e){switch(e.format){case r.COMPRESSED:return"dxt1,";break;case r.COMPRESSED_ALPHA:return"dxt5,";break;default:return""}};return e}();t.exports=a},{"awayjs-stagegl/lib/base/ContextGLTextureFormat":undefined}]},{},[]);
//# sourceMappingURL=awayjs-renderergl.min.js.map