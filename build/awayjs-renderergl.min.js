require=function e(t,i,r){function a(n,o){if(!i[n]){if(!t[n]){var l="function"==typeof require&&require;if(!o&&l)return l(n,!0);if(s)return s(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var p=i[n]={exports:{}};t[n][0].call(p.exports,function(e){var i=t[n][1][e];return a(i?i:e)},p,p.exports,e,t,i,r)}return i[n].exports}for(var s="function"==typeof require&&require,n=0;n<r.length;n++)a(r[n]);return a}({"awayjs-renderergl/lib/animators/AnimationSetBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=e("awayjs-core/lib/errors/AbstractMethodError"),n=e("awayjs-renderergl/lib/errors/AnimationSetError"),o=function(e){function t(){e.call(this),this._animations=new Array,this._animationNames=new Array,this._animationDictionary=new Object}return i(t,e),t.prototype._pFindTempReg=function(e,t){void 0===t&&(t=null);for(var i,r=0;;){if(i="vt"+r,-1==e.indexOf(i)&&t!=i)return i;++r}return null},Object.defineProperty(t.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:!0,configurable:!0}),t.prototype.resetGPUCompatibility=function(){this._usesCPU=!1},t.prototype.cancelGPUCompatibility=function(){this._usesCPU=!0},t.prototype.getAGALVertexCode=function(){throw new s},t.prototype.activate=function(){throw new s},t.prototype.deactivate=function(){throw new s},t.prototype.getAGALFragmentCode=function(){throw new s},t.prototype.getAGALUVCode=function(){throw new s},t.prototype.doneAGALCode=function(){throw new s},Object.defineProperty(t.prototype,"assetType",{get:function(){return r.ANIMATION_SET},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),t.prototype.hasAnimation=function(e){return null!=this._animationDictionary[e]},t.prototype.getAnimation=function(e){return this._animationDictionary[e]},t.prototype.addAnimation=function(e){if(this._animationDictionary[e.name])throw new n("root node name '"+e.name+"' already exists in the set");this._animationDictionary[e.name]=e,this._animations.push(e),this._animationNames.push(e.name)},t.prototype.dispose=function(){},t}(a);t.exports=o},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-renderergl/lib/errors/AnimationSetError":void 0}],"awayjs-renderergl/lib/animators/AnimatorBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=e("awayjs-core/lib/errors/AbstractMethodError"),n=e("awayjs-core/lib/utils/RequestAnimationFrame"),o=e("awayjs-core/lib/utils/getTimer"),l=e("awayjs-renderergl/lib/events/AnimatorEvent"),h=function(e){function t(t){e.call(this),this._autoUpdate=!0,this._time=0,this._playbackSpeed=1,this._pOwners=new Array,this._pAbsoluteTime=0,this._animationStates=new Object,this.updatePosition=!0,this._pAnimationSet=t,this._broadcaster=new n(this.onEnterFrame,this)}return i(t,e),t.prototype.getAnimationState=function(e){var t=e.stateClass,i=e.id;return null==this._animationStates[i]&&(this._animationStates[i]=new t(this,e)),this._animationStates[i]},t.prototype.getAnimationStateByName=function(e){return this.getAnimationState(this._pAnimationSet.getAnimation(e))},Object.defineProperty(t.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){this._autoUpdate!=e&&(this._autoUpdate=e,this._autoUpdate?this.start():this.stop())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(e){this._time!=e&&this.update(e)},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._pActiveState.phase(e)},Object.defineProperty(t.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(e){this._playbackSpeed=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(){throw new s},t.prototype.start=function(){!this._isPlaying&&this._autoUpdate&&(this._time=this._pAbsoluteTime=o(),this._isPlaying=!0,this._broadcaster.start(),this.hasEventListener(l.START)&&(null==this._startEvent&&(this._startEvent=new l(l.START,this)),this.dispatchEvent(this._startEvent)))},t.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._broadcaster.stop(),this.hasEventListener(l.STOP)&&(null==this._stopEvent&&(this._stopEvent=new l(l.STOP,this)),this.dispatchEvent(this._stopEvent)))},t.prototype.update=function(e){var t=(e-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(t),this._time=e},t.prototype.reset=function(e,t){void 0===t&&(t=0),this.getAnimationState(this._pAnimationSet.getAnimation(e)).offset(t+this._pAbsoluteTime)},t.prototype.addOwner=function(e){this._pOwners.push(e)},t.prototype.removeOwner=function(e){this._pOwners.splice(this._pOwners.indexOf(e),1)},t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e,this._pActiveState.update(this._pAbsoluteTime),this.updatePosition&&this.applyPositionDelta()},t.prototype.onEnterFrame=function(e){void 0===e&&(e=null),this.update(o())},t.prototype.applyPositionDelta=function(){var e,t=this._pActiveState.positionDelta,i=t.length;if(i>0){e=this._pOwners.length;for(var r=0;e>r;++r)this._pOwners[r].translateLocal(t,i)}},t.prototype.dispatchCycleEvent=function(){this.hasEventListener(l.CYCLE_COMPLETE)&&(null==this._cycleEvent&&(this._cycleEvent=new l(l.CYCLE_COMPLETE,this)),this.dispatchEvent(this._cycleEvent))},t.prototype.clone=function(){throw new s},t.prototype.dispose=function(){},t.prototype.testGPUCompatibility=function(){throw new s},Object.defineProperty(t.prototype,"assetType",{get:function(){return r.ANIMATOR},enumerable:!0,configurable:!0}),t.prototype.getRenderableSubGeometry=function(e,t){return t},t}(a);t.exports=h},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-core/lib/utils/RequestAnimationFrame":void 0,"awayjs-core/lib/utils/getTimer":void 0,"awayjs-renderergl/lib/events/AnimatorEvent":void 0}],"awayjs-renderergl/lib/animators/ParticleAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/AnimationSetBase"),a=e("awayjs-renderergl/lib/animators/data/AnimationRegisterCache"),s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry"),n=e("awayjs-renderergl/lib/animators/data/ParticleAnimationData"),o=e("awayjs-renderergl/lib/animators/data/ParticleProperties"),l=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),h=e("awayjs-renderergl/lib/animators/nodes/ParticleTimeNode"),p=function(e){function t(t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),e.call(this),this._animationSubGeometries=new Object,this._particleNodes=new Array,this._localDynamicNodes=new Array,this._localStaticNodes=new Array,this._totalLenOfOneVertex=0,this.addAnimation(this._timeNode=new h(t,i,r))}return i(t,e),Object.defineProperty(t.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:!0,configurable:!0}),t.prototype.addAnimation=function(t){var i,r=t;for(r._iProcessAnimationSetting(this),r.mode==l.LOCAL_STATIC?(r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength,this._localStaticNodes.push(r)):r.mode==l.LOCAL_DYNAMIC&&this._localDynamicNodes.push(r),i=this._particleNodes.length-1;i>=0&&!(this._particleNodes[i].priority<=r.priority);i--);this._particleNodes.splice(i+1,0,r),e.prototype.addAnimation.call(this,t)},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALVertexCode=function(e){this._iAnimationRegisterCache=e.animationRegisterCache,null==this._iAnimationRegisterCache&&(this._iAnimationRegisterCache=e.animationRegisterCache=new a(e.profile)),this._iAnimationRegisterCache.vertexConstantOffset=e.numUsedVertexConstants,this._iAnimationRegisterCache.vertexAttributesOffset=e.numUsedStreams,this._iAnimationRegisterCache.varyingsOffset=e.numUsedVaryings,this._iAnimationRegisterCache.fragmentConstantOffset=e.numUsedFragmentConstants,this._iAnimationRegisterCache.hasUVNode=this.hasUVNode,this._iAnimationRegisterCache.needVelocity=this.needVelocity,this._iAnimationRegisterCache.hasBillboard=this.hasBillboard,this._iAnimationRegisterCache.sourceRegisters=e.animatableAttributes,this._iAnimationRegisterCache.targetRegisters=e.animationTargetRegisters,this._iAnimationRegisterCache.needFragmentAnimation=e.usesFragmentAnimation,this._iAnimationRegisterCache.needUVAnimation=!e.usesUVTransform,this._iAnimationRegisterCache.hasColorAddNode=this.hasColorAddNode,this._iAnimationRegisterCache.hasColorMulNode=this.hasColorMulNode,this._iAnimationRegisterCache.reset();var i="";i+=this._iAnimationRegisterCache.getInitCode();var r,s;for(s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority<t.POST_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));for(i+=this._iAnimationRegisterCache.getCombinationCode(),s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority>=t.POST_PRIORITY&&r.priority<t.COLOR_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));for(i+=this._iAnimationRegisterCache.initColorRegisters(),s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority>=t.COLOR_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));return i+=this._iAnimationRegisterCache.getColorPassCode()},t.prototype.getAGALUVCode=function(e){var t="";if(this.hasUVNode){this._iAnimationRegisterCache.setUVSourceAndTarget(e.uvSource,e.uvTarget),t+="mov "+this._iAnimationRegisterCache.uvTarget+".xy,"+this._iAnimationRegisterCache.uvAttribute.toString()+"\n";for(var i,r=0;r<this._particleNodes.length;r++)i=this._particleNodes[r];t+=i.getAGALUVCode(e,this._iAnimationRegisterCache),t+="mov "+this._iAnimationRegisterCache.uvVar.toString()+","+this._iAnimationRegisterCache.uvTarget+".xy\n"}else t+="mov "+e.uvTarget+","+e.uvSource+"\n";return t},t.prototype.getAGALFragmentCode=function(e,t){return this._iAnimationRegisterCache.getColorCombinationCode(t)},t.prototype.doneAGALCode=function(){this._iAnimationRegisterCache.setDataLength(),this._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index,0,1,2,0)},Object.defineProperty(t.prototype,"usesCPU",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.cancelGPUCompatibility=function(){},t.prototype.dispose=function(){for(var t in this._animationSubGeometries)this._animationSubGeometries[t].dispose();e.prototype.dispose.call(this)},t.prototype.getAnimationSubGeometry=function(e){var t=e.parentMesh,i=t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id];return i?i:(this._iGenerateAnimationSubGeometries(t),t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id])},t.prototype._iGenerateAnimationSubGeometries=function(e){if(null==this.initParticleFunc)throw new Error("no initParticleFunc set");var t=e.geometry;if(!t)throw new Error("Particle animation can only be performed on a ParticleGeometry object");var i,r,a,l,h,p,d,c=!1;for(i=0;i<e.subMeshes.length;i++)p=e.subMeshes[i],h=p.subGeometry,e.shareAnimationGeometry&&(l=this._animationSubGeometries[h.id])||(l=new s,e.shareAnimationGeometry?this._animationSubGeometries[h.id]=l:this._animationSubGeometries[p.id]=l,c=!0,l.createVertexData(h.numVertices,this._totalLenOfOneVertex));if(c){var u,_,g,m,y,f,b,x,v,w,P,C=t.particles,T=C.length,D=t.numParticles,S=new o;for(S.total=D,S.startTime=0,S.duration=1e3,S.delay=.1,i=0,r=0;D>i;){for(S.index=i,this.initParticleFunc.call(this.initParticleScope,S),a=0;a<this._localStaticNodes.length;a++)this._localStaticNodes[a]._iGeneratePropertyOfOneParticle(S);for(;T>r&&(u=C[r]).particleIndex==i;){for(a=0;a<e.subMeshes.length;a++)if(p=e.subMeshes[a],p.subGeometry==u.subGeometry){l=e.shareAnimationGeometry?this._animationSubGeometries[p.subGeometry.id]:this._animationSubGeometries[p.id];break}for(b=u.numVertices,x=l.vertexData,v=b*this._totalLenOfOneVertex,w=l.numProcessedVertices*this._totalLenOfOneVertex,a=0;a<this._localStaticNodes.length;a++)for(d=this._localStaticNodes[a],f=d.oneData,_=d.dataLength,g=w+d._iDataOffset,m=0;v>m;m+=this._totalLenOfOneVertex)for(P=g+m,y=0;_>y;y++)x[P+y]=f[y];this._localDynamicNodes.length&&l.animationParticles.push(new n(i,S.startTime,S.duration,S.delay,u)),l.numProcessedVertices+=b,r++}i++}}},t.POST_PRIORITY=9,t.COLOR_PRIORITY=18,t}(r);t.exports=p},{"awayjs-renderergl/lib/animators/AnimationSetBase":void 0,"awayjs-renderergl/lib/animators/data/AnimationRegisterCache":void 0,"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticleAnimationData":void 0,"awayjs-renderergl/lib/animators/data/ParticleProperties":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":void 0}],"awayjs-renderergl/lib/animators/ParticleAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLProgramType"),a=e("awayjs-renderergl/lib/animators/AnimatorBase"),s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry"),n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=function(e){function t(t){e.call(this,t),this._animationParticleStates=new Array,this._animatorParticleStates=new Array,this._timeParticleStates=new Array,this._totalLenOfOneVertex=0,this._animatorSubGeometries=new Object,this._particleAnimationSet=t;for(var i,r,a=0;a<this._particleAnimationSet.particleNodes.length;a++)r=this._particleAnimationSet.particleNodes[a],i=this.getAnimationState(r),r.mode==n.LOCAL_DYNAMIC?(this._animatorParticleStates.push(i),r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength):this._animationParticleStates.push(i),i.needUpdateTime&&this._timeParticleStates.push(i)}return i(t,e),t.prototype.clone=function(){return new t(this._particleAnimationSet)},t.prototype.setRenderState=function(e,t,i,a){var s,n=this._particleAnimationSet._iAnimationRegisterCache,o=t.subMesh;if(!o)throw new Error("Must be subMesh");var l=this._particleAnimationSet.getAnimationSubGeometry(o);for(s=0;s<this._animationParticleStates.length;s++)this._animationParticleStates[s].setRenderState(i,t,l,n,a);var h=this.getAnimatorSubGeometry(o);for(s=0;s<this._animatorParticleStates.length;s++)this._animatorParticleStates[s].setRenderState(i,t,h,n,a);i.context.setProgramConstantsFromArray(r.VERTEX,n.vertexConstantOffset,n.vertexConstantData,n.numVertexConstant),n.numFragmentConstant>0&&i.context.setProgramConstantsFromArray(r.FRAGMENT,n.fragmentConstantOffset,n.fragmentConstantData,n.numFragmentConstant)},t.prototype.testGPUCompatibility=function(){},t.prototype.start=function(){e.prototype.start.call(this);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime)},t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e;for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].update(this._pAbsoluteTime)},t.prototype.resetTime=function(e){void 0===e&&(e=0);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime+e);this.update(this.time)},t.prototype.dispose=function(){for(var e in this._animatorSubGeometries)this._animatorSubGeometries[e].dispose()},t.prototype.getAnimatorSubGeometry=function(e){if(this._animatorParticleStates.length){var t=e.subGeometry,i=this._animatorSubGeometries[t.id]=new s;i.createVertexData(t.numVertices,this._totalLenOfOneVertex),i.animationParticles=this._particleAnimationSet.getAnimationSubGeometry(e).animationParticles}},t}(a);t.exports=o},{"awayjs-renderergl/lib/animators/AnimatorBase":void 0,"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/animators/SkeletonAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/AnimationSetBase"),a=function(e){function t(t){void 0===t&&(t=4),e.call(this),this._jointsPerVertex=t}return i(t,e),Object.defineProperty(t.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(e){for(var t=e.animatableAttributes.length,i=e.numUsedVertexConstants,r=i+1,a=i+2,s="va"+e.numUsedStreams,n="va"+(e.numUsedStreams+1),o=[s+".x",s+".y",s+".z",s+".w"],l=[n+".x",n+".y",n+".z",n+".w"],h=this._pFindTempReg(e.animationTargetRegisters),p=this._pFindTempReg(e.animationTargetRegisters,h),d="dp4",c="",u=0;t>u;++u){for(var _=e.animatableAttributes[u],g=0;g<this._jointsPerVertex;++g)c+=d+" "+h+".x, "+_+", vc["+o[g]+"+"+i+"]\n"+d+" "+h+".y, "+_+", vc["+o[g]+"+"+r+"]\n"+d+" "+h+".z, "+_+", vc["+o[g]+"+"+a+"]\nmov "+h+".w, "+_+".w\nmul "+h+", "+h+", "+l[g]+"\n",c+=0==g?"mov "+p+", "+h+"\n":"add "+p+", "+p+", "+h+"\n";d="dp3",c+="mov "+e.animationTargetRegisters[u]+", "+p+"\n"}return c},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"},t.prototype.doneAGALCode=function(){},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/AnimationSetBase":void 0}],"awayjs-renderergl/lib/animators/SkeletonAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-display/lib/events/SubGeometryEvent"),s=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/animators/AnimatorBase"),o=e("awayjs-renderergl/lib/animators/data/JointPose"),l=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),h=e("awayjs-renderergl/lib/events/AnimationStateEvent"),p=function(e){function t(t,i,r){var a=this;void 0===r&&(r=!1),e.call(this,t),this._globalPose=new l,this._morphedSubGeometry=new Object,this._morphedSubGeometryDirty=new Object,this._skeleton=i,this._forceCPU=r,this._jointsPerVertex=t.jointsPerVertex,this._numJoints=this._skeleton.numJoints,this._globalMatrices=new Array(12*this._numJoints);for(var s=0,n=0;n<this._numJoints;++n)this._globalMatrices[s++]=1,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=1,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=1,this._globalMatrices[s++]=0;this._onTransitionCompleteDelegate=function(e){return a.onTransitionComplete(e)},this._onIndicesUpdateDelegate=function(e){return a.onIndicesUpdate(e)},this._onVerticesUpdateDelegate=function(e){return a.onVerticesUpdate(e)}}return i(t,e),Object.defineProperty(t.prototype,"globalMatrices",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalMatrices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalPose",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalPose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(e){this._useCondensedIndices=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this._pAnimationSet,this._skeleton,this._forceCPU)},t.prototype.play=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=0/0),this._pActiveAnimationName!=e){if(this._pActiveAnimationName=e,!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");t&&this._pActiveNode?(this._pActiveNode=t.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(e),this._pAbsoluteTime),this._pActiveNode.addEventListener(h.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)):this._pActiveNode=this._pAnimationSet.getAnimation(e),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeSkeletonState=this._pActiveState,this.start(),isNaN(i)||this.reset(e,i)}},t.prototype.setRenderState=function(e,t,i,a,n,o){this._globalPropertiesDirty&&this.updateGlobalProperties();var l=t.subMesh.subGeometry;if(l.useCondensedIndices=this._useCondensedIndices,this._useCondensedIndices)this.updateCondensedMatrices(l.condensedIndexLookUp,l.numCondensedJoints),i.context.setProgramConstantsFromArray(s.VERTEX,n,this._condensedMatrices,3*l.numCondensedJoints);else{if(this._pAnimationSet.usesCPU)return void(this._morphedSubGeometryDirty[l.id]&&this.morphSubGeometry(t,l));i.context.setProgramConstantsFromArray(s.VERTEX,n,this._globalMatrices,3*this._numJoints)}i.activateBuffer(o,t.getVertexData(r.JOINT_INDEX_DATA),t.getVertexOffset(r.JOINT_INDEX_DATA),t.JOINT_INDEX_FORMAT),i.activateBuffer(o+1,t.getVertexData(r.JOINT_WEIGHT_DATA),t.getVertexOffset(r.JOINT_WEIGHT_DATA),t.JOINT_WEIGHT_FORMAT)},t.prototype.testGPUCompatibility=function(e){!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||e.numUsedVertexConstants+3*this._numJoints>128)&&this._pAnimationSet.cancelGPUCompatibility()},t.prototype._pUpdateDeltaTime=function(t){if(e.prototype._pUpdateDeltaTime.call(this,t),this._globalPropertiesDirty=!0,this._pAnimationSet.usesCPU)for(var i in this._morphedSubGeometryDirty)this._morphedSubGeometryDirty[i]=!0},t.prototype.updateCondensedMatrices=function(e,t){var i,r,a=0,s=0;this._condensedMatrices=new Array;do for(r=4*e[a],i=r+12;i>r;)this._condensedMatrices[s++]=this._globalMatrices[r++];while(++a<t)},t.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=!1,this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);for(var e,t,i,r,a,s,n,o,l,h,p,d,c,u,_,g,m,y,f,b,x,v,w,P,C,T,D,S,O,A,R,j,V,I,N,L,M=0,F=this._globalPose.jointPoses,E=this._skeleton.joints,B=0;B<this._numJoints;++B)V=F[B],I=V.orientation,N=V.translation,t=I.x,i=I.y,r=I.z,a=I.w,s=(L=2*t)*i,n=L*r,o=L*a,l=(L=2*i)*r,h=L*a,p=2*r*a,l=2*i*r,h=2*i*a,p=2*r*a,t*=t,i*=i,r*=r,a*=a,d=(L=t-i)-r+a,c=s-p,u=n+h,_=s+p,g=-L-r+a,m=l-o,y=n-h,f=l+o,b=-t-i+r+a,e=E[B].inverseBindPose,x=e[0],v=e[4],w=e[8],P=e[12],C=e[1],T=e[5],D=e[9],S=e[13],O=e[2],A=e[6],R=e[10],j=e[14],this._globalMatrices[M]=d*x+c*C+u*O,this._globalMatrices[M+1]=d*v+c*T+u*A,this._globalMatrices[M+2]=d*w+c*D+u*R,this._globalMatrices[M+3]=d*P+c*S+u*j+N.x,this._globalMatrices[M+4]=_*x+g*C+m*O,this._globalMatrices[M+5]=_*v+g*T+m*A,this._globalMatrices[M+6]=_*w+g*D+m*R,this._globalMatrices[M+7]=_*P+g*S+m*j+N.y,this._globalMatrices[M+8]=y*x+f*C+b*O,this._globalMatrices[M+9]=y*v+f*T+b*A,this._globalMatrices[M+10]=y*w+f*D+b*R,this._globalMatrices[M+11]=y*P+f*S+b*j+N.z,M+=12},t.prototype.getRenderableSubGeometry=function(e,t){if(this._morphedSubGeometryDirty[t.id]=!0,!this._pAnimationSet.usesCPU)return t;var i;return(i=this._morphedSubGeometry[t.id])||(i=this._morphedSubGeometry[t.id]=t.clone(),i.autoDeriveNormals=!1,i.autoDeriveTangents=!1,i.autoDeriveUVs=!1,t.addEventListener(a.INDICES_UPDATED,this._onIndicesUpdateDelegate),t.addEventListener(a.VERTICES_UPDATED,this._onVerticesUpdateDelegate)),i},t.prototype.morphSubGeometry=function(e,t){this._morphedSubGeometryDirty[t.id]=!1;for(var i,r,a,s,n,o,l,h,p,d,c,u,_,g,m,y,f,b,x,v,w,P,C,T,D,S,O,A,R,j,V,I,N=t.positions,L=t.vertexNormals,M=t.vertexTangents,F=t.jointIndices,E=t.jointWeights,B=this._morphedSubGeometry[t.id],z=B.positions,U=B.vertexNormals,G=B.vertexTangents,k=0,X=0,W=N.length;W>k;){for(u=N[k],_=N[k+1],g=N[k+2],m=L[k],y=L[k+1],f=L[k+2],b=M[k],x=M[k+1],v=M[k+2],r=0,a=0,s=0,n=0,o=0,l=0,h=0,p=0,d=0,i=0;i<this._jointsPerVertex;)if(c=E[X],c>0){var H=F[X++]<<2;w=this._globalMatrices[H],P=this._globalMatrices[H+1],C=this._globalMatrices[H+2],T=this._globalMatrices[H+3],D=this._globalMatrices[H+4],S=this._globalMatrices[H+5],O=this._globalMatrices[H+6],A=this._globalMatrices[H+7],R=this._globalMatrices[H+8],j=this._globalMatrices[H+9],V=this._globalMatrices[H+10],I=this._globalMatrices[H+11],r+=c*(w*u+P*_+C*g+T),a+=c*(D*u+S*_+O*g+A),s+=c*(R*u+j*_+V*g+I),n+=c*(w*m+P*y+C*f),o+=c*(D*m+S*y+O*f),l+=c*(R*m+j*y+V*f),h+=c*(w*b+P*x+C*v),p+=c*(D*b+S*x+O*v),d+=c*(R*b+j*x+V*v),++i}else X+=this._jointsPerVertex-i,i=this._jointsPerVertex;z[k]=r,z[k+1]=a,z[k+2]=s,U[k]=n,U[k+1]=o,U[k+2]=l,G[k]=h,G[k+1]=p,G[k+2]=d,k+=3}B.updatePositions(z),B.updateVertexNormals(U),B.updateVertexTangents(G)},t.prototype.localToGlobalPose=function(e,t,i){var r,a,s,n,l,h,p,d,c,u,_,g,m,y,f,b,x,v,w,P,C=t.jointPoses,T=i.joints,D=e.numJointPoses,S=e.jointPoses;C.length!=D&&(C.length=D);for(var O=0;D>O;++O)r=C[O],null==r&&(r=C[O]=new o),s=T[O],a=s.parentIndex,l=S[O],c=r.orientation,d=r.translation,0>a?(p=l.translation,h=l.orientation,c.x=h.x,c.y=h.y,c.z=h.z,c.w=h.w,d.x=p.x,d.y=p.y,d.z=p.z):(n=C[a],h=n.orientation,p=l.translation,y=h.x,f=h.y,b=h.z,x=h.w,v=p.x,w=p.y,P=p.z,m=-y*v-f*w-b*P,u=x*v+f*P-b*w,_=x*w-y*P+b*v,g=x*P+y*w-f*v,p=n.translation,d.x=-m*y+u*x-_*b+g*f+p.x,d.y=-m*f+u*b+_*x-g*y+p.y,d.z=-m*b-u*f+_*y+g*x+p.z,u=h.x,_=h.y,g=h.z,m=h.w,h=l.orientation,y=h.x,f=h.y,b=h.z,x=h.w,c.w=m*x-u*y-_*f-g*b,c.x=m*y+u*x+_*b-g*f,c.y=m*f-u*b+_*x+g*y,c.z=m*b+u*f-_*y+g*x)},t.prototype.onTransitionComplete=function(e){e.type==h.TRANSITION_COMPLETE&&(e.animationNode.removeEventListener(h.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate),this._pActiveState==e.animationState&&(this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName),this._pActiveState=this.getAnimationState(this._pActiveNode),this._activeSkeletonState=this._pActiveState))},t.prototype.onIndicesUpdate=function(e){var t=e.target;this._morphedSubGeometry[t.id].updateIndices(t.indices)},t.prototype.onVerticesUpdate=function(e){var t=e.target,i=this._morphedSubGeometry[t.id];switch(e.dataType){case r.UV_DATA:i.updateUVs(t.uvs);case r.SECONDARY_UV_DATA:i.updateUVs(t.secondaryUVs)}},t}(n);t.exports=p},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/events/SubGeometryEvent":void 0,"awayjs-renderergl/lib/animators/AnimatorBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/animators/VertexAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/AnimationSetBase"),a=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode"),s=function(e){function t(t,i){void 0===t&&(t=2),void 0===i&&(i="absolute"),e.call(this),this._numPoses=t,this._blendMode=i}return i(t,e),Object.defineProperty(t.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(e){return this._blendMode==a.ABSOLUTE?this.getAbsoluteAGALCode(e):this.getAdditiveAGALCode(e)},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"},t.prototype.doneAGALCode=function(){},t.prototype.getAbsoluteAGALCode=function(e){var t="",i=this._pFindTempReg(e.animationTargetRegisters),r=this._pFindTempReg(e.animationTargetRegisters,i),a=new Array("x","y","z","w"),s=e.animatableAttributes.length,n="vc"+e.numUsedVertexConstants;s>2&&(s=2);for(var o=e.numUsedStreams,l=0;s>l;++l){t+="mul "+i+", "+e.animatableAttributes[l]+", "+n+"."+a[0]+"\n";for(var h=1;h<this._numPoses;++h)t+="mul "+r+", va"+o+", "+n+"."+a[h]+"\n",h<this._numPoses-1&&(t+="add "+i+", "+i+", "+r+"\n"),++o;t+="add "+e.animationTargetRegisters[l]+", "+i+", "+r+"\n"}return(e.tangentDependencies>0||e.outputsNormals)&&(t+="dp3 "+i+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\nmul "+i+", "+e.animationTargetRegisters[1]+", "+i+".x\nsub "+e.animationTargetRegisters[2]+", "+e.animationTargetRegisters[2]+", "+i+"\n"),t},t.prototype.getAdditiveAGALCode=function(e){var t,i="",r=e.animatableAttributes.length,a=["x","y","z","w"],s=this._pFindTempReg(e.animationTargetRegisters),n=e.numUsedStreams;r>2&&(r=2),i+="mov  "+e.animationTargetRegisters[0]+", "+e.animatableAttributes[0]+"\n",e.normalDependencies>0&&(i+="mov "+e.animationTargetRegisters[1]+", "+e.animatableAttributes[1]+"\n");for(var o=0;r>o;++o)for(var l=0;l<this._numPoses;++l)i+="mul "+s+", va"+(n+t)+", vc"+e.numUsedVertexConstants+"."+a[l]+"\nadd "+e.animationTargetRegisters[o]+", "+e.animationTargetRegisters[o]+", "+s+"\n",t++;return(e.tangentDependencies>0||e.outputsNormals)&&(i+="dp3 "+s+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\nmul "+s+", "+e.animationTargetRegisters[1]+", "+s+".x\nsub "+e.animationTargetRegisters[2]+", "+e.animatableAttributes[2]+", "+s+"\n"),i},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/AnimationSetBase":void 0,"awayjs-renderergl/lib/animators/data/VertexAnimationMode":void 0}],"awayjs-renderergl/lib/animators/VertexAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/base/ContextGLProgramType"),s=e("awayjs-stagegl/lib/pool/VertexDataPool"),n=e("awayjs-renderergl/lib/animators/AnimatorBase"),o=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode"),l=function(e){function t(t){e.call(this,t),this._poses=new Array,this._weights=Array(1,0,0,0),this._vertexAnimationSet=t,this._numPoses=t.numPoses,this._blendMode=t.blendMode}return i(t,e),t.prototype.clone=function(){return new t(this._vertexAnimationSet)
},t.prototype.play=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=0/0),this._pActiveAnimationName!=e){if(this._pActiveAnimationName=e,!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(e),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeVertexState=this._pActiveState,this.start(),isNaN(i)||this.reset(e,i)}},t.prototype._pUpdateDeltaTime=function(t){e.prototype._pUpdateDeltaTime.call(this,t);var i=!1;if(this._poses[0]!=this._activeVertexState.currentGeometry&&(this._poses[0]=this._activeVertexState.currentGeometry,i=!0),this._poses[1]!=this._activeVertexState.nextGeometry&&(this._poses[1]=this._activeVertexState.nextGeometry,i=!0),this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight),i)for(var r,a=this._pOwners.length,s=0;a>s;s++)r=this._pOwners[s],r._iInvalidateRenderableGeometries()},t.prototype.setRenderState=function(e,t,i,n,l,h){if(!this._poses.length)return void this.setNullPose(e,t,i,l,h);var p,d,c=t.subMesh,u=this._numPoses;for(i.context.setProgramConstantsFromArray(a.VERTEX,l,this._weights,1),d=this._blendMode==o.ABSOLUTE?1:0;u>d;++d)p=this._poses[d].subGeometries[c._iIndex]||c.subGeometry,i.activateBuffer(h++,s.getItem(p,t.getIndexData(),r.POSITION_DATA),p.getOffset(r.POSITION_DATA),r.POSITION_FORMAT),e.normalDependencies>0&&i.activateBuffer(h++,s.getItem(p,t.getIndexData(),r.NORMAL_DATA),p.getOffset(r.NORMAL_DATA),r.NORMAL_FORMAT)},t.prototype.setNullPose=function(e,t,i,s,n){if(i.context.setProgramConstantsFromArray(a.VERTEX,s,this._weights,1),this._blendMode==o.ABSOLUTE)for(var l=this._numPoses,h=1;l>h;++h)i.activateBuffer(n++,t.getVertexData(r.POSITION_DATA),t.getVertexOffset(r.POSITION_DATA),r.POSITION_FORMAT),e.normalDependencies>0&&i.activateBuffer(n++,t.getVertexData(r.NORMAL_DATA),t.getVertexOffset(r.NORMAL_DATA),r.NORMAL_FORMAT)},t.prototype.testGPUCompatibility=function(){},t.prototype.getRenderableSubGeometry=function(e,t){return this._blendMode==o.ABSOLUTE&&this._poses.length?this._poses[0].subGeometries[e.subMesh._iIndex]||t:t},t}(n);t.exports=l},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/animators/AnimatorBase":void 0,"awayjs-renderergl/lib/animators/data/VertexAnimationMode":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/pool/VertexDataPool":void 0}],"awayjs-renderergl/lib/animators/data/AnimationRegisterCache":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/compilation/ShaderRegisterCache"),a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),s=function(e){function t(t){e.call(this,t),this.indexDictionary=new Object,this.vertexConstantData=new Array,this.fragmentConstantData=new Array}return i(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.rotationRegisters=new Array,this.positionAttribute=this.getRegisterFromString(this.sourceRegisters[0]),this.scaleAndRotateTarget=this.getRegisterFromString(this.targetRegisters[0]),this.addVertexTempUsages(this.scaleAndRotateTarget,1);for(var t=1;t<this.targetRegisters.length;t++)this.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[t])),this.addVertexTempUsages(this.rotationRegisters[t-1],1);if(this.scaleAndRotateTarget=new a(this.scaleAndRotateTarget.regName,this.scaleAndRotateTarget.index),this.vertexZeroConst=this.getFreeVertexConstant(),this.vertexZeroConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,0),this.vertexOneConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,1),this.vertexTwoConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,2),this.positionTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.positionTarget,1),this.positionTarget=new a(this.positionTarget.regName,this.positionTarget.index),this.needVelocity)this.velocityTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.velocityTarget,1),this.velocityTarget=new a(this.velocityTarget.regName,this.velocityTarget.index),this.vertexTime=new a(this.velocityTarget.regName,this.velocityTarget.index,3),this.vertexLife=new a(this.positionTarget.regName,this.positionTarget.index,3);else{var i=this.getFreeVertexVectorTemp();this.addVertexTempUsages(i,1),this.vertexTime=new a(i.regName,i.index,0),this.vertexLife=new a(i.regName,i.index,1)}},t.prototype.setUVSourceAndTarget=function(e,t){this.uvVar=this.getRegisterFromString(t),this.uvAttribute=this.getRegisterFromString(e),this.uvTarget=new a(this.positionTarget.regName,this.positionTarget.index)},t.prototype.setRegisterIndex=function(e,t,i){var r=this.indexDictionary[e.id];null==r&&(r=this.indexDictionary[e.id]=new Array(8)),r[t]=i},t.prototype.getRegisterIndex=function(e,t){return this.indexDictionary[e.id][t]},t.prototype.getInitCode=function(){for(var e=this.sourceRegisters.length,t="",i=0;e>i;i++)t+="mov "+this.targetRegisters[i]+","+this.sourceRegisters[i]+"\n";return t+="mov "+this.positionTarget+".xyz,"+this.vertexZeroConst.toString()+"\n",this.needVelocity&&(t+="mov "+this.velocityTarget+".xyz,"+this.vertexZeroConst.toString()+"\n"),t},t.prototype.getCombinationCode=function(){return"add "+this.scaleAndRotateTarget+".xyz,"+this.scaleAndRotateTarget+".xyz,"+this.positionTarget+".xyz\n"},t.prototype.initColorRegisters=function(){var e="";return this.hasColorMulNode&&(this.colorMulTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorMulTarget,1),this.colorMulVary=this.getFreeVarying(),e+="mov "+this.colorMulTarget+","+this.vertexOneConst+"\n"),this.hasColorAddNode&&(this.colorAddTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorAddTarget,1),this.colorAddVary=this.getFreeVarying(),e+="mov "+this.colorAddTarget+","+this.vertexZeroConst+"\n"),e},t.prototype.getColorPassCode=function(){var e="";return this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)&&(this.hasColorMulNode&&(e+="mov "+this.colorMulVary+","+this.colorMulTarget+"\n"),this.hasColorAddNode&&(e+="mov "+this.colorAddVary+","+this.colorAddTarget+"\n")),e},t.prototype.getColorCombinationCode=function(e){var t="";if(this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){var i=this.getRegisterFromString(e);this.addFragmentTempUsages(i,1),this.hasColorMulNode&&(t+="mul "+i+","+i+","+this.colorMulVary+"\n"),this.hasColorAddNode&&(t+="add "+i+","+i+","+this.colorAddVary+"\n")}return t},t.prototype.getRegisterFromString=function(e){var t=e.split(/(\d+)/);return new a(t[0],parseInt(t[1]))},Object.defineProperty(t.prototype,"numVertexConstant",{get:function(){return this._numVertexConstant},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numFragmentConstant",{get:function(){return this._numFragmentConstant},enumerable:!0,configurable:!0}),t.prototype.setDataLength=function(){this._numVertexConstant=this.numUsedVertexConstants-this.vertexConstantOffset,this._numFragmentConstant=this.numUsedFragmentConstants-this.fragmentConstantOffset,this.vertexConstantData.length=4*this._numVertexConstant,this.fragmentConstantData.length=4*this._numFragmentConstant},t.prototype.setVertexConst=function(e,t,i,r,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0);var s=4*(e-this.vertexConstantOffset);this.vertexConstantData[s++]=t,this.vertexConstantData[s++]=i,this.vertexConstantData[s++]=r,this.vertexConstantData[s]=a},t.prototype.setVertexConstFromArray=function(e,t){for(var i=4*(e-this.vertexConstantOffset),r=0;r<t.length;r++)this.vertexConstantData[i++]=t[r]},t.prototype.setVertexConstFromMatrix=function(e,t){var i=t.rawData,r=4*(e-this.vertexConstantOffset);this.vertexConstantData[r++]=i[0],this.vertexConstantData[r++]=i[4],this.vertexConstantData[r++]=i[8],this.vertexConstantData[r++]=i[12],this.vertexConstantData[r++]=i[1],this.vertexConstantData[r++]=i[5],this.vertexConstantData[r++]=i[9],this.vertexConstantData[r++]=i[13],this.vertexConstantData[r++]=i[2],this.vertexConstantData[r++]=i[6],this.vertexConstantData[r++]=i[10],this.vertexConstantData[r++]=i[14],this.vertexConstantData[r++]=i[3],this.vertexConstantData[r++]=i[7],this.vertexConstantData[r++]=i[11],this.vertexConstantData[r]=i[15]},t.prototype.setFragmentConst=function(e,t,i,r,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0);var s=4*(e-this.fragmentConstantOffset);this.fragmentConstantData[s++]=t,this.fragmentConstantData[s++]=i,this.fragmentConstantData[s++]=r,this.fragmentConstantData[s]=a},t}(r);t.exports=s},{"awayjs-renderergl/lib/compilation/ShaderRegisterCache":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":[function(e,t){var i=function(){function e(){this._pVertexBuffer=new Array(8),this._pBufferContext=new Array(8),this._pBufferDirty=new Array(8),this.numProcessedVertices=0,this.previousTime=Number.NEGATIVE_INFINITY,this.animationParticles=new Array;for(var t=0;8>t;t++)this._pBufferDirty[t]=!0;this._iUniqueId=e.SUBGEOM_ID_COUNT++}return e.prototype.createVertexData=function(e,t){this._numVertices=e,this._totalLenOfOneVertex=t,this._pVertexData=new Array(e*t)},e.prototype.activateVertexBuffer=function(e,t,i,r){var a=i.stageIndex,s=i.context,n=this._pVertexBuffer[a];n&&this._pBufferContext[a]==s||(n=this._pVertexBuffer[a]=s.createVertexBuffer(this._numVertices,this._totalLenOfOneVertex),this._pBufferContext[a]=s,this._pBufferDirty[a]=!0),this._pBufferDirty[a]&&(n.uploadFromArray(this._pVertexData,0,this._numVertices),this._pBufferDirty[a]=!1),s.setVertexBufferAt(e,n,t,r)},e.prototype.dispose=function(){for(;this._pVertexBuffer.length;){var e=this._pVertexBuffer.pop();e&&e.dispose()}},e.prototype.invalidateBuffer=function(){for(var e=0;8>e;e++)this._pBufferDirty[e]=!0},Object.defineProperty(e.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:!0,configurable:!0}),e.SUBGEOM_ID_COUNT=0,e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ColorSegmentPoint":[function(e,t){var i=function(){function e(e,t){if(0>=e||e>=1)throw new Error("life exceeds range (0,1)");this._life=e,this._color=t}return Object.defineProperty(e.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"life",{get:function(){return this._life},enumerable:!0,configurable:!0}),e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/JointPose":[function(e,t){var i=e("awayjs-core/lib/geom/Matrix3D"),r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-core/lib/geom/Vector3D"),s=function(){function e(){this.orientation=new r,this.translation=new a}return e.prototype.toMatrix3D=function(e){return void 0===e&&(e=null),null==e&&(e=new i),this.orientation.toMatrix3D(e),e.appendTranslation(this.translation.x,this.translation.y,this.translation.z),e},e.prototype.copyFrom=function(e){var t=e.orientation,i=e.translation;this.orientation.x=t.x,this.orientation.y=t.y,this.orientation.z=t.z,this.orientation.w=t.w,this.translation.x=i.x,this.translation.y=i.y,this.translation.z=i.z},e}();t.exports=s},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0}],"awayjs-renderergl/lib/animators/data/ParticleAnimationData":[function(e,t){var i=function(){function e(e,t,i,r,a){this.index=e,this.startTime=t,this.totalTime=i+r,this.duration=i,this.delay=r,this.startVertexIndex=a.startVertexIndex,this.numVertices=a.numVertices}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticleData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":[function(e,t){var i=function(){function e(){}return e.GLOBAL=0,e.LOCAL_STATIC=1,e.LOCAL_DYNAMIC=2,e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticleProperties":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonJoint":[function(e,t){var i=function(){function e(){this.parentIndex=-1}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonPose":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=e("awayjs-renderergl/lib/animators/data/JointPose"),n=function(e){function t(){e.call(this),this.jointPoses=new Array}return i(t,e),Object.defineProperty(t.prototype,"numJointPoses",{get:function(){return this.jointPoses.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assetType",{get:function(){return r.SKELETON_POSE},enumerable:!0,configurable:!0}),t.prototype.jointPoseFromName=function(e){var t=this.jointPoseIndexFromName(e);return-1!=t?this.jointPoses[t]:null},t.prototype.jointPoseIndexFromName=function(e){for(var t,i,r;r<this.jointPoses.length;r++){if(i=this.jointPoses[r],i.name==e)return t;t++}return-1},t.prototype.clone=function(){for(var e=new t,i=this.jointPoses.length,r=0;i>r;r++){var a=new s,n=this.jointPoses[r];a.name=n.name,a.copyFrom(n),e.jointPoses[r]=a}return e},t.prototype.dispose=function(){this.jointPoses.length=0},t}(a);t.exports=n},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0}],"awayjs-renderergl/lib/animators/data/Skeleton":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=function(e){function t(){e.call(this),this.joints=new Array}return i(t,e),Object.defineProperty(t.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),t.prototype.jointFromName=function(e){var t=this.jointIndexFromName(e);return-1!=t?this.joints[t]:null},t.prototype.jointIndexFromName=function(e){for(var t,i,r;r<this.joints.length;r++){if(i=this.joints[r],i.name==e)return t;t++}return-1},t.prototype.dispose=function(){this.joints.length=0},Object.defineProperty(t.prototype,"assetType",{get:function(){return r.SKELETON},enumerable:!0,configurable:!0}),t}(a);t.exports=s},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0}],"awayjs-renderergl/lib/animators/data/VertexAnimationMode":[function(e,t){var i=function(){function e(){}return e.ADDITIVE="additive",e.ABSOLUTE="absolute",e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),s=function(e){function t(){e.call(this),this._pLooping=!0,this._pTotalDuration=0,this._pStitchDirty=!0,this._pStitchFinalFrame=!1,this._pNumFrames=0,this._pDurations=new Array,this._pTotalDelta=new r,this.fixedFrameRate=!0}return i(t,e),Object.defineProperty(t.prototype,"looping",{get:function(){return this._pLooping},set:function(e){this._pLooping!=e&&(this._pLooping=e,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(e){this._pStitchFinalFrame!=e&&(this._pStitchFinalFrame=e,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalDuration",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDuration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalDelta",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDelta},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastFrame",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pLastFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durations",{get:function(){return this._pDurations},enumerable:!0,configurable:!0}),t.prototype._pUpdateStitch=function(){this._pStitchDirty=!1,this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1,this._pTotalDuration=0,this._pTotalDelta.x=0,this._pTotalDelta.y=0,this._pTotalDelta.z=0},t}(a);t.exports=s},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleAccelerationState"),o=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleAcceleration",t,3),this._pStateClass=n,this._acceleration=i||new r}return i(t,e),t.prototype.pGetAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.ACCELERATION_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var s="mul "+r+","+t.vertexTime+","+i+"\n";if(t.needVelocity){var o=t.getFreeVertexVectorTemp();s+="mul "+o+","+r+","+t.vertexTwoConst+"\n",s+="add "+t.velocityTarget+".xyz,"+o+".xyz,"+t.velocityTarget+".xyz\n"}return t.removeVertexTempUsage(r),s+="mul "+r+","+r+","+t.vertexTime+"\n",s+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ACCELERATION_VECTOR3D];if(!i)throw new Error("there is no "+t.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=i.x/2,this._pOneData[1]=i.y/2,this._pOneData[2]=i.z/2},t.ACCELERATION_VECTOR3D="AccelerationVector3D",t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleBezierCurveState"),l=function(e){function t(t,i,a){void 0===i&&(i=null),void 0===a&&(a=null),e.call(this,"ParticleBezierCurve",t,6),this._pStateClass=o,this._iControlPoint=i||new r,this._iEndPoint=a||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.BEZIER_CONTROL_INDEX,i.index);var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.BEZIER_END_INDEX,r.index);var n=t.getFreeVertexVectorTemp(),l=new a(n.regName,n.index,0),h=new a(n.regName,n.index,1),p=new a(n.regName,n.index,2);t.addVertexTempUsages(n,1);var d=t.getFreeVertexVectorTemp(),c=new a(d.regName,d.index);t.removeVertexTempUsage(n);var u="";return u+="sub "+l+","+t.vertexOneConst+","+t.vertexLife+"\n",u+="mul "+h+","+t.vertexLife+","+t.vertexLife+"\n",u+="mul "+p+","+t.vertexLife+","+l+"\n",u+="mul "+p+","+p+","+t.vertexTwoConst+"\n",u+="mul "+c+".xyz,"+p+","+i+"\n",u+="add "+t.positionTarget+".xyz,"+c+".xyz,"+t.positionTarget+".xyz\n",u+="mul "+c+".xyz,"+h+","+r+"\n",u+="add "+t.positionTarget+".xyz,"+c+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(u+="mul "+h+","+t.vertexLife+","+t.vertexTwoConst+"\n",u+="sub "+p+","+t.vertexOneConst+","+h+"\n",u+="mul "+p+","+t.vertexTwoConst+","+p+"\n",u+="mul "+c+".xyz,"+i+","+p+"\n",u+="add "+t.velocityTarget+".xyz,"+c+".xyz,"+t.velocityTarget+".xyz\n",u+="mul "+c+".xyz,"+r+","+h+"\n",u+="add "+t.velocityTarget+".xyz,"+c+".xyz,"+t.velocityTarget+".xyz\n"),u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.BEZIER_CONTROL_VECTOR3D];if(!i)throw new Error("there is no "+t.BEZIER_CONTROL_VECTOR3D+" in param!");var r=e[t.BEZIER_END_VECTOR3D];if(!r)throw new Error("there is no "+t.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,this._pOneData[3]=r.x,this._pOneData[4]=r.y,this._pOneData[5]=r.z},t.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D",t.BEZIER_END_VECTOR3D="BezierEndVector3D",t}(n);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleBillboardState"),n=function(e){function t(t){void 0===t&&(t=null),e.call(this,"ParticleBillboard",r.GLOBAL,0,4),this._pStateClass=s,this._iBillboardAxis=t}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexConstant();t.setRegisterIndex(this,s.MATRIX_INDEX,i.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant();for(var r,a=t.getFreeVertexVectorTemp(),n="m33 "+a+".xyz,"+t.scaleAndRotateTarget+","+i+"\nmov "+t.scaleAndRotateTarget+".xyz,"+a+"\n",o=0;o<t.rotationRegisters.length;o++)r=t.rotationRegisters[o],n+="m33 "+a+".xyz,"+r+","+i+"\nmov "+r+".xyz,"+r+"\n";return n},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.hasBillboard=!0},t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleBillboardState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleColorState"),l=function(e){function t(t,i,s,n,l,h,p,d,c){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===n&&(n=!1),void 0===l&&(l=!1),void 0===h&&(h=null),void 0===p&&(p=null),void 0===d&&(d=1),void 0===c&&(c=0),e.call(this,"ParticleColor",t,i&&s?16:8,a.COLOR_PRIORITY),this._pStateClass=o,this._iUsesMultiplier=i,this._iUsesOffset=s,this._iUsesCycle=n,this._iUsesPhase=l,this._iStartColor=h||new r,this._iEndColor=p||new r,this._iCycleDuration=d,this._iCyclePhase=c}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var r=t.getFreeVertexVectorTemp();if(this._iUsesCycle){var a=t.getFreeVertexConstant();t.setRegisterIndex(this,o.CYCLE_INDEX,a.index),t.addVertexTempUsages(r,1);var n=t.getFreeVertexSingleTemp();t.removeVertexTempUsage(r),i+="mul "+n+","+t.vertexTime+","+a+".x\n",this._iUsesPhase&&(i+="add "+n+","+n+","+a+".y\n"),i+="sin "+n+","+n+"\n"}if(this._iUsesMultiplier){var l=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute(),h=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.START_MULTIPLIER_INDEX,l.index),t.setRegisterIndex(this,o.DELTA_MULTIPLIER_INDEX,h.index),i+="mul "+r+","+h+","+(this._iUsesCycle?n:t.vertexLife)+"\n",i+="add "+r+","+r+","+l+"\n",i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var p=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant(),d=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,o.START_OFFSET_INDEX,p.index),t.setRegisterIndex(this,o.DELTA_OFFSET_INDEX,d.index),i+="mul "+r+","+d+","+(this._iUsesCycle?n:t.vertexLife)+"\n",i+="add "+r+","+r+","+p+"\n",i+="add "+t.colorAddTarget+","+r+","+t.colorAddTarget+"\n"}}return i},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_START_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_START_COLORTRANSFORM+" in param!");var r=e[t.COLOR_END_COLORTRANSFORM];if(!r)throw new Error("there is no "+t.COLOR_END_COLORTRANSFORM+" in param!");var a=0;this._iUsesCycle?(this._iUsesMultiplier&&(this._pOneData[a++]=(i.redMultiplier+r.redMultiplier)/2,this._pOneData[a++]=(i.greenMultiplier+r.greenMultiplier)/2,this._pOneData[a++]=(i.blueMultiplier+r.blueMultiplier)/2,this._pOneData[a++]=(i.alphaMultiplier+r.alphaMultiplier)/2,this._pOneData[a++]=(i.redMultiplier-r.redMultiplier)/2,this._pOneData[a++]=(i.greenMultiplier-r.greenMultiplier)/2,this._pOneData[a++]=(i.blueMultiplier-r.blueMultiplier)/2,this._pOneData[a++]=(i.alphaMultiplier-r.alphaMultiplier)/2),this._iUsesOffset&&(this._pOneData[a++]=(i.redOffset+r.redOffset)/510,this._pOneData[a++]=(i.greenOffset+r.greenOffset)/510,this._pOneData[a++]=(i.blueOffset+r.blueOffset)/510,this._pOneData[a++]=(i.alphaOffset+r.alphaOffset)/510,this._pOneData[a++]=(i.redOffset-r.redOffset)/510,this._pOneData[a++]=(i.greenOffset-r.greenOffset)/510,this._pOneData[a++]=(i.blueOffset-r.blueOffset)/510,this._pOneData[a++]=(i.alphaOffset-r.alphaOffset)/510)):(this._iUsesMultiplier&&(this._pOneData[a++]=i.redMultiplier,this._pOneData[a++]=i.greenMultiplier,this._pOneData[a++]=i.blueMultiplier,this._pOneData[a++]=i.alphaMultiplier,this._pOneData[a++]=r.redMultiplier-i.redMultiplier,this._pOneData[a++]=r.greenMultiplier-i.greenMultiplier,this._pOneData[a++]=r.blueMultiplier-i.blueMultiplier,this._pOneData[a++]=r.alphaMultiplier-i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[a++]=i.redOffset/255,this._pOneData[a++]=i.greenOffset/255,this._pOneData[a++]=i.blueOffset/255,this._pOneData[a++]=i.alphaOffset/255,this._pOneData[a++]=(r.redOffset-i.redOffset)/255,this._pOneData[a++]=(r.greenOffset-i.greenOffset)/255,this._pOneData[a++]=(r.blueOffset-i.blueOffset)/255,this._pOneData[a++]=(r.alphaOffset-i.alphaOffset)/255))},t.COLOR_START_COLORTRANSFORM="ColorStartColorTransform",t.COLOR_END_COLORTRANSFORM="ColorEndColorTransform",t}(n);t.exports=l},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleColorState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleFollowState"),o=function(e){function t(t,i,s){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===s&&(s=!1),e.call(this,"ParticleFollow",a.LOCAL_DYNAMIC,t&&i?6:3,r.POST_PRIORITY),this._pStateClass=n,this._iUsesPosition=t,this._iUsesRotation=i,this._iSmooth=s}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(this._iUsesRotation){var r=t.getFreeVertexAttribute();t.setRegisterIndex(this,n.FOLLOW_ROTATION_INDEX,r.index);var a=t.getFreeVertexVectorTemp();t.addVertexTempUsages(a,1);var s=t.getFreeVertexVectorTemp();t.addVertexTempUsages(s,1);var o,l=t.getFreeVertexVectorTemp();t.hasBillboard&&(t.addVertexTempUsages(l,1),o=t.getFreeVertexVectorTemp()),t.removeVertexTempUsage(a),t.removeVertexTempUsage(s),t.hasBillboard&&t.removeVertexTempUsage(l);var h,p=t.rotationRegisters.length;if(i+="mov "+a+","+t.vertexZeroConst+"\n",i+="mov "+a+".x,"+t.vertexOneConst+"\n",i+="mov "+l+","+t.vertexZeroConst+"\n",i+="sin "+l+".y,"+r+".x\n",i+="cos "+l+".z,"+r+".x\n",i+="mov "+s+".x,"+t.vertexZeroConst+"\n",i+="mov "+s+".y,"+l+".z\n",i+="neg "+s+".z,"+l+".y\n",t.hasBillboard)i+="m33 "+o+".xyz,"+t.positionTarget+".xyz,"+a+"\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",h=0;p>h;h++)i+="m33 "+t.rotationRegisters[h]+".xyz,"+t.rotationRegisters[h]+","+a+"\n";if(i+="mov "+a+","+t.vertexZeroConst+"\n",i+="cos "+a+".x,"+r+".y\n",i+="sin "+a+".z,"+r+".y\n",i+="mov "+s+","+t.vertexZeroConst+"\n",i+="mov "+s+".y,"+t.vertexOneConst+"\n",i+="mov "+l+","+t.vertexZeroConst+"\n",i+="neg "+l+".x,"+a+".z\n",i+="mov "+l+".z,"+a+".x\n",t.hasBillboard)i+="m33 "+o+".xyz,"+o+".xyz,"+a+"\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",h=0;p>h;h++)i+="m33 "+t.rotationRegisters[h]+".xyz,"+t.rotationRegisters[h]+","+a+"\n";if(i+="mov "+s+","+t.vertexZeroConst+"\n",i+="sin "+s+".x,"+r+".z\n",i+="cos "+s+".y,"+r+".z\n",i+="mov "+a+","+t.vertexZeroConst+"\n",i+="mov "+a+".x,"+s+".y\n",i+="neg "+a+".y,"+s+".x\n",i+="mov "+l+","+t.vertexZeroConst+"\n",i+="mov "+l+".z,"+t.vertexOneConst+"\n",t.hasBillboard)i+="m33 "+o+".xyz,"+o+".xyz,"+a+"\n",i+="sub "+o+".xyz,"+o+".xyz,"+t.positionTarget+".xyz\n",i+="add "+t.scaleAndRotateTarget+".xyz,"+o+".xyz,"+t.scaleAndRotateTarget+".xyz\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",h=0;p>h;h++)i+="m33 "+t.rotationRegisters[h]+".xyz,"+t.rotationRegisters[h]+","+a+"\n"}if(this._iUsesPosition){var d=t.getFreeVertexAttribute();t.setRegisterIndex(this,n.FOLLOW_POSITION_INDEX,d.index),i+="add "+t.scaleAndRotateTarget+".xyz,"+d+","+t.scaleAndRotateTarget+".xyz\n"}return i},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleFollowState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e
}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleInitialColorState"),l=function(e){function t(t,i,s,n){void 0===i&&(i=!0),void 0===s&&(s=!1),void 0===n&&(n=null),e.call(this,"ParticleInitialColor",t,i&&s?8:4,a.COLOR_PRIORITY),this._pStateClass=o,this._iUsesMultiplier=i,this._iUsesOffset=s,this._iInitialColor=n||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){if(this._iUsesMultiplier){var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.MULTIPLIER_INDEX,r.index),i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var a=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,o.OFFSET_INDEX,a.index),i+="add "+t.colorAddTarget+","+a+","+t.colorAddTarget+"\n"}}return i},t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_INITIAL_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_INITIAL_COLORTRANSFORM+" in param!");var r=0;this._iUsesMultiplier&&(this._pOneData[r++]=i.redMultiplier,this._pOneData[r++]=i.greenMultiplier,this._pOneData[r++]=i.blueMultiplier,this._pOneData[r++]=i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[r++]=i.redOffset/255,this._pOneData[r++]=i.greenOffset/255,this._pOneData[r++]=i.blueOffset/255,this._pOneData[r++]=i.alphaOffset/255)},t.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform",t}(n);t.exports=l},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=function(e){function t(i,r,a,s){void 0===s&&(s=1),e.call(this),this._pDataLength=3,i+=t.MODES[r],this.name=i,this._pMode=r,this._priority=s,this._pDataLength=a,this._pOneData=new Array(this._pDataLength)}return i(t,e),Object.defineProperty(t.prototype,"mode",{get:function(){return this._pMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oneData",{get:function(){return this._pOneData},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(){return""},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(){return""},t.prototype._iGeneratePropertyOfOneParticle=function(){},t.prototype._iProcessAnimationSetting=function(){},t.GLOBAL="Global",t.LOCAL_STATIC="LocalStatic",t.LOCAL_DYNAMIC="LocalDynamic",t.MODES={0:t.GLOBAL,1:t.LOCAL_STATIC,2:t.LOCAL_DYNAMIC},t}(r);t.exports=a},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleOrbitState"),l=function(e){function t(t,i,a,s,n,l,h,p){void 0===i&&(i=!0),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===n&&(n=100),void 0===l&&(l=1),void 0===h&&(h=0),void 0===p&&(p=null);var d=3;s&&d++,e.call(this,"ParticleOrbit",t,d),this._pStateClass=o,this._iUsesEulers=i,this._iUsesCycle=a,this._iUsesPhase=s,this._iRadius=n,this._iCycleDuration=l,this._iCyclePhase=h,this._iEulers=p||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.ORBIT_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,o.EULERS_INDEX,r.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant();var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);var l=new a(n.regName,n.index),h=t.getFreeVertexVectorTemp(),p=new a(h.regName,h.index,0),d=new a(h.regName,h.index,1),c=new a(h.regName,h.index,2);t.removeVertexTempUsage(n);var u="";return this._iUsesCycle?(u+="mul "+c+","+t.vertexTime+","+i+".y\n",this._iUsesPhase&&(u+="add "+c+","+c+","+i+".w\n")):u+="mul "+c+","+t.vertexLife+","+i+".y\n",u+="cos "+p+","+c+"\n",u+="sin "+d+","+c+"\n",u+="mul "+l+".x,"+p+","+i+".x\n",u+="mul "+l+".y,"+d+","+i+".x\n",u+="mov "+l+".wz"+t.vertexZeroConst+"\n",this._iUsesEulers&&(u+="m44 "+l+","+l+","+r+"\n"),u+="add "+t.positionTarget+".xyz,"+l+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(u+="neg "+l+".x,"+d+"\n",u+="mov "+l+".y,"+p+"\n",u+="mov "+l+".zw,"+t.vertexZeroConst+"\n",this._iUsesEulers&&(u+="m44 "+l+","+l+","+r+"\n"),u+="mul "+l+","+l+","+i+".z\n",u+="div "+l+","+l+","+i+".y\n",this._iUsesCycle||(u+="div "+l+","+l+","+t.vertexLife+"\n"),u+="add "+t.velocityTarget+".xyz,"+t.velocityTarget+".xyz,"+l+".xyz\n"),u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ORBIT_VECTOR3D];if(!i)throw new Error("there is no "+t.ORBIT_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._iUsesCycle&&i.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=2*Math.PI/(this._iUsesCycle?i.y:1),this._pOneData[2]=i.x*Math.PI*2,this._iUsesPhase&&(this._pOneData[3]=i.z*Math.PI/180)},t.ORBIT_VECTOR3D="OrbitVector3D",t}(n);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleOrbitState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleOscillatorState"),l=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleOscillator",t,4),this._pStateClass=o,this._iOscillator=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.OSCILLATOR_INDEX,i.index);var r=t.getFreeVertexVectorTemp(),n=new a(r.regName,r.index,0),l=new a(r.regName,r.index,1),h=new a(r.regName,r.index,2);t.addVertexTempUsages(r,1);var p=t.getFreeVertexVectorTemp(),d=new a(p.regName,p.index);t.removeVertexTempUsage(r);var c="";return c+="mul "+n+","+t.vertexTime+","+i+".w\n",c+="sin "+l+","+n+"\n",c+="mul "+d+".xyz,"+l+","+i+".xyz\n",c+="add "+t.positionTarget+".xyz,"+d+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(c+="cos "+h+","+n+"\n",c+="mul "+d+".xyz,"+h+","+i+".xyz\n",c+="add "+t.velocityTarget+".xyz,"+d+".xyz,"+t.velocityTarget+".xyz\n"),c},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.OSCILLATOR_VECTOR3D];if(!i)throw new Error("there is no "+t.OSCILLATOR_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=2*Math.PI/i.w},t.OSCILLATOR_VECTOR3D="OscillatorVector3D",t}(n);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticlePositionState"),o=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticlePosition",t,3),this._pStateClass=n,this._iPosition=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();return t.setRegisterIndex(this,n.POSITION_INDEX,i.index),"add "+t.positionTarget+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.POSITION_VECTOR3D="PositionVector3D",t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticlePositionState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState"),o=function(e){function t(){e.call(this,"ParticleRotateToHeading",a.GLOBAL,0,3),this._pStateClass=n}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i,a="",s=t.rotationRegisters.length;if(t.hasBillboard){var o=t.getFreeVertexVectorTemp();t.addVertexTempUsages(o,1);var l=t.getFreeVertexVectorTemp();t.addVertexTempUsages(l,1);var h=t.getFreeVertexVectorTemp(),p=t.getFreeVertexConstant();for(t.setRegisterIndex(this,n.MATRIX_INDEX,p.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.removeVertexTempUsage(o),t.removeVertexTempUsage(l),a+="m33 "+o+".xyz,"+t.velocityTarget+".xyz,"+p+"\n",a+="mov "+h+","+t.vertexZeroConst+"\n",a+="mov "+h+".xy,"+o+".xy\n",a+="nrm "+h+".xyz,"+h+".xyz\n",a+="mov "+l+","+t.vertexZeroConst+"\n",a+="mov "+l+".x,"+h+".y\n",a+="mov "+l+".y,"+h+".x\n",a+="mov "+o+","+t.vertexZeroConst+"\n",a+="mov "+o+".x,"+h+".x\n",a+="neg "+o+".y,"+h+".y\n",a+="mov "+h+","+t.vertexZeroConst+"\n",a+="mov "+h+".z,"+t.vertexOneConst+"\n",a+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+o+"\n",i=0;s>i;i++)a+="m33 "+t.rotationRegisters[i]+".xyz,"+t.rotationRegisters[i]+","+o+"\n"}else{var d=t.getFreeVertexVectorTemp();t.addVertexTempUsages(d,1);var c=t.getFreeVertexVectorTemp();t.addVertexTempUsages(c,1);var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var _=t.getFreeVertexVectorTemp(),g=new r(u.regName,u.index,3),m=new r(_.regName,_.index,3),y=new r(d.regName,d.index,3),f=m;for(t.removeVertexTempUsage(d),t.removeVertexTempUsage(c),t.removeVertexTempUsage(u),a+="mov "+c+".x,"+t.vertexOneConst+"\n",a+="mov "+c+".yz,"+t.vertexZeroConst+"\n",a+="nrm "+d+".xyz,"+t.velocityTarget+".xyz\n",a+="dp3 "+y+","+d+".xyz,"+c+".xyz\n",a+="crs "+d+".xyz,"+c+".xyz,"+d+".xyz\n",a+="nrm "+d+".xyz,"+d+".xyz\n",a+="dp3 "+u+".x,"+d+".xyz,"+d+".xyz\n",a+="sge "+u+".x,"+t.vertexZeroConst+","+u+".x\n",a+="add "+d+".z,"+u+".x,"+d+".z\n",a+="add "+f+","+y+","+t.vertexOneConst+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+g+","+f+"\n",a+="sub "+f+","+t.vertexOneConst+","+y+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+m+","+f+"\n",a+="mul "+u+".xyz,"+m+","+d+".xyz\n",a+="mul "+_+".xyz,"+m+","+d+".xyz\n",a+="neg "+_+".xyz,"+_+".xyz\n",a+="crs "+d+".xyz,"+u+".xyz,"+t.scaleAndRotateTarget+".xyz\n",a+="mul "+c+".xyz,"+g+","+t.scaleAndRotateTarget+".xyz\n",a+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",a+="dp3 "+c+".w,"+u+".xyz,"+t.scaleAndRotateTarget+".xyz\n",a+="neg "+d+".w,"+c+".w\n",a+="crs "+u+".xyz,"+d+".xyz,"+_+".xyz\n",a+="mul "+c+".xyzw,"+d+".xyzw,"+g+"\n",a+="add "+u+".xyz,"+u+".xyz,"+c+".xyz\n",a+="mul "+c+".xyz,"+d+".w,"+_+".xyz\n",a+="add "+t.scaleAndRotateTarget+".xyz,"+u+".xyz,"+c+".xyz\n",i=0;s>i;i++)a+="mov "+c+".x,"+t.vertexOneConst+"\n",a+="mov "+c+".yz,"+t.vertexZeroConst+"\n",a+="nrm "+d+".xyz,"+t.velocityTarget+".xyz\n",a+="dp3 "+y+","+d+".xyz,"+c+".xyz\n",a+="crs "+d+".xyz,"+c+".xyz,"+d+".xyz\n",a+="nrm "+d+".xyz,"+d+".xyz\n",a+="dp3 "+u+".x,"+d+".xyz,"+d+".xyz\n",a+="sge "+u+".x,"+t.vertexZeroConst+","+u+".x\n",a+="add "+d+".z,"+u+".x,"+d+".z\n",a+="add "+f+","+y+","+t.vertexOneConst+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+g+","+f+"\n",a+="sub "+f+","+t.vertexOneConst+","+y+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+m+","+f+"\n",a+="mul "+u+".xyz,"+m+","+d+".xyz\n",a+="mul "+_+".xyz,"+m+","+d+".xyz\n",a+="neg "+_+".xyz,"+_+".xyz\n",a+="crs "+d+".xyz,"+u+".xyz,"+t.rotationRegisters[i]+".xyz\n",a+="mul "+c+".xyz,"+g+","+t.rotationRegisters[i]+".xyz\n",a+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",a+="dp3 "+c+".w,"+u+".xyz,"+t.rotationRegisters[i]+".xyz\n",a+="neg "+d+".w,"+c+".w\n",a+="crs "+u+".xyz,"+d+".xyz,"+_+".xyz\n",a+="mul "+c+".xyzw,"+d+".xyzw,"+g+"\n",a+="add "+u+".xyz,"+u+".xyz,"+c+".xyz\n",a+="mul "+c+".xyz,"+d+".w,"+_+".xyz\n",a+="add "+t.rotationRegisters[i]+".xyz,"+u+".xyz,"+c+".xyz\n"}return a},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.needVelocity=!0},t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState"),l=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleRotateToPosition",t,3,3),this._pStateClass=o,this._iPosition=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.POSITION_INDEX,i.index);var r,n="",l=t.rotationRegisters.length;if(t.hasBillboard){var h=t.getFreeVertexVectorTemp();t.addVertexTempUsages(h,1);var p=t.getFreeVertexVectorTemp();t.addVertexTempUsages(p,1);var d=t.getFreeVertexVectorTemp(),c=t.getFreeVertexConstant();for(t.setRegisterIndex(this,o.MATRIX_INDEX,c.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.removeVertexTempUsage(h),t.removeVertexTempUsage(p),n+="sub "+h+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",n+="m33 "+h+".xyz,"+h+".xyz,"+c+"\n",n+="mov "+d+","+t.vertexZeroConst+"\n",n+="mov "+d+".xy,"+h+".xy\n",n+="nrm "+d+".xyz,"+d+".xyz\n",n+="mov "+p+","+t.vertexZeroConst+"\n",n+="mov "+p+".x,"+d+".y\n",n+="mov "+p+".y,"+d+".x\n",n+="mov "+h+","+t.vertexZeroConst+"\n",n+="mov "+h+".x,"+d+".x\n",n+="neg "+h+".y,"+d+".y\n",n+="mov "+d+","+t.vertexZeroConst+"\n",n+="mov "+d+".z,"+t.vertexOneConst+"\n",n+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+h+"\n",r=0;l>r;r++)n+="m33 "+t.rotationRegisters[r]+".xyz,"+t.rotationRegisters[r]+","+h+"\n"}else{var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var _=t.getFreeVertexVectorTemp();t.addVertexTempUsages(_,1);var g=new a(_.regName,_.index,0),m=new a(_.regName,_.index,1),y=new a(_.regName,_.index,2),f=new a(_.regName,_.index,3),b=t.getFreeVertexVectorTemp();for(t.addVertexTempUsages(b,1),t.removeVertexTempUsage(u),t.removeVertexTempUsage(_),t.removeVertexTempUsage(b),n+="sub "+u+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="mov "+m+","+u+".y\n",n+="mul "+g+","+m+","+m+"\n",n+="sub "+g+","+t.vertexOneConst+","+g+"\n",n+="sqt "+g+","+g+"\n",n+="mul "+b+".x,"+g+","+t.scaleAndRotateTarget+".y\n",n+="mul "+b+".y,"+m+","+t.scaleAndRotateTarget+".z\n",n+="mul "+b+".z,"+m+","+t.scaleAndRotateTarget+".y\n",n+="mul "+b+".w,"+g+","+t.scaleAndRotateTarget+".z\n",n+="sub "+t.scaleAndRotateTarget+".y,"+b+".x,"+b+".y\n",n+="add "+t.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",n+="abs "+b+".y,"+u+".y\n",n+="sge "+b+".z,"+b+".y,"+t.vertexOneConst+"\n",n+="mul "+b+".x,"+b+".y,"+u+".y\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="dp3 "+m+","+u+".xyz,"+u+".xyz\n",n+="sge "+f+","+t.vertexZeroConst+","+m+"\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="sub "+m+","+t.vertexOneConst+","+f+"\n",n+="mul "+m+","+m+","+u+".x\n",n+="mov "+g+","+u+".z\n",n+="neg "+g+","+g+"\n",n+="sub "+y+","+t.vertexOneConst+","+g+"\n",n+="mul "+y+","+b+".x,"+f+"\n",n+="add "+g+","+g+","+y+"\n",n+="mul "+b+".x,"+g+","+t.scaleAndRotateTarget+".x\n",n+="mul "+b+".y,"+m+","+t.scaleAndRotateTarget+".z\n",n+="mul "+b+".z,"+m+","+t.scaleAndRotateTarget+".x\n",n+="mul "+b+".w,"+g+","+t.scaleAndRotateTarget+".z\n",n+="sub "+t.scaleAndRotateTarget+".x,"+b+".x,"+b+".y\n",n+="add "+t.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",r=0;l>r;r++)n+="sub "+u+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="mov "+m+","+u+".y\n",n+="mul "+g+","+m+","+m+"\n",n+="sub "+g+","+t.vertexOneConst+","+g+"\n",n+="sqt "+g+","+g+"\n",n+="mul "+b+".x,"+g+","+t.rotationRegisters[r]+".y\n",n+="mul "+b+".y,"+m+","+t.rotationRegisters[r]+".z\n",n+="mul "+b+".z,"+m+","+t.rotationRegisters[r]+".y\n",n+="mul "+b+".w,"+g+","+t.rotationRegisters[r]+".z\n",n+="sub "+t.rotationRegisters[r]+".y,"+b+".x,"+b+".y\n",n+="add "+t.rotationRegisters[r]+".z,"+b+".z,"+b+".w\n",n+="abs "+b+".y,"+u+".y\n",n+="sge "+b+".z,"+b+".y,"+t.vertexOneConst+"\n",n+="mul "+b+".x,"+b+".y,"+u+".y\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="dp3 "+m+","+u+".xyz,"+u+".xyz\n",n+="sge "+f+","+t.vertexZeroConst+","+m+"\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="sub "+m+","+t.vertexOneConst+","+f+"\n",n+="mul "+m+","+m+","+u+".x\n",n+="mov "+g+","+u+".z\n",n+="neg "+g+","+g+"\n",n+="sub "+y+","+t.vertexOneConst+","+g+"\n",n+="mul "+y+","+b+".x,"+f+"\n",n+="add "+g+","+g+","+y+"\n",n+="mul "+b+".x,"+g+","+t.rotationRegisters[r]+".x\n",n+="mul "+b+".y,"+m+","+t.rotationRegisters[r]+".z\n",n+="mul "+b+".z,"+m+","+t.rotationRegisters[r]+".x\n",n+="mul "+b+".w,"+g+","+t.rotationRegisters[r]+".z\n",n+="sub "+t.rotationRegisters[r]+".x,"+b+".x,"+b+".y\n",n+="add "+t.rotationRegisters[r]+".z,"+b+".z,"+b+".w\n"}return n},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.POSITION_VECTOR3D="RotateToPositionVector3D",t}(n);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState"),l=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleRotationalVelocity",t,4),this._pStateClass=o,this._iRotationalVelocity=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.ROTATIONALVELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);var l=t.getFreeVertexVectorTemp();t.addVertexTempUsages(l,1);var h=new a(l.regName,l.index),p=t.getFreeVertexVectorTemp();p=new a(p.regName,p.index);var d=new a(h.regName,h.index,3),c=new a(p.regName,p.index,3);t.removeVertexTempUsage(r),t.removeVertexTempUsage(n),t.removeVertexTempUsage(l);var u="";u+="mov "+r+".xyz,"+i+".xyz\n",u+="mov "+r+".w,"+t.vertexZeroConst+"\n",u+="mul "+d+","+t.vertexTime+","+i+".w\n",u+="sin "+c+","+d+"\n",u+="cos "+d+","+d+"\n",u+="mul "+h+".xyz,"+c+","+r+".xyz\n",u+="mul "+p+".xyz,"+c+","+r+".xyz\n",u+="neg "+p+".xyz,"+p+".xyz\n",u+="crs "+r+".xyz,"+h+".xyz,"+t.scaleAndRotateTarget+".xyz\n",u+="mul "+n+".xyz,"+d+","+t.scaleAndRotateTarget+".xyz\n",u+="add "+r+".xyz,"+r+".xyz,"+n+".xyz\n",u+="dp3 "+n+".w,"+h+".xyz,"+t.scaleAndRotateTarget+".xyz\n",u+="neg "+r+".w,"+n+".w\n",u+="crs "+h+".xyz,"+r+".xyz,"+p+".xyz\n",u+="mul "+n+".xyzw,"+r+".xyzw,"+d+"\n",u+="add "+h+".xyz,"+h+".xyz,"+n+".xyz\n",u+="mul "+n+".xyz,"+r+".w,"+p+".xyz\n",u+="add "+t.scaleAndRotateTarget+".xyz,"+h+".xyz,"+n+".xyz\n";for(var _=t.rotationRegisters.length,g=0;_>g;g++)u+="mov "+r+".xyz,"+i+".xyz\n",u+="mov "+r+".w,"+t.vertexZeroConst+"\n",u+="mul "+d+","+t.vertexTime+","+i+".w\n",u+="sin "+c+","+d+"\n",u+="cos "+d+","+d+"\n",u+="mul "+h+".xyz,"+c+","+r+".xyz\n",u+="mul "+p+".xyz,"+c+","+r+".xyz\n",u+="neg "+p+".xyz,"+p+".xyz\n",u+="crs "+r+".xyz,"+h+".xyz,"+t.rotationRegisters[g]+".xyz\n",u+="mul "+n+".xyz,"+d+","+t.rotationRegisters[g]+"\n",u+="add "+r+".xyz,"+r+".xyz,"+n+".xyz\n",u+="dp3 "+n+".w,"+h+".xyz,"+t.rotationRegisters[g]+"\n",u+="neg "+r+".w,"+n+".w\n",u+="crs "+h+".xyz,"+r+".xyz,"+p+".xyz\n",u+="mul "+n+".xyzw,"+r+".xyzw,"+d+"\n",u+="add "+h+".xyz,"+h+".xyz,"+n+".xyz\n",u+="mul "+n+".xyz,"+r+".w,"+p+".xyz\n",u+="add "+t.rotationRegisters[g]+","+h+".xyz,"+n+".xyz\n";return u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ROTATIONALVELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(i.length<=0?i.z=1:i.normalize(),this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/i.w},t.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D",t}(n);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleScaleState"),n=function(e){function t(t,i,r,a,n,o,l){void 0===a&&(a=1),void 0===n&&(n=1),void 0===o&&(o=1),void 0===l&&(l=0),e.call(this,"ParticleScale",t,i&&r?4:i||r?3:2,3),this._pStateClass=s,this._iUsesCycle=i,this._iUsesPhase=r,this._iMinScale=a,this._iMaxScale=n,this._iCycleDuration=o,this._iCyclePhase=l}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="",a=t.getFreeVertexSingleTemp(),n=this._pMode==r.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();return t.setRegisterIndex(this,s.SCALE_INDEX,n.index),this._iUsesCycle&&(i+="mul "+a+","+t.vertexTime+","+n+".z\n",this._iUsesPhase&&(i+="add "+a+","+a+","+n+".w\n"),i+="sin "+a+","+a+"\n"),i+="mul "+a+","+n+".y,"+(this._iUsesCycle?a:t.vertexLife)+"\n",i+="add "+a+","+n+".x,"+a+"\n",i+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.SCALE_VECTOR3D];if(!i)throw new Error("there is no "+t.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){if(this._pOneData[0]=(i.x+i.y)/2,this._pOneData[1]=Math.abs(i.x-i.y)/2,i.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=2*Math.PI/i.z,this._iUsesPhase&&(this._pOneData[3]=i.w*Math.PI/180)}else this._pOneData[0]=i.x,this._pOneData[1]=i.y-i.x},t.SCALE_VECTOR3D="ScaleVector3D",t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleScaleState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState"),l=function(e){function t(t,i,r,n,l,h){if(e.call(this,"ParticleSegmentedColor",s.GLOBAL,0,a.COLOR_PRIORITY),this._pStateClass=o,r>4)throw new Error("the numSegmentPoint must be less or equal 4");this._iUsesMultiplier=t,this._iUsesOffset=i,this._iNumSegmentPoint=r,this._iStartColor=n,this._iEndColor=l,this._iSegmentPoints=h}return i(t,e),t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var a;this._iUsesMultiplier&&(a=t.getFreeVertexVectorTemp(),t.addVertexTempUsages(a,1));var s=t.getFreeVertexVectorTemp();t.addVertexTempUsages(s,1);var n=t.getFreeVertexVectorTemp(),l=new r(n.regName,n.index,0),h=new r(n.regName,n.index,1);this._iUsesMultiplier&&t.removeVertexTempUsage(a),t.removeVertexTempUsage(s);var p=t.getFreeVertexConstant();t.setRegisterIndex(this,o.TIME_DATA_INDEX,p.index);var d,c,u;if(this._iUsesMultiplier)for(c=t.getFreeVertexConstant(),t.setRegisterIndex(this,o.START_MULTIPLIER_INDEX,c.index),u=new Array,d=0;d<this._iNumSegmentPoint+1;d++)u.push(t.getFreeVertexConstant());var _,g;if(this._iUsesOffset)for(_=t.getFreeVertexConstant(),t.setRegisterIndex(this,o.START_OFFSET_INDEX,_.index),g=new Array,d=0;d<this._iNumSegmentPoint+1;d++)g.push(t.getFreeVertexConstant());for(this._iUsesMultiplier&&(i+="mov "+a+","+c+"\n"),this._iUsesOffset&&(i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+_+"\n"),d=0;d<this._iNumSegmentPoint;d++){switch(d){case 0:i+="min "+h+","+t.vertexLife+","+p+".x\n";break;case 1:i+="sub "+l+","+t.vertexLife+","+p+".x\n",i+="max "+h+","+l+","+t.vertexZeroConst+"\n",i+="min "+h+","+h+","+p+".y\n";break;case 2:i+="sub "+l+","+l+","+p+".y\n",i+="max "+h+","+l+","+t.vertexZeroConst+"\n",i+="min "+h+","+h+","+p+".z\n";break;case 3:i+="sub "+l+","+l+","+p+".z\n",i+="max "+h+","+l+","+t.vertexZeroConst+"\n",i+="min "+h+","+h+","+p+".w\n"}this._iUsesMultiplier&&(i+="mul "+s+","+h+","+u[d]+"\n",i+="add "+a+","+a+","+s+"\n"),this._iUsesOffset&&(i+="mul "+s+","+h+","+g[d]+"\n",i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+s+"\n")}if(0==this._iNumSegmentPoint)h=t.vertexLife;else{switch(this._iNumSegmentPoint){case 1:i+="sub "+l+","+t.vertexLife+","+p+".x\n";break;case 2:i+="sub "+l+","+l+","+p+".y\n";break;case 3:i+="sub "+l+","+l+","+p+".z\n";break;case 4:i+="sub "+l+","+l+","+p+".w\n"}i+="max "+h+","+l+","+t.vertexZeroConst+"\n"}this._iUsesMultiplier&&(i+="mul "+s+","+h+","+u[this._iNumSegmentPoint]+"\n",i+="add "+a+","+a+","+s+"\n",i+="mul "+t.colorMulTarget+","+t.colorMulTarget+","+a+"\n"),this._iUsesOffset&&(i+="mul "+s+","+h+","+g[this._iNumSegmentPoint]+"\n",i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+s+"\n")}return i},t}(n);t.exports=l},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState"),l=function(e){function t(t,i,r,s,n,l,h,p){void 0===s&&(s=1),void 0===n&&(n=1),void 0===l&&(l=1),void 0===h&&(h=0),void 0===p&&(p=Number.MAX_VALUE),e.call(this,"ParticleSpriteSheet",t,i?r?3:2:1,a.POST_PRIORITY+1),this._pStateClass=o,this._iUsesCycle=i,this._iUsesPhase=r,this._iNumColumns=s,this._iNumRows=n,this._iCyclePhase=h,this._iCycleDuration=l,this._iTotalFrames=Math.min(p,s*n)}return i(t,e),Object.defineProperty(t.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFrames",{get:function(){return this._iTotalFrames},enumerable:!0,configurable:!0}),t.prototype.getAGALUVCode=function(e,t){var i=t.getFreeVertexConstant(),a=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();
t.setRegisterIndex(this,o.UV_INDEX_0,i.index),t.setRegisterIndex(this,o.UV_INDEX_1,a.index);var n=new r(i.regName,i.index,0),l=new r(i.regName,i.index,1),h=new r(i.regName,i.index,2),p=new r(a.regName,a.index,0),d=new r(a.regName,a.index,1),c=new r(a.regName,a.index,2),u=t.getFreeVertexVectorTemp(),_=new r(u.regName,u.index,0),g=new r(u.regName,u.index,1);u=new r(u.regName,u.index,2);var m=new r(u.regName,u.index,3),y=new r(t.uvTarget.regName,t.uvTarget.index,0),f=new r(t.uvTarget.regName,t.uvTarget.index,1),b="";return b+="mul "+y+","+y+","+l+"\n",this._iNumRows>1&&(b+="mul "+f+","+f+","+h+"\n"),this._iUsesCycle?(b+=this._iUsesPhase?"add "+_+","+t.vertexTime+","+c+"\n":"mov "+_+","+t.vertexTime+"\n",b+="div "+_+","+_+","+d+"\n",b+="frc "+_+","+_+"\n",b+="mul "+_+","+_+","+d+"\n",b+="mul "+u+","+_+","+p+"\n"):b+="mul "+u.toString()+","+t.vertexLife+","+n+"\n",this._iNumRows>1&&(b+="frc "+m+","+u+"\n",b+="sub "+g+","+u+","+m+"\n",b+="mul "+g+","+g+","+h+"\n",b+="add "+f+","+f+","+g+"\n"),b+="div "+m+","+u+","+l+"\n",b+="frc "+u+","+m+"\n",b+="sub "+m+","+m+","+u+"\n",b+="mul "+u+","+m+","+l+"\n",this._iNumRows>1&&(b+="frc "+u+","+u+"\n"),b+="add "+y+","+y+","+u+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=!0},t.prototype._iGeneratePropertyOfOneParticle=function(e){if(this._iUsesCycle){var i=e[t.UV_VECTOR3D];if(!i)throw new Error("there is no "+t.UV_VECTOR3D+" in param!");if(i.x<=0)throw new Error("the cycle duration must be greater than zero");var r=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=r/i.x,this._pOneData[1]=i.x,this._iUsesPhase&&(this._pOneData[2]=i.y)}},t.UV_VECTOR3D="UVVector3D",t}(n);t.exports=l},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleTimeState"),n=function(e){function t(t,i,a){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),this._pStateClass=s,this._iUsesDuration=t,this._iUsesLooping=i,this._iUsesDelay=a,e.call(this,"ParticleTime",r.LOCAL_STATIC,4,0)}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexAttribute();t.setRegisterIndex(this,s.TIME_STREAM_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,s.TIME_CONSTANT_INDEX,r.index);var a="";a+="sub "+t.vertexTime+","+r+","+i+".x\n";var n=t.getFreeVertexSingleTemp();if(a+="sge "+n+","+t.vertexTime+","+t.vertexZeroConst+"\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+n+"\n",this._iUsesDuration)if(this._iUsesLooping){var o=t.getFreeVertexSingleTemp();this._iUsesDelay?(a+="div "+o+","+t.vertexTime+","+i+".z\n",a+="frc "+o+","+o+"\n",a+="mul "+t.vertexTime+","+o+","+i+".z\n",a+="slt "+o+","+t.vertexTime+","+i+".y\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+o+"\n"):(a+="mul "+o+","+t.vertexTime+","+i+".w\n",a+="frc "+o+","+o+"\n",a+="mul "+t.vertexTime+","+o+","+i+".y\n")}else{var l=t.getFreeVertexSingleTemp();a+="sge "+l+","+i+".y,"+t.vertexTime+"\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+l+"\n"}return a+="mul "+t.vertexLife+","+t.vertexTime+","+i+".w\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){this._pOneData[0]=e.startTime,this._pOneData[1]=e.duration,this._pOneData[2]=e.delay+e.duration,this._pOneData[3]=1/e.duration},t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleTimeState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleUVNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),l=e("awayjs-renderergl/lib/animators/states/ParticleUVState"),h=function(e){function t(t,i,r,a){void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a="x"),e.call(this,"ParticleUV",n.GLOBAL,4,s.POST_PRIORITY+1),this._pStateClass=l,this._cycle=i,this._scale=r,this._axis=a,this.updateUVData()}return i(t,e),Object.defineProperty(t.prototype,"cycle",{get:function(){return this._cycle},set:function(e){this._cycle=e,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"axis",{get:function(){return this._axis},set:function(e){this._axis=e},enumerable:!0,configurable:!0}),t.prototype.getAGALUVCode=function(e,t){var i="",r=t.getFreeVertexConstant();t.setRegisterIndex(this,l.UV_INDEX,r.index);var s="x"==this._axis?0:"y"==this._axis?1:2,n=new a(t.uvTarget.regName,t.uvTarget.index,s),o=t.getFreeVertexSingleTemp();return 1!=this._scale&&(i+="mul "+n+","+n+","+r+".y\n"),i+="mul "+o+","+t.vertexTime+","+r+".x\n",i+="sin "+o+","+o+"\n",i+="add "+n+","+n+","+o+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype.updateUVData=function(){this._iUvData=new r(2*Math.PI/this._cycle,this._scale,0,0)},t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=!0},t.U_AXIS="x",t.V_AXIS="y",t}(o);t.exports=h},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleUVState":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleVelocityState"),o=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleVelocity",t,3),this._pStateClass=n,this._iVelocity=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.VELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp(),s="";return s+="mul "+r+","+t.vertexTime+","+i+"\n",s+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n",t.needVelocity&&(s+="add "+t.velocityTarget+".xyz,"+i+".xyz,"+t.velocityTarget+".xyz\n"),s},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.VELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.VELOCITY_VECTOR3D="VelocityVector3D",t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleVelocityState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonClipState"),s=function(e){function t(){e.call(this),this._frames=new Array,this.highQuality=!1,this._pStateClass=a}return i(t,e),Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),t.prototype.addFrame=function(e,t){this._frames.push(e),this._pDurations.push(t),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,r,a=this._pNumFrames-1;a--;)this._pTotalDuration+=this._pDurations[a],t=this._frames[a].jointPoses[0].translation,i=this._frames[a+1].jointPoses[0].translation,r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z;(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._frames[0].jointPoses[0].translation,i=this._frames[1].jointPoses[0].translation,r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonClipState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonDifferenceState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonDirectionalState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState"),s=function(e){function t(){e.call(this),this._iInputs=new Array,this._pStateClass=a}return i(t,e),Object.defineProperty(t.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:!0,configurable:!0}),t.prototype.getInputIndex=function(e){return this._iInputs.indexOf(e)},t.prototype.getInputAt=function(e){return this._iInputs[e]},t.prototype.addInput=function(e){this._iInputs[this._numInputs++]=e},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":void 0}],"awayjs-renderergl/lib/animators/nodes/VertexClipNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase"),s=e("awayjs-renderergl/lib/animators/states/VertexClipState"),n=function(e){function t(){e.call(this),this._frames=new Array,this._translations=new Array,this._pStateClass=s}return i(t,e),Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),t.prototype.addFrame=function(e,t,i){void 0===i&&(i=null),this._frames.push(e),this._pDurations.push(t),this._translations.push(i||new r),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,r,a=this._pNumFrames-1;a--;)this._pTotalDuration+=this._pDurations[a],t=this._translations[a],i=this._translations[a+1],r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z;this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._translations[0],i=this._translations[1],r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z)},t}(a);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":void 0,"awayjs-renderergl/lib/animators/states/VertexClipState":void 0}],"awayjs-renderergl/lib/animators/states/AnimationClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),a=e("awayjs-renderergl/lib/events/AnimationStateEvent"),s=function(e){function t(t,i){e.call(this,t,i),this._pFramesDirty=!0,this._animationClipNode=i}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pBlendWeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pCurrentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pNextFrame},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this._animationClipNode.looping||(e>this._pStartTime+this._animationClipNode.totalDuration?e=this._pStartTime+this._animationClipNode.totalDuration:e<this._pStartTime&&(e=this._pStartTime)),this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},t.prototype.phase=function(e){var t=e*this._animationClipNode.totalDuration+this._pStartTime;this._pTime!=t-this._pStartTime&&this._pUpdateTime(t)},t.prototype._pUpdateTime=function(t){this._pFramesDirty=!0,this._pTimeDir=t-this._pStartTime>this._pTime?1:-1,e.prototype._pUpdateTime.call(this,t)},t.prototype._pUpdateFrames=function(){this._pFramesDirty=!1;var e=this._animationClipNode.looping,t=this._animationClipNode.totalDuration,i=this._animationClipNode.lastFrame,r=this._pTime;if(e&&(r>=t||0>r)&&(r%=t,0>r&&(r+=t)),!e&&r>=t)this.notifyPlaybackComplete(),this._pCurrentFrame=i,this._pNextFrame=i,this._pBlendWeight=0;else if(!e&&0>=r)this._pCurrentFrame=0,this._pNextFrame=0,this._pBlendWeight=0;else if(this._animationClipNode.fixedFrameRate){var a=r/t*i;this._pCurrentFrame=Math.floor(a),this._pBlendWeight=a-this._pCurrentFrame,this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0,this._pNextFrame=0;var s,n=0,o=this._animationClipNode.durations;do s=n,n+=o[this._pNextFrame],this._pCurrentFrame=this._pNextFrame++;while(r>n);this._pCurrentFrame==i&&(this._pCurrentFrame=0,this._pNextFrame=1),this._pBlendWeight=(r-s)/o[this._pCurrentFrame]}},t.prototype.notifyPlaybackComplete=function(){null==this._animationStatePlaybackComplete&&(this._animationStatePlaybackComplete=new a(a.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode)),this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0}],"awayjs-renderergl/lib/animators/states/AnimationStateBase":[function(e,t){var i=e("awayjs-core/lib/geom/Vector3D"),r=function(){function e(e,t){this._pRootDelta=new i,this._pPositionDeltaDirty=!0,this._pStartTime=0,this._pAnimator=e,this._pAnimationNode=t}return Object.defineProperty(e.prototype,"positionDelta",{get:function(){return this._pPositionDeltaDirty&&this._pUpdatePositionDelta(),this._pRootDelta},enumerable:!0,configurable:!0}),e.prototype.offset=function(e){this._pStartTime=e,this._pPositionDeltaDirty=!0},e.prototype.update=function(e){this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},e.prototype.phase=function(){},e.prototype._pUpdateTime=function(e){this._pTime=e-this._pStartTime,this._pPositionDeltaDirty=!0},e.prototype._pUpdatePositionDelta=function(){},e}();t.exports=r},{"awayjs-core/lib/geom/Vector3D":void 0}],"awayjs-renderergl/lib/animators/states/IAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/IVertexAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleAccelerationNode=i,this._acceleration=this._particleAccelerationNode._acceleration,this.updateAccelerationData()}return i(t,e),Object.defineProperty(t.prototype,"acceleration",{get:function(){return this._acceleration},set:function(e){this._acceleration.x=e.x,this._acceleration.y=e.y,this._acceleration.z=e.z,this.updateAccelerationData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){var o=n.getRegisterIndex(this._pAnimationNode,t.ACCELERATION_INDEX);this._particleAccelerationNode.mode==s.LOCAL_STATIC?r.activateVertexBuffer(o,this._particleAccelerationNode._iDataOffset,e,a.FLOAT_3):n.setVertexConst(o,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)},t.prototype.updateAccelerationData=function(){this._particleAccelerationNode.mode==s.GLOBAL&&(this._halfAcceleration=new r(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2))},t.ACCELERATION_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleBezierCurveNode=i,this._controlPoint=this._particleBezierCurveNode._iControlPoint,this._endPoint=this._particleBezierCurveNode._iEndPoint}return i(t,e),Object.defineProperty(t.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(e){this._controlPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endPoint",{get:function(){return this._endPoint},set:function(e){this._endPoint=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,s,n){var o=n.getRegisterIndex(this._pAnimationNode,t.BEZIER_CONTROL_INDEX),l=n.getRegisterIndex(this._pAnimationNode,t.BEZIER_END_INDEX);this._particleBezierCurveNode.mode==a.LOCAL_STATIC?(s.activateVertexBuffer(o,this._particleBezierCurveNode._iDataOffset,e,r.FLOAT_3),s.activateVertexBuffer(l,this._particleBezierCurveNode._iDataOffset+3,e,r.FLOAT_3)):(n.setVertexConst(o,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z),n.setVertexConst(l,this._endPoint.x,this._endPoint.y,this._endPoint.z))},t.BEZIER_CONTROL_INDEX=0,t.BEZIER_END_INDEX=1,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleBillboardState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/MathConsts"),a=e("awayjs-core/lib/geom/Matrix3D"),s=e("awayjs-core/lib/geom/Orientation3D"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._matrix=new a,this._billboardAxis=i._iBillboardAxis}return i(t,e),t.prototype.setRenderState=function(e,i,a,n,o){var l;if(this._billboardAxis){var h=i.sourceEntity.sceneTransform.position,p=o.sceneTransform.position.subtract(h),d=p.crossProduct(this._billboardAxis);d.normalize(),p=this.billboardAxis.crossProduct(d),p.normalize(),this._matrix.copyFrom(i.sourceEntity.sceneTransform),l=this._matrix.decompose(s.AXIS_ANGLE),this._matrix.copyColumnFrom(0,d),this._matrix.copyColumnFrom(1,this.billboardAxis),this._matrix.copyColumnFrom(2,p),this._matrix.copyColumnFrom(3,h),this._matrix.appendRotation(-l[1].w*r.RADIANS_TO_DEGREES,l[1])}else this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(o.inverseSceneTransform),l=this._matrix.decompose(s.AXIS_ANGLE),this._matrix.identity(),this._matrix.appendRotation(-l[1].w*r.RADIANS_TO_DEGREES,l[1]);n.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)},Object.defineProperty(t.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(e){this.billboardAxis=e?e.clone():null,this.billboardAxis&&this.billboardAxis.normalize()},enumerable:!0,configurable:!0}),t.MATRIX_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/MathConsts":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Orientation3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleColorNode=i,this._usesMultiplier=this._particleColorNode._iUsesMultiplier,this._usesOffset=this._particleColorNode._iUsesOffset,this._usesCycle=this._particleColorNode._iUsesCycle,this._usesPhase=this._particleColorNode._iUsesPhase,this._startColor=this._particleColorNode._iStartColor,this._endColor=this._particleColorNode._iEndColor,this._cycleDuration=this._particleColorNode._iCycleDuration,this._cyclePhase=this._particleColorNode._iCyclePhase,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateColorData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){if(n.needFragmentAnimation){var o=this._particleColorNode._iDataOffset;this._usesCycle&&n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w),this._usesMultiplier&&(this._particleColorNode.mode==s.LOCAL_STATIC?(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),o,e,a.FLOAT_4),o+=4,r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),o,e,a.FLOAT_4),o+=4):(n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w),n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w))),this._usesOffset&&(this._particleColorNode.mode==s.LOCAL_STATIC?(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),o,e,a.FLOAT_4),o+=4,r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),o,e,a.FLOAT_4),o+=4):(n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w),n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)))}},t.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new r(2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}this._particleColorNode.mode==s.GLOBAL&&(this._usesCycle?(this._usesMultiplier&&(this._startMultiplierData=new r((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2),this._deltaMultiplierData=new r((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)),this._usesOffset&&(this._startOffsetData=new r((this._startColor.redOffset+this._endColor.redOffset)/510,(this._startColor.greenOffset+this._endColor.greenOffset)/510,(this._startColor.blueOffset+this._endColor.blueOffset)/510,(this._startColor.alphaOffset+this._endColor.alphaOffset)/510),this._deltaOffsetData=new r((this._endColor.redOffset-this._startColor.redOffset)/510,(this._endColor.greenOffset-this._startColor.greenOffset)/510,(this._endColor.blueOffset-this._startColor.blueOffset)/510,(this._endColor.alphaOffset-this._startColor.alphaOffset)/510))):(this._usesMultiplier&&(this._startMultiplierData=new r(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),this._deltaMultiplierData=new r(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)),this._usesOffset&&(this._startOffsetData=new r(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),this._deltaOffsetData=new r((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255))))},t.START_MULTIPLIER_INDEX=0,t.DELTA_MULTIPLIER_INDEX=1,t.START_OFFSET_INDEX=2,t.DELTA_OFFSET_INDEX=3,t.CYCLE_INDEX=4,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleFollowState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/MathConsts"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i,!0),this._targetPos=new a,this._targetEuler=new a,this._temp=new a,this._particleFollowNode=i,this._smooth=i._iSmooth}return i(t,e),Object.defineProperty(t.prototype,"followTarget",{get:function(){return this._followTarget},set:function(e){this._followTarget=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smooth",{get:function(){return this._smooth},set:function(e){this._smooth=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,a,n){this._followTarget&&(this._particleFollowNode._iUsesPosition&&(this._targetPos.x=this._followTarget.transform.position.x/i.sourceEntity.scaleX,this._targetPos.y=this._followTarget.transform.position.y/i.sourceEntity.scaleY,this._targetPos.z=this._followTarget.transform.position.z/i.sourceEntity.scaleZ),this._particleFollowNode._iUsesRotation&&(this._targetEuler.x=this._followTarget.rotationX,this._targetEuler.y=this._followTarget.rotationY,this._targetEuler.z=this._followTarget.rotationZ,this._targetEuler.scaleBy(r.DEGREES_TO_RADIANS))),this._prePos||(this._prePos=this._targetPos.clone()),this._preEuler||(this._preEuler=this._targetEuler.clone());var o=this._pTime/1e3,l=a.previousTime,h=o-l,p=l!=o;this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation?(p&&this.processPositionAndRotation(o,h,a),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,e,s.FLOAT_3)):this._particleFollowNode._iUsesPosition?(p&&this.processPosition(o,h,a),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)):this._particleFollowNode._iUsesRotation&&(p&&this.precessRotation(o,h,a),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)),this._prePos.copyFrom(this._targetPos),this._targetEuler.copyFrom(this._targetEuler),a.previousTime=o
},t.prototype.processPosition=function(e,t,i){var r,a,s=i.animationParticles,n=i.vertexData,o=!1,l=s.length;this._smooth?(a=this._prePos.subtract(this._targetPos),a.scaleBy(1/t)):r=this._targetPos;for(var h=0;l>h;h++){var p=(e-s[h].startTime)/s[h].totalTime,d=(p-Math.floor(p))*s[h].totalTime;if(0>=d-t){var c=s[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(a),this._temp.scaleBy(d),r=this._targetPos.add(this._temp)),n[c]!=r.x||n[c+1]!=r.y||n[c+2]!=r.z){o=!0;for(var u=0;u<s[h].numVertices;u++)n[c++]=r.x,n[c++]=r.y,n[c++]=r.z}}}o&&i.invalidateBuffer()},t.prototype.precessRotation=function(e,t,i){var r,a,s=i.animationParticles,n=i.vertexData,o=!1,l=s.length;this._smooth?(a=this._preEuler.subtract(this._targetEuler),a.scaleBy(1/t)):r=this._targetEuler;for(var h=0;l>h;h++){var p=(e-s[h].startTime)/s[h].totalTime,d=(p-Math.floor(p))*s[h].totalTime;if(0>=d-t){var c=s[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(a),this._temp.scaleBy(d),r=this._targetEuler.add(this._temp)),n[c]!=r.x||n[c+1]!=r.y||n[c+2]!=r.z){o=!0;for(var u=0;u<s[h].numVertices;u++)n[c++]=r.x,n[c++]=r.y,n[c++]=r.z}}}o&&i.invalidateBuffer()},t.prototype.processPositionAndRotation=function(e,t,i){var r,a,s,n,o=i.animationParticles,l=i.vertexData,h=!1,p=o.length;this._smooth?(s=this._prePos.subtract(this._targetPos),s.scaleBy(1/t),n=this._preEuler.subtract(this._targetEuler),n.scaleBy(1/t)):(r=this._targetPos,a=this._targetEuler);for(var d=0;p>d;d++){var c=(e-o[d].startTime)/o[d].totalTime,u=(c-Math.floor(c))*o[d].totalTime;if(0>=u-t){var _=o[d].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(s),this._temp.scaleBy(u),r=this._targetPos.add(this._temp),this._temp.copyFrom(n),this._temp.scaleBy(u),a=this._targetEuler.add(this._temp)),l[_]!=r.x||l[_+1]!=r.y||l[_+2]!=r.z||l[_+3]!=a.x||l[_+4]!=a.y||l[_+5]!=a.z){h=!0;for(var g=0;g<o[d].numVertices;g++)l[_++]=r.x,l[_++]=r.y,l[_++]=r.z,l[_++]=a.x,l[_++]=a.y,l[_++]=a.z}}}h&&i.invalidateBuffer()},t.FOLLOW_POSITION_INDEX=0,t.FOLLOW_ROTATION_INDEX=1,t}(n);t.exports=o},{"awayjs-core/lib/geom/MathConsts":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleInitialColorNode=i,this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._initialColor=i._iInitialColor,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"initialColor",{get:function(){return this._initialColor},set:function(e){this._initialColor=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n,o){if(i=i,o=o,n.needFragmentAnimation)if(this._particleInitialColorNode.mode==s.LOCAL_STATIC){var l=this._particleInitialColorNode._iDataOffset;this._usesMultiplier&&(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),l,e,a.FLOAT_4),l+=4),this._usesOffset&&r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),l,e,a.FLOAT_4)}else this._usesMultiplier&&n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w),this._usesOffset&&n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)},t.prototype.updateColorData=function(){this._particleInitialColorNode.mode==s.GLOBAL&&(this._usesMultiplier&&(this._multiplierData=new r(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier)),this._usesOffset&&(this._offsetData=new r(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)))},t.MULTIPLIER_INDEX=0,t.OFFSET_INDEX=1,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleOrbitState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),l=function(e){function t(t,i){e.call(this,t,i),this._particleOrbitNode=i,this._usesEulers=this._particleOrbitNode._iUsesEulers,this._usesCycle=this._particleOrbitNode._iUsesCycle,this._usesPhase=this._particleOrbitNode._iUsesPhase,this._eulers=this._particleOrbitNode._iEulers,this._radius=this._particleOrbitNode._iRadius,this._cycleDuration=this._particleOrbitNode._iCycleDuration,this._cyclePhase=this._particleOrbitNode._iCyclePhase,this.updateOrbitData()}return i(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eulers",{get:function(){return this._eulers},set:function(e){this._eulers=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,a){var o=a.getRegisterIndex(this._pAnimationNode,t.ORBIT_INDEX);this._particleOrbitNode.mode==n.LOCAL_STATIC?this._usesPhase?r.activateVertexBuffer(o,this._particleOrbitNode._iDataOffset,e,s.FLOAT_4):r.activateVertexBuffer(o,this._particleOrbitNode._iDataOffset,e,s.FLOAT_3):a.setVertexConst(o,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w),this._usesEulers&&a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.EULERS_INDEX),this._eulersMatrix)},t.prototype.updateOrbitData=function(){if(this._usesEulers&&(this._eulersMatrix=new r,this._eulersMatrix.appendRotation(this._eulers.x,a.X_AXIS),this._eulersMatrix.appendRotation(this._eulers.y,a.Y_AXIS),this._eulersMatrix.appendRotation(this._eulers.z,a.Z_AXIS)),this._particleOrbitNode.mode==n.GLOBAL)if(this._orbitData=new a(this._radius,0,this._radius*Math.PI*2,this._cyclePhase*Math.PI/180),this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=2*Math.PI/this._cycleDuration}else this._orbitData.y=2*Math.PI},t.ORBIT_INDEX=0,t.EULERS_INDEX=1,t}(o);t.exports=l},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleOscillatorNode=i,this._oscillator=this._particleOscillatorNode._iOscillator,this.updateOscillatorData()}return i(t,e),Object.defineProperty(t.prototype,"oscillator",{get:function(){return this._oscillator},set:function(e){this._oscillator=e,this.updateOscillatorData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){var o=n.getRegisterIndex(this._pAnimationNode,t.OSCILLATOR_INDEX);this._particleOscillatorNode.mode==s.LOCAL_STATIC?r.activateVertexBuffer(o,this._particleOscillatorNode._iDataOffset,e,a.FLOAT_4):n.setVertexConst(o,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)},t.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==s.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");null==this._oscillatorData&&(this._oscillatorData=new r),this._oscillatorData.x=this._oscillator.x,this._oscillatorData.y=this._oscillator.y,this._oscillatorData.z=this._oscillator.z,this._oscillatorData.w=2*Math.PI/this._oscillator.w}},t.OSCILLATOR_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticlePositionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particlePositionNode=i,this._position=this._particlePositionNode._iPosition}return i(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.getPositions=function(){return this._pDynamicProperties},t.prototype.setPositions=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,s,n){this._particlePositionNode.mode!=a.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[s._iUniqueId]||this._pUpdateDynamicProperties(s);var o=n.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);this._particlePositionNode.mode==a.GLOBAL?n.setVertexConst(o,this._position.x,this._position.y,this._position.z):s.activateVertexBuffer(o,this._particlePositionNode._iDataOffset,e,r.FLOAT_3)},t.POSITION_INDEX=0,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),s=function(e){function t(t,i){e.call(this,t,i),this._matrix=new r}return i(t,e),t.prototype.setRenderState=function(e,i,r,a,s){a.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(s.inverseSceneTransform),a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix))},t.MATRIX_INDEX=0,t}(a);t.exports=s},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._matrix=new r,this._particleRotateToPositionNode=i,this._position=this._particleRotateToPositionNode._iPosition}return i(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n,o){var l=n.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);n.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(o.inverseSceneTransform),n.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)),this._particleRotateToPositionNode.mode==s.GLOBAL?(this._offset=i.sourceEntity.inverseSceneTransform.transformVector(this._position),n.setVertexConst(l,this._offset.x,this._offset.y,this._offset.z)):r.activateVertexBuffer(l,this._particleRotateToPositionNode._iDataOffset,e,a.FLOAT_3)},t.MATRIX_INDEX=0,t.POSITION_INDEX=1,t}(n);t.exports=o},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleRotationalVelocityNode=i,this._rotationalVelocity=this._particleRotationalVelocityNode._iRotationalVelocity,this.updateRotationalVelocityData()}return i(t,e),Object.defineProperty(t.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(e){this._rotationalVelocity=e,this.updateRotationalVelocityData()},enumerable:!0,configurable:!0}),t.prototype.getRotationalVelocities=function(){return this._pDynamicProperties},t.prototype.setRotationalVelocities=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,r,n){this._particleRotationalVelocityNode.mode!=s.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var o=n.getRegisterIndex(this._pAnimationNode,t.ROTATIONALVELOCITY_INDEX);this._particleRotationalVelocityNode.mode==s.GLOBAL?n.setVertexConst(o,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w):r.activateVertexBuffer(o,this._particleRotationalVelocityNode._iDataOffset,e,a.FLOAT_4)},t.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==s.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var e=this._rotationalVelocity.clone();e.length<=0?e.z=1:e.normalize(),this._rotationalVelocityData=new r(e.x,e.y,e.z,Math.PI/e.w)}},t.ROTATIONALVELOCITY_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleScaleState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleScaleNode=i,this._usesCycle=this._particleScaleNode._iUsesCycle,this._usesPhase=this._particleScaleNode._iUsesPhase,this._minScale=this._particleScaleNode._iMinScale,this._maxScale=this._particleScaleNode._iMaxScale,this._cycleDuration=this._particleScaleNode._iCycleDuration,this._cyclePhase=this._particleScaleNode._iCyclePhase,this.updateScaleData()}return i(t,e),Object.defineProperty(t.prototype,"minScale",{get:function(){return this._minScale},set:function(e){this._minScale=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateScaleData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){var o=n.getRegisterIndex(this._pAnimationNode,t.SCALE_INDEX);this._particleScaleNode.mode==s.LOCAL_STATIC?this._usesCycle?this._usesPhase?r.activateVertexBuffer(o,this._particleScaleNode._iDataOffset,e,a.FLOAT_4):r.activateVertexBuffer(o,this._particleScaleNode._iDataOffset,e,a.FLOAT_3):r.activateVertexBuffer(o,this._particleScaleNode._iDataOffset,e,a.FLOAT_2):n.setVertexConst(o,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)},t.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==s.GLOBAL)if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new r((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new r(this._minScale,this._maxScale-this._minScale,0,0)},t.SCALE_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),a=function(e){function t(t,i){e.call(this,t,i),this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._startColor=i._iStartColor,this._endColor=i._iEndColor,this._segmentPoints=i._iSegmentPoints,this._numSegmentPoint=i._iNumSegmentPoint,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(e){this._segmentPoints=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,a){a.needFragmentAnimation&&(this._numSegmentPoint>0&&a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]),this._usesMultiplier&&a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._multiplierData),this._usesOffset&&a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._offsetData))},t.prototype.updateColorData=function(){this._timeLifeData=new Array,this._multiplierData=new Array,this._offsetData=new Array;var e;for(e=0;e<this._numSegmentPoint;e++)this._timeLifeData.push(0==e?this._segmentPoints[e].life:this._segmentPoints[e].life-this._segmentPoints[e-1].life);if(this._timeLifeData.push(0==this._numSegmentPoint?1:1-this._segmentPoints[e-1].life),this._usesMultiplier){for(this._multiplierData.push(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),e=0;e<this._numSegmentPoint;e++)0==e?this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[e]):this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e]);0==this._numSegmentPoint?this._multiplierData.push(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier):this._multiplierData.push((this._endColor.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._endColor.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._endColor.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._endColor.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e])}if(this._usesOffset){for(this._offsetData.push(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),e=0;e<this._numSegmentPoint;e++)0==e?this._offsetData.push((this._segmentPoints[e].color.redOffset-this._startColor.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[e]/255):this._offsetData.push((this._segmentPoints[e].color.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255);0==this._numSegmentPoint?this._offsetData.push((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255):this._offsetData.push((this._endColor.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._endColor.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._endColor.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._endColor.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255)}this._timeLifeData.length=4},t.START_MULTIPLIER_INDEX=0,t.START_OFFSET_INDEX=1,t.TIME_DATA_INDEX=2,t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleSpriteSheetNode=i,this._usesCycle=this._particleSpriteSheetNode._iUsesCycle,this._usesPhase=this._particleSpriteSheetNode._iUsesCycle,this._totalFrames=this._particleSpriteSheetNode._iTotalFrames,this._numColumns=this._particleSpriteSheetNode._iNumColumns,this._numRows=this._particleSpriteSheetNode._iNumRows,this._cycleDuration=this._particleSpriteSheetNode._iCycleDuration,this._cyclePhase=this._particleSpriteSheetNode._iCyclePhase,this.updateSpriteSheetData()}return i(t,e),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,s,n){if(n.needUVAnimation&&(n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]),this._usesCycle)){var o=n.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_1);this._particleSpriteSheetNode.mode==a.LOCAL_STATIC?this._usesPhase?s.activateVertexBuffer(o,this._particleSpriteSheetNode._iDataOffset,e,r.FLOAT_3):s.activateVertexBuffer(o,this._particleSpriteSheetNode._iDataOffset,e,r.FLOAT_2):n.setVertexConst(o,this._spriteSheetData[4],this._spriteSheetData[5])}},t.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var e=this._totalFrames/this._numColumns;if(this._spriteSheetData[0]=e,this._spriteSheetData[1]=1/this._numColumns,this._spriteSheetData[2]=1/this._numRows,this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=e/this._cycleDuration,this._spriteSheetData[5]=this._cycleDuration,this._usesPhase&&(this._spriteSheetData[6]=this._cyclePhase)}},t.UV_INDEX_0=0,t.UV_INDEX_1=1,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleStateBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),a=function(e){function t(t,i,r){void 0===r&&(r=!1),e.call(this,t,i),this._pDynamicProperties=new Array,this._pDynamicPropertiesDirty=new Object,this._particleNode=i,this._pNeedUpdateTime=r}return i(t,e),Object.defineProperty(t.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(){},t.prototype._pUpdateDynamicProperties=function(e){this._pDynamicPropertiesDirty[e._iUniqueId]=!0;for(var t,i,r,a,s,n=e.animationParticles,o=e.vertexData,l=e.totalLenOfOneVertex,h=this._particleNode.dataLength,p=this._particleNode._iDataOffset,d=this._pDynamicProperties.length,c=0,u=0,_=0;d>c;){for(;d>u&&(s=n[u]).index==c;){for(a=this._pDynamicProperties[c],t=s.numVertices*l,i=s.startVertexIndex*l+p,_=0;t>_;_+=l)for(r=i+_,_=0;t>_;_+=l)r=i+_,o[r++]=a.x,o[r++]=a.y,o[r++]=a.z,4==h&&(o[r++]=a.w);u++}c++}e.invalidateBuffer()},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleTimeState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),s=function(e){function t(t,i){e.call(this,t,i,!0),this._particleTimeNode=i}return i(t,e),t.prototype.setRenderState=function(e,i,a,s){a.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,e,r.FLOAT_4);var n=this._pTime/1e3;s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,t.TIME_CONSTANT_INDEX),n,n,n,n)},t.TIME_STREAM_INDEX=0,t.TIME_CONSTANT_INDEX=1,t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleUVState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),a=function(e){function t(t,i){e.call(this,t,i),this._particleUVNode=i}return i(t,e),t.prototype.setRenderState=function(e,i,r,a){if(a.needUVAnimation){var s=a.getRegisterIndex(this._pAnimationNode,t.UV_INDEX),n=this._particleUVNode._iUvData;a.setVertexConst(s,n.x,n.y)}},t.UV_INDEX=0,t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleVelocityState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleVelocityNode=i,this._velocity=this._particleVelocityNode._iVelocity}return i(t,e),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity=e},enumerable:!0,configurable:!0}),t.prototype.getVelocities=function(){return this._pDynamicProperties},t.prototype.setVelocities=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,s,n){this._particleVelocityNode.mode!=a.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[s._iUniqueId]||this._pUpdateDynamicProperties(s);var o=n.getRegisterIndex(this._pAnimationNode,t.VELOCITY_INDEX);this._particleVelocityNode.mode==a.GLOBAL?n.setVertexConst(o,this._velocity.x,this._velocity.y,this._velocity.z):s.activateVertexBuffer(o,this._particleVelocityNode._iDataOffset,e,r.FLOAT_3)
},t.VELOCITY_INDEX=0,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._blendWeight=0,this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=i,this._inputA=t.getAnimationState(this._skeletonAnimationNode.inputA),this._inputB=t.getAnimationState(this._skeletonAnimationNode.inputB)}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(e),this._inputB.phase(e)},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e=this._inputA.positionDelta,t=this._inputB.positionDelta;this._pRootDelta.x=e.x+this._blendWeight*(t.x-e.x),this._pRootDelta.y=e.y+this._blendWeight*(t.y-e.y),this._pRootDelta.z=e.z+this._blendWeight*(t.z-e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var t,i,a,s,n,o,l=this._skeletonPose.jointPoses,h=this._inputA.getSkeletonPose(e).jointPoses,p=this._inputB.getSkeletonPose(e).jointPoses,d=e.numJoints;l.length!=d&&(l.length=d);for(var c=0;d>c;++c)t=l[c],null==t&&(t=l[c]=new r),i=h[c],a=p[c],s=i.translation,n=a.translation,t.orientation.lerp(i.orientation,a.orientation,this._blendWeight),o=t.translation,o.x=s.x+this._blendWeight*(n.x-s.x),o.y=s.y+this._blendWeight*(n.y-s.y),o.z=s.z+this._blendWeight*(n.z-s.z)},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/JointPose"),s=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),n=e("awayjs-renderergl/lib/animators/states/AnimationClipState"),o=function(e){function t(t,i){e.call(this,t,i),this._rootPos=new r,this._skeletonPose=new s,this._skeletonPoseDirty=!0,this._skeletonClipNode=i,this._frames=this._skeletonClipNode.frames}return i(t,e),Object.defineProperty(t.prototype,"currentPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentPose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextPose},enumerable:!0,configurable:!0}),t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,e.prototype._pUpdateTime.call(this,t)},t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this),this._currentPose=this._frames[this._pCurrentFrame],this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame?(this._nextPose=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextPose=this._frames[this._pNextFrame]},t.prototype.updateSkeletonPose=function(e){if(this._skeletonPoseDirty=!1,this._skeletonClipNode.totalDuration){this._pFramesDirty&&this._pUpdateFrames();var t,i,r,s,n,o,l=this._currentPose.jointPoses,h=this._nextPose.jointPoses,p=e.numJoints,d=this._skeletonPose.jointPoses;if(d.length!=p&&(d.length=p),p!=l.length||p!=h.length)throw new Error("joint counts don't match!");for(var c=0;p>c;++c)n=d[c],null==n&&(n=d[c]=new a),r=l[c],s=h[c],t=r.translation,i=s.translation,this._skeletonClipNode.highQuality?n.orientation.slerp(r.orientation,s.orientation,this._pBlendWeight):n.orientation.lerp(r.orientation,s.orientation,this._pBlendWeight),c>0&&(o=n.translation,o.x=t.x+this._pBlendWeight*(i.x-t.x),o.y=t.y+this._pBlendWeight*(i.y-t.y),o.z=t.z+this._pBlendWeight*(i.z-t.z))}},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._pFramesDirty&&this._pUpdateFrames();var e,t,i,r=this._skeletonClipNode.totalDelta;(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame)&&(this._rootPos.x-=r.x*this._pTimeDir,this._rootPos.y-=r.y*this._pTimeDir,this._rootPos.z-=r.z*this._pTimeDir);var a=this._rootPos.x,s=this._rootPos.y,n=this._rootPos.z;this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame?(e=this._frames[0].jointPoses[0].translation,t=this._frames[1].jointPoses[0].translation,i=this._currentPose.jointPoses[0].translation,this._rootPos.x=i.x+e.x+this._pBlendWeight*(t.x-e.x),this._rootPos.y=i.y+e.y+this._pBlendWeight*(t.y-e.y),this._rootPos.z=i.z+e.z+this._pBlendWeight*(t.z-e.z)):(e=this._currentPose.jointPoses[0].translation,t=this._frames[this._pNextFrame].jointPoses[0].translation,this._rootPos.x=e.x+this._pBlendWeight*(t.x-e.x),this._rootPos.y=e.y+this._pBlendWeight*(t.y-e.y),this._rootPos.z=e.z+this._pBlendWeight*(t.z-e.z)),this._pRootDelta.x=this._rootPos.x-a,this._pRootDelta.y=this._rootPos.y-s,this._pRootDelta.z=this._rootPos.z-n,this._pOldFrame=this._pNextFrame},t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationClipState":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-renderergl/lib/animators/data/JointPose"),s=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),n=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._blendWeight=0,this._skeletonPose=new s,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=i,this._baseInput=t.getAnimationState(this._skeletonAnimationNode.baseInput),this._differenceInput=t.getAnimationState(this._skeletonAnimationNode.differenceInput)}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._baseInput.phase(e),this._baseInput.phase(e)},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,this._baseInput.update(t),this._differenceInput.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e=this._baseInput.positionDelta,t=this._differenceInput.positionDelta;this.positionDelta.x=e.x+this._blendWeight*t.x,this.positionDelta.y=e.y+this._blendWeight*t.y,this.positionDelta.z=e.z+this._blendWeight*t.z},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var i,r,s,n,o,l,h=this._skeletonPose.jointPoses,p=this._baseInput.getSkeletonPose(e).jointPoses,d=this._differenceInput.getSkeletonPose(e).jointPoses,c=e.numJoints;h.length!=c&&(h.length=c);for(var u=0;c>u;++u)i=h[u],null==i&&(i=h[u]=new a),r=p[u],s=d[u],n=r.translation,o=s.translation,t._tempQuat.multiply(s.orientation,r.orientation),i.orientation.lerp(r.orientation,t._tempQuat,this._blendWeight),l=i.translation,l.x=n.x+this._blendWeight*o.x,l.y=n.y+this._blendWeight*o.y,l.z=n.z+this._blendWeight*o.z},t._tempQuat=new r,t}(n);t.exports=o},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._blendWeight=0,this._direction=0,this._blendDirty=!0,this._skeletonAnimationNode=i,this._forward=t.getAnimationState(this._skeletonAnimationNode.forward),this._backward=t.getAnimationState(this._skeletonAnimationNode.backward),this._left=t.getAnimationState(this._skeletonAnimationNode.left),this._right=t.getAnimationState(this._skeletonAnimationNode.right)}return i(t,e),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._direction!=e&&(this._direction=e,this._blendDirty=!0,this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(e),this._inputB.phase(e)},t.prototype._pUdateTime=function(t){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._blendDirty&&this.updateBlend();var e=this._inputA.positionDelta,t=this._inputB.positionDelta;this.positionDelta.x=e.x+this._blendWeight*(t.x-e.x),this.positionDelta.y=e.y+this._blendWeight*(t.y-e.y),this.positionDelta.z=e.z+this._blendWeight*(t.z-e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1,this._blendDirty&&this.updateBlend();var t,i,a,s,n,o,l=this._skeletonPose.jointPoses,h=this._inputA.getSkeletonPose(e).jointPoses,p=this._inputB.getSkeletonPose(e).jointPoses,d=e.numJoints;l.length!=d&&(l.length=d);for(var c=0;d>c;++c)t=l[c],null==t&&(t=l[c]=new r),i=h[c],a=p[c],s=i.translation,n=a.translation,t.orientation.lerp(i.orientation,a.orientation,this._blendWeight),o=t.translation,o.x=s.x+this._blendWeight*(n.x-s.x),o.y=s.y+this._blendWeight*(n.y-s.y),o.z=s.z+this._blendWeight*(n.z-s.z)},t.prototype.updateBlend=function(){this._blendDirty=!1,(this._direction<0||this._direction>360)&&(this._direction%=360,this._direction<0&&(this._direction+=360)),this._direction<90?(this._inputA=this._forward,this._inputB=this._right,this._blendWeight=this._direction/90):this._direction<180?(this._inputA=this._right,this._inputB=this._backward,this._blendWeight=(this._direction-90)/90):this._direction<270?(this._inputA=this._backward,this._inputB=this._left,this._blendWeight=(this._direction-180)/90):(this._inputA=this._left,this._inputB=this._forward,this._blendWeight=(this._direction-270)/90)},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._blendWeights=new Array,this._inputs=new Array,this._skeletonAnimationNode=i;for(var r=this._skeletonAnimationNode.numInputs;r--;)this._inputs[r]=t.getAnimationState(this._skeletonAnimationNode._iInputs[r])}return i(t,e),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0;for(var t=0;t<this._skeletonAnimationNode.numInputs;++t)this._blendWeights[t]&&this._inputs[t].update(e)},t.prototype._pUdateTime=function(t){for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)this._blendWeights[i]&&this._inputs[i].update(t);e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype.getBlendWeightAt=function(e){return this._blendWeights[e]},t.prototype.setBlendWeightAt=function(e,t){this._blendWeights[e]=t,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e,t;this.positionDelta.x=0,this.positionDelta.y=0,this.positionDelta.z=0;for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)t=this._blendWeights[i],t&&(e=this._inputs[i].positionDelta,this.positionDelta.x+=t*e.x,this.positionDelta.y+=t*e.y,this.positionDelta.z+=t*e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var t,i,a,s,n,o,l,h,p,d,c,u,_,g,m,y,f,b,x=this._skeletonPose.jointPoses,v=e.numJoints;x.length!=v&&(x.length=v);for(var w=0;w<this._skeletonAnimationNode.numInputs;++w)if(t=this._blendWeights[w])if(i=this._inputs[w].getSkeletonPose(e).jointPoses,p)for(d=0;d<e.numJoints;++d)a=x[d],s=i[d],h=p[d].orientation,u=h.x,_=h.y,g=h.z,c=h.w,h=s.orientation,o=s.translation,y=h.x,f=h.y,b=h.z,m=h.w,0>u*y+_*f+g*b+c*m&&(y=-y,f=-f,b=-b,m=-m),l=a.orientation,l.x+=t*y,l.y+=t*f,l.z+=t*b,l.w+=t*m,n=a.translation,n.x+=t*o.x,n.y+=t*o.y,n.z+=t*o.z;else for(p=i,d=0;v>d;++d)a=x[d],null==a&&(a=x[d]=new r),s=i[d],h=s.orientation,o=s.translation,l=a.orientation,l.x=t*h.x,l.y=t*h.y,l.z=t*h.z,l.w=t*h.w,n=a.translation,n.x=t*o.x,n.y=t*o.y,n.z=t*o.z;for(d=0;d<e.numJoints;++d)x[d].orientation.normalize()},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/VertexClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationClipState"),a=function(e){function t(t,i){e.call(this,t,i),this._vertexClipNode=i,this._frames=this._vertexClipNode.frames}return i(t,e),Object.defineProperty(t.prototype,"currentGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentGeometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextGeometry},enumerable:!0,configurable:!0}),t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this),this._currentGeometry=this._frames[this._pCurrentFrame],this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame?(this._nextGeometry=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextGeometry=this._frames[this._pNextFrame]},t.prototype._pUpdatePositionDelta=function(){},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/AnimationClipState":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode"),a=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":void 0,"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState"),a=e("awayjs-renderergl/lib/events/AnimationStateEvent"),s=function(e){function t(t,i){e.call(this,t,i),this._crossfadeTransitionNode=i}return i(t,e),t.prototype._pUpdateTime=function(t){this.blendWeight=Math.abs(t-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed),this.blendWeight>=1&&(this.blendWeight=1,null==this._animationStateTransitionComplete&&(this._animationStateTransitionComplete=new a(a.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode)),this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)),e.prototype._pUpdateTime.call(this,t)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransition":[function(e,t){var i=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode"),r=function(){function e(e){this.blendSpeed=.5,this.blendSpeed=e}return e.prototype.getAnimationNode=function(e,t,r,a){var s=new i;return s.inputA=t,s.inputB=r,s.blendSpeed=this.blendSpeed,s.startBlend=a,s},e}();t.exports=r},{"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":void 0}],"awayjs-renderergl/lib/animators/transitions/IAnimationTransition":[function(){},{}],"awayjs-renderergl/lib/base/ParticleGeometry":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/Geometry"),a=function(e){function t(){e.apply(this,arguments)}return i(t,e),t}(r);t.exports=a},{"awayjs-display/lib/base/Geometry":void 0}],"awayjs-renderergl/lib/compilation/RegisterPool":[function(e,t){var i=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),r=function(){function e(e,t,i){void 0===i&&(i=!0),this._regName=e,this._regCount=t,this._persistent=i,this.initRegisters(e,t)}return e.prototype.requestFreeVectorReg=function(){for(var e=0;e<this._regCount;++e)if(!this.isRegisterUsed(e))return this._persistent&&this._usedVectorCount[e]++,this._vectorRegisters[e];throw new Error("Register overflow!")},e.prototype.requestFreeRegComponent=function(){for(var e=0;e<this._regCount;++e)if(!(this._usedVectorCount[e]>0))for(var t=0;4>t;++t)if(0==this._usedSingleCount[t][e])return this._persistent&&this._usedSingleCount[t][e]++,this._registerComponents[t][e];throw new Error("Register overflow!")},e.prototype.addUsage=function(e,t){e._component>-1?this._usedSingleCount[e._component][e.index]+=t:this._usedVectorCount[e.index]+=t},e.prototype.removeUsage=function(e){if(e._component>-1){if(--this._usedSingleCount[e._component][e.index]<0)throw new Error("More usages removed than exist!")}else if(--this._usedVectorCount[e.index]<0)throw new Error("More usages removed than exist!")},e.prototype.dispose=function(){this._vectorRegisters=null,this._registerComponents=null,this._usedSingleCount=null,this._usedVectorCount=null},e.prototype.hasRegisteredRegs=function(){for(var e=0;e<this._regCount;++e)if(this.isRegisterUsed(e))return!0;return!1},e.prototype.initRegisters=function(t,i){var r=e._initPool(t,i);this._vectorRegisters=e._regPool[r],this._registerComponents=e._regCompsPool[r],this._usedVectorCount=this._initArray(Array(i),0),this._usedSingleCount=new Array(4),this._usedSingleCount[0]=this._initArray(new Array(i),0),this._usedSingleCount[1]=this._initArray(new Array(i),0),this._usedSingleCount[2]=this._initArray(new Array(i),0),this._usedSingleCount[3]=this._initArray(new Array(i),0)},e._initPool=function(t,r){var a=t+r;if(void 0!=e._regPool[a])return a;var s=new Array(r);e._regPool[a]=s;var n=[[],[],[],[]];e._regCompsPool[a]=n;for(var o=0;r>o;++o){s[o]=new i(t,o);for(var l=0;4>l;++l)n[l][o]=new i(t,o,l)}return a},e.prototype.isRegisterUsed=function(e){if(this._usedVectorCount[e]>0)return!0;for(var t=0;4>t;++t)if(this._usedSingleCount[t][e]>0)return!0;return!1},e.prototype._initArray=function(e,t){for(var i=e.length,r=0;i>r;r++)e[r]=t;return e},e._regPool=new Object,e._regCompsPool=new Object,e}();t.exports=r},{"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/compilation/ShaderCompilerBase":[function(e,t){var i=e("awayjs-renderergl/lib/compilation/ShaderRegisterCache"),r=e("awayjs-renderergl/lib/compilation/ShaderRegisterData"),a=function(){function e(e,t,a){this._pVertexCode="",this._pFragmentCode="",this._pPostAnimationFragmentCode="",this._pMaterial=e,this._pMaterialPass=t,this._pShaderObject=a,this._pProfile=a.profile,this._pSharedRegisters=new r,this._pRegisterCache=new i(this._pProfile),this._pRegisterCache.vertexAttributesOffset=1,this._pRegisterCache.reset()}return e.prototype.compile=function(){this._pShaderObject.reset(),this.pCalculateDependencies(),this.pInitRegisterIndices(),this.pCompileDependencies(),this._pVertexCode+=this._pMaterialPass._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pPostAnimationFragmentCode+=this._pMaterialPass._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pPostAnimationFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister+", "+this._pSharedRegisters.shadedTarget+"\n",this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget),this._pShaderObject.initConstantData(this._pRegisterCache,this._pAnimatableAttributes,this._pAnimationTargetRegisters,this._uvSource,this._uvTarget),this._pMaterialPass._iInitConstantData(this._pShaderObject)},e.prototype.pCompileDependencies=function(){this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1),this._pShaderObject.globalPosDependencies>0&&this.compileGlobalPositionCode(),this._pShaderObject.uvDependencies>0&&this.compileUVCode(),this._pShaderObject.secondaryUVDependencies>0&&this.compileSecondaryUVCode(),this._pShaderObject.normalDependencies>0&&this.compileNormalCode(),this._pShaderObject.viewDirDependencies>0&&this.compileViewDirCode(),this._pVertexCode+=this._pMaterial._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._pMaterial._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pVertexCode+=this._pMaterialPass._iGetPreLightingVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._pMaterialPass._iGetPreLightingFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)},e.prototype.compileGlobalPositionCode=function(){this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp(),this._pShaderObject.globalPosDependencies);var e=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pShaderObject.sceneMatrixIndex=4*e.index,this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex+", "+this._pSharedRegisters.localPosition+", "+e+"\n",this._pShaderObject.usesGlobalPosFragment&&(this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying+", "+this._pSharedRegisters.globalPositionVertex+"\n")},e.prototype.compileUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.uvBufferIndex=e.index;var t=this._pRegisterCache.getFreeVarying();if(this._pSharedRegisters.uvVarying=t,this._pShaderObject.usesUVTransform){var i=this._pRegisterCache.getFreeVertexConstant(),r=this._pRegisterCache.getFreeVertexConstant();this._pShaderObject.uvTransformIndex=4*i.index,this._pVertexCode+="dp4 "+t+".x, "+e+", "+i+"\ndp4 "+t+".y, "+e+", "+r+"\nmov "+t+".zw, "+e+".zw \n"}else this._pShaderObject.uvTransformIndex=-1,this._uvTarget=t.toString(),this._uvSource=e.toString()},e.prototype.compileSecondaryUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.secondaryUVBufferIndex=e.index,this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.secondaryUVVarying+", "+e+"\n"},e.prototype.compileViewDirCode=function(){var e=this._pRegisterCache.getFreeVertexConstant();if(this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pShaderObject.viewDirDependencies),this._pShaderObject.cameraPositionIndex=4*e.index,this._pShaderObject.usesTangentSpace){var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+t+", "+e+", "+this._pSharedRegisters.localPosition+"\nm33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+t+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+e+", "+this._pSharedRegisters.globalPositionVertex+"\n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\nmov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w\n"},e.prototype.compileNormalCode=function(){if(this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pShaderObject.normalDependencies),this._pShaderObject.outputsNormals&&!this._pShaderObject.outputsTangentNormals)return this._pVertexCode+=this._pMaterialPass._iGetNormalVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),void(this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters));var e;if(this._pShaderObject.outputsNormals&&this._pShaderObject.usesTangentSpace||(e=new Array(3),e[0]=this._pRegisterCache.getFreeVertexConstant(),e[1]=this._pRegisterCache.getFreeVertexConstant(),e[2]=this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pShaderObject.sceneNormalMatrixIndex=4*e[0].index,this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying()),this._pShaderObject.outputsNormals)if(this._pShaderObject.usesTangentSpace)this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\ncrs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n",this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);else{this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="m33 "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\nnrm "+this._pSharedRegisters.animatedNormal+".xyz, "+t+"\nm33 "+t+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+t+"\nmov "+this._pSharedRegisters.tangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".x  \nmov "+this._pSharedRegisters.tangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".x  \nmov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.bitangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.normalVarying+".x, "+this._pSharedRegisters.animatedTangent+".z  \nmov "+this._pSharedRegisters.normalVarying+".z, "+this._pSharedRegisters.animatedNormal+".z  \nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.normalInput+".w  \ncrs "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.tangentVarying+".y, "+t+".x    \nmov "+this._pSharedRegisters.bitangentVarying+".y, "+t+".y  \nmov "+this._pSharedRegisters.normalVarying+".y, "+t+".z    \n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);var i,r,a;i=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(i,1),r=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(r,1),a=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(a,1),this._pFragmentCode+="nrm "+i+".xyz, "+this._pSharedRegisters.tangentVarying+"\nmov "+i+".w, "+this._pSharedRegisters.tangentVarying+".w	\nnrm "+r+".xyz, "+this._pSharedRegisters.bitangentVarying+"\nnrm "+a+".xyz, "+this._pSharedRegisters.normalVarying+"\n",this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)+"m33 "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalFragment+", "+i+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n",this._pRegisterCache.removeFragmentTempUsage(r),this._pRegisterCache.removeFragmentTempUsage(i),this._pRegisterCache.removeFragmentTempUsage(a)}else this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w\n",this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n",this._pShaderObject.tangentDependencies>0&&(this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="m33 "+this._pSharedRegisters.tangentVarying+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\nmov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.animatedTangent+".w\n");this._pShaderObject.usesTangentSpace||this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal)
},e.prototype.pInitRegisterIndices=function(){this._pShaderObject.pInitRegisterIndices(),this._pAnimatableAttributes=new Array("va0"),this._pAnimationTargetRegisters=new Array("vt0"),this._pVertexCode="",this._pFragmentCode="",this._pPostAnimationFragmentCode="",this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition=this._pRegisterCache.getFreeVertexVectorTemp(),1),this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant(),this._pShaderObject.commonsDataIndex=4*this._pSharedRegisters.commons.index,(this._pShaderObject.tangentDependencies>0||this._pShaderObject.outputsNormals)&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pShaderObject.tangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1),this._pShaderObject.usesTangentSpace&&(this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1)),this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString())),this._pShaderObject.normalDependencies>0&&(this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute(),this._pShaderObject.normalBufferIndex=this._pSharedRegisters.normalInput.index,this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1),this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString()))},e.prototype.pCalculateDependencies=function(){this._pShaderObject.useAlphaPremultiplied=this._pMaterial.alphaPremultiplied,this._pShaderObject.useBothSides=this._pMaterial.bothSides,this._pShaderObject.useMipmapping=this._pMaterial.mipmap,this._pShaderObject.useSmoothTextures=this._pMaterial.smooth,this._pShaderObject.repeatTextures=this._pMaterial.repeat,this._pShaderObject.usesUVTransform=this._pMaterial.animateUVs,this._pShaderObject.alphaThreshold=this._pMaterial.alphaThreshold,this._pShaderObject.texture=this._pMaterial.texture,this._pShaderObject.color=this._pMaterial.color,this._pMaterialPass._iIncludeDependencies(this._pShaderObject)},e.prototype.dispose=function(){this._pRegisterCache.dispose(),this._pRegisterCache=null,this._pSharedRegisters=null},Object.defineProperty(e.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"postAnimationFragmentCode",{get:function(){return this._pPostAnimationFragmentCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget.toString()},enumerable:!0,configurable:!0}),e}();t.exports=a},{"awayjs-renderergl/lib/compilation/ShaderRegisterCache":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterData":void 0}],"awayjs-renderergl/lib/compilation/ShaderLightingCompiler":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/materials/LightSources"),a=e("awayjs-stagegl/lib/base/ContextGLProfile"),s=e("awayjs-renderergl/lib/compilation/ShaderCompilerBase"),n=function(e){function t(t,i,r){e.call(this,t,i,r),this._materialLightingPass=i,this._shaderLightingObject=r}return i(t,e),t.prototype.pCompileDependencies=function(){e.prototype.pCompileDependencies.call(this),this._shaderLightingObject.usesShadows&&this.pCompileShadowCode(),this._shaderLightingObject.usesLights&&(this.initLightRegisters(),this.compileLightCode()),this._shaderLightingObject.usesProbes&&this.compileLightProbeCode(),this._pVertexCode+=this._materialLightingPass._iGetPostLightingVertexCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._materialLightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters)},t.prototype.pCompileShadowCode=function(){this._shaderLightingObject.normalDependencies>0?this._pSharedRegisters.shadowTarget=this._pSharedRegisters.normalFragment:(this._pSharedRegisters.shadowTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget,1))},t.prototype.initLightRegisters=function(){var e,t;if(this._dirLightVertexConstants)for(t=this._dirLightVertexConstants.length,e=0;t>e;++e)this._dirLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant(),-1==this._shaderLightingObject.lightVertexConstantIndex&&(this._shaderLightingObject.lightVertexConstantIndex=4*this._dirLightVertexConstants[e].index);if(this._pointLightVertexConstants)for(t=this._pointLightVertexConstants.length,e=0;t>e;++e)this._pointLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant(),-1==this._shaderLightingObject.lightVertexConstantIndex&&(this._shaderLightingObject.lightVertexConstantIndex=4*this._pointLightVertexConstants[e].index);for(t=this._dirLightFragmentConstants.length,e=0;t>e;++e)this._dirLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*this._dirLightFragmentConstants[e].index);for(t=this._pointLightFragmentConstants.length,e=0;t>e;++e)this._pointLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*this._pointLightFragmentConstants[e].index)},t.prototype.compileLightCode=function(){for(var e,t,i,r,a=0,s=0,n=this._shaderLightingObject.usesLightsForSpecular,o=this._shaderLightingObject.usesLightsForDiffuse,l=0;l<this._materialLightingPass.iNumDirectionalLights;++l){if(this._shaderLightingObject.usesTangentSpace){r=this._dirLightVertexConstants[a++];var h=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+h+".xyz, "+r+", "+this._pSharedRegisters.animatedTangent+"\nmov "+h+".w, "+r+".w\n",r=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addVertexTempUsages(r,1),this._pFragmentCode+="nrm "+r+".xyz, "+h+"\nmov "+r+".w, "+h+".w\n"}else r=this._dirLightFragmentConstants[s++];e=this._dirLightFragmentConstants[s++],t=this._dirLightFragmentConstants[s++],o&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters)),n&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters)),this._shaderLightingObject.usesTangentSpace&&this._pRegisterCache.removeVertexTempUsage(r)}a=0,s=0;for(var l=0;l<this._materialLightingPass.iNumPointLights;++l){i=this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment?this._pointLightVertexConstants[a++]:this._pointLightFragmentConstants[s++],e=this._pointLightFragmentConstants[s++],t=this._pointLightFragmentConstants[s++],r=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(r,1);var h;if(this._shaderLightingObject.usesTangentSpace){h=this._pRegisterCache.getFreeVarying();var p=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+p+", "+i+", "+this._pSharedRegisters.localPosition+"\nm33 "+h+".xyz, "+p+", "+this._pSharedRegisters.animatedTangent+"\nmov "+h+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._shaderLightingObject.usesGlobalPosFragment?(h=r,this._pFragmentCode+="sub "+r+", "+i+", "+this._pSharedRegisters.globalPositionVarying+"\n"):(h=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="sub "+h+", "+i+", "+this._pSharedRegisters.globalPositionVertex+"\n");this._pFragmentCode+=this._shaderLightingObject.usesLightFallOff?"dp3 "+r+".w, "+h+", "+h+"\nsub "+r+".w, "+r+".w, "+e+".w\nmul "+r+".w, "+r+".w, "+t+".w\nsat "+r+".w, "+r+".w\nsub "+r+".w, "+this._pSharedRegisters.commons+".w, "+r+".w\nnrm "+r+".xyz, "+h+"\n":"nrm "+r+".xyz, "+h+"\nmov "+r+".w, "+h+".w\n",-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*i.index),o&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters)),n&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters)),this._pRegisterCache.removeFragmentTempUsage(r)}},t.prototype.compileLightProbeCode=function(){var e,t,i,r=[".x",".y",".z",".w"],a=new Array,s=this._shaderLightingObject.usesProbesForSpecular,n=this._shaderLightingObject.usesProbesForDiffuse;for(n&&(this._shaderLightingObject.lightProbeDiffuseIndices=new Array),s&&(this._shaderLightingObject.lightProbeSpecularIndices=new Array),t=0;t<this._pNumProbeRegisters;++t)a[t]=this._pRegisterCache.getFreeFragmentConstant(),0==t&&(this._shaderLightingObject.probeWeightsIndex=4*a[t].index);for(t=0;t<this._materialLightingPass.iNumLightProbes;++t)e=a[Math.floor(t/4)].toString()+r[t%4],n&&(i=this._pRegisterCache.getFreeTextureReg(),this._shaderLightingObject.lightProbeDiffuseIndices[t]=i.index,this._pFragmentCode+=this._materialLightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters)),s&&(i=this._pRegisterCache.getFreeTextureReg(),this._shaderLightingObject.lightProbeSpecularIndices[t]=i.index,this._pFragmentCode+=this._materialLightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters))},t.prototype.pInitRegisterIndices=function(){e.prototype.pInitRegisterIndices.call(this),this._shaderLightingObject.lightVertexConstantIndex=-1,this._shaderLightingObject.lightFragmentConstantIndex=-1,this._shaderLightingObject.probeWeightsIndex=-1,this._pNumProbeRegisters=Math.ceil(this._materialLightingPass.iNumLightProbes/4),this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment?(this._pointLightVertexConstants=new Array(this._materialLightingPass.iNumPointLights),this._pointLightFragmentConstants=new Array(2*this._materialLightingPass.iNumPointLights)):this._pointLightFragmentConstants=new Array(3*this._materialLightingPass.iNumPointLights),this._shaderLightingObject.usesTangentSpace?(this._dirLightVertexConstants=new Array(this._materialLightingPass.iNumDirectionalLights),this._dirLightFragmentConstants=new Array(2*this._materialLightingPass.iNumDirectionalLights)):this._dirLightFragmentConstants=new Array(3*this._materialLightingPass.iNumDirectionalLights)},t.prototype.pCalculateDependencies=function(){var t=this._materialLightingPass.iNumPointLights+this._materialLightingPass.iNumDirectionalLights,i=this._materialLightingPass.iNumLightProbes,s=this._pMaterial.diffuseLightSources,n=this._materialLightingPass._iUsesSpecular()?this._pMaterial.specularLightSources:0,o=s|n;this._shaderLightingObject.usesLightFallOff=this._pMaterial.enableLightFallOff&&this._shaderLightingObject.profile!=a.BASELINE_CONSTRAINED,this._shaderLightingObject.numLights=t+i,this._shaderLightingObject.numPointLights=this._materialLightingPass.iNumPointLights,this._shaderLightingObject.numDirectionalLights=this._materialLightingPass.iNumDirectionalLights,this._shaderLightingObject.numLightProbes=i,this._shaderLightingObject.pointLightsOffset=this._materialLightingPass.pointLightsOffset,this._shaderLightingObject.directionalLightsOffset=this._materialLightingPass.directionalLightsOffset,this._shaderLightingObject.lightProbesOffset=this._materialLightingPass.lightProbesOffset,this._shaderLightingObject.lightPicker=this._materialLightingPass.lightPicker,this._shaderLightingObject.usesLights=t>0&&0!=(o&r.LIGHTS),this._shaderLightingObject.usesProbes=i>0&&0!=(o&r.PROBES),this._shaderLightingObject.usesLightsForSpecular=t>0&&0!=(n&r.LIGHTS),this._shaderLightingObject.usesProbesForSpecular=i>0&&0!=(n&r.PROBES),this._shaderLightingObject.usesLightsForDiffuse=t>0&&0!=(s&r.LIGHTS),this._shaderLightingObject.usesProbesForDiffuse=i>0&&0!=(s&r.PROBES),this._shaderLightingObject.usesShadows=this._materialLightingPass._iUsesShadows(),e.prototype.pCalculateDependencies.call(this)},t}(s);t.exports=n},{"awayjs-display/lib/materials/LightSources":void 0,"awayjs-renderergl/lib/compilation/ShaderCompilerBase":void 0,"awayjs-stagegl/lib/base/ContextGLProfile":void 0}],"awayjs-renderergl/lib/compilation/ShaderLightingObject":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/compilation/ShaderLightingCompiler"),a=e("awayjs-renderergl/lib/compilation/ShaderObjectBase"),s=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.createCompiler=function(e,t){return new r(e,t,this)},t.prototype.reset=function(){e.prototype.reset.call(this),this.numLights=0,this.usesLightFallOff=!0},t.prototype.setRenderState=function(t,i,r,a){e.prototype.setRenderState.call(this,t,i,r,a),this.usesLights&&this.updateLights(),this.usesProbes&&this.updateProbes(i)},t.prototype.updateLights=function(){var e,t,i,r,a,s,n=0,o=0,l=0,h=this.usesShadows?2:1;this.ambientR=this.ambientG=this.ambientB=0,a=this.lightVertexConstantIndex,o=this.lightFragmentConstantIndex;var p=0,d=this.lightPicker.directionalLights;for(s=this.directionalLightsOffset,i=this.lightPicker.directionalLights.length,s>i&&(p=1,s-=i);h>p;++p)for(p&&(d=this.lightPicker.castingDirectionalLights),i=d.length,i>this.numDirectionalLights&&(i=this.numDirectionalLights),n=0;i>n;++n){if(e=d[s+n],r=e.sceneDirection,this.ambientR+=e._iAmbientR,this.ambientG+=e._iAmbientG,this.ambientB+=e._iAmbientB,this.usesTangentSpace){var c=-r.x,u=-r.y,_=-r.z;this.vertexConstantData[a++]=this._pInverseSceneMatrix[0]*c+this._pInverseSceneMatrix[4]*u+this._pInverseSceneMatrix[8]*_,this.vertexConstantData[a++]=this._pInverseSceneMatrix[1]*c+this._pInverseSceneMatrix[5]*u+this._pInverseSceneMatrix[9]*_,this.vertexConstantData[a++]=this._pInverseSceneMatrix[2]*c+this._pInverseSceneMatrix[6]*u+this._pInverseSceneMatrix[10]*_,this.vertexConstantData[a++]=1}else this.fragmentConstantData[o++]=-r.x,this.fragmentConstantData[o++]=-r.y,this.fragmentConstantData[o++]=-r.z,this.fragmentConstantData[o++]=1;this.fragmentConstantData[o++]=e._iDiffuseR,this.fragmentConstantData[o++]=e._iDiffuseG,this.fragmentConstantData[o++]=e._iDiffuseB,this.fragmentConstantData[o++]=1,this.fragmentConstantData[o++]=e._iSpecularR,this.fragmentConstantData[o++]=e._iSpecularG,this.fragmentConstantData[o++]=e._iSpecularB,this.fragmentConstantData[o++]=1,++l==this.numDirectionalLights&&(n=i,p=h)}if(this.numDirectionalLights>l)for(n=o+12*(this.numDirectionalLights-l);n>o;)this.fragmentConstantData[o++]=0;l=0;var g=this.lightPicker.pointLights;for(s=this.pointLightsOffset,i=this.lightPicker.pointLights.length,s>i?(p=1,s-=i):p=0;h>p;++p)for(p&&(g=this.lightPicker.castingPointLights),i=g.length,n=0;i>n;++n){t=g[s+n],r=t.scenePosition,this.ambientR+=t._iAmbientR,this.ambientG+=t._iAmbientG,this.ambientB+=t._iAmbientB,this.usesTangentSpace?(c=r.x,u=r.y,_=r.z,this.vertexConstantData[a++]=this._pInverseSceneMatrix[0]*c+this._pInverseSceneMatrix[4]*u+this._pInverseSceneMatrix[8]*_+this._pInverseSceneMatrix[12],this.vertexConstantData[a++]=this._pInverseSceneMatrix[1]*c+this._pInverseSceneMatrix[5]*u+this._pInverseSceneMatrix[9]*_+this._pInverseSceneMatrix[13],this.vertexConstantData[a++]=this._pInverseSceneMatrix[2]*c+this._pInverseSceneMatrix[6]*u+this._pInverseSceneMatrix[10]*_+this._pInverseSceneMatrix[14],this.vertexConstantData[a++]=1):this.usesGlobalPosFragment?(this.fragmentConstantData[o++]=r.x,this.fragmentConstantData[o++]=r.y,this.fragmentConstantData[o++]=r.z,this.fragmentConstantData[o++]=1):(this.vertexConstantData[a++]=r.x,this.vertexConstantData[a++]=r.y,this.vertexConstantData[a++]=r.z,this.vertexConstantData[a++]=1),this.fragmentConstantData[o++]=t._iDiffuseR,this.fragmentConstantData[o++]=t._iDiffuseG,this.fragmentConstantData[o++]=t._iDiffuseB;var m=t._pRadius;this.fragmentConstantData[o++]=m*m,this.fragmentConstantData[o++]=t._iSpecularR,this.fragmentConstantData[o++]=t._iSpecularG,this.fragmentConstantData[o++]=t._iSpecularB,this.fragmentConstantData[o++]=t._pFallOffFactor,++l==this.numPointLights&&(n=i,p=h)}if(this.numPointLights>l)for(n=o+12*(l-this.numPointLights);n>o;++o)this.fragmentConstantData[o]=0},t.prototype.updateProbes=function(e){var t,i=this.lightPicker.lightProbes,r=this.lightPicker.lightProbeWeights,a=i.length-this.lightProbesOffset,s=this.usesProbesForDiffuse,n=this.usesProbesForSpecular;if(s||n){a>this.numLightProbes&&(a=this.numLightProbes);for(var o=0;a>o;++o)t=i[this.lightProbesOffset+o],s&&e.activateCubeTexture(this.lightProbeDiffuseIndices[o],t.diffuseMap),n&&e.activateCubeTexture(this.lightProbeSpecularIndices[o],t.specularMap);for(o=0;a>o;++o)this.fragmentConstantData[this.probeWeightsIndex+o]=r[this.lightProbesOffset+o]}},t}(a);t.exports=s},{"awayjs-renderergl/lib/compilation/ShaderLightingCompiler":void 0,"awayjs-renderergl/lib/compilation/ShaderObjectBase":void 0}],"awayjs-renderergl/lib/compilation/ShaderObjectBase":[function(e,t){var i=e("awayjs-display/lib/base/TriangleSubGeometry"),r=e("awayjs-stagegl/lib/base/ContextGLTriangleFace"),a=e("awayjs-renderergl/lib/compilation/ShaderCompilerBase"),s=function(){function e(e){this._defaultCulling=r.BACK,this._pInverseSceneMatrix=new Array,this.ambientR=255,this.ambientG=255,this.ambientB=255,this.usesGlobalPosFragment=!1,this.vertexConstantData=new Array,this.fragmentConstantData=new Array,this.profile=e}return e.prototype.createCompiler=function(e,t){return new a(e,t,this)},e.prototype.reset=function(){this.projectionDependencies=0,this.normalDependencies=0,this.viewDirDependencies=0,this.uvDependencies=0,this.secondaryUVDependencies=0,this.globalPosDependencies=0,this.tangentDependencies=0,this.usesGlobalPosFragment=!1,this.usesFragmentAnimation=!1,this.usesTangentSpace=!1,this.outputsNormals=!1,this.outputsTangentNormals=!1},e.prototype.pInitRegisterIndices=function(){this.commonsDataIndex=-1,this.cameraPositionIndex=-1,this.uvBufferIndex=-1,this.uvTransformIndex=-1,this.secondaryUVBufferIndex=-1,this.normalBufferIndex=-1,this.tangentBufferIndex=-1,this.sceneMatrixIndex=-1,this.sceneNormalMatrixIndex=-1},e.prototype.initConstantData=function(e,t,i,r,a){this.numUsedVertexConstants=e.numUsedVertexConstants,this.numUsedFragmentConstants=e.numUsedFragmentConstants,this.numUsedStreams=e.numUsedStreams,this.numUsedTextures=e.numUsedTextures,this.numUsedVaryings=e.numUsedVaryings,this.numUsedFragmentConstants=e.numUsedFragmentConstants,this.animatableAttributes=t,this.animationTargetRegisters=i,this.uvSource=r,this.uvTarget=a,this.vertexConstantData.length=4*this.numUsedVertexConstants,this.fragmentConstantData.length=4*this.numUsedFragmentConstants,this.fragmentConstantData[this.commonsDataIndex]=.5,this.fragmentConstantData[this.commonsDataIndex+1]=0,this.fragmentConstantData[this.commonsDataIndex+2]=1/255,this.fragmentConstantData[this.commonsDataIndex+3]=1,this.uvTransformIndex>=0&&(this.vertexConstantData[this.uvTransformIndex]=1,this.vertexConstantData[this.uvTransformIndex+1]=0,this.vertexConstantData[this.uvTransformIndex+2]=0,this.vertexConstantData[this.uvTransformIndex+3]=0,this.vertexConstantData[this.uvTransformIndex+4]=0,this.vertexConstantData[this.uvTransformIndex+5]=1,this.vertexConstantData[this.uvTransformIndex+6]=0,this.vertexConstantData[this.uvTransformIndex+7]=0),this.cameraPositionIndex>=0&&(this.vertexConstantData[this.cameraPositionIndex+3]=1)},e.prototype.iActivate=function(e,t){if(e.context.setCulling(this.useBothSides?r.NONE:this._defaultCulling,t.projection.coordinateSystem),!this.usesTangentSpace&&this.cameraPositionIndex>=0){var i=t.scenePosition;this.vertexConstantData[this.cameraPositionIndex]=i.x,this.vertexConstantData[this.cameraPositionIndex+1]=i.y,this.vertexConstantData[this.cameraPositionIndex+2]=i.z}},e.prototype.iDeactivate=function(){},e.prototype.setRenderState=function(e,t,r){t.context;if(e.materialOwner.animator&&e.materialOwner.animator.setRenderState(this,e,t,r,this.numUsedVertexConstants,this.numUsedStreams),this.uvBufferIndex>=0&&t.activateBuffer(this.uvBufferIndex,e.getVertexData(i.UV_DATA),e.getVertexOffset(i.UV_DATA),i.UV_FORMAT),this.secondaryUVBufferIndex>=0&&t.activateBuffer(this.secondaryUVBufferIndex,e.getVertexData(i.SECONDARY_UV_DATA),e.getVertexOffset(i.SECONDARY_UV_DATA),i.SECONDARY_UV_FORMAT),this.normalBufferIndex>=0&&t.activateBuffer(this.normalBufferIndex,e.getVertexData(i.NORMAL_DATA),e.getVertexOffset(i.NORMAL_DATA),i.NORMAL_FORMAT),this.tangentBufferIndex>=0&&t.activateBuffer(this.tangentBufferIndex,e.getVertexData(i.TANGENT_DATA),e.getVertexOffset(i.TANGENT_DATA),i.TANGENT_FORMAT),this.usesUVTransform){var a=e.materialOwner.uvTransform.matrix;a?(this.vertexConstantData[this.uvTransformIndex]=a.a,this.vertexConstantData[this.uvTransformIndex+1]=a.b,this.vertexConstantData[this.uvTransformIndex+3]=a.tx,this.vertexConstantData[this.uvTransformIndex+4]=a.c,this.vertexConstantData[this.uvTransformIndex+5]=a.d,this.vertexConstantData[this.uvTransformIndex+7]=a.ty):(this.vertexConstantData[this.uvTransformIndex]=1,this.vertexConstantData[this.uvTransformIndex+1]=0,this.vertexConstantData[this.uvTransformIndex+3]=0,this.vertexConstantData[this.uvTransformIndex+4]=0,this.vertexConstantData[this.uvTransformIndex+5]=1,this.vertexConstantData[this.uvTransformIndex+7]=0)}if(this.sceneNormalMatrixIndex>=0&&e.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData,this.sceneNormalMatrixIndex,!1),this.usesTangentSpace&&this.cameraPositionIndex>=0){e.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);var s=r.scenePosition,n=s.x,o=s.y,l=s.z;this.vertexConstantData[this.cameraPositionIndex]=this._pInverseSceneMatrix[0]*n+this._pInverseSceneMatrix[4]*o+this._pInverseSceneMatrix[8]*l+this._pInverseSceneMatrix[12],this.vertexConstantData[this.cameraPositionIndex+1]=this._pInverseSceneMatrix[1]*n+this._pInverseSceneMatrix[5]*o+this._pInverseSceneMatrix[9]*l+this._pInverseSceneMatrix[13],this.vertexConstantData[this.cameraPositionIndex+2]=this._pInverseSceneMatrix[2]*n+this._pInverseSceneMatrix[6]*o+this._pInverseSceneMatrix[10]*l+this._pInverseSceneMatrix[14]}},e.prototype.dispose=function(){},e}();t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/compilation/ShaderCompilerBase":void 0,"awayjs-stagegl/lib/base/ContextGLTriangleFace":void 0}],"awayjs-renderergl/lib/compilation/ShaderRegisterCache":[function(e,t){var i=e("awayjs-renderergl/lib/compilation/RegisterPool"),r=e("awayjs-renderergl/lib/compilation/ShaderRegisterElement"),a=function(){function e(e){this._numUsedVertexConstants=0,this._numUsedFragmentConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._profile=e}return e.prototype.reset=function(){this._fragmentTempCache=new i("ft",8,!1),this._vertexTempCache=new i("vt",8,!1),this._varyingCache=new i("v",8),this._textureCache=new i("fs",8),this._vertexAttributesCache=new i("va",8),this._fragmentConstantsCache=new i("fc",28),this._vertexConstantsCache=new i("vc",128),this._fragmentOutputRegister=new r("oc",-1),this._vertexOutputRegister=new r("op",-1),this._numUsedVertexConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._numUsedFragmentConstants=0;var e;for(e=0;e<this._vertexAttributesOffset;++e)this.getFreeVertexAttribute();for(e=0;e<this._vertexConstantOffset;++e)this.getFreeVertexConstant();for(e=0;e<this._varyingsOffset;++e)this.getFreeVarying();for(e=0;e<this._fragmentConstantOffset;++e)this.getFreeFragmentConstant()},e.prototype.dispose=function(){this._fragmentTempCache.dispose(),this._vertexTempCache.dispose(),this._varyingCache.dispose(),this._fragmentConstantsCache.dispose(),this._vertexAttributesCache.dispose(),this._fragmentTempCache=null,this._vertexTempCache=null,this._varyingCache=null,this._fragmentConstantsCache=null,this._vertexAttributesCache=null,this._fragmentOutputRegister=null,this._vertexOutputRegister=null},e.prototype.addFragmentTempUsages=function(e,t){this._fragmentTempCache.addUsage(e,t)},e.prototype.removeFragmentTempUsage=function(e){this._fragmentTempCache.removeUsage(e)},e.prototype.addVertexTempUsages=function(e,t){this._vertexTempCache.addUsage(e,t)},e.prototype.removeVertexTempUsage=function(e){this._vertexTempCache.removeUsage(e)},e.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()},e.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()},e.prototype.getFreeVarying=function(){return++this._numUsedVaryings,this._varyingCache.requestFreeVectorReg()},e.prototype.getFreeFragmentConstant=function(){return++this._numUsedFragmentConstants,this._fragmentConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexConstant=function(){return++this._numUsedVertexConstants,this._vertexConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()},e.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()},e.prototype.getFreeVertexAttribute=function(){return++this._numUsedStreams,this._vertexAttributesCache.requestFreeVectorReg()},e.prototype.getFreeTextureReg=function(){return++this._numUsedTextures,this._textureCache.requestFreeVectorReg()},Object.defineProperty(e.prototype,"vertexConstantOffset",{get:function(){return this._vertexConstantOffset},set:function(e){this._vertexConstantOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributesOffset",{get:function(){return this._vertexAttributesOffset},set:function(e){this._vertexAttributesOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"varyingsOffset",{get:function(){return this._varyingsOffset},set:function(e){this._varyingsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentConstantOffset",{get:function(){return this._fragmentConstantOffset},set:function(e){this._fragmentConstantOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:!0,configurable:!0}),e}();t.exports=a},{"awayjs-renderergl/lib/compilation/RegisterPool":void 0,"awayjs-renderergl/lib/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/compilation/ShaderRegisterData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/compilation/ShaderRegisterElement":[function(e,t){var i=function(){function e(t,i,r){void 0===r&&(r=-1),this._component=r,this._regName=t,this._index=i,this._toStr=this._regName,this._index>=0&&(this._toStr+=this._index),r>-1&&(this._toStr+="."+e.COMPONENTS[r])}return e.prototype.toString=function(){return this._toStr},Object.defineProperty(e.prototype,"regName",{get:function(){return this._regName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e.COMPONENTS=["x","y","z","w"],e}();t.exports=i},{}],"awayjs-renderergl/lib/errors/AnimationSetError":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/errors/Error"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t}(r);t.exports=a},{"awayjs-core/lib/errors/Error":void 0}],"awayjs-renderergl/lib/events/AnimationStateEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=function(e){function t(t,i,r,a){e.call(this,t),this._animator=i,this._animationState=r,this._animationNode=a}return i(t,e),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationState",{get:function(){return this._animationState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.type,this._animator,this._animationState,this._animationNode)},t.PLAYBACK_COMPLETE="playbackComplete",t.TRANSITION_COMPLETE="transitionComplete",t}(r);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-renderergl/lib/events/AnimatorEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=function(e){function t(t,i){e.call(this,t),this._animator=i}return i(t,e),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.type,this._animator)},t.START="start",t.STOP="stop",t.CYCLE_COMPLETE="cycle_complete",t}(r);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-renderergl/lib/events/ShadingMethodEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t.SHADER_INVALIDATED="ShaderInvalidated",t}(r);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-renderergl/lib/filters/Filter3DBase":[function(e,t){var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e.prototype.pAddTask=function(e){this._tasks.push(e),null==this._requireDepthRender&&(this._requireDepthRender=e.requireDepthRender)},Object.defineProperty(e.prototype,"tasks",{get:function(){return this._tasks},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._tasks[0].getMainInputTexture(e)},Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight
},set:function(e){this._textureHeight=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureHeight=e},enumerable:!0,configurable:!0}),e.prototype.setRenderTargets=function(e){this._tasks[this._tasks.length-1].target=e},e.prototype.dispose=function(){for(var e=0;e<this._tasks.length;++e)this._tasks[e].dispose()},e.prototype.update=function(){},e}();t.exports=i},{}],"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),r=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFormat"),s=function(){function e(e){void 0===e&&(e=!1),this._scaledTextureWidth=-1,this._scaledTextureHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._textureDimensionsInvalid=!0,this._program3DInvalid=!0,this._textureScale=0,this._requireDepthRender=e}return Object.defineProperty(e.prototype,"textureScale",{get:function(){return this._textureScale},set:function(e){this._textureScale!=e&&(this._textureScale=e,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth!=e&&(this._textureWidth=e,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){this._textureHeight!=e&&(this._textureHeight=e,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._textureDimensionsInvalid&&this.pUpdateTextures(e),this._mainInputTexture},e.prototype.dispose=function(){this._mainInputTexture&&this._mainInputTexture.dispose(),this._program3D&&this._program3D.dispose()},e.prototype.pInvalidateProgram=function(){this._program3DInvalid=!0},e.prototype.pUpdateProgram=function(e){this._program3D&&this._program3D.dispose(),this._program3D=e.context.createProgram();var t=(new r).assemble("part vertex 1\n"+this.pGetVertexCode()+"endpart").vertex.data,i=(new r).assemble("part fragment 1\n"+this.pGetFragmentCode()+"endpart").fragment.data;this._program3D.upload(t,i),this._program3DInvalid=!1},e.prototype.pGetVertexCode=function(){return"mov op, va0\nmov v0, va1\n"},e.prototype.pGetFragmentCode=function(){throw new i},e.prototype.pUpdateTextures=function(e){this._mainInputTexture&&this._mainInputTexture.dispose(),this._mainInputTexture=e.context.createTexture(this._scaledTextureWidth,this._scaledTextureHeight,a.BGRA,!0),this._textureDimensionsInvalid=!1},e.prototype.getProgram=function(e){return this._program3DInvalid&&this.pUpdateProgram(e),this._program3D},e.prototype.activate=function(){},e.prototype.deactivate=function(){},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e}();t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFormat":void 0}],"awayjs-renderergl/lib/managers/DefaultMaterialManager":[function(e,t){var i=e("awayjs-core/lib/base/BitmapData"),r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/textures/BitmapTexture"),s=e("awayjs-renderergl/lib/materials/LineBasicMaterial"),n=e("awayjs-renderergl/lib/materials/TriangleBasicMaterial"),o=function(){function e(){}return e.getDefaultMaterial=function(t){return void 0===t&&(t=null),null!=t&&t.assetType==r.LINE_SUB_MESH?(e._defaultLineMaterial||e.createDefaultLineMaterial(),e._defaultLineMaterial):(e._defaultTriangleMaterial||e.createDefaultTriangleMaterial(),e._defaultTriangleMaterial)},e.getDefaultTexture=function(t){return void 0===t&&(t=null),e._defaultTexture||e.createDefaultTexture(),e._defaultTexture},e.createDefaultTexture=function(){e._defaultBitmapData=e.createCheckeredBitmapData(),e._defaultTexture=new a(e._defaultBitmapData,!0),e._defaultTexture.name="defaultTexture"},e.createCheckeredBitmapData=function(){var e,t,r=new i(8,8,!1,0);for(e=0;8>e;e++)for(t=0;8>t;t++)1&t^1&e&&r.setPixel(e,t,16777215);return r},e.createDefaultTriangleMaterial=function(){e._defaultTexture||e.createDefaultTexture(),e._defaultTriangleMaterial=new n(e._defaultTexture),e._defaultTriangleMaterial.mipmap=!1,e._defaultTriangleMaterial.smooth=!1,e._defaultTriangleMaterial.name="defaultTriangleMaterial"},e.createDefaultLineMaterial=function(){e._defaultLineMaterial=new s,e._defaultLineMaterial.name="defaultSegmentMaterial"},e}();t.exports=o},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/textures/BitmapTexture":void 0,"awayjs-renderergl/lib/materials/LineBasicMaterial":void 0,"awayjs-renderergl/lib/materials/TriangleBasicMaterial":void 0}],"awayjs-renderergl/lib/managers/RTTBufferManager":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Rectangle"),a=e("awayjs-core/lib/events/Event"),s=e("awayjs-core/lib/events/EventDispatcher"),n=e("awayjs-core/lib/utils/TextureUtils"),o=function(e){function t(t){e.call(this),this._viewWidth=-1,this._viewHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._buffersInvalid=!0,this._renderToTextureRect=new r,this._stage=t}return i(t,e),t.getInstance=function(e){if(!e)throw new Error("stage key cannot be null!");null==t._instances&&(t._instances=new Array);var i=t.getRTTBufferManagerFromStage(e);if(null==i){i=new t(e);var r=new l;r.stage3d=e,r.rttbfm=i,t._instances.push(r)}return i},t.getRTTBufferManagerFromStage=function(e){for(var i,r=t._instances.length,a=0;r>a;a++)if(i=t._instances[a],i.stage3d===e)return i.rttbfm;return null},t.deleteRTTBufferManager=function(e){for(var i,r=t._instances.length,a=0;r>a;a++)if(i=t._instances[a],i.stage3d===e)return void t._instances.splice(a,1)},Object.defineProperty(t.prototype,"textureRatioX",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureRatioY",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(e){e!=this._viewWidth&&(this._viewWidth=e,this._buffersInvalid=!0,this._textureWidth=n.getBestPowerOf2(this._viewWidth),this._textureWidth>this._viewWidth?(this._renderToTextureRect.x=Math.floor(.5*(this._textureWidth-this._viewWidth)),this._renderToTextureRect.width=this._viewWidth):(this._renderToTextureRect.x=0,this._renderToTextureRect.width=this._textureWidth),this.dispatchEvent(new a(a.RESIZE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(e){e!=this._viewHeight&&(this._viewHeight=e,this._buffersInvalid=!0,this._textureHeight=n.getBestPowerOf2(this._viewHeight),this._textureHeight>this._viewHeight?(this._renderToTextureRect.y=Math.floor(.5*(this._textureHeight-this._viewHeight)),this._renderToTextureRect.height=this._viewHeight):(this._renderToTextureRect.y=0,this._renderToTextureRect.height=this._textureHeight),this.dispatchEvent(new a(a.RESIZE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToTextureVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToScreenVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToScreenVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToTextureRect",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureRect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){t.deleteRTTBufferManager(this._stage),this._indexBuffer&&(this._indexBuffer.dispose(),this._renderToScreenVertexBuffer.dispose(),this._renderToTextureVertexBuffer.dispose(),this._renderToScreenVertexBuffer=null,this._renderToTextureVertexBuffer=null,this._indexBuffer=null)},t.prototype.updateRTTBuffers=function(){var e,t,i,r,a=this._stage.context;null==this._renderToTextureVertexBuffer&&(this._renderToTextureVertexBuffer=a.createVertexBuffer(4,5)),null==this._renderToScreenVertexBuffer&&(this._renderToScreenVertexBuffer=a.createVertexBuffer(4,5)),this._indexBuffer||(this._indexBuffer=a.createIndexBuffer(6),this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6)),this._textureRatioX=i=Math.min(this._viewWidth/this._textureWidth,1),this._textureRatioY=r=Math.min(this._viewHeight/this._textureHeight,1);var s=.5*(1-i),n=.5*(i+1),o=.5*(r+1),l=.5*(1-r);e=[-i,-r,s,o,0,i,-r,n,o,1,i,r,n,l,2,-i,r,s,l,3],t=[-1,-1,s,o,0,1,-1,n,o,1,1,1,n,l,2,-1,1,s,l,3],this._renderToTextureVertexBuffer.uploadFromArray(e,0,4),this._renderToScreenVertexBuffer.uploadFromArray(t,0,4),this._buffersInvalid=!1},t}(s),l=function(){function e(){}return e}();t.exports=o},{"awayjs-core/lib/events/Event":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/utils/TextureUtils":void 0}],"awayjs-renderergl/lib/materials/LineBasicMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-display/lib/base/LineSubGeometry"),s=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/materials/MaterialGLBase"),o=e("awayjs-renderergl/lib/passes/LineBasicPass"),l=function(e){function t(t){void 0===t&&(t=1.25),e.call(this),this._constants=new Array(0,0,0,0),this._thickness=t,this.bothSides=!0,this._pAddScreenPass(this._screenPass=new o),this._calcMatrix=new r,this._constants[1]=1/255}return i(t,e),t.prototype._iGetVertexCode=function(){return"m44 vt0, va0, vc8			\nm44 vt1, va1, vc8			\nsub vt2, vt1, vt0 			\nslt vt5.x, vt0.z, vc7.z			\nsub vt5.y, vc5.x, vt5.x			\nadd vt4.x, vt0.z, vc7.z			\nsub vt4.y, vt0.z, vt1.z			\nseq vt4.z, vt4.y vc6.x			\nadd vt4.y, vt4.y, vt4.z			\ndiv vt4.z, vt4.x, vt4.y			\nmul vt4.xyz, vt4.zzz, vt2.xyz	\nadd vt3.xyz, vt0.xyz, vt4.xyz	\nmov vt3.w, vc5.x			\nmul vt0, vt0, vt5.yyyy			\nmul vt3, vt3, vt5.xxxx			\nadd vt0, vt0, vt3				\nsub vt2, vt1, vt0 			\nnrm vt2.xyz, vt2.xyz			\nnrm vt5.xyz, vt0.xyz			\nmov vt5.w, vc5.x				\ncrs vt3.xyz, vt2, vt5			\nnrm vt3.xyz, vt3.xyz			\nmul vt3.xyz, vt3.xyz, va2.xxx	\nmov vt3.w, vc5.x			\ndp3 vt4.x, vt0, vc6			\nmul vt4.x, vt4.x, vc7.x			\nmul vt3.xyz, vt3.xyz, vt4.xxx	\nadd vt0.xyz, vt0.xyz, vt3.xyz	\nm44 op, vt0, vc0			\nmov v0, va3				\n"},t.prototype._iActivatePass=function(i,r,a){e.prototype._iActivatePass.call(this,i,r,a);var n=r.context,o=r.stage;this._constants[0]=this._thickness/(o.scissorRect?Math.min(o.scissorRect.width,o.scissorRect.height):Math.min(o.width,o.height)),this._constants[2]=a.projection.near,n.setProgramConstantsFromArray(s.VERTEX,5,t.pONE_VECTOR,1),n.setProgramConstantsFromArray(s.VERTEX,6,t.pFRONT_VECTOR,1),n.setProgramConstantsFromArray(s.VERTEX,7,this._constants,1),n.setProgramConstantsFromMatrix(s.VERTEX,0,a.projection.matrix,!0)},t.prototype._iRenderPass=function(t,i,r,n,o){e.prototype._iRenderPass.call(this,t,i,r,n,o);var l=r.context;this._calcMatrix.copyFrom(i.sourceEntity.sceneTransform),this._calcMatrix.append(n.inverseSceneTransform),l.setProgramConstantsFromMatrix(s.VERTEX,8,this._calcMatrix,!0),r.activateBuffer(0,i.getVertexData(a.START_POSITION_DATA),i.getVertexOffset(a.START_POSITION_DATA),a.POSITION_FORMAT),r.activateBuffer(1,i.getVertexData(a.END_POSITION_DATA),i.getVertexOffset(a.END_POSITION_DATA),a.POSITION_FORMAT),r.activateBuffer(2,i.getVertexData(a.THICKNESS_DATA),i.getVertexOffset(a.THICKNESS_DATA),a.THICKNESS_FORMAT),r.activateBuffer(3,i.getVertexData(a.COLOR_DATA),i.getVertexOffset(a.COLOR_DATA),a.COLOR_FORMAT),l.drawTriangles(r.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t.pONE_VECTOR=Array(1,1,1,1),t.pFRONT_VECTOR=Array(0,0,-1,0),t}(n);t.exports=l},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-display/lib/base/LineSubGeometry":void 0,"awayjs-renderergl/lib/materials/MaterialGLBase":void 0,"awayjs-renderergl/lib/passes/LineBasicPass":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/materials/MaterialGLBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/materials/MaterialBase"),a=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype._iGetVertexCode=function(){return""},t.prototype._iGetFragmentCode=function(){return""},t}(r);t.exports=a},{"awayjs-display/lib/materials/MaterialBase":void 0}],"awayjs-renderergl/lib/materials/SkyboxMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),n=e("awayjs-stagegl/lib/base/ContextGLProgramType"),o=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),l=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),h=e("awayjs-renderergl/lib/materials/MaterialGLBase"),p=e("awayjs-renderergl/lib/passes/SkyboxPass"),d=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),c=function(e){function t(t,i,r,a){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===a&&(a=!1),e.call(this),this._cubeMap=t,this._pAddScreenPass(this._skyboxPass=new p),this._vertexData=new Array(0,0,0,0,1,1,1,1)}return i(t,e),Object.defineProperty(t.prototype,"cubeMap",{get:function(){return this._cubeMap},set:function(e){e&&this._cubeMap&&(e.hasMipmaps!=this._cubeMap.hasMipmaps||e.format!=this._cubeMap.format)&&this._pInvalidatePasses(),this._cubeMap=e},enumerable:!0,configurable:!0}),t.prototype._iGetVertexCode=function(){return"mul vt0, va0, vc5\nadd vt0, vt0, vc4\nm44 op, vt0, vc0\nmov v0, va0\n"},t.prototype._iGetFragmentCode=function(){var e=",mipnone";return this._cubeMap.hasMipmaps&&(e=",miplinear"),"tex ft0, v0, fs0 <cube,"+d.getFormatStringForTexture(this._cubeMap)+"linear,clamp"+e+">\n"},t.prototype._iActivatePass=function(t,i,r){e.prototype._iActivatePass.call(this,t,i,r);var n=i.context;n.setSamplerStateAt(0,l.CLAMP,o.LINEAR,this._cubeMap.hasMipmaps?s.MIPLINEAR:s.MIPNONE),n.setDepthTest(!1,a.LESS),i.stage.activateCubeTexture(0,this._cubeMap)},t.prototype._iRenderPass=function(t,i,a,s,o){e.prototype._iRenderPass.call(this,t,i,a,s,o);var l=a.context,h=s.scenePosition;this._vertexData[0]=h.x,this._vertexData[1]=h.y,this._vertexData[2]=h.z,this._vertexData[4]=this._vertexData[5]=this._vertexData[6]=s.projection.far/Math.sqrt(3),l.setProgramConstantsFromMatrix(n.VERTEX,0,o,!0),l.setProgramConstantsFromArray(n.VERTEX,4,this._vertexData,2),a.activateBuffer(0,i.getVertexData(r.POSITION_DATA),i.getVertexOffset(r.POSITION_DATA),r.POSITION_FORMAT),l.drawTriangles(a.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t}(h);t.exports=c},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/materials/MaterialGLBase":void 0,"awayjs-renderergl/lib/passes/SkyboxPass":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/TriangleBasicMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/textures/Texture2DBase"),a=e("awayjs-display/lib/base/BlendMode"),s=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),n=e("awayjs-renderergl/lib/materials/TriangleMaterialBase"),o=e("awayjs-renderergl/lib/passes/TriangleBasicPass"),l=function(e){function t(t,i,a,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===a&&(a=!1),void 0===n&&(n=!1),e.call(this),this._alphaBlending=!1,this._alpha=1,this._depthCompareMode=s.LESS_EQUAL,this._screenPass=new o,t instanceof r?(this.texture=t,this.smooth=null==i?!0:!1,this.repeat=a,this.mipmap=n):(this.color=t?Number(t):13421772,this.alpha=null==i?1:Number(i))}return i(t,e),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode!=e&&(this._depthCompareMode=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e>1?e=1:0>e&&(e=0),this._alpha!=e&&(this._alpha=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(e){this._alphaBlending!=e&&(this._alphaBlending=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),t.prototype._iUpdateMaterial=function(){this._pScreenPassesInvalid&&(this._pScreenPassesInvalid=!1,this.setBlendAndCompareModes(),this._pClearScreenPasses(),this._pAddScreenPass(this._screenPass))},t.prototype.setBlendAndCompareModes=function(){this._pRequiresBlending=this._pBlendMode!=a.NORMAL||this._alphaBlending||this._alpha<1,this._screenPass.depthCompareMode=this._depthCompareMode,this._screenPass.preserveAlpha=this._pRequiresBlending,this._screenPass.setBlendMode(this._pBlendMode==a.NORMAL&&this._pRequiresBlending?a.LAYER:this._pBlendMode),this._screenPass.forceSeparateMVP=!1},t}(n);t.exports=l},{"awayjs-core/lib/textures/Texture2DBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialBase":void 0,"awayjs-renderergl/lib/passes/TriangleBasicPass":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/materials/TriangleMaterialBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3DUtils"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/materials/MaterialGLBase"),o=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype._iGetVertexCode=function(e,t,i){var r="",a=e.globalPosDependencies>0?i.globalPositionVertex:i.localPosition,s=t.getFreeVertexConstant();if(t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),e.viewMatrixIndex=4*s.index,e.projectionDependencies>0){i.projectionFragment=t.getFreeVarying();var n=t.getFreeVertexVectorTemp();r+="m44 "+n+", "+a+", "+s+"\nmov "+i.projectionFragment+", "+n+"\nmov op, "+n+"\n"}else r+="m44 op, "+a+", "+s+"\n";return r},t.prototype._iRenderPass=function(t,i,n,o,l){e.prototype._iRenderPass.call(this,t,i,n,o,l);var h=t.shaderObject;if(h.sceneMatrixIndex>=0)i.sourceEntity.getRenderSceneTransform(o).copyRawDataTo(h.vertexConstantData,h.sceneMatrixIndex,!0),l.copyRawDataTo(h.vertexConstantData,h.viewMatrixIndex,!0);else{var p=r.CALCULATION_MATRIX;p.copyFrom(i.sourceEntity.getRenderSceneTransform(o)),p.append(l),p.copyRawDataTo(h.vertexConstantData,h.viewMatrixIndex,!0)}var d=n.context;d.setProgramConstantsFromArray(s.VERTEX,0,h.vertexConstantData,h.numUsedVertexConstants),d.setProgramConstantsFromArray(s.FRAGMENT,0,h.fragmentConstantData,h.numUsedFragmentConstants),n.activateBuffer(0,i.getVertexData(a.POSITION_DATA),i.getVertexOffset(a.POSITION_DATA),a.POSITION_FORMAT),d.drawTriangles(n.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t}(n);t.exports=o},{"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/materials/MaterialGLBase":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/passes/DepthMapPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/passes/MaterialPassGLBase"),o=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex,r=t.fragmentConstantData;r[i]=1,r[i+1]=255,r[i+2]=65025,r[i+3]=16581375,r[i+4]=1/255,r[i+5]=1/255,r[i+6]=1/255,r[i+7]=0},t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++,e.alphaThreshold>0&&e.uvDependencies++},t.prototype._iGetFragmentCode=function(e,t,i){var r="",a=i.shadedTarget,s=t.getFreeTextureReg(),n=t.getFreeFragmentConstant(),l=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var h=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(h,1);var p=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(p,1),r+="div "+h+", "+i.projectionFragment+", "+i.projectionFragment+".w\nmul "+h+", "+n+", "+h+".z\nfrc "+h+", "+h+"\nmul "+p+", "+h+".yzww, "+l+"\n",e.alphaThreshold>0){s=t.getFreeTextureReg(),this._texturesIndex=s.index;var d=t.getFreeFragmentVectorTemp();r+=o.getTex2DSampleCode(d,i,s,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var c=t.getFreeFragmentConstant();r+="sub "+d+".w, "+d+".w, "+c+".x\nkil "+d+".w\n"}return r+="sub "+a+", "+h+", "+p+"\n",t.removeFragmentTempUsage(h),t.removeFragmentTempUsage(p),r},t.prototype._iRender=function(){},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=i.context,l=t.shaderObject;l.alphaThreshold>0&&(o.setSamplerStateAt(this._texturesIndex,l.repeatTextures?s.REPEAT:s.CLAMP,l.useSmoothTextures?a.LINEAR:a.NEAREST,l.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.stage.activateTexture(this._texturesIndex,l.texture),l.fragmentConstantData[this._fragmentConstantsIndex+8]=t.shaderObject.alphaThreshold)},t}(n);t.exports=l},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/passes/DistanceMapPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/passes/MaterialPassGLBase"),o=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex,r=t.fragmentConstantData;r[i+4]=1/255,r[i+5]=1/255,r[i+6]=1/255,r[i+7]=0},t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++,e.viewDirDependencies++,e.alphaThreshold>0&&e.uvDependencies++,e.viewDirDependencies>0&&e.globalPosDependencies++},t.prototype._iGetFragmentCode=function(e,t,i){var r,a=i.shadedTarget,s=t.getFreeTextureReg(),n=t.getFreeFragmentConstant(),l=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var h=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(h,1);var p=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(p,1),r="dp3 "+h+".z, "+i.viewDirVarying+".xyz, "+i.viewDirVarying+".xyz\nmul "+h+", "+n+", "+h+".z\nfrc "+h+", "+h+"\nmul "+p+", "+h+".yzww, "+l+"\n",e.alphaThreshold>0){s=t.getFreeTextureReg(),this._texturesIndex=s.index;var d=t.getFreeFragmentVectorTemp();r+=o.getTex2DSampleCode(d,i,s,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var c=t.getFreeFragmentConstant();r+="sub "+d+".w, "+d+".w, "+c+".x\nkil "+d+".w\n"}return r+="sub "+a+", "+h+", "+p+"\n"},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=i.context,l=t.shaderObject,h=n.projection.far;h=1/(2*h*h);var p=this._fragmentConstantsIndex,d=l.fragmentConstantData;d[p]=1*h,d[p+1]=255*h,d[p+2]=65025*h,d[p+3]=16581375*h,l.alphaThreshold>0&&(o.setSamplerStateAt(this._texturesIndex,l.repeatTextures?s.REPEAT:s.CLAMP,l.useSmoothTextures?a.LINEAR:a.NEAREST,l.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.stage.activateTexture(this._texturesIndex,l.texture),d[p+8]=t.shaderObject.alphaThreshold)},t}(n);t.exports=l},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/passes/LightingPassGLBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/errors/AbstractMethodError"),a=e("awayjs-renderergl/lib/passes/MaterialPassGLBase"),s=function(e){function t(){e.call(this),this._pNumPointLights=0,this._pNumDirectionalLights=0,this._pNumLightProbes=0,this._directionalLightsOffset=0,this._pointLightsOffset=0,this._lightProbesOffset=0}return i(t,e),Object.defineProperty(t.prototype,"directionalLightsOffset",{get:function(){return this._directionalLightsOffset},set:function(e){this._directionalLightsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointLightsOffset",{get:function(){return this._pointLightsOffset},set:function(e){this._pointLightsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightProbesOffset",{get:function(){return this._lightProbesOffset},set:function(e){this._lightProbesOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iNumPointLights",{get:function(){return this._pNumPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iNumDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iNumLightProbes",{get:function(){return this._pNumLightProbes},enumerable:!0,configurable:!0}),t.prototype._iUsesSpecular=function(){throw new r},t.prototype._iUsesShadows=function(){throw new r},t.prototype._iGetPreLightingVertexCode=function(){throw new r},t.prototype._iGetPreLightingFragmentCode=function(){throw new r},t.prototype._iGetPerLightDiffuseFragmentCode=function(){throw new r},t.prototype._iGetPerLightSpecularFragmentCode=function(){throw new r},t.prototype._iGetPerProbeDiffuseFragmentCode=function(){throw new r},t.prototype._iGetPerProbeSpecularFragmentCode=function(){throw new r},t.prototype._iGetPostLightingVertexCode=function(){throw new r},t.prototype._iGetPostLightingFragmentCode=function(){throw new r},t}(a);t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-renderergl/lib/passes/MaterialPassGLBase":void 0}],"awayjs-renderergl/lib/passes/LineBasicPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/passes/MaterialPassGLBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iGetFragmentCode=function(e,t,i){var r=i.shadedTarget;return"mov "+r+", v0\n"},t}(r);t.exports=a},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":void 0}],"awayjs-renderergl/lib/passes/MaterialPassGLBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/NamedAssetBase"),a=e("awayjs-core/lib/errors/ArgumentError"),s=e("awayjs-core/lib/events/Event"),n=e("awayjs-display/lib/base/BlendMode"),o=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),l=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),h=e("awayjs-renderergl/lib/compilation/ShaderObjectBase"),p=function(e){function t(){var t=this;e.call(this),this._materialPassData=new Array,this._preserveAlpha=!0,this._forceSeparateMVP=!1,this._depthCompareMode=l.LESS_EQUAL,this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1,this._writeDepth=!0,this._onLightsChangeDelegate=function(e){return t.onLightsChange(e)}}return i(t,e),Object.defineProperty(t.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(e){this._preserveAlpha!=e&&(this._preserveAlpha=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(e){this._forceSeparateMVP!=e&&(this._forceSeparateMVP=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),t.prototype.createShaderObject=function(e){return new h(e)},Object.defineProperty(t.prototype,"writeDepth",{get:function(){return this._writeDepth},set:function(e){this._writeDepth=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(this._pLightPicker&&this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate);this._materialPassData.length;)this._materialPassData[0].dispose();this._materialPassData=null},t.prototype._iRender=function(e,t,i,r,a){this.setRenderState(e,t,i,r,a)},t.prototype.setRenderState=function(e,t,i,r,a){e.shaderObject.setRenderState(t,i,r,a)},t.prototype.setBlendMode=function(e){switch(e){case n.NORMAL:this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1;break;case n.LAYER:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE_MINUS_SOURCE_ALPHA,this._pEnableBlending=!0;break;case n.MULTIPLY:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_COLOR,this._pEnableBlending=!0;break;case n.ADD:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE,this._pEnableBlending=!0;break;case n.ALPHA:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_ALPHA,this._pEnableBlending=!0;break;default:throw new a("Unsupported blend mode!")}},t.prototype._iActivate=function(e,t,i){t.context.setDepthTest(this._writeDepth&&!this._pEnableBlending,this._depthCompareMode),this._pEnableBlending&&t.context.setBlendFactors(this._blendFactorSource,this._blendFactorDest),t.activateMaterialPass(e,i)},t.prototype._iDeactivate=function(e,t){t.deactivateMaterialPass(e),t.context.setDepthTest(!0,l.LESS_EQUAL)
},t.prototype._pInvalidatePass=function(){for(var e=this._materialPassData.length,t=0;e>t;t++)this._materialPassData[t].invalidate();this.dispatchEvent(new s(s.CHANGE))},Object.defineProperty(t.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(e){this._pLightPicker&&this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate),this._pLightPicker=e,this._pLightPicker&&this._pLightPicker.addEventListener(s.CHANGE,this._onLightsChangeDelegate),this.pUpdateLights()},enumerable:!0,configurable:!0}),t.prototype.onLightsChange=function(){this.pUpdateLights()},t.prototype.pUpdateLights=function(){},t.prototype._iIncludeDependencies=function(e){this._forceSeparateMVP&&e.globalPosDependencies++,e.outputsNormals=this._pOutputsNormals(e),e.outputsTangentNormals=e.outputsNormals&&this._pOutputsTangentNormals(e),e.usesTangentSpace=e.outputsTangentNormals&&this._pUsesTangentSpace(e),!e.usesTangentSpace&&e.viewDirDependencies>0&&e.globalPosDependencies++},t.prototype._iInitConstantData=function(){},t.prototype._iGetPreLightingVertexCode=function(){return""},t.prototype._iGetPreLightingFragmentCode=function(){return""},t.prototype._iGetVertexCode=function(){return""},t.prototype._iGetFragmentCode=function(){return""},t.prototype._iGetNormalVertexCode=function(){return""},t.prototype._iGetNormalFragmentCode=function(){return""},t.prototype._pOutputsNormals=function(){return!1},t.prototype._pOutputsTangentNormals=function(){return!1},t.prototype._pUsesTangentSpace=function(){return!1},t.prototype._iAddMaterialPassData=function(e){return this._materialPassData.push(e),e},t.prototype._iRemoveMaterialPassData=function(e){return this._materialPassData.splice(this._materialPassData.indexOf(e),1),e},t}(r);t.exports=p},{"awayjs-core/lib/errors/ArgumentError":void 0,"awayjs-core/lib/events/Event":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-renderergl/lib/compilation/ShaderObjectBase":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/passes/SkyboxPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/passes/MaterialPassGLBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iIncludeDependencies=function(e){e.useMipmapping=!1},t}(r);t.exports=a},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":void 0}],"awayjs-renderergl/lib/passes/TriangleBasicPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/passes/MaterialPassGLBase"),o=e("awayjs-renderergl/lib/utils/ShaderCompilerHelper"),l=function(e){function t(){e.call(this),this._diffuseColor=16777215,this._diffuseR=1,this._diffuseG=1,this._diffuseB=1,this._diffuseA=1}return i(t,e),Object.defineProperty(t.prototype,"diffuseAlpha",{get:function(){return this._diffuseA},set:function(e){this._diffuseA=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){this._diffuseColor=e,this._diffuseR=(this._diffuseColor>>16&255)/255,this._diffuseG=(this._diffuseColor>>8&255)/255,this._diffuseB=(255&this._diffuseColor)/255},enumerable:!0,configurable:!0}),t.prototype._iGetFragmentCode=function(e,t,i){var r,a="",s=i.shadedTarget;if(null!=e.texture){if(r=t.getFreeTextureReg(),this._texturesIndex=r.index,a+=o.getTex2DSampleCode(s,i,r,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping),e.alphaThreshold>0){var n=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index,a+="sub "+s+".w, "+s+".w, "+n+".x\nkil "+s+".w\nadd "+s+".w, "+s+".w, "+n+".x\n"}}else r=t.getFreeFragmentConstant(),this._fragmentConstantsIndex=4*r.index,a+="mov "+s+", "+r+"\n";return a},t.prototype._iIncludeDependencies=function(e){null!=e.texture&&e.uvDependencies++},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=t.shaderObject;if(null!=o.texture)i.context.setSamplerStateAt(this._texturesIndex,o.repeatTextures?s.REPEAT:s.CLAMP,o.useSmoothTextures?a.LINEAR:a.NEAREST,o.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.stage.activateTexture(this._texturesIndex,o.texture),o.alphaThreshold>0&&(o.fragmentConstantData[this._fragmentConstantsIndex]=o.alphaThreshold);else{var l=this._fragmentConstantsIndex,h=o.fragmentConstantData;h[l]=this._diffuseR,h[l+1]=this._diffuseG,h[l+2]=this._diffuseB,h[l+3]=this._diffuseA}},t}(n);t.exports=l},{"awayjs-renderergl/lib/passes/MaterialPassGLBase":void 0,"awayjs-renderergl/lib/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/pick/JSPickingCollider":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-renderergl/lib/pick/PickingColliderBase"),n=function(e){function t(t){void 0===t&&(t=!1),e.call(this),this._findClosestCollision=t}return i(t,e),t.prototype._pTestRenderableCollision=function(e,t,i){for(var s,n,o,l,h,p,d,c,u,_,g,m,y,f,b,x,v,w,P,C,T,D,S,O,A,R,j,V,I,N,L,M,F,E,B,z,U,G,k,X,W,H=e.getIndexData().data,Z=-1,q=e.materialOwner.material.bothSides,Y=e.getVertexData(a.POSITION_DATA).data,J=e.getVertexData(a.POSITION_DATA).dataPerVertex,Q=e.getVertexOffset(a.POSITION_DATA),K=e.getVertexData(a.UV_DATA).data,$=e.getVertexData(a.UV_DATA).dataPerVertex,et=e.getVertexOffset(a.UV_DATA),tt=H.length,it=0;tt>it;it+=3)if(n=Q+H[it]*J,o=Q+H[it+1]*J,l=Q+H[it+2]*J,w=Y[n],P=Y[n+1],C=Y[n+2],T=Y[o],D=Y[o+1],S=Y[o+2],O=Y[l],A=Y[l+1],R=Y[l+2],j=T-w,V=D-P,I=S-C,N=O-w,L=A-P,M=R-C,c=V*M-I*L,u=I*N-j*M,_=j*L-V*N,F=1/Math.sqrt(c*c+u*u+_*_),c*=F,u*=F,_*=F,E=c*this.rayDirection.x+u*+this.rayDirection.y+_*this.rayDirection.z,!q&&0>E||q&&0!=E){if(B=-(c*w+u*P+_*C),z=-(c*this.rayPosition.x+u*this.rayPosition.y+_*this.rayPosition.z+B),s=z/E,g=this.rayPosition.x+s*this.rayDirection.x,m=this.rayPosition.y+s*this.rayDirection.y,y=this.rayPosition.z+s*this.rayDirection.z,U=j*N+V*L+I*M,G=j*j+V*V+I*I,k=N*N+L*L+M*M,h=g-w,p=m-P,d=y-C,X=h*j+p*V+d*I,W=h*N+p*L+d*M,f=1/(G*k-U*U),x=f*(k*X-U*W),v=f*(-U*X+G*W),0>x)continue;if(0>v)continue;if(b=1-x-v,!(0>b)&&s>0&&i>s&&(i=s,Z=it/3,t.rayEntryDistance=s,t.localPosition=new r(g,m,y),t.localNormal=new r(c,u,_),t.uv=this._pGetCollisionUV(H,K,it,x,v,b,et,$),t.index=it,!this._findClosestCollision))return!0}return Z>=0?!0:!1},t}(s);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pick/PickingColliderBase":void 0}],"awayjs-renderergl/lib/pick/PickingColliderBase":[function(e,t){var i=e("awayjs-core/lib/geom/Point"),r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-core/lib/errors/AbstractMethodError"),s=e("awayjs-display/lib/pool/RenderablePool"),n=e("awayjs-renderergl/lib/pool/BillboardRenderable"),o=e("awayjs-renderergl/lib/pool/TriangleSubMeshRenderable"),l=function(){function e(){this._billboardRenderablePool=s.getPool(n),this._subMeshRenderablePool=s.getPool(o)}return e.prototype._pPetCollisionNormal=function(e,t,i){var a=new r,s=3*e[i],n=3*e[i+1],o=3*e[i+2],l=new r(t[s],t[s+1],t[s+2]),h=new r(t[n],t[n+1],t[n+2]),p=new r(t[o],t[o+1],t[o+2]),d=h.subtract(l),c=p.subtract(l);return a=d.crossProduct(c),a.normalize(),a},e.prototype._pGetCollisionUV=function(e,t,a,s,n,o,l,h){var p=new i,d=e[a]*h+l,c=new r(t[d],t[d+1]);d=e[a+1]*h+l;var u=new r(t[d],t[d+1]);d=e[a+2]*h+l;var _=new r(t[d],t[d+1]);return p.x=o*c.x+s*u.x+n*_.x,p.y=o*c.y+s*u.y+n*_.y,p},e.prototype._pTestRenderableCollision=function(){throw new a},e.prototype.setLocalRay=function(e,t){this.rayPosition=e,this.rayDirection=t},e.prototype.testBillboardCollision=function(e,t,i){return this.setLocalRay(t.localRayPosition,t.localRayDirection),t.materialOwner=null,this._pTestRenderableCollision(this._billboardRenderablePool.getItem(e),t,i)?(i=t.rayEntryDistance,t.materialOwner=e,!0):!1},e.prototype.testMeshCollision=function(e,t,i,r){this.setLocalRay(t.localRayPosition,t.localRayDirection),t.materialOwner=null;for(var a,s=e.subMeshes.length,n=0;s>n;++n)if(a=e.subMeshes[n],this._pTestRenderableCollision(this._subMeshRenderablePool.getItem(a),t,i)&&(i=t.rayEntryDistance,t.materialOwner=a,!r))return!0;return null!=t.materialOwner},e}();t.exports=l},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-renderergl/lib/pool/BillboardRenderable":void 0,"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":void 0}],"awayjs-renderergl/lib/pick/ShaderPicker":[function(e,t){var i=e("awayjs-core/lib/utils/Debug"),r=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-core/lib/geom/Matrix3DUtils"),s=e("awayjs-core/lib/geom/Point"),n=e("awayjs-core/lib/geom/Rectangle"),o=e("awayjs-core/lib/geom/Vector3D"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),h=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),p=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),d=e("awayjs-stagegl/lib/base/ContextGLClearMask"),c=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),u=e("awayjs-stagegl/lib/base/ContextGLProgramType"),_=e("awayjs-stagegl/lib/base/ContextGLTriangleFace"),g=function(){function e(e){void 0===e&&(e=!1),this._onlyMouseEnabled=!0,this._interactives=new Array,this._localHitPosition=new o,this._hitUV=new s,this._localHitNormal=new o,this._rayPos=new o,this._rayDir=new o,this._shaderPickingDetails=e,this._id=new Array(4),this._viewportData=new Array(4),this._boundOffsetScale=new Array(8),this._boundOffsetScale[3]=0,this._boundOffsetScale[7]=1}return Object.defineProperty(e.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},set:function(e){this._onlyMouseEnabled=e},enumerable:!0,configurable:!0}),e.prototype.getViewCollision=function(e,t,i){var a=i.iEntityCollector;if(this._stage=i.renderer.stage,!this._stage)return null;if(this._context=this._stage.context,this._viewportData[0]=i.width,this._viewportData[1]=i.height,this._viewportData[2]=-(this._projX=2*e/i.width-1),this._viewportData[3]=this._projY=2*t/i.height-1,this._potentialFound=!1,this._blendedRenderableHead=null,this._opaqueRenderableHead=null,this.pDraw(a,null),this._context.setVertexBufferAt(0,null),!this._context||!this._potentialFound)return null;if(this._bitmapData||(this._bitmapData=new r(1,1,!1,0)),this._context.drawToBitmapData(this._bitmapData),this._hitColor=this._bitmapData.getPixel(0,0),!this._hitColor)return this._context.present(),null;if(this._hitRenderable=this._interactives[this._hitColor-1],this._hitEntity=this._hitRenderable.sourceEntity,this._onlyMouseEnabled&&!this._hitEntity._iIsMouseEnabled())return null;var s=this._hitEntity._iPickingCollisionVO;return this._shaderPickingDetails?(this.getHitDetails(i.camera),s.localPosition=this._localHitPosition,s.localNormal=this._localHitNormal,s.uv=this._hitUV,s.index=this._faceIndex):(s.localPosition=null,s.localNormal=null,s.uv=null,s.index=0),s},e.prototype.getSceneCollision=function(){return null},e.prototype.pDraw=function(t){t.camera;this._context.clear(0,0,0,1),this._stage.scissorRect=e.MOUSE_SCISSOR_RECT,this._interactives.length=this._interactiveId=0,this._objectProgram||this.initObjectProgram(),this._context.setBlendFactors(p.ONE,p.ZERO),this._context.setDepthTest(!0,c.LESS),this._context.setProgram(this._objectProgram),this._context.setProgramConstantsFromArray(u.VERTEX,4,this._viewportData,1)},e.prototype.drawRenderables=function(e,t){for(var i=a.CALCULATION_MATRIX,r=t.viewProjection;e;)e.sourceEntity.scene&&e.sourceEntity._iIsMouseEnabled()?(this._potentialFound=!0,this._context.setCulling(e.materialOwner.material.bothSides?_.NONE:_.BACK,t.projection.coordinateSystem),this._interactives[this._interactiveId++]=e,this._id[1]=(this._interactiveId>>8)/255,this._id[2]=(255&this._interactiveId)/255,i.copyFrom(e.sourceEntity.getRenderSceneTransform(t)),i.append(r),this._context.setProgramConstantsFromMatrix(u.VERTEX,0,i,!0),this._context.setProgramConstantsFromArray(u.FRAGMENT,0,this._id,1),this._stage.activateBuffer(0,e.getVertexData(l.POSITION_DATA),e.getVertexOffset(l.POSITION_DATA),l.POSITION_FORMAT),this._context.drawTriangles(this._stage.getIndexBuffer(e.getIndexData()),0,e.numTriangles),e=e.next):e=e.next},e.prototype.updateRay=function(e){this._rayPos=e.scenePosition,this._rayDir=e.getRay(this._projX,this._projY,1),this._rayDir.normalize()},e.prototype.initObjectProgram=function(){var e,t;this._objectProgram=this._context.createProgram(),e="m44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",t="mov oc, fc0",i.throwPIR("ShaderPicker","initTriangleProgram","Dependency: initObjectProgram")},e.prototype.initTriangleProgram=function(){var e,t;this._triangleProgram=this._context.createProgram(),e="add vt0, va0, vc5 			\nmul vt0, vt0, vc6 			\nmov v0, vt0				\nm44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",t="mov oc, v0";var i=(new h).assemble("part vertex 1\n"+e+"endpart").vertex.data,r=(new h).assemble("part fragment 1\n"+t+"endpart").fragment.data;this._triangleProgram.upload(i,r)},e.prototype.getHitDetails=function(e){this.getApproximatePosition(e),this.getPreciseDetails(e)},e.prototype.getApproximatePosition=function(t){var i,r,s,n,o,h,p,c=this._hitRenderable.sourceEntity.bounds.aabb,_=a.CALCULATION_MATRIX;_.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(t)),_.append(t.viewProjection),this._triangleProgram||this.initTriangleProgram(),this._boundOffsetScale[4]=1/(r=c.width),this._boundOffsetScale[5]=1/(s=c.height),this._boundOffsetScale[6]=1/(n=c.depth),this._boundOffsetScale[0]=o=-c.x,this._boundOffsetScale[1]=h=-c.y,this._boundOffsetScale[2]=p=-c.z,this._context.setProgram(this._triangleProgram),this._context.clear(0,0,0,0,1,0,d.DEPTH),this._context.setScissorRectangle(e.MOUSE_SCISSOR_RECT),this._context.setProgramConstantsFromMatrix(u.VERTEX,0,_,!0),this._context.setProgramConstantsFromArray(u.VERTEX,5,this._boundOffsetScale,2),this._stage.activateBuffer(0,this._hitRenderable.getVertexData(l.POSITION_DATA),this._hitRenderable.getVertexOffset(l.POSITION_DATA),l.POSITION_FORMAT),this._context.drawTriangles(this._stage.getIndexBuffer(this._hitRenderable.getIndexData()),0,this._hitRenderable.numTriangles),this._context.drawToBitmapData(this._bitmapData),i=this._bitmapData.getPixel(0,0),this._localHitPosition.x=(i>>16&255)*r/255-o,this._localHitPosition.y=(i>>8&255)*s/255-h,this._localHitPosition.z=(255&i)*n/255-p},e.prototype.getPreciseDetails=function(e){var t,i,r,a,s,n,o,h,p,d,c,u,_,g,m,y,f,b,x,v,w,P,C,T,D,S,O,A,R,j,V,I,N,L,M,F,E,B,z,U,G,k,X,W,H,Z,q,Y,J=rt.length,Q=0,K=1,$=2,et=this._localHitPosition.x,tt=this._localHitPosition.y,it=this._localHitPosition.z,rt=this._hitRenderable.getIndexData().data,at=this._hitRenderable.getVertexData(l.POSITION_DATA).data,st=this._hitRenderable.getVertexData(l.POSITION_DATA).dataPerVertex,nt=this._hitRenderable.getVertexOffset(l.POSITION_DATA),ot=this._hitRenderable.getVertexData(l.UV_DATA).data,lt=this._hitRenderable.getVertexData(l.UV_DATA).dataPerVertex,ht=this._hitRenderable.getVertexOffset(l.UV_DATA),pt=(this._hitRenderable.getVertexData(l.NORMAL_DATA).data,this._hitRenderable.getVertexData(l.NORMAL_DATA).dataPerVertex),dt=this._hitRenderable.getVertexOffset(l.NORMAL_DATA);for(this.updateRay(e);J>Q;){if(d=nt+rt[Q]*st,c=nt+rt[K]*st,u=nt+rt[$]*st,t=at[d],i=at[d+1],r=at[d+2],a=at[c],s=at[c+1],n=at[c+2],o=at[u],h=at[u+1],p=at[u+2],!(t>et&&a>et&&o>et||i>tt&&s>tt&&h>tt||r>it&&n>it&&p>it||et>t&&et>a&&et>o||tt>i&&tt>s&&tt>h||it>r&&it>n&&it>p)&&(_=o-t,g=h-i,m=p-r,y=a-t,f=s-i,b=n-r,x=et-t,v=tt-i,w=it-r,R=_*_+g*g+m*m,j=_*y+g*f+m*b,V=_*x+g*v+m*w,I=y*y+f*f+b*b,N=y*x+f*v+b*w,F=1/(R*I-j*j),L=(I*V-j*N)*F,M=(R*N-j*V)*F,L>=0&&M>=0&&1>=L+M))return P=dt+rt[Q]*pt,C=dt+rt[K]*pt,T=dt+rt[$]*pt,D=rt[P]+rt[C]+rt[T],S=rt[P+1]+rt[C+1]+rt[T+1],O=rt[P+2]+rt[C+2]+rt[T+2],A=Math.sqrt(D*D+S*S+O*O),D/=A,S/=A,O/=A,this.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform,D,S,O,t,i,r),x=this._localHitPosition.x-t,v=this._localHitPosition.y-i,w=this._localHitPosition.z-r,k=a-t,X=s-i,W=n-r,H=o-t,Z=h-i,q=p-r,this._localHitNormal.x=X*q-W*Z,this._localHitNormal.y=W*H-k*q,this._localHitNormal.z=k*Z-X*H,Y=1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x+this._localHitNormal.y*this._localHitNormal.y+this._localHitNormal.z*this._localHitNormal.z),this._localHitNormal.x*=Y,this._localHitNormal.y*=Y,this._localHitNormal.z*=Y,V=_*x+g*v+m*w,N=y*x+f*v+b*w,L=(I*V-j*N)*F,M=(R*N-j*V)*F,z=ht+rt[Q]*lt,U=ht+rt[K]*lt,G=ht+rt[$]*lt,E=ot[z],B=ot[z+1],this._hitUV.x=E+M*(ot[U]-E)+L*(ot[G]-E),this._hitUV.y=B+M*(ot[U+1]-B)+L*(ot[G+1]-B),void(this._faceIndex=Q);Q+=3,K+=3,$+=3}},e.prototype.getPrecisePosition=function(e,t,i,r,s,n,o){var l,h,p,d,c,u,_,g=a.RAW_DATA_CONTAINER,m=this._rayPos.x,y=this._rayPos.y,f=this._rayPos.z;d=this._rayDir.x,c=this._rayDir.y,u=this._rayDir.z,e.copyRawDataTo(g),l=g[0]*d+g[4]*c+g[8]*u,h=g[1]*d+g[5]*c+g[9]*u,p=g[2]*d+g[6]*c+g[10]*u,d=g[0]*m+g[4]*y+g[8]*f+g[12],c=g[1]*m+g[5]*y+g[9]*f+g[13],u=g[2]*m+g[6]*y+g[10]*f+g[14],_=((s-d)*t+(n-c)*i+(o-u)*r)/(l*t+h*i+p*r),this._localHitPosition.x=d+l*_,this._localHitPosition.y=c+h*_,this._localHitPosition.z=u+p*_},e.prototype.dispose=function(){this._bitmapData.dispose(),this._triangleProgram&&this._triangleProgram.dispose(),this._objectProgram&&this._objectProgram.dispose(),this._triangleProgram=null,this._objectProgram=null,this._bitmapData=null,this._hitRenderable=null,this._hitEntity=null},e.MOUSE_SCISSOR_RECT=new n(0,0,1,1),e}();t.exports=g},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/utils/Debug":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/ContextGLTriangleFace":void 0}],"awayjs-renderergl/lib/pool/BillboardRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-renderergl/lib/pool/RenderableBase"),s=function(e){function t(t,i){e.call(this,t,i,i),this._billboard=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=this._billboard.material,i=t._materialGeometry[e.id];return i?i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0)):(i=t._materialGeometry[e.id]=new r(!0),i.autoDeriveNormals=!1,i.autoDeriveTangents=!1,i.updateIndices(Array(0,1,2,0,2,3)),i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0)),i.updateVertexNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0)),i.updateVertexTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i.updateUVs(Array(0,0,1,0,1,1,0,1))),this._pVertexDataDirty[r.POSITION_DATA]=!0,this._pVertexDataDirty[r.NORMAL_DATA]=!0,this._pVertexDataDirty[r.TANGENT_DATA]=!0,this._pVertexDataDirty[r.UV_DATA]=!0,i},t._materialGeometry=new Object,t.id="billboard",t}(a);t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0}],"awayjs-renderergl/lib/pool/LineSubMeshRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/LineSubGeometry"),a=e("awayjs-renderergl/lib/pool/RenderableBase"),s=function(e){function t(t,i,r,a){void 0===r&&(r=0),void 0===a&&(a=0),e.call(this,t,i.parentMesh,i,r,a),this.subMesh=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=this.subMesh.subGeometry;return this._pVertexDataDirty[r.START_POSITION_DATA]=!0,this._pVertexDataDirty[r.END_POSITION_DATA]=!0,e.thickness&&(this._pVertexDataDirty[r.THICKNESS_DATA]=!0),e.startColors&&(this._pVertexDataDirty[r.COLOR_DATA]=!0),e},t.prototype._pGetOverflowRenderable=function(e,i,r,a){return new t(e,i,r,a)},t.id="linesubmesh",t}(a);t.exports=s},{"awayjs-display/lib/base/LineSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0}],"awayjs-renderergl/lib/pool/MaterialDataPool":[function(e,t){var i=e("awayjs-renderergl/lib/pool/MaterialData"),r=function(){function e(){this._pool=new Object}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=e._iAddMaterialData(new i(this,e)))},e.prototype.disposeItem=function(e){e._iRemoveMaterialData(this._pool[e.id]),this._pool[e.id]=null},e}();t.exports=r},{"awayjs-renderergl/lib/pool/MaterialData":void 0}],"awayjs-renderergl/lib/pool/MaterialData":[function(e,t){var i=e("awayjs-renderergl/lib/pool/MaterialPassDataPool"),r=function(){function e(e,t){this.invalidAnimation=!0,this._pool=e,this.material=t,this._materialPassDataPool=new i(t)}return e.prototype.getMaterialPass=function(e,t){var i=this._materialPassDataPool.getItem(e);if(i.shaderObject||(i.shaderObject=e.createShaderObject(t),i.invalid=!0),i.invalid){i.invalid=!1;var r=i.shaderObject.createCompiler(this.material,e);r.compile(),i.shadedTarget=r.shadedTarget,i.vertexCode=r.vertexCode,i.fragmentCode=r.fragmentCode,i.postAnimationFragmentCode=r.postAnimationFragmentCode,i.key=""}return i},e.prototype.getMaterialPasses=function(e){if(null==this._passes){var t=this.material._iScreenPasses,i=t.length;this._passes=new Array(i);for(var r=0;i>r;r++)this._passes[r]=this.getMaterialPass(t[r],e)}return this._passes},e.prototype.dispose=function(){this._materialPassDataPool.disposePool(),this._materialPassDataPool=null,this._pool.disposeItem(this.material),this._passes=null},e.prototype.invalidateMaterial=function(){this._passes=null,this.invalidateAnimation()},e.prototype.invalidateAnimation=function(){this.invalidAnimation=!0},e}();t.exports=r},{"awayjs-renderergl/lib/pool/MaterialPassDataPool":void 0}],"awayjs-renderergl/lib/pool/MaterialPassDataPool":[function(e,t){var i=e("awayjs-renderergl/lib/pool/MaterialPassData"),r=function(){function e(e){this._pool=new Object,this._material=e}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=this._material._iAddMaterialPassData(e._iAddMaterialPassData(new i(this,this._material,e))))},e.prototype.disposeItem=function(e){e._iRemoveMaterialPassData(this._pool[e.id]),delete this._pool[e.id]},e.prototype.disposePool=function(){for(var e in this._pool)this._pool[e].materialPass._iRemoveMaterialPassData(this._pool[e]);delete this._pool},e}();t.exports=r},{"awayjs-renderergl/lib/pool/MaterialPassData":void 0}],"awayjs-renderergl/lib/pool/MaterialPassData":[function(e,t){var i=function(){function e(e,t,i){this.animationVertexCode="",this.animationFragmentCode="",this._pool=e,this.material=t,this.materialPass=i}return e.prototype.dispose=function(){this._pool.disposeItem(this.materialPass),this.shaderObject.dispose(),this.shaderObject=null,this.programData.dispose(),this.programData=null},e.prototype.invalidate=function(){this.invalid=!0},e}();t.exports=i},{}],"awayjs-renderergl/lib/pool/RenderableBase":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),r=e("awayjs-display/lib/base/SubGeometryBase"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-display/lib/events/SubGeometryEvent"),n=e("awayjs-stagegl/lib/pool/IndexDataPool"),o=e("awayjs-stagegl/lib/pool/VertexDataPool"),l=function(){function e(e,t,i,r,a){var s=this;void 0===r&&(r=0),void 0===a&&(a=0),this._geometryDirty=!0,this._indexDataDirty=!0,this._vertexData=new Object,this._pVertexDataDirty=new Object,this._vertexOffset=new Object,this._onIndicesUpdatedDelegate=function(e){return s._onIndicesUpdated(e)},this._onVerticesUpdatedDelegate=function(e){return s._onVerticesUpdated(e)},this._pool=e,this._level=r,this._indexOffset=a,this.sourceEntity=t,this.materialOwner=i}return Object.defineProperty(e.prototype,"overflow",{get:function(){return this._indexDataDirty&&this._updateIndexData(),this._overflow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTriangles",{get:function(){return this._numTriangles},enumerable:!0,configurable:!0}),e.prototype.getIndexData=function(){return this._indexDataDirty&&this._updateIndexData(),this._indexData},e.prototype.getVertexData=function(e){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[e]&&this._updateVertexData(e),this._vertexData[this._concatenateArrays?a.VERTEX_DATA:e]},e.prototype.getVertexOffset=function(e){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[e]&&this._updateVertexData(e),this._vertexOffset[e]},e.prototype.dispose=function(){this._pool.disposeItem(this.materialOwner),this._indexData.dispose(),this._indexData=null;for(var e in this._vertexData)this._vertexData[e].dispose(),this._vertexData[e]=null;this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype.invalidateGeometry=function(){this._geometryDirty=!0,0==this._level&&(this._indexDataDirty=!0),this._overflow&&this._overflow.invalidateGeometry()},e.prototype.invalidateIndexData=function(){this._indexDataDirty=!0},e.prototype.invalidateVertexData=function(e){this._pVertexDataDirty[e]=!0},e.prototype._pGetSubGeometry=function(){throw new i},e.prototype._iFillIndexData=function(e){this._geometryDirty&&this._updateGeometry(),this._indexData=n.getItem(this._subGeometry,this._level,e),this._numTriangles=this._indexData.data.length/3,e=this._indexData.offset,e<this._subGeometry.indices.length?(this._overflow||(this._overflow=this._pGetOverflowRenderable(this._pool,this.materialOwner,e,this._level+1)),this._overflow._iFillIndexData(e)):this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype._pGetOverflowRenderable=function(){throw new i},e.prototype._updateGeometry=function(){this._subGeometry&&(0==this._level&&this._subGeometry.removeEventListener(s.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.removeEventListener(s.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._subGeometry=this._pGetSubGeometry(),this._concatenateArrays=this._subGeometry.concatenateArrays,this._subGeometry&&(0==this._level&&this._subGeometry.addEventListener(s.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.addEventListener(s.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._geometryDirty=!1},e.prototype._updateIndexData=function(){this._iFillIndexData(this._indexOffset),this._indexDataDirty=!1},e.prototype._updateVertexData=function(e){this._vertexOffset[e]=this._subGeometry.getOffset(e),this._subGeometry.concatenateArrays&&(e=r.VERTEX_DATA),this._vertexData[e]=o.getItem(this._subGeometry,this.getIndexData(),e),this._pVertexDataDirty[e]=!1},e.prototype._onIndicesUpdated=function(){this.invalidateIndexData()},e.prototype._onVerticesUpdated=function(e){this._concatenateArrays=e.target.concatenateArrays,this.invalidateVertexData(e.dataType)},e}();t.exports=l},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-display/lib/base/SubGeometryBase":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/events/SubGeometryEvent":void 0,"awayjs-stagegl/lib/pool/IndexDataPool":void 0,"awayjs-stagegl/lib/pool/VertexDataPool":void 0}],"awayjs-renderergl/lib/pool/SkyboxRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-renderergl/lib/pool/RenderableBase"),s=function(e){function t(t,i){e.call(this,t,i,i)}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=t._geometry;return e||(e=t._geometry=new r(!0),e.autoDeriveNormals=!1,e.autoDeriveTangents=!1,e.updateIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2)),e.updatePositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1))),this._pVertexDataDirty[r.POSITION_DATA]=!0,e},t.id="skybox",t}(a);t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0}],"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/pool/RenderableBase"),n=function(e){function t(t,i,r,a){void 0===r&&(r=0),void 0===a&&(a=0),e.call(this,t,i.parentMesh,i,r,a),this.subMesh=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e;switch(e=this.subMesh.animator?this.subMesh.animator.getRenderableSubGeometry(this,this.subMesh.subGeometry):this.subMesh.subGeometry,this._pVertexDataDirty[r.POSITION_DATA]=!0,e.vertexNormals&&(this._pVertexDataDirty[r.NORMAL_DATA]=!0),e.vertexTangents&&(this._pVertexDataDirty[r.TANGENT_DATA]=!0),e.uvs&&(this._pVertexDataDirty[r.UV_DATA]=!0),e.secondaryUVs&&(this._pVertexDataDirty[r.SECONDARY_UV_DATA]=!0),e.jointIndices&&(this._pVertexDataDirty[r.JOINT_INDEX_DATA]=!0),e.jointWeights&&(this._pVertexDataDirty[r.JOINT_WEIGHT_DATA]=!0),e.jointsPerVertex){case 1:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_1;break;case 2:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_2;break;case 3:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_3;break;case 4:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_4}return e},t.prototype._pGetOverflowRenderable=function(e,i,r,a){return new t(e,i,r,a)},t.id="trianglesubmesh",t}(s);t.exports=n},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/render/DefaultRenderer":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/textures/RenderTexture"),n=e("awayjs-display/lib/pool/RenderablePool"),o=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),l=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),h=e("awayjs-stagegl/lib/base/ContextGLClearMask"),p=e("awayjs-stagegl/lib/managers/StageManager"),d=e("awayjs-renderergl/lib/pool/SkyboxRenderable"),c=e("awayjs-renderergl/lib/render/DepthRenderer"),u=e("awayjs-renderergl/lib/render/Filter3DRenderer"),_=e("awayjs-renderergl/lib/render/RendererBase"),g=e("awayjs-renderergl/lib/managers/RTTBufferManager"),m=e("awayjs-renderergl/lib/passes/DepthMapPass"),y=e("awayjs-renderergl/lib/passes/DistanceMapPass"),f=function(e){function t(t,i,a){void 0===t&&(t=!1),void 0===i&&(i="baseline"),void 0===a&&(a="auto"),e.call(this),this._skyboxProjection=new r,this._skyboxRenderablePool=n.getPool(d),this._pDepthRenderer=new c(new m),this._pDistanceRenderer=new c(new y),null==this._pStage&&(this.stage=p.getInstance().getFreeStage(t,i,a)),this._pRttBufferManager=g.getInstance(this._pStage),0==this._width?this.width=window.innerWidth:this._pRttBufferManager.viewWidth=this._width,0==this._height?this.height=window.innerHeight:this._pRttBufferManager.viewHeight=this._height
}return i(t,e),Object.defineProperty(t.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(e){this._antiAlias!=e&&(this._antiAlias=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(e){this._depthPrepass=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(e){e&&0==e.length&&(e=null),this._pFilter3DRenderer&&!e?(this._pFilter3DRenderer.dispose(),this._pFilter3DRenderer=null):!this._pFilter3DRenderer&&e&&(this._pFilter3DRenderer=new u(this._pStage),this._pFilter3DRenderer.filters=e),this._pFilter3DRenderer?(this._pFilter3DRenderer.filters=e,this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender):(this._pRequireDepthRender=!1,this._pDepthRender&&(this._pDepthRender.dispose(),this._pDepthRender=null))},enumerable:!0,configurable:!0}),t.prototype.render=function(t){return e.prototype.render.call(this,t),this._pStage.recoverFromDisposal()?(this._pBackBufferInvalid&&this.pUpdateBackBuffer(),this._shareContext&&this._pContext&&this._pContext.clear(0,0,0,1,1,0,h.DEPTH),this._pFilter3DRenderer?(this.textureRatioX=this._pRttBufferManager.textureRatioX,this.textureRatioY=this._pRttBufferManager.textureRatioY):(this.textureRatioX=1,this.textureRatioY=1),this._pRequireDepthRender&&this.pRenderSceneDepthToTexture(t),this._depthPrepass&&this.pRenderDepthPrepass(t),this._pFilter3DRenderer&&this._pContext||(this._shareContext?this._iRender(t,null,this._pScissorRect):this._iRender(t)),e.prototype.render.call(this,t),!this._shareContext&&this._pContext&&this._pContext.present(),void(this._pStage.bufferClear=!1)):void(this._pBackBufferInvalid=!0)},t.prototype.pExecuteRender=function(t,i,r,a){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=0),this.updateLights(t),i&&(this.pCollectRenderables(t),this.drawRenderables(this._pOpaqueRenderableHead,t),this.drawRenderables(this._pBlendedRenderableHead,t)),e.prototype.pExecuteRender.call(this,t,i,r,a)},t.prototype.updateLights=function(e){var t,i,r,a,s=e.directionalLights,n=e.pointLights;for(t=s.length,i=0;t>i;++i)r=s[i],a=r.shadowMapper,r.castsShadows&&(a.autoUpdateShadows||a._iShadowsInvalid)&&a.iRenderDepthMap(e,this._pDepthRenderer);for(t=n.length,i=0;t>i;++i)r=n[i],a=r.shadowMapper,r.castsShadows&&(a.autoUpdateShadows||a._iShadowsInvalid)&&a.iRenderDepthMap(e,this._pDistanceRenderer)},t.prototype.pDraw=function(e,t){t||this.pCollectRenderables(e),this._pContext.setBlendFactors(o.ONE,o.ZERO),e.skyBox&&(this._pContext.setDepthTest(!1,l.ALWAYS),this.drawSkybox(e)),this._pContext.setDepthTest(!0,l.LESS_EQUAL),this.drawRenderables(this._pOpaqueRenderableHead,e),this.drawRenderables(this._pBlendedRenderableHead,e)},t.prototype.drawSkybox=function(e){var t=this._skyboxRenderablePool.getItem(e.skyBox),i=e.skyBox.material,r=e.camera;this.updateSkyboxProjection(r);var a=this.getMaterial(i,this._pStage.profile).getMaterialPass(i._iScreenPasses[0],this._pStage.profile);i._iActivatePass(a,this,r),i._iRenderPass(a,t,this._pStage,r,this._skyboxProjection),i._iDeactivatePass(a,this)},t.prototype.updateSkyboxProjection=function(e){var t=new a;this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix),this._skyboxProjection.copyRowTo(2,t);var i=e.scenePosition,r=t.x,s=t.y,n=t.z,o=-(t.x*i.x+t.y*i.y+t.z*i.z+Math.sqrt(r*r+s*s+n*n)),l=r>=0?1:-1,h=s>=0?1:-1,p=new a(l,h,1,1),d=this._skyboxProjection.clone();d.invert();var c=d.transformVector(p);this._skyboxProjection.copyRowTo(3,p);var u=(c.x*p.x+c.y*p.y+c.z*p.z+c.w*p.w)/(r*c.x+s*c.y+n*c.z+o*c.w);this._skyboxProjection.copyRowFrom(2,new a(r*u,s*u,n*u,o*u))},t.prototype.drawRenderables=function(e,t){for(var i,r,a,s,n,o,l=(this._pStage.context,t.camera);e;){for(n=this.getMaterial(e.material,this._pStage.profile),a=e.material._iScreenPasses,r=e.material._iNumScreenPasses(),i=0;r>i;i++){o=e,s=n.getMaterialPass(a[i],this._pStage.profile),e.material._iActivatePass(s,this,l);do e.material._iRenderPass(s,o,this._pStage,l,this._pRttViewProjectionMatrix),o=o.next;while(o&&o.material==e.material);n.material._iDeactivatePass(s,this)}e=o}},t.prototype.dispose=function(){this._shareContext||this._pStage.dispose(),this._pDepthRenderer.dispose(),this._pDistanceRenderer.dispose(),this._pDepthRenderer=null,this._pDistanceRenderer=null,this._pDepthRender=null,e.prototype.dispose.call(this)},t.prototype.pRenderDepthPrepass=function(e){this._pDepthRenderer.disableColor=!0,this._pFilter3DRenderer||(this._pDepthRenderer.textureRatioX=1,this._pDepthRenderer.textureRatioY=1,this._pDepthRenderer._iRender(e)),this._pDepthRenderer.disableColor=!1},t.prototype.pRenderSceneDepthToTexture=function(e){(this._pDepthTextureInvalid||!this._pDepthRender)&&this.initDepthTexture(this._pStage.context),this._pDepthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX,this._pDepthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY,this._pDepthRenderer._iRender(e,this._pDepthRender)},t.prototype.pUpdateBackBuffer=function(){this._pStage.context&&!this._shareContext&&this._width&&this._height&&(this._pStage.configureBackBuffer(this._width,this._height,this._antiAlias,!0),this._pBackBufferInvalid=!1)},t.prototype.iSetStage=function(t){e.prototype.iSetStage.call(this,t),this._pDistanceRenderer.iSetStage(t),this._pDepthRenderer.iSetStage(t)},t.prototype.initDepthTexture=function(){this._pDepthTextureInvalid=!1,this._pDepthRender&&this._pDepthRender.dispose(),this._pDepthRender=new s(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight)},t}(_);t.exports=f},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/textures/RenderTexture":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-renderergl/lib/managers/RTTBufferManager":void 0,"awayjs-renderergl/lib/passes/DepthMapPass":void 0,"awayjs-renderergl/lib/passes/DistanceMapPass":void 0,"awayjs-renderergl/lib/pool/SkyboxRenderable":void 0,"awayjs-renderergl/lib/render/DepthRenderer":void 0,"awayjs-renderergl/lib/render/Filter3DRenderer":void 0,"awayjs-renderergl/lib/render/RendererBase":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/managers/StageManager":void 0}],"awayjs-renderergl/lib/render/DepthRenderer":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),a=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),s=e("awayjs-renderergl/lib/render/RendererBase"),n=function(e){function t(t,i){void 0===i&&(i=!1),e.call(this),this._pass=t,this._renderBlended=i,this._iBackgroundR=1,this._iBackgroundG=1,this._iBackgroundB=1}return i(t,e),Object.defineProperty(t.prototype,"disableColor",{get:function(){return this._disableColor},set:function(e){this._disableColor=e},enumerable:!0,configurable:!0}),t.prototype._iRenderCascades=function(e,t,i,s,n){this.pCollectRenderables(e),this._pStage.setRenderTarget(t,!0,0),this._pContext.clear(1,1,1,1,1,0),this._pContext.setBlendFactors(r.ONE,r.ZERO),this._pContext.setDepthTest(!0,a.LESS);for(var o=this._pOpaqueRenderableHead,l=!0,h=i-1;h>=0;--h)this._pStage.scissorRect=s[h],this.drawCascadeRenderables(o,n[h],l?null:n[h].frustumPlanes),l=!1;this._pContext.setDepthTest(!1,a.LESS_EQUAL),this._pStage.scissorRect=null},t.prototype.drawCascadeRenderables=function(e,t,i){var r,a,s;for(this._pStage.context;e;){a=this.getMaterial(e.material,this._pStage.profile),s=e,r=a.getMaterialPass(this._pass,this._pStage.profile),""==r.key&&this.calcAnimationCode(e.material,r),e.material._iActivatePass(r,this,t);do!i||s.sourceEntity.worldBounds.isInFrustum(i,4)?s.material._iRenderPass(r,s,this._pStage,t,this._pRttViewProjectionMatrix):s.cascaded=!0,s=s.next;while(s&&s.material==e.material&&!s.cascaded);e.material._iDeactivatePass(r,this),e=s}},t.prototype.pDraw=function(e){this.pCollectRenderables(e),this._pContext.setBlendFactors(r.ONE,r.ZERO),this._pContext.setDepthTest(!0,a.LESS),this.drawRenderables(this._pOpaqueRenderableHead,e),this._disableColor&&this._pContext.setColorMask(!1,!1,!1,!1),this._renderBlended&&this.drawRenderables(this._pBlendedRenderableHead,e),this._disableColor&&this._pContext.setColorMask(!0,!0,!0,!0)},t.prototype.drawRenderables=function(e,t){for(var i,r,a,s=(this._pStage.context,t.camera);e;){if(r=this.getMaterial(e.material,this._pStage.profile),this._disableColor&&0!=e.material.alphaThreshold){a=e;do a=a.next;while(a&&a.material==e.material)}else{a=e,i=r.getMaterialPass(this._pass,this._pStage.profile),""==i.key&&this.calcAnimationCode(e.material,i),e.material._iActivatePass(i,this,s);do a.material._iRenderPass(i,a,this._pStage,s,this._pRttViewProjectionMatrix),a=a.next;while(a&&a.material==e.material);e.material._iDeactivatePass(i,this)}e=a}},t}(s);t.exports=n},{"awayjs-renderergl/lib/render/RendererBase":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/render/Filter3DRenderer":[function(e,t){var i=e("awayjs-core/lib/events/Event"),r=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/managers/RTTBufferManager"),n=function(){function e(e){var t=this;this._filterSizesInvalid=!0,this._onRTTResizeDelegate=function(e){return t.onRTTResize(e)},this._stage=e,this._rttManager=s.getInstance(e),this._rttManager.addEventListener(i.RESIZE,this._onRTTResizeDelegate)}return e.prototype.onRTTResize=function(){this._filterSizesInvalid=!0},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._filterTasksInvalid&&this.updateFilterTasks(e),this._mainInputTexture},Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(e){if(this._filters=e,this._filterTasksInvalid=!0,this._requireDepthRender=!1,this._filters){for(var t=0;t<this._filters.length;++t){var i=this._filters[t],r=null==i.requireDepthRender?!1:i.requireDepthRender;this._requireDepthRender=this._requireDepthRender||r}this._filterSizesInvalid=!0}},enumerable:!0,configurable:!0}),e.prototype.updateFilterTasks=function(e){var t;if(this._filterSizesInvalid&&this.updateFilterSizes(),!this._filters)return void(this._tasks=null);this._tasks=new Array,t=this._filters.length-1;for(var i,r=0;t>=r;++r)i=this._filters[r],i.setRenderTargets(r==t?null:this._filters[r+1].getMainInputTexture(e),e),this._tasks=this._tasks.concat(i.tasks);this._mainInputTexture=this._filters[0].getMainInputTexture(e)},e.prototype.render=function(e,t,i){var s,n,o,l=e.context,h=this._rttManager.indexBuffer,p=this._rttManager.renderToTextureVertexBuffer;if(this._filters){for(this._filterSizesInvalid&&this.updateFilterSizes(),this._filterTasksInvalid&&this.updateFilterTasks(e),s=this._filters.length,n=0;s>n;++n)this._filters[n].update(e,t);for(s=this._tasks.length,s>1&&(l.setVertexBufferAt(0,p,0,a.FLOAT_2),l.setVertexBufferAt(1,p,2,a.FLOAT_2)),n=0;s>n;++n)o=this._tasks[n],o.target||(e.scissorRect=null,p=this._rttManager.renderToScreenVertexBuffer,l.setVertexBufferAt(0,p,0,a.FLOAT_2),l.setVertexBufferAt(1,p,2,a.FLOAT_2)),l.setTextureAt(0,o.getMainInputTexture(e)),l.setProgram(o.getProgram(e)),l.clear(0,0,0,0),o.activate(e,t,i),l.setBlendFactors(r.ONE,r.ZERO),l.drawTriangles(h,0,2),o.deactivate(e);l.setTextureAt(0,null),l.setVertexBufferAt(0,null),l.setVertexBufferAt(1,null)}},e.prototype.updateFilterSizes=function(){for(var e=0;e<this._filters.length;++e)this._filters[e].textureWidth=this._rttManager.textureWidth,this._filters[e].textureHeight=this._rttManager.textureHeight;this._filterSizesInvalid=!0},e.prototype.dispose=function(){this._rttManager.removeEventListener(i.RESIZE,this._onRTTResizeDelegate),this._rttManager=null,this._stage=null},e}();t.exports=n},{"awayjs-core/lib/events/Event":void 0,"awayjs-renderergl/lib/managers/RTTBufferManager":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/render/RendererBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Point"),s=e("awayjs-core/lib/geom/Rectangle"),n=e("awayjs-core/lib/errors/AbstractMethodError"),o=e("awayjs-core/lib/events/EventDispatcher"),l=e("awayjs-display/lib/pool/RenderablePool"),h=e("awayjs-display/lib/sort/RenderableMergeSort"),p=e("awayjs-display/lib/events/RendererEvent"),d=e("awayjs-display/lib/events/StageEvent"),c=e("awayjs-display/lib/traverse/EntityCollector"),u=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),_=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),g=e("awayjs-renderergl/lib/pool/BillboardRenderable"),m=e("awayjs-renderergl/lib/pool/LineSubMeshRenderable"),y=e("awayjs-renderergl/lib/pool/MaterialDataPool"),f=e("awayjs-renderergl/lib/pool/TriangleSubMeshRenderable"),b=e("awayjs-renderergl/lib/managers/DefaultMaterialManager"),x=function(e){function t(){var t=this;e.call(this),this._numUsedStreams=0,this._numUsedTextures=0,this._viewPort=new s,this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this._depthPrepass=!1,this._backgroundR=0,this._backgroundG=0,this._backgroundB=0,this._backgroundAlpha=1,this._shareContext=!1,this.textureRatioX=1,this.textureRatioY=1,this._pRttViewProjectionMatrix=new r,this._localPos=new a,this._globalPos=new a,this._pScissorRect=new s,this._pNumTriangles=0,this._onViewportUpdatedDelegate=function(e){return t.onViewportUpdated(e)},this._materialDataPool=new y,this._billboardRenderablePool=l.getPool(g),this._triangleSubMeshRenderablePool=l.getPool(f),this._lineSubMeshRenderablePool=l.getPool(m),this._onContextUpdateDelegate=function(e){return t.onContextUpdate(e)},this.renderableSorter=new h}return i(t,e),Object.defineProperty(t.prototype,"numTriangles",{get:function(){return this._pNumTriangles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scissorRect",{get:function(){return this._pScissorRect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._localPos.x},set:function(e){this.x!=e&&(this._globalPos.x=this._localPos.x=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._localPos.y},set:function(e){this.y!=e&&(this._globalPos.y=this._localPos.y=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width!=e&&(this._width=e,this._pScissorRect.width=e,this._pRttBufferManager&&(this._pRttBufferManager.viewWidth=e),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height!=e&&(this._height=e,this._pScissorRect.height=e,this._pRttBufferManager&&(this._pRttBufferManager.viewHeight=e),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),t.prototype.getProgram=function(e){if(e.key.length)return e.programData;e.key=e.animationVertexCode+e.vertexCode+"---"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode;var t=this._pStage.getProgramData(e.key);return e.programData!=t&&(e.programData&&e.programData.dispose(),e.programData=t,t.usages++),t},t.prototype.getMaterial=function(e,t){var i=this._materialDataPool.getItem(e);if(i.invalidAnimation){i.invalidAnimation=!1;for(var r,a=i.getMaterialPasses(t),s=this.getEnabledGPUAnimation(e,a),n=0,o=1,l=a.length,h=0;l>h;h++)r=a[h],r.usesAnimation!=s&&(r.usesAnimation=s,""==r.key),""==r.key&&this.calcAnimationCode(e,r),n+=this.getProgram(r).id*o,o*=1e3;i.renderOrderId=n}return i},t.prototype.activateMaterialPass=function(e,t){for(var i=e.shaderObject,r=i.numUsedStreams;r<this._numUsedStreams;r++)this._pContext.setVertexBufferAt(r,null);for(var r=i.numUsedTextures;r<this._numUsedTextures;r++)this._pContext.setTextureAt(r,null);e.usesAnimation&&e.material.animationSet.activate(i,this._pStage),i.iActivate(this._pStage,t);var a=this.getProgram(e);if(!a.program){a.program=this._pContext.createProgram();var s=(new u).assemble("part vertex 1\n"+e.animationVertexCode+e.vertexCode+"endpart").vertex.data,n=(new u).assemble("part fragment 1\n"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode+"endpart").fragment.data;a.program.upload(s,n)}this._pContext.setProgram(a.program)},t.prototype.deactivateMaterialPass=function(e){var t=e.shaderObject;e.usesAnimation&&e.material.animationSet.deactivate(t,this._pStage),e.shaderObject.iDeactivate(this._pStage),this._numUsedStreams=t.numUsedStreams,this._numUsedTextures=t.numUsedTextures},t.prototype._iCreateEntityCollector=function(){return new c},Object.defineProperty(t.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(e){this._backgroundR!=e&&(this._backgroundR=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(e){this._backgroundG!=e&&(this._backgroundG=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(e){this._backgroundB!=e&&(this._backgroundB=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._pContext},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stage",{get:function(){return this._pStage},set:function(e){e!=this._pStage&&this.iSetStage(e)},enumerable:!0,configurable:!0}),t.prototype.iSetStage=function(e){this._pStage&&(this._pStage.removeEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate)),e?(this._pStage=e,this._pStage.addEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage.context&&(this._pContext=this._pStage.context)):(this._pStage=null,this._pContext=null),this._pBackBufferInvalid=!0,this.updateGlobalPos()},Object.defineProperty(t.prototype,"shareContext",{get:function(){return this._shareContext},set:function(e){this._shareContext!=e&&(this._shareContext=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._pRttBufferManager&&this._pRttBufferManager.dispose(),this._pRttBufferManager=null,this._pStage.removeEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage=null},t.prototype.render=function(){this._viewportDirty=!1,this._scissorDirty=!1},t.prototype._iRender=function(e,t,i,r){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0),this._pStage&&this._pContext){this._pRttViewProjectionMatrix.copyFrom(e.camera.viewProjection),this._pRttViewProjectionMatrix.appendScale(this.textureRatioX,this.textureRatioY,1),this.pExecuteRender(e,t,i,r);for(var a=0;8>a;++a)this._pContext.setVertexBufferAt(a,null),this._pContext.setTextureAt(a,null)}},t.prototype._iRenderCascades=function(){},t.prototype.pCollectRenderables=function(e){this._pBlendedRenderableHead=null,this._pOpaqueRenderableHead=null,this._pNumTriangles=0;var t=e.entityHead;for(this._pCamera=e.camera,this._iEntryPoint=this._pCamera.scenePosition,this._pCameraForward=this._pCamera.transform.forwardVector;t;)t.entity._iCollectRenderables(this),t=t.next;this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead),this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)},t.prototype.pExecuteRender=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0),this._pStage.setRenderTarget(t,!0,r),!t&&this._shareContext||this._depthPrepass||this._pContext.clear(this._backgroundR,this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0),this._pContext.setDepthTest(!1,_.ALWAYS),this._pStage.scissorRect=i,this.pDraw(e,t),this._shareContext||this._snapshotRequired&&this._snapshotBitmapData&&(this._pContext.drawToBitmapData(this._snapshotBitmapData),this._snapshotRequired=!1),this._pStage.scissorRect=null},t.prototype.queueSnapshot=function(e){this._snapshotRequired=!0,this._snapshotBitmapData=e},t.prototype.pDraw=function(){throw new n},t.prototype.onContextUpdate=function(){this._pContext=this._pStage.context},Object.defineProperty(t.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(e){this._backgroundAlpha!=e&&(this._backgroundAlpha=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),t.prototype.notifyScissorUpdate=function(){this._scissorDirty||(this._scissorDirty=!0,this._scissorUpdated||(this._scissorUpdated=new p(p.SCISSOR_UPDATED)),this.dispatchEvent(this._scissorUpdated))},t.prototype.notifyViewportUpdate=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewPortUpdated||(this._viewPortUpdated=new p(p.VIEWPORT_UPDATED)),this.dispatchEvent(this._viewPortUpdated))},t.prototype.onViewportUpdated=function(){this._viewPort=this._pStage.viewPort,this._shareContext&&(this._pScissorRect.x=this._globalPos.x-this._pStage.x,this._pScissorRect.y=this._globalPos.y-this._pStage.y,this.notifyScissorUpdate()),this.notifyViewportUpdate()},t.prototype.updateGlobalPos=function(){this._shareContext?(this._pScissorRect.x=this._globalPos.x-this._viewPort.x,this._pScissorRect.y=this._globalPos.y-this._viewPort.y):(this._pScissorRect.x=0,this._pScissorRect.y=0,this._viewPort.x=this._globalPos.x,this._viewPort.y=this._globalPos.y),this.notifyScissorUpdate()},t.prototype.applyBillboard=function(e){this._applyRenderable(this._billboardRenderablePool.getItem(e))},t.prototype.applyTriangleSubMesh=function(e){this._applyRenderable(this._triangleSubMeshRenderablePool.getItem(e))},t.prototype.applyLineSubMesh=function(e){this._applyRenderable(this._lineSubMeshRenderablePool.getItem(e))},t.prototype._applyRenderable=function(e){var t=e.materialOwner.material,i=e.sourceEntity,r=i.scenePosition;t||(t=b.getDefaultMaterial(e.materialOwner)),t._iUpdateMaterial(),e.material=t,e.materialId=t._iMaterialId,e.renderOrderId=this.getMaterial(t,this._pStage.profile).renderOrderId,e.cascaded=!1,r=this._iEntryPoint.subtract(r),e.zIndex=i.zOffset+r.dotProduct(this._pCameraForward),e.renderSceneTransform=e.sourceEntity.getRenderSceneTransform(this._pCamera),t.requiresBlending?(e.next=this._pBlendedRenderableHead,this._pBlendedRenderableHead=e):(e.next=this._pOpaqueRenderableHead,this._pOpaqueRenderableHead=e),this._pNumTriangles+=e.numTriangles,e.overflow&&this._applyRenderable(e.overflow)},t.prototype.getEnabledGPUAnimation=function(e,t){if(e.animationSet){e.animationSet.resetGPUCompatibility();for(var i=e.iOwners,r=i.length,a=t.length,s=0;a>s;s++)for(var n=0;r>n;n++)i[n].animator&&i[n].animator.testGPUCompatibility(t[s].shaderObject);return!e.animationSet.usesCPU}return!1},t.prototype.calcAnimationCode=function(e,t){t.key="",t.animationVertexCode="",t.animationFragmentCode="";var i=t.shaderObject;if(t.usesAnimation){var r=e.animationSet;t.animationVertexCode+=r.getAGALVertexCode(i),i.uvDependencies>0&&!i.usesUVTransform&&(t.animationVertexCode+=r.getAGALUVCode(i)),i.usesFragmentAnimation&&(t.animationFragmentCode+=r.getAGALFragmentCode(i,t.shadedTarget)),r.doneAGALCode(i)}else{for(var a=i.animatableAttributes.length,s=0;a>s;++s)t.animationVertexCode+="mov "+i.animationTargetRegisters[s]+", "+i.animatableAttributes[s]+"\n";i.uvDependencies>0&&!i.usesUVTransform&&(t.animationVertexCode+="mov "+i.uvTarget+","+i.uvSource+"\n")}},t}(o);t.exports=x},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-display/lib/events/RendererEvent":void 0,"awayjs-display/lib/events/StageEvent":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-display/lib/sort/RenderableMergeSort":void 0,"awayjs-display/lib/traverse/EntityCollector":void 0,"awayjs-renderergl/lib/managers/DefaultMaterialManager":void 0,"awayjs-renderergl/lib/pool/BillboardRenderable":void 0,"awayjs-renderergl/lib/pool/LineSubMeshRenderable":void 0,"awayjs-renderergl/lib/pool/MaterialDataPool":void 0,"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/tools/commands/Merge":[function(e,t){var i=e("awayjs-core/lib/geom/Matrix3DUtils"),r=e("awayjs-display/lib/base/Geometry"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-display/lib/entities/Mesh"),n=function(){function e(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),this._keepMaterial=e,this._disposeSources=t,this._objectSpace=i}return Object.defineProperty(e.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(e){this._disposeSources=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(e){this._keepMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(e){this._objectSpace=e},enumerable:!0,configurable:!0}),e.prototype.applyToContainer=function(e,t){this.reset(),this.parseContainer(e,t),this.collect(e,!1),this.merge(e,this._disposeSources)},e.prototype.applyToMeshes=function(e,t){if(this.reset(),t.length){for(var i=0;i<t.length;i++)t[i]!=e&&this.collect(t[i],this._disposeSources);this.collect(e,!1),this.merge(e,this._disposeSources)}},e.prototype.apply=function(e,t){this.reset(),this.collect(t,this._disposeSources),this.collect(e,!1),this.merge(e,this._disposeSources)},e.prototype.reset=function(){this._toDispose=new Array,this._geomVOs=new Array},e.prototype.merge=function(e,t){var i,s,n,o,l;for(n=e.geometry,o=e.geometry=new r,s=e.subMeshes.length,l=this._geomVOs.length>1,i=0;i<this._geomVOs.length;i++){var h,p=new a(!0);p.autoDeriveNormals=!1,p.autoDeriveTangents=!1,h=this._geomVOs[i],p.updateIndices(h.indices),p.updatePositions(h.vertices),p.updateVertexNormals(h.normals),p.updateVertexTangents(h.tangents),p.updateUVs(h.uvs),o.addSubGeometry(p),this._keepMaterial&&l&&(e.subMeshes[s].material=h.material)}if(this._keepMaterial&&!l&&this._geomVOs.length&&(e.material=this._geomVOs[0].material),t){for(var d,i,c=this._toDispose.length;c>i;i++)d=this._toDispose[i],d.geometry.dispose(),d.dispose();n.dispose()}this._toDispose=null},e.prototype.collect=function(e,t){if(e.geometry){var r,a,s=e.geometry.subGeometries;for(r=0;r<s.length;r++){var n,o,l,h,p,d,c,u,_,g,m,y,f,b,x,v,w;for(_=s[r],b=_.positions,x=_.vertexNormals,v=_.vertexTangents,w=_.uvs,g=this.getSubGeomData(e.subMeshes[r].material||e.material),m=this._objectSpace?g.vertices:new Array,y=this._objectSpace?g.normals:new Array,f=this._objectSpace?g.tangents:new Array,h=m.length,p=y.length,d=f.length,c=g.uvs.length,o=_.numVertices,n=0;o>n;n++)a=3*n,m[h++]=b[a],m[h++]=b[a+1],m[h++]=b[a+2],y[p++]=x[a],y[p++]=x[a+1],y[p++]=x[a+2],f[d++]=v[a],f[d++]=v[a+1],f[d++]=v[a+2],g.uvs[c++]=w[2*n],g.uvs[c++]=w[2*n+1];for(u=this._objectSpace?0:g.vertices.length/3,l=g.indices.length,o=_.numTriangles,n=0;o>n;n++)a=3*n,g.indices[l++]=_.indices[a]+u,g.indices[l++]=_.indices[a+1]+u,g.indices[l++]=_.indices[a+2]+u;if(!this._objectSpace)for(e.sceneTransform.transformVectors(m,m),i.deltaTransformVectors(e.sceneTransform,y,y),i.deltaTransformVectors(e.sceneTransform,f,f),h=g.vertices.length,p=g.normals.length,d=g.tangents.length,o=m.length,n=0;o>n;n++)g.vertices[h++]=m[n],g.normals[p++]=y[n],g.tangents[d++]=f[n]}t&&this._toDispose.push(e)}},e.prototype.getSubGeomData=function(e){var t;if(this._keepMaterial){var i,r;for(r=this._geomVOs.length,i=0;r>i;i++)if(this._geomVOs[i].material==e){t=this._geomVOs[i];break}}else this._geomVOs.length&&(t=this._geomVOs[0]);return t||(t=new o,t.vertices=new Array,t.normals=new Array,t.tangents=new Array,t.uvs=new Array,t.indices=new Array,t.material=e,this._geomVOs.push(t)),t},e.prototype.parseContainer=function(e,t){var i,r;for(t instanceof s&&t!=e&&this.collect(t,this._disposeSources),r=0;r<t.numChildren;++r)i=t.getChildAt(r),this.parseContainer(e,i)},e}(),o=function(){function e(){}return e}();t.exports=n},{"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/entities/Mesh":void 0}],"awayjs-renderergl/lib/tools/data/ParticleGeometryTransform":[function(e,t){var i=function(){function e(){}return Object.defineProperty(e.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(e){this._defaultVertexTransform=e,this._defaultInvVertexTransform=e.clone(),this._defaultInvVertexTransform.invert(),this._defaultInvVertexTransform.transpose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(e){this._defaultUVTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:!0,configurable:!0}),e}();t.exports=i},{}],"awayjs-renderergl/lib/utils/ParticleGeometryHelper":[function(e,t){var i=e("awayjs-core/lib/geom/Point"),r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-renderergl/lib/animators/data/ParticleData"),n=e("awayjs-renderergl/lib/base/ParticleGeometry"),o=function(){function e(){}return e.generateGeometry=function(t,o){void 0===o&&(o=null);var l,h,p,d,c,u,_,g,m,y,f,b,x=new Array,v=new Array,w=new Array,P=new Array,C=new Array,T=new Array,D=new Array,S=new Array,O=t.length,A=new Array,R=new r,j=new r,V=new r,I=new i;for(f=0;O>f;f++){l=t[f].subGeometries,p=l.length;for(var N=0;p>N;N++){A.length<=N&&(A.push(S.length),x.push(new Array),v.push(new Array),w.push(new Array),P.push(new Array),C.push(new Array),S.push(new a(!0)),T.push(0)),h=l[N],h.numVertices+T[A[N]]>e.MAX_VERTEX&&(A[N]=S.length,x.push(new Array),v.push(new Array),w.push(new Array),P.push(new Array),C.push(new Array),S.push(new a(!0)),T.push(0)),b=A[N],d=x[b],c=v[b],u=w[b],_=P[b],g=C[b],m=T[b],y=S[b];var L=new s;L.numVertices=h.numVertices,L.startVertexIndex=m,L.particleIndex=f,L.subGeometry=y,D.push(L),T[b]+=h.numVertices;var M,F,E,B,z,U,G,k=h;if(k)if(F=k.numVertices,k.numTriangles,B=k.positions,z=k.vertexNormals,U=k.vertexTangents,G=k.uvs,o){var X=o[f],W=X.vertexTransform,H=X.invVertexTransform,Z=X.UVTransform;for(M=0;F>M;M++)E=3*M,R.x=B[E],R.y=B[E+1],R.z=B[E+2],j.x=z[E],j.y=z[E+1],j.z=z[E+2],V.x=U[E],V.y=U[E+1],V.z=U[E+2],I.x=G[2*M],I.y=G[2*M+1],W&&(R=W.transformVector(R),j=H.deltaTransformVector(j),V=H.deltaTransformVector(j)),Z&&(I=Z.transformPoint(I)),B.push(R.x,R.y,R.z),z.push(j.x,j.y,j.z),U.push(V.x,V.y,V.z),G.push(I.x,I.y)
}else for(M=0;F>M;M++)E=3*M,c.push(B[E],B[E+1],B[E+2]),u.push(z[E],z[E+1],z[E+2]),_.push(U[E],U[E+1],U[E+2]),g.push(G[2*M],G[2*M+1]);var q=h.indices;for(F=h.numTriangles,M=0;F>M;M++)E=3*M,d.push(q[E]+m,q[E+1]+m,q[E+2]+m)}}var Y=new n;for(Y.particles=D,Y.numParticles=O,O=S.length,f=0;O>f;f++)y=S[f],y.autoDeriveNormals=!1,y.autoDeriveTangents=!1,y.updateIndices(x[f]),y.updatePositions(v[f]),y.updateVertexNormals(w[f]),y.updateVertexTangents(P[f]),y.updateUVs(C[f]),Y.addSubGeometry(y);return Y},e.MAX_VERTEX=65535,e}();t.exports=o},{"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticleData":void 0,"awayjs-renderergl/lib/base/ParticleGeometry":void 0}],"awayjs-renderergl/lib/utils/PerspectiveMatrix3D":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=function(e){function t(t){void 0===t&&(t=null),e.call(this,t)}return i(t,e),t.prototype.perspectiveFieldOfViewLH=function(e,t,i,r){var a=1/Math.tan(e/2),s=a/t;this.copyRawDataFrom([s,0,0,0,0,a,0,0,0,0,r/(r-i),1,0,0,i*r/(i-r),0])},t}(r);t.exports=a},{"awayjs-core/lib/geom/Matrix3D":void 0}],"awayjs-renderergl/lib/utils/ShaderCompilerHelper":[function(e,t){var i=e("awayjs-stagegl/lib/base/ContextGLTextureFormat"),r=function(){function e(){}return e.getTex2DSampleCode=function(t,i,r,a,s,n,o,l,h){void 0===l&&(l=null),void 0===h&&(h=null);var p=h||(n?"wrap":"clamp"),d=e.getFormatStringForTexture(a),c=o&&a.hasMipmaps,u=s?c?"linear,miplinear":"linear":c?"nearest,mipnearest":"nearest";return null==l&&(l=i.uvVarying),"tex "+t+", "+l+", "+r+" <2d,"+u+","+d+p+">\n"},e.getTexCubeSampleCode=function(t,i,r,a,s,n){var o,l=e.getFormatStringForTexture(r),h=s&&r.hasMipmaps,o=a?h?"linear,miplinear":"linear":h?"nearest,mipnearest":"nearest";return"tex "+t+", "+n+", "+i+" <cube,"+l+o+">\n"},e.getFormatStringForTexture=function(e){switch(e.format){case i.COMPRESSED:return"dxt1,";case i.COMPRESSED_ALPHA:return"dxt5,";default:return""}},e}();t.exports=r},{"awayjs-stagegl/lib/base/ContextGLTextureFormat":void 0}]},{},[]);
//# sourceMappingURL=awayjs-renderergl.min.js.map