require=function e(t,i,r){function a(n,o){if(!i[n]){if(!t[n]){var h="function"==typeof require&&require;if(!o&&h)return h(n,!0);if(s)return s(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var p=i[n]={exports:{}};t[n][0].call(p.exports,function(e){var i=t[n][1][e];return a(i?i:e)},p,p.exports,e,t,i,r)}return i[n].exports}for(var s="function"==typeof require&&require,n=0;n<r.length;n++)a(r[n]);return a}({"awayjs-renderergl/lib/animators/AnimationSetBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=e("awayjs-core/lib/errors/AbstractMethodError"),n=e("awayjs-renderergl/lib/errors/AnimationSetError"),o=function(e){function t(){e.call(this),this._animations=new Array,this._animationNames=new Array,this._animationDictionary=new Object}return i(t,e),t.prototype._pFindTempReg=function(e,t){void 0===t&&(t=null);for(var i,r=0;;){if(i="vt"+r,-1==e.indexOf(i)&&t!=i)return i;++r}return null},Object.defineProperty(t.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:!0,configurable:!0}),t.prototype.resetGPUCompatibility=function(){this._usesCPU=!1},t.prototype.cancelGPUCompatibility=function(){this._usesCPU=!0},t.prototype.getAGALVertexCode=function(){throw new s},t.prototype.activate=function(){throw new s},t.prototype.deactivate=function(){throw new s},t.prototype.getAGALFragmentCode=function(){throw new s},t.prototype.getAGALUVCode=function(){throw new s},t.prototype.doneAGALCode=function(){throw new s},Object.defineProperty(t.prototype,"assetType",{get:function(){return r.ANIMATION_SET},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),t.prototype.hasAnimation=function(e){return null!=this._animationDictionary[e]},t.prototype.getAnimation=function(e){return this._animationDictionary[e]},t.prototype.addAnimation=function(e){if(this._animationDictionary[e.name])throw new n("root node name '"+e.name+"' already exists in the set");this._animationDictionary[e.name]=e,this._animations.push(e),this._animationNames.push(e.name)},t.prototype.dispose=function(){},t}(a);t.exports=o},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-renderergl/lib/errors/AnimationSetError":void 0}],"awayjs-renderergl/lib/animators/AnimatorBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=e("awayjs-core/lib/errors/AbstractMethodError"),n=e("awayjs-core/lib/utils/RequestAnimationFrame"),o=e("awayjs-core/lib/utils/getTimer"),h=e("awayjs-renderergl/lib/events/AnimatorEvent"),l=function(e){function t(t){e.call(this),this._autoUpdate=!0,this._time=0,this._playbackSpeed=1,this._pOwners=new Array,this._pAbsoluteTime=0,this._animationStates=new Object,this.updatePosition=!0,this._pAnimationSet=t,this._broadcaster=new n(this.onEnterFrame,this)}return i(t,e),t.prototype.getAnimationState=function(e){var t=e.stateClass,i=e.id;return null==this._animationStates[i]&&(this._animationStates[i]=new t(this,e)),this._animationStates[i]},t.prototype.getAnimationStateByName=function(e){return this.getAnimationState(this._pAnimationSet.getAnimation(e))},Object.defineProperty(t.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){this._autoUpdate!=e&&(this._autoUpdate=e,this._autoUpdate?this.start():this.stop())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},set:function(e){this._time!=e&&this.update(e)},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._pActiveState.phase(e)},Object.defineProperty(t.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(e){this._playbackSpeed=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(){throw new s},t.prototype.start=function(){!this._isPlaying&&this._autoUpdate&&(this._time=this._pAbsoluteTime=o(),this._isPlaying=!0,this._broadcaster.start(),this.hasEventListener(h.START)&&(null==this._startEvent&&(this._startEvent=new h(h.START,this)),this.dispatchEvent(this._startEvent)))},t.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._broadcaster.stop(),this.hasEventListener(h.STOP)&&(null==this._stopEvent&&(this._stopEvent=new h(h.STOP,this)),this.dispatchEvent(this._stopEvent)))},t.prototype.update=function(e){var t=(e-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(t),this._time=e},t.prototype.reset=function(e,t){void 0===t&&(t=0),this.getAnimationState(this._pAnimationSet.getAnimation(e)).offset(t+this._pAbsoluteTime)},t.prototype.addOwner=function(e){this._pOwners.push(e)},t.prototype.removeOwner=function(e){this._pOwners.splice(this._pOwners.indexOf(e),1)},t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e,this._pActiveState.update(this._pAbsoluteTime),this.updatePosition&&this.applyPositionDelta()},t.prototype.onEnterFrame=function(e){void 0===e&&(e=null),this.update(o())},t.prototype.applyPositionDelta=function(){var e,t=this._pActiveState.positionDelta,i=t.length;if(i>0){e=this._pOwners.length;for(var r=0;e>r;++r)this._pOwners[r].translateLocal(t,i)}},t.prototype.dispatchCycleEvent=function(){this.hasEventListener(h.CYCLE_COMPLETE)&&(null==this._cycleEvent&&(this._cycleEvent=new h(h.CYCLE_COMPLETE,this)),this.dispatchEvent(this._cycleEvent))},t.prototype.clone=function(){throw new s},t.prototype.dispose=function(){},t.prototype.testGPUCompatibility=function(){throw new s},Object.defineProperty(t.prototype,"assetType",{get:function(){return r.ANIMATOR},enumerable:!0,configurable:!0}),t.prototype.getRenderableSubGeometry=function(e,t){return t},t}(a);t.exports=l},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-core/lib/utils/RequestAnimationFrame":void 0,"awayjs-core/lib/utils/getTimer":void 0,"awayjs-renderergl/lib/events/AnimatorEvent":void 0}],"awayjs-renderergl/lib/animators/ParticleAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/AnimationSetBase"),a=e("awayjs-renderergl/lib/animators/data/AnimationRegisterCache"),s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry"),n=e("awayjs-renderergl/lib/animators/data/ParticleAnimationData"),o=e("awayjs-renderergl/lib/animators/data/ParticleProperties"),h=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),l=e("awayjs-renderergl/lib/animators/nodes/ParticleTimeNode"),p=function(e){function t(t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),e.call(this),this._animationSubGeometries=new Object,this._particleNodes=new Array,this._localDynamicNodes=new Array,this._localStaticNodes=new Array,this._totalLenOfOneVertex=0,this.addAnimation(this._timeNode=new l(t,i,r))}return i(t,e),Object.defineProperty(t.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:!0,configurable:!0}),t.prototype.addAnimation=function(t){var i,r=t;for(r._iProcessAnimationSetting(this),r.mode==h.LOCAL_STATIC?(r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength,this._localStaticNodes.push(r)):r.mode==h.LOCAL_DYNAMIC&&this._localDynamicNodes.push(r),i=this._particleNodes.length-1;i>=0&&!(this._particleNodes[i].priority<=r.priority);i--);this._particleNodes.splice(i+1,0,r),e.prototype.addAnimation.call(this,t)},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALVertexCode=function(e){this._iAnimationRegisterCache=e.animationRegisterCache,null==this._iAnimationRegisterCache&&(this._iAnimationRegisterCache=e.animationRegisterCache=new a(e.profile)),this._iAnimationRegisterCache.vertexConstantOffset=e.numUsedVertexConstants,this._iAnimationRegisterCache.vertexAttributesOffset=e.numUsedStreams,this._iAnimationRegisterCache.varyingsOffset=e.numUsedVaryings,this._iAnimationRegisterCache.fragmentConstantOffset=e.numUsedFragmentConstants,this._iAnimationRegisterCache.hasUVNode=this.hasUVNode,this._iAnimationRegisterCache.needVelocity=this.needVelocity,this._iAnimationRegisterCache.hasBillboard=this.hasBillboard,this._iAnimationRegisterCache.sourceRegisters=e.animatableAttributes,this._iAnimationRegisterCache.targetRegisters=e.animationTargetRegisters,this._iAnimationRegisterCache.needFragmentAnimation=e.usesFragmentAnimation,this._iAnimationRegisterCache.needUVAnimation=!e.usesUVTransform,this._iAnimationRegisterCache.hasColorAddNode=this.hasColorAddNode,this._iAnimationRegisterCache.hasColorMulNode=this.hasColorMulNode,this._iAnimationRegisterCache.reset();var i="";i+=this._iAnimationRegisterCache.getInitCode();var r,s;for(s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority<t.POST_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));for(i+=this._iAnimationRegisterCache.getCombinationCode(),s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority>=t.POST_PRIORITY&&r.priority<t.COLOR_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));for(i+=this._iAnimationRegisterCache.initColorRegisters(),s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority>=t.COLOR_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));return i+=this._iAnimationRegisterCache.getColorPassCode()},t.prototype.getAGALUVCode=function(e){var t="";if(this.hasUVNode){this._iAnimationRegisterCache.setUVSourceAndTarget(e.uvSource,e.uvTarget),t+="mov "+this._iAnimationRegisterCache.uvTarget+".xy,"+this._iAnimationRegisterCache.uvAttribute.toString()+"\n";for(var i,r=0;r<this._particleNodes.length;r++)i=this._particleNodes[r];t+=i.getAGALUVCode(e,this._iAnimationRegisterCache),t+="mov "+this._iAnimationRegisterCache.uvVar.toString()+","+this._iAnimationRegisterCache.uvTarget+".xy\n"}else t+="mov "+e.uvTarget+","+e.uvSource+"\n";return t},t.prototype.getAGALFragmentCode=function(e,t){return this._iAnimationRegisterCache.getColorCombinationCode(t)},t.prototype.doneAGALCode=function(){this._iAnimationRegisterCache.setDataLength(),this._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index,0,1,2,0)},Object.defineProperty(t.prototype,"usesCPU",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.cancelGPUCompatibility=function(){},t.prototype.dispose=function(){for(var t in this._animationSubGeometries)this._animationSubGeometries[t].dispose();e.prototype.dispose.call(this)},t.prototype.getAnimationSubGeometry=function(e){var t=e.parentMesh,i=t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id];return i?i:(this._iGenerateAnimationSubGeometries(t),t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id])},t.prototype._iGenerateAnimationSubGeometries=function(e){if(null==this.initParticleFunc)throw new Error("no initParticleFunc set");var t=e.geometry;if(!t)throw new Error("Particle animation can only be performed on a ParticleGeometry object");var i,r,a,h,l,p,d,c=!1;for(i=0;i<e.subMeshes.length;i++)p=e.subMeshes[i],l=p.subGeometry,e.shareAnimationGeometry&&(h=this._animationSubGeometries[l.id])||(h=new s,e.shareAnimationGeometry?this._animationSubGeometries[l.id]=h:this._animationSubGeometries[p.id]=h,c=!0,h.createVertexData(l.numVertices,this._totalLenOfOneVertex));if(c){var u,g,_,m,y,f,b,x,v,w,C,T=t.particles,P=T.length,D=t.numParticles,S=new o;for(S.total=D,S.startTime=0,S.duration=1e3,S.delay=.1,i=0,r=0;D>i;){for(S.index=i,this.initParticleFunc.call(this.initParticleScope,S),a=0;a<this._localStaticNodes.length;a++)this._localStaticNodes[a]._iGeneratePropertyOfOneParticle(S);for(;P>r&&(u=T[r]).particleIndex==i;){for(a=0;a<e.subMeshes.length;a++)if(p=e.subMeshes[a],p.subGeometry==u.subGeometry){h=e.shareAnimationGeometry?this._animationSubGeometries[p.subGeometry.id]:this._animationSubGeometries[p.id];break}for(b=u.numVertices,x=h.vertexData,v=b*this._totalLenOfOneVertex,w=h.numProcessedVertices*this._totalLenOfOneVertex,a=0;a<this._localStaticNodes.length;a++)for(d=this._localStaticNodes[a],f=d.oneData,g=d.dataLength,_=w+d._iDataOffset,m=0;v>m;m+=this._totalLenOfOneVertex)for(C=_+m,y=0;g>y;y++)x[C+y]=f[y];this._localDynamicNodes.length&&h.animationParticles.push(new n(i,S.startTime,S.duration,S.delay,u)),h.numProcessedVertices+=b,r++}i++}}},t.POST_PRIORITY=9,t.COLOR_PRIORITY=18,t}(r);t.exports=p},{"awayjs-renderergl/lib/animators/AnimationSetBase":void 0,"awayjs-renderergl/lib/animators/data/AnimationRegisterCache":void 0,"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticleAnimationData":void 0,"awayjs-renderergl/lib/animators/data/ParticleProperties":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":void 0}],"awayjs-renderergl/lib/animators/ParticleAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLProgramType"),a=e("awayjs-renderergl/lib/animators/AnimatorBase"),s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry"),n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=function(e){function t(t){e.call(this,t),this._animationParticleStates=new Array,this._animatorParticleStates=new Array,this._timeParticleStates=new Array,this._totalLenOfOneVertex=0,this._animatorSubGeometries=new Object,this._particleAnimationSet=t;for(var i,r,a=0;a<this._particleAnimationSet.particleNodes.length;a++)r=this._particleAnimationSet.particleNodes[a],i=this.getAnimationState(r),r.mode==n.LOCAL_DYNAMIC?(this._animatorParticleStates.push(i),r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength):this._animationParticleStates.push(i),i.needUpdateTime&&this._timeParticleStates.push(i)}return i(t,e),t.prototype.clone=function(){return new t(this._particleAnimationSet)},t.prototype.setRenderState=function(e,t,i,a){var s,n=this._particleAnimationSet._iAnimationRegisterCache,o=t.subMesh;if(!o)throw new Error("Must be subMesh");var h=this._particleAnimationSet.getAnimationSubGeometry(o);for(s=0;s<this._animationParticleStates.length;s++)this._animationParticleStates[s].setRenderState(i,t,h,n,a);var l=this.getAnimatorSubGeometry(o);for(s=0;s<this._animatorParticleStates.length;s++)this._animatorParticleStates[s].setRenderState(i,t,l,n,a);i.context.setProgramConstantsFromArray(r.VERTEX,n.vertexConstantOffset,n.vertexConstantData,n.numVertexConstant),n.numFragmentConstant>0&&i.context.setProgramConstantsFromArray(r.FRAGMENT,n.fragmentConstantOffset,n.fragmentConstantData,n.numFragmentConstant)},t.prototype.testGPUCompatibility=function(){},t.prototype.start=function(){e.prototype.start.call(this);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime)},t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e;for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].update(this._pAbsoluteTime)},t.prototype.resetTime=function(e){void 0===e&&(e=0);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime+e);this.update(this.time)},t.prototype.dispose=function(){for(var e in this._animatorSubGeometries)this._animatorSubGeometries[e].dispose()},t.prototype.getAnimatorSubGeometry=function(e){if(this._animatorParticleStates.length){var t=e.subGeometry,i=this._animatorSubGeometries[t.id]=new s;i.createVertexData(t.numVertices,this._totalLenOfOneVertex),i.animationParticles=this._particleAnimationSet.getAnimationSubGeometry(e).animationParticles}},t}(a);t.exports=o},{"awayjs-renderergl/lib/animators/AnimatorBase":void 0,"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/animators/SkeletonAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/AnimationSetBase"),a=function(e){function t(t){void 0===t&&(t=4),e.call(this),this._jointsPerVertex=t}return i(t,e),Object.defineProperty(t.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(e){for(var t=e.animatableAttributes.length,i=e.numUsedVertexConstants,r=i+1,a=i+2,s="va"+e.numUsedStreams,n="va"+(e.numUsedStreams+1),o=[s+".x",s+".y",s+".z",s+".w"],h=[n+".x",n+".y",n+".z",n+".w"],l=this._pFindTempReg(e.animationTargetRegisters),p=this._pFindTempReg(e.animationTargetRegisters,l),d="dp4",c="",u=0;t>u;++u){for(var g=e.animatableAttributes[u],_=0;_<this._jointsPerVertex;++_)c+=d+" "+l+".x, "+g+", vc["+o[_]+"+"+i+"]\n"+d+" "+l+".y, "+g+", vc["+o[_]+"+"+r+"]\n"+d+" "+l+".z, "+g+", vc["+o[_]+"+"+a+"]\nmov "+l+".w, "+g+".w\nmul "+l+", "+l+", "+h[_]+"\n",c+=0==_?"mov "+p+", "+l+"\n":"add "+p+", "+p+", "+l+"\n";d="dp3",c+="mov "+e.animationTargetRegisters[u]+", "+p+"\n"}return c},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"},t.prototype.doneAGALCode=function(){},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/AnimationSetBase":void 0}],"awayjs-renderergl/lib/animators/SkeletonAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-display/lib/events/SubGeometryEvent"),s=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/animators/AnimatorBase"),o=e("awayjs-renderergl/lib/animators/data/JointPose"),h=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),l=e("awayjs-renderergl/lib/events/AnimationStateEvent"),p=function(e){function t(t,i,r){var a=this;void 0===r&&(r=!1),e.call(this,t),this._globalPose=new h,this._morphedSubGeometry=new Object,this._morphedSubGeometryDirty=new Object,this._skeleton=i,this._forceCPU=r,this._jointsPerVertex=t.jointsPerVertex,this._numJoints=this._skeleton.numJoints,this._globalMatrices=new Array(12*this._numJoints);for(var s=0,n=0;n<this._numJoints;++n)this._globalMatrices[s++]=1,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=1,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=1,this._globalMatrices[s++]=0;this._onTransitionCompleteDelegate=function(e){return a.onTransitionComplete(e)},this._onIndicesUpdateDelegate=function(e){return a.onIndicesUpdate(e)},this._onVerticesUpdateDelegate=function(e){return a.onVerticesUpdate(e)}}return i(t,e),Object.defineProperty(t.prototype,"globalMatrices",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalMatrices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalPose",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalPose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(e){this._useCondensedIndices=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this._pAnimationSet,this._skeleton,this._forceCPU)},t.prototype.play=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=0/0),this._pActiveAnimationName!=e){if(this._pActiveAnimationName=e,!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");t&&this._pActiveNode?(this._pActiveNode=t.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(e),this._pAbsoluteTime),this._pActiveNode.addEventListener(l.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)):this._pActiveNode=this._pAnimationSet.getAnimation(e),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeSkeletonState=this._pActiveState,this.start(),isNaN(i)||this.reset(e,i)}},t.prototype.setRenderState=function(e,t,i,a,n,o){this._globalPropertiesDirty&&this.updateGlobalProperties();var h=t.subMesh.subGeometry;if(h.useCondensedIndices=this._useCondensedIndices,this._useCondensedIndices)this.updateCondensedMatrices(h.condensedIndexLookUp,h.numCondensedJoints),i.context.setProgramConstantsFromArray(s.VERTEX,n,this._condensedMatrices,3*h.numCondensedJoints);else{if(this._pAnimationSet.usesCPU)return void(this._morphedSubGeometryDirty[h.id]&&this.morphSubGeometry(t,h));i.context.setProgramConstantsFromArray(s.VERTEX,n,this._globalMatrices,3*this._numJoints)}i.activateBuffer(o,t.getVertexData(r.JOINT_INDEX_DATA),t.getVertexOffset(r.JOINT_INDEX_DATA),t.JOINT_INDEX_FORMAT),i.activateBuffer(o+1,t.getVertexData(r.JOINT_WEIGHT_DATA),t.getVertexOffset(r.JOINT_WEIGHT_DATA),t.JOINT_WEIGHT_FORMAT)},t.prototype.testGPUCompatibility=function(e){!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||e.numUsedVertexConstants+3*this._numJoints>128)&&this._pAnimationSet.cancelGPUCompatibility()},t.prototype._pUpdateDeltaTime=function(t){if(e.prototype._pUpdateDeltaTime.call(this,t),this._globalPropertiesDirty=!0,this._pAnimationSet.usesCPU)for(var i in this._morphedSubGeometryDirty)this._morphedSubGeometryDirty[i]=!0},t.prototype.updateCondensedMatrices=function(e,t){var i,r,a=0,s=0;this._condensedMatrices=new Array;do for(r=4*e[a],i=r+12;i>r;)this._condensedMatrices[s++]=this._globalMatrices[r++];while(++a<t)},t.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=!1,this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);for(var e,t,i,r,a,s,n,o,h,l,p,d,c,u,g,_,m,y,f,b,x,v,w,C,T,P,D,S,M,O,A,j,R,I,F,N,V=0,L=this._globalPose.jointPoses,E=this._skeleton.joints,B=0;B<this._numJoints;++B)R=L[B],I=R.orientation,F=R.translation,t=I.x,i=I.y,r=I.z,a=I.w,s=(N=2*t)*i,n=N*r,o=N*a,h=(N=2*i)*r,l=N*a,p=2*r*a,h=2*i*r,l=2*i*a,p=2*r*a,t*=t,i*=i,r*=r,a*=a,d=(N=t-i)-r+a,c=s-p,u=n+l,g=s+p,_=-N-r+a,m=h-o,y=n-l,f=h+o,b=-t-i+r+a,e=E[B].inverseBindPose,x=e[0],v=e[4],w=e[8],C=e[12],T=e[1],P=e[5],D=e[9],S=e[13],M=e[2],O=e[6],A=e[10],j=e[14],this._globalMatrices[V]=d*x+c*T+u*M,this._globalMatrices[V+1]=d*v+c*P+u*O,this._globalMatrices[V+2]=d*w+c*D+u*A,this._globalMatrices[V+3]=d*C+c*S+u*j+F.x,this._globalMatrices[V+4]=g*x+_*T+m*M,this._globalMatrices[V+5]=g*v+_*P+m*O,this._globalMatrices[V+6]=g*w+_*D+m*A,this._globalMatrices[V+7]=g*C+_*S+m*j+F.y,this._globalMatrices[V+8]=y*x+f*T+b*M,this._globalMatrices[V+9]=y*v+f*P+b*O,this._globalMatrices[V+10]=y*w+f*D+b*A,this._globalMatrices[V+11]=y*C+f*S+b*j+F.z,V+=12},t.prototype.getRenderableSubGeometry=function(e,t){if(this._morphedSubGeometryDirty[t.id]=!0,!this._pAnimationSet.usesCPU)return t;var i;return(i=this._morphedSubGeometry[t.id])||(i=this._morphedSubGeometry[t.id]=t.clone(),i.autoDeriveNormals=!1,i.autoDeriveTangents=!1,i.autoDeriveUVs=!1,t.addEventListener(a.INDICES_UPDATED,this._onIndicesUpdateDelegate),t.addEventListener(a.VERTICES_UPDATED,this._onVerticesUpdateDelegate)),i},t.prototype.morphSubGeometry=function(e,t){this._morphedSubGeometryDirty[t.id]=!1;for(var i,r,a,s,n,o,h,l,p,d,c,u,g,_,m,y,f,b,x,v,w,C,T,P,D,S,M,O,A,j,R,I,F=t.positions,N=t.vertexNormals,V=t.vertexTangents,L=t.jointIndices,E=t.jointWeights,B=this._morphedSubGeometry[t.id],U=B.positions,z=B.vertexNormals,k=B.vertexTangents,G=0,H=0,X=F.length;X>G;){for(u=F[G],g=F[G+1],_=F[G+2],m=N[G],y=N[G+1],f=N[G+2],b=V[G],x=V[G+1],v=V[G+2],r=0,a=0,s=0,n=0,o=0,h=0,l=0,p=0,d=0,i=0;i<this._jointsPerVertex;)if(c=E[H],c>0){var W=L[H++]<<2;w=this._globalMatrices[W],C=this._globalMatrices[W+1],T=this._globalMatrices[W+2],P=this._globalMatrices[W+3],D=this._globalMatrices[W+4],S=this._globalMatrices[W+5],M=this._globalMatrices[W+6],O=this._globalMatrices[W+7],A=this._globalMatrices[W+8],j=this._globalMatrices[W+9],R=this._globalMatrices[W+10],I=this._globalMatrices[W+11],r+=c*(w*u+C*g+T*_+P),a+=c*(D*u+S*g+M*_+O),s+=c*(A*u+j*g+R*_+I),n+=c*(w*m+C*y+T*f),o+=c*(D*m+S*y+M*f),h+=c*(A*m+j*y+R*f),l+=c*(w*b+C*x+T*v),p+=c*(D*b+S*x+M*v),d+=c*(A*b+j*x+R*v),++i}else H+=this._jointsPerVertex-i,i=this._jointsPerVertex;U[G]=r,U[G+1]=a,U[G+2]=s,z[G]=n,z[G+1]=o,z[G+2]=h,k[G]=l,k[G+1]=p,k[G+2]=d,G+=3}B.updatePositions(U),B.updateVertexNormals(z),B.updateVertexTangents(k)},t.prototype.localToGlobalPose=function(e,t,i){var r,a,s,n,h,l,p,d,c,u,g,_,m,y,f,b,x,v,w,C,T=t.jointPoses,P=i.joints,D=e.numJointPoses,S=e.jointPoses;T.length!=D&&(T.length=D);for(var M=0;D>M;++M)r=T[M],null==r&&(r=T[M]=new o),s=P[M],a=s.parentIndex,h=S[M],c=r.orientation,d=r.translation,0>a?(p=h.translation,l=h.orientation,c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,d.x=p.x,d.y=p.y,d.z=p.z):(n=T[a],l=n.orientation,p=h.translation,y=l.x,f=l.y,b=l.z,x=l.w,v=p.x,w=p.y,C=p.z,m=-y*v-f*w-b*C,u=x*v+f*C-b*w,g=x*w-y*C+b*v,_=x*C+y*w-f*v,p=n.translation,d.x=-m*y+u*x-g*b+_*f+p.x,d.y=-m*f+u*b+g*x-_*y+p.y,d.z=-m*b-u*f+g*y+_*x+p.z,u=l.x,g=l.y,_=l.z,m=l.w,l=h.orientation,y=l.x,f=l.y,b=l.z,x=l.w,c.w=m*x-u*y-g*f-_*b,c.x=m*y+u*x+g*b-_*f,c.y=m*f-u*b+g*x+_*y,c.z=m*b+u*f-g*y+_*x)},t.prototype.onTransitionComplete=function(e){e.type==l.TRANSITION_COMPLETE&&(e.animationNode.removeEventListener(l.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate),this._pActiveState==e.animationState&&(this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName),this._pActiveState=this.getAnimationState(this._pActiveNode),this._activeSkeletonState=this._pActiveState))},t.prototype.onIndicesUpdate=function(e){var t=e.target;this._morphedSubGeometry[t.id].updateIndices(t.indices)},t.prototype.onVerticesUpdate=function(e){var t=e.target,i=this._morphedSubGeometry[t.id];switch(e.dataType){case r.UV_DATA:i.updateUVs(t.uvs);case r.SECONDARY_UV_DATA:i.updateUVs(t.secondaryUVs)}},t}(n);t.exports=p},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/events/SubGeometryEvent":void 0,"awayjs-renderergl/lib/animators/AnimatorBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/animators/VertexAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/AnimationSetBase"),a=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode"),s=function(e){function t(t,i){void 0===t&&(t=2),void 0===i&&(i="absolute"),e.call(this),this._numPoses=t,this._blendMode=i}return i(t,e),Object.defineProperty(t.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(e){return this._blendMode==a.ABSOLUTE?this.getAbsoluteAGALCode(e):this.getAdditiveAGALCode(e)},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"},t.prototype.doneAGALCode=function(){},t.prototype.getAbsoluteAGALCode=function(e){var t="",i=this._pFindTempReg(e.animationTargetRegisters),r=this._pFindTempReg(e.animationTargetRegisters,i),a=new Array("x","y","z","w"),s=e.animatableAttributes.length,n="vc"+e.numUsedVertexConstants;s>2&&(s=2);for(var o=e.numUsedStreams,h=0;s>h;++h){t+="mul "+i+", "+e.animatableAttributes[h]+", "+n+"."+a[0]+"\n";for(var l=1;l<this._numPoses;++l)t+="mul "+r+", va"+o+", "+n+"."+a[l]+"\n",l<this._numPoses-1&&(t+="add "+i+", "+i+", "+r+"\n"),++o;t+="add "+e.animationTargetRegisters[h]+", "+i+", "+r+"\n"}return(e.tangentDependencies>0||e.outputsNormals)&&(t+="dp3 "+i+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\nmul "+i+", "+e.animationTargetRegisters[1]+", "+i+".x\nsub "+e.animationTargetRegisters[2]+", "+e.animationTargetRegisters[2]+", "+i+"\n"),t},t.prototype.getAdditiveAGALCode=function(e){var t,i="",r=e.animatableAttributes.length,a=["x","y","z","w"],s=this._pFindTempReg(e.animationTargetRegisters),n=e.numUsedStreams;r>2&&(r=2),i+="mov  "+e.animationTargetRegisters[0]+", "+e.animatableAttributes[0]+"\n",e.normalDependencies>0&&(i+="mov "+e.animationTargetRegisters[1]+", "+e.animatableAttributes[1]+"\n");for(var o=0;r>o;++o)for(var h=0;h<this._numPoses;++h)i+="mul "+s+", va"+(n+t)+", vc"+e.numUsedVertexConstants+"."+a[h]+"\nadd "+e.animationTargetRegisters[o]+", "+e.animationTargetRegisters[o]+", "+s+"\n",t++;return(e.tangentDependencies>0||e.outputsNormals)&&(i+="dp3 "+s+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\nmul "+s+", "+e.animationTargetRegisters[1]+", "+s+".x\nsub "+e.animationTargetRegisters[2]+", "+e.animatableAttributes[2]+", "+s+"\n"),i},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/AnimationSetBase":void 0,"awayjs-renderergl/lib/animators/data/VertexAnimationMode":void 0}],"awayjs-renderergl/lib/animators/VertexAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/base/ContextGLProgramType"),s=e("awayjs-stagegl/lib/pool/VertexDataPool"),n=e("awayjs-renderergl/lib/animators/AnimatorBase"),o=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode"),h=function(e){function t(t){e.call(this,t),this._poses=new Array,this._weights=Array(1,0,0,0),this._vertexAnimationSet=t,this._numPoses=t.numPoses,this._blendMode=t.blendMode}return i(t,e),t.prototype.clone=function(){return new t(this._vertexAnimationSet)
},t.prototype.play=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=0/0),this._pActiveAnimationName!=e){if(this._pActiveAnimationName=e,!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(e),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeVertexState=this._pActiveState,this.start(),isNaN(i)||this.reset(e,i)}},t.prototype._pUpdateDeltaTime=function(t){e.prototype._pUpdateDeltaTime.call(this,t);var i=!1;if(this._poses[0]!=this._activeVertexState.currentGeometry&&(this._poses[0]=this._activeVertexState.currentGeometry,i=!0),this._poses[1]!=this._activeVertexState.nextGeometry&&(this._poses[1]=this._activeVertexState.nextGeometry,i=!0),this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight),i)for(var r,a=this._pOwners.length,s=0;a>s;s++)r=this._pOwners[s],r._iInvalidateRenderableGeometries()},t.prototype.setRenderState=function(e,t,i,n,h,l){if(!this._poses.length)return void this.setNullPose(e,t,i,h,l);var p,d,c=t.subMesh,u=this._numPoses;for(i.context.setProgramConstantsFromArray(a.VERTEX,h,this._weights,1),d=this._blendMode==o.ABSOLUTE?1:0;u>d;++d)p=this._poses[d].subGeometries[c._iIndex]||c.subGeometry,i.activateBuffer(l++,s.getItem(p,t.getIndexData(),r.POSITION_DATA),p.getOffset(r.POSITION_DATA),r.POSITION_FORMAT),e.normalDependencies>0&&i.activateBuffer(l++,s.getItem(p,t.getIndexData(),r.NORMAL_DATA),p.getOffset(r.NORMAL_DATA),r.NORMAL_FORMAT)},t.prototype.setNullPose=function(e,t,i,s,n){if(i.context.setProgramConstantsFromArray(a.VERTEX,s,this._weights,1),this._blendMode==o.ABSOLUTE)for(var h=this._numPoses,l=1;h>l;++l)i.activateBuffer(n++,t.getVertexData(r.POSITION_DATA),t.getVertexOffset(r.POSITION_DATA),r.POSITION_FORMAT),e.normalDependencies>0&&i.activateBuffer(n++,t.getVertexData(r.NORMAL_DATA),t.getVertexOffset(r.NORMAL_DATA),r.NORMAL_FORMAT)},t.prototype.testGPUCompatibility=function(){},t.prototype.getRenderableSubGeometry=function(e,t){return this._blendMode==o.ABSOLUTE&&this._poses.length?this._poses[0].subGeometries[e.subMesh._iIndex]||t:t},t}(n);t.exports=h},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/animators/AnimatorBase":void 0,"awayjs-renderergl/lib/animators/data/VertexAnimationMode":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/pool/VertexDataPool":void 0}],"awayjs-renderergl/lib/animators/data/AnimationRegisterCache":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterCache"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),s=function(e){function t(t){e.call(this,t),this.indexDictionary=new Object,this.vertexConstantData=new Array,this.fragmentConstantData=new Array}return i(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.rotationRegisters=new Array,this.positionAttribute=this.getRegisterFromString(this.sourceRegisters[0]),this.scaleAndRotateTarget=this.getRegisterFromString(this.targetRegisters[0]),this.addVertexTempUsages(this.scaleAndRotateTarget,1);for(var t=1;t<this.targetRegisters.length;t++)this.rotationRegisters.push(this.getRegisterFromString(this.targetRegisters[t])),this.addVertexTempUsages(this.rotationRegisters[t-1],1);if(this.scaleAndRotateTarget=new a(this.scaleAndRotateTarget.regName,this.scaleAndRotateTarget.index),this.vertexZeroConst=this.getFreeVertexConstant(),this.vertexZeroConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,0),this.vertexOneConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,1),this.vertexTwoConst=new a(this.vertexZeroConst.regName,this.vertexZeroConst.index,2),this.positionTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.positionTarget,1),this.positionTarget=new a(this.positionTarget.regName,this.positionTarget.index),this.needVelocity)this.velocityTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.velocityTarget,1),this.velocityTarget=new a(this.velocityTarget.regName,this.velocityTarget.index),this.vertexTime=new a(this.velocityTarget.regName,this.velocityTarget.index,3),this.vertexLife=new a(this.positionTarget.regName,this.positionTarget.index,3);else{var i=this.getFreeVertexVectorTemp();this.addVertexTempUsages(i,1),this.vertexTime=new a(i.regName,i.index,0),this.vertexLife=new a(i.regName,i.index,1)}},t.prototype.setUVSourceAndTarget=function(e,t){this.uvVar=this.getRegisterFromString(t),this.uvAttribute=this.getRegisterFromString(e),this.uvTarget=new a(this.positionTarget.regName,this.positionTarget.index)},t.prototype.setRegisterIndex=function(e,t,i){var r=this.indexDictionary[e.id];null==r&&(r=this.indexDictionary[e.id]=new Array(8)),r[t]=i},t.prototype.getRegisterIndex=function(e,t){return this.indexDictionary[e.id][t]},t.prototype.getInitCode=function(){for(var e=this.sourceRegisters.length,t="",i=0;e>i;i++)t+="mov "+this.targetRegisters[i]+","+this.sourceRegisters[i]+"\n";return t+="mov "+this.positionTarget+".xyz,"+this.vertexZeroConst.toString()+"\n",this.needVelocity&&(t+="mov "+this.velocityTarget+".xyz,"+this.vertexZeroConst.toString()+"\n"),t},t.prototype.getCombinationCode=function(){return"add "+this.scaleAndRotateTarget+".xyz,"+this.scaleAndRotateTarget+".xyz,"+this.positionTarget+".xyz\n"},t.prototype.initColorRegisters=function(){var e="";return this.hasColorMulNode&&(this.colorMulTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorMulTarget,1),this.colorMulVary=this.getFreeVarying(),e+="mov "+this.colorMulTarget+","+this.vertexOneConst+"\n"),this.hasColorAddNode&&(this.colorAddTarget=this.getFreeVertexVectorTemp(),this.addVertexTempUsages(this.colorAddTarget,1),this.colorAddVary=this.getFreeVarying(),e+="mov "+this.colorAddTarget+","+this.vertexZeroConst+"\n"),e},t.prototype.getColorPassCode=function(){var e="";return this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)&&(this.hasColorMulNode&&(e+="mov "+this.colorMulVary+","+this.colorMulTarget+"\n"),this.hasColorAddNode&&(e+="mov "+this.colorAddVary+","+this.colorAddTarget+"\n")),e},t.prototype.getColorCombinationCode=function(e){var t="";if(this.needFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)){var i=this.getRegisterFromString(e);this.addFragmentTempUsages(i,1),this.hasColorMulNode&&(t+="mul "+i+","+i+","+this.colorMulVary+"\n"),this.hasColorAddNode&&(t+="add "+i+","+i+","+this.colorAddVary+"\n")}return t},t.prototype.getRegisterFromString=function(e){var t=e.split(/(\d+)/);return new a(t[0],parseInt(t[1]))},Object.defineProperty(t.prototype,"numVertexConstant",{get:function(){return this._numVertexConstant},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numFragmentConstant",{get:function(){return this._numFragmentConstant},enumerable:!0,configurable:!0}),t.prototype.setDataLength=function(){this._numVertexConstant=this.numUsedVertexConstants-this.vertexConstantOffset,this._numFragmentConstant=this.numUsedFragmentConstants-this.fragmentConstantOffset,this.vertexConstantData.length=4*this._numVertexConstant,this.fragmentConstantData.length=4*this._numFragmentConstant},t.prototype.setVertexConst=function(e,t,i,r,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0);var s=4*(e-this.vertexConstantOffset);this.vertexConstantData[s++]=t,this.vertexConstantData[s++]=i,this.vertexConstantData[s++]=r,this.vertexConstantData[s]=a},t.prototype.setVertexConstFromArray=function(e,t){for(var i=4*(e-this.vertexConstantOffset),r=0;r<t.length;r++)this.vertexConstantData[i++]=t[r]},t.prototype.setVertexConstFromMatrix=function(e,t){var i=t.rawData,r=4*(e-this.vertexConstantOffset);this.vertexConstantData[r++]=i[0],this.vertexConstantData[r++]=i[4],this.vertexConstantData[r++]=i[8],this.vertexConstantData[r++]=i[12],this.vertexConstantData[r++]=i[1],this.vertexConstantData[r++]=i[5],this.vertexConstantData[r++]=i[9],this.vertexConstantData[r++]=i[13],this.vertexConstantData[r++]=i[2],this.vertexConstantData[r++]=i[6],this.vertexConstantData[r++]=i[10],this.vertexConstantData[r++]=i[14],this.vertexConstantData[r++]=i[3],this.vertexConstantData[r++]=i[7],this.vertexConstantData[r++]=i[11],this.vertexConstantData[r]=i[15]},t.prototype.setFragmentConst=function(e,t,i,r,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0);var s=4*(e-this.fragmentConstantOffset);this.fragmentConstantData[s++]=t,this.fragmentConstantData[s++]=i,this.fragmentConstantData[s++]=r,this.fragmentConstantData[s]=a},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/compilation/ShaderRegisterCache":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":[function(e,t){var i=function(){function e(){this._pVertexBuffer=new Array(8),this._pBufferContext=new Array(8),this._pBufferDirty=new Array(8),this.numProcessedVertices=0,this.previousTime=Number.NEGATIVE_INFINITY,this.animationParticles=new Array;for(var t=0;8>t;t++)this._pBufferDirty[t]=!0;this._iUniqueId=e.SUBGEOM_ID_COUNT++}return e.prototype.createVertexData=function(e,t){this._numVertices=e,this._totalLenOfOneVertex=t,this._pVertexData=new Array(e*t)},e.prototype.activateVertexBuffer=function(e,t,i,r){var a=i.stageIndex,s=i.context,n=this._pVertexBuffer[a];n&&this._pBufferContext[a]==s||(n=this._pVertexBuffer[a]=s.createVertexBuffer(this._numVertices,this._totalLenOfOneVertex),this._pBufferContext[a]=s,this._pBufferDirty[a]=!0),this._pBufferDirty[a]&&(n.uploadFromArray(this._pVertexData,0,this._numVertices),this._pBufferDirty[a]=!1),s.setVertexBufferAt(e,n,t,r)},e.prototype.dispose=function(){for(;this._pVertexBuffer.length;){var e=this._pVertexBuffer.pop();e&&e.dispose()}},e.prototype.invalidateBuffer=function(){for(var e=0;8>e;e++)this._pBufferDirty[e]=!0},Object.defineProperty(e.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:!0,configurable:!0}),e.SUBGEOM_ID_COUNT=0,e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ColorSegmentPoint":[function(e,t){var i=function(){function e(e,t){if(0>=e||e>=1)throw new Error("life exceeds range (0,1)");this._life=e,this._color=t}return Object.defineProperty(e.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"life",{get:function(){return this._life},enumerable:!0,configurable:!0}),e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/JointPose":[function(e,t){var i=e("awayjs-core/lib/geom/Matrix3D"),r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-core/lib/geom/Vector3D"),s=function(){function e(){this.orientation=new r,this.translation=new a}return e.prototype.toMatrix3D=function(e){return void 0===e&&(e=null),null==e&&(e=new i),this.orientation.toMatrix3D(e),e.appendTranslation(this.translation.x,this.translation.y,this.translation.z),e},e.prototype.copyFrom=function(e){var t=e.orientation,i=e.translation;this.orientation.x=t.x,this.orientation.y=t.y,this.orientation.z=t.z,this.orientation.w=t.w,this.translation.x=i.x,this.translation.y=i.y,this.translation.z=i.z},e}();t.exports=s},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0}],"awayjs-renderergl/lib/animators/data/ParticleAnimationData":[function(e,t){var i=function(){function e(e,t,i,r,a){this.index=e,this.startTime=t,this.totalTime=i+r,this.duration=i,this.delay=r,this.startVertexIndex=a.startVertexIndex,this.numVertices=a.numVertices}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticleData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":[function(e,t){var i=function(){function e(){}return e.GLOBAL=0,e.LOCAL_STATIC=1,e.LOCAL_DYNAMIC=2,e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticleProperties":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonJoint":[function(e,t){var i=function(){function e(){this.parentIndex=-1}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonPose":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=e("awayjs-renderergl/lib/animators/data/JointPose"),n=function(e){function t(){e.call(this),this.jointPoses=new Array}return i(t,e),Object.defineProperty(t.prototype,"numJointPoses",{get:function(){return this.jointPoses.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assetType",{get:function(){return r.SKELETON_POSE},enumerable:!0,configurable:!0}),t.prototype.jointPoseFromName=function(e){var t=this.jointPoseIndexFromName(e);return-1!=t?this.jointPoses[t]:null},t.prototype.jointPoseIndexFromName=function(e){for(var t,i,r;r<this.jointPoses.length;r++){if(i=this.jointPoses[r],i.name==e)return t;t++}return-1},t.prototype.clone=function(){for(var e=new t,i=this.jointPoses.length,r=0;i>r;r++){var a=new s,n=this.jointPoses[r];a.name=n.name,a.copyFrom(n),e.jointPoses[r]=a}return e},t.prototype.dispose=function(){this.jointPoses.length=0},t}(a);t.exports=n},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0}],"awayjs-renderergl/lib/animators/data/Skeleton":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=function(e){function t(){e.call(this),this.joints=new Array}return i(t,e),Object.defineProperty(t.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),t.prototype.jointFromName=function(e){var t=this.jointIndexFromName(e);return-1!=t?this.joints[t]:null},t.prototype.jointIndexFromName=function(e){for(var t,i,r;r<this.joints.length;r++){if(i=this.joints[r],i.name==e)return t;t++}return-1},t.prototype.dispose=function(){this.joints.length=0},Object.defineProperty(t.prototype,"assetType",{get:function(){return r.SKELETON},enumerable:!0,configurable:!0}),t}(a);t.exports=s},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0}],"awayjs-renderergl/lib/animators/data/VertexAnimationMode":[function(e,t){var i=function(){function e(){}return e.ADDITIVE="additive",e.ABSOLUTE="absolute",e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),s=function(e){function t(){e.call(this),this._pLooping=!0,this._pTotalDuration=0,this._pStitchDirty=!0,this._pStitchFinalFrame=!1,this._pNumFrames=0,this._pDurations=new Array,this._pTotalDelta=new r,this.fixedFrameRate=!0}return i(t,e),Object.defineProperty(t.prototype,"looping",{get:function(){return this._pLooping},set:function(e){this._pLooping!=e&&(this._pLooping=e,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(e){this._pStitchFinalFrame!=e&&(this._pStitchFinalFrame=e,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalDuration",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDuration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalDelta",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDelta},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastFrame",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pLastFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durations",{get:function(){return this._pDurations},enumerable:!0,configurable:!0}),t.prototype._pUpdateStitch=function(){this._pStitchDirty=!1,this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1,this._pTotalDuration=0,this._pTotalDelta.x=0,this._pTotalDelta.y=0,this._pTotalDelta.z=0},t}(a);t.exports=s},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleAccelerationState"),o=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleAcceleration",t,3),this._pStateClass=n,this._acceleration=i||new r}return i(t,e),t.prototype.pGetAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.ACCELERATION_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var s="mul "+r+","+t.vertexTime+","+i+"\n";if(t.needVelocity){var o=t.getFreeVertexVectorTemp();s+="mul "+o+","+r+","+t.vertexTwoConst+"\n",s+="add "+t.velocityTarget+".xyz,"+o+".xyz,"+t.velocityTarget+".xyz\n"}return t.removeVertexTempUsage(r),s+="mul "+r+","+r+","+t.vertexTime+"\n",s+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ACCELERATION_VECTOR3D];if(!i)throw new Error("there is no "+t.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=i.x/2,this._pOneData[1]=i.y/2,this._pOneData[2]=i.z/2},t.ACCELERATION_VECTOR3D="AccelerationVector3D",t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleBezierCurveState"),h=function(e){function t(t,i,a){void 0===i&&(i=null),void 0===a&&(a=null),e.call(this,"ParticleBezierCurve",t,6),this._pStateClass=o,this._iControlPoint=i||new r,this._iEndPoint=a||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.BEZIER_CONTROL_INDEX,i.index);var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.BEZIER_END_INDEX,r.index);var n=t.getFreeVertexVectorTemp(),h=new a(n.regName,n.index,0),l=new a(n.regName,n.index,1),p=new a(n.regName,n.index,2);t.addVertexTempUsages(n,1);var d=t.getFreeVertexVectorTemp(),c=new a(d.regName,d.index);t.removeVertexTempUsage(n);var u="";return u+="sub "+h+","+t.vertexOneConst+","+t.vertexLife+"\n",u+="mul "+l+","+t.vertexLife+","+t.vertexLife+"\n",u+="mul "+p+","+t.vertexLife+","+h+"\n",u+="mul "+p+","+p+","+t.vertexTwoConst+"\n",u+="mul "+c+".xyz,"+p+","+i+"\n",u+="add "+t.positionTarget+".xyz,"+c+".xyz,"+t.positionTarget+".xyz\n",u+="mul "+c+".xyz,"+l+","+r+"\n",u+="add "+t.positionTarget+".xyz,"+c+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(u+="mul "+l+","+t.vertexLife+","+t.vertexTwoConst+"\n",u+="sub "+p+","+t.vertexOneConst+","+l+"\n",u+="mul "+p+","+t.vertexTwoConst+","+p+"\n",u+="mul "+c+".xyz,"+i+","+p+"\n",u+="add "+t.velocityTarget+".xyz,"+c+".xyz,"+t.velocityTarget+".xyz\n",u+="mul "+c+".xyz,"+r+","+l+"\n",u+="add "+t.velocityTarget+".xyz,"+c+".xyz,"+t.velocityTarget+".xyz\n"),u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.BEZIER_CONTROL_VECTOR3D];if(!i)throw new Error("there is no "+t.BEZIER_CONTROL_VECTOR3D+" in param!");var r=e[t.BEZIER_END_VECTOR3D];if(!r)throw new Error("there is no "+t.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,this._pOneData[3]=r.x,this._pOneData[4]=r.y,this._pOneData[5]=r.z},t.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D",t.BEZIER_END_VECTOR3D="BezierEndVector3D",t}(n);t.exports=h},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleBillboardState"),n=function(e){function t(t){void 0===t&&(t=null),e.call(this,"ParticleBillboard",r.GLOBAL,0,4),this._pStateClass=s,this._iBillboardAxis=t}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexConstant();t.setRegisterIndex(this,s.MATRIX_INDEX,i.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant();for(var r,a=t.getFreeVertexVectorTemp(),n="m33 "+a+".xyz,"+t.scaleAndRotateTarget+","+i+"\nmov "+t.scaleAndRotateTarget+".xyz,"+a+"\n",o=0;o<t.rotationRegisters.length;o++)r=t.rotationRegisters[o],n+="m33 "+a+".xyz,"+r+","+i+"\nmov "+r+".xyz,"+r+"\n";return n},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.hasBillboard=!0},t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleBillboardState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleColorState"),h=function(e){function t(t,i,s,n,h,l,p,d,c){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===n&&(n=!1),void 0===h&&(h=!1),void 0===l&&(l=null),void 0===p&&(p=null),void 0===d&&(d=1),void 0===c&&(c=0),e.call(this,"ParticleColor",t,i&&s?16:8,a.COLOR_PRIORITY),this._pStateClass=o,this._iUsesMultiplier=i,this._iUsesOffset=s,this._iUsesCycle=n,this._iUsesPhase=h,this._iStartColor=l||new r,this._iEndColor=p||new r,this._iCycleDuration=d,this._iCyclePhase=c}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var r=t.getFreeVertexVectorTemp();if(this._iUsesCycle){var a=t.getFreeVertexConstant();t.setRegisterIndex(this,o.CYCLE_INDEX,a.index),t.addVertexTempUsages(r,1);var n=t.getFreeVertexSingleTemp();t.removeVertexTempUsage(r),i+="mul "+n+","+t.vertexTime+","+a+".x\n",this._iUsesPhase&&(i+="add "+n+","+n+","+a+".y\n"),i+="sin "+n+","+n+"\n"}if(this._iUsesMultiplier){var h=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute(),l=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.START_MULTIPLIER_INDEX,h.index),t.setRegisterIndex(this,o.DELTA_MULTIPLIER_INDEX,l.index),i+="mul "+r+","+l+","+(this._iUsesCycle?n:t.vertexLife)+"\n",i+="add "+r+","+r+","+h+"\n",i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var p=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant(),d=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,o.START_OFFSET_INDEX,p.index),t.setRegisterIndex(this,o.DELTA_OFFSET_INDEX,d.index),i+="mul "+r+","+d+","+(this._iUsesCycle?n:t.vertexLife)+"\n",i+="add "+r+","+r+","+p+"\n",i+="add "+t.colorAddTarget+","+r+","+t.colorAddTarget+"\n"}}return i},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_START_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_START_COLORTRANSFORM+" in param!");var r=e[t.COLOR_END_COLORTRANSFORM];if(!r)throw new Error("there is no "+t.COLOR_END_COLORTRANSFORM+" in param!");var a=0;this._iUsesCycle?(this._iUsesMultiplier&&(this._pOneData[a++]=(i.redMultiplier+r.redMultiplier)/2,this._pOneData[a++]=(i.greenMultiplier+r.greenMultiplier)/2,this._pOneData[a++]=(i.blueMultiplier+r.blueMultiplier)/2,this._pOneData[a++]=(i.alphaMultiplier+r.alphaMultiplier)/2,this._pOneData[a++]=(i.redMultiplier-r.redMultiplier)/2,this._pOneData[a++]=(i.greenMultiplier-r.greenMultiplier)/2,this._pOneData[a++]=(i.blueMultiplier-r.blueMultiplier)/2,this._pOneData[a++]=(i.alphaMultiplier-r.alphaMultiplier)/2),this._iUsesOffset&&(this._pOneData[a++]=(i.redOffset+r.redOffset)/510,this._pOneData[a++]=(i.greenOffset+r.greenOffset)/510,this._pOneData[a++]=(i.blueOffset+r.blueOffset)/510,this._pOneData[a++]=(i.alphaOffset+r.alphaOffset)/510,this._pOneData[a++]=(i.redOffset-r.redOffset)/510,this._pOneData[a++]=(i.greenOffset-r.greenOffset)/510,this._pOneData[a++]=(i.blueOffset-r.blueOffset)/510,this._pOneData[a++]=(i.alphaOffset-r.alphaOffset)/510)):(this._iUsesMultiplier&&(this._pOneData[a++]=i.redMultiplier,this._pOneData[a++]=i.greenMultiplier,this._pOneData[a++]=i.blueMultiplier,this._pOneData[a++]=i.alphaMultiplier,this._pOneData[a++]=r.redMultiplier-i.redMultiplier,this._pOneData[a++]=r.greenMultiplier-i.greenMultiplier,this._pOneData[a++]=r.blueMultiplier-i.blueMultiplier,this._pOneData[a++]=r.alphaMultiplier-i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[a++]=i.redOffset/255,this._pOneData[a++]=i.greenOffset/255,this._pOneData[a++]=i.blueOffset/255,this._pOneData[a++]=i.alphaOffset/255,this._pOneData[a++]=(r.redOffset-i.redOffset)/255,this._pOneData[a++]=(r.greenOffset-i.greenOffset)/255,this._pOneData[a++]=(r.blueOffset-i.blueOffset)/255,this._pOneData[a++]=(r.alphaOffset-i.alphaOffset)/255))},t.COLOR_START_COLORTRANSFORM="ColorStartColorTransform",t.COLOR_END_COLORTRANSFORM="ColorEndColorTransform",t}(n);t.exports=h},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleColorState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleFollowState"),o=function(e){function t(t,i,s){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===s&&(s=!1),e.call(this,"ParticleFollow",a.LOCAL_DYNAMIC,t&&i?6:3,r.POST_PRIORITY),this._pStateClass=n,this._iUsesPosition=t,this._iUsesRotation=i,this._iSmooth=s}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(this._iUsesRotation){var r=t.getFreeVertexAttribute();t.setRegisterIndex(this,n.FOLLOW_ROTATION_INDEX,r.index);var a=t.getFreeVertexVectorTemp();t.addVertexTempUsages(a,1);var s=t.getFreeVertexVectorTemp();t.addVertexTempUsages(s,1);var o,h=t.getFreeVertexVectorTemp();t.hasBillboard&&(t.addVertexTempUsages(h,1),o=t.getFreeVertexVectorTemp()),t.removeVertexTempUsage(a),t.removeVertexTempUsage(s),t.hasBillboard&&t.removeVertexTempUsage(h);var l,p=t.rotationRegisters.length;if(i+="mov "+a+","+t.vertexZeroConst+"\n",i+="mov "+a+".x,"+t.vertexOneConst+"\n",i+="mov "+h+","+t.vertexZeroConst+"\n",i+="sin "+h+".y,"+r+".x\n",i+="cos "+h+".z,"+r+".x\n",i+="mov "+s+".x,"+t.vertexZeroConst+"\n",i+="mov "+s+".y,"+h+".z\n",i+="neg "+s+".z,"+h+".y\n",t.hasBillboard)i+="m33 "+o+".xyz,"+t.positionTarget+".xyz,"+a+"\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",l=0;p>l;l++)i+="m33 "+t.rotationRegisters[l]+".xyz,"+t.rotationRegisters[l]+","+a+"\n";if(i+="mov "+a+","+t.vertexZeroConst+"\n",i+="cos "+a+".x,"+r+".y\n",i+="sin "+a+".z,"+r+".y\n",i+="mov "+s+","+t.vertexZeroConst+"\n",i+="mov "+s+".y,"+t.vertexOneConst+"\n",i+="mov "+h+","+t.vertexZeroConst+"\n",i+="neg "+h+".x,"+a+".z\n",i+="mov "+h+".z,"+a+".x\n",t.hasBillboard)i+="m33 "+o+".xyz,"+o+".xyz,"+a+"\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",l=0;p>l;l++)i+="m33 "+t.rotationRegisters[l]+".xyz,"+t.rotationRegisters[l]+","+a+"\n";if(i+="mov "+s+","+t.vertexZeroConst+"\n",i+="sin "+s+".x,"+r+".z\n",i+="cos "+s+".y,"+r+".z\n",i+="mov "+a+","+t.vertexZeroConst+"\n",i+="mov "+a+".x,"+s+".y\n",i+="neg "+a+".y,"+s+".x\n",i+="mov "+h+","+t.vertexZeroConst+"\n",i+="mov "+h+".z,"+t.vertexOneConst+"\n",t.hasBillboard)i+="m33 "+o+".xyz,"+o+".xyz,"+a+"\n",i+="sub "+o+".xyz,"+o+".xyz,"+t.positionTarget+".xyz\n",i+="add "+t.scaleAndRotateTarget+".xyz,"+o+".xyz,"+t.scaleAndRotateTarget+".xyz\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",l=0;p>l;l++)i+="m33 "+t.rotationRegisters[l]+".xyz,"+t.rotationRegisters[l]+","+a+"\n"}if(this._iUsesPosition){var d=t.getFreeVertexAttribute();t.setRegisterIndex(this,n.FOLLOW_POSITION_INDEX,d.index),i+="add "+t.scaleAndRotateTarget+".xyz,"+d+","+t.scaleAndRotateTarget+".xyz\n"}return i},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleFollowState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e
}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleInitialColorState"),h=function(e){function t(t,i,s,n){void 0===i&&(i=!0),void 0===s&&(s=!1),void 0===n&&(n=null),e.call(this,"ParticleInitialColor",t,i&&s?8:4,a.COLOR_PRIORITY),this._pStateClass=o,this._iUsesMultiplier=i,this._iUsesOffset=s,this._iInitialColor=n||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){if(this._iUsesMultiplier){var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.MULTIPLIER_INDEX,r.index),i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var a=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,o.OFFSET_INDEX,a.index),i+="add "+t.colorAddTarget+","+a+","+t.colorAddTarget+"\n"}}return i},t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_INITIAL_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_INITIAL_COLORTRANSFORM+" in param!");var r=0;this._iUsesMultiplier&&(this._pOneData[r++]=i.redMultiplier,this._pOneData[r++]=i.greenMultiplier,this._pOneData[r++]=i.blueMultiplier,this._pOneData[r++]=i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[r++]=i.redOffset/255,this._pOneData[r++]=i.greenOffset/255,this._pOneData[r++]=i.blueOffset/255,this._pOneData[r++]=i.alphaOffset/255)},t.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform",t}(n);t.exports=h},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=function(e){function t(i,r,a,s){void 0===s&&(s=1),e.call(this),this._pDataLength=3,i+=t.MODES[r],this.name=i,this._pMode=r,this._priority=s,this._pDataLength=a,this._pOneData=new Array(this._pDataLength)}return i(t,e),Object.defineProperty(t.prototype,"mode",{get:function(){return this._pMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oneData",{get:function(){return this._pOneData},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(){return""},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(){return""},t.prototype._iGeneratePropertyOfOneParticle=function(){},t.prototype._iProcessAnimationSetting=function(){},t.GLOBAL="Global",t.LOCAL_STATIC="LocalStatic",t.LOCAL_DYNAMIC="LocalDynamic",t.MODES={0:t.GLOBAL,1:t.LOCAL_STATIC,2:t.LOCAL_DYNAMIC},t}(r);t.exports=a},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleOrbitState"),h=function(e){function t(t,i,a,s,n,h,l,p){void 0===i&&(i=!0),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===n&&(n=100),void 0===h&&(h=1),void 0===l&&(l=0),void 0===p&&(p=null);var d=3;s&&d++,e.call(this,"ParticleOrbit",t,d),this._pStateClass=o,this._iUsesEulers=i,this._iUsesCycle=a,this._iUsesPhase=s,this._iRadius=n,this._iCycleDuration=h,this._iCyclePhase=l,this._iEulers=p||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.ORBIT_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,o.EULERS_INDEX,r.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant();var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);var h=new a(n.regName,n.index),l=t.getFreeVertexVectorTemp(),p=new a(l.regName,l.index,0),d=new a(l.regName,l.index,1),c=new a(l.regName,l.index,2);t.removeVertexTempUsage(n);var u="";return this._iUsesCycle?(u+="mul "+c+","+t.vertexTime+","+i+".y\n",this._iUsesPhase&&(u+="add "+c+","+c+","+i+".w\n")):u+="mul "+c+","+t.vertexLife+","+i+".y\n",u+="cos "+p+","+c+"\n",u+="sin "+d+","+c+"\n",u+="mul "+h+".x,"+p+","+i+".x\n",u+="mul "+h+".y,"+d+","+i+".x\n",u+="mov "+h+".wz"+t.vertexZeroConst+"\n",this._iUsesEulers&&(u+="m44 "+h+","+h+","+r+"\n"),u+="add "+t.positionTarget+".xyz,"+h+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(u+="neg "+h+".x,"+d+"\n",u+="mov "+h+".y,"+p+"\n",u+="mov "+h+".zw,"+t.vertexZeroConst+"\n",this._iUsesEulers&&(u+="m44 "+h+","+h+","+r+"\n"),u+="mul "+h+","+h+","+i+".z\n",u+="div "+h+","+h+","+i+".y\n",this._iUsesCycle||(u+="div "+h+","+h+","+t.vertexLife+"\n"),u+="add "+t.velocityTarget+".xyz,"+t.velocityTarget+".xyz,"+h+".xyz\n"),u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ORBIT_VECTOR3D];if(!i)throw new Error("there is no "+t.ORBIT_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._iUsesCycle&&i.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=2*Math.PI/(this._iUsesCycle?i.y:1),this._pOneData[2]=i.x*Math.PI*2,this._iUsesPhase&&(this._pOneData[3]=i.z*Math.PI/180)},t.ORBIT_VECTOR3D="OrbitVector3D",t}(n);t.exports=h},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleOrbitState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleOscillatorState"),h=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleOscillator",t,4),this._pStateClass=o,this._iOscillator=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.OSCILLATOR_INDEX,i.index);var r=t.getFreeVertexVectorTemp(),n=new a(r.regName,r.index,0),h=new a(r.regName,r.index,1),l=new a(r.regName,r.index,2);t.addVertexTempUsages(r,1);var p=t.getFreeVertexVectorTemp(),d=new a(p.regName,p.index);t.removeVertexTempUsage(r);var c="";return c+="mul "+n+","+t.vertexTime+","+i+".w\n",c+="sin "+h+","+n+"\n",c+="mul "+d+".xyz,"+h+","+i+".xyz\n",c+="add "+t.positionTarget+".xyz,"+d+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(c+="cos "+l+","+n+"\n",c+="mul "+d+".xyz,"+l+","+i+".xyz\n",c+="add "+t.velocityTarget+".xyz,"+d+".xyz,"+t.velocityTarget+".xyz\n"),c},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.OSCILLATOR_VECTOR3D];if(!i)throw new Error("there is no "+t.OSCILLATOR_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=2*Math.PI/i.w},t.OSCILLATOR_VECTOR3D="OscillatorVector3D",t}(n);t.exports=h},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticlePositionState"),o=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticlePosition",t,3),this._pStateClass=n,this._iPosition=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();return t.setRegisterIndex(this,n.POSITION_INDEX,i.index),"add "+t.positionTarget+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.POSITION_VECTOR3D="PositionVector3D",t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticlePositionState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState"),o=function(e){function t(){e.call(this,"ParticleRotateToHeading",a.GLOBAL,0,3),this._pStateClass=n}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i,a="",s=t.rotationRegisters.length;if(t.hasBillboard){var o=t.getFreeVertexVectorTemp();t.addVertexTempUsages(o,1);var h=t.getFreeVertexVectorTemp();t.addVertexTempUsages(h,1);var l=t.getFreeVertexVectorTemp(),p=t.getFreeVertexConstant();for(t.setRegisterIndex(this,n.MATRIX_INDEX,p.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.removeVertexTempUsage(o),t.removeVertexTempUsage(h),a+="m33 "+o+".xyz,"+t.velocityTarget+".xyz,"+p+"\n",a+="mov "+l+","+t.vertexZeroConst+"\n",a+="mov "+l+".xy,"+o+".xy\n",a+="nrm "+l+".xyz,"+l+".xyz\n",a+="mov "+h+","+t.vertexZeroConst+"\n",a+="mov "+h+".x,"+l+".y\n",a+="mov "+h+".y,"+l+".x\n",a+="mov "+o+","+t.vertexZeroConst+"\n",a+="mov "+o+".x,"+l+".x\n",a+="neg "+o+".y,"+l+".y\n",a+="mov "+l+","+t.vertexZeroConst+"\n",a+="mov "+l+".z,"+t.vertexOneConst+"\n",a+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+o+"\n",i=0;s>i;i++)a+="m33 "+t.rotationRegisters[i]+".xyz,"+t.rotationRegisters[i]+","+o+"\n"}else{var d=t.getFreeVertexVectorTemp();t.addVertexTempUsages(d,1);var c=t.getFreeVertexVectorTemp();t.addVertexTempUsages(c,1);var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var g=t.getFreeVertexVectorTemp(),_=new r(u.regName,u.index,3),m=new r(g.regName,g.index,3),y=new r(d.regName,d.index,3),f=m;for(t.removeVertexTempUsage(d),t.removeVertexTempUsage(c),t.removeVertexTempUsage(u),a+="mov "+c+".x,"+t.vertexOneConst+"\n",a+="mov "+c+".yz,"+t.vertexZeroConst+"\n",a+="nrm "+d+".xyz,"+t.velocityTarget+".xyz\n",a+="dp3 "+y+","+d+".xyz,"+c+".xyz\n",a+="crs "+d+".xyz,"+c+".xyz,"+d+".xyz\n",a+="nrm "+d+".xyz,"+d+".xyz\n",a+="dp3 "+u+".x,"+d+".xyz,"+d+".xyz\n",a+="sge "+u+".x,"+t.vertexZeroConst+","+u+".x\n",a+="add "+d+".z,"+u+".x,"+d+".z\n",a+="add "+f+","+y+","+t.vertexOneConst+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+_+","+f+"\n",a+="sub "+f+","+t.vertexOneConst+","+y+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+m+","+f+"\n",a+="mul "+u+".xyz,"+m+","+d+".xyz\n",a+="mul "+g+".xyz,"+m+","+d+".xyz\n",a+="neg "+g+".xyz,"+g+".xyz\n",a+="crs "+d+".xyz,"+u+".xyz,"+t.scaleAndRotateTarget+".xyz\n",a+="mul "+c+".xyz,"+_+","+t.scaleAndRotateTarget+".xyz\n",a+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",a+="dp3 "+c+".w,"+u+".xyz,"+t.scaleAndRotateTarget+".xyz\n",a+="neg "+d+".w,"+c+".w\n",a+="crs "+u+".xyz,"+d+".xyz,"+g+".xyz\n",a+="mul "+c+".xyzw,"+d+".xyzw,"+_+"\n",a+="add "+u+".xyz,"+u+".xyz,"+c+".xyz\n",a+="mul "+c+".xyz,"+d+".w,"+g+".xyz\n",a+="add "+t.scaleAndRotateTarget+".xyz,"+u+".xyz,"+c+".xyz\n",i=0;s>i;i++)a+="mov "+c+".x,"+t.vertexOneConst+"\n",a+="mov "+c+".yz,"+t.vertexZeroConst+"\n",a+="nrm "+d+".xyz,"+t.velocityTarget+".xyz\n",a+="dp3 "+y+","+d+".xyz,"+c+".xyz\n",a+="crs "+d+".xyz,"+c+".xyz,"+d+".xyz\n",a+="nrm "+d+".xyz,"+d+".xyz\n",a+="dp3 "+u+".x,"+d+".xyz,"+d+".xyz\n",a+="sge "+u+".x,"+t.vertexZeroConst+","+u+".x\n",a+="add "+d+".z,"+u+".x,"+d+".z\n",a+="add "+f+","+y+","+t.vertexOneConst+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+_+","+f+"\n",a+="sub "+f+","+t.vertexOneConst+","+y+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+m+","+f+"\n",a+="mul "+u+".xyz,"+m+","+d+".xyz\n",a+="mul "+g+".xyz,"+m+","+d+".xyz\n",a+="neg "+g+".xyz,"+g+".xyz\n",a+="crs "+d+".xyz,"+u+".xyz,"+t.rotationRegisters[i]+".xyz\n",a+="mul "+c+".xyz,"+_+","+t.rotationRegisters[i]+".xyz\n",a+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",a+="dp3 "+c+".w,"+u+".xyz,"+t.rotationRegisters[i]+".xyz\n",a+="neg "+d+".w,"+c+".w\n",a+="crs "+u+".xyz,"+d+".xyz,"+g+".xyz\n",a+="mul "+c+".xyzw,"+d+".xyzw,"+_+"\n",a+="add "+u+".xyz,"+u+".xyz,"+c+".xyz\n",a+="mul "+c+".xyz,"+d+".w,"+g+".xyz\n",a+="add "+t.rotationRegisters[i]+".xyz,"+u+".xyz,"+c+".xyz\n"}return a},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.needVelocity=!0},t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState"),h=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleRotateToPosition",t,3,3),this._pStateClass=o,this._iPosition=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.POSITION_INDEX,i.index);var r,n="",h=t.rotationRegisters.length;if(t.hasBillboard){var l=t.getFreeVertexVectorTemp();t.addVertexTempUsages(l,1);var p=t.getFreeVertexVectorTemp();t.addVertexTempUsages(p,1);var d=t.getFreeVertexVectorTemp(),c=t.getFreeVertexConstant();for(t.setRegisterIndex(this,o.MATRIX_INDEX,c.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.removeVertexTempUsage(l),t.removeVertexTempUsage(p),n+="sub "+l+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",n+="m33 "+l+".xyz,"+l+".xyz,"+c+"\n",n+="mov "+d+","+t.vertexZeroConst+"\n",n+="mov "+d+".xy,"+l+".xy\n",n+="nrm "+d+".xyz,"+d+".xyz\n",n+="mov "+p+","+t.vertexZeroConst+"\n",n+="mov "+p+".x,"+d+".y\n",n+="mov "+p+".y,"+d+".x\n",n+="mov "+l+","+t.vertexZeroConst+"\n",n+="mov "+l+".x,"+d+".x\n",n+="neg "+l+".y,"+d+".y\n",n+="mov "+d+","+t.vertexZeroConst+"\n",n+="mov "+d+".z,"+t.vertexOneConst+"\n",n+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+l+"\n",r=0;h>r;r++)n+="m33 "+t.rotationRegisters[r]+".xyz,"+t.rotationRegisters[r]+","+l+"\n"}else{var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var g=t.getFreeVertexVectorTemp();t.addVertexTempUsages(g,1);var _=new a(g.regName,g.index,0),m=new a(g.regName,g.index,1),y=new a(g.regName,g.index,2),f=new a(g.regName,g.index,3),b=t.getFreeVertexVectorTemp();for(t.addVertexTempUsages(b,1),t.removeVertexTempUsage(u),t.removeVertexTempUsage(g),t.removeVertexTempUsage(b),n+="sub "+u+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="mov "+m+","+u+".y\n",n+="mul "+_+","+m+","+m+"\n",n+="sub "+_+","+t.vertexOneConst+","+_+"\n",n+="sqt "+_+","+_+"\n",n+="mul "+b+".x,"+_+","+t.scaleAndRotateTarget+".y\n",n+="mul "+b+".y,"+m+","+t.scaleAndRotateTarget+".z\n",n+="mul "+b+".z,"+m+","+t.scaleAndRotateTarget+".y\n",n+="mul "+b+".w,"+_+","+t.scaleAndRotateTarget+".z\n",n+="sub "+t.scaleAndRotateTarget+".y,"+b+".x,"+b+".y\n",n+="add "+t.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",n+="abs "+b+".y,"+u+".y\n",n+="sge "+b+".z,"+b+".y,"+t.vertexOneConst+"\n",n+="mul "+b+".x,"+b+".y,"+u+".y\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="dp3 "+m+","+u+".xyz,"+u+".xyz\n",n+="sge "+f+","+t.vertexZeroConst+","+m+"\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="sub "+m+","+t.vertexOneConst+","+f+"\n",n+="mul "+m+","+m+","+u+".x\n",n+="mov "+_+","+u+".z\n",n+="neg "+_+","+_+"\n",n+="sub "+y+","+t.vertexOneConst+","+_+"\n",n+="mul "+y+","+b+".x,"+f+"\n",n+="add "+_+","+_+","+y+"\n",n+="mul "+b+".x,"+_+","+t.scaleAndRotateTarget+".x\n",n+="mul "+b+".y,"+m+","+t.scaleAndRotateTarget+".z\n",n+="mul "+b+".z,"+m+","+t.scaleAndRotateTarget+".x\n",n+="mul "+b+".w,"+_+","+t.scaleAndRotateTarget+".z\n",n+="sub "+t.scaleAndRotateTarget+".x,"+b+".x,"+b+".y\n",n+="add "+t.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",r=0;h>r;r++)n+="sub "+u+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="mov "+m+","+u+".y\n",n+="mul "+_+","+m+","+m+"\n",n+="sub "+_+","+t.vertexOneConst+","+_+"\n",n+="sqt "+_+","+_+"\n",n+="mul "+b+".x,"+_+","+t.rotationRegisters[r]+".y\n",n+="mul "+b+".y,"+m+","+t.rotationRegisters[r]+".z\n",n+="mul "+b+".z,"+m+","+t.rotationRegisters[r]+".y\n",n+="mul "+b+".w,"+_+","+t.rotationRegisters[r]+".z\n",n+="sub "+t.rotationRegisters[r]+".y,"+b+".x,"+b+".y\n",n+="add "+t.rotationRegisters[r]+".z,"+b+".z,"+b+".w\n",n+="abs "+b+".y,"+u+".y\n",n+="sge "+b+".z,"+b+".y,"+t.vertexOneConst+"\n",n+="mul "+b+".x,"+b+".y,"+u+".y\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="dp3 "+m+","+u+".xyz,"+u+".xyz\n",n+="sge "+f+","+t.vertexZeroConst+","+m+"\n",n+="mov "+u+".y,"+t.vertexZeroConst+"\n",n+="nrm "+u+".xyz,"+u+".xyz\n",n+="sub "+m+","+t.vertexOneConst+","+f+"\n",n+="mul "+m+","+m+","+u+".x\n",n+="mov "+_+","+u+".z\n",n+="neg "+_+","+_+"\n",n+="sub "+y+","+t.vertexOneConst+","+_+"\n",n+="mul "+y+","+b+".x,"+f+"\n",n+="add "+_+","+_+","+y+"\n",n+="mul "+b+".x,"+_+","+t.rotationRegisters[r]+".x\n",n+="mul "+b+".y,"+m+","+t.rotationRegisters[r]+".z\n",n+="mul "+b+".z,"+m+","+t.rotationRegisters[r]+".x\n",n+="mul "+b+".w,"+_+","+t.rotationRegisters[r]+".z\n",n+="sub "+t.rotationRegisters[r]+".x,"+b+".x,"+b+".y\n",n+="add "+t.rotationRegisters[r]+".z,"+b+".z,"+b+".w\n"}return n},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.POSITION_VECTOR3D="RotateToPositionVector3D",t}(n);t.exports=h},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState"),h=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleRotationalVelocity",t,4),this._pStateClass=o,this._iRotationalVelocity=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.ROTATIONALVELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);var h=t.getFreeVertexVectorTemp();t.addVertexTempUsages(h,1);var l=new a(h.regName,h.index),p=t.getFreeVertexVectorTemp();p=new a(p.regName,p.index);var d=new a(l.regName,l.index,3),c=new a(p.regName,p.index,3);t.removeVertexTempUsage(r),t.removeVertexTempUsage(n),t.removeVertexTempUsage(h);var u="";u+="mov "+r+".xyz,"+i+".xyz\n",u+="mov "+r+".w,"+t.vertexZeroConst+"\n",u+="mul "+d+","+t.vertexTime+","+i+".w\n",u+="sin "+c+","+d+"\n",u+="cos "+d+","+d+"\n",u+="mul "+l+".xyz,"+c+","+r+".xyz\n",u+="mul "+p+".xyz,"+c+","+r+".xyz\n",u+="neg "+p+".xyz,"+p+".xyz\n",u+="crs "+r+".xyz,"+l+".xyz,"+t.scaleAndRotateTarget+".xyz\n",u+="mul "+n+".xyz,"+d+","+t.scaleAndRotateTarget+".xyz\n",u+="add "+r+".xyz,"+r+".xyz,"+n+".xyz\n",u+="dp3 "+n+".w,"+l+".xyz,"+t.scaleAndRotateTarget+".xyz\n",u+="neg "+r+".w,"+n+".w\n",u+="crs "+l+".xyz,"+r+".xyz,"+p+".xyz\n",u+="mul "+n+".xyzw,"+r+".xyzw,"+d+"\n",u+="add "+l+".xyz,"+l+".xyz,"+n+".xyz\n",u+="mul "+n+".xyz,"+r+".w,"+p+".xyz\n",u+="add "+t.scaleAndRotateTarget+".xyz,"+l+".xyz,"+n+".xyz\n";for(var g=t.rotationRegisters.length,_=0;g>_;_++)u+="mov "+r+".xyz,"+i+".xyz\n",u+="mov "+r+".w,"+t.vertexZeroConst+"\n",u+="mul "+d+","+t.vertexTime+","+i+".w\n",u+="sin "+c+","+d+"\n",u+="cos "+d+","+d+"\n",u+="mul "+l+".xyz,"+c+","+r+".xyz\n",u+="mul "+p+".xyz,"+c+","+r+".xyz\n",u+="neg "+p+".xyz,"+p+".xyz\n",u+="crs "+r+".xyz,"+l+".xyz,"+t.rotationRegisters[_]+".xyz\n",u+="mul "+n+".xyz,"+d+","+t.rotationRegisters[_]+"\n",u+="add "+r+".xyz,"+r+".xyz,"+n+".xyz\n",u+="dp3 "+n+".w,"+l+".xyz,"+t.rotationRegisters[_]+"\n",u+="neg "+r+".w,"+n+".w\n",u+="crs "+l+".xyz,"+r+".xyz,"+p+".xyz\n",u+="mul "+n+".xyzw,"+r+".xyzw,"+d+"\n",u+="add "+l+".xyz,"+l+".xyz,"+n+".xyz\n",u+="mul "+n+".xyz,"+r+".w,"+p+".xyz\n",u+="add "+t.rotationRegisters[_]+","+l+".xyz,"+n+".xyz\n";return u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ROTATIONALVELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(i.length<=0?i.z=1:i.normalize(),this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/i.w},t.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D",t}(n);t.exports=h},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleScaleState"),n=function(e){function t(t,i,r,a,n,o,h){void 0===a&&(a=1),void 0===n&&(n=1),void 0===o&&(o=1),void 0===h&&(h=0),e.call(this,"ParticleScale",t,i&&r?4:i||r?3:2,3),this._pStateClass=s,this._iUsesCycle=i,this._iUsesPhase=r,this._iMinScale=a,this._iMaxScale=n,this._iCycleDuration=o,this._iCyclePhase=h}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="",a=t.getFreeVertexSingleTemp(),n=this._pMode==r.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();return t.setRegisterIndex(this,s.SCALE_INDEX,n.index),this._iUsesCycle&&(i+="mul "+a+","+t.vertexTime+","+n+".z\n",this._iUsesPhase&&(i+="add "+a+","+a+","+n+".w\n"),i+="sin "+a+","+a+"\n"),i+="mul "+a+","+n+".y,"+(this._iUsesCycle?a:t.vertexLife)+"\n",i+="add "+a+","+n+".x,"+a+"\n",i+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.SCALE_VECTOR3D];if(!i)throw new Error("there is no "+t.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){if(this._pOneData[0]=(i.x+i.y)/2,this._pOneData[1]=Math.abs(i.x-i.y)/2,i.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=2*Math.PI/i.z,this._iUsesPhase&&(this._pOneData[3]=i.w*Math.PI/180)}else this._pOneData[0]=i.x,this._pOneData[1]=i.y-i.x},t.SCALE_VECTOR3D="ScaleVector3D",t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleScaleState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState"),h=function(e){function t(t,i,r,n,h,l){if(e.call(this,"ParticleSegmentedColor",s.GLOBAL,0,a.COLOR_PRIORITY),this._pStateClass=o,r>4)throw new Error("the numSegmentPoint must be less or equal 4");this._iUsesMultiplier=t,this._iUsesOffset=i,this._iNumSegmentPoint=r,this._iStartColor=n,this._iEndColor=h,this._iSegmentPoints=l}return i(t,e),t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var a;this._iUsesMultiplier&&(a=t.getFreeVertexVectorTemp(),t.addVertexTempUsages(a,1));var s=t.getFreeVertexVectorTemp();t.addVertexTempUsages(s,1);var n=t.getFreeVertexVectorTemp(),h=new r(n.regName,n.index,0),l=new r(n.regName,n.index,1);this._iUsesMultiplier&&t.removeVertexTempUsage(a),t.removeVertexTempUsage(s);var p=t.getFreeVertexConstant();t.setRegisterIndex(this,o.TIME_DATA_INDEX,p.index);var d,c,u;if(this._iUsesMultiplier)for(c=t.getFreeVertexConstant(),t.setRegisterIndex(this,o.START_MULTIPLIER_INDEX,c.index),u=new Array,d=0;d<this._iNumSegmentPoint+1;d++)u.push(t.getFreeVertexConstant());var g,_;if(this._iUsesOffset)for(g=t.getFreeVertexConstant(),t.setRegisterIndex(this,o.START_OFFSET_INDEX,g.index),_=new Array,d=0;d<this._iNumSegmentPoint+1;d++)_.push(t.getFreeVertexConstant());for(this._iUsesMultiplier&&(i+="mov "+a+","+c+"\n"),this._iUsesOffset&&(i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+g+"\n"),d=0;d<this._iNumSegmentPoint;d++){switch(d){case 0:i+="min "+l+","+t.vertexLife+","+p+".x\n";break;case 1:i+="sub "+h+","+t.vertexLife+","+p+".x\n",i+="max "+l+","+h+","+t.vertexZeroConst+"\n",i+="min "+l+","+l+","+p+".y\n";break;case 2:i+="sub "+h+","+h+","+p+".y\n",i+="max "+l+","+h+","+t.vertexZeroConst+"\n",i+="min "+l+","+l+","+p+".z\n";break;case 3:i+="sub "+h+","+h+","+p+".z\n",i+="max "+l+","+h+","+t.vertexZeroConst+"\n",i+="min "+l+","+l+","+p+".w\n"}this._iUsesMultiplier&&(i+="mul "+s+","+l+","+u[d]+"\n",i+="add "+a+","+a+","+s+"\n"),this._iUsesOffset&&(i+="mul "+s+","+l+","+_[d]+"\n",i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+s+"\n")}if(0==this._iNumSegmentPoint)l=t.vertexLife;else{switch(this._iNumSegmentPoint){case 1:i+="sub "+h+","+t.vertexLife+","+p+".x\n";break;case 2:i+="sub "+h+","+h+","+p+".y\n";break;case 3:i+="sub "+h+","+h+","+p+".z\n";break;case 4:i+="sub "+h+","+h+","+p+".w\n"}i+="max "+l+","+h+","+t.vertexZeroConst+"\n"}this._iUsesMultiplier&&(i+="mul "+s+","+l+","+u[this._iNumSegmentPoint]+"\n",i+="add "+a+","+a+","+s+"\n",i+="mul "+t.colorMulTarget+","+t.colorMulTarget+","+a+"\n"),this._iUsesOffset&&(i+="mul "+s+","+l+","+_[this._iNumSegmentPoint]+"\n",i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+s+"\n")}return i},t}(n);t.exports=h},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState"),h=function(e){function t(t,i,r,s,n,h,l,p){void 0===s&&(s=1),void 0===n&&(n=1),void 0===h&&(h=1),void 0===l&&(l=0),void 0===p&&(p=Number.MAX_VALUE),e.call(this,"ParticleSpriteSheet",t,i?r?3:2:1,a.POST_PRIORITY+1),this._pStateClass=o,this._iUsesCycle=i,this._iUsesPhase=r,this._iNumColumns=s,this._iNumRows=n,this._iCyclePhase=l,this._iCycleDuration=h,this._iTotalFrames=Math.min(p,s*n)}return i(t,e),Object.defineProperty(t.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFrames",{get:function(){return this._iTotalFrames
},enumerable:!0,configurable:!0}),t.prototype.getAGALUVCode=function(e,t){var i=t.getFreeVertexConstant(),a=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.UV_INDEX_0,i.index),t.setRegisterIndex(this,o.UV_INDEX_1,a.index);var n=new r(i.regName,i.index,0),h=new r(i.regName,i.index,1),l=new r(i.regName,i.index,2),p=new r(a.regName,a.index,0),d=new r(a.regName,a.index,1),c=new r(a.regName,a.index,2),u=t.getFreeVertexVectorTemp(),g=new r(u.regName,u.index,0),_=new r(u.regName,u.index,1);u=new r(u.regName,u.index,2);var m=new r(u.regName,u.index,3),y=new r(t.uvTarget.regName,t.uvTarget.index,0),f=new r(t.uvTarget.regName,t.uvTarget.index,1),b="";return b+="mul "+y+","+y+","+h+"\n",this._iNumRows>1&&(b+="mul "+f+","+f+","+l+"\n"),this._iUsesCycle?(b+=this._iUsesPhase?"add "+g+","+t.vertexTime+","+c+"\n":"mov "+g+","+t.vertexTime+"\n",b+="div "+g+","+g+","+d+"\n",b+="frc "+g+","+g+"\n",b+="mul "+g+","+g+","+d+"\n",b+="mul "+u+","+g+","+p+"\n"):b+="mul "+u.toString()+","+t.vertexLife+","+n+"\n",this._iNumRows>1&&(b+="frc "+m+","+u+"\n",b+="sub "+_+","+u+","+m+"\n",b+="mul "+_+","+_+","+l+"\n",b+="add "+f+","+f+","+_+"\n"),b+="div "+m+","+u+","+h+"\n",b+="frc "+u+","+m+"\n",b+="sub "+m+","+m+","+u+"\n",b+="mul "+u+","+m+","+h+"\n",this._iNumRows>1&&(b+="frc "+u+","+u+"\n"),b+="add "+y+","+y+","+u+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=!0},t.prototype._iGeneratePropertyOfOneParticle=function(e){if(this._iUsesCycle){var i=e[t.UV_VECTOR3D];if(!i)throw new Error("there is no "+t.UV_VECTOR3D+" in param!");if(i.x<=0)throw new Error("the cycle duration must be greater than zero");var r=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=r/i.x,this._pOneData[1]=i.x,this._iUsesPhase&&(this._pOneData[2]=i.y)}},t.UV_VECTOR3D="UVVector3D",t}(n);t.exports=h},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleTimeState"),n=function(e){function t(t,i,a){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),this._pStateClass=s,this._iUsesDuration=t,this._iUsesLooping=i,this._iUsesDelay=a,e.call(this,"ParticleTime",r.LOCAL_STATIC,4,0)}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexAttribute();t.setRegisterIndex(this,s.TIME_STREAM_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,s.TIME_CONSTANT_INDEX,r.index);var a="";a+="sub "+t.vertexTime+","+r+","+i+".x\n";var n=t.getFreeVertexSingleTemp();if(a+="sge "+n+","+t.vertexTime+","+t.vertexZeroConst+"\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+n+"\n",this._iUsesDuration)if(this._iUsesLooping){var o=t.getFreeVertexSingleTemp();this._iUsesDelay?(a+="div "+o+","+t.vertexTime+","+i+".z\n",a+="frc "+o+","+o+"\n",a+="mul "+t.vertexTime+","+o+","+i+".z\n",a+="slt "+o+","+t.vertexTime+","+i+".y\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+o+"\n"):(a+="mul "+o+","+t.vertexTime+","+i+".w\n",a+="frc "+o+","+o+"\n",a+="mul "+t.vertexTime+","+o+","+i+".y\n")}else{var h=t.getFreeVertexSingleTemp();a+="sge "+h+","+i+".y,"+t.vertexTime+"\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+h+"\n"}return a+="mul "+t.vertexLife+","+t.vertexTime+","+i+".w\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){this._pOneData[0]=e.startTime,this._pOneData[1]=e.duration,this._pOneData[2]=e.delay+e.duration,this._pOneData[3]=1/e.duration},t}(a);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleTimeState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleUVNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),h=e("awayjs-renderergl/lib/animators/states/ParticleUVState"),l=function(e){function t(t,i,r,a){void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a="x"),e.call(this,"ParticleUV",n.GLOBAL,4,s.POST_PRIORITY+1),this._pStateClass=h,this._cycle=i,this._scale=r,this._axis=a,this.updateUVData()}return i(t,e),Object.defineProperty(t.prototype,"cycle",{get:function(){return this._cycle},set:function(e){this._cycle=e,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"axis",{get:function(){return this._axis},set:function(e){this._axis=e},enumerable:!0,configurable:!0}),t.prototype.getAGALUVCode=function(e,t){var i="",r=t.getFreeVertexConstant();t.setRegisterIndex(this,h.UV_INDEX,r.index);var s="x"==this._axis?0:"y"==this._axis?1:2,n=new a(t.uvTarget.regName,t.uvTarget.index,s),o=t.getFreeVertexSingleTemp();return 1!=this._scale&&(i+="mul "+n+","+n+","+r+".y\n"),i+="mul "+o+","+t.vertexTime+","+r+".x\n",i+="sin "+o+","+o+"\n",i+="add "+n+","+n+","+o+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype.updateUVData=function(){this._iUvData=new r(2*Math.PI/this._cycle,this._scale,0,0)},t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=!0},t.U_AXIS="x",t.V_AXIS="y",t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleUVState":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleVelocityState"),o=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleVelocity",t,3),this._pStateClass=n,this._iVelocity=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.VELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp(),s="";return s+="mul "+r+","+t.vertexTime+","+i+"\n",s+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n",t.needVelocity&&(s+="add "+t.velocityTarget+".xyz,"+i+".xyz,"+t.velocityTarget+".xyz\n"),s},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.VELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.VELOCITY_VECTOR3D="VelocityVector3D",t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleVelocityState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonClipState"),s=function(e){function t(){e.call(this),this._frames=new Array,this.highQuality=!1,this._pStateClass=a}return i(t,e),Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),t.prototype.addFrame=function(e,t){this._frames.push(e),this._pDurations.push(t),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,r,a=this._pNumFrames-1;a--;)this._pTotalDuration+=this._pDurations[a],t=this._frames[a].jointPoses[0].translation,i=this._frames[a+1].jointPoses[0].translation,r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z;(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._frames[0].jointPoses[0].translation,i=this._frames[1].jointPoses[0].translation,r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonClipState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonDifferenceState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonDirectionalState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState"),s=function(e){function t(){e.call(this),this._iInputs=new Array,this._pStateClass=a}return i(t,e),Object.defineProperty(t.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:!0,configurable:!0}),t.prototype.getInputIndex=function(e){return this._iInputs.indexOf(e)},t.prototype.getInputAt=function(e){return this._iInputs[e]},t.prototype.addInput=function(e){this._iInputs[this._numInputs++]=e},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":void 0}],"awayjs-renderergl/lib/animators/nodes/VertexClipNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase"),s=e("awayjs-renderergl/lib/animators/states/VertexClipState"),n=function(e){function t(){e.call(this),this._frames=new Array,this._translations=new Array,this._pStateClass=s}return i(t,e),Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),t.prototype.addFrame=function(e,t,i){void 0===i&&(i=null),this._frames.push(e),this._pDurations.push(t),this._translations.push(i||new r),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,r,a=this._pNumFrames-1;a--;)this._pTotalDuration+=this._pDurations[a],t=this._translations[a],i=this._translations[a+1],r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z;this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._translations[0],i=this._translations[1],r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z)},t}(a);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":void 0,"awayjs-renderergl/lib/animators/states/VertexClipState":void 0}],"awayjs-renderergl/lib/animators/states/AnimationClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),a=e("awayjs-renderergl/lib/events/AnimationStateEvent"),s=function(e){function t(t,i){e.call(this,t,i),this._pFramesDirty=!0,this._animationClipNode=i}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pBlendWeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pCurrentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pNextFrame},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this._animationClipNode.looping||(e>this._pStartTime+this._animationClipNode.totalDuration?e=this._pStartTime+this._animationClipNode.totalDuration:e<this._pStartTime&&(e=this._pStartTime)),this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},t.prototype.phase=function(e){var t=e*this._animationClipNode.totalDuration+this._pStartTime;this._pTime!=t-this._pStartTime&&this._pUpdateTime(t)},t.prototype._pUpdateTime=function(t){this._pFramesDirty=!0,this._pTimeDir=t-this._pStartTime>this._pTime?1:-1,e.prototype._pUpdateTime.call(this,t)},t.prototype._pUpdateFrames=function(){this._pFramesDirty=!1;var e=this._animationClipNode.looping,t=this._animationClipNode.totalDuration,i=this._animationClipNode.lastFrame,r=this._pTime;if(e&&(r>=t||0>r)&&(r%=t,0>r&&(r+=t)),!e&&r>=t)this.notifyPlaybackComplete(),this._pCurrentFrame=i,this._pNextFrame=i,this._pBlendWeight=0;else if(!e&&0>=r)this._pCurrentFrame=0,this._pNextFrame=0,this._pBlendWeight=0;else if(this._animationClipNode.fixedFrameRate){var a=r/t*i;this._pCurrentFrame=Math.floor(a),this._pBlendWeight=a-this._pCurrentFrame,this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0,this._pNextFrame=0;var s,n=0,o=this._animationClipNode.durations;do s=n,n+=o[this._pNextFrame],this._pCurrentFrame=this._pNextFrame++;while(r>n);this._pCurrentFrame==i&&(this._pCurrentFrame=0,this._pNextFrame=1),this._pBlendWeight=(r-s)/o[this._pCurrentFrame]}},t.prototype.notifyPlaybackComplete=function(){null==this._animationStatePlaybackComplete&&(this._animationStatePlaybackComplete=new a(a.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode)),this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0}],"awayjs-renderergl/lib/animators/states/AnimationStateBase":[function(e,t){var i=e("awayjs-core/lib/geom/Vector3D"),r=function(){function e(e,t){this._pRootDelta=new i,this._pPositionDeltaDirty=!0,this._pStartTime=0,this._pAnimator=e,this._pAnimationNode=t}return Object.defineProperty(e.prototype,"positionDelta",{get:function(){return this._pPositionDeltaDirty&&this._pUpdatePositionDelta(),this._pRootDelta},enumerable:!0,configurable:!0}),e.prototype.offset=function(e){this._pStartTime=e,this._pPositionDeltaDirty=!0},e.prototype.update=function(e){this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},e.prototype.phase=function(){},e.prototype._pUpdateTime=function(e){this._pTime=e-this._pStartTime,this._pPositionDeltaDirty=!0},e.prototype._pUpdatePositionDelta=function(){},e}();t.exports=r},{"awayjs-core/lib/geom/Vector3D":void 0}],"awayjs-renderergl/lib/animators/states/IAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/IVertexAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleAccelerationNode=i,this._acceleration=this._particleAccelerationNode._acceleration,this.updateAccelerationData()}return i(t,e),Object.defineProperty(t.prototype,"acceleration",{get:function(){return this._acceleration},set:function(e){this._acceleration.x=e.x,this._acceleration.y=e.y,this._acceleration.z=e.z,this.updateAccelerationData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){var o=n.getRegisterIndex(this._pAnimationNode,t.ACCELERATION_INDEX);this._particleAccelerationNode.mode==s.LOCAL_STATIC?r.activateVertexBuffer(o,this._particleAccelerationNode._iDataOffset,e,a.FLOAT_3):n.setVertexConst(o,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)},t.prototype.updateAccelerationData=function(){this._particleAccelerationNode.mode==s.GLOBAL&&(this._halfAcceleration=new r(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2))},t.ACCELERATION_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleBezierCurveNode=i,this._controlPoint=this._particleBezierCurveNode._iControlPoint,this._endPoint=this._particleBezierCurveNode._iEndPoint}return i(t,e),Object.defineProperty(t.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(e){this._controlPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endPoint",{get:function(){return this._endPoint},set:function(e){this._endPoint=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,s,n){var o=n.getRegisterIndex(this._pAnimationNode,t.BEZIER_CONTROL_INDEX),h=n.getRegisterIndex(this._pAnimationNode,t.BEZIER_END_INDEX);this._particleBezierCurveNode.mode==a.LOCAL_STATIC?(s.activateVertexBuffer(o,this._particleBezierCurveNode._iDataOffset,e,r.FLOAT_3),s.activateVertexBuffer(h,this._particleBezierCurveNode._iDataOffset+3,e,r.FLOAT_3)):(n.setVertexConst(o,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z),n.setVertexConst(h,this._endPoint.x,this._endPoint.y,this._endPoint.z))},t.BEZIER_CONTROL_INDEX=0,t.BEZIER_END_INDEX=1,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleBillboardState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/MathConsts"),a=e("awayjs-core/lib/geom/Matrix3D"),s=e("awayjs-core/lib/geom/Orientation3D"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._matrix=new a,this._billboardAxis=i._iBillboardAxis}return i(t,e),t.prototype.setRenderState=function(e,i,a,n,o){var h;if(this._billboardAxis){var l=i.sourceEntity.sceneTransform.position,p=o.sceneTransform.position.subtract(l),d=p.crossProduct(this._billboardAxis);d.normalize(),p=this.billboardAxis.crossProduct(d),p.normalize(),this._matrix.copyFrom(i.sourceEntity.sceneTransform),h=this._matrix.decompose(s.AXIS_ANGLE),this._matrix.copyColumnFrom(0,d),this._matrix.copyColumnFrom(1,this.billboardAxis),this._matrix.copyColumnFrom(2,p),this._matrix.copyColumnFrom(3,l),this._matrix.appendRotation(-h[1].w*r.RADIANS_TO_DEGREES,h[1])}else this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(o.inverseSceneTransform),h=this._matrix.decompose(s.AXIS_ANGLE),this._matrix.identity(),this._matrix.appendRotation(-h[1].w*r.RADIANS_TO_DEGREES,h[1]);n.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)},Object.defineProperty(t.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(e){this.billboardAxis=e?e.clone():null,this.billboardAxis&&this.billboardAxis.normalize()},enumerable:!0,configurable:!0}),t.MATRIX_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/MathConsts":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Orientation3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleColorNode=i,this._usesMultiplier=this._particleColorNode._iUsesMultiplier,this._usesOffset=this._particleColorNode._iUsesOffset,this._usesCycle=this._particleColorNode._iUsesCycle,this._usesPhase=this._particleColorNode._iUsesPhase,this._startColor=this._particleColorNode._iStartColor,this._endColor=this._particleColorNode._iEndColor,this._cycleDuration=this._particleColorNode._iCycleDuration,this._cyclePhase=this._particleColorNode._iCyclePhase,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateColorData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){if(n.needFragmentAnimation){var o=this._particleColorNode._iDataOffset;this._usesCycle&&n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w),this._usesMultiplier&&(this._particleColorNode.mode==s.LOCAL_STATIC?(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),o,e,a.FLOAT_4),o+=4,r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),o,e,a.FLOAT_4),o+=4):(n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w),n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w))),this._usesOffset&&(this._particleColorNode.mode==s.LOCAL_STATIC?(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),o,e,a.FLOAT_4),o+=4,r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),o,e,a.FLOAT_4),o+=4):(n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w),n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)))}},t.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new r(2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}this._particleColorNode.mode==s.GLOBAL&&(this._usesCycle?(this._usesMultiplier&&(this._startMultiplierData=new r((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2),this._deltaMultiplierData=new r((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)),this._usesOffset&&(this._startOffsetData=new r((this._startColor.redOffset+this._endColor.redOffset)/510,(this._startColor.greenOffset+this._endColor.greenOffset)/510,(this._startColor.blueOffset+this._endColor.blueOffset)/510,(this._startColor.alphaOffset+this._endColor.alphaOffset)/510),this._deltaOffsetData=new r((this._endColor.redOffset-this._startColor.redOffset)/510,(this._endColor.greenOffset-this._startColor.greenOffset)/510,(this._endColor.blueOffset-this._startColor.blueOffset)/510,(this._endColor.alphaOffset-this._startColor.alphaOffset)/510))):(this._usesMultiplier&&(this._startMultiplierData=new r(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),this._deltaMultiplierData=new r(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)),this._usesOffset&&(this._startOffsetData=new r(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),this._deltaOffsetData=new r((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255))))},t.START_MULTIPLIER_INDEX=0,t.DELTA_MULTIPLIER_INDEX=1,t.START_OFFSET_INDEX=2,t.DELTA_OFFSET_INDEX=3,t.CYCLE_INDEX=4,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleFollowState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/MathConsts"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i,!0),this._targetPos=new a,this._targetEuler=new a,this._temp=new a,this._particleFollowNode=i,this._smooth=i._iSmooth}return i(t,e),Object.defineProperty(t.prototype,"followTarget",{get:function(){return this._followTarget},set:function(e){this._followTarget=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smooth",{get:function(){return this._smooth},set:function(e){this._smooth=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,a,n){this._followTarget&&(this._particleFollowNode._iUsesPosition&&(this._targetPos.x=this._followTarget.transform.position.x/i.sourceEntity.scaleX,this._targetPos.y=this._followTarget.transform.position.y/i.sourceEntity.scaleY,this._targetPos.z=this._followTarget.transform.position.z/i.sourceEntity.scaleZ),this._particleFollowNode._iUsesRotation&&(this._targetEuler.x=this._followTarget.rotationX,this._targetEuler.y=this._followTarget.rotationY,this._targetEuler.z=this._followTarget.rotationZ,this._targetEuler.scaleBy(r.DEGREES_TO_RADIANS))),this._prePos||(this._prePos=this._targetPos.clone()),this._preEuler||(this._preEuler=this._targetEuler.clone());var o=this._pTime/1e3,h=a.previousTime,l=o-h,p=h!=o;this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation?(p&&this.processPositionAndRotation(o,l,a),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,e,s.FLOAT_3)):this._particleFollowNode._iUsesPosition?(p&&this.processPosition(o,l,a),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)):this._particleFollowNode._iUsesRotation&&(p&&this.precessRotation(o,l,a),a.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)),this._prePos.copyFrom(this._targetPos),this._targetEuler.copyFrom(this._targetEuler),a.previousTime=o
},t.prototype.processPosition=function(e,t,i){var r,a,s=i.animationParticles,n=i.vertexData,o=!1,h=s.length;this._smooth?(a=this._prePos.subtract(this._targetPos),a.scaleBy(1/t)):r=this._targetPos;for(var l=0;h>l;l++){var p=(e-s[l].startTime)/s[l].totalTime,d=(p-Math.floor(p))*s[l].totalTime;if(0>=d-t){var c=s[l].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(a),this._temp.scaleBy(d),r=this._targetPos.add(this._temp)),n[c]!=r.x||n[c+1]!=r.y||n[c+2]!=r.z){o=!0;for(var u=0;u<s[l].numVertices;u++)n[c++]=r.x,n[c++]=r.y,n[c++]=r.z}}}o&&i.invalidateBuffer()},t.prototype.precessRotation=function(e,t,i){var r,a,s=i.animationParticles,n=i.vertexData,o=!1,h=s.length;this._smooth?(a=this._preEuler.subtract(this._targetEuler),a.scaleBy(1/t)):r=this._targetEuler;for(var l=0;h>l;l++){var p=(e-s[l].startTime)/s[l].totalTime,d=(p-Math.floor(p))*s[l].totalTime;if(0>=d-t){var c=s[l].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(a),this._temp.scaleBy(d),r=this._targetEuler.add(this._temp)),n[c]!=r.x||n[c+1]!=r.y||n[c+2]!=r.z){o=!0;for(var u=0;u<s[l].numVertices;u++)n[c++]=r.x,n[c++]=r.y,n[c++]=r.z}}}o&&i.invalidateBuffer()},t.prototype.processPositionAndRotation=function(e,t,i){var r,a,s,n,o=i.animationParticles,h=i.vertexData,l=!1,p=o.length;this._smooth?(s=this._prePos.subtract(this._targetPos),s.scaleBy(1/t),n=this._preEuler.subtract(this._targetEuler),n.scaleBy(1/t)):(r=this._targetPos,a=this._targetEuler);for(var d=0;p>d;d++){var c=(e-o[d].startTime)/o[d].totalTime,u=(c-Math.floor(c))*o[d].totalTime;if(0>=u-t){var g=o[d].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(s),this._temp.scaleBy(u),r=this._targetPos.add(this._temp),this._temp.copyFrom(n),this._temp.scaleBy(u),a=this._targetEuler.add(this._temp)),h[g]!=r.x||h[g+1]!=r.y||h[g+2]!=r.z||h[g+3]!=a.x||h[g+4]!=a.y||h[g+5]!=a.z){l=!0;for(var _=0;_<o[d].numVertices;_++)h[g++]=r.x,h[g++]=r.y,h[g++]=r.z,h[g++]=a.x,h[g++]=a.y,h[g++]=a.z}}}l&&i.invalidateBuffer()},t.FOLLOW_POSITION_INDEX=0,t.FOLLOW_ROTATION_INDEX=1,t}(n);t.exports=o},{"awayjs-core/lib/geom/MathConsts":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleInitialColorNode=i,this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._initialColor=i._iInitialColor,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"initialColor",{get:function(){return this._initialColor},set:function(e){this._initialColor=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n,o){if(i=i,o=o,n.needFragmentAnimation)if(this._particleInitialColorNode.mode==s.LOCAL_STATIC){var h=this._particleInitialColorNode._iDataOffset;this._usesMultiplier&&(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),h,e,a.FLOAT_4),h+=4),this._usesOffset&&r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),h,e,a.FLOAT_4)}else this._usesMultiplier&&n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w),this._usesOffset&&n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)},t.prototype.updateColorData=function(){this._particleInitialColorNode.mode==s.GLOBAL&&(this._usesMultiplier&&(this._multiplierData=new r(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier)),this._usesOffset&&(this._offsetData=new r(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)))},t.MULTIPLIER_INDEX=0,t.OFFSET_INDEX=1,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleOrbitState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),n=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),h=function(e){function t(t,i){e.call(this,t,i),this._particleOrbitNode=i,this._usesEulers=this._particleOrbitNode._iUsesEulers,this._usesCycle=this._particleOrbitNode._iUsesCycle,this._usesPhase=this._particleOrbitNode._iUsesPhase,this._eulers=this._particleOrbitNode._iEulers,this._radius=this._particleOrbitNode._iRadius,this._cycleDuration=this._particleOrbitNode._iCycleDuration,this._cyclePhase=this._particleOrbitNode._iCyclePhase,this.updateOrbitData()}return i(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eulers",{get:function(){return this._eulers},set:function(e){this._eulers=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,a){var o=a.getRegisterIndex(this._pAnimationNode,t.ORBIT_INDEX);this._particleOrbitNode.mode==n.LOCAL_STATIC?this._usesPhase?r.activateVertexBuffer(o,this._particleOrbitNode._iDataOffset,e,s.FLOAT_4):r.activateVertexBuffer(o,this._particleOrbitNode._iDataOffset,e,s.FLOAT_3):a.setVertexConst(o,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w),this._usesEulers&&a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.EULERS_INDEX),this._eulersMatrix)},t.prototype.updateOrbitData=function(){if(this._usesEulers&&(this._eulersMatrix=new r,this._eulersMatrix.appendRotation(this._eulers.x,a.X_AXIS),this._eulersMatrix.appendRotation(this._eulers.y,a.Y_AXIS),this._eulersMatrix.appendRotation(this._eulers.z,a.Z_AXIS)),this._particleOrbitNode.mode==n.GLOBAL)if(this._orbitData=new a(this._radius,0,this._radius*Math.PI*2,this._cyclePhase*Math.PI/180),this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=2*Math.PI/this._cycleDuration}else this._orbitData.y=2*Math.PI},t.ORBIT_INDEX=0,t.EULERS_INDEX=1,t}(o);t.exports=h},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleOscillatorNode=i,this._oscillator=this._particleOscillatorNode._iOscillator,this.updateOscillatorData()}return i(t,e),Object.defineProperty(t.prototype,"oscillator",{get:function(){return this._oscillator},set:function(e){this._oscillator=e,this.updateOscillatorData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){var o=n.getRegisterIndex(this._pAnimationNode,t.OSCILLATOR_INDEX);this._particleOscillatorNode.mode==s.LOCAL_STATIC?r.activateVertexBuffer(o,this._particleOscillatorNode._iDataOffset,e,a.FLOAT_4):n.setVertexConst(o,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)},t.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==s.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");null==this._oscillatorData&&(this._oscillatorData=new r),this._oscillatorData.x=this._oscillator.x,this._oscillatorData.y=this._oscillator.y,this._oscillatorData.z=this._oscillator.z,this._oscillatorData.w=2*Math.PI/this._oscillator.w}},t.OSCILLATOR_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticlePositionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particlePositionNode=i,this._position=this._particlePositionNode._iPosition}return i(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.getPositions=function(){return this._pDynamicProperties},t.prototype.setPositions=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,s,n){this._particlePositionNode.mode!=a.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[s._iUniqueId]||this._pUpdateDynamicProperties(s);var o=n.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);this._particlePositionNode.mode==a.GLOBAL?n.setVertexConst(o,this._position.x,this._position.y,this._position.z):s.activateVertexBuffer(o,this._particlePositionNode._iDataOffset,e,r.FLOAT_3)},t.POSITION_INDEX=0,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),s=function(e){function t(t,i){e.call(this,t,i),this._matrix=new r}return i(t,e),t.prototype.setRenderState=function(e,i,r,a,s){a.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(s.inverseSceneTransform),a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix))},t.MATRIX_INDEX=0,t}(a);t.exports=s},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._matrix=new r,this._particleRotateToPositionNode=i,this._position=this._particleRotateToPositionNode._iPosition}return i(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n,o){var h=n.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);n.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(o.inverseSceneTransform),n.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)),this._particleRotateToPositionNode.mode==s.GLOBAL?(this._offset=i.sourceEntity.inverseSceneTransform.transformVector(this._position),n.setVertexConst(h,this._offset.x,this._offset.y,this._offset.z)):r.activateVertexBuffer(h,this._particleRotateToPositionNode._iDataOffset,e,a.FLOAT_3)},t.MATRIX_INDEX=0,t.POSITION_INDEX=1,t}(n);t.exports=o},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleRotationalVelocityNode=i,this._rotationalVelocity=this._particleRotationalVelocityNode._iRotationalVelocity,this.updateRotationalVelocityData()}return i(t,e),Object.defineProperty(t.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(e){this._rotationalVelocity=e,this.updateRotationalVelocityData()},enumerable:!0,configurable:!0}),t.prototype.getRotationalVelocities=function(){return this._pDynamicProperties},t.prototype.setRotationalVelocities=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,r,n){this._particleRotationalVelocityNode.mode!=s.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var o=n.getRegisterIndex(this._pAnimationNode,t.ROTATIONALVELOCITY_INDEX);this._particleRotationalVelocityNode.mode==s.GLOBAL?n.setVertexConst(o,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w):r.activateVertexBuffer(o,this._particleRotationalVelocityNode._iDataOffset,e,a.FLOAT_4)},t.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==s.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var e=this._rotationalVelocity.clone();e.length<=0?e.z=1:e.normalize(),this._rotationalVelocityData=new r(e.x,e.y,e.z,Math.PI/e.w)}},t.ROTATIONALVELOCITY_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleScaleState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleScaleNode=i,this._usesCycle=this._particleScaleNode._iUsesCycle,this._usesPhase=this._particleScaleNode._iUsesPhase,this._minScale=this._particleScaleNode._iMinScale,this._maxScale=this._particleScaleNode._iMaxScale,this._cycleDuration=this._particleScaleNode._iCycleDuration,this._cyclePhase=this._particleScaleNode._iCyclePhase,this.updateScaleData()}return i(t,e),Object.defineProperty(t.prototype,"minScale",{get:function(){return this._minScale},set:function(e){this._minScale=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateScaleData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,n){var o=n.getRegisterIndex(this._pAnimationNode,t.SCALE_INDEX);this._particleScaleNode.mode==s.LOCAL_STATIC?this._usesCycle?this._usesPhase?r.activateVertexBuffer(o,this._particleScaleNode._iDataOffset,e,a.FLOAT_4):r.activateVertexBuffer(o,this._particleScaleNode._iDataOffset,e,a.FLOAT_3):r.activateVertexBuffer(o,this._particleScaleNode._iDataOffset,e,a.FLOAT_2):n.setVertexConst(o,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)},t.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==s.GLOBAL)if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new r((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new r(this._minScale,this._maxScale-this._minScale,0,0)},t.SCALE_INDEX=0,t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),a=function(e){function t(t,i){e.call(this,t,i),this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._startColor=i._iStartColor,this._endColor=i._iEndColor,this._segmentPoints=i._iSegmentPoints,this._numSegmentPoint=i._iNumSegmentPoint,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(e){this._segmentPoints=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,a){a.needFragmentAnimation&&(this._numSegmentPoint>0&&a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]),this._usesMultiplier&&a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._multiplierData),this._usesOffset&&a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._offsetData))},t.prototype.updateColorData=function(){this._timeLifeData=new Array,this._multiplierData=new Array,this._offsetData=new Array;var e;for(e=0;e<this._numSegmentPoint;e++)this._timeLifeData.push(0==e?this._segmentPoints[e].life:this._segmentPoints[e].life-this._segmentPoints[e-1].life);if(this._timeLifeData.push(0==this._numSegmentPoint?1:1-this._segmentPoints[e-1].life),this._usesMultiplier){for(this._multiplierData.push(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),e=0;e<this._numSegmentPoint;e++)0==e?this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[e]):this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e]);0==this._numSegmentPoint?this._multiplierData.push(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier):this._multiplierData.push((this._endColor.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._endColor.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._endColor.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._endColor.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e])}if(this._usesOffset){for(this._offsetData.push(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),e=0;e<this._numSegmentPoint;e++)0==e?this._offsetData.push((this._segmentPoints[e].color.redOffset-this._startColor.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[e]/255):this._offsetData.push((this._segmentPoints[e].color.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255);0==this._numSegmentPoint?this._offsetData.push((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255):this._offsetData.push((this._endColor.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._endColor.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._endColor.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._endColor.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255)}this._timeLifeData.length=4},t.START_MULTIPLIER_INDEX=0,t.START_OFFSET_INDEX=1,t.TIME_DATA_INDEX=2,t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleSpriteSheetNode=i,this._usesCycle=this._particleSpriteSheetNode._iUsesCycle,this._usesPhase=this._particleSpriteSheetNode._iUsesCycle,this._totalFrames=this._particleSpriteSheetNode._iTotalFrames,this._numColumns=this._particleSpriteSheetNode._iNumColumns,this._numRows=this._particleSpriteSheetNode._iNumRows,this._cycleDuration=this._particleSpriteSheetNode._iCycleDuration,this._cyclePhase=this._particleSpriteSheetNode._iCyclePhase,this.updateSpriteSheetData()}return i(t,e),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,s,n){if(n.needUVAnimation&&(n.setVertexConst(n.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]),this._usesCycle)){var o=n.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_1);this._particleSpriteSheetNode.mode==a.LOCAL_STATIC?this._usesPhase?s.activateVertexBuffer(o,this._particleSpriteSheetNode._iDataOffset,e,r.FLOAT_3):s.activateVertexBuffer(o,this._particleSpriteSheetNode._iDataOffset,e,r.FLOAT_2):n.setVertexConst(o,this._spriteSheetData[4],this._spriteSheetData[5])}},t.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var e=this._totalFrames/this._numColumns;if(this._spriteSheetData[0]=e,this._spriteSheetData[1]=1/this._numColumns,this._spriteSheetData[2]=1/this._numRows,this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=e/this._cycleDuration,this._spriteSheetData[5]=this._cycleDuration,this._usesPhase&&(this._spriteSheetData[6]=this._cyclePhase)}},t.UV_INDEX_0=0,t.UV_INDEX_1=1,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleStateBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),a=function(e){function t(t,i,r){void 0===r&&(r=!1),e.call(this,t,i),this._pDynamicProperties=new Array,this._pDynamicPropertiesDirty=new Object,this._particleNode=i,this._pNeedUpdateTime=r}return i(t,e),Object.defineProperty(t.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(){},t.prototype._pUpdateDynamicProperties=function(e){this._pDynamicPropertiesDirty[e._iUniqueId]=!0;for(var t,i,r,a,s,n=e.animationParticles,o=e.vertexData,h=e.totalLenOfOneVertex,l=this._particleNode.dataLength,p=this._particleNode._iDataOffset,d=this._pDynamicProperties.length,c=0,u=0,g=0;d>c;){for(;d>u&&(s=n[u]).index==c;){for(a=this._pDynamicProperties[c],t=s.numVertices*h,i=s.startVertexIndex*h+p,g=0;t>g;g+=h)for(r=i+g,g=0;t>g;g+=h)r=i+g,o[r++]=a.x,o[r++]=a.y,o[r++]=a.z,4==l&&(o[r++]=a.w);u++}c++}e.invalidateBuffer()},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleTimeState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),s=function(e){function t(t,i){e.call(this,t,i,!0),this._particleTimeNode=i}return i(t,e),t.prototype.setRenderState=function(e,i,a,s){a.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,e,r.FLOAT_4);var n=this._pTime/1e3;s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,t.TIME_CONSTANT_INDEX),n,n,n,n)},t.TIME_STREAM_INDEX=0,t.TIME_CONSTANT_INDEX=1,t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleUVState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),a=function(e){function t(t,i){e.call(this,t,i),this._particleUVNode=i}return i(t,e),t.prototype.setRenderState=function(e,i,r,a){if(a.needUVAnimation){var s=a.getRegisterIndex(this._pAnimationNode,t.UV_INDEX),n=this._particleUVNode._iUvData;a.setVertexConst(s,n.x,n.y)}},t.UV_INDEX=0,t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleVelocityState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleVelocityNode=i,this._velocity=this._particleVelocityNode._iVelocity}return i(t,e),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity=e},enumerable:!0,configurable:!0}),t.prototype.getVelocities=function(){return this._pDynamicProperties},t.prototype.setVelocities=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,s,n){this._particleVelocityNode.mode!=a.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[s._iUniqueId]||this._pUpdateDynamicProperties(s);var o=n.getRegisterIndex(this._pAnimationNode,t.VELOCITY_INDEX);this._particleVelocityNode.mode==a.GLOBAL?n.setVertexConst(o,this._velocity.x,this._velocity.y,this._velocity.z):s.activateVertexBuffer(o,this._particleVelocityNode._iDataOffset,e,r.FLOAT_3)
},t.VELOCITY_INDEX=0,t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._blendWeight=0,this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=i,this._inputA=t.getAnimationState(this._skeletonAnimationNode.inputA),this._inputB=t.getAnimationState(this._skeletonAnimationNode.inputB)}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(e),this._inputB.phase(e)},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e=this._inputA.positionDelta,t=this._inputB.positionDelta;this._pRootDelta.x=e.x+this._blendWeight*(t.x-e.x),this._pRootDelta.y=e.y+this._blendWeight*(t.y-e.y),this._pRootDelta.z=e.z+this._blendWeight*(t.z-e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var t,i,a,s,n,o,h=this._skeletonPose.jointPoses,l=this._inputA.getSkeletonPose(e).jointPoses,p=this._inputB.getSkeletonPose(e).jointPoses,d=e.numJoints;h.length!=d&&(h.length=d);for(var c=0;d>c;++c)t=h[c],null==t&&(t=h[c]=new r),i=l[c],a=p[c],s=i.translation,n=a.translation,t.orientation.lerp(i.orientation,a.orientation,this._blendWeight),o=t.translation,o.x=s.x+this._blendWeight*(n.x-s.x),o.y=s.y+this._blendWeight*(n.y-s.y),o.z=s.z+this._blendWeight*(n.z-s.z)},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/JointPose"),s=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),n=e("awayjs-renderergl/lib/animators/states/AnimationClipState"),o=function(e){function t(t,i){e.call(this,t,i),this._rootPos=new r,this._skeletonPose=new s,this._skeletonPoseDirty=!0,this._skeletonClipNode=i,this._frames=this._skeletonClipNode.frames}return i(t,e),Object.defineProperty(t.prototype,"currentPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentPose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextPose},enumerable:!0,configurable:!0}),t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,e.prototype._pUpdateTime.call(this,t)},t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this),this._currentPose=this._frames[this._pCurrentFrame],this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame?(this._nextPose=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextPose=this._frames[this._pNextFrame]},t.prototype.updateSkeletonPose=function(e){if(this._skeletonPoseDirty=!1,this._skeletonClipNode.totalDuration){this._pFramesDirty&&this._pUpdateFrames();var t,i,r,s,n,o,h=this._currentPose.jointPoses,l=this._nextPose.jointPoses,p=e.numJoints,d=this._skeletonPose.jointPoses;if(d.length!=p&&(d.length=p),p!=h.length||p!=l.length)throw new Error("joint counts don't match!");for(var c=0;p>c;++c)n=d[c],null==n&&(n=d[c]=new a),r=h[c],s=l[c],t=r.translation,i=s.translation,this._skeletonClipNode.highQuality?n.orientation.slerp(r.orientation,s.orientation,this._pBlendWeight):n.orientation.lerp(r.orientation,s.orientation,this._pBlendWeight),c>0&&(o=n.translation,o.x=t.x+this._pBlendWeight*(i.x-t.x),o.y=t.y+this._pBlendWeight*(i.y-t.y),o.z=t.z+this._pBlendWeight*(i.z-t.z))}},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._pFramesDirty&&this._pUpdateFrames();var e,t,i,r=this._skeletonClipNode.totalDelta;(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame)&&(this._rootPos.x-=r.x*this._pTimeDir,this._rootPos.y-=r.y*this._pTimeDir,this._rootPos.z-=r.z*this._pTimeDir);var a=this._rootPos.x,s=this._rootPos.y,n=this._rootPos.z;this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame?(e=this._frames[0].jointPoses[0].translation,t=this._frames[1].jointPoses[0].translation,i=this._currentPose.jointPoses[0].translation,this._rootPos.x=i.x+e.x+this._pBlendWeight*(t.x-e.x),this._rootPos.y=i.y+e.y+this._pBlendWeight*(t.y-e.y),this._rootPos.z=i.z+e.z+this._pBlendWeight*(t.z-e.z)):(e=this._currentPose.jointPoses[0].translation,t=this._frames[this._pNextFrame].jointPoses[0].translation,this._rootPos.x=e.x+this._pBlendWeight*(t.x-e.x),this._rootPos.y=e.y+this._pBlendWeight*(t.y-e.y),this._rootPos.z=e.z+this._pBlendWeight*(t.z-e.z)),this._pRootDelta.x=this._rootPos.x-a,this._pRootDelta.y=this._rootPos.y-s,this._pRootDelta.z=this._rootPos.z-n,this._pOldFrame=this._pNextFrame},t}(n);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationClipState":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-renderergl/lib/animators/data/JointPose"),s=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),n=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._blendWeight=0,this._skeletonPose=new s,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=i,this._baseInput=t.getAnimationState(this._skeletonAnimationNode.baseInput),this._differenceInput=t.getAnimationState(this._skeletonAnimationNode.differenceInput)}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._baseInput.phase(e),this._baseInput.phase(e)},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,this._baseInput.update(t),this._differenceInput.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e=this._baseInput.positionDelta,t=this._differenceInput.positionDelta;this.positionDelta.x=e.x+this._blendWeight*t.x,this.positionDelta.y=e.y+this._blendWeight*t.y,this.positionDelta.z=e.z+this._blendWeight*t.z},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var i,r,s,n,o,h,l=this._skeletonPose.jointPoses,p=this._baseInput.getSkeletonPose(e).jointPoses,d=this._differenceInput.getSkeletonPose(e).jointPoses,c=e.numJoints;l.length!=c&&(l.length=c);for(var u=0;c>u;++u)i=l[u],null==i&&(i=l[u]=new a),r=p[u],s=d[u],n=r.translation,o=s.translation,t._tempQuat.multiply(s.orientation,r.orientation),i.orientation.lerp(r.orientation,t._tempQuat,this._blendWeight),h=i.translation,h.x=n.x+this._blendWeight*o.x,h.y=n.y+this._blendWeight*o.y,h.z=n.z+this._blendWeight*o.z},t._tempQuat=new r,t}(n);t.exports=o},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._blendWeight=0,this._direction=0,this._blendDirty=!0,this._skeletonAnimationNode=i,this._forward=t.getAnimationState(this._skeletonAnimationNode.forward),this._backward=t.getAnimationState(this._skeletonAnimationNode.backward),this._left=t.getAnimationState(this._skeletonAnimationNode.left),this._right=t.getAnimationState(this._skeletonAnimationNode.right)}return i(t,e),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._direction!=e&&(this._direction=e,this._blendDirty=!0,this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(e),this._inputB.phase(e)},t.prototype._pUdateTime=function(t){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._blendDirty&&this.updateBlend();var e=this._inputA.positionDelta,t=this._inputB.positionDelta;this.positionDelta.x=e.x+this._blendWeight*(t.x-e.x),this.positionDelta.y=e.y+this._blendWeight*(t.y-e.y),this.positionDelta.z=e.z+this._blendWeight*(t.z-e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1,this._blendDirty&&this.updateBlend();var t,i,a,s,n,o,h=this._skeletonPose.jointPoses,l=this._inputA.getSkeletonPose(e).jointPoses,p=this._inputB.getSkeletonPose(e).jointPoses,d=e.numJoints;h.length!=d&&(h.length=d);for(var c=0;d>c;++c)t=h[c],null==t&&(t=h[c]=new r),i=l[c],a=p[c],s=i.translation,n=a.translation,t.orientation.lerp(i.orientation,a.orientation,this._blendWeight),o=t.translation,o.x=s.x+this._blendWeight*(n.x-s.x),o.y=s.y+this._blendWeight*(n.y-s.y),o.z=s.z+this._blendWeight*(n.z-s.z)},t.prototype.updateBlend=function(){this._blendDirty=!1,(this._direction<0||this._direction>360)&&(this._direction%=360,this._direction<0&&(this._direction+=360)),this._direction<90?(this._inputA=this._forward,this._inputB=this._right,this._blendWeight=this._direction/90):this._direction<180?(this._inputA=this._right,this._inputB=this._backward,this._blendWeight=(this._direction-90)/90):this._direction<270?(this._inputA=this._backward,this._inputB=this._left,this._blendWeight=(this._direction-180)/90):(this._inputA=this._left,this._inputB=this._forward,this._blendWeight=(this._direction-270)/90)},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._blendWeights=new Array,this._inputs=new Array,this._skeletonAnimationNode=i;for(var r=this._skeletonAnimationNode.numInputs;r--;)this._inputs[r]=t.getAnimationState(this._skeletonAnimationNode._iInputs[r])}return i(t,e),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0;for(var t=0;t<this._skeletonAnimationNode.numInputs;++t)this._blendWeights[t]&&this._inputs[t].update(e)},t.prototype._pUdateTime=function(t){for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)this._blendWeights[i]&&this._inputs[i].update(t);e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype.getBlendWeightAt=function(e){return this._blendWeights[e]},t.prototype.setBlendWeightAt=function(e,t){this._blendWeights[e]=t,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e,t;this.positionDelta.x=0,this.positionDelta.y=0,this.positionDelta.z=0;for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)t=this._blendWeights[i],t&&(e=this._inputs[i].positionDelta,this.positionDelta.x+=t*e.x,this.positionDelta.y+=t*e.y,this.positionDelta.z+=t*e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var t,i,a,s,n,o,h,l,p,d,c,u,g,_,m,y,f,b,x=this._skeletonPose.jointPoses,v=e.numJoints;x.length!=v&&(x.length=v);for(var w=0;w<this._skeletonAnimationNode.numInputs;++w)if(t=this._blendWeights[w])if(i=this._inputs[w].getSkeletonPose(e).jointPoses,p)for(d=0;d<e.numJoints;++d)a=x[d],s=i[d],l=p[d].orientation,u=l.x,g=l.y,_=l.z,c=l.w,l=s.orientation,o=s.translation,y=l.x,f=l.y,b=l.z,m=l.w,0>u*y+g*f+_*b+c*m&&(y=-y,f=-f,b=-b,m=-m),h=a.orientation,h.x+=t*y,h.y+=t*f,h.z+=t*b,h.w+=t*m,n=a.translation,n.x+=t*o.x,n.y+=t*o.y,n.z+=t*o.z;else for(p=i,d=0;v>d;++d)a=x[d],null==a&&(a=x[d]=new r),s=i[d],l=s.orientation,o=s.translation,h=a.orientation,h.x=t*l.x,h.y=t*l.y,h.z=t*l.z,h.w=t*l.w,n=a.translation,n.x=t*o.x,n.y=t*o.y,n.z=t*o.z;for(d=0;d<e.numJoints;++d)x[d].orientation.normalize()},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/VertexClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationClipState"),a=function(e){function t(t,i){e.call(this,t,i),this._vertexClipNode=i,this._frames=this._vertexClipNode.frames}return i(t,e),Object.defineProperty(t.prototype,"currentGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentGeometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextGeometry},enumerable:!0,configurable:!0}),t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this),this._currentGeometry=this._frames[this._pCurrentFrame],this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame?(this._nextGeometry=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextGeometry=this._frames[this._pNextFrame]},t.prototype._pUpdatePositionDelta=function(){},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/AnimationClipState":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode"),a=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":void 0,"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState"),a=e("awayjs-renderergl/lib/events/AnimationStateEvent"),s=function(e){function t(t,i){e.call(this,t,i),this._crossfadeTransitionNode=i}return i(t,e),t.prototype._pUpdateTime=function(t){this.blendWeight=Math.abs(t-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed),this.blendWeight>=1&&(this.blendWeight=1,null==this._animationStateTransitionComplete&&(this._animationStateTransitionComplete=new a(a.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode)),this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)),e.prototype._pUpdateTime.call(this,t)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransition":[function(e,t){var i=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode"),r=function(){function e(e){this.blendSpeed=.5,this.blendSpeed=e}return e.prototype.getAnimationNode=function(e,t,r,a){var s=new i;return s.inputA=t,s.inputB=r,s.blendSpeed=this.blendSpeed,s.startBlend=a,s},e}();t.exports=r},{"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":void 0}],"awayjs-renderergl/lib/animators/transitions/IAnimationTransition":[function(){},{}],"awayjs-renderergl/lib/base/ParticleGeometry":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/Geometry"),a=function(e){function t(){e.apply(this,arguments)}return i(t,e),t}(r);t.exports=a},{"awayjs-display/lib/base/Geometry":void 0}],"awayjs-renderergl/lib/errors/AnimationSetError":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/errors/Error"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t}(r);t.exports=a},{"awayjs-core/lib/errors/Error":void 0}],"awayjs-renderergl/lib/events/AnimationStateEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=function(e){function t(t,i,r,a){e.call(this,t),this._animator=i,this._animationState=r,this._animationNode=a}return i(t,e),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationState",{get:function(){return this._animationState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.type,this._animator,this._animationState,this._animationNode)},t.PLAYBACK_COMPLETE="playbackComplete",t.TRANSITION_COMPLETE="transitionComplete",t}(r);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-renderergl/lib/events/AnimatorEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=function(e){function t(t,i){e.call(this,t),this._animator=i}return i(t,e),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.type,this._animator)},t.START="start",t.STOP="stop",t.CYCLE_COMPLETE="cycle_complete",t}(r);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-renderergl/lib/events/ShadingMethodEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t.SHADER_INVALIDATED="ShaderInvalidated",t}(r);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-renderergl/lib/filters/Filter3DBase":[function(e,t){var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e.prototype.pAddTask=function(e){this._tasks.push(e),null==this._requireDepthRender&&(this._requireDepthRender=e.requireDepthRender)},Object.defineProperty(e.prototype,"tasks",{get:function(){return this._tasks},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._tasks[0].getMainInputTexture(e)},Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){this._textureHeight=e;for(var t=0;t<this._tasks.length;++t)this._tasks[t].textureHeight=e},enumerable:!0,configurable:!0}),e.prototype.setRenderTargets=function(e){this._tasks[this._tasks.length-1].target=e},e.prototype.dispose=function(){for(var e=0;e<this._tasks.length;++e)this._tasks[e].dispose()},e.prototype.update=function(){},e}();t.exports=i},{}],"awayjs-renderergl/lib/filters/tasks/Filter3DTaskBase":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),r=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFormat"),s=function(){function e(e){void 0===e&&(e=!1),this._scaledTextureWidth=-1,this._scaledTextureHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._textureDimensionsInvalid=!0,this._program3DInvalid=!0,this._textureScale=0,this._requireDepthRender=e}return Object.defineProperty(e.prototype,"textureScale",{get:function(){return this._textureScale},set:function(e){this._textureScale!=e&&(this._textureScale=e,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(e){this._textureWidth!=e&&(this._textureWidth=e,this._scaledTextureWidth=this._textureWidth>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(e){this._textureHeight!=e&&(this._textureHeight=e,this._scaledTextureHeight=this._textureHeight>>this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._textureDimensionsInvalid&&this.pUpdateTextures(e),this._mainInputTexture},e.prototype.dispose=function(){this._mainInputTexture&&this._mainInputTexture.dispose(),this._program3D&&this._program3D.dispose()},e.prototype.pInvalidateProgram=function(){this._program3DInvalid=!0},e.prototype.pUpdateProgram=function(e){this._program3D&&this._program3D.dispose(),this._program3D=e.context.createProgram();var t=(new r).assemble("part vertex 1\n"+this.pGetVertexCode()+"endpart").vertex.data,i=(new r).assemble("part fragment 1\n"+this.pGetFragmentCode()+"endpart").fragment.data;this._program3D.upload(t,i),this._program3DInvalid=!1},e.prototype.pGetVertexCode=function(){return"mov op, va0\nmov v0, va1\n"},e.prototype.pGetFragmentCode=function(){throw new i},e.prototype.pUpdateTextures=function(e){this._mainInputTexture&&this._mainInputTexture.dispose(),this._mainInputTexture=e.context.createTexture(this._scaledTextureWidth,this._scaledTextureHeight,a.BGRA,!0),this._textureDimensionsInvalid=!1},e.prototype.getProgram=function(e){return this._program3DInvalid&&this.pUpdateProgram(e),this._program3D},e.prototype.activate=function(){},e.prototype.deactivate=function(){},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e}();t.exports=s},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFormat":void 0}],"awayjs-renderergl/lib/managers/RTTBufferManager":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Rectangle"),a=e("awayjs-core/lib/events/Event"),s=e("awayjs-core/lib/events/EventDispatcher"),n=e("awayjs-core/lib/utils/TextureUtils"),o=function(e){function t(t){e.call(this),this._viewWidth=-1,this._viewHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._buffersInvalid=!0,this._renderToTextureRect=new r,this._stage=t}return i(t,e),t.getInstance=function(e){if(!e)throw new Error("stage key cannot be null!");null==t._instances&&(t._instances=new Array);var i=t.getRTTBufferManagerFromStage(e);if(null==i){i=new t(e);var r=new h;r.stage3d=e,r.rttbfm=i,t._instances.push(r)}return i},t.getRTTBufferManagerFromStage=function(e){for(var i,r=t._instances.length,a=0;r>a;a++)if(i=t._instances[a],i.stage3d===e)return i.rttbfm;return null},t.deleteRTTBufferManager=function(e){for(var i,r=t._instances.length,a=0;r>a;a++)if(i=t._instances[a],i.stage3d===e)return void t._instances.splice(a,1)},Object.defineProperty(t.prototype,"textureRatioX",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureRatioY",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(e){e!=this._viewWidth&&(this._viewWidth=e,this._buffersInvalid=!0,this._textureWidth=n.getBestPowerOf2(this._viewWidth),this._textureWidth>this._viewWidth?(this._renderToTextureRect.x=Math.floor(.5*(this._textureWidth-this._viewWidth)),this._renderToTextureRect.width=this._viewWidth):(this._renderToTextureRect.x=0,this._renderToTextureRect.width=this._textureWidth),this.dispatchEvent(new a(a.RESIZE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(e){e!=this._viewHeight&&(this._viewHeight=e,this._buffersInvalid=!0,this._textureHeight=n.getBestPowerOf2(this._viewHeight),this._textureHeight>this._viewHeight?(this._renderToTextureRect.y=Math.floor(.5*(this._textureHeight-this._viewHeight)),this._renderToTextureRect.height=this._viewHeight):(this._renderToTextureRect.y=0,this._renderToTextureRect.height=this._textureHeight),this.dispatchEvent(new a(a.RESIZE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToTextureVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToScreenVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToScreenVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToTextureRect",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureRect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){t.deleteRTTBufferManager(this._stage),this._indexBuffer&&(this._indexBuffer.dispose(),this._renderToScreenVertexBuffer.dispose(),this._renderToTextureVertexBuffer.dispose(),this._renderToScreenVertexBuffer=null,this._renderToTextureVertexBuffer=null,this._indexBuffer=null)},t.prototype.updateRTTBuffers=function(){var e,t,i,r,a=this._stage.context;null==this._renderToTextureVertexBuffer&&(this._renderToTextureVertexBuffer=a.createVertexBuffer(4,5)),null==this._renderToScreenVertexBuffer&&(this._renderToScreenVertexBuffer=a.createVertexBuffer(4,5)),this._indexBuffer||(this._indexBuffer=a.createIndexBuffer(6),this._indexBuffer.uploadFromArray([2,1,0,3,2,0],0,6)),this._textureRatioX=i=Math.min(this._viewWidth/this._textureWidth,1),this._textureRatioY=r=Math.min(this._viewHeight/this._textureHeight,1);var s=.5*(1-i),n=.5*(i+1),o=.5*(r+1),h=.5*(1-r);e=[-i,-r,s,o,0,i,-r,n,o,1,i,r,n,h,2,-i,r,s,h,3],t=[-1,-1,s,o,0,1,-1,n,o,1,1,1,n,h,2,-1,1,s,h,3],this._renderToTextureVertexBuffer.uploadFromArray(e,0,4),this._renderToScreenVertexBuffer.uploadFromArray(t,0,4),this._buffersInvalid=!1},t}(s),h=function(){function e(){}return e}();t.exports=o},{"awayjs-core/lib/events/Event":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/utils/TextureUtils":void 0}],"awayjs-renderergl/lib/materials/LineBasicMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-display/lib/base/LineSubGeometry"),s=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/materials/StageGLMaterialBase"),o=e("awayjs-renderergl/lib/materials/passes/LineBasicPass"),h=function(e){function t(t){void 0===t&&(t=1.25),e.call(this),this._constants=new Array(0,0,0,0),this._thickness=t,this.bothSides=!0,this._pAddScreenPass(this._screenPass=new o),this._calcMatrix=new r,this._constants[1]=1/255}return i(t,e),t.prototype._iGetVertexCode=function(){return"m44 vt0, va0, vc8			\nm44 vt1, va1, vc8			\nsub vt2, vt1, vt0 			\nslt vt5.x, vt0.z, vc7.z			\nsub vt5.y, vc5.x, vt5.x			\nadd vt4.x, vt0.z, vc7.z			\nsub vt4.y, vt0.z, vt1.z			\nseq vt4.z, vt4.y vc6.x			\nadd vt4.y, vt4.y, vt4.z			\ndiv vt4.z, vt4.x, vt4.y			\nmul vt4.xyz, vt4.zzz, vt2.xyz	\nadd vt3.xyz, vt0.xyz, vt4.xyz	\nmov vt3.w, vc5.x			\nmul vt0, vt0, vt5.yyyy			\nmul vt3, vt3, vt5.xxxx			\nadd vt0, vt0, vt3				\nsub vt2, vt1, vt0 			\nnrm vt2.xyz, vt2.xyz			\nnrm vt5.xyz, vt0.xyz			\nmov vt5.w, vc5.x				\ncrs vt3.xyz, vt2, vt5			\nnrm vt3.xyz, vt3.xyz			\nmul vt3.xyz, vt3.xyz, va2.xxx	\nmov vt3.w, vc5.x			\ndp3 vt4.x, vt0, vc6			\nmul vt4.x, vt4.x, vc7.x			\nmul vt3.xyz, vt3.xyz, vt4.xxx	\nadd vt0.xyz, vt0.xyz, vt3.xyz	\nm44 op, vt0, vc0			\nmov v0, va3				\n"
},t.prototype._iActivatePass=function(i,r,a){e.prototype._iActivatePass.call(this,i,r,a);var n=r.context,o=r.stage;this._constants[0]=this._thickness/(o.scissorRect?Math.min(o.scissorRect.width,o.scissorRect.height):Math.min(o.width,o.height)),this._constants[2]=a.projection.near,n.setProgramConstantsFromArray(s.VERTEX,5,t.pONE_VECTOR,1),n.setProgramConstantsFromArray(s.VERTEX,6,t.pFRONT_VECTOR,1),n.setProgramConstantsFromArray(s.VERTEX,7,this._constants,1),n.setProgramConstantsFromMatrix(s.VERTEX,0,a.projection.matrix,!0)},t.prototype._iRenderPass=function(t,i,r,n,o){e.prototype._iRenderPass.call(this,t,i,r,n,o);var h=r.context;this._calcMatrix.copyFrom(i.sourceEntity.sceneTransform),this._calcMatrix.append(n.inverseSceneTransform),h.setProgramConstantsFromMatrix(s.VERTEX,8,this._calcMatrix,!0),r.activateBuffer(0,i.getVertexData(a.START_POSITION_DATA),i.getVertexOffset(a.START_POSITION_DATA),a.POSITION_FORMAT),r.activateBuffer(1,i.getVertexData(a.END_POSITION_DATA),i.getVertexOffset(a.END_POSITION_DATA),a.POSITION_FORMAT),r.activateBuffer(2,i.getVertexData(a.THICKNESS_DATA),i.getVertexOffset(a.THICKNESS_DATA),a.THICKNESS_FORMAT),r.activateBuffer(3,i.getVertexData(a.COLOR_DATA),i.getVertexOffset(a.COLOR_DATA),a.COLOR_FORMAT),h.drawTriangles(r.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t.pONE_VECTOR=Array(1,1,1,1),t.pFRONT_VECTOR=Array(0,0,-1,0),t}(n);t.exports=h},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-display/lib/base/LineSubGeometry":void 0,"awayjs-renderergl/lib/materials/StageGLMaterialBase":void 0,"awayjs-renderergl/lib/materials/passes/LineBasicPass":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/materials/SkyboxMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),s=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),n=e("awayjs-stagegl/lib/base/ContextGLProgramType"),o=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),h=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),l=e("awayjs-renderergl/lib/materials/StageGLMaterialBase"),p=e("awayjs-renderergl/lib/materials/passes/SkyboxPass"),d=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),c=function(e){function t(t,i,r,a){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===a&&(a=!1),e.call(this),this._cubeMap=t,this._pAddScreenPass(this._skyboxPass=new p),this._vertexData=new Array(0,0,0,0,1,1,1,1)}return i(t,e),Object.defineProperty(t.prototype,"cubeMap",{get:function(){return this._cubeMap},set:function(e){e&&this._cubeMap&&(e.hasMipmaps!=this._cubeMap.hasMipmaps||e.format!=this._cubeMap.format)&&this._pInvalidatePasses(),this._cubeMap=e},enumerable:!0,configurable:!0}),t.prototype._iGetVertexCode=function(){return"mul vt0, va0, vc5\nadd vt0, vt0, vc4\nm44 op, vt0, vc0\nmov v0, va0\n"},t.prototype._iGetFragmentCode=function(){var e=",mipnone";return this._cubeMap.hasMipmaps&&(e=",miplinear"),"tex ft0, v0, fs0 <cube,"+d.getFormatStringForTexture(this._cubeMap)+"linear,clamp"+e+">\n"},t.prototype._iActivatePass=function(t,i,r){e.prototype._iActivatePass.call(this,t,i,r);var n=i.context;n.setSamplerStateAt(0,h.CLAMP,o.LINEAR,this._cubeMap.hasMipmaps?s.MIPLINEAR:s.MIPNONE),n.setDepthTest(!1,a.LESS),i.stage.activateCubeTexture(0,this._cubeMap)},t.prototype._iRenderPass=function(t,i,a,s,o){e.prototype._iRenderPass.call(this,t,i,a,s,o);var h=a.context,l=s.scenePosition;this._vertexData[0]=l.x,this._vertexData[1]=l.y,this._vertexData[2]=l.z,this._vertexData[4]=this._vertexData[5]=this._vertexData[6]=s.projection.far/Math.sqrt(3),h.setProgramConstantsFromMatrix(n.VERTEX,0,o,!0),h.setProgramConstantsFromArray(n.VERTEX,4,this._vertexData,2),a.activateBuffer(0,i.getVertexData(r.POSITION_DATA),i.getVertexOffset(r.POSITION_DATA),r.POSITION_FORMAT),h.drawTriangles(a.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t}(l);t.exports=c},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/materials/StageGLMaterialBase":void 0,"awayjs-renderergl/lib/materials/passes/SkyboxPass":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/StageGLMaterialBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/materials/MaterialBase"),a=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype._iGetVertexCode=function(){return""},t.prototype._iGetFragmentCode=function(){return""},t}(r);t.exports=a},{"awayjs-display/lib/materials/MaterialBase":void 0}],"awayjs-renderergl/lib/materials/TriangleBasicMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/textures/Texture2DBase"),a=e("awayjs-display/lib/base/BlendMode"),s=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),n=e("awayjs-renderergl/lib/materials/TriangleMaterialBase"),o=e("awayjs-renderergl/lib/materials/passes/TriangleBasicPass"),h=function(e){function t(t,i,a,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===a&&(a=!1),void 0===n&&(n=!1),e.call(this),this._alphaBlending=!1,this._alpha=1,this._depthCompareMode=s.LESS_EQUAL,this._screenPass=new o,t instanceof r?(this.texture=t,this.smooth=null==i?!0:!1,this.repeat=a,this.mipmap=n):(this.color=t?Number(t):13421772,this.alpha=null==i?1:Number(i))}return i(t,e),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode!=e&&(this._depthCompareMode=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e>1?e=1:0>e&&(e=0),this._alpha!=e&&(this._alpha=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(e){this._alphaBlending!=e&&(this._alphaBlending=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),t.prototype.iUpdateMaterial=function(){var e;this._pScreenPassesInvalid&&(this.pUpdateScreenPasses(),e=!0),e&&(this._pClearScreenPasses(),this._pAddScreenPass(this._screenPass))},t.prototype.pUpdateScreenPasses=function(){this.initPasses(),this.setBlendAndCompareModes(),this._pScreenPassesInvalid=!1},t.prototype.initPasses=function(){},t.prototype.setBlendAndCompareModes=function(){this._pRequiresBlending=this._pBlendMode!=a.NORMAL||this._alphaBlending||this._alpha<1,this._screenPass.depthCompareMode=this._depthCompareMode,this._screenPass.preserveAlpha=this._pRequiresBlending,this._screenPass.setBlendMode(this._pBlendMode==a.NORMAL&&this._pRequiresBlending?a.LAYER:this._pBlendMode),this._screenPass.forceSeparateMVP=!1},t}(n);t.exports=h},{"awayjs-core/lib/textures/Texture2DBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialBase":void 0,"awayjs-renderergl/lib/materials/passes/TriangleBasicPass":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/materials/TriangleMaterialBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3DUtils"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/materials/StageGLMaterialBase"),o=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype._iGetVertexCode=function(e,t,i){var r="",a=e.globalPosDependencies>0?i.globalPositionVertex:i.localPosition,s=t.getFreeVertexConstant();if(t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),e.viewMatrixIndex=4*s.index,e.projectionDependencies>0){i.projectionFragment=t.getFreeVarying();var n=t.getFreeVertexVectorTemp();r+="m44 "+n+", "+a+", "+s+"\nmov "+i.projectionFragment+", "+n+"\nmov op, "+n+"\n"}else r+="m44 op, "+a+", "+s+"\n";return r},t.prototype._iRenderPass=function(t,i,n,o,h){e.prototype._iRenderPass.call(this,t,i,n,o,h);var l=t.shaderObject;if(l.sceneMatrixIndex>=0)i.sourceEntity.getRenderSceneTransform(o).copyRawDataTo(l.vertexConstantData,l.sceneMatrixIndex,!0),h.copyRawDataTo(l.vertexConstantData,l.viewMatrixIndex,!0);else{var p=r.CALCULATION_MATRIX;p.copyFrom(i.sourceEntity.getRenderSceneTransform(o)),p.append(h),p.copyRawDataTo(l.vertexConstantData,l.viewMatrixIndex,!0)}var d=n.context;d.setProgramConstantsFromArray(s.VERTEX,0,l.vertexConstantData,l.numUsedVertexConstants),d.setProgramConstantsFromArray(s.FRAGMENT,0,l.fragmentConstantData,l.numUsedFragmentConstants),n.activateBuffer(0,i.getVertexData(a.POSITION_DATA),i.getVertexOffset(a.POSITION_DATA),a.POSITION_FORMAT),d.drawTriangles(n.getIndexBuffer(i.getIndexData()),0,i.numTriangles)},t}(n);t.exports=o},{"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/materials/StageGLMaterialBase":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/materials/TriangleMaterialMode":[function(e,t){var i=function(){function e(){}return e.SINGLE_PASS="singlePass",e.MULTI_PASS="multiPass",e}();t.exports=i},{}],"awayjs-renderergl/lib/materials/TriangleMethodMaterial":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-core/lib/textures/Texture2DBase"),s=e("awayjs-display/lib/base/BlendMode"),n=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker"),o=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),h=e("awayjs-renderergl/lib/materials/TriangleMaterialBase"),l=e("awayjs-renderergl/lib/materials/TriangleMaterialMode"),p=e("awayjs-renderergl/lib/materials/methods/AmbientBasicMethod"),d=e("awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod"),c=e("awayjs-renderergl/lib/materials/methods/NormalBasicMethod"),u=e("awayjs-renderergl/lib/materials/methods/SpecularBasicMethod"),g=e("awayjs-renderergl/lib/materials/passes/MaterialPassMode"),_=e("awayjs-renderergl/lib/materials/passes/TriangleMethodPass"),m=function(e){function t(t,i,r,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===s&&(s=!1),e.call(this),this._alphaBlending=!1,this._alpha=1,this._ambientMethod=new p,this._diffuseMethod=new d,this._normalMethod=new c,this._specularMethod=new u,this._depthCompareMode=o.LESS_EQUAL,this._materialMode=l.SINGLE_PASS,t instanceof a?(this.texture=t,this.smooth=null==i?!0:!1,this.repeat=r,this.mipmap=s):(this.color=null==t?16777215:Number(t),this.alpha=null==i?1:Number(i))}return i(t,e),Object.defineProperty(t.prototype,"materialMode",{get:function(){return this._materialMode},set:function(e){this._materialMode!=e&&(this._materialMode=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode!=e&&(this._depthCompareMode=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e>1?e=1:0>e&&(e=0),this._alpha!=e&&(this._alpha=e,null==this._colorTransform&&(this._colorTransform=new r),this._colorTransform.alphaMultiplier=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this._screenPass.colorTransform},set:function(e){this._screenPass.colorTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseTexture",{get:function(){return this._diffuseMethod.texture},set:function(e){this._diffuseMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(e){this._ambientMethod!=e&&(e&&this._ambientMethod&&e.copyFrom(this._ambientMethod),this._ambientMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(e){this._shadowMethod!=e&&(e&&this._shadowMethod&&e.copyFrom(this._shadowMethod),this._shadowMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(e){this._diffuseMethod!=e&&(e&&this._diffuseMethod&&e.copyFrom(this._diffuseMethod),this._diffuseMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(e){this._specularMethod!=e&&(e&&this._specularMethod&&e.copyFrom(this._specularMethod),this._specularMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(e){this._normalMethod!=e&&(e&&this._normalMethod&&e.copyFrom(this._normalMethod),this._normalMethod=e,this._pInvalidateScreenPasses())},enumerable:!0,configurable:!0}),t.prototype.addEffectMethod=function(e){null==this._screenPass&&(this._screenPass=new _),this._screenPass.addEffectMethod(e),this._pInvalidateScreenPasses()},Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._screenPass?this._screenPass.numEffectMethods:0},enumerable:!0,configurable:!0}),t.prototype.hasEffectMethod=function(e){return this._screenPass?this._screenPass.hasEffectMethod(e):!1},t.prototype.getEffectMethodAt=function(e){return null==this._screenPass?null:this._screenPass.getEffectMethodAt(e)},t.prototype.addEffectMethodAt=function(e,t){null==this._screenPass&&(this._screenPass=new _),this._screenPass.addEffectMethodAt(e,t),this._pInvalidatePasses()},t.prototype.removeEffectMethod=function(e){null!=this._screenPass&&(this._screenPass.removeEffectMethod(e),0==this._screenPass.numEffectMethods&&this._pInvalidatePasses())},Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._normalMethod.normalMap},set:function(e){this._normalMethod.normalMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMap",{get:function(){return this._specularMethod.texture},set:function(e){this._specularMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gloss",{get:function(){return this._specularMethod.gloss},set:function(e){this._specularMethod.gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambientMethod.ambient},set:function(e){this._ambientMethod.ambient=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._specularMethod.specular},set:function(e){this._specularMethod.specular=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._diffuseMethod.ambientColor},set:function(e){this._diffuseMethod.ambientColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseMethod.diffuseColor},set:function(e){this._diffuseMethod.diffuseColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularMethod.specularColor},set:function(e){this._specularMethod.specularColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(e){this._alphaBlending!=e&&(this._alphaBlending=e,this._pInvalidatePasses())},enumerable:!0,configurable:!0}),t.prototype._iUpdateMaterial=function(){if(this._pScreenPassesInvalid){if(this._pScreenPassesInvalid=!1,this.initPasses(),this.setBlendAndCompareModes(),this._pClearScreenPasses(),this._materialMode==l.MULTI_PASS&&(this._casterLightPass&&this._pAddScreenPass(this._casterLightPass),this._nonCasterLightPasses))for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pAddScreenPass(this._nonCasterLightPasses[e]);this._screenPass&&this._pAddScreenPass(this._screenPass)}},t.prototype.initPasses=function(){0==this.numLights||this.numEffectMethods>0||this._materialMode==l.SINGLE_PASS?this.initEffectPass():this._screenPass&&this.removeEffectPass(),this._shadowMethod&&this._materialMode==l.MULTI_PASS?this.initCasterLightPass():this._casterLightPass&&this.removeCasterLightPass(),this.numNonCasters>0&&this._materialMode==l.MULTI_PASS?this.initNonCasterLightPasses():this._nonCasterLightPasses&&this.removeNonCasterLightPasses()},t.prototype.setBlendAndCompareModes=function(){var e=Boolean(this._casterLightPass||this._screenPass);if(this._casterLightPass&&(this._casterLightPass.forceSeparateMVP=e,this._casterLightPass.setBlendMode(s.NORMAL),this._casterLightPass.depthCompareMode=this._depthCompareMode),this._nonCasterLightPasses){var t=0;this._casterLightPass||(this._nonCasterLightPasses[0].forceSeparateMVP=e,this._nonCasterLightPasses[0].setBlendMode(s.NORMAL),this._nonCasterLightPasses[0].depthCompareMode=this._depthCompareMode,t=1);for(var i=t;i<this._nonCasterLightPasses.length;++i)this._nonCasterLightPasses[i].forceSeparateMVP=e,this._nonCasterLightPasses[i].setBlendMode(s.ADD),this._nonCasterLightPasses[i].depthCompareMode=o.LESS_EQUAL}this._casterLightPass||this._nonCasterLightPasses?(this._pRequiresBlending=!1,this._screenPass&&(this._screenPass.passMode=g.EFFECTS,this._screenPass.depthCompareMode=o.LESS_EQUAL,this._screenPass.setBlendMode(s.LAYER),this._screenPass.forceSeparateMVP=e)):this._screenPass&&(this._pRequiresBlending=this._pBlendMode!=s.NORMAL||this._alphaBlending||this._colorTransform&&this._colorTransform.alphaMultiplier<1,this._screenPass.passMode=g.SUPER_SHADER,this._screenPass.depthCompareMode=this._depthCompareMode,this._screenPass.preserveAlpha=this._pRequiresBlending,this._screenPass.colorTransform=this._colorTransform,this._screenPass.setBlendMode(this._pBlendMode==s.NORMAL&&this._pRequiresBlending?s.LAYER:this._pBlendMode),this._screenPass.forceSeparateMVP=!1)},t.prototype.initCasterLightPass=function(){null==this._casterLightPass&&(this._casterLightPass=new _(g.LIGHTING)),this._casterLightPass.lightPicker=new n([this._shadowMethod.castingLight]),this._casterLightPass.shadowMethod=this._shadowMethod,this._casterLightPass.diffuseMethod=this._diffuseMethod,this._casterLightPass.ambientMethod=this._ambientMethod,this._casterLightPass.normalMethod=this._normalMethod,this._casterLightPass.specularMethod=this._specularMethod},t.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose(),this._pRemoveScreenPass(this._casterLightPass),this._casterLightPass=null},t.prototype.initNonCasterLightPasses=function(){this.removeNonCasterLightPasses();var e,t=this._pLightPicker.numDirectionalLights,i=this._pLightPicker.numPointLights,r=this._pLightPicker.numLightProbes,a=0,s=0,n=0;for(this._casterLightPass||(t+=this._pLightPicker.numCastingDirectionalLights,i+=this._pLightPicker.numCastingPointLights),this._nonCasterLightPasses=new Array;t>a||i>s||r>n;)e=new _(g.LIGHTING),e.includeCasters=null==this._shadowMethod,e.directionalLightsOffset=a,e.pointLightsOffset=s,e.lightProbesOffset=n,e.lightPicker=this._pLightPicker,e.diffuseMethod=this._diffuseMethod,e.ambientMethod=this._ambientMethod,e.normalMethod=this._normalMethod,e.specularMethod=this._specularMethod,this._nonCasterLightPasses.push(e),a+=e.iNumDirectionalLights,s+=e.iNumPointLights,n+=e.iNumLightProbes},t.prototype.removeNonCasterLightPasses=function(){if(this._nonCasterLightPasses){for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pRemoveScreenPass(this._nonCasterLightPasses[e]);this._nonCasterLightPasses=null}},t.prototype.removeEffectPass=function(){this._screenPass.ambientMethod!=this._ambientMethod&&this._screenPass.ambientMethod.dispose(),this._screenPass.diffuseMethod!=this._diffuseMethod&&this._screenPass.diffuseMethod.dispose(),this._screenPass.specularMethod!=this._specularMethod&&this._screenPass.specularMethod.dispose(),this._screenPass.normalMethod!=this._normalMethod&&this._screenPass.normalMethod.dispose(),this._pRemoveScreenPass(this._screenPass),this._screenPass=null},t.prototype.initEffectPass=function(){null==this._screenPass&&(this._screenPass=new _),this._materialMode==l.SINGLE_PASS?(this._screenPass.ambientMethod=this._ambientMethod,this._screenPass.diffuseMethod=this._diffuseMethod,this._screenPass.specularMethod=this._specularMethod,this._screenPass.normalMethod=this._normalMethod,this._screenPass.shadowMethod=this._shadowMethod):this._materialMode==l.MULTI_PASS&&(this._screenPass.ambientMethod=0==this.numLights?this._ambientMethod:null,this._screenPass.preserveAlpha=!1,this._screenPass.normalMethod=this._normalMethod)},Object.defineProperty(t.prototype,"numLights",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights+this._pLightPicker.numCastingDirectionalLights+this._pLightPicker.numCastingPointLights:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numNonCasters",{get:function(){return this._pLightPicker?this._pLightPicker.numLightProbes+this._pLightPicker.numDirectionalLights+this._pLightPicker.numPointLights:0},enumerable:!0,configurable:!0}),t}(h);t.exports=m},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-core/lib/textures/Texture2DBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialBase":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialMode":void 0,"awayjs-renderergl/lib/materials/methods/AmbientBasicMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod":void 0,"awayjs-renderergl/lib/materials/methods/NormalBasicMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularBasicMethod":void 0,"awayjs-renderergl/lib/materials/passes/MaterialPassMode":void 0,"awayjs-renderergl/lib/materials/passes/TriangleMethodPass":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/materials/compilation/MethodVO":[function(e,t){var i=function(){function e(e){this.useMethod=!0,this.method=e}return e.prototype.reset=function(){this.method.iReset(),this.texturesIndex=-1,this.vertexConstantsIndex=-1,this.fragmentConstantsIndex=-1,this.needsProjection=!1,this.needsView=!1,this.needsNormals=!1,this.needsTangents=!1,this.needsUV=!1,this.needsSecondaryUV=!1,this.needsGlobalVertexPos=!1,this.needsGlobalFragmentPos=!1},e}();t.exports=i},{}],"awayjs-renderergl/lib/materials/compilation/RegisterPool":[function(e,t){var i=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),r=function(){function e(e,t,i){void 0===i&&(i=!0),this._regName=e,this._regCount=t,this._persistent=i,this.initRegisters(e,t)}return e.prototype.requestFreeVectorReg=function(){for(var e=0;e<this._regCount;++e)if(!this.isRegisterUsed(e))return this._persistent&&this._usedVectorCount[e]++,this._vectorRegisters[e];throw new Error("Register overflow!")},e.prototype.requestFreeRegComponent=function(){for(var e=0;e<this._regCount;++e)if(!(this._usedVectorCount[e]>0))for(var t=0;4>t;++t)if(0==this._usedSingleCount[t][e])return this._persistent&&this._usedSingleCount[t][e]++,this._registerComponents[t][e];throw new Error("Register overflow!")},e.prototype.addUsage=function(e,t){e._component>-1?this._usedSingleCount[e._component][e.index]+=t:this._usedVectorCount[e.index]+=t},e.prototype.removeUsage=function(e){if(e._component>-1){if(--this._usedSingleCount[e._component][e.index]<0)throw new Error("More usages removed than exist!")}else if(--this._usedVectorCount[e.index]<0)throw new Error("More usages removed than exist!")},e.prototype.dispose=function(){this._vectorRegisters=null,this._registerComponents=null,this._usedSingleCount=null,this._usedVectorCount=null},e.prototype.hasRegisteredRegs=function(){for(var e=0;e<this._regCount;++e)if(this.isRegisterUsed(e))return!0;return!1},e.prototype.initRegisters=function(t,i){var r=e._initPool(t,i);this._vectorRegisters=e._regPool[r],this._registerComponents=e._regCompsPool[r],this._usedVectorCount=this._initArray(Array(i),0),this._usedSingleCount=new Array(4),this._usedSingleCount[0]=this._initArray(new Array(i),0),this._usedSingleCount[1]=this._initArray(new Array(i),0),this._usedSingleCount[2]=this._initArray(new Array(i),0),this._usedSingleCount[3]=this._initArray(new Array(i),0)},e._initPool=function(t,r){var a=t+r;if(void 0!=e._regPool[a])return a;var s=new Array(r);e._regPool[a]=s;var n=[[],[],[],[]];e._regCompsPool[a]=n;for(var o=0;r>o;++o){s[o]=new i(t,o);for(var h=0;4>h;++h)n[h][o]=new i(t,o,h)}return a},e.prototype.isRegisterUsed=function(e){if(this._usedVectorCount[e]>0)return!0;for(var t=0;4>t;++t)if(this._usedSingleCount[t][e]>0)return!0;return!1},e.prototype._initArray=function(e,t){for(var i=e.length,r=0;i>r;r++)e[r]=t;return e},e._regPool=new Object,e._regCompsPool=new Object,e}();t.exports=r},{"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/materials/compilation/ShaderCompilerBase":[function(e,t){var i=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterCache"),r=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterData"),a=e("awayjs-renderergl/lib/materials/passes/MaterialPassMode"),s=function(){function e(e,t,a){this._pVertexCode="",this._pFragmentCode="",this._pPostAnimationFragmentCode="",this._pMaterial=e,this._pMaterialPass=t,this._pShaderObject=a,this._pProfile=a.profile,this._pSharedRegisters=new r,this._pRegisterCache=new i(this._pProfile),this._pRegisterCache.vertexAttributesOffset=1,this._pRegisterCache.reset()}return e.prototype.compile=function(){this._pShaderObject.reset(),this.pCalculateDependencies(),this.pInitRegisterIndices(),this.pCompileDependencies(),this._pVertexCode+=this._pMaterialPass._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pPostAnimationFragmentCode+=this._pMaterialPass._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pPostAnimationFragmentCode+="mov "+this._pRegisterCache.fragmentOutputRegister+", "+this._pSharedRegisters.shadedTarget+"\n",this._pRegisterCache.removeFragmentTempUsage(this._pSharedRegisters.shadedTarget),this._pShaderObject.initConstantData(this._pRegisterCache,this._pAnimatableAttributes,this._pAnimationTargetRegisters,this._uvSource,this._uvTarget),this._pMaterialPass._iInitConstantData(this._pShaderObject)},e.prototype.pCompileDependencies=function(){this._pSharedRegisters.shadedTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadedTarget,1),this._pShaderObject.globalPosDependencies>0&&this.compileGlobalPositionCode(),this._pShaderObject.uvDependencies>0&&this.compileUVCode(),this._pShaderObject.secondaryUVDependencies>0&&this.compileSecondaryUVCode(),this._pShaderObject.normalDependencies>0&&this.compileNormalCode(),this._pShaderObject.viewDirDependencies>0&&this.compileViewDirCode(),this._pVertexCode+=this._pMaterial._iGetVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._pMaterial._iGetFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pVertexCode+=this._pMaterialPass._iGetPreLightingVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._pMaterialPass._iGetPreLightingFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)},e.prototype.compileGlobalPositionCode=function(){this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.globalPositionVertex=this._pRegisterCache.getFreeVertexVectorTemp(),this._pShaderObject.globalPosDependencies);var e=this._pRegisterCache.getFreeVertexConstant();this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pShaderObject.sceneMatrixIndex=4*e.index,this._pVertexCode+="m44 "+this._pSharedRegisters.globalPositionVertex+", "+this._pSharedRegisters.localPosition+", "+e+"\n",this._pShaderObject.usesGlobalPosFragment&&(this._pSharedRegisters.globalPositionVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.globalPositionVarying+", "+this._pSharedRegisters.globalPositionVertex+"\n")},e.prototype.compileUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.uvBufferIndex=e.index;var t=this._pRegisterCache.getFreeVarying();if(this._pSharedRegisters.uvVarying=t,this._pShaderObject.usesUVTransform){var i=this._pRegisterCache.getFreeVertexConstant(),r=this._pRegisterCache.getFreeVertexConstant();this._pShaderObject.uvTransformIndex=4*i.index,this._pVertexCode+="dp4 "+t+".x, "+e+", "+i+"\ndp4 "+t+".y, "+e+", "+r+"\nmov "+t+".zw, "+e+".zw \n"}else this._pShaderObject.uvTransformIndex=-1,this._uvTarget=t.toString(),this._uvSource=e.toString()},e.prototype.compileSecondaryUVCode=function(){var e=this._pRegisterCache.getFreeVertexAttribute();this._pShaderObject.secondaryUVBufferIndex=e.index,this._pSharedRegisters.secondaryUVVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="mov "+this._pSharedRegisters.secondaryUVVarying+", "+e+"\n"},e.prototype.compileViewDirCode=function(){var e=this._pRegisterCache.getFreeVertexConstant();if(this._pSharedRegisters.viewDirVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.viewDirFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.viewDirFragment,this._pShaderObject.viewDirDependencies),this._pShaderObject.cameraPositionIndex=4*e.index,this._pShaderObject.usesTangentSpace){var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+t+", "+e+", "+this._pSharedRegisters.localPosition+"\nm33 "+this._pSharedRegisters.viewDirVarying+".xyz, "+t+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.viewDirVarying+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._pVertexCode+="sub "+this._pSharedRegisters.viewDirVarying+", "+e+", "+this._pSharedRegisters.globalPositionVertex+"\n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.globalPositionVertex);this._pFragmentCode+="nrm "+this._pSharedRegisters.viewDirFragment+".xyz, "+this._pSharedRegisters.viewDirVarying+"\nmov "+this._pSharedRegisters.viewDirFragment+".w,   "+this._pSharedRegisters.viewDirVarying+".w\n"},e.prototype.compileNormalCode=function(){if(this._pSharedRegisters.normalFragment=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.normalFragment,this._pShaderObject.normalDependencies),this._pShaderObject.outputsNormals&&!this._pShaderObject.outputsTangentNormals)return this._pVertexCode+=this._pMaterialPass._iGetNormalVertexCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters),void(this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters));
var e;if(this._pShaderObject.outputsNormals&&this._pShaderObject.usesTangentSpace||(e=new Array(3),e[0]=this._pRegisterCache.getFreeVertexConstant(),e[1]=this._pRegisterCache.getFreeVertexConstant(),e[2]=this._pRegisterCache.getFreeVertexConstant(),this._pRegisterCache.getFreeVertexConstant(),this._pShaderObject.sceneNormalMatrixIndex=4*e[0].index,this._pSharedRegisters.normalVarying=this._pRegisterCache.getFreeVarying()),this._pShaderObject.outputsNormals)if(this._pShaderObject.usesTangentSpace)this._pVertexCode+="nrm "+this._pSharedRegisters.animatedNormal+".xyz, "+this._pSharedRegisters.animatedNormal+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+this._pSharedRegisters.animatedTangent+"\ncrs "+this._pSharedRegisters.bitangent+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\n",this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters);else{this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pSharedRegisters.bitangentVarying=this._pRegisterCache.getFreeVarying();var t=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="m33 "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\nnrm "+this._pSharedRegisters.animatedNormal+".xyz, "+t+"\nm33 "+t+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\nnrm "+this._pSharedRegisters.animatedTangent+".xyz, "+t+"\nmov "+this._pSharedRegisters.tangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".x  \nmov "+this._pSharedRegisters.tangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".x  \nmov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.bitangentVarying+".x, "+this._pSharedRegisters.animatedTangent+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".z, "+this._pSharedRegisters.animatedNormal+".y  \nmov "+this._pSharedRegisters.bitangentVarying+".w, "+this._pSharedRegisters.normalInput+".w  \nmov "+this._pSharedRegisters.normalVarying+".x, "+this._pSharedRegisters.animatedTangent+".z  \nmov "+this._pSharedRegisters.normalVarying+".z, "+this._pSharedRegisters.animatedNormal+".z  \nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.normalInput+".w  \ncrs "+t+".xyz, "+this._pSharedRegisters.animatedNormal+", "+this._pSharedRegisters.animatedTangent+"\nmov "+this._pSharedRegisters.tangentVarying+".y, "+t+".x    \nmov "+this._pSharedRegisters.bitangentVarying+".y, "+t+".y  \nmov "+this._pSharedRegisters.normalVarying+".y, "+t+".z    \n",this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedTangent);var i,r,a;i=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(i,1),r=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(r,1),a=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(a,1),this._pFragmentCode+="nrm "+i+".xyz, "+this._pSharedRegisters.tangentVarying+"\nmov "+i+".w, "+this._pSharedRegisters.tangentVarying+".w	\nnrm "+r+".xyz, "+this._pSharedRegisters.bitangentVarying+"\nnrm "+a+".xyz, "+this._pSharedRegisters.normalVarying+"\n",this._pFragmentCode+=this._pMaterialPass._iGetNormalFragmentCode(this._pShaderObject,this._pRegisterCache,this._pSharedRegisters)+"m33 "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalFragment+", "+i+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n",this._pRegisterCache.removeFragmentTempUsage(r),this._pRegisterCache.removeFragmentTempUsage(i),this._pRegisterCache.removeFragmentTempUsage(a)}else this._pVertexCode+="m33 "+this._pSharedRegisters.normalVarying+".xyz, "+this._pSharedRegisters.animatedNormal+", "+e[0]+"\nmov "+this._pSharedRegisters.normalVarying+".w, "+this._pSharedRegisters.animatedNormal+".w\n",this._pFragmentCode+="nrm "+this._pSharedRegisters.normalFragment+".xyz, "+this._pSharedRegisters.normalVarying+"\nmov "+this._pSharedRegisters.normalFragment+".w, "+this._pSharedRegisters.normalVarying+".w\n",this._pShaderObject.tangentDependencies>0&&(this._pSharedRegisters.tangentVarying=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="m33 "+this._pSharedRegisters.tangentVarying+".xyz, "+this._pSharedRegisters.animatedTangent+", "+e[0]+"\nmov "+this._pSharedRegisters.tangentVarying+".w, "+this._pSharedRegisters.animatedTangent+".w\n");this._pShaderObject.usesTangentSpace||this._pRegisterCache.removeVertexTempUsage(this._pSharedRegisters.animatedNormal)},e.prototype.pInitRegisterIndices=function(){this._pShaderObject.pInitRegisterIndices(),this._pAnimatableAttributes=new Array("va0"),this._pAnimationTargetRegisters=new Array("vt0"),this._pVertexCode="",this._pFragmentCode="",this._pPostAnimationFragmentCode="",this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.localPosition=this._pRegisterCache.getFreeVertexVectorTemp(),1),this._pSharedRegisters.commons=this._pRegisterCache.getFreeFragmentConstant(),this._pShaderObject.commonsDataIndex=4*this._pSharedRegisters.commons.index,(this._pShaderObject.tangentDependencies>0||this._pShaderObject.outputsNormals)&&(this._pSharedRegisters.tangentInput=this._pRegisterCache.getFreeVertexAttribute(),this._pShaderObject.tangentBufferIndex=this._pSharedRegisters.tangentInput.index,this._pSharedRegisters.animatedTangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedTangent,1),this._pShaderObject.usesTangentSpace&&(this._pSharedRegisters.bitangent=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.bitangent,1)),this._pAnimatableAttributes.push(this._pSharedRegisters.tangentInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedTangent.toString())),this._pShaderObject.normalDependencies>0&&(this._pSharedRegisters.normalInput=this._pRegisterCache.getFreeVertexAttribute(),this._pShaderObject.normalBufferIndex=this._pSharedRegisters.normalInput.index,this._pSharedRegisters.animatedNormal=this._pRegisterCache.getFreeVertexVectorTemp(),this._pRegisterCache.addVertexTempUsages(this._pSharedRegisters.animatedNormal,1),this._pAnimatableAttributes.push(this._pSharedRegisters.normalInput.toString()),this._pAnimationTargetRegisters.push(this._pSharedRegisters.animatedNormal.toString()))},e.prototype.pCalculateDependencies=function(){this._pShaderObject.useAlphaPremultiplied=this._pMaterial.alphaPremultiplied,this._pShaderObject.useBothSides=this._pMaterial.bothSides,this._pShaderObject.useMipmapping=this._pMaterial.mipmap,this._pShaderObject.useSmoothTextures=this._pMaterial.smooth,this._pShaderObject.repeatTextures=this._pMaterial.repeat,this._pShaderObject.usesUVTransform=this._pMaterial.animateUVs,this._pShaderObject.alphaThreshold=this._pMaterial.alphaThreshold,this._pShaderObject.texture=this._pMaterial.texture,this._pShaderObject.color=this._pMaterial.color,this._pShaderObject.usesFragmentAnimation=Boolean(this._pMaterialPass.passMode==a.SUPER_SHADER),this._pMaterialPass._iIncludeDependencies(this._pShaderObject)},e.prototype.dispose=function(){this._pRegisterCache.dispose(),this._pRegisterCache=null,this._pSharedRegisters=null},Object.defineProperty(e.prototype,"vertexCode",{get:function(){return this._pVertexCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentCode",{get:function(){return this._pFragmentCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"postAnimationFragmentCode",{get:function(){return this._pPostAnimationFragmentCode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadedTarget",{get:function(){return this._pSharedRegisters.shadedTarget.toString()},enumerable:!0,configurable:!0}),e}();t.exports=s},{"awayjs-renderergl/lib/materials/compilation/ShaderRegisterCache":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterData":void 0,"awayjs-renderergl/lib/materials/passes/MaterialPassMode":void 0}],"awayjs-renderergl/lib/materials/compilation/ShaderLightingCompiler":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/materials/LightSources"),a=e("awayjs-stagegl/lib/base/ContextGLProfile"),s=e("awayjs-renderergl/lib/materials/compilation/ShaderCompilerBase"),n=function(e){function t(t,i,r){e.call(this,t,i,r),this._materialLightingPass=i,this._shaderLightingObject=r}return i(t,e),t.prototype.pCompileDependencies=function(){e.prototype.pCompileDependencies.call(this),this._shaderLightingObject.usesShadows&&this.pCompileShadowCode(),this._shaderLightingObject.usesLights&&(this.initLightRegisters(),this.compileLightCode()),this._shaderLightingObject.usesProbes&&this.compileLightProbeCode(),this._pVertexCode+=this._materialLightingPass._iGetPostLightingVertexCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters),this._pFragmentCode+=this._materialLightingPass._iGetPostLightingFragmentCode(this._shaderLightingObject,this._pRegisterCache,this._pSharedRegisters)},t.prototype.pCompileShadowCode=function(){this._shaderLightingObject.normalDependencies>0?this._pSharedRegisters.shadowTarget=this._pSharedRegisters.normalFragment:(this._pSharedRegisters.shadowTarget=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(this._pSharedRegisters.shadowTarget,1))},t.prototype.initLightRegisters=function(){var e,t;if(this._dirLightVertexConstants)for(t=this._dirLightVertexConstants.length,e=0;t>e;++e)this._dirLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant(),-1==this._shaderLightingObject.lightVertexConstantIndex&&(this._shaderLightingObject.lightVertexConstantIndex=4*this._dirLightVertexConstants[e].index);if(this._pointLightVertexConstants)for(t=this._pointLightVertexConstants.length,e=0;t>e;++e)this._pointLightVertexConstants[e]=this._pRegisterCache.getFreeVertexConstant(),-1==this._shaderLightingObject.lightVertexConstantIndex&&(this._shaderLightingObject.lightVertexConstantIndex=4*this._pointLightVertexConstants[e].index);for(t=this._dirLightFragmentConstants.length,e=0;t>e;++e)this._dirLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*this._dirLightFragmentConstants[e].index);for(t=this._pointLightFragmentConstants.length,e=0;t>e;++e)this._pointLightFragmentConstants[e]=this._pRegisterCache.getFreeFragmentConstant(),-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*this._pointLightFragmentConstants[e].index)},t.prototype.compileLightCode=function(){for(var e,t,i,r,a=0,s=0,n=this._shaderLightingObject.usesLightsForSpecular,o=this._shaderLightingObject.usesLightsForDiffuse,h=0;h<this._materialLightingPass.iNumDirectionalLights;++h){if(this._shaderLightingObject.usesTangentSpace){r=this._dirLightVertexConstants[a++];var l=this._pRegisterCache.getFreeVarying();this._pVertexCode+="m33 "+l+".xyz, "+r+", "+this._pSharedRegisters.animatedTangent+"\nmov "+l+".w, "+r+".w\n",r=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addVertexTempUsages(r,1),this._pFragmentCode+="nrm "+r+".xyz, "+l+"\nmov "+r+".w, "+l+".w\n"}else r=this._dirLightFragmentConstants[s++];e=this._dirLightFragmentConstants[s++],t=this._dirLightFragmentConstants[s++],o&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters)),n&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters)),this._shaderLightingObject.usesTangentSpace&&this._pRegisterCache.removeVertexTempUsage(r)}a=0,s=0;for(var h=0;h<this._materialLightingPass.iNumPointLights;++h){i=this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment?this._pointLightVertexConstants[a++]:this._pointLightFragmentConstants[s++],e=this._pointLightFragmentConstants[s++],t=this._pointLightFragmentConstants[s++],r=this._pRegisterCache.getFreeFragmentVectorTemp(),this._pRegisterCache.addFragmentTempUsages(r,1);var l;if(this._shaderLightingObject.usesTangentSpace){l=this._pRegisterCache.getFreeVarying();var p=this._pRegisterCache.getFreeVertexVectorTemp();this._pVertexCode+="sub "+p+", "+i+", "+this._pSharedRegisters.localPosition+"\nm33 "+l+".xyz, "+p+", "+this._pSharedRegisters.animatedTangent+"\nmov "+l+".w, "+this._pSharedRegisters.localPosition+".w\n"}else this._shaderLightingObject.usesGlobalPosFragment?(l=r,this._pFragmentCode+="sub "+r+", "+i+", "+this._pSharedRegisters.globalPositionVarying+"\n"):(l=this._pRegisterCache.getFreeVarying(),this._pVertexCode+="sub "+l+", "+i+", "+this._pSharedRegisters.globalPositionVertex+"\n");this._pFragmentCode+=this._shaderLightingObject.usesLightFallOff?"dp3 "+r+".w, "+l+", "+l+"\nsub "+r+".w, "+r+".w, "+e+".w\nmul "+r+".w, "+r+".w, "+t+".w\nsat "+r+".w, "+r+".w\nsub "+r+".w, "+this._pSharedRegisters.commons+".w, "+r+".w\nnrm "+r+".xyz, "+l+"\n":"nrm "+r+".xyz, "+l+"\nmov "+r+".w, "+l+".w\n",-1==this._shaderLightingObject.lightFragmentConstantIndex&&(this._shaderLightingObject.lightFragmentConstantIndex=4*i.index),o&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightDiffuseFragmentCode(this._shaderLightingObject,r,e,this._pRegisterCache,this._pSharedRegisters)),n&&(this._pFragmentCode+=this._materialLightingPass._iGetPerLightSpecularFragmentCode(this._shaderLightingObject,r,t,this._pRegisterCache,this._pSharedRegisters)),this._pRegisterCache.removeFragmentTempUsage(r)}},t.prototype.compileLightProbeCode=function(){var e,t,i,r=[".x",".y",".z",".w"],a=new Array,s=this._shaderLightingObject.usesProbesForSpecular,n=this._shaderLightingObject.usesProbesForDiffuse;for(n&&(this._shaderLightingObject.lightProbeDiffuseIndices=new Array),s&&(this._shaderLightingObject.lightProbeSpecularIndices=new Array),t=0;t<this._pNumProbeRegisters;++t)a[t]=this._pRegisterCache.getFreeFragmentConstant(),0==t&&(this._shaderLightingObject.probeWeightsIndex=4*a[t].index);for(t=0;t<this._materialLightingPass.iNumLightProbes;++t)e=a[Math.floor(t/4)].toString()+r[t%4],n&&(i=this._pRegisterCache.getFreeTextureReg(),this._shaderLightingObject.lightProbeDiffuseIndices[t]=i.index,this._pFragmentCode+=this._materialLightingPass._iGetPerProbeDiffuseFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters)),s&&(i=this._pRegisterCache.getFreeTextureReg(),this._shaderLightingObject.lightProbeSpecularIndices[t]=i.index,this._pFragmentCode+=this._materialLightingPass._iGetPerProbeSpecularFragmentCode(this._shaderLightingObject,i,e,this._pRegisterCache,this._pSharedRegisters))},t.prototype.pInitRegisterIndices=function(){e.prototype.pInitRegisterIndices.call(this),this._shaderLightingObject.lightVertexConstantIndex=-1,this._shaderLightingObject.lightFragmentConstantIndex=-1,this._shaderLightingObject.probeWeightsIndex=-1,this._pNumProbeRegisters=Math.ceil(this._materialLightingPass.iNumLightProbes/4),this._shaderLightingObject.usesTangentSpace||!this._shaderLightingObject.usesGlobalPosFragment?(this._pointLightVertexConstants=new Array(this._materialLightingPass.iNumPointLights),this._pointLightFragmentConstants=new Array(2*this._materialLightingPass.iNumPointLights)):this._pointLightFragmentConstants=new Array(3*this._materialLightingPass.iNumPointLights),this._shaderLightingObject.usesTangentSpace?(this._dirLightVertexConstants=new Array(this._materialLightingPass.iNumDirectionalLights),this._dirLightFragmentConstants=new Array(2*this._materialLightingPass.iNumDirectionalLights)):this._dirLightFragmentConstants=new Array(3*this._materialLightingPass.iNumDirectionalLights)},t.prototype.pCalculateDependencies=function(){var t=this._materialLightingPass.iNumPointLights+this._materialLightingPass.iNumDirectionalLights,i=this._materialLightingPass.iNumLightProbes,s=this._pMaterial.diffuseLightSources,n=this._materialLightingPass._iUsesSpecular()?this._pMaterial.specularLightSources:0,o=s|n;this._shaderLightingObject.usesLightFallOff=this._pMaterial.enableLightFallOff&&this._shaderLightingObject.profile!=a.BASELINE_CONSTRAINED,this._shaderLightingObject.numLights=t+i,this._shaderLightingObject.numPointLights=this._materialLightingPass.iNumPointLights,this._shaderLightingObject.numDirectionalLights=this._materialLightingPass.iNumDirectionalLights,this._shaderLightingObject.numLightProbes=i,this._shaderLightingObject.pointLightsOffset=this._materialLightingPass.pointLightsOffset,this._shaderLightingObject.directionalLightsOffset=this._materialLightingPass.directionalLightsOffset,this._shaderLightingObject.lightProbesOffset=this._materialLightingPass.lightProbesOffset,this._shaderLightingObject.lightPicker=this._materialLightingPass.lightPicker,this._shaderLightingObject.usesLights=t>0&&0!=(o&r.LIGHTS),this._shaderLightingObject.usesProbes=i>0&&0!=(o&r.PROBES),this._shaderLightingObject.usesLightsForSpecular=t>0&&0!=(n&r.LIGHTS),this._shaderLightingObject.usesProbesForSpecular=i>0&&0!=(n&r.PROBES),this._shaderLightingObject.usesLightsForDiffuse=t>0&&0!=(s&r.LIGHTS),this._shaderLightingObject.usesProbesForDiffuse=i>0&&0!=(s&r.PROBES),this._shaderLightingObject.usesShadows=this._materialLightingPass._iUsesShadows(),e.prototype.pCalculateDependencies.call(this)},t}(s);t.exports=n},{"awayjs-display/lib/materials/LightSources":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderCompilerBase":void 0,"awayjs-stagegl/lib/base/ContextGLProfile":void 0}],"awayjs-renderergl/lib/materials/compilation/ShaderLightingObject":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/compilation/ShaderLightingCompiler"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderObjectBase"),s=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.createCompiler=function(e,t){return new r(e,t,this)},t.prototype.reset=function(){e.prototype.reset.call(this),this.numLights=0,this.usesLightFallOff=!0},t.prototype.addWorldSpaceDependencies=function(t){e.prototype.addWorldSpaceDependencies.call(this,t),this.numPointLights>0&&this.usesLights&&(++this.globalPosDependencies,t&&(this.usesGlobalPosFragment=!0))},t.prototype.setRenderState=function(t,i,r,a){e.prototype.setRenderState.call(this,t,i,r,a),this.usesLights&&this.updateLights(),this.usesProbes&&this.updateProbes(i)},t.prototype.updateLights=function(){var e,t,i,r,a,s,n=0,o=0,h=0,l=this.usesShadows?2:1;this.ambientR=this.ambientG=this.ambientB=0,a=this.lightVertexConstantIndex,o=this.lightFragmentConstantIndex;var p=0,d=this.lightPicker.directionalLights;for(s=this.directionalLightsOffset,i=this.lightPicker.directionalLights.length,s>i&&(p=1,s-=i);l>p;++p)for(p&&(d=this.lightPicker.castingDirectionalLights),i=d.length,i>this.numDirectionalLights&&(i=this.numDirectionalLights),n=0;i>n;++n){if(e=d[s+n],r=e.sceneDirection,this.ambientR+=e._iAmbientR,this.ambientG+=e._iAmbientG,this.ambientB+=e._iAmbientB,this.usesTangentSpace){var c=-r.x,u=-r.y,g=-r.z;this.vertexConstantData[a++]=this._pInverseSceneMatrix[0]*c+this._pInverseSceneMatrix[4]*u+this._pInverseSceneMatrix[8]*g,this.vertexConstantData[a++]=this._pInverseSceneMatrix[1]*c+this._pInverseSceneMatrix[5]*u+this._pInverseSceneMatrix[9]*g,this.vertexConstantData[a++]=this._pInverseSceneMatrix[2]*c+this._pInverseSceneMatrix[6]*u+this._pInverseSceneMatrix[10]*g,this.vertexConstantData[a++]=1}else this.fragmentConstantData[o++]=-r.x,this.fragmentConstantData[o++]=-r.y,this.fragmentConstantData[o++]=-r.z,this.fragmentConstantData[o++]=1;this.fragmentConstantData[o++]=e._iDiffuseR,this.fragmentConstantData[o++]=e._iDiffuseG,this.fragmentConstantData[o++]=e._iDiffuseB,this.fragmentConstantData[o++]=1,this.fragmentConstantData[o++]=e._iSpecularR,this.fragmentConstantData[o++]=e._iSpecularG,this.fragmentConstantData[o++]=e._iSpecularB,this.fragmentConstantData[o++]=1,++h==this.numDirectionalLights&&(n=i,p=l)}if(this.numDirectionalLights>h)for(n=o+12*(this.numDirectionalLights-h);n>o;)this.fragmentConstantData[o++]=0;h=0;var _=this.lightPicker.pointLights;for(s=this.pointLightsOffset,i=this.lightPicker.pointLights.length,s>i?(p=1,s-=i):p=0;l>p;++p)for(p&&(_=this.lightPicker.castingPointLights),i=_.length,n=0;i>n;++n){t=_[s+n],r=t.scenePosition,this.ambientR+=t._iAmbientR,this.ambientG+=t._iAmbientG,this.ambientB+=t._iAmbientB,this.usesTangentSpace?(c=r.x,u=r.y,g=r.z,this.vertexConstantData[a++]=this._pInverseSceneMatrix[0]*c+this._pInverseSceneMatrix[4]*u+this._pInverseSceneMatrix[8]*g+this._pInverseSceneMatrix[12],this.vertexConstantData[a++]=this._pInverseSceneMatrix[1]*c+this._pInverseSceneMatrix[5]*u+this._pInverseSceneMatrix[9]*g+this._pInverseSceneMatrix[13],this.vertexConstantData[a++]=this._pInverseSceneMatrix[2]*c+this._pInverseSceneMatrix[6]*u+this._pInverseSceneMatrix[10]*g+this._pInverseSceneMatrix[14],this.vertexConstantData[a++]=1):this.usesGlobalPosFragment?(this.fragmentConstantData[o++]=r.x,this.fragmentConstantData[o++]=r.y,this.fragmentConstantData[o++]=r.z,this.fragmentConstantData[o++]=1):(this.vertexConstantData[a++]=r.x,this.vertexConstantData[a++]=r.y,this.vertexConstantData[a++]=r.z,this.vertexConstantData[a++]=1),this.fragmentConstantData[o++]=t._iDiffuseR,this.fragmentConstantData[o++]=t._iDiffuseG,this.fragmentConstantData[o++]=t._iDiffuseB;var m=t._pRadius;this.fragmentConstantData[o++]=m*m,this.fragmentConstantData[o++]=t._iSpecularR,this.fragmentConstantData[o++]=t._iSpecularG,this.fragmentConstantData[o++]=t._iSpecularB,this.fragmentConstantData[o++]=t._pFallOffFactor,++h==this.numPointLights&&(n=i,p=l)}if(this.numPointLights>h)for(n=o+12*(h-this.numPointLights);n>o;++o)this.fragmentConstantData[o]=0},t.prototype.updateProbes=function(e){var t,i=this.lightPicker.lightProbes,r=this.lightPicker.lightProbeWeights,a=i.length-this.lightProbesOffset,s=this.usesProbesForDiffuse,n=this.usesProbesForSpecular;if(s||n){a>this.numLightProbes&&(a=this.numLightProbes);for(var o=0;a>o;++o)t=i[this.lightProbesOffset+o],s&&e.activateCubeTexture(this.lightProbeDiffuseIndices[o],t.diffuseMap),n&&e.activateCubeTexture(this.lightProbeSpecularIndices[o],t.specularMap);for(o=0;a>o;++o)this.fragmentConstantData[this.probeWeightsIndex+o]=r[this.lightProbesOffset+o]}},t}(a);t.exports=s},{"awayjs-renderergl/lib/materials/compilation/ShaderLightingCompiler":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderObjectBase":void 0}],"awayjs-renderergl/lib/materials/compilation/ShaderObjectBase":[function(e,t){var i=e("awayjs-display/lib/base/TriangleSubGeometry"),r=e("awayjs-stagegl/lib/base/ContextGLTriangleFace"),a=e("awayjs-renderergl/lib/materials/compilation/ShaderCompilerBase"),s=function(){function e(e){this._defaultCulling=r.BACK,this._pInverseSceneMatrix=new Array,this.ambientR=255,this.ambientG=255,this.ambientB=255,this.usesGlobalPosFragment=!1,this.vertexConstantData=new Array,this.fragmentConstantData=new Array,this.profile=e}return e.prototype.createCompiler=function(e,t){return new a(e,t,this)},e.prototype.reset=function(){this.projectionDependencies=0,this.normalDependencies=0,this.viewDirDependencies=0,this.uvDependencies=0,this.secondaryUVDependencies=0,this.globalPosDependencies=0,this.tangentDependencies=0,this.usesGlobalPosFragment=!1,this.usesFragmentAnimation=!1,this.usesTangentSpace=!1,this.outputsNormals=!1,this.outputsTangentNormals=!1},e.prototype.addWorldSpaceDependencies=function(){this.viewDirDependencies>0&&++this.globalPosDependencies},e.prototype.pInitRegisterIndices=function(){this.commonsDataIndex=-1,this.cameraPositionIndex=-1,this.uvBufferIndex=-1,this.uvTransformIndex=-1,this.secondaryUVBufferIndex=-1,this.normalBufferIndex=-1,this.tangentBufferIndex=-1,this.sceneMatrixIndex=-1,this.sceneNormalMatrixIndex=-1},e.prototype.initConstantData=function(e,t,i,r,a){this.numUsedVertexConstants=e.numUsedVertexConstants,this.numUsedFragmentConstants=e.numUsedFragmentConstants,this.numUsedStreams=e.numUsedStreams,this.numUsedTextures=e.numUsedTextures,this.numUsedVaryings=e.numUsedVaryings,this.numUsedFragmentConstants=e.numUsedFragmentConstants,this.animatableAttributes=t,this.animationTargetRegisters=i,this.uvSource=r,this.uvTarget=a,this.vertexConstantData.length=4*this.numUsedVertexConstants,this.fragmentConstantData.length=4*this.numUsedFragmentConstants,this.fragmentConstantData[this.commonsDataIndex]=.5,this.fragmentConstantData[this.commonsDataIndex+1]=0,this.fragmentConstantData[this.commonsDataIndex+2]=1/255,this.fragmentConstantData[this.commonsDataIndex+3]=1,this.uvTransformIndex>=0&&(this.vertexConstantData[this.uvTransformIndex]=1,this.vertexConstantData[this.uvTransformIndex+1]=0,this.vertexConstantData[this.uvTransformIndex+2]=0,this.vertexConstantData[this.uvTransformIndex+3]=0,this.vertexConstantData[this.uvTransformIndex+4]=0,this.vertexConstantData[this.uvTransformIndex+5]=1,this.vertexConstantData[this.uvTransformIndex+6]=0,this.vertexConstantData[this.uvTransformIndex+7]=0),this.cameraPositionIndex>=0&&(this.vertexConstantData[this.cameraPositionIndex+3]=1)},e.prototype.iActivate=function(e,t){if(e.context.setCulling(this.useBothSides?r.NONE:this._defaultCulling,t.projection.coordinateSystem),!this.usesTangentSpace&&this.cameraPositionIndex>=0){var i=t.scenePosition;this.vertexConstantData[this.cameraPositionIndex]=i.x,this.vertexConstantData[this.cameraPositionIndex+1]=i.y,this.vertexConstantData[this.cameraPositionIndex+2]=i.z}},e.prototype.iDeactivate=function(){},e.prototype.setRenderState=function(e,t,r){t.context;if(e.materialOwner.animator&&e.materialOwner.animator.setRenderState(this,e,t,r,this.numUsedVertexConstants,this.numUsedStreams),this.uvBufferIndex>=0&&t.activateBuffer(this.uvBufferIndex,e.getVertexData(i.UV_DATA),e.getVertexOffset(i.UV_DATA),i.UV_FORMAT),this.secondaryUVBufferIndex>=0&&t.activateBuffer(this.secondaryUVBufferIndex,e.getVertexData(i.SECONDARY_UV_DATA),e.getVertexOffset(i.SECONDARY_UV_DATA),i.SECONDARY_UV_FORMAT),this.normalBufferIndex>=0&&t.activateBuffer(this.normalBufferIndex,e.getVertexData(i.NORMAL_DATA),e.getVertexOffset(i.NORMAL_DATA),i.NORMAL_FORMAT),this.tangentBufferIndex>=0&&t.activateBuffer(this.tangentBufferIndex,e.getVertexData(i.TANGENT_DATA),e.getVertexOffset(i.TANGENT_DATA),i.TANGENT_FORMAT),this.usesUVTransform){var a=e.materialOwner.uvTransform.matrix;a?(this.vertexConstantData[this.uvTransformIndex]=a.a,this.vertexConstantData[this.uvTransformIndex+1]=a.b,this.vertexConstantData[this.uvTransformIndex+3]=a.tx,this.vertexConstantData[this.uvTransformIndex+4]=a.c,this.vertexConstantData[this.uvTransformIndex+5]=a.d,this.vertexConstantData[this.uvTransformIndex+7]=a.ty):(this.vertexConstantData[this.uvTransformIndex]=1,this.vertexConstantData[this.uvTransformIndex+1]=0,this.vertexConstantData[this.uvTransformIndex+3]=0,this.vertexConstantData[this.uvTransformIndex+4]=0,this.vertexConstantData[this.uvTransformIndex+5]=1,this.vertexConstantData[this.uvTransformIndex+7]=0)}if(this.sceneNormalMatrixIndex>=0&&e.sourceEntity.inverseSceneTransform.copyRawDataTo(this.vertexConstantData,this.sceneNormalMatrixIndex,!1),this.usesTangentSpace&&this.cameraPositionIndex>=0){e.sourceEntity.inverseSceneTransform.copyRawDataTo(this._pInverseSceneMatrix);var s=r.scenePosition,n=s.x,o=s.y,h=s.z;this.vertexConstantData[this.cameraPositionIndex]=this._pInverseSceneMatrix[0]*n+this._pInverseSceneMatrix[4]*o+this._pInverseSceneMatrix[8]*h+this._pInverseSceneMatrix[12],this.vertexConstantData[this.cameraPositionIndex+1]=this._pInverseSceneMatrix[1]*n+this._pInverseSceneMatrix[5]*o+this._pInverseSceneMatrix[9]*h+this._pInverseSceneMatrix[13],this.vertexConstantData[this.cameraPositionIndex+2]=this._pInverseSceneMatrix[2]*n+this._pInverseSceneMatrix[6]*o+this._pInverseSceneMatrix[10]*h+this._pInverseSceneMatrix[14]}},e.prototype.dispose=function(){},e}();t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderCompilerBase":void 0,"awayjs-stagegl/lib/base/ContextGLTriangleFace":void 0}],"awayjs-renderergl/lib/materials/compilation/ShaderRegisterCache":[function(e,t){var i=e("awayjs-renderergl/lib/materials/compilation/RegisterPool"),r=e("awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement"),a=function(){function e(e){this._numUsedVertexConstants=0,this._numUsedFragmentConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._profile=e}return e.prototype.reset=function(){this._fragmentTempCache=new i("ft",8,!1),this._vertexTempCache=new i("vt",8,!1),this._varyingCache=new i("v",8),this._textureCache=new i("fs",8),this._vertexAttributesCache=new i("va",8),this._fragmentConstantsCache=new i("fc",28),this._vertexConstantsCache=new i("vc",128),this._fragmentOutputRegister=new r("oc",-1),this._vertexOutputRegister=new r("op",-1),this._numUsedVertexConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._numUsedFragmentConstants=0;var e;for(e=0;e<this._vertexAttributesOffset;++e)this.getFreeVertexAttribute();for(e=0;e<this._vertexConstantOffset;++e)this.getFreeVertexConstant();for(e=0;e<this._varyingsOffset;++e)this.getFreeVarying();for(e=0;e<this._fragmentConstantOffset;++e)this.getFreeFragmentConstant()},e.prototype.dispose=function(){this._fragmentTempCache.dispose(),this._vertexTempCache.dispose(),this._varyingCache.dispose(),this._fragmentConstantsCache.dispose(),this._vertexAttributesCache.dispose(),this._fragmentTempCache=null,this._vertexTempCache=null,this._varyingCache=null,this._fragmentConstantsCache=null,this._vertexAttributesCache=null,this._fragmentOutputRegister=null,this._vertexOutputRegister=null},e.prototype.addFragmentTempUsages=function(e,t){this._fragmentTempCache.addUsage(e,t)},e.prototype.removeFragmentTempUsage=function(e){this._fragmentTempCache.removeUsage(e)},e.prototype.addVertexTempUsages=function(e,t){this._vertexTempCache.addUsage(e,t)},e.prototype.removeVertexTempUsage=function(e){this._vertexTempCache.removeUsage(e)},e.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()},e.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()},e.prototype.getFreeVarying=function(){return++this._numUsedVaryings,this._varyingCache.requestFreeVectorReg()},e.prototype.getFreeFragmentConstant=function(){return++this._numUsedFragmentConstants,this._fragmentConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexConstant=function(){return++this._numUsedVertexConstants,this._vertexConstantsCache.requestFreeVectorReg()},e.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()},e.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()},e.prototype.getFreeVertexAttribute=function(){return++this._numUsedStreams,this._vertexAttributesCache.requestFreeVectorReg()},e.prototype.getFreeTextureReg=function(){return++this._numUsedTextures,this._textureCache.requestFreeVectorReg()},Object.defineProperty(e.prototype,"vertexConstantOffset",{get:function(){return this._vertexConstantOffset},set:function(e){this._vertexConstantOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributesOffset",{get:function(){return this._vertexAttributesOffset},set:function(e){this._vertexAttributesOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"varyingsOffset",{get:function(){return this._varyingsOffset},set:function(e){this._varyingsOffset=e
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentConstantOffset",{get:function(){return this._fragmentConstantOffset},set:function(e){this._fragmentConstantOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:!0,configurable:!0}),e}();t.exports=a},{"awayjs-renderergl/lib/materials/compilation/RegisterPool":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/materials/compilation/ShaderRegisterData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/materials/compilation/ShaderRegisterElement":[function(e,t){var i=function(){function e(t,i,r){void 0===r&&(r=-1),this._component=r,this._regName=t,this._index=i,this._toStr=this._regName,this._index>=0&&(this._toStr+=this._index),r>-1&&(this._toStr+="."+e.COMPONENTS[r])}return e.prototype.toString=function(){return this._toStr},Object.defineProperty(e.prototype,"regName",{get:function(){return this._regName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e.COMPONENTS=["x","y","z","w"],e}();t.exports=i},{}],"awayjs-renderergl/lib/materials/methods/AmbientBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/materials/methods/ShadingMethodBase"),o=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),h=function(e){function t(){e.call(this),this._color=16777215,this._alpha=1,this._colorR=1,this._colorG=1,this._colorB=1,this._ambient=1}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsUV=Boolean(null!=e.texture)},t.prototype.iInitConstants=function(e,t){t.needsUV||(this._color=e.color,this.updateColor())},Object.defineProperty(t.prototype,"ambient",{get:function(){return this._ambient},set:function(e){this._ambient!=e&&(this._ambient=e,this.updateColor())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!=e&&(this._alpha=e,this.updateColor())},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(e){},t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s,n="";if(t.needsUV){if(s=r.getFreeTextureReg(),t.texturesIndex=s.index,n+=o.getTex2DSampleCode(i,a,s,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping),e.alphaThreshold>0){var h=r.getFreeFragmentConstant();t.fragmentConstantsIndex=4*h.index,n+="sub "+i+".w, "+i+".w, "+h+".x\nkil "+i+".w\nadd "+i+".w, "+i+".w, "+h+".x\n"}}else s=r.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*s.index,n+="mov "+i+", "+s+"\n";return n},t.prototype.iActivate=function(e,t,i){if(t.needsUV)i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?s.REPEAT:s.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.activateTexture(t.texturesIndex,e.texture),e.alphaThreshold>0&&(e.fragmentConstantData[t.fragmentConstantsIndex]=e.alphaThreshold);else{var n=t.fragmentConstantsIndex,o=e.fragmentConstantData;o[n]=this._colorR,o[n+1]=this._colorG,o[n+2]=this._colorB,o[n+3]=this._alpha}},t.prototype.updateColor=function(){this._colorR=(this._color>>16&255)/255*this._ambient,this._colorG=(this._color>>8&255)/255*this._ambient,this._colorB=(255&this._color)/255*this._ambient},t}(n);t.exports=h},{"awayjs-renderergl/lib/materials/methods/ShadingMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/methods/AmbientEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/AmbientBasicMethod"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t){e.call(this),this._cubeTexture=t}return i(t,e),t.prototype.iInitVO=function(t,i){e.prototype.iInitVO.call(this,t,i),i.needsNormals=!0},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r),r.activateCubeTexture(i.texturesIndex,this._cubeTexture)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var n,o="",h=r.getFreeTextureReg();return t.texturesIndex=h.index,o+=a.getTexCubeSampleCode(i,h,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,s.normalFragment),n=r.getFreeFragmentConstant(),t.fragmentConstantsIndex=n.index,o+="add "+i+".xyz, "+i+".xyz, "+n+".xyz\n"},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/AmbientBasicMethod":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/materials/methods/LightingMethodBase"),o=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),h=function(e){function t(){e.call(this),this._multiply=!0,this._diffuseColor=16777215,this._ambientColor=16777215,this._diffuseR=1,this._diffuseG=1,this._diffuseB=1,this._ambientR=1,this._ambientG=1,this._ambientB=1}return i(t,e),t.prototype.iIsUsed=function(e){return e.numLights?!0:!1},Object.defineProperty(t.prototype,"multiply",{get:function(){return this._multiply},set:function(e){this._multiply!=e&&(this._multiply=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture,t.needsNormals=e.numLights>0},t.prototype.generateMip=function(e){this._pUseTexture&&e.activateTexture(0,this._texture)},Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){this._diffuseColor!=e&&(this._diffuseColor=e,this.updateDiffuse())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(e){this._ambientColor!=e&&(this._ambientColor=e,this.updateAmbient())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._pUseTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._texture=null},t.prototype.copyFrom=function(e){var t=e;this.texture=t.texture,this.multiply=t.multiply,this.diffuseColor=t.diffuseColor,this.ambientColor=t.ambientColor},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pTotalLightColorReg=null,this._pDiffuseInputRegister=null},t.prototype.iGetFragmentPreLightingCode=function(e,t,i){var r="";return this._pIsFirstLight=!0,this._pTotalLightColorReg=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._pTotalLightColorReg,1),r},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var n,o="";return this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1)),o+="dp3 "+n+".x, "+i+", "+s.normalFragment+"\nmax "+n+".w, "+n+".x, "+s.commons+".y\n",e.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+i+".w\n"),null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,s)),o+="mul "+n+", "+n+".w, "+r+"\n",this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,r,a,s){var n,o="";return this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1)),o+="tex "+n+", "+s.normalFragment+", "+i+" <cube,linear,miplinear>\nmul "+n+".xyz, "+n+".xyz, "+r+"\n",null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,s)),this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,a){var s,n="";a.shadowTarget&&(n+=this.pApplyShadow(e,t,r,a)),s=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(s,1);var h=r.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*h.index,this._pUseTexture?(this._pDiffuseInputRegister=r.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,n+=o.getTex2DSampleCode(s,a,this._pDiffuseInputRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)):(this._pDiffuseInputRegister=r.getFreeFragmentConstant(),n+="mov "+s+", "+this._pDiffuseInputRegister+"\n"),n+="sat "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+"\nmul "+s+".xyz, "+s+", "+this._pTotalLightColorReg+"\n",n+=this._multiply?"add "+s+".xyz, "+s+", "+h+"\nmul "+i+".xyz, "+i+", "+s+"\n":"mul "+i+".xyz, "+i+", "+h+"\nmul "+this._pTotalLightColorReg+".xyz, "+i+", "+this._pTotalLightColorReg+"\nsub "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\nadd "+i+".xyz, "+i+", "+s+"\n",r.removeFragmentTempUsage(this._pTotalLightColorReg),r.removeFragmentTempUsage(s),n},t.prototype.pApplyShadow=function(e,t,i,r){return"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+r.shadowTarget+".w\n"},t.prototype.iActivate=function(e,t,i){if(this._pUseTexture)i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?s.REPEAT:s.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.activateTexture(t.texturesIndex,this._texture);else{var n=t.fragmentConstantsIndex,o=e.fragmentConstantData;o[n+4]=this._diffuseR,o[n+5]=this._diffuseG,o[n+6]=this._diffuseB,o[n+7]=1}},t.prototype.updateDiffuse=function(){this._diffuseR=(this._diffuseColor>>16&255)/255,this._diffuseG=(this._diffuseColor>>8&255)/255,this._diffuseB=(255&this._diffuseColor)/255},t.prototype.updateAmbient=function(){this._ambientR=(this._ambientColor>>16&255)/255,this._ambientG=(this._ambientColor>>8&255)/255,this._ambientB=(255&this._ambientColor)/255},t.prototype.iSetRenderState=function(e,t){if(e.numLights>0){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i]=e.ambientR*this._ambientR,r[i+1]=e.ambientG*this._ambientG,r[i+2]=e.ambientB*this._ambientB,r[i+3]=1}},t}(n);t.exports=h},{"awayjs-renderergl/lib/materials/methods/LightingMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseCelMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod"),a=function(e){function t(t,i){var r=this;void 0===t&&(t=3),void 0===i&&(i=null),e.call(this,null,i),this._smoothness=.1,this.baseMethod._iModulateMethod=function(e,t,i,a,s){return r.clampDiffuse(e,t,i,a,s)},this._levels=t}return i(t,e),t.prototype.iInitConstants=function(t,i){var r=t.fragmentConstantData,a=i.secondaryFragmentConstantsIndex;e.prototype.iInitConstants.call(this,t,i),r[a+1]=1,r[a+2]=0},Object.defineProperty(t.prototype,"levels",{get:function(){return this._levels},set:function(e){this._levels=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._dataReg=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=t.fragmentConstantData,s=i.secondaryFragmentConstantsIndex;a[s]=this._levels,a[s+3]=this._smoothness},t.prototype.clampDiffuse=function(e,t,i){return"mul "+i+".w, "+i+".w, "+this._dataReg+".x\nfrc "+i+".z, "+i+".w\nsub "+i+".y, "+i+".w, "+i+".z\nmov "+i+".x, "+this._dataReg+".x\nsub "+i+".x, "+i+".x, "+this._dataReg+".y\nrcp "+i+".x,"+i+".x\nmul "+i+".w, "+i+".y, "+i+".x\nsub "+i+".y, "+i+".w, "+i+".x\ndiv "+i+".z, "+i+".z, "+this._dataReg+".w\nsat "+i+".z, "+i+".z\nmul "+i+".w, "+i+".w, "+i+".z\nsub "+i+".z, "+this._dataReg+".y, "+i+".z\nmul "+i+".y, "+i+".y, "+i+".z\nadd "+i+".w, "+i+".w, "+i+".y\nsat "+i+".w, "+i+".w\n"},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),a=e("awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod"),s=function(e){function t(t,i){var s=this;void 0===i&&(i=null),e.call(this),this._onShaderInvalidatedDelegate=function(e){return s.onShaderInvalidated(e)},this.pBaseMethod=i||new a,this.pBaseMethod._iModulateMethod=t,this.pBaseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return i(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(e){this.pBaseMethod!=e&&(this.pBaseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod=e,this.pBaseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){this.pBaseMethod.iInitVO(e,t)},t.prototype.iInitConstants=function(e,t){this.pBaseMethod.iInitConstants(e,t)},t.prototype.dispose=function(){this.pBaseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod.dispose()},Object.defineProperty(t.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(e){this.pBaseMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this.pBaseMethod.diffuseColor},set:function(e){this.pBaseMethod.diffuseColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this.pBaseMethod.ambientColor},set:function(e){this.pBaseMethod.ambientColor=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentPreLightingCode=function(e,t,i,r){return this.pBaseMethod.iGetFragmentPreLightingCode(e,t,i,r)},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var n=this.pBaseMethod.iGetFragmentCodePerLight(e,t,i,r,a,s);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,n},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,r,a,s){var n=this.pBaseMethod.iGetFragmentCodePerProbe(e,t,i,r,a,s);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,n},t.prototype.iActivate=function(e,t,i){this.pBaseMethod.iActivate(e,t,i)},t.prototype.iSetRenderState=function(e,t,i,r,a){this.pBaseMethod.iSetRenderState(e,t,i,r,a)},t.prototype.iDeactivate=function(e,t,i){this.pBaseMethod.iDeactivate(e,t,i)},t.prototype.iGetVertexCode=function(e,t,i,r){return this.pBaseMethod.iGetVertexCode(e,t,i,r)},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,a){return this.pBaseMethod.iGetFragmentPostLightingCode(e,t,i,r,a)},t.prototype.iReset=function(){this.pBaseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this.pBaseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(a);t.exports=s},{"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseDepthMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,r=t.fragmentConstantsIndex;i[r]=1,i[r+1]=1/255,i[r+2]=1/65025,i[r+3]=1/16581375},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,s){var n,o,h="";if(!this._pUseTexture)throw new Error("DiffuseDepthMethod requires texture!");return e.numLights>0&&(s.shadowTarget&&(h+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s.shadowTarget+".w\n"),h+="add "+i+".xyz, "+this._pTotalLightColorReg+".xyz, "+i+".xyz\nsat "+i+".xyz, "+i+".xyz\n",r.removeFragmentTempUsage(this._pTotalLightColorReg)),n=e.numLights>0?r.getFreeFragmentVectorTemp():i,this._pDiffuseInputRegister=r.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,o=r.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*o.index,h+=a.getTex2DSampleCode(n,s,this._pDiffuseInputRegister,this.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"dp4 "+n+".x, "+n+", "+o+"\nmov "+n+".yz, "+n+".xx			\nmov "+n+".w, "+o+".x\nsub "+n+".xyz, "+o+".xxx, "+n+".xyz\n",0==e.numLights?h:h+="mul "+i+".xyz, "+n+".xyz, "+i+".xyz\nmov "+i+".w, "+n+".w\n"},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseGradientMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t){e.call(this),this._gradient=t}return i(t,e),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._gradient},set:function(e){(e.hasMipmaps!=this._gradient.hasMipmaps||e.format!=this._gradient.format)&&this.iInvalidateShaderProgram(),this._gradient=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._gradientTextureRegister=null},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){var s=e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a);return this._pIsFirstLight=!0,t.numLights>0&&(this._gradientTextureRegister=r.getFreeTextureReg(),i.secondaryTexturesIndex=this._gradientTextureRegister.index),s},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,s,n){var o,h="";return this._pIsFirstLight?o=this._pTotalLightColorReg:(o=s.getFreeFragmentVectorTemp(),s.addFragmentTempUsages(o,1)),h+="dp3 "+o+".w, "+i+".xyz, "+n.normalFragment+".xyz\nmul "+o+".w, "+o+".w, "+n.commons+".x\nadd "+o+".w, "+o+".w, "+n.commons+".x\nmul "+o+".xyz, "+o+".w, "+i+".w\n",null!=this._iModulateMethod&&(h+=this._iModulateMethod(e,t,o,s,n)),h+=a.getTex2DSampleCode(o,n,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,o,"clamp")+"mul "+o+".xyz, "+o+".xyz, "+r+".xyz\n",this._pIsFirstLight||(h+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n",s.removeFragmentTempUsage(o)),this._pIsFirstLight=!1,h},t.prototype.pApplyShadow=function(e,t,i,r){var s=i.getFreeFragmentVectorTemp();return"mov "+s+", "+r.shadowTarget+".wwww\n"+a.getTex2DSampleCode(s,r,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s,"clamp")+"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n"},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r),r.activateTexture(i.secondaryTexturesIndex,this._gradient)},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseLightMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i,r,a){void 0===i&&(i="multiply"),void 0===r&&(r=!1),void 0===a&&(a=null),e.call(this,null,a),this._useSecondaryUV=r,this._lightMapTexture=t,this.blendMode=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightMapTexture",{get:function(){return this._lightMapTexture},set:function(e){this._lightMapTexture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){r.activateTexture(i.secondaryTexturesIndex,this._lightMapTexture),e.prototype.iActivate.call(this,t,i,r)},t.prototype.iGetFragmentPostLightingCode=function(i,r,s,n,o){var h,l=n.getFreeTextureReg(),p=n.getFreeFragmentVectorTemp();switch(r.secondaryTexturesIndex=l.index,h=a.getTex2DSampleCode(p,o,l,this._lightMapTexture,i.useSmoothTextures,i.repeatTextures,i.useMipmapping,o.secondaryUVVarying),this._blendMode){case t.MULTIPLY:h+="mul "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+p+"\n";break;case t.ADD:h+="add "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+p+"\n"}return h+=e.prototype.iGetFragmentPostLightingCode.call(this,i,r,s,n,o)},t.MULTIPLY="multiply",t.ADD="add",t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseSubSurfaceMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod"),a=e("awayjs-renderergl/lib/materials/passes/SingleObjectDepthPass"),s=function(e){function t(t,i,r){var s=this;void 0===t&&(t=512),void 0===i&&(i=15),void 0===r&&(r=null),e.call(this,null,r),this._translucency=1,this._scatterColor=16777215,this._scatterR=1,this._scatterG=1,this._scatterB=1,this.pBaseMethod._iModulateMethod=function(e,t,i,r,a){return s.scatterLight(e,t,i,r,a)},this._passes=new Array,this._depthPass=new a,this._depthPass.textureSize=t,this._depthPass.polyOffset=i,this._passes.push(this._depthPass),this._scattering=.2,this._translucency=1}return i(t,e),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i);var r=t.vertexConstantData,a=i.secondaryVertexConstantsIndex;r[a]=.5,r[a+1]=-.5,r[a+2]=0,r[a+3]=1,r=t.fragmentConstantData,a=i.secondaryFragmentConstantsIndex,r[a+3]=1,r[a+4]=1,r[a+5]=1/255,r[a+6]=1/65025,r[a+7]=1/16581375,r[a+10]=.5,r[a+11]=-.1},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._lightProjVarying=null,this._propReg=null,this._lightColorReg=null,this._colorReg=null,this._decReg=null,this._targetReg=null},Object.defineProperty(t.prototype,"scattering",{get:function(){return this._scattering},set:function(e){this._scattering=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translucency",{get:function(){return this._translucency},set:function(e){this._translucency=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scatterColor",{get:function(){return this._scatterColor},set:function(e){this._scatterColor=e,this._scatterR=(e>>16&255)/255,this._scatterG=(e>>8&255)/255,this._scatterB=(255&e)/255},enumerable:!0,configurable:!0}),t.prototype.iGetVertexCode=function(t,i,r,a){var s,n,o=e.prototype.iGetVertexCode.call(this,t,i,r,a),h=r.getFreeVertexVectorTemp();return n=r.getFreeVertexConstant(),i.secondaryVertexConstantsIndex=4*n.index,this._lightProjVarying=r.getFreeVarying(),s=r.getFreeVertexConstant(),r.getFreeVertexConstant(),r.getFreeVertexConstant(),r.getFreeVertexConstant(),o+="m44 "+h+", vt0, "+s+"\ndiv "+h+".xyz, "+h+".xyz, "+h+".w\nmul "+h+".xy, "+h+".xy, "+n+".xy\nadd "+h+".xy, "+h+".xy, "+n+".xx\nmov "+this._lightProjVarying+".xyz, "+h+".xyz\nmov "+this._lightProjVarying+".w, va0.w\n"},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._colorReg=r.getFreeFragmentConstant(),this._decReg=r.getFreeFragmentConstant(),this._propReg=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._colorReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t.prototype.iGetFragmentCodePerLight=function(t,i,r,a,s,n){return this._pIsFirstLight=!0,this._lightColorReg=a,e.prototype.iGetFragmentCodePerLight.call(this,t,i,r,a,s,n)},t.prototype.iGetFragmentPostLightingCode=function(t,i,r,a,s){var n=e.prototype.iGetFragmentPostLightingCode.call(this,t,i,r,a,s),o=a.getFreeFragmentVectorTemp();return n+="mul "+o+".xyz, "+this._lightColorReg+".xyz, "+this._targetReg+".w\nmul "+o+".xyz, "+o+".xyz, "+this._colorReg+".xyz\nadd "+r+".xyz, "+r+".xyz, "+o+".xyz\n",this._targetReg!=s.viewDirFragment&&a.removeFragmentTempUsage(r),n},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=i.secondaryFragmentConstantsIndex,s=t.fragmentConstantData;s[a]=this._scatterR,s[a+1]=this._scatterG,s[a+2]=this._scatterB,s[a+8]=this._scattering,s[a+9]=this._translucency},t.prototype.iSetRenderState=function(e,t,i,r){r.activateTexture(t.secondaryTexturesIndex,this._depthPass._iGetDepthMap(i)),this._depthPass._iGetProjection(i).copyRawDataTo(e.vertexConstantData,t.secondaryVertexConstantsIndex+4,!0)},t.prototype.scatterLight=function(e,t,i,r,a){if(!this._pIsFirstLight)return"";this._pIsFirstLight=!1;var s="",n=r.getFreeTextureReg();a.viewDirFragment?this._targetReg=a.viewDirFragment:(this._targetReg=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(this._targetReg,1)),t.secondaryTexturesIndex=n.index;var o=r.getFreeFragmentVectorTemp();return s+="tex "+o+", "+this._lightProjVarying+", "+n+" <2d,nearest,clamp>\ndp4 "+i+".z, "+o+", "+this._decReg+"\n",s+="sub "+i+".z, "+this._lightProjVarying+".z, "+i+".z\nsub "+i+".z, "+this._propReg+".x, "+i+".z\nmul "+i+".z, "+this._propReg+".y, "+i+".z\nsat "+i+".z, "+i+".z\nneg "+i+".y, "+i+".x\nmul "+i+".y, "+i+".y, "+this._propReg+".z\nadd "+i+".y, "+i+".y, "+this._propReg+".z\nmul "+this._targetReg+".w, "+i+".z, "+i+".y\nsub "+i+".y, "+this._colorReg+".w, "+this._targetReg+".w\nmul "+i+".w, "+i+".w, "+i+".y\n"},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":void 0,"awayjs-renderergl/lib/materials/passes/SingleObjectDepthPass":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseWrapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod"),a=function(e){function t(t){void 0===t&&(t=.5),e.call(this),this.wrapFactor=t}return i(t,e),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._wrapDataRegister=null},Object.defineProperty(t.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(e){this._wrapFactor=e,this._wrapFactor=1/(e+1)},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){var s=e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a);return this._pIsFirstLight=!0,this._wrapDataRegister=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._wrapDataRegister.index,s},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var n,o="";return this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1)),o+="dp3 "+n+".x, "+i+".xyz, "+s.normalFragment+".xyz\nadd "+n+".y, "+n+".x, "+this._wrapDataRegister+".x\nmul "+n+".y, "+n+".y, "+this._wrapDataRegister+".y\nsat "+n+".w, "+n+".y\nmul "+n+".xz, "+n+".w, "+i+".wz\n",null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,i,a,s)),o+="mul "+n+", "+n+".x, "+r+"\n",this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=i.secondaryFragmentConstantsIndex,s=t.fragmentConstantData;s[a]=this._wrapFactor,s[a+1]=1/(this._wrapFactor+1)},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/DiffuseBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/EffectAlphaMaskMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){void 0===i&&(i=!1),e.call(this),this._texture=t,this._useSecondaryUV=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(t.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(e){this._useSecondaryUV!=e&&(this._useSecondaryUV=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){i.activateTexture(t.texturesIndex,this._texture)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var n=r.getFreeTextureReg(),o=r.getFreeFragmentVectorTemp(),h=this._useSecondaryUV?s.secondaryUVVarying:s.uvVarying;return t.texturesIndex=n.index,a.getTex2DSampleCode(o,s,n,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,h)+"mul "+i+", "+i+", "+o+".x\n"
},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectColorMatrixMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(t){if(e.call(this),20!=t.length)throw new Error("Matrix length must be 20!");this._matrix=t}return i(t,e),Object.defineProperty(t.prototype,"colorMatrix",{get:function(){return this._matrix},set:function(e){this._matrix=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,i,r){var a="",s=r.getFreeFragmentConstant();r.getFreeFragmentConstant(),r.getFreeFragmentConstant(),r.getFreeFragmentConstant();var n=r.getFreeFragmentConstant();t.fragmentConstantsIndex=4*s.index;var o=r.getFreeFragmentVectorTemp();return a+="m44 "+o+", "+i+", "+s+"\nadd "+i+", "+o+", "+n+"\n"},t.prototype.iActivate=function(e,t){var i=this._matrix,r=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[r]=i[0],a[r+1]=i[1],a[r+2]=i[2],a[r+3]=i[3],a[r+4]=i[5],a[r+5]=i[6],a[r+6]=i[7],a[r+7]=i[8],a[r+8]=i[10],a[r+9]=i[11],a[r+10]=i[12],a[r+11]=i[13],a[r+12]=i[15],a[r+13]=i[16],a[r+14]=i[17],a[r+15]=i[18],a[r+16]=i[4],a[r+17]=i[9],a[r+18]=i[14],a[r+19]=i[19]},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/EffectColorTransformMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(){e.call(this)}return i(t,e),Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(e){this._colorTransform=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,i,r){var a="",s=r.getFreeFragmentConstant(),n=r.getFreeFragmentConstant();return t.fragmentConstantsIndex=4*s.index,a+="mul "+i+", "+i+", "+s+"\nadd "+i+", "+i+", "+n+"\n"},t.prototype.iActivate=function(e,t){var i=1/255,r=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[r]=this._colorTransform.redMultiplier,a[r+1]=this._colorTransform.greenMultiplier,a[r+2]=this._colorTransform.blueMultiplier,a[r+3]=this._colorTransform.alphaMultiplier,a[r+4]=this._colorTransform.redOffset*i,a[r+5]=this._colorTransform.greenOffset*i,a[r+6]=this._colorTransform.blueOffset*i,a[r+7]=this._colorTransform.alphaOffset*i},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/EffectEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){void 0===i&&(i=1),e.call(this),this._cubeTexture=t,this._alpha=i}return i(t,e),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){(e!=this._mask||e&&this._mask&&(e.hasMipmaps!=this._mask.hasMipmaps||e.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=e},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){e.fragmentConstantData[t.fragmentConstantsIndex]=this._alpha,i.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&i.activateTexture(t.texturesIndex+1,this._mask)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var n=r.getFreeFragmentConstant(),o=r.getFreeFragmentVectorTemp(),h="",l=r.getFreeTextureReg();t.texturesIndex=l.index,t.fragmentConstantsIndex=4*n.index,r.addFragmentTempUsages(o,1);var p=r.getFreeFragmentVectorTemp();return h+="dp3 "+o+".w, "+s.viewDirFragment+".xyz, "+s.normalFragment+".xyz\nadd "+o+".w, "+o+".w, "+o+".w\nmul "+o+".xyz, "+s.normalFragment+".xyz, "+o+".w\nsub "+o+".xyz, "+o+".xyz, "+s.viewDirFragment+".xyz\n"+a.getTexCubeSampleCode(o,l,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,o)+"sub "+p+".w, "+o+".w, fc0.x\nkil "+p+".w\nsub "+o+", "+o+", "+i+"\n",this._mask&&(h+=a.getTex2DSampleCode(p,s,r.getFreeTextureReg(),this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+o+", "+p+", "+o+"\n"),h+="mul "+o+", "+o+", "+n+".x\nadd "+i+", "+i+", "+o+"\n",r.removeFragmentTempUsage(o),h},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectFogMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(t,i,r){void 0===r&&(r=8421504),e.call(this),this._minDistance=0,this._maxDistance=1e3,this.minDistance=t,this.maxDistance=i,this.fogColor=r}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsProjection=!0},t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,r=t.fragmentConstantsIndex;i[r+3]=1,i[r+6]=0,i[r+7]=0},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},set:function(e){this._minDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(e){this._maxDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._fogColor},set:function(e){this._fogColor=e,this._fogR=(e>>16&255)/255,this._fogG=(e>>8&255)/255,this._fogB=(255&e)/255},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t){var i=e.fragmentConstantData,r=t.fragmentConstantsIndex;i[r]=this._fogR,i[r+1]=this._fogG,i[r+2]=this._fogB,i[r+4]=this._minDistance,i[r+5]=1/(this._maxDistance-this._minDistance)},t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s=r.getFreeFragmentConstant(),n=r.getFreeFragmentConstant(),o=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(o,1);var h=r.getFreeFragmentVectorTemp(),l="";return t.fragmentConstantsIndex=4*s.index,l+="sub "+h+".w, "+a.projectionFragment+".z, "+n+".x\nmul "+h+".w, "+h+".w, "+n+".y\nsat "+h+".w, "+h+".w\nsub "+o+", "+s+", "+i+"\nmul "+o+", "+o+", "+h+".w\nadd "+i+", "+i+", "+o+"\n",r.removeFragmentTempUsage(o),l},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/EffectFresnelEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){void 0===i&&(i=1),e.call(this),this._fresnelPower=5,this._normalReflectance=0,this._cubeTexture=t,this._alpha=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1},Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){(Boolean(e)!=Boolean(this._mask)||e&&this._mask&&(e.hasMipmaps!=this._mask.hasMipmaps||e.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){var r=e.fragmentConstantData,a=t.fragmentConstantsIndex;r[a]=this._alpha,r[a+1]=this._normalReflectance,r[a+2]=this._fresnelPower,i.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&i.activateTexture(t.texturesIndex+1,this._mask)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var n=r.getFreeFragmentConstant(),o=r.getFreeFragmentVectorTemp(),h="",l=r.getFreeTextureReg(),p=s.viewDirFragment,d=s.normalFragment;t.texturesIndex=l.index,t.fragmentConstantsIndex=4*n.index,r.addFragmentTempUsages(o,1);var c=r.getFreeFragmentVectorTemp();if(h+="dp3 "+o+".w, "+p+".xyz, "+d+".xyz\nadd "+o+".w, "+o+".w, "+o+".w\nmul "+o+".xyz, "+d+".xyz, "+o+".w\nsub "+o+".xyz, "+o+".xyz, "+p+".xyz\n"+a.getTexCubeSampleCode(o,l,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,o)+"sub "+c+".w, "+o+".w, fc0.x\nkil "+c+".w\nsub "+o+", "+o+", "+i+"\n",h+="dp3 "+p+".w, "+p+".xyz, "+d+".xyz\nsub "+p+".w, "+n+".w, "+p+".w\npow "+p+".w, "+p+".w, "+n+".z\nsub "+d+".w, "+n+".w, "+p+".w\nmul "+d+".w, "+n+".y, "+d+".w\nadd "+p+".w, "+p+".w, "+d+".w\nmul "+p+".w, "+n+".x, "+p+".w\n",this._mask){var u=r.getFreeTextureReg();h+=a.getTex2DSampleCode(c,s,u,this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+p+".w, "+c+".x, "+p+".w\n"}return h+="mul "+o+", "+o+", "+p+".w\nadd "+i+", "+i+", "+o+"\n",r.removeFragmentTempUsage(o),h},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectLightMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i,r){void 0===i&&(i="multiply"),void 0===r&&(r=!1),e.call(this),this._useSecondaryUV=r,this._texture=t,this.blendMode=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsUV=!this._useSecondaryUV,t.needsSecondaryUV=this._useSecondaryUV},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format)&&this.iInvalidateShaderProgram(),this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){r.activateTexture(i.texturesIndex,this._texture),e.prototype.iActivate.call(this,t,i,r)},t.prototype.iGetFragmentCode=function(e,i,r,s,n){var o,h=s.getFreeTextureReg(),l=s.getFreeFragmentVectorTemp();switch(i.texturesIndex=h.index,o=a.getTex2DSampleCode(l,n,h,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,this._useSecondaryUV?n.secondaryUVVarying:n.uvVarying),this._blendMode){case t.MULTIPLY:o+="mul "+r+", "+r+", "+l+"\n";break;case t.ADD:o+="add "+r+", "+r+", "+l+"\n"}return o},t.MULTIPLY="multiply",t.ADD="add",t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/errors/AbstractMethodError"),s=e("awayjs-renderergl/lib/materials/methods/ShadingMethodBase"),n=function(e){function t(){e.call(this)}return i(t,e),Object.defineProperty(t.prototype,"assetType",{get:function(){return r.EFFECTS_METHOD},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(){throw new a},t}(s);t.exports=n},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-renderergl/lib/materials/methods/ShadingMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/EffectRefractionEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i,r,a,s){void 0===i&&(i=.1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=0),e.call(this),this._dispersionR=0,this._dispersionG=0,this._dispersionB=0,this._alpha=1,this._envMap=t,this._dispersionR=r,this._dispersionG=a,this._dispersionB=s,this._useDispersion=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG),this._refractionIndex=i}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i+4]=1,r[i+5]=0,r[i+7]=1},t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._envMap},set:function(e){this._envMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(e){this._refractionIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(e){this._dispersionR=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(e){this._dispersionG=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(e){this._dispersionB=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){var r=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[r]=this._dispersionR+this._refractionIndex,this._useDispersion&&(a[r+1]=this._dispersionG+this._refractionIndex,a[r+2]=this._dispersionB+this._refractionIndex),a[r+3]=this._alpha,i.activateCubeTexture(t.texturesIndex,this._envMap)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var n,o,h,l=r.getFreeFragmentConstant(),p=r.getFreeFragmentConstant(),d="",c=r.getFreeTextureReg();t.texturesIndex=c.index,t.fragmentConstantsIndex=4*l.index,n=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(n,1),o=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(o,1),h=r.getFreeFragmentVectorTemp();var u=s.viewDirFragment,g=s.normalFragment;return d+="neg "+u+".xyz, "+u+".xyz\n",d+="dp3 "+h+".x, "+u+".xyz, "+g+".xyz\nmul "+h+".w, "+h+".x, "+h+".x\nsub "+h+".w, "+p+".x, "+h+".w\nmul "+h+".w, "+l+".x, "+h+".w\nmul "+h+".w, "+l+".x, "+h+".w\nsub "+h+".w, "+p+".x, "+h+".w\nsqt "+h+".y, "+h+".w\nmul "+h+".x, "+l+".x, "+h+".x\nadd "+h+".x, "+h+".x, "+h+".y\nmul "+h+".xyz, "+h+".x, "+g+".xyz\nmul "+n+", "+l+".x, "+u+"\nsub "+n+".xyz, "+n+".xyz, "+h+".xyz\nnrm "+n+".xyz, "+n+".xyz\n",d+=a.getTexCubeSampleCode(o,c,this._envMap,e.useSmoothTextures,e.useMipmapping,n)+"sub "+o+".w, "+o+".w, fc0.x	\nkil "+o+".w\n",this._useDispersion&&(d+="dp3 "+h+".x, "+u+".xyz, "+g+".xyz\nmul "+h+".w, "+h+".x, "+h+".x\nsub "+h+".w, "+p+".x, "+h+".w\nmul "+h+".w, "+l+".y, "+h+".w\nmul "+h+".w, "+l+".y, "+h+".w\nsub "+h+".w, "+p+".x, "+h+".w\nsqt "+h+".y, "+h+".w\nmul "+h+".x, "+l+".y, "+h+".x\nadd "+h+".x, "+h+".x, "+h+".y\nmul "+h+".xyz, "+h+".x, "+g+".xyz\nmul "+n+", "+l+".y, "+u+"\nsub "+n+".xyz, "+n+".xyz, "+h+".xyz\nnrm "+n+".xyz, "+n+".xyz\n",d+=a.getTexCubeSampleCode(h,c,this._envMap,e.useSmoothTextures,e.useMipmapping,n)+"mov "+o+".y, "+h+".y\n",d+="dp3 "+h+".x, "+u+".xyz, "+g+".xyz\nmul "+h+".w, "+h+".x, "+h+".x\nsub "+h+".w, "+p+".x, "+h+".w\nmul "+h+".w, "+l+".z, "+h+".w\nmul "+h+".w, "+l+".z, "+h+".w\nsub "+h+".w, "+p+".x, "+h+".w\nsqt "+h+".y, "+h+".w\nmul "+h+".x, "+l+".z, "+h+".x\nadd "+h+".x, "+h+".x, "+h+".y\nmul "+h+".xyz, "+h+".x, "+g+".xyz\nmul "+n+", "+l+".z, "+u+"\nsub "+n+".xyz, "+n+".xyz, "+h+".xyz\nnrm "+n+".xyz, "+n+".xyz\n",d+=a.getTexCubeSampleCode(h,c,this._envMap,e.useSmoothTextures,e.useMipmapping,n)+"mov "+o+".z, "+h+".z\n"),r.removeFragmentTempUsage(n),d+="sub "+o+".xyz, "+o+".xyz, "+i+".xyz\nmul "+o+".xyz, "+o+".xyz, "+l+".w\nadd "+i+".xyz, "+i+".xyz, "+o+".xyz\n",r.removeFragmentTempUsage(o),d+="neg "+u+".xyz, "+u+".xyz\n"},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectRimLightMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(t,i,r,a){void 0===t&&(t=16777215),void 0===i&&(i=.4),void 0===r&&(r=2),void 0===a&&(a="mix"),e.call(this),this._blendMode=a,this._strength=i,this._power=r,this.color=t}return i(t,e),t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1},t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this._colorR=(e>>16&255)/255,this._colorG=(e>>8&255)/255,this._colorB=(255&e)/255},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._strength},set:function(e){this._strength=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._power},set:function(e){this._power=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i]=this._colorR,r[i+1]=this._colorG,r[i+2]=this._colorB,r[i+4]=this._strength,r[i+5]=this._power},t.prototype.iGetFragmentCode=function(e,i,r,a,s){var n=a.getFreeFragmentConstant(),o=a.getFreeFragmentConstant(),h=a.getFreeFragmentVectorTemp(),l="";return i.fragmentConstantsIndex=4*n.index,l+="dp3 "+h+".x, "+s.viewDirFragment+".xyz, "+s.normalFragment+".xyz\nsat "+h+".x, "+h+".x\nsub "+h+".x, "+n+".w, "+h+".x\npow "+h+".x, "+h+".x, "+o+".y\nmul "+h+".x, "+h+".x, "+o+".x\nsub "+h+".x, "+n+".w, "+h+".x\nmul "+r+".xyz, "+r+".xyz, "+h+".x\nsub "+h+".w, "+n+".w, "+h+".x\n",l+=this._blendMode==t.ADD?"mul "+h+".xyz, "+h+".w, "+n+".xyz\nadd "+r+".xyz, "+r+".xyz, "+h+".xyz\n":this._blendMode==t.MULTIPLY?"mul "+h+".xyz, "+h+".w, "+n+".xyz\nmul "+r+".xyz, "+r+".xyz, "+h+".xyz\n":"sub "+h+".xyz, "+n+".xyz, "+r+".xyz\nmul "+h+".xyz, "+h+".xyz, "+h+".w\nadd "+r+".xyz, "+r+".xyz, "+h+".xyz\n"},t.ADD="add",t.MULTIPLY="multiply",t.MIX="mix",t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/LightingMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/ShadingMethodBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iGetFragmentPreLightingCode=function(){return""},t.prototype.iGetFragmentCodePerLight=function(){return""},t.prototype.iGetFragmentCodePerProbe=function(){return""},t.prototype.iGetFragmentPostLightingCode=function(){return""},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/ShadingMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/NormalBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/materials/methods/ShadingMethodBase"),o=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),h=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iIsUsed=function(e){return this._useTexture&&e.normalDependencies?!0:!1},t.prototype.iInitVO=function(e,t){t.needsUV=this._useTexture},t.prototype.iOutputsTangentNormals=function(){return!0},t.prototype.copyFrom=function(e){var t=e;null!=t.normalMap&&(this.normalMap=t.normalMap)},Object.defineProperty(t.prototype,"normalMap",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._useTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._useTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pNormalTextureRegister=null},t.prototype.dispose=function(){this._texture&&(this._texture=null)},t.prototype.iActivate=function(e,t,i){t.texturesIndex>=0&&(i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?s.REPEAT:s.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.activateTexture(t.texturesIndex,this._texture))},t.prototype.iGetFragmentCode=function(e,t,i,r,a){return this._pNormalTextureRegister=r.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,o.getTex2DSampleCode(i,a,this._pNormalTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"sub "+i+".xyz, "+i+".xyz, "+a.commons+".xxx\nnrm "+i+".xyz, "+i+"\n"},t}(n);t.exports=h},{"awayjs-renderergl/lib/materials/methods/ShadingMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/methods/NormalHeightMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/NormalBasicMethod"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i,r,a){e.call(this),this.normalMap=t,this._worldXYRatio=i/r,this._worldXZRatio=a/r}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i]=1/this.normalMap.width,r[i+1]=1/this.normalMap.height,r[i+2]=0,r[i+3]=1,r[i+4]=this._worldXYRatio,r[i+5]=this._worldXZRatio},Object.defineProperty(t.prototype,"tangentSpace",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(t){e.prototype.copyFrom.call(this,t),this._worldXYRatio=t._worldXYRatio,this._worldXZRatio=t._worldXZRatio},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var n=r.getFreeFragmentVectorTemp(),o=r.getFreeFragmentConstant(),h=r.getFreeFragmentConstant();return this._pNormalTextureRegister=r.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*o.index,a.getTex2DSampleCode(i,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s.uvVarying,"clamp")+"add "+n+", "+s.uvVarying+", "+o+".xzzz\n"+a.getTex2DSampleCode(n,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,n,"clamp")+"sub "+i+".x, "+i+".x, "+n+".x\nadd "+n+", "+s.uvVarying+", "+o+".zyzz\n"+a.getTex2DSampleCode(n,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,n,"clamp")+"sub "+i+".z, "+i+".z, "+n+".x\nmov "+i+".y, "+o+".w\nmul "+i+".xz, "+i+".xz, "+h+".xy\nnrm "+i+".xyz, "+i+".xyz\n"},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/NormalBasicMethod":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/NormalSimpleWaterMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/NormalBasicMethod"),a=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){e.call(this),this._useSecondNormalMap=!1,this._water1OffsetX=0,this._water1OffsetY=0,this._water2OffsetX=0,this._water2OffsetY=0,this.normalMap=t,this.secondaryNormalMap=i}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i]=.5,r[i+1]=0,r[i+2]=0,r[i+3]=1},t.prototype.iInitVO=function(t,i){e.prototype.iInitVO.call(this,t,i),this._useSecondNormalMap=this.normalMap!=this.secondaryNormalMap},Object.defineProperty(t.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(e){this._water1OffsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(e){this._water1OffsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(e){this._water2OffsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(e){this._water2OffsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryNormalMap",{get:function(){return this._texture2},set:function(e){this._texture2=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._normalTextureRegister2=null},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._texture2=null},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=t.fragmentConstantData,s=i.fragmentConstantsIndex;a[s+4]=this._water1OffsetX,a[s+5]=this._water1OffsetY,a[s+6]=this._water2OffsetX,a[s+7]=this._water2OffsetY,this._useSecondNormalMap&&r.activateTexture(i.texturesIndex+1,this._texture2)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var n=r.getFreeFragmentVectorTemp(),o=r.getFreeFragmentConstant(),h=r.getFreeFragmentConstant();return this._pNormalTextureRegister=r.getFreeTextureReg(),this._normalTextureRegister2=this._useSecondNormalMap?r.getFreeTextureReg():this._pNormalTextureRegister,t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*o.index,"add "+n+", "+s.uvVarying+", "+h+".xyxy\n"+a.getTex2DSampleCode(i,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,n)+"add "+n+", "+s.uvVarying+", "+h+".zwzw\n"+a.getTex2DSampleCode(n,s,this._normalTextureRegister2,this._texture2,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,n)+"add "+i+", "+i+", "+n+"		\nmul "+i+", "+i+", "+o+".x	\nsub "+i+".xyz, "+i+".xyz, "+s.commons+".xxx	\nnrm "+i+".xyz, "+i+".xyz							\n"},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/NormalBasicMethod":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/ShadingMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/NamedAssetBase"),a=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),s=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iIsUsed=function(){return!0},t.prototype.iInitVO=function(){},t.prototype.iInitConstants=function(){},t.prototype.iUsesTangentSpace=function(){return!0},Object.defineProperty(t.prototype,"passes",{get:function(){return this._passes},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.iReset=function(){this.iCleanCompilationData()},t.prototype.iCleanCompilationData=function(){},t.prototype.iGetVertexCode=function(){return""},t.prototype.iGetFragmentCode=function(){return null},t.prototype.iActivate=function(){},t.prototype.iSetRenderState=function(){},t.prototype.iDeactivate=function(){},t.prototype.iInvalidateShaderProgram=function(){this.dispatchEvent(new a(a.SHADER_INVALIDATED))},t.prototype.copyFrom=function(){},t}(r);t.exports=s},{"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowCascadeMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=e("awayjs-display/lib/entities/DirectionalLight"),s=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),n=e("awayjs-renderergl/lib/materials/compilation/MethodVO"),o=e("awayjs-renderergl/lib/materials/methods/ShadowMapMethodBase"),h=function(e){function t(t){var i=this;if(e.call(this,t.castingLight),this._baseMethod=t,!(this._pCastingLight instanceof a))throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");if(this._cascadeShadowMapper=this._pCastingLight.shadowMapper,!this._cascadeShadowMapper)throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");this._cascadeShadowMapper.addEventListener(r.CHANGE,function(e){return i.onCascadeChange(e)}),this._baseMethod.addEventListener(s.SHADER_INVALIDATED,function(e){return i.onShaderInvalidated(e)})}return i(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){var t=this;this._baseMethod!=e&&(this._baseMethod.removeEventListener(s.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)}),this._baseMethod=e,this._baseMethod.addEventListener(s.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)}),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){var i=new n(this._baseMethod);this._baseMethod.iInitVO(e,i),t.needsGlobalVertexPos=!0,t.needsProjection=!0},t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,r=e.vertexConstantData,a=t.fragmentConstantsIndex;
i[a]=1,i[a+1]=1/255,i[a+2]=1/65025,i[a+3]=1/16581375,i[a+6]=.5,i[a+7]=-.5,a=t.vertexConstantsIndex,r[a]=.5,r[a+1]=-.5,r[a+2]=0},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._cascadeProjections=null,this._depthMapCoordVaryings=null},t.prototype.iGetVertexCode=function(e,t,i,r){var a="",s=i.getFreeVertexConstant();this.initProjectionsRegs(i),t.vertexConstantsIndex=4*s.index;for(var n=i.getFreeVertexVectorTemp(),o=0;o<this._cascadeShadowMapper.numCascades;++o)a+="m44 "+n+", "+r.globalPositionVertex+", "+this._cascadeProjections[o]+"\nadd "+this._depthMapCoordVaryings[o]+", "+n+", "+s+".zzwz\n";return a},t.prototype.initProjectionsRegs=function(e){this._cascadeProjections=new Array(this._cascadeShadowMapper.numCascades),this._depthMapCoordVaryings=new Array(this._cascadeShadowMapper.numCascades);for(var t=0;t<this._cascadeShadowMapper.numCascades;++t)this._depthMapCoordVaryings[t]=e.getFreeVarying(),this._cascadeProjections[t]=e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant()},t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s,n=this._cascadeShadowMapper.numCascades,o=r.getFreeTextureReg(),h=r.getFreeFragmentConstant(),l=r.getFreeFragmentConstant(),p=r.getFreeFragmentConstant(),d=Array(p+".x",p+".y",p+".z",p+".w");t.fragmentConstantsIndex=4*h.index,t.texturesIndex=o.index;var c=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(c,1);var u=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(u,1),s="mov "+u+", "+this._depthMapCoordVaryings[n-1]+"\n";for(var g=n-2;g>=0;--g){var _=this._depthMapCoordVaryings[g];s+="slt "+c+".z, "+a.projectionFragment+".z, "+d[g]+"\n";var m=r.getFreeFragmentVectorTemp();s+="sub "+m+", "+_+", "+u+"\nmul "+m+", "+m+", "+c+".z\nadd "+u+", "+u+", "+m+"\n"}return r.removeFragmentTempUsage(c),s+="div "+u+", "+u+", "+u+".w\nmul "+u+".xy, "+u+".xy, "+l+".zw\nadd "+u+".xy, "+u+".xy, "+l+".zz\n",s+=this._baseMethod._iGetCascadeFragmentCode(e,t,h,o,u,i,r,a)+"add "+i+".w, "+i+".w, "+l+".y\n",r.removeFragmentTempUsage(u),s},t.prototype.iActivate=function(e,t,i){i.activateTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap);var r=e.vertexConstantData,a=t.vertexConstantsIndex;e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._cascadeShadowMapper.depth*this._pEpsilon);var s=this._cascadeShadowMapper.numCascades;a+=4;for(var n=0;s>n;++n)this._cascadeShadowMapper.getDepthProjections(n).copyRawDataTo(r,a,!0),a+=16;var o=e.fragmentConstantData,h=t.fragmentConstantsIndex;o[h+5]=1-this._pAlpha;var l=this._cascadeShadowMapper._iNearPlaneDistances;h+=8;for(var p=0;s>p;++p)o[h+p]=l[p];this._baseMethod.iActivateForCascade(e,t,i)},t.prototype.iSetRenderState=function(){},t.prototype.onCascadeChange=function(){this.iInvalidateShaderProgram()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(o);t.exports=h},{"awayjs-core/lib/events/Event":void 0,"awayjs-display/lib/entities/DirectionalLight":void 0,"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0,"awayjs-renderergl/lib/materials/compilation/MethodVO":void 0,"awayjs-renderergl/lib/materials/methods/ShadowMapMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowDitheredMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-core/lib/textures/BitmapTexture"),s=e("awayjs-renderergl/lib/materials/methods/ShadowMethodBase"),n=function(e){function t(i,r,a){void 0===r&&(r=4),void 0===a&&(a=1),e.call(this,i),this._depthMapSize=this._pCastingLight.shadowMapper.depthMapSize,this.numSamples=r,this.range=a,++t._grainUsages,t._grainTexture||this.initGrainTexture()}return i(t,e),Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e,this._numSamples<1?this._numSamples=1:this._numSamples>24&&(this._numSamples=24),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(t,i){e.prototype.iInitVO.call(this,t,i),i.needsProjection=!0},t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i);var r=t.fragmentConstantData,a=i.fragmentConstantsIndex;r[a+8]=1/this._numSamples},Object.defineProperty(t.prototype,"range",{get:function(){return 2*this._range},set:function(e){this._range=e/2},enumerable:!0,configurable:!0}),t.prototype.initGrainTexture=function(){t._grainBitmapData=new r(64,64,!1);for(var e,i,s=new Array,n=4096,o=1/(this._depthMapSize*this._range),h=0;n>h;++h)e=2*(Math.random()-.5),i=2*(Math.random()-.5),0>e?e-=o:e+=o,0>i?i-=o:i+=o,e>1?e=1:-1>e&&(e=-1),i>1?i=1:-1>i&&(i=-1),s[h]=Math.floor(255*(.5*e+.5))<<16|Math.floor(255*(.5*i+.5))<<8;t._grainBitmapData.setVector(t._grainBitmapData.rect,s),t._grainTexture=new a(t._grainBitmapData)},t.prototype.dispose=function(){0==--t._grainUsages&&(t._grainTexture.dispose(),t._grainBitmapData.dispose(),t._grainTexture=null)},t.prototype.iActivate=function(i,r,a){e.prototype.iActivate.call(this,i,r,a);var s=i.fragmentConstantData,n=r.fragmentConstantsIndex;s[n+9]=(a.width-1)/63,s[n+10]=(a.height-1)/63,s[n+11]=2*this._range/this._depthMapSize,a.activateTexture(r.texturesIndex+1,t._grainTexture)},t.prototype._pGetPlanarFragmentCode=function(e,t,i,r){var a=i.getFreeTextureReg(),s=i.getFreeFragmentConstant(),n=(i.getFreeFragmentConstant(),i.getFreeFragmentConstant());return e.fragmentConstantsIndex=4*s.index,e.texturesIndex=a.index,this.getSampleCode(n,a,s,t,i,r)},t.prototype.getSampleCode=function(e,t,i,r,a,s){var n="",o=a.getFreeTextureReg(),h=a.getFreeFragmentVectorTemp(),l=this._numSamples;a.addFragmentTempUsages(h,1);var p=a.getFreeFragmentVectorTemp(),d=s.projectionFragment;for(n+="div "+h+", "+d+", "+d+".w\nmul "+h+".xy, "+h+".xy, "+e+".yz\n";l>0;)n+=l==this._numSamples?"tex "+h+", "+h+", "+o+" <2d,nearest,repeat,mipnone>\n":"tex "+h+", "+h+".zwxy, "+o+" <2d,nearest,repeat,mipnone>\n",n+="sub "+h+".zw, "+h+".xy, fc0.xx\nmul "+h+".zw, "+h+".zw, "+e+".w\n",n+=l==this._numSamples?"add "+h+".xy, "+h+".zw, "+this._pDepthMapCoordReg+".xy\ntex "+p+", "+h+", "+t+" <2d,nearest,clamp,mipnone>\ndp4 "+p+".z, "+p+", "+i+"\nslt "+r+".w, "+this._pDepthMapCoordReg+".z, "+p+".z\n":this.addSample(h,t,i,r,a),l>4&&(n+="add "+h+".xy, "+h+".xy, "+h+".zw\n"+this.addSample(h,t,i,r,a)),l>1&&(n+="sub "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+h+".zw\n"+this.addSample(h,t,i,r,a)),l>5&&(n+="sub "+h+".xy, "+h+".xy, "+h+".zw\n"+this.addSample(h,t,i,r,a)),l>2&&(n+="neg "+h+".w, "+h+".w\n",n+="add "+h+".xy, "+h+".wz, "+this._pDepthMapCoordReg+".xy\n"+this.addSample(h,t,i,r,a)),l>6&&(n+="add "+h+".xy, "+h+".xy, "+h+".wz\n"+this.addSample(h,t,i,r,a)),l>3&&(n+="sub "+h+".xy, "+this._pDepthMapCoordReg+".xy, "+h+".wz\n"+this.addSample(h,t,i,r,a)),l>7&&(n+="sub "+h+".xy, "+h+".xy, "+h+".wz\n"+this.addSample(h,t,i,r,a)),l-=8;return a.removeFragmentTempUsage(h),n+="mul "+r+".w, "+r+".w, "+e+".x\n"},t.prototype.addSample=function(e,t,i,r,a){var s=a.getFreeFragmentVectorTemp();return"tex "+s+", "+e+", "+t+" <2d,nearest,clamp,mipnone>\ndp4 "+s+".z, "+s+", "+i+"\nslt "+s+".z, "+this._pDepthMapCoordReg+".z, "+s+".z\nadd "+r+".w, "+r+".w, "+s+".z\n"},t.prototype.iActivateForCascade=function(e,i,r){var a=e.fragmentConstantData,s=i.secondaryFragmentConstantsIndex;a[s]=1/this._numSamples,a[s+1]=(r.width-1)/63,a[s+2]=(r.height-1)/63,a[s+3]=2*this._range/this._depthMapSize,r.activateTexture(i.texturesIndex+1,t._grainTexture)},t.prototype._iGetCascadeFragmentCode=function(e,t,i,r,a,s,n,o){this._pDepthMapCoordReg=a;var h=n.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*h.index,this.getSampleCode(h,r,i,s,n,o)},t}(s);t.exports=n},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/textures/BitmapTexture":void 0,"awayjs-renderergl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowFilteredMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/ShadowMethodBase"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i);var r=t.fragmentConstantData,a=i.fragmentConstantsIndex;r[a+8]=.5;var s=this.castingLight.shadowMapper.depthMapSize;r[a+9]=s,r[a+10]=1/s},t.prototype._pGetPlanarFragmentCode=function(e,t,i){var r=i.getFreeTextureReg(),a=i.getFreeFragmentConstant(),s=i.getFreeFragmentConstant();s=s;var n,o=i.getFreeFragmentConstant(),h=i.getFreeFragmentVectorTemp(),l="";return e.fragmentConstantsIndex=4*a.index,i.addFragmentTempUsages(h,1),n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1),l+="mov "+n+", "+this._pDepthMapCoordReg+"\ntex "+h+", "+this._pDepthMapCoordReg+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+a+"\nslt "+n+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\nadd "+n+".x, "+this._pDepthMapCoordReg+".x, "+o+".z\ntex "+h+", "+n+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+a+"\nslt "+n+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\nmul "+h+".x, "+this._pDepthMapCoordReg+".x, "+o+".y\nfrc "+h+".x, "+h+".x\nsub "+n+".w, "+n+".w, "+n+".z\nmul "+n+".w, "+n+".w, "+h+".x\nadd "+t+".w, "+n+".z, "+n+".w\nmov "+n+".x, "+this._pDepthMapCoordReg+".x\nadd "+n+".y, "+this._pDepthMapCoordReg+".y, "+o+".z\ntex "+h+", "+n+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+a+"\nslt "+n+".z, "+this._pDepthMapCoordReg+".z, "+h+".z\nadd "+n+".x, "+this._pDepthMapCoordReg+".x, "+o+".z\ntex "+h+", "+n+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+a+"\nslt "+n+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\nmul "+h+".x, "+this._pDepthMapCoordReg+".x, "+o+".y\nfrc "+h+".x, "+h+".x\nsub "+n+".w, "+n+".w, "+n+".z\nmul "+n+".w, "+n+".w, "+h+".x\nadd "+n+".w, "+n+".z, "+n+".w\nmul "+h+".x, "+this._pDepthMapCoordReg+".y, "+o+".y\nfrc "+h+".x, "+h+".x\nsub "+n+".w, "+n+".w, "+t+".w\nmul "+n+".w, "+n+".w, "+h+".x\nadd "+t+".w, "+t+".w, "+n+".w\n",i.removeFragmentTempUsage(h),i.removeFragmentTempUsage(n),e.texturesIndex=r.index,l},t.prototype.iActivateForCascade=function(e,t){var i=this.castingLight.shadowMapper.depthMapSize,r=t.secondaryFragmentConstantsIndex,a=e.fragmentConstantData;a[r]=i,a[r+1]=1/i},t.prototype._iGetCascadeFragmentCode=function(e,t,i,r,a,s,n){var o,h=n.getFreeFragmentConstant();t.secondaryFragmentConstantsIndex=4*h.index;var l=n.getFreeFragmentVectorTemp();n.addFragmentTempUsages(l,1);var p=n.getFreeFragmentVectorTemp();return n.addFragmentTempUsages(p,1),o="tex "+l+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+i+"\nslt "+p+".x, "+a+".z, "+l+".z\nadd "+a+".x, "+a+".x, "+h+".y\ntex "+l+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+i+"\nslt "+p+".z, "+a+".z, "+l+".z\nadd "+a+".y, "+a+".y, "+h+".y\ntex "+l+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+i+"\nslt "+p+".w, "+a+".z, "+l+".z\nsub "+a+".x, "+a+".x, "+h+".y\ntex "+l+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+i+"\nslt "+p+".y, "+a+".z, "+l+".z\nmul "+l+".xy, "+a+".xy, "+h+".x\nfrc "+l+".xy, "+l+".xy\nsub "+a+", "+p+".xyzw, "+p+".zwxy\nmul "+a+", "+a+", "+l+".x\nadd "+p+".xy, "+p+".xy, "+a+".zw\nsub "+p+".y, "+p+".y, "+p+".x\nmul "+p+".y, "+p+".y, "+l+".y\nadd "+s+".w, "+p+".x, "+p+".y\n",n.removeFragmentTempUsage(l),n.removeFragmentTempUsage(p),o},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowHardMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/ShadowMethodBase"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype._pGetPlanarFragmentCode=function(e,t,i){var r=i.getFreeTextureReg(),a=i.getFreeFragmentConstant(),s=(i.getFreeFragmentConstant(),i.getFreeFragmentVectorTemp()),n="";return e.fragmentConstantsIndex=4*a.index,e.texturesIndex=r.index,n+="tex "+s+", "+this._pDepthMapCoordReg+", "+r+" <2d, nearest, clamp>\ndp4 "+s+".z, "+s+", "+a+"\nslt "+t+".w, "+this._pDepthMapCoordReg+".z, "+s+".z\n"},t.prototype._pGetPointFragmentCode=function(e,t,i,r){var a=i.getFreeTextureReg(),s=i.getFreeFragmentConstant(),n=i.getFreeFragmentConstant(),o=i.getFreeFragmentConstant(),h=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(h,1);var l=i.getFreeFragmentVectorTemp(),p="";return e.fragmentConstantsIndex=4*s.index,e.texturesIndex=a.index,p+="sub "+l+", "+r.globalPositionVarying+", "+o+"\ndp3 "+l+".w, "+l+".xyz, "+l+".xyz\nmul "+l+".w, "+l+".w, "+o+".w\nnrm "+l+".xyz, "+l+".xyz\ntex "+h+", "+l+", "+a+" <cube, nearest, clamp>\ndp4 "+h+".z, "+h+", "+s+"\nadd "+t+".w, "+l+".w, "+n+".x\nslt "+t+".w, "+t+".w, "+h+".z\n",i.removeFragmentTempUsage(h),p},t.prototype._iGetCascadeFragmentCode=function(e,t,i,r,a,s,n){var o=n.getFreeFragmentVectorTemp();return"tex "+o+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+o+".z, "+o+", "+i+"\nslt "+s+".w, "+a+".z, "+o+".z\n"},t.prototype.iActivateForCascade=function(){},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowMapMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-renderergl/lib/materials/methods/ShadingMethodBase"),s=function(e){function t(t){e.call(this),this._pEpsilon=.02,this._pAlpha=1,this._pCastingLight=t,t.castsShadows=!0,this._pShadowMapper=t.shadowMapper}return i(t,e),Object.defineProperty(t.prototype,"assetType",{get:function(){return r.SHADOW_MAP_METHOD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._pAlpha},set:function(e){this._pAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"castingLight",{get:function(){return this._pCastingLight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._pEpsilon},set:function(e){this._pEpsilon=e},enumerable:!0,configurable:!0}),t}(a);t.exports=s},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-renderergl/lib/materials/methods/ShadingMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowMethodBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/errors/AbstractMethodError"),a=e("awayjs-display/lib/entities/PointLight"),s=e("awayjs-renderergl/lib/materials/methods/ShadowMapMethodBase"),n=function(e){function t(t){this._pUsePoint=t instanceof a,e.call(this,t)}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsView=!0,t.needsGlobalVertexPos=!0,t.needsGlobalFragmentPos=this._pUsePoint,t.needsNormals=e.numLights>0},t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,r=e.vertexConstantData,a=t.fragmentConstantsIndex;i[a]=1,i[a+1]=1/255,i[a+2]=1/65025,i[a+3]=1/16581375,i[a+6]=0,i[a+7]=1,this._pUsePoint&&(i[a+8]=0,i[a+9]=0,i[a+10]=0,i[a+11]=1),a=t.vertexConstantsIndex,-1!=a&&(r[a]=.5,r[a+1]=.5,r[a+2]=0,r[a+3]=1)},Object.defineProperty(t.prototype,"_iDepthMapCoordReg",{get:function(){return this._pDepthMapCoordReg},set:function(e){this._pDepthMapCoordReg=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pDepthMapCoordReg=null},t.prototype.iGetVertexCode=function(e,t,i,r){return this._pUsePoint?this._pGetPointVertexCode(t,i,r):this.pGetPlanarVertexCode(t,i,r)},t.prototype._pGetPointVertexCode=function(e){return e.vertexConstantsIndex=-1,""},t.prototype.pGetPlanarVertexCode=function(e,t,i){var r="",a=t.getFreeVertexVectorTemp(),s=t.getFreeVertexConstant(),n=t.getFreeVertexConstant();return t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),this._pDepthMapCoordReg=t.getFreeVarying(),e.vertexConstantsIndex=4*s.index,r+="m44 "+a+", "+i.globalPositionVertex+", "+n+"\ndiv "+a+", "+a+", "+a+".w\nmul "+a+".xy, "+a+".xy, "+s+".xy\nadd "+this._pDepthMapCoordReg+", "+a+", "+s+".xxwz\n"},t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s=this._pUsePoint?this._pGetPointFragmentCode(t,i,r,a):this._pGetPlanarFragmentCode(t,i,r,a);return s+="add "+i+".w, "+i+".w, fc"+(t.fragmentConstantsIndex/4+1)+".y\nsat "+i+".w, "+i+".w\n"},t.prototype._pGetPlanarFragmentCode=function(){throw new r},t.prototype._pGetPointFragmentCode=function(){throw new r},t.prototype.iSetRenderState=function(e,t){this._pUsePoint||this._pShadowMapper.iDepthProjection.copyRawDataTo(e.vertexConstantData,t.vertexConstantsIndex+4,!0)},t.prototype._iGetCascadeFragmentCode=function(){throw new Error("This shadow method is incompatible with cascade shadows")},t.prototype.iActivate=function(e,t,i){var r=e.fragmentConstantData,a=t.fragmentConstantsIndex;if(this._pUsePoint?r[a+4]=-Math.pow(1/(this._pCastingLight.fallOff*this._pEpsilon),2):e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._pShadowMapper.depth*this._pEpsilon),r[a+5]=1-this._pAlpha,this._pUsePoint){var s=this._pCastingLight.scenePosition;r[a+8]=s.x,r[a+9]=s.y,r[a+10]=s.z;var n=this._pCastingLight.fallOff;r[a+11]=1/(2*n*n)}this._pUsePoint||i.activateRenderTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap)},t.prototype.iActivateForCascade=function(){throw new Error("This shadow method is incompatible with cascade shadows")},t}(s);t.exports=n},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-display/lib/entities/PointLight":void 0,"awayjs-renderergl/lib/materials/methods/ShadowMapMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowNearMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),a=e("awayjs-renderergl/lib/materials/methods/ShadowMethodBase"),s=function(e){function t(t,i){var a=this;if(void 0===i&&(i=.1),e.call(this,t.castingLight),this._onShaderInvalidatedDelegate=function(e){return a.onShaderInvalidated(e)},this._baseMethod=t,this._fadeRatio=i,this._nearShadowMapper=this._pCastingLight.shadowMapper,!this._nearShadowMapper)throw new Error("ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.");this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return i(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){this._baseMethod!=e&&(this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=e,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i),this._baseMethod.iInitConstants(t,i);var r=t.fragmentConstantData,a=i.secondaryFragmentConstantsIndex;r[a+2]=0,r[a+3]=1},t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t),t.needsProjection=!0},t.prototype.dispose=function(){this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)},Object.defineProperty(t.prototype,"alpha",{get:function(){return this._baseMethod.alpha},set:function(e){this._baseMethod.alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._baseMethod.epsilon},set:function(e){this._baseMethod.epsilon=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(e){this._fadeRatio=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s=this._baseMethod.iGetFragmentCode(e,t,i,r,a),n=r.getFreeFragmentConstant(),o=r.getFreeFragmentSingleTemp();return t.secondaryFragmentConstantsIndex=4*n.index,s+="abs "+o+", "+a.projectionFragment+".w\nsub "+o+", "+o+", "+n+".x\nmul "+o+", "+o+", "+n+".y\nsat "+o+", "+o+"\nsub "+o+", "+n+".w,"+o+"\nsub "+i+".w, "+n+".w,"+i+".w\nmul "+i+".w, "+i+".w, "+o+"\nsub "+i+".w, "+n+".w,"+i+".w\n"},t.prototype.iActivate=function(e,t,i){this._baseMethod.iActivate(e,t,i)},t.prototype.iDeactivate=function(e,t,i){this._baseMethod.iDeactivate(e,t,i)},t.prototype.iSetRenderState=function(e,t,i,r,a){var s=a.projection.near,n=a.projection.far-s,o=this._nearShadowMapper.coverageRatio,h=o*(1-this._fadeRatio);o=s+o*n,h=s+h*n;var l=e.fragmentConstantData,p=t.secondaryFragmentConstantsIndex;l[p]=h,l[p+1]=1/(o-h),this._baseMethod.iSetRenderState(e,t,i,r,a)},t.prototype.iGetVertexCode=function(e,t,i,r){return this._baseMethod.iGetVertexCode(e,t,i,r)},t.prototype.iReset=function(){this._baseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(a);t.exports=s},{"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0,"awayjs-renderergl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowSoftMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/PoissonLookup"),a=e("awayjs-renderergl/lib/materials/methods/ShadowMethodBase"),s=function(e){function t(t,i,r){void 0===i&&(i=5),void 0===r&&(r=1),e.call(this,t),this._range=1,this.numSamples=i,this.range=r}return i(t,e),Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e,this._numSamples<1?this._numSamples=1:this._numSamples>32&&(this._numSamples=32),this._offsets=r.getDistribution(this._numSamples),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e},enumerable:!0,configurable:!0}),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i),t.fragmentConstantData[i.fragmentConstantsIndex+8]=1/this._numSamples,t.fragmentConstantData[i.fragmentConstantsIndex+9]=0},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);for(var a=.5*this._range/this._pCastingLight.shadowMapper.depthMapSize,s=t.fragmentConstantData,n=i.fragmentConstantsIndex+10,o=this._numSamples<<1,h=0;o>h;++h)s[n+h]=this._offsets[h]*a},t.prototype._pGetPlanarFragmentCode=function(e,t,i){var r=i.getFreeTextureReg(),a=i.getFreeFragmentConstant(),s=(i.getFreeFragmentConstant(),i.getFreeFragmentConstant());return e.fragmentConstantsIndex=4*a.index,e.texturesIndex=r.index,this.getSampleCode(i,r,a,t,s)},t.prototype.addSample=function(e,t,i,r,a){var s=a.getFreeFragmentVectorTemp();return"tex "+s+", "+e+", "+t+" <2d,nearest,clamp>\ndp4 "+s+".z, "+s+", "+i+"\nslt "+e+".w, "+this._pDepthMapCoordReg+".z, "+s+".z\nadd "+r+".w, "+r+".w, "+e+".w\n"},t.prototype.iActivateForCascade=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=this._range/this._pCastingLight.shadowMapper.depthMapSize,s=t.fragmentConstantData,n=i.secondaryFragmentConstantsIndex,o=this._numSamples<<1;s[n]=1/this._numSamples,s[n+1]=0,n+=2;for(var h=0;o>h;++h)s[n+h]=this._offsets[h]*a;o%4==0&&(s[n+o]=0,s[n+o+1]=0)},t.prototype._iGetCascadeFragmentCode=function(e,t,i,r,a,s,n){this._pDepthMapCoordReg=a;var o=n.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*o.index,this.getSampleCode(n,r,i,s,o)},t.prototype.getSampleCode=function(e,t,i,r,a){var s,n,o=new Array(a+".zw");s=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(s,1);for(var h=e.getFreeFragmentVectorTemp(),l=this._numSamples>>1,p=0;l>p;++p){var d=e.getFreeFragmentConstant();o.push(d+".xy"),o.push(d+".zw")}for(p=0;p<this._numSamples;++p)0==p?n="add "+s+", "+this._pDepthMapCoordReg+", "+a+".zwyy\ntex "+h+", "+s+", "+t+" <2d,nearest,clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+r+".w, "+this._pDepthMapCoordReg+".z, "+h+".z\n":n+="add "+s+".xy, "+this._pDepthMapCoordReg+".xy, "+o[p]+"\n"+this.addSample(s,t,i,r,e);return e.removeFragmentTempUsage(s),n+="mul "+r+".w, "+r+".w, "+a+".x\n"},t}(a);t.exports=s},{"awayjs-core/lib/geom/PoissonLookup":void 0,"awayjs-renderergl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularAnisotropicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/SpecularBasicMethod"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsTangents=!0,t.needsView=!0},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var n,o="";return this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1)),o+="nrm "+n+".xyz, "+s.tangentVarying+".xyz\ndp3 "+n+".w, "+n+".xyz, "+i+".xyz\ndp3 "+n+".z, "+n+".xyz, "+s.viewDirFragment+".xyz\n",o+="sin "+n+".x, "+n+".w\nsin "+n+".y, "+n+".z\nmul "+n+".x, "+n+".x, "+n+".y\ncos "+n+".z, "+n+".z\ncos "+n+".w, "+n+".w\nmul "+n+".w, "+n+".w, "+n+".z\nsub "+n+".w, "+n+".x, "+n+".w\n",o+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+n+".w, "+n+".w, "+this._pSpecularTexData+".w\n":"pow "+n+".w, "+n+".w, "+this._pSpecularDataRegister+".w\n",o+="mul "+n+".w, "+n+".w, "+i+".w\n",null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,s)),o+="mul "+n+".xyz, "+r+".xyz, "+n+".w\n",this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/SpecularBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularBasicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/materials/methods/LightingMethodBase"),o=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),h=function(e){function t(){e.call(this),this._gloss=50,this._specular=1,this._specularColor=16777215,this._iSpecularR=1,this._iSpecularG=1,this._iSpecularB=1}return i(t,e),t.prototype.iIsUsed=function(e){return e.numLights?!0:!1},t.prototype.iInitVO=function(e,t){t.needsUV=this._pUseTexture,t.needsNormals=e.numLights>0,t.needsView=e.numLights>0},Object.defineProperty(t.prototype,"gloss",{get:function(){return this._gloss},set:function(e){this._gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._specular},set:function(e){e!=this._specular&&(this._specular=e,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._specularColor},set:function(e){this._specularColor!=e&&((0==this._specularColor||0==e)&&this.iInvalidateShaderProgram(),this._specularColor=e,this.updateSpecular())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t=null!=e;(t!=this._pUseTexture||e&&this._texture&&(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format))&&this.iInvalidateShaderProgram(),this._pUseTexture=t,this._texture=e},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(e){var t=e,i=t;this.texture=i.texture,this.specular=i.specular,this.specularColor=i.specularColor,this.gloss=i.gloss},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._pTotalLightColorReg=null,this._pSpecularTextureRegister=null,this._pSpecularTexData=null,this._pSpecularDataRegister=null},t.prototype.iGetFragmentPreLightingCode=function(e,t,i,r){var a="";return this._pIsFirstLight=!0,this._pSpecularDataRegister=i.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*this._pSpecularDataRegister.index,this._pUseTexture?(this._pSpecularTexData=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._pSpecularTexData,1),this._pSpecularTextureRegister=i.getFreeTextureReg(),t.texturesIndex=this._pSpecularTextureRegister.index,a=o.getTex2DSampleCode(this._pSpecularTexData,r,this._pSpecularTextureRegister,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)):this._pSpecularTextureRegister=null,this._pTotalLightColorReg=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(this._pTotalLightColorReg,1),a},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var n,o="";this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1));var h=s.viewDirFragment,l=s.normalFragment;return o+="add "+n+", "+i+", "+h+"\nnrm "+n+".xyz, "+n+"\ndp3 "+n+".w, "+l+", "+n+"\nsat "+n+".w, "+n+".w\n",o+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+n+".w, "+n+".w, "+this._pSpecularTexData+".w\n":"pow "+n+".w, "+n+".w, "+this._pSpecularDataRegister+".w\n",e.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+i+".w\n"),null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,s)),o+="mul "+n+".xyz, "+r+", "+n+".w\n",this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,r,a,s){var n,o="";this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1));var h=s.normalFragment,l=s.viewDirFragment;return o+="dp3 "+n+".w, "+h+", "+l+"\nadd "+n+".w, "+n+".w, "+n+".w\nmul "+n+", "+n+".w, "+h+"\nsub "+n+", "+n+", "+l+"\ntex "+n+", "+n+", "+i+" <cube,"+(e.useSmoothTextures?"linear":"nearest")+",miplinear>\nmul "+n+".xyz, "+n+", "+r+"\n",null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,s)),this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+n+"\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,a){var s="";return a.shadowTarget&&(s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+a.shadowTarget+".w\n"),this._pUseTexture&&(s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularTexData+".x\n",r.removeFragmentTempUsage(this._pSpecularTexData)),s+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+this._pSpecularDataRegister+"\nadd "+i+".xyz, "+i+", "+this._pTotalLightColorReg+"\n",r.removeFragmentTempUsage(this._pTotalLightColorReg),s},t.prototype.iActivate=function(e,t,i){this._pUseTexture&&(i.context.setSamplerStateAt(t.texturesIndex,e.repeatTextures?s.REPEAT:s.CLAMP,e.useSmoothTextures?a.LINEAR:a.NEAREST,e.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.activateTexture(t.texturesIndex,this._texture));var n=t.fragmentConstantsIndex,o=e.fragmentConstantData;o[n]=this._iSpecularR,o[n+1]=this._iSpecularG,o[n+2]=this._iSpecularB,o[n+3]=this._gloss},t.prototype.updateSpecular=function(){this._iSpecularR=(this._specularColor>>16&255)/255*this._specular,this._iSpecularG=(this._specularColor>>8&255)/255*this._specular,this._iSpecularB=(255&this._specularColor)/255*this._specular
},t}(n);t.exports=h},{"awayjs-renderergl/lib/materials/methods/LightingMethodBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularCelMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod"),a=function(e){function t(t,i){var r=this;void 0===t&&(t=.5),void 0===i&&(i=null),e.call(this,null,i),this._smoothness=.1,this._specularCutOff=.1,this.baseMethod._iModulateMethod=function(e,t,i,a,s){return r.clampSpecular(e,t,i,a,s)},this._specularCutOff=t}return i(t,e),Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(e){this._specularCutOff=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=i.secondaryFragmentConstantsIndex,s=t.fragmentConstantData;s[a]=this._smoothness,s[a+1]=this._specularCutOff},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},t.prototype.clampSpecular=function(e,t,i){return"sub "+i+".y, "+i+".w, "+this._dataReg+".y\ndiv "+i+".y, "+i+".y, "+this._dataReg+".x\nsat "+i+".y, "+i+".y\nsge "+i+".w, "+i+".w, "+this._dataReg+".y\nmul "+i+".w, "+i+".w, "+i+".y\n"},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._dataReg=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),a=e("awayjs-renderergl/lib/materials/methods/SpecularBasicMethod"),s=function(e){function t(t,i){var s=this;void 0===i&&(i=null),e.call(this),this._onShaderInvalidatedDelegate=function(e){return s.onShaderInvalidated(e)},this._baseMethod=i||new a,this._baseMethod._iModulateMethod=t,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return i(t,e),t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t)},t.prototype.iInitConstants=function(e,t){this._baseMethod.iInitConstants(e,t)},Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){this._baseMethod!=e&&(this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=e,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(e){this._baseMethod.gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._baseMethod.specular},set:function(e){this._baseMethod.specular=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"passes",{get:function(){return this._baseMethod.passes},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod.dispose()},Object.defineProperty(t.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(e){this._baseMethod.texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){this._baseMethod.iActivate(e,t,i)},t.prototype.iSetRenderState=function(e,t,i,r,a){this._baseMethod.iSetRenderState(e,t,i,r,a)},t.prototype.iDeactivate=function(e,t,i){this._baseMethod.iDeactivate(e,t,i)},t.prototype.iGetVertexCode=function(e,t,i,r){return this._baseMethod.iGetVertexCode(e,t,i,r)},t.prototype.iGetFragmentPreLightingCode=function(e,t,i,r){return this._baseMethod.iGetFragmentPreLightingCode(e,t,i,r)},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){return this._baseMethod.iGetFragmentCodePerLight(e,t,i,r,a,s)},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,r,a,s){return this._baseMethod.iGetFragmentCodePerProbe(e,t,i,r,a,s)},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,a){return this._baseMethod.iGetFragmentPostLightingCode(e,t,i,r,a)},t.prototype.iReset=function(){this._baseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(a);t.exports=s},{"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0,"awayjs-renderergl/lib/materials/methods/SpecularBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularFresnelMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod"),a=function(e){function t(t,i){var r=this;void 0===t&&(t=!0),void 0===i&&(i=null),e.call(this,null,i),this._fresnelPower=5,this._normalReflectance=.028,this.baseMethod._iModulateMethod=function(e,t,i,a,s){return r.modulateSpecular(e,t,i,a,s)},this._incidentLight=!t}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.secondaryFragmentConstantsIndex;e.fragmentConstantData[i+2]=1,e.fragmentConstantData[i+3]=0},Object.defineProperty(t.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},set:function(e){this._incidentLight==e&&(this._incidentLight=!e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=t.fragmentConstantData,s=i.secondaryFragmentConstantsIndex;a[s]=this._normalReflectance,a[s+1]=this._fresnelPower},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._dataReg=r.getFreeFragmentConstant(),console.log("SpecularFresnelMethod","iGetFragmentPreLightingCode",this._dataReg),i.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t.prototype.modulateSpecular=function(e,t,i,r,a){var s;return s="dp3 "+i+".y, "+a.viewDirFragment+".xyz, "+(this._incidentLight?i:a.normalFragment)+".xyz\nsub "+i+".y, "+this._dataReg+".z, "+i+".y\npow "+i+".x, "+i+".y, "+this._dataReg+".y\nsub "+i+".y, "+this._dataReg+".z, "+i+".y\nmul "+i+".y, "+this._dataReg+".x, "+i+".y\nadd "+i+".y, "+i+".x, "+i+".y\nmul "+i+".w, "+i+".w, "+i+".y\n",console.log("SpecularFresnelMethod","modulateSpecular",s),s},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularPhongMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/SpecularBasicMethod"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var n,o="";this._pIsFirstLight?n=this._pTotalLightColorReg:(n=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(n,1));var h=s.viewDirFragment,l=s.normalFragment;return o+="dp3 "+n+".w, "+i+", "+l+"\nadd "+n+".w, "+n+".w, "+n+".w\nmul "+n+".xyz, "+l+", "+n+".w\nsub "+n+".xyz, "+n+", "+i+"\nadd "+n+".w, "+n+".w, "+s.commons+".w\nsat "+n+".w, "+n+".w\nmul "+n+".xyz, "+n+", "+n+".w\ndp3 "+n+".w, "+n+", "+h+"\nsat "+n+".w, "+n+".w\n",o+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+n+".w, "+n+".w, "+this._pSpecularTexData+".w\n":"pow "+n+".w, "+n+".w, "+this._pSpecularDataRegister+".w\n",e.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+i+".w\n"),null!=this._iModulateMethod&&(o+=this._iModulateMethod(e,t,n,a,s)),o+="mul "+n+".xyz, "+r+".xyz, "+n+".w\n",this._pIsFirstLight||(o+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n",a.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/SpecularBasicMethod":void 0}],"awayjs-renderergl/lib/materials/passes/DepthMapPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/materials/passes/MaterialPassBase"),o=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),h=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex,r=t.fragmentConstantData;r[i]=1,r[i+1]=255,r[i+2]=65025,r[i+3]=16581375,r[i+4]=1/255,r[i+5]=1/255,r[i+6]=1/255,r[i+7]=0},t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++,e.alphaThreshold>0&&e.uvDependencies++},t.prototype._iGetFragmentCode=function(e,t,i){var r="",a=i.shadedTarget,s=t.getFreeTextureReg(),n=t.getFreeFragmentConstant(),h=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var l=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(l,1);var p=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(p,1),r+="div "+l+", "+i.projectionFragment+", "+i.projectionFragment+".w\nmul "+l+", "+n+", "+l+".z\nfrc "+l+", "+l+"\nmul "+p+", "+l+".yzww, "+h+"\n",e.alphaThreshold>0){s=t.getFreeTextureReg(),this._texturesIndex=s.index;var d=t.getFreeFragmentVectorTemp();r+=o.getTex2DSampleCode(d,i,s,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var c=t.getFreeFragmentConstant();r+="sub "+d+".w, "+d+".w, "+c+".x\nkil "+d+".w\n"}return r+="sub "+a+", "+l+", "+p+"\n",t.removeFragmentTempUsage(l),t.removeFragmentTempUsage(p),r},t.prototype._iRender=function(){},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=i.context,h=t.shaderObject;h.alphaThreshold>0&&(o.setSamplerStateAt(this._texturesIndex,h.repeatTextures?s.REPEAT:s.CLAMP,h.useSmoothTextures?a.LINEAR:a.NEAREST,h.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.stage.activateTexture(this._texturesIndex,h.texture),h.fragmentConstantData[this._fragmentConstantsIndex+8]=t.shaderObject.alphaThreshold)},t}(n);t.exports=h},{"awayjs-renderergl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/passes/DistanceMapPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/materials/passes/MaterialPassBase"),o=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),h=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);var i=this._fragmentConstantsIndex,r=t.fragmentConstantData;r[i+4]=1/255,r[i+5]=1/255,r[i+6]=1/255,r[i+7]=0},t.prototype._iIncludeDependencies=function(e){e.projectionDependencies++,e.viewDirDependencies++,e.alphaThreshold>0&&e.uvDependencies++,e.addWorldSpaceDependencies(!1)},t.prototype._iGetFragmentCode=function(e,t,i){var r,a=i.shadedTarget,s=t.getFreeTextureReg(),n=t.getFreeFragmentConstant(),h=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var l=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(l,1);var p=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(p,1),r="dp3 "+l+".z, "+i.viewDirVarying+".xyz, "+i.viewDirVarying+".xyz\nmul "+l+", "+n+", "+l+".z\nfrc "+l+", "+l+"\nmul "+p+", "+l+".yzww, "+h+"\n",e.alphaThreshold>0){s=t.getFreeTextureReg(),this._texturesIndex=s.index;var d=t.getFreeFragmentVectorTemp();r+=o.getTex2DSampleCode(d,i,s,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping);var c=t.getFreeFragmentConstant();r+="sub "+d+".w, "+d+".w, "+c+".x\nkil "+d+".w\n"}return r+="sub "+a+", "+l+", "+p+"\n"},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=i.context,h=t.shaderObject,l=n.projection.far;l=1/(2*l*l);var p=this._fragmentConstantsIndex,d=h.fragmentConstantData;d[p]=1*l,d[p+1]=255*l,d[p+2]=65025*l,d[p+3]=16581375*l,h.alphaThreshold>0&&(o.setSamplerStateAt(this._texturesIndex,h.repeatTextures?s.REPEAT:s.CLAMP,h.useSmoothTextures?a.LINEAR:a.NEAREST,h.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.stage.activateTexture(this._texturesIndex,h.texture),d[p+8]=t.shaderObject.alphaThreshold)},t}(n);t.exports=h},{"awayjs-renderergl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/passes/ILightingPassStageGL":[function(){},{}],"awayjs-renderergl/lib/materials/passes/IMaterialPassStageGL":[function(){},{}],"awayjs-renderergl/lib/materials/passes/LineBasicPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/passes/MaterialPassBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iGetFragmentCode=function(e,t,i){var r=i.shadedTarget;return"mov "+r+", v0\n"},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/passes/MaterialPassBase":void 0}],"awayjs-renderergl/lib/materials/passes/MaterialPassBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/NamedAssetBase"),a=e("awayjs-core/lib/errors/ArgumentError"),s=e("awayjs-core/lib/events/Event"),n=e("awayjs-display/lib/base/BlendMode"),o=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),h=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),l=e("awayjs-renderergl/lib/materials/compilation/ShaderObjectBase"),p=e("awayjs-renderergl/lib/materials/passes/MaterialPassMode"),d=function(e){function t(t){var i=this;void 0===t&&(t=3),e.call(this),this._materialPassData=new Array,this._maxLights=3,this._preserveAlpha=!0,this._includeCasters=!0,this._forceSeparateMVP=!1,this._directionalLightsOffset=0,this._pointLightsOffset=0,this._lightProbesOffset=0,this._pNumPointLights=0,this._pNumDirectionalLights=0,this._pNumLightProbes=0,this._pNumLights=0,this._depthCompareMode=h.LESS_EQUAL,this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1,this._writeDepth=!0,this._passMode=t,this._onLightsChangeDelegate=function(e){return i.onLightsChange(e)}}return i(t,e),Object.defineProperty(t.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(e){this._preserveAlpha!=e&&(this._preserveAlpha=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(e){this._includeCasters!=e&&(this._includeCasters=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(e){this._forceSeparateMVP!=e&&(this._forceSeparateMVP=e,this._pInvalidatePass())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"directionalLightsOffset",{get:function(){return this._directionalLightsOffset},set:function(e){this._directionalLightsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointLightsOffset",{get:function(){return this._pointLightsOffset},set:function(e){this._pointLightsOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightProbesOffset",{get:function(){return this._lightProbesOffset},set:function(e){this._lightProbesOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"passMode",{get:function(){return this._passMode},set:function(e){this._passMode=e,this._pInvalidatePass()},enumerable:!0,configurable:!0}),t.prototype.createShaderObject=function(e){return new l(e)},Object.defineProperty(t.prototype,"writeDepth",{get:function(){return this._writeDepth},set:function(e){this._writeDepth=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(e){this._depthCompareMode=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(this._pLightPicker&&this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate);this._materialPassData.length;)this._materialPassData[0].dispose();this._materialPassData=null},t.prototype._iRender=function(e,t,i,r,a){this.setRenderState(e,t,i,r,a)},t.prototype.setRenderState=function(e,t,i,r,a){e.shaderObject.setRenderState(t,i,r,a)},t.prototype.setBlendMode=function(e){switch(e){case n.NORMAL:this._blendFactorSource=o.ONE,this._blendFactorDest=o.ZERO,this._pEnableBlending=!1;break;case n.LAYER:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE_MINUS_SOURCE_ALPHA,this._pEnableBlending=!0;break;case n.MULTIPLY:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_COLOR,this._pEnableBlending=!0;break;case n.ADD:this._blendFactorSource=o.SOURCE_ALPHA,this._blendFactorDest=o.ONE,this._pEnableBlending=!0;break;case n.ALPHA:this._blendFactorSource=o.ZERO,this._blendFactorDest=o.SOURCE_ALPHA,this._pEnableBlending=!0;break;default:throw new a("Unsupported blend mode!")}},t.prototype._iActivate=function(e,t,i){t.context.setDepthTest(this._writeDepth&&!this._pEnableBlending,this._depthCompareMode),this._pEnableBlending&&t.context.setBlendFactors(this._blendFactorSource,this._blendFactorDest),t.activateMaterialPass(e,i)},t.prototype._iDeactivate=function(e,t){t.deactivateMaterialPass(e),t.context.setDepthTest(!0,h.LESS_EQUAL)},t.prototype._pInvalidatePass=function(){for(var e=this._materialPassData.length,t=0;e>t;t++)this._materialPassData[t].invalidate();this.dispatchEvent(new s(s.CHANGE))},Object.defineProperty(t.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(e){this._pLightPicker&&this._pLightPicker.removeEventListener(s.CHANGE,this._onLightsChangeDelegate),this._pLightPicker=e,this._pLightPicker&&this._pLightPicker.addEventListener(s.CHANGE,this._onLightsChangeDelegate),this.pUpdateLights()},enumerable:!0,configurable:!0}),t.prototype.onLightsChange=function(){this.pUpdateLights()},t.prototype.pUpdateLights=function(){var e=this._pNumDirectionalLights,t=this._pNumPointLights,i=this._pNumLightProbes;this._pLightPicker&&this._passMode&p.LIGHTING?(this._pNumDirectionalLights=this.calculateNumDirectionalLights(this._pLightPicker.numDirectionalLights),this._pNumPointLights=this.calculateNumPointLights(this._pLightPicker.numPointLights),this._pNumLightProbes=this.calculateNumProbes(this._pLightPicker.numLightProbes),this._includeCasters&&(this._pNumDirectionalLights+=this._pLightPicker.numCastingDirectionalLights,this._pNumPointLights+=this._pLightPicker.numCastingPointLights)):(this._pNumDirectionalLights=0,this._pNumPointLights=0,this._pNumLightProbes=0),this._pNumLights=this._pNumDirectionalLights+this._pNumPointLights,(e!=this._pNumDirectionalLights||t!=this._pNumPointLights||i!=this._pNumLightProbes)&&this._pInvalidatePass()},t.prototype._iIncludeDependencies=function(e){this._forceSeparateMVP&&e.globalPosDependencies++,e.outputsNormals=this._pOutputsNormals(e),e.outputsTangentNormals=e.outputsNormals&&this._pOutputsTangentNormals(e),e.usesTangentSpace=e.outputsTangentNormals&&this._pUsesTangentSpace(e),e.usesTangentSpace||e.addWorldSpaceDependencies(Boolean(this._passMode&p.EFFECTS))},t.prototype._iInitConstantData=function(){},t.prototype._iGetPreLightingVertexCode=function(){return""},t.prototype._iGetPreLightingFragmentCode=function(){return""},t.prototype._iGetVertexCode=function(){return""},t.prototype._iGetFragmentCode=function(){return""},t.prototype._iGetNormalVertexCode=function(){return""},t.prototype._iGetNormalFragmentCode=function(){return""},Object.defineProperty(t.prototype,"iNumPointLights",{get:function(){return this._pNumPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iNumDirectionalLights",{get:function(){return this._pNumDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iNumLightProbes",{get:function(){return this._pNumLightProbes},enumerable:!0,configurable:!0}),t.prototype._pOutputsNormals=function(){return!1},t.prototype._pOutputsTangentNormals=function(){return!1},t.prototype._pUsesTangentSpace=function(){return!1},t.prototype.calculateNumDirectionalLights=function(e){return Math.min(e-this._directionalLightsOffset,this._maxLights)},t.prototype.calculateNumPointLights=function(e){var t=this._maxLights-this._pNumDirectionalLights;return Math.min(e-this._pointLightsOffset,t)},t.prototype.calculateNumProbes=function(e){var t=0;return Math.min(e-this._lightProbesOffset,4/t|0)},t.prototype._iAddMaterialPassData=function(e){return this._materialPassData.push(e),e},t.prototype._iRemoveMaterialPassData=function(e){return this._materialPassData.splice(this._materialPassData.indexOf(e),1),e},t}(r);t.exports=d},{"awayjs-core/lib/errors/ArgumentError":void 0,"awayjs-core/lib/events/Event":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderObjectBase":void 0,"awayjs-renderergl/lib/materials/passes/MaterialPassMode":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/materials/passes/MaterialPassMode":[function(e,t){var i=function(){function e(){}return e.EFFECTS=1,e.LIGHTING=2,e.SUPER_SHADER=3,e}();t.exports=i},{}],"awayjs-renderergl/lib/materials/passes/SingleObjectDepthPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/textures/RenderTexture"),s=e("awayjs-display/lib/base/TriangleSubGeometry"),n=e("awayjs-stagegl/lib/base/ContextGLProgramType"),o=e("awayjs-renderergl/lib/materials/passes/MaterialPassBase"),h=function(e){function t(){e.call(this),this._textureSize=512,this._polyOffset=Array(15,0,0,0),this._projectionTexturesInvalid=!0}return i(t,e),Object.defineProperty(t.prototype,"textureSize",{get:function(){return this._textureSize},set:function(e){this._textureSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"polyOffset",{get:function(){return this._polyOffset[0]},set:function(e){this._polyOffset[0]=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){if(this._textures){for(var e in this._textures){var t=this._textures[e];t.dispose()}this._textures=null}},t.prototype.updateProjectionTextures=function(){if(this._textures)for(var e in this._textures){var t=this._textures[e];t.dispose()}this._textures=new Object,this._projections=new Object,this._projectionTexturesInvalid=!1},t.prototype._iGetVertexCode=function(){var e;return e="mul vt7, vt1, vc4.x	\nadd vt7, vt7, vt0\nmov vt7.w, vt0.w\n",e+="m44 vt2, vt7, vc0\nmov op, vt2\n",e+="div v0, vt2, vt2.w\n"},t.prototype._iGetFragmentCode=function(){var e="";return e+="mul ft0, fc0, v0.z\nfrc ft0, ft0\nmul ft1, ft0.yzww, fc1\nsub ft0, ft0, ft1\nmov oc, ft0\n"},t.prototype._iGetDepthMap=function(e){return this._textures[e.materialOwner.id]},t.prototype._iGetProjection=function(e){return this._projections[e.materialOwner.id]},t.prototype._iRender=function(e,t,i,o){var h,l,p,d=i.context,c=this._pLightPicker.allPickedLights,u=t.materialOwner.id;this._textures[u]||(this._textures[u]=new a(this._textureSize,this._textureSize)),this._projections[u]||(this._projections[u]=new r),l=c.length,p=c[0],h=p.iGetObjectProjectionMatrix(t.sourceEntity,o,this._projections[u]),i.setRenderTarget(this._textures[u],!0),d.clear(1,1,1),d.setProgramConstantsFromMatrix(n.VERTEX,0,h,!0),d.setProgramConstantsFromArray(n.FRAGMENT,0,this._enc,2),i.activateBuffer(0,t.getVertexData(s.POSITION_DATA),t.getVertexOffset(s.POSITION_DATA),s.POSITION_FORMAT),i.activateBuffer(1,t.getVertexData(s.NORMAL_DATA),t.getVertexOffset(s.NORMAL_DATA),s.NORMAL_FORMAT),d.drawTriangles(i.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},t.prototype._iActivate=function(t,i,r){this._projectionTexturesInvalid&&this.updateProjectionTextures(),e.prototype._iActivate.call(this,t,i,r),i.context.setProgramConstantsFromArray(n.VERTEX,4,this._polyOffset,1)},t}(o);t.exports=h},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/textures/RenderTexture":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/materials/passes/SkyboxPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/passes/MaterialPassBase"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype._iIncludeDependencies=function(e){e.useMipmapping=!1},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/passes/MaterialPassBase":void 0}],"awayjs-renderergl/lib/materials/passes/TriangleBasicPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLMipFilter"),a=e("awayjs-stagegl/lib/base/ContextGLTextureFilter"),s=e("awayjs-stagegl/lib/base/ContextGLWrapMode"),n=e("awayjs-renderergl/lib/materials/passes/MaterialPassBase"),o=e("awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper"),h=function(e){function t(){e.call(this),this._diffuseColor=16777215,this._diffuseR=1,this._diffuseG=1,this._diffuseB=1,this._diffuseA=1}return i(t,e),Object.defineProperty(t.prototype,"diffuseAlpha",{get:function(){return this._diffuseA},set:function(e){this._diffuseA=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._diffuseColor},set:function(e){this._diffuseColor=e,this._diffuseR=(this._diffuseColor>>16&255)/255,this._diffuseG=(this._diffuseColor>>8&255)/255,this._diffuseB=(255&this._diffuseColor)/255},enumerable:!0,configurable:!0}),t.prototype._iGetFragmentCode=function(e,t,i){var r,a="",s=i.shadedTarget;if(null!=e.texture){if(r=t.getFreeTextureReg(),this._texturesIndex=r.index,a+=o.getTex2DSampleCode(s,i,r,e.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping),e.alphaThreshold>0){var n=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index,a+="sub "+s+".w, "+s+".w, "+n+".x\nkil "+s+".w\nadd "+s+".w, "+s+".w, "+n+".x\n"}}else r=t.getFreeFragmentConstant(),this._fragmentConstantsIndex=4*r.index,a+="mov "+s+", "+r+"\n";return a},t.prototype._iIncludeDependencies=function(e){null!=e.texture&&e.uvDependencies++},t.prototype._iActivate=function(t,i,n){e.prototype._iActivate.call(this,t,i,n);var o=t.shaderObject;if(null!=o.texture)i.context.setSamplerStateAt(this._texturesIndex,o.repeatTextures?s.REPEAT:s.CLAMP,o.useSmoothTextures?a.LINEAR:a.NEAREST,o.useMipmapping?r.MIPLINEAR:r.MIPNONE),i.stage.activateTexture(this._texturesIndex,o.texture),o.alphaThreshold>0&&(o.fragmentConstantData[this._fragmentConstantsIndex]=o.alphaThreshold);else{var h=this._fragmentConstantsIndex,l=o.fragmentConstantData;l[h]=this._diffuseR,l[h+1]=this._diffuseG,l[h+2]=this._diffuseB,l[h+3]=this._diffuseA}},t}(n);t.exports=h},{"awayjs-renderergl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":void 0,"awayjs-stagegl/lib/base/ContextGLMipFilter":void 0,"awayjs-stagegl/lib/base/ContextGLTextureFilter":void 0,"awayjs-stagegl/lib/base/ContextGLWrapMode":void 0}],"awayjs-renderergl/lib/materials/passes/TriangleMethodPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/events/ShadingMethodEvent"),a=e("awayjs-renderergl/lib/materials/compilation/MethodVO"),s=e("awayjs-renderergl/lib/materials/compilation/ShaderLightingObject"),n=e("awayjs-renderergl/lib/materials/compilation/ShaderObjectBase"),o=e("awayjs-renderergl/lib/materials/methods/EffectColorTransformMethod"),h=e("awayjs-renderergl/lib/materials/passes/MaterialPassBase"),l=e("awayjs-renderergl/lib/materials/passes/MaterialPassMode"),p=function(e){function t(t){var i=this;void 0===t&&(t=3),e.call(this,t),this._iMethodVOs=new Array,this._numEffectDependencies=0,this._onShaderInvalidatedDelegate=function(e){return i.onShaderInvalidated(e)}}return i(t,e),t.prototype.createShaderObject=function(e){return this._pLightPicker&&this.passMode&l.LIGHTING?new s(e):new n(e)},t.prototype._iInitConstantData=function(t){e.prototype._iInitConstantData.call(this,t);for(var i=this._iMethodVOs.length,r=0;i>r;++r)this._iMethodVOs[r].method.iInitConstants(t,this._iMethodVOs[r])},Object.defineProperty(t.prototype,"colorTransform",{get:function(){return this.colorTransformMethod?this.colorTransformMethod.colorTransform:null},set:function(e){e?(null==this.colorTransformMethod&&(this.colorTransformMethod=new o),this.colorTransformMethod.colorTransform=e):e||this.colorTransformMethod&&(this.colorTransformMethod=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTransformMethod",{get:function(){return this._iColorTransformMethodVO?this._iColorTransformMethodVO.method:null},set:function(e){this._iColorTransformMethodVO&&this._iColorTransformMethodVO.method==e||(this._iColorTransformMethodVO&&(this._removeDependency(this._iColorTransformMethodVO),this._iColorTransformMethodVO=null),e&&(this._iColorTransformMethodVO=new a(e),this._addDependency(this._iColorTransformMethodVO)))},enumerable:!0,configurable:!0}),t.prototype._removeDependency=function(e,t){void 0===t&&(t=!1);var i=this._iMethodVOs.indexOf(e);t||this._numEffectDependencies--,e.method.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._iMethodVOs.splice(i,1),this._pInvalidatePass()
},t.prototype._addDependency=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=-1),e.method.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),t?(-1!=i?this._iMethodVOs.splice(i+this._iMethodVOs.length-this._numEffectDependencies,0,e):this._iMethodVOs.push(e),this._numEffectDependencies++):this._iMethodVOs.splice(this._iMethodVOs.length-this._numEffectDependencies,0,e),this._pInvalidatePass()},t.prototype.addEffectMethod=function(e){this._addDependency(new a(e),!0)},Object.defineProperty(t.prototype,"numEffectMethods",{get:function(){return this._numEffectDependencies},enumerable:!0,configurable:!0}),t.prototype.hasEffectMethod=function(e){return null!=this.getDependencyForMethod(e)},t.prototype.getEffectMethodAt=function(e){return 0>e||e>this._numEffectDependencies-1?null:this._iMethodVOs[e+this._iMethodVOs.length-this._numEffectDependencies].method},t.prototype.addEffectMethodAt=function(e,t){this._addDependency(new a(e),!0,t)},t.prototype.removeEffectMethod=function(e){var t=this.getDependencyForMethod(e);null!=t&&this._removeDependency(t,!0)},t.prototype.getDependencyForMethod=function(e){for(var t=this._iMethodVOs.length,i=0;t>i;++i)if(this._iMethodVOs[i].method==e)return this._iMethodVOs[i];return null},Object.defineProperty(t.prototype,"normalMethod",{get:function(){return this._iNormalMethodVO?this._iNormalMethodVO.method:null},set:function(e){this._iNormalMethodVO&&this._iNormalMethodVO.method==e||(this._iNormalMethodVO&&(this._removeDependency(this._iNormalMethodVO),this._iNormalMethodVO=null),e&&(this._iNormalMethodVO=new a(e),this._addDependency(this._iNormalMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientMethod",{get:function(){return this._iAmbientMethodVO?this._iAmbientMethodVO.method:null},set:function(e){this._iAmbientMethodVO&&this._iAmbientMethodVO.method==e||(this._iAmbientMethodVO&&(this._removeDependency(this._iAmbientMethodVO),this._iAmbientMethodVO=null),e&&(this._iAmbientMethodVO=new a(e),this._addDependency(this._iAmbientMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMethod",{get:function(){return this._iShadowMethodVO?this._iShadowMethodVO.method:null},set:function(e){this._iShadowMethodVO&&this._iShadowMethodVO.method==e||(this._iShadowMethodVO&&(this._removeDependency(this._iShadowMethodVO),this._iShadowMethodVO=null),e&&(this._iShadowMethodVO=new a(e),this._addDependency(this._iShadowMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseMethod",{get:function(){return this._iDiffuseMethodVO?this._iDiffuseMethodVO.method:null},set:function(e){this._iDiffuseMethodVO&&this._iDiffuseMethodVO.method==e||(this._iDiffuseMethodVO&&(this._removeDependency(this._iDiffuseMethodVO),this._iDiffuseMethodVO=null),e&&(this._iDiffuseMethodVO=new a(e),this._addDependency(this._iDiffuseMethodVO)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularMethod",{get:function(){return this._iSpecularMethodVO?this._iSpecularMethodVO.method:null},set:function(e){this._iSpecularMethodVO&&this._iSpecularMethodVO.method==e||(this._iSpecularMethodVO&&(this._removeDependency(this._iSpecularMethodVO),this._iSpecularMethodVO=null),e&&(this._iSpecularMethodVO=new a(e),this._addDependency(this._iSpecularMethodVO)))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(e.prototype.dispose.call(this);this._iMethodVOs.length;)this._removeDependency(this._iMethodVOs[0]);this._iMethodVOs=null},t.prototype.onShaderInvalidated=function(){this._pInvalidatePass()},t.prototype._iActivate=function(t,i,r){e.prototype._iActivate.call(this,t,i,r);for(var a,s=this._iMethodVOs.length,n=0;s>n;++n)a=this._iMethodVOs[n],a.useMethod&&a.method.iActivate(t.shaderObject,a,i.stage)},t.prototype.setRenderState=function(t,i,r,a,s){e.prototype.setRenderState.call(this,t,i,r,a,s);for(var n,o=this._iMethodVOs.length,h=0;o>h;++h)n=this._iMethodVOs[h],n.useMethod&&n.method.iSetRenderState(t.shaderObject,n,i,r,a)},t.prototype._iDeactivate=function(t,i){e.prototype._iDeactivate.call(this,t,i);for(var r,a=this._iMethodVOs.length,s=0;a>s;++s)r=this._iMethodVOs[s],r.useMethod&&r.method.iDeactivate(t.shaderObject,r,i.stage)},t.prototype._iIncludeDependencies=function(t){var i,r=this._iMethodVOs.length;for(i=0;r>i;++i)this.setupAndCountDependencies(t,this._iMethodVOs[i]);for(i=0;r>i;++i)this._iMethodVOs[i].useMethod=this._iMethodVOs[i].method.iIsUsed(t);e.prototype._iIncludeDependencies.call(this,t)},t.prototype.setupAndCountDependencies=function(e,t){t.reset(),t.method.iInitVO(e,t),t.needsProjection&&e.projectionDependencies++,t.needsGlobalVertexPos?(e.globalPosDependencies++,t.needsGlobalFragmentPos&&(e.usesGlobalPosFragment=!0)):t.needsGlobalFragmentPos&&(e.globalPosDependencies++,e.usesGlobalPosFragment=!0),t.needsNormals&&e.normalDependencies++,t.needsTangents&&e.tangentDependencies++,t.needsView&&e.viewDirDependencies++,t.needsUV&&e.uvDependencies++,t.needsSecondaryUV&&e.secondaryUVDependencies++},t.prototype._iGetPreLightingVertexCode=function(e,t,i){var r="";return this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod&&(r+=this._iAmbientMethodVO.method.iGetVertexCode(e,this._iAmbientMethodVO,t,i)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(r+=this._iDiffuseMethodVO.method.iGetVertexCode(e,this._iDiffuseMethodVO,t,i)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(r+=this._iSpecularMethodVO.method.iGetVertexCode(e,this._iSpecularMethodVO,t,i)),r},t.prototype._iGetPreLightingFragmentCode=function(e,t,i){var r="";return this._iAmbientMethodVO&&this._iAmbientMethodVO.useMethod&&(r+=this._iAmbientMethodVO.method.iGetFragmentCode(e,this._iAmbientMethodVO,i.shadedTarget,t,i),this._iAmbientMethodVO.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),this._iAmbientMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(r+=this._iDiffuseMethodVO.method.iGetFragmentPreLightingCode(e,this._iDiffuseMethodVO,t,i)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(r+=this._iSpecularMethodVO.method.iGetFragmentPreLightingCode(e,this._iSpecularMethodVO,t,i)),r},t.prototype._iGetPerLightDiffuseFragmentCode=function(e,t,i,r,a){return this._iDiffuseMethodVO.method.iGetFragmentCodePerLight(e,this._iDiffuseMethodVO,t,i,r,a)},t.prototype._iGetPerLightSpecularFragmentCode=function(e,t,i,r,a){return this._iSpecularMethodVO.method.iGetFragmentCodePerLight(e,this._iSpecularMethodVO,t,i,r,a)},t.prototype._iGetPerProbeDiffuseFragmentCode=function(e,t,i,r,a){return this._iDiffuseMethodVO.method.iGetFragmentCodePerProbe(e,this._iDiffuseMethodVO,t,i,r,a)},t.prototype._iGetPerProbeSpecularFragmentCode=function(e,t,i,r,a){return this._iSpecularMethodVO.method.iGetFragmentCodePerProbe(e,this._iSpecularMethodVO,t,i,r,a)},t.prototype._iGetPostLightingVertexCode=function(e,t,i){var r="";return this._iShadowMethodVO&&(r+=this._iShadowMethodVO.method.iGetVertexCode(e,this._iShadowMethodVO,t,i)),r},t.prototype._iGetPostLightingFragmentCode=function(e,t,i){var r="";return e.useAlphaPremultiplied&&this._pEnableBlending&&(r+="add "+i.shadedTarget+".w, "+i.shadedTarget+".w, "+i.commons+".z\ndiv "+i.shadedTarget+".xyz, "+i.shadedTarget+", "+i.shadedTarget+".w\nsub "+i.shadedTarget+".w, "+i.shadedTarget+".w, "+i.commons+".z\nsat "+i.shadedTarget+".xyz, "+i.shadedTarget+"\n"),this._iShadowMethodVO&&(r+=this._iShadowMethodVO.method.iGetFragmentCode(e,this._iShadowMethodVO,i.shadowTarget,t,i)),this._iDiffuseMethodVO&&this._iDiffuseMethodVO.useMethod&&(r+=this._iDiffuseMethodVO.method.iGetFragmentPostLightingCode(e,this._iDiffuseMethodVO,i.shadedTarget,t,i),this._iDiffuseMethodVO.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),this._iDiffuseMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment)),this._iSpecularMethodVO&&this._iSpecularMethodVO.useMethod&&(r+=this._iSpecularMethodVO.method.iGetFragmentPostLightingCode(e,this._iSpecularMethodVO,i.shadedTarget,t,i),this._iSpecularMethodVO.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),this._iSpecularMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment)),this._iShadowMethodVO&&t.removeFragmentTempUsage(i.shadowTarget),r},t.prototype._pUsesTangentSpace=function(e){if(e.usesProbes)return!1;for(var t,i=this._iMethodVOs.length,r=0;i>r;++r)if(t=this._iMethodVOs[r],t.useMethod&&!t.method.iUsesTangentSpace())return!1;return!0},t.prototype._pOutputsTangentNormals=function(){return this._iNormalMethodVO.method.iOutputsTangentNormals()},t.prototype._pOutputsNormals=function(){return this._iNormalMethodVO&&this._iNormalMethodVO.useMethod},t.prototype._iGetNormalVertexCode=function(e,t,i){return this._iNormalMethodVO.method.iGetVertexCode(e,this._iNormalMethodVO,t,i)},t.prototype._iGetNormalFragmentCode=function(e,t,i){var r=this._iNormalMethodVO.method.iGetFragmentCode(e,this._iNormalMethodVO,i.normalFragment,t,i);return this._iNormalMethodVO.needsView&&t.removeFragmentTempUsage(i.viewDirFragment),(this._iNormalMethodVO.needsGlobalFragmentPos||this._iNormalMethodVO.needsGlobalVertexPos)&&t.removeVertexTempUsage(i.globalPositionVertex),r},t.prototype._iGetVertexCode=function(e,t,i){for(var r,a="",s=this._iMethodVOs.length,n=s-this._numEffectDependencies;s>n;n++)r=this._iMethodVOs[n],r.useMethod&&(a+=r.method.iGetVertexCode(e,r,t,i),(r.needsGlobalVertexPos||r.needsGlobalFragmentPos)&&t.removeVertexTempUsage(i.globalPositionVertex));return this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod&&(a+=this._iColorTransformMethodVO.method.iGetVertexCode(e,this._iColorTransformMethodVO,t,i)),a},t.prototype._iGetFragmentCode=function(e,t,i){var r,a="";this.preserveAlpha&&this._numEffectDependencies>0&&(r=t.getFreeFragmentSingleTemp(),t.addFragmentTempUsages(r,1),a+="mov "+r+", "+i.shadedTarget+".w\n");for(var s,n=this._iMethodVOs.length,o=n-this._numEffectDependencies;n>o;o++)s=this._iMethodVOs[o],s.useMethod&&(a+=s.method.iGetFragmentCode(e,s,i.shadedTarget,t,i),s.needsNormals&&t.removeFragmentTempUsage(i.normalFragment),s.needsView&&t.removeFragmentTempUsage(i.viewDirFragment));return this.preserveAlpha&&this._numEffectDependencies>0&&(a+="mov "+i.shadedTarget+".w, "+r+"\n",t.removeFragmentTempUsage(r)),this._iColorTransformMethodVO&&this._iColorTransformMethodVO.useMethod&&(a+=this._iColorTransformMethodVO.method.iGetFragmentCode(e,this._iColorTransformMethodVO,i.shadedTarget,t,i)),a},t.prototype._iUsesShadows=function(){return Boolean(this._iShadowMethodVO||this.lightPicker.castingDirectionalLights.length>0||this.lightPicker.castingPointLights.length>0)},t.prototype._iUsesSpecular=function(){return Boolean(this._iSpecularMethodVO)},t}(h);t.exports=p},{"awayjs-renderergl/lib/events/ShadingMethodEvent":void 0,"awayjs-renderergl/lib/materials/compilation/MethodVO":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderLightingObject":void 0,"awayjs-renderergl/lib/materials/compilation/ShaderObjectBase":void 0,"awayjs-renderergl/lib/materials/methods/EffectColorTransformMethod":void 0,"awayjs-renderergl/lib/materials/passes/MaterialPassBase":void 0,"awayjs-renderergl/lib/materials/passes/MaterialPassMode":void 0}],"awayjs-renderergl/lib/materials/utils/DefaultMaterialManager":[function(e,t){var i=e("awayjs-core/lib/base/BitmapData"),r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/textures/BitmapTexture"),s=e("awayjs-renderergl/lib/materials/LineBasicMaterial"),n=e("awayjs-renderergl/lib/materials/TriangleBasicMaterial"),o=function(){function e(){}return e.getDefaultMaterial=function(t){return void 0===t&&(t=null),null!=t&&t.assetType==r.LINE_SUB_MESH?(e._defaultLineMaterial||e.createDefaultLineMaterial(),e._defaultLineMaterial):(e._defaultTriangleMaterial||e.createDefaultTriangleMaterial(),e._defaultTriangleMaterial)},e.getDefaultTexture=function(t){return void 0===t&&(t=null),e._defaultTexture||e.createDefaultTexture(),e._defaultTexture},e.createDefaultTexture=function(){e._defaultBitmapData=e.createCheckeredBitmapData(),e._defaultTexture=new a(e._defaultBitmapData,!0),e._defaultTexture.name="defaultTexture"},e.createCheckeredBitmapData=function(){var e,t,r=new i(8,8,!1,0);for(e=0;8>e;e++)for(t=0;8>t;t++)1&t^1&e&&r.setPixel(e,t,16777215);return r},e.createDefaultTriangleMaterial=function(){e._defaultTexture||e.createDefaultTexture(),e._defaultTriangleMaterial=new n(e._defaultTexture),e._defaultTriangleMaterial.mipmap=!1,e._defaultTriangleMaterial.smooth=!1,e._defaultTriangleMaterial.name="defaultTriangleMaterial"},e.createDefaultLineMaterial=function(){e._defaultLineMaterial=new s,e._defaultLineMaterial.name="defaultSegmentMaterial"},e}();t.exports=o},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/textures/BitmapTexture":void 0,"awayjs-renderergl/lib/materials/LineBasicMaterial":void 0,"awayjs-renderergl/lib/materials/TriangleBasicMaterial":void 0}],"awayjs-renderergl/lib/materials/utils/ShaderCompilerHelper":[function(e,t){var i=e("awayjs-stagegl/lib/base/ContextGLTextureFormat"),r=function(){function e(){}return e.getTex2DSampleCode=function(t,i,r,a,s,n,o,h,l){void 0===h&&(h=null),void 0===l&&(l=null);var p=l||(n?"wrap":"clamp"),d=e.getFormatStringForTexture(a),c=o&&a.hasMipmaps,u=s?c?"linear,miplinear":"linear":c?"nearest,mipnearest":"nearest";return null==h&&(h=i.uvVarying),"tex "+t+", "+h+", "+r+" <2d,"+u+","+d+p+">\n"},e.getTexCubeSampleCode=function(t,i,r,a,s,n){var o,h=e.getFormatStringForTexture(r),l=s&&r.hasMipmaps,o=a?l?"linear,miplinear":"linear":l?"nearest,mipnearest":"nearest";return"tex "+t+", "+n+", "+i+" <cube,"+h+o+">\n"},e.getFormatStringForTexture=function(e){switch(e.format){case i.COMPRESSED:return"dxt1,";case i.COMPRESSED_ALPHA:return"dxt5,";default:return""}},e}();t.exports=r},{"awayjs-stagegl/lib/base/ContextGLTextureFormat":void 0}],"awayjs-renderergl/lib/parsers/AWDParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-core/lib/geom/Matrix3D"),s=e("awayjs-core/lib/geom/Vector3D"),n=e("awayjs-core/lib/net/URLLoaderDataFormat"),o=e("awayjs-core/lib/net/URLRequest"),h=e("awayjs-core/lib/library/AssetType"),l=e("awayjs-core/lib/parsers/ParserBase"),p=e("awayjs-core/lib/parsers/ParserUtils"),d=e("awayjs-core/lib/projections/PerspectiveProjection"),c=e("awayjs-core/lib/projections/OrthographicProjection"),u=e("awayjs-core/lib/projections/OrthographicOffCenterProjection"),g=e("awayjs-core/lib/textures/BitmapCubeTexture"),_=e("awayjs-core/lib/textures/ImageCubeTexture"),m=e("awayjs-core/lib/textures/ImageTexture"),y=e("awayjs-core/lib/utils/ByteArray"),f=e("awayjs-display/lib/containers/DisplayObjectContainer"),b=e("awayjs-display/lib/base/BlendMode"),x=e("awayjs-display/lib/base/Geometry"),v=e("awayjs-display/lib/base/TriangleSubGeometry"),w=e("awayjs-display/lib/entities/DirectionalLight"),C=e("awayjs-display/lib/entities/PointLight"),T=e("awayjs-display/lib/entities/Camera"),P=e("awayjs-display/lib/entities/Mesh"),D=e("awayjs-display/lib/entities/Skybox"),S=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker"),M=e("awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper"),O=e("awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper"),A=e("awayjs-display/lib/prefabs/PrefabBase"),j=e("awayjs-display/lib/prefabs/PrimitiveCapsulePrefab"),R=e("awayjs-display/lib/prefabs/PrimitiveConePrefab"),I=e("awayjs-display/lib/prefabs/PrimitiveCubePrefab"),F=e("awayjs-display/lib/prefabs/PrimitiveCylinderPrefab"),N=e("awayjs-display/lib/prefabs/PrimitivePlanePrefab"),V=e("awayjs-display/lib/prefabs/PrimitiveSpherePrefab"),L=e("awayjs-display/lib/prefabs/PrimitiveTorusPrefab"),E=e("awayjs-renderergl/lib/animators/VertexAnimationSet"),B=e("awayjs-renderergl/lib/animators/VertexAnimator"),U=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet"),z=e("awayjs-renderergl/lib/animators/SkeletonAnimator"),k=e("awayjs-renderergl/lib/animators/data/JointPose"),G=e("awayjs-renderergl/lib/animators/data/Skeleton"),H=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),X=e("awayjs-renderergl/lib/animators/data/SkeletonJoint"),W=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode"),Y=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode"),J=e("awayjs-renderergl/lib/materials/SkyboxMaterial"),q=e("awayjs-renderergl/lib/materials/TriangleMaterialMode"),K=e("awayjs-renderergl/lib/materials/TriangleMethodMaterial"),Z=e("awayjs-renderergl/lib/materials/utils/DefaultMaterialManager"),Q=e("awayjs-renderergl/lib/materials/methods/AmbientEnvMapMethod"),$=e("awayjs-renderergl/lib/materials/methods/DiffuseDepthMethod"),et=e("awayjs-renderergl/lib/materials/methods/DiffuseCelMethod"),tt=e("awayjs-renderergl/lib/materials/methods/DiffuseGradientMethod"),it=e("awayjs-renderergl/lib/materials/methods/DiffuseLightMapMethod"),rt=e("awayjs-renderergl/lib/materials/methods/DiffuseWrapMethod"),at=e("awayjs-renderergl/lib/materials/methods/EffectAlphaMaskMethod"),st=e("awayjs-renderergl/lib/materials/methods/EffectColorMatrixMethod"),nt=e("awayjs-renderergl/lib/materials/methods/EffectColorTransformMethod"),ot=e("awayjs-renderergl/lib/materials/methods/EffectEnvMapMethod"),ht=e("awayjs-renderergl/lib/materials/methods/EffectFogMethod"),lt=e("awayjs-renderergl/lib/materials/methods/EffectFresnelEnvMapMethod"),pt=e("awayjs-renderergl/lib/materials/methods/EffectLightMapMethod"),dt=e("awayjs-renderergl/lib/materials/methods/EffectRimLightMethod"),ct=e("awayjs-renderergl/lib/materials/methods/NormalSimpleWaterMethod"),ut=e("awayjs-renderergl/lib/materials/methods/ShadowDitheredMethod"),gt=e("awayjs-renderergl/lib/materials/methods/ShadowFilteredMethod"),_t=e("awayjs-renderergl/lib/materials/methods/SpecularFresnelMethod"),mt=e("awayjs-renderergl/lib/materials/methods/ShadowHardMethod"),yt=e("awayjs-renderergl/lib/materials/methods/SpecularAnisotropicMethod"),ft=e("awayjs-renderergl/lib/materials/methods/SpecularCelMethod"),bt=e("awayjs-renderergl/lib/materials/methods/SpecularPhongMethod"),xt=e("awayjs-renderergl/lib/materials/methods/ShadowNearMethod"),vt=e("awayjs-renderergl/lib/materials/methods/ShadowSoftMethod"),wt=function(e){function t(){e.call(this,n.ARRAY_BUFFER),this._debug=!1,this._startedParsing=!1,this._texture_users={},this._parsed_header=!1,this._blocks=new Array,this._blocks[0]=new Ct,this._blocks[0].data=null,this.blendModeDic=new Array,this.blendModeDic.push(b.NORMAL),this.blendModeDic.push(b.ADD),this.blendModeDic.push(b.ALPHA),this.blendModeDic.push(b.DARKEN),this.blendModeDic.push(b.DIFFERENCE),this.blendModeDic.push(b.ERASE),this.blendModeDic.push(b.HARDLIGHT),this.blendModeDic.push(b.INVERT),this.blendModeDic.push(b.LAYER),this.blendModeDic.push(b.LIGHTEN),this.blendModeDic.push(b.MULTIPLY),this.blendModeDic.push(b.NORMAL),this.blendModeDic.push(b.OVERLAY),this.blendModeDic.push(b.SCREEN),this.blendModeDic.push(b.SHADER),this.blendModeDic.push(b.OVERLAY),this._depthSizeDic=new Array,this._depthSizeDic.push(256),this._depthSizeDic.push(512),this._depthSizeDic.push(2048),this._depthSizeDic.push(1024),this._version=Array()}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"awd"==e},t.supportsData=function(e){return"AWD"==p.toString(e,3)},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t,i,r,a=e.id.split("#"),s=a[0];if(1==a.length&&(t=e.assets[0])){r=this._blocks[e.id],r.data=t,t.resetAssetPath(r.name,null,!0),r.name=t.name,this._pFinalizeAsset(t),this._debug&&(console.log("Successfully loaded Bitmap for texture"),console.log("Parsed texture: Name = "+r.name))}if(a.length>1){i=e.assets[0];var n=i;if(this._cubeTextures[a[1]]=n.htmlImageElement,this._texture_users[s].push(1),this._debug&&console.log("Successfully loaded Bitmap "+this._texture_users[s].length+" / 6 for Cubetexture"),this._texture_users[s].length==this._cubeTextures.length){var o=this._cubeTextures[0],h=this._cubeTextures[1],l=this._cubeTextures[2],p=this._cubeTextures[3],d=this._cubeTextures[4],c=this._cubeTextures[5];t=new _(o,h,l,p,d,c),r=this._blocks[s],r.data=t,t.resetAssetPath(r.name,null,!0),r.name=t.name,this._pFinalizeAsset(t),this._debug&&console.log("Parsed CubeTexture: Name = "+r.name)}}}},t.prototype._iResolveDependencyFailure=function(){},t.prototype._iResolveDependencyName=function(e,t){var i=t.name;if(t){var r=this._blocks[parseInt(e.id)];t.resetAssetPath(r.name,null,!0)}var a=t.name;return t.name=i,a},t.prototype._pProceedParsing=function(){if(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0),!this._parsed_header){switch(this.parseHeader(),this._compression){case t.DEFLATE:case t.LZMA:this._pDieWithError("Compressed AWD formats not yet supported");break;case t.UNCOMPRESSED:this._body=this._byteData}this._parsed_header=!0}if(this._body){for(;this._body.getBytesAvailable()>0&&!this.parsingPaused;)this.parseNextBlock();return 0==this._body.getBytesAvailable()?(this.dispose(),l.PARSING_DONE):l.MORE_TO_PARSE}switch(this._compression){case t.DEFLATE:case t.LZMA:this._debug&&console.log("(!) AWDParser Error: Compressed AWD formats not yet supported (!)")}return l.PARSING_DONE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new f},t.prototype.dispose=function(){for(var e in this._blocks){var t=this._blocks[e];t.dispose()}},t.prototype.parseNextBlock=function(){var e,i,r,a,s,n=!1;this._cur_block_id=this._body.readUnsignedInt(),i=this._body.readUnsignedByte(),r=this._body.readUnsignedByte(),a=this._body.readUnsignedByte(),s=this._body.readUnsignedInt();{var o=Pt.test(a,Pt.FLAG4);Pt.test(a,Pt.FLAG5)}this._accuracyOnBlocks&&(this._accuracyMatrix=Pt.test(a,Pt.FLAG1),this._accuracyGeo=Pt.test(a,Pt.FLAG2),this._accuracyProps=Pt.test(a,Pt.FLAG3),this._geoNrType=t.FLOAT32,this._accuracyGeo&&(this._geoNrType=t.FLOAT64),this._matrixNrType=t.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=t.FLOAT64),this._propsNrType=t.FLOAT32,this._accuracyProps&&(this._propsNrType=t.FLOAT64));var h=this._body.position+s;if(s>this._body.getBytesAvailable())return this._pDieWithError("AWD2 block length is bigger than the bytes that are available!"),void(this._body.position+=this._body.getBytesAvailable());this._newBlockBytes=new y,this._body.readBytes(this._newBlockBytes,0,s),o&&this._pDieWithError("Compressed AWD formats not yet supported"),this._newBlockBytes.position=0,e=new Ct,e.len=this._newBlockBytes.position+s,e.id=this._cur_block_id;var l=this._newBlockBytes.position+s;if(o&&this._pDieWithError("Compressed AWD formats not yet supported"),this._debug&&console.log("AWDBlock:  ID = "+this._cur_block_id+" | TypeID = "+r+" | Compression = "+o+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps),this._blocks[this._cur_block_id]=e,2==this._version[0]&&1==this._version[1])switch(r){case 11:this.parsePrimitves(this._cur_block_id),n=!0;break;case 31:this.parseSkyboxInstance(this._cur_block_id),n=!0;break;case 41:this.parseLight(this._cur_block_id),n=!0;break;case 42:this.parseCamera(this._cur_block_id),n=!0;break;case 51:this.parseLightPicker(this._cur_block_id),n=!0;break;case 81:this.parseMaterial_v1(this._cur_block_id),n=!0;break;case 83:this.parseCubeTexture(this._cur_block_id),n=!0;break;case 91:this.parseSharedMethodBlock(this._cur_block_id),n=!0;break;case 92:this.parseShadowMethodBlock(this._cur_block_id),n=!0;break;case 111:this.parseMeshPoseAnimation(this._cur_block_id,!0),n=!0;break;case 112:this.parseMeshPoseAnimation(this._cur_block_id),n=!0;break;case 113:this.parseVertexAnimationSet(this._cur_block_id),n=!0;break;case 122:this.parseAnimatorSet(this._cur_block_id),n=!0;break;case 253:this.parseCommand(this._cur_block_id),n=!0}if(0==n)switch(r){case 1:this.parseTriangleGeometrieBlock(this._cur_block_id);break;case 22:this.parseContainer(this._cur_block_id);break;case 23:this.parseMeshInstance(this._cur_block_id);break;case 81:this.parseMaterial(this._cur_block_id);break;case 82:this.parseTexture(this._cur_block_id);break;case 101:this.parseSkeleton(this._cur_block_id);break;case 102:this.parseSkeletonPose(this._cur_block_id);break;case 103:this.parseSkeletonAnimation(this._cur_block_id);break;case 121:case 254:this.parseNameSpace(this._cur_block_id);break;case 255:this.parseMetaData(this._cur_block_id);break;default:this._debug&&console.log("AWDBlock:   Unknown BlockType  (BlockID = "+this._cur_block_id+") - Skip "+s+" bytes"),this._newBlockBytes.position+=s}var p=0;if(this._newBlockBytes.position==l){if(this._debug&&e.errorMessages)for(;p<e.errorMessages.length;)console.log("        (!) Error: "+e.errorMessages[p]+" (!)"),p++;this._debug&&console.log("\n")}else if(this._debug&&(console.log("  (!)(!)(!) Error while reading AWDBlock ID "+this._cur_block_id+" = skip to next block"),e.errorMessages))for(;p<e.errorMessages.length;)console.log("        (!) Error: "+e.errorMessages[p]+" (!)"),p++;this._body.position=h,this._newBlockBytes=null},t.prototype.parseTriangleGeometrieBlock=function(e){for(var t=new x,i=this.parseVarStr(),r=this._newBlockBytes.readUnsignedShort(),a=this.parseProperties({1:this._geoNrType,2:this._geoNrType}),s=a.get(1,1),n=a.get(2,1),o=0;r>o;){var h,l,p,d,c;h=this._newBlockBytes.readUnsignedInt(),l=this._newBlockBytes.position+h;for(var u=this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._newBlockBytes.position<l;){var g,_,m,y,f=0;_=this._newBlockBytes.readUnsignedByte(),g=this._newBlockBytes.readUnsignedByte(),m=this._newBlockBytes.readUnsignedInt(),y=this._newBlockBytes.position+m;var b,w,C;if(1==_)for(var T=new Array;this._newBlockBytes.position<y;)b=this.readNumber(this._accuracyGeo),w=this.readNumber(this._accuracyGeo),C=this.readNumber(this._accuracyGeo),T[f++]=b,T[f++]=w,T[f++]=C;else if(2==_)for(var P=new Array;this._newBlockBytes.position<y;)P[f++]=this._newBlockBytes.readUnsignedShort();else if(3==_)for(var D=new Array;this._newBlockBytes.position<y;)D[f++]=this.readNumber(this._accuracyGeo);else if(4==_)for(var S=new Array;this._newBlockBytes.position<y;)S[f++]=this.readNumber(this._accuracyGeo);else if(6==_)for(d=Array();this._newBlockBytes.position<y;)d[f++]=3*this._newBlockBytes.readUnsignedShort();else if(7==_)for(c=new Array;this._newBlockBytes.position<y;)c[f++]=this.readNumber(this._accuracyGeo);else this._newBlockBytes.position=y}this.parseUserAttributes(),p=new v(!0),c&&(p.jointsPerVertex=c.length/(T.length/3)),S&&(p.autoDeriveNormals=!1),D&&(p.autoDeriveUVs=!1),p.updateIndices(P),p.updatePositions(T),p.updateVertexNormals(S),p.updateUVs(D),p.updateVertexTangents(null),p.updateJointWeights(c),p.updateJointIndices(d);var M=u.get(1,1),O=u.get(2,1),A=!1;(s!=M||n!=O)&&(A=!0,M=s/M,O=n/O),A&&p.scaleUV(M,O),t.addSubGeometry(p),o++}(1!=s||1!=n)&&t.scaleUV(s,n),this.parseUserAttributes(),this._pFinalizeAsset(t,i),this._blocks[e].data=t,this._debug&&console.log("Parsed a TriangleGeometry: Name = "+i+"| Id = "+p.id)},t.prototype.parsePrimitves=function(e){var i,r,a,s;i=this.parseVarStr(),a=this._newBlockBytes.readUnsignedByte(),s=this.parseProperties({101:this._geoNrType,102:this._geoNrType,103:this._geoNrType,110:this._geoNrType,111:this._geoNrType,301:t.UINT16,302:t.UINT16,303:t.UINT16,701:t.BOOL,702:t.BOOL,703:t.BOOL,704:t.BOOL});var n=["Unsupported Type-ID","PrimitivePlanePrefab","PrimitiveCubePrefab","PrimitiveSpherePrefab","PrimitiveCylinderPrefab","PrimitivesConePrefab","PrimitivesCapsulePrefab","PrimitivesTorusPrefab"];switch(a){case 1:r=new N(s.get(101,100),s.get(102,100),s.get(301,1),s.get(302,1),s.get(701,!0),s.get(702,!1));break;case 2:r=new I(s.get(101,100),s.get(102,100),s.get(103,100),s.get(301,1),s.get(302,1),s.get(303,1),s.get(701,!0));break;case 3:r=new V(s.get(101,50),s.get(301,16),s.get(302,12),s.get(701,!0));break;case 4:r=new F(s.get(101,50),s.get(102,50),s.get(103,100),s.get(301,16),s.get(302,1),!0,!0,!0),s.get(701,!0)||(r.topClosed=!1),s.get(702,!0)||(r.bottomClosed=!1),s.get(703,!0)||(r.yUp=!1);break;case 5:r=new R(s.get(101,50),s.get(102,100),s.get(301,16),s.get(302,1),s.get(701,!0),s.get(702,!0));break;case 6:r=new j(s.get(101,50),s.get(102,100),s.get(301,16),s.get(302,15),s.get(701,!0));break;case 7:r=new L(s.get(101,50),s.get(102,50),s.get(301,16),s.get(302,8),s.get(701,!0));break;default:r=new A,console.log("ERROR: UNSUPPORTED PREFAB_TYPE")}1!=s.get(110,1)||1!=s.get(111,1),this.parseUserAttributes(),r.name=i,this._pFinalizeAsset(r,i),this._blocks[e].data=r,this._debug&&((0>a||a>7)&&(a=0),console.log("Parsed a Primivite: Name = "+i+"| type = "+n[a]))},t.prototype.parseContainer=function(e){var i,r,a,n;r=this._newBlockBytes.readUnsignedInt(),a=this.parseMatrix3D(),i=this.parseVarStr();var o="Root (TopLevel)";n=new f,n.transform.matrix3D=a;var l=this.getAssetByID(r,[h.CONTAINER,h.LIGHT,h.MESH]);if(l[0]){{l[1].addChild(n)}o=l[1].name}else r>0?this._blocks[e].addError("Could not find a parent for this ObjectContainer3D"):this._pContent.addChild(n);if(2==this._version[0]&&1==this._version[1]){var p=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8});n.pivot=new s(p.get(1,0),p.get(2,0),p.get(3,0))}else this.parseProperties(null);n.extra=this.parseUserAttributes(),this._pFinalizeAsset(n,i),this._blocks[e].data=n,this._debug&&console.log("Parsed a Container: Name = '"+i+"' | Parent-Name = "+o)},t.prototype.parseMeshInstance=function(e){var i,r,a,n=this._newBlockBytes.readUnsignedInt(),o=this.parseMatrix3D(),l=this.parseVarStr(),p="Root (TopLevel)",d=this._newBlockBytes.readUnsignedInt(),c=this.getAssetByID(d,[h.GEOMETRY]);c[0]?a=c[1]:(this._blocks[e].addError("Could not find a Geometry for this Mesh. A empty Geometry is created!"),a=new x),this._blocks[e].geoID=d;var u=new Array;i=this._newBlockBytes.readUnsignedShort();var g=new Array;r=0;for(var _;i>r;){var m;m=this._newBlockBytes.readUnsignedInt(),_=this.getAssetByID(m,[h.MATERIAL]),!_[0]&&m>0&&this._blocks[e].addError("Could not find Material Nr "+r+" (ID = "+m+" ) for this Mesh");var y=_[1];u.push(y),g.push(y.name),r++}var f=new P(a,null);f.transform.matrix3D=o;var b=this.getAssetByID(n,[h.CONTAINER,h.LIGHT,h.MESH]);if(b[0]){var v=b[1];v.addChild(f),p=v.name}else n>0?this._blocks[e].addError("Could not find a parent for this Mesh"):this._pContent.addChild(f);if(u.length>=1&&1==f.subMeshes.length)f.material=u[0];else if(u.length>1){var w;for(w=0;w<f.subMeshes.length;w++)f.subMeshes[w].material=u[Math.min(u.length-1,w)]}if(2==this._version[0]&&1==this._version[1]){var C=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8,5:t.BOOL});f.pivot=new s(C.get(1,0),C.get(2,0),C.get(3,0)),f.castsShadows=C.get(5,!0)}else this.parseProperties(null);f.extra=this.parseUserAttributes(),this._pFinalizeAsset(f,l),this._blocks[e].data=f,this._debug&&console.log("Parsed a Mesh: Name = '"+l+"' | Parent-Name = "+p+"| Geometry-Name = "+a.name+" | SubMeshes = "+f.subMeshes.length+" | Mat-Names = "+g.toString())},t.prototype.parseSkyboxInstance=function(e){var t=this.parseVarStr(),i=this._newBlockBytes.readUnsignedInt(),r=this.getAssetByID(i,[h.TEXTURE],"CubeTexture");r[0]||0==i||this._blocks[e].addError("Could not find the Cubetexture (ID = "+i+" ) for this Skybox");var a=new D(new J(r[1]));this.parseProperties(null),a.extra=this.parseUserAttributes(),this._pFinalizeAsset(a,t),this._blocks[e].data=a,this._debug&&console.log("Parsed a Skybox: Name = '"+t+"' | CubeTexture-Name = "+r[1].name)},t.prototype.parseLight=function(e){var i,r,a=this._newBlockBytes.readUnsignedInt(),s=this.parseMatrix3D(),n=this.parseVarStr(),o=this._newBlockBytes.readUnsignedByte(),l=this.parseProperties({1:this._propsNrType,2:this._propsNrType,3:t.COLOR,4:this._propsNrType,5:this._propsNrType,6:t.BOOL,7:t.COLOR,8:this._propsNrType,9:t.UINT8,10:t.UINT8,11:this._propsNrType,12:t.UINT16,21:this._matrixNrType,22:this._matrixNrType,23:this._matrixNrType}),p=l.get(9,0),d="Root (TopLevel)",c=["Unsupported LightType","PointLight","DirectionalLight"],u=["No ShadowMapper","DirectionalShadowMapper","NearDirectionalShadowMapper","CascadeShadowMapper","CubeMapShadowMapper"];
if(1==o&&(i=new C,i.radius=l.get(1,9e4),i.fallOff=l.get(2,1e5),p>0&&4==p&&(r=new M),i.transform.matrix3D=s),2==o&&(i=new w(l.get(21,0),l.get(22,-1),l.get(23,1)),p>0&&1==p&&(r=new O)),i.color=l.get(3,16777215),i.specular=l.get(4,1),i.diffuse=l.get(5,1),i.ambientColor=l.get(7,16777215),i.ambient=l.get(8,0),r&&(r instanceof M?1!=l.get(10,1)&&(r.depthMapSize=this._depthSizeDic[l.get(10,1)]):2!=l.get(10,2)&&(r.depthMapSize=this._depthSizeDic[l.get(10,2)]),i.shadowMapper=r,i.castsShadows=!0),0!=a){var g=this.getAssetByID(a,[h.CONTAINER,h.LIGHT,h.MESH]);g[0]?(g[1].addChild(i),d=g[1].name):this._blocks[e].addError("Could not find a parent for this Light")}else this._pContent.addChild(i);this.parseUserAttributes(),this._pFinalizeAsset(i,n),this._blocks[e].data=i,this._debug&&console.log("Parsed a Light: Name = '"+n+"' | Type = "+c[o]+" | Parent-Name = "+d+" | ShadowMapper-Type = "+u[p])},t.prototype.parseCamera=function(e){var i,r=this._newBlockBytes.readUnsignedInt(),a=this.parseMatrix3D(),n=this.parseVarStr(),o="Root (TopLevel)";this._newBlockBytes.readUnsignedByte(),this._newBlockBytes.readShort();var l=this._newBlockBytes.readShort(),p=this.parseProperties({101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType});switch(l){case 5001:i=new d(p.get(101,60));break;case 5002:i=new c(p.get(101,500));break;case 5003:i=new u(p.get(101,-400),p.get(102,400),p.get(103,-300),p.get(104,300));break;default:return void console.log("unsupportedLenstype")}var g=new T(i);g.transform.matrix3D=a;var _=this.getAssetByID(r,[h.CONTAINER,h.LIGHT,h.MESH]);if(_[0]){var m=_[1];m.addChild(g),o=m.name}else r>0?this._blocks[e].addError("Could not find a parent for this Camera"):this._pContent.addChild(g);g.name=n,p=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8}),g.pivot=new s(p.get(1,0),p.get(2,0),p.get(3,0)),g.extra=this.parseUserAttributes(),this._pFinalizeAsset(g,n),this._blocks[e].data=g,this._debug&&console.log("Parsed a Camera: Name = '"+n+"' | Projectiontype = "+i+" | Parent-Name = "+o)},t.prototype.parseLightPicker=function(e){var t,i=this.parseVarStr(),r=this._newBlockBytes.readUnsignedShort(),a=new Array,s=0,n=0,o=new Array;for(s=0;r>s;s++)n=this._newBlockBytes.readUnsignedInt(),t=this.getAssetByID(n,[h.LIGHT]),t[0]?(a.push(t[1]),o.push(t[1].name)):this._blocks[e].addError("Could not find a Light Nr "+s+" (ID = "+n+" ) for this LightPicker");if(0==a.length)return this._blocks[e].addError("Could not create this LightPicker, cause no Light was found."),void this.parseUserAttributes();var l=new S(a);l.name=i,this.parseUserAttributes(),this._pFinalizeAsset(l,i),this._blocks[e].data=l,this._debug&&console.log("Parsed a StaticLightPicker: Name = '"+i+"' | Texture-Name = "+o.toString())},t.prototype.parseMaterial=function(e){var i,r,a,s,n,o,l,p;for(i=this.parseVarStr(),r=this._newBlockBytes.readUnsignedByte(),o=this._newBlockBytes.readUnsignedByte(),a=this.parseProperties({1:t.INT32,2:t.BADDR,10:this._propsNrType,11:t.BOOL,12:this._propsNrType,13:t.BOOL}),l=0;o>l;){var d;d=this._newBlockBytes.readUnsignedShort(),this.parseProperties(null),this.parseUserAttributes(),l+=1}var c="";if(n=this.parseUserAttributes(),1===r){c+="Parsed a ColorMaterial(SinglePass): Name = '"+i+"' | ";var u;u=a.get(1,16777215),this.materialMode<2?s=new K(u,a.get(10,1)):(s=new K(u),s.materialMode=q.MULTI_PASS)}else if(2===r){var g=a.get(2,0);p=this.getAssetByID(g,[h.TEXTURE]),!p[0]&&g>0&&this._blocks[e].addError("Could not find the DiffsueTexture (ID = "+g+" ) for this Material"),s=new K(p[1]),this.materialMode<2?(s.alphaBlending=a.get(11,!1),s.alpha=a.get(10,1),c+="Parsed a TriangleMethodMaterial(SinglePass): Name = '"+i+"' | Texture-Name = "+s.name):(s.materialMode=q.MULTI_PASS,c+="Parsed a TriangleMethodMaterial(MultiPass): Name = '"+i+"' | Texture-Name = "+s.name)}s.extra=n,s.alphaThreshold=a.get(12,0),s.repeat=a.get(13,!1),this._pFinalizeAsset(s,i),this._blocks[e].data=s,this._debug&&console.log(c)},t.prototype.parseMaterial_v1=function(e){var i,r,a,s,n=this.parseVarStr(),o=this._newBlockBytes.readUnsignedByte(),l=this._newBlockBytes.readUnsignedByte(),p=this.parseProperties({1:t.UINT32,2:t.BADDR,3:t.BADDR,4:t.UINT8,5:t.BOOL,6:t.BOOL,7:t.BOOL,8:t.BOOL,9:t.UINT8,10:this._propsNrType,11:t.BOOL,12:this._propsNrType,13:t.BOOL,15:this._propsNrType,16:t.UINT32,17:t.BADDR,18:this._propsNrType,19:this._propsNrType,20:t.UINT32,21:t.BADDR,22:t.BADDR}),d=p.get(4,0),c="";if(d>=2)return void this._blocks[e].addError("Material-spezialType '"+d+"' is not supported, can only be 0:singlePass, 1:MultiPass !");if(1==this.materialMode?d=0:2==this.materialMode&&(d=1),2>d){if(1==o){var u=p.get(1,13421772);1==d?(i=new K(u),i.materialMode=q.MULTI_PASS,c+="Parsed a ColorMaterial(MultiPass): Name = '"+n+"' | "):(i=new K(u,p.get(10,1)),i.alphaBlending=p.get(11,!1),c+="Parsed a ColorMaterial(SinglePass): Name = '"+n+"' | ")}else if(2==o){var g=p.get(2,0);s=this.getAssetByID(g,[h.TEXTURE]),!s[0]&&g>0&&this._blocks[e].addError("Could not find the AmbientTexture (ID = "+g+" ) for this TriangleMethodMaterial");var _=s[1];i=new K(_),1==d?(i.materialMode=q.MULTI_PASS,c+="Parsed a TriangleMethodMaterial(MultiPass): Name = '"+n+"' | Texture-Name = "+_.name):(i.alpha=p.get(10,1),i.alphaBlending=p.get(11,!1),c+="Parsed a TriangleMethodMaterial(SinglePass): Name = '"+n+"' | Texture-Name = "+_.name)}var m,y=p.get(17,0);s=this.getAssetByID(y,[h.TEXTURE]),s[0]||0==y||this._blocks[e].addError("Could not find the DiffuseTexture (ID = "+y+" ) for this TriangleMethodMaterial"),s[0]&&(m=s[1]),m&&(i.diffuseTexture=m,c+=" | DiffuseTexture-Name = "+m.name);var f=p.get(3,0);s=this.getAssetByID(f,[h.TEXTURE]),s[0]||0==f||this._blocks[e].addError("Could not find the NormalTexture (ID = "+f+" ) for this TriangleMethodMaterial"),s[0]&&(r=s[1],c+=" | NormalTexture-Name = "+r.name);var b=p.get(21,0);s=this.getAssetByID(b,[h.TEXTURE]),s[0]||0==b||this._blocks[e].addError("Could not find the SpecularTexture (ID = "+b+" ) for this TriangleMethodMaterial"),s[0]&&(a=s[1],c+=" | SpecularTexture-Name = "+a.name);var x=p.get(22,0);s=this.getAssetByID(x,[h.LIGHT_PICKER]),!s[0]&&x?this._blocks[e].addError("Could not find the LightPicker (ID = "+x+" ) for this TriangleMethodMaterial"):i.lightPicker=s[1],i.smooth=p.get(5,!0),i.mipmap=p.get(6,!0),i.bothSides=p.get(7,!1),i.alphaPremultiplied=p.get(8,!1),i.blendMode=this.blendModeDic[p.get(9,0)],i.repeat=p.get(13,!1),r&&(i.normalMap=r),a&&(i.specularMap=a),i.alphaThreshold=p.get(12,0),i.ambient=p.get(15,1),i.diffuseColor=p.get(16,16777215),i.specular=p.get(18,1),i.gloss=p.get(19,50),i.specularColor=p.get(20,16777215);for(var v,w=0;l>w;){var C;switch(C=this._newBlockBytes.readUnsignedShort(),p=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4}),C){case 999:v=p.get(1,0),s=this.getAssetByID(v,[h.EFFECTS_METHOD]),s[0]?(i.addEffectMethod(s[1]),c+=" | EffectMethod-Name = "+s[1].name):this._blocks[e].addError("Could not find the EffectMethod (ID = "+v+" ) for this Material");break;case 998:v=p.get(1,0),s=this.getAssetByID(v,[h.SHADOW_MAP_METHOD]),s[0]?(i.shadowMethod=s[1],c+=" | ShadowMethod-Name = "+s[1].name):this._blocks[e].addError("Could not find the ShadowMethod (ID = "+v+" ) for this Material");break;case 1:v=p.get(1,0),s=this.getAssetByID(v,[h.TEXTURE],"CubeTexture"),s[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+v+" ) for this EnvMapAmbientMethodMaterial"),i.ambientMethod=new Q(s[1]),c+=" | AmbientEnvMapMethod | EnvMap-Name ="+s[1].name;break;case 51:i.diffuseMethod=new $,c+=" | DiffuseDepthMethod";break;case 52:v=p.get(1,0),s=this.getAssetByID(v,[h.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the GradientDiffuseTexture (ID = "+v+" ) for this GradientDiffuseMethod"),i.diffuseMethod=new tt(s[1]),c+=" | DiffuseGradientMethod | GradientDiffuseTexture-Name ="+s[1].name;break;case 53:i.diffuseMethod=new rt(p.get(101,5)),c+=" | DiffuseWrapMethod";break;case 54:v=p.get(1,0),s=this.getAssetByID(v,[h.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the LightMap (ID = "+v+" ) for this LightMapDiffuseMethod"),i.diffuseMethod=new it(s[1],this.blendModeDic[p.get(401,10)],!1,i.diffuseMethod),c+=" | DiffuseLightMapMethod | LightMapTexture-Name ="+s[1].name;break;case 55:i.diffuseMethod=new et(p.get(401,3),i.diffuseMethod),i.diffuseMethod.smoothness=p.get(101,.1),c+=" | DiffuseCelMethod";break;case 56:break;case 101:i.specularMethod=new yt,c+=" | SpecularAnisotropicMethod";break;case 102:i.specularMethod=new bt,c+=" | SpecularPhongMethod";break;case 103:i.specularMethod=new ft(p.get(101,.5),i.specularMethod),i.specularMethod.smoothness=p.get(102,.1),c+=" | SpecularCelMethod";break;case 104:i.specularMethod=new _t(p.get(701,!0),i.specularMethod),i.specularMethod.fresnelPower=p.get(101,5),i.specularMethod.normalReflectance=p.get(102,.1),c+=" | SpecularFresnelMethod";break;case 151:break;case 152:v=p.get(1,0),s=this.getAssetByID(v,[h.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the SecoundNormalMap (ID = "+v+" ) for this SimpleWaterNormalMethod"),i.normalMap||this._blocks[e].addError("Could not find a normal Map on this Material to use with this SimpleWaterNormalMethod"),i.normalMap=s[1],i.normalMethod=new ct(i.normalMap,s[1]),c+=" | NormalSimpleWaterMethod | Second-NormalTexture-Name = "+s[1].name}this.parseUserAttributes(),w+=1}}i.extra=this.parseUserAttributes(),this._pFinalizeAsset(i,n),this._blocks[e].data=i,this._debug&&console.log(c)},t.prototype.parseTexture=function(e){var t;this._blocks[e].name=this.parseVarStr();var i,r=this._newBlockBytes.readUnsignedByte();if(this._texture_users[this._cur_block_id.toString()]=[],0==r){i=this._newBlockBytes.readUnsignedInt();var a;a=this._newBlockBytes.readUTFBytes(i),this._pAddDependency(this._cur_block_id.toString(),new o(a),!1,null,!0)}else{i=this._newBlockBytes.readUnsignedInt();var s;s=new y,this._newBlockBytes.readBytes(s,0,i),this._pAddDependency(this._cur_block_id.toString(),null,!1,p.byteArrayToImage(s),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=t,this._debug){var n=["external","embed"];console.log("Start parsing a "+n[r]+" Bitmap for Texture")}},t.prototype.parseCubeTexture=function(e){var t,i,r;this._cubeTextures=new Array,this._texture_users[this._cur_block_id.toString()]=[];var a=this._newBlockBytes.readUnsignedByte();for(this._blocks[e].name=this.parseVarStr(),r=0;6>r;r++)if(this._texture_users[this._cur_block_id.toString()]=[],this._cubeTextures.push(null),0==a){t=this._newBlockBytes.readUnsignedInt();var s;s=this._newBlockBytes.readUTFBytes(t),this._pAddDependency(this._cur_block_id.toString()+"#"+r,new o(s),!1,null,!0)}else{t=this._newBlockBytes.readUnsignedInt();var n;n=new y,this._newBlockBytes.readBytes(n,0,t),this._pAddDependency(this._cur_block_id.toString()+"#"+r,null,!1,p.byteArrayToImage(n),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=i,this._debug){var h=["external","embed"];console.log("Start parsing 6 "+h[a]+" Bitmaps for CubeTexture")}},t.prototype.parseSharedMethodBlock=function(e){var t;this._blocks[e].name=this.parseVarStr(),t=this.parseSharedMethodList(e),this.parseUserAttributes(),this._blocks[e].data=t,this._pFinalizeAsset(t,this._blocks[e].name),this._blocks[e].data=t,this._debug&&console.log("Parsed a EffectMethod: Name = "+t.name+" Type = "+t)},t.prototype.parseShadowMethodBlock=function(e){var t,i;this._blocks[e].name=this.parseVarStr(),i=this._newBlockBytes.readUnsignedInt();var r=this.getAssetByID(i,[h.LIGHT]);return r[0]?(t=this.parseShadowMethodList(r[1],e),void(t&&(this.parseUserAttributes(),this._pFinalizeAsset(t,this._blocks[e].name),this._blocks[e].data=t,this._debug&&console.log("Parsed a ShadowMapMethodMethod: Name = "+t.name+" | Type = "+t+" | Light-Name = ",r[1].name)))):void this._blocks[e].addError("Could not find the TargetLight (ID = "+i+" ) for this ShadowMethod - ShadowMethod not created")},t.prototype.parseCommand=function(e){var i,r,a=(1==this._newBlockBytes.readUnsignedByte(),this._newBlockBytes.readUnsignedInt()),n=this.parseMatrix3D(),o=this.parseVarStr(),l=this.getAssetByID(a,[h.CONTAINER,h.LIGHT,h.MESH]);l[0]&&(i=l[1]);var p=(this._newBlockBytes.readShort(),this._newBlockBytes.readShort()),d=this.parseProperties({1:t.BADDR});switch(p){case 1:var c=d.get(1,0),u=this.getAssetByID(c,[h.LIGHT,h.TEXTURE_PROJECTOR]);if(!u[0]&&0!=c)return void this._blocks[e].addError("Could not find the light (ID = "+c+" ( for this CommandBock!");r=u[1],i&&i.addChild(r),r.transform.matrix3D=n}r&&(d=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8}),r.pivot=new s(d.get(1,0),d.get(2,0),d.get(3,0)),r.extra=this.parseUserAttributes()),this._blocks[e].data=r,this._debug&&console.log("Parsed a CommandBlock: Name = '"+o)},t.prototype.parseMetaData=function(){var e=this.parseProperties({1:t.UINT32,2:t.AWDSTRING,3:t.AWDSTRING,4:t.AWDSTRING,5:t.AWDSTRING});this._debug&&(console.log("Parsed a MetaDataBlock: TimeStamp         = "+e.get(1,0)),console.log("                        EncoderName       = "+e.get(2,"unknown")),console.log("                        EncoderVersion    = "+e.get(3,"unknown")),console.log("                        GeneratorName     = "+e.get(4,"unknown")),console.log("                        GeneratorVersion  = "+e.get(5,"unknown")))},t.prototype.parseNameSpace=function(){var e=this._newBlockBytes.readUnsignedByte(),t=this.parseVarStr();this._debug&&console.log("Parsed a NameSpaceBlock: ID = "+e+" | String = "+t)},t.prototype.parseShadowMethodList=function(e,i){var r,a,s,n=this._newBlockBytes.readUnsignedShort(),o=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4});switch(n){case 1002:if(a=o.get(1,0),s=this.getAssetByID(a,[h.SHADOW_MAP_METHOD]),!s[0])return this._blocks[i].addError("Could not find the ShadowBaseMethod (ID = "+a+" ) for this ShadowNearMethod - ShadowMethod not created"),r;r=new xt(s[1]);break;case 1101:r=new gt(e),r.alpha=o.get(101,1),r.epsilon=o.get(102,.002);break;case 1102:r=new ut(e,o.get(201,5)),r.alpha=o.get(101,1),r.epsilon=o.get(102,.002),r.range=o.get(103,1);break;case 1103:r=new vt(e,o.get(201,5)),r.alpha=o.get(101,1),r.epsilon=o.get(102,.002),r.range=o.get(103,1);break;case 1104:r=new mt(e),r.alpha=o.get(101,1),r.epsilon=o.get(102,.002)}return this.parseUserAttributes(),r},t.prototype.parseSkeleton=function(e){var t=this.parseVarStr(),i=this._newBlockBytes.readUnsignedShort(),r=new G;this.parseProperties(null);for(var a=0;i>a;){var s,n;this._newBlockBytes.readUnsignedShort(),s=new X,s.parentIndex=this._newBlockBytes.readUnsignedShort()-1,s.name=this.parseVarStr(),n=this.parseMatrix3D(),s.inverseBindPose=n.rawData,this.parseProperties(null),this.parseUserAttributes(),r.joints.push(s),a++}this.parseUserAttributes(),this._pFinalizeAsset(r,t),this._blocks[e].data=r,this._debug&&console.log("Parsed a Skeleton: Name = "+r.name+" | Number of Joints = "+a)},t.prototype.parseSkeletonPose=function(e){var t=this.parseVarStr(),i=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var r=new H,s=0;i>s;){var n,o;if(n=new k,o=this._newBlockBytes.readUnsignedByte(),1==o){var h=this.parseMatrix43RawData(),l=new a(h);n.orientation.fromMatrix(l),n.translation.copyFrom(l.position),r.jointPoses[s]=n}s++}this.parseUserAttributes(),this._pFinalizeAsset(r,t),this._blocks[e].data=r,this._debug&&console.log("Parsed a SkeletonPose: Name = "+r.name+" | Number of Joints = "+s)},t.prototype.parseSkeletonAnimation=function(e){var t,i,r=this.parseVarStr(),a=new W,s=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var n,o=0;s>o;)i=this._newBlockBytes.readUnsignedInt(),t=this._newBlockBytes.readUnsignedShort(),n=this.getAssetByID(i,[h.SKELETON_POSE]),n[0]?a.addFrame(this._blocks[i].data,t):this._blocks[e].addError("Could not find the SkeletonPose Frame # "+o+" (ID = "+i+" ) for this SkeletonClipNode"),o++;return 0==a.frames.length?void this._blocks[e].addError("Could not this SkeletonClipNode, because no Frames where set."):(this.parseUserAttributes(),this._pFinalizeAsset(a,r),this._blocks[e].data=a,void(this._debug&&console.log("Parsed a SkeletonClipNode: Name = "+a.name+" | Number of Frames = "+a.frames.length)))},t.prototype.parseMeshPoseAnimation=function(e,i){void 0===i&&(i=!1);var r,a,s,n,o,l,p,d,c,u,g,_,m,y,f=1,b=0,w=new Y,C=0,T=0,P=new Array,D=this.parseVarStr(),S=this._newBlockBytes.readUnsignedInt(),M=this.getAssetByID(S,[h.GEOMETRY]);if(!M[0])return void this._blocks[e].addError("Could not find the target-Geometry-Object "+S+" ) for this VertexClipNode");var O=this.getUVForVertexAnimation(S);for(i||(f=this._newBlockBytes.readUnsignedShort()),r=this._newBlockBytes.readUnsignedShort(),C=this._newBlockBytes.readUnsignedShort(),T=0;C>T;)P.push(this._newBlockBytes.readUnsignedShort()),T++;for(y=this.parseProperties({1:t.BOOL,2:t.BOOL}),w.looping=y.get(1,!0),w.stitchFinalFrame=y.get(2,!1),a=0;f>a;){for(n=this._newBlockBytes.readUnsignedShort(),u=new x,s=0;r>s;)for(T=0,d=this._newBlockBytes.readUnsignedInt(),c=this._newBlockBytes.position+d;C>T;){if(1==P[T]){for(_=M[1].subGeometries[s].indices,m=new Array,b=0;this._newBlockBytes.position<c;)o=this.readNumber(this._accuracyGeo),l=this.readNumber(this._accuracyGeo),p=this.readNumber(this._accuracyGeo),m[b++]=o,m[b++]=l,m[b++]=p;g=new v(!0),g.updateIndices(_),g.updatePositions(m),g.updateUVs(O[s]),g.updateVertexNormals(null),g.updateVertexTangents(null),g.autoDeriveNormals=!1,g.autoDeriveTangents=!1,s++,u.addSubGeometry(g)}else this._newBlockBytes.position=c;T++}w.addFrame(u,n),a++}this.parseUserAttributes(),this._pFinalizeAsset(w,D),this._blocks[e].data=w,this._debug&&console.log("Parsed a VertexClipNode: Name = "+w.name+" | Target-Geometry-Name = "+M[1].name+" | Number of Frames = "+w.frames.length)},t.prototype.parseVertexAnimationSet=function(e){for(var i,r=this.parseVarStr(),a=this._newBlockBytes.readUnsignedShort(),s=this.parseProperties({1:t.UINT16}),n=0,o=new Array,l=new Array;a>n;){i=this._newBlockBytes.readUnsignedInt();var p=this.getAssetByID(i,[h.ANIMATION_NODE]);p[0]?(p[1]instanceof Y&&l.push(p[1]),p[1]instanceof W&&o.push(p[1])):this._blocks[e].addError("Could not find the AnimationClipNode Nr "+n+" ( "+i+" ) for this AnimationSet"),n++}if(0==l.length&&0==o.length)return void this._blocks[e].addError("Could not create this AnimationSet, because it contains no animations");if(this.parseUserAttributes(),l.length>0){for(var d=new E,c=0;c<l.length;c++)d.addAnimation(l[c]);this._pFinalizeAsset(d,r),this._blocks[e].data=d,this._debug&&console.log("Parsed a VertexAnimationSet: Name = "+r+" | Animations = "+d.animations.length+" | Animation-Names = "+d.animationNames.toString())}else if(o.length>0){p=this.getAssetByID(i,[h.ANIMATION_NODE]);for(var u=new U(s.get(1,4)),c=0;c<o.length;c++)u.addAnimation(o[c]);this._pFinalizeAsset(u,r),this._blocks[e].data=u,this._debug&&console.log("Parsed a SkeletonAnimationSet: Name = "+r+" | Animations = "+u.animations.length+" | Animation-Names = "+u.animationNames.toString())}},t.prototype.parseAnimatorSet=function(e){var i,r,a=this.parseVarStr(),s=this._newBlockBytes.readUnsignedShort(),n=this.parseProperties({1:t.BADDR});i=this._newBlockBytes.readUnsignedInt();for(var o=this._newBlockBytes.readUnsignedShort(),l=new Array,p=0;o>p;p++)l.push(this._newBlockBytes.readUnsignedInt());this._newBlockBytes.readUnsignedShort(),1==this._newBlockBytes.readUnsignedByte();this.parseUserAttributes(),this.parseUserAttributes();var d,c=new Array;for(p=0;p<l.length;p++)d=this.getAssetByID(l[p],[h.MESH]),d[0]&&c.push(d[1]);if(d=this.getAssetByID(i,[h.ANIMATION_SET]),!d[0])return void this._blocks[e].addError("Could not find the AnimationSet ( "+i+" ) for this Animator");r=d[1];var u;if(1==s){if(d=this.getAssetByID(n.get(1,0),[h.SKELETON]),!d[0])return void this._blocks[e].addError("Could not find the Skeleton ( "+n.get(1,0)+" ) for this Animator");u=new z(r,d[1])}else 2==s&&(u=new B(r));for(this._pFinalizeAsset(u,a),this._blocks[e].data=u,p=0;p<c.length;p++)1==s&&(c[p].animator=u),2==s&&(c[p].animator=u);this._debug&&console.log("Parsed a Animator: Name = "+a)},t.prototype.parseSharedMethodList=function(e){var i,a,s,n=this._newBlockBytes.readUnsignedShort(),o=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType,105:this._propsNrType,106:this._propsNrType,107:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL});switch(n){case 401:i=new st(o.get(101,new Array(0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)));break;case 402:i=new nt;var l=o.get(601,0);i.colorTransform=new r(o.get(102,1),o.get(103,1),o.get(104,1),o.get(101,1),l>>16&255,l>>8&255,255&l,l>>24&255);break;case 403:a=o.get(1,0),console.log("ENV MAP",a),s=this.getAssetByID(a,[h.TEXTURE],"CubeTexture"),s[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+a+" ) for this EnvMapMethod"),i=new ot(s[1],o.get(101,1)),a=o.get(2,0),a>0&&(s=this.getAssetByID(a,[h.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the Mask-texture (ID = "+a+" ) for this EnvMapMethod"));break;case 404:a=o.get(1,0),s=this.getAssetByID(a,[h.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the LightMap (ID = "+a+" ) for this LightMapMethod"),i=new pt(s[1],this.blendModeDic[o.get(401,10)]);break;case 406:i=new dt(o.get(601,16777215),o.get(101,.4),o.get(101,2));break;case 407:a=o.get(1,0),s=this.getAssetByID(a,[h.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the Alpha-texture (ID = "+a+" ) for this AlphaMaskMethod"),i=new at(s[1],o.get(701,!1));break;case 410:a=o.get(1,0),s=this.getAssetByID(a,[h.TEXTURE],"CubeTexture"),s[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+a+" ) for this FresnelEnvMapMethod"),i=new lt(s[1],o.get(101,1));break;case 411:i=new ht(o.get(101,0),o.get(102,1e3),o.get(601,8421504))}return this.parseUserAttributes(),i},t.prototype.parseUserAttributes=function(){var e,i,r;if(i=this._newBlockBytes.readUnsignedInt(),i>0){var a;for(e={},a=this._newBlockBytes.position+i;this._newBlockBytes.position<a;){var s,n,o,h,l;if(s=this._newBlockBytes.readUnsignedByte(),n=this.parseVarStr(),o=this._newBlockBytes.readUnsignedByte(),h=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+h>a)return console.log("           Error in reading attribute # "+r+" = skipped to end of attribute-list"),this._newBlockBytes.position=a,e;switch(o){case t.AWDSTRING:l=this._newBlockBytes.readUTFBytes(h);break;case t.INT8:l=this._newBlockBytes.readByte();break;case t.INT16:l=this._newBlockBytes.readShort();break;case t.INT32:l=this._newBlockBytes.readInt();break;case t.BOOL:case t.UINT8:l=this._newBlockBytes.readUnsignedByte();break;case t.UINT16:l=this._newBlockBytes.readUnsignedShort();break;case t.UINT32:case t.BADDR:l=this._newBlockBytes.readUnsignedInt();break;case t.FLOAT32:l=this._newBlockBytes.readFloat();break;case t.FLOAT64:l=this._newBlockBytes.readDouble();break;default:l="unimplemented attribute type "+o,this._newBlockBytes.position+=h}this._debug&&console.log("attribute = name: "+n+"  / value = "+l),e[n]=l,r+=1}}return e},t.prototype.parseProperties=function(e){var t,i,r=0,a=new Tt;if(i=this._newBlockBytes.readUnsignedInt(),t=this._newBlockBytes.position+i,e)for(;this._newBlockBytes.position<t;){var s,n,o;if(n=this._newBlockBytes.readUnsignedShort(),s=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+s>t)return console.log("           Error in reading property # "+r+" = skipped to end of propertie-list"),this._newBlockBytes.position=t,a;e.hasOwnProperty(n.toString())?(o=e[n],a.set(n,this.parseAttrValue(o,s))):this._newBlockBytes.position+=s,r+=1}else this._newBlockBytes.position=t;return a},t.prototype.parseAttrValue=function(e,i){var r,a;switch(e){case t.BOOL:case t.INT8:r=1,a=this._newBlockBytes.readByte;break;case t.INT16:r=2,a=this._newBlockBytes.readShort;break;case t.INT32:r=4,a=this._newBlockBytes.readInt;break;case t.UINT8:r=1,a=this._newBlockBytes.readUnsignedByte;break;case t.UINT16:r=2,a=this._newBlockBytes.readUnsignedShort;break;case t.UINT32:case t.COLOR:case t.BADDR:r=4,a=this._newBlockBytes.readUnsignedInt;break;case t.FLOAT32:r=4,a=this._newBlockBytes.readFloat;break;case t.FLOAT64:r=8,a=this._newBlockBytes.readDouble;break;case t.AWDSTRING:return this._newBlockBytes.readUTFBytes(i);case t.VECTOR2x1:case t.VECTOR3x1:case t.VECTOR4x1:case t.MTX3x2:case t.MTX3x3:case t.MTX4x3:case t.MTX4x4:r=8,a=this._newBlockBytes.readDouble}if(i>r){for(var s=[],n=0,o=i/r;o>n;)s.push(a.apply(this._newBlockBytes)),n++;return s}var h=a.apply(this._newBlockBytes);return h},t.prototype.parseHeader=function(){var e,i;this._byteData.position=3,this._version[0]=this._byteData.readUnsignedByte(),this._version[1]=this._byteData.readUnsignedByte(),e=this._byteData.readUnsignedShort(),this._streaming=Pt.test(e,Pt.FLAG1),2==this._version[0]&&1==this._version[1]&&(this._accuracyMatrix=Pt.test(e,Pt.FLAG2),this._accuracyGeo=Pt.test(e,Pt.FLAG3),this._accuracyProps=Pt.test(e,Pt.FLAG4)),this._geoNrType=t.FLOAT32,this._accuracyGeo&&(this._geoNrType=t.FLOAT64),this._matrixNrType=t.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=t.FLOAT64),this._propsNrType=t.FLOAT32,this._accuracyProps&&(this._propsNrType=t.FLOAT64),this._compression=this._byteData.readUnsignedByte(),this._debug&&(console.log("Import AWDFile of version = "+this._version[0]+" - "+this._version[1]),console.log("Global Settings = Compression = "+this._compression+" | Streaming = "+this._streaming+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps)),i=this._byteData.readUnsignedInt(),this._streaming||i==this._byteData.getBytesAvailable()||this._pDieWithError("AWD2 body length does not match header integrity field")},t.prototype.getUVForVertexAnimation=function(e){if(this._blocks[e].data instanceof P&&(e=this._blocks[e].geoID),this._blocks[e].uvsForVertexAnimation)return this._blocks[e].uvsForVertexAnimation;var t,i,r,a,s,n,o,h=this._blocks[e].data,l=0;for(this._blocks[e].uvsForVertexAnimation=new Array;l<h.subGeometries.length;){for(n=new Array,o=h.subGeometries[l],a=o.numVertices,t=o.uvs,i=o.getStride(v.UV_DATA),r=o.getOffset(v.UV_DATA),s=0;a>s;s++)n.push(t[r+s*i+0]),n.push(t[r+s*i+1]);this._blocks[e].uvsForVertexAnimation.push(n),l++}return this._blocks[e].uvsForVertexAnimation},t.prototype.parseVarStr=function(){var e=this._newBlockBytes.readUnsignedShort();return this._newBlockBytes.readUTFBytes(e)},t.prototype.getAssetByID=function(e,t,i){void 0===i&&(i="SingleTexture");var r=new Array,a=0;if(e>0&&this._blocks[e]&&this._blocks[e].data)for(;a<t.length;){var s=this._blocks[e].data;if(s.assetType==t[a]){if(t[a]==h.TEXTURE&&"CubeTexture"==i&&this._blocks[e].data instanceof _)return r.push(!0),r.push(this._blocks[e].data),r;if(t[a]!=h.TEXTURE||"SingleTexture"!=i)return r.push(!0),r.push(this._blocks[e].data),r;if(this._blocks[e].data instanceof m)return r.push(!0),r.push(this._blocks[e].data),r}if(t[a]==h.GEOMETRY&&s.assetType==h.MESH){var n=this._blocks[e].data;return r.push(!0),r.push(n.geometry),r}a++}return r.push(!1),r.push(this.getDefaultAsset(t[0],i)),r},t.prototype.getDefaultAsset=function(e,t){switch(!0){case e==h.TEXTURE:if("CubeTexture"==t)return this.getDefaultCubeTexture();if("SingleTexture"==t)return this.getDefaultTexture();break;case e==h.MATERIAL:return this.getDefaultMaterial()}return null},t.prototype.getDefaultMaterial=function(){return this._defaultBitmapMaterial||(this._defaultBitmapMaterial=Z.getDefaultMaterial()),this._defaultBitmapMaterial},t.prototype.getDefaultTexture=function(){return this._defaultTexture||(this._defaultTexture=Z.getDefaultTexture()),this._defaultTexture},t.prototype.getDefaultCubeTexture=function(){if(!this._defaultCubeTexture){var e=Z.createCheckeredBitmapData();this._defaultCubeTexture=new g(e,e,e,e,e,e),this._defaultCubeTexture.name="defaultCubeTexture"}return this._defaultCubeTexture},t.prototype.readNumber=function(e){return void 0===e&&(e=!1),e?this._newBlockBytes.readDouble():this._newBlockBytes.readFloat()},t.prototype.parseMatrix3D=function(){return new a(this.parseMatrix43RawData())},t.prototype.parseMatrix32RawData=function(){var e,t=new Array(6);for(e=0;6>e;e++)t[e]=this._newBlockBytes.readFloat();return t},t.prototype.parseMatrix43RawData=function(){var e=new Array(16);return e[0]=this.readNumber(this._accuracyMatrix),e[1]=this.readNumber(this._accuracyMatrix),e[2]=this.readNumber(this._accuracyMatrix),e[3]=0,e[4]=this.readNumber(this._accuracyMatrix),e[5]=this.readNumber(this._accuracyMatrix),e[6]=this.readNumber(this._accuracyMatrix),e[7]=0,e[8]=this.readNumber(this._accuracyMatrix),e[9]=this.readNumber(this._accuracyMatrix),e[10]=this.readNumber(this._accuracyMatrix),e[11]=0,e[12]=this.readNumber(this._accuracyMatrix),e[13]=this.readNumber(this._accuracyMatrix),e[14]=this.readNumber(this._accuracyMatrix),e[15]=1,isNaN(e[0])&&(e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e[12]=0,e[13]=0,e[14]=0),e},t.COMPRESSIONMODE_LZMA="lzma",t.UNCOMPRESSED=0,t.DEFLATE=1,t.LZMA=2,t.INT8=1,t.INT16=2,t.INT32=3,t.UINT8=4,t.UINT16=5,t.UINT32=6,t.FLOAT32=7,t.FLOAT64=8,t.BOOL=21,t.COLOR=22,t.BADDR=23,t.AWDSTRING=31,t.AWDBYTEARRAY=32,t.VECTOR2x1=41,t.VECTOR3x1=42,t.VECTOR4x1=43,t.MTX3x2=44,t.MTX3x3=45,t.MTX4x3=46,t.MTX4x4=47,t}(l),Ct=function(){function e(){}return e.prototype.dispose=function(){this.id=null,this.bytes=null,this.errorMessages=null,this.uvsForVertexAnimation=null},e.prototype.addError=function(e){this.errorMessages||(this.errorMessages=new Array),this.errorMessages.push(e)},e}(),Tt=function(){function e(){}return e.prototype.set=function(e,t){this[e.toString()]=t},e.prototype.get=function(e,t){return this.hasOwnProperty(e.toString())?this[e.toString()]:t},e}(),Pt=function(){function e(){}return e.test=function(e,t){return(e&t)==t},e.FLAG1=1,e.FLAG2=2,e.FLAG3=4,e.FLAG4=8,e.FLAG5=16,e.FLAG6=32,e.FLAG7=64,e.FLAG8=128,e.FLAG9=256,e.FLAG10=512,e.FLAG11=1024,e.FLAG12=2048,e.FLAG13=4096,e.FLAG14=8192,e.FLAG15=16384,e.FLAG16=32768,e}();t.exports=wt},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-core/lib/projections/OrthographicOffCenterProjection":void 0,"awayjs-core/lib/projections/OrthographicProjection":void 0,"awayjs-core/lib/projections/PerspectiveProjection":void 0,"awayjs-core/lib/textures/BitmapCubeTexture":void 0,"awayjs-core/lib/textures/ImageCubeTexture":void 0,"awayjs-core/lib/textures/ImageTexture":void 0,"awayjs-core/lib/utils/ByteArray":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Camera":void 0,"awayjs-display/lib/entities/DirectionalLight":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-display/lib/entities/PointLight":void 0,"awayjs-display/lib/entities/Skybox":void 0,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":void 0,"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper":void 0,"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper":void 0,"awayjs-display/lib/prefabs/PrefabBase":void 0,"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveConePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveCubePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab":void 0,"awayjs-display/lib/prefabs/PrimitivePlanePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveSpherePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveTorusPrefab":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimator":void 0,"awayjs-renderergl/lib/animators/VertexAnimationSet":void 0,"awayjs-renderergl/lib/animators/VertexAnimator":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/Skeleton":void 0,"awayjs-renderergl/lib/animators/data/SkeletonJoint":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":void 0,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":void 0,"awayjs-renderergl/lib/materials/SkyboxMaterial":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialMode":void 0,"awayjs-renderergl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-renderergl/lib/materials/methods/AmbientEnvMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseCelMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseDepthMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseGradientMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseLightMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseWrapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectAlphaMaskMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectColorMatrixMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectColorTransformMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectEnvMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectFogMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectFresnelEnvMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectLightMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectRimLightMethod":void 0,"awayjs-renderergl/lib/materials/methods/NormalSimpleWaterMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowDitheredMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowFilteredMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowHardMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowNearMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowSoftMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularAnisotropicMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularCelMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularFresnelMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularPhongMethod":void 0,"awayjs-renderergl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/MD2Parser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e
}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/net/URLLoaderDataFormat"),a=e("awayjs-core/lib/net/URLRequest"),s=e("awayjs-core/lib/parsers/ParserBase"),n=e("awayjs-core/lib/parsers/ParserUtils"),o=e("awayjs-display/lib/containers/DisplayObjectContainer"),h=e("awayjs-display/lib/base/Geometry"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),p=e("awayjs-display/lib/entities/Mesh"),d=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode"),c=e("awayjs-renderergl/lib/animators/VertexAnimationSet"),u=e("awayjs-renderergl/lib/materials/TriangleMethodMaterial"),g=e("awayjs-renderergl/lib/materials/TriangleMaterialMode"),_=e("awayjs-renderergl/lib/materials/utils/DefaultMaterialManager"),m=function(e){function t(t,i){void 0===t&&(t="jpg"),void 0===i&&(i=!0),e.call(this,r.ARRAY_BUFFER),this._clipNodes=new Object,this._animationSet=new c,this.materialFinal=!1,this.geoCreated=!1,this._textureType=t,this._ignoreTexturePath=i}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md2"==e},t.supportsData=function(e){return"IDP2"==n.toString(e,4)},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t=e.assets[0];if(t){var i=new u(t);this.materialMode>=2&&(i.materialMode=g.MULTI_PASS),this._pContent.addChild(this._mesh),i.name=this._mesh.material.name,this._mesh.material=i,this._pFinalizeAsset(i),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)}this.materialFinal=!0}},t.prototype._iResolveDependencyFailure=function(){this.materialMode<2?this._mesh.material=_.getDefaultMaterial():(this._mesh.material=new u(_.getDefaultTexture()),this._mesh.material.materialMode=g.MULTI_PASS),this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh),this.materialFinal=!0},t.prototype._pProceedParsing=function(){for(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0,this._byteData.position=0);this._pHasTime();)if(this._parsedHeader)if(this._parsedUV)if(this._parsedFaces)if(this._parsedFrames){if(this.geoCreated&&this.materialFinal)return s.PARSING_DONE;this.geoCreated||(this.geoCreated=!0,this._geometry.addSubGeometry(this._firstSubGeom.clone()),this._mesh.name="",this.materialFinal&&(this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)),this._pPauseAndRetrieveDependencies())}else this.parseFrames();else this.parseFaces();else this.parseUV();else this._geometry=new h,this._mesh=new p(this._geometry,null),this.materialMode<2?this._mesh.material=_.getDefaultMaterial():(this._mesh.material=new u(_.getDefaultTexture()),this._mesh.material.materialMode=g.MULTI_PASS),this.parseHeader(),this.parseMaterialNames();return s.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new o},t.prototype.parseHeader=function(){this._ident=this._byteData.readInt(),this._version=this._byteData.readInt(),this._skinWidth=this._byteData.readInt(),this._skinHeight=this._byteData.readInt(),this._byteData.readInt(),this._numSkins=this._byteData.readInt(),this._numVertices=this._byteData.readInt(),this._numST=this._byteData.readInt(),this._numTris=this._byteData.readInt(),this._byteData.readInt(),this._numFrames=this._byteData.readInt(),this._offsetSkins=this._byteData.readInt(),this._offsetST=this._byteData.readInt(),this._offsetTris=this._byteData.readInt(),this._offsetFrames=this._byteData.readInt(),this._byteData.readInt(),this._offsetEnd=this._byteData.readInt(),this._parsedHeader=!0},t.prototype.parseMaterialNames=function(){var e,t,i,r;this._materialNames=new Array,this._byteData.position=this._offsetSkins;for(var s=new RegExp("[^a-zA-Z0-9\\_/.]","g"),n=0;n<this._numSkins;++n)t=this._byteData.readUTFBytes(64),t=t.replace(s,""),i=t.lastIndexOf("."),this._ignoreTexturePath&&(r=t.lastIndexOf("/")),-1==t.toLowerCase().indexOf(".jpg")&&-1==t.toLowerCase().indexOf(".png")?(t=t.substring(r+1,i),e=t+"."+this._textureType):e=t,this._materialNames[n]=t,0==this.dependencies.length&&this._pAddDependency(t,new a(e));this._materialNames.length>0?this._mesh.material.name=this._materialNames[0]:this.materialFinal=!0},t.prototype.parseUV=function(){var e=0;this._uvs=new Array(2*this._numST),this._byteData.position=this._offsetST;for(var t=0;t<this._numST;t++)this._uvs[e++]=this._byteData.readShort()/this._skinWidth,this._uvs[e++]=this._byteData.readShort()/this._skinHeight;this._parsedUV=!0},t.prototype.parseFaces=function(){var e,t,i,r,a,s,n;for(this._vertIndices=new Array,this._uvIndices=new Array,this._indices=new Array,this._byteData.position=this._offsetTris,n=0;n<this._numTris;n++)e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedShort(),a=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedShort(),this.addIndex(e,r),this.addIndex(t,a),this.addIndex(i,s);var o=this._uvIndices.length;for(this._finalUV=new Array(2*o),n=0;o>n;++n)this._finalUV[n<<1]=this._uvs[this._uvIndices[n]<<1],this._finalUV[(n<<1)+1]=this._uvs[(this._uvIndices[n]<<1)+1];this._parsedFaces=!0},t.prototype.addIndex=function(e,t){var i=this.findIndex(e,t);-1==i?(this._indices.push(this._vertIndices.length),this._vertIndices.push(e),this._uvIndices.push(t)):this._indices.push(i)},t.prototype.findIndex=function(e,t){for(var i=this._vertIndices.length,r=0;i>r;++r)if(this._vertIndices[r]==e&&this._uvIndices[r]==t)return r;return-1},t.prototype.parseFrames=function(){var e,i,r,a,s,n,o,p,c,u,g,_,m,y=this._vertIndices.length,f="",b=null;for(this._byteData.position=this._offsetFrames,g=0;g<this._numFrames;g++){for(u=new Array,c=new Array(3*y),e=this._byteData.readFloat(),i=this._byteData.readFloat(),r=this._byteData.readFloat(),a=this._byteData.readFloat(),s=this._byteData.readFloat(),n=this._byteData.readFloat(),f=this.readFrameName(),_=0;_<this._numVertices;_++,this._byteData.position++)u.push(e*this._byteData.readUnsignedByte()+a,i*this._byteData.readUnsignedByte()+s,r*this._byteData.readUnsignedByte()+n);for(m=0,_=0;y>_;_++)c[m++]=u[3*this._vertIndices[_]],c[m++]=u[3*this._vertIndices[_]+2],c[m++]=u[3*this._vertIndices[_]+1];p=new l(!0),null==this._firstSubGeom&&(this._firstSubGeom=p),o=new h,o.addSubGeometry(p),p.updateIndices(this._indices),p.updatePositions(c),p.updateUVs(this._finalUV),p.vertexNormals,p.vertexTangents,p.autoDeriveNormals=!1,p.autoDeriveTangents=!1;var x=this._clipNodes[f];x||(b&&(this._pFinalizeAsset(b),this._animationSet.addAnimation(b)),x=new d,x.name=f,x.stitchFinalFrame=!0,this._clipNodes[f]=x,b=x),x.addFrame(o,1e3/t.FPS)}b&&(this._pFinalizeAsset(b),this._animationSet.addAnimation(b)),this._pFinalizeAsset(this._animationSet),this._parsedFrames=!0},t.prototype.readFrameName=function(){for(var e="",t=0,i=0;16>i;i++){var r=this._byteData.readUnsignedByte();Math.floor(r)>57&&Math.floor(r)<=122&&0==t&&(e+=String.fromCharCode(r)),Math.floor(r)>=48&&Math.floor(r)<=57&&t++}return e},t.FPS=6,t}(s);t.exports=m},{"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/animators/VertexAnimationSet":void 0,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialMode":void 0,"awayjs-renderergl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-renderergl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/MD5AnimParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/net/URLLoaderDataFormat"),n=e("awayjs-core/lib/parsers/ParserBase"),o=e("awayjs-renderergl/lib/animators/data/JointPose"),h=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),l=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode"),p=e("awayjs-renderergl/lib/parsers/data/BaseFrameData"),d=e("awayjs-renderergl/lib/parsers/data/BoundsData"),c=e("awayjs-renderergl/lib/parsers/data/FrameData"),u=e("awayjs-renderergl/lib/parsers/data/HierarchyData"),g=function(e){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=0),e.call(this,s.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new r;var n=new r,o=new r;n.fromAxisAngle(a.X_AXIS,.5*-Math.PI),o.fromAxisAngle(a.Y_AXIS,.5*-Math.PI),this._rotationQuat.multiply(o,n),t&&(this._rotationQuat.multiply(o,n),n.fromAxisAngle(t,i),this._rotationQuat.multiply(n,this._rotationQuat))}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md5anim"==e},t.supportsData=function(){return!1},t.prototype._pProceedParsing=function(){var e;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case"":break;case t.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_FRAMES_TOKEN:this._numFrames=this.getNextInt(),this._bounds=new Array,this._frameData=new Array;break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._hierarchy=new Array(this._numJoints),this._baseFrameData=new Array(this._numJoints);break;case t.FRAME_RATE_TOKEN:this._frameRate=this.getNextInt();break;case t.NUM_ANIMATED_COMPONENTS_TOKEN:this._numAnimatedComponents=this.getNextInt();break;case t.HIERARCHY_TOKEN:this.parseHierarchy();break;case t.BOUNDS_TOKEN:this.parseBounds();break;case t.BASE_FRAME_TOKEN:this.parseBaseFrame();break;case t.FRAME_TOKEN:this.parseFrame();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF)return this._clip=new l,this.translateClip(),this._pFinalizeAsset(this._clip),n.PARSING_DONE}return n.MORE_TO_PARSE},t.prototype.translateClip=function(){for(var e=0;e<this._numFrames;++e)this._clip.addFrame(this.translatePose(this._frameData[e]),1e3/this._frameRate)},t.prototype.translatePose=function(e){for(var t,i,s,n,l,p=new a,d=new r,c=e.components,u=new h,g=u.jointPoses,_=0;_<this._numJoints;++_){l=0,i=new o,t=this._hierarchy[_],s=this._baseFrameData[_],n=t.flags,p.x=s.position.x,p.y=s.position.y,p.z=s.position.z,d.x=s.orientation.x,d.y=s.orientation.y,d.z=s.orientation.z,1&n&&(p.x=c[t.startIndex+l++]),2&n&&(p.y=c[t.startIndex+l++]),4&n&&(p.z=c[t.startIndex+l++]),8&n&&(d.x=c[t.startIndex+l++]),16&n&&(d.y=c[t.startIndex+l++]),32&n&&(d.z=c[t.startIndex+l++]);var m=1-d.x*d.x-d.y*d.y-d.z*d.z;d.w=0>m?0:-Math.sqrt(m),t.parentIndex<0?(i.orientation.multiply(this._rotationQuat,d),i.translation=this._rotationQuat.rotatePoint(p)):(i.orientation.copyFrom(d),i.translation.x=p.x,i.translation.y=p.y,i.translation.z=p.z),i.orientation.y=-i.orientation.y,i.orientation.z=-i.orientation.z,i.translation.x=-i.translation.x,g[_]=i}return u},t.prototype.parseHierarchy=function(){var e,i,r=this.getNextToken(),a=0;"{"!=r&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),i=new u,i.name=this.parseLiteralstring(),i.parentIndex=this.getNextInt(),i.flags=this.getNextInt(),i.startIndex=this.getNextInt(),this._hierarchy[a++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseBounds=function(){var e,i,r=this.getNextToken(),a=0;"{"!=r&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),i=new d,i.min=this.parseVector3D(),i.max=this.parseVector3D(),this._bounds[a++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseBaseFrame=function(){var e,i,r=this.getNextToken(),a=0;"{"!=r&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),i=new p,i.position=this.parseVector3D(),i.orientation=this.parseQuaternion(),this._baseFrameData[a++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseFrame=function(){var e,i,r,a;a=this.getNextInt(),r=this.getNextToken(),"{"!=r&&this.sendUnknownKeywordError();do{this._reachedEOF&&this.sendEOFError(),i=new c,i.components=new Array(this._numAnimatedComponents);for(var s=0;s<this._numAnimatedComponents;++s)i.components[s]=this.getNextNumber();this._frameData[a]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack()}while("}"!=e)},t.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},t.prototype.getNextToken=function(){for(var e,i="";!this._reachedEOF;){if(e=this.getNextChar()," "==e||"\r"==e||"\n"==e||"	"==e){if(i!=t.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=i)return i}else i+=e;if(i==t.COMMENT_TOKEN)return i}return i},t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while("\n"==e||" "==e||"\r"==e||"	"==e);this.putBack()},t.prototype.ignoreLine=function(){for(var e;!this._reachedEOF&&"\n"!=e;)e=this.getNextChar()},t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);return"\n"==e?(++this._line,this._charLineIndex=0):"\r"!=e&&++this._charLineIndex,this._parseIndex==this._textData.length&&(this._reachedEOF=!0),e},t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());return isNaN(e)&&this.sendParseError("int type"),e},t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());return isNaN(e)&&this.sendParseError("float type"),e},t.prototype.parseVector3D=function(){var e=new a,t=this.getNextToken();return"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseQuaternion=function(){var e=new r,t=this.getNextToken();"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber();var i=1-e.x*e.x-e.y*e.y-e.z*e.z;return e.w=0>i?0:-Math.sqrt(i),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseCMD=function(){this.parseLiteralstring()},t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar(),t="";'"'!=e&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),e=this.getNextChar(),'"'!=e&&(t+=e);while('"'!=e);return t},t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},t.VERSION_TOKEN="MD5Version",t.COMMAND_LINE_TOKEN="commandline",t.NUM_FRAMES_TOKEN="numFrames",t.NUM_JOINTS_TOKEN="numJoints",t.FRAME_RATE_TOKEN="frameRate",t.NUM_ANIMATED_COMPONENTS_TOKEN="numAnimatedComponents",t.HIERARCHY_TOKEN="hierarchy",t.BOUNDS_TOKEN="bounds",t.BASE_FRAME_TOKEN="baseframe",t.FRAME_TOKEN="frame",t.COMMENT_TOKEN="//",t}(n);t.exports=g},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":void 0,"awayjs-renderergl/lib/parsers/data/BaseFrameData":void 0,"awayjs-renderergl/lib/parsers/data/BoundsData":void 0,"awayjs-renderergl/lib/parsers/data/FrameData":void 0,"awayjs-renderergl/lib/parsers/data/HierarchyData":void 0}],"awayjs-renderergl/lib/parsers/MD5MeshParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/net/URLLoaderDataFormat"),n=e("awayjs-core/lib/parsers/ParserBase"),o=e("awayjs-display/lib/containers/DisplayObjectContainer"),h=e("awayjs-display/lib/base/Geometry"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),p=e("awayjs-display/lib/entities/Mesh"),d=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet"),c=e("awayjs-renderergl/lib/animators/data/Skeleton"),u=e("awayjs-renderergl/lib/animators/data/SkeletonJoint"),g=function(e){function t(t,i){if(void 0===t&&(t=null),void 0===i&&(i=0),e.call(this,s.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new r,this._rotationQuat.fromAxisAngle(a.X_AXIS,.5*-Math.PI),t){var n=new r;n.fromAxisAngle(t,i),this._rotationQuat.multiply(this._rotationQuat,n)}}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md5mesh"==e},t.supportsData=function(){return!1},t.prototype._pProceedParsing=function(){var e;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._bindPoses=new Array(this._numJoints);break;case t.NUM_MESHES_TOKEN:this._numMeshes=this.getNextInt();break;case t.JOINTS_TOKEN:this.parseJoints();break;case t.MESH_TOKEN:this.parseMesh();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF){this.calculateMaxJointCount(),this._animationSet=new d(this._maxJointCount),this._mesh=new p(new h,null),this._geometry=this._mesh.geometry;for(var i=0;i<this._meshData.length;++i)this._geometry.addSubGeometry(this.translateGeom(this._meshData[i].vertexData,this._meshData[i].weightData,this._meshData[i].indices));return this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._geometry),this._pFinalizeAsset(this._mesh),this._pFinalizeAsset(this._skeleton),this._pFinalizeAsset(this._animationSet),n.PARSING_DONE}}return n.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new o},t.prototype.calculateMaxJointCount=function(){this._maxJointCount=0;for(var e=this._meshData.length,t=0;e>t;++t)for(var i=this._meshData[t],r=i.vertexData,a=r.length,s=0;a>s;++s){var n=this.countZeroWeightJoints(r[s],i.weightData),o=r[s].countWeight-n;o>this._maxJointCount&&(this._maxJointCount=o)}},t.prototype.countZeroWeightJoints=function(e,t){for(var i,r=e.startWeight,a=e.startWeight+e.countWeight,s=0,n=r;a>n;++n)i=t[n].bias,0==i&&++s;return s},t.prototype.parseJoints=function(){var e,i,r,a,s=0,n=this.getNextToken();"{"!=n&&this.sendUnknownKeywordError(),this._skeleton=new c;do{this._reachedEOF&&this.sendEOFError(),i=new u,i.name=this.parseLiteralstring(),i.parentIndex=this.getNextInt(),r=this.parseVector3D(),r=this._rotationQuat.rotatePoint(r),a=this.parseQuaternion(),this._bindPoses[s]=a.toMatrix3D(),this._bindPoses[s].appendTranslation(r.x,r.y,r.z);var o=this._bindPoses[s].clone();o.invert(),i.inverseBindPose=o.rawData,this._skeleton.joints[s++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack()}while("}"!=e)},t.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},t.prototype.parseMesh=function(){var e,i,r,a,s=this.getNextToken();for("{"!=s&&this.sendUnknownKeywordError(),null==this._shaders&&(this._shaders=new Array);"}"!=e;)switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.MESH_SHADER_TOKEN:this._shaders.push(this.parseLiteralstring());break;case t.MESH_NUM_VERTS_TOKEN:i=new Array(this.getNextInt());break;case t.MESH_NUM_TRIS_TOKEN:a=new Array(3*this.getNextInt());break;case t.MESH_NUM_WEIGHTS_TOKEN:r=new Array(this.getNextInt());break;case t.MESH_VERT_TOKEN:this.parseVertex(i);break;case t.MESH_TRI_TOKEN:this.parseTri(a);break;case t.MESH_WEIGHT_TOKEN:this.parseJoint(r)}null==this._meshData&&(this._meshData=new Array);var n=this._meshData.length;this._meshData[n]=new y,this._meshData[n].vertexData=i,this._meshData[n].weightData=r,this._meshData[n].indices=a},t.prototype.translateGeom=function(e,t,i){for(var r,a,s,n,o,h,p,d,c=e.length,u=new l(!0),g=new Array(2*c),_=new Array(3*c),m=new Array(c*this._maxJointCount),y=new Array(c*this._maxJointCount),f=0,b=0;c>b;++b){n=e[b],r=3*n.index,a=r+1,s=r+2,_[r]=_[a]=_[s]=0,d=0;for(var x=0;x<n.countWeight;++x)o=t[n.startWeight+x],o.bias>0&&(h=this._bindPoses[o.joint],p=h.transformVector(o.pos),_[r]+=p.x*o.bias,_[a]+=p.y*o.bias,_[s]+=p.z*o.bias,m[f]=3*o.joint,y[f++]=o.bias,++d);for(x=d;x<this._maxJointCount;++x)m[f]=0,y[f++]=0;r=n.index<<1,g[r++]=n.s,g[r]=n.t}return u.jointsPerVertex=this._maxJointCount,u.updateIndices(i),u.updatePositions(_),u.updateUVs(g),u.updateJointIndices(m),u.updateJointWeights(y),u.vertexNormals,u.vertexTangents,u.autoDeriveTangents=!1,u.autoDeriveNormals=!1,u},t.prototype.parseTri=function(e){var t=3*this.getNextInt();e[t]=this.getNextInt(),e[t+1]=this.getNextInt(),e[t+2]=this.getNextInt()},t.prototype.parseJoint=function(e){var t=new m;t.index=this.getNextInt(),t.joint=this.getNextInt(),t.bias=this.getNextNumber(),t.pos=this.parseVector3D(),e[t.index]=t},t.prototype.parseVertex=function(e){var t=new _;t.index=this.getNextInt(),this.parseUV(t),t.startWeight=this.getNextInt(),t.countWeight=this.getNextInt(),e[t.index]=t},t.prototype.parseUV=function(e){var t=this.getNextToken();"("!=t&&this.sendParseError("("),e.s=this.getNextNumber(),e.t=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")")},t.prototype.getNextToken=function(){for(var e,i="";!this._reachedEOF;){if(e=this.getNextChar()," "==e||"\r"==e||"\n"==e||"	"==e){if(i!=t.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=i)return i}else i+=e;if(i==t.COMMENT_TOKEN)return i}return i},t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while("\n"==e||" "==e||"\r"==e||"	"==e);this.putBack()},t.prototype.ignoreLine=function(){for(var e;!this._reachedEOF&&"\n"!=e;)e=this.getNextChar()},t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);return"\n"==e?(++this._line,this._charLineIndex=0):"\r"!=e&&++this._charLineIndex,this._parseIndex>=this._textData.length&&(this._reachedEOF=!0),e},t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());return isNaN(e)&&this.sendParseError("int type"),e},t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());return isNaN(e)&&this.sendParseError("float type"),e},t.prototype.parseVector3D=function(){var e=new a,t=this.getNextToken();return"("!=t&&this.sendParseError("("),e.x=-this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseQuaternion=function(){var e=new r,t=this.getNextToken();"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=-this.getNextNumber(),e.z=-this.getNextNumber();var i=1-e.x*e.x-e.y*e.y-e.z*e.z;e.w=0>i?0:-Math.sqrt(i),")"!=this.getNextToken()&&this.sendParseError(")");var a=new r;return a.multiply(this._rotationQuat,e),a},t.prototype.parseCMD=function(){this.parseLiteralstring()},t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar(),t="";'"'!=e&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),e=this.getNextChar(),'"'!=e&&(t+=e);while('"'!=e);return t},t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},t.VERSION_TOKEN="MD5Version",t.COMMAND_LINE_TOKEN="commandline",t.NUM_JOINTS_TOKEN="numJoints",t.NUM_MESHES_TOKEN="numMeshes",t.COMMENT_TOKEN="//",t.JOINTS_TOKEN="joints",t.MESH_TOKEN="mesh",t.MESH_SHADER_TOKEN="shader",t.MESH_NUM_VERTS_TOKEN="numverts",t.MESH_VERT_TOKEN="vert",t.MESH_NUM_TRIS_TOKEN="numtris",t.MESH_TRI_TOKEN="tri",t.MESH_NUM_WEIGHTS_TOKEN="numweights",t.MESH_WEIGHT_TOKEN="weight",t}(n),_=function(){function e(){}return e}(),m=function(){function e(){}return e}(),y=function(){function e(){}return e}();t.exports=g},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/Skeleton":void 0,"awayjs-renderergl/lib/animators/data/SkeletonJoint":void 0}],"awayjs-renderergl/lib/parsers/Max3DSParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/library/AssetType"),n=e("awayjs-core/lib/net/URLLoaderDataFormat"),o=e("awayjs-core/lib/net/URLRequest"),h=e("awayjs-core/lib/parsers/ParserBase"),l=e("awayjs-core/lib/parsers/ParserUtils"),p=e("awayjs-display/lib/containers/DisplayObjectContainer"),d=e("awayjs-display/lib/base/Geometry"),c=e("awayjs-display/lib/base/TriangleSubGeometry"),u=e("awayjs-display/lib/entities/Mesh"),g=e("awayjs-renderergl/lib/materials/utils/DefaultMaterialManager"),_=e("awayjs-renderergl/lib/materials/TriangleMethodMaterial"),m=e("awayjs-renderergl/lib/materials/TriangleMaterialMode"),y=function(e){function t(t){void 0===t&&(t=!0),e.call(this,n.ARRAY_BUFFER),this._useSmoothingGroups=t}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"3ds"==e},t.supportsData=function(e){var t;return t=l.toByteArray(e),t&&(t.position=0,19789==t.readShort())?!0:!1},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t;if(t=e.assets[0],t.assetType==s.TEXTURE){var i;i=this._textures[e.id],i.texture=t}}},t.prototype._iResolveDependencyFailure=function(){},t.prototype._pProceedParsing=function(){for(this._byteData||(this._byteData=this._pGetByteData(),this._byteData.position=0,this._textures={},this._materials={},this._unfinalized_objects={});this._pHasTime();)if(this._cur_mat&&this._byteData.position>=this._cur_mat_end?this.finalizeCurrentMaterial():this._cur_obj&&this._byteData.position>=this._cur_obj_end&&(this._unfinalized_objects[this._cur_obj.name]=this._cur_obj,this._cur_obj_end=Number.MAX_VALUE,this._cur_obj=null),this._byteData.getBytesAvailable()>0){var e,t,i;switch(e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedInt(),i=this._byteData.position+(t-6),e){case 19789:case 15677:case 45056:continue;case 45055:this._cur_mat_end=i,this._cur_mat=this.parseMaterial();break;case 16384:this._cur_obj_end=i,this._cur_obj=new x,this._cur_obj.name=this.readNulTermstring(),this._cur_obj.materials=new Array,this._cur_obj.materialFaces={};break;case 16640:this._cur_obj.type=s.MESH;break;case 16656:this.parseVertexList();break;case 16672:this.parseFaceList();break;case 16704:this.parseUVList();break;case 16688:this.parseFaceMaterialList();break;case 16736:this._cur_obj.transform=this.readTransform();break;case 45058:this.parseObjectAnimation(i);break;case 16720:this.parseSmoothingGroups();break;default:this._byteData.position+=t-6}if(this.dependencies.length){this._pPauseAndRetrieveDependencies();break}}if(this._byteData.getBytesAvailable()||this._cur_obj||this._cur_mat)return h.MORE_TO_PARSE;var r;for(r in this._unfinalized_objects){var a;a=this.constructObject(this._unfinalized_objects[r]),a&&(this._pContent.addChild(a),this._pFinalizeAsset(a,r))}return h.PARSING_DONE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new p},t.prototype.parseMaterial=function(){var e;for(e=new b;this._byteData.position<this._cur_mat_end;){var t,i,r;switch(t=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedInt(),r=this._byteData.position+(i-6),t){case 40960:e.name=this.readNulTermstring();break;case 40976:e.ambientColor=this.readColor();break;case 40992:e.diffuseColor=this.readColor();break;case 41008:e.specularColor=this.readColor();break;case 41089:e.twoSided=!0;break;case 41472:e.colorMap=this.parseTexture(r);break;case 41476:e.specularMap=this.parseTexture(r);break;default:this._byteData.position=r}}return e},t.prototype.parseTexture=function(e){var t;for(t=new v;this._byteData.position<e;){var i,r;switch(i=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedInt(),i){case 41728:t.url=this.readNulTermstring();break;default:this._byteData.position+=r-6}}return this._textures[t.url]=t,this._pAddDependency(t.url,new o(t.url)),t},t.prototype.parseVertexList=function(){var e,t,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.verts=new Array(3*i),e=0,t=this._cur_obj.verts.length;t>e;){var r,a,s;r=this._byteData.readFloat(),a=this._byteData.readFloat(),s=this._byteData.readFloat(),this._cur_obj.verts[e++]=r,this._cur_obj.verts[e++]=s,this._cur_obj.verts[e++]=a}},t.prototype.parseFaceList=function(){var e,t,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.indices=new Array(3*i),e=0,t=this._cur_obj.indices.length;t>e;){var r,a,s;r=this._byteData.readUnsignedShort(),a=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedShort(),this._cur_obj.indices[e++]=r,this._cur_obj.indices[e++]=s,this._cur_obj.indices[e++]=a,this._byteData.position+=2}this._cur_obj.smoothingGroups=new Array(i)},t.prototype.parseSmoothingGroups=function(){for(var e=this._cur_obj.indices.length/3,t=0;e>t;)this._cur_obj.smoothingGroups[t]=this._byteData.readUnsignedInt(),t++},t.prototype.parseUVList=function(){var e,t,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.uvs=new Array(2*i),e=0,t=this._cur_obj.uvs.length;t>e;)this._cur_obj.uvs[e++]=this._byteData.readFloat(),this._cur_obj.uvs[e++]=1-this._byteData.readFloat()},t.prototype.parseFaceMaterialList=function(){var e,t,i,r;for(e=this.readNulTermstring(),t=this._byteData.readUnsignedShort(),r=new Array(t),i=0;i<r.length;)r[i++]=this._byteData.readUnsignedShort();this._cur_obj.materials.push(e),this._cur_obj.materialFaces[e]=r},t.prototype.parseObjectAnimation=function(e){var t,i,r,s,n;for(r=new a;this._byteData.position<e;){var o,h;switch(o=this._byteData.readUnsignedShort(),h=this._byteData.readUnsignedInt(),o){case 45072:s=this.readNulTermstring(),this._byteData.position+=4,n=this._byteData.readShort();break;case 45075:r.x=this._byteData.readFloat(),r.z=this._byteData.readFloat(),r.y=this._byteData.readFloat();break;default:this._byteData.position+=h-6}}"$$$DUMMY"!=s&&this._unfinalized_objects.hasOwnProperty(s)&&(t=this._unfinalized_objects[s],i=this.constructObject(t,r),i&&(this._pContent.addChild(i),this._pFinalizeAsset(i,t.name)),delete this._unfinalized_objects[s])
},t.prototype.constructObject=function(e,t){if(void 0===t&&(t=null),e.type==s.MESH){var i,a,n,o,h,l,p,g;if(e.materials.length>1&&console.log("The Away3D 3DS parser does not support multiple materials per mesh at this point."),!e.indices||0==e.indices.length)return null;for(p=new Array(e.verts.length/3),g=new Array(e.indices.length/3),this.prepareData(p,g,e),this._useSmoothingGroups&&this.applySmoothGroups(p,g),e.verts=new Array(3*p.length),i=0;i<p.length;i++)e.verts[3*i]=p[i].x,e.verts[3*i+1]=p[i].y,e.verts[3*i+2]=p[i].z;for(e.indices=new Array(3*g.length),i=0;i<g.length;i++)e.indices[3*i]=g[i].a,e.indices[3*i+1]=g[i].b,e.indices[3*i+2]=g[i].c;if(e.uvs)for(e.uvs=new Array(2*p.length),i=0;i<p.length;i++)e.uvs[2*i]=p[i].u,e.uvs[2*i+1]=p[i].v;if(n=new d,a=new c(!0),a.updateIndices(e.indices),a.updatePositions(e.verts),a.updateUVs(e.uvs),n.addSubGeometry(a),e.materials.length>0){var _;_=e.materials[0],o=this._materials[_].material}if(t){if(e.transform){var m=e.transform.concat();m[12]=0,m[13]=0,m[14]=0,l=new r(m),t=l.transformVector(t)}t.scaleBy(-1),l=new r,l.appendTranslation(t.x,t.y,t.z),n.applyTransformation(l)}return e.transform&&(l=new r(e.transform),l.invert(),n.applyTransformation(l)),this._pFinalizeAsset(n,e.name.concat("_geom")),h=new u(n,o),h.transform.matrix3D=new r(e.transform),h}return null},t.prototype.prepareData=function(e,t,i){var r,a,s,n=i.verts.length;for(r=0,a=0,s=0;n>r;){var o=new w;o.x=i.verts[r++],o.y=i.verts[r++],o.z=i.verts[r++],i.uvs&&(o.u=i.uvs[a++],o.v=i.uvs[a++]),e[s++]=o}for(n=i.indices.length,r=0,s=0;n>r;){var h=new f;h.a=i.indices[r++],h.b=i.indices[r++],h.c=i.indices[r++],h.smoothGroup=i.smoothingGroups[s]||0,t[s++]=h}},t.prototype.applySmoothGroups=function(e,t){var i,r,a,s,n,o=e.length,h=t.length,l=new Array(o);for(i=0;o>i;i++)l[i]=new Array;for(i=0;h>i;i++){var p=t[i];for(r=0;3>r;r++){var d=l[0==r?p.a:1==r?p.b:p.c],c=p.smoothGroup;for(a=d.length-1;a>=0;a--)(c&d[a])>0&&(c|=d[a],d.splice(a,1),a=d.length-1);d.push(c)}}var u=new Array(o);for(i=0;o>i;i++)if(!((n=l[i].length)<1)){var g=new Array(n);u[i]=g,g[0]=i;var _=e[i];for(r=1;n>r;r++){var m=new w;m.x=_.x,m.y=_.y,m.z=_.z,m.u=_.u,m.v=_.v,g[r]=e.length,e.push(m)}}for(o=e.length,i=0;h>i;i++)for(p=t[i],c=p.smoothGroup,r=0;3>r;r++)for(a=0==r?p.a:1==r?p.b:p.c,d=l[a],n=d.length,g=u[a],s=0;n>s;s++)if(0==c&&0==d[s]||(c&d[s])>0){var y=g[s];0==c&&(d.splice(s,1),g.splice(s,1)),0==r?p.a=y:1==r?p.b=y:p.c=y,s=n}},t.prototype.finalizeCurrentMaterial=function(){var e;e=new _(this._cur_mat.colorMap?this._cur_mat.colorMap.texture||g.getDefaultTexture():this._cur_mat.ambientColor),e.diffuseColor=this._cur_mat.diffuseColor,e.specularColor=this._cur_mat.specularColor,this.materialMode>=2&&(e.materialMode=m.MULTI_PASS),e.bothSides=this._cur_mat.twoSided,this._pFinalizeAsset(e,this._cur_mat.name),this._materials[this._cur_mat.name]=this._cur_mat,this._cur_mat.material=e,this._cur_mat=null},t.prototype.readNulTermstring=function(){for(var e,t="";(e=this._byteData.readUnsignedByte())>0;)t+=String.fromCharCode(e);return t},t.prototype.readTransform=function(){var e;return e=new Array(16),e[0]=this._byteData.readFloat(),e[2]=this._byteData.readFloat(),e[1]=this._byteData.readFloat(),e[3]=0,e[8]=this._byteData.readFloat(),e[10]=this._byteData.readFloat(),e[9]=this._byteData.readFloat(),e[11]=0,e[4]=this._byteData.readFloat(),e[6]=this._byteData.readFloat(),e[5]=this._byteData.readFloat(),e[7]=0,e[12]=this._byteData.readFloat(),e[14]=this._byteData.readFloat(),e[13]=this._byteData.readFloat(),e[15]=1,e},t.prototype.readColor=function(){var e,t,i,r,a;switch(e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedInt(),e){case 16:i=255*this._byteData.readFloat(),r=255*this._byteData.readFloat(),a=255*this._byteData.readFloat();break;case 17:i=this._byteData.readUnsignedByte(),r=this._byteData.readUnsignedByte(),a=this._byteData.readUnsignedByte();break;default:this._byteData.position+=t-6}return i<<16|r<<8|a},t}(h),f=function(){function e(){}return e}(),b=function(){function e(){}return e}(),x=function(){function e(){}return e}(),v=function(){function e(){}return e}(),w=function(){function e(){}return e}();t.exports=y},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialMode":void 0,"awayjs-renderergl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-renderergl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/OBJParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/net/URLLoaderDataFormat"),s=e("awayjs-core/lib/net/URLRequest"),n=e("awayjs-core/lib/parsers/ParserBase"),o=e("awayjs-core/lib/parsers/ParserUtils"),h=e("awayjs-display/lib/containers/DisplayObjectContainer"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),p=e("awayjs-display/lib/base/Geometry"),d=e("awayjs-display/lib/entities/Mesh"),c=e("awayjs-renderergl/lib/materials/TriangleMethodMaterial"),u=e("awayjs-renderergl/lib/materials/TriangleMaterialMode"),g=e("awayjs-renderergl/lib/materials/methods/SpecularBasicMethod"),_=e("awayjs-renderergl/lib/materials/utils/DefaultMaterialManager"),m=function(e){function t(t){void 0===t&&(t=1),e.call(this,a.TEXT),this._mtlLibLoaded=!0,this._activeMaterialID="",this._scale=t}return i(t,e),Object.defineProperty(t.prototype,"scale",{set:function(e){this._scale=e},enumerable:!0,configurable:!0}),t.supportsType=function(e){return e=e.toLowerCase(),"obj"==e},t.supportsData=function(e){var t=o.toString(e),i=!1,r=!1;return t&&(i=-1!=t.indexOf("\nv "),r=-1!=t.indexOf("\nf ")),i&&r},t.prototype._iResolveDependency=function(e){if("mtl"==e.id){var t=o.toString(e.data);this.parseMtl(t)}else{var i;if(1!=e.assets.length)return;if(i=e.assets[0],i.assetType==r.TEXTURE){var a=new v;a.materialID=e.id,a.texture=i,this._materialLoaded.push(a),this._meshes.length>0&&this.applyMaterial(a)}}},t.prototype._iResolveDependencyFailure=function(e){if("mtl"==e.id)this._mtlLib=!1,this._mtlLibLoaded=!1;else{var t=new v;t.materialID=e.id,this._materialLoaded.push(t)}this._meshes.length>0&&this.applyMaterial(t)},t.prototype._pProceedParsing=function(){var e,t,i=String.fromCharCode(10);for(this._startedParsing||(this._textData=this._pGetTextData(),this._textData=this._textData.replace(/\\[\r\n]+\s*/gm," ")),-1==this._textData.indexOf(i)&&(i=String.fromCharCode(13)),this._startedParsing||(this._startedParsing=!0,this._vertices=new Array,this._vertexNormals=new Array,this._materialIDs=new Array,this._materialLoaded=new Array,this._meshes=new Array,this._uvs=new Array,this._stringLength=this._textData.length,this._charIndex=this._textData.indexOf(i,0),this._oldIndex=0,this._objects=new Array,this._objectIndex=0);this._charIndex<this._stringLength&&this._pHasTime();)if(this._charIndex=this._textData.indexOf(i,this._oldIndex),-1==this._charIndex&&(this._charIndex=this._stringLength),e=this._textData.substring(this._oldIndex,this._charIndex),e=e.split("\r").join(""),e=e.replace("  "," "),t=e.split(" "),this._oldIndex=this._charIndex+1,this.parseLine(t),this.parsingPaused)return n.MORE_TO_PARSE;return this._charIndex>=this._stringLength?this._mtlLib&&!this._mtlLibLoaded?n.MORE_TO_PARSE:(this.translate(),this.applyMaterials(),n.PARSING_DONE):n.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new h},t.prototype.parseLine=function(e){switch(e[0]){case"mtllib":this._mtlLib=!0,this._mtlLibLoaded=!1,this.loadMtl(e[1]);break;case"g":this.createGroup(e);break;case"o":this.createObject(e);break;case"usemtl":this._mtlLib&&(e[1]||(e[1]="def000"),this._materialIDs.push(e[1]),this._activeMaterialID=e[1],this._currentGroup&&(this._currentGroup.materialID=this._activeMaterialID));break;case"v":this.parseVertex(e);break;case"vt":this.parseUV(e);break;case"vn":this.parseVertexNormal(e);break;case"f":this.parseFace(e)}},t.prototype.translate=function(){for(var e=0;e<this._objects.length;++e)for(var t,i,r,a,s,n,o,h=this._objects[e].groups,l=h.length,g=0;l>g;++g){for(r=new p,t=h[g].materialGroups,i=t.length,s=0;i>s;++s)this.translateMaterialGroup(t[s],r);if(0!=r.subGeometries.length){if(this._pFinalizeAsset(r),o=new c(_.getDefaultTexture()),this.materialMode>=2&&(o.materialMode=u.MULTI_PASS),a=new d(r,o),a.name=this._objects[e].name?this._objects[e].name:h[g].name?h[g].name:"",this._meshes.push(a),o.name=""!=h[g].materialID?h[g].materialID+"~"+a.name:this._lastMtlID+"~"+a.name,a.subMeshes.length>1)for(n=1;n<a.subMeshes.length;++n)a.subMeshes[n].material=o;this._pContent.addChild(a),this._pFinalizeAsset(a)}}},t.prototype.translateMaterialGroup=function(e,t){var i,r,a,s=e.faces,n=s.length,o=new Array,h=new Array,p=new Array,d=new Array;this._realIndices=[],this._vertexIndex=0;for(var c,u=0;n>u;++u)for(i=s[u],r=i.indexIds.length-1,c=1;r>c;++c)this.translateVertexData(i,c,o,h,d,p),this.translateVertexData(i,0,o,h,d,p),this.translateVertexData(i,c+1,o,h,d,p);o.length>0&&(a=new l(!0),a.autoDeriveNormals=p.length?!1:!0,a.updateIndices(d),a.updatePositions(o),a.updateVertexNormals(p),a.updateUVs(h),t.addSubGeometry(a))},t.prototype.translateVertexData=function(e,t,i,r,a,s){var n,o,h,l;if(this._realIndices[e.indexIds[t]])n=this._realIndices[e.indexIds[t]]-1;else if(n=this._vertexIndex,this._realIndices[e.indexIds[t]]=++this._vertexIndex,o=this._vertices[e.vertexIndices[t]-1],i.push(o.x*this._scale,o.y*this._scale,o.z*this._scale),e.normalIndices.length>0&&(h=this._vertexNormals[e.normalIndices[t]-1],s.push(h.x,h.y,h.z)),e.uvIndices.length>0)try{l=this._uvs[e.uvIndices[t]-1],r.push(l.u,l.v)}catch(p){switch(t){case 0:r.push(0,1);break;case 1:r.push(.5,0);break;case 2:r.push(1,1)}}a.push(n)},t.prototype.createObject=function(e){this._currentGroup=null,this._currentMaterialGroup=null,this._objects.push(this._currentObject=new y),e&&(this._currentObject.name=e[1])},t.prototype.createGroup=function(e){this._currentObject||this.createObject(null),this._currentGroup=new f,this._currentGroup.materialID=this._activeMaterialID,e&&(this._currentGroup.name=e[1]),this._currentObject.groups.push(this._currentGroup),this.createMaterialGroup(null)},t.prototype.createMaterialGroup=function(e){this._currentMaterialGroup=new b,e&&(this._currentMaterialGroup.url=e[1]),this._currentGroup.materialGroups.push(this._currentMaterialGroup)},t.prototype.parseVertex=function(e){var t,i,r;if(e.length>4){for(var a,s=[],n=1;n<e.length;++n)a=parseFloat(e[n]),isNaN(a)||s.push(a);t=s[0],i=s[1],r=-s[2],this._vertices.push(new T(t,i,r))}else t=parseFloat(e[1]),i=parseFloat(e[2]),r=-parseFloat(e[3]),this._vertices.push(new T(t,i,r))},t.prototype.parseUV=function(e){if(e.length>3){for(var t,i=[],r=1;r<e.length;++r)t=parseFloat(e[r]),isNaN(t)||i.push(t);this._uvs.push(new C(i[0],1-i[1]))}else this._uvs.push(new C(parseFloat(e[1]),1-parseFloat(e[2])))},t.prototype.parseVertexNormal=function(e){if(e.length>4){for(var t,i=[],r=1;r<e.length;++r)t=parseFloat(e[r]),isNaN(t)||i.push(t);this._vertexNormals.push(new T(i[0],i[1],-i[2]))}else this._vertexNormals.push(new T(parseFloat(e[1]),parseFloat(e[2]),-parseFloat(e[3])))},t.prototype.parseFace=function(e){var t=e.length,i=new w;this._currentGroup||this.createGroup(null);for(var r,a=1;t>a;++a)""!=e[a]&&(r=e[a].split("/"),i.vertexIndices.push(this.parseIndex(parseInt(r[0]),this._vertices.length)),r[1]&&String(r[1]).length>0&&i.uvIndices.push(this.parseIndex(parseInt(r[1]),this._uvs.length)),r[2]&&String(r[2]).length>0&&i.normalIndices.push(this.parseIndex(parseInt(r[2]),this._vertexNormals.length)),i.indexIds.push(e[a]));this._currentMaterialGroup.faces.push(i)},t.prototype.parseIndex=function(e,t){return 0>e?e+t+1:e},t.prototype.parseMtl=function(e){for(var t,i,r,a,n,o,h,l,p,d,_,m,y=e.split("newmtl"),f=0;f<y.length;++f){for(t=y[f].split("\r").join("").split("\n"),1==t.length&&(t=y[f].split(String.fromCharCode(13))),h=l=p=16777215,d=0,n=!1,o=!1,_=1,m="",r=0;r<t.length;++r)if(t[r]=t[r].replace(/\s+$/,""),"#"!=t[r].substring(0,1)&&(0==r||""!=t[r]))if(i=t[r].split(" "),(9==String(i[0]).charCodeAt(0)||32==String(i[0]).charCodeAt(0))&&(i[0]=i[0].substring(1,i[0].length)),0==r)this._lastMtlID=i.join(""),this._lastMtlID=""==this._lastMtlID?"def000":this._lastMtlID;else switch(i[0]){case"Ka":i[1]&&!isNaN(Number(i[1]))&&i[2]&&!isNaN(Number(i[2]))&&i[3]&&!isNaN(Number(i[3]))&&(l=255*i[1]<<16|255*i[2]<<8|255*i[3]);break;case"Ks":i[1]&&!isNaN(Number(i[1]))&&i[2]&&!isNaN(Number(i[2]))&&i[3]&&!isNaN(Number(i[3]))&&(p=255*i[1]<<16|255*i[2]<<8|255*i[3],n=!0);break;case"Ns":i[1]&&!isNaN(Number(i[1]))&&(d=.001*Number(i[1])),0==d&&(n=!1);break;case"Kd":i[1]&&!isNaN(Number(i[1]))&&i[2]&&!isNaN(Number(i[2]))&&i[3]&&!isNaN(Number(i[3]))&&(h=255*i[1]<<16|255*i[2]<<8|255*i[3],o=!0);break;case"tr":case"d":i[1]&&!isNaN(Number(i[1]))&&(_=Number(i[1]));break;case"map_Kd":m=this.parseMapKdString(i),m=m.replace(/\\/g,"/")}if(""!=m){if(n){a=new g,a.specularColor=p,a.specular=d;var b=new x;b.alpha=_,b.basicSpecularMethod=a,b.materialID=this._lastMtlID,this._materialSpecularData||(this._materialSpecularData=new Array),this._materialSpecularData.push(b)}this._pAddDependency(this._lastMtlID,new s(m))}else if(o&&!isNaN(l)){var w=new v;w.materialID=this._lastMtlID,0==_&&console.log("Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:"+this._lastMtlID+", mesh(es) using it will be invisible!");var C;if(this.materialMode<2){C=new c(l);var T=C;T.alpha=_,T.diffuseColor=h,T.repeat=!0,n&&(T.specularColor=p,T.specular=d)}else{C=new c(l),C.materialMode=u.MULTI_PASS;var P=C;P.diffuseColor=h,P.repeat=!0,n&&(P.specularColor=p,P.specular=d)}w.cm=C,this._materialLoaded.push(w),this._meshes.length>0&&this.applyMaterial(w)}}this._mtlLibLoaded=!0},t.prototype.parseMapKdString=function(e){var t,i,r="";for(t=1;t<e.length;){switch(e[t]){case"-blendu":case"-blendv":case"-cc":case"-clamp":case"-texres":t+=2;break;case"-mm":t+=3;break;case"-o":case"-s":case"-t":t+=4;continue;default:i=!0}if(i)break}for(t;t<e.length;t++)r+=e[t],r+=" ";return r=r.replace(/\s+$/,"")},t.prototype.loadMtl=function(e){this._pAddDependency("mtl",new s(e),!0),this._pPauseAndRetrieveDependencies()},t.prototype.applyMaterial=function(e){for(var t,i,r,a,s,n=0;n<this._meshes.length;++n)if(i=this._meshes[n],t=i.material.name.split("~"),t[0]==e.materialID){if(e.cm)i.material&&(i.material=null),i.material=e.cm;else if(e.texture)if(this.materialMode<2){if(r=i.material,r.texture=e.texture,r.color=e.color,r.alpha=e.alpha,r.repeat=!0,e.specularMethod)r.specularMethod=null,r.specularMethod=e.specularMethod;else if(this._materialSpecularData)for(a=0;a<this._materialSpecularData.length;++a)if(s=this._materialSpecularData[a],s.materialID==e.materialID){r.specularMethod=null,r.specularMethod=s.basicSpecularMethod,r.color=s.color,r.alpha=s.alpha;break}}else if(r=i.material,r.materialMode=u.MULTI_PASS,r.texture=e.texture,r.color=e.color,r.repeat=!0,e.specularMethod)r.specularMethod=null,r.specularMethod=e.specularMethod;else if(this._materialSpecularData)for(a=0;a<this._materialSpecularData.length;++a)if(s=this._materialSpecularData[a],s.materialID==e.materialID){r.specularMethod=null,r.specularMethod=s.basicSpecularMethod,r.color=s.color;break}i.material.name=t[1]?t[1]:t[0],this._meshes.splice(n,1),--n}(e.cm||r)&&this._pFinalizeAsset(e.cm||r)},t.prototype.applyMaterials=function(){if(0!=this._materialLoaded.length)for(var e=0;e<this._materialLoaded.length;++e)this.applyMaterial(this._materialLoaded[e])},t}(n),y=function(){function e(){this.groups=new Array}return e}(),f=function(){function e(){this.materialGroups=new Array}return e}(),b=function(){function e(){this.faces=new Array}return e}(),x=function(){function e(){this.color=16777215,this.alpha=1}return e}(),v=function(){function e(){this.color=16777215,this.alpha=1}return e}(),w=function(){function e(){this.vertexIndices=new Array,this.uvIndices=new Array,this.normalIndices=new Array,this.indexIds=new Array}return e}(),C=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._u=e,this._v=t}return Object.defineProperty(e.prototype,"v",{get:function(){return this._v},set:function(e){this._v=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"u",{get:function(){return this._u},set:function(e){this._u=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._u,this._v)},e.prototype.toString=function(){return this._u+","+this._v},e}(),T=function(){function e(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),this._x=e,this._y=t,this._z=i,this._index=r}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._x,this._y,this._z)},e}();t.exports=m},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/materials/TriangleMaterialMode":void 0,"awayjs-renderergl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-renderergl/lib/materials/methods/SpecularBasicMethod":void 0,"awayjs-renderergl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/Parsers":[function(e,t){var i=e("awayjs-core/lib/library/AssetLoader"),r=e("awayjs-renderergl/lib/parsers/AWDParser"),a=e("awayjs-renderergl/lib/parsers/Max3DSParser"),s=e("awayjs-renderergl/lib/parsers/MD2Parser"),n=e("awayjs-renderergl/lib/parsers/OBJParser"),o=function(){function e(){}return e.enableAllBundled=function(){i.enableParsers(e.ALL_BUNDLED)},e.ALL_BUNDLED=Array(r,a,s,n),e}();t.exports=o},{"awayjs-core/lib/library/AssetLoader":void 0,"awayjs-renderergl/lib/parsers/AWDParser":void 0,"awayjs-renderergl/lib/parsers/MD2Parser":void 0,"awayjs-renderergl/lib/parsers/Max3DSParser":void 0,"awayjs-renderergl/lib/parsers/OBJParser":void 0}],"awayjs-renderergl/lib/parsers/data/AWDBlock":[function(e,t){var i=function(){function e(){}return e.prototype.dispose=function(){this.id=null,this.bytes=null,this.errorMessages=null,this.uvsForVertexAnimation=null},e.prototype.addError=function(e){this.errorMessages||(this.errorMessages=new Array),this.errorMessages.push(e)},e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/AWDProperties":[function(e,t){var i=function(){function e(){}return e.prototype.set=function(e,t){this[e.toString()]=t},e.prototype.get=function(e,t){return this.hasOwnProperty(e.toString())?this[e.toString()]:t},e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/BaseFrameData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/BitFlags":[function(e,t){var i=function(){function e(){}return e.test=function(e,t){return(e&t)==t},e.FLAG1=1,e.FLAG2=2,e.FLAG3=4,e.FLAG4=8,e.FLAG5=16,e.FLAG6=32,e.FLAG7=64,e.FLAG8=128,e.FLAG9=256,e.FLAG10=512,e.FLAG11=1024,e.FLAG12=2048,e.FLAG13=4096,e.FLAG14=8192,e.FLAG15=16384,e.FLAG16=32768,e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/BoundsData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/FaceVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/FrameData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/HierarchyData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/MaterialVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/ObjectVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/TextureVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/VertexVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/pick/JSPickingCollider":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-renderergl/lib/pick/PickingColliderBase"),n=function(e){function t(t){void 0===t&&(t=!1),e.call(this),this._findClosestCollision=t}return i(t,e),t.prototype._pTestRenderableCollision=function(e,t,i){for(var s,n,o,h,l,p,d,c,u,g,_,m,y,f,b,x,v,w,C,T,P,D,S,M,O,A,j,R,I,F,N,V,L,E,B,U,z,k,G,H,X,W=e.getIndexData().data,Y=-1,J=e.materialOwner.material.bothSides,q=e.getVertexData(a.POSITION_DATA).data,K=e.getVertexData(a.POSITION_DATA).dataPerVertex,Z=e.getVertexOffset(a.POSITION_DATA),Q=e.getVertexData(a.UV_DATA).data,$=e.getVertexData(a.UV_DATA).dataPerVertex,et=e.getVertexOffset(a.UV_DATA),tt=W.length,it=0;tt>it;it+=3)if(n=Z+W[it]*K,o=Z+W[it+1]*K,h=Z+W[it+2]*K,w=q[n],C=q[n+1],T=q[n+2],P=q[o],D=q[o+1],S=q[o+2],M=q[h],O=q[h+1],A=q[h+2],j=P-w,R=D-C,I=S-T,F=M-w,N=O-C,V=A-T,c=R*V-I*N,u=I*F-j*V,g=j*N-R*F,L=1/Math.sqrt(c*c+u*u+g*g),c*=L,u*=L,g*=L,E=c*this.rayDirection.x+u*+this.rayDirection.y+g*this.rayDirection.z,!J&&0>E||J&&0!=E){if(B=-(c*w+u*C+g*T),U=-(c*this.rayPosition.x+u*this.rayPosition.y+g*this.rayPosition.z+B),s=U/E,_=this.rayPosition.x+s*this.rayDirection.x,m=this.rayPosition.y+s*this.rayDirection.y,y=this.rayPosition.z+s*this.rayDirection.z,z=j*F+R*N+I*V,k=j*j+R*R+I*I,G=F*F+N*N+V*V,l=_-w,p=m-C,d=y-T,H=l*j+p*R+d*I,X=l*F+p*N+d*V,f=1/(k*G-z*z),x=f*(G*H-z*X),v=f*(-z*H+k*X),0>x)continue;if(0>v)continue;if(b=1-x-v,!(0>b)&&s>0&&i>s&&(i=s,Y=it/3,t.rayEntryDistance=s,t.localPosition=new r(_,m,y),t.localNormal=new r(c,u,g),t.uv=this._pGetCollisionUV(W,Q,it,x,v,b,et,$),t.index=it,!this._findClosestCollision))return!0}return Y>=0?!0:!1},t}(s);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pick/PickingColliderBase":void 0}],"awayjs-renderergl/lib/pick/PickingColliderBase":[function(e,t){var i=e("awayjs-core/lib/geom/Point"),r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-core/lib/errors/AbstractMethodError"),s=e("awayjs-display/lib/pool/RenderablePool"),n=e("awayjs-renderergl/lib/pool/BillboardRenderable"),o=e("awayjs-renderergl/lib/pool/TriangleSubMeshRenderable"),h=function(){function e(){this._billboardRenderablePool=s.getPool(n),this._subMeshRenderablePool=s.getPool(o)}return e.prototype._pPetCollisionNormal=function(e,t,i){var a=new r,s=3*e[i],n=3*e[i+1],o=3*e[i+2],h=new r(t[s],t[s+1],t[s+2]),l=new r(t[n],t[n+1],t[n+2]),p=new r(t[o],t[o+1],t[o+2]),d=l.subtract(h),c=p.subtract(h);return a=d.crossProduct(c),a.normalize(),a},e.prototype._pGetCollisionUV=function(e,t,a,s,n,o,h,l){var p=new i,d=e[a]*l+h,c=new r(t[d],t[d+1]);d=e[a+1]*l+h;var u=new r(t[d],t[d+1]);d=e[a+2]*l+h;var g=new r(t[d],t[d+1]);return p.x=o*c.x+s*u.x+n*g.x,p.y=o*c.y+s*u.y+n*g.y,p},e.prototype._pTestRenderableCollision=function(){throw new a},e.prototype.setLocalRay=function(e,t){this.rayPosition=e,this.rayDirection=t},e.prototype.testBillboardCollision=function(e,t,i){return this.setLocalRay(t.localRayPosition,t.localRayDirection),t.materialOwner=null,this._pTestRenderableCollision(this._billboardRenderablePool.getItem(e),t,i)?(i=t.rayEntryDistance,t.materialOwner=e,!0):!1},e.prototype.testMeshCollision=function(e,t,i,r){this.setLocalRay(t.localRayPosition,t.localRayDirection),t.materialOwner=null;for(var a,s=e.subMeshes.length,n=0;s>n;++n)if(a=e.subMeshes[n],this._pTestRenderableCollision(this._subMeshRenderablePool.getItem(a),t,i)&&(i=t.rayEntryDistance,t.materialOwner=a,!r))return!0;return null!=t.materialOwner},e}();t.exports=h},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-renderergl/lib/pool/BillboardRenderable":void 0,"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":void 0}],"awayjs-renderergl/lib/pick/ShaderPicker":[function(e,t){var i=e("awayjs-core/lib/utils/Debug"),r=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-core/lib/geom/Matrix3DUtils"),s=e("awayjs-core/lib/geom/Point"),n=e("awayjs-core/lib/geom/Rectangle"),o=e("awayjs-core/lib/geom/Vector3D"),h=e("awayjs-display/lib/base/TriangleSubGeometry"),l=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),p=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),d=e("awayjs-stagegl/lib/base/ContextGLClearMask"),c=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),u=e("awayjs-stagegl/lib/base/ContextGLProgramType"),g=e("awayjs-stagegl/lib/base/ContextGLTriangleFace"),_=function(){function e(e){void 0===e&&(e=!1),this._onlyMouseEnabled=!0,this._interactives=new Array,this._localHitPosition=new o,this._hitUV=new s,this._localHitNormal=new o,this._rayPos=new o,this._rayDir=new o,this._shaderPickingDetails=e,this._id=new Array(4),this._viewportData=new Array(4),this._boundOffsetScale=new Array(8),this._boundOffsetScale[3]=0,this._boundOffsetScale[7]=1}return Object.defineProperty(e.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},set:function(e){this._onlyMouseEnabled=e},enumerable:!0,configurable:!0}),e.prototype.getViewCollision=function(e,t,i){var a=i.iEntityCollector;if(this._stage=i.renderer.stage,!this._stage)return null;if(this._context=this._stage.context,this._viewportData[0]=i.width,this._viewportData[1]=i.height,this._viewportData[2]=-(this._projX=2*e/i.width-1),this._viewportData[3]=this._projY=2*t/i.height-1,this._potentialFound=!1,this._blendedRenderableHead=null,this._opaqueRenderableHead=null,this.pDraw(a,null),this._context.setVertexBufferAt(0,null),!this._context||!this._potentialFound)return null;if(this._bitmapData||(this._bitmapData=new r(1,1,!1,0)),this._context.drawToBitmapData(this._bitmapData),this._hitColor=this._bitmapData.getPixel(0,0),!this._hitColor)return this._context.present(),null;if(this._hitRenderable=this._interactives[this._hitColor-1],this._hitEntity=this._hitRenderable.sourceEntity,this._onlyMouseEnabled&&!this._hitEntity._iIsMouseEnabled())return null;var s=this._hitEntity._iPickingCollisionVO;return this._shaderPickingDetails?(this.getHitDetails(i.camera),s.localPosition=this._localHitPosition,s.localNormal=this._localHitNormal,s.uv=this._hitUV,s.index=this._faceIndex):(s.localPosition=null,s.localNormal=null,s.uv=null,s.index=0),s},e.prototype.getSceneCollision=function(){return null},e.prototype.pDraw=function(t){t.camera;this._context.clear(0,0,0,1),this._stage.scissorRect=e.MOUSE_SCISSOR_RECT,this._interactives.length=this._interactiveId=0,this._objectProgram||this.initObjectProgram(),this._context.setBlendFactors(p.ONE,p.ZERO),this._context.setDepthTest(!0,c.LESS),this._context.setProgram(this._objectProgram),this._context.setProgramConstantsFromArray(u.VERTEX,4,this._viewportData,1)},e.prototype.drawRenderables=function(e,t){for(var i=a.CALCULATION_MATRIX,r=t.viewProjection;e;)e.sourceEntity.scene&&e.sourceEntity._iIsMouseEnabled()?(this._potentialFound=!0,this._context.setCulling(e.materialOwner.material.bothSides?g.NONE:g.BACK,t.projection.coordinateSystem),this._interactives[this._interactiveId++]=e,this._id[1]=(this._interactiveId>>8)/255,this._id[2]=(255&this._interactiveId)/255,i.copyFrom(e.sourceEntity.getRenderSceneTransform(t)),i.append(r),this._context.setProgramConstantsFromMatrix(u.VERTEX,0,i,!0),this._context.setProgramConstantsFromArray(u.FRAGMENT,0,this._id,1),this._stage.activateBuffer(0,e.getVertexData(h.POSITION_DATA),e.getVertexOffset(h.POSITION_DATA),h.POSITION_FORMAT),this._context.drawTriangles(this._stage.getIndexBuffer(e.getIndexData()),0,e.numTriangles),e=e.next):e=e.next},e.prototype.updateRay=function(e){this._rayPos=e.scenePosition,this._rayDir=e.getRay(this._projX,this._projY,1),this._rayDir.normalize()},e.prototype.initObjectProgram=function(){var e,t;this._objectProgram=this._context.createProgram(),e="m44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",t="mov oc, fc0",i.throwPIR("ShaderPicker","initTriangleProgram","Dependency: initObjectProgram")},e.prototype.initTriangleProgram=function(){var e,t;this._triangleProgram=this._context.createProgram(),e="add vt0, va0, vc5 			\nmul vt0, vt0, vc6 			\nmov v0, vt0				\nm44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",t="mov oc, v0";var i=(new l).assemble("part vertex 1\n"+e+"endpart").vertex.data,r=(new l).assemble("part fragment 1\n"+t+"endpart").fragment.data;this._triangleProgram.upload(i,r)},e.prototype.getHitDetails=function(e){this.getApproximatePosition(e),this.getPreciseDetails(e)},e.prototype.getApproximatePosition=function(t){var i,r,s,n,o,l,p,c=this._hitRenderable.sourceEntity.bounds.aabb,g=a.CALCULATION_MATRIX;g.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(t)),g.append(t.viewProjection),this._triangleProgram||this.initTriangleProgram(),this._boundOffsetScale[4]=1/(r=c.width),this._boundOffsetScale[5]=1/(s=c.height),this._boundOffsetScale[6]=1/(n=c.depth),this._boundOffsetScale[0]=o=-c.x,this._boundOffsetScale[1]=l=-c.y,this._boundOffsetScale[2]=p=-c.z,this._context.setProgram(this._triangleProgram),this._context.clear(0,0,0,0,1,0,d.DEPTH),this._context.setScissorRectangle(e.MOUSE_SCISSOR_RECT),this._context.setProgramConstantsFromMatrix(u.VERTEX,0,g,!0),this._context.setProgramConstantsFromArray(u.VERTEX,5,this._boundOffsetScale,2),this._stage.activateBuffer(0,this._hitRenderable.getVertexData(h.POSITION_DATA),this._hitRenderable.getVertexOffset(h.POSITION_DATA),h.POSITION_FORMAT),this._context.drawTriangles(this._stage.getIndexBuffer(this._hitRenderable.getIndexData()),0,this._hitRenderable.numTriangles),this._context.drawToBitmapData(this._bitmapData),i=this._bitmapData.getPixel(0,0),this._localHitPosition.x=(i>>16&255)*r/255-o,this._localHitPosition.y=(i>>8&255)*s/255-l,this._localHitPosition.z=(255&i)*n/255-p},e.prototype.getPreciseDetails=function(e){var t,i,r,a,s,n,o,l,p,d,c,u,g,_,m,y,f,b,x,v,w,C,T,P,D,S,M,O,A,j,R,I,F,N,V,L,E,B,U,z,k,G,H,X,W,Y,J,q,K=rt.length,Z=0,Q=1,$=2,et=this._localHitPosition.x,tt=this._localHitPosition.y,it=this._localHitPosition.z,rt=this._hitRenderable.getIndexData().data,at=this._hitRenderable.getVertexData(h.POSITION_DATA).data,st=this._hitRenderable.getVertexData(h.POSITION_DATA).dataPerVertex,nt=this._hitRenderable.getVertexOffset(h.POSITION_DATA),ot=this._hitRenderable.getVertexData(h.UV_DATA).data,ht=this._hitRenderable.getVertexData(h.UV_DATA).dataPerVertex,lt=this._hitRenderable.getVertexOffset(h.UV_DATA),pt=(this._hitRenderable.getVertexData(h.NORMAL_DATA).data,this._hitRenderable.getVertexData(h.NORMAL_DATA).dataPerVertex),dt=this._hitRenderable.getVertexOffset(h.NORMAL_DATA);
for(this.updateRay(e);K>Z;){if(d=nt+rt[Z]*st,c=nt+rt[Q]*st,u=nt+rt[$]*st,t=at[d],i=at[d+1],r=at[d+2],a=at[c],s=at[c+1],n=at[c+2],o=at[u],l=at[u+1],p=at[u+2],!(t>et&&a>et&&o>et||i>tt&&s>tt&&l>tt||r>it&&n>it&&p>it||et>t&&et>a&&et>o||tt>i&&tt>s&&tt>l||it>r&&it>n&&it>p)&&(g=o-t,_=l-i,m=p-r,y=a-t,f=s-i,b=n-r,x=et-t,v=tt-i,w=it-r,A=g*g+_*_+m*m,j=g*y+_*f+m*b,R=g*x+_*v+m*w,I=y*y+f*f+b*b,F=y*x+f*v+b*w,L=1/(A*I-j*j),N=(I*R-j*F)*L,V=(A*F-j*R)*L,N>=0&&V>=0&&1>=N+V))return C=dt+rt[Z]*pt,T=dt+rt[Q]*pt,P=dt+rt[$]*pt,D=rt[C]+rt[T]+rt[P],S=rt[C+1]+rt[T+1]+rt[P+1],M=rt[C+2]+rt[T+2]+rt[P+2],O=Math.sqrt(D*D+S*S+M*M),D/=O,S/=O,M/=O,this.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform,D,S,M,t,i,r),x=this._localHitPosition.x-t,v=this._localHitPosition.y-i,w=this._localHitPosition.z-r,G=a-t,H=s-i,X=n-r,W=o-t,Y=l-i,J=p-r,this._localHitNormal.x=H*J-X*Y,this._localHitNormal.y=X*W-G*J,this._localHitNormal.z=G*Y-H*W,q=1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x+this._localHitNormal.y*this._localHitNormal.y+this._localHitNormal.z*this._localHitNormal.z),this._localHitNormal.x*=q,this._localHitNormal.y*=q,this._localHitNormal.z*=q,R=g*x+_*v+m*w,F=y*x+f*v+b*w,N=(I*R-j*F)*L,V=(A*F-j*R)*L,U=lt+rt[Z]*ht,z=lt+rt[Q]*ht,k=lt+rt[$]*ht,E=ot[U],B=ot[U+1],this._hitUV.x=E+V*(ot[z]-E)+N*(ot[k]-E),this._hitUV.y=B+V*(ot[z+1]-B)+N*(ot[k+1]-B),void(this._faceIndex=Z);Z+=3,Q+=3,$+=3}},e.prototype.getPrecisePosition=function(e,t,i,r,s,n,o){var h,l,p,d,c,u,g,_=a.RAW_DATA_CONTAINER,m=this._rayPos.x,y=this._rayPos.y,f=this._rayPos.z;d=this._rayDir.x,c=this._rayDir.y,u=this._rayDir.z,e.copyRawDataTo(_),h=_[0]*d+_[4]*c+_[8]*u,l=_[1]*d+_[5]*c+_[9]*u,p=_[2]*d+_[6]*c+_[10]*u,d=_[0]*m+_[4]*y+_[8]*f+_[12],c=_[1]*m+_[5]*y+_[9]*f+_[13],u=_[2]*m+_[6]*y+_[10]*f+_[14],g=((s-d)*t+(n-c)*i+(o-u)*r)/(h*t+l*i+p*r),this._localHitPosition.x=d+h*g,this._localHitPosition.y=c+l*g,this._localHitPosition.z=u+p*g},e.prototype.dispose=function(){this._bitmapData.dispose(),this._triangleProgram&&this._triangleProgram.dispose(),this._objectProgram&&this._objectProgram.dispose(),this._triangleProgram=null,this._objectProgram=null,this._bitmapData=null,this._hitRenderable=null,this._hitEntity=null},e.MOUSE_SCISSOR_RECT=new n(0,0,1,1),e}();t.exports=_},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/utils/Debug":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/ContextGLTriangleFace":void 0}],"awayjs-renderergl/lib/pool/BillboardRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-renderergl/lib/pool/RenderableBase"),s=function(e){function t(t,i){e.call(this,t,i,i),this._billboard=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=this._billboard.material,i=t._materialGeometry[e.id];return i?i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0)):(i=t._materialGeometry[e.id]=new r(!0),i.autoDeriveNormals=!1,i.autoDeriveTangents=!1,i.updateIndices(Array(0,1,2,0,2,3)),i.updatePositions(Array(0,e.height,0,e.width,e.height,0,e.width,0,0,0,0,0)),i.updateVertexNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0)),i.updateVertexTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i.updateUVs(Array(0,0,1,0,1,1,0,1))),this._pVertexDataDirty[r.POSITION_DATA]=!0,this._pVertexDataDirty[r.NORMAL_DATA]=!0,this._pVertexDataDirty[r.TANGENT_DATA]=!0,this._pVertexDataDirty[r.UV_DATA]=!0,i},t._materialGeometry=new Object,t.id="billboard",t}(a);t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0}],"awayjs-renderergl/lib/pool/LineSubMeshRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/LineSubGeometry"),a=e("awayjs-renderergl/lib/pool/RenderableBase"),s=function(e){function t(t,i,r,a){void 0===r&&(r=0),void 0===a&&(a=0),e.call(this,t,i.parentMesh,i,r,a),this.subMesh=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=this.subMesh.subGeometry;return this._pVertexDataDirty[r.START_POSITION_DATA]=!0,this._pVertexDataDirty[r.END_POSITION_DATA]=!0,e.thickness&&(this._pVertexDataDirty[r.THICKNESS_DATA]=!0),e.startColors&&(this._pVertexDataDirty[r.COLOR_DATA]=!0),e},t.prototype._pGetOverflowRenderable=function(e,i,r,a){return new t(e,i,r,a)},t.id="linesubmesh",t}(a);t.exports=s},{"awayjs-display/lib/base/LineSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0}],"awayjs-renderergl/lib/pool/MaterialDataPool":[function(e,t){var i=e("awayjs-renderergl/lib/pool/MaterialData"),r=function(){function e(){this._pool=new Object}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=e._iAddMaterialData(new i(this,e)))},e.prototype.disposeItem=function(e){e._iRemoveMaterialData(this._pool[e.id]),this._pool[e.id]=null},e}();t.exports=r},{"awayjs-renderergl/lib/pool/MaterialData":void 0}],"awayjs-renderergl/lib/pool/MaterialData":[function(e,t){var i=e("awayjs-renderergl/lib/pool/MaterialPassDataPool"),r=function(){function e(e,t){this.invalidAnimation=!0,this._pool=e,this.material=t,this._materialPassDataPool=new i(t)}return e.prototype.getMaterialPass=function(e,t){var i=this._materialPassDataPool.getItem(e);if(i.shaderObject||(i.shaderObject=e.createShaderObject(t),i.invalid=!0),i.invalid){i.invalid=!1;var r=i.shaderObject.createCompiler(this.material,e);r.compile(),i.shadedTarget=r.shadedTarget,i.vertexCode=r.vertexCode,i.fragmentCode=r.fragmentCode,i.postAnimationFragmentCode=r.postAnimationFragmentCode,i.key=""}return i},e.prototype.getMaterialPasses=function(e){if(null==this._passes){var t=this.material._iScreenPasses,i=t.length;this._passes=new Array(i);for(var r=0;i>r;r++)this._passes[r]=this.getMaterialPass(t[r],e)}return this._passes},e.prototype.dispose=function(){this._materialPassDataPool.disposePool(),this._materialPassDataPool=null,this._pool.disposeItem(this.material),this._passes=null},e.prototype.invalidateMaterial=function(){this._passes=null,this.invalidateAnimation()},e.prototype.invalidateAnimation=function(){this.invalidAnimation=!0},e}();t.exports=r},{"awayjs-renderergl/lib/pool/MaterialPassDataPool":void 0}],"awayjs-renderergl/lib/pool/MaterialPassDataPool":[function(e,t){var i=e("awayjs-renderergl/lib/pool/MaterialPassData"),r=function(){function e(e){this._pool=new Object,this._material=e}return e.prototype.getItem=function(e){return this._pool[e.id]||(this._pool[e.id]=this._material._iAddMaterialPassData(e._iAddMaterialPassData(new i(this,this._material,e))))},e.prototype.disposeItem=function(e){e._iRemoveMaterialPassData(this._pool[e.id]),delete this._pool[e.id]},e.prototype.disposePool=function(){for(var e in this._pool)this._pool[e].materialPass._iRemoveMaterialPassData(this._pool[e]);delete this._pool},e}();t.exports=r},{"awayjs-renderergl/lib/pool/MaterialPassData":void 0}],"awayjs-renderergl/lib/pool/MaterialPassData":[function(e,t){var i=function(){function e(e,t,i){this.animationVertexCode="",this.animationFragmentCode="",this._pool=e,this.material=t,this.materialPass=i}return e.prototype.dispose=function(){this._pool.disposeItem(this.materialPass),this.shaderObject.dispose(),this.shaderObject=null,this.programData.dispose(),this.programData=null},e.prototype.invalidate=function(){this.invalid=!0},e}();t.exports=i},{}],"awayjs-renderergl/lib/pool/RenderableBase":[function(e,t){var i=e("awayjs-core/lib/errors/AbstractMethodError"),r=e("awayjs-display/lib/base/SubGeometryBase"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-display/lib/events/SubGeometryEvent"),n=e("awayjs-stagegl/lib/pool/IndexDataPool"),o=e("awayjs-stagegl/lib/pool/VertexDataPool"),h=function(){function e(e,t,i,r,a){var s=this;void 0===r&&(r=0),void 0===a&&(a=0),this._geometryDirty=!0,this._indexDataDirty=!0,this._vertexData=new Object,this._pVertexDataDirty=new Object,this._vertexOffset=new Object,this._onIndicesUpdatedDelegate=function(e){return s._onIndicesUpdated(e)},this._onVerticesUpdatedDelegate=function(e){return s._onVerticesUpdated(e)},this._pool=e,this._level=r,this._indexOffset=a,this.sourceEntity=t,this.materialOwner=i}return Object.defineProperty(e.prototype,"overflow",{get:function(){return this._indexDataDirty&&this._updateIndexData(),this._overflow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTriangles",{get:function(){return this._numTriangles},enumerable:!0,configurable:!0}),e.prototype.getIndexData=function(){return this._indexDataDirty&&this._updateIndexData(),this._indexData},e.prototype.getVertexData=function(e){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[e]&&this._updateVertexData(e),this._vertexData[this._concatenateArrays?a.VERTEX_DATA:e]},e.prototype.getVertexOffset=function(e){return this._indexDataDirty&&this._updateIndexData(),this._pVertexDataDirty[e]&&this._updateVertexData(e),this._vertexOffset[e]},e.prototype.dispose=function(){this._pool.disposeItem(this.materialOwner),this._indexData.dispose(),this._indexData=null;for(var e in this._vertexData)this._vertexData[e].dispose(),this._vertexData[e]=null;this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype.invalidateGeometry=function(){this._geometryDirty=!0,0==this._level&&(this._indexDataDirty=!0),this._overflow&&this._overflow.invalidateGeometry()},e.prototype.invalidateIndexData=function(){this._indexDataDirty=!0},e.prototype.invalidateVertexData=function(e){this._pVertexDataDirty[e]=!0},e.prototype._pGetSubGeometry=function(){throw new i},e.prototype._iFillIndexData=function(e){this._geometryDirty&&this._updateGeometry(),this._indexData=n.getItem(this._subGeometry,this._level,e),this._numTriangles=this._indexData.data.length/3,e=this._indexData.offset,e<this._subGeometry.indices.length?(this._overflow||(this._overflow=this._pGetOverflowRenderable(this._pool,this.materialOwner,e,this._level+1)),this._overflow._iFillIndexData(e)):this._overflow&&(this._overflow.dispose(),this._overflow=null)},e.prototype._pGetOverflowRenderable=function(){throw new i},e.prototype._updateGeometry=function(){this._subGeometry&&(0==this._level&&this._subGeometry.removeEventListener(s.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.removeEventListener(s.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._subGeometry=this._pGetSubGeometry(),this._concatenateArrays=this._subGeometry.concatenateArrays,this._subGeometry&&(0==this._level&&this._subGeometry.addEventListener(s.INDICES_UPDATED,this._onIndicesUpdatedDelegate),this._subGeometry.addEventListener(s.VERTICES_UPDATED,this._onVerticesUpdatedDelegate)),this._geometryDirty=!1},e.prototype._updateIndexData=function(){this._iFillIndexData(this._indexOffset),this._indexDataDirty=!1},e.prototype._updateVertexData=function(e){this._vertexOffset[e]=this._subGeometry.getOffset(e),this._subGeometry.concatenateArrays&&(e=r.VERTEX_DATA),this._vertexData[e]=o.getItem(this._subGeometry,this.getIndexData(),e),this._pVertexDataDirty[e]=!1},e.prototype._onIndicesUpdated=function(){this.invalidateIndexData()},e.prototype._onVerticesUpdated=function(e){this._concatenateArrays=e.target.concatenateArrays,this.invalidateVertexData(e.dataType)},e}();t.exports=h},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-display/lib/base/SubGeometryBase":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/events/SubGeometryEvent":void 0,"awayjs-stagegl/lib/pool/IndexDataPool":void 0,"awayjs-stagegl/lib/pool/VertexDataPool":void 0}],"awayjs-renderergl/lib/pool/SkyboxRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-renderergl/lib/pool/RenderableBase"),s=function(e){function t(t,i){e.call(this,t,i,i)}return i(t,e),t.prototype._pGetSubGeometry=function(){var e=t._geometry;return e||(e=t._geometry=new r(!0),e.autoDeriveNormals=!1,e.autoDeriveTangents=!1,e.updateIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2)),e.updatePositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1))),this._pVertexDataDirty[r.POSITION_DATA]=!0,e},t.id="skybox",t}(a);t.exports=s},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0}],"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/pool/RenderableBase"),n=function(e){function t(t,i,r,a){void 0===r&&(r=0),void 0===a&&(a=0),e.call(this,t,i.parentMesh,i,r,a),this.subMesh=i}return i(t,e),t.prototype._pGetSubGeometry=function(){var e;switch(e=this.subMesh.animator?this.subMesh.animator.getRenderableSubGeometry(this,this.subMesh.subGeometry):this.subMesh.subGeometry,this._pVertexDataDirty[r.POSITION_DATA]=!0,e.vertexNormals&&(this._pVertexDataDirty[r.NORMAL_DATA]=!0),e.vertexTangents&&(this._pVertexDataDirty[r.TANGENT_DATA]=!0),e.uvs&&(this._pVertexDataDirty[r.UV_DATA]=!0),e.secondaryUVs&&(this._pVertexDataDirty[r.SECONDARY_UV_DATA]=!0),e.jointIndices&&(this._pVertexDataDirty[r.JOINT_INDEX_DATA]=!0),e.jointWeights&&(this._pVertexDataDirty[r.JOINT_WEIGHT_DATA]=!0),e.jointsPerVertex){case 1:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_1;break;case 2:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_2;break;case 3:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_3;break;case 4:this.JOINT_INDEX_FORMAT=this.JOINT_WEIGHT_FORMAT=a.FLOAT_4}return e},t.prototype._pGetOverflowRenderable=function(e,i,r,a){return new t(e,i,r,a)},t.id="trianglesubmesh",t}(s);t.exports=n},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pool/RenderableBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/render/DefaultRenderer":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/textures/RenderTexture"),n=e("awayjs-display/lib/pool/RenderablePool"),o=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),h=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),l=e("awayjs-stagegl/lib/base/ContextGLClearMask"),p=e("awayjs-stagegl/lib/managers/StageManager"),d=e("awayjs-renderergl/lib/pool/SkyboxRenderable"),c=e("awayjs-renderergl/lib/render/DepthRenderer"),u=e("awayjs-renderergl/lib/render/Filter3DRenderer"),g=e("awayjs-renderergl/lib/render/RendererBase"),_=e("awayjs-renderergl/lib/managers/RTTBufferManager"),m=e("awayjs-renderergl/lib/materials/passes/DepthMapPass"),y=e("awayjs-renderergl/lib/materials/passes/DistanceMapPass"),f=function(e){function t(t,i,a){void 0===t&&(t=!1),void 0===i&&(i="baseline"),void 0===a&&(a="auto"),e.call(this),this._skyboxProjection=new r,this._skyboxRenderablePool=n.getPool(d),this._pDepthRenderer=new c(new m),this._pDistanceRenderer=new c(new y),null==this._pStage&&(this.stage=p.getInstance().getFreeStage(t,i,a)),this._pRttBufferManager=_.getInstance(this._pStage),0==this._width?this.width=window.innerWidth:this._pRttBufferManager.viewWidth=this._width,0==this._height?this.height=window.innerHeight:this._pRttBufferManager.viewHeight=this._height}return i(t,e),Object.defineProperty(t.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(e){this._antiAlias!=e&&(this._antiAlias=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(e){this._depthPrepass=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filters3d",{get:function(){return this._pFilter3DRenderer?this._pFilter3DRenderer.filters:null},set:function(e){e&&0==e.length&&(e=null),this._pFilter3DRenderer&&!e?(this._pFilter3DRenderer.dispose(),this._pFilter3DRenderer=null):!this._pFilter3DRenderer&&e&&(this._pFilter3DRenderer=new u(this._pStage),this._pFilter3DRenderer.filters=e),this._pFilter3DRenderer?(this._pFilter3DRenderer.filters=e,this._pRequireDepthRender=this._pFilter3DRenderer.requireDepthRender):(this._pRequireDepthRender=!1,this._pDepthRender&&(this._pDepthRender.dispose(),this._pDepthRender=null))},enumerable:!0,configurable:!0}),t.prototype.render=function(t){return e.prototype.render.call(this,t),this._pStage.recoverFromDisposal()?(this._pBackBufferInvalid&&this.pUpdateBackBuffer(),this._shareContext&&this._pContext&&this._pContext.clear(0,0,0,1,1,0,l.DEPTH),this._pFilter3DRenderer?(this.textureRatioX=this._pRttBufferManager.textureRatioX,this.textureRatioY=this._pRttBufferManager.textureRatioY):(this.textureRatioX=1,this.textureRatioY=1),this._pRequireDepthRender&&this.pRenderSceneDepthToTexture(t),this._depthPrepass&&this.pRenderDepthPrepass(t),this._pFilter3DRenderer&&this._pContext||(this._shareContext?this._iRender(t,null,this._pScissorRect):this._iRender(t)),e.prototype.render.call(this,t),!this._shareContext&&this._pContext&&this._pContext.present(),void(this._pStage.bufferClear=!1)):void(this._pBackBufferInvalid=!0)},t.prototype.pExecuteRender=function(t,i,r,a){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=0),this.updateLights(t),i&&(this.pCollectRenderables(t),this.drawRenderables(this._pOpaqueRenderableHead,t),this.drawRenderables(this._pBlendedRenderableHead,t)),e.prototype.pExecuteRender.call(this,t,i,r,a)},t.prototype.updateLights=function(e){var t,i,r,a,s=e.directionalLights,n=e.pointLights;for(t=s.length,i=0;t>i;++i)r=s[i],a=r.shadowMapper,r.castsShadows&&(a.autoUpdateShadows||a._iShadowsInvalid)&&a.iRenderDepthMap(e,this._pDepthRenderer);for(t=n.length,i=0;t>i;++i)r=n[i],a=r.shadowMapper,r.castsShadows&&(a.autoUpdateShadows||a._iShadowsInvalid)&&a.iRenderDepthMap(e,this._pDistanceRenderer)},t.prototype.pDraw=function(e,t){t||this.pCollectRenderables(e),this._pContext.setBlendFactors(o.ONE,o.ZERO),e.skyBox&&(this._pContext.setDepthTest(!1,h.ALWAYS),this.drawSkybox(e)),this._pContext.setDepthTest(!0,h.LESS_EQUAL),this.drawRenderables(this._pOpaqueRenderableHead,e),this.drawRenderables(this._pBlendedRenderableHead,e)},t.prototype.drawSkybox=function(e){var t=this._skyboxRenderablePool.getItem(e.skyBox),i=e.skyBox.material,r=e.camera;this.updateSkyboxProjection(r);var a=this.getMaterial(i,this._pStage.profile).getMaterialPass(i._iScreenPasses[0],this._pStage.profile);i._iActivatePass(a,this,r),i._iRenderPass(a,t,this._pStage,r,this._skyboxProjection),i._iDeactivatePass(a,this)},t.prototype.updateSkyboxProjection=function(e){var t=new a;this._skyboxProjection.copyFrom(this._pRttViewProjectionMatrix),this._skyboxProjection.copyRowTo(2,t);var i=e.scenePosition,r=t.x,s=t.y,n=t.z,o=-(t.x*i.x+t.y*i.y+t.z*i.z+Math.sqrt(r*r+s*s+n*n)),h=r>=0?1:-1,l=s>=0?1:-1,p=new a(h,l,1,1),d=this._skyboxProjection.clone();d.invert();var c=d.transformVector(p);this._skyboxProjection.copyRowTo(3,p);var u=(c.x*p.x+c.y*p.y+c.z*p.z+c.w*p.w)/(r*c.x+s*c.y+n*c.z+o*c.w);this._skyboxProjection.copyRowFrom(2,new a(r*u,s*u,n*u,o*u))},t.prototype.drawRenderables=function(e,t){for(var i,r,a,s,n,o,h=(this._pStage.context,t.camera);e;){for(n=this.getMaterial(e.material,this._pStage.profile),a=e.material._iScreenPasses,r=e.material._iNumScreenPasses(),i=0;r>i;i++){o=e,s=n.getMaterialPass(a[i],this._pStage.profile),e.material._iActivatePass(s,this,h);do e.material._iRenderPass(s,o,this._pStage,h,this._pRttViewProjectionMatrix),o=o.next;while(o&&o.material==e.material);n.material._iDeactivatePass(s,this)}e=o}},t.prototype.dispose=function(){this._shareContext||this._pStage.dispose(),this._pDepthRenderer.dispose(),this._pDistanceRenderer.dispose(),this._pDepthRenderer=null,this._pDistanceRenderer=null,this._pDepthRender=null,e.prototype.dispose.call(this)},t.prototype.pRenderDepthPrepass=function(e){this._pDepthRenderer.disableColor=!0,this._pFilter3DRenderer||(this._pDepthRenderer.textureRatioX=1,this._pDepthRenderer.textureRatioY=1,this._pDepthRenderer._iRender(e)),this._pDepthRenderer.disableColor=!1},t.prototype.pRenderSceneDepthToTexture=function(e){(this._pDepthTextureInvalid||!this._pDepthRender)&&this.initDepthTexture(this._pStage.context),this._pDepthRenderer.textureRatioX=this._pRttBufferManager.textureRatioX,this._pDepthRenderer.textureRatioY=this._pRttBufferManager.textureRatioY,this._pDepthRenderer._iRender(e,this._pDepthRender)},t.prototype.pUpdateBackBuffer=function(){this._pStage.context&&!this._shareContext&&this._width&&this._height&&(this._pStage.configureBackBuffer(this._width,this._height,this._antiAlias,!0),this._pBackBufferInvalid=!1)},t.prototype.iSetStage=function(t){e.prototype.iSetStage.call(this,t),this._pDistanceRenderer.iSetStage(t),this._pDepthRenderer.iSetStage(t)},t.prototype.initDepthTexture=function(){this._pDepthTextureInvalid=!1,this._pDepthRender&&this._pDepthRender.dispose(),this._pDepthRender=new s(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight)},t}(g);t.exports=f},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/textures/RenderTexture":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-renderergl/lib/managers/RTTBufferManager":void 0,"awayjs-renderergl/lib/materials/passes/DepthMapPass":void 0,"awayjs-renderergl/lib/materials/passes/DistanceMapPass":void 0,"awayjs-renderergl/lib/pool/SkyboxRenderable":void 0,"awayjs-renderergl/lib/render/DepthRenderer":void 0,"awayjs-renderergl/lib/render/Filter3DRenderer":void 0,"awayjs-renderergl/lib/render/RendererBase":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/managers/StageManager":void 0}],"awayjs-renderergl/lib/render/DepthRenderer":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),a=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),s=e("awayjs-renderergl/lib/render/RendererBase"),n=function(e){function t(t,i){void 0===i&&(i=!1),e.call(this),this._pass=t,this._renderBlended=i,this._iBackgroundR=1,this._iBackgroundG=1,this._iBackgroundB=1}return i(t,e),Object.defineProperty(t.prototype,"disableColor",{get:function(){return this._disableColor},set:function(e){this._disableColor=e},enumerable:!0,configurable:!0}),t.prototype._iRenderCascades=function(e,t,i,s,n){this.pCollectRenderables(e),this._pStage.setRenderTarget(t,!0,0),this._pContext.clear(1,1,1,1,1,0),this._pContext.setBlendFactors(r.ONE,r.ZERO),this._pContext.setDepthTest(!0,a.LESS);for(var o=this._pOpaqueRenderableHead,h=!0,l=i-1;l>=0;--l)this._pStage.scissorRect=s[l],this.drawCascadeRenderables(o,n[l],h?null:n[l].frustumPlanes),h=!1;this._pContext.setDepthTest(!1,a.LESS_EQUAL),this._pStage.scissorRect=null},t.prototype.drawCascadeRenderables=function(e,t,i){var r,a,s;for(this._pStage.context;e;){a=this.getMaterial(e.material,this._pStage.profile),s=e,r=a.getMaterialPass(this._pass,this._pStage.profile),""==r.key&&this.calcAnimationCode(e.material,r),e.material._iActivatePass(r,this,t);do!i||s.sourceEntity.worldBounds.isInFrustum(i,4)?s.material._iRenderPass(r,s,this._pStage,t,this._pRttViewProjectionMatrix):s.cascaded=!0,s=s.next;while(s&&s.material==e.material&&!s.cascaded);e.material._iDeactivatePass(r,this),e=s}},t.prototype.pDraw=function(e){this.pCollectRenderables(e),this._pContext.setBlendFactors(r.ONE,r.ZERO),this._pContext.setDepthTest(!0,a.LESS),this.drawRenderables(this._pOpaqueRenderableHead,e),this._disableColor&&this._pContext.setColorMask(!1,!1,!1,!1),this._renderBlended&&this.drawRenderables(this._pBlendedRenderableHead,e),this._disableColor&&this._pContext.setColorMask(!0,!0,!0,!0)},t.prototype.drawRenderables=function(e,t){for(var i,r,a,s=(this._pStage.context,t.camera);e;){if(r=this.getMaterial(e.material,this._pStage.profile),this._disableColor&&0!=e.material.alphaThreshold){a=e;do a=a.next;while(a&&a.material==e.material)}else{a=e,i=r.getMaterialPass(this._pass,this._pStage.profile),""==i.key&&this.calcAnimationCode(e.material,i),e.material._iActivatePass(i,this,s);do a.material._iRenderPass(i,a,this._pStage,s,this._pRttViewProjectionMatrix),a=a.next;while(a&&a.material==e.material);e.material._iDeactivatePass(i,this)}e=a}},t}(s);t.exports=n},{"awayjs-renderergl/lib/render/RendererBase":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/render/Filter3DRenderer":[function(e,t){var i=e("awayjs-core/lib/events/Event"),r=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/managers/RTTBufferManager"),n=function(){function e(e){var t=this;this._filterSizesInvalid=!0,this._onRTTResizeDelegate=function(e){return t.onRTTResize(e)},this._stage=e,this._rttManager=s.getInstance(e),this._rttManager.addEventListener(i.RESIZE,this._onRTTResizeDelegate)}return e.prototype.onRTTResize=function(){this._filterSizesInvalid=!0},Object.defineProperty(e.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),e.prototype.getMainInputTexture=function(e){return this._filterTasksInvalid&&this.updateFilterTasks(e),this._mainInputTexture},Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(e){if(this._filters=e,this._filterTasksInvalid=!0,this._requireDepthRender=!1,this._filters){for(var t=0;t<this._filters.length;++t){var i=this._filters[t],r=null==i.requireDepthRender?!1:i.requireDepthRender;this._requireDepthRender=this._requireDepthRender||r}this._filterSizesInvalid=!0}},enumerable:!0,configurable:!0}),e.prototype.updateFilterTasks=function(e){var t;if(this._filterSizesInvalid&&this.updateFilterSizes(),!this._filters)return void(this._tasks=null);this._tasks=new Array,t=this._filters.length-1;for(var i,r=0;t>=r;++r)i=this._filters[r],i.setRenderTargets(r==t?null:this._filters[r+1].getMainInputTexture(e),e),this._tasks=this._tasks.concat(i.tasks);this._mainInputTexture=this._filters[0].getMainInputTexture(e)},e.prototype.render=function(e,t,i){var s,n,o,h=e.context,l=this._rttManager.indexBuffer,p=this._rttManager.renderToTextureVertexBuffer;if(this._filters){for(this._filterSizesInvalid&&this.updateFilterSizes(),this._filterTasksInvalid&&this.updateFilterTasks(e),s=this._filters.length,n=0;s>n;++n)this._filters[n].update(e,t);for(s=this._tasks.length,s>1&&(h.setVertexBufferAt(0,p,0,a.FLOAT_2),h.setVertexBufferAt(1,p,2,a.FLOAT_2)),n=0;s>n;++n)o=this._tasks[n],o.target||(e.scissorRect=null,p=this._rttManager.renderToScreenVertexBuffer,h.setVertexBufferAt(0,p,0,a.FLOAT_2),h.setVertexBufferAt(1,p,2,a.FLOAT_2)),h.setTextureAt(0,o.getMainInputTexture(e)),h.setProgram(o.getProgram(e)),h.clear(0,0,0,0),o.activate(e,t,i),h.setBlendFactors(r.ONE,r.ZERO),h.drawTriangles(l,0,2),o.deactivate(e);h.setTextureAt(0,null),h.setVertexBufferAt(0,null),h.setVertexBufferAt(1,null)}},e.prototype.updateFilterSizes=function(){for(var e=0;e<this._filters.length;++e)this._filters[e].textureWidth=this._rttManager.textureWidth,this._filters[e].textureHeight=this._rttManager.textureHeight;this._filterSizesInvalid=!0},e.prototype.dispose=function(){this._rttManager.removeEventListener(i.RESIZE,this._onRTTResizeDelegate),this._rttManager=null,this._stage=null},e}();t.exports=n},{"awayjs-core/lib/events/Event":void 0,"awayjs-renderergl/lib/managers/RTTBufferManager":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/render/RendererBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Point"),s=e("awayjs-core/lib/geom/Rectangle"),n=e("awayjs-core/lib/errors/AbstractMethodError"),o=e("awayjs-core/lib/events/EventDispatcher"),h=e("awayjs-display/lib/pool/RenderablePool"),l=e("awayjs-display/lib/sort/RenderableMergeSort"),p=e("awayjs-display/lib/events/RendererEvent"),d=e("awayjs-display/lib/events/StageEvent"),c=e("awayjs-display/lib/traverse/EntityCollector"),u=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),g=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),_=e("awayjs-renderergl/lib/pool/BillboardRenderable"),m=e("awayjs-renderergl/lib/pool/LineSubMeshRenderable"),y=e("awayjs-renderergl/lib/pool/MaterialDataPool"),f=e("awayjs-renderergl/lib/pool/TriangleSubMeshRenderable"),b=e("awayjs-renderergl/lib/materials/utils/DefaultMaterialManager"),x=function(e){function t(){var t=this;e.call(this),this._numUsedStreams=0,this._numUsedTextures=0,this._viewPort=new s,this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this._depthPrepass=!1,this._backgroundR=0,this._backgroundG=0,this._backgroundB=0,this._backgroundAlpha=1,this._shareContext=!1,this.textureRatioX=1,this.textureRatioY=1,this._pRttViewProjectionMatrix=new r,this._localPos=new a,this._globalPos=new a,this._pScissorRect=new s,this._pNumTriangles=0,this._onViewportUpdatedDelegate=function(e){return t.onViewportUpdated(e)},this._materialDataPool=new y,this._billboardRenderablePool=h.getPool(_),this._triangleSubMeshRenderablePool=h.getPool(f),this._lineSubMeshRenderablePool=h.getPool(m),this._onContextUpdateDelegate=function(e){return t.onContextUpdate(e)},this.renderableSorter=new l}return i(t,e),Object.defineProperty(t.prototype,"numTriangles",{get:function(){return this._pNumTriangles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPort",{get:function(){return this._viewPort},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scissorRect",{get:function(){return this._pScissorRect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._localPos.x},set:function(e){this.x!=e&&(this._globalPos.x=this._localPos.x=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._localPos.y},set:function(e){this.y!=e&&(this._globalPos.y=this._localPos.y=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width!=e&&(this._width=e,this._pScissorRect.width=e,this._pRttBufferManager&&(this._pRttBufferManager.viewWidth=e),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height!=e&&(this._height=e,this._pScissorRect.height=e,this._pRttBufferManager&&(this._pRttBufferManager.viewHeight=e),this._pBackBufferInvalid=!0,this._pDepthTextureInvalid=!0,this.notifyScissorUpdate())
},enumerable:!0,configurable:!0}),t.prototype.getProgram=function(e){if(e.key.length)return e.programData;e.key=e.animationVertexCode+e.vertexCode+"---"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode;var t=this._pStage.getProgramData(e.key);return e.programData!=t&&(e.programData&&e.programData.dispose(),e.programData=t,t.usages++),t},t.prototype.getMaterial=function(e,t){var i=this._materialDataPool.getItem(e);if(i.invalidAnimation){i.invalidAnimation=!1;for(var r,a=i.getMaterialPasses(t),s=this.getEnabledGPUAnimation(e,a),n=0,o=1,h=a.length,l=0;h>l;l++)r=a[l],r.usesAnimation!=s&&(r.usesAnimation=s,""==r.key),""==r.key&&this.calcAnimationCode(e,r),n+=this.getProgram(r).id*o,o*=1e3;i.renderOrderId=n}return i},t.prototype.activateMaterialPass=function(e,t){for(var i=e.shaderObject,r=i.numUsedStreams;r<this._numUsedStreams;r++)this._pContext.setVertexBufferAt(r,null);for(var r=i.numUsedTextures;r<this._numUsedTextures;r++)this._pContext.setTextureAt(r,null);e.usesAnimation&&e.material.animationSet.activate(i,this._pStage),i.iActivate(this._pStage,t);var a=this.getProgram(e);if(!a.program){a.program=this._pContext.createProgram();var s=(new u).assemble("part vertex 1\n"+e.animationVertexCode+e.vertexCode+"endpart").vertex.data,n=(new u).assemble("part fragment 1\n"+e.fragmentCode+e.animationFragmentCode+e.postAnimationFragmentCode+"endpart").fragment.data;a.program.upload(s,n)}this._pContext.setProgram(a.program)},t.prototype.deactivateMaterialPass=function(e){var t=e.shaderObject;e.usesAnimation&&e.material.animationSet.deactivate(t,this._pStage),e.shaderObject.iDeactivate(this._pStage),this._numUsedStreams=t.numUsedStreams,this._numUsedTextures=t.numUsedTextures},t.prototype._iCreateEntityCollector=function(){return new c},Object.defineProperty(t.prototype,"_iBackgroundR",{get:function(){return this._backgroundR},set:function(e){this._backgroundR!=e&&(this._backgroundR=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_iBackgroundG",{get:function(){return this._backgroundG},set:function(e){this._backgroundG!=e&&(this._backgroundG=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_iBackgroundB",{get:function(){return this._backgroundB},set:function(e){this._backgroundB!=e&&(this._backgroundB=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._pContext},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stage",{get:function(){return this._pStage},set:function(e){e!=this._pStage&&this.iSetStage(e)},enumerable:!0,configurable:!0}),t.prototype.iSetStage=function(e){this._pStage&&(this._pStage.removeEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate)),e?(this._pStage=e,this._pStage.addEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.addEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage.context&&(this._pContext=this._pStage.context)):(this._pStage=null,this._pContext=null),this._pBackBufferInvalid=!0,this.updateGlobalPos()},Object.defineProperty(t.prototype,"shareContext",{get:function(){return this._shareContext},set:function(e){this._shareContext!=e&&(this._shareContext=e,this.updateGlobalPos())},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._pRttBufferManager&&this._pRttBufferManager.dispose(),this._pRttBufferManager=null,this._pStage.removeEventListener(d.CONTEXT_CREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._pStage.removeEventListener(d.VIEWPORT_UPDATED,this._onViewportUpdatedDelegate),this._pStage=null},t.prototype.render=function(){this._viewportDirty=!1,this._scissorDirty=!1},t.prototype._iRender=function(e,t,i,r){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0),this._pStage&&this._pContext){this._pRttViewProjectionMatrix.copyFrom(e.camera.viewProjection),this._pRttViewProjectionMatrix.appendScale(this.textureRatioX,this.textureRatioY,1),this.pExecuteRender(e,t,i,r);for(var a=0;8>a;++a)this._pContext.setVertexBufferAt(a,null),this._pContext.setTextureAt(a,null)}},t.prototype._iRenderCascades=function(){},t.prototype.pCollectRenderables=function(e){this._pBlendedRenderableHead=null,this._pOpaqueRenderableHead=null,this._pNumTriangles=0;var t=e.entityHead;for(this._pCamera=e.camera,this._iEntryPoint=this._pCamera.scenePosition,this._pCameraForward=this._pCamera.transform.forwardVector;t;)t.entity._iCollectRenderables(this),t=t.next;this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead),this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)},t.prototype.pExecuteRender=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0),this._pStage.setRenderTarget(t,!0,r),!t&&this._shareContext||this._depthPrepass||this._pContext.clear(this._backgroundR,this._backgroundG,this._backgroundB,this._backgroundAlpha,1,0),this._pContext.setDepthTest(!1,g.ALWAYS),this._pStage.scissorRect=i,this.pDraw(e,t),this._shareContext||this._snapshotRequired&&this._snapshotBitmapData&&(this._pContext.drawToBitmapData(this._snapshotBitmapData),this._snapshotRequired=!1),this._pStage.scissorRect=null},t.prototype.queueSnapshot=function(e){this._snapshotRequired=!0,this._snapshotBitmapData=e},t.prototype.pDraw=function(){throw new n},t.prototype.onContextUpdate=function(){this._pContext=this._pStage.context},Object.defineProperty(t.prototype,"_iBackgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(e){this._backgroundAlpha!=e&&(this._backgroundAlpha=e,this._pBackBufferInvalid=!0)},enumerable:!0,configurable:!0}),t.prototype.notifyScissorUpdate=function(){this._scissorDirty||(this._scissorDirty=!0,this._scissorUpdated||(this._scissorUpdated=new p(p.SCISSOR_UPDATED)),this.dispatchEvent(this._scissorUpdated))},t.prototype.notifyViewportUpdate=function(){this._viewportDirty||(this._viewportDirty=!0,this._viewPortUpdated||(this._viewPortUpdated=new p(p.VIEWPORT_UPDATED)),this.dispatchEvent(this._viewPortUpdated))},t.prototype.onViewportUpdated=function(){this._viewPort=this._pStage.viewPort,this._shareContext&&(this._pScissorRect.x=this._globalPos.x-this._pStage.x,this._pScissorRect.y=this._globalPos.y-this._pStage.y,this.notifyScissorUpdate()),this.notifyViewportUpdate()},t.prototype.updateGlobalPos=function(){this._shareContext?(this._pScissorRect.x=this._globalPos.x-this._viewPort.x,this._pScissorRect.y=this._globalPos.y-this._viewPort.y):(this._pScissorRect.x=0,this._pScissorRect.y=0,this._viewPort.x=this._globalPos.x,this._viewPort.y=this._globalPos.y),this.notifyScissorUpdate()},t.prototype.applyBillboard=function(e){this._applyRenderable(this._billboardRenderablePool.getItem(e))},t.prototype.applyTriangleSubMesh=function(e){this._applyRenderable(this._triangleSubMeshRenderablePool.getItem(e))},t.prototype.applyLineSubMesh=function(e){this._applyRenderable(this._lineSubMeshRenderablePool.getItem(e))},t.prototype._applyRenderable=function(e){var t=e.materialOwner.material,i=e.sourceEntity,r=i.scenePosition;t||(t=b.getDefaultMaterial(e.materialOwner)),t._iUpdateMaterial(),e.material=t,e.materialId=t._iMaterialId,e.renderOrderId=this.getMaterial(t,this._pStage.profile).renderOrderId,e.cascaded=!1,r=this._iEntryPoint.subtract(r),e.zIndex=i.zOffset+r.dotProduct(this._pCameraForward),e.renderSceneTransform=e.sourceEntity.getRenderSceneTransform(this._pCamera),t.requiresBlending?(e.next=this._pBlendedRenderableHead,this._pBlendedRenderableHead=e):(e.next=this._pOpaqueRenderableHead,this._pOpaqueRenderableHead=e),this._pNumTriangles+=e.numTriangles,e.overflow&&this._applyRenderable(e.overflow)},t.prototype.getEnabledGPUAnimation=function(e,t){if(e.animationSet){e.animationSet.resetGPUCompatibility();for(var i=e.iOwners,r=i.length,a=t.length,s=0;a>s;s++)for(var n=0;r>n;n++)i[n].animator&&i[n].animator.testGPUCompatibility(t[s].shaderObject);return!e.animationSet.usesCPU}return!1},t.prototype.calcAnimationCode=function(e,t){t.key="",t.animationVertexCode="",t.animationFragmentCode="";var i=t.shaderObject;if(t.usesAnimation){var r=e.animationSet;t.animationVertexCode+=r.getAGALVertexCode(i),i.uvDependencies>0&&!i.usesUVTransform&&(t.animationVertexCode+=r.getAGALUVCode(i)),i.usesFragmentAnimation&&(t.animationFragmentCode+=r.getAGALFragmentCode(i,t.shadedTarget)),r.doneAGALCode(i)}else{for(var a=i.animatableAttributes.length,s=0;a>s;++s)t.animationVertexCode+="mov "+i.animationTargetRegisters[s]+", "+i.animatableAttributes[s]+"\n";i.uvDependencies>0&&!i.usesUVTransform&&(t.animationVertexCode+="mov "+i.uvTarget+","+i.uvSource+"\n")}},t}(o);t.exports=x},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/events/EventDispatcher":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-display/lib/events/RendererEvent":void 0,"awayjs-display/lib/events/StageEvent":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-display/lib/sort/RenderableMergeSort":void 0,"awayjs-display/lib/traverse/EntityCollector":void 0,"awayjs-renderergl/lib/materials/utils/DefaultMaterialManager":void 0,"awayjs-renderergl/lib/pool/BillboardRenderable":void 0,"awayjs-renderergl/lib/pool/LineSubMeshRenderable":void 0,"awayjs-renderergl/lib/pool/MaterialDataPool":void 0,"awayjs-renderergl/lib/pool/TriangleSubMeshRenderable":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0}],"awayjs-renderergl/lib/tools/commands/Merge":[function(e,t){var i=e("awayjs-core/lib/geom/Matrix3DUtils"),r=e("awayjs-display/lib/base/Geometry"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-display/lib/entities/Mesh"),n=function(){function e(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),this._keepMaterial=e,this._disposeSources=t,this._objectSpace=i}return Object.defineProperty(e.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(e){this._disposeSources=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(e){this._keepMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(e){this._objectSpace=e},enumerable:!0,configurable:!0}),e.prototype.applyToContainer=function(e,t){this.reset(),this.parseContainer(e,t),this.collect(e,!1),this.merge(e,this._disposeSources)},e.prototype.applyToMeshes=function(e,t){if(this.reset(),t.length){for(var i=0;i<t.length;i++)t[i]!=e&&this.collect(t[i],this._disposeSources);this.collect(e,!1),this.merge(e,this._disposeSources)}},e.prototype.apply=function(e,t){this.reset(),this.collect(t,this._disposeSources),this.collect(e,!1),this.merge(e,this._disposeSources)},e.prototype.reset=function(){this._toDispose=new Array,this._geomVOs=new Array},e.prototype.merge=function(e,t){var i,s,n,o,h;for(n=e.geometry,o=e.geometry=new r,s=e.subMeshes.length,h=this._geomVOs.length>1,i=0;i<this._geomVOs.length;i++){var l,p=new a(!0);p.autoDeriveNormals=!1,p.autoDeriveTangents=!1,l=this._geomVOs[i],p.updateIndices(l.indices),p.updatePositions(l.vertices),p.updateVertexNormals(l.normals),p.updateVertexTangents(l.tangents),p.updateUVs(l.uvs),o.addSubGeometry(p),this._keepMaterial&&h&&(e.subMeshes[s].material=l.material)}if(this._keepMaterial&&!h&&this._geomVOs.length&&(e.material=this._geomVOs[0].material),t){for(var d,i,c=this._toDispose.length;c>i;i++)d=this._toDispose[i],d.geometry.dispose(),d.dispose();n.dispose()}this._toDispose=null},e.prototype.collect=function(e,t){if(e.geometry){var r,a,s=e.geometry.subGeometries;for(r=0;r<s.length;r++){var n,o,h,l,p,d,c,u,g,_,m,y,f,b,x,v,w;for(g=s[r],b=g.positions,x=g.vertexNormals,v=g.vertexTangents,w=g.uvs,_=this.getSubGeomData(e.subMeshes[r].material||e.material),m=this._objectSpace?_.vertices:new Array,y=this._objectSpace?_.normals:new Array,f=this._objectSpace?_.tangents:new Array,l=m.length,p=y.length,d=f.length,c=_.uvs.length,o=g.numVertices,n=0;o>n;n++)a=3*n,m[l++]=b[a],m[l++]=b[a+1],m[l++]=b[a+2],y[p++]=x[a],y[p++]=x[a+1],y[p++]=x[a+2],f[d++]=v[a],f[d++]=v[a+1],f[d++]=v[a+2],_.uvs[c++]=w[2*n],_.uvs[c++]=w[2*n+1];for(u=this._objectSpace?0:_.vertices.length/3,h=_.indices.length,o=g.numTriangles,n=0;o>n;n++)a=3*n,_.indices[h++]=g.indices[a]+u,_.indices[h++]=g.indices[a+1]+u,_.indices[h++]=g.indices[a+2]+u;if(!this._objectSpace)for(e.sceneTransform.transformVectors(m,m),i.deltaTransformVectors(e.sceneTransform,y,y),i.deltaTransformVectors(e.sceneTransform,f,f),l=_.vertices.length,p=_.normals.length,d=_.tangents.length,o=m.length,n=0;o>n;n++)_.vertices[l++]=m[n],_.normals[p++]=y[n],_.tangents[d++]=f[n]}t&&this._toDispose.push(e)}},e.prototype.getSubGeomData=function(e){var t;if(this._keepMaterial){var i,r;for(r=this._geomVOs.length,i=0;r>i;i++)if(this._geomVOs[i].material==e){t=this._geomVOs[i];break}}else this._geomVOs.length&&(t=this._geomVOs[0]);return t||(t=new o,t.vertices=new Array,t.normals=new Array,t.tangents=new Array,t.uvs=new Array,t.indices=new Array,t.material=e,this._geomVOs.push(t)),t},e.prototype.parseContainer=function(e,t){var i,r;for(t instanceof s&&t!=e&&this.collect(t,this._disposeSources),r=0;r<t.numChildren;++r)i=t.getChildAt(r),this.parseContainer(e,i)},e}(),o=function(){function e(){}return e}();t.exports=n},{"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/entities/Mesh":void 0}],"awayjs-renderergl/lib/tools/data/ParticleGeometryTransform":[function(e,t){var i=function(){function e(){}return Object.defineProperty(e.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(e){this._defaultVertexTransform=e,this._defaultInvVertexTransform=e.clone(),this._defaultInvVertexTransform.invert(),this._defaultInvVertexTransform.transpose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(e){this._defaultUVTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:!0,configurable:!0}),e}();t.exports=i},{}],"awayjs-renderergl/lib/tools/helpers/ParticleGeometryHelper":[function(e,t){var i=e("awayjs-core/lib/geom/Point"),r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-renderergl/lib/animators/data/ParticleData"),n=e("awayjs-renderergl/lib/base/ParticleGeometry"),o=function(){function e(){}return e.generateGeometry=function(t,o){void 0===o&&(o=null);var h,l,p,d,c,u,g,_,m,y,f,b,x=new Array,v=new Array,w=new Array,C=new Array,T=new Array,P=new Array,D=new Array,S=new Array,M=t.length,O=new Array,A=new r,j=new r,R=new r,I=new i;for(f=0;M>f;f++){h=t[f].subGeometries,p=h.length;for(var F=0;p>F;F++){O.length<=F&&(O.push(S.length),x.push(new Array),v.push(new Array),w.push(new Array),C.push(new Array),T.push(new Array),S.push(new a(!0)),P.push(0)),l=h[F],l.numVertices+P[O[F]]>e.MAX_VERTEX&&(O[F]=S.length,x.push(new Array),v.push(new Array),w.push(new Array),C.push(new Array),T.push(new Array),S.push(new a(!0)),P.push(0)),b=O[F],d=x[b],c=v[b],u=w[b],g=C[b],_=T[b],m=P[b],y=S[b];var N=new s;N.numVertices=l.numVertices,N.startVertexIndex=m,N.particleIndex=f,N.subGeometry=y,D.push(N),P[b]+=l.numVertices;var V,L,E,B,U,z,k,G=l;if(G)if(L=G.numVertices,G.numTriangles,B=G.positions,U=G.vertexNormals,z=G.vertexTangents,k=G.uvs,o){var H=o[f],X=H.vertexTransform,W=H.invVertexTransform,Y=H.UVTransform;for(V=0;L>V;V++)E=3*V,A.x=B[E],A.y=B[E+1],A.z=B[E+2],j.x=U[E],j.y=U[E+1],j.z=U[E+2],R.x=z[E],R.y=z[E+1],R.z=z[E+2],I.x=k[2*V],I.y=k[2*V+1],X&&(A=X.transformVector(A),j=W.deltaTransformVector(j),R=W.deltaTransformVector(j)),Y&&(I=Y.transformPoint(I)),B.push(A.x,A.y,A.z),U.push(j.x,j.y,j.z),z.push(R.x,R.y,R.z),k.push(I.x,I.y)}else for(V=0;L>V;V++)E=3*V,c.push(B[E],B[E+1],B[E+2]),u.push(U[E],U[E+1],U[E+2]),g.push(z[E],z[E+1],z[E+2]),_.push(k[2*V],k[2*V+1]);var J=l.indices;for(L=l.numTriangles,V=0;L>V;V++)E=3*V,d.push(J[E]+m,J[E+1]+m,J[E+2]+m)}}var q=new n;for(q.particles=D,q.numParticles=M,M=S.length,f=0;M>f;f++)y=S[f],y.autoDeriveNormals=!1,y.autoDeriveTangents=!1,y.updateIndices(x[f]),y.updatePositions(v[f]),y.updateVertexNormals(w[f]),y.updateVertexTangents(C[f]),y.updateUVs(T[f]),q.addSubGeometry(y);return q},e.MAX_VERTEX=65535,e}();t.exports=o},{"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticleData":void 0,"awayjs-renderergl/lib/base/ParticleGeometry":void 0}],"awayjs-renderergl/lib/utils/PerspectiveMatrix3D":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=function(e){function t(t){void 0===t&&(t=null),e.call(this,t)}return i(t,e),t.prototype.perspectiveFieldOfViewLH=function(e,t,i,r){var a=1/Math.tan(e/2),s=a/t;this.copyRawDataFrom([s,0,0,0,0,a,0,0,0,0,r/(r-i),1,0,0,i*r/(i-r),0])},t}(r);t.exports=a},{"awayjs-core/lib/geom/Matrix3D":void 0}]},{},[]);
//# sourceMappingURL=awayjs-renderergl.min.js.map