require=function e(t,i,r){function a(o,n){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!n&&l)return l(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var p=i[o]={exports:{}};t[o][0].call(p.exports,function(e){var i=t[o][1][e];return a(i?i:e)},p,p.exports,e,t,i,r)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({"awayjs-renderergl/lib/animators/ParticleAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/animators/AnimationSetBase"),a=e("awayjs-stagegl/lib/animators/data/AnimationRegisterCache"),s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry"),o=e("awayjs-renderergl/lib/animators/data/ParticleAnimationData"),n=e("awayjs-renderergl/lib/animators/data/ParticleProperties"),l=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),h=e("awayjs-renderergl/lib/animators/nodes/ParticleTimeNode"),p=function(e){function t(t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),e.call(this),this._animationSubGeometries=new Object,this._particleNodes=new Array,this._localDynamicNodes=new Array,this._localStaticNodes=new Array,this._totalLenOfOneVertex=0,this.addAnimation(this._timeNode=new h(t,i,r))}return i(t,e),Object.defineProperty(t.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:!0,configurable:!0}),t.prototype.addAnimation=function(t){var i,r=t;for(r._iProcessAnimationSetting(this),r.mode==l.LOCAL_STATIC?(r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength,this._localStaticNodes.push(r)):r.mode==l.LOCAL_DYNAMIC&&this._localDynamicNodes.push(r),i=this._particleNodes.length-1;i>=0&&!(this._particleNodes[i].priority<=r.priority);i--);this._particleNodes.splice(i+1,0,r),e.prototype.addAnimation.call(this,t)},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALVertexCode=function(e){this._iAnimationRegisterCache=e.animationRegisterCache,null==this._iAnimationRegisterCache&&(this._iAnimationRegisterCache=e.animationRegisterCache=new a(e.profile)),this._iAnimationRegisterCache.vertexConstantOffset=e.numUsedVertexConstants,this._iAnimationRegisterCache.vertexAttributesOffset=e.numUsedStreams,this._iAnimationRegisterCache.varyingsOffset=e.numUsedVaryings,this._iAnimationRegisterCache.fragmentConstantOffset=e.numUsedFragmentConstants,this._iAnimationRegisterCache.hasUVNode=this.hasUVNode,this._iAnimationRegisterCache.needVelocity=this.needVelocity,this._iAnimationRegisterCache.hasBillboard=this.hasBillboard,this._iAnimationRegisterCache.sourceRegisters=e.animatableAttributes,this._iAnimationRegisterCache.targetRegisters=e.animationTargetRegisters,this._iAnimationRegisterCache.needFragmentAnimation=e.usesFragmentAnimation,this._iAnimationRegisterCache.needUVAnimation=!e.usesUVTransform,this._iAnimationRegisterCache.hasColorAddNode=this.hasColorAddNode,this._iAnimationRegisterCache.hasColorMulNode=this.hasColorMulNode,this._iAnimationRegisterCache.reset();var i="";i+=this._iAnimationRegisterCache.getInitCode();var r,s;for(s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority<t.POST_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));for(i+=this._iAnimationRegisterCache.getCombinationCode(),s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority>=t.POST_PRIORITY&&r.priority<t.COLOR_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));for(i+=this._iAnimationRegisterCache.initColorRegisters(),s=0;s<this._particleNodes.length;s++)r=this._particleNodes[s],r.priority>=t.COLOR_PRIORITY&&(i+=r.getAGALVertexCode(e,this._iAnimationRegisterCache));return i+=this._iAnimationRegisterCache.getColorPassCode()},t.prototype.getAGALUVCode=function(e){var t="";if(this.hasUVNode){this._iAnimationRegisterCache.setUVSourceAndTarget(e.uvSource,e.uvTarget),t+="mov "+this._iAnimationRegisterCache.uvTarget+".xy,"+this._iAnimationRegisterCache.uvAttribute.toString()+"\n";for(var i,r=0;r<this._particleNodes.length;r++)i=this._particleNodes[r];t+=i.getAGALUVCode(e,this._iAnimationRegisterCache),t+="mov "+this._iAnimationRegisterCache.uvVar.toString()+","+this._iAnimationRegisterCache.uvTarget+".xy\n"}else t+="mov "+e.uvTarget+","+e.uvSource+"\n";return t},t.prototype.getAGALFragmentCode=function(e,t){return this._iAnimationRegisterCache.getColorCombinationCode(t)},t.prototype.doneAGALCode=function(){this._iAnimationRegisterCache.setDataLength(),this._iAnimationRegisterCache.setVertexConst(this._iAnimationRegisterCache.vertexZeroConst.index,0,1,2,0)},Object.defineProperty(t.prototype,"usesCPU",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.cancelGPUCompatibility=function(){},t.prototype.dispose=function(){for(var t in this._animationSubGeometries)this._animationSubGeometries[t].dispose();e.prototype.dispose.call(this)},t.prototype.getAnimationSubGeometry=function(e){var t=e.parentMesh,i=t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id];return i?i:(this._iGenerateAnimationSubGeometries(t),t.shareAnimationGeometry?this._animationSubGeometries[e.subGeometry.id]:this._animationSubGeometries[e.id])},t.prototype._iGenerateAnimationSubGeometries=function(e){if(null==this.initParticleFunc)throw new Error("no initParticleFunc set");var t=e.geometry;if(!t)throw new Error("Particle animation can only be performed on a ParticleGeometry object");var i,r,a,l,h,p,d,c=!1;for(i=0;i<e.subMeshes.length;i++)p=e.subMeshes[i],h=p.subGeometry,e.shareAnimationGeometry&&(l=this._animationSubGeometries[h.id])||(l=new s,e.shareAnimationGeometry?this._animationSubGeometries[h.id]=l:this._animationSubGeometries[p.id]=l,c=!0,l.createVertexData(h.numVertices,this._totalLenOfOneVertex));if(c){var u,_,y,m,g,f,b,x,w,v,D,T=t.particles,P=T.length,C=t.numParticles,S=new n;for(S.total=C,S.startTime=0,S.duration=1e3,S.delay=.1,i=0,r=0;C>i;){for(S.index=i,this.initParticleFunc.call(this.initParticleScope,S),a=0;a<this._localStaticNodes.length;a++)this._localStaticNodes[a]._iGeneratePropertyOfOneParticle(S);for(;P>r&&(u=T[r]).particleIndex==i;){for(a=0;a<e.subMeshes.length;a++)if(p=e.subMeshes[a],p.subGeometry==u.subGeometry){l=e.shareAnimationGeometry?this._animationSubGeometries[p.subGeometry.id]:this._animationSubGeometries[p.id];break}for(b=u.numVertices,x=l.vertexData,w=b*this._totalLenOfOneVertex,v=l.numProcessedVertices*this._totalLenOfOneVertex,a=0;a<this._localStaticNodes.length;a++)for(d=this._localStaticNodes[a],f=d.oneData,_=d.dataLength,y=v+d._iDataOffset,m=0;w>m;m+=this._totalLenOfOneVertex)for(D=y+m,g=0;_>g;g++)x[D+g]=f[g];this._localDynamicNodes.length&&l.animationParticles.push(new o(i,S.startTime,S.duration,S.delay,u)),l.numProcessedVertices+=b,r++}i++}}},t.POST_PRIORITY=9,t.COLOR_PRIORITY=18,t}(r);t.exports=p},{"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticleAnimationData":void 0,"awayjs-renderergl/lib/animators/data/ParticleProperties":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":void 0,"awayjs-stagegl/lib/animators/AnimationSetBase":void 0,"awayjs-stagegl/lib/animators/data/AnimationRegisterCache":void 0}],"awayjs-renderergl/lib/animators/ParticleAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/animators/AnimatorBase"),a=e("awayjs-stagegl/lib/base/ContextGLProgramType"),s=e("awayjs-renderergl/lib/animators/data/AnimationSubGeometry"),o=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=function(e){function t(t){e.call(this,t),this._animationParticleStates=new Array,this._animatorParticleStates=new Array,this._timeParticleStates=new Array,this._totalLenOfOneVertex=0,this._animatorSubGeometries=new Object,this._particleAnimationSet=t;for(var i,r,a=0;a<this._particleAnimationSet.particleNodes.length;a++)r=this._particleAnimationSet.particleNodes[a],i=this.getAnimationState(r),r.mode==o.LOCAL_DYNAMIC?(this._animatorParticleStates.push(i),r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength):this._animationParticleStates.push(i),i.needUpdateTime&&this._timeParticleStates.push(i)}return i(t,e),t.prototype.clone=function(){return new t(this._particleAnimationSet)},t.prototype.setRenderState=function(e,t,i,r){var s,o=this._particleAnimationSet._iAnimationRegisterCache,n=t.subMesh;if(!n)throw new Error("Must be subMesh");var l=this._particleAnimationSet.getAnimationSubGeometry(n);for(s=0;s<this._animationParticleStates.length;s++)this._animationParticleStates[s].setRenderState(i,t,l,o,r);var h=this.getAnimatorSubGeometry(n);for(s=0;s<this._animatorParticleStates.length;s++)this._animatorParticleStates[s].setRenderState(i,t,h,o,r);i.context.setProgramConstantsFromArray(a.VERTEX,o.vertexConstantOffset,o.vertexConstantData,o.numVertexConstant),o.numFragmentConstant>0&&i.context.setProgramConstantsFromArray(a.FRAGMENT,o.fragmentConstantOffset,o.fragmentConstantData,o.numFragmentConstant)},t.prototype.testGPUCompatibility=function(){},t.prototype.start=function(){e.prototype.start.call(this);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime)},t.prototype._pUpdateDeltaTime=function(e){this._pAbsoluteTime+=e;for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].update(this._pAbsoluteTime)},t.prototype.resetTime=function(e){void 0===e&&(e=0);for(var t=0;t<this._timeParticleStates.length;t++)this._timeParticleStates[t].offset(this._pAbsoluteTime+e);this.update(this.time)},t.prototype.dispose=function(){for(var e in this._animatorSubGeometries)this._animatorSubGeometries[e].dispose()},t.prototype.getAnimatorSubGeometry=function(e){if(this._animatorParticleStates.length){var t=e.subGeometry,i=this._animatorSubGeometries[t.id]=new s;i.createVertexData(t.numVertices,this._totalLenOfOneVertex),i.animationParticles=this._particleAnimationSet.getAnimationSubGeometry(e).animationParticles}},t}(r);t.exports=n},{"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-stagegl/lib/animators/AnimatorBase":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/animators/SkeletonAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/animators/AnimationSetBase"),a=function(e){function t(t){void 0===t&&(t=4),e.call(this),this._jointsPerVertex=t}return i(t,e),Object.defineProperty(t.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(e){for(var t=e.animatableAttributes.length,i=e.numUsedVertexConstants,r=i+1,a=i+2,s="va"+e.numUsedStreams,o="va"+(e.numUsedStreams+1),n=[s+".x",s+".y",s+".z",s+".w"],l=[o+".x",o+".y",o+".z",o+".w"],h=this._pFindTempReg(e.animationTargetRegisters),p=this._pFindTempReg(e.animationTargetRegisters,h),d="dp4",c="",u=0;t>u;++u){for(var _=e.animatableAttributes[u],y=0;y<this._jointsPerVertex;++y)c+=d+" "+h+".x, "+_+", vc["+n[y]+"+"+i+"]\n"+d+" "+h+".y, "+_+", vc["+n[y]+"+"+r+"]\n"+d+" "+h+".z, "+_+", vc["+n[y]+"+"+a+"]\nmov "+h+".w, "+_+".w\nmul "+h+", "+h+", "+l[y]+"\n",c+=0==y?"mov "+p+", "+h+"\n":"add "+p+", "+p+", "+h+"\n";d="dp3",c+="mov "+e.animationTargetRegisters[u]+", "+p+"\n"}return c},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"},t.prototype.doneAGALCode=function(){},t}(r);t.exports=a},{"awayjs-stagegl/lib/animators/AnimationSetBase":void 0}],"awayjs-renderergl/lib/animators/SkeletonAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-display/lib/events/SubGeometryEvent"),s=e("awayjs-stagegl/lib/animators/AnimatorBase"),o=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/animators/data/JointPose"),l=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),h=e("awayjs-renderergl/lib/events/AnimationStateEvent"),p=function(e){function t(t,i,r){var a=this;void 0===r&&(r=!1),e.call(this,t),this._globalPose=new l,this._morphedSubGeometry=new Object,this._morphedSubGeometryDirty=new Object,this._skeleton=i,this._forceCPU=r,this._jointsPerVertex=t.jointsPerVertex,this._numJoints=this._skeleton.numJoints,this._globalMatrices=new Array(12*this._numJoints);for(var s=0,o=0;o<this._numJoints;++o)this._globalMatrices[s++]=1,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=1,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=0,this._globalMatrices[s++]=1,this._globalMatrices[s++]=0;this._onTransitionCompleteDelegate=function(e){return a.onTransitionComplete(e)},this._onIndicesUpdateDelegate=function(e){return a.onIndicesUpdate(e)},this._onVerticesUpdateDelegate=function(e){return a.onVerticesUpdate(e)}}return i(t,e),Object.defineProperty(t.prototype,"globalMatrices",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalMatrices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalPose",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalPose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(e){this._useCondensedIndices=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this._pAnimationSet,this._skeleton,this._forceCPU)},t.prototype.play=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=0/0),this._pActiveAnimationName!=e){if(this._pActiveAnimationName=e,!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");t&&this._pActiveNode?(this._pActiveNode=t.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(e),this._pAbsoluteTime),this._pActiveNode.addEventListener(h.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)):this._pActiveNode=this._pAnimationSet.getAnimation(e),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeSkeletonState=this._pActiveState,this.start(),isNaN(i)||this.reset(e,i)}},t.prototype.setRenderState=function(e,t,i,a,s,n){this._globalPropertiesDirty&&this.updateGlobalProperties();var l=t.subMesh.subGeometry;if(l.useCondensedIndices=this._useCondensedIndices,this._useCondensedIndices)this.updateCondensedMatrices(l.condensedIndexLookUp,l.numCondensedJoints),i.context.setProgramConstantsFromArray(o.VERTEX,s,this._condensedMatrices,3*l.numCondensedJoints);else{if(this._pAnimationSet.usesCPU)return void(this._morphedSubGeometryDirty[l.id]&&this.morphSubGeometry(t,l));i.context.setProgramConstantsFromArray(o.VERTEX,s,this._globalMatrices,3*this._numJoints)}i.context.activateBuffer(n,t.getVertexData(r.JOINT_INDEX_DATA),t.getVertexOffset(r.JOINT_INDEX_DATA),t.JOINT_INDEX_FORMAT),i.context.activateBuffer(n+1,t.getVertexData(r.JOINT_WEIGHT_DATA),t.getVertexOffset(r.JOINT_WEIGHT_DATA),t.JOINT_WEIGHT_FORMAT)},t.prototype.testGPUCompatibility=function(e){!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||e.numUsedVertexConstants+3*this._numJoints>128)&&this._pAnimationSet.cancelGPUCompatibility()},t.prototype._pUpdateDeltaTime=function(t){if(e.prototype._pUpdateDeltaTime.call(this,t),this._globalPropertiesDirty=!0,this._pAnimationSet.usesCPU)for(var i in this._morphedSubGeometryDirty)this._morphedSubGeometryDirty[i]=!0},t.prototype.updateCondensedMatrices=function(e,t){var i,r,a=0,s=0;this._condensedMatrices=new Array;do for(r=4*e[a],i=r+12;i>r;)this._condensedMatrices[s++]=this._globalMatrices[r++];while(++a<t)},t.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=!1,this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);for(var e,t,i,r,a,s,o,n,l,h,p,d,c,u,_,y,m,g,f,b,x,w,v,D,T,P,C,S,A,O,M,j,N,I,R,F,E=0,V=this._globalPose.jointPoses,B=this._skeleton.joints,L=0;L<this._numJoints;++L)N=V[L],I=N.orientation,R=N.translation,t=I.x,i=I.y,r=I.z,a=I.w,s=(F=2*t)*i,o=F*r,n=F*a,l=(F=2*i)*r,h=F*a,p=2*r*a,l=2*i*r,h=2*i*a,p=2*r*a,t*=t,i*=i,r*=r,a*=a,d=(F=t-i)-r+a,c=s-p,u=o+h,_=s+p,y=-F-r+a,m=l-n,g=o-h,f=l+n,b=-t-i+r+a,e=B[L].inverseBindPose,x=e[0],w=e[4],v=e[8],D=e[12],T=e[1],P=e[5],C=e[9],S=e[13],A=e[2],O=e[6],M=e[10],j=e[14],this._globalMatrices[E]=d*x+c*T+u*A,this._globalMatrices[E+1]=d*w+c*P+u*O,this._globalMatrices[E+2]=d*v+c*C+u*M,this._globalMatrices[E+3]=d*D+c*S+u*j+R.x,this._globalMatrices[E+4]=_*x+y*T+m*A,this._globalMatrices[E+5]=_*w+y*P+m*O,this._globalMatrices[E+6]=_*v+y*C+m*M,this._globalMatrices[E+7]=_*D+y*S+m*j+R.y,this._globalMatrices[E+8]=g*x+f*T+b*A,this._globalMatrices[E+9]=g*w+f*P+b*O,this._globalMatrices[E+10]=g*v+f*C+b*M,this._globalMatrices[E+11]=g*D+f*S+b*j+R.z,E+=12},t.prototype.getRenderableSubGeometry=function(e,t){if(this._morphedSubGeometryDirty[t.id]=!0,!this._pAnimationSet.usesCPU)return t;var i;return(i=this._morphedSubGeometry[t.id])||(i=this._morphedSubGeometry[t.id]=t.clone(),i.autoDeriveNormals=!1,i.autoDeriveTangents=!1,i.autoDeriveUVs=!1,t.addEventListener(a.INDICES_UPDATED,this._onIndicesUpdateDelegate),t.addEventListener(a.VERTICES_UPDATED,this._onVerticesUpdateDelegate)),i},t.prototype.morphSubGeometry=function(e,t){this._morphedSubGeometryDirty[t.id]=!1;for(var i,r,a,s,o,n,l,h,p,d,c,u,_,y,m,g,f,b,x,w,v,D,T,P,C,S,A,O,M,j,N,I,R=t.positions,F=t.vertexNormals,E=t.vertexTangents,V=t.jointIndices,B=t.jointWeights,L=this._morphedSubGeometry[t.id],z=L.positions,k=L.vertexNormals,U=L.vertexTangents,G=0,X=0,H=R.length;H>G;){for(u=R[G],_=R[G+1],y=R[G+2],m=F[G],g=F[G+1],f=F[G+2],b=E[G],x=E[G+1],w=E[G+2],r=0,a=0,s=0,o=0,n=0,l=0,h=0,p=0,d=0,i=0;i<this._jointsPerVertex;)if(c=B[X],c>0){var W=V[X++]<<2;v=this._globalMatrices[W],D=this._globalMatrices[W+1],T=this._globalMatrices[W+2],P=this._globalMatrices[W+3],C=this._globalMatrices[W+4],S=this._globalMatrices[W+5],A=this._globalMatrices[W+6],O=this._globalMatrices[W+7],M=this._globalMatrices[W+8],j=this._globalMatrices[W+9],N=this._globalMatrices[W+10],I=this._globalMatrices[W+11],r+=c*(v*u+D*_+T*y+P),a+=c*(C*u+S*_+A*y+O),s+=c*(M*u+j*_+N*y+I),o+=c*(v*m+D*g+T*f),n+=c*(C*m+S*g+A*f),l+=c*(M*m+j*g+N*f),h+=c*(v*b+D*x+T*w),p+=c*(C*b+S*x+A*w),d+=c*(M*b+j*x+N*w),++i}else X+=this._jointsPerVertex-i,i=this._jointsPerVertex;z[G]=r,z[G+1]=a,z[G+2]=s,k[G]=o,k[G+1]=n,k[G+2]=l,U[G]=h,U[G+1]=p,U[G+2]=d,G+=3}L.updatePositions(z),L.updateVertexNormals(k),L.updateVertexTangents(U)},t.prototype.localToGlobalPose=function(e,t,i){var r,a,s,o,l,h,p,d,c,u,_,y,m,g,f,b,x,w,v,D,T=t.jointPoses,P=i.joints,C=e.numJointPoses,S=e.jointPoses;T.length!=C&&(T.length=C);for(var A=0;C>A;++A)r=T[A],null==r&&(r=T[A]=new n),s=P[A],a=s.parentIndex,l=S[A],c=r.orientation,d=r.translation,0>a?(p=l.translation,h=l.orientation,c.x=h.x,c.y=h.y,c.z=h.z,c.w=h.w,d.x=p.x,d.y=p.y,d.z=p.z):(o=T[a],h=o.orientation,p=l.translation,g=h.x,f=h.y,b=h.z,x=h.w,w=p.x,v=p.y,D=p.z,m=-g*w-f*v-b*D,u=x*w+f*D-b*v,_=x*v-g*D+b*w,y=x*D+g*v-f*w,p=o.translation,d.x=-m*g+u*x-_*b+y*f+p.x,d.y=-m*f+u*b+_*x-y*g+p.y,d.z=-m*b-u*f+_*g+y*x+p.z,u=h.x,_=h.y,y=h.z,m=h.w,h=l.orientation,g=h.x,f=h.y,b=h.z,x=h.w,c.w=m*x-u*g-_*f-y*b,c.x=m*g+u*x+_*b-y*f,c.y=m*f-u*b+_*x+y*g,c.z=m*b+u*f-_*g+y*x)},t.prototype.onTransitionComplete=function(e){e.type==h.TRANSITION_COMPLETE&&(e.animationNode.removeEventListener(h.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate),this._pActiveState==e.animationState&&(this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName),this._pActiveState=this.getAnimationState(this._pActiveNode),this._activeSkeletonState=this._pActiveState))},t.prototype.onIndicesUpdate=function(e){var t=e.target;this._morphedSubGeometry[t.id].updateIndices(t.indices)},t.prototype.onVerticesUpdate=function(e){var t=e.target,i=this._morphedSubGeometry[t.id];switch(e.dataType){case r.UV_DATA:i.updateUVs(t.uvs);case r.SECONDARY_UV_DATA:i.updateUVs(t.secondaryUVs)}},t}(s);t.exports=p},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/events/SubGeometryEvent":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0,"awayjs-stagegl/lib/animators/AnimatorBase":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0}],"awayjs-renderergl/lib/animators/VertexAnimationSet":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/animators/AnimationSetBase"),a=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode"),s=function(e){function t(t,i){void 0===t&&(t=2),void 0===i&&(i="absolute"),e.call(this),this._numPoses=t,this._blendMode=i}return i(t,e),Object.defineProperty(t.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(e){return this._blendMode==a.ABSOLUTE?this.getAbsoluteAGALCode(e):this.getAdditiveAGALCode(e)},t.prototype.activate=function(){},t.prototype.deactivate=function(){},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(e){return"mov "+e.uvTarget+","+e.uvSource+"\n"},t.prototype.doneAGALCode=function(){},t.prototype.getAbsoluteAGALCode=function(e){var t="",i=this._pFindTempReg(e.animationTargetRegisters),r=this._pFindTempReg(e.animationTargetRegisters,i),a=new Array("x","y","z","w"),s=e.animatableAttributes.length,o="vc"+e.numUsedVertexConstants;s>2&&(s=2);for(var n=e.numUsedStreams,l=0;s>l;++l){t+="mul "+i+", "+e.animatableAttributes[l]+", "+o+"."+a[0]+"\n";for(var h=1;h<this._numPoses;++h)t+="mul "+r+", va"+n+", "+o+"."+a[h]+"\n",h<this._numPoses-1&&(t+="add "+i+", "+i+", "+r+"\n"),++n;t+="add "+e.animationTargetRegisters[l]+", "+i+", "+r+"\n"}return(e.tangentDependencies>0||e.outputsNormals)&&(t+="dp3 "+i+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\nmul "+i+", "+e.animationTargetRegisters[1]+", "+i+".x\nsub "+e.animationTargetRegisters[2]+", "+e.animationTargetRegisters[2]+", "+i+"\n"),t},t.prototype.getAdditiveAGALCode=function(e){var t,i="",r=e.animatableAttributes.length,a=["x","y","z","w"],s=this._pFindTempReg(e.animationTargetRegisters),o=e.numUsedStreams;r>2&&(r=2),i+="mov  "+e.animationTargetRegisters[0]+", "+e.animatableAttributes[0]+"\n",e.normalDependencies>0&&(i+="mov "+e.animationTargetRegisters[1]+", "+e.animatableAttributes[1]+"\n");for(var n=0;r>n;++n)for(var l=0;l<this._numPoses;++l)i+="mul "+s+", va"+(o+t)+", vc"+e.numUsedVertexConstants+"."+a[l]+"\nadd "+e.animationTargetRegisters[n]+", "+e.animationTargetRegisters[n]+", "+s+"\n",t++;return(e.tangentDependencies>0||e.outputsNormals)&&(i+="dp3 "+s+".x, "+e.animatableAttributes[2]+", "+e.animationTargetRegisters[1]+"\nmul "+s+", "+e.animationTargetRegisters[1]+", "+s+".x\nsub "+e.animationTargetRegisters[2]+", "+e.animatableAttributes[2]+", "+s+"\n"),i},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/data/VertexAnimationMode":void 0,"awayjs-stagegl/lib/animators/AnimationSetBase":void 0}],"awayjs-renderergl/lib/animators/VertexAnimator":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/TriangleSubGeometry"),a=e("awayjs-stagegl/lib/animators/AnimatorBase"),s=e("awayjs-stagegl/lib/pool/VertexDataPool"),o=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-renderergl/lib/animators/data/VertexAnimationMode"),l=function(e){function t(t){e.call(this,t),this._poses=new Array,this._weights=Array(1,0,0,0),this._vertexAnimationSet=t,this._numPoses=t.numPoses,this._blendMode=t.blendMode}return i(t,e),t.prototype.clone=function(){return new t(this._vertexAnimationSet)},t.prototype.play=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=0/0),this._pActiveAnimationName!=e){if(this._pActiveAnimationName=e,!this._pAnimationSet.hasAnimation(e))throw new Error("Animation root node "+e+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(e),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeVertexState=this._pActiveState,this.start(),isNaN(i)||this.reset(e,i)}},t.prototype._pUpdateDeltaTime=function(t){e.prototype._pUpdateDeltaTime.call(this,t);var i=!1;if(this._poses[0]!=this._activeVertexState.currentGeometry&&(this._poses[0]=this._activeVertexState.currentGeometry,i=!0),this._poses[1]!=this._activeVertexState.nextGeometry&&(this._poses[1]=this._activeVertexState.nextGeometry,i=!0),this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight),i)for(var r,a=this._pOwners.length,s=0;a>s;s++)r=this._pOwners[s],r._iInvalidateRenderableGeometries()},t.prototype.setRenderState=function(e,t,i,a,l,h){if(!this._poses.length)return void this.setNullPose(e,t,i,l,h);var p,d,c=t.subMesh,u=this._numPoses;for(i.context.setProgramConstantsFromArray(o.VERTEX,l,this._weights,1),d=this._blendMode==n.ABSOLUTE?1:0;u>d;++d)p=this._poses[d].subGeometries[c._iIndex]||c.subGeometry,i.context.activateBuffer(h++,s.getItem(p,t.getIndexData(),r.POSITION_DATA),p.getOffset(r.POSITION_DATA),r.POSITION_FORMAT),e.normalDependencies>0&&i.context.activateBuffer(h++,s.getItem(p,t.getIndexData(),r.NORMAL_DATA),p.getOffset(r.NORMAL_DATA),r.NORMAL_FORMAT)},t.prototype.setNullPose=function(e,t,i,a,s){if(i.context.setProgramConstantsFromArray(o.VERTEX,a,this._weights,1),this._blendMode==n.ABSOLUTE)for(var l=this._numPoses,h=1;l>h;++h)i.context.activateBuffer(s++,t.getVertexData(r.POSITION_DATA),t.getVertexOffset(r.POSITION_DATA),r.POSITION_FORMAT),e.normalDependencies>0&&i.context.activateBuffer(s++,t.getVertexData(r.NORMAL_DATA),t.getVertexOffset(r.NORMAL_DATA),r.NORMAL_FORMAT)},t.prototype.testGPUCompatibility=function(){},t.prototype.getRenderableSubGeometry=function(e,t){return this._blendMode==n.ABSOLUTE&&this._poses.length?this._poses[0].subGeometries[e.subMesh._iIndex]||t:t},t}(a);t.exports=l},{"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/VertexAnimationMode":void 0,"awayjs-stagegl/lib/animators/AnimatorBase":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/pool/VertexDataPool":void 0}],"awayjs-renderergl/lib/animators/data/AnimationSubGeometry":[function(e,t){var i=function(){function e(){this._pVertexBuffer=new Array(8),this._pBufferContext=new Array(8),this._pBufferDirty=new Array(8),this.numProcessedVertices=0,this.previousTime=Number.NEGATIVE_INFINITY,this.animationParticles=new Array;for(var t=0;8>t;t++)this._pBufferDirty[t]=!0;this._iUniqueId=e.SUBGEOM_ID_COUNT++}return e.prototype.createVertexData=function(e,t){this._numVertices=e,this._totalLenOfOneVertex=t,this._pVertexData=new Array(e*t)},e.prototype.activateVertexBuffer=function(e,t,i,r){var a=i.stageIndex,s=i.context,o=this._pVertexBuffer[a];o&&this._pBufferContext[a]==s||(o=this._pVertexBuffer[a]=s.createVertexBuffer(this._numVertices,this._totalLenOfOneVertex),this._pBufferContext[a]=s,this._pBufferDirty[a]=!0),this._pBufferDirty[a]&&(o.uploadFromArray(this._pVertexData,0,this._numVertices),this._pBufferDirty[a]=!1),s.setVertexBufferAt(e,o,t,r)},e.prototype.dispose=function(){for(;this._pVertexBuffer.length;){var e=this._pVertexBuffer.pop();e&&e.dispose()}},e.prototype.invalidateBuffer=function(){for(var e=0;8>e;e++)this._pBufferDirty[e]=!0},Object.defineProperty(e.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:!0,configurable:!0}),e.SUBGEOM_ID_COUNT=0,e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ColorSegmentPoint":[function(e,t){var i=function(){function e(e,t){if(0>=e||e>=1)throw new Error("life exceeds range (0,1)");this._life=e,this._color=t}return Object.defineProperty(e.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"life",{get:function(){return this._life},enumerable:!0,configurable:!0}),e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/JointPose":[function(e,t){var i=e("awayjs-core/lib/geom/Matrix3D"),r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-core/lib/geom/Vector3D"),s=function(){function e(){this.orientation=new r,this.translation=new a}return e.prototype.toMatrix3D=function(e){return void 0===e&&(e=null),null==e&&(e=new i),this.orientation.toMatrix3D(e),e.appendTranslation(this.translation.x,this.translation.y,this.translation.z),e},e.prototype.copyFrom=function(e){var t=e.orientation,i=e.translation;this.orientation.x=t.x,this.orientation.y=t.y,this.orientation.z=t.z,this.orientation.w=t.w,this.translation.x=i.x,this.translation.y=i.y,this.translation.z=i.z},e}();t.exports=s},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0}],"awayjs-renderergl/lib/animators/data/ParticleAnimationData":[function(e,t){var i=function(){function e(e,t,i,r,a){this.index=e,this.startTime=t,this.totalTime=i+r,this.duration=i,this.delay=r,this.startVertexIndex=a.startVertexIndex,this.numVertices=a.numVertices}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticleData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":[function(e,t){var i=function(){function e(){}return e.GLOBAL=0,e.LOCAL_STATIC=1,e.LOCAL_DYNAMIC=2,e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/ParticleProperties":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonJoint":[function(e,t){var i=function(){function e(){this.parentIndex=-1}return e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/data/SkeletonPose":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=e("awayjs-renderergl/lib/animators/data/JointPose"),o=function(e){function t(){e.call(this),this.jointPoses=new Array}return i(t,e),Object.defineProperty(t.prototype,"numJointPoses",{get:function(){return this.jointPoses.length
},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assetType",{get:function(){return r.SKELETON_POSE},enumerable:!0,configurable:!0}),t.prototype.jointPoseFromName=function(e){var t=this.jointPoseIndexFromName(e);return-1!=t?this.jointPoses[t]:null},t.prototype.jointPoseIndexFromName=function(e){for(var t,i,r;r<this.jointPoses.length;r++){if(i=this.jointPoses[r],i.name==e)return t;t++}return-1},t.prototype.clone=function(){for(var e=new t,i=this.jointPoses.length,r=0;i>r;r++){var a=new s,o=this.jointPoses[r];a.name=o.name,a.copyFrom(o),e.jointPoses[r]=a}return e},t.prototype.dispose=function(){this.jointPoses.length=0},t}(a);t.exports=o},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0}],"awayjs-renderergl/lib/animators/data/Skeleton":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/library/NamedAssetBase"),s=function(e){function t(){e.call(this),this.joints=new Array}return i(t,e),Object.defineProperty(t.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),t.prototype.jointFromName=function(e){var t=this.jointIndexFromName(e);return-1!=t?this.joints[t]:null},t.prototype.jointIndexFromName=function(e){for(var t,i,r;r<this.joints.length;r++){if(i=this.joints[r],i.name==e)return t;t++}return-1},t.prototype.dispose=function(){this.joints.length=0},Object.defineProperty(t.prototype,"assetType",{get:function(){return r.SKELETON},enumerable:!0,configurable:!0}),t}(a);t.exports=s},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/library/NamedAssetBase":void 0}],"awayjs-renderergl/lib/animators/data/VertexAnimationMode":[function(e,t){var i=function(){function e(){}return e.ADDITIVE="additive",e.ABSOLUTE="absolute",e}();t.exports=i},{}],"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),s=function(e){function t(){e.call(this),this._pLooping=!0,this._pTotalDuration=0,this._pStitchDirty=!0,this._pStitchFinalFrame=!1,this._pNumFrames=0,this._pDurations=new Array,this._pTotalDelta=new r,this.fixedFrameRate=!0}return i(t,e),Object.defineProperty(t.prototype,"looping",{get:function(){return this._pLooping},set:function(e){this._pLooping!=e&&(this._pLooping=e,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(e){this._pStitchFinalFrame!=e&&(this._pStitchFinalFrame=e,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalDuration",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDuration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalDelta",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDelta},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastFrame",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pLastFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durations",{get:function(){return this._pDurations},enumerable:!0,configurable:!0}),t.prototype._pUpdateStitch=function(){this._pStitchDirty=!1,this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1,this._pTotalDuration=0,this._pTotalDelta.x=0,this._pTotalDelta.y=0,this._pTotalDelta.z=0},t}(a);t.exports=s},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleAccelerationNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleAccelerationState"),n=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleAcceleration",t,3),this._pStateClass=o,this._acceleration=i||new r}return i(t,e),t.prototype.pGetAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.ACCELERATION_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var s="mul "+r+","+t.vertexTime+","+i+"\n";if(t.needVelocity){var n=t.getFreeVertexVectorTemp();s+="mul "+n+","+r+","+t.vertexTwoConst+"\n",s+="add "+t.velocityTarget+".xyz,"+n+".xyz,"+t.velocityTarget+".xyz\n"}return t.removeVertexTempUsage(r),s+="mul "+r+","+r+","+t.vertexTime+"\n",s+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ACCELERATION_VECTOR3D];if(!i)throw new Error("there is no "+t.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=i.x/2,this._pOneData[1]=i.y/2,this._pOneData[2]=i.z/2},t.ACCELERATION_VECTOR3D="AccelerationVector3D",t}(s);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleBezierCurveNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleBezierCurveState"),l=function(e){function t(t,i,a){void 0===i&&(i=null),void 0===a&&(a=null),e.call(this,"ParticleBezierCurve",t,6),this._pStateClass=n,this._iControlPoint=i||new r,this._iEndPoint=a||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.BEZIER_CONTROL_INDEX,i.index);var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.BEZIER_END_INDEX,r.index);var o=t.getFreeVertexVectorTemp(),l=new a(o.regName,o.index,0),h=new a(o.regName,o.index,1),p=new a(o.regName,o.index,2);t.addVertexTempUsages(o,1);var d=t.getFreeVertexVectorTemp(),c=new a(d.regName,d.index);t.removeVertexTempUsage(o);var u="";return u+="sub "+l+","+t.vertexOneConst+","+t.vertexLife+"\n",u+="mul "+h+","+t.vertexLife+","+t.vertexLife+"\n",u+="mul "+p+","+t.vertexLife+","+l+"\n",u+="mul "+p+","+p+","+t.vertexTwoConst+"\n",u+="mul "+c+".xyz,"+p+","+i+"\n",u+="add "+t.positionTarget+".xyz,"+c+".xyz,"+t.positionTarget+".xyz\n",u+="mul "+c+".xyz,"+h+","+r+"\n",u+="add "+t.positionTarget+".xyz,"+c+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(u+="mul "+h+","+t.vertexLife+","+t.vertexTwoConst+"\n",u+="sub "+p+","+t.vertexOneConst+","+h+"\n",u+="mul "+p+","+t.vertexTwoConst+","+p+"\n",u+="mul "+c+".xyz,"+i+","+p+"\n",u+="add "+t.velocityTarget+".xyz,"+c+".xyz,"+t.velocityTarget+".xyz\n",u+="mul "+c+".xyz,"+r+","+h+"\n",u+="add "+t.velocityTarget+".xyz,"+c+".xyz,"+t.velocityTarget+".xyz\n"),u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.BEZIER_CONTROL_VECTOR3D];if(!i)throw new Error("there is no "+t.BEZIER_CONTROL_VECTOR3D+" in param!");var r=e[t.BEZIER_END_VECTOR3D];if(!r)throw new Error("there is no "+t.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,this._pOneData[3]=r.x,this._pOneData[4]=r.y,this._pOneData[5]=r.z},t.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D",t.BEZIER_END_VECTOR3D="BezierEndVector3D",t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleBillboardNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleBillboardState"),o=function(e){function t(t){void 0===t&&(t=null),e.call(this,"ParticleBillboard",r.GLOBAL,0,4),this._pStateClass=s,this._iBillboardAxis=t}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexConstant();t.setRegisterIndex(this,s.MATRIX_INDEX,i.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant();for(var r,a=t.getFreeVertexVectorTemp(),o="m33 "+a+".xyz,"+t.scaleAndRotateTarget+","+i+"\nmov "+t.scaleAndRotateTarget+".xyz,"+a+"\n",n=0;n<t.rotationRegisters.length;n++)r=t.rotationRegisters[n],o+="m33 "+a+".xyz,"+r+","+i+"\nmov "+r+".xyz,"+r+"\n";return o},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.hasBillboard=!0},t}(a);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleBillboardState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleColorState"),l=function(e){function t(t,i,s,o,l,h,p,d,c){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===o&&(o=!1),void 0===l&&(l=!1),void 0===h&&(h=null),void 0===p&&(p=null),void 0===d&&(d=1),void 0===c&&(c=0),e.call(this,"ParticleColor",t,i&&s?16:8,a.COLOR_PRIORITY),this._pStateClass=n,this._iUsesMultiplier=i,this._iUsesOffset=s,this._iUsesCycle=o,this._iUsesPhase=l,this._iStartColor=h||new r,this._iEndColor=p||new r,this._iCycleDuration=d,this._iCyclePhase=c}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var r=t.getFreeVertexVectorTemp();if(this._iUsesCycle){var a=t.getFreeVertexConstant();t.setRegisterIndex(this,n.CYCLE_INDEX,a.index),t.addVertexTempUsages(r,1);var o=t.getFreeVertexSingleTemp();t.removeVertexTempUsage(r),i+="mul "+o+","+t.vertexTime+","+a+".x\n",this._iUsesPhase&&(i+="add "+o+","+o+","+a+".y\n"),i+="sin "+o+","+o+"\n"}if(this._iUsesMultiplier){var l=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute(),h=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.START_MULTIPLIER_INDEX,l.index),t.setRegisterIndex(this,n.DELTA_MULTIPLIER_INDEX,h.index),i+="mul "+r+","+h+","+(this._iUsesCycle?o:t.vertexLife)+"\n",i+="add "+r+","+r+","+l+"\n",i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var p=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant(),d=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,n.START_OFFSET_INDEX,p.index),t.setRegisterIndex(this,n.DELTA_OFFSET_INDEX,d.index),i+="mul "+r+","+d+","+(this._iUsesCycle?o:t.vertexLife)+"\n",i+="add "+r+","+r+","+p+"\n",i+="add "+t.colorAddTarget+","+r+","+t.colorAddTarget+"\n"}}return i},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_START_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_START_COLORTRANSFORM+" in param!");var r=e[t.COLOR_END_COLORTRANSFORM];if(!r)throw new Error("there is no "+t.COLOR_END_COLORTRANSFORM+" in param!");var a=0;this._iUsesCycle?(this._iUsesMultiplier&&(this._pOneData[a++]=(i.redMultiplier+r.redMultiplier)/2,this._pOneData[a++]=(i.greenMultiplier+r.greenMultiplier)/2,this._pOneData[a++]=(i.blueMultiplier+r.blueMultiplier)/2,this._pOneData[a++]=(i.alphaMultiplier+r.alphaMultiplier)/2,this._pOneData[a++]=(i.redMultiplier-r.redMultiplier)/2,this._pOneData[a++]=(i.greenMultiplier-r.greenMultiplier)/2,this._pOneData[a++]=(i.blueMultiplier-r.blueMultiplier)/2,this._pOneData[a++]=(i.alphaMultiplier-r.alphaMultiplier)/2),this._iUsesOffset&&(this._pOneData[a++]=(i.redOffset+r.redOffset)/510,this._pOneData[a++]=(i.greenOffset+r.greenOffset)/510,this._pOneData[a++]=(i.blueOffset+r.blueOffset)/510,this._pOneData[a++]=(i.alphaOffset+r.alphaOffset)/510,this._pOneData[a++]=(i.redOffset-r.redOffset)/510,this._pOneData[a++]=(i.greenOffset-r.greenOffset)/510,this._pOneData[a++]=(i.blueOffset-r.blueOffset)/510,this._pOneData[a++]=(i.alphaOffset-r.alphaOffset)/510)):(this._iUsesMultiplier&&(this._pOneData[a++]=i.redMultiplier,this._pOneData[a++]=i.greenMultiplier,this._pOneData[a++]=i.blueMultiplier,this._pOneData[a++]=i.alphaMultiplier,this._pOneData[a++]=r.redMultiplier-i.redMultiplier,this._pOneData[a++]=r.greenMultiplier-i.greenMultiplier,this._pOneData[a++]=r.blueMultiplier-i.blueMultiplier,this._pOneData[a++]=r.alphaMultiplier-i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[a++]=i.redOffset/255,this._pOneData[a++]=i.greenOffset/255,this._pOneData[a++]=i.blueOffset/255,this._pOneData[a++]=i.alphaOffset/255,this._pOneData[a++]=(r.redOffset-i.redOffset)/255,this._pOneData[a++]=(r.greenOffset-i.greenOffset)/255,this._pOneData[a++]=(r.blueOffset-i.blueOffset)/255,this._pOneData[a++]=(r.alphaOffset-i.alphaOffset)/255))},t.COLOR_START_COLORTRANSFORM="ColorStartColorTransform",t.COLOR_END_COLORTRANSFORM="ColorEndColorTransform",t}(o);t.exports=l},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleColorState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleFollowNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleFollowState"),n=function(e){function t(t,i,s){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===s&&(s=!1),e.call(this,"ParticleFollow",a.LOCAL_DYNAMIC,t&&i?6:3,r.POST_PRIORITY),this._pStateClass=o,this._iUsesPosition=t,this._iUsesRotation=i,this._iSmooth=s}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(this._iUsesRotation){var r=t.getFreeVertexAttribute();t.setRegisterIndex(this,o.FOLLOW_ROTATION_INDEX,r.index);var a=t.getFreeVertexVectorTemp();t.addVertexTempUsages(a,1);var s=t.getFreeVertexVectorTemp();t.addVertexTempUsages(s,1);var n,l=t.getFreeVertexVectorTemp();t.hasBillboard&&(t.addVertexTempUsages(l,1),n=t.getFreeVertexVectorTemp()),t.removeVertexTempUsage(a),t.removeVertexTempUsage(s),t.hasBillboard&&t.removeVertexTempUsage(l);var h,p=t.rotationRegisters.length;if(i+="mov "+a+","+t.vertexZeroConst+"\n",i+="mov "+a+".x,"+t.vertexOneConst+"\n",i+="mov "+l+","+t.vertexZeroConst+"\n",i+="sin "+l+".y,"+r+".x\n",i+="cos "+l+".z,"+r+".x\n",i+="mov "+s+".x,"+t.vertexZeroConst+"\n",i+="mov "+s+".y,"+l+".z\n",i+="neg "+s+".z,"+l+".y\n",t.hasBillboard)i+="m33 "+n+".xyz,"+t.positionTarget+".xyz,"+a+"\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",h=0;p>h;h++)i+="m33 "+t.rotationRegisters[h]+".xyz,"+t.rotationRegisters[h]+","+a+"\n";if(i+="mov "+a+","+t.vertexZeroConst+"\n",i+="cos "+a+".x,"+r+".y\n",i+="sin "+a+".z,"+r+".y\n",i+="mov "+s+","+t.vertexZeroConst+"\n",i+="mov "+s+".y,"+t.vertexOneConst+"\n",i+="mov "+l+","+t.vertexZeroConst+"\n",i+="neg "+l+".x,"+a+".z\n",i+="mov "+l+".z,"+a+".x\n",t.hasBillboard)i+="m33 "+n+".xyz,"+n+".xyz,"+a+"\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",h=0;p>h;h++)i+="m33 "+t.rotationRegisters[h]+".xyz,"+t.rotationRegisters[h]+","+a+"\n";if(i+="mov "+s+","+t.vertexZeroConst+"\n",i+="sin "+s+".x,"+r+".z\n",i+="cos "+s+".y,"+r+".z\n",i+="mov "+a+","+t.vertexZeroConst+"\n",i+="mov "+a+".x,"+s+".y\n",i+="neg "+a+".y,"+s+".x\n",i+="mov "+l+","+t.vertexZeroConst+"\n",i+="mov "+l+".z,"+t.vertexOneConst+"\n",t.hasBillboard)i+="m33 "+n+".xyz,"+n+".xyz,"+a+"\n",i+="sub "+n+".xyz,"+n+".xyz,"+t.positionTarget+".xyz\n",i+="add "+t.scaleAndRotateTarget+".xyz,"+n+".xyz,"+t.scaleAndRotateTarget+".xyz\n";else for(i+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n",h=0;p>h;h++)i+="m33 "+t.rotationRegisters[h]+".xyz,"+t.rotationRegisters[h]+","+a+"\n"}if(this._iUsesPosition){var d=t.getFreeVertexAttribute();t.setRegisterIndex(this,o.FOLLOW_POSITION_INDEX,d.index),i+="add "+t.scaleAndRotateTarget+".xyz,"+d+","+t.scaleAndRotateTarget+".xyz\n"}return i},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleFollowState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleInitialColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleInitialColorState"),l=function(e){function t(t,i,s,o){void 0===i&&(i=!0),void 0===s&&(s=!1),void 0===o&&(o=null),e.call(this,"ParticleInitialColor",t,i&&s?8:4,a.COLOR_PRIORITY),this._pStateClass=n,this._iUsesMultiplier=i,this._iUsesOffset=s,this._iInitialColor=o||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){if(this._iUsesMultiplier){var r=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.MULTIPLIER_INDEX,r.index),i+="mul "+t.colorMulTarget+","+r+","+t.colorMulTarget+"\n"}if(this._iUsesOffset){var a=this._pMode==s.LOCAL_STATIC?t.getFreeVertexAttribute():t.getFreeVertexConstant();t.setRegisterIndex(this,n.OFFSET_INDEX,a.index),i+="add "+t.colorAddTarget+","+a+","+t.colorAddTarget+"\n"}}return i},t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.COLOR_INITIAL_COLORTRANSFORM];if(!i)throw new Error("there is no "+t.COLOR_INITIAL_COLORTRANSFORM+" in param!");var r=0;this._iUsesMultiplier&&(this._pOneData[r++]=i.redMultiplier,this._pOneData[r++]=i.greenMultiplier,this._pOneData[r++]=i.blueMultiplier,this._pOneData[r++]=i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[r++]=i.redOffset/255,this._pOneData[r++]=i.greenOffset/255,this._pOneData[r++]=i.blueOffset/255,this._pOneData[r++]=i.alphaOffset/255)},t.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform",t}(o);t.exports=l},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=function(e){function t(i,r,a,s){void 0===s&&(s=1),e.call(this),this._pDataLength=3,i+=t.MODES[r],this.name=i,this._pMode=r,this._priority=s,this._pDataLength=a,this._pOneData=new Array(this._pDataLength)}return i(t,e),Object.defineProperty(t.prototype,"mode",{get:function(){return this._pMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oneData",{get:function(){return this._pOneData},enumerable:!0,configurable:!0}),t.prototype.getAGALVertexCode=function(){return""},t.prototype.getAGALFragmentCode=function(){return""},t.prototype.getAGALUVCode=function(){return""},t.prototype._iGeneratePropertyOfOneParticle=function(){},t.prototype._iProcessAnimationSetting=function(){},t.GLOBAL="Global",t.LOCAL_STATIC="LocalStatic",t.LOCAL_DYNAMIC="LocalDynamic",t.MODES={0:t.GLOBAL,1:t.LOCAL_STATIC,2:t.LOCAL_DYNAMIC},t}(r);t.exports=a},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleOrbitNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleOrbitState"),l=function(e){function t(t,i,a,s,o,l,h,p){void 0===i&&(i=!0),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=100),void 0===l&&(l=1),void 0===h&&(h=0),void 0===p&&(p=null);var d=3;s&&d++,e.call(this,"ParticleOrbit",t,d),this._pStateClass=n,this._iUsesEulers=i,this._iUsesCycle=a,this._iUsesPhase=s,this._iRadius=o,this._iCycleDuration=l,this._iCyclePhase=h,this._iEulers=p||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.ORBIT_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,n.EULERS_INDEX,r.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant();var o=t.getFreeVertexVectorTemp();t.addVertexTempUsages(o,1);var l=new a(o.regName,o.index),h=t.getFreeVertexVectorTemp(),p=new a(h.regName,h.index,0),d=new a(h.regName,h.index,1),c=new a(h.regName,h.index,2);t.removeVertexTempUsage(o);var u="";return this._iUsesCycle?(u+="mul "+c+","+t.vertexTime+","+i+".y\n",this._iUsesPhase&&(u+="add "+c+","+c+","+i+".w\n")):u+="mul "+c+","+t.vertexLife+","+i+".y\n",u+="cos "+p+","+c+"\n",u+="sin "+d+","+c+"\n",u+="mul "+l+".x,"+p+","+i+".x\n",u+="mul "+l+".y,"+d+","+i+".x\n",u+="mov "+l+".wz"+t.vertexZeroConst+"\n",this._iUsesEulers&&(u+="m44 "+l+","+l+","+r+"\n"),u+="add "+t.positionTarget+".xyz,"+l+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(u+="neg "+l+".x,"+d+"\n",u+="mov "+l+".y,"+p+"\n",u+="mov "+l+".zw,"+t.vertexZeroConst+"\n",this._iUsesEulers&&(u+="m44 "+l+","+l+","+r+"\n"),u+="mul "+l+","+l+","+i+".z\n",u+="div "+l+","+l+","+i+".y\n",this._iUsesCycle||(u+="div "+l+","+l+","+t.vertexLife+"\n"),u+="add "+t.velocityTarget+".xyz,"+t.velocityTarget+".xyz,"+l+".xyz\n"),u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ORBIT_VECTOR3D];if(!i)throw new Error("there is no "+t.ORBIT_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._iUsesCycle&&i.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=2*Math.PI/(this._iUsesCycle?i.y:1),this._pOneData[2]=i.x*Math.PI*2,this._iUsesPhase&&(this._pOneData[3]=i.z*Math.PI/180)},t.ORBIT_VECTOR3D="OrbitVector3D",t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleOrbitState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleOscillatorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleOscillatorState"),l=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleOscillator",t,4),this._pStateClass=n,this._iOscillator=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.OSCILLATOR_INDEX,i.index);var r=t.getFreeVertexVectorTemp(),o=new a(r.regName,r.index,0),l=new a(r.regName,r.index,1),h=new a(r.regName,r.index,2);t.addVertexTempUsages(r,1);var p=t.getFreeVertexVectorTemp(),d=new a(p.regName,p.index);t.removeVertexTempUsage(r);var c="";return c+="mul "+o+","+t.vertexTime+","+i+".w\n",c+="sin "+l+","+o+"\n",c+="mul "+d+".xyz,"+l+","+i+".xyz\n",c+="add "+t.positionTarget+".xyz,"+d+".xyz,"+t.positionTarget+".xyz\n",t.needVelocity&&(c+="cos "+h+","+o+"\n",c+="mul "+d+".xyz,"+h+","+i+".xyz\n",c+="add "+t.velocityTarget+".xyz,"+d+".xyz,"+t.velocityTarget+".xyz\n"),c},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.OSCILLATOR_VECTOR3D];if(!i)throw new Error("there is no "+t.OSCILLATOR_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=2*Math.PI/i.w},t.OSCILLATOR_VECTOR3D="OscillatorVector3D",t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticlePositionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticlePositionState"),n=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticlePosition",t,3),this._pStateClass=o,this._iPosition=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();return t.setRegisterIndex(this,o.POSITION_INDEX,i.index),"add "+t.positionTarget+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.POSITION_VECTOR3D="PositionVector3D",t}(s);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticlePositionState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToHeadingNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState"),n=function(e){function t(){e.call(this,"ParticleRotateToHeading",a.GLOBAL,0,3),this._pStateClass=o}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i,a="",s=t.rotationRegisters.length;if(t.hasBillboard){var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1);var l=t.getFreeVertexVectorTemp();t.addVertexTempUsages(l,1);var h=t.getFreeVertexVectorTemp(),p=t.getFreeVertexConstant();for(t.setRegisterIndex(this,o.MATRIX_INDEX,p.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.removeVertexTempUsage(n),t.removeVertexTempUsage(l),a+="m33 "+n+".xyz,"+t.velocityTarget+".xyz,"+p+"\n",a+="mov "+h+","+t.vertexZeroConst+"\n",a+="mov "+h+".xy,"+n+".xy\n",a+="nrm "+h+".xyz,"+h+".xyz\n",a+="mov "+l+","+t.vertexZeroConst+"\n",a+="mov "+l+".x,"+h+".y\n",a+="mov "+l+".y,"+h+".x\n",a+="mov "+n+","+t.vertexZeroConst+"\n",a+="mov "+n+".x,"+h+".x\n",a+="neg "+n+".y,"+h+".y\n",a+="mov "+h+","+t.vertexZeroConst+"\n",a+="mov "+h+".z,"+t.vertexOneConst+"\n",a+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+n+"\n",i=0;s>i;i++)a+="m33 "+t.rotationRegisters[i]+".xyz,"+t.rotationRegisters[i]+","+n+"\n"}else{var d=t.getFreeVertexVectorTemp();t.addVertexTempUsages(d,1);var c=t.getFreeVertexVectorTemp();t.addVertexTempUsages(c,1);var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var _=t.getFreeVertexVectorTemp(),y=new r(u.regName,u.index,3),m=new r(_.regName,_.index,3),g=new r(d.regName,d.index,3),f=m;for(t.removeVertexTempUsage(d),t.removeVertexTempUsage(c),t.removeVertexTempUsage(u),a+="mov "+c+".x,"+t.vertexOneConst+"\n",a+="mov "+c+".yz,"+t.vertexZeroConst+"\n",a+="nrm "+d+".xyz,"+t.velocityTarget+".xyz\n",a+="dp3 "+g+","+d+".xyz,"+c+".xyz\n",a+="crs "+d+".xyz,"+c+".xyz,"+d+".xyz\n",a+="nrm "+d+".xyz,"+d+".xyz\n",a+="dp3 "+u+".x,"+d+".xyz,"+d+".xyz\n",a+="sge "+u+".x,"+t.vertexZeroConst+","+u+".x\n",a+="add "+d+".z,"+u+".x,"+d+".z\n",a+="add "+f+","+g+","+t.vertexOneConst+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+y+","+f+"\n",a+="sub "+f+","+t.vertexOneConst+","+g+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+m+","+f+"\n",a+="mul "+u+".xyz,"+m+","+d+".xyz\n",a+="mul "+_+".xyz,"+m+","+d+".xyz\n",a+="neg "+_+".xyz,"+_+".xyz\n",a+="crs "+d+".xyz,"+u+".xyz,"+t.scaleAndRotateTarget+".xyz\n",a+="mul "+c+".xyz,"+y+","+t.scaleAndRotateTarget+".xyz\n",a+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",a+="dp3 "+c+".w,"+u+".xyz,"+t.scaleAndRotateTarget+".xyz\n",a+="neg "+d+".w,"+c+".w\n",a+="crs "+u+".xyz,"+d+".xyz,"+_+".xyz\n",a+="mul "+c+".xyzw,"+d+".xyzw,"+y+"\n",a+="add "+u+".xyz,"+u+".xyz,"+c+".xyz\n",a+="mul "+c+".xyz,"+d+".w,"+_+".xyz\n",a+="add "+t.scaleAndRotateTarget+".xyz,"+u+".xyz,"+c+".xyz\n",i=0;s>i;i++)a+="mov "+c+".x,"+t.vertexOneConst+"\n",a+="mov "+c+".yz,"+t.vertexZeroConst+"\n",a+="nrm "+d+".xyz,"+t.velocityTarget+".xyz\n",a+="dp3 "+g+","+d+".xyz,"+c+".xyz\n",a+="crs "+d+".xyz,"+c+".xyz,"+d+".xyz\n",a+="nrm "+d+".xyz,"+d+".xyz\n",a+="dp3 "+u+".x,"+d+".xyz,"+d+".xyz\n",a+="sge "+u+".x,"+t.vertexZeroConst+","+u+".x\n",a+="add "+d+".z,"+u+".x,"+d+".z\n",a+="add "+f+","+g+","+t.vertexOneConst+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+y+","+f+"\n",a+="sub "+f+","+t.vertexOneConst+","+g+"\n",a+="div "+f+","+f+","+t.vertexTwoConst+"\n",a+="sqt "+m+","+f+"\n",a+="mul "+u+".xyz,"+m+","+d+".xyz\n",a+="mul "+_+".xyz,"+m+","+d+".xyz\n",a+="neg "+_+".xyz,"+_+".xyz\n",a+="crs "+d+".xyz,"+u+".xyz,"+t.rotationRegisters[i]+".xyz\n",a+="mul "+c+".xyz,"+y+","+t.rotationRegisters[i]+".xyz\n",a+="add "+d+".xyz,"+d+".xyz,"+c+".xyz\n",a+="dp3 "+c+".w,"+u+".xyz,"+t.rotationRegisters[i]+".xyz\n",a+="neg "+d+".w,"+c+".w\n",a+="crs "+u+".xyz,"+d+".xyz,"+_+".xyz\n",a+="mul "+c+".xyzw,"+d+".xyzw,"+y+"\n",a+="add "+u+".xyz,"+u+".xyz,"+c+".xyz\n",a+="mul "+c+".xyz,"+d+".w,"+_+".xyz\n",a+="add "+t.rotationRegisters[i]+".xyz,"+u+".xyz,"+c+".xyz\n"
}return a},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.needVelocity=!0},t}(s);t.exports=n},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotateToPositionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState"),l=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleRotateToPosition",t,3,3),this._pStateClass=n,this._iPosition=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.POSITION_INDEX,i.index);var r,o="",l=t.rotationRegisters.length;if(t.hasBillboard){var h=t.getFreeVertexVectorTemp();t.addVertexTempUsages(h,1);var p=t.getFreeVertexVectorTemp();t.addVertexTempUsages(p,1);var d=t.getFreeVertexVectorTemp(),c=t.getFreeVertexConstant();for(t.setRegisterIndex(this,n.MATRIX_INDEX,c.index),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.removeVertexTempUsage(h),t.removeVertexTempUsage(p),o+="sub "+h+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",o+="m33 "+h+".xyz,"+h+".xyz,"+c+"\n",o+="mov "+d+","+t.vertexZeroConst+"\n",o+="mov "+d+".xy,"+h+".xy\n",o+="nrm "+d+".xyz,"+d+".xyz\n",o+="mov "+p+","+t.vertexZeroConst+"\n",o+="mov "+p+".x,"+d+".y\n",o+="mov "+p+".y,"+d+".x\n",o+="mov "+h+","+t.vertexZeroConst+"\n",o+="mov "+h+".x,"+d+".x\n",o+="neg "+h+".y,"+d+".y\n",o+="mov "+d+","+t.vertexZeroConst+"\n",o+="mov "+d+".z,"+t.vertexOneConst+"\n",o+="m33 "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+h+"\n",r=0;l>r;r++)o+="m33 "+t.rotationRegisters[r]+".xyz,"+t.rotationRegisters[r]+","+h+"\n"}else{var u=t.getFreeVertexVectorTemp();t.addVertexTempUsages(u,1);var _=t.getFreeVertexVectorTemp();t.addVertexTempUsages(_,1);var y=new a(_.regName,_.index,0),m=new a(_.regName,_.index,1),g=new a(_.regName,_.index,2),f=new a(_.regName,_.index,3),b=t.getFreeVertexVectorTemp();for(t.addVertexTempUsages(b,1),t.removeVertexTempUsage(u),t.removeVertexTempUsage(_),t.removeVertexTempUsage(b),o+="sub "+u+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",o+="nrm "+u+".xyz,"+u+".xyz\n",o+="mov "+m+","+u+".y\n",o+="mul "+y+","+m+","+m+"\n",o+="sub "+y+","+t.vertexOneConst+","+y+"\n",o+="sqt "+y+","+y+"\n",o+="mul "+b+".x,"+y+","+t.scaleAndRotateTarget+".y\n",o+="mul "+b+".y,"+m+","+t.scaleAndRotateTarget+".z\n",o+="mul "+b+".z,"+m+","+t.scaleAndRotateTarget+".y\n",o+="mul "+b+".w,"+y+","+t.scaleAndRotateTarget+".z\n",o+="sub "+t.scaleAndRotateTarget+".y,"+b+".x,"+b+".y\n",o+="add "+t.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",o+="abs "+b+".y,"+u+".y\n",o+="sge "+b+".z,"+b+".y,"+t.vertexOneConst+"\n",o+="mul "+b+".x,"+b+".y,"+u+".y\n",o+="mov "+u+".y,"+t.vertexZeroConst+"\n",o+="dp3 "+m+","+u+".xyz,"+u+".xyz\n",o+="sge "+f+","+t.vertexZeroConst+","+m+"\n",o+="mov "+u+".y,"+t.vertexZeroConst+"\n",o+="nrm "+u+".xyz,"+u+".xyz\n",o+="sub "+m+","+t.vertexOneConst+","+f+"\n",o+="mul "+m+","+m+","+u+".x\n",o+="mov "+y+","+u+".z\n",o+="neg "+y+","+y+"\n",o+="sub "+g+","+t.vertexOneConst+","+y+"\n",o+="mul "+g+","+b+".x,"+f+"\n",o+="add "+y+","+y+","+g+"\n",o+="mul "+b+".x,"+y+","+t.scaleAndRotateTarget+".x\n",o+="mul "+b+".y,"+m+","+t.scaleAndRotateTarget+".z\n",o+="mul "+b+".z,"+m+","+t.scaleAndRotateTarget+".x\n",o+="mul "+b+".w,"+y+","+t.scaleAndRotateTarget+".z\n",o+="sub "+t.scaleAndRotateTarget+".x,"+b+".x,"+b+".y\n",o+="add "+t.scaleAndRotateTarget+".z,"+b+".z,"+b+".w\n",r=0;l>r;r++)o+="sub "+u+".xyz,"+i+".xyz,"+t.positionTarget+".xyz\n",o+="nrm "+u+".xyz,"+u+".xyz\n",o+="mov "+m+","+u+".y\n",o+="mul "+y+","+m+","+m+"\n",o+="sub "+y+","+t.vertexOneConst+","+y+"\n",o+="sqt "+y+","+y+"\n",o+="mul "+b+".x,"+y+","+t.rotationRegisters[r]+".y\n",o+="mul "+b+".y,"+m+","+t.rotationRegisters[r]+".z\n",o+="mul "+b+".z,"+m+","+t.rotationRegisters[r]+".y\n",o+="mul "+b+".w,"+y+","+t.rotationRegisters[r]+".z\n",o+="sub "+t.rotationRegisters[r]+".y,"+b+".x,"+b+".y\n",o+="add "+t.rotationRegisters[r]+".z,"+b+".z,"+b+".w\n",o+="abs "+b+".y,"+u+".y\n",o+="sge "+b+".z,"+b+".y,"+t.vertexOneConst+"\n",o+="mul "+b+".x,"+b+".y,"+u+".y\n",o+="mov "+u+".y,"+t.vertexZeroConst+"\n",o+="dp3 "+m+","+u+".xyz,"+u+".xyz\n",o+="sge "+f+","+t.vertexZeroConst+","+m+"\n",o+="mov "+u+".y,"+t.vertexZeroConst+"\n",o+="nrm "+u+".xyz,"+u+".xyz\n",o+="sub "+m+","+t.vertexOneConst+","+f+"\n",o+="mul "+m+","+m+","+u+".x\n",o+="mov "+y+","+u+".z\n",o+="neg "+y+","+y+"\n",o+="sub "+g+","+t.vertexOneConst+","+y+"\n",o+="mul "+g+","+b+".x,"+f+"\n",o+="add "+y+","+y+","+g+"\n",o+="mul "+b+".x,"+y+","+t.rotationRegisters[r]+".x\n",o+="mul "+b+".y,"+m+","+t.rotationRegisters[r]+".z\n",o+="mul "+b+".z,"+m+","+t.rotationRegisters[r]+".x\n",o+="mul "+b+".w,"+y+","+t.rotationRegisters[r]+".z\n",o+="sub "+t.rotationRegisters[r]+".x,"+b+".x,"+b+".y\n",o+="add "+t.rotationRegisters[r]+".z,"+b+".z,"+b+".w\n"}return o},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+t.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.POSITION_VECTOR3D="RotateToPositionVector3D",t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleRotationalVelocityNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState"),l=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleRotationalVelocity",t,4),this._pStateClass=n,this._iRotationalVelocity=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.ROTATIONALVELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp();t.addVertexTempUsages(r,1);var o=t.getFreeVertexVectorTemp();t.addVertexTempUsages(o,1);var l=t.getFreeVertexVectorTemp();t.addVertexTempUsages(l,1);var h=new a(l.regName,l.index),p=t.getFreeVertexVectorTemp();p=new a(p.regName,p.index);var d=new a(h.regName,h.index,3),c=new a(p.regName,p.index,3);t.removeVertexTempUsage(r),t.removeVertexTempUsage(o),t.removeVertexTempUsage(l);var u="";u+="mov "+r+".xyz,"+i+".xyz\n",u+="mov "+r+".w,"+t.vertexZeroConst+"\n",u+="mul "+d+","+t.vertexTime+","+i+".w\n",u+="sin "+c+","+d+"\n",u+="cos "+d+","+d+"\n",u+="mul "+h+".xyz,"+c+","+r+".xyz\n",u+="mul "+p+".xyz,"+c+","+r+".xyz\n",u+="neg "+p+".xyz,"+p+".xyz\n",u+="crs "+r+".xyz,"+h+".xyz,"+t.scaleAndRotateTarget+".xyz\n",u+="mul "+o+".xyz,"+d+","+t.scaleAndRotateTarget+".xyz\n",u+="add "+r+".xyz,"+r+".xyz,"+o+".xyz\n",u+="dp3 "+o+".w,"+h+".xyz,"+t.scaleAndRotateTarget+".xyz\n",u+="neg "+r+".w,"+o+".w\n",u+="crs "+h+".xyz,"+r+".xyz,"+p+".xyz\n",u+="mul "+o+".xyzw,"+r+".xyzw,"+d+"\n",u+="add "+h+".xyz,"+h+".xyz,"+o+".xyz\n",u+="mul "+o+".xyz,"+r+".w,"+p+".xyz\n",u+="add "+t.scaleAndRotateTarget+".xyz,"+h+".xyz,"+o+".xyz\n";for(var _=t.rotationRegisters.length,y=0;_>y;y++)u+="mov "+r+".xyz,"+i+".xyz\n",u+="mov "+r+".w,"+t.vertexZeroConst+"\n",u+="mul "+d+","+t.vertexTime+","+i+".w\n",u+="sin "+c+","+d+"\n",u+="cos "+d+","+d+"\n",u+="mul "+h+".xyz,"+c+","+r+".xyz\n",u+="mul "+p+".xyz,"+c+","+r+".xyz\n",u+="neg "+p+".xyz,"+p+".xyz\n",u+="crs "+r+".xyz,"+h+".xyz,"+t.rotationRegisters[y]+".xyz\n",u+="mul "+o+".xyz,"+d+","+t.rotationRegisters[y]+"\n",u+="add "+r+".xyz,"+r+".xyz,"+o+".xyz\n",u+="dp3 "+o+".w,"+h+".xyz,"+t.rotationRegisters[y]+"\n",u+="neg "+r+".w,"+o+".w\n",u+="crs "+h+".xyz,"+r+".xyz,"+p+".xyz\n",u+="mul "+o+".xyzw,"+r+".xyzw,"+d+"\n",u+="add "+h+".xyz,"+h+".xyz,"+o+".xyz\n",u+="mul "+o+".xyz,"+r+".w,"+p+".xyz\n",u+="add "+t.rotationRegisters[y]+","+h+".xyz,"+o+".xyz\n";return u},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.ROTATIONALVELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(i.length<=0?i.z=1:i.normalize(),this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/i.w},t.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D",t}(o);t.exports=l},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleScaleNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleScaleState"),o=function(e){function t(t,i,r,a,o,n,l){void 0===a&&(a=1),void 0===o&&(o=1),void 0===n&&(n=1),void 0===l&&(l=0),e.call(this,"ParticleScale",t,i&&r?4:i||r?3:2,3),this._pStateClass=s,this._iUsesCycle=i,this._iUsesPhase=r,this._iMinScale=a,this._iMaxScale=o,this._iCycleDuration=n,this._iCyclePhase=l}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i="",a=t.getFreeVertexSingleTemp(),o=this._pMode==r.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();return t.setRegisterIndex(this,s.SCALE_INDEX,o.index),this._iUsesCycle&&(i+="mul "+a+","+t.vertexTime+","+o+".z\n",this._iUsesPhase&&(i+="add "+a+","+a+","+o+".w\n"),i+="sin "+a+","+a+"\n"),i+="mul "+a+","+o+".y,"+(this._iUsesCycle?a:t.vertexLife)+"\n",i+="add "+a+","+o+".x,"+a+"\n",i+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+a+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.SCALE_VECTOR3D];if(!i)throw new Error("there is no "+t.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){if(this._pOneData[0]=(i.x+i.y)/2,this._pOneData[1]=Math.abs(i.x-i.y)/2,i.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=2*Math.PI/i.z,this._iUsesPhase&&(this._pOneData[3]=i.w*Math.PI/180)}else this._pOneData[0]=i.x,this._pOneData[1]=i.y-i.x},t.SCALE_VECTOR3D="ScaleVector3D",t}(a);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleScaleState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleSegmentedColorNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState"),l=function(e){function t(t,i,r,o,l,h){if(e.call(this,"ParticleSegmentedColor",s.GLOBAL,0,a.COLOR_PRIORITY),this._pStateClass=n,r>4)throw new Error("the numSegmentPoint must be less or equal 4");this._iUsesMultiplier=t,this._iUsesOffset=i,this._iNumSegmentPoint=r,this._iStartColor=o,this._iEndColor=l,this._iSegmentPoints=h}return i(t,e),t.prototype._iProcessAnimationSetting=function(e){this._iUsesMultiplier&&(e.hasColorMulNode=!0),this._iUsesOffset&&(e.hasColorAddNode=!0)},t.prototype.getAGALVertexCode=function(e,t){var i="";if(t.needFragmentAnimation){var a;this._iUsesMultiplier&&(a=t.getFreeVertexVectorTemp(),t.addVertexTempUsages(a,1));var s=t.getFreeVertexVectorTemp();t.addVertexTempUsages(s,1);var o=t.getFreeVertexVectorTemp(),l=new r(o.regName,o.index,0),h=new r(o.regName,o.index,1);this._iUsesMultiplier&&t.removeVertexTempUsage(a),t.removeVertexTempUsage(s);var p=t.getFreeVertexConstant();t.setRegisterIndex(this,n.TIME_DATA_INDEX,p.index);var d,c,u;if(this._iUsesMultiplier)for(c=t.getFreeVertexConstant(),t.setRegisterIndex(this,n.START_MULTIPLIER_INDEX,c.index),u=new Array,d=0;d<this._iNumSegmentPoint+1;d++)u.push(t.getFreeVertexConstant());var _,y;if(this._iUsesOffset)for(_=t.getFreeVertexConstant(),t.setRegisterIndex(this,n.START_OFFSET_INDEX,_.index),y=new Array,d=0;d<this._iNumSegmentPoint+1;d++)y.push(t.getFreeVertexConstant());for(this._iUsesMultiplier&&(i+="mov "+a+","+c+"\n"),this._iUsesOffset&&(i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+_+"\n"),d=0;d<this._iNumSegmentPoint;d++){switch(d){case 0:i+="min "+h+","+t.vertexLife+","+p+".x\n";break;case 1:i+="sub "+l+","+t.vertexLife+","+p+".x\n",i+="max "+h+","+l+","+t.vertexZeroConst+"\n",i+="min "+h+","+h+","+p+".y\n";break;case 2:i+="sub "+l+","+l+","+p+".y\n",i+="max "+h+","+l+","+t.vertexZeroConst+"\n",i+="min "+h+","+h+","+p+".z\n";break;case 3:i+="sub "+l+","+l+","+p+".z\n",i+="max "+h+","+l+","+t.vertexZeroConst+"\n",i+="min "+h+","+h+","+p+".w\n"}this._iUsesMultiplier&&(i+="mul "+s+","+h+","+u[d]+"\n",i+="add "+a+","+a+","+s+"\n"),this._iUsesOffset&&(i+="mul "+s+","+h+","+y[d]+"\n",i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+s+"\n")}if(0==this._iNumSegmentPoint)h=t.vertexLife;else{switch(this._iNumSegmentPoint){case 1:i+="sub "+l+","+t.vertexLife+","+p+".x\n";break;case 2:i+="sub "+l+","+l+","+p+".y\n";break;case 3:i+="sub "+l+","+l+","+p+".z\n";break;case 4:i+="sub "+l+","+l+","+p+".w\n"}i+="max "+h+","+l+","+t.vertexZeroConst+"\n"}this._iUsesMultiplier&&(i+="mul "+s+","+h+","+u[this._iNumSegmentPoint]+"\n",i+="add "+a+","+a+","+s+"\n",i+="mul "+t.colorMulTarget+","+t.colorMulTarget+","+a+"\n"),this._iUsesOffset&&(i+="mul "+s+","+h+","+y[this._iNumSegmentPoint]+"\n",i+="add "+t.colorAddTarget+","+t.colorAddTarget+","+s+"\n")}return i},t}(o);t.exports=l},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleSpriteSheetNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),a=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),n=e("awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState"),l=function(e){function t(t,i,r,s,o,l,h,p){void 0===s&&(s=1),void 0===o&&(o=1),void 0===l&&(l=1),void 0===h&&(h=0),void 0===p&&(p=Number.MAX_VALUE),e.call(this,"ParticleSpriteSheet",t,i?r?3:2:1,a.POST_PRIORITY+1),this._pStateClass=n,this._iUsesCycle=i,this._iUsesPhase=r,this._iNumColumns=s,this._iNumRows=o,this._iCyclePhase=h,this._iCycleDuration=l,this._iTotalFrames=Math.min(p,s*o)}return i(t,e),Object.defineProperty(t.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFrames",{get:function(){return this._iTotalFrames},enumerable:!0,configurable:!0}),t.prototype.getAGALUVCode=function(e,t){var i=t.getFreeVertexConstant(),a=this._pMode==s.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,n.UV_INDEX_0,i.index),t.setRegisterIndex(this,n.UV_INDEX_1,a.index);var o=new r(i.regName,i.index,0),l=new r(i.regName,i.index,1),h=new r(i.regName,i.index,2),p=new r(a.regName,a.index,0),d=new r(a.regName,a.index,1),c=new r(a.regName,a.index,2),u=t.getFreeVertexVectorTemp(),_=new r(u.regName,u.index,0),y=new r(u.regName,u.index,1);u=new r(u.regName,u.index,2);var m=new r(u.regName,u.index,3),g=new r(t.uvTarget.regName,t.uvTarget.index,0),f=new r(t.uvTarget.regName,t.uvTarget.index,1),b="";return b+="mul "+g+","+g+","+l+"\n",this._iNumRows>1&&(b+="mul "+f+","+f+","+h+"\n"),this._iUsesCycle?(b+=this._iUsesPhase?"add "+_+","+t.vertexTime+","+c+"\n":"mov "+_+","+t.vertexTime+"\n",b+="div "+_+","+_+","+d+"\n",b+="frc "+_+","+_+"\n",b+="mul "+_+","+_+","+d+"\n",b+="mul "+u+","+_+","+p+"\n"):b+="mul "+u.toString()+","+t.vertexLife+","+o+"\n",this._iNumRows>1&&(b+="frc "+m+","+u+"\n",b+="sub "+y+","+u+","+m+"\n",b+="mul "+y+","+y+","+h+"\n",b+="add "+f+","+f+","+y+"\n"),b+="div "+m+","+u+","+l+"\n",b+="frc "+u+","+m+"\n",b+="sub "+m+","+m+","+u+"\n",b+="mul "+u+","+m+","+l+"\n",this._iNumRows>1&&(b+="frc "+u+","+u+"\n"),b+="add "+g+","+g+","+u+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=!0},t.prototype._iGeneratePropertyOfOneParticle=function(e){if(this._iUsesCycle){var i=e[t.UV_VECTOR3D];if(!i)throw new Error("there is no "+t.UV_VECTOR3D+" in param!");if(i.x<=0)throw new Error("the cycle duration must be greater than zero");var r=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=r/i.x,this._pOneData[1]=i.x,this._iUsesPhase&&(this._pOneData[2]=i.y)}},t.UV_VECTOR3D="UVVector3D",t}(o);t.exports=l},{"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleTimeNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),a=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),s=e("awayjs-renderergl/lib/animators/states/ParticleTimeState"),o=function(e){function t(t,i,a){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),this._pStateClass=s,this._iUsesDuration=t,this._iUsesLooping=i,this._iUsesDelay=a,e.call(this,"ParticleTime",r.LOCAL_STATIC,4,0)}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=t.getFreeVertexAttribute();t.setRegisterIndex(this,s.TIME_STREAM_INDEX,i.index);var r=t.getFreeVertexConstant();t.setRegisterIndex(this,s.TIME_CONSTANT_INDEX,r.index);var a="";a+="sub "+t.vertexTime+","+r+","+i+".x\n";var o=t.getFreeVertexSingleTemp();if(a+="sge "+o+","+t.vertexTime+","+t.vertexZeroConst+"\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+o+"\n",this._iUsesDuration)if(this._iUsesLooping){var n=t.getFreeVertexSingleTemp();this._iUsesDelay?(a+="div "+n+","+t.vertexTime+","+i+".z\n",a+="frc "+n+","+n+"\n",a+="mul "+t.vertexTime+","+n+","+i+".z\n",a+="slt "+n+","+t.vertexTime+","+i+".y\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+n+"\n"):(a+="mul "+n+","+t.vertexTime+","+i+".w\n",a+="frc "+n+","+n+"\n",a+="mul "+t.vertexTime+","+n+","+i+".y\n")}else{var l=t.getFreeVertexSingleTemp();a+="sge "+l+","+i+".y,"+t.vertexTime+"\n",a+="mul "+t.scaleAndRotateTarget+".xyz,"+t.scaleAndRotateTarget+".xyz,"+l+"\n"}return a+="mul "+t.vertexLife+","+t.vertexTime+","+i+".w\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){this._pOneData[0]=e.startTime,this._pOneData[1]=e.duration,this._pOneData[2]=e.delay+e.duration,this._pOneData[3]=1/e.duration},t}(a);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleTimeState":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleUVNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement"),s=e("awayjs-renderergl/lib/animators/ParticleAnimationSet"),o=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),l=e("awayjs-renderergl/lib/animators/states/ParticleUVState"),h=function(e){function t(t,i,r,a){void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a="x"),e.call(this,"ParticleUV",o.GLOBAL,4,s.POST_PRIORITY+1),this._pStateClass=l,this._cycle=i,this._scale=r,this._axis=a,this.updateUVData()}return i(t,e),Object.defineProperty(t.prototype,"cycle",{get:function(){return this._cycle},set:function(e){this._cycle=e,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"axis",{get:function(){return this._axis},set:function(e){this._axis=e},enumerable:!0,configurable:!0}),t.prototype.getAGALUVCode=function(e,t){var i="",r=t.getFreeVertexConstant();t.setRegisterIndex(this,l.UV_INDEX,r.index);var s="x"==this._axis?0:"y"==this._axis?1:2,o=new a(t.uvTarget.regName,t.uvTarget.index,s),n=t.getFreeVertexSingleTemp();return 1!=this._scale&&(i+="mul "+o+","+o+","+r+".y\n"),i+="mul "+n+","+t.vertexTime+","+r+".x\n",i+="sin "+n+","+n+"\n",i+="add "+o+","+o+","+n+"\n"},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype.updateUVData=function(){this._iUvData=new r(2*Math.PI/this._cycle,this._scale,0,0)},t.prototype._iProcessAnimationSetting=function(e){e.hasUVNode=!0},t.U_AXIS="x",t.V_AXIS="y",t}(n);t.exports=h},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/ParticleAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleUVState":void 0,"awayjs-stagegl/lib/materials/compilation/ShaderRegisterElement":void 0}],"awayjs-renderergl/lib/animators/nodes/ParticleVelocityNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/nodes/ParticleNodeBase"),o=e("awayjs-renderergl/lib/animators/states/ParticleVelocityState"),n=function(e){function t(t,i){void 0===i&&(i=null),e.call(this,"ParticleVelocity",t,3),this._pStateClass=o,this._iVelocity=i||new r}return i(t,e),t.prototype.getAGALVertexCode=function(e,t){var i=this._pMode==a.GLOBAL?t.getFreeVertexConstant():t.getFreeVertexAttribute();t.setRegisterIndex(this,o.VELOCITY_INDEX,i.index);var r=t.getFreeVertexVectorTemp(),s="";return s+="mul "+r+","+t.vertexTime+","+i+"\n",s+="add "+t.positionTarget+".xyz,"+r+","+t.positionTarget+".xyz\n",t.needVelocity&&(s+="add "+t.velocityTarget+".xyz,"+i+".xyz,"+t.velocityTarget+".xyz\n"),s},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._iGeneratePropertyOfOneParticle=function(e){var i=e[t.VELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+t.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},t.VELOCITY_VECTOR3D="VelocityVector3D",t}(s);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/nodes/ParticleNodeBase":void 0,"awayjs-renderergl/lib/animators/states/ParticleVelocityState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonClipState"),s=function(e){function t(){e.call(this),this._frames=new Array,this.highQuality=!1,this._pStateClass=a}return i(t,e),Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),t.prototype.addFrame=function(e,t){this._frames.push(e),this._pDurations.push(t),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,r,a=this._pNumFrames-1;a--;)this._pTotalDuration+=this._pDurations[a],t=this._frames[a].jointPoses[0].translation,i=this._frames[a+1].jointPoses[0].translation,r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z;(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._frames[0].jointPoses[0].translation,i=this._frames[1].jointPoses[0].translation,r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonClipState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonDifferenceNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonDifferenceState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonDirectionalNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonDirectionalState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":void 0}],"awayjs-renderergl/lib/animators/nodes/SkeletonNaryLERPNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/animators/nodes/AnimationNodeBase"),a=e("awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState"),s=function(e){function t(){e.call(this),this._iInputs=new Array,this._pStateClass=a}return i(t,e),Object.defineProperty(t.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:!0,configurable:!0}),t.prototype.getInputIndex=function(e){return this._iInputs.indexOf(e)},t.prototype.getInputAt=function(e){return this._iInputs[e]},t.prototype.addInput=function(e){this._iInputs[this._numInputs++]=e},t.prototype.getAnimationState=function(e){return e.getAnimationState(this)},t}(r);t.exports=s},{"awayjs-display/lib/animators/nodes/AnimationNodeBase":void 0,"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":void 0}],"awayjs-renderergl/lib/animators/nodes/VertexClipNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase"),s=e("awayjs-renderergl/lib/animators/states/VertexClipState"),o=function(e){function t(){e.call(this),this._frames=new Array,this._translations=new Array,this._pStateClass=s}return i(t,e),Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),t.prototype.addFrame=function(e,t,i){void 0===i&&(i=null),this._frames.push(e),this._pDurations.push(t),this._translations.push(i||new r),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},t.prototype._pUpdateStitch=function(){e.prototype._pUpdateStitch.call(this);for(var t,i,r,a=this._pNumFrames-1;a--;)this._pTotalDuration+=this._pDurations[a],t=this._translations[a],i=this._translations[a+1],r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z;this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],t=this._translations[0],i=this._translations[1],r=i.subtract(t),this._pTotalDelta.x+=r.x,this._pTotalDelta.y+=r.y,this._pTotalDelta.z+=r.z)},t}(a);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/nodes/AnimationClipNodeBase":void 0,"awayjs-renderergl/lib/animators/states/VertexClipState":void 0}],"awayjs-renderergl/lib/animators/states/AnimationClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),a=e("awayjs-renderergl/lib/events/AnimationStateEvent"),s=function(e){function t(t,i){e.call(this,t,i),this._pFramesDirty=!0,this._animationClipNode=i
}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pBlendWeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pCurrentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pNextFrame},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this._animationClipNode.looping||(e>this._pStartTime+this._animationClipNode.totalDuration?e=this._pStartTime+this._animationClipNode.totalDuration:e<this._pStartTime&&(e=this._pStartTime)),this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},t.prototype.phase=function(e){var t=e*this._animationClipNode.totalDuration+this._pStartTime;this._pTime!=t-this._pStartTime&&this._pUpdateTime(t)},t.prototype._pUpdateTime=function(t){this._pFramesDirty=!0,this._pTimeDir=t-this._pStartTime>this._pTime?1:-1,e.prototype._pUpdateTime.call(this,t)},t.prototype._pUpdateFrames=function(){this._pFramesDirty=!1;var e=this._animationClipNode.looping,t=this._animationClipNode.totalDuration,i=this._animationClipNode.lastFrame,r=this._pTime;if(e&&(r>=t||0>r)&&(r%=t,0>r&&(r+=t)),!e&&r>=t)this.notifyPlaybackComplete(),this._pCurrentFrame=i,this._pNextFrame=i,this._pBlendWeight=0;else if(!e&&0>=r)this._pCurrentFrame=0,this._pNextFrame=0,this._pBlendWeight=0;else if(this._animationClipNode.fixedFrameRate){var a=r/t*i;this._pCurrentFrame=Math.floor(a),this._pBlendWeight=a-this._pCurrentFrame,this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0,this._pNextFrame=0;var s,o=0,n=this._animationClipNode.durations;do s=o,o+=n[this._pNextFrame],this._pCurrentFrame=this._pNextFrame++;while(r>o);this._pCurrentFrame==i&&(this._pCurrentFrame=0,this._pNextFrame=1),this._pBlendWeight=(r-s)/n[this._pCurrentFrame]}},t.prototype.notifyPlaybackComplete=function(){null==this._animationStatePlaybackComplete&&(this._animationStatePlaybackComplete=new a(a.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode)),this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0}],"awayjs-renderergl/lib/animators/states/AnimationStateBase":[function(e,t){var i=e("awayjs-core/lib/geom/Vector3D"),r=function(){function e(e,t){this._pRootDelta=new i,this._pPositionDeltaDirty=!0,this._pStartTime=0,this._pAnimator=e,this._pAnimationNode=t}return Object.defineProperty(e.prototype,"positionDelta",{get:function(){return this._pPositionDeltaDirty&&this._pUpdatePositionDelta(),this._pRootDelta},enumerable:!0,configurable:!0}),e.prototype.offset=function(e){this._pStartTime=e,this._pPositionDeltaDirty=!0},e.prototype.update=function(e){this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},e.prototype.phase=function(){},e.prototype._pUpdateTime=function(e){this._pTime=e-this._pStartTime,this._pPositionDeltaDirty=!0},e.prototype._pUpdatePositionDelta=function(){},e}();t.exports=r},{"awayjs-core/lib/geom/Vector3D":void 0}],"awayjs-renderergl/lib/animators/states/ISkeletonAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/IVertexAnimationState":[function(){},{}],"awayjs-renderergl/lib/animators/states/ParticleAccelerationState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleAccelerationNode=i,this._acceleration=this._particleAccelerationNode._acceleration,this.updateAccelerationData()}return i(t,e),Object.defineProperty(t.prototype,"acceleration",{get:function(){return this._acceleration},set:function(e){this._acceleration.x=e.x,this._acceleration.y=e.y,this._acceleration.z=e.z,this.updateAccelerationData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,o){var n=o.getRegisterIndex(this._pAnimationNode,t.ACCELERATION_INDEX);this._particleAccelerationNode.mode==s.LOCAL_STATIC?r.activateVertexBuffer(n,this._particleAccelerationNode._iDataOffset,e,a.FLOAT_3):o.setVertexConst(n,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)},t.prototype.updateAccelerationData=function(){this._particleAccelerationNode.mode==s.GLOBAL&&(this._halfAcceleration=new r(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2))},t.ACCELERATION_INDEX=0,t}(o);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleBezierCurveState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleBezierCurveNode=i,this._controlPoint=this._particleBezierCurveNode._iControlPoint,this._endPoint=this._particleBezierCurveNode._iEndPoint}return i(t,e),Object.defineProperty(t.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(e){this._controlPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endPoint",{get:function(){return this._endPoint},set:function(e){this._endPoint=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,s,o){var n=o.getRegisterIndex(this._pAnimationNode,t.BEZIER_CONTROL_INDEX),l=o.getRegisterIndex(this._pAnimationNode,t.BEZIER_END_INDEX);this._particleBezierCurveNode.mode==a.LOCAL_STATIC?(s.activateVertexBuffer(n,this._particleBezierCurveNode._iDataOffset,e,r.FLOAT_3),s.activateVertexBuffer(l,this._particleBezierCurveNode._iDataOffset+3,e,r.FLOAT_3)):(o.setVertexConst(n,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z),o.setVertexConst(l,this._endPoint.x,this._endPoint.y,this._endPoint.z))},t.BEZIER_CONTROL_INDEX=0,t.BEZIER_END_INDEX=1,t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleBillboardState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/MathConsts"),a=e("awayjs-core/lib/geom/Matrix3D"),s=e("awayjs-core/lib/geom/Orientation3D"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._matrix=new a,this._billboardAxis=i._iBillboardAxis}return i(t,e),t.prototype.setRenderState=function(e,i,a,o,n){var l;if(this._billboardAxis){var h=i.sourceEntity.sceneTransform.position,p=n.sceneTransform.position.subtract(h),d=p.crossProduct(this._billboardAxis);d.normalize(),p=this.billboardAxis.crossProduct(d),p.normalize(),this._matrix.copyFrom(i.sourceEntity.sceneTransform),l=this._matrix.decompose(s.AXIS_ANGLE),this._matrix.copyColumnFrom(0,d),this._matrix.copyColumnFrom(1,this.billboardAxis),this._matrix.copyColumnFrom(2,p),this._matrix.copyColumnFrom(3,h),this._matrix.appendRotation(-l[1].w*r.RADIANS_TO_DEGREES,l[1])}else this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(n.inverseSceneTransform),l=this._matrix.decompose(s.AXIS_ANGLE),this._matrix.identity(),this._matrix.appendRotation(-l[1].w*r.RADIANS_TO_DEGREES,l[1]);o.setVertexConstFromMatrix(o.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)},Object.defineProperty(t.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(e){this.billboardAxis=e?e.clone():null,this.billboardAxis&&this.billboardAxis.normalize()},enumerable:!0,configurable:!0}),t.MATRIX_INDEX=0,t}(o);t.exports=n},{"awayjs-core/lib/geom/MathConsts":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Orientation3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleColorNode=i,this._usesMultiplier=this._particleColorNode._iUsesMultiplier,this._usesOffset=this._particleColorNode._iUsesOffset,this._usesCycle=this._particleColorNode._iUsesCycle,this._usesPhase=this._particleColorNode._iUsesPhase,this._startColor=this._particleColorNode._iStartColor,this._endColor=this._particleColorNode._iEndColor,this._cycleDuration=this._particleColorNode._iCycleDuration,this._cyclePhase=this._particleColorNode._iCyclePhase,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateColorData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,o){if(o.needFragmentAnimation){var n=this._particleColorNode._iDataOffset;this._usesCycle&&o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w),this._usesMultiplier&&(this._particleColorNode.mode==s.LOCAL_STATIC?(r.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),n,e,a.FLOAT_4),n+=4,r.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),n,e,a.FLOAT_4),n+=4):(o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w),o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w))),this._usesOffset&&(this._particleColorNode.mode==s.LOCAL_STATIC?(r.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),n,e,a.FLOAT_4),n+=4,r.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),n,e,a.FLOAT_4),n+=4):(o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w),o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)))}},t.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new r(2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}this._particleColorNode.mode==s.GLOBAL&&(this._usesCycle?(this._usesMultiplier&&(this._startMultiplierData=new r((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2),this._deltaMultiplierData=new r((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)),this._usesOffset&&(this._startOffsetData=new r((this._startColor.redOffset+this._endColor.redOffset)/510,(this._startColor.greenOffset+this._endColor.greenOffset)/510,(this._startColor.blueOffset+this._endColor.blueOffset)/510,(this._startColor.alphaOffset+this._endColor.alphaOffset)/510),this._deltaOffsetData=new r((this._endColor.redOffset-this._startColor.redOffset)/510,(this._endColor.greenOffset-this._startColor.greenOffset)/510,(this._endColor.blueOffset-this._startColor.blueOffset)/510,(this._endColor.alphaOffset-this._startColor.alphaOffset)/510))):(this._usesMultiplier&&(this._startMultiplierData=new r(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),this._deltaMultiplierData=new r(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)),this._usesOffset&&(this._startOffsetData=new r(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),this._deltaOffsetData=new r((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255))))},t.START_MULTIPLIER_INDEX=0,t.DELTA_MULTIPLIER_INDEX=1,t.START_OFFSET_INDEX=2,t.DELTA_OFFSET_INDEX=3,t.CYCLE_INDEX=4,t}(o);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleFollowState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/MathConsts"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i,!0),this._targetPos=new a,this._targetEuler=new a,this._temp=new a,this._particleFollowNode=i,this._smooth=i._iSmooth}return i(t,e),Object.defineProperty(t.prototype,"followTarget",{get:function(){return this._followTarget},set:function(e){this._followTarget=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smooth",{get:function(){return this._smooth},set:function(e){this._smooth=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,a,o){this._followTarget&&(this._particleFollowNode._iUsesPosition&&(this._targetPos.x=this._followTarget.transform.position.x/i.sourceEntity.scaleX,this._targetPos.y=this._followTarget.transform.position.y/i.sourceEntity.scaleY,this._targetPos.z=this._followTarget.transform.position.z/i.sourceEntity.scaleZ),this._particleFollowNode._iUsesRotation&&(this._targetEuler.x=this._followTarget.rotationX,this._targetEuler.y=this._followTarget.rotationY,this._targetEuler.z=this._followTarget.rotationZ,this._targetEuler.scaleBy(r.DEGREES_TO_RADIANS))),this._prePos||(this._prePos=this._targetPos.clone()),this._preEuler||(this._preEuler=this._targetEuler.clone());var n=this._pTime/1e3,l=a.previousTime,h=n-l,p=l!=n;this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation?(p&&this.processPositionAndRotation(n,h,a),a.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3),a.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,e,s.FLOAT_3)):this._particleFollowNode._iUsesPosition?(p&&this.processPosition(n,h,a),a.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)):this._particleFollowNode._iUsesRotation&&(p&&this.precessRotation(n,h,a),a.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,e,s.FLOAT_3)),this._prePos.copyFrom(this._targetPos),this._targetEuler.copyFrom(this._targetEuler),a.previousTime=n},t.prototype.processPosition=function(e,t,i){var r,a,s=i.animationParticles,o=i.vertexData,n=!1,l=s.length;this._smooth?(a=this._prePos.subtract(this._targetPos),a.scaleBy(1/t)):r=this._targetPos;for(var h=0;l>h;h++){var p=(e-s[h].startTime)/s[h].totalTime,d=(p-Math.floor(p))*s[h].totalTime;if(0>=d-t){var c=s[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(a),this._temp.scaleBy(d),r=this._targetPos.add(this._temp)),o[c]!=r.x||o[c+1]!=r.y||o[c+2]!=r.z){n=!0;for(var u=0;u<s[h].numVertices;u++)o[c++]=r.x,o[c++]=r.y,o[c++]=r.z}}}n&&i.invalidateBuffer()},t.prototype.precessRotation=function(e,t,i){var r,a,s=i.animationParticles,o=i.vertexData,n=!1,l=s.length;this._smooth?(a=this._preEuler.subtract(this._targetEuler),a.scaleBy(1/t)):r=this._targetEuler;for(var h=0;l>h;h++){var p=(e-s[h].startTime)/s[h].totalTime,d=(p-Math.floor(p))*s[h].totalTime;if(0>=d-t){var c=s[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(a),this._temp.scaleBy(d),r=this._targetEuler.add(this._temp)),o[c]!=r.x||o[c+1]!=r.y||o[c+2]!=r.z){n=!0;for(var u=0;u<s[h].numVertices;u++)o[c++]=r.x,o[c++]=r.y,o[c++]=r.z}}}n&&i.invalidateBuffer()},t.prototype.processPositionAndRotation=function(e,t,i){var r,a,s,o,n=i.animationParticles,l=i.vertexData,h=!1,p=n.length;this._smooth?(s=this._prePos.subtract(this._targetPos),s.scaleBy(1/t),o=this._preEuler.subtract(this._targetEuler),o.scaleBy(1/t)):(r=this._targetPos,a=this._targetEuler);for(var d=0;p>d;d++){var c=(e-n[d].startTime)/n[d].totalTime,u=(c-Math.floor(c))*n[d].totalTime;if(0>=u-t){var _=n[d].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(s),this._temp.scaleBy(u),r=this._targetPos.add(this._temp),this._temp.copyFrom(o),this._temp.scaleBy(u),a=this._targetEuler.add(this._temp)),l[_]!=r.x||l[_+1]!=r.y||l[_+2]!=r.z||l[_+3]!=a.x||l[_+4]!=a.y||l[_+5]!=a.z){h=!0;for(var y=0;y<n[d].numVertices;y++)l[_++]=r.x,l[_++]=r.y,l[_++]=r.z,l[_++]=a.x,l[_++]=a.y,l[_++]=a.z}}}h&&i.invalidateBuffer()},t.FOLLOW_POSITION_INDEX=0,t.FOLLOW_ROTATION_INDEX=1,t}(o);t.exports=n},{"awayjs-core/lib/geom/MathConsts":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleInitialColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleInitialColorNode=i,this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._initialColor=i._iInitialColor,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"initialColor",{get:function(){return this._initialColor},set:function(e){this._initialColor=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,o,n){if(i=i,n=n,o.needFragmentAnimation)if(this._particleInitialColorNode.mode==s.LOCAL_STATIC){var l=this._particleInitialColorNode._iDataOffset;this._usesMultiplier&&(r.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),l,e,a.FLOAT_4),l+=4),this._usesOffset&&r.activateVertexBuffer(o.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),l,e,a.FLOAT_4)}else this._usesMultiplier&&o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w),this._usesOffset&&o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)},t.prototype.updateColorData=function(){this._particleInitialColorNode.mode==s.GLOBAL&&(this._usesMultiplier&&(this._multiplierData=new r(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier)),this._usesOffset&&(this._offsetData=new r(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)))},t.MULTIPLIER_INDEX=0,t.OFFSET_INDEX=1,t}(o);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleOrbitState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),o=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),n=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),l=function(e){function t(t,i){e.call(this,t,i),this._particleOrbitNode=i,this._usesEulers=this._particleOrbitNode._iUsesEulers,this._usesCycle=this._particleOrbitNode._iUsesCycle,this._usesPhase=this._particleOrbitNode._iUsesPhase,this._eulers=this._particleOrbitNode._iEulers,this._radius=this._particleOrbitNode._iRadius,this._cycleDuration=this._particleOrbitNode._iCycleDuration,this._cyclePhase=this._particleOrbitNode._iCyclePhase,this.updateOrbitData()}return i(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eulers",{get:function(){return this._eulers},set:function(e){this._eulers=e,this.updateOrbitData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,a){var n=a.getRegisterIndex(this._pAnimationNode,t.ORBIT_INDEX);this._particleOrbitNode.mode==o.LOCAL_STATIC?this._usesPhase?r.activateVertexBuffer(n,this._particleOrbitNode._iDataOffset,e,s.FLOAT_4):r.activateVertexBuffer(n,this._particleOrbitNode._iDataOffset,e,s.FLOAT_3):a.setVertexConst(n,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w),this._usesEulers&&a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.EULERS_INDEX),this._eulersMatrix)},t.prototype.updateOrbitData=function(){if(this._usesEulers&&(this._eulersMatrix=new r,this._eulersMatrix.appendRotation(this._eulers.x,a.X_AXIS),this._eulersMatrix.appendRotation(this._eulers.y,a.Y_AXIS),this._eulersMatrix.appendRotation(this._eulers.z,a.Z_AXIS)),this._particleOrbitNode.mode==o.GLOBAL)if(this._orbitData=new a(this._radius,0,this._radius*Math.PI*2,this._cyclePhase*Math.PI/180),this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=2*Math.PI/this._cycleDuration}else this._orbitData.y=2*Math.PI},t.ORBIT_INDEX=0,t.EULERS_INDEX=1,t}(n);t.exports=l},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleOscillatorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleOscillatorNode=i,this._oscillator=this._particleOscillatorNode._iOscillator,this.updateOscillatorData()}return i(t,e),Object.defineProperty(t.prototype,"oscillator",{get:function(){return this._oscillator},set:function(e){this._oscillator=e,this.updateOscillatorData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,o){var n=o.getRegisterIndex(this._pAnimationNode,t.OSCILLATOR_INDEX);this._particleOscillatorNode.mode==s.LOCAL_STATIC?r.activateVertexBuffer(n,this._particleOscillatorNode._iDataOffset,e,a.FLOAT_4):o.setVertexConst(n,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)},t.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==s.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");null==this._oscillatorData&&(this._oscillatorData=new r),this._oscillatorData.x=this._oscillator.x,this._oscillatorData.y=this._oscillator.y,this._oscillatorData.z=this._oscillator.z,this._oscillatorData.w=2*Math.PI/this._oscillator.w}},t.OSCILLATOR_INDEX=0,t}(o);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticlePositionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particlePositionNode=i,this._position=this._particlePositionNode._iPosition}return i(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.getPositions=function(){return this._pDynamicProperties},t.prototype.setPositions=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,s,o){this._particlePositionNode.mode!=a.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[s._iUniqueId]||this._pUpdateDynamicProperties(s);var n=o.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);this._particlePositionNode.mode==a.GLOBAL?o.setVertexConst(n,this._position.x,this._position.y,this._position.z):s.activateVertexBuffer(n,this._particlePositionNode._iDataOffset,e,r.FLOAT_3)},t.POSITION_INDEX=0,t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotateToHeadingState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),s=function(e){function t(t,i){e.call(this,t,i),this._matrix=new r}return i(t,e),t.prototype.setRenderState=function(e,i,r,a,s){a.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(s.inverseSceneTransform),a.setVertexConstFromMatrix(a.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix))},t.MATRIX_INDEX=0,t}(a);t.exports=s},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotateToPositionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._matrix=new r,this._particleRotateToPositionNode=i,this._position=this._particleRotateToPositionNode._iPosition}return i(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,o,n){var l=o.getRegisterIndex(this._pAnimationNode,t.POSITION_INDEX);o.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.sceneTransform),this._matrix.append(n.inverseSceneTransform),o.setVertexConstFromMatrix(o.getRegisterIndex(this._pAnimationNode,t.MATRIX_INDEX),this._matrix)),this._particleRotateToPositionNode.mode==s.GLOBAL?(this._offset=i.sourceEntity.inverseSceneTransform.transformVector(this._position),o.setVertexConst(l,this._offset.x,this._offset.y,this._offset.z)):r.activateVertexBuffer(l,this._particleRotateToPositionNode._iDataOffset,e,a.FLOAT_3)},t.MATRIX_INDEX=0,t.POSITION_INDEX=1,t}(o);t.exports=n},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleRotationalVelocityState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleRotationalVelocityNode=i,this._rotationalVelocity=this._particleRotationalVelocityNode._iRotationalVelocity,this.updateRotationalVelocityData()
}return i(t,e),Object.defineProperty(t.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(e){this._rotationalVelocity=e,this.updateRotationalVelocityData()},enumerable:!0,configurable:!0}),t.prototype.getRotationalVelocities=function(){return this._pDynamicProperties},t.prototype.setRotationalVelocities=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,r,o){this._particleRotationalVelocityNode.mode!=s.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var n=o.getRegisterIndex(this._pAnimationNode,t.ROTATIONALVELOCITY_INDEX);this._particleRotationalVelocityNode.mode==s.GLOBAL?o.setVertexConst(n,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w):r.activateVertexBuffer(n,this._particleRotationalVelocityNode._iDataOffset,e,a.FLOAT_4)},t.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==s.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var e=this._rotationalVelocity.clone();e.length<=0?e.z=1:e.normalize(),this._rotationalVelocityData=new r(e.x,e.y,e.z,Math.PI/e.w)}},t.ROTATIONALVELOCITY_INDEX=0,t}(o);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleScaleState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),s=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),o=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._particleScaleNode=i,this._usesCycle=this._particleScaleNode._iUsesCycle,this._usesPhase=this._particleScaleNode._iUsesPhase,this._minScale=this._particleScaleNode._iMinScale,this._maxScale=this._particleScaleNode._iMaxScale,this._cycleDuration=this._particleScaleNode._iCycleDuration,this._cyclePhase=this._particleScaleNode._iCyclePhase,this.updateScaleData()}return i(t,e),Object.defineProperty(t.prototype,"minScale",{get:function(){return this._minScale},set:function(e){this._minScale=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){return this._maxScale},set:function(e){this._maxScale=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateScaleData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,o){var n=o.getRegisterIndex(this._pAnimationNode,t.SCALE_INDEX);this._particleScaleNode.mode==s.LOCAL_STATIC?this._usesCycle?this._usesPhase?r.activateVertexBuffer(n,this._particleScaleNode._iDataOffset,e,a.FLOAT_4):r.activateVertexBuffer(n,this._particleScaleNode._iDataOffset,e,a.FLOAT_3):r.activateVertexBuffer(n,this._particleScaleNode._iDataOffset,e,a.FLOAT_2):o.setVertexConst(n,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)},t.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==s.GLOBAL)if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new r((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new r(this._minScale,this._maxScale-this._minScale,0,0)},t.SCALE_INDEX=0,t}(o);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleSegmentedColorState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),a=function(e){function t(t,i){e.call(this,t,i),this._usesMultiplier=i._iUsesMultiplier,this._usesOffset=i._iUsesOffset,this._startColor=i._iStartColor,this._endColor=i._iEndColor,this._segmentPoints=i._iSegmentPoints,this._numSegmentPoint=i._iNumSegmentPoint,this.updateColorData()}return i(t,e),Object.defineProperty(t.prototype,"startColor",{get:function(){return this._startColor},set:function(e){this._startColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endColor",{get:function(){return this._endColor},set:function(e){this._endColor=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(e){this._segmentPoints=e,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,r,a){a.needFragmentAnimation&&(this._numSegmentPoint>0&&a.setVertexConst(a.getRegisterIndex(this._pAnimationNode,t.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]),this._usesMultiplier&&a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_MULTIPLIER_INDEX),this._multiplierData),this._usesOffset&&a.setVertexConstFromArray(a.getRegisterIndex(this._pAnimationNode,t.START_OFFSET_INDEX),this._offsetData))},t.prototype.updateColorData=function(){this._timeLifeData=new Array,this._multiplierData=new Array,this._offsetData=new Array;var e;for(e=0;e<this._numSegmentPoint;e++)this._timeLifeData.push(0==e?this._segmentPoints[e].life:this._segmentPoints[e].life-this._segmentPoints[e-1].life);if(this._timeLifeData.push(0==this._numSegmentPoint?1:1-this._segmentPoints[e-1].life),this._usesMultiplier){for(this._multiplierData.push(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),e=0;e<this._numSegmentPoint;e++)0==e?this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[e]):this._multiplierData.push((this._segmentPoints[e].color.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._segmentPoints[e].color.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e]);0==this._numSegmentPoint?this._multiplierData.push(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier):this._multiplierData.push((this._endColor.redMultiplier-this._segmentPoints[e-1].color.redMultiplier)/this._timeLifeData[e],(this._endColor.greenMultiplier-this._segmentPoints[e-1].color.greenMultiplier)/this._timeLifeData[e],(this._endColor.blueMultiplier-this._segmentPoints[e-1].color.blueMultiplier)/this._timeLifeData[e],(this._endColor.alphaMultiplier-this._segmentPoints[e-1].color.alphaMultiplier)/this._timeLifeData[e])}if(this._usesOffset){for(this._offsetData.push(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),e=0;e<this._numSegmentPoint;e++)0==e?this._offsetData.push((this._segmentPoints[e].color.redOffset-this._startColor.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[e]/255):this._offsetData.push((this._segmentPoints[e].color.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._segmentPoints[e].color.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255);0==this._numSegmentPoint?this._offsetData.push((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255):this._offsetData.push((this._endColor.redOffset-this._segmentPoints[e-1].color.redOffset)/this._timeLifeData[e]/255,(this._endColor.greenOffset-this._segmentPoints[e-1].color.greenOffset)/this._timeLifeData[e]/255,(this._endColor.blueOffset-this._segmentPoints[e-1].color.blueOffset)/this._timeLifeData[e]/255,(this._endColor.alphaOffset-this._segmentPoints[e-1].color.alphaOffset)/this._timeLifeData[e]/255)}this._timeLifeData.length=4},t.START_MULTIPLIER_INDEX=0,t.START_OFFSET_INDEX=1,t.TIME_DATA_INDEX=2,t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleSpriteSheetState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleSpriteSheetNode=i,this._usesCycle=this._particleSpriteSheetNode._iUsesCycle,this._usesPhase=this._particleSpriteSheetNode._iUsesCycle,this._totalFrames=this._particleSpriteSheetNode._iTotalFrames,this._numColumns=this._particleSpriteSheetNode._iNumColumns,this._numRows=this._particleSpriteSheetNode._iNumRows,this._cycleDuration=this._particleSpriteSheetNode._iCycleDuration,this._cyclePhase=this._particleSpriteSheetNode._iCyclePhase,this.updateSpriteSheetData()}return i(t,e),Object.defineProperty(t.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(e){this._cyclePhase=e,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(e){this._cycleDuration=e,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(e,i,s,o){if(o.needUVAnimation&&(o.setVertexConst(o.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]),this._usesCycle)){var n=o.getRegisterIndex(this._pAnimationNode,t.UV_INDEX_1);this._particleSpriteSheetNode.mode==a.LOCAL_STATIC?this._usesPhase?s.activateVertexBuffer(n,this._particleSpriteSheetNode._iDataOffset,e,r.FLOAT_3):s.activateVertexBuffer(n,this._particleSpriteSheetNode._iDataOffset,e,r.FLOAT_2):o.setVertexConst(n,this._spriteSheetData[4],this._spriteSheetData[5])}},t.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var e=this._totalFrames/this._numColumns;if(this._spriteSheetData[0]=e,this._spriteSheetData[1]=1/this._numColumns,this._spriteSheetData[2]=1/this._numRows,this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=e/this._cycleDuration,this._spriteSheetData[5]=this._cycleDuration,this._usesPhase&&(this._spriteSheetData[6]=this._cyclePhase)}},t.UV_INDEX_0=0,t.UV_INDEX_1=1,t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleStateBase":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),a=function(e){function t(t,i,r){void 0===r&&(r=!1),e.call(this,t,i),this._pDynamicProperties=new Array,this._pDynamicPropertiesDirty=new Object,this._particleNode=i,this._pNeedUpdateTime=r}return i(t,e),Object.defineProperty(t.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:!0,configurable:!0}),t.prototype.setRenderState=function(){},t.prototype._pUpdateDynamicProperties=function(e){this._pDynamicPropertiesDirty[e._iUniqueId]=!0;for(var t,i,r,a,s,o=e.animationParticles,n=e.vertexData,l=e.totalLenOfOneVertex,h=this._particleNode.dataLength,p=this._particleNode._iDataOffset,d=this._pDynamicProperties.length,c=0,u=0,_=0;d>c;){for(;d>u&&(s=o[u]).index==c;){for(a=this._pDynamicProperties[c],t=s.numVertices*l,i=s.startVertexIndex*l+p,_=0;t>_;_+=l)for(r=i+_,_=0;t>_;_+=l)r=i+_,n[r++]=a.x,n[r++]=a.y,n[r++]=a.z,4==h&&(n[r++]=a.w);u++}c++}e.invalidateBuffer()},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleTimeState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),s=function(e){function t(t,i){e.call(this,t,i,!0),this._particleTimeNode=i}return i(t,e),t.prototype.setRenderState=function(e,i,a,s){a.activateVertexBuffer(s.getRegisterIndex(this._pAnimationNode,t.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,e,r.FLOAT_4);var o=this._pTime/1e3;s.setVertexConst(s.getRegisterIndex(this._pAnimationNode,t.TIME_CONSTANT_INDEX),o,o,o,o)},t.TIME_STREAM_INDEX=0,t.TIME_CONSTANT_INDEX=1,t}(a);t.exports=s},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/ParticleUVState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),a=function(e){function t(t,i){e.call(this,t,i),this._particleUVNode=i}return i(t,e),t.prototype.setRenderState=function(e,i,r,a){if(a.needUVAnimation){var s=a.getRegisterIndex(this._pAnimationNode,t.UV_INDEX),o=this._particleUVNode._iUvData;a.setVertexConst(s,o.x,o.y)}},t.UV_INDEX=0,t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0}],"awayjs-renderergl/lib/animators/states/ParticleVelocityState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/base/ContextGLVertexBufferFormat"),a=e("awayjs-renderergl/lib/animators/data/ParticlePropertiesMode"),s=e("awayjs-renderergl/lib/animators/states/ParticleStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._particleVelocityNode=i,this._velocity=this._particleVelocityNode._iVelocity}return i(t,e),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity=e},enumerable:!0,configurable:!0}),t.prototype.getVelocities=function(){return this._pDynamicProperties},t.prototype.setVelocities=function(e){this._pDynamicProperties=e,this._pDynamicPropertiesDirty=new Object},t.prototype.setRenderState=function(e,i,s,o){this._particleVelocityNode.mode!=a.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[s._iUniqueId]||this._pUpdateDynamicProperties(s);var n=o.getRegisterIndex(this._pAnimationNode,t.VELOCITY_INDEX);this._particleVelocityNode.mode==a.GLOBAL?o.setVertexConst(n,this._velocity.x,this._velocity.y,this._velocity.z):s.activateVertexBuffer(n,this._particleVelocityNode._iDataOffset,e,r.FLOAT_3)},t.VELOCITY_INDEX=0,t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/ParticlePropertiesMode":void 0,"awayjs-renderergl/lib/animators/states/ParticleStateBase":void 0,"awayjs-stagegl/lib/base/ContextGLVertexBufferFormat":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._blendWeight=0,this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=i,this._inputA=t.getAnimationState(this._skeletonAnimationNode.inputA),this._inputB=t.getAnimationState(this._skeletonAnimationNode.inputB)}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(e),this._inputB.phase(e)},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e=this._inputA.positionDelta,t=this._inputB.positionDelta;this._pRootDelta.x=e.x+this._blendWeight*(t.x-e.x),this._pRootDelta.y=e.y+this._blendWeight*(t.y-e.y),this._pRootDelta.z=e.z+this._blendWeight*(t.z-e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var t,i,a,s,o,n,l=this._skeletonPose.jointPoses,h=this._inputA.getSkeletonPose(e).jointPoses,p=this._inputB.getSkeletonPose(e).jointPoses,d=e.numJoints;l.length!=d&&(l.length=d);for(var c=0;d>c;++c)t=l[c],null==t&&(t=l[c]=new r),i=h[c],a=p[c],s=i.translation,o=a.translation,t.orientation.lerp(i.orientation,a.orientation,this._blendWeight),n=t.translation,n.x=s.x+this._blendWeight*(o.x-s.x),n.y=s.y+this._blendWeight*(o.y-s.y),n.z=s.z+this._blendWeight*(o.z-s.z)},t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-renderergl/lib/animators/data/JointPose"),s=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),o=e("awayjs-renderergl/lib/animators/states/AnimationClipState"),n=function(e){function t(t,i){e.call(this,t,i),this._rootPos=new r,this._skeletonPose=new s,this._skeletonPoseDirty=!0,this._skeletonClipNode=i,this._frames=this._skeletonClipNode.frames}return i(t,e),Object.defineProperty(t.prototype,"currentPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentPose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextPose},enumerable:!0,configurable:!0}),t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,e.prototype._pUpdateTime.call(this,t)},t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this),this._currentPose=this._frames[this._pCurrentFrame],this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame?(this._nextPose=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextPose=this._frames[this._pNextFrame]},t.prototype.updateSkeletonPose=function(e){if(this._skeletonPoseDirty=!1,this._skeletonClipNode.totalDuration){this._pFramesDirty&&this._pUpdateFrames();var t,i,r,s,o,n,l=this._currentPose.jointPoses,h=this._nextPose.jointPoses,p=e.numJoints,d=this._skeletonPose.jointPoses;if(d.length!=p&&(d.length=p),p!=l.length||p!=h.length)throw new Error("joint counts don't match!");for(var c=0;p>c;++c)o=d[c],null==o&&(o=d[c]=new a),r=l[c],s=h[c],t=r.translation,i=s.translation,this._skeletonClipNode.highQuality?o.orientation.slerp(r.orientation,s.orientation,this._pBlendWeight):o.orientation.lerp(r.orientation,s.orientation,this._pBlendWeight),c>0&&(n=o.translation,n.x=t.x+this._pBlendWeight*(i.x-t.x),n.y=t.y+this._pBlendWeight*(i.y-t.y),n.z=t.z+this._pBlendWeight*(i.z-t.z))}},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._pFramesDirty&&this._pUpdateFrames();var e,t,i,r=this._skeletonClipNode.totalDelta;(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame)&&(this._rootPos.x-=r.x*this._pTimeDir,this._rootPos.y-=r.y*this._pTimeDir,this._rootPos.z-=r.z*this._pTimeDir);var a=this._rootPos.x,s=this._rootPos.y,o=this._rootPos.z;this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame?(e=this._frames[0].jointPoses[0].translation,t=this._frames[1].jointPoses[0].translation,i=this._currentPose.jointPoses[0].translation,this._rootPos.x=i.x+e.x+this._pBlendWeight*(t.x-e.x),this._rootPos.y=i.y+e.y+this._pBlendWeight*(t.y-e.y),this._rootPos.z=i.z+e.z+this._pBlendWeight*(t.z-e.z)):(e=this._currentPose.jointPoses[0].translation,t=this._frames[this._pNextFrame].jointPoses[0].translation,this._rootPos.x=e.x+this._pBlendWeight*(t.x-e.x),this._rootPos.y=e.y+this._pBlendWeight*(t.y-e.y),this._rootPos.z=e.z+this._pBlendWeight*(t.z-e.z)),this._pRootDelta.x=this._rootPos.x-a,this._pRootDelta.y=this._rootPos.y-s,this._pRootDelta.z=this._rootPos.z-o,this._pOldFrame=this._pNextFrame},t}(o);t.exports=n},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationClipState":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonDifferenceState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-renderergl/lib/animators/data/JointPose"),s=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),o=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),n=function(e){function t(t,i){e.call(this,t,i),this._blendWeight=0,this._skeletonPose=new s,this._skeletonPoseDirty=!0,this._skeletonAnimationNode=i,this._baseInput=t.getAnimationState(this._skeletonAnimationNode.baseInput),this._differenceInput=t.getAnimationState(this._skeletonAnimationNode.differenceInput)}return i(t,e),Object.defineProperty(t.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(e){this._blendWeight=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._baseInput.phase(e),this._baseInput.phase(e)},t.prototype._pUpdateTime=function(t){this._skeletonPoseDirty=!0,this._baseInput.update(t),this._differenceInput.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e=this._baseInput.positionDelta,t=this._differenceInput.positionDelta;this.positionDelta.x=e.x+this._blendWeight*t.x,this.positionDelta.y=e.y+this._blendWeight*t.y,this.positionDelta.z=e.z+this._blendWeight*t.z},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var i,r,s,o,n,l,h=this._skeletonPose.jointPoses,p=this._baseInput.getSkeletonPose(e).jointPoses,d=this._differenceInput.getSkeletonPose(e).jointPoses,c=e.numJoints;h.length!=c&&(h.length=c);for(var u=0;c>u;++u)i=h[u],null==i&&(i=h[u]=new a),r=p[u],s=d[u],o=r.translation,n=s.translation,t._tempQuat.multiply(s.orientation,r.orientation),i.orientation.lerp(r.orientation,t._tempQuat,this._blendWeight),l=i.translation,l.x=o.x+this._blendWeight*n.x,l.y=o.y+this._blendWeight*n.y,l.z=o.z+this._blendWeight*n.z},t._tempQuat=new r,t}(o);t.exports=n},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonDirectionalState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._blendWeight=0,this._direction=0,this._blendDirty=!0,this._skeletonAnimationNode=i,this._forward=t.getAnimationState(this._skeletonAnimationNode.forward),this._backward=t.getAnimationState(this._skeletonAnimationNode.backward),this._left=t.getAnimationState(this._skeletonAnimationNode.left),this._right=t.getAnimationState(this._skeletonAnimationNode.right)}return i(t,e),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._direction!=e&&(this._direction=e,this._blendDirty=!0,this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.phase=function(e){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(e),this._inputB.phase(e)},t.prototype._pUdateTime=function(t){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._inputA.update(t),this._inputB.update(t),e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._blendDirty&&this.updateBlend();var e=this._inputA.positionDelta,t=this._inputB.positionDelta;this.positionDelta.x=e.x+this._blendWeight*(t.x-e.x),this.positionDelta.y=e.y+this._blendWeight*(t.y-e.y),this.positionDelta.z=e.z+this._blendWeight*(t.z-e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1,this._blendDirty&&this.updateBlend();var t,i,a,s,o,n,l=this._skeletonPose.jointPoses,h=this._inputA.getSkeletonPose(e).jointPoses,p=this._inputB.getSkeletonPose(e).jointPoses,d=e.numJoints;l.length!=d&&(l.length=d);for(var c=0;d>c;++c)t=l[c],null==t&&(t=l[c]=new r),i=h[c],a=p[c],s=i.translation,o=a.translation,t.orientation.lerp(i.orientation,a.orientation,this._blendWeight),n=t.translation,n.x=s.x+this._blendWeight*(o.x-s.x),n.y=s.y+this._blendWeight*(o.y-s.y),n.z=s.z+this._blendWeight*(o.z-s.z)},t.prototype.updateBlend=function(){this._blendDirty=!1,(this._direction<0||this._direction>360)&&(this._direction%=360,this._direction<0&&(this._direction+=360)),this._direction<90?(this._inputA=this._forward,this._inputB=this._right,this._blendWeight=this._direction/90):this._direction<180?(this._inputA=this._right,this._inputB=this._backward,this._blendWeight=(this._direction-90)/90):this._direction<270?(this._inputA=this._backward,this._inputB=this._left,this._blendWeight=(this._direction-180)/90):(this._inputA=this._left,this._inputB=this._forward,this._blendWeight=(this._direction-270)/90)},t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/SkeletonNaryLERPState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/data/JointPose"),a=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),s=e("awayjs-renderergl/lib/animators/states/AnimationStateBase"),o=function(e){function t(t,i){e.call(this,t,i),this._skeletonPose=new a,this._skeletonPoseDirty=!0,this._blendWeights=new Array,this._inputs=new Array,this._skeletonAnimationNode=i;for(var r=this._skeletonAnimationNode.numInputs;r--;)this._inputs[r]=t.getAnimationState(this._skeletonAnimationNode._iInputs[r])}return i(t,e),t.prototype.phase=function(e){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0;for(var t=0;t<this._skeletonAnimationNode.numInputs;++t)this._blendWeights[t]&&this._inputs[t].update(e)},t.prototype._pUdateTime=function(t){for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)this._blendWeights[i]&&this._inputs[i].update(t);e.prototype._pUpdateTime.call(this,t)},t.prototype.getSkeletonPose=function(e){return this._skeletonPoseDirty&&this.updateSkeletonPose(e),this._skeletonPose},t.prototype.getBlendWeightAt=function(e){return this._blendWeights[e]},t.prototype.setBlendWeightAt=function(e,t){this._blendWeights[e]=t,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},t.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var e,t;this.positionDelta.x=0,this.positionDelta.y=0,this.positionDelta.z=0;for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)t=this._blendWeights[i],t&&(e=this._inputs[i].positionDelta,this.positionDelta.x+=t*e.x,this.positionDelta.y+=t*e.y,this.positionDelta.z+=t*e.z)},t.prototype.updateSkeletonPose=function(e){this._skeletonPoseDirty=!1;var t,i,a,s,o,n,l,h,p,d,c,u,_,y,m,g,f,b,x=this._skeletonPose.jointPoses,w=e.numJoints;x.length!=w&&(x.length=w);for(var v=0;v<this._skeletonAnimationNode.numInputs;++v)if(t=this._blendWeights[v])if(i=this._inputs[v].getSkeletonPose(e).jointPoses,p)for(d=0;d<e.numJoints;++d)a=x[d],s=i[d],h=p[d].orientation,u=h.x,_=h.y,y=h.z,c=h.w,h=s.orientation,n=s.translation,g=h.x,f=h.y,b=h.z,m=h.w,0>u*g+_*f+y*b+c*m&&(g=-g,f=-f,b=-b,m=-m),l=a.orientation,l.x+=t*g,l.y+=t*f,l.z+=t*b,l.w+=t*m,o=a.translation,o.x+=t*n.x,o.y+=t*n.y,o.z+=t*n.z;
else for(p=i,d=0;w>d;++d)a=x[d],null==a&&(a=x[d]=new r),s=i[d],h=s.orientation,n=s.translation,l=a.orientation,l.x=t*h.x,l.y=t*h.y,l.z=t*h.z,l.w=t*h.w,o=a.translation,o.x=t*n.x,o.y=t*n.y,o.z=t*n.z;for(d=0;d<e.numJoints;++d)x[d].orientation.normalize()},t}(s);t.exports=o},{"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/states/AnimationStateBase":void 0}],"awayjs-renderergl/lib/animators/states/VertexClipState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/AnimationClipState"),a=function(e){function t(t,i){e.call(this,t,i),this._vertexClipNode=i,this._frames=this._vertexClipNode.frames}return i(t,e),Object.defineProperty(t.prototype,"currentGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentGeometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextGeometry",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextGeometry},enumerable:!0,configurable:!0}),t.prototype._pUpdateFrames=function(){e.prototype._pUpdateFrames.call(this),this._currentGeometry=this._frames[this._pCurrentFrame],this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame?(this._nextGeometry=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextGeometry=this._frames[this._pNextFrame]},t.prototype._pUpdatePositionDelta=function(){},t}(r);t.exports=a},{"awayjs-renderergl/lib/animators/states/AnimationClipState":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode"),a=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState"),s=function(e){function t(){e.call(this),this._pStateClass=a}return i(t,e),t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/nodes/SkeletonBinaryLERPNode":void 0,"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionState":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState"),a=e("awayjs-renderergl/lib/events/AnimationStateEvent"),s=function(e){function t(t,i){e.call(this,t,i),this._crossfadeTransitionNode=i}return i(t,e),t.prototype._pUpdateTime=function(t){this.blendWeight=Math.abs(t-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed),this.blendWeight>=1&&(this.blendWeight=1,null==this._animationStateTransitionComplete&&(this._animationStateTransitionComplete=new a(a.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode)),this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)),e.prototype._pUpdateTime.call(this,t)},t}(r);t.exports=s},{"awayjs-renderergl/lib/animators/states/SkeletonBinaryLERPState":void 0,"awayjs-renderergl/lib/events/AnimationStateEvent":void 0}],"awayjs-renderergl/lib/animators/transitions/CrossfadeTransition":[function(e,t){var i=e("awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode"),r=function(){function e(e){this.blendSpeed=.5,this.blendSpeed=e}return e.prototype.getAnimationNode=function(e,t,r,a){var s=new i;return s.inputA=t,s.inputB=r,s.blendSpeed=this.blendSpeed,s.startBlend=a,s},e}();t.exports=r},{"awayjs-renderergl/lib/animators/transitions/CrossfadeTransitionNode":void 0}],"awayjs-renderergl/lib/animators/transitions/IAnimationTransition":[function(){},{}],"awayjs-renderergl/lib/base/ParticleGeometry":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-display/lib/base/Geometry"),a=function(e){function t(){e.apply(this,arguments)}return i(t,e),t}(r);t.exports=a},{"awayjs-display/lib/base/Geometry":void 0}],"awayjs-renderergl/lib/events/AnimationStateEvent":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=function(e){function t(t,i,r,a){e.call(this,t),this._animator=i,this._animationState=r,this._animationNode=a}return i(t,e),Object.defineProperty(t.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationState",{get:function(){return this._animationState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.type,this._animator,this._animationState,this._animationNode)},t.PLAYBACK_COMPLETE="playbackComplete",t.TRANSITION_COMPLETE="transitionComplete",t}(r);t.exports=a},{"awayjs-core/lib/events/Event":void 0}],"awayjs-renderergl/lib/materials/methods/AmbientEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/AmbientBasicMethod"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t){e.call(this),this._cubeTexture=t}return i(t,e),t.prototype.iInitVO=function(t,i){e.prototype.iInitVO.call(this,t,i),i.needsNormals=!0},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r),r.context.activateCubeTexture(i.texturesIndex,this._cubeTexture)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var o,n="",l=r.getFreeTextureReg();return t.texturesIndex=l.index,n+=a.getTexCubeSampleCode(i,l,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,s.normalFragment),o=r.getFreeFragmentConstant(),t.fragmentConstantsIndex=o.index,n+="add "+i+".xyz, "+i+".xyz, "+o+".xyz\n"},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/AmbientBasicMethod":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseCelMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod"),a=function(e){function t(t,i){var r=this;void 0===t&&(t=3),void 0===i&&(i=null),e.call(this,null,i),this._smoothness=.1,this.baseMethod._iModulateMethod=function(e,t,i,a,s){return r.clampDiffuse(e,t,i,a,s)},this._levels=t}return i(t,e),t.prototype.iInitConstants=function(t,i){var r=t.fragmentConstantData,a=i.secondaryFragmentConstantsIndex;e.prototype.iInitConstants.call(this,t,i),r[a+1]=1,r[a+2]=0},Object.defineProperty(t.prototype,"levels",{get:function(){return this._levels},set:function(e){this._levels=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._dataReg=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=t.fragmentConstantData,s=i.secondaryFragmentConstantsIndex;a[s]=this._levels,a[s+3]=this._smoothness},t.prototype.clampDiffuse=function(e,t,i){return"mul "+i+".w, "+i+".w, "+this._dataReg+".x\nfrc "+i+".z, "+i+".w\nsub "+i+".y, "+i+".w, "+i+".z\nmov "+i+".x, "+this._dataReg+".x\nsub "+i+".x, "+i+".x, "+this._dataReg+".y\nrcp "+i+".x,"+i+".x\nmul "+i+".w, "+i+".y, "+i+".x\nsub "+i+".y, "+i+".w, "+i+".x\ndiv "+i+".z, "+i+".z, "+this._dataReg+".w\nsat "+i+".z, "+i+".z\nmul "+i+".w, "+i+".w, "+i+".z\nsub "+i+".z, "+this._dataReg+".y, "+i+".z\nmul "+i+".y, "+i+".y, "+i+".z\nadd "+i+".w, "+i+".w, "+i+".y\nsat "+i+".w, "+i+".w\n"},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/events/ShadingMethodEvent"),a=e("awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod"),s=function(e){function t(t,i){var s=this;void 0===i&&(i=null),e.call(this),this._onShaderInvalidatedDelegate=function(e){return s.onShaderInvalidated(e)},this.pBaseMethod=i||new a,this.pBaseMethod._iModulateMethod=t,this.pBaseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return i(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this.pBaseMethod},set:function(e){this.pBaseMethod!=e&&(this.pBaseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod=e,this.pBaseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){this.pBaseMethod.iInitVO(e,t)},t.prototype.iInitConstants=function(e,t){this.pBaseMethod.iInitConstants(e,t)},t.prototype.dispose=function(){this.pBaseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.pBaseMethod.dispose()},Object.defineProperty(t.prototype,"texture",{get:function(){return this.pBaseMethod.texture},set:function(e){this.pBaseMethod.texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this.pBaseMethod.diffuseColor},set:function(e){this.pBaseMethod.diffuseColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this.pBaseMethod.ambientColor},set:function(e){this.pBaseMethod.ambientColor=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentPreLightingCode=function(e,t,i,r){return this.pBaseMethod.iGetFragmentPreLightingCode(e,t,i,r)},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var o=this.pBaseMethod.iGetFragmentCodePerLight(e,t,i,r,a,s);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,o},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,r,a,s){var o=this.pBaseMethod.iGetFragmentCodePerProbe(e,t,i,r,a,s);return this._pTotalLightColorReg=this.pBaseMethod._pTotalLightColorReg,o},t.prototype.iActivate=function(e,t,i){this.pBaseMethod.iActivate(e,t,i)},t.prototype.iSetRenderState=function(e,t,i,r,a){this.pBaseMethod.iSetRenderState(e,t,i,r,a)},t.prototype.iDeactivate=function(e,t,i){this.pBaseMethod.iDeactivate(e,t,i)},t.prototype.iGetVertexCode=function(e,t,i,r){return this.pBaseMethod.iGetVertexCode(e,t,i,r)},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,a){return this.pBaseMethod.iGetFragmentPostLightingCode(e,t,i,r,a)},t.prototype.iReset=function(){this.pBaseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this.pBaseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(a);t.exports=s},{"awayjs-stagegl/lib/events/ShadingMethodEvent":void 0,"awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseDepthMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,r=t.fragmentConstantsIndex;i[r]=1,i[r+1]=1/255,i[r+2]=1/65025,i[r+3]=1/16581375},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,s){var o,n,l="";if(!this._pUseTexture)throw new Error("DiffuseDepthMethod requires texture!");return e.numLights>0&&(s.shadowTarget&&(l+="mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+s.shadowTarget+".w\n"),l+="add "+i+".xyz, "+this._pTotalLightColorReg+".xyz, "+i+".xyz\nsat "+i+".xyz, "+i+".xyz\n",r.removeFragmentTempUsage(this._pTotalLightColorReg)),o=e.numLights>0?r.getFreeFragmentVectorTemp():i,this._pDiffuseInputRegister=r.getFreeTextureReg(),t.texturesIndex=this._pDiffuseInputRegister.index,n=r.getFreeFragmentConstant(),t.fragmentConstantsIndex=4*n.index,l+=a.getTex2DSampleCode(o,s,this._pDiffuseInputRegister,this.texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"dp4 "+o+".x, "+o+", "+n+"\nmov "+o+".yz, "+o+".xx			\nmov "+o+".w, "+n+".x\nsub "+o+".xyz, "+n+".xxx, "+o+".xyz\n",0==e.numLights?l:l+="mul "+i+".xyz, "+o+".xyz, "+i+".xyz\nmov "+i+".w, "+o+".w\n"},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseGradientMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t){e.call(this),this._gradient=t}return i(t,e),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._gradient},set:function(e){(e.hasMipmaps!=this._gradient.hasMipmaps||e.format!=this._gradient.format)&&this.iInvalidateShaderProgram(),this._gradient=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._gradientTextureRegister=null},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){var s=e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a);return this._pIsFirstLight=!0,t.numLights>0&&(this._gradientTextureRegister=r.getFreeTextureReg(),i.secondaryTexturesIndex=this._gradientTextureRegister.index),s},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,s,o){var n,l="";return this._pIsFirstLight?n=this._pTotalLightColorReg:(n=s.getFreeFragmentVectorTemp(),s.addFragmentTempUsages(n,1)),l+="dp3 "+n+".w, "+i+".xyz, "+o.normalFragment+".xyz\nmul "+n+".w, "+n+".w, "+o.commons+".x\nadd "+n+".w, "+n+".w, "+o.commons+".x\nmul "+n+".xyz, "+n+".w, "+i+".w\n",null!=this._iModulateMethod&&(l+=this._iModulateMethod(e,t,n,s,o)),l+=a.getTex2DSampleCode(n,o,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,n,"clamp")+"mul "+n+".xyz, "+n+".xyz, "+r+".xyz\n",this._pIsFirstLight||(l+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+n+".xyz\n",s.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,l},t.prototype.pApplyShadow=function(e,t,i,r){var s=i.getFreeFragmentVectorTemp();return"mov "+s+", "+r.shadowTarget+".wwww\n"+a.getTex2DSampleCode(s,r,this._gradientTextureRegister,this._gradient,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s,"clamp")+"mul "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+", "+s+"\n"},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r),r.context.activateTexture(i.secondaryTexturesIndex,this._gradient)},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseLightMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),a=e("awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod"),s=function(e){function t(t,i,r,a){void 0===i&&(i="multiply"),void 0===r&&(r=!1),void 0===a&&(a=null),e.call(this,null,a),this._useSecondaryUV=r,this._lightMapTexture=t,this.blendMode=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightMapTexture",{get:function(){return this._lightMapTexture},set:function(e){this._lightMapTexture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){r.context.activateTexture(i.secondaryTexturesIndex,this._lightMapTexture),e.prototype.iActivate.call(this,t,i,r)},t.prototype.iGetFragmentPostLightingCode=function(i,a,s,o,n){var l,h=o.getFreeTextureReg(),p=o.getFreeFragmentVectorTemp();switch(a.secondaryTexturesIndex=h.index,l=r.getTex2DSampleCode(p,n,h,this._lightMapTexture,i.useSmoothTextures,i.repeatTextures,i.useMipmapping,n.secondaryUVVarying),this._blendMode){case t.MULTIPLY:l+="mul "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+p+"\n";break;case t.ADD:l+="add "+this._pTotalLightColorReg+", "+this._pTotalLightColorReg+", "+p+"\n"}return l+=e.prototype.iGetFragmentPostLightingCode.call(this,i,a,s,o,n)},t.MULTIPLY="multiply",t.ADD="add",t}(a);t.exports=s},{"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseSubSurfaceMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod"),a=e("awayjs-renderergl/lib/materials/passes/SingleObjectDepthPass"),s=function(e){function t(t,i,r){var s=this;void 0===t&&(t=512),void 0===i&&(i=15),void 0===r&&(r=null),e.call(this,null,r),this._translucency=1,this._scatterColor=16777215,this._scatterR=1,this._scatterG=1,this._scatterB=1,this.pBaseMethod._iModulateMethod=function(e,t,i,r,a){return s.scatterLight(e,t,i,r,a)},this._passes=new Array,this._depthPass=new a,this._depthPass.textureSize=t,this._depthPass.polyOffset=i,this._passes.push(this._depthPass),this._scattering=.2,this._translucency=1}return i(t,e),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i);var r=t.vertexConstantData,a=i.secondaryVertexConstantsIndex;r[a]=.5,r[a+1]=-.5,r[a+2]=0,r[a+3]=1,r=t.fragmentConstantData,a=i.secondaryFragmentConstantsIndex,r[a+3]=1,r[a+4]=1,r[a+5]=1/255,r[a+6]=1/65025,r[a+7]=1/16581375,r[a+10]=.5,r[a+11]=-.1},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._lightProjVarying=null,this._propReg=null,this._lightColorReg=null,this._colorReg=null,this._decReg=null,this._targetReg=null},Object.defineProperty(t.prototype,"scattering",{get:function(){return this._scattering},set:function(e){this._scattering=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translucency",{get:function(){return this._translucency},set:function(e){this._translucency=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scatterColor",{get:function(){return this._scatterColor},set:function(e){this._scatterColor=e,this._scatterR=(e>>16&255)/255,this._scatterG=(e>>8&255)/255,this._scatterB=(255&e)/255},enumerable:!0,configurable:!0}),t.prototype.iGetVertexCode=function(t,i,r,a){var s,o,n=e.prototype.iGetVertexCode.call(this,t,i,r,a),l=r.getFreeVertexVectorTemp();return o=r.getFreeVertexConstant(),i.secondaryVertexConstantsIndex=4*o.index,this._lightProjVarying=r.getFreeVarying(),s=r.getFreeVertexConstant(),r.getFreeVertexConstant(),r.getFreeVertexConstant(),r.getFreeVertexConstant(),n+="m44 "+l+", vt0, "+s+"\ndiv "+l+".xyz, "+l+".xyz, "+l+".w\nmul "+l+".xy, "+l+".xy, "+o+".xy\nadd "+l+".xy, "+l+".xy, "+o+".xx\nmov "+this._lightProjVarying+".xyz, "+l+".xyz\nmov "+this._lightProjVarying+".w, va0.w\n"},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._colorReg=r.getFreeFragmentConstant(),this._decReg=r.getFreeFragmentConstant(),this._propReg=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._colorReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t.prototype.iGetFragmentCodePerLight=function(t,i,r,a,s,o){return this._pIsFirstLight=!0,this._lightColorReg=a,e.prototype.iGetFragmentCodePerLight.call(this,t,i,r,a,s,o)},t.prototype.iGetFragmentPostLightingCode=function(t,i,r,a,s){var o=e.prototype.iGetFragmentPostLightingCode.call(this,t,i,r,a,s),n=a.getFreeFragmentVectorTemp();return o+="mul "+n+".xyz, "+this._lightColorReg+".xyz, "+this._targetReg+".w\nmul "+n+".xyz, "+n+".xyz, "+this._colorReg+".xyz\nadd "+r+".xyz, "+r+".xyz, "+n+".xyz\n",this._targetReg!=s.viewDirFragment&&a.removeFragmentTempUsage(r),o},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=i.secondaryFragmentConstantsIndex,s=t.fragmentConstantData;s[a]=this._scatterR,s[a+1]=this._scatterG,s[a+2]=this._scatterB,s[a+8]=this._scattering,s[a+9]=this._translucency},t.prototype.iSetRenderState=function(e,t,i,r){r.context.activateTexture(t.secondaryTexturesIndex,this._depthPass._iGetDepthMap(i)),this._depthPass._iGetProjection(i).copyRawDataTo(e.vertexConstantData,t.secondaryVertexConstantsIndex+4,!0)},t.prototype.scatterLight=function(e,t,i,r,a){if(!this._pIsFirstLight)return"";this._pIsFirstLight=!1;var s="",o=r.getFreeTextureReg();a.viewDirFragment?this._targetReg=a.viewDirFragment:(this._targetReg=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(this._targetReg,1)),t.secondaryTexturesIndex=o.index;var n=r.getFreeFragmentVectorTemp();return s+="tex "+n+", "+this._lightProjVarying+", "+o+" <2d,nearest,clamp>\ndp4 "+i+".z, "+n+", "+this._decReg+"\n",s+="sub "+i+".z, "+this._lightProjVarying+".z, "+i+".z\nsub "+i+".z, "+this._propReg+".x, "+i+".z\nmul "+i+".z, "+this._propReg+".y, "+i+".z\nsat "+i+".z, "+i+".z\nneg "+i+".y, "+i+".x\nmul "+i+".y, "+i+".y, "+this._propReg+".z\nadd "+i+".y, "+i+".y, "+this._propReg+".z\nmul "+this._targetReg+".w, "+i+".z, "+i+".y\nsub "+i+".y, "+this._colorReg+".w, "+this._targetReg+".w\nmul "+i+".w, "+i+".w, "+i+".y\n"},t}(r);t.exports=s},{"awayjs-renderergl/lib/materials/methods/DiffuseCompositeMethod":void 0,"awayjs-renderergl/lib/materials/passes/SingleObjectDepthPass":void 0}],"awayjs-renderergl/lib/materials/methods/DiffuseWrapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod"),a=function(e){function t(t){void 0===t&&(t=.5),e.call(this),this.wrapFactor=t}return i(t,e),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._wrapDataRegister=null},Object.defineProperty(t.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(e){this._wrapFactor=e,this._wrapFactor=1/(e+1)},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){var s=e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a);return this._pIsFirstLight=!0,this._wrapDataRegister=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._wrapDataRegister.index,s},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var o,n="";return this._pIsFirstLight?o=this._pTotalLightColorReg:(o=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(o,1)),n+="dp3 "+o+".x, "+i+".xyz, "+s.normalFragment+".xyz\nadd "+o+".y, "+o+".x, "+this._wrapDataRegister+".x\nmul "+o+".y, "+o+".y, "+this._wrapDataRegister+".y\nsat "+o+".w, "+o+".y\nmul "+o+".xz, "+o+".w, "+i+".wz\n",null!=this._iModulateMethod&&(n+=this._iModulateMethod(e,t,i,a,s)),n+="mul "+o+", "+o+".x, "+r+"\n",this._pIsFirstLight||(n+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n",a.removeFragmentTempUsage(o)),this._pIsFirstLight=!1,n},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=i.secondaryFragmentConstantsIndex,s=t.fragmentConstantData;s[a]=this._wrapFactor,s[a+1]=1/(this._wrapFactor+1)},t}(r);t.exports=a},{"awayjs-stagegl/lib/materials/methods/DiffuseBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/EffectAlphaMaskMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){void 0===i&&(i=!1),e.call(this),this._texture=t,this._useSecondaryUV=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsSecondaryUV=this._useSecondaryUV,t.needsUV=!this._useSecondaryUV},Object.defineProperty(t.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(e){this._useSecondaryUV!=e&&(this._useSecondaryUV=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){i.context.activateTexture(t.texturesIndex,this._texture)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var o=r.getFreeTextureReg(),n=r.getFreeFragmentVectorTemp(),l=this._useSecondaryUV?s.secondaryUVVarying:s.uvVarying;return t.texturesIndex=o.index,a.getTex2DSampleCode(n,s,o,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,l)+"mul "+i+", "+i+", "+n+".x\n"},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectColorMatrixMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(t){if(e.call(this),20!=t.length)throw new Error("Matrix length must be 20!");this._matrix=t}return i(t,e),Object.defineProperty(t.prototype,"colorMatrix",{get:function(){return this._matrix},set:function(e){this._matrix=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,i,r){var a="",s=r.getFreeFragmentConstant();r.getFreeFragmentConstant(),r.getFreeFragmentConstant(),r.getFreeFragmentConstant();var o=r.getFreeFragmentConstant();t.fragmentConstantsIndex=4*s.index;var n=r.getFreeFragmentVectorTemp();return a+="m44 "+n+", "+i+", "+s+"\nadd "+i+", "+n+", "+o+"\n"},t.prototype.iActivate=function(e,t){var i=this._matrix,r=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[r]=i[0],a[r+1]=i[1],a[r+2]=i[2],a[r+3]=i[3],a[r+4]=i[5],a[r+5]=i[6],a[r+6]=i[7],a[r+7]=i[8],a[r+8]=i[10],a[r+9]=i[11],a[r+10]=i[12],a[r+11]=i[13],a[r+12]=i[15],a[r+13]=i[16],a[r+14]=i[17],a[r+15]=i[18],a[r+16]=i[4],a[r+17]=i[9],a[r+18]=i[14],a[r+19]=i[19]},t}(r);t.exports=a},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/EffectEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){void 0===i&&(i=1),e.call(this),this._cubeTexture=t,this._alpha=i}return i(t,e),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){(e!=this._mask||e&&this._mask&&(e.hasMipmaps!=this._mask.hasMipmaps||e.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=e},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){e.fragmentConstantData[t.fragmentConstantsIndex]=this._alpha,i.context.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&i.context.activateTexture(t.texturesIndex+1,this._mask)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var o=r.getFreeFragmentConstant(),n=r.getFreeFragmentVectorTemp(),l="",h=r.getFreeTextureReg();t.texturesIndex=h.index,t.fragmentConstantsIndex=4*o.index,r.addFragmentTempUsages(n,1);var p=r.getFreeFragmentVectorTemp();return l+="dp3 "+n+".w, "+s.viewDirFragment+".xyz, "+s.normalFragment+".xyz\nadd "+n+".w, "+n+".w, "+n+".w\nmul "+n+".xyz, "+s.normalFragment+".xyz, "+n+".w\nsub "+n+".xyz, "+n+".xyz, "+s.viewDirFragment+".xyz\n"+a.getTexCubeSampleCode(n,h,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,n)+"sub "+p+".w, "+n+".w, fc0.x\nkil "+p+".w\nsub "+n+", "+n+", "+i+"\n",this._mask&&(l+=a.getTex2DSampleCode(p,s,r.getFreeTextureReg(),this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+n+", "+p+", "+n+"\n"),l+="mul "+n+", "+n+", "+o+".x\nadd "+i+", "+i+", "+n+"\n",r.removeFragmentTempUsage(n),l},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectFogMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(t,i,r){void 0===r&&(r=8421504),e.call(this),this._minDistance=0,this._maxDistance=1e3,this.minDistance=t,this.maxDistance=i,this.fogColor=r}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsProjection=!0},t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,r=t.fragmentConstantsIndex;i[r+3]=1,i[r+6]=0,i[r+7]=0},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},set:function(e){this._minDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(e){this._maxDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._fogColor},set:function(e){this._fogColor=e,this._fogR=(e>>16&255)/255,this._fogG=(e>>8&255)/255,this._fogB=(255&e)/255},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t){var i=e.fragmentConstantData,r=t.fragmentConstantsIndex;i[r]=this._fogR,i[r+1]=this._fogG,i[r+2]=this._fogB,i[r+4]=this._minDistance,i[r+5]=1/(this._maxDistance-this._minDistance)},t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s=r.getFreeFragmentConstant(),o=r.getFreeFragmentConstant(),n=r.getFreeFragmentVectorTemp();
r.addFragmentTempUsages(n,1);var l=r.getFreeFragmentVectorTemp(),h="";return t.fragmentConstantsIndex=4*s.index,h+="sub "+l+".w, "+a.projectionFragment+".z, "+o+".x\nmul "+l+".w, "+l+".w, "+o+".y\nsat "+l+".w, "+l+".w\nsub "+n+", "+s+", "+i+"\nmul "+n+", "+n+", "+l+".w\nadd "+i+", "+i+", "+n+"\n",r.removeFragmentTempUsage(n),h},t}(r);t.exports=a},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/EffectFresnelEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){void 0===i&&(i=1),e.call(this),this._fresnelPower=5,this._normalReflectance=0,this._cubeTexture=t,this._alpha=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0,t.needsUV=null!=this._mask},t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1},Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){(Boolean(e)!=Boolean(this._mask)||e&&this._mask&&(e.hasMipmaps!=this._mask.hasMipmaps||e.format!=this._mask.format))&&this.iInvalidateShaderProgram(),this._mask=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"envMap",{get:function(){return this._cubeTexture},set:function(e){this._cubeTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){var r=e.fragmentConstantData,a=t.fragmentConstantsIndex;r[a]=this._alpha,r[a+1]=this._normalReflectance,r[a+2]=this._fresnelPower,i.context.activateCubeTexture(t.texturesIndex,this._cubeTexture),this._mask&&i.context.activateTexture(t.texturesIndex+1,this._mask)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var o=r.getFreeFragmentConstant(),n=r.getFreeFragmentVectorTemp(),l="",h=r.getFreeTextureReg(),p=s.viewDirFragment,d=s.normalFragment;t.texturesIndex=h.index,t.fragmentConstantsIndex=4*o.index,r.addFragmentTempUsages(n,1);var c=r.getFreeFragmentVectorTemp();if(l+="dp3 "+n+".w, "+p+".xyz, "+d+".xyz\nadd "+n+".w, "+n+".w, "+n+".w\nmul "+n+".xyz, "+d+".xyz, "+n+".w\nsub "+n+".xyz, "+n+".xyz, "+p+".xyz\n"+a.getTexCubeSampleCode(n,h,this._cubeTexture,e.useSmoothTextures,e.useMipmapping,n)+"sub "+c+".w, "+n+".w, fc0.x\nkil "+c+".w\nsub "+n+", "+n+", "+i+"\n",l+="dp3 "+p+".w, "+p+".xyz, "+d+".xyz\nsub "+p+".w, "+o+".w, "+p+".w\npow "+p+".w, "+p+".w, "+o+".z\nsub "+d+".w, "+o+".w, "+p+".w\nmul "+d+".w, "+o+".y, "+d+".w\nadd "+p+".w, "+p+".w, "+d+".w\nmul "+p+".w, "+o+".x, "+p+".w\n",this._mask){var u=r.getFreeTextureReg();l+=a.getTex2DSampleCode(c,s,u,this._mask,e.useSmoothTextures,e.repeatTextures,e.useMipmapping)+"mul "+p+".w, "+c+".x, "+p+".w\n"}return l+="mul "+n+", "+n+", "+p+".w\nadd "+i+", "+i+", "+n+"\n",r.removeFragmentTempUsage(n),l},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectLightMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i,r){void 0===i&&(i="multiply"),void 0===r&&(r=!1),e.call(this),this._useSecondaryUV=r,this._texture=t,this.blendMode=i}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsUV=!this._useSecondaryUV,t.needsSecondaryUV=this._useSecondaryUV},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){if(e!=t.ADD&&e!=t.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){(e.hasMipmaps!=this._texture.hasMipmaps||e.format!=this._texture.format)&&this.iInvalidateShaderProgram(),this._texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){r.context.activateTexture(i.texturesIndex,this._texture),e.prototype.iActivate.call(this,t,i,r)},t.prototype.iGetFragmentCode=function(e,i,r,s,o){var n,l=s.getFreeTextureReg(),h=s.getFreeFragmentVectorTemp();switch(i.texturesIndex=l.index,n=a.getTex2DSampleCode(h,o,l,this._texture,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,this._useSecondaryUV?o.secondaryUVVarying:o.uvVarying),this._blendMode){case t.MULTIPLY:n+="mul "+r+", "+r+", "+h+"\n";break;case t.ADD:n+="add "+r+", "+r+", "+h+"\n"}return n},t.MULTIPLY="multiply",t.ADD="add",t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectRefractionEnvMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i,r,a,s){void 0===i&&(i=.1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===s&&(s=0),e.call(this),this._dispersionR=0,this._dispersionG=0,this._dispersionB=0,this._alpha=1,this._envMap=t,this._dispersionR=r,this._dispersionG=a,this._dispersionB=s,this._useDispersion=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG),this._refractionIndex=i}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i+4]=1,r[i+5]=0,r[i+7]=1},t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(t.prototype,"envMap",{get:function(){return this._envMap},set:function(e){this._envMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(e){this._refractionIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(e){this._dispersionR=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(e){this._dispersionG=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(e){this._dispersionB=e;var t=!(this._dispersionR==this._dispersionB&&this._dispersionR==this._dispersionG);this._useDispersion!=t&&(this.iInvalidateShaderProgram(),this._useDispersion=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){var r=t.fragmentConstantsIndex,a=e.fragmentConstantData;a[r]=this._dispersionR+this._refractionIndex,this._useDispersion&&(a[r+1]=this._dispersionG+this._refractionIndex,a[r+2]=this._dispersionB+this._refractionIndex),a[r+3]=this._alpha,i.context.activateCubeTexture(t.texturesIndex,this._envMap)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var o,n,l,h=r.getFreeFragmentConstant(),p=r.getFreeFragmentConstant(),d="",c=r.getFreeTextureReg();t.texturesIndex=c.index,t.fragmentConstantsIndex=4*h.index,o=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(o,1),n=r.getFreeFragmentVectorTemp(),r.addFragmentTempUsages(n,1),l=r.getFreeFragmentVectorTemp();var u=s.viewDirFragment,_=s.normalFragment;return d+="neg "+u+".xyz, "+u+".xyz\n",d+="dp3 "+l+".x, "+u+".xyz, "+_+".xyz\nmul "+l+".w, "+l+".x, "+l+".x\nsub "+l+".w, "+p+".x, "+l+".w\nmul "+l+".w, "+h+".x, "+l+".w\nmul "+l+".w, "+h+".x, "+l+".w\nsub "+l+".w, "+p+".x, "+l+".w\nsqt "+l+".y, "+l+".w\nmul "+l+".x, "+h+".x, "+l+".x\nadd "+l+".x, "+l+".x, "+l+".y\nmul "+l+".xyz, "+l+".x, "+_+".xyz\nmul "+o+", "+h+".x, "+u+"\nsub "+o+".xyz, "+o+".xyz, "+l+".xyz\nnrm "+o+".xyz, "+o+".xyz\n",d+=a.getTexCubeSampleCode(n,c,this._envMap,e.useSmoothTextures,e.useMipmapping,o)+"sub "+n+".w, "+n+".w, fc0.x	\nkil "+n+".w\n",this._useDispersion&&(d+="dp3 "+l+".x, "+u+".xyz, "+_+".xyz\nmul "+l+".w, "+l+".x, "+l+".x\nsub "+l+".w, "+p+".x, "+l+".w\nmul "+l+".w, "+h+".y, "+l+".w\nmul "+l+".w, "+h+".y, "+l+".w\nsub "+l+".w, "+p+".x, "+l+".w\nsqt "+l+".y, "+l+".w\nmul "+l+".x, "+h+".y, "+l+".x\nadd "+l+".x, "+l+".x, "+l+".y\nmul "+l+".xyz, "+l+".x, "+_+".xyz\nmul "+o+", "+h+".y, "+u+"\nsub "+o+".xyz, "+o+".xyz, "+l+".xyz\nnrm "+o+".xyz, "+o+".xyz\n",d+=a.getTexCubeSampleCode(l,c,this._envMap,e.useSmoothTextures,e.useMipmapping,o)+"mov "+n+".y, "+l+".y\n",d+="dp3 "+l+".x, "+u+".xyz, "+_+".xyz\nmul "+l+".w, "+l+".x, "+l+".x\nsub "+l+".w, "+p+".x, "+l+".w\nmul "+l+".w, "+h+".z, "+l+".w\nmul "+l+".w, "+h+".z, "+l+".w\nsub "+l+".w, "+p+".x, "+l+".w\nsqt "+l+".y, "+l+".w\nmul "+l+".x, "+h+".z, "+l+".x\nadd "+l+".x, "+l+".x, "+l+".y\nmul "+l+".xyz, "+l+".x, "+_+".xyz\nmul "+o+", "+h+".z, "+u+"\nsub "+o+".xyz, "+o+".xyz, "+l+".xyz\nnrm "+o+".xyz, "+o+".xyz\n",d+=a.getTexCubeSampleCode(l,c,this._envMap,e.useSmoothTextures,e.useMipmapping,o)+"mov "+n+".z, "+l+".z\n"),r.removeFragmentTempUsage(o),d+="sub "+n+".xyz, "+n+".xyz, "+i+".xyz\nmul "+n+".xyz, "+n+".xyz, "+h+".w\nadd "+i+".xyz, "+i+".xyz, "+n+".xyz\n",r.removeFragmentTempUsage(n),d+="neg "+u+".xyz, "+u+".xyz\n"},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/EffectRimLightMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/EffectMethodBase"),a=function(e){function t(t,i,r,a){void 0===t&&(t=16777215),void 0===i&&(i=.4),void 0===r&&(r=2),void 0===a&&(a="mix"),e.call(this),this._blendMode=a,this._strength=i,this._power=r,this.color=t}return i(t,e),t.prototype.iInitConstants=function(e,t){e.fragmentConstantData[t.fragmentConstantsIndex+3]=1},t.prototype.iInitVO=function(e,t){t.needsNormals=!0,t.needsView=!0},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this._blendMode!=e&&(this._blendMode=e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this._colorR=(e>>16&255)/255,this._colorG=(e>>8&255)/255,this._colorB=(255&e)/255},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._strength},set:function(e){this._strength=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._power},set:function(e){this._power=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i]=this._colorR,r[i+1]=this._colorG,r[i+2]=this._colorB,r[i+4]=this._strength,r[i+5]=this._power},t.prototype.iGetFragmentCode=function(e,i,r,a,s){var o=a.getFreeFragmentConstant(),n=a.getFreeFragmentConstant(),l=a.getFreeFragmentVectorTemp(),h="";return i.fragmentConstantsIndex=4*o.index,h+="dp3 "+l+".x, "+s.viewDirFragment+".xyz, "+s.normalFragment+".xyz\nsat "+l+".x, "+l+".x\nsub "+l+".x, "+o+".w, "+l+".x\npow "+l+".x, "+l+".x, "+n+".y\nmul "+l+".x, "+l+".x, "+n+".x\nsub "+l+".x, "+o+".w, "+l+".x\nmul "+r+".xyz, "+r+".xyz, "+l+".x\nsub "+l+".w, "+o+".w, "+l+".x\n",h+=this._blendMode==t.ADD?"mul "+l+".xyz, "+l+".w, "+o+".xyz\nadd "+r+".xyz, "+r+".xyz, "+l+".xyz\n":this._blendMode==t.MULTIPLY?"mul "+l+".xyz, "+l+".w, "+o+".xyz\nmul "+r+".xyz, "+r+".xyz, "+l+".xyz\n":"sub "+l+".xyz, "+o+".xyz, "+r+".xyz\nmul "+l+".xyz, "+l+".xyz, "+l+".w\nadd "+r+".xyz, "+r+".xyz, "+l+".xyz\n"},t.ADD="add",t.MULTIPLY="multiply",t.MIX="mix",t}(r);t.exports=a},{"awayjs-stagegl/lib/materials/methods/EffectMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/NormalHeightMapMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/NormalBasicMethod"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i,r,a){e.call(this),this.normalMap=t,this._worldXYRatio=i/r,this._worldXZRatio=a/r}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i]=1/this.normalMap.width,r[i+1]=1/this.normalMap.height,r[i+2]=0,r[i+3]=1,r[i+4]=this._worldXYRatio,r[i+5]=this._worldXZRatio},Object.defineProperty(t.prototype,"tangentSpace",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.copyFrom=function(t){e.prototype.copyFrom.call(this,t),this._worldXYRatio=t._worldXYRatio,this._worldXZRatio=t._worldXZRatio},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var o=r.getFreeFragmentVectorTemp(),n=r.getFreeFragmentConstant(),l=r.getFreeFragmentConstant();return this._pNormalTextureRegister=r.getFreeTextureReg(),t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*n.index,a.getTex2DSampleCode(i,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,s.uvVarying,"clamp")+"add "+o+", "+s.uvVarying+", "+n+".xzzz\n"+a.getTex2DSampleCode(o,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,o,"clamp")+"sub "+i+".x, "+i+".x, "+o+".x\nadd "+o+", "+s.uvVarying+", "+n+".zyzz\n"+a.getTex2DSampleCode(o,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,o,"clamp")+"sub "+i+".z, "+i+".z, "+o+".x\nmov "+i+".y, "+n+".w\nmul "+i+".xz, "+i+".xz, "+l+".xy\nnrm "+i+".xyz, "+i+".xyz\n"},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/NormalBasicMethod":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/NormalSimpleWaterMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/NormalBasicMethod"),a=e("awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper"),s=function(e){function t(t,i){e.call(this),this._useSecondNormalMap=!1,this._water1OffsetX=0,this._water1OffsetY=0,this._water2OffsetX=0,this._water2OffsetY=0,this.normalMap=t,this.secondaryNormalMap=i}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.fragmentConstantsIndex,r=e.fragmentConstantData;r[i]=.5,r[i+1]=0,r[i+2]=0,r[i+3]=1},t.prototype.iInitVO=function(t,i){e.prototype.iInitVO.call(this,t,i),this._useSecondNormalMap=this.normalMap!=this.secondaryNormalMap},Object.defineProperty(t.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(e){this._water1OffsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(e){this._water1OffsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(e){this._water2OffsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(e){this._water2OffsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryNormalMap",{get:function(){return this._texture2},set:function(e){this._texture2=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._normalTextureRegister2=null},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._texture2=null},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=t.fragmentConstantData,s=i.fragmentConstantsIndex;a[s+4]=this._water1OffsetX,a[s+5]=this._water1OffsetY,a[s+6]=this._water2OffsetX,a[s+7]=this._water2OffsetY,this._useSecondNormalMap&&r.context.activateTexture(i.texturesIndex+1,this._texture2)},t.prototype.iGetFragmentCode=function(e,t,i,r,s){var o=r.getFreeFragmentVectorTemp(),n=r.getFreeFragmentConstant(),l=r.getFreeFragmentConstant();return this._pNormalTextureRegister=r.getFreeTextureReg(),this._normalTextureRegister2=this._useSecondNormalMap?r.getFreeTextureReg():this._pNormalTextureRegister,t.texturesIndex=this._pNormalTextureRegister.index,t.fragmentConstantsIndex=4*n.index,"add "+o+", "+s.uvVarying+", "+l+".xyxy\n"+a.getTex2DSampleCode(i,s,this._pNormalTextureRegister,this.normalMap,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,o)+"add "+o+", "+s.uvVarying+", "+l+".zwzw\n"+a.getTex2DSampleCode(o,s,this._normalTextureRegister2,this._texture2,e.useSmoothTextures,e.repeatTextures,e.useMipmapping,o)+"add "+i+", "+i+", "+o+"		\nmul "+i+", "+i+", "+n+".x	\nsub "+i+".xyz, "+i+".xyz, "+s.commons+".xxx	\nnrm "+i+".xyz, "+i+".xyz							\n"},t}(r);t.exports=s},{"awayjs-stagegl/lib/materials/methods/NormalBasicMethod":void 0,"awayjs-stagegl/lib/materials/utils/ShaderCompilerHelper":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowCascadeMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/events/Event"),a=e("awayjs-display/lib/entities/DirectionalLight"),s=e("awayjs-stagegl/lib/events/ShadingMethodEvent"),o=e("awayjs-stagegl/lib/materials/compilation/MethodVO"),n=e("awayjs-stagegl/lib/materials/methods/ShadowMapMethodBase"),l=function(e){function t(t){var i=this;if(e.call(this,t.castingLight),this._baseMethod=t,!(this._pCastingLight instanceof a))throw new Error("ShadowCascadeMethod is only compatible with DirectionalLight");if(this._cascadeShadowMapper=this._pCastingLight.shadowMapper,!this._cascadeShadowMapper)throw new Error("ShadowCascadeMethod requires a light that has a CascadeShadowMapper instance assigned to shadowMapper.");this._cascadeShadowMapper.addEventListener(r.CHANGE,function(e){return i.onCascadeChange(e)}),this._baseMethod.addEventListener(s.SHADER_INVALIDATED,function(e){return i.onShaderInvalidated(e)})}return i(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){var t=this;this._baseMethod!=e&&(this._baseMethod.removeEventListener(s.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)}),this._baseMethod=e,this._baseMethod.addEventListener(s.SHADER_INVALIDATED,function(e){return t.onShaderInvalidated(e)}),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(e,t){var i=new o(this._baseMethod);this._baseMethod.iInitVO(e,i),t.needsGlobalVertexPos=!0,t.needsProjection=!0},t.prototype.iInitConstants=function(e,t){var i=e.fragmentConstantData,r=e.vertexConstantData,a=t.fragmentConstantsIndex;i[a]=1,i[a+1]=1/255,i[a+2]=1/65025,i[a+3]=1/16581375,i[a+6]=.5,i[a+7]=-.5,a=t.vertexConstantsIndex,r[a]=.5,r[a+1]=-.5,r[a+2]=0},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._cascadeProjections=null,this._depthMapCoordVaryings=null},t.prototype.iGetVertexCode=function(e,t,i,r){var a="",s=i.getFreeVertexConstant();this.initProjectionsRegs(i),t.vertexConstantsIndex=4*s.index;for(var o=i.getFreeVertexVectorTemp(),n=0;n<this._cascadeShadowMapper.numCascades;++n)a+="m44 "+o+", "+r.globalPositionVertex+", "+this._cascadeProjections[n]+"\nadd "+this._depthMapCoordVaryings[n]+", "+o+", "+s+".zzwz\n";return a},t.prototype.initProjectionsRegs=function(e){this._cascadeProjections=new Array(this._cascadeShadowMapper.numCascades),this._depthMapCoordVaryings=new Array(this._cascadeShadowMapper.numCascades);for(var t=0;t<this._cascadeShadowMapper.numCascades;++t)this._depthMapCoordVaryings[t]=e.getFreeVarying(),this._cascadeProjections[t]=e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant()},t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s,o=this._cascadeShadowMapper.numCascades,n=r.getFreeTextureReg(),l=r.getFreeFragmentConstant(),h=r.getFreeFragmentConstant(),p=r.getFreeFragmentConstant(),d=Array(p+".x",p+".y",p+".z",p+".w");t.fragmentConstantsIndex=4*l.index,t.texturesIndex=n.index;var c=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(c,1);var u=r.getFreeFragmentVectorTemp();r.addFragmentTempUsages(u,1),s="mov "+u+", "+this._depthMapCoordVaryings[o-1]+"\n";for(var _=o-2;_>=0;--_){var y=this._depthMapCoordVaryings[_];s+="slt "+c+".z, "+a.projectionFragment+".z, "+d[_]+"\n";var m=r.getFreeFragmentVectorTemp();s+="sub "+m+", "+y+", "+u+"\nmul "+m+", "+m+", "+c+".z\nadd "+u+", "+u+", "+m+"\n"}return r.removeFragmentTempUsage(c),s+="div "+u+", "+u+", "+u+".w\nmul "+u+".xy, "+u+".xy, "+h+".zw\nadd "+u+".xy, "+u+".xy, "+h+".zz\n",s+=this._baseMethod._iGetCascadeFragmentCode(e,t,l,n,u,i,r,a)+"add "+i+".w, "+i+".w, "+h+".y\n",r.removeFragmentTempUsage(u),s},t.prototype.iActivate=function(e,t,i){i.context.activateTexture(t.texturesIndex,this._pCastingLight.shadowMapper.depthMap);var r=e.vertexConstantData,a=t.vertexConstantsIndex;e.vertexConstantData[t.vertexConstantsIndex+3]=-1/(this._cascadeShadowMapper.depth*this._pEpsilon);var s=this._cascadeShadowMapper.numCascades;a+=4;for(var o=0;s>o;++o)this._cascadeShadowMapper.getDepthProjections(o).copyRawDataTo(r,a,!0),a+=16;var n=e.fragmentConstantData,l=t.fragmentConstantsIndex;n[l+5]=1-this._pAlpha;var h=this._cascadeShadowMapper._iNearPlaneDistances;l+=8;for(var p=0;s>p;++p)n[l+p]=h[p];this._baseMethod.iActivateForCascade(e,t,i)},t.prototype.iSetRenderState=function(){},t.prototype.onCascadeChange=function(){this.iInvalidateShaderProgram()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(n);t.exports=l},{"awayjs-core/lib/events/Event":void 0,"awayjs-display/lib/entities/DirectionalLight":void 0,"awayjs-stagegl/lib/events/ShadingMethodEvent":void 0,"awayjs-stagegl/lib/materials/compilation/MethodVO":void 0,"awayjs-stagegl/lib/materials/methods/ShadowMapMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowDitheredMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-core/lib/textures/BitmapTexture"),s=e("awayjs-stagegl/lib/materials/methods/ShadowMethodBase"),o=function(e){function t(i,r,a){void 0===r&&(r=4),void 0===a&&(a=1),e.call(this,i),this._depthMapSize=this._pCastingLight.shadowMapper.depthMapSize,this.numSamples=r,this.range=a,++t._grainUsages,t._grainTexture||this.initGrainTexture()}return i(t,e),Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e,this._numSamples<1?this._numSamples=1:this._numSamples>24&&(this._numSamples=24),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),t.prototype.iInitVO=function(t,i){e.prototype.iInitVO.call(this,t,i),i.needsProjection=!0},t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i);var r=t.fragmentConstantData,a=i.fragmentConstantsIndex;r[a+8]=1/this._numSamples},Object.defineProperty(t.prototype,"range",{get:function(){return 2*this._range},set:function(e){this._range=e/2},enumerable:!0,configurable:!0}),t.prototype.initGrainTexture=function(){t._grainBitmapData=new r(64,64,!1);for(var e,i,s=new Array,o=4096,n=1/(this._depthMapSize*this._range),l=0;o>l;++l)e=2*(Math.random()-.5),i=2*(Math.random()-.5),0>e?e-=n:e+=n,0>i?i-=n:i+=n,e>1?e=1:-1>e&&(e=-1),i>1?i=1:-1>i&&(i=-1),s[l]=Math.floor(255*(.5*e+.5))<<16|Math.floor(255*(.5*i+.5))<<8;t._grainBitmapData.setVector(t._grainBitmapData.rect,s),t._grainTexture=new a(t._grainBitmapData)},t.prototype.dispose=function(){0==--t._grainUsages&&(t._grainTexture.dispose(),t._grainBitmapData.dispose(),t._grainTexture=null)},t.prototype.iActivate=function(i,r,a){e.prototype.iActivate.call(this,i,r,a);var s=i.fragmentConstantData,o=r.fragmentConstantsIndex;s[o+9]=(a.width-1)/63,s[o+10]=(a.height-1)/63,s[o+11]=2*this._range/this._depthMapSize,a.context.activateTexture(r.texturesIndex+1,t._grainTexture)},t.prototype._pGetPlanarFragmentCode=function(e,t,i,r){var a=i.getFreeTextureReg(),s=i.getFreeFragmentConstant(),o=(i.getFreeFragmentConstant(),i.getFreeFragmentConstant());return e.fragmentConstantsIndex=4*s.index,e.texturesIndex=a.index,this.getSampleCode(o,a,s,t,i,r)},t.prototype.getSampleCode=function(e,t,i,r,a,s){var o="",n=a.getFreeTextureReg(),l=a.getFreeFragmentVectorTemp(),h=this._numSamples;a.addFragmentTempUsages(l,1);var p=a.getFreeFragmentVectorTemp(),d=s.projectionFragment;for(o+="div "+l+", "+d+", "+d+".w\nmul "+l+".xy, "+l+".xy, "+e+".yz\n";h>0;)o+=h==this._numSamples?"tex "+l+", "+l+", "+n+" <2d,nearest,repeat,mipnone>\n":"tex "+l+", "+l+".zwxy, "+n+" <2d,nearest,repeat,mipnone>\n",o+="sub "+l+".zw, "+l+".xy, fc0.xx\nmul "+l+".zw, "+l+".zw, "+e+".w\n",o+=h==this._numSamples?"add "+l+".xy, "+l+".zw, "+this._pDepthMapCoordReg+".xy\ntex "+p+", "+l+", "+t+" <2d,nearest,clamp,mipnone>\ndp4 "+p+".z, "+p+", "+i+"\nslt "+r+".w, "+this._pDepthMapCoordReg+".z, "+p+".z\n":this.addSample(l,t,i,r,a),h>4&&(o+="add "+l+".xy, "+l+".xy, "+l+".zw\n"+this.addSample(l,t,i,r,a)),h>1&&(o+="sub "+l+".xy, "+this._pDepthMapCoordReg+".xy, "+l+".zw\n"+this.addSample(l,t,i,r,a)),h>5&&(o+="sub "+l+".xy, "+l+".xy, "+l+".zw\n"+this.addSample(l,t,i,r,a)),h>2&&(o+="neg "+l+".w, "+l+".w\n",o+="add "+l+".xy, "+l+".wz, "+this._pDepthMapCoordReg+".xy\n"+this.addSample(l,t,i,r,a)),h>6&&(o+="add "+l+".xy, "+l+".xy, "+l+".wz\n"+this.addSample(l,t,i,r,a)),h>3&&(o+="sub "+l+".xy, "+this._pDepthMapCoordReg+".xy, "+l+".wz\n"+this.addSample(l,t,i,r,a)),h>7&&(o+="sub "+l+".xy, "+l+".xy, "+l+".wz\n"+this.addSample(l,t,i,r,a)),h-=8;return a.removeFragmentTempUsage(l),o+="mul "+r+".w, "+r+".w, "+e+".x\n"},t.prototype.addSample=function(e,t,i,r,a){var s=a.getFreeFragmentVectorTemp();return"tex "+s+", "+e+", "+t+" <2d,nearest,clamp,mipnone>\ndp4 "+s+".z, "+s+", "+i+"\nslt "+s+".z, "+this._pDepthMapCoordReg+".z, "+s+".z\nadd "+r+".w, "+r+".w, "+s+".z\n"},t.prototype.iActivateForCascade=function(e,i,r){var a=e.fragmentConstantData,s=i.secondaryFragmentConstantsIndex;a[s]=1/this._numSamples,a[s+1]=(r.width-1)/63,a[s+2]=(r.height-1)/63,a[s+3]=2*this._range/this._depthMapSize,r.context.activateTexture(i.texturesIndex+1,t._grainTexture)},t.prototype._iGetCascadeFragmentCode=function(e,t,i,r,a,s,o,n){this._pDepthMapCoordReg=a;var l=o.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*l.index,this.getSampleCode(l,r,i,s,o,n)},t}(s);t.exports=o},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/textures/BitmapTexture":void 0,"awayjs-stagegl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowFilteredMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/ShadowMethodBase"),a=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i);var r=t.fragmentConstantData,a=i.fragmentConstantsIndex;r[a+8]=.5;var s=this.castingLight.shadowMapper.depthMapSize;r[a+9]=s,r[a+10]=1/s},t.prototype._pGetPlanarFragmentCode=function(e,t,i){var r=i.getFreeTextureReg(),a=i.getFreeFragmentConstant(),s=i.getFreeFragmentConstant();s=s;var o,n=i.getFreeFragmentConstant(),l=i.getFreeFragmentVectorTemp(),h="";return e.fragmentConstantsIndex=4*a.index,i.addFragmentTempUsages(l,1),o=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(o,1),h+="mov "+o+", "+this._pDepthMapCoordReg+"\ntex "+l+", "+this._pDepthMapCoordReg+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+a+"\nslt "+o+".z, "+this._pDepthMapCoordReg+".z, "+l+".z\nadd "+o+".x, "+this._pDepthMapCoordReg+".x, "+n+".z\ntex "+l+", "+o+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+a+"\nslt "+o+".w, "+this._pDepthMapCoordReg+".z, "+l+".z\nmul "+l+".x, "+this._pDepthMapCoordReg+".x, "+n+".y\nfrc "+l+".x, "+l+".x\nsub "+o+".w, "+o+".w, "+o+".z\nmul "+o+".w, "+o+".w, "+l+".x\nadd "+t+".w, "+o+".z, "+o+".w\nmov "+o+".x, "+this._pDepthMapCoordReg+".x\nadd "+o+".y, "+this._pDepthMapCoordReg+".y, "+n+".z\ntex "+l+", "+o+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+a+"\nslt "+o+".z, "+this._pDepthMapCoordReg+".z, "+l+".z\nadd "+o+".x, "+this._pDepthMapCoordReg+".x, "+n+".z\ntex "+l+", "+o+", "+r+" <2d, nearest, clamp>\ndp4 "+l+".z, "+l+", "+a+"\nslt "+o+".w, "+this._pDepthMapCoordReg+".z, "+l+".z\nmul "+l+".x, "+this._pDepthMapCoordReg+".x, "+n+".y\nfrc "+l+".x, "+l+".x\nsub "+o+".w, "+o+".w, "+o+".z\nmul "+o+".w, "+o+".w, "+l+".x\nadd "+o+".w, "+o+".z, "+o+".w\nmul "+l+".x, "+this._pDepthMapCoordReg+".y, "+n+".y\nfrc "+l+".x, "+l+".x\nsub "+o+".w, "+o+".w, "+t+".w\nmul "+o+".w, "+o+".w, "+l+".x\nadd "+t+".w, "+t+".w, "+o+".w\n",i.removeFragmentTempUsage(l),i.removeFragmentTempUsage(o),e.texturesIndex=r.index,h},t.prototype.iActivateForCascade=function(e,t){var i=this.castingLight.shadowMapper.depthMapSize,r=t.secondaryFragmentConstantsIndex,a=e.fragmentConstantData;a[r]=i,a[r+1]=1/i},t.prototype._iGetCascadeFragmentCode=function(e,t,i,r,a,s,o){var n,l=o.getFreeFragmentConstant();t.secondaryFragmentConstantsIndex=4*l.index;var h=o.getFreeFragmentVectorTemp();o.addFragmentTempUsages(h,1);var p=o.getFreeFragmentVectorTemp();return o.addFragmentTempUsages(p,1),n="tex "+h+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".x, "+a+".z, "+h+".z\nadd "+a+".x, "+a+".x, "+l+".y\ntex "+h+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".z, "+a+".z, "+h+".z\nadd "+a+".y, "+a+".y, "+l+".y\ntex "+h+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".w, "+a+".z, "+h+".z\nsub "+a+".x, "+a+".x, "+l+".y\ntex "+h+", "+a+", "+r+" <2d, nearest, clamp>\ndp4 "+h+".z, "+h+", "+i+"\nslt "+p+".y, "+a+".z, "+h+".z\nmul "+h+".xy, "+a+".xy, "+l+".x\nfrc "+h+".xy, "+h+".xy\nsub "+a+", "+p+".xyzw, "+p+".zwxy\nmul "+a+", "+a+", "+h+".x\nadd "+p+".xy, "+p+".xy, "+a+".zw\nsub "+p+".y, "+p+".y, "+p+".x\nmul "+p+".y, "+p+".y, "+h+".y\nadd "+s+".w, "+p+".x, "+p+".y\n",o.removeFragmentTempUsage(h),o.removeFragmentTempUsage(p),n},t}(r);t.exports=a},{"awayjs-stagegl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowNearMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i
},r=e("awayjs-stagegl/lib/events/ShadingMethodEvent"),a=e("awayjs-stagegl/lib/materials/methods/ShadowMethodBase"),s=function(e){function t(t,i){var a=this;if(void 0===i&&(i=.1),e.call(this,t.castingLight),this._onShaderInvalidatedDelegate=function(e){return a.onShaderInvalidated(e)},this._baseMethod=t,this._fadeRatio=i,this._nearShadowMapper=this._pCastingLight.shadowMapper,!this._nearShadowMapper)throw new Error("ShadowNearMethod requires a light that has a NearDirectionalShadowMapper instance assigned to shadowMapper.");this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return i(t,e),Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){this._baseMethod!=e&&(this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=e,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i),this._baseMethod.iInitConstants(t,i);var r=t.fragmentConstantData,a=i.secondaryFragmentConstantsIndex;r[a+2]=0,r[a+3]=1},t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t),t.needsProjection=!0},t.prototype.dispose=function(){this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)},Object.defineProperty(t.prototype,"alpha",{get:function(){return this._baseMethod.alpha},set:function(e){this._baseMethod.alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"epsilon",{get:function(){return this._baseMethod.epsilon},set:function(e){this._baseMethod.epsilon=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(e){this._fadeRatio=e},enumerable:!0,configurable:!0}),t.prototype.iGetFragmentCode=function(e,t,i,r,a){var s=this._baseMethod.iGetFragmentCode(e,t,i,r,a),o=r.getFreeFragmentConstant(),n=r.getFreeFragmentSingleTemp();return t.secondaryFragmentConstantsIndex=4*o.index,s+="abs "+n+", "+a.projectionFragment+".w\nsub "+n+", "+n+", "+o+".x\nmul "+n+", "+n+", "+o+".y\nsat "+n+", "+n+"\nsub "+n+", "+o+".w,"+n+"\nsub "+i+".w, "+o+".w,"+i+".w\nmul "+i+".w, "+i+".w, "+n+"\nsub "+i+".w, "+o+".w,"+i+".w\n"},t.prototype.iActivate=function(e,t,i){this._baseMethod.iActivate(e,t,i)},t.prototype.iDeactivate=function(e,t,i){this._baseMethod.iDeactivate(e,t,i)},t.prototype.iSetRenderState=function(e,t,i,r,a){var s=a.projection.near,o=a.projection.far-s,n=this._nearShadowMapper.coverageRatio,l=n*(1-this._fadeRatio);n=s+n*o,l=s+l*o;var h=e.fragmentConstantData,p=t.secondaryFragmentConstantsIndex;h[p]=l,h[p+1]=1/(n-l),this._baseMethod.iSetRenderState(e,t,i,r,a)},t.prototype.iGetVertexCode=function(e,t,i,r){return this._baseMethod.iGetVertexCode(e,t,i,r)},t.prototype.iReset=function(){this._baseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(a);t.exports=s},{"awayjs-stagegl/lib/events/ShadingMethodEvent":void 0,"awayjs-stagegl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/ShadowSoftMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/PoissonLookup"),a=e("awayjs-stagegl/lib/materials/methods/ShadowMethodBase"),s=function(e){function t(t,i,r){void 0===i&&(i=5),void 0===r&&(r=1),e.call(this,t),this._range=1,this.numSamples=i,this.range=r}return i(t,e),Object.defineProperty(t.prototype,"numSamples",{get:function(){return this._numSamples},set:function(e){this._numSamples=e,this._numSamples<1?this._numSamples=1:this._numSamples>32&&(this._numSamples=32),this._offsets=r.getDistribution(this._numSamples),this.iInvalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e},enumerable:!0,configurable:!0}),t.prototype.iInitConstants=function(t,i){e.prototype.iInitConstants.call(this,t,i),t.fragmentConstantData[i.fragmentConstantsIndex+8]=1/this._numSamples,t.fragmentConstantData[i.fragmentConstantsIndex+9]=0},t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);for(var a=.5*this._range/this._pCastingLight.shadowMapper.depthMapSize,s=t.fragmentConstantData,o=i.fragmentConstantsIndex+10,n=this._numSamples<<1,l=0;n>l;++l)s[o+l]=this._offsets[l]*a},t.prototype._pGetPlanarFragmentCode=function(e,t,i){var r=i.getFreeTextureReg(),a=i.getFreeFragmentConstant(),s=(i.getFreeFragmentConstant(),i.getFreeFragmentConstant());return e.fragmentConstantsIndex=4*a.index,e.texturesIndex=r.index,this.getSampleCode(i,r,a,t,s)},t.prototype.addSample=function(e,t,i,r,a){var s=a.getFreeFragmentVectorTemp();return"tex "+s+", "+e+", "+t+" <2d,nearest,clamp>\ndp4 "+s+".z, "+s+", "+i+"\nslt "+e+".w, "+this._pDepthMapCoordReg+".z, "+s+".z\nadd "+r+".w, "+r+".w, "+e+".w\n"},t.prototype.iActivateForCascade=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=this._range/this._pCastingLight.shadowMapper.depthMapSize,s=t.fragmentConstantData,o=i.secondaryFragmentConstantsIndex,n=this._numSamples<<1;s[o]=1/this._numSamples,s[o+1]=0,o+=2;for(var l=0;n>l;++l)s[o+l]=this._offsets[l]*a;n%4==0&&(s[o+n]=0,s[o+n+1]=0)},t.prototype._iGetCascadeFragmentCode=function(e,t,i,r,a,s,o){this._pDepthMapCoordReg=a;var n=o.getFreeFragmentConstant();return t.secondaryFragmentConstantsIndex=4*n.index,this.getSampleCode(o,r,i,s,n)},t.prototype.getSampleCode=function(e,t,i,r,a){var s,o,n=new Array(a+".zw");s=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(s,1);for(var l=e.getFreeFragmentVectorTemp(),h=this._numSamples>>1,p=0;h>p;++p){var d=e.getFreeFragmentConstant();n.push(d+".xy"),n.push(d+".zw")}for(p=0;p<this._numSamples;++p)0==p?o="add "+s+", "+this._pDepthMapCoordReg+", "+a+".zwyy\ntex "+l+", "+s+", "+t+" <2d,nearest,clamp>\ndp4 "+l+".z, "+l+", "+i+"\nslt "+r+".w, "+this._pDepthMapCoordReg+".z, "+l+".z\n":o+="add "+s+".xy, "+this._pDepthMapCoordReg+".xy, "+n[p]+"\n"+this.addSample(s,t,i,r,e);return e.removeFragmentTempUsage(s),o+="mul "+r+".w, "+r+".w, "+a+".x\n"},t}(a);t.exports=s},{"awayjs-core/lib/geom/PoissonLookup":void 0,"awayjs-stagegl/lib/materials/methods/ShadowMethodBase":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularAnisotropicMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/SpecularBasicMethod"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iInitVO=function(e,t){t.needsTangents=!0,t.needsView=!0},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var o,n="";return this._pIsFirstLight?o=this._pTotalLightColorReg:(o=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(o,1)),n+="nrm "+o+".xyz, "+s.tangentVarying+".xyz\ndp3 "+o+".w, "+o+".xyz, "+i+".xyz\ndp3 "+o+".z, "+o+".xyz, "+s.viewDirFragment+".xyz\n",n+="sin "+o+".x, "+o+".w\nsin "+o+".y, "+o+".z\nmul "+o+".x, "+o+".x, "+o+".y\ncos "+o+".z, "+o+".z\ncos "+o+".w, "+o+".w\nmul "+o+".w, "+o+".w, "+o+".z\nsub "+o+".w, "+o+".x, "+o+".w\n",n+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+o+".w, "+o+".w, "+this._pSpecularTexData+".w\n":"pow "+o+".w, "+o+".w, "+this._pSpecularDataRegister+".w\n",n+="mul "+o+".w, "+o+".w, "+i+".w\n",null!=this._iModulateMethod&&(n+=this._iModulateMethod(e,t,o,a,s)),n+="mul "+o+".xyz, "+r+".xyz, "+o+".w\n",this._pIsFirstLight||(n+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n",a.removeFragmentTempUsage(o)),this._pIsFirstLight=!1,n},t}(r);t.exports=a},{"awayjs-stagegl/lib/materials/methods/SpecularBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularCelMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod"),a=function(e){function t(t,i){var r=this;void 0===t&&(t=.5),void 0===i&&(i=null),e.call(this,null,i),this._smoothness=.1,this._specularCutOff=.1,this.baseMethod._iModulateMethod=function(e,t,i,a,s){return r.clampSpecular(e,t,i,a,s)},this._specularCutOff=t}return i(t,e),Object.defineProperty(t.prototype,"smoothness",{get:function(){return this._smoothness},set:function(e){this._smoothness=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(e){this._specularCutOff=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=i.secondaryFragmentConstantsIndex,s=t.fragmentConstantData;s[a]=this._smoothness,s[a+1]=this._specularCutOff},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},t.prototype.clampSpecular=function(e,t,i){return"sub "+i+".y, "+i+".w, "+this._dataReg+".y\ndiv "+i+".y, "+i+".y, "+this._dataReg+".x\nsat "+i+".y, "+i+".y\nsge "+i+".w, "+i+".w, "+this._dataReg+".y\nmul "+i+".w, "+i+".w, "+i+".y\n"},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._dataReg=r.getFreeFragmentConstant(),i.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/events/ShadingMethodEvent"),a=e("awayjs-stagegl/lib/materials/methods/SpecularBasicMethod"),s=function(e){function t(t,i){var s=this;void 0===i&&(i=null),e.call(this),this._onShaderInvalidatedDelegate=function(e){return s.onShaderInvalidated(e)},this._baseMethod=i||new a,this._baseMethod._iModulateMethod=t,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)}return i(t,e),t.prototype.iInitVO=function(e,t){this._baseMethod.iInitVO(e,t)},t.prototype.iInitConstants=function(e,t){this._baseMethod.iInitConstants(e,t)},Object.defineProperty(t.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(e){this._baseMethod!=e&&(this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=e,this._baseMethod.addEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(e){this._baseMethod.gloss=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specular",{get:function(){return this._baseMethod.specular},set:function(e){this._baseMethod.specular=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"passes",{get:function(){return this._baseMethod.passes},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._baseMethod.removeEventListener(r.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod.dispose()},Object.defineProperty(t.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(e){this._baseMethod.texture=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(e,t,i){this._baseMethod.iActivate(e,t,i)},t.prototype.iSetRenderState=function(e,t,i,r,a){this._baseMethod.iSetRenderState(e,t,i,r,a)},t.prototype.iDeactivate=function(e,t,i){this._baseMethod.iDeactivate(e,t,i)},t.prototype.iGetVertexCode=function(e,t,i,r){return this._baseMethod.iGetVertexCode(e,t,i,r)},t.prototype.iGetFragmentPreLightingCode=function(e,t,i,r){return this._baseMethod.iGetFragmentPreLightingCode(e,t,i,r)},t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){return this._baseMethod.iGetFragmentCodePerLight(e,t,i,r,a,s)},t.prototype.iGetFragmentCodePerProbe=function(e,t,i,r,a,s){return this._baseMethod.iGetFragmentCodePerProbe(e,t,i,r,a,s)},t.prototype.iGetFragmentPostLightingCode=function(e,t,i,r,a){return this._baseMethod.iGetFragmentPostLightingCode(e,t,i,r,a)},t.prototype.iReset=function(){this._baseMethod.iReset()},t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._baseMethod.iCleanCompilationData()},t.prototype.onShaderInvalidated=function(){this.iInvalidateShaderProgram()},t}(a);t.exports=s},{"awayjs-stagegl/lib/events/ShadingMethodEvent":void 0,"awayjs-stagegl/lib/materials/methods/SpecularBasicMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularFresnelMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod"),a=function(e){function t(t,i){var r=this;void 0===t&&(t=!0),void 0===i&&(i=null),e.call(this,null,i),this._fresnelPower=5,this._normalReflectance=.028,this.baseMethod._iModulateMethod=function(e,t,i,a,s){return r.modulateSpecular(e,t,i,a,s)},this._incidentLight=!t}return i(t,e),t.prototype.iInitConstants=function(e,t){var i=t.secondaryFragmentConstantsIndex;e.fragmentConstantData[i+2]=1,e.fragmentConstantData[i+3]=0},Object.defineProperty(t.prototype,"basedOnSurface",{get:function(){return!this._incidentLight},set:function(e){this._incidentLight==e&&(this._incidentLight=!e,this.iInvalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(e){this._fresnelPower=e},enumerable:!0,configurable:!0}),t.prototype.iCleanCompilationData=function(){e.prototype.iCleanCompilationData.call(this),this._dataReg=null},Object.defineProperty(t.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(e){this._normalReflectance=e},enumerable:!0,configurable:!0}),t.prototype.iActivate=function(t,i,r){e.prototype.iActivate.call(this,t,i,r);var a=t.fragmentConstantData,s=i.secondaryFragmentConstantsIndex;a[s]=this._normalReflectance,a[s+1]=this._fresnelPower},t.prototype.iGetFragmentPreLightingCode=function(t,i,r,a){return this._dataReg=r.getFreeFragmentConstant(),console.log("SpecularFresnelMethod","iGetFragmentPreLightingCode",this._dataReg),i.secondaryFragmentConstantsIndex=4*this._dataReg.index,e.prototype.iGetFragmentPreLightingCode.call(this,t,i,r,a)},t.prototype.modulateSpecular=function(e,t,i,r,a){var s;return s="dp3 "+i+".y, "+a.viewDirFragment+".xyz, "+(this._incidentLight?i:a.normalFragment)+".xyz\nsub "+i+".y, "+this._dataReg+".z, "+i+".y\npow "+i+".x, "+i+".y, "+this._dataReg+".y\nsub "+i+".y, "+this._dataReg+".z, "+i+".y\nmul "+i+".y, "+this._dataReg+".x, "+i+".y\nadd "+i+".y, "+i+".x, "+i+".y\nmul "+i+".w, "+i+".w, "+i+".y\n",console.log("SpecularFresnelMethod","modulateSpecular",s),s},t}(r);t.exports=a},{"awayjs-renderergl/lib/materials/methods/SpecularCompositeMethod":void 0}],"awayjs-renderergl/lib/materials/methods/SpecularPhongMethod":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-stagegl/lib/materials/methods/SpecularBasicMethod"),a=function(e){function t(){e.call(this)}return i(t,e),t.prototype.iGetFragmentCodePerLight=function(e,t,i,r,a,s){var o,n="";this._pIsFirstLight?o=this._pTotalLightColorReg:(o=a.getFreeFragmentVectorTemp(),a.addFragmentTempUsages(o,1));var l=s.viewDirFragment,h=s.normalFragment;return n+="dp3 "+o+".w, "+i+", "+h+"\nadd "+o+".w, "+o+".w, "+o+".w\nmul "+o+".xyz, "+h+", "+o+".w\nsub "+o+".xyz, "+o+", "+i+"\nadd "+o+".w, "+o+".w, "+s.commons+".w\nsat "+o+".w, "+o+".w\nmul "+o+".xyz, "+o+", "+o+".w\ndp3 "+o+".w, "+o+", "+l+"\nsat "+o+".w, "+o+".w\n",n+=this._pUseTexture?"mul "+this._pSpecularTexData+".w, "+this._pSpecularTexData+".y, "+this._pSpecularDataRegister+".w\npow "+o+".w, "+o+".w, "+this._pSpecularTexData+".w\n":"pow "+o+".w, "+o+".w, "+this._pSpecularDataRegister+".w\n",e.usesLightFallOff&&(n+="mul "+o+".w, "+o+".w, "+i+".w\n"),null!=this._iModulateMethod&&(n+=this._iModulateMethod(e,t,o,a,s)),n+="mul "+o+".xyz, "+r+".xyz, "+o+".w\n",this._pIsFirstLight||(n+="add "+this._pTotalLightColorReg+".xyz, "+this._pTotalLightColorReg+".xyz, "+o+".xyz\n",a.removeFragmentTempUsage(o)),this._pIsFirstLight=!1,n},t}(r);t.exports=a},{"awayjs-stagegl/lib/materials/methods/SpecularBasicMethod":void 0}],"awayjs-renderergl/lib/materials/passes/SingleObjectDepthPass":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/textures/RenderTexture"),s=e("awayjs-display/lib/base/TriangleSubGeometry"),o=e("awayjs-stagegl/lib/base/ContextGLProgramType"),n=e("awayjs-stagegl/lib/materials/passes/MaterialPassBase"),l=function(e){function t(){e.call(this),this._textureSize=512,this._polyOffset=Array(15,0,0,0),this._projectionTexturesInvalid=!0}return i(t,e),Object.defineProperty(t.prototype,"textureSize",{get:function(){return this._textureSize},set:function(e){this._textureSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"polyOffset",{get:function(){return this._polyOffset[0]},set:function(e){this._polyOffset[0]=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){if(this._textures){for(var e in this._textures){var t=this._textures[e];t.dispose()}this._textures=null}},t.prototype.updateProjectionTextures=function(){if(this._textures)for(var e in this._textures){var t=this._textures[e];t.dispose()}this._textures=new Object,this._projections=new Object,this._projectionTexturesInvalid=!1},t.prototype._iGetVertexCode=function(){var e;return e="mul vt7, vt1, vc4.x	\nadd vt7, vt7, vt0\nmov vt7.w, vt0.w\n",e+="m44 vt2, vt7, vc0\nmov op, vt2\n",e+="div v0, vt2, vt2.w\n"},t.prototype._iGetFragmentCode=function(){var e="";return e+="mul ft0, fc0, v0.z\nfrc ft0, ft0\nmul ft1, ft0.yzww, fc1\nsub ft0, ft0, ft1\nmov oc, ft0\n"},t.prototype._iGetDepthMap=function(e){return this._textures[e.materialOwner.id]},t.prototype._iGetProjection=function(e){return this._projections[e.materialOwner.id]},t.prototype._iRender=function(e,t,i,n){var l,h,p,d=i.context,c=this._pLightPicker.allPickedLights,u=t.materialOwner.id;this._textures[u]||(this._textures[u]=new a(this._textureSize,this._textureSize)),this._projections[u]||(this._projections[u]=new r),h=c.length,p=c[0],l=p.iGetObjectProjectionMatrix(t.sourceEntity,n,this._projections[u]),d.setRenderTarget(this._textures[u],!0),d.clear(1,1,1),d.setProgramConstantsFromMatrix(o.VERTEX,0,l,!0),d.setProgramConstantsFromArray(o.FRAGMENT,0,this._enc,2),d.activateBuffer(0,t.getVertexData(s.POSITION_DATA),t.getVertexOffset(s.POSITION_DATA),s.POSITION_FORMAT),d.activateBuffer(1,t.getVertexData(s.NORMAL_DATA),t.getVertexOffset(s.NORMAL_DATA),s.NORMAL_FORMAT),d.drawTriangles(d.getIndexBuffer(t.getIndexData()),0,t.numTriangles)},t.prototype._iActivate=function(t,i,r){this._projectionTexturesInvalid&&this.updateProjectionTextures(),e.prototype._iActivate.call(this,t,i,r),i.context.setProgramConstantsFromArray(o.VERTEX,4,this._polyOffset,1)},t}(n);t.exports=l},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/textures/RenderTexture":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/materials/passes/MaterialPassBase":void 0}],"awayjs-renderergl/lib/parsers/AWDParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/ColorTransform"),a=e("awayjs-core/lib/geom/Matrix3D"),s=e("awayjs-core/lib/geom/Vector3D"),o=e("awayjs-core/lib/net/URLLoaderDataFormat"),n=e("awayjs-core/lib/net/URLRequest"),l=e("awayjs-core/lib/library/AssetType"),h=e("awayjs-core/lib/parsers/ParserBase"),p=e("awayjs-core/lib/parsers/ParserUtils"),d=e("awayjs-core/lib/projections/PerspectiveProjection"),c=e("awayjs-core/lib/projections/OrthographicProjection"),u=e("awayjs-core/lib/projections/OrthographicOffCenterProjection"),_=e("awayjs-core/lib/textures/BitmapCubeTexture"),y=e("awayjs-core/lib/textures/ImageCubeTexture"),m=e("awayjs-core/lib/textures/ImageTexture"),g=e("awayjs-core/lib/utils/ByteArray"),f=e("awayjs-display/lib/containers/DisplayObjectContainer"),b=e("awayjs-display/lib/base/BlendMode"),x=e("awayjs-display/lib/base/Geometry"),w=e("awayjs-display/lib/base/TriangleSubGeometry"),v=e("awayjs-display/lib/entities/DirectionalLight"),D=e("awayjs-display/lib/entities/PointLight"),T=e("awayjs-display/lib/entities/Camera"),P=e("awayjs-display/lib/entities/Mesh"),C=e("awayjs-display/lib/entities/Skybox"),S=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker"),A=e("awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper"),O=e("awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper"),M=e("awayjs-display/lib/prefabs/PrefabBase"),j=e("awayjs-display/lib/prefabs/PrimitiveCapsulePrefab"),N=e("awayjs-display/lib/prefabs/PrimitiveConePrefab"),I=e("awayjs-display/lib/prefabs/PrimitiveCubePrefab"),R=e("awayjs-display/lib/prefabs/PrimitiveCylinderPrefab"),F=e("awayjs-display/lib/prefabs/PrimitivePlanePrefab"),E=e("awayjs-display/lib/prefabs/PrimitiveSpherePrefab"),V=e("awayjs-display/lib/prefabs/PrimitiveTorusPrefab"),B=e("awayjs-stagegl/lib/materials/SkyboxMaterial"),L=e("awayjs-stagegl/lib/materials/TriangleMaterialMode"),z=e("awayjs-stagegl/lib/materials/TriangleMethodMaterial"),k=e("awayjs-stagegl/lib/materials/utils/DefaultMaterialManager"),U=e("awayjs-renderergl/lib/animators/VertexAnimationSet"),G=e("awayjs-renderergl/lib/animators/VertexAnimator"),X=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet"),H=e("awayjs-renderergl/lib/animators/SkeletonAnimator"),W=e("awayjs-renderergl/lib/animators/data/JointPose"),J=e("awayjs-renderergl/lib/animators/data/Skeleton"),K=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),Y=e("awayjs-renderergl/lib/animators/data/SkeletonJoint"),Z=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode"),q=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode"),Q=e("awayjs-renderergl/lib/materials/methods/AmbientEnvMapMethod"),$=e("awayjs-renderergl/lib/materials/methods/DiffuseDepthMethod"),et=e("awayjs-renderergl/lib/materials/methods/DiffuseCelMethod"),tt=e("awayjs-renderergl/lib/materials/methods/DiffuseGradientMethod"),it=e("awayjs-renderergl/lib/materials/methods/DiffuseLightMapMethod"),rt=e("awayjs-renderergl/lib/materials/methods/DiffuseWrapMethod"),at=e("awayjs-renderergl/lib/materials/methods/EffectAlphaMaskMethod"),st=e("awayjs-renderergl/lib/materials/methods/EffectColorMatrixMethod"),ot=e("awayjs-stagegl/lib/materials/methods/EffectColorTransformMethod"),nt=e("awayjs-renderergl/lib/materials/methods/EffectEnvMapMethod"),lt=e("awayjs-renderergl/lib/materials/methods/EffectFogMethod"),ht=e("awayjs-renderergl/lib/materials/methods/EffectFresnelEnvMapMethod"),pt=e("awayjs-renderergl/lib/materials/methods/EffectLightMapMethod"),dt=e("awayjs-renderergl/lib/materials/methods/EffectRimLightMethod"),ct=e("awayjs-renderergl/lib/materials/methods/NormalSimpleWaterMethod"),ut=e("awayjs-renderergl/lib/materials/methods/ShadowDitheredMethod"),_t=e("awayjs-renderergl/lib/materials/methods/ShadowFilteredMethod"),yt=e("awayjs-renderergl/lib/materials/methods/SpecularFresnelMethod"),mt=e("awayjs-stagegl/lib/materials/methods/ShadowHardMethod"),gt=e("awayjs-renderergl/lib/materials/methods/SpecularAnisotropicMethod"),ft=e("awayjs-renderergl/lib/materials/methods/SpecularCelMethod"),bt=e("awayjs-renderergl/lib/materials/methods/SpecularPhongMethod"),xt=e("awayjs-renderergl/lib/materials/methods/ShadowNearMethod"),wt=e("awayjs-renderergl/lib/materials/methods/ShadowSoftMethod"),vt=e("awayjs-renderergl/lib/parsers/data/AWDBlock"),Dt=e("awayjs-renderergl/lib/parsers/data/AWDProperties"),Tt=e("awayjs-renderergl/lib/parsers/data/BitFlags"),Pt=function(e){function t(){e.call(this,o.ARRAY_BUFFER),this._debug=!1,this._startedParsing=!1,this._texture_users={},this._parsed_header=!1,this._blocks=new Array,this._blocks[0]=new vt,this._blocks[0].data=null,this.blendModeDic=new Array,this.blendModeDic.push(b.NORMAL),this.blendModeDic.push(b.ADD),this.blendModeDic.push(b.ALPHA),this.blendModeDic.push(b.DARKEN),this.blendModeDic.push(b.DIFFERENCE),this.blendModeDic.push(b.ERASE),this.blendModeDic.push(b.HARDLIGHT),this.blendModeDic.push(b.INVERT),this.blendModeDic.push(b.LAYER),this.blendModeDic.push(b.LIGHTEN),this.blendModeDic.push(b.MULTIPLY),this.blendModeDic.push(b.NORMAL),this.blendModeDic.push(b.OVERLAY),this.blendModeDic.push(b.SCREEN),this.blendModeDic.push(b.SHADER),this.blendModeDic.push(b.OVERLAY),this._depthSizeDic=new Array,this._depthSizeDic.push(256),this._depthSizeDic.push(512),this._depthSizeDic.push(2048),this._depthSizeDic.push(1024),this._version=Array()}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"awd"==e},t.supportsData=function(e){return"AWD"==p.toString(e,3)},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t,i,r,a=e.id.split("#"),s=a[0];if(1==a.length&&(t=e.assets[0])){r=this._blocks[e.id],r.data=t,t.resetAssetPath(r.name,null,!0),r.name=t.name,this._pFinalizeAsset(t),this._debug&&(console.log("Successfully loaded Bitmap for texture"),console.log("Parsed texture: Name = "+r.name))}if(a.length>1){i=e.assets[0];var o=i;if(this._cubeTextures[a[1]]=o.htmlImageElement,this._texture_users[s].push(1),this._debug&&console.log("Successfully loaded Bitmap "+this._texture_users[s].length+" / 6 for Cubetexture"),this._texture_users[s].length==this._cubeTextures.length){var n=this._cubeTextures[0],l=this._cubeTextures[1],h=this._cubeTextures[2],p=this._cubeTextures[3],d=this._cubeTextures[4],c=this._cubeTextures[5];t=new y(n,l,h,p,d,c),r=this._blocks[s],r.data=t,t.resetAssetPath(r.name,null,!0),r.name=t.name,this._pFinalizeAsset(t),this._debug&&console.log("Parsed CubeTexture: Name = "+r.name)}}}},t.prototype._iResolveDependencyFailure=function(){},t.prototype._iResolveDependencyName=function(e,t){var i=t.name;if(t){var r=this._blocks[parseInt(e.id)];t.resetAssetPath(r.name,null,!0)}var a=t.name;return t.name=i,a},t.prototype._pProceedParsing=function(){if(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0),!this._parsed_header){switch(this.parseHeader(),this._compression){case t.DEFLATE:case t.LZMA:this._pDieWithError("Compressed AWD formats not yet supported");break;case t.UNCOMPRESSED:this._body=this._byteData}this._parsed_header=!0}if(this._body){for(;this._body.getBytesAvailable()>0&&!this.parsingPaused;)this.parseNextBlock();return 0==this._body.getBytesAvailable()?(this.dispose(),h.PARSING_DONE):h.MORE_TO_PARSE}switch(this._compression){case t.DEFLATE:case t.LZMA:this._debug&&console.log("(!) AWDParser Error: Compressed AWD formats not yet supported (!)")}return h.PARSING_DONE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new f},t.prototype.dispose=function(){for(var e in this._blocks){var t=this._blocks[e];t.dispose()}},t.prototype.parseNextBlock=function(){var e,i,r,a,s,o=!1;this._cur_block_id=this._body.readUnsignedInt(),i=this._body.readUnsignedByte(),r=this._body.readUnsignedByte(),a=this._body.readUnsignedByte(),s=this._body.readUnsignedInt();{var n=Tt.test(a,Tt.FLAG4);Tt.test(a,Tt.FLAG5)}this._accuracyOnBlocks&&(this._accuracyMatrix=Tt.test(a,Tt.FLAG1),this._accuracyGeo=Tt.test(a,Tt.FLAG2),this._accuracyProps=Tt.test(a,Tt.FLAG3),this._geoNrType=t.FLOAT32,this._accuracyGeo&&(this._geoNrType=t.FLOAT64),this._matrixNrType=t.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=t.FLOAT64),this._propsNrType=t.FLOAT32,this._accuracyProps&&(this._propsNrType=t.FLOAT64));var l=this._body.position+s;if(s>this._body.getBytesAvailable())return this._pDieWithError("AWD2 block length is bigger than the bytes that are available!"),void(this._body.position+=this._body.getBytesAvailable());this._newBlockBytes=new g,this._body.readBytes(this._newBlockBytes,0,s),n&&this._pDieWithError("Compressed AWD formats not yet supported"),this._newBlockBytes.position=0,e=new vt,e.len=this._newBlockBytes.position+s,e.id=this._cur_block_id;var h=this._newBlockBytes.position+s;if(n&&this._pDieWithError("Compressed AWD formats not yet supported"),this._debug&&console.log("AWDBlock:  ID = "+this._cur_block_id+" | TypeID = "+r+" | Compression = "+n+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps),this._blocks[this._cur_block_id]=e,2==this._version[0]&&1==this._version[1])switch(r){case 11:this.parsePrimitves(this._cur_block_id),o=!0;break;case 31:this.parseSkyboxInstance(this._cur_block_id),o=!0;break;case 41:this.parseLight(this._cur_block_id),o=!0;break;case 42:this.parseCamera(this._cur_block_id),o=!0;break;case 51:this.parseLightPicker(this._cur_block_id),o=!0;break;case 81:this.parseMaterial_v1(this._cur_block_id),o=!0;break;case 83:this.parseCubeTexture(this._cur_block_id),o=!0;break;case 91:this.parseSharedMethodBlock(this._cur_block_id),o=!0;break;case 92:this.parseShadowMethodBlock(this._cur_block_id),o=!0;break;case 111:this.parseMeshPoseAnimation(this._cur_block_id,!0),o=!0;break;case 112:this.parseMeshPoseAnimation(this._cur_block_id),o=!0;break;case 113:this.parseVertexAnimationSet(this._cur_block_id),o=!0;break;case 122:this.parseAnimatorSet(this._cur_block_id),o=!0;break;case 253:this.parseCommand(this._cur_block_id),o=!0}if(0==o)switch(r){case 1:this.parseTriangleGeometrieBlock(this._cur_block_id);break;case 22:this.parseContainer(this._cur_block_id);break;case 23:this.parseMeshInstance(this._cur_block_id);break;case 81:this.parseMaterial(this._cur_block_id);break;case 82:this.parseTexture(this._cur_block_id);break;case 101:this.parseSkeleton(this._cur_block_id);break;case 102:this.parseSkeletonPose(this._cur_block_id);break;case 103:this.parseSkeletonAnimation(this._cur_block_id);break;case 121:case 254:this.parseNameSpace(this._cur_block_id);break;case 255:this.parseMetaData(this._cur_block_id);break;default:this._debug&&console.log("AWDBlock:   Unknown BlockType  (BlockID = "+this._cur_block_id+") - Skip "+s+" bytes"),this._newBlockBytes.position+=s}var p=0;if(this._newBlockBytes.position==h){if(this._debug&&e.errorMessages)for(;p<e.errorMessages.length;)console.log("        (!) Error: "+e.errorMessages[p]+" (!)"),p++;this._debug&&console.log("\n")}else if(this._debug&&(console.log("  (!)(!)(!) Error while reading AWDBlock ID "+this._cur_block_id+" = skip to next block"),e.errorMessages))for(;p<e.errorMessages.length;)console.log("        (!) Error: "+e.errorMessages[p]+" (!)"),p++;this._body.position=l,this._newBlockBytes=null},t.prototype.parseTriangleGeometrieBlock=function(e){for(var t=new x,i=this.parseVarStr(),r=this._newBlockBytes.readUnsignedShort(),a=this.parseProperties({1:this._geoNrType,2:this._geoNrType}),s=a.get(1,1),o=a.get(2,1),n=0;r>n;){var l,h,p,d,c;l=this._newBlockBytes.readUnsignedInt(),h=this._newBlockBytes.position+l;for(var u=this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._newBlockBytes.position<h;){var _,y,m,g,f=0;
y=this._newBlockBytes.readUnsignedByte(),_=this._newBlockBytes.readUnsignedByte(),m=this._newBlockBytes.readUnsignedInt(),g=this._newBlockBytes.position+m;var b,v,D;if(1==y)for(var T=new Array;this._newBlockBytes.position<g;)b=this.readNumber(this._accuracyGeo),v=this.readNumber(this._accuracyGeo),D=this.readNumber(this._accuracyGeo),T[f++]=b,T[f++]=v,T[f++]=D;else if(2==y)for(var P=new Array;this._newBlockBytes.position<g;)P[f++]=this._newBlockBytes.readUnsignedShort();else if(3==y)for(var C=new Array;this._newBlockBytes.position<g;)C[f++]=this.readNumber(this._accuracyGeo);else if(4==y)for(var S=new Array;this._newBlockBytes.position<g;)S[f++]=this.readNumber(this._accuracyGeo);else if(6==y)for(d=Array();this._newBlockBytes.position<g;)d[f++]=3*this._newBlockBytes.readUnsignedShort();else if(7==y)for(c=new Array;this._newBlockBytes.position<g;)c[f++]=this.readNumber(this._accuracyGeo);else this._newBlockBytes.position=g}this.parseUserAttributes(),p=new w(!0),c&&(p.jointsPerVertex=c.length/(T.length/3)),S&&(p.autoDeriveNormals=!1),C&&(p.autoDeriveUVs=!1),p.updateIndices(P),p.updatePositions(T),p.updateVertexNormals(S),p.updateUVs(C),p.updateVertexTangents(null),p.updateJointWeights(c),p.updateJointIndices(d);var A=u.get(1,1),O=u.get(2,1),M=!1;(s!=A||o!=O)&&(M=!0,A=s/A,O=o/O),M&&p.scaleUV(A,O),t.addSubGeometry(p),n++}(1!=s||1!=o)&&t.scaleUV(s,o),this.parseUserAttributes(),this._pFinalizeAsset(t,i),this._blocks[e].data=t,this._debug&&console.log("Parsed a TriangleGeometry: Name = "+i+"| Id = "+p.id)},t.prototype.parsePrimitves=function(e){var i,r,a,s;i=this.parseVarStr(),a=this._newBlockBytes.readUnsignedByte(),s=this.parseProperties({101:this._geoNrType,102:this._geoNrType,103:this._geoNrType,110:this._geoNrType,111:this._geoNrType,301:t.UINT16,302:t.UINT16,303:t.UINT16,701:t.BOOL,702:t.BOOL,703:t.BOOL,704:t.BOOL});var o=["Unsupported Type-ID","PrimitivePlanePrefab","PrimitiveCubePrefab","PrimitiveSpherePrefab","PrimitiveCylinderPrefab","PrimitivesConePrefab","PrimitivesCapsulePrefab","PrimitivesTorusPrefab"];switch(a){case 1:r=new F(s.get(101,100),s.get(102,100),s.get(301,1),s.get(302,1),s.get(701,!0),s.get(702,!1));break;case 2:r=new I(s.get(101,100),s.get(102,100),s.get(103,100),s.get(301,1),s.get(302,1),s.get(303,1),s.get(701,!0));break;case 3:r=new E(s.get(101,50),s.get(301,16),s.get(302,12),s.get(701,!0));break;case 4:r=new R(s.get(101,50),s.get(102,50),s.get(103,100),s.get(301,16),s.get(302,1),!0,!0,!0),s.get(701,!0)||(r.topClosed=!1),s.get(702,!0)||(r.bottomClosed=!1),s.get(703,!0)||(r.yUp=!1);break;case 5:r=new N(s.get(101,50),s.get(102,100),s.get(301,16),s.get(302,1),s.get(701,!0),s.get(702,!0));break;case 6:r=new j(s.get(101,50),s.get(102,100),s.get(301,16),s.get(302,15),s.get(701,!0));break;case 7:r=new V(s.get(101,50),s.get(102,50),s.get(301,16),s.get(302,8),s.get(701,!0));break;default:r=new M,console.log("ERROR: UNSUPPORTED PREFAB_TYPE")}1!=s.get(110,1)||1!=s.get(111,1),this.parseUserAttributes(),r.name=i,this._pFinalizeAsset(r,i),this._blocks[e].data=r,this._debug&&((0>a||a>7)&&(a=0),console.log("Parsed a Primivite: Name = "+i+"| type = "+o[a]))},t.prototype.parseContainer=function(e){var i,r,a,o;r=this._newBlockBytes.readUnsignedInt(),a=this.parseMatrix3D(),i=this.parseVarStr();var n="Root (TopLevel)";o=new f,o.transform.matrix3D=a;var h=this.getAssetByID(r,[l.CONTAINER,l.LIGHT,l.MESH]);if(h[0]){{h[1].addChild(o)}n=h[1].name}else r>0?this._blocks[e].addError("Could not find a parent for this ObjectContainer3D"):this._pContent.addChild(o);if(2==this._version[0]&&1==this._version[1]){var p=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8});o.pivot=new s(p.get(1,0),p.get(2,0),p.get(3,0))}else this.parseProperties(null);o.extra=this.parseUserAttributes(),this._pFinalizeAsset(o,i),this._blocks[e].data=o,this._debug&&console.log("Parsed a Container: Name = '"+i+"' | Parent-Name = "+n)},t.prototype.parseMeshInstance=function(e){var i,r,a,o=this._newBlockBytes.readUnsignedInt(),n=this.parseMatrix3D(),h=this.parseVarStr(),p="Root (TopLevel)",d=this._newBlockBytes.readUnsignedInt(),c=this.getAssetByID(d,[l.GEOMETRY]);c[0]?a=c[1]:(this._blocks[e].addError("Could not find a Geometry for this Mesh. A empty Geometry is created!"),a=new x),this._blocks[e].geoID=d;var u=new Array;i=this._newBlockBytes.readUnsignedShort();var _=new Array;r=0;for(var y;i>r;){var m;m=this._newBlockBytes.readUnsignedInt(),y=this.getAssetByID(m,[l.MATERIAL]),!y[0]&&m>0&&this._blocks[e].addError("Could not find Material Nr "+r+" (ID = "+m+" ) for this Mesh");var g=y[1];u.push(g),_.push(g.name),r++}var f=new P(a,null);f.transform.matrix3D=n;var b=this.getAssetByID(o,[l.CONTAINER,l.LIGHT,l.MESH]);if(b[0]){var w=b[1];w.addChild(f),p=w.name}else o>0?this._blocks[e].addError("Could not find a parent for this Mesh"):this._pContent.addChild(f);if(u.length>=1&&1==f.subMeshes.length)f.material=u[0];else if(u.length>1){var v;for(v=0;v<f.subMeshes.length;v++)f.subMeshes[v].material=u[Math.min(u.length-1,v)]}if(2==this._version[0]&&1==this._version[1]){var D=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8,5:t.BOOL});f.pivot=new s(D.get(1,0),D.get(2,0),D.get(3,0)),f.castsShadows=D.get(5,!0)}else this.parseProperties(null);f.extra=this.parseUserAttributes(),this._pFinalizeAsset(f,h),this._blocks[e].data=f,this._debug&&console.log("Parsed a Mesh: Name = '"+h+"' | Parent-Name = "+p+"| Geometry-Name = "+a.name+" | SubMeshes = "+f.subMeshes.length+" | Mat-Names = "+_.toString())},t.prototype.parseSkyboxInstance=function(e){var t=this.parseVarStr(),i=this._newBlockBytes.readUnsignedInt(),r=this.getAssetByID(i,[l.TEXTURE],"CubeTexture");r[0]||0==i||this._blocks[e].addError("Could not find the Cubetexture (ID = "+i+" ) for this Skybox");var a=new C(new B(r[1]));this.parseProperties(null),a.extra=this.parseUserAttributes(),this._pFinalizeAsset(a,t),this._blocks[e].data=a,this._debug&&console.log("Parsed a Skybox: Name = '"+t+"' | CubeTexture-Name = "+r[1].name)},t.prototype.parseLight=function(e){var i,r,a=this._newBlockBytes.readUnsignedInt(),s=this.parseMatrix3D(),o=this.parseVarStr(),n=this._newBlockBytes.readUnsignedByte(),h=this.parseProperties({1:this._propsNrType,2:this._propsNrType,3:t.COLOR,4:this._propsNrType,5:this._propsNrType,6:t.BOOL,7:t.COLOR,8:this._propsNrType,9:t.UINT8,10:t.UINT8,11:this._propsNrType,12:t.UINT16,21:this._matrixNrType,22:this._matrixNrType,23:this._matrixNrType}),p=h.get(9,0),d="Root (TopLevel)",c=["Unsupported LightType","PointLight","DirectionalLight"],u=["No ShadowMapper","DirectionalShadowMapper","NearDirectionalShadowMapper","CascadeShadowMapper","CubeMapShadowMapper"];if(1==n&&(i=new D,i.radius=h.get(1,9e4),i.fallOff=h.get(2,1e5),p>0&&4==p&&(r=new A),i.transform.matrix3D=s),2==n&&(i=new v(h.get(21,0),h.get(22,-1),h.get(23,1)),p>0&&1==p&&(r=new O)),i.color=h.get(3,16777215),i.specular=h.get(4,1),i.diffuse=h.get(5,1),i.ambientColor=h.get(7,16777215),i.ambient=h.get(8,0),r&&(r instanceof A?1!=h.get(10,1)&&(r.depthMapSize=this._depthSizeDic[h.get(10,1)]):2!=h.get(10,2)&&(r.depthMapSize=this._depthSizeDic[h.get(10,2)]),i.shadowMapper=r,i.castsShadows=!0),0!=a){var _=this.getAssetByID(a,[l.CONTAINER,l.LIGHT,l.MESH]);_[0]?(_[1].addChild(i),d=_[1].name):this._blocks[e].addError("Could not find a parent for this Light")}else this._pContent.addChild(i);this.parseUserAttributes(),this._pFinalizeAsset(i,o),this._blocks[e].data=i,this._debug&&console.log("Parsed a Light: Name = '"+o+"' | Type = "+c[n]+" | Parent-Name = "+d+" | ShadowMapper-Type = "+u[p])},t.prototype.parseCamera=function(e){var i,r=this._newBlockBytes.readUnsignedInt(),a=this.parseMatrix3D(),o=this.parseVarStr(),n="Root (TopLevel)";this._newBlockBytes.readUnsignedByte(),this._newBlockBytes.readShort();var h=this._newBlockBytes.readShort(),p=this.parseProperties({101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType});switch(h){case 5001:i=new d(p.get(101,60));break;case 5002:i=new c(p.get(101,500));break;case 5003:i=new u(p.get(101,-400),p.get(102,400),p.get(103,-300),p.get(104,300));break;default:return void console.log("unsupportedLenstype")}var _=new T(i);_.transform.matrix3D=a;var y=this.getAssetByID(r,[l.CONTAINER,l.LIGHT,l.MESH]);if(y[0]){var m=y[1];m.addChild(_),n=m.name}else r>0?this._blocks[e].addError("Could not find a parent for this Camera"):this._pContent.addChild(_);_.name=o,p=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8}),_.pivot=new s(p.get(1,0),p.get(2,0),p.get(3,0)),_.extra=this.parseUserAttributes(),this._pFinalizeAsset(_,o),this._blocks[e].data=_,this._debug&&console.log("Parsed a Camera: Name = '"+o+"' | Projectiontype = "+i+" | Parent-Name = "+n)},t.prototype.parseLightPicker=function(e){var t,i=this.parseVarStr(),r=this._newBlockBytes.readUnsignedShort(),a=new Array,s=0,o=0,n=new Array;for(s=0;r>s;s++)o=this._newBlockBytes.readUnsignedInt(),t=this.getAssetByID(o,[l.LIGHT]),t[0]?(a.push(t[1]),n.push(t[1].name)):this._blocks[e].addError("Could not find a Light Nr "+s+" (ID = "+o+" ) for this LightPicker");if(0==a.length)return this._blocks[e].addError("Could not create this LightPicker, cause no Light was found."),void this.parseUserAttributes();var h=new S(a);h.name=i,this.parseUserAttributes(),this._pFinalizeAsset(h,i),this._blocks[e].data=h,this._debug&&console.log("Parsed a StaticLightPicker: Name = '"+i+"' | Texture-Name = "+n.toString())},t.prototype.parseMaterial=function(e){var i,r,a,s,o,n,h,p;for(i=this.parseVarStr(),r=this._newBlockBytes.readUnsignedByte(),n=this._newBlockBytes.readUnsignedByte(),a=this.parseProperties({1:t.INT32,2:t.BADDR,10:this._propsNrType,11:t.BOOL,12:this._propsNrType,13:t.BOOL}),h=0;n>h;){var d;d=this._newBlockBytes.readUnsignedShort(),this.parseProperties(null),this.parseUserAttributes(),h+=1}var c="";if(o=this.parseUserAttributes(),1===r){c+="Parsed a ColorMaterial(SinglePass): Name = '"+i+"' | ";var u;u=a.get(1,16777215),this.materialMode<2?s=new z(u,a.get(10,1)):(s=new z(u),s.materialMode=L.MULTI_PASS)}else if(2===r){var _=a.get(2,0);p=this.getAssetByID(_,[l.TEXTURE]),!p[0]&&_>0&&this._blocks[e].addError("Could not find the DiffsueTexture (ID = "+_+" ) for this Material"),s=new z(p[1]),this.materialMode<2?(s.alphaBlending=a.get(11,!1),s.alpha=a.get(10,1),c+="Parsed a TriangleMethodMaterial(SinglePass): Name = '"+i+"' | Texture-Name = "+s.name):(s.materialMode=L.MULTI_PASS,c+="Parsed a TriangleMethodMaterial(MultiPass): Name = '"+i+"' | Texture-Name = "+s.name)}s.extra=o,s.alphaThreshold=a.get(12,0),s.repeat=a.get(13,!1),this._pFinalizeAsset(s,i),this._blocks[e].data=s,this._debug&&console.log(c)},t.prototype.parseMaterial_v1=function(e){var i,r,a,s,o=this.parseVarStr(),n=this._newBlockBytes.readUnsignedByte(),h=this._newBlockBytes.readUnsignedByte(),p=this.parseProperties({1:t.UINT32,2:t.BADDR,3:t.BADDR,4:t.UINT8,5:t.BOOL,6:t.BOOL,7:t.BOOL,8:t.BOOL,9:t.UINT8,10:this._propsNrType,11:t.BOOL,12:this._propsNrType,13:t.BOOL,15:this._propsNrType,16:t.UINT32,17:t.BADDR,18:this._propsNrType,19:this._propsNrType,20:t.UINT32,21:t.BADDR,22:t.BADDR}),d=p.get(4,0),c="";if(d>=2)return void this._blocks[e].addError("Material-spezialType '"+d+"' is not supported, can only be 0:singlePass, 1:MultiPass !");if(1==this.materialMode?d=0:2==this.materialMode&&(d=1),2>d){if(1==n){var u=p.get(1,13421772);1==d?(i=new z(u),i.materialMode=L.MULTI_PASS,c+="Parsed a ColorMaterial(MultiPass): Name = '"+o+"' | "):(i=new z(u,p.get(10,1)),i.alphaBlending=p.get(11,!1),c+="Parsed a ColorMaterial(SinglePass): Name = '"+o+"' | ")}else if(2==n){var _=p.get(2,0);s=this.getAssetByID(_,[l.TEXTURE]),!s[0]&&_>0&&this._blocks[e].addError("Could not find the AmbientTexture (ID = "+_+" ) for this TriangleMethodMaterial");var y=s[1];i=new z(y),1==d?(i.materialMode=L.MULTI_PASS,c+="Parsed a TriangleMethodMaterial(MultiPass): Name = '"+o+"' | Texture-Name = "+y.name):(i.alpha=p.get(10,1),i.alphaBlending=p.get(11,!1),c+="Parsed a TriangleMethodMaterial(SinglePass): Name = '"+o+"' | Texture-Name = "+y.name)}var m,g=p.get(17,0);s=this.getAssetByID(g,[l.TEXTURE]),s[0]||0==g||this._blocks[e].addError("Could not find the DiffuseTexture (ID = "+g+" ) for this TriangleMethodMaterial"),s[0]&&(m=s[1]),m&&(i.diffuseTexture=m,c+=" | DiffuseTexture-Name = "+m.name);var f=p.get(3,0);s=this.getAssetByID(f,[l.TEXTURE]),s[0]||0==f||this._blocks[e].addError("Could not find the NormalTexture (ID = "+f+" ) for this TriangleMethodMaterial"),s[0]&&(r=s[1],c+=" | NormalTexture-Name = "+r.name);var b=p.get(21,0);s=this.getAssetByID(b,[l.TEXTURE]),s[0]||0==b||this._blocks[e].addError("Could not find the SpecularTexture (ID = "+b+" ) for this TriangleMethodMaterial"),s[0]&&(a=s[1],c+=" | SpecularTexture-Name = "+a.name);var x=p.get(22,0);s=this.getAssetByID(x,[l.LIGHT_PICKER]),!s[0]&&x?this._blocks[e].addError("Could not find the LightPicker (ID = "+x+" ) for this TriangleMethodMaterial"):i.lightPicker=s[1],i.smooth=p.get(5,!0),i.mipmap=p.get(6,!0),i.bothSides=p.get(7,!1),i.alphaPremultiplied=p.get(8,!1),i.blendMode=this.blendModeDic[p.get(9,0)],i.repeat=p.get(13,!1),r&&(i.normalMap=r),a&&(i.specularMap=a),i.alphaThreshold=p.get(12,0),i.ambient=p.get(15,1),i.diffuseColor=p.get(16,16777215),i.specular=p.get(18,1),i.gloss=p.get(19,50),i.specularColor=p.get(20,16777215);for(var w,v=0;h>v;){var D;switch(D=this._newBlockBytes.readUnsignedShort(),p=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4}),D){case 999:w=p.get(1,0),s=this.getAssetByID(w,[l.EFFECTS_METHOD]),s[0]?(i.addEffectMethod(s[1]),c+=" | EffectMethod-Name = "+s[1].name):this._blocks[e].addError("Could not find the EffectMethod (ID = "+w+" ) for this Material");break;case 998:w=p.get(1,0),s=this.getAssetByID(w,[l.SHADOW_MAP_METHOD]),s[0]?(i.shadowMethod=s[1],c+=" | ShadowMethod-Name = "+s[1].name):this._blocks[e].addError("Could not find the ShadowMethod (ID = "+w+" ) for this Material");break;case 1:w=p.get(1,0),s=this.getAssetByID(w,[l.TEXTURE],"CubeTexture"),s[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+w+" ) for this EnvMapAmbientMethodMaterial"),i.ambientMethod=new Q(s[1]),c+=" | AmbientEnvMapMethod | EnvMap-Name ="+s[1].name;break;case 51:i.diffuseMethod=new $,c+=" | DiffuseDepthMethod";break;case 52:w=p.get(1,0),s=this.getAssetByID(w,[l.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the GradientDiffuseTexture (ID = "+w+" ) for this GradientDiffuseMethod"),i.diffuseMethod=new tt(s[1]),c+=" | DiffuseGradientMethod | GradientDiffuseTexture-Name ="+s[1].name;break;case 53:i.diffuseMethod=new rt(p.get(101,5)),c+=" | DiffuseWrapMethod";break;case 54:w=p.get(1,0),s=this.getAssetByID(w,[l.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the LightMap (ID = "+w+" ) for this LightMapDiffuseMethod"),i.diffuseMethod=new it(s[1],this.blendModeDic[p.get(401,10)],!1,i.diffuseMethod),c+=" | DiffuseLightMapMethod | LightMapTexture-Name ="+s[1].name;break;case 55:i.diffuseMethod=new et(p.get(401,3),i.diffuseMethod),i.diffuseMethod.smoothness=p.get(101,.1),c+=" | DiffuseCelMethod";break;case 56:break;case 101:i.specularMethod=new gt,c+=" | SpecularAnisotropicMethod";break;case 102:i.specularMethod=new bt,c+=" | SpecularPhongMethod";break;case 103:i.specularMethod=new ft(p.get(101,.5),i.specularMethod),i.specularMethod.smoothness=p.get(102,.1),c+=" | SpecularCelMethod";break;case 104:i.specularMethod=new yt(p.get(701,!0),i.specularMethod),i.specularMethod.fresnelPower=p.get(101,5),i.specularMethod.normalReflectance=p.get(102,.1),c+=" | SpecularFresnelMethod";break;case 151:break;case 152:w=p.get(1,0),s=this.getAssetByID(w,[l.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the SecoundNormalMap (ID = "+w+" ) for this SimpleWaterNormalMethod"),i.normalMap||this._blocks[e].addError("Could not find a normal Map on this Material to use with this SimpleWaterNormalMethod"),i.normalMap=s[1],i.normalMethod=new ct(i.normalMap,s[1]),c+=" | NormalSimpleWaterMethod | Second-NormalTexture-Name = "+s[1].name}this.parseUserAttributes(),v+=1}}i.extra=this.parseUserAttributes(),this._pFinalizeAsset(i,o),this._blocks[e].data=i,this._debug&&console.log(c)},t.prototype.parseTexture=function(e){var t;this._blocks[e].name=this.parseVarStr();var i,r=this._newBlockBytes.readUnsignedByte();if(this._texture_users[this._cur_block_id.toString()]=[],0==r){i=this._newBlockBytes.readUnsignedInt();var a;a=this._newBlockBytes.readUTFBytes(i),this._pAddDependency(this._cur_block_id.toString(),new n(a),!1,null,!0)}else{i=this._newBlockBytes.readUnsignedInt();var s;s=new g,this._newBlockBytes.readBytes(s,0,i),this._pAddDependency(this._cur_block_id.toString(),null,!1,p.byteArrayToImage(s),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=t,this._debug){var o=["external","embed"];console.log("Start parsing a "+o[r]+" Bitmap for Texture")}},t.prototype.parseCubeTexture=function(e){var t,i,r;this._cubeTextures=new Array,this._texture_users[this._cur_block_id.toString()]=[];var a=this._newBlockBytes.readUnsignedByte();for(this._blocks[e].name=this.parseVarStr(),r=0;6>r;r++)if(this._texture_users[this._cur_block_id.toString()]=[],this._cubeTextures.push(null),0==a){t=this._newBlockBytes.readUnsignedInt();var s;s=this._newBlockBytes.readUTFBytes(t),this._pAddDependency(this._cur_block_id.toString()+"#"+r,new n(s),!1,null,!0)}else{t=this._newBlockBytes.readUnsignedInt();var o;o=new g,this._newBlockBytes.readBytes(o,0,t),this._pAddDependency(this._cur_block_id.toString()+"#"+r,null,!1,p.byteArrayToImage(o),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=i,this._debug){var l=["external","embed"];console.log("Start parsing 6 "+l[a]+" Bitmaps for CubeTexture")}},t.prototype.parseSharedMethodBlock=function(e){var t;this._blocks[e].name=this.parseVarStr(),t=this.parseSharedMethodList(e),this.parseUserAttributes(),this._blocks[e].data=t,this._pFinalizeAsset(t,this._blocks[e].name),this._blocks[e].data=t,this._debug&&console.log("Parsed a EffectMethod: Name = "+t.name+" Type = "+t)},t.prototype.parseShadowMethodBlock=function(e){var t,i;this._blocks[e].name=this.parseVarStr(),i=this._newBlockBytes.readUnsignedInt();var r=this.getAssetByID(i,[l.LIGHT]);return r[0]?(t=this.parseShadowMethodList(r[1],e),void(t&&(this.parseUserAttributes(),this._pFinalizeAsset(t,this._blocks[e].name),this._blocks[e].data=t,this._debug&&console.log("Parsed a ShadowMapMethodMethod: Name = "+t.name+" | Type = "+t+" | Light-Name = ",r[1].name)))):void this._blocks[e].addError("Could not find the TargetLight (ID = "+i+" ) for this ShadowMethod - ShadowMethod not created")},t.prototype.parseCommand=function(e){var i,r,a=(1==this._newBlockBytes.readUnsignedByte(),this._newBlockBytes.readUnsignedInt()),o=this.parseMatrix3D(),n=this.parseVarStr(),h=this.getAssetByID(a,[l.CONTAINER,l.LIGHT,l.MESH]);h[0]&&(i=h[1]);var p=(this._newBlockBytes.readShort(),this._newBlockBytes.readShort()),d=this.parseProperties({1:t.BADDR});switch(p){case 1:var c=d.get(1,0),u=this.getAssetByID(c,[l.LIGHT,l.TEXTURE_PROJECTOR]);if(!u[0]&&0!=c)return void this._blocks[e].addError("Could not find the light (ID = "+c+" ( for this CommandBock!");r=u[1],i&&i.addChild(r),r.transform.matrix3D=o}r&&(d=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8}),r.pivot=new s(d.get(1,0),d.get(2,0),d.get(3,0)),r.extra=this.parseUserAttributes()),this._blocks[e].data=r,this._debug&&console.log("Parsed a CommandBlock: Name = '"+n)},t.prototype.parseMetaData=function(){var e=this.parseProperties({1:t.UINT32,2:t.AWDSTRING,3:t.AWDSTRING,4:t.AWDSTRING,5:t.AWDSTRING});this._debug&&(console.log("Parsed a MetaDataBlock: TimeStamp         = "+e.get(1,0)),console.log("                        EncoderName       = "+e.get(2,"unknown")),console.log("                        EncoderVersion    = "+e.get(3,"unknown")),console.log("                        GeneratorName     = "+e.get(4,"unknown")),console.log("                        GeneratorVersion  = "+e.get(5,"unknown")))},t.prototype.parseNameSpace=function(){var e=this._newBlockBytes.readUnsignedByte(),t=this.parseVarStr();this._debug&&console.log("Parsed a NameSpaceBlock: ID = "+e+" | String = "+t)},t.prototype.parseShadowMethodList=function(e,i){var r,a,s,o=this._newBlockBytes.readUnsignedShort(),n=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4});switch(o){case 1002:if(a=n.get(1,0),s=this.getAssetByID(a,[l.SHADOW_MAP_METHOD]),!s[0])return this._blocks[i].addError("Could not find the ShadowBaseMethod (ID = "+a+" ) for this ShadowNearMethod - ShadowMethod not created"),r;r=new xt(s[1]);break;case 1101:r=new _t(e),r.alpha=n.get(101,1),r.epsilon=n.get(102,.002);break;case 1102:r=new ut(e,n.get(201,5)),r.alpha=n.get(101,1),r.epsilon=n.get(102,.002),r.range=n.get(103,1);break;case 1103:r=new wt(e,n.get(201,5)),r.alpha=n.get(101,1),r.epsilon=n.get(102,.002),r.range=n.get(103,1);break;case 1104:r=new mt(e),r.alpha=n.get(101,1),r.epsilon=n.get(102,.002)}return this.parseUserAttributes(),r},t.prototype.parseSkeleton=function(e){var t=this.parseVarStr(),i=this._newBlockBytes.readUnsignedShort(),r=new J;this.parseProperties(null);for(var a=0;i>a;){var s,o;this._newBlockBytes.readUnsignedShort(),s=new Y,s.parentIndex=this._newBlockBytes.readUnsignedShort()-1,s.name=this.parseVarStr(),o=this.parseMatrix3D(),s.inverseBindPose=o.rawData,this.parseProperties(null),this.parseUserAttributes(),r.joints.push(s),a++}this.parseUserAttributes(),this._pFinalizeAsset(r,t),this._blocks[e].data=r,this._debug&&console.log("Parsed a Skeleton: Name = "+r.name+" | Number of Joints = "+a)},t.prototype.parseSkeletonPose=function(e){var t=this.parseVarStr(),i=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var r=new K,s=0;i>s;){var o,n;if(o=new W,n=this._newBlockBytes.readUnsignedByte(),1==n){var l=this.parseMatrix43RawData(),h=new a(l);o.orientation.fromMatrix(h),o.translation.copyFrom(h.position),r.jointPoses[s]=o}s++}this.parseUserAttributes(),this._pFinalizeAsset(r,t),this._blocks[e].data=r,this._debug&&console.log("Parsed a SkeletonPose: Name = "+r.name+" | Number of Joints = "+s)},t.prototype.parseSkeletonAnimation=function(e){var t,i,r=this.parseVarStr(),a=new Z,s=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var o,n=0;s>n;)i=this._newBlockBytes.readUnsignedInt(),t=this._newBlockBytes.readUnsignedShort(),o=this.getAssetByID(i,[l.SKELETON_POSE]),o[0]?a.addFrame(this._blocks[i].data,t):this._blocks[e].addError("Could not find the SkeletonPose Frame # "+n+" (ID = "+i+" ) for this SkeletonClipNode"),n++;return 0==a.frames.length?void this._blocks[e].addError("Could not this SkeletonClipNode, because no Frames where set."):(this.parseUserAttributes(),this._pFinalizeAsset(a,r),this._blocks[e].data=a,void(this._debug&&console.log("Parsed a SkeletonClipNode: Name = "+a.name+" | Number of Frames = "+a.frames.length)))},t.prototype.parseMeshPoseAnimation=function(e,i){void 0===i&&(i=!1);var r,a,s,o,n,h,p,d,c,u,_,y,m,g,f=1,b=0,v=new q,D=0,T=0,P=new Array,C=this.parseVarStr(),S=this._newBlockBytes.readUnsignedInt(),A=this.getAssetByID(S,[l.GEOMETRY]);if(!A[0])return void this._blocks[e].addError("Could not find the target-Geometry-Object "+S+" ) for this VertexClipNode");var O=this.getUVForVertexAnimation(S);for(i||(f=this._newBlockBytes.readUnsignedShort()),r=this._newBlockBytes.readUnsignedShort(),D=this._newBlockBytes.readUnsignedShort(),T=0;D>T;)P.push(this._newBlockBytes.readUnsignedShort()),T++;for(g=this.parseProperties({1:t.BOOL,2:t.BOOL}),v.looping=g.get(1,!0),v.stitchFinalFrame=g.get(2,!1),a=0;f>a;){for(o=this._newBlockBytes.readUnsignedShort(),u=new x,s=0;r>s;)for(T=0,d=this._newBlockBytes.readUnsignedInt(),c=this._newBlockBytes.position+d;D>T;){if(1==P[T]){for(y=A[1].subGeometries[s].indices,m=new Array,b=0;this._newBlockBytes.position<c;)n=this.readNumber(this._accuracyGeo),h=this.readNumber(this._accuracyGeo),p=this.readNumber(this._accuracyGeo),m[b++]=n,m[b++]=h,m[b++]=p;_=new w(!0),_.updateIndices(y),_.updatePositions(m),_.updateUVs(O[s]),_.updateVertexNormals(null),_.updateVertexTangents(null),_.autoDeriveNormals=!1,_.autoDeriveTangents=!1,s++,u.addSubGeometry(_)}else this._newBlockBytes.position=c;T++}v.addFrame(u,o),a++}this.parseUserAttributes(),this._pFinalizeAsset(v,C),this._blocks[e].data=v,this._debug&&console.log("Parsed a VertexClipNode: Name = "+v.name+" | Target-Geometry-Name = "+A[1].name+" | Number of Frames = "+v.frames.length)},t.prototype.parseVertexAnimationSet=function(e){for(var i,r=this.parseVarStr(),a=this._newBlockBytes.readUnsignedShort(),s=this.parseProperties({1:t.UINT16}),o=0,n=new Array,h=new Array;a>o;){i=this._newBlockBytes.readUnsignedInt();var p=this.getAssetByID(i,[l.ANIMATION_NODE]);p[0]?(p[1]instanceof q&&h.push(p[1]),p[1]instanceof Z&&n.push(p[1])):this._blocks[e].addError("Could not find the AnimationClipNode Nr "+o+" ( "+i+" ) for this AnimationSet"),o++}if(0==h.length&&0==n.length)return void this._blocks[e].addError("Could not create this AnimationSet, because it contains no animations");if(this.parseUserAttributes(),h.length>0){for(var d=new U,c=0;c<h.length;c++)d.addAnimation(h[c]);this._pFinalizeAsset(d,r),this._blocks[e].data=d,this._debug&&console.log("Parsed a VertexAnimationSet: Name = "+r+" | Animations = "+d.animations.length+" | Animation-Names = "+d.animationNames.toString())}else if(n.length>0){p=this.getAssetByID(i,[l.ANIMATION_NODE]);for(var u=new X(s.get(1,4)),c=0;c<n.length;c++)u.addAnimation(n[c]);this._pFinalizeAsset(u,r),this._blocks[e].data=u,this._debug&&console.log("Parsed a SkeletonAnimationSet: Name = "+r+" | Animations = "+u.animations.length+" | Animation-Names = "+u.animationNames.toString())}},t.prototype.parseAnimatorSet=function(e){var i,r,a=this.parseVarStr(),s=this._newBlockBytes.readUnsignedShort(),o=this.parseProperties({1:t.BADDR});i=this._newBlockBytes.readUnsignedInt();for(var n=this._newBlockBytes.readUnsignedShort(),h=new Array,p=0;n>p;p++)h.push(this._newBlockBytes.readUnsignedInt());this._newBlockBytes.readUnsignedShort(),1==this._newBlockBytes.readUnsignedByte();this.parseUserAttributes(),this.parseUserAttributes();var d,c=new Array;for(p=0;p<h.length;p++)d=this.getAssetByID(h[p],[l.MESH]),d[0]&&c.push(d[1]);if(d=this.getAssetByID(i,[l.ANIMATION_SET]),!d[0])return void this._blocks[e].addError("Could not find the AnimationSet ( "+i+" ) for this Animator");r=d[1];var u;if(1==s){if(d=this.getAssetByID(o.get(1,0),[l.SKELETON]),!d[0])return void this._blocks[e].addError("Could not find the Skeleton ( "+o.get(1,0)+" ) for this Animator");u=new H(r,d[1])}else 2==s&&(u=new G(r));for(this._pFinalizeAsset(u,a),this._blocks[e].data=u,p=0;p<c.length;p++)1==s&&(c[p].animator=u),2==s&&(c[p].animator=u);this._debug&&console.log("Parsed a Animator: Name = "+a)},t.prototype.parseSharedMethodList=function(e){var i,a,s,o=this._newBlockBytes.readUnsignedShort(),n=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType,105:this._propsNrType,106:this._propsNrType,107:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL});switch(o){case 401:i=new st(n.get(101,new Array(0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)));break;case 402:i=new ot;var h=n.get(601,0);i.colorTransform=new r(n.get(102,1),n.get(103,1),n.get(104,1),n.get(101,1),h>>16&255,h>>8&255,255&h,h>>24&255);break;case 403:a=n.get(1,0),console.log("ENV MAP",a),s=this.getAssetByID(a,[l.TEXTURE],"CubeTexture"),s[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+a+" ) for this EnvMapMethod"),i=new nt(s[1],n.get(101,1)),a=n.get(2,0),a>0&&(s=this.getAssetByID(a,[l.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the Mask-texture (ID = "+a+" ) for this EnvMapMethod"));break;case 404:a=n.get(1,0),s=this.getAssetByID(a,[l.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the LightMap (ID = "+a+" ) for this LightMapMethod"),i=new pt(s[1],this.blendModeDic[n.get(401,10)]);break;case 406:i=new dt(n.get(601,16777215),n.get(101,.4),n.get(101,2));break;case 407:a=n.get(1,0),s=this.getAssetByID(a,[l.TEXTURE]),s[0]||this._blocks[e].addError("Could not find the Alpha-texture (ID = "+a+" ) for this AlphaMaskMethod"),i=new at(s[1],n.get(701,!1));break;case 410:a=n.get(1,0),s=this.getAssetByID(a,[l.TEXTURE],"CubeTexture"),s[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+a+" ) for this FresnelEnvMapMethod"),i=new ht(s[1],n.get(101,1));break;case 411:i=new lt(n.get(101,0),n.get(102,1e3),n.get(601,8421504))}return this.parseUserAttributes(),i},t.prototype.parseUserAttributes=function(){var e,i,r;if(i=this._newBlockBytes.readUnsignedInt(),i>0){var a;for(e={},a=this._newBlockBytes.position+i;this._newBlockBytes.position<a;){var s,o,n,l,h;if(s=this._newBlockBytes.readUnsignedByte(),o=this.parseVarStr(),n=this._newBlockBytes.readUnsignedByte(),l=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+l>a)return console.log("           Error in reading attribute # "+r+" = skipped to end of attribute-list"),this._newBlockBytes.position=a,e;switch(n){case t.AWDSTRING:h=this._newBlockBytes.readUTFBytes(l);break;case t.INT8:h=this._newBlockBytes.readByte();break;case t.INT16:h=this._newBlockBytes.readShort();break;case t.INT32:h=this._newBlockBytes.readInt();break;case t.BOOL:case t.UINT8:h=this._newBlockBytes.readUnsignedByte();break;case t.UINT16:h=this._newBlockBytes.readUnsignedShort();break;case t.UINT32:case t.BADDR:h=this._newBlockBytes.readUnsignedInt();break;case t.FLOAT32:h=this._newBlockBytes.readFloat();break;case t.FLOAT64:h=this._newBlockBytes.readDouble();break;default:h="unimplemented attribute type "+n,this._newBlockBytes.position+=l}this._debug&&console.log("attribute = name: "+o+"  / value = "+h),e[o]=h,r+=1}}return e},t.prototype.parseProperties=function(e){var t,i,r=0,a=new Dt;if(i=this._newBlockBytes.readUnsignedInt(),t=this._newBlockBytes.position+i,e)for(;this._newBlockBytes.position<t;){var s,o,n;if(o=this._newBlockBytes.readUnsignedShort(),s=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+s>t)return console.log("           Error in reading property # "+r+" = skipped to end of propertie-list"),this._newBlockBytes.position=t,a;e.hasOwnProperty(o.toString())?(n=e[o],a.set(o,this.parseAttrValue(n,s))):this._newBlockBytes.position+=s,r+=1}else this._newBlockBytes.position=t;return a},t.prototype.parseAttrValue=function(e,i){var r,a;switch(e){case t.BOOL:case t.INT8:r=1,a=this._newBlockBytes.readByte;break;case t.INT16:r=2,a=this._newBlockBytes.readShort;break;case t.INT32:r=4,a=this._newBlockBytes.readInt;break;case t.UINT8:r=1,a=this._newBlockBytes.readUnsignedByte;break;case t.UINT16:r=2,a=this._newBlockBytes.readUnsignedShort;break;case t.UINT32:case t.COLOR:case t.BADDR:r=4,a=this._newBlockBytes.readUnsignedInt;break;case t.FLOAT32:r=4,a=this._newBlockBytes.readFloat;break;case t.FLOAT64:r=8,a=this._newBlockBytes.readDouble;break;case t.AWDSTRING:return this._newBlockBytes.readUTFBytes(i);case t.VECTOR2x1:case t.VECTOR3x1:case t.VECTOR4x1:case t.MTX3x2:case t.MTX3x3:case t.MTX4x3:case t.MTX4x4:r=8,a=this._newBlockBytes.readDouble}if(i>r){for(var s=[],o=0,n=i/r;n>o;)s.push(a.apply(this._newBlockBytes)),o++;return s}var l=a.apply(this._newBlockBytes);return l},t.prototype.parseHeader=function(){var e,i;this._byteData.position=3,this._version[0]=this._byteData.readUnsignedByte(),this._version[1]=this._byteData.readUnsignedByte(),e=this._byteData.readUnsignedShort(),this._streaming=Tt.test(e,Tt.FLAG1),2==this._version[0]&&1==this._version[1]&&(this._accuracyMatrix=Tt.test(e,Tt.FLAG2),this._accuracyGeo=Tt.test(e,Tt.FLAG3),this._accuracyProps=Tt.test(e,Tt.FLAG4)),this._geoNrType=t.FLOAT32,this._accuracyGeo&&(this._geoNrType=t.FLOAT64),this._matrixNrType=t.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=t.FLOAT64),this._propsNrType=t.FLOAT32,this._accuracyProps&&(this._propsNrType=t.FLOAT64),this._compression=this._byteData.readUnsignedByte(),this._debug&&(console.log("Import AWDFile of version = "+this._version[0]+" - "+this._version[1]),console.log("Global Settings = Compression = "+this._compression+" | Streaming = "+this._streaming+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps)),i=this._byteData.readUnsignedInt(),this._streaming||i==this._byteData.getBytesAvailable()||this._pDieWithError("AWD2 body length does not match header integrity field")
},t.prototype.getUVForVertexAnimation=function(e){if(this._blocks[e].data instanceof P&&(e=this._blocks[e].geoID),this._blocks[e].uvsForVertexAnimation)return this._blocks[e].uvsForVertexAnimation;var t,i,r,a,s,o,n,l=this._blocks[e].data,h=0;for(this._blocks[e].uvsForVertexAnimation=new Array;h<l.subGeometries.length;){for(o=new Array,n=l.subGeometries[h],a=n.numVertices,t=n.uvs,i=n.getStride(w.UV_DATA),r=n.getOffset(w.UV_DATA),s=0;a>s;s++)o.push(t[r+s*i+0]),o.push(t[r+s*i+1]);this._blocks[e].uvsForVertexAnimation.push(o),h++}return this._blocks[e].uvsForVertexAnimation},t.prototype.parseVarStr=function(){var e=this._newBlockBytes.readUnsignedShort();return this._newBlockBytes.readUTFBytes(e)},t.prototype.getAssetByID=function(e,t,i){void 0===i&&(i="SingleTexture");var r=new Array,a=0;if(e>0&&this._blocks[e]&&this._blocks[e].data)for(;a<t.length;){var s=this._blocks[e].data;if(s.assetType==t[a]){if(t[a]==l.TEXTURE&&"CubeTexture"==i&&this._blocks[e].data instanceof y)return r.push(!0),r.push(this._blocks[e].data),r;if(t[a]!=l.TEXTURE||"SingleTexture"!=i)return r.push(!0),r.push(this._blocks[e].data),r;if(this._blocks[e].data instanceof m)return r.push(!0),r.push(this._blocks[e].data),r}if(t[a]==l.GEOMETRY&&s.assetType==l.MESH){var o=this._blocks[e].data;return r.push(!0),r.push(o.geometry),r}a++}return r.push(!1),r.push(this.getDefaultAsset(t[0],i)),r},t.prototype.getDefaultAsset=function(e,t){switch(!0){case e==l.TEXTURE:if("CubeTexture"==t)return this.getDefaultCubeTexture();if("SingleTexture"==t)return this.getDefaultTexture();break;case e==l.MATERIAL:return this.getDefaultMaterial()}return null},t.prototype.getDefaultMaterial=function(){return this._defaultBitmapMaterial||(this._defaultBitmapMaterial=k.getDefaultMaterial()),this._defaultBitmapMaterial},t.prototype.getDefaultTexture=function(){return this._defaultTexture||(this._defaultTexture=k.getDefaultTexture()),this._defaultTexture},t.prototype.getDefaultCubeTexture=function(){if(!this._defaultCubeTexture){var e=k.createCheckeredBitmapData();this._defaultCubeTexture=new _(e,e,e,e,e,e),this._defaultCubeTexture.name="defaultCubeTexture"}return this._defaultCubeTexture},t.prototype.readNumber=function(e){return void 0===e&&(e=!1),e?this._newBlockBytes.readDouble():this._newBlockBytes.readFloat()},t.prototype.parseMatrix3D=function(){return new a(this.parseMatrix43RawData())},t.prototype.parseMatrix32RawData=function(){var e,t=new Array(6);for(e=0;6>e;e++)t[e]=this._newBlockBytes.readFloat();return t},t.prototype.parseMatrix43RawData=function(){var e=new Array(16);return e[0]=this.readNumber(this._accuracyMatrix),e[1]=this.readNumber(this._accuracyMatrix),e[2]=this.readNumber(this._accuracyMatrix),e[3]=0,e[4]=this.readNumber(this._accuracyMatrix),e[5]=this.readNumber(this._accuracyMatrix),e[6]=this.readNumber(this._accuracyMatrix),e[7]=0,e[8]=this.readNumber(this._accuracyMatrix),e[9]=this.readNumber(this._accuracyMatrix),e[10]=this.readNumber(this._accuracyMatrix),e[11]=0,e[12]=this.readNumber(this._accuracyMatrix),e[13]=this.readNumber(this._accuracyMatrix),e[14]=this.readNumber(this._accuracyMatrix),e[15]=1,isNaN(e[0])&&(e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e[12]=0,e[13]=0,e[14]=0),e},t.COMPRESSIONMODE_LZMA="lzma",t.UNCOMPRESSED=0,t.DEFLATE=1,t.LZMA=2,t.INT8=1,t.INT16=2,t.INT32=3,t.UINT8=4,t.UINT16=5,t.UINT32=6,t.FLOAT32=7,t.FLOAT64=8,t.BOOL=21,t.COLOR=22,t.BADDR=23,t.AWDSTRING=31,t.AWDBYTEARRAY=32,t.VECTOR2x1=41,t.VECTOR3x1=42,t.VECTOR4x1=43,t.MTX3x2=44,t.MTX3x3=45,t.MTX4x3=46,t.MTX4x4=47,t}(h);t.exports=Pt},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-core/lib/projections/OrthographicOffCenterProjection":void 0,"awayjs-core/lib/projections/OrthographicProjection":void 0,"awayjs-core/lib/projections/PerspectiveProjection":void 0,"awayjs-core/lib/textures/BitmapCubeTexture":void 0,"awayjs-core/lib/textures/ImageCubeTexture":void 0,"awayjs-core/lib/textures/ImageTexture":void 0,"awayjs-core/lib/utils/ByteArray":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Camera":void 0,"awayjs-display/lib/entities/DirectionalLight":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-display/lib/entities/PointLight":void 0,"awayjs-display/lib/entities/Skybox":void 0,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":void 0,"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper":void 0,"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper":void 0,"awayjs-display/lib/prefabs/PrefabBase":void 0,"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveConePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveCubePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab":void 0,"awayjs-display/lib/prefabs/PrimitivePlanePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveSpherePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveTorusPrefab":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimator":void 0,"awayjs-renderergl/lib/animators/VertexAnimationSet":void 0,"awayjs-renderergl/lib/animators/VertexAnimator":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/Skeleton":void 0,"awayjs-renderergl/lib/animators/data/SkeletonJoint":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":void 0,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":void 0,"awayjs-renderergl/lib/materials/methods/AmbientEnvMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseCelMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseDepthMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseGradientMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseLightMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/DiffuseWrapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectAlphaMaskMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectColorMatrixMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectEnvMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectFogMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectFresnelEnvMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectLightMapMethod":void 0,"awayjs-renderergl/lib/materials/methods/EffectRimLightMethod":void 0,"awayjs-renderergl/lib/materials/methods/NormalSimpleWaterMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowDitheredMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowFilteredMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowNearMethod":void 0,"awayjs-renderergl/lib/materials/methods/ShadowSoftMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularAnisotropicMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularCelMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularFresnelMethod":void 0,"awayjs-renderergl/lib/materials/methods/SpecularPhongMethod":void 0,"awayjs-renderergl/lib/parsers/data/AWDBlock":void 0,"awayjs-renderergl/lib/parsers/data/AWDProperties":void 0,"awayjs-renderergl/lib/parsers/data/BitFlags":void 0,"awayjs-stagegl/lib/materials/SkyboxMaterial":void 0,"awayjs-stagegl/lib/materials/TriangleMaterialMode":void 0,"awayjs-stagegl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-stagegl/lib/materials/methods/EffectColorTransformMethod":void 0,"awayjs-stagegl/lib/materials/methods/ShadowHardMethod":void 0,"awayjs-stagegl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/MD2Parser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/net/URLLoaderDataFormat"),a=e("awayjs-core/lib/net/URLRequest"),s=e("awayjs-core/lib/parsers/ParserBase"),o=e("awayjs-core/lib/parsers/ParserUtils"),n=e("awayjs-display/lib/containers/DisplayObjectContainer"),l=e("awayjs-display/lib/base/Geometry"),h=e("awayjs-display/lib/base/TriangleSubGeometry"),p=e("awayjs-display/lib/entities/Mesh"),d=e("awayjs-stagegl/lib/materials/utils/DefaultMaterialManager"),c=e("awayjs-stagegl/lib/materials/TriangleMethodMaterial"),u=e("awayjs-stagegl/lib/materials/TriangleMaterialMode"),_=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode"),y=e("awayjs-renderergl/lib/animators/VertexAnimationSet"),m=function(e){function t(t,i){void 0===t&&(t="jpg"),void 0===i&&(i=!0),e.call(this,r.ARRAY_BUFFER),this._clipNodes=new Object,this._animationSet=new y,this.materialFinal=!1,this.geoCreated=!1,this._textureType=t,this._ignoreTexturePath=i}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md2"==e},t.supportsData=function(e){return"IDP2"==o.toString(e,4)},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t=e.assets[0];if(t){var i=new c(t);this.materialMode>=2&&(i.materialMode=u.MULTI_PASS),this._pContent.addChild(this._mesh),i.name=this._mesh.material.name,this._mesh.material=i,this._pFinalizeAsset(i),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)}this.materialFinal=!0}},t.prototype._iResolveDependencyFailure=function(){this.materialMode<2?this._mesh.material=d.getDefaultMaterial():(this._mesh.material=new c(d.getDefaultTexture()),this._mesh.material.materialMode=u.MULTI_PASS),this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh),this.materialFinal=!0},t.prototype._pProceedParsing=function(){for(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0,this._byteData.position=0);this._pHasTime();)if(this._parsedHeader)if(this._parsedUV)if(this._parsedFaces)if(this._parsedFrames){if(this.geoCreated&&this.materialFinal)return s.PARSING_DONE;this.geoCreated||(this.geoCreated=!0,this._geometry.addSubGeometry(this._firstSubGeom.clone()),this._mesh.name="",this.materialFinal&&(this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)),this._pPauseAndRetrieveDependencies())}else this.parseFrames();else this.parseFaces();else this.parseUV();else this._geometry=new l,this._mesh=new p(this._geometry,null),this.materialMode<2?this._mesh.material=d.getDefaultMaterial():(this._mesh.material=new c(d.getDefaultTexture()),this._mesh.material.materialMode=u.MULTI_PASS),this.parseHeader(),this.parseMaterialNames();return s.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new n},t.prototype.parseHeader=function(){this._ident=this._byteData.readInt(),this._version=this._byteData.readInt(),this._skinWidth=this._byteData.readInt(),this._skinHeight=this._byteData.readInt(),this._byteData.readInt(),this._numSkins=this._byteData.readInt(),this._numVertices=this._byteData.readInt(),this._numST=this._byteData.readInt(),this._numTris=this._byteData.readInt(),this._byteData.readInt(),this._numFrames=this._byteData.readInt(),this._offsetSkins=this._byteData.readInt(),this._offsetST=this._byteData.readInt(),this._offsetTris=this._byteData.readInt(),this._offsetFrames=this._byteData.readInt(),this._byteData.readInt(),this._offsetEnd=this._byteData.readInt(),this._parsedHeader=!0},t.prototype.parseMaterialNames=function(){var e,t,i,r;this._materialNames=new Array,this._byteData.position=this._offsetSkins;for(var s=new RegExp("[^a-zA-Z0-9\\_/.]","g"),o=0;o<this._numSkins;++o)t=this._byteData.readUTFBytes(64),t=t.replace(s,""),i=t.lastIndexOf("."),this._ignoreTexturePath&&(r=t.lastIndexOf("/")),-1==t.toLowerCase().indexOf(".jpg")&&-1==t.toLowerCase().indexOf(".png")?(t=t.substring(r+1,i),e=t+"."+this._textureType):e=t,this._materialNames[o]=t,0==this.dependencies.length&&this._pAddDependency(t,new a(e));this._materialNames.length>0?this._mesh.material.name=this._materialNames[0]:this.materialFinal=!0},t.prototype.parseUV=function(){var e=0;this._uvs=new Array(2*this._numST),this._byteData.position=this._offsetST;for(var t=0;t<this._numST;t++)this._uvs[e++]=this._byteData.readShort()/this._skinWidth,this._uvs[e++]=this._byteData.readShort()/this._skinHeight;this._parsedUV=!0},t.prototype.parseFaces=function(){var e,t,i,r,a,s,o;for(this._vertIndices=new Array,this._uvIndices=new Array,this._indices=new Array,this._byteData.position=this._offsetTris,o=0;o<this._numTris;o++)e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedShort(),a=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedShort(),this.addIndex(e,r),this.addIndex(t,a),this.addIndex(i,s);var n=this._uvIndices.length;for(this._finalUV=new Array(2*n),o=0;n>o;++o)this._finalUV[o<<1]=this._uvs[this._uvIndices[o]<<1],this._finalUV[(o<<1)+1]=this._uvs[(this._uvIndices[o]<<1)+1];this._parsedFaces=!0},t.prototype.addIndex=function(e,t){var i=this.findIndex(e,t);-1==i?(this._indices.push(this._vertIndices.length),this._vertIndices.push(e),this._uvIndices.push(t)):this._indices.push(i)},t.prototype.findIndex=function(e,t){for(var i=this._vertIndices.length,r=0;i>r;++r)if(this._vertIndices[r]==e&&this._uvIndices[r]==t)return r;return-1},t.prototype.parseFrames=function(){var e,i,r,a,s,o,n,p,d,c,u,y,m,g=this._vertIndices.length,f="",b=null;for(this._byteData.position=this._offsetFrames,u=0;u<this._numFrames;u++){for(c=new Array,d=new Array(3*g),e=this._byteData.readFloat(),i=this._byteData.readFloat(),r=this._byteData.readFloat(),a=this._byteData.readFloat(),s=this._byteData.readFloat(),o=this._byteData.readFloat(),f=this.readFrameName(),y=0;y<this._numVertices;y++,this._byteData.position++)c.push(e*this._byteData.readUnsignedByte()+a,i*this._byteData.readUnsignedByte()+s,r*this._byteData.readUnsignedByte()+o);for(m=0,y=0;g>y;y++)d[m++]=c[3*this._vertIndices[y]],d[m++]=c[3*this._vertIndices[y]+2],d[m++]=c[3*this._vertIndices[y]+1];p=new h(!0),null==this._firstSubGeom&&(this._firstSubGeom=p),n=new l,n.addSubGeometry(p),p.updateIndices(this._indices),p.updatePositions(d),p.updateUVs(this._finalUV),p.vertexNormals,p.vertexTangents,p.autoDeriveNormals=!1,p.autoDeriveTangents=!1;var x=this._clipNodes[f];x||(b&&(this._pFinalizeAsset(b),this._animationSet.addAnimation(b)),x=new _,x.name=f,x.stitchFinalFrame=!0,this._clipNodes[f]=x,b=x),x.addFrame(n,1e3/t.FPS)}b&&(this._pFinalizeAsset(b),this._animationSet.addAnimation(b)),this._pFinalizeAsset(this._animationSet),this._parsedFrames=!0},t.prototype.readFrameName=function(){for(var e="",t=0,i=0;16>i;i++){var r=this._byteData.readUnsignedByte();Math.floor(r)>57&&Math.floor(r)<=122&&0==t&&(e+=String.fromCharCode(r)),Math.floor(r)>=48&&Math.floor(r)<=57&&t++}return e},t.FPS=6,t}(s);t.exports=m},{"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/animators/VertexAnimationSet":void 0,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":void 0,"awayjs-stagegl/lib/materials/TriangleMaterialMode":void 0,"awayjs-stagegl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-stagegl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/MD5AnimParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/net/URLLoaderDataFormat"),o=e("awayjs-core/lib/parsers/ParserBase"),n=e("awayjs-renderergl/lib/animators/data/JointPose"),l=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),h=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode"),p=e("awayjs-renderergl/lib/parsers/data/BaseFrameData"),d=e("awayjs-renderergl/lib/parsers/data/BoundsData"),c=e("awayjs-renderergl/lib/parsers/data/FrameData"),u=e("awayjs-renderergl/lib/parsers/data/HierarchyData"),_=function(e){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=0),e.call(this,s.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new r;var o=new r,n=new r;o.fromAxisAngle(a.X_AXIS,.5*-Math.PI),n.fromAxisAngle(a.Y_AXIS,.5*-Math.PI),this._rotationQuat.multiply(n,o),t&&(this._rotationQuat.multiply(n,o),o.fromAxisAngle(t,i),this._rotationQuat.multiply(o,this._rotationQuat))}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md5anim"==e},t.supportsData=function(){return!1},t.prototype._pProceedParsing=function(){var e;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case"":break;case t.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_FRAMES_TOKEN:this._numFrames=this.getNextInt(),this._bounds=new Array,this._frameData=new Array;break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._hierarchy=new Array(this._numJoints),this._baseFrameData=new Array(this._numJoints);break;case t.FRAME_RATE_TOKEN:this._frameRate=this.getNextInt();break;case t.NUM_ANIMATED_COMPONENTS_TOKEN:this._numAnimatedComponents=this.getNextInt();break;case t.HIERARCHY_TOKEN:this.parseHierarchy();break;case t.BOUNDS_TOKEN:this.parseBounds();break;case t.BASE_FRAME_TOKEN:this.parseBaseFrame();break;case t.FRAME_TOKEN:this.parseFrame();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF)return this._clip=new h,this.translateClip(),this._pFinalizeAsset(this._clip),o.PARSING_DONE}return o.MORE_TO_PARSE},t.prototype.translateClip=function(){for(var e=0;e<this._numFrames;++e)this._clip.addFrame(this.translatePose(this._frameData[e]),1e3/this._frameRate)},t.prototype.translatePose=function(e){for(var t,i,s,o,h,p=new a,d=new r,c=e.components,u=new l,_=u.jointPoses,y=0;y<this._numJoints;++y){h=0,i=new n,t=this._hierarchy[y],s=this._baseFrameData[y],o=t.flags,p.x=s.position.x,p.y=s.position.y,p.z=s.position.z,d.x=s.orientation.x,d.y=s.orientation.y,d.z=s.orientation.z,1&o&&(p.x=c[t.startIndex+h++]),2&o&&(p.y=c[t.startIndex+h++]),4&o&&(p.z=c[t.startIndex+h++]),8&o&&(d.x=c[t.startIndex+h++]),16&o&&(d.y=c[t.startIndex+h++]),32&o&&(d.z=c[t.startIndex+h++]);var m=1-d.x*d.x-d.y*d.y-d.z*d.z;d.w=0>m?0:-Math.sqrt(m),t.parentIndex<0?(i.orientation.multiply(this._rotationQuat,d),i.translation=this._rotationQuat.rotatePoint(p)):(i.orientation.copyFrom(d),i.translation.x=p.x,i.translation.y=p.y,i.translation.z=p.z),i.orientation.y=-i.orientation.y,i.orientation.z=-i.orientation.z,i.translation.x=-i.translation.x,_[y]=i}return u},t.prototype.parseHierarchy=function(){var e,i,r=this.getNextToken(),a=0;"{"!=r&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),i=new u,i.name=this.parseLiteralstring(),i.parentIndex=this.getNextInt(),i.flags=this.getNextInt(),i.startIndex=this.getNextInt(),this._hierarchy[a++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseBounds=function(){var e,i,r=this.getNextToken(),a=0;"{"!=r&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),i=new d,i.min=this.parseVector3D(),i.max=this.parseVector3D(),this._bounds[a++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseBaseFrame=function(){var e,i,r=this.getNextToken(),a=0;"{"!=r&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),i=new p,i.position=this.parseVector3D(),i.orientation=this.parseQuaternion(),this._baseFrameData[a++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseFrame=function(){var e,i,r,a;a=this.getNextInt(),r=this.getNextToken(),"{"!=r&&this.sendUnknownKeywordError();do{this._reachedEOF&&this.sendEOFError(),i=new c,i.components=new Array(this._numAnimatedComponents);for(var s=0;s<this._numAnimatedComponents;++s)i.components[s]=this.getNextNumber();this._frameData[a]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack()}while("}"!=e)},t.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},t.prototype.getNextToken=function(){for(var e,i="";!this._reachedEOF;){if(e=this.getNextChar()," "==e||"\r"==e||"\n"==e||"	"==e){if(i!=t.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=i)return i}else i+=e;if(i==t.COMMENT_TOKEN)return i}return i},t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while("\n"==e||" "==e||"\r"==e||"	"==e);this.putBack()},t.prototype.ignoreLine=function(){for(var e;!this._reachedEOF&&"\n"!=e;)e=this.getNextChar()},t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);return"\n"==e?(++this._line,this._charLineIndex=0):"\r"!=e&&++this._charLineIndex,this._parseIndex==this._textData.length&&(this._reachedEOF=!0),e},t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());return isNaN(e)&&this.sendParseError("int type"),e},t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());return isNaN(e)&&this.sendParseError("float type"),e},t.prototype.parseVector3D=function(){var e=new a,t=this.getNextToken();return"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseQuaternion=function(){var e=new r,t=this.getNextToken();"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber();var i=1-e.x*e.x-e.y*e.y-e.z*e.z;return e.w=0>i?0:-Math.sqrt(i),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseCMD=function(){this.parseLiteralstring()},t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar(),t="";'"'!=e&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),e=this.getNextChar(),'"'!=e&&(t+=e);while('"'!=e);return t},t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},t.VERSION_TOKEN="MD5Version",t.COMMAND_LINE_TOKEN="commandline",t.NUM_FRAMES_TOKEN="numFrames",t.NUM_JOINTS_TOKEN="numJoints",t.FRAME_RATE_TOKEN="frameRate",t.NUM_ANIMATED_COMPONENTS_TOKEN="numAnimatedComponents",t.HIERARCHY_TOKEN="hierarchy",t.BOUNDS_TOKEN="bounds",t.BASE_FRAME_TOKEN="baseframe",t.FRAME_TOKEN="frame",t.COMMENT_TOKEN="//",t}(o);t.exports=_},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":void 0,"awayjs-renderergl/lib/parsers/data/BaseFrameData":void 0,"awayjs-renderergl/lib/parsers/data/BoundsData":void 0,"awayjs-renderergl/lib/parsers/data/FrameData":void 0,"awayjs-renderergl/lib/parsers/data/HierarchyData":void 0}],"awayjs-renderergl/lib/parsers/MD5MeshParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Quaternion"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/net/URLLoaderDataFormat"),o=e("awayjs-core/lib/parsers/ParserBase"),n=e("awayjs-display/lib/containers/DisplayObjectContainer"),l=e("awayjs-display/lib/base/Geometry"),h=e("awayjs-display/lib/base/TriangleSubGeometry"),p=e("awayjs-display/lib/entities/Mesh"),d=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet"),c=e("awayjs-renderergl/lib/animators/data/Skeleton"),u=e("awayjs-renderergl/lib/animators/data/SkeletonJoint"),_=function(e){function t(t,i){if(void 0===t&&(t=null),void 0===i&&(i=0),e.call(this,s.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new r,this._rotationQuat.fromAxisAngle(a.X_AXIS,.5*-Math.PI),t){var o=new r;o.fromAxisAngle(t,i),this._rotationQuat.multiply(this._rotationQuat,o)}}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md5mesh"==e},t.supportsData=function(){return!1},t.prototype._pProceedParsing=function(){var e;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._bindPoses=new Array(this._numJoints);break;case t.NUM_MESHES_TOKEN:this._numMeshes=this.getNextInt();break;case t.JOINTS_TOKEN:this.parseJoints();break;case t.MESH_TOKEN:this.parseMesh();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF){this.calculateMaxJointCount(),this._animationSet=new d(this._maxJointCount),this._mesh=new p(new l,null),this._geometry=this._mesh.geometry;for(var i=0;i<this._meshData.length;++i)this._geometry.addSubGeometry(this.translateGeom(this._meshData[i].vertexData,this._meshData[i].weightData,this._meshData[i].indices));return this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._geometry),this._pFinalizeAsset(this._mesh),this._pFinalizeAsset(this._skeleton),this._pFinalizeAsset(this._animationSet),o.PARSING_DONE}}return o.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new n},t.prototype.calculateMaxJointCount=function(){this._maxJointCount=0;for(var e=this._meshData.length,t=0;e>t;++t)for(var i=this._meshData[t],r=i.vertexData,a=r.length,s=0;a>s;++s){var o=this.countZeroWeightJoints(r[s],i.weightData),n=r[s].countWeight-o;n>this._maxJointCount&&(this._maxJointCount=n)}},t.prototype.countZeroWeightJoints=function(e,t){for(var i,r=e.startWeight,a=e.startWeight+e.countWeight,s=0,o=r;a>o;++o)i=t[o].bias,0==i&&++s;return s},t.prototype.parseJoints=function(){var e,i,r,a,s=0,o=this.getNextToken();"{"!=o&&this.sendUnknownKeywordError(),this._skeleton=new c;do{this._reachedEOF&&this.sendEOFError(),i=new u,i.name=this.parseLiteralstring(),i.parentIndex=this.getNextInt(),r=this.parseVector3D(),r=this._rotationQuat.rotatePoint(r),a=this.parseQuaternion(),this._bindPoses[s]=a.toMatrix3D(),this._bindPoses[s].appendTranslation(r.x,r.y,r.z);var n=this._bindPoses[s].clone();n.invert(),i.inverseBindPose=n.rawData,this._skeleton.joints[s++]=i,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack()}while("}"!=e)},t.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},t.prototype.parseMesh=function(){var e,i,r,a,s=this.getNextToken();for("{"!=s&&this.sendUnknownKeywordError(),null==this._shaders&&(this._shaders=new Array);"}"!=e;)switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.MESH_SHADER_TOKEN:this._shaders.push(this.parseLiteralstring());break;case t.MESH_NUM_VERTS_TOKEN:i=new Array(this.getNextInt());break;case t.MESH_NUM_TRIS_TOKEN:a=new Array(3*this.getNextInt());break;case t.MESH_NUM_WEIGHTS_TOKEN:r=new Array(this.getNextInt());break;case t.MESH_VERT_TOKEN:this.parseVertex(i);break;case t.MESH_TRI_TOKEN:this.parseTri(a);break;case t.MESH_WEIGHT_TOKEN:this.parseJoint(r)}null==this._meshData&&(this._meshData=new Array);var o=this._meshData.length;this._meshData[o]=new g,this._meshData[o].vertexData=i,this._meshData[o].weightData=r,this._meshData[o].indices=a},t.prototype.translateGeom=function(e,t,i){for(var r,a,s,o,n,l,p,d,c=e.length,u=new h(!0),_=new Array(2*c),y=new Array(3*c),m=new Array(c*this._maxJointCount),g=new Array(c*this._maxJointCount),f=0,b=0;c>b;++b){o=e[b],r=3*o.index,a=r+1,s=r+2,y[r]=y[a]=y[s]=0,d=0;for(var x=0;x<o.countWeight;++x)n=t[o.startWeight+x],n.bias>0&&(l=this._bindPoses[n.joint],p=l.transformVector(n.pos),y[r]+=p.x*n.bias,y[a]+=p.y*n.bias,y[s]+=p.z*n.bias,m[f]=3*n.joint,g[f++]=n.bias,++d);for(x=d;x<this._maxJointCount;++x)m[f]=0,g[f++]=0;r=o.index<<1,_[r++]=o.s,_[r]=o.t}return u.jointsPerVertex=this._maxJointCount,u.updateIndices(i),u.updatePositions(y),u.updateUVs(_),u.updateJointIndices(m),u.updateJointWeights(g),u.vertexNormals,u.vertexTangents,u.autoDeriveTangents=!1,u.autoDeriveNormals=!1,u},t.prototype.parseTri=function(e){var t=3*this.getNextInt();e[t]=this.getNextInt(),e[t+1]=this.getNextInt(),e[t+2]=this.getNextInt()},t.prototype.parseJoint=function(e){var t=new m;t.index=this.getNextInt(),t.joint=this.getNextInt(),t.bias=this.getNextNumber(),t.pos=this.parseVector3D(),e[t.index]=t},t.prototype.parseVertex=function(e){var t=new y;t.index=this.getNextInt(),this.parseUV(t),t.startWeight=this.getNextInt(),t.countWeight=this.getNextInt(),e[t.index]=t},t.prototype.parseUV=function(e){var t=this.getNextToken();"("!=t&&this.sendParseError("("),e.s=this.getNextNumber(),e.t=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")")},t.prototype.getNextToken=function(){for(var e,i="";!this._reachedEOF;){if(e=this.getNextChar()," "==e||"\r"==e||"\n"==e||"	"==e){if(i!=t.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=i)return i}else i+=e;if(i==t.COMMENT_TOKEN)return i}return i},t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while("\n"==e||" "==e||"\r"==e||"	"==e);this.putBack()},t.prototype.ignoreLine=function(){for(var e;!this._reachedEOF&&"\n"!=e;)e=this.getNextChar()},t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);return"\n"==e?(++this._line,this._charLineIndex=0):"\r"!=e&&++this._charLineIndex,this._parseIndex>=this._textData.length&&(this._reachedEOF=!0),e},t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());return isNaN(e)&&this.sendParseError("int type"),e},t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());return isNaN(e)&&this.sendParseError("float type"),e},t.prototype.parseVector3D=function(){var e=new a,t=this.getNextToken();return"("!=t&&this.sendParseError("("),e.x=-this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseQuaternion=function(){var e=new r,t=this.getNextToken();"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=-this.getNextNumber(),e.z=-this.getNextNumber();
var i=1-e.x*e.x-e.y*e.y-e.z*e.z;e.w=0>i?0:-Math.sqrt(i),")"!=this.getNextToken()&&this.sendParseError(")");var a=new r;return a.multiply(this._rotationQuat,e),a},t.prototype.parseCMD=function(){this.parseLiteralstring()},t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar(),t="";'"'!=e&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),e=this.getNextChar(),'"'!=e&&(t+=e);while('"'!=e);return t},t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},t.VERSION_TOKEN="MD5Version",t.COMMAND_LINE_TOKEN="commandline",t.NUM_JOINTS_TOKEN="numJoints",t.NUM_MESHES_TOKEN="numMeshes",t.COMMENT_TOKEN="//",t.JOINTS_TOKEN="joints",t.MESH_TOKEN="mesh",t.MESH_SHADER_TOKEN="shader",t.MESH_NUM_VERTS_TOKEN="numverts",t.MESH_VERT_TOKEN="vert",t.MESH_NUM_TRIS_TOKEN="numtris",t.MESH_TRI_TOKEN="tri",t.MESH_NUM_WEIGHTS_TOKEN="numweights",t.MESH_WEIGHT_TOKEN="weight",t}(o),y=function(){function e(){}return e}(),m=function(){function e(){}return e}(),g=function(){function e(){}return e}();t.exports=_},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/Skeleton":void 0,"awayjs-renderergl/lib/animators/data/SkeletonJoint":void 0}],"awayjs-renderergl/lib/parsers/Max3DSParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=e("awayjs-core/lib/geom/Vector3D"),s=e("awayjs-core/lib/library/AssetType"),o=e("awayjs-core/lib/net/URLLoaderDataFormat"),n=e("awayjs-core/lib/net/URLRequest"),l=e("awayjs-core/lib/parsers/ParserBase"),h=e("awayjs-core/lib/parsers/ParserUtils"),p=e("awayjs-display/lib/containers/DisplayObjectContainer"),d=e("awayjs-display/lib/base/Geometry"),c=e("awayjs-display/lib/base/TriangleSubGeometry"),u=e("awayjs-display/lib/entities/Mesh"),_=e("awayjs-stagegl/lib/materials/utils/DefaultMaterialManager"),y=e("awayjs-stagegl/lib/materials/TriangleMethodMaterial"),m=e("awayjs-stagegl/lib/materials/TriangleMaterialMode"),g=e("awayjs-renderergl/lib/parsers/data/FaceVO"),f=e("awayjs-renderergl/lib/parsers/data/MaterialVO"),b=e("awayjs-renderergl/lib/parsers/data/ObjectVO"),x=e("awayjs-renderergl/lib/parsers/data/TextureVO"),w=e("awayjs-renderergl/lib/parsers/data/VertexVO"),v=function(e){function t(t){void 0===t&&(t=!0),e.call(this,o.ARRAY_BUFFER),this._useSmoothingGroups=t}return i(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"3ds"==e},t.supportsData=function(e){var t;return t=h.toByteArray(e),t&&(t.position=0,19789==t.readShort())?!0:!1},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t;if(t=e.assets[0],t.assetType==s.TEXTURE){var i;i=this._textures[e.id],i.texture=t}}},t.prototype._iResolveDependencyFailure=function(){},t.prototype._pProceedParsing=function(){for(this._byteData||(this._byteData=this._pGetByteData(),this._byteData.position=0,this._textures={},this._materials={},this._unfinalized_objects={});this._pHasTime();)if(this._cur_mat&&this._byteData.position>=this._cur_mat_end?this.finalizeCurrentMaterial():this._cur_obj&&this._byteData.position>=this._cur_obj_end&&(this._unfinalized_objects[this._cur_obj.name]=this._cur_obj,this._cur_obj_end=Number.MAX_VALUE,this._cur_obj=null),this._byteData.getBytesAvailable()>0){var e,t,i;switch(e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedInt(),i=this._byteData.position+(t-6),e){case 19789:case 15677:case 45056:continue;case 45055:this._cur_mat_end=i,this._cur_mat=this.parseMaterial();break;case 16384:this._cur_obj_end=i,this._cur_obj=new b,this._cur_obj.name=this.readNulTermstring(),this._cur_obj.materials=new Array,this._cur_obj.materialFaces={};break;case 16640:this._cur_obj.type=s.MESH;break;case 16656:this.parseVertexList();break;case 16672:this.parseFaceList();break;case 16704:this.parseUVList();break;case 16688:this.parseFaceMaterialList();break;case 16736:this._cur_obj.transform=this.readTransform();break;case 45058:this.parseObjectAnimation(i);break;case 16720:this.parseSmoothingGroups();break;default:this._byteData.position+=t-6}if(this.dependencies.length){this._pPauseAndRetrieveDependencies();break}}if(this._byteData.getBytesAvailable()||this._cur_obj||this._cur_mat)return l.MORE_TO_PARSE;var r;for(r in this._unfinalized_objects){var a;a=this.constructObject(this._unfinalized_objects[r]),a&&(this._pContent.addChild(a),this._pFinalizeAsset(a,r))}return l.PARSING_DONE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new p},t.prototype.parseMaterial=function(){var e;for(e=new f;this._byteData.position<this._cur_mat_end;){var t,i,r;switch(t=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedInt(),r=this._byteData.position+(i-6),t){case 40960:e.name=this.readNulTermstring();break;case 40976:e.ambientColor=this.readColor();break;case 40992:e.diffuseColor=this.readColor();break;case 41008:e.specularColor=this.readColor();break;case 41089:e.twoSided=!0;break;case 41472:e.colorMap=this.parseTexture(r);break;case 41476:e.specularMap=this.parseTexture(r);break;default:this._byteData.position=r}}return e},t.prototype.parseTexture=function(e){var t;for(t=new x;this._byteData.position<e;){var i,r;switch(i=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedInt(),i){case 41728:t.url=this.readNulTermstring();break;default:this._byteData.position+=r-6}}return this._textures[t.url]=t,this._pAddDependency(t.url,new n(t.url)),t},t.prototype.parseVertexList=function(){var e,t,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.verts=new Array(3*i),e=0,t=this._cur_obj.verts.length;t>e;){var r,a,s;r=this._byteData.readFloat(),a=this._byteData.readFloat(),s=this._byteData.readFloat(),this._cur_obj.verts[e++]=r,this._cur_obj.verts[e++]=s,this._cur_obj.verts[e++]=a}},t.prototype.parseFaceList=function(){var e,t,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.indices=new Array(3*i),e=0,t=this._cur_obj.indices.length;t>e;){var r,a,s;r=this._byteData.readUnsignedShort(),a=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedShort(),this._cur_obj.indices[e++]=r,this._cur_obj.indices[e++]=s,this._cur_obj.indices[e++]=a,this._byteData.position+=2}this._cur_obj.smoothingGroups=new Array(i)},t.prototype.parseSmoothingGroups=function(){for(var e=this._cur_obj.indices.length/3,t=0;e>t;)this._cur_obj.smoothingGroups[t]=this._byteData.readUnsignedInt(),t++},t.prototype.parseUVList=function(){var e,t,i;for(i=this._byteData.readUnsignedShort(),this._cur_obj.uvs=new Array(2*i),e=0,t=this._cur_obj.uvs.length;t>e;)this._cur_obj.uvs[e++]=this._byteData.readFloat(),this._cur_obj.uvs[e++]=1-this._byteData.readFloat()},t.prototype.parseFaceMaterialList=function(){var e,t,i,r;for(e=this.readNulTermstring(),t=this._byteData.readUnsignedShort(),r=new Array(t),i=0;i<r.length;)r[i++]=this._byteData.readUnsignedShort();this._cur_obj.materials.push(e),this._cur_obj.materialFaces[e]=r},t.prototype.parseObjectAnimation=function(e){var t,i,r,s,o;for(r=new a;this._byteData.position<e;){var n,l;switch(n=this._byteData.readUnsignedShort(),l=this._byteData.readUnsignedInt(),n){case 45072:s=this.readNulTermstring(),this._byteData.position+=4,o=this._byteData.readShort();break;case 45075:r.x=this._byteData.readFloat(),r.z=this._byteData.readFloat(),r.y=this._byteData.readFloat();break;default:this._byteData.position+=l-6}}"$$$DUMMY"!=s&&this._unfinalized_objects.hasOwnProperty(s)&&(t=this._unfinalized_objects[s],i=this.constructObject(t,r),i&&(this._pContent.addChild(i),this._pFinalizeAsset(i,t.name)),delete this._unfinalized_objects[s])},t.prototype.constructObject=function(e,t){if(void 0===t&&(t=null),e.type==s.MESH){var i,a,o,n,l,h,p,_;if(e.materials.length>1&&console.log("The Away3D 3DS parser does not support multiple materials per mesh at this point."),!e.indices||0==e.indices.length)return null;for(p=new Array(e.verts.length/3),_=new Array(e.indices.length/3),this.prepareData(p,_,e),this._useSmoothingGroups&&this.applySmoothGroups(p,_),e.verts=new Array(3*p.length),i=0;i<p.length;i++)e.verts[3*i]=p[i].x,e.verts[3*i+1]=p[i].y,e.verts[3*i+2]=p[i].z;for(e.indices=new Array(3*_.length),i=0;i<_.length;i++)e.indices[3*i]=_[i].a,e.indices[3*i+1]=_[i].b,e.indices[3*i+2]=_[i].c;if(e.uvs)for(e.uvs=new Array(2*p.length),i=0;i<p.length;i++)e.uvs[2*i]=p[i].u,e.uvs[2*i+1]=p[i].v;if(o=new d,a=new c(!0),a.updateIndices(e.indices),a.updatePositions(e.verts),a.updateUVs(e.uvs),o.addSubGeometry(a),e.materials.length>0){var y;y=e.materials[0],n=this._materials[y].material}if(t){if(e.transform){var m=e.transform.concat();m[12]=0,m[13]=0,m[14]=0,h=new r(m),t=h.transformVector(t)}t.scaleBy(-1),h=new r,h.appendTranslation(t.x,t.y,t.z),o.applyTransformation(h)}return e.transform&&(h=new r(e.transform),h.invert(),o.applyTransformation(h)),this._pFinalizeAsset(o,e.name.concat("_geom")),l=new u(o,n),l.transform.matrix3D=new r(e.transform),l}return null},t.prototype.prepareData=function(e,t,i){var r,a,s,o=i.verts.length;for(r=0,a=0,s=0;o>r;){var n=new w;n.x=i.verts[r++],n.y=i.verts[r++],n.z=i.verts[r++],i.uvs&&(n.u=i.uvs[a++],n.v=i.uvs[a++]),e[s++]=n}for(o=i.indices.length,r=0,s=0;o>r;){var l=new g;l.a=i.indices[r++],l.b=i.indices[r++],l.c=i.indices[r++],l.smoothGroup=i.smoothingGroups[s]||0,t[s++]=l}},t.prototype.applySmoothGroups=function(e,t){var i,r,a,s,o,n=e.length,l=t.length,h=new Array(n);for(i=0;n>i;i++)h[i]=new Array;for(i=0;l>i;i++){var p=t[i];for(r=0;3>r;r++){var d=h[0==r?p.a:1==r?p.b:p.c],c=p.smoothGroup;for(a=d.length-1;a>=0;a--)(c&d[a])>0&&(c|=d[a],d.splice(a,1),a=d.length-1);d.push(c)}}var u=new Array(n);for(i=0;n>i;i++)if(!((o=h[i].length)<1)){var _=new Array(o);u[i]=_,_[0]=i;var y=e[i];for(r=1;o>r;r++){var m=new w;m.x=y.x,m.y=y.y,m.z=y.z,m.u=y.u,m.v=y.v,_[r]=e.length,e.push(m)}}for(n=e.length,i=0;l>i;i++)for(p=t[i],c=p.smoothGroup,r=0;3>r;r++)for(a=0==r?p.a:1==r?p.b:p.c,d=h[a],o=d.length,_=u[a],s=0;o>s;s++)if(0==c&&0==d[s]||(c&d[s])>0){var g=_[s];0==c&&(d.splice(s,1),_.splice(s,1)),0==r?p.a=g:1==r?p.b=g:p.c=g,s=o}},t.prototype.finalizeCurrentMaterial=function(){var e;e=new y(this._cur_mat.colorMap?this._cur_mat.colorMap.texture||_.getDefaultTexture():this._cur_mat.ambientColor),e.diffuseColor=this._cur_mat.diffuseColor,e.specularColor=this._cur_mat.specularColor,this.materialMode>=2&&(e.materialMode=m.MULTI_PASS),e.bothSides=this._cur_mat.twoSided,this._pFinalizeAsset(e,this._cur_mat.name),this._materials[this._cur_mat.name]=this._cur_mat,this._cur_mat.material=e,this._cur_mat=null},t.prototype.readNulTermstring=function(){for(var e,t="";(e=this._byteData.readUnsignedByte())>0;)t+=String.fromCharCode(e);return t},t.prototype.readTransform=function(){var e;return e=new Array(16),e[0]=this._byteData.readFloat(),e[2]=this._byteData.readFloat(),e[1]=this._byteData.readFloat(),e[3]=0,e[8]=this._byteData.readFloat(),e[10]=this._byteData.readFloat(),e[9]=this._byteData.readFloat(),e[11]=0,e[4]=this._byteData.readFloat(),e[6]=this._byteData.readFloat(),e[5]=this._byteData.readFloat(),e[7]=0,e[12]=this._byteData.readFloat(),e[14]=this._byteData.readFloat(),e[13]=this._byteData.readFloat(),e[15]=1,e},t.prototype.readColor=function(){var e,t,i,r,a;switch(e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedInt(),e){case 16:i=255*this._byteData.readFloat(),r=255*this._byteData.readFloat(),a=255*this._byteData.readFloat();break;case 17:i=this._byteData.readUnsignedByte(),r=this._byteData.readUnsignedByte(),a=this._byteData.readUnsignedByte();break;default:this._byteData.position+=t-6}return i<<16|r<<8|a},t}(l);t.exports=v},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/parsers/data/FaceVO":void 0,"awayjs-renderergl/lib/parsers/data/MaterialVO":void 0,"awayjs-renderergl/lib/parsers/data/ObjectVO":void 0,"awayjs-renderergl/lib/parsers/data/TextureVO":void 0,"awayjs-renderergl/lib/parsers/data/VertexVO":void 0,"awayjs-stagegl/lib/materials/TriangleMaterialMode":void 0,"awayjs-stagegl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-stagegl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/OBJParser":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/library/AssetType"),a=e("awayjs-core/lib/net/URLLoaderDataFormat"),s=e("awayjs-core/lib/net/URLRequest"),o=e("awayjs-core/lib/parsers/ParserBase"),n=e("awayjs-core/lib/parsers/ParserUtils"),l=e("awayjs-display/lib/containers/DisplayObjectContainer"),h=e("awayjs-display/lib/base/TriangleSubGeometry"),p=e("awayjs-display/lib/base/Geometry"),d=e("awayjs-display/lib/entities/Mesh"),c=e("awayjs-stagegl/lib/materials/utils/DefaultMaterialManager"),u=e("awayjs-stagegl/lib/materials/methods/SpecularBasicMethod"),_=e("awayjs-stagegl/lib/materials/TriangleMethodMaterial"),y=e("awayjs-stagegl/lib/materials/TriangleMaterialMode"),m=function(e){function t(t){void 0===t&&(t=1),e.call(this,a.TEXT),this._mtlLibLoaded=!0,this._activeMaterialID="",this._scale=t}return i(t,e),Object.defineProperty(t.prototype,"scale",{set:function(e){this._scale=e},enumerable:!0,configurable:!0}),t.supportsType=function(e){return e=e.toLowerCase(),"obj"==e},t.supportsData=function(e){var t=n.toString(e),i=!1,r=!1;return t&&(i=-1!=t.indexOf("\nv "),r=-1!=t.indexOf("\nf ")),i&&r},t.prototype._iResolveDependency=function(e){if("mtl"==e.id){var t=n.toString(e.data);this.parseMtl(t)}else{var i;if(1!=e.assets.length)return;if(i=e.assets[0],i.assetType==r.TEXTURE){var a=new w;a.materialID=e.id,a.texture=i,this._materialLoaded.push(a),this._meshes.length>0&&this.applyMaterial(a)}}},t.prototype._iResolveDependencyFailure=function(e){if("mtl"==e.id)this._mtlLib=!1,this._mtlLibLoaded=!1;else{var t=new w;t.materialID=e.id,this._materialLoaded.push(t)}this._meshes.length>0&&this.applyMaterial(t)},t.prototype._pProceedParsing=function(){var e,t,i=String.fromCharCode(10);for(this._startedParsing||(this._textData=this._pGetTextData(),this._textData=this._textData.replace(/\\[\r\n]+\s*/gm," ")),-1==this._textData.indexOf(i)&&(i=String.fromCharCode(13)),this._startedParsing||(this._startedParsing=!0,this._vertices=new Array,this._vertexNormals=new Array,this._materialIDs=new Array,this._materialLoaded=new Array,this._meshes=new Array,this._uvs=new Array,this._stringLength=this._textData.length,this._charIndex=this._textData.indexOf(i,0),this._oldIndex=0,this._objects=new Array,this._objectIndex=0);this._charIndex<this._stringLength&&this._pHasTime();)if(this._charIndex=this._textData.indexOf(i,this._oldIndex),-1==this._charIndex&&(this._charIndex=this._stringLength),e=this._textData.substring(this._oldIndex,this._charIndex),e=e.split("\r").join(""),e=e.replace("  "," "),t=e.split(" "),this._oldIndex=this._charIndex+1,this.parseLine(t),this.parsingPaused)return o.MORE_TO_PARSE;return this._charIndex>=this._stringLength?this._mtlLib&&!this._mtlLibLoaded?o.MORE_TO_PARSE:(this.translate(),this.applyMaterials(),o.PARSING_DONE):o.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new l},t.prototype.parseLine=function(e){switch(e[0]){case"mtllib":this._mtlLib=!0,this._mtlLibLoaded=!1,this.loadMtl(e[1]);break;case"g":this.createGroup(e);break;case"o":this.createObject(e);break;case"usemtl":this._mtlLib&&(e[1]||(e[1]="def000"),this._materialIDs.push(e[1]),this._activeMaterialID=e[1],this._currentGroup&&(this._currentGroup.materialID=this._activeMaterialID));break;case"v":this.parseVertex(e);break;case"vt":this.parseUV(e);break;case"vn":this.parseVertexNormal(e);break;case"f":this.parseFace(e)}},t.prototype.translate=function(){for(var e=0;e<this._objects.length;++e)for(var t,i,r,a,s,o,n,l=this._objects[e].groups,h=l.length,u=0;h>u;++u){for(r=new p,t=l[u].materialGroups,i=t.length,s=0;i>s;++s)this.translateMaterialGroup(t[s],r);if(0!=r.subGeometries.length){if(this._pFinalizeAsset(r),n=new _(c.getDefaultTexture()),this.materialMode>=2&&(n.materialMode=y.MULTI_PASS),a=new d(r,n),a.name=this._objects[e].name?this._objects[e].name:l[u].name?l[u].name:"",this._meshes.push(a),n.name=""!=l[u].materialID?l[u].materialID+"~"+a.name:this._lastMtlID+"~"+a.name,a.subMeshes.length>1)for(o=1;o<a.subMeshes.length;++o)a.subMeshes[o].material=n;this._pContent.addChild(a),this._pFinalizeAsset(a)}}},t.prototype.translateMaterialGroup=function(e,t){var i,r,a,s=e.faces,o=s.length,n=new Array,l=new Array,p=new Array,d=new Array;this._realIndices=[],this._vertexIndex=0;for(var c,u=0;o>u;++u)for(i=s[u],r=i.indexIds.length-1,c=1;r>c;++c)this.translateVertexData(i,c,n,l,d,p),this.translateVertexData(i,0,n,l,d,p),this.translateVertexData(i,c+1,n,l,d,p);n.length>0&&(a=new h(!0),a.autoDeriveNormals=p.length?!1:!0,a.updateIndices(d),a.updatePositions(n),a.updateVertexNormals(p),a.updateUVs(l),t.addSubGeometry(a))},t.prototype.translateVertexData=function(e,t,i,r,a,s){var o,n,l,h;if(this._realIndices[e.indexIds[t]])o=this._realIndices[e.indexIds[t]]-1;else if(o=this._vertexIndex,this._realIndices[e.indexIds[t]]=++this._vertexIndex,n=this._vertices[e.vertexIndices[t]-1],i.push(n.x*this._scale,n.y*this._scale,n.z*this._scale),e.normalIndices.length>0&&(l=this._vertexNormals[e.normalIndices[t]-1],s.push(l.x,l.y,l.z)),e.uvIndices.length>0)try{h=this._uvs[e.uvIndices[t]-1],r.push(h.u,h.v)}catch(p){switch(t){case 0:r.push(0,1);break;case 1:r.push(.5,0);break;case 2:r.push(1,1)}}a.push(o)},t.prototype.createObject=function(e){this._currentGroup=null,this._currentMaterialGroup=null,this._objects.push(this._currentObject=new g),e&&(this._currentObject.name=e[1])},t.prototype.createGroup=function(e){this._currentObject||this.createObject(null),this._currentGroup=new f,this._currentGroup.materialID=this._activeMaterialID,e&&(this._currentGroup.name=e[1]),this._currentObject.groups.push(this._currentGroup),this.createMaterialGroup(null)},t.prototype.createMaterialGroup=function(e){this._currentMaterialGroup=new b,e&&(this._currentMaterialGroup.url=e[1]),this._currentGroup.materialGroups.push(this._currentMaterialGroup)},t.prototype.parseVertex=function(e){var t,i,r;if(e.length>4){for(var a,s=[],o=1;o<e.length;++o)a=parseFloat(e[o]),isNaN(a)||s.push(a);t=s[0],i=s[1],r=-s[2],this._vertices.push(new T(t,i,r))}else t=parseFloat(e[1]),i=parseFloat(e[2]),r=-parseFloat(e[3]),this._vertices.push(new T(t,i,r))},t.prototype.parseUV=function(e){if(e.length>3){for(var t,i=[],r=1;r<e.length;++r)t=parseFloat(e[r]),isNaN(t)||i.push(t);this._uvs.push(new D(i[0],1-i[1]))}else this._uvs.push(new D(parseFloat(e[1]),1-parseFloat(e[2])))},t.prototype.parseVertexNormal=function(e){if(e.length>4){for(var t,i=[],r=1;r<e.length;++r)t=parseFloat(e[r]),isNaN(t)||i.push(t);this._vertexNormals.push(new T(i[0],i[1],-i[2]))}else this._vertexNormals.push(new T(parseFloat(e[1]),parseFloat(e[2]),-parseFloat(e[3])))},t.prototype.parseFace=function(e){var t=e.length,i=new v;this._currentGroup||this.createGroup(null);for(var r,a=1;t>a;++a)""!=e[a]&&(r=e[a].split("/"),i.vertexIndices.push(this.parseIndex(parseInt(r[0]),this._vertices.length)),r[1]&&String(r[1]).length>0&&i.uvIndices.push(this.parseIndex(parseInt(r[1]),this._uvs.length)),r[2]&&String(r[2]).length>0&&i.normalIndices.push(this.parseIndex(parseInt(r[2]),this._vertexNormals.length)),i.indexIds.push(e[a]));this._currentMaterialGroup.faces.push(i)},t.prototype.parseIndex=function(e,t){return 0>e?e+t+1:e},t.prototype.parseMtl=function(e){for(var t,i,r,a,o,n,l,h,p,d,c,m,g=e.split("newmtl"),f=0;f<g.length;++f){for(t=g[f].split("\r").join("").split("\n"),1==t.length&&(t=g[f].split(String.fromCharCode(13))),l=h=p=16777215,d=0,o=!1,n=!1,c=1,m="",r=0;r<t.length;++r)if(t[r]=t[r].replace(/\s+$/,""),"#"!=t[r].substring(0,1)&&(0==r||""!=t[r]))if(i=t[r].split(" "),(9==String(i[0]).charCodeAt(0)||32==String(i[0]).charCodeAt(0))&&(i[0]=i[0].substring(1,i[0].length)),0==r)this._lastMtlID=i.join(""),this._lastMtlID=""==this._lastMtlID?"def000":this._lastMtlID;else switch(i[0]){case"Ka":i[1]&&!isNaN(Number(i[1]))&&i[2]&&!isNaN(Number(i[2]))&&i[3]&&!isNaN(Number(i[3]))&&(h=255*i[1]<<16|255*i[2]<<8|255*i[3]);break;case"Ks":i[1]&&!isNaN(Number(i[1]))&&i[2]&&!isNaN(Number(i[2]))&&i[3]&&!isNaN(Number(i[3]))&&(p=255*i[1]<<16|255*i[2]<<8|255*i[3],o=!0);break;case"Ns":i[1]&&!isNaN(Number(i[1]))&&(d=.001*Number(i[1])),0==d&&(o=!1);break;case"Kd":i[1]&&!isNaN(Number(i[1]))&&i[2]&&!isNaN(Number(i[2]))&&i[3]&&!isNaN(Number(i[3]))&&(l=255*i[1]<<16|255*i[2]<<8|255*i[3],n=!0);break;case"tr":case"d":i[1]&&!isNaN(Number(i[1]))&&(c=Number(i[1]));break;case"map_Kd":m=this.parseMapKdString(i),m=m.replace(/\\/g,"/")}if(""!=m){if(o){a=new u,a.specularColor=p,a.specular=d;var b=new x;b.alpha=c,b.basicSpecularMethod=a,b.materialID=this._lastMtlID,this._materialSpecularData||(this._materialSpecularData=new Array),this._materialSpecularData.push(b)}this._pAddDependency(this._lastMtlID,new s(m))}else if(n&&!isNaN(h)){var v=new w;v.materialID=this._lastMtlID,0==c&&console.log("Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:"+this._lastMtlID+", mesh(es) using it will be invisible!");var D;if(this.materialMode<2){D=new _(h);var T=D;T.alpha=c,T.diffuseColor=l,T.repeat=!0,o&&(T.specularColor=p,T.specular=d)}else{D=new _(h),D.materialMode=y.MULTI_PASS;var P=D;P.diffuseColor=l,P.repeat=!0,o&&(P.specularColor=p,P.specular=d)}v.cm=D,this._materialLoaded.push(v),this._meshes.length>0&&this.applyMaterial(v)}}this._mtlLibLoaded=!0},t.prototype.parseMapKdString=function(e){var t,i,r="";for(t=1;t<e.length;){switch(e[t]){case"-blendu":case"-blendv":case"-cc":case"-clamp":case"-texres":t+=2;break;case"-mm":t+=3;break;case"-o":case"-s":case"-t":t+=4;continue;default:i=!0}if(i)break}for(t;t<e.length;t++)r+=e[t],r+=" ";return r=r.replace(/\s+$/,"")},t.prototype.loadMtl=function(e){this._pAddDependency("mtl",new s(e),!0),this._pPauseAndRetrieveDependencies()},t.prototype.applyMaterial=function(e){for(var t,i,r,a,s,o=0;o<this._meshes.length;++o)if(i=this._meshes[o],t=i.material.name.split("~"),t[0]==e.materialID){if(e.cm)i.material&&(i.material=null),i.material=e.cm;else if(e.texture)if(this.materialMode<2){if(r=i.material,r.texture=e.texture,r.color=e.color,r.alpha=e.alpha,r.repeat=!0,e.specularMethod)r.specularMethod=null,r.specularMethod=e.specularMethod;else if(this._materialSpecularData)for(a=0;a<this._materialSpecularData.length;++a)if(s=this._materialSpecularData[a],s.materialID==e.materialID){r.specularMethod=null,r.specularMethod=s.basicSpecularMethod,r.color=s.color,r.alpha=s.alpha;break}}else if(r=i.material,r.materialMode=y.MULTI_PASS,r.texture=e.texture,r.color=e.color,r.repeat=!0,e.specularMethod)r.specularMethod=null,r.specularMethod=e.specularMethod;else if(this._materialSpecularData)for(a=0;a<this._materialSpecularData.length;++a)if(s=this._materialSpecularData[a],s.materialID==e.materialID){r.specularMethod=null,r.specularMethod=s.basicSpecularMethod,r.color=s.color;break}i.material.name=t[1]?t[1]:t[0],this._meshes.splice(o,1),--o}(e.cm||r)&&this._pFinalizeAsset(e.cm||r)},t.prototype.applyMaterials=function(){if(0!=this._materialLoaded.length)for(var e=0;e<this._materialLoaded.length;++e)this.applyMaterial(this._materialLoaded[e])},t}(o),g=function(){function e(){this.groups=new Array}return e}(),f=function(){function e(){this.materialGroups=new Array}return e}(),b=function(){function e(){this.faces=new Array}return e}(),x=function(){function e(){this.color=16777215,this.alpha=1}return e}(),w=function(){function e(){this.color=16777215,this.alpha=1}return e}(),v=function(){function e(){this.vertexIndices=new Array,this.uvIndices=new Array,this.normalIndices=new Array,this.indexIds=new Array}return e}(),D=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._u=e,this._v=t}return Object.defineProperty(e.prototype,"v",{get:function(){return this._v},set:function(e){this._v=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"u",{get:function(){return this._u},set:function(e){this._u=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._u,this._v)},e.prototype.toString=function(){return this._u+","+this._v},e}(),T=function(){function e(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),this._x=e,this._y=t,this._z=i,this._index=r}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._x,this._y,this._z)},e}();t.exports=m},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-stagegl/lib/materials/TriangleMaterialMode":void 0,"awayjs-stagegl/lib/materials/TriangleMethodMaterial":void 0,"awayjs-stagegl/lib/materials/methods/SpecularBasicMethod":void 0,"awayjs-stagegl/lib/materials/utils/DefaultMaterialManager":void 0}],"awayjs-renderergl/lib/parsers/Parsers":[function(e,t){var i=e("awayjs-core/lib/library/AssetLoader"),r=e("awayjs-renderergl/lib/parsers/AWDParser"),a=e("awayjs-renderergl/lib/parsers/Max3DSParser"),s=e("awayjs-renderergl/lib/parsers/MD2Parser"),o=e("awayjs-renderergl/lib/parsers/OBJParser"),n=function(){function e(){}return e.enableAllBundled=function(){i.enableParsers(e.ALL_BUNDLED)},e.ALL_BUNDLED=Array(r,a,s,o),e}();t.exports=n},{"awayjs-core/lib/library/AssetLoader":void 0,"awayjs-renderergl/lib/parsers/AWDParser":void 0,"awayjs-renderergl/lib/parsers/MD2Parser":void 0,"awayjs-renderergl/lib/parsers/Max3DSParser":void 0,"awayjs-renderergl/lib/parsers/OBJParser":void 0}],"awayjs-renderergl/lib/parsers/data/AWDBlock":[function(e,t){var i=function(){function e(){}return e.prototype.dispose=function(){this.id=null,this.bytes=null,this.errorMessages=null,this.uvsForVertexAnimation=null},e.prototype.addError=function(e){this.errorMessages||(this.errorMessages=new Array),this.errorMessages.push(e)},e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/AWDProperties":[function(e,t){var i=function(){function e(){}return e.prototype.set=function(e,t){this[e.toString()]=t},e.prototype.get=function(e,t){return this.hasOwnProperty(e.toString())?this[e.toString()]:t},e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/BaseFrameData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/BitFlags":[function(e,t){var i=function(){function e(){}return e.test=function(e,t){return(e&t)==t},e.FLAG1=1,e.FLAG2=2,e.FLAG3=4,e.FLAG4=8,e.FLAG5=16,e.FLAG6=32,e.FLAG7=64,e.FLAG8=128,e.FLAG9=256,e.FLAG10=512,e.FLAG11=1024,e.FLAG12=2048,e.FLAG13=4096,e.FLAG14=8192,e.FLAG15=16384,e.FLAG16=32768,e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/BoundsData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/FaceVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/FrameData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/HierarchyData":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/MaterialVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/ObjectVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/TextureVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/parsers/data/VertexVO":[function(e,t){var i=function(){function e(){}return e}();t.exports=i},{}],"awayjs-renderergl/lib/pick/JSPickingCollider":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-renderergl/lib/pick/PickingColliderBase"),o=function(e){function t(t){void 0===t&&(t=!1),e.call(this),this._findClosestCollision=t}return i(t,e),t.prototype._pTestRenderableCollision=function(e,t,i){for(var s,o,n,l,h,p,d,c,u,_,y,m,g,f,b,x,w,v,D,T,P,C,S,A,O,M,j,N,I,R,F,E,V,B,L,z,k,U,G,X,H,W=e.getIndexData().data,J=-1,K=e.materialOwner.material.bothSides,Y=e.getVertexData(a.POSITION_DATA).data,Z=e.getVertexData(a.POSITION_DATA).dataPerVertex,q=e.getVertexOffset(a.POSITION_DATA),Q=e.getVertexData(a.UV_DATA).data,$=e.getVertexData(a.UV_DATA).dataPerVertex,et=e.getVertexOffset(a.UV_DATA),tt=W.length,it=0;tt>it;it+=3)if(o=q+W[it]*Z,n=q+W[it+1]*Z,l=q+W[it+2]*Z,v=Y[o],D=Y[o+1],T=Y[o+2],P=Y[n],C=Y[n+1],S=Y[n+2],A=Y[l],O=Y[l+1],M=Y[l+2],j=P-v,N=C-D,I=S-T,R=A-v,F=O-D,E=M-T,c=N*E-I*F,u=I*R-j*E,_=j*F-N*R,V=1/Math.sqrt(c*c+u*u+_*_),c*=V,u*=V,_*=V,B=c*this.rayDirection.x+u*+this.rayDirection.y+_*this.rayDirection.z,!K&&0>B||K&&0!=B){if(L=-(c*v+u*D+_*T),z=-(c*this.rayPosition.x+u*this.rayPosition.y+_*this.rayPosition.z+L),s=z/B,y=this.rayPosition.x+s*this.rayDirection.x,m=this.rayPosition.y+s*this.rayDirection.y,g=this.rayPosition.z+s*this.rayDirection.z,k=j*R+N*F+I*E,U=j*j+N*N+I*I,G=R*R+F*F+E*E,h=y-v,p=m-D,d=g-T,X=h*j+p*N+d*I,H=h*R+p*F+d*E,f=1/(U*G-k*k),x=f*(G*X-k*H),w=f*(-k*X+U*H),0>x)continue;if(0>w)continue;if(b=1-x-w,!(0>b)&&s>0&&i>s&&(i=s,J=it/3,t.rayEntryDistance=s,t.localPosition=new r(y,m,g),t.localNormal=new r(c,u,_),t.uv=this._pGetCollisionUV(W,Q,it,x,w,b,et,$),t.index=it,!this._findClosestCollision))return!0}return J>=0?!0:!1},t}(s);t.exports=o},{"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/pick/PickingColliderBase":void 0}],"awayjs-renderergl/lib/pick/PickingColliderBase":[function(e,t){var i=e("awayjs-core/lib/geom/Point"),r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-core/lib/errors/AbstractMethodError"),s=e("awayjs-display/lib/pool/RenderablePool"),o=e("awayjs-stagegl/lib/pool/BillboardRenderable"),n=e("awayjs-stagegl/lib/pool/TriangleSubMeshRenderable"),l=function(){function e(){this._billboardRenderablePool=s.getPool(o),this._subMeshRenderablePool=s.getPool(n)
}return e.prototype._pPetCollisionNormal=function(e,t,i){var a=new r,s=3*e[i],o=3*e[i+1],n=3*e[i+2],l=new r(t[s],t[s+1],t[s+2]),h=new r(t[o],t[o+1],t[o+2]),p=new r(t[n],t[n+1],t[n+2]),d=h.subtract(l),c=p.subtract(l);return a=d.crossProduct(c),a.normalize(),a},e.prototype._pGetCollisionUV=function(e,t,a,s,o,n,l,h){var p=new i,d=e[a]*h+l,c=new r(t[d],t[d+1]);d=e[a+1]*h+l;var u=new r(t[d],t[d+1]);d=e[a+2]*h+l;var _=new r(t[d],t[d+1]);return p.x=n*c.x+s*u.x+o*_.x,p.y=n*c.y+s*u.y+o*_.y,p},e.prototype._pTestRenderableCollision=function(){throw new a},e.prototype.setLocalRay=function(e,t){this.rayPosition=e,this.rayDirection=t},e.prototype.testBillboardCollision=function(e,t,i){return this.setLocalRay(t.localRayPosition,t.localRayDirection),t.materialOwner=null,this._pTestRenderableCollision(this._billboardRenderablePool.getItem(e),t,i)?(i=t.rayEntryDistance,t.materialOwner=e,!0):!1},e.prototype.testMeshCollision=function(e,t,i,r){this.setLocalRay(t.localRayPosition,t.localRayDirection),t.materialOwner=null;for(var a,s=e.subMeshes.length,o=0;s>o;++o)if(a=e.subMeshes[o],this._pTestRenderableCollision(this._subMeshRenderablePool.getItem(a),t,i)&&(i=t.rayEntryDistance,t.materialOwner=a,!r))return!0;return null!=t.materialOwner},e}();t.exports=l},{"awayjs-core/lib/errors/AbstractMethodError":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/pool/RenderablePool":void 0,"awayjs-stagegl/lib/pool/BillboardRenderable":void 0,"awayjs-stagegl/lib/pool/TriangleSubMeshRenderable":void 0}],"awayjs-renderergl/lib/pick/ShaderPicker":[function(e,t){var i=e("awayjs-core/lib/utils/Debug"),r=e("awayjs-core/lib/base/BitmapData"),a=e("awayjs-core/lib/geom/Matrix3DUtils"),s=e("awayjs-core/lib/geom/Point"),o=e("awayjs-core/lib/geom/Rectangle"),n=e("awayjs-core/lib/geom/Vector3D"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),h=e("awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler"),p=e("awayjs-stagegl/lib/base/ContextGLBlendFactor"),d=e("awayjs-stagegl/lib/base/ContextGLClearMask"),c=e("awayjs-stagegl/lib/base/ContextGLCompareMode"),u=e("awayjs-stagegl/lib/base/ContextGLProgramType"),_=e("awayjs-stagegl/lib/base/ContextGLTriangleFace"),y=function(){function e(e){void 0===e&&(e=!1),this._onlyMouseEnabled=!0,this._interactives=new Array,this._localHitPosition=new n,this._hitUV=new s,this._localHitNormal=new n,this._rayPos=new n,this._rayDir=new n,this._shaderPickingDetails=e,this._id=new Array(4),this._viewportData=new Array(4),this._boundOffsetScale=new Array(8),this._boundOffsetScale[3]=0,this._boundOffsetScale[7]=1}return Object.defineProperty(e.prototype,"onlyMouseEnabled",{get:function(){return this._onlyMouseEnabled},set:function(e){this._onlyMouseEnabled=e},enumerable:!0,configurable:!0}),e.prototype.getViewCollision=function(e,t,i){var a=i.iEntityCollector;if(this._stage=i.renderer.stage,!this._stage)return null;if(this._context=this._stage.context,this._viewportData[0]=i.width,this._viewportData[1]=i.height,this._viewportData[2]=-(this._projX=2*e/i.width-1),this._viewportData[3]=this._projY=2*t/i.height-1,this._potentialFound=!1,this._blendedRenderableHead=null,this._opaqueRenderableHead=null,this.pDraw(a,null),this._context.setVertexBufferAt(0,null),!this._context||!this._potentialFound)return null;if(this._bitmapData||(this._bitmapData=new r(1,1,!1,0)),this._context.drawToBitmapData(this._bitmapData),this._hitColor=this._bitmapData.getPixel(0,0),!this._hitColor)return this._context.present(),null;if(this._hitRenderable=this._interactives[this._hitColor-1],this._hitEntity=this._hitRenderable.sourceEntity,this._onlyMouseEnabled&&!this._hitEntity._iIsMouseEnabled())return null;var s=this._hitEntity._iPickingCollisionVO;return this._shaderPickingDetails?(this.getHitDetails(i.camera),s.localPosition=this._localHitPosition,s.localNormal=this._localHitNormal,s.uv=this._hitUV,s.index=this._faceIndex):(s.localPosition=null,s.localNormal=null,s.uv=null,s.index=0),s},e.prototype.getSceneCollision=function(){return null},e.prototype.pDraw=function(t){t.camera;this._context.clear(0,0,0,1),this._stage.scissorRect=e.MOUSE_SCISSOR_RECT,this._interactives.length=this._interactiveId=0,this._objectProgram||this.initObjectProgram(),this._context.setBlendFactors(p.ONE,p.ZERO),this._context.setDepthTest(!0,c.LESS),this._context.setProgram(this._objectProgram),this._context.setProgramConstantsFromArray(u.VERTEX,4,this._viewportData,1)},e.prototype.drawRenderables=function(e,t){for(var i=a.CALCULATION_MATRIX,r=t.viewProjection;e;)e.sourceEntity.scene&&e.sourceEntity._iIsMouseEnabled()?(this._potentialFound=!0,this._context.setCulling(e.materialOwner.material.bothSides?_.NONE:_.BACK,t.projection.coordinateSystem),this._interactives[this._interactiveId++]=e,this._id[1]=(this._interactiveId>>8)/255,this._id[2]=(255&this._interactiveId)/255,i.copyFrom(e.sourceEntity.getRenderSceneTransform(t)),i.append(r),this._context.setProgramConstantsFromMatrix(u.VERTEX,0,i,!0),this._context.setProgramConstantsFromArray(u.FRAGMENT,0,this._id,1),this._context.activateBuffer(0,e.getVertexData(l.POSITION_DATA),e.getVertexOffset(l.POSITION_DATA),l.POSITION_FORMAT),this._context.drawTriangles(this._context.getIndexBuffer(e.getIndexData()),0,e.numTriangles),e=e.next):e=e.next},e.prototype.updateRay=function(e){this._rayPos=e.scenePosition,this._rayDir=e.getRay(this._projX,this._projY,1),this._rayDir.normalize()},e.prototype.initObjectProgram=function(){var e,t;this._objectProgram=this._context.createProgram(),e="m44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",t="mov oc, fc0",i.throwPIR("ShaderPicker","initTriangleProgram","Dependency: initObjectProgram")},e.prototype.initTriangleProgram=function(){var e,t;this._triangleProgram=this._context.createProgram(),e="add vt0, va0, vc5 			\nmul vt0, vt0, vc6 			\nmov v0, vt0				\nm44 vt0, va0, vc0			\nmul vt1.xy, vt0.w, vc4.zw	\nadd vt0.xy, vt0.xy, vt1.xy	\nmul vt0.xy, vt0.xy, vc4.xy	\nmov op, vt0	\n",t="mov oc, v0";var i=(new h).assemble("part vertex 1\n"+e+"endpart").vertex.data,r=(new h).assemble("part fragment 1\n"+t+"endpart").fragment.data;this._triangleProgram.upload(i,r)},e.prototype.getHitDetails=function(e){this.getApproximatePosition(e),this.getPreciseDetails(e)},e.prototype.getApproximatePosition=function(t){var i,r,s,o,n,h,p,c=this._hitRenderable.sourceEntity.bounds.aabb,_=a.CALCULATION_MATRIX;_.copyFrom(this._hitRenderable.sourceEntity.getRenderSceneTransform(t)),_.append(t.viewProjection),this._triangleProgram||this.initTriangleProgram(),this._boundOffsetScale[4]=1/(r=c.width),this._boundOffsetScale[5]=1/(s=c.height),this._boundOffsetScale[6]=1/(o=c.depth),this._boundOffsetScale[0]=n=-c.x,this._boundOffsetScale[1]=h=-c.y,this._boundOffsetScale[2]=p=-c.z,this._context.setProgram(this._triangleProgram),this._context.clear(0,0,0,0,1,0,d.DEPTH),this._context.setScissorRectangle(e.MOUSE_SCISSOR_RECT),this._context.setProgramConstantsFromMatrix(u.VERTEX,0,_,!0),this._context.setProgramConstantsFromArray(u.VERTEX,5,this._boundOffsetScale,2),this._context.activateBuffer(0,this._hitRenderable.getVertexData(l.POSITION_DATA),this._hitRenderable.getVertexOffset(l.POSITION_DATA),l.POSITION_FORMAT),this._context.drawTriangles(this._context.getIndexBuffer(this._hitRenderable.getIndexData()),0,this._hitRenderable.numTriangles),this._context.drawToBitmapData(this._bitmapData),i=this._bitmapData.getPixel(0,0),this._localHitPosition.x=(i>>16&255)*r/255-n,this._localHitPosition.y=(i>>8&255)*s/255-h,this._localHitPosition.z=(255&i)*o/255-p},e.prototype.getPreciseDetails=function(e){var t,i,r,a,s,o,n,h,p,d,c,u,_,y,m,g,f,b,x,w,v,D,T,P,C,S,A,O,M,j,N,I,R,F,E,V,B,L,z,k,U,G,X,H,W,J,K,Y,Z=rt.length,q=0,Q=1,$=2,et=this._localHitPosition.x,tt=this._localHitPosition.y,it=this._localHitPosition.z,rt=this._hitRenderable.getIndexData().data,at=this._hitRenderable.getVertexData(l.POSITION_DATA).data,st=this._hitRenderable.getVertexData(l.POSITION_DATA).dataPerVertex,ot=this._hitRenderable.getVertexOffset(l.POSITION_DATA),nt=this._hitRenderable.getVertexData(l.UV_DATA).data,lt=this._hitRenderable.getVertexData(l.UV_DATA).dataPerVertex,ht=this._hitRenderable.getVertexOffset(l.UV_DATA),pt=(this._hitRenderable.getVertexData(l.NORMAL_DATA).data,this._hitRenderable.getVertexData(l.NORMAL_DATA).dataPerVertex),dt=this._hitRenderable.getVertexOffset(l.NORMAL_DATA);for(this.updateRay(e);Z>q;){if(d=ot+rt[q]*st,c=ot+rt[Q]*st,u=ot+rt[$]*st,t=at[d],i=at[d+1],r=at[d+2],a=at[c],s=at[c+1],o=at[c+2],n=at[u],h=at[u+1],p=at[u+2],!(t>et&&a>et&&n>et||i>tt&&s>tt&&h>tt||r>it&&o>it&&p>it||et>t&&et>a&&et>n||tt>i&&tt>s&&tt>h||it>r&&it>o&&it>p)&&(_=n-t,y=h-i,m=p-r,g=a-t,f=s-i,b=o-r,x=et-t,w=tt-i,v=it-r,M=_*_+y*y+m*m,j=_*g+y*f+m*b,N=_*x+y*w+m*v,I=g*g+f*f+b*b,R=g*x+f*w+b*v,V=1/(M*I-j*j),F=(I*N-j*R)*V,E=(M*R-j*N)*V,F>=0&&E>=0&&1>=F+E))return D=dt+rt[q]*pt,T=dt+rt[Q]*pt,P=dt+rt[$]*pt,C=rt[D]+rt[T]+rt[P],S=rt[D+1]+rt[T+1]+rt[P+1],A=rt[D+2]+rt[T+2]+rt[P+2],O=Math.sqrt(C*C+S*S+A*A),C/=O,S/=O,A/=O,this.getPrecisePosition(this._hitRenderable.sourceEntity.inverseSceneTransform,C,S,A,t,i,r),x=this._localHitPosition.x-t,w=this._localHitPosition.y-i,v=this._localHitPosition.z-r,G=a-t,X=s-i,H=o-r,W=n-t,J=h-i,K=p-r,this._localHitNormal.x=X*K-H*J,this._localHitNormal.y=H*W-G*K,this._localHitNormal.z=G*J-X*W,Y=1/Math.sqrt(this._localHitNormal.x*this._localHitNormal.x+this._localHitNormal.y*this._localHitNormal.y+this._localHitNormal.z*this._localHitNormal.z),this._localHitNormal.x*=Y,this._localHitNormal.y*=Y,this._localHitNormal.z*=Y,N=_*x+y*w+m*v,R=g*x+f*w+b*v,F=(I*N-j*R)*V,E=(M*R-j*N)*V,z=ht+rt[q]*lt,k=ht+rt[Q]*lt,U=ht+rt[$]*lt,B=nt[z],L=nt[z+1],this._hitUV.x=B+E*(nt[k]-B)+F*(nt[U]-B),this._hitUV.y=L+E*(nt[k+1]-L)+F*(nt[U+1]-L),void(this._faceIndex=q);q+=3,Q+=3,$+=3}},e.prototype.getPrecisePosition=function(e,t,i,r,s,o,n){var l,h,p,d,c,u,_,y=a.RAW_DATA_CONTAINER,m=this._rayPos.x,g=this._rayPos.y,f=this._rayPos.z;d=this._rayDir.x,c=this._rayDir.y,u=this._rayDir.z,e.copyRawDataTo(y),l=y[0]*d+y[4]*c+y[8]*u,h=y[1]*d+y[5]*c+y[9]*u,p=y[2]*d+y[6]*c+y[10]*u,d=y[0]*m+y[4]*g+y[8]*f+y[12],c=y[1]*m+y[5]*g+y[9]*f+y[13],u=y[2]*m+y[6]*g+y[10]*f+y[14],_=((s-d)*t+(o-c)*i+(n-u)*r)/(l*t+h*i+p*r),this._localHitPosition.x=d+l*_,this._localHitPosition.y=c+h*_,this._localHitPosition.z=u+p*_},e.prototype.dispose=function(){this._bitmapData.dispose(),this._triangleProgram&&this._triangleProgram.dispose(),this._objectProgram&&this._objectProgram.dispose(),this._triangleProgram=null,this._objectProgram=null,this._bitmapData=null,this._hitRenderable=null,this._hitEntity=null},e.MOUSE_SCISSOR_RECT=new o(0,0,1,1),e}();t.exports=y},{"awayjs-core/lib/base/BitmapData":void 0,"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Rectangle":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/utils/Debug":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-stagegl/lib/aglsl/assembler/AGALMiniAssembler":void 0,"awayjs-stagegl/lib/base/ContextGLBlendFactor":void 0,"awayjs-stagegl/lib/base/ContextGLClearMask":void 0,"awayjs-stagegl/lib/base/ContextGLCompareMode":void 0,"awayjs-stagegl/lib/base/ContextGLProgramType":void 0,"awayjs-stagegl/lib/base/ContextGLTriangleFace":void 0}],"awayjs-renderergl/lib/tools/commands/Merge":[function(e,t){var i=e("awayjs-core/lib/geom/Matrix3DUtils"),r=e("awayjs-display/lib/base/Geometry"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-display/lib/entities/Mesh"),o=function(){function e(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),this._keepMaterial=e,this._disposeSources=t,this._objectSpace=i}return Object.defineProperty(e.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(e){this._disposeSources=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(e){this._keepMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(e){this._objectSpace=e},enumerable:!0,configurable:!0}),e.prototype.applyToContainer=function(e,t){this.reset(),this.parseContainer(e,t),this.collect(e,!1),this.merge(e,this._disposeSources)},e.prototype.applyToMeshes=function(e,t){if(this.reset(),t.length){for(var i=0;i<t.length;i++)t[i]!=e&&this.collect(t[i],this._disposeSources);this.collect(e,!1),this.merge(e,this._disposeSources)}},e.prototype.apply=function(e,t){this.reset(),this.collect(t,this._disposeSources),this.collect(e,!1),this.merge(e,this._disposeSources)},e.prototype.reset=function(){this._toDispose=new Array,this._geomVOs=new Array},e.prototype.merge=function(e,t){var i,s,o,n,l;for(o=e.geometry,n=e.geometry=new r,s=e.subMeshes.length,l=this._geomVOs.length>1,i=0;i<this._geomVOs.length;i++){var h,p=new a(!0);p.autoDeriveNormals=!1,p.autoDeriveTangents=!1,h=this._geomVOs[i],p.updateIndices(h.indices),p.updatePositions(h.vertices),p.updateVertexNormals(h.normals),p.updateVertexTangents(h.tangents),p.updateUVs(h.uvs),n.addSubGeometry(p),this._keepMaterial&&l&&(e.subMeshes[s].material=h.material)}if(this._keepMaterial&&!l&&this._geomVOs.length&&(e.material=this._geomVOs[0].material),t){for(var d,i,c=this._toDispose.length;c>i;i++)d=this._toDispose[i],d.geometry.dispose(),d.dispose();o.dispose()}this._toDispose=null},e.prototype.collect=function(e,t){if(e.geometry){var r,a,s=e.geometry.subGeometries;for(r=0;r<s.length;r++){var o,n,l,h,p,d,c,u,_,y,m,g,f,b,x,w,v;for(_=s[r],b=_.positions,x=_.vertexNormals,w=_.vertexTangents,v=_.uvs,y=this.getSubGeomData(e.subMeshes[r].material||e.material),m=this._objectSpace?y.vertices:new Array,g=this._objectSpace?y.normals:new Array,f=this._objectSpace?y.tangents:new Array,h=m.length,p=g.length,d=f.length,c=y.uvs.length,n=_.numVertices,o=0;n>o;o++)a=3*o,m[h++]=b[a],m[h++]=b[a+1],m[h++]=b[a+2],g[p++]=x[a],g[p++]=x[a+1],g[p++]=x[a+2],f[d++]=w[a],f[d++]=w[a+1],f[d++]=w[a+2],y.uvs[c++]=v[2*o],y.uvs[c++]=v[2*o+1];for(u=this._objectSpace?0:y.vertices.length/3,l=y.indices.length,n=_.numTriangles,o=0;n>o;o++)a=3*o,y.indices[l++]=_.indices[a]+u,y.indices[l++]=_.indices[a+1]+u,y.indices[l++]=_.indices[a+2]+u;if(!this._objectSpace)for(e.sceneTransform.transformVectors(m,m),i.deltaTransformVectors(e.sceneTransform,g,g),i.deltaTransformVectors(e.sceneTransform,f,f),h=y.vertices.length,p=y.normals.length,d=y.tangents.length,n=m.length,o=0;n>o;o++)y.vertices[h++]=m[o],y.normals[p++]=g[o],y.tangents[d++]=f[o]}t&&this._toDispose.push(e)}},e.prototype.getSubGeomData=function(e){var t;if(this._keepMaterial){var i,r;for(r=this._geomVOs.length,i=0;r>i;i++)if(this._geomVOs[i].material==e){t=this._geomVOs[i];break}}else this._geomVOs.length&&(t=this._geomVOs[0]);return t||(t=new n,t.vertices=new Array,t.normals=new Array,t.tangents=new Array,t.uvs=new Array,t.indices=new Array,t.material=e,this._geomVOs.push(t)),t},e.prototype.parseContainer=function(e,t){var i,r;for(t instanceof s&&t!=e&&this.collect(t,this._disposeSources),r=0;r<t.numChildren;++r)i=t.getChildAt(r),this.parseContainer(e,i)},e}(),n=function(){function e(){}return e}();t.exports=o},{"awayjs-core/lib/geom/Matrix3DUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/entities/Mesh":void 0}],"awayjs-renderergl/lib/tools/data/ParticleGeometryTransform":[function(e,t){var i=function(){function e(){}return Object.defineProperty(e.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(e){this._defaultVertexTransform=e,this._defaultInvVertexTransform=e.clone(),this._defaultInvVertexTransform.invert(),this._defaultInvVertexTransform.transpose()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(e){this._defaultUVTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:!0,configurable:!0}),e}();t.exports=i},{}],"awayjs-renderergl/lib/tools/helpers/ParticleGeometryHelper":[function(e,t){var i=e("awayjs-core/lib/geom/Point"),r=e("awayjs-core/lib/geom/Vector3D"),a=e("awayjs-display/lib/base/TriangleSubGeometry"),s=e("awayjs-renderergl/lib/animators/data/ParticleData"),o=e("awayjs-renderergl/lib/base/ParticleGeometry"),n=function(){function e(){}return e.generateGeometry=function(t,n){void 0===n&&(n=null);var l,h,p,d,c,u,_,y,m,g,f,b,x=new Array,w=new Array,v=new Array,D=new Array,T=new Array,P=new Array,C=new Array,S=new Array,A=t.length,O=new Array,M=new r,j=new r,N=new r,I=new i;for(f=0;A>f;f++){l=t[f].subGeometries,p=l.length;for(var R=0;p>R;R++){O.length<=R&&(O.push(S.length),x.push(new Array),w.push(new Array),v.push(new Array),D.push(new Array),T.push(new Array),S.push(new a(!0)),P.push(0)),h=l[R],h.numVertices+P[O[R]]>e.MAX_VERTEX&&(O[R]=S.length,x.push(new Array),w.push(new Array),v.push(new Array),D.push(new Array),T.push(new Array),S.push(new a(!0)),P.push(0)),b=O[R],d=x[b],c=w[b],u=v[b],_=D[b],y=T[b],m=P[b],g=S[b];var F=new s;F.numVertices=h.numVertices,F.startVertexIndex=m,F.particleIndex=f,F.subGeometry=g,C.push(F),P[b]+=h.numVertices;var E,V,B,L,z,k,U,G=h;if(G)if(V=G.numVertices,G.numTriangles,L=G.positions,z=G.vertexNormals,k=G.vertexTangents,U=G.uvs,n){var X=n[f],H=X.vertexTransform,W=X.invVertexTransform,J=X.UVTransform;for(E=0;V>E;E++)B=3*E,M.x=L[B],M.y=L[B+1],M.z=L[B+2],j.x=z[B],j.y=z[B+1],j.z=z[B+2],N.x=k[B],N.y=k[B+1],N.z=k[B+2],I.x=U[2*E],I.y=U[2*E+1],H&&(M=H.transformVector(M),j=W.deltaTransformVector(j),N=W.deltaTransformVector(j)),J&&(I=J.transformPoint(I)),L.push(M.x,M.y,M.z),z.push(j.x,j.y,j.z),k.push(N.x,N.y,N.z),U.push(I.x,I.y)}else for(E=0;V>E;E++)B=3*E,c.push(L[B],L[B+1],L[B+2]),u.push(z[B],z[B+1],z[B+2]),_.push(k[B],k[B+1],k[B+2]),y.push(U[2*E],U[2*E+1]);var K=h.indices;for(V=h.numTriangles,E=0;V>E;E++)B=3*E,d.push(K[B]+m,K[B+1]+m,K[B+2]+m)}}var Y=new o;for(Y.particles=C,Y.numParticles=A,A=S.length,f=0;A>f;f++)g=S[f],g.autoDeriveNormals=!1,g.autoDeriveTangents=!1,g.updateIndices(x[f]),g.updatePositions(w[f]),g.updateVertexNormals(v[f]),g.updateVertexTangents(D[f]),g.updateUVs(T[f]),Y.addSubGeometry(g);return Y},e.MAX_VERTEX=65535,e}();t.exports=n},{"awayjs-core/lib/geom/Point":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-renderergl/lib/animators/data/ParticleData":void 0,"awayjs-renderergl/lib/base/ParticleGeometry":void 0}],"awayjs-renderergl/lib/utils/PerspectiveMatrix3D":[function(e,t){var i=this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},r=e("awayjs-core/lib/geom/Matrix3D"),a=function(e){function t(t){void 0===t&&(t=null),e.call(this,t)}return i(t,e),t.prototype.perspectiveFieldOfViewLH=function(e,t,i,r){var a=1/Math.tan(e/2),s=a/t;this.copyRawDataFrom([s,0,0,0,0,a,0,0,0,0,r/(r-i),1,0,0,i*r/(i-r),0])},t}(r);t.exports=a},{"awayjs-core/lib/geom/Matrix3D":void 0}]},{},[]);
//# sourceMappingURL=awayjs-renderergl.min.js.map